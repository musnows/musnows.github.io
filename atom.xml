<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æ…•é›ªçš„å¯’èˆ</title>
  
  <subtitle>é›ªä¸‹äº†ä¸€å¤œ</subtitle>
  <link href="https://blog.musnow.top/atom.xml" rel="self"/>
  
  <link href="https://blog.musnow.top/"/>
  <updated>2023-09-01T10:12:55.000Z</updated>
  <id>https://blog.musnow.top/</id>
  
  <author>
    <name>æ…•é›ªå¹´å</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ã€Linuxã€‘rootå’Œå­ç”¨æˆ·éƒ½èƒ½æ‰§è¡Œçš„å‘½ä»¤ï¼Œsudoæ— æ³•æ‰§è¡Œï¼ˆå·²è§£å†³ï¼‰</title>
    <link href="https://blog.musnow.top/posts/2473452644/"/>
    <id>https://blog.musnow.top/posts/2473452644/</id>
    <published>2023-09-01T10:12:55.000Z</published>
    <updated>2023-09-01T10:12:55.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å…¨æµç¨‹å¸–å­ <a href="https://ask.oceanbase.com/t/topic/35604437/7">https://ask.oceanbase.com/t/topic/35604437/7</a></p></blockquote><h1 id="1-é—®é¢˜"><a href="#1-é—®é¢˜" class="headerlink" title="1.é—®é¢˜"></a>1.é—®é¢˜</h1><p>å¦‚é¢˜ï¼Œåœ¨ç¼–è¯‘miniobçš„æ—¶å€™é‡åˆ°å¦‚ä¸‹é”™è¯¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[mu@vm-cnt8:~/code/miniob]$ sudo bash build.sh init</span><br><span class="line">build.sh init</span><br><span class="line">HEAD is now at 5df3037d Merge branch <span class="string">&#x27;release-2.1.12-stable-pull&#x27;</span> into patches-2.1</span><br><span class="line">build.sh: line 83: cmake: <span class="built_in">command</span> not found</span><br><span class="line">build.sh: line 91: cmake: <span class="built_in">command</span> not found</span><br><span class="line">build.sh: line 99: cmake: <span class="built_in">command</span> not found</span><br><span class="line">build.sh: line 107: cmake: <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure><p>æ ¹æ®å­—é¢æ„æ€ï¼Œæ˜¯cmakeå‘½ä»¤æ‰¾ä¸åˆ°ï¼Œä½†æ˜¯æˆ‘çš„ç³»ç»Ÿé‡Œé¢å·²ç»æœ‰äº†ç¬¦åˆæ¡ä»¶çš„ç¯å¢ƒï¼›ä»¥ä¸‹æ˜¯gihub&#x2F;miniobä»“åº“ä¸­docsé‡Œé¢<code>how_to_build.md</code>çš„å†…å®¹</p><blockquote><p>MiniOB éœ€è¦ä½¿ç”¨ï¼š</p><ul><li>cmake ç‰ˆæœ¬ &gt;&#x3D; 3.13</li><li>gcc&#x2F;clang gccå»ºè®®8.3ä»¥ä¸Šï¼Œç¼–è¯‘å™¨éœ€è¦æ”¯æŒc++20æ–°æ ‡å‡†</li><li>flex (2.5+), bison (3.7+) ç”¨äºç”Ÿæˆè¯æ³•è¯­æ³•åˆ†æä»£ç </li></ul></blockquote><p>æˆ‘ä½¿ç”¨çš„ç³»ç»Ÿæ˜¯centos8-steamçš„vmwareè™šæ‹Ÿæœºï¼›å½“å‰ä½¿ç”¨çš„miniobçš„commitä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">76221e46e66ef408771ce886aa0c586a09374b0d</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯æˆ‘çš„ç³»ç»Ÿä¸­å„ä¸ªä¾èµ–é¡¹çš„ç‰ˆæœ¬å·ï¼Œå¯ä»¥çœ‹åˆ°åœ¨å­ç”¨æˆ·ä¸­ï¼Œä¾èµ–é¡¹çš„æ‰€æœ‰å‘½ä»¤éƒ½å¯ä»¥æ­£å¸¸æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[mu@vm-cnt8:~/code/miniob]$ gcc --version</span><br><span class="line">gcc (GCC) 8.5.0 20210514 (Red Hat 8.5.0-20)</span><br><span class="line">Copyright (C) 2018 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the <span class="built_in">source</span> <span class="keyword">for</span> copying conditions.  There is NO</span><br><span class="line">warranty; not even <span class="keyword">for</span> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br><span class="line"></span><br><span class="line">[mu@vm-cnt8:~/code/miniob]$ cmake --version</span><br><span class="line">cmake version 3.27.4</span><br><span class="line"></span><br><span class="line">CMake suite maintained and supported by Kitware (kitware.com/cmake).</span><br><span class="line">[mu@vm-cnt8:~/code/miniob]$ flex --version</span><br><span class="line">flex 2.6.1</span><br><span class="line">[mu@vm-cnt8:~/code/miniob]$ bison --version</span><br><span class="line">bison (GNU Bison) 3.8</span><br><span class="line">Written by Robert Corbett and Richard Stallman.</span><br><span class="line"></span><br><span class="line">Copyright (C) 2021 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the <span class="built_in">source</span> <span class="keyword">for</span> copying conditions.  There is NO</span><br><span class="line">warranty; not even <span class="keyword">for</span> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br></pre></td></tr></table></figure><p>åœ¨rootä¸­ï¼Œä¹Ÿå¯ä»¥æ­£å¸¸æ‰§è¡Œè¿™äº›å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@vm-cnt8:~]# cmake --version</span><br><span class="line">cmake version 3.27.4</span><br><span class="line"></span><br><span class="line">CMake suite maintained and supported by Kitware (kitware.com/cmake).</span><br><span class="line">[root@vm-cnt8:~]# flex --version</span><br><span class="line">flex 2.6.1</span><br><span class="line">[root@vm-cnt8:~]# bison --version</span><br><span class="line">bison (GNU Bison) 3.8</span><br><span class="line">Written by Robert Corbett and Richard Stallman.</span><br><span class="line"></span><br><span class="line">Copyright (C) 2021 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the source for copying conditions.  There is NO</span><br><span class="line">warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯sudoæ‰§è¡Œminiobçš„å®‰è£…è„šæœ¬çš„æ—¶å€™ï¼Œå´æ‰¾ä¸åˆ°cmakeå‘½ä»¤</p><h1 id="2-debugè¿‡ç¨‹"><a href="#2-debugè¿‡ç¨‹" class="headerlink" title="2.debugè¿‡ç¨‹"></a>2.debugè¿‡ç¨‹</h1><p>ç»è¿‡å¤§ä½¬çš„æ•™å­¦ï¼ŒçŸ¥é“äº†ä¸€ä¸ªæ–°çš„sudoç”¨æ³•ï¼š<code>sudo -E</code></p><blockquote><p><code>sudo -E</code> æ˜¯ç»§æ‰¿å½“å‰ç”¨æˆ·çš„ç¯å¢ƒå˜é‡è¿è¡Œsudoåé¢çš„å‘½ä»¤ï¼Œå¦åˆ™ç¯å¢ƒå˜é‡ä¼šè¢«æ¸…ç†æ‰ï¼›</p></blockquote><p>ä½†æ˜¯åœ¨åˆæ¬¡ä½¿ç”¨çš„æ—¶å€™ï¼Œä¾æ—§æ— æ³•æˆåŠŸç¼–è¯‘miniobï¼Œä¹Ÿæ‰¾ä¸åˆ°cmakeå‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[mu@vm-cnt8:~/code/miniob]$ sudo -E bash build.sh init</span><br><span class="line">[sudo] password for mu: </span><br><span class="line">build.sh init</span><br><span class="line">HEAD is now at 5df3037d Merge branch &#x27;release-2.1.12-stable-pull&#x27; into patches-2.1</span><br><span class="line">build.sh: line 83: cmake: command not found</span><br><span class="line">build.sh: line 91: cmake: command not found</span><br><span class="line">build.sh: line 99: cmake: command not found</span><br><span class="line">build.sh: line 107: cmake: command not found</span><br><span class="line"></span><br><span class="line">[mu@vm-cnt8:~]$ sudo -E cmake --version</span><br><span class="line">[sudo] password for mu: </span><br><span class="line">sudo: cmake: command not found</span><br></pre></td></tr></table></figure><h1 id="3-æœ€ç»ˆè§£å†³ï¼šPATHç¯å¢ƒå˜é‡"><a href="#3-æœ€ç»ˆè§£å†³ï¼šPATHç¯å¢ƒå˜é‡" class="headerlink" title="3.æœ€ç»ˆè§£å†³ï¼šPATHç¯å¢ƒå˜é‡"></a>3.æœ€ç»ˆè§£å†³ï¼šPATHç¯å¢ƒå˜é‡</h1><p>æœ€ç»ˆçš„è§£å†³åŠæ³•æ˜¯æˆ‘è‡ªå·±æƒ³å‡ºæ¥çš„ï¼ˆå¤§ä½¬ä¹Ÿå›å¤äº†æˆ‘è¿™ä¸ªè§£å†³æ–¹æ¡ˆï¼‰</p><p>å½“å‰åœ¨å­ç”¨æˆ·ä½¿ç”¨ <code>sudo -E</code>æ˜¯æ‰¾ä¸åˆ°cmakeå‘½ä»¤çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[mu@vm-cnt8:~]$ sudo -E cmake --version</span><br><span class="line">[sudo] password for mu: </span><br><span class="line">sudo: cmake: command not found</span><br></pre></td></tr></table></figure><p>æˆ‘çš„ç³»ç»Ÿé‡Œé¢çš„PATHç¯å¢ƒå˜é‡å¦‚ä¸‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mu@vm-cnt8:~]$ sudo <span class="built_in">env</span> | grep PATH</span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin</span><br></pre></td></tr></table></figure><p>è€Œcmakeçš„è·¯å¾„å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[mu@vm-cnt8:~]$ type cmake</span><br><span class="line">cmake is /usr/local/bin/cmake</span><br><span class="line">[mu@vm-cnt8:~]$ whereis cmake</span><br><span class="line">cmake: /usr/local/bin/cmake /usr/share/cmake</span><br></pre></td></tr></table></figure><p>æœ‰æ²¡æœ‰å¯èƒ½ï¼Œæ˜¯å› ä¸ºcmakeä¸åœ¨PATHç¯å¢ƒå˜é‡é‡Œé¢ï¼Œå¯¼è‡´sudoçš„æ—¶å€™æ‰¾ä¸åˆ°å‘½ä»¤å‘¢ï¼Ÿè™½ç„¶åœ¨rootå’Œmuç”¨æˆ·ä¸‹éƒ½å¯ä»¥ç›´æ¥æ‰§è¡Œcmakeã€‚</p><p>äºæ˜¯æˆ‘å°±å»rooté‡Œé¢æ‰§è¡Œäº†ä¸€ä¸‹è½¯è¿æ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@vm-cnt8:~]# ls /usr/bin | grep cmake</span><br><span class="line">[root@vm-cnt8:~]# ln -s /usr/local/bin/cmake /usr/bin/cmake</span><br><span class="line">[root@vm-cnt8:~]# ll /usr/bin | grep cmake</span><br><span class="line">lrwxrwxrwx. 1 root root          20 Sep  1 05:57 cmake -&gt; /usr/local/bin/cmake</span><br></pre></td></tr></table></figure><p>å†æ¥è¯•è¯•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo -E cmake --version</span><br><span class="line">cmake version 3.27.4</span><br><span class="line"></span><br><span class="line">CMake suite maintained and supported by Kitware (kitware.com/cmake).</span><br></pre></td></tr></table></figure><p>æœ€åå†æ¥è¯•è¯•ç¼–è¯‘ï¼Œåº”è¯¥æ˜¯OKäº†ï¼ŒinitæˆåŠŸæ‰§è¡Œï¼Œç¼–è¯‘ä¹Ÿé€šè¿‡äº†ï¼Œæ²¡æœ‰æŠ¥é”™</p><p><img src="https://img.musnow.top/i/2023/09/7e206210ba3f9ffa5df6a492ae7b457a.png" alt="image-20230901181050840"></p><p>æ„Ÿè°¢miniobç¤¾åŒºå¤§ä½¬ä»¬çš„å¸®åŠ©ï¼</p><h1 id="4-ç»“è®º"><a href="#4-ç»“è®º" class="headerlink" title="4.ç»“è®º"></a>4.ç»“è®º</h1><p>å¦‚æœå‡ºç°ä¸€ä¸ªå‘½ä»¤ï¼Œrootå’Œå­ç”¨æˆ·éƒ½å¯ä»¥æ‰§è¡Œï¼Œä½†æ˜¯å­ç”¨æˆ·ä¸­sudoå´æ‰¾ä¸åˆ°æ­¤å‘½ä»¤ï¼Œå¯ä»¥å°è¯•æ£€æŸ¥ä¸€ä¸‹è¯¥å‘½ä»¤æ‰€åœ¨è·¯å¾„æ˜¯å¦ä¸å½“å‰ç³»ç»Ÿçš„PATHç¯å¢ƒå˜é‡ä¸ç¬¦åˆï¼</p>]]></content>
    
    
    <summary type="html">rootå’Œå­ç”¨æˆ·éƒ½èƒ½æ‰§è¡Œçš„å‘½ä»¤ï¼Œsudoå´æ— æ³•æ‰§è¡Œï¼Œå¦‚ä½•è§£å†³ï¼Ÿ</summary>
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ã€winã€‘Windowsä¸‹MSI Afterburnerå¦‚ä½•è®©å…¶ä¸åœ¨æŸä¸ªè½¯ä»¶ä¸­æ˜¾ç¤ºå¸§æ•°</title>
    <link href="https://blog.musnow.top/posts/4160666395/"/>
    <id>https://blog.musnow.top/posts/4160666395/</id>
    <published>2023-08-31T13:44:31.000Z</published>
    <updated>2023-08-31T13:44:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>Windowsä¸‹MSI Afterburnerå¦‚ä½•è®©å…¶ä¸åœ¨æŸä¸ªè½¯ä»¶ä¸­æ˜¾ç¤ºå¸§æ•°</p><span id="more"></span><h1 id="1-é—®é¢˜è¯´æ˜"><a href="#1-é—®é¢˜è¯´æ˜" class="headerlink" title="1.é—®é¢˜è¯´æ˜"></a>1.é—®é¢˜è¯´æ˜</h1><p>æ€»æ‰€å‘¨çŸ¥ï¼Œ<code>MSI Afterburner</code>è¿™ä¸ªè½¯ä»¶å¯ä»¥åœ¨æ¸¸æˆé‡Œé¢å±•ç¤ºä½ å½“å‰ç”µè„‘çš„å„é¡¹ç”Ÿå‘½ä½“å¾ï¼ŒåŒ…æ‹¬GPU&#x2F;CPUåŠŸè€—é¢‘ç‡æ¸©åº¦ï¼Œå†…å­˜å ç”¨ï¼Œå½“å‰å¸§æ•°ç­‰ç­‰æ•°æ®ï¼Œä¸ç®¡æ˜¯ç”¨æ¥ç›‘çœ‹ç”µè„‘è¿è¡Œæ˜¯å¦æ­£å¸¸ï¼Œè¿˜æ˜¯ç”¨æ¥å°è¶…ä¸€ä¸‹æ˜¾å¡ï¼Œéƒ½æ˜¯å¾ˆå¥½ç”¨çš„ä¸œè¥¿ï¼Œå†åŠ ä¸Šæ¯«æ— å¹¿å‘Š+å…è´¹ï¼Œå‡ ä¹æ˜¯äººæ‰‹å¿…å¤‡çš„PCè‰¯è¯</p><p><img src="https://img.musnow.top/i/2023/08/22a440a97052d98344faa1679af7e4a1.png" alt="image-20230831211541651"></p><p>ä½†æ€»æœ‰æ—¶å€™è¿™ä¸ªè½¯ä»¶ä¼šæŠ½é£ï¼Œæ¯”å¦‚æˆ‘çš„ç”µè„‘é‡Œé¢ï¼Œæœ€æ–°ç‰ˆæœ¬çš„è¿™ä¸ªè½¯ä»¶ï¼Œå°±ä¼šæŠŠç…§ç‰‡è«åå…¶å¦™çš„ä¹Ÿè¯†åˆ«æˆäº†ä¸€ä¸ªæ¸¸æˆï¼Œåœ¨é‡Œé¢æ˜¾ç¤ºå¸§æ•°ï¼Œæœ€ç¦»è°±çš„æ˜¯ï¼Œæœ€ä¸‹æ–¹çš„é¢„è§ˆå…¶ä»–å›¾ç‰‡çš„å°æ¡†æ¡†é‡Œé¢ï¼Œä¹Ÿç»™ä½ æ˜¾ç¤ºäº†å¸§æ•°</p><p><img src="https://img.musnow.top/i/2023/08/33033ee6b815fd496aefff2db7b41983.png" alt="image-20230831211739693"></p><p>è¿™è‚¯å®šå¾ˆæ¼ç«ï¼Œæˆ‘ä»¬è¦æ€ä¹ˆæ ·æ‰èƒ½è®©ä»–ä¸åœ¨è¿™é‡Œé¢æ˜¾ç¤ºå‘¢ï¼Ÿ</p><h1 id="2-é…ç½®"><a href="#2-é…ç½®" class="headerlink" title="2.é…ç½®"></a>2.é…ç½®</h1><p>å’Œ<code>MSI Afterburner</code>æ†ç»‘ä¸‹è½½çš„æœ‰è¿™ä¹ˆä¸€ä¸ªè½¯ä»¶ï¼Œå…¶å®å®ƒæ‰æ˜¯è´Ÿè´£å°†æ•°æ®æŠ•å±åˆ°ä½ çš„å±å¹•ä¸Šçš„è½¯ä»¶ï¼Œåœ¨è¿™é‡Œé¢ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¾ç½®åœ¨æŸä¸ªè½¯ä»¶ä¸­ä¸æ˜¾ç¤ºå¸§æ•°</p><p><img src="https://img.musnow.top/i/2023/08/38ddd77df81cad02c8ac53f0834550f8.png" alt="image-20230831212031500"></p><p>å¯¹äºæ­£å¸¸å®‰è£…çš„è½¯ä»¶ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æ‰¾åˆ°è½¯ä»¶çš„å®‰è£…è·¯å¾„ï¼Œé€‰ä¸­å®ƒçš„exeå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå†è®¾ç½®ä¸€ä¸‹æŠŠå¸§æ•°å™¨å…³é—­ï¼Œå°±å¯ä»¥é¿å…é”™è¯¯åœ°æ˜¾ç¤ºå¸§æ•°å½±å“è½¯ä»¶è‡ªèº«çš„ä½¿ç”¨</p><p><img src="https://img.musnow.top/i/2023/08/952d106d45b52990e2bd63ae4ddc5534.png" alt="image-20230831212050181"></p><p>ä½†æ˜¯windowsè‡ªå¸¦çš„ç›¸å†Œå°±æœ‰ç‚¹æ¼ç«äº†ï¼Œ<strong>æˆ‘ä»¬å‹æ ¹ä¸çŸ¥é“å®ƒçš„å¯æ‰§è¡Œæ–‡ä»¶åœ¨å“ªé‡Œ</strong>ï¼</p><h1 id="3-windowsç³»ç»Ÿåº”ç”¨çš„å¯æ‰§è¡Œæ–‡ä»¶"><a href="#3-windowsç³»ç»Ÿåº”ç”¨çš„å¯æ‰§è¡Œæ–‡ä»¶" class="headerlink" title="3.windowsç³»ç»Ÿåº”ç”¨çš„å¯æ‰§è¡Œæ–‡ä»¶"></a>3.windowsç³»ç»Ÿåº”ç”¨çš„å¯æ‰§è¡Œæ–‡ä»¶</h1><p>windowsç»å¤§éƒ¨åˆ†çš„ç³»ç»Ÿè‡ªå¸¦è½¯ä»¶éƒ½åœ¨è¿™é‡Œé¢ï¼Œä½ éœ€è¦æ‰“å¼€æ˜¾ç¤ºéšè—æ–‡ä»¶å¤¹æ‰èƒ½çœ‹åˆ°æ­¤æ–‡ä»¶å¤¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\WindowsApps\</span><br></pre></td></tr></table></figure><p>è€Œ<a href="https://zhidao.baidu.com/question/1550787637804576787.html">ç…§ç‰‡è½¯ä»¶è·¯å¾„</a>å¦‚ä¸‹ï¼ˆæˆ‘çš„win11ç‰ˆæœ¬æ˜¯<code>22H2 22621.963</code>ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\WindowsApps\Microsoft.Windows.Photos_2023.11080.4003.0_x64__8wekyb3d8bbwe</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢æœ‰ä¸€ä¸ª<code>PhotosApp.exe</code>ï¼Œå°±æ˜¯windowsè‡ªå¸¦ç…§ç‰‡çš„å¯æ‰§è¡Œæ–‡ä»¶äº†ï¼›</p><p>ä½†æ˜¯ï¼ä½ ä¼šå‘ç°ä½ å‹æ ¹æ²¡æœ‰ <code>C:\Program Files\WindowsApps\</code>è¿™ä¸ªæ–‡ä»¶å¤¹çš„è¿›å…¥æƒé™ï¼Œæ›´åˆ«ææ‰¾åˆ°è¿™ä¸ªç…§ç‰‡è½¯ä»¶çš„exeäº†ï¼</p><p>ç™¾åº¦äº†ä¸€ä¸‹ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªæ•™ç¨‹ <a href="https://www.bkqs.com.cn/content/kn928o443.html">Win10ä¸‹WindowsAppsæƒé™æ€ä¹ˆè·å–</a>ï¼›é¡ºå¸¦ä¸€æï¼Œä¸ºäº†é¿å…åŸæ–‡å¤±æ•ˆï¼Œè¿™ç¯‡æ–‡ç« ä¹Ÿè½¬è½½åˆ°äº†æœ¬ç«™ã€‚</p><blockquote><p>æ³¨æ„ï¼æ¯•ç«Ÿè¿™ç®—æ˜¯ç³»ç»Ÿåº•å±‚æ–‡ä»¶å¤¹äº†ï¼Œæˆ‘ä¸ç¡®å®šè¿™æ ·ä¿®æ”¹æ–‡ä»¶å¤¹æƒé™æ˜¯å¦ä¼šå‡ºç°é—®é¢˜ï¼å¦‚æœä½ æ‹…å¿ƒå‡ºç°é—®é¢˜ï¼Œ<strong>è¯·ä¸è¦æ“ä½œ</strong>ï¼Œåœ¨ä¸æ‰“æ¸¸æˆçš„æ—¶å€™ä¸è¦å¯åŠ¨MSI Afterbuneræ˜¯æ›´å¥½çš„é€‰æ‹©ï¼</p><p>å¦‚æœå‡ºç°é—®é¢˜ï¼Œå‚è€ƒ ã€<a href="https://blog.csdn.net/oh_futrue/article/details/91042020">WindowsApps æƒé™é—®é¢˜å¯¼è‡´Microsoft StoreåŠå…¶ä¸‹è½½çš„åº”ç”¨ä¸èƒ½å¯åŠ¨ï¼ˆé—ªé€€ï¼‰çš„è§£å†³åŠæ³•</a>ã€‘ å¤åŸæƒé™ï¼å®åœ¨ä¸è¡Œå°±ææ€•è¦é‡è£…ç³»ç»Ÿäº† ğŸ¤£</p><p><img src="https://img.musnow.top/i/2023/08/91c5e537eee80c51f1e2788b15a7d997.png" alt="image-20230831214242664"></p><p>ç›®å‰æˆ‘è¿™è¾¹è¿˜ä¹ˆæœ‰å‡ºç°å¼‚å¸¸æƒ…å†µï¼Œæ¯•ç«Ÿæˆ‘ä¿®æ”¹ä¸ºäº†<code>everyone</code>ç†è®ºä¸Šæ¥è¯´æ˜¯å¹¶ä¸ä¼šå‡ºç°æƒé™ä¸å¤Ÿè€Œå¯¼è‡´æŸä¸ªç¨‹åºæ— æ³•æ‰§è¡Œçš„é—®é¢˜çš„</p></blockquote><p>æ ¹æ®æ•™ç¨‹é‡Œé¢çš„æ­¥éª¤ä¸€æ­¥ä¸€æ­¥æ¥ï¼Œå°±å¯ä»¥è·å–åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹çš„è¿›å…¥æƒé™</p><p><img src="https://img.musnow.top/i/2023/08/f35c62ab02b889383a3f88a3b9700629.png" alt="image-20230831212801573"></p><h1 id="4-ç¦ç”¨ç…§ç‰‡ä¸­çš„å¸§æ•°æ˜¾ç¤º"><a href="#4-ç¦ç”¨ç…§ç‰‡ä¸­çš„å¸§æ•°æ˜¾ç¤º" class="headerlink" title="4.ç¦ç”¨ç…§ç‰‡ä¸­çš„å¸§æ•°æ˜¾ç¤º"></a>4.ç¦ç”¨ç…§ç‰‡ä¸­çš„å¸§æ•°æ˜¾ç¤º</h1><p>æ‰¾åˆ°è¿™ä¸ª<code>PhotosApp.exe</code>ä¹‹åï¼Œåœ¨<code>RivaTuner</code>è¿™ä¸ªè½¯ä»¶é‡Œé¢é€‰ä¸­è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå°†å…¶çš„displayå…³é—­</p><p><img src="https://img.musnow.top/i/2023/08/b98f245a377bbfe1369b7cb9809fc9a5.png" alt="image-20230831212557862"></p><p>å¥½äº†ï¼Œè¿™ä¸‹æ²¡æœ‰èƒ¡ä¹±æ˜¾ç¤ºå¸§æ•°äº†ï¼</p><p><img src="https://img.musnow.top/i/2023/08/d0f3baad38aec23619141b8cf92b6292.png" alt="image-20230831212631268"></p>]]></content>
    
    
    <summary type="html">Windowsä¸‹MSI Afterburnerå¦‚ä½•è®©å…¶ä¸åœ¨æŸä¸ªè½¯ä»¶ä¸­æ˜¾ç¤ºå¸§æ•°</summary>
    
    
    
    <category term="ç”µè„‘ä½¿ç”¨å°è´´å£«" scheme="https://blog.musnow.top/categories/%E7%94%B5%E8%84%91%E4%BD%BF%E7%94%A8%E5%B0%8F%E8%B4%B4%E5%A3%AB/"/>
    
    
    <category term="windows" scheme="https://blog.musnow.top/tags/windows/"/>
    
  </entry>
  
  <entry>
    <title>ã€winã€‘Windowsä¸‹Cç›˜é‡Œé¢çš„WindowsAppsæ–‡ä»¶å¤¹æƒé™æ€ä¹ˆè·å–</title>
    <link href="https://blog.musnow.top/posts/3712817486/"/>
    <id>https://blog.musnow.top/posts/3712817486/</id>
    <published>2023-08-31T13:34:31.000Z</published>
    <updated>2023-08-31T13:34:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>é¿å…åŸæ–‡å¤±æ•ˆï¼Œè½¬è½½æ­¤æ–‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åŸæ–‡ https://www.bkqs.com.cn/content/kn928o443.html</span><br></pre></td></tr></table></figure><h1 id="Winä¸‹WindowsAppsæƒé™æ€ä¹ˆè·å–"><a href="#Winä¸‹WindowsAppsæƒé™æ€ä¹ˆè·å–" class="headerlink" title="Winä¸‹WindowsAppsæƒé™æ€ä¹ˆè·å–"></a>Winä¸‹WindowsAppsæƒé™æ€ä¹ˆè·å–</h1><p><code>2023-01-31 14:32:17</code></p><p>Win10ä¸‹WindowsAppsæƒé™æ€ä¹ˆè·å–ï¼ŸWindowsAppså®‰è£…çš„æ˜¯Windowsåº”ç”¨å•†åº—çš„åº”ç”¨ç¨‹åºï¼Œè®¿é—®æ­¤æ–‡ä»¶å¤¹éœ€è¦è·å–æƒé™æ‰èƒ½è¿›å…¥ã€‚å…·ä½“æ€ä¹ˆè®¾ç½®å‘¢ï¼Ÿä¸€èµ·æ¥äº†è§£ä¸‹å§ï¼</p><p><img src="https://img.musnow.top/i/2023/08/df83e62f3e53e132acb209f09a797b6f.png"></p><h2 id="æ“ä½œæ–¹æ³•"><a href="#æ“ä½œæ–¹æ³•" class="headerlink" title="æ“ä½œæ–¹æ³•"></a>æ“ä½œæ–¹æ³•</h2><ul><li><p>01</p><p>1ã€åœ¨è®¡ç®—æœºä¸­ï¼Œæ‰“å¼€æ­¤ç”µè„‘ã€‚ç‚¹å‡»æŸ¥çœ‹é€‰é¡¹ï¼Œå¹¶å‹¾é€‰é€‰é¡¹æ¡†ä¸­çš„â€œéšè—çš„é¡¹ç›®â€ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/ac1473123b0f35d32f01b7539023fb51.png"></p></li><li><p>02</p><p>2ã€åœ¨æ­¤ç”µè„‘çª—å£ä¸­ï¼Œæ‰¾åˆ°ç³»ç»Ÿç›˜ä¸‹çš„â€œWindowsAppsâ€ï¼ˆéšè—çš„æ–‡ä»¶å¤¹ï¼‰ï¼Œå…·ä½“è·¯å¾„ä¸ºâ€œC:\Program Files\WindowsAppsâ€ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/9a1d5608930d12c04e4303e3b923a747.png"></p></li><li><p>03</p><p>3ã€é€‰ä¸­WindowsAppsæ–‡ä»¶å¤¹ï¼Œå¹¶ç‚¹å‡»é¼ æ ‡å³é”®ï¼Œåœ¨å¼¹å‡ºçš„é€‰é¡¹æ¡†ä¸­ç‚¹å‡»â€œå±æ€§â€é€‰é¡¹ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/32e95c80075f35fb9004e63797b1f1d7.png"></p></li><li><p>04</p><p>4ã€ç‚¹å‡»å±æ€§é€‰é¡¹åï¼Œè¿™ä¸ªæ—¶å€™ä¼šæ‰“å¼€â€œWindowsAppså±æ€§â€å¯¹è¯æ¡†ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/5ede94735ea0e66cb1115012e795b0df.png"></p></li><li><p>05</p><p>5ã€åœ¨WindowsAppså±æ€§å¯¹è¯æ¡†ä¸­ï¼Œåˆ‡æ¢åˆ°â€œå®‰å…¨â€é€‰é¡¹å¡ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/b92921c8b6547e8a81e68752e96c830f.png"></p></li><li><p>06</p><p>6ã€åœ¨å®‰å…¨é€‰é¡¹å¡ä¸‹ï¼Œçœ‹åˆ°æç¤ºâ€œå¿…é¡»å…·æœ‰è¯»å–æƒé™æ‰èƒ½æŸ¥çœ‹å¯¹è±¡å±æ€§â€ï¼Œå¹¶ç‚¹å‡»â€œé«˜çº§â€é€‰é¡¹æŒ‰é’®ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/a13b0247ca7b99c1793189336e492c85.png"></p></li><li><p>07</p><p>7ã€ç‚¹å‡»é«˜çº§é€‰é¡¹åï¼Œè¿™ä¸ªæ—¶å€™ä¼šæ‰“å¼€â€œWindowsAppsçš„é«˜çº§å®‰å…¨è®¾ç½®â€å¯¹è¯çª—å£ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/434d13327223687c0ae808b9e5bd0226.png"></p></li><li><p>08</p><p>8ã€åœ¨WindowsAppsçš„é«˜çº§å®‰å…¨è®¾ç½®å¯¹è¯çª—å£ä¸­ï¼Œç‚¹å‡»æ‰€æœ‰è€…åçš„â€œæ›´æ”¹â€æŒ‰é’®ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/c7060a1aacb894d0ea904202291e9267.png"></p></li><li><p>09</p><p>9ã€ç‚¹å‡»æ›´æ”¹åï¼Œè¿™ä¸ªæ—¶å€™ä¼šæ‰“å¼€â€œé€‰æ‹©ç”¨æˆ·æˆ–ç»„â€å¯¹è¯æ¡†ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/9b02a003b59c4ce73a72690fc414c038.png"></p></li><li><p>10</p><p>10ã€åœ¨è¾“å…¥è¦é€‰æ‹©çš„å¯¹è±¡åç§°è¾“å…¥æ¡†ä¸­ï¼Œè¾“å…¥â€œEveryoneâ€ï¼Œå¹¶ç‚¹å‡»â€œç¡®å®šâ€æŒ‰é’®ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/fa792f7c20c081c4079f02f6734e2e8d.png"></p></li><li><p>11</p><p>11ã€ç‚¹å‡»ç¡®å®šåï¼Œè¿™ä¸ªæ—¶å€™ä¼šè·³è½¬åˆ°WindowsAppsçš„é«˜çº§å®‰å…¨è®¾ç½®å¯¹è¯çª—å£ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/f132cedbea9f1c6677375c0661e68994.png"></p></li><li><p>12</p><p>12ã€æ¥ç€å‹¾é€‰æ‰€æœ‰è€…ä¸‹çš„â€œæ›¿æ¢å­å®¹å™¨å’Œå¯¹è±¡çš„æ‰€æœ‰è€…â€ï¼Œå¹¶ç‚¹å‡»â€œç¡®å®šâ€æŒ‰é’®ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/bf8f5bb96b5daa6290850574d2258bb7.png"></p></li><li><p>13</p><p>13ã€ç‚¹å‡»ç¡®å®šåï¼Œè¿™ä¸ªæ—¶å€™ä¼šå¼¹å‡ºWindowså®‰å…¨å¯¹è¯æ¡†ï¼Œè¿›è¡Œæ›´æ”¹æ‰€æœ‰æƒã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/74051d49c0138f62d250c588acb0eaa4.png"></p></li><li><p>14</p><p>14ã€æ›´æ”¹æ‰€æœ‰æƒå®Œæˆåï¼Œè¿™ä¸ªæ—¶å€™å°±èƒ½æ­£å¸¸è®¿é—®â€œWindowsAppsâ€æ–‡ä»¶å¤¹äº†ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/c523ded7262708fbef624c1c742997f8.png"></p></li></ul>]]></content>
    
    
    <summary type="html">Winä¸‹Cç›˜é‡Œé¢çš„WindowsAppsæƒé™æ€ä¹ˆè·å–</summary>
    
    
    
    <category term="ç”µè„‘ä½¿ç”¨å°è´´å£«" scheme="https://blog.musnow.top/categories/%E7%94%B5%E8%84%91%E4%BD%BF%E7%94%A8%E5%B0%8F%E8%B4%B4%E5%A3%AB/"/>
    
    
    <category term="windows" scheme="https://blog.musnow.top/tags/windows/"/>
    
  </entry>
  
  <entry>
    <title>ã€Linuxã€‘centos8å®‰è£…bison3.8</title>
    <link href="https://blog.musnow.top/posts/1067381808/"/>
    <id>https://blog.musnow.top/posts/1067381808/</id>
    <published>2023-08-30T10:31:55.000Z</published>
    <updated>2023-08-30T10:31:55.000Z</updated>
    
    <content type="html"><![CDATA[<p>centos8å®‰è£…<code>bison3.8</code>çš„æ•™ç¨‹ï¼Œæ„Ÿè§‰è¿™ä¸ªè½¯ä»¶åŒ…å¾ˆ<code>å°ä¼—</code>å•Šï¼Œç™¾åº¦æ‰¾ä¸åˆ°å®‰è£…æ•™ç¨‹ï¼Œæœ€ç»ˆè¿˜æ˜¯åœ¨èµ·è„šæ—®æ—¯é‡Œé¢ç¿»å‡ºæ¥äº†å¾ˆä¹…ä¹‹å‰çš„æ–‡æ¡£ï¼Œå¥½åœ¨æ²¡æœ‰è¿‡æ—¶ï¼›</p><span id="more"></span><blockquote><p><a href="https://linux.cn/lfs/LFS-BOOK-7.7-systemd/chapter06/bison.html">https://linux.cn/lfs/LFS-BOOK-7.7-systemd/chapter06/bison.html</a></p></blockquote><p><img src="https://img.musnow.top/i/2023/09/db6be01dbd28cd3371fdf8e5d657b968.png" alt="image-20230901215525821"></p><p>è™½ç„¶centos8ä¸­ä½ å¯ä»¥ä½¿ç”¨yumç›´æ¥å®‰è£…ï¼Œä½†æ˜¯å“ªä¸ªå®‰è£…çš„ç‰ˆæœ¬å¤ªä½äº†ï¼Œè¾¾ä¸åˆ°å¦‚ä»Šçš„éœ€æ±‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y bison</span><br></pre></td></tr></table></figure><p>æˆ‘è¿™è¾¹ç›´æ¥ç”¨yumå®‰è£…çš„æ˜¯<code>3.0.4</code>çš„ç‰ˆæœ¬ï¼Œå·²ç»æ˜¯2015å¹´çš„ä¸œè¥¿äº†ï¼Œæœ€æ–°çš„ç‰ˆæœ¬å·²ç»åˆ°3.8äº†ï¼Œè€Œä¸”æˆ‘æ­£åœ¨ä½¿ç”¨çš„æ–°é¡¹ç›®miniobå°±è¦æ±‚æ›´é«˜çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥è€ç‰ˆæœ¬è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bison (GNU Bison) 3.0.4</span><br><span class="line">Written by Robert Corbett and Richard Stallman.</span><br><span class="line"></span><br><span class="line">Copyright (C) 2015 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the source for copying conditions.  There is NO</span><br><span class="line">warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br></pre></td></tr></table></figure><p>å…ˆç”¨yumæŠŠå®‰è£…å¥½äº†çš„åˆ æ‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum remove bison</span><br></pre></td></tr></table></figure><blockquote><p>æˆ‘çœ‹æœ‰çš„æ–‡ç« è¯´éœ€è¦å…ˆå®‰è£…å‰ç½®ä¾èµ–é¡¹<code>flex</code>ï¼Œè¿™é‡Œå¸¦ä¸Šå§ã€‚å› ä¸ºæˆ‘çš„ç³»ç»Ÿé‡Œé¢ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™å°±å·²ç»å®‰è£…å¥½äº†è¿™ä¸ªä¸œè¥¿äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install flex</span><br></pre></td></tr></table></figure></blockquote><p>å»å®˜ç½‘ <a href="http://ftp.gnu.org/gnu/bison/">http://ftp.gnu.org/gnu/bison/</a> ä¸‹è½½æœ€æ–°çš„å‹ç¼©åŒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.gnu.org/gnu/bison/bison-3.8.tar.gz</span><br></pre></td></tr></table></figure><p>è§£å‹å¹¶è¿›å…¥æ–‡ä»¶å¤¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf bison-3.8.tar.gz</span><br><span class="line">cd bison-3.8</span><br></pre></td></tr></table></figure><p>é…ç½®å®‰è£…è·¯å¾„ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨äº†<code>/usr/local</code>è¿™ä¸ªç›®å½•ï¼Œå¦‚æœä½ æŸ¥çœ‹è¿‡å®‰è£…åçš„bisonï¼Œä½ ä¼šå‘ç°å®ƒçš„å®‰è£…åŒ…çš„é€»è¾‘æ˜¯å’Œ<code>/usr/local</code>ç›®å½•ä¸€è‡´çš„ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¿®æ”¹æˆä½ è‡ªå·±æƒ³è¦çš„ç›®å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ls /usr/local/</span><br><span class="line">bin  doc  etc  games  include  lib  lib64  libexec  openssl-1.1.1  sbin  share  src</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é…ç½®å®‰è£…è·¯å¾„ä¸º<code>/usr/local</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure -prefix=/usr/local/</span><br></pre></td></tr></table></figure><p>ç›®å½•é…ç½®å¥½äº†ä¹‹åï¼Œmakeå®‰è£…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make install</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœè¦å¸è½½ï¼Œç”¨<code>make uninstall</code></p></blockquote><p>å®‰è£…å¥½äº†ä¹‹åæ‰§è¡Œ<code>bison --version</code>ï¼Œä½ ä¼šå¾—åˆ°å¦‚ä¸‹è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-bash: /usr/bin/bison: No such file or directory</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨<code>/usr/local</code>é‡Œé¢å®‰è£…çš„ä¸œè¥¿æ²¡æœ‰åœ¨pathä¸­ï¼Œæ²¡æœ‰åŠæ³•ç›´æ¥æ‰§è¡Œï¼Œéœ€è¦æˆ‘ä»¬å°†å…¶è½¯é“¾æ¥åˆ°<code>/usr/bin</code>é‡Œé¢ï¼›</p><p>å¦‚æœä½ çš„å®‰è£…æ­£ç¡®äº†ï¼Œåº”è¯¥å¯ä»¥åœ¨<code>/usr/local/bin</code>é‡Œé¢æ‰¾åˆ°<code>bison</code>; å¦‚æœä½ å®‰è£…çš„è·¯å¾„ä¸åŒï¼Œé‚£å°±å»ä½ å®‰è£…è·¯å¾„ä¸‹æ‰¾<code>bison</code>çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼›</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls /usr/local/bin</span></span><br><span class="line">2to3-3.10  bison  cmake  cpack  ctest  docker-compose  idle3.10  pip3.10  pydoc3.10  python3.10  python3.10-config  yacc</span><br></pre></td></tr></table></figure><p>å°†å…¶è½¯è¿æ¥ä¸€ä¸‹å°±okäº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ln -s /usr/local/bin/bison /usr/bin/bison</span></span><br><span class="line"><span class="comment"># ls /usr/bin/bison</span></span><br><span class="line">/usr/bin/bison</span><br></pre></td></tr></table></figure><p>å†æ¬¡æ£€æŸ¥ç‰ˆæœ¬ï¼Œå®‰è£…<code>3.8</code>æˆåŠŸï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># bison --version</span><br><span class="line">bison (GNU Bison) 3.8</span><br><span class="line">Written by Robert Corbett and Richard Stallman.</span><br><span class="line"></span><br><span class="line">Copyright (C) 2021 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the source for copying conditions.  There is NO</span><br><span class="line">warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;centos8å®‰è£…&lt;code&gt;bison3.8&lt;/code&gt;çš„æ•™ç¨‹ï¼Œæ„Ÿè§‰è¿™ä¸ªè½¯ä»¶åŒ…å¾ˆ&lt;code&gt;å°ä¼—&lt;/code&gt;å•Šï¼Œç™¾åº¦æ‰¾ä¸åˆ°å®‰è£…æ•™ç¨‹ï¼Œæœ€ç»ˆè¿˜æ˜¯åœ¨èµ·è„šæ—®æ—¯é‡Œé¢ç¿»å‡ºæ¥äº†å¾ˆä¹…ä¹‹å‰çš„æ–‡æ¡£ï¼Œå¥½åœ¨æ²¡æœ‰è¿‡æ—¶ï¼›&lt;/p&gt;</summary>
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ã€Linuxã€‘centos8å®‰è£…cmake3.27.4</title>
    <link href="https://blog.musnow.top/posts/343476194/"/>
    <id>https://blog.musnow.top/posts/343476194/</id>
    <published>2023-08-30T10:30:55.000Z</published>
    <updated>2023-08-30T10:30:55.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç¬¬ä¸€æ­¥ï¼Œå»<a href="https://cmake.org/download/">å®˜ç½‘</a>ä¸‹å®‰è£…åŒ…ï¼Œä¸€å®šä¸è¦ä¸‹é”™äº†</p><p><img src="https://img.musnow.top/i/2023/08/a7b64c50664a8d69fb805fcbb17edcbe.png" alt="image-20230830175242958"></p><p>ä¸‹å¥½äº†ä¹‹åï¼Œç”¨ftpè½¯ä»¶ä¼ åˆ°äº‘æœåŠ¡å™¨æˆ–è€…è™šæ‹Ÿæœºä¸Šï¼Œæˆ‘ç”¨çš„æ˜¯centos8ç³»ç»Ÿï¼Œå®‰è£…ä¹‹å‰å…ˆå‡†å¤‡å¥½è¿™äº›ä¾èµ–é¡¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y gcc gcc-c++ make automake</span><br><span class="line">yum install -y openssl  openssl-devel</span><br></pre></td></tr></table></figure><p>æŠŠä¸‹è½½å¥½çš„å®‰è£…åŒ…ä¼ ä¸Šå»åï¼Œè§£å‹ï¼ˆåœ¨rootç”¨æˆ·ä¸‹æ“ä½œï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf cmake-3.27.4.tar.gz </span><br></pre></td></tr></table></figure><p>è§£å‹å®Œæ¯•åè¿›å…¥æ–‡ä»¶å¤¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd cmake-3.27.4</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bootstrap</span><br></pre></td></tr></table></figure><p>è€å¿ƒç­‰å€™å®Œæˆåï¼Œä¾æ¬¡è¿è¡Œä¸‹é¢ä¸¤ä¸ªå‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gmake</span><br><span class="line">gmake install</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆåˆ¤æ–­æ˜¯å¦å®‰è£…æˆåŠŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake --version</span><br></pre></td></tr></table></figure><p>å‡ºç°å¦‚ä¸‹ä¿¡æ¯å°±æ˜¯æå®šäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># cmake --version</span><br><span class="line">cmake version 3.27.4</span><br><span class="line"></span><br><span class="line">CMake suite maintained and supported by Kitware (kitware.com/cmake).</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ç¬¬ä¸€æ­¥ï¼Œå»&lt;a href=&quot;https://cmake.org/download/&quot;&gt;å®˜ç½‘&lt;/a&gt;ä¸‹å®‰è£…åŒ…ï¼Œä¸€å®šä¸è¦ä¸‹é”™äº†&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img.musnow.top/i/2023/08/a7b64c50664a8d69fb805fcbb</summary>
      
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ã€C++ã€‘C++14çš„é‚£äº›æ–°ç‰¹æ€§</title>
    <link href="https://blog.musnow.top/posts/1184922698/"/>
    <id>https://blog.musnow.top/posts/1184922698/</id>
    <published>2023-08-28T14:40:46.000Z</published>
    <updated>2023-08-28T14:40:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ C++14çš„é‚£äº›æ–°ç‰¹æ€§</p><span id="more"></span><p><img src="https://img.musnow.top/i/2023/08/0061de987afa3c3003cbfa4762397ac5.png" alt="v2-642fda8762a7dcda4556e14c8ff5c1ef_1440w"></p><p>ä¸ºäº†æ–¹ä¾¿æŒ‡å®šä½¿ç”¨C++14æ¥ç¼–è¯‘ä»£ç ï¼Œæœ¬æ–‡çš„æµ‹è¯•éƒ½æ˜¯åœ¨linuxä¸‹è¿›è¡Œçš„ï¼Œg++ç‰ˆæœ¬å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ g++ --version</span><br><span class="line">g++ (GCC) 8.5.0 20210514 (Red Hat 8.5.0-4)</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ å’Œæˆ‘ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä½¿ç”¨VSCæ¥é“¾æ¥linuxè¿›è¡Œä»£ç ç¼–å†™ï¼Œé‚£ä¸€å®šè¦è®°å¾—ä¿®æ”¹C++æ’ä»¶é‡Œé¢çš„CPPç‰ˆæœ¬ï¼Œå¦åˆ™é»˜è®¤ä»¥C++11æ¥è¿›è¡Œè¯­æ³•é«˜äº®çš„è¯ï¼Œä¼šæŠŠC++11ä¸æ”¯æŒçš„è¯­æ³•æ ‡çº¢ï¼Œå½±å“æˆ‘ä»¬å­¦ä¹ </p><p><img src="https://img.musnow.top/i/2023/08/8363f819fd562b1bd452551e970ff4a3.png" alt="image-20230828230838973"></p><blockquote><p>æœ¬æ–‡å‚è€ƒ <a href="https://zhuanlan.zhihu.com/p/588826142">https://zhuanlan.zhihu.com/p/588826142</a> è¿›è¡Œå­¦ä¹ ;</p><p>å®˜æ–¹æ–‡æ¡£ <a href="https://zh.cppreference.com/w/cpp/14">https://zh.cppreference.com/w/cpp/14</a></p></blockquote><h1 id="1-lambdaæ–°ç‰¹æ€§"><a href="#1-lambdaæ–°ç‰¹æ€§" class="headerlink" title="1.lambdaæ–°ç‰¹æ€§"></a>1.lambdaæ–°ç‰¹æ€§</h1><p>C++14ç»™lambdaè¡¨è¾¾å¼æ·»åŠ äº†ä¸¤ä¸ªæ–°åŠŸèƒ½</p><ul><li>å‚æ•°æ¨æ–­ï¼ˆautoï¼‰</li><li>å‚æ•°åˆå§‹åŒ–åæ•è·ï¼ˆå¯ä»¥åœ¨<code>[]</code>å¯¹æŸä¸ªæ–°å‚æ•°è¿›è¡Œèµ‹å€¼ï¼‰</li></ul><p>å…ˆæ¥å¤ä¹ ä¸€ä¸‹C++11ä¸­å­¦ä¹ çš„lambdaæ•è·çš„åŸºæœ¬æ–¹å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[val]ï¼šè¡¨ç¤ºå€¼ä¼ é€’æ–¹å¼æ•æ‰å˜é‡val</span><br><span class="line">[=]ï¼šè¡¨ç¤ºå€¼ä¼ é€’æ–¹å¼æ•è·æ‰€æœ‰çˆ¶ä½œç”¨åŸŸä¸­çš„å˜é‡(åŒ…æ‹¬this)</span><br><span class="line">[&amp;val]ï¼šè¡¨ç¤ºå¼•ç”¨ä¼ é€’æ•æ‰å˜é‡val</span><br><span class="line">[&amp;]ï¼šè¡¨ç¤ºå¼•ç”¨ä¼ é€’æ•æ‰æ‰€æœ‰çˆ¶ä½œç”¨åŸŸä¸­çš„å˜é‡(åŒ…æ‹¬this)</span><br><span class="line">[this]ï¼šè¡¨ç¤ºå€¼ä¼ é€’æ–¹å¼æ•æ‰å½“å‰çš„thisæŒ‡é’ˆ</span><br></pre></td></tr></table></figure><p>åœ¨C++14ä¸­ï¼Œæ–°å¢çš„æ˜¯ä¸‹é¢çš„è¿™ç§æƒ…å†µ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">30</span>;</span><br><span class="line"><span class="comment">// [] ä¸­èµ‹å€¼äº†ä¸€ä¸ªå‚æ•°</span></span><br><span class="line"><span class="comment">// () ä¸­å¯ä»¥ä½¿ç”¨autoå…³é”®å­—æ¥æ¨æ–­å‚æ•°ç±»å‹</span></span><br><span class="line"><span class="keyword">auto</span> func = [x = <span class="number">3</span>](<span class="keyword">auto</span> y) &#123;<span class="keyword">return</span> x + y; &#125;;</span><br><span class="line">cout &lt;&lt; <span class="built_in">func</span>(a) &lt;&lt; endl;</span><br></pre></td></tr></table></figure><p>è¿è¡Œæµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ°æˆåŠŸè¾“å‡ºäº†ç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ make</span><br><span class="line">g++ test.cpp -o test -std=c++14</span><br><span class="line">$ ./test</span><br><span class="line">33</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸€ä¸‹ç±»å‹ï¼Œä¹Ÿèƒ½æ­£å¸¸è°ƒç”¨</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> a = <span class="number">30.2</span>;</span><br><span class="line"><span class="keyword">auto</span> func = [x = <span class="number">3</span>](<span class="keyword">auto</span> y)</span><br><span class="line">&#123; <span class="keyword">return</span> x + y; &#125;;</span><br><span class="line">cout &lt;&lt; <span class="built_in">func</span>(a) &lt;&lt; endl;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">33.2</span><br></pre></td></tr></table></figure><p>å¦‚æœæƒ³å°†èµ‹å€¼å‚æ•°å’ŒåŸæœ¬çš„æ•è·æ–¹å¼ä¸€èµ·ä½¿ç”¨ï¼Œåˆ™éœ€è¦å°†<strong>èµ‹å€¼å‚æ•°</strong>æ”¾åœ¨<code>[]</code>çš„æœ€<strong>åé¢</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_lambda2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">10</span>, b = <span class="number">20</span>;</span><br><span class="line">    <span class="type">int</span> c = <span class="number">1</span>, d = <span class="number">3</span>, e = <span class="number">5</span>;</span><br><span class="line">    <span class="comment">// èµ‹å€¼çš„å‚æ•°è¦æ”¾åœ¨[]çš„æœ€åé¢ï¼Œæ•è·æ–¹å¼æ”¾åœ¨å‰é¢</span></span><br><span class="line">    <span class="keyword">auto</span> func6 = [=, f = <span class="number">30</span>, g = <span class="number">40</span>]</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">return</span> (a + b + c + d + e + f + g);</span><br><span class="line">    &#125;;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">func6</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">109</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–æ•è·çš„å¥½å¤„æ˜¯å¯ä»¥æ”¯æŒ<strong>ç§»åŠ¨æ•è·</strong>äº†ï¼›ä¸ç„¶åœ¨C++11ä¸­ï¼Œlambdaå°±åªèƒ½ä½¿ç”¨èµ‹å€¼æ•è·å’Œå¼•ç”¨æ•è·</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::unique_ptr&lt;Item&gt; <span class="title">item</span><span class="params">(<span class="keyword">new</span> Item())</span></span>;</span><br><span class="line"><span class="comment">// std::moveæ”¹ä¸ºå³å€¼è¿›è¡Œèµ‹å€¼åæ•è·</span></span><br><span class="line"><span class="keyword">auto</span> func = [m = std::<span class="built_in">move</span>(item)] &#123; <span class="comment">/* do something */</span> &#125;;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–°ç‰¹æ€§çš„æå‡ºï¼Œä¹Ÿè®©lambdaæˆåŠŸæœ‰äº†å’Œbindæ¯”æ‹¼çš„èƒ½åŠ›ã€‚åœ¨C++11ä¸­ï¼Œbindçš„ä¼˜åŠ¿å°±æ˜¯åœ¨äº<strong>ç§»åŠ¨æ•è·</strong>çš„æ”¯æŒï¼›å¦‚ä»Šlambdaä¹Ÿæœ‰äº†è¿™ä»½èƒ½åŠ›äº†ï¼Œæˆ‘ä»¬å¯ä»¥æ›´çµæ´»åœ°æ ¹æ®åœºæ™¯é€‰ç”¨lambdaæˆ–è€…bindï¼Œè€Œä¸æ˜¯åªèƒ½ä½¿ç”¨bindäº†ã€‚</p><h1 id="2-å˜é‡æ¨¡æ¿"><a href="#2-å˜é‡æ¨¡æ¿" class="headerlink" title="2.å˜é‡æ¨¡æ¿"></a>2.å˜é‡æ¨¡æ¿</h1><h2 id="2-1-ç¤ºä¾‹"><a href="#2-1-ç¤ºä¾‹" class="headerlink" title="2.1 ç¤ºä¾‹"></a>2.1 ç¤ºä¾‹</h2><p>çœ‹æ¸…æ¥šè¿™ä¸ªåå­—å•Šï¼æ˜¯<strong>å˜é‡æ¨¡æ¿</strong>ï¼Œå¯ä¸æ˜¯ä»€ä¹ˆå‡½æ•°æ¨¡æ¿å“ˆï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">T pi = <span class="built_in">T</span>(<span class="number">3.1415926535897932385L</span>); <span class="comment">// variable template</span></span><br><span class="line"><span class="comment">// æ•°å­—æœ€åçš„Lä»£è¡¨è¿™æ˜¯ä¸€ä¸ªé•¿æµ®ç‚¹å‹</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_value_template</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; pi&lt;<span class="type">double</span>&gt; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; pi&lt;<span class="type">float</span>&gt; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; pi&lt;<span class="type">int</span>&gt; &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šå°±æ˜¯ä¸€ä¸ªæœ€æœ€æœ€ç®€å•çš„å˜é‡æ¨¡æ¿ï¼Œæˆ‘ä»¬åœ¨ä¼ å…¥å¯¹åº”çš„ç±»å‹åï¼Œä»–å°±ä¼šè½¬æˆæˆ‘ä»¬éœ€è¦çš„ç±»å‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ make</span><br><span class="line">g++ test.cpp -o test -std=c++14</span><br><span class="line">$ ./test</span><br><span class="line">3.14159</span><br><span class="line">3.14159</span><br><span class="line">3</span><br></pre></td></tr></table></figure><h2 id="2-2-ç±»ä¸­ä½¿ç”¨"><a href="#2-2-ç±»ä¸­ä½¿ç”¨" class="headerlink" title="2.2 ç±»ä¸­ä½¿ç”¨"></a>2.2 ç±»ä¸­ä½¿ç”¨</h2><p>å½“ä½ éœ€è¦åœ¨ç±»ä¸­ä½¿ç”¨æ¨¡æ¿å˜é‡çš„æ—¶å€™ï¼Œè¿™ä¸ªå˜é‡å¿…é¡»å®šä¹‰ä¸º<code>static</code>ï¼›</p><p>å› ä¸ºå®ƒæ˜¯æ¨¡æ¿ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ¥ç”¨æ¨¡æ¿æœ¬èº«å°±æœ‰çš„ç‰¹æ€§ï¼Œå°†è¿™ä¸ªæ¨¡æ¿é’ˆå¯¹æŸä¸€ä¸ªç±»å‹è¿›è¡Œ<strong>ç‰¹åŒ–</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Limits</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> T min; <span class="comment">// å£°æ˜é™æ€æˆå‘˜æ¨¡æ¿</span></span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="type">const</span> T Limits::min = &#123; &#125;; <span class="comment">// å®šä¹‰é™æ€æˆå‘˜æ¨¡æ¿ï¼Œå…¨éƒ¨ä½¿ç”¨é»˜è®¤å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸‹é¢ä¸‰ä¸ªæ˜¯æ¨¡æ¿å˜é‡çš„ç‰¹åŒ–</span></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="type">const</span> <span class="type">float</span> Limits::min&lt;<span class="type">float</span>&gt; = <span class="number">4.5</span>;</span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> Limits::min&lt;<span class="type">double</span>&gt; = <span class="number">5.5</span>;</span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="type">const</span> std::string Limits::min&lt;std::string&gt; = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; Limits::min&lt;<span class="type">int</span>&gt; &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; Limits::min&lt;<span class="type">float</span>&gt; &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; Limits::min&lt;<span class="type">double</span>&gt; &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; Limits::min&lt;std::string&gt; &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">0</span><br><span class="line">4.5</span><br><span class="line">5.5</span><br><span class="line">hello</span><br></pre></td></tr></table></figure><h2 id="2-3-å’Œç±»å‹è½¬æ¢çš„åŒºåˆ«"><a href="#2-3-å’Œç±»å‹è½¬æ¢çš„åŒºåˆ«" class="headerlink" title="2.3 å’Œç±»å‹è½¬æ¢çš„åŒºåˆ«"></a>2.3 å’Œç±»å‹è½¬æ¢çš„åŒºåˆ«</h2><p>è¿™é‡Œæˆ‘åˆç›´æ¥å®šä¹‰äº†ä¸€ä¸ªå˜é‡ï¼Œä½¿ç”¨<code>static_cast</code>ç›´æ¥è½¬æ¢å˜é‡ï¼Œçœ‹çœ‹ç»“æœä¼šä¸ä¼šæœ‰ä»€ä¹ˆåŒºåˆ«</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ•°å­—æœ€åçš„Lä»£è¡¨è¿™æ˜¯ä¸€ä¸ªé•¿æµ®ç‚¹å‹</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">T pi = <span class="built_in">T</span>(<span class="number">3.1415926535897932385L</span>); <span class="comment">// å˜é‡æ¨¡æ¿</span></span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="type">double</span> lpi = <span class="number">3.1415926535897932385L</span>; <span class="comment">// ç›´æ¥å®šä¹‰é•¿æµ®ç‚¹å‹</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_value_template</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; pi&lt;<span class="type">double</span>&gt; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; pi&lt;<span class="type">float</span>&gt; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; pi&lt;<span class="type">int</span>&gt; &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot; ----- \n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(lpi) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(lpi) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(lpi) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸Šå»äºŒè€…çš„ç»“æœå®Œå…¨ç›¸åŒï¼Œé‚£ä¹ˆæ—¢ç„¶å¯ä»¥ç›´æ¥ä½¿ç”¨å˜é‡ç±»å‹è½¬æ¢ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æ–°å¢ä¸€ä¸ªæ¨¡æ¿å˜é‡å‘¢ï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">3.14159</span><br><span class="line">3.14159</span><br><span class="line">3</span><br><span class="line"> ----- </span><br><span class="line">3.14159</span><br><span class="line">3.14159</span><br><span class="line">3</span><br></pre></td></tr></table></figure><blockquote><p>ä»¥ä¸‹å†…å®¹æ¥è‡ªGPTï¼Œæˆ‘è§‰å¾—å®ƒè¯´çš„å¾ˆå¯¹</p></blockquote><p>å®šä¹‰ä¸€ä¸ªå˜é‡å¹¶ä½¿ç”¨æ•°æ®è½¬æ¢ï¼ˆç±»å‹è½¬æ¢ï¼‰æ˜¯ä¸€ç§å¸¸è§çš„ç¼–ç¨‹æ–¹å¼ï¼Œä½†ä¸å˜é‡æ¨¡æ¿æœ‰ä¸€äº›åŒºåˆ«ï¼š</p><ol><li><strong>é€šç”¨æ€§ï¼š</strong> å˜é‡æ¨¡æ¿å…è®¸ä½ é€šè¿‡æ¨¡æ¿å‚æ•°æ¥ç”Ÿæˆå¤šä¸ªä¸åŒç±»å‹çš„å˜é‡ï¼Œä»è€Œåœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ã€‚è¿™ä½¿å¾—ä»£ç æ›´å…·é€šç”¨æ€§å’Œå¯æ‰©å±•æ€§ï¼Œå› ä¸ºä½ å¯ä»¥ä¸ºå¤šä¸ªç±»å‹ç”Ÿæˆç›¸åº”çš„å˜é‡ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œç›´æ¥å®šä¹‰å˜é‡å¹¶ä½¿ç”¨æ•°æ®è½¬æ¢é€šå¸¸åªé€‚ç”¨äºç‰¹å®šçš„ä¸€ç§æ•°æ®ç±»å‹ã€‚</li><li><strong>æ¨¡æ¿åŒ–ï¼š</strong> å˜é‡æ¨¡æ¿æ˜¯ä¸€ç§æ¨¡æ¿åŒ–çš„æ–¹å¼æ¥ç”Ÿæˆå˜é‡ï¼Œå®ƒéµå¾ª C++ çš„æ¨¡æ¿æœºåˆ¶ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨æ¨¡æ¿<strong>ç‰¹åŒ–</strong>ã€éƒ¨åˆ†ç‰¹åŒ–ç­‰æŠ€æœ¯æ¥å®šåˆ¶åŒ–ç”Ÿæˆçš„å˜é‡ï¼Œä»¥æ»¡è¶³ä¸åŒçš„éœ€æ±‚ã€‚è€Œä½¿ç”¨æ•°æ®è½¬æ¢æ—¶ï¼Œä½ å¿…é¡»æ˜¾å¼åœ°æ‰§è¡Œç±»å‹è½¬æ¢ï¼Œè¿™å¯èƒ½ä¼šåœ¨ä»£ç ä¸­å¼•å…¥ä¸å¿…è¦çš„é‡å¤ã€‚</li><li><strong>ç¼–è¯‘æ—¶è®¡ç®—ï¼š</strong> å˜é‡æ¨¡æ¿é€šå¸¸ç”¨äºåœ¨ç¼–è¯‘æ—¶ç”Ÿæˆå€¼ï¼Œå› æ­¤å¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µè¿›è¡Œç±»å‹æ£€æŸ¥å’Œè®¡ç®—ã€‚è¿™æœ‰åŠ©äºæé«˜ä»£ç çš„æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚è€Œæ•°æ®è½¬æ¢å¯èƒ½åœ¨è¿è¡Œæ—¶è¿›è¡Œï¼Œå¯èƒ½ä¼šå¼•å…¥ä¸€äº›è¿è¡Œæ—¶å¼€é”€å’Œç±»å‹é”™è¯¯çš„é£é™©ã€‚</li><li><strong>æŠ½è±¡æ€§ï¼š</strong> å˜é‡æ¨¡æ¿å¯ä»¥åœ¨æ›´é«˜çš„æŠ½è±¡å±‚æ¬¡ä¸Šæ“ä½œæ•°æ®ï¼Œä½¿ä»£ç æ›´å…·è¡¨è¾¾åŠ›å’Œå¯è¯»æ€§ã€‚å®ƒå…è®¸ä½ ä»¥æ›´è‡ªç„¶çš„æ–¹å¼æè¿°æŸä¸ªå€¼ä¸ç‰¹å®šç±»å‹ä¹‹é—´çš„å…³ç³»ï¼Œè€Œä¸å¿…æ˜¾å¼è¿›è¡Œç±»å‹è½¬æ¢ã€‚</li></ol><p>æ€»ä¹‹ï¼Œå˜é‡æ¨¡æ¿æä¾›äº†ä¸€ç§æ›´çµæ´»ã€é€šç”¨å’Œæ¨¡æ¿åŒ–çš„æ–¹å¼æ¥ç”Ÿæˆå˜é‡ï¼Œé€‚ç”¨äºéœ€è¦åœ¨ä¸åŒç±»å‹ä¸Šå·¥ä½œçš„æƒ…å†µã€‚å½“ä½ éœ€è¦ä¸ºå¤šä¸ªç±»å‹ç”Ÿæˆç‰¹å®šçš„å˜é‡æˆ–å€¼æ—¶ï¼Œå˜é‡æ¨¡æ¿æ˜¯ä¸€ç§æ›´ä¼˜é›…å’Œå¼ºå¤§çš„é€‰æ‹©ã€‚</p><h1 id="3-constexpré™åˆ¶æ”¾å®½"><a href="#3-constexpré™åˆ¶æ”¾å®½" class="headerlink" title="3.constexpré™åˆ¶æ”¾å®½"></a>3.constexpré™åˆ¶æ”¾å®½</h1><p>åœ¨C++11ä¸­è¢«å¼•å…¥çš„constexprï¼Œå¯ä»¥è®©ç¼–è¯‘å™¨åœ¨ç¼–è¯‘ç¨‹åºçš„æœŸé—´ï¼Œå°±å°†ä¸€éƒ¨åˆ†å·¥ä½œå®Œæˆï¼Œä¸å¿…ç­‰åˆ°è¿è¡ŒæœŸé—´å†åšï¼›åœ¨C++11ä¸­ï¼Œconstexprçš„é™åˆ¶å¾ˆä¸¥æ ¼ï¼Œè¿™å¯¼è‡´å®ƒå¹¶ä¸å¥½ç”¨ï¼š</p><ul><li>constexprä¿®é¥°å˜é‡ï¼Œè¦æ±‚å˜é‡å¿…é¡»å¯ä»¥åœ¨ç¼–è¯‘å™¨æ¨å¯¼å‡ºæ¥</li><li>constexprä¿®é¥°å‡½æ•°ï¼ˆè¿”å›å€¼ï¼‰ï¼Œå‡½æ•°å†…é™¤äº†å¯ä»¥åŒ…å«usingå’ŒtypedefæŒ‡ä»¤ä»¥åŠ<code>static_asssert</code>æ–­è¨€å¤–ï¼Œåªèƒ½åŒ…å«ä¸€æ¡<code>return</code>è¯­å¥</li><li>constexpråŒæ—¶å¯ä»¥ä¿®é¥°æ„é€ å‡½æ•°ï¼Œä½†ä¹Ÿä¼šè¦æ±‚ä½¿ç”¨è¿™ä¸ªæ„é€ å‡½æ•°çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨ç¼–è¯‘å™¨å°±æŠŠç›¸å…³çš„å†…å®¹å…¨æ¨å¯¼å‡ºæ¥</li></ul><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ¯”è¾ƒåŸºç¡€çš„C++11ä¸­çš„ç”¨ä¾‹ï¼Œç»™è¯¥å‡½æ•°è®¾ç½®äº†<code>constexpr</code>å…³é”®å­—åï¼Œè¯¥å‡½æ•°å°±å¯ä»¥åœ¨ç¼–è¯‘æœŸé—´è¢«è®¡ç®—å‡ºç»“æœï¼Œå†ç”¨<code>static_assert</code>åœ¨ç¼–è¯‘æœŸé—´æ–­è¨€ç»“æœæ˜¯å¦æ­£ç¡®ï¼›</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">constexpr</span> <span class="type">int</span> <span class="title">factorial</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (n &lt;= <span class="number">1</span>) ? <span class="number">1</span> : n * <span class="built_in">factorial</span>(n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">test_constexpr1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constexpr</span> <span class="type">int</span> result = <span class="built_in">factorial</span>(<span class="number">5</span>); <span class="comment">// ç¼–è¯‘æ—¶è®¡ç®—é˜¶ä¹˜</span></span><br><span class="line">    <span class="built_in">static_assert</span>(result == <span class="number">120</span>, <span class="string">&quot;Factorial of 5 should be 120&quot;</span>); <span class="comment">// ç¼–è¯‘æ—¶æ–­è¨€</span></span><br><span class="line">    cout &lt;&lt; result &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœåœ¨C++11ä¸­çš„constexprå‡½æ•°å†…åŒ…å«å…¶ä»–è¯­å¥ï¼Œç¼–è¯‘çš„æ—¶å€™ä¼šæŠ¥é”™ï¼Œç¿»è¯‘è¿‡æ¥æ˜¯è¯¥å‡½æ•°å†…éƒ¨ä¸æ˜¯ä¸€ä¸ªreturnè¿”å›è¯­å¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ g++ test.cpp -o test -std=c++11</span><br><span class="line">test.cpp: In function â€˜constexpr int FuncNew(int)â€™:</span><br><span class="line">test.cpp:96:1: error: body of â€˜constexprâ€™ function â€˜constexpr int FuncNew(int)â€™ not a return-statement</span><br><span class="line"> &#125;</span><br><span class="line"> ^</span><br></pre></td></tr></table></figure><p>c++14ä¸­ï¼Œå¯¹constexprçš„é™åˆ¶æ”¾å®½äº†ï¼Œå…è®¸ä½¿ç”¨<strong>å¾ªç¯ã€ifã€switch</strong>ç­‰ç­‰è¯­å¥ï¼Œä½†æ˜¯ä¸»æ—¨è¿˜æ˜¯ä¸€æ ·çš„ï¼Œéœ€è¦åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥è®¡ç®—å‡ºå…¨éƒ¨å†…å®¹ï¼›é™åˆ¶æ”¾å®½ä¹‹åï¼Œè¿™ä¸ªå…³é”®å­—ä¾¿å¯ä»¥æ›´çµæ´»çš„ä½¿ç”¨äº†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¡ç®—å‰né¡¹å’Œï¼ŒC++11</span></span><br><span class="line"><span class="function"><span class="keyword">constexpr</span> <span class="type">int</span> <span class="title">Func</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n &gt; <span class="number">0</span> ? <span class="built_in">Func</span>(n - <span class="number">1</span>) + n : <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è®¡ç®—å‰Né¡¹å’Œï¼ŒC++14</span></span><br><span class="line"><span class="function"><span class="keyword">constexpr</span> <span class="type">int</span> <span class="title">FuncNew</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        sum += i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="4-äºŒè¿›åˆ¶å˜é‡"><a href="#4-äºŒè¿›åˆ¶å˜é‡" class="headerlink" title="4.äºŒè¿›åˆ¶å˜é‡"></a>4.äºŒè¿›åˆ¶å˜é‡</h1><p>å¯ä»¥ä½¿ç”¨<code>0b</code>æˆ–è€…<code>0B</code>å¼€å¤´ç›´æ¥å®šä¹‰äºŒè¿›åˆ¶å˜é‡ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;    </span><br><span class="line">    <span class="type">int</span> bit1 = <span class="number">0b1001</span>;</span><br><span class="line">    <span class="type">int</span> bit2 = <span class="number">0B</span>1011;</span><br><span class="line">    std::cout &lt;&lt; bit1 &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; bit2 &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ g++ test.cpp -o test -std=c++14</span><br><span class="line">$ ./test</span><br><span class="line">9 11</span><br></pre></td></tr></table></figure><p>æˆ‘åœ¨æµ‹è¯•ä¸­å‘ç°ï¼Œå½“æˆ‘ç”¨C++11ç¼–è¯‘æ­¤ä»£ç çš„æ—¶å€™ï¼Œä¼¼ä¹ä¹Ÿæ²¡æœ‰å¼•å‘ç¼–è¯‘é”™è¯¯ï¼Œéš¾é“è¯´0bæ˜¯åœ¨C++11é‡Œé¢å°±æ”¯æŒäº†å—ï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ g++ test.cpp -o test -std=c++11</span><br><span class="line">$ ./test</span><br><span class="line">9 11</span><br></pre></td></tr></table></figure><p>GPTç»™å‡ºäº†0Bè¿™ç§äºŒè¿›åˆ¶å˜é‡æ˜¯åœ¨C++14ä¸­å¼•å…¥çš„ç¡®è®¤ï¼Œå¹¶æåˆ°äº†ä¸ºä»€ä¹ˆä¼šå‡ºç°ä¸Šè¿°æƒ…å†µï¼›è™½ç„¶C++11çœ‹ä¸Šå»ç¼–è¯‘å’Œè¿è¡Œéƒ½æ²¡æœ‰é—®é¢˜ï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯å¾—éµå¾ªç‰ˆæœ¬ï¼Œé€‰ç”¨æ­£ç¡®çš„ç‰ˆæœ¬è¿›è¡Œç¼–è¯‘ï¼Œæ‰èƒ½æ ¹æœ¬ä¸Šé¿å…é”™è¯¯</p><blockquote><p>C++æ ‡å‡†é€šå¸¸æ˜¯å‘åå…¼å®¹çš„ï¼Œè¿™æ„å‘³ç€è¾ƒæ–°ç‰ˆæœ¬çš„ç¼–è¯‘å™¨é€šå¸¸ä¼šç»§ç»­æ”¯æŒè¾ƒæ—§ç‰ˆæœ¬çš„æ ‡å‡†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨ä½¿ç”¨æ”¯æŒC++11æ ‡å‡†çš„ç¼–è¯‘å™¨ï¼ˆå¦‚g++ï¼‰æ—¶ï¼Œä½¿ç”¨äº†C++14æˆ–æ›´é«˜ç‰ˆæœ¬çš„ç‰¹æ€§ï¼Œé€šå¸¸ä¸ä¼šå¼•å‘ç¼–è¯‘é”™è¯¯ï¼Œå› ä¸ºè¿™äº›ç¼–è¯‘å™¨ä¼šå°½é‡å‘åå…¼å®¹ï¼Œä»¥ä¿æŒç°æœ‰ä»£ç çš„å¯ç¼–è¯‘æ€§ã€‚</p><p>åœ¨ä½ æåˆ°çš„æƒ…å†µä¸‹ï¼Œå³ä½¿ä½ ä½¿ç”¨g++ç¼–è¯‘å™¨ä»¥C++11æ ‡å‡†ç¼–è¯‘ï¼Œå®ƒä»ç„¶å¯ä»¥ç†è§£å’Œæ¥å—C++14å¼•å…¥çš„äºŒè¿›åˆ¶å­—é¢é‡ç‰¹æ€§ã€‚è¿™æ˜¯ç¼–è¯‘å™¨å¼€å‘è€…çš„ä¸€ç§è®¾è®¡é€‰æ‹©ï¼Œä»¥ä¾¿ä½¿ä»£ç çš„è¿ç§»æ›´åŠ å¹³æ»‘ã€‚ä½†æ˜¯ï¼Œä¸ºäº†éµå¾ªæœ€ä½³å®è·µå’Œä¿æŒä»£ç çš„å¯è¯»æ€§ï¼Œå½“ä½ åœ¨ä½¿ç”¨ç‰¹å®šC++æ ‡å‡†çš„åŠŸèƒ½æ—¶ï¼Œæœ€å¥½å°†ç¼–è¯‘å™¨é€‰é¡¹è®¾ç½®ä¸ºè¯¥æ ‡å‡†çš„ç‰ˆæœ¬ï¼Œä»¥ç¡®ä¿ä»£ç çš„å¯ç§»æ¤æ€§ã€‚</p></blockquote><h1 id="5-æ•°å­—åˆ†éš”ç¬¦"><a href="#5-æ•°å­—åˆ†éš”ç¬¦" class="headerlink" title="5.æ•°å­—åˆ†éš”ç¬¦"></a>5.æ•°å­—åˆ†éš”ç¬¦</h1><p>åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ä½¿ç”¨æ•°å­—çš„æ—¶å€™ï¼Œä¸ºäº†æ›´å¥½çš„å¯è¯»æ€§ï¼Œæˆ‘ä»¬ä¼šä»¥3ä¸ªæ•°ç»„æˆ–è€…4ä¸ªæ•°ç»„ä¸ºåˆ†å‰²ï¼Œæ‰“ä¸€ä¸ªç‚¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1,0000,0000 ä¸€äº¿</span><br><span class="line">100,000,000</span><br></pre></td></tr></table></figure><p>C++14ä¸­ï¼Œä¹Ÿæ”¯æŒäº†è¿™æ ·çš„æ‰“ç‚¹ï¼Œä»¥æ–¹ä¾¿æˆ‘ä»¬æ›´å¥½çš„çœ‹å‡ºå¤§æ•°å­—çš„ä½æ•°</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_num_div</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> big_num1 = <span class="number">100000000</span>;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> big_num2 = <span class="number">100&#x27;000&#x27;000</span>;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> big_num3 = <span class="number">1&#x27;0000&#x27;0000</span>;</span><br><span class="line">    cout &lt;&lt; big_num1 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; big_num2 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; big_num3 &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„ï¼Œè¿™æ ·çš„æ“ä½œä¸ä¼šå¯¹æ•°å­—æœ¬èº«æœ‰ä»»ä½•å½±å“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">100000000</span><br><span class="line">100000000</span><br><span class="line">100000000</span><br></pre></td></tr></table></figure><p>åœ¨C++11ä¸­è¿™ç§è¯­æ³•æ˜¯ä¸æ”¯æŒçš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ g++ test.cpp -o test -std=c++11</span><br><span class="line">test.cpp:116:29: warning: multi-character character constant [-Wmultichar]</span><br><span class="line">     long long big_num2 = 100&#x27;000&#x27;000;</span><br><span class="line">                             ^~~~~</span><br><span class="line">test.cpp:117:27: warning: multi-character character constant [-Wmultichar]</span><br><span class="line">     long long big_num3 = 1&#x27;0000&#x27;0000;</span><br><span class="line">                           ^~~~~~</span><br><span class="line">test.cpp: In function â€˜void test_num_div()â€™:</span><br><span class="line">test.cpp:116:29: error: expected â€˜,â€™ or â€˜;â€™ before &#x27;\x303030&#x27;</span><br><span class="line">     long long big_num2 = 100&#x27;000&#x27;000;</span><br><span class="line">                             ^~~~~</span><br><span class="line">test.cpp:117:27: error: expected â€˜,â€™ or â€˜;â€™ before &#x27;\x30303030&#x27;</span><br><span class="line">     long long big_num3 = 1&#x27;0000&#x27;0000;</span><br><span class="line">                           ^~~~~~</span><br></pre></td></tr></table></figure><h1 id="6-è¿”å›å€¼autoæ¨å¯¼"><a href="#6-è¿”å›å€¼autoæ¨å¯¼" class="headerlink" title="6.è¿”å›å€¼autoæ¨å¯¼"></a>6.è¿”å›å€¼autoæ¨å¯¼</h1><p>c++14æ–°å¢äº†å‡½æ•°è¿”å›å€¼çš„æ¨å¯¼ï¼Œå½“è¿”å›å€¼å£°æ˜ä¸ºautoæ—¶ï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®ä½ çš„returnè¯­å¥æ¨å¯¼å‡ºä½ çš„è¿”å›å€¼ç±»å‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">Func</span><span class="params">(T x, T y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">Func</span>(<span class="number">3</span>, <span class="number">4</span>) &lt;&lt; std::endl; <span class="comment">// è¿”å›å€¼æ¨å¯¼ä¸ºint</span></span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">Func</span>(<span class="number">3.1</span>, <span class="number">4.2</span>) &lt;&lt; std::endl; <span class="comment">// è¿”å›å€¼æ¨å¯¼ä¸ºdouble</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ make</span><br><span class="line">g++ test.cpp -o test -std=c++14</span><br><span class="line">$ ./test</span><br><span class="line">7</span><br><span class="line">7.3</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ¨å¯¼æ˜¯æœ‰é™åˆ¶æ¡ä»¶çš„</p><p>1ã€å¦‚æœæœ‰å¤šä¸ªæ¨å¯¼è¯­å¥ï¼Œé‚£ä¹ˆå¤šä¸ªæ¨å¯¼çš„ç»“æœå¿…é¡»ä¸€è‡´</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¼–è¯‘æŠ¥é”™ï¼Œç¬¬ä¸€ä¸ªreturnæ¨å¯¼ä¸ºintï¼Œç¬¬äºŒä¸ªreturnæ¨å¯¼ä¸ºdoubleï¼Œä¸¤æ¬¡æ¨å¯¼ç»“æœä¸ä¸€è‡´</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">Func</span><span class="params">(<span class="type">int</span> flag)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (flag &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">3.14</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ã€å¦‚æœæ²¡æœ‰returnæˆ–è€…returnä¸ºvoidç±»å‹ï¼Œé‚£ä¹ˆautoä¼šè¢«æ¨å¯¼ä¸ºvoidã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">f</span><span class="params">()</span> </span>&#123;&#125;              <span class="comment">// returns void</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">g</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">f</span>(); &#125; <span class="comment">// returns void</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span>* <span class="title">x</span><span class="params">()</span> </span>&#123;&#125;             <span class="comment">// error: cannot deduce auto* from void</span></span><br></pre></td></tr></table></figure><p>3ã€ä¸€æ—¦åœ¨å‡½æ•°ä¸­çœ‹åˆ°returnè¯­å¥ï¼Œä»è¯¥è¯­å¥æ¨å¯¼å‡ºçš„è¿”å›ç±»å‹å°±å¯ä»¥åœ¨å‡½æ•°çš„å…¶ä½™éƒ¨åˆ†ä¸­ä½¿ç”¨ï¼ŒåŒ…æ‹¬åœ¨å…¶ä»–returnè¯­å¥ä¸­ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">Sum</span><span class="params">(<span class="type">int</span> i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i &lt;= <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> i; <span class="comment">// è¿”å›å€¼è¢«æ¨å¯¼ä¸ºint</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Sum</span>(i - <span class="number">1</span>) + i; <span class="comment">// sumçš„è¿”å›å€¼å·²ç»è¢«æ¨å¯¼å‡ºæ¥äº†ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯æ²¡æœ‰é—®é¢˜çš„</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœè¿˜æ²¡è¢«æ¨å¯¼å‡ºæ¥ï¼Œé‚£å°±ä¸èƒ½ä½¿ç”¨ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">Sum</span><span class="params">(<span class="type">int</span> i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Sum</span>(i - <span class="number">1</span>) + i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–è¯‘æŠ¥é”™ï¼Œå› ä¸ºSumçš„è¿”å›å€¼è¿˜æ²¡æœ‰è¢«æ¨å¯¼å‡ºæ¥ï¼Œæ‰€ä»¥è¿˜ä¸èƒ½ä½¿ç”¨</span></span><br><span class="line">error: use of â€˜<span class="function"><span class="keyword">auto</span> <span class="title">Sum</span><span class="params">(<span class="type">int</span>)</span>â€™ before deduction of â€˜<span class="keyword">auto</span>â€™</span></span><br></pre></td></tr></table></figure><p>4ã€ä¸èƒ½æ¨å¯¼åˆå§‹åŒ–åˆ—è¡¨ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">func</span> <span class="params">()</span> </span>&#123; <span class="keyword">return</span> &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–è¯‘æŠ¥é”™</span></span><br><span class="line">error: returning initializer list</span><br></pre></td></tr></table></figure><p>5ã€è™šå‡½æ•°ä¸èƒ½ä½¿ç”¨è¿”å›å€¼æ¨å¯¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Item</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">auto</span> <span class="title">Func</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–è¯‘æŠ¥é”™</span></span><br><span class="line">error: <span class="keyword">virtual</span> function cannot have deduced <span class="keyword">return</span> type</span><br></pre></td></tr></table></figure><h1 id="7-deprecated-æ ‡è®°"><a href="#7-deprecated-æ ‡è®°" class="headerlink" title="7.[[deprecated]]æ ‡è®°"></a>7.<code>[[deprecated]]</code>æ ‡è®°</h1><p>è¿™ä¸ªæ ‡è®°çš„ä½œç”¨æ˜¯å‘ŠçŸ¥å…¶ä»–äººï¼ŒæŸä¸ªå‡½æ•°è¢«å¼ƒç”¨äº†ï¼Œä¸å…è®¸ç»§ç»­è°ƒç”¨è¯¥å‡½æ•°ï¼›è¯¥å­—æ®µçš„å¥½å¤„åœ¨äºï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•å·²ç»åœ¨åç»­ä¸éœ€è¦ä½¿ç”¨äº†ï¼Œä½ å¯ä»¥å…ˆç»™ä»–åŠ ä¸Šè¿™ä¸ªå…³é”®å­—ï¼Œç„¶åå†è¿›è¡Œå…¶ä»–çš„ä»£ç æ£€æŸ¥ï¼Œç¡®è®¤æ— è¯¯åï¼Œå†å°†è¿™ä¸ªå‡½æ•°æ•´ä½“æ¸…é™¤ï¼›</p><p>åˆ«äººä¹Ÿä¸éœ€è¦å»æ£€æŸ¥å‡½æ•°çš„å®ç°ï¼Œå› ä¸ºåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ç¼–è¯‘å™¨å°±ä¼šå‘Šè¯‰ä½ è¿™ä¸ªå‡½æ•°è¢«å¼ƒç”¨ï¼›<strong>ä½†æ˜¯ç¼–è¯‘ä¾æ—§æ˜¯æˆåŠŸçš„</strong>ï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[[deprecated]]</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">test_return_auto</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">Func</span>(<span class="number">3</span>, <span class="number">4</span>) &lt;&lt; std::endl; <span class="comment">// è¿”å›å€¼æ¨å¯¼ä¸ºint</span></span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">Func</span>(<span class="number">3.1</span>, <span class="number">4.2</span>) &lt;&lt; std::endl; <span class="comment">// è¿”å›å€¼æ¨å¯¼ä¸ºdouble</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">test_return_auto</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¼šè­¦å‘Šä½ ï¼Œè¿™ä¸ªå‡½æ•°å·²ç»è¢«å¼ƒç”¨äº†ï¼›ä½†è¿™é‡Œåªæ˜¯è­¦å‘Šï¼Œç¼–è¯‘ä¾æ—§æˆåŠŸäº†ï¼Œæ‰€ä»¥æœ€ç»ˆè¿˜æ˜¯éœ€è¦ç¨‹åºçŒ¿å»ç…ä¸€çœ¼å„ä¸ªè­¦å‘Šåˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ make</span><br><span class="line">g++ test.cpp -o test -std=c++14</span><br><span class="line">test.cpp: In function â€˜int main()â€™:</span><br><span class="line">test.cpp:145:22: warning: â€˜int test_return_auto()â€™ is deprecated [-Wdeprecated-declarations]</span><br><span class="line">     test_return_auto();</span><br><span class="line">                      ^</span><br><span class="line">test.cpp:132:5: note: declared here</span><br><span class="line"> int test_return_auto()</span><br><span class="line">     ^~~~~~~~~~~~~~~~</span><br><span class="line">test.cpp:145:22: warning: â€˜int test_return_auto()â€™ is deprecated [-Wdeprecated-declarations]</span><br><span class="line">     test_return_auto();</span><br><span class="line">                      ^</span><br><span class="line">test.cpp:132:5: note: declared here</span><br><span class="line"> int test_return_auto()</span><br><span class="line">     ^~~~~~~~~~~~~~~~</span><br></pre></td></tr></table></figure><hr><h1 id="stdåº“çš„æ–°ç‰¹æ€§"><a href="#stdåº“çš„æ–°ç‰¹æ€§" class="headerlink" title="stdåº“çš„æ–°ç‰¹æ€§"></a>stdåº“çš„æ–°ç‰¹æ€§</h1><p>ä»¥ä¸‹æ˜¯STDåº“çš„æ–°å¢å†…å®¹ï¼</p><h2 id="8-std-make-unique"><a href="#8-std-make-unique" class="headerlink" title="8.std::make_unique"></a>8.std::make_unique</h2><p>è¿™ä¸ªä¸œè¥¿åœ¨cplusplusç½‘ç«™ä¸Šæ‰¾ä¸åˆ°é‡Šä¹‰ï¼Œæ‰€ä»¥å°±å»<a href="https://zh.cppreference.com/">cppçš„å®˜ç½‘</a>ä¸Šæ‰¾äº†</p><blockquote><p><a href="https://zh.cppreference.com/w/cpp/memory/unique_ptr/make_unique">https://zh.cppreference.com/w/cpp/memory/unique_ptr/make_unique</a></p></blockquote><p>è¯¥å‡½æ•°å®šä¹‰åœ¨<code>&lt;memory&gt;</code>å¤´æ–‡ä»¶ä¸­</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt; <span class="keyword">class</span> T, <span class="keyword">class</span>... Args &gt;</span></span><br><span class="line"><span class="function">unique_ptr&lt;T&gt; <span class="title">make_unique</span><span class="params">( Args&amp;&amp;... args )</span></span>;</span><br><span class="line"><span class="comment">//(1)(C++14 èµ·) (ä»…å¯¹éæ•°ç»„ç±»å‹)</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt; <span class="keyword">class</span> T &gt;</span></span><br><span class="line"><span class="function">unique_ptr&lt;T&gt; <span class="title">make_unique</span><span class="params">( std::<span class="type">size_t</span> size )</span></span>;</span><br><span class="line"><span class="comment">//(2)(C++14 èµ·) (ä»…å¯¹æœªçŸ¥è¾¹ç•Œæ•°ç»„)</span></span><br><span class="line"><span class="keyword">template</span>&lt; <span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span>... Args &gt;</span><br><span class="line"><span class="comment">/* unspecified */</span> <span class="built_in">make_unique</span>( Args&amp;&amp;... args ) = <span class="keyword">delete</span>;</span><br><span class="line"><span class="comment">//(3)(C++14 èµ·) (ä»…å¯¹å·²çŸ¥è¾¹ç•Œæ•°ç»„)</span></span><br></pre></td></tr></table></figure><p>ä½œç”¨æ˜¯æ„é€  <code>T</code> ç±»å‹å¯¹è±¡å¹¶å°†å…¶åŒ…è£…è¿› <a href="https://zh.cppreference.com/w/cpp/memory/unique_ptr">std::unique_ptr</a>ï¼›</p><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>args</td><td>å°†è¦æ„é€ çš„ <code>T</code> å®ä¾‹æ‰€ç”¨çš„å‚æ•°åˆ—è¡¨ã€‚</td></tr><tr><td>size</td><td>è¦æ„é€ çš„æ•°ç»„å¤§å°</td></tr></tbody></table><ol><li>æ„é€ éæ•°ç»„ç±»å‹ <code>T</code> å¯¹è±¡ã€‚ä¼ é€’å‚æ•° <code>args</code> ç»™ <code>T</code> çš„æ„é€ å‡½æ•°ã€‚æ­¤é‡è½½åªæœ‰åœ¨ <code>T</code> ä¸æ˜¯æ•°ç»„ç±»å‹æ—¶æ‰ä¼šå‚ä¸é‡è½½å†³è®®ã€‚å‡½æ•°ç­‰ä»·äºï¼š</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unique_ptr</span>&lt;T&gt;(<span class="keyword">new</span> <span class="built_in">T</span>(std::forward&lt;Args&gt;(args)...))</span><br></pre></td></tr></table></figure><ol start="2"><li>æ„é€ æ‹¥æœ‰åŠ¨æ€å¤§å°çš„æ•°ç»„ã€‚<a href="https://zh.cppreference.com/w/cpp/language/value_initialization">å€¼åˆå§‹åŒ–</a>æ•°ç»„å…ƒç´ ã€‚æ­¤é‡è½½åªæœ‰åœ¨ <code>T</code> æ˜¯æœªçŸ¥è¾¹ç•Œæ•°ç»„æ—¶æ‰ä¼šå‚ä¸é‡è½½å†³è®®ã€‚å‡½æ•°ç­‰ä»·äºï¼š</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unique_ptr</span>&lt;T&gt;(<span class="keyword">new</span> std::<span class="type">remove_extent_t</span>&lt;T&gt;[size]())</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç¤ºä¾‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">test_class</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">test_class</span>(<span class="type">int</span> a=<span class="number">-1</span>):_a(a)&#123;&#125;</span><br><span class="line">    <span class="type">int</span> _a;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::unique_ptr&lt;test_class&gt; pt = std::<span class="built_in">make_unique</span>&lt;test_class&gt;(<span class="number">3</span>);</span><br><span class="line">    cout &lt;&lt; pt-&gt;_a &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ make</span><br><span class="line">g++ test.cpp -o test -std=c++14</span><br><span class="line">$ ./test</span><br><span class="line">3</span><br></pre></td></tr></table></figure><h2 id="9-std-shared-timed-mutexä¸std-shared-lock"><a href="#9-std-shared-timed-mutexä¸std-shared-lock" class="headerlink" title="9.std::shared_timed_mutexä¸std::shared_lock"></a>9.std::shared_timed_mutexä¸std::shared_lock</h2><p>c++11å¼•å…¥äº†å¤šçº¿ç¨‹çº¿ç¨‹çš„ä¸€äº›åº“ï¼Œä½†æ˜¯æ˜¯æ²¡æœ‰è¯»å†™é”çš„ï¼Œå› æ­¤åœ¨c++14å¼•å…¥äº†è¯»å†™é”çš„ç›¸å…³å®ç°ï¼ˆå¤´æ–‡ä»¶shared_mutexï¼‰ï¼Œå…¶å®c++14è¯»å†™é”ä¹Ÿè¿˜ä¸å¤Ÿå®Œå–„ï¼Œç›´åˆ°c++17è¯»å†™é”è¿™å—æ‰ç®—æ˜¯å®Œå¤‡èµ·æ¥ã€‚</p><p><code>std::shared_timed_mutex</code>æ˜¯å¸¦è¶…æ—¶çš„è¯»å†™é”å¯¹è±¡ï¼Œæ¥å£è¿˜ç®—æ¯”è¾ƒç®€æ´æ˜“æ‡‚ï¼Œå’Œä¹‹å‰æ¥è§¦è¿‡çš„å…¶ä»–é”åŸºæœ¬ä¸€è‡´ï¼›å†…éƒ¨æˆå‘˜ä¸­<code>lock()</code>æ˜¯å†™é”ï¼Œ<code>lock_shared()</code>æ˜¯è¯»é”;</p><p><a href="https://zh.cppreference.com/w/cpp/thread/shared_timed_mutex">https://zh.cppreference.com/w/cpp/thread/shared_timed_mutex</a></p><p><img src="https://img.musnow.top/i/2023/08/9c8a79016b52e8d7845bdee6a98fc151.png" alt="image-20230829082045636"></p><p><code>std::shared_lock</code>æ˜¯åŠ é”çš„RAIIå®ç°ï¼Œå³æ„é€ æ—¶åŠ é”ï¼Œææ„æ—¶è§£é”ï¼›æˆ‘ä»¬ä½¿ç”¨<code>shared_lock/unique_lock</code>æ¥ä»<code>shared_timed_mutex</code>ä¸­è·å–é”çš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨è·å–è¯»é”å’Œå†™é”ï¼›</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">std::shared_timed_mutex mutex;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">readOperation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è¯»é”æ˜¯å¤šäººå¯ä»¥è·å–çš„ï¼Œæ‰€ä»¥è¦ç”¨shared_lock (è¯»é”)</span></span><br><span class="line">    <span class="function">std::shared_lock&lt;std::shared_timed_mutex&gt; <span class="title">lock</span><span class="params">(mutex)</span></span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Read operation: &quot;</span> &lt;&lt; sharedResource &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">writeOperation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å†™é”äº’æ–¥è·å–ï¼Œç”¨unique_lock (å†™é”)</span></span><br><span class="line">    <span class="function">std::unique_lock&lt;std::shared_timed_mutex&gt; <span class="title">lock</span><span class="params">(mutex)</span></span>;</span><br><span class="line">    sharedResource++;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Write operation: &quot;</span> &lt;&lt; sharedResource &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="10-std-exchange"><a href="#10-std-exchange" class="headerlink" title="10.std::exchange"></a>10.std::exchange</h2><p>c++14æ–°å¢äº†ä¸€ä¸ªæ¥å£<code>std::exchange</code>ï¼ˆå¤´æ–‡ä»¶utilityï¼‰ï¼Œå…¶å®è¿™ä¸ªä¹Ÿå¹¶ä¸ç®—æ˜¯æ–°å¢çš„ï¼Œå› ä¸ºè¿™ä¸ªæ¥å£å…¶å®åœ¨c++11çš„æ—¶å€™å°±æœ‰äº†ï¼Œåªä¸è¿‡åœ¨c++11ä¸­ä½œä¸ºä¸€ä¸ªå†…éƒ¨å‡½æ•°ï¼Œä¸æš´éœ²ç»™ç”¨æˆ·ä½¿ç”¨ï¼Œåœ¨c++14ä¸­æ‰æŠŠå®ƒæš´éœ²å‡ºæ¥ç»™ç”¨æˆ·ä½¿ç”¨ã€‚ä½¿ç”¨æ–¹æ³•ä¹Ÿå¾ˆç®€å•ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::string s1 = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    std::string s2 = <span class="string">&quot;world&quot;</span>;</span><br><span class="line">    std::<span class="built_in">exchange</span>(s1, s2);</span><br><span class="line">    std::cout &lt;&lt; s1 &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; s2 &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line">world world</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œexchangeä¼šæŠŠç¬¬äºŒä¸ªå€¼èµ‹å€¼ç»™ç¬¬ä¸€ä¸ªå€¼ï¼Œä½†æ˜¯ä¸ä¼šæ”¹å˜ç¬¬äºŒä¸ªå€¼ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹å®ƒçš„å®ç°å§ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Assign @p __new_val to @p __obj and return its previous value.</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> _Tp, <span class="keyword">typename</span> _Up = _Tp&gt;</span><br><span class="line">  _GLIBCXX20_CONSTEXPR</span><br><span class="line">  <span class="keyword">inline</span> _Tp</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">exchange</span>(_Tp&amp; __obj, _Up&amp;&amp; __new_val)</span><br><span class="line">  <span class="built_in">noexcept</span>(__and_&lt;is_nothrow_move_constructible&lt;_Tp&gt;,</span><br><span class="line">    is_nothrow_assignable&lt;_Tp&amp;, _Up&gt;&gt;::value)</span><br><span class="line">  &#123; <span class="keyword">return</span> std::__exchange(__obj, std::forward&lt;_Up&gt;(__new_val)); &#125;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// C++11 version of std::exchange for internal use.</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> _Tp, <span class="keyword">typename</span> _Up = _Tp&gt;</span><br><span class="line">  _GLIBCXX20_CONSTEXPR</span><br><span class="line">  <span class="keyword">inline</span> _Tp</span><br><span class="line">  __exchange(_Tp&amp; __obj, _Up&amp;&amp; __new_val)</span><br><span class="line">  &#123;</span><br><span class="line">    _Tp __old_val = std::<span class="built_in">move</span>(__obj);</span><br><span class="line">    __obj = std::forward&lt;_Up&gt;(__new_val);</span><br><span class="line">    <span class="keyword">return</span> __old_val;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ³¨é‡Šæˆ‘ä»¬å¯ä»¥æ˜ç™½å«ä¹‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯æŠŠç¬¬äºŒä¸ªå€¼èµ‹å€¼ç»™ç¬¬ä¸€ä¸ªå€¼ï¼ŒåŒæ—¶è¿”å›ç¬¬ä¸€ä¸ªå€¼çš„æ—§å€¼ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿™é‡Œè¯´æ˜ä¸€ä¸ªå…³é”®çš„ç‚¹ã€‚exchangeçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸‡èƒ½å¼•ç”¨ï¼Œæ‰€ä»¥è¯´ä»–æ˜¯æ—¢å¯ä»¥æ¥æ”¶å·¦å€¼ï¼Œä¹Ÿå¯ä»¥æ¥æ”¶å³å€¼çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥ä½¿ç”¨ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::string s1 = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    <span class="comment">// ç¬¬äºŒä¸ªå€¼æ˜¯çº¯å³å€¼</span></span><br><span class="line">    std::<span class="built_in">exchange</span>(s1, <span class="string">&quot;world&quot;</span>);</span><br><span class="line">    std::cout &lt;&lt; s1 &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    std::string s2 = <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">    <span class="comment">// ç¬¬äºŒä¸ªå€¼é€šè¿‡moveè¯­ä¹‰è½¬æˆå³å€¼</span></span><br><span class="line">    std::<span class="built_in">exchange</span>(s1, std::<span class="built_in">move</span>(s2));</span><br><span class="line">    std::cout &lt;&lt; s1 &lt;&lt; <span class="string">&quot; | &quot;</span> &lt;&lt; s2 &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœï¼Œæ³¨æ„è¿™é‡Œs2ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå› ä¸ºs2çš„ä¸œè¥¿å·²ç»è¢«ç§»åŠ¨æ‹·è´ç»™s1äº†</span></span><br><span class="line">world</span><br><span class="line">hello world | </span><br></pre></td></tr></table></figure><h2 id="11-std-integer-sequence"><a href="#11-std-integer-sequence" class="headerlink" title="11.std::integer_sequence"></a>11.std::integer_sequence</h2><p>ç±»æ¨¡æ¿ <code>std::integer_sequence</code> è¡¨ç¤ºä¸€ä¸ªç¼–è¯‘æ—¶çš„æ•´æ•°åºåˆ—ã€‚åœ¨ç”¨ä½œ<a href="https://zh.cppreference.com/w/cpp/language/function_template">å‡½æ•°æ¨¡æ¿</a>çš„å®å‚æ—¶ï¼Œèƒ½æ¨å¯¼<a href="https://zh.cppreference.com/w/cpp/language/parameter_pack">å‚æ•°åŒ…</a> <code>Ints</code> å¹¶å°†å®ƒç”¨äºåŒ…å±•å¼€ã€‚</p><p><a href="https://zh.cppreference.com/w/cpp/utility/integer_sequence">https://zh.cppreference.com/w/cpp/utility/integer_sequence</a></p><p>è¿™ä¸ªå®åœ¨æ˜¯å¤ªéš¾æ‡‚äº†ï¼Œæä¸æ˜ç™½æ˜¯å¹²å˜›çš„ï¼Œæ”¾å¼ƒäº†ğŸ˜¥</p><h2 id="12-std-quoted"><a href="#12-std-quoted" class="headerlink" title="12.std::quoted"></a>12.std::quoted</h2><p><a href="https://zh.cppreference.com/w/cpp/io/manip/quoted">https://zh.cppreference.com/w/cpp/io/manip/quoted</a></p><p>è¯¥å‡½æ•°æ¨¡æ¿ä½äº <code>&lt;iomanip&gt;</code> å¤´æ–‡ä»¶ä¸­ï¼Œç”¨äºåœ¨è¾“å…¥è¾“å‡ºæµä¸­å¤„ç†è¢«å¼•å·åŒ…å›´çš„å­—ç¬¦ä¸²ã€‚å®ƒé€šå¸¸ç”¨äºå¤„ç† CSVï¼ˆé€—å·åˆ†éš”å€¼ï¼‰æ–‡ä»¶æˆ–å…¶ä»–æ ¼å¼ï¼Œå…¶ä¸­å­—æ®µè¢«å¼•å·æ‹¬èµ·æ¥ä»¥å¤„ç†åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚é€—å·ã€æ¢è¡Œç¬¦ç­‰ï¼‰çš„æƒ…å†µã€‚</p><p>å¯¹äº<code>cout</code>è€Œè¨€ï¼Œquotedä¼šå°†å­—ç¬¦ä¸²åŒ…å›´åœ¨åŒå¼•å·ä¸­è¾“å‡º</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">test_quorted</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::string data = <span class="string">&quot;Hello, \&quot;world\&quot;\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¾“å‡ºæµä¸­ä½¿ç”¨ std::quotedï¼Œä¼šå°†å­—ç¬¦ä¸²åœ¨&quot;å†…åŒ…å›´è¾“å‡º</span></span><br><span class="line">    std::cout &lt;&lt; std::<span class="built_in">quoted</span>(data) &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">&quot;Hello, \&quot;world\&quot;</span><br><span class="line">&quot;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯å®˜æ–¹ç»™çš„ä¸€ä¸ªç¤ºä¾‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::stringstream ss;</span><br><span class="line">    std::string in = <span class="string">&quot;String with spaces, and embedded \&quot;quotes\&quot; too&quot;</span>;</span><br><span class="line">    std::string out;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">auto</span> show = [&amp;](<span class="type">const</span> <span class="keyword">auto</span>&amp; what) &#123;</span><br><span class="line">        &amp;what == &amp;in</span><br><span class="line">            ?   std::cout &lt;&lt; <span class="string">&quot;read in     [&quot;</span> &lt;&lt; in &lt;&lt; <span class="string">&quot;]\n&quot;</span></span><br><span class="line">                          &lt;&lt; <span class="string">&quot;stored as   [&quot;</span> &lt;&lt; ss.<span class="built_in">str</span>() &lt;&lt; <span class="string">&quot;]\n&quot;</span></span><br><span class="line">            :   std::cout &lt;&lt; <span class="string">&quot;written out [&quot;</span> &lt;&lt; out &lt;&lt; <span class="string">&quot;]\n\n&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"> </span><br><span class="line">    ss &lt;&lt; std::<span class="built_in">quoted</span>(in);</span><br><span class="line">    <span class="built_in">show</span>(in);</span><br><span class="line">    ss &gt;&gt; std::<span class="built_in">quoted</span>(out);</span><br><span class="line">    <span class="built_in">show</span>(out);</span><br><span class="line"> </span><br><span class="line">    ss.<span class="built_in">str</span>(<span class="string">&quot;&quot;</span>); <span class="comment">// clear the stream buffer</span></span><br><span class="line"> </span><br><span class="line">    in = <span class="string">&quot;String with spaces, and embedded $quotes$ too&quot;</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> delim &#123;<span class="string">&#x27;$&#x27;</span>&#125;;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> escape &#123;<span class="string">&#x27;%&#x27;</span>&#125;;</span><br><span class="line"> </span><br><span class="line">    ss &lt;&lt; std::<span class="built_in">quoted</span>(in, delim, escape);</span><br><span class="line">    <span class="built_in">show</span>(in);</span><br><span class="line">    ss &gt;&gt; std::<span class="built_in">quoted</span>(out, delim, escape);</span><br><span class="line">    <span class="built_in">show</span>(out);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">read in     [String with spaces, and embedded &quot;quotes&quot; too]</span><br><span class="line">stored as   [&quot;String with spaces, and embedded \&quot;quotes\&quot; too&quot;]</span><br><span class="line">written out [String with spaces, and embedded &quot;quotes&quot; too]</span><br><span class="line"> </span><br><span class="line">read in     [String with spaces, and embedded $quotes$ too]</span><br><span class="line">stored as   [$String with spaces, and embedded %$quotes%$ too$]</span><br><span class="line">written out [String with spaces, and embedded $quotes$ too]</span><br></pre></td></tr></table></figure><p>åœ¨ç»™å®šçš„ä»£ç ä¸­ï¼Œ<code>delim</code> å’Œ <code>escape</code> æ˜¯ç”¨äºæŒ‡å®šè‡ªå®šä¹‰çš„åˆ†éš”ç¬¦å’Œè½¬ä¹‰å­—ç¬¦çš„å‚æ•°ã€‚è¿™äº›å‚æ•°æ˜¯ç”¨äº <code>std::quoted</code> å‡½æ•°çš„é‡è½½å½¢å¼ï¼Œå…è®¸ä½ æŒ‡å®šä¸åŒäºé»˜è®¤å¼•å·çš„å­—ç¬¦æ¥åŒ…å›´å­—ç¬¦ä¸²ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªä¸åŒäºé»˜è®¤è½¬ä¹‰å­—ç¬¦çš„å­—ç¬¦æ¥è½¬ä¹‰å¼•å·å­—ç¬¦ã€‚ä»¥ä¸‹æ˜¯å…³äºè¿™ä¸¤ä¸ªå‚æ•°çš„è¯¦ç»†è§£é‡Šï¼š</p><ol><li><code>delim</code>: åˆ†éš”ç¬¦ åœ¨ç¬¬ä¸€ä¸ªç”¨æ³•ä¸­ï¼Œ<code>std::quoted</code> å‡½æ•°ä½¿ç”¨äº†ä¸‰ä¸ªå‚æ•°çš„é‡è½½å½¢å¼ï¼š<code>std::quoted(in, delim, escape)</code>ã€‚<code>delim</code> å‚æ•°ç”¨äºæŒ‡å®šåŒ…å›´å­—ç¬¦ä¸²çš„åˆ†éš”ç¬¦ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œ<code>std::quoted</code> ä½¿ç”¨åŒå¼•å·ä½œä¸ºé»˜è®¤åˆ†éš”ç¬¦ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½æƒ³è¦ä½¿ç”¨å…¶ä»–å­—ç¬¦æ¥åŒ…å›´å­—ç¬¦ä¸²ï¼Œä»¥é¿å…ä¸å­—ç¬¦ä¸²æœ¬èº«çš„å­—ç¬¦å†²çªã€‚åœ¨ä½ çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œåˆ†éš”ç¬¦ <code>delim</code> è¢«è®¾ç½®ä¸º <code>$</code>ï¼Œè¿™æ„å‘³ç€å­—ç¬¦ä¸²ä¼šè¢«åŒ…å›´åœ¨ <code>$</code> å­—ç¬¦å†…ã€‚</li><li><code>escape</code>: è½¬ä¹‰å­—ç¬¦ <code>escape</code> å‚æ•°å…è®¸ä½ æŒ‡å®šä¸€ä¸ªå­—ç¬¦ï¼Œç”¨äºè½¬ä¹‰åˆ†éš”ç¬¦å­—ç¬¦æœ¬èº«ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>std::quoted</code> ä½¿ç”¨åŒå¼•å· <code>&quot;</code> ä½œä¸ºè½¬ä¹‰å­—ç¬¦ï¼Œä»¥ç¡®ä¿åœ¨å­—ç¬¦ä¸²ä¸­åµŒå…¥çš„å¼•å·ä¸ä¼šè¢«è§£é‡Šä¸ºç»“æŸå¼•å·ã€‚ä½†å¦‚æœä½ é€‰æ‹©äº†è‡ªå®šä¹‰çš„åˆ†éš”ç¬¦ï¼Œä½ å¯èƒ½è¿˜éœ€è¦æŒ‡å®šä¸€ä¸ªä¸åŒäºé»˜è®¤è½¬ä¹‰å­—ç¬¦çš„å­—ç¬¦æ¥è¿›è¡Œè½¬ä¹‰ã€‚åœ¨ä½ çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œè½¬ä¹‰å­—ç¬¦ <code>escape</code> è¢«è®¾ç½®ä¸º <code>%</code>ï¼Œè¿™æ„å‘³ç€åœ¨å­—ç¬¦ä¸²ä¸­ï¼Œå¦‚æœä½ æƒ³è¦è¡¨ç¤ºåˆ†éš”ç¬¦ <code>$</code> æœ¬èº«ï¼Œä½ éœ€è¦ä½¿ç”¨ <code>%$</code>ã€‚</li></ol><p>è¿™éƒ¨åˆ†ä¹Ÿä¸æ˜¯å¾ˆå®¹æ˜“ææ˜ç™½å®ƒæ˜¯å¹²å˜›çš„ï¼Œå¦‚æœé¢è¯•å®˜é—®é“äº†å°±è¯´æˆ‘ä¸ä¼šå§ğŸ˜­</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;å­¦ä¹ C++14çš„é‚£äº›æ–°ç‰¹æ€§&lt;/p&gt;</summary>
    
    
    
    <category term="é‡è§C++" scheme="https://blog.musnow.top/categories/%E9%81%87%E8%A7%81C/"/>
    
    
    <category term="æ•°æ®ç»“æ„" scheme="https://blog.musnow.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    <category term="C++" scheme="https://blog.musnow.top/tags/C/"/>
    
    <category term="C++14" scheme="https://blog.musnow.top/tags/C-14/"/>
    
  </entry>
  
  <entry>
    <title>ã€leetcodeã€‘1137. ç¬¬ N ä¸ªæ³°æ³¢é‚£å¥‘æ•°</title>
    <link href="https://blog.musnow.top/posts/563921472/"/>
    <id>https://blog.musnow.top/posts/563921472/</id>
    <published>2023-08-27T09:32:44.000Z</published>
    <updated>2023-08-27T09:32:44.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æ˜¯å­¦ä¹ åŠ¨å½’çš„ç¬¬ä¸€å¤©ï¼Œå…ˆæ¥ä¸€é“ç®€å•é¢˜ç»ƒç»ƒæ‰‹å§ï¼</p><h1 id="1-é¢˜ç›®"><a href="#1-é¢˜ç›®" class="headerlink" title="1.é¢˜ç›®"></a>1.é¢˜ç›®</h1><blockquote><p>leetcode <a href="https://leetcode.cn/problems/n-th-tribonacci-number/">1137. ç¬¬ N ä¸ªæ³°æ³¢é‚£å¥‘æ•°</a></p></blockquote><p>æ³°æ³¢é‚£å¥‘åºåˆ— Tn å®šä¹‰å¦‚ä¸‹ï¼š </p><p>T0 &#x3D; 0, T1 &#x3D; 1, T2 &#x3D; 1, ä¸”åœ¨ n &gt;&#x3D; 0 çš„æ¡ä»¶ä¸‹ <code>Tn+3 = Tn + Tn+1 + Tn+2</code></p><p>ç»™ä½ æ•´æ•° <code>n</code>ï¼Œè¯·è¿”å›ç¬¬ n ä¸ªæ³°æ³¢é‚£å¥‘æ•° Tn çš„å€¼ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„ä¸æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Œå“ªä¸ªæ˜¯ <code>Tn = Tn-1 + Tn-2</code>ï¼Œè€Œè¿™é‡Œæ˜¯ä¸‰ä¸ªï¼›</p><h1 id="2-åŠ¨å½’è§£æ³•"><a href="#2-åŠ¨å½’è§£æ³•" class="headerlink" title="2.åŠ¨å½’è§£æ³•"></a>2.åŠ¨å½’è§£æ³•</h1><p>åŠ¨æ€é€’å½’çš„æ€è·¯æ˜¯éœ€è¦æ‰¾åˆ°ä¸€ä¸ªé€’å½’æ–¹ç¨‹ï¼Œæœ¬é¢˜ä¸­çš„é€’å½’æ–¹ç¨‹å·²ç»ç»™å‡ºæ¥äº†ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“nå°äº3çš„æ—¶å€™ï¼Œè¿™ä¸ªé€’å½’æ–¹ç¨‹æ˜¯ä¸å¯ç”¨çš„ï¼ˆå› ä¸ºæˆ‘ä»¬æ²¡æœ‰åŠæ³•è®¡ç®—T<sub>è´Ÿæ•°</sub>çš„å€¼ï¼‰</p><h2 id="2-1-è§£æ³•1-é€’å½’"><a href="#2-1-è§£æ³•1-é€’å½’" class="headerlink" title="2.1 è§£æ³•1-é€’å½’"></a>2.1 è§£æ³•1-é€’å½’</h2><p>å¦‚ä¸‹æ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ªè§£æ³•ï¼Œé€šè¿‡é€’å½’å‡½æ•°è®¡ç®—æ•°å€¼ï¼Œå¹¶æå‰å†™å…¥0ã€1ã€2è¿™ä¸‰ä¸ªæ•°å€¼åˆ°æ•°ç»„é‡Œé¢ã€‚</p><p>å¦‚æœæ•°ç»„é‡Œé¢æœ‰å€¼ï¼Œç›´æ¥å–å‡ºæ¥ï¼Œå¦‚æœæ²¡æœ‰å€¼ï¼Œåœ¨è®¡ç®—äº†ä¹‹åå†èµ‹å€¼åˆ°æ•°ç»„é‡Œé¢ã€‚è¿™æ ·å°±èƒ½ä¿è¯åœ¨æ•´ä¸ªé€’å½’æµç¨‹ä¸­ï¼Œç›¸åŒä¸‹æ ‡å¤„çš„æ•°æ®åªä¼šè¢«è®¡ç®—ä¸€æ¬¡ï¼ˆä¸è¿™ä¹ˆåšä¼šè¶…æ—¶ï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> DEF -1 <span class="comment">//é»˜è®¤å€¼</span></span></span><br><span class="line">    <span class="comment">// ç›´æ¥ç”¨é€’å½’ä¼šè¶…æ—¶</span></span><br><span class="line">    <span class="comment">// æƒ³æ³•æ˜¯å°†æ•°æ®å­˜åˆ°vectoré‡Œé¢ï¼Œé¿å…é’ˆå¯¹æŸä¸€ä¸ªæ•°çš„äºŒæ¬¡é€’å½’è¿ç®—</span></span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> <span class="title function_">fib</span><span class="params">(<span class="type">int</span> n,<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;&amp; _map)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(_map[n] != DEF)&#123;</span><br><span class="line">            <span class="keyword">return</span> _map[n];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> ans = fib(n<span class="number">-1</span>,_map) + fib(n<span class="number">-2</span>,_map)+fib(n<span class="number">-3</span>,_map);</span><br><span class="line">        _map[n] = ans;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">tribonacci</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt; _map(<span class="number">40</span>,DEF);</span><br><span class="line">        _map[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        _map[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        _map[<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–å¹¶ä¼ å¼•ç”¨ç»™é€’å½’å‡½æ•°</span></span><br><span class="line">        <span class="keyword">return</span> fib(n,_map);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è¯¥æ–¹æ³•çš„é€šè¿‡ç‡å¦‚å›¾</p><p><img src="https://img.musnow.top/i/2023/08/6da34c2bc594bf2893b2b0edaee08c21.png" alt="image-20230827172927657"></p><h2 id="2-2-æ–¹æ³•2-è¿­ä»£"><a href="#2-2-æ–¹æ³•2-è¿­ä»£" class="headerlink" title="2.2 æ–¹æ³•2-è¿­ä»£"></a>2.2 æ–¹æ³•2-è¿­ä»£</h2><p>è¿˜æ˜¯ç›¸åŒçš„æ€è·¯ï¼Œåªä¸è¿‡è¿™æ¬¡æˆ‘ä»¬ä¸ç”¨é€’å½’ï¼Œè€Œæ˜¯ç”¨è¿­ä»£æ¥è®¡ç®—å‡ºæ•°ç»„é‡Œé¢å¯¹åº”ä¸‹æ ‡çš„å€¼ï¼Œæœ€åå†è¿”å›ç»™ç”¨æˆ·</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">tribonacci</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(n&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt; _map(n+<span class="number">1</span>,DEF);</span><br><span class="line">    _map[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    _map[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    _map[<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">3</span>;i&lt;_map.size();i++)&#123;</span><br><span class="line">        _map[i] = _map[i<span class="number">-3</span>] +_map[i<span class="number">-2</span>]+_map[i<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> _map[n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥åŠæ³•çš„é€šè¿‡ç‡å¦‚å›¾ï¼Œæ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦éƒ½æ˜¯<code>O(N)</code></p><p><img src="https://img.musnow.top/i/2023/08/eddf5511ea8346939633d018000e406f.png" alt="image-20230827173201195"></p><h2 id="2-3-è¿­ä»£-å˜é‡"><a href="#2-3-è¿­ä»£-å˜é‡" class="headerlink" title="2.3 è¿­ä»£+å˜é‡"></a>2.3 è¿­ä»£+å˜é‡</h2><p>æ—¢ç„¶åœ¨è®¡ç®—çš„æ—¶å€™æˆ‘ä»¬åªéœ€è¦ç”¨åˆ°å½“å‰æ•°æ®å’Œè¯¥æ•°æ®ä¹‹å‰çš„3ä¸ªå˜é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥ç”¨å›ºå®šçš„å‡ ä¸ªå˜é‡æ¥å®ç°è¿™ä¸ªæ“ä½œï¼Œæ¯æ¬¡è®¡ç®—ä¹‹åï¼Œéƒ½å¯¹å˜é‡è¿›è¡Œä¸€æ¬¡è½®æ¢å°±okäº†ï¼Œå®˜æ–¹çš„é¢˜è§£å°±æ˜¯è¿™ä¹ˆæ“ä½œçš„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">tribonacci</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> p = <span class="number">0</span>, q = <span class="number">0</span>, r = <span class="number">1</span>, s = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">3</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        p = q;</span><br><span class="line">        q = r;</span><br><span class="line">        r = s;</span><br><span class="line">        s = p + q + r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦è¿˜æ˜¯O(N)ï¼Œä½†æ˜¯ç©ºé—´å¤æ‚åº¦å°±é™åˆ°O(1)äº†ï¼</p><p><img src="https://img.musnow.top/i/2023/08/0681a6444a756d58fe395a2202b0ce18.png" alt="image-20230827173339364"></p><h1 id="3-çŸ©é˜µè®¡ç®—"><a href="#3-çŸ©é˜µè®¡ç®—" class="headerlink" title="3.çŸ©é˜µè®¡ç®—"></a>3.çŸ©é˜µè®¡ç®—</h1><p>å¦‚æœä¸ç”¨é€’å½’ï¼Œè¿˜å¯ä»¥ç”¨çŸ©é˜µä¹˜æ³•è¿ç®—ï¼Œè¯¥æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(LogN)</code></p><p><a href="https://leetcode.cn/problems/n-th-tribonacci-number/solutions/921898/di-n-ge-tai-bo-na-qi-shu-by-leetcode-sol-kn16/">https://leetcode.cn/problems/n-th-tribonacci-number/solutions/921898/di-n-ge-tai-bo-na-qi-shu-by-leetcode-sol-kn16/</a></p><p><img src="https://img.musnow.top/i/2023/08/a0431301252e331d1d2e9ac952358063.png" alt="image-20230827173653674"></p><p>å¥ˆä½•æœ¬äººçº¿ä»£çŸ¥è¯†å¿˜è®°äº†ï¼Œå®Œå…¨çœ‹ä¸æ‡‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">public:</span><br><span class="line">    <span class="type">int</span> <span class="title function_">tribonacci</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">long</span>&gt;&gt; q = &#123;&#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>&#125;, &#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>&#125;&#125;;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">long</span>&gt;&gt; res = <span class="built_in">pow</span>(q, n);</span><br><span class="line">        <span class="keyword">return</span> res[<span class="number">0</span>][<span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">long</span>&gt;&gt; <span class="built_in">pow</span>(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">long</span>&gt;&gt;&amp; a, <span class="type">long</span> n) &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">long</span>&gt;&gt; ret = &#123;&#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>&#125;&#125;;</span><br><span class="line">        <span class="keyword">while</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((n &amp; <span class="number">1</span>) == <span class="number">1</span>) &#123;</span><br><span class="line">                ret = multiply(ret, a);</span><br><span class="line">            &#125;</span><br><span class="line">            n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">            a = multiply(a, a);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">long</span>&gt;&gt; multiply(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">long</span>&gt;&gt;&amp; a, <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">long</span>&gt;&gt;&amp; b) &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">long</span>&gt;&gt; c(<span class="number">3</span>, <span class="built_in">vector</span>&lt;<span class="type">long</span>&gt;(<span class="number">3</span>));</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">                c[i][j] = a[i][<span class="number">0</span>] * b[<span class="number">0</span>][j] + a[i][<span class="number">1</span>] * b[<span class="number">1</span>][j] + a[i][<span class="number">2</span>] * b[<span class="number">2</span>][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æµ‹äº†ä¸€ä¸‹æ•ˆæœï¼Œå¥½åƒæ•ˆç‡å’Œä½¿ç”¨2.3çš„åŠæ³•æ²¡å•¥åŒºåˆ«ï¼Œé‚£æˆ‘è¿˜æ˜¯ç”¨åŠ¨å½’å§ğŸ˜­</p><p><img src="https://img.musnow.top/i/2023/08/858eede4f1ef9c10b2eb69f2150eae9d.png" alt="image-20230827173941225"></p><p>ä»¥åæœ‰æ—¶é—´äº†å†æ¥çº ç»“è¿™ä¸ªç­”æ¡ˆçš„æ€è·¯</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä»Šå¤©æ˜¯å­¦ä¹ åŠ¨å½’çš„ç¬¬ä¸€å¤©ï¼Œå…ˆæ¥ä¸€é“ç®€å•é¢˜ç»ƒç»ƒæ‰‹å§ï¼&lt;/p&gt;
&lt;h1 id=&quot;1-é¢˜ç›®&quot;&gt;&lt;a href=&quot;#1-é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;1.é¢˜ç›®&quot;&gt;&lt;/a&gt;1.é¢˜ç›®&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;leetcode &lt;a href=</summary>
      
    
    
    
    <category term="æŠŠé¢˜ç›®éƒ½ç»™åˆ·å¹²å‡€" scheme="https://blog.musnow.top/categories/%E6%8A%8A%E9%A2%98%E7%9B%AE%E9%83%BD%E7%BB%99%E5%88%B7%E5%B9%B2%E5%87%80/"/>
    
    
    <category term="C++" scheme="https://blog.musnow.top/tags/C/"/>
    
    <category term="OJåˆ·é¢˜" scheme="https://blog.musnow.top/tags/OJ%E5%88%B7%E9%A2%98/"/>
    
    <category term="leetcode" scheme="https://blog.musnow.top/tags/leetcode/"/>
    
  </entry>
  
  <entry>
    <title>ã€æŠ€æœ¯ã€‘CDN/PCDN/SDNè¯¦è§£</title>
    <link href="https://blog.musnow.top/posts/292924834/"/>
    <id>https://blog.musnow.top/posts/292924834/</id>
    <published>2023-08-27T02:49:28.000Z</published>
    <updated>2023-08-27T02:49:28.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ´å®çš„å­¦ä¹ åŸå› ï¼šäº¬ä¸œå®ä¹ ç”Ÿæ‹›è˜æ¡ç›®ä¸Šå†™äº†è¿™äº›æŠ€æœ¯ï¼Œé‚£å°±ç»™ä»–å­¦äº†ï¼</p><span id="more"></span><blockquote><p>å‚è€ƒ<br><a href="https://blog.csdn.net/baidu_41651554/article/details/122218513">https://blog.csdn.net/baidu_41651554/article/details/122218513</a></p></blockquote><p>å—¨å—¨å—¨ï¼Œç›´æ¥ä¸Šèœï¼</p><h1 id="1-CDN"><a href="#1-CDN" class="headerlink" title="1.CDN"></a>1.CDN</h1><p>CDNçš„å…¨ç¨‹æ˜¯content delivery networkï¼Œå†…å®¹åˆ†å‘ç½‘ç»œï¼›è¯´äººè¯å°±æ˜¯æŠŠç½‘ç«™äº§ç”Ÿçš„å†…å®¹åˆ†å‘åˆ°å„ä¸ªç”¨æˆ·è¯·æ±‚çš„ç½‘ç»œé‡Œå»ï¼Œå…·æœ‰ <strong>åˆ†å¸ƒå¼</strong> ç½‘ç»œçš„ç‰¹ç‚¹ï¼</p><h2 id="1-1-å‰ç½®å£°æ˜"><a href="#1-1-å‰ç½®å£°æ˜" class="headerlink" title="1.1 å‰ç½®å£°æ˜"></a>1.1 å‰ç½®å£°æ˜</h2><p>å½“ä»£ç½‘ç»œå½¢åŠ¿é”™ç»¼å¤æ‚ï¼Œç‰¹åˆ«æ˜¯è§†é¢‘ã€éŸ³é¢‘ç±»ç½‘ç»œæœåŠ¡çš„å…´èµ·ï¼Œç»™äº’è”ç½‘çš„è´·æ¬¾é€ æˆäº†å¾ˆå¤§çš„å‹åŠ›å•Šï¼</p><p>ä»¥ä¹‹å‰å¾ˆç«çš„â€œå»¶ç¦§æ”»ç•¥â€ä¸ºä¾‹ï¼Œå½“æ—¶æ›¾ç»åœ¨æŸè§†é¢‘APPå®ç°äº†1åƒä¸‡ç”¨æˆ·åŒæ—¶åœ¨çº¿è§‚çœ‹ã€‚å¦‚æœå¤§å®¶è§‚çœ‹çš„æ˜¯1080pæ¸…æ™°åº¦çš„è§†é¢‘ï¼ˆç†è®ºä¸Šéœ€è¦4Mbpså¸¦å®½ï¼‰ï¼Œé‚£ä¹ˆï¼Œç´¯è®¡éœ€è¦çš„æµé‡å¸¦å®½æ˜¯<br>$$<br>10,000,000Ã—4Mbps&#x3D;40,000,000Mbps&#x3D;40Tbps<br>$$<br>è¿™ä¸ªæ•°å­—è€ææ€–äº†ï¼å¯¹äºä¼˜é…·ã€çˆ±å¥‡è‰ºè¿™æ ·çš„äº’è”ç½‘è§†é¢‘å†…å®¹æä¾›å•†æ¥è¯´ï¼Œè¿™æ— ç–‘æ˜¯éå¸¸å·¨å¤§çš„æµé‡å‹åŠ›ã€‚</p><p>å¦‚æœæŒ‰æœåŠ¡å™¨ç”¨çš„10Gbpsçš„ä¸‡å…†ç½‘å¡æ¥ç®—ï¼Œé‚£ä¹Ÿéœ€è¦å››åƒå—ä¸‡å…†ç½‘å¡æ‰èƒ½é¡¶å¾—ä½è¿™ä¹ˆå¤§çš„æµé‡æ¶ˆè€—ï¼Œæ›´åˆ«æå‹æ ¹æ²¡æœ‰é‚£ä¹ˆå¤šåœ°æ–¹ç»™ä½ æ’è¿™ä¹ˆå¤šç½‘å¡çš„äº‹æƒ…äº†ï¼›</p><p>æœ‰è¿™ä¹ˆä¸€ä¸ªè¯´æ³•ï¼šå½“ç”¨æˆ·æ‰“å¼€ä¸€ä¸ªé¡µé¢ï¼Œç­‰å¾…è¶…è¿‡4ç§’ï¼Œä»–å°±ä¼šå…³é—­è¿™ä¸ªé¡µé¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªç”¨æˆ·å°±ä¼šæµå¤±ã€‚ç”¨æˆ·æµå¤±å¯¹äºå…¬å¸æ¥è¯´å¯å°±æ˜¯é‡‘é’±æµå¤±ï¼</p><p>æ‰€ä»¥ï¼Œæ²¡æœ‰ä»»ä½•ä¸€å®¶äº’è”ç½‘æœåŠ¡æä¾›å•†åŸå› å› ä¸ºç½‘ç»œçš„é—®é¢˜è€Œæµå¤±å®¢æˆ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—åƒä¸ªåŠæ³•æ¥è§£å†³è¿™ç§æµé‡çŸ­æ—¶é—´æš´å‘çš„é—®é¢˜ï¼</p><p>è€ŒCDNï¼Œå°±æ˜¯ä¸€é¡¹éå¸¸æœ‰æ•ˆçš„<strong>ç¼©çŸ­æ—¶å»¶</strong>çš„æŠ€æœ¯ã€‚</p><h2 id="1-2-æŠ€æœ¯ä¸»ä½“"><a href="#1-2-æŠ€æœ¯ä¸»ä½“" class="headerlink" title="1.2 æŠ€æœ¯ä¸»ä½“"></a>1.2 æŠ€æœ¯ä¸»ä½“</h2><p>CDNç¼©çŸ­ç”¨æˆ·å»¶æ—¶çš„åŠæ³•ä¹Ÿéå¸¸â€œç®€å•â€ï¼Œå…¶å®å°±æ˜¯å°†äº‘æœåŠ¡éƒ¨ç½²åˆ°ç”¨æˆ·èº«è¾¹ã€‚åœ¨è®¿é—®çš„æ—¶å€™ï¼Œæ ¹æ®DNSçš„å¤šçº¿è§£æèƒ½åŠ›ï¼ˆå³ä¸ºä¸åŒåœ°åŒºæä¾›ä¸åŒçš„IPè§£æï¼‰é€‰æ‹©ç¦»ç”¨æˆ·æœ€è¿‘çš„æœåŠ¡å™¨æ¥ä¸ºç”¨æˆ·æä¾›æœåŠ¡ã€‚</p><p><img src="https://img.musnow.top/i/2023/08/1298b6b472d89a0007ac82fb213b1aeb.png" alt="image-20230827105913951"></p><p>å› ä¸ºè¿™æ ·ï¼ŒCDNå°±åœ¨å†…å®¹å±‚é¢ä¸Šè¿›è¡Œäº†ä¸€å®šçš„ç­›é€‰å’Œåˆ†å‘ï¼Œæ‰€ä»¥ä»–å°±å«å†…å®¹åˆ†å‘ç½‘ç»œï¼›</p><p>å…·ä½“æ¥è¯´ï¼ŒCDNå°±æ˜¯é‡‡ç”¨æ›´å¤šçš„ç¼“å­˜æœåŠ¡å™¨ï¼ˆCDNè¾¹ç¼˜èŠ‚ç‚¹ï¼‰ï¼Œå¸ƒæ”¾åœ¨ç”¨æˆ·è®¿é—®ç›¸å¯¹é›†ä¸­çš„åœ°åŒºæˆ–ç½‘ç»œä¸­ã€‚å½“ç”¨æˆ·è®¿é—®ç½‘ç«™æ—¶ï¼Œåˆ©ç”¨å…¨å±€è´Ÿè½½æŠ€æœ¯ï¼Œå°†ç”¨æˆ·çš„è®¿é—®æŒ‡å‘è·ç¦»æœ€è¿‘çš„ç¼“å­˜æœåŠ¡å™¨ä¸Šï¼Œç”±ç¼“å­˜æœåŠ¡å™¨å“åº”ç”¨æˆ·è¯·æ±‚ã€‚ï¼ˆæœ‰ç‚¹åƒç”µå•†çš„æœ¬åœ°ä»“ï¼‰</p><p>å¤§å®¶å¯èƒ½è§‰å¾—ï¼Œè¿™ä¸ªä¸å°±æ˜¯â€œé•œåƒæœåŠ¡å™¨â€å˜›ï¼Ÿå…¶å®ä¸ä¸€æ ·ã€‚é•œåƒæœåŠ¡å™¨æ˜¯æºå†…å®¹æœåŠ¡å™¨çš„å®Œæ•´å¤åˆ¶ã€‚è€ŒCDNï¼Œæ˜¯éƒ¨åˆ†å†…å®¹çš„ç¼“å­˜ï¼Œæ™ºèƒ½ç¨‹åº¦æ›´é«˜ã€‚</p><p>ç¡®åˆ‡åœ°è¯´ï¼Œ<strong>CDN&#x3D;æ›´æ™ºèƒ½çš„é•œåƒ+ç¼“å­˜+æµé‡å¯¼æµ</strong></p><p>è€Œä¸”è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCDNå¹¶ä¸æ˜¯åªèƒ½ç¼“å­˜è§†é¢‘å†…å®¹ï¼Œå®ƒè¿˜å¯ä»¥å¯¹ç½‘ç«™çš„é™æ€èµ„æºï¼ˆä¾‹å¦‚å„ç±»å‹å›¾ç‰‡ã€htmlã€cssã€jsç­‰ï¼‰è¿›è¡Œåˆ†å‘ï¼Œå¯¹ç§»åŠ¨åº”ç”¨APPçš„é™æ€å†…å®¹ï¼ˆä¾‹å¦‚å®‰è£…åŒ…apkæ–‡ä»¶ã€APPå†…çš„å›¾ç‰‡è§†é¢‘ç­‰ï¼‰è¿›è¡Œåˆ†å‘ã€‚</p><p>CDNçš„å…·ä½“å·¥ä½œæµç¨‹ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæŸä¸ªç”¨æˆ·æƒ³è¦è®¿é—®ä¼˜é…·çš„è§†é¢‘ç‚¹æ’­å†…å®¹ï¼Œé‚£ä¹ˆï¼š</p><p><img src="https://img.musnow.top/i/2023/08/8ad3d099d1138c6b02472adeb5a2097c.png" alt="img"></p><p>å…·ä½“æ­¥éª¤å¦‚ä¸‹</p><ol><li>å½“ç”¨æˆ·ç‚¹å‡»å¯¹åº”èµ„æºå†…å®¹ï¼Œåº”ç”¨æ ¹æ®åŸŸååœ°å€åˆ°åº•å±‚è§¦å‘DNSè¯·æ±‚ï¼›</li><li>å…ˆæ˜¯è¯·æ±‚çš„æœ¬åœ°è¿è¥å•†çš„DNSï¼Œå†è½¬å‘åˆ°CDNåŸŸåæœåŠ¡çš„DNSï¼›</li><li>CDNåŸŸåæœåŠ¡çš„DNSä¼šå°†CDNçš„<strong>å…¨å±€å‡è¡¡è´Ÿè½½æœåŠ¡å™¨</strong>çš„IPåœ°å€è¿”å›ç»™ç”¨æˆ·ï¼›</li><li>ç”¨æˆ·å‘CDNçš„è´Ÿè½½å‡è¡¡è®¾å¤‡å‘èµ·URLçš„è®¿é—®è¯·æ±‚ï¼›</li><li>CDNçš„è´Ÿè½½å‡è¡¡è®¾å¤‡æ ¹æ®ç”¨æˆ·IPåœ°å€ï¼Œä»¥åŠç”¨æˆ·è¯·æ±‚çš„å†…å®¹URLï¼Œé€‰æ‹©ä¸€å°ç”¨æˆ·æ‰€å±åŒºåŸŸï¼ˆç¦»ç”¨æˆ·è¶Šè¿‘è¶Šå¥½ï¼‰çš„<strong>ç¼“å­˜æœåŠ¡å™¨</strong>ï¼›</li><li>è´Ÿè½½å‡è¡¡è®¾å¤‡å‘Šè¯‰ç”¨æˆ·è¿™å°ç¼“å­˜æœåŠ¡å™¨çš„IPåœ°å€ï¼Œè®©ç”¨æˆ·å‘æ‰€é€‰æ‹©çš„ç¼“å­˜æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼›</li><li>ç”¨æˆ·å‘ç¼“å­˜æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œç¼“å­˜æœåŠ¡å™¨å“åº”ï¼Œå°†ç”¨æˆ·è¯·æ±‚å†…å®¹å‘é€ç»™ç”¨æˆ·</li><li>å¦‚æœè¿™å°æœåŠ¡å™¨ä¸Šæ²¡æœ‰ç”¨æˆ·æƒ³è¦çš„å†…å®¹ï¼Œé‚£å°±æ ¹æ®CDNè®¾ç½®çš„<strong>å›æºæœåŠ¡å™¨</strong>ï¼ˆåˆç§°æºç«™ï¼‰æ¥è¯·æ±‚è¯¥URL</li><li>ç¼“å­˜æœåŠ¡å™¨ä»<strong>æºç«™</strong>æ‹‰å–å†…å®¹ç¼“å­˜åˆ°æœ¬åœ°ï¼Œå¹¶ä¼ è¾“ç»™ç”¨æˆ·ï¼›å¹¶æ ¹æ®ç”¨æˆ·è®¾ç½®çš„ç¼“å­˜ç­–ç•¥æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ä¿ç•™è¯¥èµ„æºåˆ°æœ¬åœ°ï¼Œæ˜¯åˆ™è¿›è¡Œç¼“å­˜ã€‚</li></ol><p>åœ¨CDNå·¥ä½œçš„æ•´ä¸ªæµç¨‹ä¸­ï¼Œæºç«™çš„æœåŠ¡å™¨IPæ˜¯å¯¹ç”¨æˆ·ä¸å¯è§çš„ï¼›CDNæœåŠ¡åœ¨å®ç°äº†ä¸€å®šçš„èµ„æºè®¿é—®åŠ é€Ÿçš„åŸºç¡€ä¸Šï¼Œè¿˜é™„å¸¦äº†éšè—æºç«™IPçš„åŠŸèƒ½ï¼Œé¿å…æºç«™ç›´æ¥é­å—ç«åŠ›æ‰“å‡»ï¼ˆæŒ‡æœåŠ¡å™¨è¢«æ”»å‡»ï¼‰</p><h2 id="1-3-é™æ€åŠ é€Ÿ"><a href="#1-3-é™æ€åŠ é€Ÿ" class="headerlink" title="1.3 é™æ€åŠ é€Ÿ"></a>1.3 é™æ€åŠ é€Ÿ</h2><p>æ‰€è°“é™æ€åŠ é€Ÿï¼Œæ˜¯åªåŠ é€Ÿæºç«™æ‰€æä¾›æœåŠ¡ä¸­çš„é™æ€èµ„æºï¼ŒåŒ…æ‹¬jsã€htmlã€cssã€å›¾ç‰‡ã€éŸ³è§†é¢‘ç­‰ä¸ä¼šå‡ºç°å˜åŠ¨çš„èµ„æºæ–‡ä»¶ã€‚å°†è¿™äº›èµ„æºåœ¨CDNäº‘æœåŠ¡å™¨å†…è¿›è¡Œç¼“å­˜ï¼Œç”¨æˆ·è®¿é—®é™æ€èµ„æºçš„æ—¶å€™ä»CDNä¼ è¾“ç»™ç”¨æˆ·ï¼Œè®¿é—®aspã€phpã€jspç­‰åŠ¨æ€èµ„æºçš„æ—¶å€™ï¼Œä»æºç«™æŠ“å–ï¼Œæ—¢ä¿è¯äº†æ•°æ®çš„åŠæ—¶æ€§ï¼Œåˆæé«˜äº†é™æ€èµ„æºçš„åŠ è½½é€Ÿåº¦ã€‚</p><p>ç›¸æ¯”äºåŠ¨æ€èµ„æºæ–‡ä»¶ï¼Œé™æ€èµ„æºï¼Œç‰¹åˆ«æ˜¯å›¾ç‰‡ï¼Œæ˜¯è®¿é—®è¿‡ç¨‹ä¸­æ¶ˆè€—æµé‡è¾ƒå¤§çš„éƒ¨åˆ†ï¼›ä½¿ç”¨é™æ€èµ„æºåŠ é€Ÿèƒ½å¤§å¤§å‡è½»æºç«™çš„ç½‘ç»œè´·æ¬¾å’Œèµ„æºè´Ÿè½½çš„å‹åŠ›ï¼Œåˆå‡å°‘äº†ç”¨æˆ·çš„åŠ è½½é€Ÿåº¦ï¼Œä½¿å¾—ç½‘ç»œæœåŠ¡èƒ½æ›´å¿«çš„å±•ç°åœ¨ç”¨æˆ·é¢å‰ï¼›</p><h2 id="1-4-åŠ¨æ€åŠ é€Ÿ"><a href="#1-4-åŠ¨æ€åŠ é€Ÿ" class="headerlink" title="1.4 åŠ¨æ€åŠ é€Ÿ"></a>1.4 åŠ¨æ€åŠ é€Ÿ</h2><p>åŠ¨æ€åŠ é€Ÿæ˜¯æŒ‡CDNçš„DNSè§£æä¸­é€šè¿‡åŠ¨æ€é“¾è·¯æ¢æµ‹ï¼Œç›‘æ§ç½‘ç»œç¯å¢ƒçš„å˜åŒ–ï¼Œç›‘æ§å„åœ°ç½‘ç»œå»¶è¿Ÿï¼Œå¯»æ‰¾åˆ°ä¸€æ¡æœ€<strong>ç¨³å®šã€æœ€é«˜æ•ˆã€æœ€å¿«é€Ÿ</strong>çš„è·¯å¾„ï¼Œå›æºåŠ¨æ€èµ„æºï¼Œä»è€Œå®ç°åŠ¨æ€èµ„æºï¼ˆå¦‚aspã€phpã€jspç­‰ï¼‰åŠ é€Ÿã€‚ç„¶åæ„æˆé“¾è·¯åˆ—è¡¨ï¼Œç»‘å®šåˆ°DNSè§£æä¸Šï¼Œæ›´æ–°åˆ°CDNçš„æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸Šã€‚ç®€å•æ¶æ„è§ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://img.musnow.top/i/2023/08/9b51e87fe04bacbd8591b55e5d62f679.png" alt="img"></p><h2 id="1-5-æ•°æ®èŠ‚ç‚¹çš„æ›´æ–°å’ŒåŒæ­¥"><a href="#1-5-æ•°æ®èŠ‚ç‚¹çš„æ›´æ–°å’ŒåŒæ­¥" class="headerlink" title="1.5 æ•°æ®èŠ‚ç‚¹çš„æ›´æ–°å’ŒåŒæ­¥"></a>1.5 æ•°æ®èŠ‚ç‚¹çš„æ›´æ–°å’ŒåŒæ­¥</h2><p>cdnåˆ†ä¸ºæ¨æ‹‰ä¸¤ç§æ–¹å¼</p><ul><li>æ¨æ˜¯æœåŠ¡å™¨å°†å†…å®¹æ¨åˆ°cdnèŠ‚ç‚¹ä¸Š</li><li>æ‹‰æ˜¯cdnåœ¨ç¬¬ä¸€æ¬¡æ¥å—è¯·æ±‚çš„æ—¶å€™ä»æœåŠ¡å™¨æ‹‰å–èµ„æºè¿›è¡Œå“åº”å¹¶ä¿å­˜</li></ul><p>å½“èµ„æºåœ¨cdnç¼“å­˜ä¹‹åï¼Œå¦‚æœæœåŠ¡å™¨ä¸Šçš„èµ„æºå‘ç”Ÿå˜åŒ–ï¼ŒcdnèŠ‚ç‚¹æ˜¯ä¸ä¼šçŸ¥é“çš„ï¼Œé™¤éç¼“å­˜æ—¶é—´åˆ°æœŸé‡æ–°æ‹‰å–æˆ–è€…ä¿®æ”¹æ–°èµ„æºçš„è®¿é—®ã€‚</p><p>åŠ¨æ€èµ„æºçš„è¯ï¼Œä¸€èˆ¬éƒ½æ˜¯æ— å»¶è¿Ÿçš„ã€‚é™æ€å¯¹äº css å’Œ js æ¥è¯´ï¼Œå»ºè®®åœ¨ç¼–è¯‘ç”Ÿæˆçš„é˜¶æ®µï¼Œä¸ºæ–‡ä»¶ååŠ ä¸Šæ—¶é—´æˆ³ã€‚è€Œä¸”æœ€å¥½æ˜¯åœ¨æ–‡ä»¶åé‡Œé¢ï¼Œè€Œä¸æ˜¯ querystring é‡Œé¢åŠ ã€‚è¿™æ˜¯æœ€æ–¹ä¾¿çš„æ–¹æ¡ˆï¼Œå› ä¸ºä¸€æ—¦å‘ç”Ÿäº†æ›´æ–°ï¼Œæ¯æ¬¡å»å–çš„ä¸€å®šæ˜¯æ–°æ–‡ä»¶ï¼Œä¸æ¶‰åŠç¼“å­˜åˆ·æ–°çš„é—®é¢˜ã€‚</p><h2 id="1-6-CDNçš„å¥½å¤„"><a href="#1-6-CDNçš„å¥½å¤„" class="headerlink" title="1.6 CDNçš„å¥½å¤„"></a>1.6 CDNçš„å¥½å¤„</h2><h3 id="1-6-1-å¯¹æœåŠ¡å•†"><a href="#1-6-1-å¯¹æœåŠ¡å•†" class="headerlink" title="1.6.1 å¯¹æœåŠ¡å•†"></a>1.6.1 å¯¹æœåŠ¡å•†</h3><p>é‡‡ç”¨CDNæŠ€æœ¯ï¼Œæœ€å¤§çš„å¥½å¤„ï¼Œå°±æ˜¯åŠ é€Ÿäº†ç½‘ç«™çš„è®¿é—®â€”â€”ç”¨æˆ·ä¸å†…å®¹ä¹‹é—´çš„ç‰©ç†è·ç¦»ç¼©çŸ­ï¼Œç”¨æˆ·çš„ç­‰å¾…æ—¶é—´ä¹Ÿå¾—ä»¥ç¼©çŸ­ã€‚</p><p>è€Œä¸”ï¼Œåˆ†å‘è‡³ä¸åŒçº¿è·¯çš„ç¼“å­˜æœåŠ¡å™¨ï¼Œä¹Ÿè®©<strong>è·¨è¿è¥å•†</strong>ä¹‹é—´çš„è®¿é—®å¾—ä»¥åŠ é€Ÿã€‚ä¾‹å¦‚ä¸­å›½ç§»åŠ¨æ‰‹æœºç”¨æˆ·è®¿é—®ä¸­å›½ç”µä¿¡ç½‘ç»œçš„å†…å®¹æºï¼Œå¯ä»¥é€šè¿‡åœ¨ä¸­å›½ç§»åŠ¨å‡è®¾CDNæœåŠ¡å™¨ï¼Œè¿›è¡ŒåŠ é€Ÿã€‚æ•ˆæœæ˜¯éå¸¸æ˜æ˜¾çš„ã€‚</p><p>æ­¤å¤–ï¼ŒCDNè¿˜æœ‰å®‰å…¨æ–¹é¢çš„å¥½å¤„ã€‚å†…å®¹è¿›è¡Œåˆ†å‘åï¼Œ<strong>æºæœåŠ¡å™¨çš„IPè¢«éšè—</strong>ï¼Œå—åˆ°æ”»å‡»çš„æ¦‚ç‡ä¼šå¤§å¹…ä¸‹é™ã€‚è€Œä¸”ï¼Œå½“æŸä¸ªæœåŠ¡å™¨æ•…éšœæ—¶ï¼Œç³»ç»Ÿä¼šè°ƒç”¨ä¸´è¿‘çš„å¥åº·æœåŠ¡å™¨ï¼Œè¿›è¡ŒæœåŠ¡ï¼Œé¿å…å¯¹ç”¨æˆ·é€ æˆå½±å“ã€‚</p><p>æ­£å› ä¸ºCDNçš„å¥½å¤„å¾ˆå¤šï¼Œæ‰€ä»¥ï¼Œç›®å‰æ‰€æœ‰ä¸»æµçš„äº’è”ç½‘æœåŠ¡æä¾›å•†ï¼Œéƒ½é‡‡ç”¨äº†CDNæŠ€æœ¯ã€‚æ‰€æœ‰çš„äº‘æœåŠ¡æä¾›å•†ï¼Œä¹Ÿéƒ½æä¾›äº†CDNæœåŠ¡ï¼ˆä»·æ ¼ï¼ŒæŒ‰æµé‡è®¡è´¹ï¼‰</p><h3 id="1-6-2-å¯¹é€šä¿¡è¡Œä¸š"><a href="#1-6-2-å¯¹é€šä¿¡è¡Œä¸š" class="headerlink" title="1.6.2 å¯¹é€šä¿¡è¡Œä¸š"></a>1.6.2 å¯¹é€šä¿¡è¡Œä¸š</h3><ul><li><strong>äº’è”ç½‘æœåŠ¡æä¾›å•†</strong>é‡‡ç”¨CDNï¼Œæ˜¯ä»¥å­˜å‚¨æ¢æ—¶å»¶ã€‚èŠ±é’±è´­ç½®CDNæœåŠ¡å™¨æˆ–äº‘è®¡ç®—æœåŠ¡ï¼Œä»¥æ­¤æ¢å–æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚</li><li><strong>é€šä¿¡è¿è¥å•†</strong>ä¹Ÿè¿½æ§CDNï¼Œä½†å®ƒä»¬çš„ç›®çš„ï¼Œæ˜¯ä»¥å­˜å‚¨æ¢å¸¦å®½ â€”â€”é€šè¿‡æœåŠ¡â€œä¸‹æ²‰â€ï¼Œå‡è½»ä¸Šå±‚éª¨å¹²ç½‘ç»œçš„æµé‡å‹åŠ›ï¼Œé¿å…ç¡¬ä»¶æ‰©å®¹ï¼Œé™ä½ç½‘ç»œå»ºè®¾æˆæœ¬ã€‚</li></ul><p>ä»¥ä¸Šæ–‡æåˆ°çš„çˆ±å¥‡è‰ºçœ‹è§†é¢‘çš„é«˜å¸¦å®½é—®é¢˜ä¸ºä¾‹ï¼Œå¦‚æœä¸é‡‡ç”¨CDNï¼Œé‚£å°±æ˜¯å·¨å¤§çš„æµé‡æµå…¥åŒä¸€ä¸ªæœºæˆ¿ï¼Œè¿™ä¼šå¯¼è‡´è¿™ä¸ªæœºæˆ¿å…¥ç½‘&#x2F;å‡ºç½‘çš„çº¿è·¯è¢«æ‹¥å¡ï¼Œå½±å“å…¶ä»–ä¸šåŠ¡çš„è¿›è¡Œï¼</p><p>åŒæ ·çš„ï¼Œå¦‚æœå¤§é‡çš„ä¸šåŠ¡æµé‡æ•°æ®åœ¨éª¨å¹²ç½‘è·‘æ¥è·‘å»ï¼Œ<strong>éª¨å¹²ç½‘è‚¯å®šåƒä¸æ¶ˆï¼Œè¦æ‹¼å‘½æ‰©å®¹</strong>ã€‚å¦‚æœè¿™äº›ä¸šåŠ¡æµé‡æ•°æ®åœ¨åº•å±‚å°±è¢«è§£å†³äº†ï¼Œé‚£ä¹ˆï¼Œéª¨å¹²ç½‘çš„å¸¦å®½å‹åŠ›è‡ªç„¶å°±å‡è½»äº†ã€‚</p><p>å¾ˆå¤šè¿è¥å•†å·²ç»å°†CDNä¸‹æ²‰åˆ°åœ°å¸‚çº§ï¼Œä»¥æ­¤å‡è½»å‹åŠ›ï¼ŒåŒæ—¶å¯ä»¥æå‡ç”¨æˆ·ä½“éªŒï¼å¯è°“æ˜¯ä¸€ä¸¾ä¸¤å¾—çš„ç¾äº‹ï¼</p><p><img src="https://img.musnow.top/i/2023/08/9806e61f7d240e45b2701d25668935e7.png" alt="img"></p><h1 id="2-PCDN"><a href="#2-PCDN" class="headerlink" title="2.PCDN"></a>2.PCDN</h1><p>PCDNæŠ€æœ¯æ˜¯P2PæŠ€æœ¯+CDNæŠ€æœ¯çš„é›†å’Œï¼Œåœ¨è®¤è¯†PCDNä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè¦ç®€å•äº†è§£ä¸€ä¸‹P2PæŠ€æœ¯</p><h2 id="2-1-P2P"><a href="#2-1-P2P" class="headerlink" title="2.1 P2P"></a>2.1 P2P</h2><p>P2På³<code>Peer to Peer</code>ï¼Œçº¯P2Pæ¶æ„åŒ…å«å¦‚ä¸‹å†…å®¹</p><ul><li>æ²¡æœ‰æ€»æ˜¯åœ¨çº¿çš„æœåŠ¡å™¨</li><li>ä»»æ„ç«¯ä¹‹é—´ç›´æ¥é€šä¿¡</li><li>å¯¹ç­‰æ”¾ä¹‹é—´å¯ä»¥é—´æ–­é“¾æ¥ï¼Œå¹¶å¯ä»¥åŠ¨æ€æ”¹å˜IPåœ°å€</li></ul><p>å®é™…çš„ç”¨ä¾‹å¦‚ä¸‹</p><ul><li>æ–‡ä»¶åˆ†å‘ï¼ˆBTä¸‹è½½ï¼‰</li><li>æµåª’ä½“</li><li>VolP</li><li>å†…ç½‘ç©¿é€å¼è®¿é—®ï¼ˆå»ºç«‹P2Pé“¾æ¥ï¼Œç›´æ¥å’Œå†…ç½‘ä¸»æœºé€šä¿¡ï¼‰</li></ul><p><img src="https://img.musnow.top/i/2023/08/ebc51e20db9f5b31b0067fead78826ae.png" alt="image"></p><p>å…³äºP2Pæƒ³äº†è§£æ›´å¤šä¿¡æ¯å¯ä»¥æŸ¥çœ‹æ­¤æ–‡ï¼š<a href="https://cloud.tencent.com/developer/article/2095486">è¯¦è§£P2PæŠ€æœ¯</a></p><h2 id="2-2-PCDN"><a href="#2-2-PCDN" class="headerlink" title="2.2 PCDN"></a>2.2 PCDN</h2><h3 id="2-2-1-æµç¨‹"><a href="#2-2-1-æµç¨‹" class="headerlink" title="2.2.1 æµç¨‹"></a>2.2.1 æµç¨‹</h3><p>å‰é¢æåˆ°äº†ï¼ŒPCDNæ˜¯P2P+CDNï¼Œé‚£ä¹ˆå…¶æ˜¯å¦‚ä½•å°†P2PæŠ€æœ¯å’ŒCDNç»“åˆèµ·æ¥çš„å‘¢ï¼Ÿ</p><p>åœ¨é˜¿é‡Œäº‘å®˜ç½‘ä¸Šå¯ä»¥çœ‹åˆ°å¯¹PCDNçš„ä»‹ç»ï¼š<a href="https://developer.aliyun.com/article/130907">ä¸€ç¯‡æ–‡ç« è§£è¯»æé€Ÿã€é™è´¹é»‘ç§‘æŠ€ï¼šPCDNå®šä¹‰ã€åŠŸèƒ½ã€æ¶æ„ã€åœºæ™¯å’Œä¼˜åŠ¿</a>ï¼›æœ¬æ–‡æ˜¯å¯¹è¿™ç¯‡æ–‡ç« çš„ä¸ªäººç†è§£ã€‚</p><blockquote><p>PCDNäº§å“æ˜¯ä¸ä¼ ç»ŸCDNäº’è¡¥åä½œçš„å…³ç³»ï¼Œä»¥P2PæŠ€æœ¯ä¸ºæ ¸å¿ƒçš„åˆ†å¸ƒå¼PCDNç³»ç»Ÿå¯ä¸ä¼ ç»ŸCDNã€äº‘CDNæ— ç¼é›†æˆï¼Œå½¢æˆäº’è¡¥åä½œï¼Œç›¸å¯¹äºCDNæ‹¥æœ‰æˆæœ¬æ›´ä½ã€è´¨é‡æ›´å¥½ä¸¤æ–¹é¢çš„æ ¸å¿ƒä¼˜åŠ¿ã€‚</p></blockquote><p>P2P å†…å®¹åˆ†å‘ç½‘ç»œï¼ˆè‹±æ–‡åï¼šP2P CDNï¼Œä»¥ä¸‹ç®€ç§°PCDNï¼‰æ˜¯ä»¥P2PæŠ€æœ¯ä¸ºåŸºç¡€ï¼Œé€šè¿‡æŒ–æ˜åˆ©ç”¨è¾¹ç¼˜ç½‘ç»œæµ·é‡ç¢ç‰‡åŒ–é—²ç½®èµ„æºè€Œæ„å»ºçš„ä½æˆæœ¬é«˜å“è´¨å†…å®¹åˆ†å‘ç½‘ç»œæœåŠ¡ã€‚ä½ å¯ä»¥é€šè¿‡é›†æˆPCDN SDKï¼ˆä»¥ä¸‹ç®€ç§°SDKï¼‰æ¥å…¥è¯¥æœåŠ¡åèƒ½è·å¾—ç­‰åŒï¼ˆæˆ–ç•¥é«˜äºï¼‰CDNçš„åˆ†å‘è´¨é‡ï¼ŒåŒæ—¶æ˜¾è‘—é™ä½åˆ†å‘æˆæœ¬ã€‚é€‚ç”¨äº<strong>è§†é¢‘ç‚¹æ’­ã€ç›´æ’­ã€å¤§æ–‡ä»¶ä¸‹è½½</strong>ç­‰ä¸šåŠ¡åœºæ™¯ã€‚</p><p>ä½¿ç”¨PCDNåçš„httpè¯·æ±‚å¤„ç†æµç¨‹å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://img.musnow.top/i/2023/08/d2bba1440e3c9b80ec949459fd8617a8.png" alt="image-20230827133437729"></p><p>P2Pçš„åŠ å…¥ï¼Œå°±æ˜¯å°†ä¸€äº›æ•°æ®<strong>é¢„å…ˆç•™å­˜åœ¨éƒ¨åˆ†ç»ˆç«¯è®¾å¤‡</strong>ï¼ˆæ¯”å¦‚å®¶ç”¨è·¯ç”±å™¨ï¼Œä¸ªäººç”µè„‘ï¼Œä¸ªäººNASï¼‰ç­‰äº§å“ä¸Šï¼Œå†é€šè¿‡P2PæŠ€æœ¯ï¼Œä»è¿™äº›Peeråšç§ç«¯è·å–åˆ°ä¸€éƒ¨åˆ†æ•°æ®ï¼Œä»¥æ­¤ä¸ºå‘¨è¾¹ç”¨æˆ·æä¾›æœåŠ¡ã€‚</p><p>ä½¿ç”¨PCDNçš„SDKåï¼Œåœ¨è¯·æ±‚DNSä¹‹åï¼Œè¿˜ä¼šå»è¯·æ±‚<strong>PCDNçš„è°ƒåº¦ç³»ç»Ÿ</strong>ï¼ŒPCDNåŒæ—¶ä¼šè¿”å›å¯ç”¨çš„CDNæœåŠ¡å™¨ï¼Œå’Œå¯ç”¨çš„P2Påšç§ç«¯ï¼Œç”¨æˆ·èƒ½åŒæ—¶ä»<strong>å¤šç«¯</strong>è·å–åˆ°æ•°æ®ï¼ˆæ ¹æ®æ–‡ä»¶åˆ†å—ï¼Œä»ä¸åŒåœ°æ–¹è·å–åŒä¸€æ–‡ä»¶ä¸åŒåˆ†å—çš„æ•°æ®ï¼Œæé«˜æ–‡ä»¶ä¸‹è½½é€Ÿåº¦ï¼‰</p><p>æ¯”å¦‚ä¸€ä¸ªæ–‡ä»¶æœ‰1MBï¼Œé‚£ä¹ˆä½¿ç”¨PCDNï¼Œæˆ‘ä»¬å¯èƒ½æœåŠ¡å•†çš„ä»<strong>CDNæœåŠ¡å™¨</strong>æ‹‰å–äº†500KBï¼Œå†ä»ä¸Šå›¾ä¸­æ‰€ç¤ºçš„ä¸¤ä¸ªpeeridç«¯è·å–åˆ°äº†500KBæ•°æ®ï¼›å› ä¸ºä½¿ç”¨çš„æ˜¯ä¸ªäººçš„peerç»ˆç«¯èŠ‚ç‚¹ï¼Œä¸ä»…æ•°é‡å¤šï¼Œ<strong>ä¸”åˆ†å¸ƒæ¯”CDNæœåŠ¡å™¨æ›´å¹¿</strong>ï¼Œç†è®ºä¸Šæ¥è¯´è‡³å°‘èƒ½è·å¾—<strong>ç­‰åŒäº</strong>ä»…ä½¿ç”¨CDNæŠ€æœ¯çš„é€Ÿåº¦ä¼˜åŠ¿ï¼Œå¦‚æœç”¨æˆ·å¯ä»¥è¿æ¥åˆ°çš„peerè¾ƒå¤šï¼Œåˆ™é€Ÿåº¦å°±ä¼š<strong>å¤§äº</strong>ä»…ä½¿ç”¨CDNæŠ€æœ¯ï¼</p><p>è€Œè¿™äº›ä½œä¸ºpeerçš„åšç§ç«¯ï¼Œä¼šå®šæœŸä»CDNç¼“å­˜ä¸€éƒ¨åˆ†çƒ­é—¨æ•°æ®åˆ°æœ¬åœ°ï¼Œå¹¶ä¸ºå…¶ä»–ä¸è‡ªå·±å»ºç«‹P2Pé“¾æ¥çš„ç»ˆç«¯æä¾›æœåŠ¡ã€‚</p><blockquote><p>äº¬ä¸œäº‘è·¯ç”±å™¨ã€è¿…é›·çš„ç½‘å¿ƒäº‘ã€ç™¾åº¦äº‘ç›˜PCå®¢æˆ·ç«¯çš„é—²æ—¶å¸¦å®½ä¸Šä¼ ç­–ç•¥ï¼Œå…¶å®éƒ½æ˜¯ä½¿ç”¨äº†PCDNæŠ€æœ¯çš„ç»ˆç«¯äº§å“ï¼Œå…¶ä¼šåœ¨å ç”¨ä¸€å°éƒ¨åˆ†ç”¨æˆ·å¸¦å®½çš„åŸºç¡€ä¸Šï¼Œç»™ç”¨æˆ·æä¾›äº¬è±†&#x2F;ç°é‡‘å¥–åŠ±ï¼›ä½†æ˜¯PCDNä¼¼ä¹å’Œè¿è¥å•†çš„æ”¿ç­–å†²çªï¼Œå…·ä½“çš„å°±ä¸äº†è§£äº†ï¼Œæœ¬æ–‡åªæ˜¯æ¥å­¦ä¹ æŠ€æœ¯çš„ã€‚</p></blockquote><h3 id="2-2-2-ä¼˜ç‚¹"><a href="#2-2-2-ä¼˜ç‚¹" class="headerlink" title="2.2.2 ä¼˜ç‚¹"></a>2.2.2 ä¼˜ç‚¹</h3><p>ä»¥ä¸‹ä¼˜ç‚¹æ¥è‡ªé˜¿é‡Œäº‘é‚£ç¯‡æ–‡ç« </p><ul><li><p>ä»·æ ¼ä½ï¼šé€šè¿‡P2PæŠ€æœ¯å¯ä¸ºå®¢æˆ·æä¾›æ›´ä½æˆæœ¬çš„å†…å®¹åˆ†å‘æœåŠ¡ï¼Œï¼ˆä»¥å³°å€¼å¸¦å®½è®¡ä»·ï¼‰ä¸ºäº‘CDNä»·æ ¼çš„1&#x2F;2ï¼Œä¸ºä¼ ç»ŸCDNä»·æ ¼çš„1&#x2F;4ï¼Œå¯æ˜¾è‘—é™ä½å®¢æˆ·çš„åˆ†å‘æˆæœ¬ï¼›</p><p>å› ä¸ºä½¿ç”¨äº†æ›´å¤šP2PèŠ‚ç‚¹ï¼Œå‡è½»äº†CDNæœåŠ¡å™¨ã€æºç«™æœåŠ¡å™¨çš„ç½‘ç»œå¸¦å®½å‹åŠ›ï¼Œæ‰€ä»¥PCDNèƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šèµ·åˆ°é™æœ¬å¢æ•ˆçš„ä½œç”¨ã€‚</p></li><li><p>è´¨é‡å¥½ï¼šé€šè¿‡CDN+P2På¤šçº§èŠ‚ç‚¹è°ƒåº¦ï¼Œä¸€ä¸ªè¯·æ±‚å¯ç”±CDNå’Œå¤šä¸ªP2PæºåŒæ—¶æä¾›å†…å®¹ï¼Œé€šè¿‡èµ„æºå†—ä½™æé«˜äº†æœåŠ¡å¯ç”¨æ€§ï¼Œæ’­æ”¾æµç•…ç‡é«˜äºçº¯CDNï¼Œåœ¨å¤§æ–‡ä»¶ä¸‹è½½åœºæ™¯ä¸­æ›´æ˜¯èƒ½æå¤§æé«˜ä¸‹è½½é€Ÿåº¦ï¼›é€šè¿‡è°ƒç”¨æµ·é‡åˆ†å¸ƒå¼P2PèŠ‚ç‚¹ï¼Œ å¹³å‡æ’­æ”¾æµç•…ç‡ &gt; 97%ï¼Œå¹³å‡é¦–æ’­æ—¶é—´å°äº1ç§’ï¼Œç”¨æˆ·ä½“éªŒå¾—åˆ°æœ‰æ•ˆæå‡ã€‚</p></li><li><p>æˆç†Ÿç¨³å®šï¼šå¤šå¹´ä¸ºä¼˜é…·åœŸè±†æä¾›ä¼˜è´¨çš„è§†é¢‘æ’­æ”¾ã€ä¸‹è½½ç­‰åŠ é€ŸæœåŠ¡ï¼Œæ¥å…¥å¸¦å®½è¶…10Tï¼Œç»å†äº†æµ·é‡ç”¨æˆ·è§„æ¨¡çš„<strong>é•¿æ—¶é—´éªŒè¯</strong>ã€‚æ‹¥æœ‰å†…ç½‘ç©¿é€ã€ç¼“å­˜å¤„ç†ã€ç§å­ç®¡ç†ã€ä¼ è¾“ç­–ç•¥ç­‰å„æ–¹é¢çš„æ ¸å¿ƒæŠ€æœ¯å’Œä¸“åˆ©ï¼›ï¼ˆè¿™æ˜¯é˜¿é‡Œäº‘ç»™è‡ªå·±æ‰“çš„å¹¿å‘Šï¼‰</p></li></ul><p><img src="https://img.musnow.top/i/2023/08/16fb75b6c4dae42f968da0e5510cd069.png" alt="image-20230827135320425"></p><h2 id="2-3-å¸¸è§åè¯"><a href="#2-3-å¸¸è§åè¯" class="headerlink" title="2.3 å¸¸è§åè¯"></a>2.3 å¸¸è§åè¯</h2><p>ä»¥ä¸‹æ˜¯PCDNä¸­å¸¸è§çš„åè¯ï¼›è¿™é‡Œé¢æ¼äº†çš„ä¸€çº§èŠ‚ç‚¹æŒ‡çš„åº”è¯¥æ˜¯CDNæœåŠ¡å™¨ï¼›</p><p><img src="https://img.musnow.top/i/2023/08/121f5a17dd247d2ba0cd17676bf53139.png" alt="image-20230827134515066"></p><p>ç”±æ­¤å¯è§ï¼Œä¸Šæ–‡æåˆ°çš„äº¬ä¸œäº‘è·¯ç”±å™¨ã€è¿…é›·çš„ç½‘å¿ƒäº‘ï¼Œè¿™äº›å®¢æˆ·ç«¯åœ¨ç”¨æˆ·çš„ç”µè„‘å¯åŠ¨åï¼Œå…¶å°±æ˜¯ä½œä¸ºPCDNçš„<strong>ä¸‰çº§èŠ‚ç‚¹</strong>æ¥å…¥æ•´ä¸ªPCDNçš„ç½‘ç»œçš„ï¼Œå…¶æä¾›çš„ä¹Ÿæ˜¯ä¸‰çº§å¸¦å®½ï¼›</p><h2 id="2-4-åŸºç¡€æ¶æ„"><a href="#2-4-åŸºç¡€æ¶æ„" class="headerlink" title="2.4 åŸºç¡€æ¶æ„"></a>2.4 åŸºç¡€æ¶æ„</h2><p>å…³é”®ç»„ä»¶</p><ul><li>indexæœåŠ¡ï¼šå…¨å±€è°ƒåº¦ï¼ŒæŠŠç”¨æˆ·è¯·æ±‚è°ƒåº¦åˆ°æœ€ä½³çš„æœºæˆ¿</li><li>ZooKeeper (Global&amp;Local)ï¼šæœåŠ¡æ´»åŠ¨æƒ…å†µæ±‡æŠ¥ç»™è°ƒåº¦æœåŠ¡ï¼ŒåŠ¨æ€é…ç½®æ›´æ–°</li><li>Nignx Proxyï¼šæ”¯æŒç§æœ‰åè®®çš„Nginxä»£ç†æœåŠ¡ï¼Œé’ˆå¯¹ä¸åŒæ–‡ä»¶ä¸€è‡´æ€§Hashåˆ°ä¸åŒçš„ChannelæœåŠ¡</li><li>ChannelæœåŠ¡ï¼šè®°å½•æ–‡ä»¶å’Œæ‹¥æœ‰æ–‡ä»¶çš„ç«¯ç‚¹åœ°å€ä¿¡æ¯ï¼Œä¸ºä¸‹è½½æä¾›å°±è¿‘çš„ç«¯ç‚¹åœ°å€</li><li>RealyæœåŠ¡ï¼šæœåŠ¡P2På»ºç«‹è¿æ¥å’Œé€šè®¯</li><li>HotæœåŠ¡ï¼šhotæ–‡ä»¶å‘ç°å’Œæ¨é€</li></ul><p>ä»¥ä¸‹æ˜¯PCDNæŠ€æœ¯çš„æ¶æ„å›¾</p><p><img src="https://img.musnow.top/i/2023/08/459dd3bd580e337a248093066360ca91.png" alt="image-20230827135429913"></p><p>æ•´ä¸ªæŠ€æœ¯çš„æµç¨‹åœ¨ä¸Šæ–‡å·²ç»è®²è§£è¿‡äº†ã€‚è¿™é‡Œçš„æ¶æ„å›¾é˜¿é‡Œäº‘çš„æ–‡ç« å¹¶æ²¡æœ‰æä¾›æ›´å¤šçš„è¯´æ˜ï¼Œå…·ä½“çš„å°±å¾—åœ¨çœŸæ­£éœ€è¦å¼€å‘PCDNçš„æ—¶å€™åœ¨å…¬å¸å†…éƒ¨æ·±å…¥å­¦ä¹ äº†ã€‚</p><h2 id="2-5-é€‚ç”¨èŒƒå›´"><a href="#2-5-é€‚ç”¨èŒƒå›´" class="headerlink" title="2.5 é€‚ç”¨èŒƒå›´"></a>2.5 é€‚ç”¨èŒƒå›´</h2><p>PCDNäº§å“é€‚ç”¨äºè§†é¢‘ç‚¹æ’­ã€ç›´æ’­ã€å¤§æ–‡ä»¶ä¸‹è½½ç­‰ä¸šåŠ¡é¢†åŸŸã€‚</p><ul><li>è§†é¢‘ç‚¹æ’­ï¼šé•¿è§†é¢‘ç‚¹æ’­ï¼Œçƒ­åº¦é›†ä¸­çš„çŸ­è§†é¢‘ç‚¹æ’­ã€‚</li><li>è§†é¢‘ç›´æ’­ï¼šå¤§å‹æ™šä¼šèµ›äº‹ç›´æ’­ã€åœ°æ–¹ç½‘å°ç›´æ’­ã€ç§€åœºäº’åŠ¨ç›´æ’­ã€‚</li><li>å¤§æ–‡ä»¶ä¸‹è½½ï¼šè¶…è¿‡1MBä¸”çƒ­åº¦é›†ä¸­çš„çš„æ–‡ä»¶åˆ†å‘ï¼Œå¦‚åº”ç”¨å¸‚åœºåˆ†å‘ã€åœ¨çº¿éŸ³é¢‘åˆ†å‘ã€‚</li></ul><h1 id="3-SDN"><a href="#3-SDN" class="headerlink" title="3.SDN"></a>3.SDN</h1><p>SDNå…¨ç§°<code>Software Defined Network</code>ï¼Œæ¦‚å¿µæœ€æ—©ç”±æ–¯å¦ç¦å¤§å­¦çš„<code>Nick McKeown</code>æ•™æˆäº2009å¹´æå‡ºï¼›è°·æ­Œäº2010åˆ°2012å¹´å»ºç«‹çš„æ•°æ®ä¸­å¿ƒç½‘ç»œB4æ˜¯SDNçš„æˆåŠŸæ¡ˆä¾‹ï¼›</p><p>è¯¥æŠ€æœ¯å­¦ä¹ äºbç«™<a href="https://www.bilibili.com/video/BV15L411E7eE/?share_source=copy_web&vd_source=7fc715db968d24a91828ac8fad0e1ad8">ã€408 è®¡ç®—æœºç½‘ç»œæ–°å¢è€ƒç‚¹â€”è½¯ä»¶å®šä¹‰ç½‘ç»œSDNï¼ˆå­—å¹•ç‰ˆï¼‰ã€‘</a></p><h2 id="3-1-çœ‹çœ‹è·¯ç”±å™¨çš„åŠŸèƒ½"><a href="#3-1-çœ‹çœ‹è·¯ç”±å™¨çš„åŠŸèƒ½" class="headerlink" title="3.1 çœ‹çœ‹è·¯ç”±å™¨çš„åŠŸèƒ½"></a>3.1 çœ‹çœ‹è·¯ç”±å™¨çš„åŠŸèƒ½</h2><p>è·¯ç”±å™¨å…·å¤‡å¦‚ä¸‹åŠŸèƒ½</p><ul><li>æŠ¥æ–‡è½¬å‘</li><li>è·¯ç”±é€‰æ‹©</li></ul><p>åœ¨å½“å‰çš„è·¯ç”±å™¨æ¶æ„ä¸­ï¼Œåˆ†ä¸ºæ•°æ®å±‚é¢å’Œæ§åˆ¶å±‚é¢ã€‚</p><ul><li>ä¸ºäº†æ„å»ºå‡ºè‡ªå·±çš„è·¯ç”±è¡¨ï¼Œè·¯ç”±å™¨å¿…é¡»è¦å’Œå‘¨è¾¹çš„å…¶ä»–è·¯ç”±å™¨å®šæœŸé€šä¿¡ï¼Œæ‰èƒ½é€šè¿‡è‡ªå·±çš„è·¯ç”±ç®—æ³•è®¾ç½®å‡ºè·¯ç”±è¡¨ï¼Œå¹¶é€‰æ‹©æ­£ç¡®çš„è·¯ç”±è·¯å¾„ï¼ˆè¿™ä¸ªè€—æ—¶è¾ƒé•¿ï¼‰</li><li>åœ¨æ•°æ®å±‚é¢ï¼Œè·¯ç”±å™¨é‡‡ç”¨ç¡¬ä»¶ï¼ŒæŸ¥è¡¨è¿›è¡Œè½¬å‘ï¼ˆè€—æ—¶ä½ï¼‰</li></ul><p><img src="https://img.musnow.top/i/2023/08/f7ec770dd37e6f4a19c73cd9133cdf90.png" alt="image-20230827143545493"></p><blockquote><p><strong>åˆ†ç»„</strong>æ˜¯ç½‘ç»œä¸“æœ‰åè¯ã€‚å¤§å¤šæ•°<a href="https://baike.baidu.com/item/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/18763?fromModule=lemma_inlink">è®¡ç®—æœºç½‘ç»œ</a>éƒ½ä¸èƒ½è¿ç»­åœ°ä¼ é€ä»»æ„é•¿çš„æ•°æ®ï¼Œæ‰€ä»¥å®é™…ä¸Šç½‘ç»œç³»ç»ŸæŠŠ<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%88%86%E5%89%B2/4395664?fromModule=lemma_inlink">æ•°æ®åˆ†å‰²</a>æˆå°å—ï¼Œç„¶åé€å—åœ°å‘é€ï¼Œè¿™ç§å°å—å°±ç§°ä½œåˆ†ç»„ï¼ˆpacketï¼‰ã€‚ä¹Ÿæœ‰äº›ä¹¦ç±æŠŠåˆ†ç»„å®šä¹‰ä¸ºç½‘ç»œå±‚çš„<a href="https://baike.baidu.com/item/%E5%8D%8F%E8%AE%AE%E6%95%B0%E6%8D%AE%E5%8D%95%E5%85%83/8226389?fromModule=lemma_inlink">åè®®æ•°æ®å•å…ƒ</a>ã€‚</p><p>è¯´ç™½äº†åˆ†ç»„å°±æ˜¯ä¸€ä¸ªæŠ¥æ–‡ï¼</p></blockquote><h2 id="3-2-SDNæ ¸å¿ƒæ€æƒ³"><a href="#3-2-SDNæ ¸å¿ƒæ€æƒ³" class="headerlink" title="3.2 SDNæ ¸å¿ƒæ€æƒ³"></a>3.2 SDNæ ¸å¿ƒæ€æƒ³</h2><blockquote><p>SDNè¿™ç§æ–°å‹<strong>ç½‘ç»œä½“ç³»ç»“æ„</strong>çš„æ ¸å¿ƒæ€æƒ³ï¼Œæ˜¯å°†ç½‘ç»œçš„æ§åˆ¶å±‚å’Œæ•°æ®å±‚é¢ç»ç’ƒï¼Œè®©æ§åˆ¶å±‚å¯ä»¥é€šè¿‡è½¯ä»¶æ¥æ§åˆ¶æ•°æ®å±‚çš„è¾ƒå¤šè®¾å¤‡</p></blockquote><p>åœ¨SDNä½“ç³»ä¸­ï¼Œè·¯ç”±å™¨çš„è·¯ç”±è½¯ä»¶è¢«å‰¥ç¦»å¼€ï¼Œè·¯ç”±å™¨ä¹‹é—´ä¹Ÿä¸å†éœ€è¦äº¤æ¢è·¯ç”±ä¿¡æ¯ã€‚</p><ul><li>æ§åˆ¶å±‚é¢ï¼šæœ‰ä¸€ä¸ªé€»è¾‘ä¸Šé›†ä¸­çš„è¿œç¨‹æ§åˆ¶å™¨ï¼Œå¯¹å¤šä¸ªäº¤æ¢æœºè¿›è¡Œæ§åˆ¶ï¼›è¯¥è¿œç¨‹æ§åˆ¶å™¨å¯ä»¥ç”±å¤šå°ç‰©ç†ä¸»æœºç»„æˆ</li></ul><p>è¿œç¨‹æ§åˆ¶å™¨ä¼šæŒæ¡å„ä¸ªä¸»æœºå’Œæ•´ä¸ªç½‘ç»œä½“ç³»çš„çŠ¶æ€ï¼Œå¹¶ä¸ºæ¯ä¸€ä¸ªè·¯ç”±åˆ†ç»„è®¡ç®—å‡ºæœ€ä½³çš„è·¯ç”±ï¼Œå’Œç”Ÿæˆæ­£ç¡®çš„è½¬å‘è¡¨ï¼›è¿™æ—¶å€™ï¼Œåº•å±‚çš„è·¯ç”±å™¨ç¡¬ä»¶å°±ä»…ä»…éœ€è¦è¿›è¡ŒæŸ¥è¡¨è½¬å‘ï¼Œè€Œä¸éœ€è¦è¿›è¡Œè€—æ—¶çš„è·¯ç”±è¡¨ç”Ÿäº§å’Œç®—æ³•è®¡ç®—äº†ï¼Œå¤§å¤§å‡è½»äº†åº•å±‚äº¤æ¢æœºå’Œè·¯ç”±å™¨ç¡¬ä»¶çš„å‹åŠ›ã€‚</p><p><img src="https://img.musnow.top/i/2023/08/feb23bbf0d7ea8acff297ff8111488fa.png" alt="image-20230827145453526"></p><h2 id="3-3-OpenFlowåè®®"><a href="#3-3-OpenFlowåè®®" class="headerlink" title="3.3 OpenFlowåè®®"></a>3.3 OpenFlowåè®®</h2><p>OpenFlowåè®®æ˜¯ä¸€ä¸ªå—åˆ°é«˜åº¦è®¤å¯çš„æ ‡å‡†ï¼Œå…¶ä¸€èˆ¬åœ¨SDNä¸­è¿›è¡Œä½¿ç”¨ï¼Œä½†SDNå¹¶ä¸ä¸€å®šè¦ç”¨OpenFlowï¼›</p><blockquote><p>OpenFlowåè®®ç”±<strong>å¼€æ”¾ç½‘ç»œåŸºé‡‘ä¼šONF</strong>è´Ÿè´£æŒ‡å®šï¼Œè¯¥åŸºé‡‘ä¼šè‡´åŠ›äºSDNçš„å‘å±•å’Œæ ‡å‡†åŒ–ï¼›OpenFlowåè®®ç›®å‰è¾ƒä¸ºæˆç†Ÿçš„æ˜¯1.3ç‰ˆæœ¬</p></blockquote><p>OpenFlowåè®®æ˜¯SDNä½“ç³»ç»“æ„ä¸­ï¼Œæ§åˆ¶å±‚é¢å’Œæ•°æ®å±‚é¢ä¹‹é—´çš„é€šä¿¡æ¥å£ï¼Œè¯¥åè®®å¯ä»¥å…è®¸æ§åˆ¶å±‚é¢çš„æ§åˆ¶å™¨å¯¹æ•°æ®å±‚é¢çš„ç‰©ç†è®¾å¤‡è¿›è¡Œç›´æ¥çš„è®¿é—®å’Œæ§åˆ¶ã€‚</p><p><img src="https://img.musnow.top/i/2023/08/0c9a0b49911c437a7d31a4090004fa1a.png" alt="image-20230827145816552"></p><h2 id="3-4-è·¯ç”±è½¬å‘çš„åŒºåˆ«"><a href="#3-4-è·¯ç”±è½¬å‘çš„åŒºåˆ«" class="headerlink" title="3.4 è·¯ç”±è½¬å‘çš„åŒºåˆ«"></a>3.4 è·¯ç”±è½¬å‘çš„åŒºåˆ«</h2><h3 id="3-4-1-ä¼ ç»Ÿè·¯ç”±è¡¨"><a href="#3-4-1-ä¼ ç»Ÿè·¯ç”±è¡¨" class="headerlink" title="3.4.1 ä¼ ç»Ÿè·¯ç”±è¡¨"></a>3.4.1 ä¼ ç»Ÿè·¯ç”±è¡¨</h3><p>ä¼ ç»Ÿçš„è·¯ç”±è½¬å‘æ˜¯æŸ¥è¯¢è·¯ç”±è¡¨ï¼Œæ ¹æ®åœ°å€æ©ç è®¡ç®—ç›®çš„ç½‘ç»œï¼Œåˆ¤æ–­æ˜¯å¦ä¸å½“å‰æ¡ç›®åŒ¹é…ï¼Œå¦‚æœåŒ¹é…ï¼Œåˆ™ä»å¯¹åº”çš„ã€Œä¸‹ä¸€æ¡ã€ä¸­å‘é€å‡ºå»ã€‚</p><p>è·¯ç”±è½¬å‘è¿™éƒ¨åˆ†å†…å®¹åœ¨æˆ‘çš„IPåè®®è¯¦è§£åšå®¢ä¸­æœ‰æ‰€æ¶‰åŠï¼š<a href="https://blog.musnow.top/posts/3482559497/">ç‚¹æˆ‘</a></p><p><img src="https://img.musnow.top/i/2023/08/e154eeaf46fb0ce68d4ca6c6ea946920.png" alt="image-20230827150215508"></p><h3 id="3-4-2-SDNå¹¿ä¹‰è½¬å‘"><a href="#3-4-2-SDNå¹¿ä¹‰è½¬å‘" class="headerlink" title="3.4.2 SDNå¹¿ä¹‰è½¬å‘"></a>3.4.2 SDNå¹¿ä¹‰è½¬å‘</h3><p>SDNåœ¨è¿™åŸºç¡€ä¸Šæ–°å¢äº†æ›´å¤šçš„å†…å®¹ï¼Œç§°ä¸º<strong>å¹¿ä¹‰è½¬å‘</strong>ï¼š</p><ol><li>è¿›è¡ŒåŒ¹é…ï¼šèƒ½å¤Ÿå¯¹ç½‘ç»œä½“ç³»ç»“æ„ä¸­çš„å„å±‚ï¼ˆæ•°æ®é“¾è·¯å±‚ï¼Œç½‘ç»œå±‚ï¼Œä¼ è¾“å±‚ï¼‰é¦–éƒ¨ä¸­çš„å­—æ®µè¿›è¡ŒåŒ¹é…</li><li>æ‰§è¡ŒåŠ¨ä½œï¼šä¸ä»…è½¬å‘åˆ†ç»„ï¼Œè¿˜å¯ä»¥å®ç°è´Ÿè½½å‡è¡¡ã€é‡å†™IPé¦–éƒ¨ï¼ˆç±»ä¼¼NATä¸­çš„è·¯ç”±åœ°å€è½¬æ¢ï¼‰ã€äººä¸ºé˜»æŒ¡æˆ–ä¸¢å¼ƒä¸€äº›åˆ†ç»„ï¼ˆç±»ä¼¼é˜²ç«å¢™ï¼‰</li></ol><p>åœ¨SDNå¹¿ä¹‰è½¬å‘ä¸­ï¼Œå®Œæˆè¿™ä¸€æ“ä½œçš„è®¾å¤‡ä¸å†ç§°ä¸ºè·¯ç”±å™¨ï¼Œè€Œæ˜¯å«åšOpenFlowäº¤æ¢æœºï¼ˆæˆ–åˆ†ç»„äº¤æ¢æœºï¼‰ï¼Œä¹Ÿå¯ä»¥ç®€ç§°ä¸ºäº¤æ¢æœºã€‚</p><h3 id="3-4-3-æµè¡¨"><a href="#3-4-3-æµè¡¨" class="headerlink" title="3.4.3 æµè¡¨"></a>3.4.3 æµè¡¨</h3><p>åœ¨SDNä¸­æ›¿ä»£ äº†ä¼ ç»Ÿè·¯ç”±è¡¨çš„æ˜¯ã€Œæµè¡¨ï¼ˆFlow Tableï¼‰ã€</p><ul><li>ä¸€ä¸ªæµå°±æ˜¯æ•´ä¸ªç½‘ç»œä¸­çš„ä¸€ç»„åˆ†ç»„åºåˆ—ï¼Œåœ¨æ­¤åºåˆ—ä¸­çš„æ¯ä¸ªåˆ†ç»„éƒ½æ˜¯<code>å…±äº«åˆ†ç»„é¦–éƒ¨æŸäº›å­—æ®µçš„å€¼</code>ï¼Œä¾‹å¦‚ï¼ŒæŸä¸ªæµå¯ä»¥æ˜¯å…±äº«ç›¸åŒçš„æºIPå’Œç›®çš„IPåœ°å€çš„ä¸€è¿ä¸²åˆ†ç»„</li><li>OpenFlowäº¤æ¢æœºä¸­çš„åˆ˜è¡¨æ˜¯ç”±SDNè¿œç¨‹æ§åˆ¶å™¨æ¥ç®¡ç†çš„ï¼ŒSDNè¿œç¨‹æ§åˆ¶å™¨é€šè¿‡ä¸€ä¸ªå®‰å…¨ä¿¡é“ï¼Œé€šè¿‡OpenFlowåè®®æ¥ç®¡ç†OpenFlowäº¤æ¢æœºä¸­çš„æµè¡¨</li></ul><p><img src="https://img.musnow.top/i/2023/08/da25636e91b2ab521809adc0d568a7d4.png" alt="image-20230827150934738"></p><ul><li>æ¯ä¸ªOpenFlowäº¤æ¢æœºå¿…é¡»æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªæµè¡¨</li><li>æ¯ä¸€ä¸ªæµè¡¨åŒ…å«å¤šä¸ªæµè¡¨é¡¹ç›®</li><li>æ¯ä¸ªæµè¡¨é¡¹åŒ…å«ä¸‰ä¸ªå­—æ®µï¼šé¦–éƒ¨å­—æ®µå€¼ï¼ˆåŒ¹é…å­—æ®µï¼‰ã€è®¡æ•°å™¨ã€åŠ¨ä½œï¼ˆç±»ä¼¼ä¸‹ä¸€è·³ï¼‰</li></ul><p>OpenFlowçš„é¦–éƒ¨å­—æ®µå€¼è·¨è¶Šäº†ä¸‰ä¸ªå±‚æ¬¡çš„é¦–éƒ¨ï¼Œæ—¢å¯ä»¥å¤„ç†æ•°æ®é“¾è·¯å±‚çš„MACå¸§ï¼Œåˆå¯ä»¥å¤„ç†IPæŠ¥æ–‡ï¼Œæˆ–è€…æ˜¯TCP&#x2F;UDPçš„ç«¯å£</p><p><img src="https://img.musnow.top/i/2023/08/fa579c04d7c630a4b94a6158c1b0d384.png" alt="image-20230827151212669"></p><p>è®¡æ•°å™¨å­—æ®µåŒ…å«ä¸€ç»„è®¡æ•°å™¨</p><ul><li>è®°å½•å·²ç»ä¸è¯¥æµè¡¨é¡¹åŒ¹é…çš„åˆ†ç»„æ•°é‡çš„è®¡æ•°å™¨ï¼›</li><li>è®°å½•è¯¥æµè¡¨é¡¹ä¸Šæ¬¡æ›´æ–°åˆ°ç°åœ¨ç»å†çš„æ—¶é—´çš„è®¡æ•°å™¨</li></ul><p>åŠ¨ä½œå­—æ®µæ˜¯ä¸€æ—åŠ¨ä½œï¼Œå½“åˆ†ç»„åŒ¹é…åˆ°æŸä¸ªæµè¡¨é¡¹æ—¶ï¼Œæ‰§è¡Œä¸‹æ–¹çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªåŠ¨ä½œ</p><ul><li>æŠŠåˆ†ç»„è½¬å‘åˆ°æŒ‡å®šçš„ç«¯å£</li><li>ä¸¢å¼ƒåˆ†ç»„</li><li>æŠŠåˆ†ç»„è¿›è¡Œå¤åˆ¶åï¼Œä»å¤šä¸ªç«¯å£è½¬å‘å‡ºå»</li><li>é‡å†™åˆ†ç»„ä¸­çš„é¦–éƒ¨å­—æ®µ</li></ul><h3 id="3-4-4-VLAN"><a href="#3-4-4-VLAN" class="headerlink" title="3.4.4 VLAN"></a>3.4.4 VLAN</h3><blockquote><p>å…³äºè¯¥æŠ¥æ–‡ä¸­VLANéƒ¨åˆ†å¯ä»¥æŸ¥çœ‹æ­¤åšå®¢ï¼š<a href="https://blog.csdn.net/LawssssCat/article/details/127204720">https://blog.csdn.net/LawssssCat/article/details/127204720</a></p></blockquote><p>VLANæ˜¯ä¸€ç§ç”¨äºè¿›ä¸€æ­¥è™šæ‹ŸåŒ–åˆ’åˆ†å±€åŸŸç½‘çš„æ–¹å¼ï¼Œå‡å¦‚ä¸€å°è·¯ç”±å™¨æœ‰4ä¸ªç½‘å£ï¼Œå…¶å¯ä»¥é€šè¿‡å°†LAN1å’ŒLAN2è®¾ç½®æˆVLAN10ï¼ŒLAN3å’ŒLAN4è®¾ç½®æˆVLAN20æ¥æ¨¡æ‹Ÿå‡ºä¸¤ä¸ªå±€åŸŸç½‘</p><p><img src="https://img.musnow.top/i/2023/08/8cfceb7090ae21914683d034f680f485.png" alt="image-20230827153454860"></p><p>vlanï¼ˆvirtual lanï¼‰æŠ€æœ¯æä¾›äº†ä¸€ç§çµæ´»çš„è§£å†³æ–¹æ¡ˆï¼›å°†äº¤æ¢æœºçš„æ¥å£æ ¹æ®ä¸šåŠ¡éœ€è¦æ·»åŠ åˆ°ä¸åŒçš„vlanä¸­ï¼Œä»è€Œå®ç°äºŒå±‚éš”ç¦»ã€‚</p><ul><li>éš”ç¦»å¹¿æ’­åŸŸï¼Œå³å¹¿æ’­åŒ…åªåœ¨æœ¬ vlan ä¸­ä¼ æ’­ï¼Œä»è€Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥æé«˜æ•´ä¸ªç½‘ç»œçš„å¤„ç†èƒ½åŠ›ï¼›</li><li>æé«˜å®‰å…¨æ€§ï¼Œä¸€ä¸ª vlan å†…çš„ç”¨æˆ·å’Œå…¶ä»– vlan å†…çš„ç”¨æˆ·ä¸èƒ½äº’è®¿ï¼Œæé«˜äº†ç½‘ç»œçš„å®‰å…¨æ€§ï¼›</li><li>å¢åŠ å¸¦å®½åˆ©ç”¨&#x2F;é™ä½å»¶è¿Ÿ&#x2F;ç®¡ç†ä½œç”¨</li></ul><h2 id="3-5-ä¸¾ä¾‹"><a href="#3-5-ä¸¾ä¾‹" class="headerlink" title="3.5 ä¸¾ä¾‹"></a>3.5 ä¸¾ä¾‹</h2><h3 id="3-5-1-ç®€å•è½¬å‘"><a href="#3-5-1-ç®€å•è½¬å‘" class="headerlink" title="3.5.1 ç®€å•è½¬å‘"></a>3.5.1 ç®€å•è½¬å‘</h3><p>é€šè¿‡ä¸åŒçš„æµè¡¨é¡¹æ¥è®¾ç½®è½¬å‘è·¯å¾„å’Œè½¬å‘åŠ¨ä½œï¼ŒåŠ¨ä½œä¸­çš„<code>è½¬å‘(3)</code>ä»£è¡¨ä»è¯¥äº¤æ¢æœºçš„3å·ç«¯å£è½¬å‘å‡ºå»ã€‚ç«¯å£å·åœ¨å›¾ä¸­æœ‰æ ‡æ³¨ï¼›</p><p><img src="https://img.musnow.top/i/2023/08/6faaa19507feedb4784efd2c5a5ac376.png" alt="image-20230827151650945"></p><h3 id="3-5-2-è´Ÿè½½å‡è¡¡"><a href="#3-5-2-è´Ÿè½½å‡è¡¡" class="headerlink" title="3.5.2 è´Ÿè½½å‡è¡¡"></a>3.5.2 è´Ÿè½½å‡è¡¡</h3><p>ç¬¬äºŒä¸ªæ —å­æ˜¯è´Ÿè½½å‡è¡¡çš„æ —å­ï¼Œåœ¨ä¸‹é¢çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬æƒ³è¦H3å‘é€çš„åˆ†ç»„é€šè¿‡<code>S2-S1-S3-H5/H6</code>ï¼Œè¦H4å‘é€çš„åˆ†ç»„é€šè¿‡<code>S2-S3-H5/H6</code>ï¼›ä»¥è¾¾åˆ°è´Ÿè½½å‡è¡¡çš„ç›®çš„ã€‚</p><p><img src="https://img.musnow.top/i/2023/08/5f152f13954536e40cb1b6b815f0c9ad.png" alt="image-20230827151718483"></p><p>ä½¿ç”¨ä¼ ç»Ÿçš„æºIPå’Œç›®çš„IPçš„è½¬å‘æ–¹å¼ï¼Œæ— æ³•å®ç°è¿™æ ·çš„è´Ÿè½½å‡è¡¡ã€‚åœ¨ä¼ ç»Ÿåœºæ™¯ä¸‹ï¼Œå½“S2åœ¨æ•°æ®é“¾è·¯å±‚å‘ç°ç›®çš„MACåœ°å€æ˜¯S3çš„MACåœ°å€çš„æ—¶å€™ï¼Œæ— è®ºå¦‚ä½•éƒ½ä¼šç›´æ¥å‘é€ç»™S3ï¼Œè€Œä¸æ˜¯ä»S1å¤„ç»•è·¯ã€‚</p><p>ä½†åœ¨SDNåœºæ™¯ä¸­ï¼Œå°±å¯ä»¥é€šè¿‡ä¸¤ä¸ªä¸åŒçš„æµè¡¨é¡¹æ¥è§„å®šä¸åŒè½¬å‘åŠ¨ä½œï¼Œå®ç°è¿™æ ·çš„è´Ÿè½½å‡è¡¡ï¼ˆè¿™é‡Œçš„<code>è½¬å‘(4)</code>ä»£è¡¨ä»S2çš„4å·ç«¯å£è½¬å‘å‡ºå»ï¼‰</p><p><img src="https://img.musnow.top/i/2023/08/2d076ac5eca2dc6f7480020f2e0fd57f.png" alt="image-20230827151948106"></p><h3 id="3-5-3-é˜²ç«å¢™"><a href="#3-5-3-é˜²ç«å¢™" class="headerlink" title="3.5.3 é˜²ç«å¢™"></a>3.5.3 é˜²ç«å¢™</h3><p>å¦‚æœæˆ‘ä»¬æƒ³è®©S2ä¸»æœºåªæ¥æ”¶æ¥è‡ªS1çš„æ•°æ®è€Œä¸æ¥å—S3çš„æ•°æ®ï¼Œå°±å¯ä»¥é€šè¿‡åªè®¾ç½®S1çš„æºIPåœ°å€çš„æµè¡¨é¡¹ï¼Œæ¥ä¸¢å¼ƒS3å‘é€çš„æ•°æ®ï¼ˆåŒ¹é…ä¸ä¸Šçš„æ•°æ®å°±ä¼šè¢«ä¸¢å¼ƒï¼‰</p><p><img src="https://img.musnow.top/i/2023/08/f7be65147a7d7897ae6d4402ad2d8f26.png" alt="image-20230827152217555"></p><h2 id="3-6-SDNä½“ç³»ç»“æ„çš„ç‰¹å¾"><a href="#3-6-SDNä½“ç³»ç»“æ„çš„ç‰¹å¾" class="headerlink" title="3.6 SDNä½“ç³»ç»“æ„çš„ç‰¹å¾"></a>3.6 SDNä½“ç³»ç»“æ„çš„ç‰¹å¾</h2><p>ä¸‹å›¾ä¸­åŒ…å«äº†SDNçš„ä½“ç³»ç»“æ„ä¸€è§ˆå›¾å’ŒSDNçš„å››ä¸ªå…³é”®ç‰¹å¾</p><ol><li>åŸºäºæµçš„è½¬å‘</li><li>æ•°æ®å±‚é¢ä¸æ§åˆ¶å±‚é¢åˆ†ç¦»</li><li>ä½äºæ•°æ®å±‚é¢åˆ†ç»„äº¤æ¢æœºä¹‹å¤–çš„ç½‘ç»œæ§åˆ¶åŠŸèƒ½</li><li>å¯ç¼–ç¨‹çš„ç½‘ç»œ</li></ol><p>å…¶ä¸­ï¼ŒSDNæ§åˆ¶å™¨æ˜¯è¿™ä¸ªæ¶æ„ä¸­æœ€å¤æ‚çš„è®¾å¤‡ï¼Œå…¶é€šè¿‡å—å‘APIæ§åˆ¶åº•å±‚çš„OpenFlowäº¤æ¢æœºï¼Œé€šè¿‡åŒ—å‘APIæ¥å—å…¶ä»–ç½‘ç»œæ§åˆ¶å™¨çš„ç­–ç•¥é…ç½®ã€‚</p><p><img src="https://img.musnow.top/i/2023/08/a6678beda5464d34757501e8cc95580e.png" alt="image-20230827152358531"></p><h3 id="3-6-1-SDNæ§åˆ¶å™¨"><a href="#3-6-1-SDNæ§åˆ¶å™¨" class="headerlink" title="3.6.1 SDNæ§åˆ¶å™¨"></a>3.6.1 SDNæ§åˆ¶å™¨</h3><p>SDNæ§åˆ¶å™¨å¯ä»¥åˆ†æˆä¸‰ä¸ªå±‚æ¬¡</p><ul><li>å…¶é€šä¿¡å±‚é€šè¿‡OpenFlowåè®®ä¸äº¤æ¢æœºé€šä¿¡</li><li>ä¸­é—´é—´æ¥æ ¹æ®å„ç§ç­–ç•¥ç®¡ç†å„ä¸ªäº¤æ¢æœº</li><li>åŒ—å‘APIæ¥æ”¶æ¥è‡ªå…¶ä»–æ§åˆ¶ç­–ç•¥å‘èµ·ç«¯çš„é…ç½®</li></ul><p><img src="https://img.musnow.top/i/2023/08/46dc0f081cfa38af5ea0d3d89e0ccc68.png" alt="image-20230827152554869"></p><p>è¿™é‡Œä½¿ç”¨çš„<code>RESTful API </code>æ˜¯åŸºäºHTTPçš„APIï¼Œä¹Ÿæ˜¯æˆ‘ä»¬è¾ƒå¸¸è§çš„APIæ¥å£ï¼›</p><h3 id="3-6-2-å¼€æºSDNæ§åˆ¶å™¨"><a href="#3-6-2-å¼€æºSDNæ§åˆ¶å™¨" class="headerlink" title="3.6.2 å¼€æºSDNæ§åˆ¶å™¨"></a>3.6.2 å¼€æºSDNæ§åˆ¶å™¨</h3><p>å¸¸ç”¨çš„å¼€æºSDNæ§åˆ¶å™¨æœ‰OPEN DAYLIGHTå’ŒONOSï¼›</p><h3 id="3-6-3-SDNçš„ä¼˜åŠ¿"><a href="#3-6-3-SDNçš„ä¼˜åŠ¿" class="headerlink" title="3.6.3 SDNçš„ä¼˜åŠ¿"></a>3.6.3 SDNçš„ä¼˜åŠ¿</h3><blockquote><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/as12138/article/details/131273381">https://blog.csdn.net/as12138/article/details/131273381</a></p></blockquote><p>SDNç›¸æ¯”äºä¼ ç»Ÿç½‘ç»œæ¶æ„ï¼Œæœ‰è®¸å¤šä¼˜ç‚¹å’Œä¼˜åŠ¿ã€‚</p><ol><li><p>é«˜åº¦å¯ç¼–ç¨‹æ€§ï¼šSDNæ¶æ„ä¸­çš„æ§åˆ¶å™¨è´Ÿè´£ç®¡ç†äº¤æ¢æœºå’Œè·¯ç”±å™¨ï¼Œä½¿å¾—ç½‘ç»œæ›´åŠ å¯ç¼–ç¨‹ã€å¯é…ç½®ã€‚ç®¡ç†å‘˜å¯ä»¥é€šè¿‡æ§åˆ¶å™¨å®ç°çµæ´»è°ƒæ•´ç½‘ç»œæ‹“æ‰‘ã€ç®¡ç†æµé‡å’Œé…ç½®æµè°ƒåº¦ç­–ç•¥ï¼Œæå‡ç½‘ç»œçš„å¯æ¼”å˜æ€§ã€å¯å®šåˆ¶åŒ–å’Œå¯ä¼¸ç¼©æ€§ã€‚</p></li><li><p>ç½‘ç»œæ™ºèƒ½é›†ä¸­åŒ–ï¼šåœ¨SDNä¸­ï¼Œç½‘ç»œæ™ºèƒ½è¢«é›†ä¸­åœ¨æ§åˆ¶å™¨ä¸­ï¼Œé€šè¿‡æ§åˆ¶å™¨è¿›è¡Œé›†ä¸­å¼ç®¡ç†å’Œæ§åˆ¶ã€‚è¿™ç§åˆ†ç¦»çš„æ¨¡å¼é¿å…äº†ç½‘ç»œè®¾å¤‡ä¸­ä»»åŠ¡çš„å¤æ‚ï¼Œæå‡äº†ç½‘ç»œçš„å¯ç®¡ç†æ€§å’Œå¯æ§åˆ¶æ€§ã€‚æ­¤å¤–ï¼Œé›†ä¸­åŒ–çš„ç®¡ç†æ–¹å¼ä¹Ÿå¯ä»¥åœ¨ç½‘ç»œä¸­é—´ä»¶å’Œåº”ç”¨ä¸­å®ç°æ™ºèƒ½æ§åˆ¶ï¼Œå¦‚åˆ†å¸ƒå¼å­˜å‚¨ã€äº‘è®¡ç®—ç­‰ã€‚</p></li><li><p>å¯æ‰©å±•æ€§ï¼šSDNä¸­çš„ç½‘ç»œè®¾å¤‡æ˜¯é€šç”¨çš„ç¡¬ä»¶è®¾å¤‡ï¼Œä¸éœ€è¦ç‰¹å®šçš„åŠŸèƒ½åŒºåˆ†ï¼ŒåŒæ—¶ä¹Ÿä¸éœ€è¦æ›´æ–°ç¡¬ä»¶ï¼Œåªéœ€æ›´æ–°æ§åˆ¶å™¨å³å¯å®ç°æ‹“æ‰‘å¯ä¼¸ç¼©å’Œçµæ´»çš„ç½‘ç»œç®¡ç†ã€‚</p></li><li><p>è‡ªåŠ¨åŒ–å’Œæé«˜æ•ˆç‡ï¼šSDNä¸­å¯ä»¥å®ç°ç½‘ç»œçš„è‡ªåŠ¨åŒ–ï¼Œé€šè¿‡æ§åˆ¶å™¨è¿›è¡Œè‡ªåŠ¨åŒ–çš„ç½‘ç»œç®¡ç†ï¼Œå¯ä»¥é¿å…æ‰‹åŠ¨ç®¡ç†ç½‘ç»œçš„å±€é™æ€§å’Œä¸ç¡®å®šæ€§ï¼Œä»è€Œæé«˜ç½‘ç»œçš„æ•ˆç‡å’Œç¨³å®šæ€§ï¼ŒåŒæ—¶ï¼Œè‡ªåŠ¨åŒ–ç½‘ç»œç®¡ç†ä¹Ÿå¯ä»¥é™ä½ç½‘ç»œç»´æŠ¤çš„æˆæœ¬å’Œæ—¶é—´ã€‚</p></li><li><p>å®‰å…¨å¯é æ€§æå‡ï¼šç½‘ç»œå®‰å…¨å’Œå¯é æ€§æ˜¯ä¼ä¸šç½‘ç»œä¸­æœ€åŸºæœ¬çš„éœ€æ±‚ã€‚ä¼ ç»Ÿçš„ç½‘ç»œå®‰å…¨å¾€å¾€éœ€è¦é€šè¿‡ä¸€äº›ç‰¹å®šè®¾å¤‡å’Œåè®®æ¥å®ç°ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒSDNä¸­çš„æ§åˆ¶å™¨å¯ä»¥æ ¹æ®ç½‘ç»œå®æ—¶çŠ¶æ€è‡ªåŠ¨ä¼˜åŒ–ç®¡ç†ç­–ç•¥ï¼Œå®‰å…¨å¯é çš„æ–¹å¼æ¥æé«˜ç½‘ç»œçš„å®‰å…¨æ€§ã€‚</p></li></ol><p>æ€»ä¹‹ï¼ŒSDNçš„ä¼˜åŠ¿åœ¨äºå…¶çµæ´»çš„å¯ç¼–ç¨‹æ€§ã€é›†ä¸­å¼æ™ºèƒ½ç®¡ç†ã€é«˜æ•ˆçš„è‡ªåŠ¨åŒ–ç½‘ç»œç®¡ç†å’Œå¢å¼ºç½‘ç»œå®‰å…¨æ€§ã€‚ä»¥ä¸Šä¼˜åŠ¿ä¹Ÿæ˜¯SDNæŠ€æœ¯åº”ç”¨å¹¿æ³›çš„ä¸»è¦åŸå› ï¼Œè¶Šæ¥è¶Šå¤šçš„ä¼ä¸šå’Œç»„ç»‡å°†SDNæŠ€æœ¯åº”ç”¨åˆ°è‡ªå·±çš„ç½‘ç»œæ¶æ„ä¸­ï¼Œä»¥æ»¡è¶³æœªæ¥ç½‘ç»œçš„éœ€æ±‚å’ŒæŒ‘æˆ˜ã€‚</p><h2 id="3-6-4-SDNåº”ç”¨å‰æ™¯"><a href="#3-6-4-SDNåº”ç”¨å‰æ™¯" class="headerlink" title="3.6.4 SDNåº”ç”¨å‰æ™¯"></a>3.6.4 SDNåº”ç”¨å‰æ™¯</h2><p>SDNæŠ€æœ¯ç›®å‰å·²ç»å®ç°äº†åŸºç¡€ç½‘ç»œé…ç½®ã€æµæ§åˆ¶ã€ç½‘ç»œå®‰å…¨ç­‰åŠŸèƒ½ã€‚åœ¨æœªæ¥ï¼ŒSDNæŠ€æœ¯è¿˜ä¼šé¢ä¸´æ›´å¤šçš„æŒ‘æˆ˜å’Œæœºé‡ã€‚</p><ol><li><p>5Gæ—¶ä»£ï¼š5GæŠ€æœ¯å°†ä¼šæ”¹å˜ç½‘ç»œçš„é¢è²Œï¼ŒåŠ é€Ÿç‰©è”ç½‘åº”ç”¨çš„æ™®åŠã€‚SDNä½œä¸ºæ¶æ„çµæ´»ã€å¯ç¼–ç¨‹çš„ç½‘ç»œæ–¹å¼ï¼Œå°†ä¼šåœ¨5Gç½‘ç»œä¸­å‘æŒ¥é‡è¦ä½œç”¨ï¼Œå®ç°ç½‘ç»œçš„è‡ªåŠ¨åŒ–å’Œæ™ºèƒ½åŒ–ç®¡ç†ã€‚</p></li><li><p>IoTè®¾å¤‡ï¼šç‰©è”ç½‘æŠ€æœ¯å¸¦æ¥å¤§é‡è®¾å¤‡çš„è¿æ¥ï¼ŒSDNæŠ€æœ¯çš„ä»·å€¼åœ¨äºè‡ªåŠ¨åŒ–äº†ç‰©è”ç½‘è®¾å¤‡çš„ç®¡ç†ã€å®‰å…¨å’Œç›‘æ§ã€‚æœªæ¥ï¼ŒSDNæŠ€æœ¯å°†ä¼šæˆä¸ºç‰©è”ç½‘ç®¡ç†çš„é‡è¦å·¥å…·ã€‚</p></li><li><p>AIï¼šéšç€äººå·¥æ™ºèƒ½çš„å‘å±•ï¼ŒSDNçš„ä¸šç•Œåº”ç”¨å·²ç»å¼€å§‹å¤§è§„æ¨¡è½åœ°ã€‚è¿™å°†åŠ é€Ÿæ™ºèƒ½äº¤é€šã€æ™ºèƒ½åŸå¸‚å’Œè‡ªåŠ¨é©¾é©¶ç­‰é¢†åŸŸçš„å‘å±•ã€‚</p></li><li><p>é›†æˆæ–°æŠ€æœ¯ï¼šSDNå¯ä»¥å¾ˆå®¹æ˜“åœ°ä¸å…¶ä»–æŠ€æœ¯ç›¸ç»“åˆï¼Œä¾‹å¦‚NFVï¼ˆç½‘ç»œåŠŸèƒ½è™šæ‹ŸåŒ–ï¼‰å’ŒAIï¼ˆäººå·¥æ™ºèƒ½ï¼‰ï¼Œä»¥æé«˜ç½‘ç»œçš„æ•ˆç‡å’Œé€‚åº”æ€§ã€‚</p></li><li><p>äº‘è®¡ç®—ï¼šSDNæŠ€æœ¯çš„çµæ´»æ€§å’Œå¯ç¼–ç¨‹æ€§ï¼Œä¹Ÿä½¿å¾—SDNä¸äº‘è®¡ç®—ç­‰æ–°æŠ€æœ¯çš„ç»“åˆå˜å¾—æ›´åŠ è‡ªç„¶ã€‚åœ¨æœªæ¥ï¼ŒSDNæŠ€æœ¯å°†ä¸äº‘æŠ€æœ¯ç´§å¯†ç»“åˆï¼Œå®ç°ä¸šåŠ¡æµç¨‹çš„è‡ªåŠ¨åŒ–ã€å¿«é€Ÿåº”ç”¨éƒ¨ç½²å’Œå¼¹æ€§äº‘èµ„æºç®¡ç†ã€‚</p></li></ol><p>æ€»è€Œè¨€ä¹‹ï¼ŒSDNæŠ€æœ¯å°†ä¸ºæœªæ¥ç½‘ç»œçš„å‘å±•å’Œå®ç°å„ç§åº”ç”¨æä¾›æ”¯æ’‘ã€‚åœ¨æ—¥ç›Šå¢é•¿çš„ç½‘ç»œéœ€æ±‚å’Œå¤æ‚çš„ç½‘ç»œæŠ€æœ¯èƒŒæ™¯ä¸‹ï¼ŒSDNçš„çµæ´»æ€§å’Œé«˜å¯ç”¨æ€§å°†ä¼šå¸¦æ¥æ›´å¤§çš„å‘å±•ç©ºé—´å’Œå¸‚åœºéœ€æ±‚ã€‚SDNæŠ€æœ¯åº”å½“ç»§ç»­ç ”ç©¶å’Œå‘å±•ï¼Œä»¥æ»¡è¶³æ›´å¤šçš„ç½‘ç»œéœ€æ±‚å’ŒæŒ‘æˆ˜ã€‚</p><h2 id="3-7-æ€»ç»“"><a href="#3-7-æ€»ç»“" class="headerlink" title="3.7 æ€»ç»“"></a>3.7 æ€»ç»“</h2><p><img src="https://img.musnow.top/i/2023/08/3a0e7fd1ff2494f51ec6121d4a60e108.png" alt="image-20230827152810972"></p>]]></content>
    
    
    <summary type="html">æœ´å®çš„å­¦ä¹ åŸå› ï¼šäº¬ä¸œå®ä¹ ç”Ÿæ‹›è˜æ¡ç›®ä¸Šå†™äº†è¿™äº›æŠ€æœ¯ï¼Œé‚£å°±ç»™ä»–å­¦äº†ï¼</summary>
    
    
    
    <category term="å·®ç”Ÿæ–‡å…·å¤š" scheme="https://blog.musnow.top/categories/%E5%B7%AE%E7%94%9F%E6%96%87%E5%85%B7%E5%A4%9A/"/>
    
    
    <category term="CDN" scheme="https://blog.musnow.top/tags/CDN/"/>
    
    <category term="SDN" scheme="https://blog.musnow.top/tags/SDN/"/>
    
  </entry>
  
  <entry>
    <title>ã€APIã€‘APIçš„å„ç§åˆ†ç±»è¯¦è§£</title>
    <link href="https://blog.musnow.top/posts/73383828/"/>
    <id>https://blog.musnow.top/posts/73383828/</id>
    <published>2023-08-26T12:15:18.000Z</published>
    <updated>2023-08-26T12:15:18.000Z</updated>
    
    <content type="html"><![CDATA[<p>APIï¼Œå³åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿åº”ç”¨ç¨‹åºä¹‹é—´çš„æ•°æ®å’ŒåŠŸèƒ½äº¤äº’è€Œè®¾è®¡çš„ä¸€äº›æ ‡å‡†æ–¹æ³•ã€‚API çš„åˆ†ç±»å¯ä»¥ä»å¤šä¸ªç»´åº¦è¿›è¡Œï¼Œæˆ‘ä¼šå¯¹ API çš„åˆ†ç±»ç»´åº¦è¿›è¡Œç®€å•çš„ä»‹ç»ã€‚</p><span id="more"></span><h2 id="æ ¹æ®ä½¿ç”¨æ–¹å¼çš„ä¸åŒ"><a href="#æ ¹æ®ä½¿ç”¨æ–¹å¼çš„ä¸åŒ" class="headerlink" title="æ ¹æ®ä½¿ç”¨æ–¹å¼çš„ä¸åŒ"></a>æ ¹æ®ä½¿ç”¨æ–¹å¼çš„ä¸åŒ</h2><p>é€šå¸¸æƒ…å†µä¸‹ï¼ŒAPI å¯ä»¥åˆ†ä¸ºä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼šå†…éƒ¨ API å’Œå¤–éƒ¨ APIã€‚</p><p>å†…éƒ¨ API æ˜¯æŒ‡ä¾›ä¼ä¸šå†…éƒ¨å¼€å‘äººå‘˜å’Œåº”ç”¨æ‰€ä½¿ç”¨çš„ APIã€‚å½“ä¼ä¸šéœ€è¦ä¸€äº›å®šåˆ¶åŒ–çš„åº”ç”¨ç¨‹åºæˆ–è€…é›†æˆç‰¹å®šçš„åŠŸèƒ½æ—¶ï¼Œå†…éƒ¨ API å¯ä»¥æä¾›æ›´å¥½çš„æŠ€æœ¯æ”¯æŒï¼ŒåŒæ—¶ä¹Ÿèƒ½ä¿è¯æ•°æ®çš„å®‰å…¨æ€§å’Œå¯é æ€§ã€‚</p><p>å¤–éƒ¨ API åˆ™æ˜¯ä¾›å…¬ä¼—å¼€å‘è€…ä½¿ç”¨çš„ APIï¼Œé€šè¿‡æä¾›æ•°æ®å’ŒæœåŠ¡ï¼Œä½¿å¾—å¤–éƒ¨çš„å¼€å‘è€…å¯ä»¥æ„å»ºä¸°å¯Œçš„åº”ç”¨ç¨‹åºå¹¶ä¸å½“å‰çš„ç”Ÿæ€ç³»ç»Ÿè¿›è¡Œåä½œã€‚è¶Šæ¥è¶Šå¤šçš„å„ç±»å…¬å¸éƒ½å¼€å§‹å‘å…¬ä¼—æä¾›è‡ªå·±çš„ APIï¼Œç¤ºä¾‹åŒ…æ‹¬ Facebookã€Twitterã€Google ç­‰ã€‚</p><h2 id="æ ¹æ®è®¿é—®æ–¹å¼çš„ä¸åŒ"><a href="#æ ¹æ®è®¿é—®æ–¹å¼çš„ä¸åŒ" class="headerlink" title="æ ¹æ®è®¿é—®æ–¹å¼çš„ä¸åŒ"></a>æ ¹æ®è®¿é—®æ–¹å¼çš„ä¸åŒ</h2><p>æ ¹æ® API çš„è®¿é—®æ–¹å¼ï¼ŒAPI å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>RESTful API RESTï¼ˆRepresentational State Transferï¼‰æ˜¯ä¸€ç§åŸºäº HTTP åè®®çš„ Web åº”ç”¨ç¨‹åºæ¶æ„æ ‡å‡†ã€‚RESTful API éµå¾ª RESTful æ¶æ„çš„åŸåˆ™ï¼Œé€šå¸¸ç”±èµ„æºè·¯å¾„å’Œè¯·æ±‚æ–¹æ³•ç»„æˆï¼Œä»¥è¾¾åˆ°å¯è¯»æ€§é«˜ã€çµæ´»æ€§å¥½çš„ç›®çš„ã€‚</li><li>SOAP API SOAPï¼ˆSimple Object Access Protocolï¼‰æ˜¯ä¸€ç§åŸºäº XML ç¼–ç çš„è¿œç¨‹è°ƒç”¨åè®®ï¼Œæ¯”è¾ƒå¤æ‚è€Œä¸”å¤„ç†æ—¶é—´å’Œç½‘ç»œèµ„æºä½¿ç”¨ç‡é«˜ã€‚è™½ç„¶ SOAP æŠ€æœ¯å·²ç»é€æ¸æ·¡å‡ºå¸‚åœºï¼Œä½†åœ¨æŸäº›ç‰¹æ®Šåœºæ™¯ä¸‹ä»ç„¶ä¼šæœ‰æ‰€åº”ç”¨ã€‚</li><li>GraphQL API GraphQL æ˜¯ç”± Facebook å…¬å¸å¼€æºçš„ä¸€ç§æ•°æ®æŸ¥è¯¢è¯­è¨€å’Œ API æ‰§è¡Œå¼•æ“ï¼Œå¯ä»¥å‘ˆç°å‡º XML schema æ¥è¡¨è¾¾æ•´ä¸ªæ•°æ®çš„ç»“æ„ï¼Œå¹¶ä¸ºå‰ç«¯å·¥ç¨‹å¸ˆæä¾›è‡ªç”±å®šä¹‰è·å–æ‰€éœ€å±æ€§ã€ä»£ç é‡ç”¨ç­‰äººæ€§åŒ–çš„ç‰¹è‰²ã€‚</li><li>gRPC API gRPC å¯ä»¥ç†è§£ä¸º Google Remote Procedure Callï¼Œæ˜¯ Google æœ€æ–°å¼€æºçš„è·¨è¯­è¨€ RPC æ¡†æ¶ã€‚å€ŸåŠ©åŸºäº HTTP&#x2F;2 çš„äºŒè¿›åˆ¶ä¼ è¾“åè®®ï¼ŒgRPC æä¾›äº†æ¯” JSON å’Œ RESTful æ›´å¿«é€Ÿå’Œæ›´å¯é çš„é€šè®¯æ–¹å¼ã€‚</li></ul><h2 id="æ ¹æ®åŠŸèƒ½çš„ä¸åŒ"><a href="#æ ¹æ®åŠŸèƒ½çš„ä¸åŒ" class="headerlink" title="æ ¹æ®åŠŸèƒ½çš„ä¸åŒ"></a>æ ¹æ®åŠŸèƒ½çš„ä¸åŒ</h2><p>æ ¹æ® API çš„åŠŸèƒ½æ€§è´¨ï¼ŒAPI å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š</p><ul><li>Web API Web API ä¸€èˆ¬éƒ½é’ˆå¯¹ Web åº”ç”¨ç¨‹åºï¼Œæä¾›ä¸€äº›æ ‡å‡†çš„æ¥å£ï¼Œä¾‹å¦‚ï¼šW3C DOM æ¥å£ã€HTTP æ¥å£ã€WebSocket æ¥å£ã€Web Worker æ¥å£ç­‰ã€‚è¿™äº› API å¸®åŠ©æµè§ˆå™¨å–å¾—ç”¨æˆ·å…ƒç´ ä¿¡æ¯ã€å‘é€ AJAX è¯·æ±‚ç­‰ç­‰ã€‚</li><li>æ“ä½œç³»ç»Ÿ API æ“ä½œç³»ç»Ÿ APIï¼ˆå¦‚ Windows API æˆ– POSIX APIï¼‰æä¾›äº†ä¸æ“ä½œç³»ç»Ÿè½¯ä»¶äº¤äº’çš„æ–¹æ³•ï¼Œå…è®¸åº”ç”¨ç¨‹åºæŸ¥è¯¢åŠæ§åˆ¶ç¡¬ä»¶è®¾å¤‡æˆ–æ“ä½œç³»ç»Ÿå†…æ ¸ä»»åŠ¡ç­‰ã€‚æ­¤ç±» API å‡ ä¹é€‚ç”¨äºä»»ä½•ç±»å‹çš„ç¯å¢ƒã€‚</li><li>æ•°æ®åº“ API æ•°æ®åº“ API å¯ä»¥ä½¿åº”ç”¨ç¨‹åºé€šè¿‡æŸäº› API å®ç°å¯¹ä¸€äº›æ•°æ®å­˜å‚¨çš„æ“ä½œï¼Œä¾‹å¦‚ï¼šSQLã€NoSQL ç­‰æ•°æ®åº“é‡Œéƒ½æœ‰ç›¸å…³çš„ API è°ƒç”¨ã€‚</li></ul><p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼ŒAPI æ”¯æŒè®¿é—®ä¸åŒçš„åŠŸèƒ½æ¨¡å—ï¼Œä¾‹å¦‚æ•°æ®è½¬æ¢ã€æ•°æ®åˆ†æã€ç½‘ç»œå®‰å…¨ã€é—¨æˆ·ç®¡ç†ã€æ—¥å†ç­‰ç­‰ï¼Œè¿˜å¯ä»¥æ ¹æ®ä¸åŒçš„éœ€æ±‚è¿›è¡Œå®¢åˆ¶åŒ–çš„å¼€å‘ã€‚</p><p>æ€»ä¹‹ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åˆé€‚çš„ API ç±»å‹æ˜¯éå¸¸é‡è¦çš„ï¼Œèƒ½å¤Ÿå¿«é€Ÿã€é«˜æ•ˆåœ°æ„å»ºéœ€è¦çš„åº”ç”¨ç¨‹åºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€Œluffy_feã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚</span><br><span class="line">åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/qq_42107247/article/details/130508490</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;APIï¼Œå³åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿åº”ç”¨ç¨‹åºä¹‹é—´çš„æ•°æ®å’ŒåŠŸèƒ½äº¤äº’è€Œè®¾è®¡çš„ä¸€äº›æ ‡å‡†æ–¹æ³•ã€‚API çš„åˆ†ç±»å¯ä»¥ä»å¤šä¸ªç»´åº¦è¿›è¡Œï¼Œæˆ‘ä¼šå¯¹ API çš„åˆ†ç±»ç»´åº¦è¿›è¡Œç®€å•çš„ä»‹ç»ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="API" scheme="https://blog.musnow.top/tags/API/"/>
    
  </entry>
  
  <entry>
    <title>ã€Linuxã€‘é«˜çº§IOå’Œå¤šè·¯è½¬æ¥ | select/poll/epoll</title>
    <link href="https://blog.musnow.top/posts/3390191280/"/>
    <id>https://blog.musnow.top/posts/3390191280/</id>
    <published>2023-08-25T00:22:36.000Z</published>
    <updated>2023-08-25T04:05:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¤šè·¯è½¬æ¥å’Œé«˜çº§IO</p><span id="more"></span><p>å’³å’³ï¼Œå†™çš„æ—¶å€™å‡ºäº†ç‚¹é—®é¢˜ï¼Œæ ‡ç‚¹ç¬¦å·å…¨ä¹±äº†ï¼ˆæ‰¹é‡æ›¿æ¢äº†å‡ æ¬¡ï¼‰ï¼Œå¹²è„†å°±æŠŠå…¨æ–‡çš„é€—å·å’Œå¥å·éƒ½æ”¹æˆè‹±æ–‡çš„äº†ï¼ˆä¸ç„¶ä»£ç å—é‡Œé¢çš„ä»£ç éƒ½æ˜¯ä¸­æ–‡æ ‡ç‚¹å°±è·‘ä¸åŠ¨äº†ï¼‰</p><h1 id="1-é«˜çº§IO"><a href="#1-é«˜çº§IO" class="headerlink" title="1.é«˜çº§IO"></a>1.é«˜çº§IO</h1><h2 id="1-1-äº”ç§IOæ¨¡å‹"><a href="#1-1-äº”ç§IOæ¨¡å‹" class="headerlink" title="1.1 äº”ç§IOæ¨¡å‹"></a>1.1 äº”ç§IOæ¨¡å‹</h2><p>ç”¨é’“é±¼ä½¬çš„æ —å­, æ¥çœ‹çœ‹äº”ç§ä¸åŒçš„IOæ¨¡å‹å§</p><ul><li>A, æ‹¿ç€é±¼ç«¿å»é’“é±¼, ä¸€ç›´ç›¯ç€é±¼æ¼‚, é±¼æ¼‚æœ‰åŠ¨é™å°±æ”¶é’©</li><li>B, æ‹¿ç€é±¼ç«¿å»é’“é±¼, æ—¶ä¸æ—¶çœ‹çœ‹é±¼æ¼‚, æœ‰åŠ¨é™å°±æ”¶è´­</li><li>C, æ‹¿ç€é±¼ç«¿å»é’“é±¼, åœ¨é±¼æ¼‚ä¸Šå¼„ä¸ªé“ƒé“›, ç„¶åå¹²å…¶ä»–çš„äº‹æƒ…, å¬åˆ°é“ƒé“›çš„å£°éŸ³å°±æ”¶é’©</li><li>D, æ‹¿äº†ä¸€å¤§å †é±¼ç«¿è¿‡æ¥, éƒ½æ‘†å¼„å¥½, åªè¦æœ‰ä¸€ä¸ªé±¼æ¼‚æœ‰åŠ¨é™, å°±æ”¶é’©</li><li>Eæ˜¯å¤§è€æ¿, ç›´æ¥å«äººå¸®å¿™é’“é±¼, é’“åˆ°ä¸€å®šæ•°é‡çš„ğŸŸåé€šçŸ¥è‡ªå·±, è‡ªå·±è¿‡æ¥å–ğŸŸï¼ˆæ²¡æœ‰å‚ä¸é’“é±¼è¿‡ç¨‹ï¼‰</li></ul><p>è¿™äº”ç§é’“é±¼æ–¹å¼, å°±å¯¹åº”äº†äº”ç§IOæ¨¡å‹</p><ul><li>A, <strong>é˜»å¡ç­‰å¾…</strong>, ç­‰å¾…åˆ°æ•°æ®å°±ç«‹å³è¯»å–</li><li>B, <strong>è½®è¯¢æ£€æµ‹</strong>, æ£€æµ‹åˆ°æ•°æ®çš„æ—¶å€™è¯»å–</li><li>C, åˆ©ç”¨é“ƒé“›æ¥ä½œä¸ºé€šçŸ¥æ–¹å¼, å¬åˆ°äº†ä¿¡å·ä¹‹å, å°±å»è¯»å–æ•°æ®ï¼ˆ<strong>ä¿¡å·é©±åŠ¨</strong>ï¼‰</li><li>D, ä¸€æ¬¡æ€§æ£€æµ‹å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆ<strong>å¤šè·¯è½¬æ¥</strong>ï¼‰</li><li>E, æ²¡æœ‰è‡ªå·±å‚ä¸é’“é±¼è¿‡ç¨‹, æœ‰åˆ«äººå¸®å¿™ç›‘æ§æ–‡ä»¶æè¿°ç¬¦, è‡ªå·±åªå…³å¿ƒæ‹¿èµ°æ•°æ®ï¼ˆ<strong>å¼‚æ­¥IO</strong>ï¼‰</li></ul><p>åœ¨è¿™äº”ç§IOæ¨¡å¼ä¸­, <strong>Dçš„æ•ˆç‡æ˜¯æœ€é«˜çš„</strong>ã€‚å› ä¸ºå®ƒä¸€æ¬¡æ€§ç›‘æ§äº†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦, è¿™äº›æ–‡ä»¶æè¿°ç¬¦çš„IOåœ¨ä¸€å®šç¨‹åº¦ä¸Šé‡åˆäº†, æ›´å®¹æ˜“ç­‰åˆ°æ•°æ®ã€‚</p><p>è¦çŸ¥é“, Dæ˜¯è¿‡æ¥é’“é±¼çš„, ä»–åªè¦èƒ½é’“åˆ°é±¼å°±å¤Ÿäº†, å¹¶ä¸ç”¨å…³å¿ƒåˆ°åº•æ˜¯å“ªä¸ªé±¼é’©é’“ä¸Šæ¥çš„é±¼ã€‚åŒç†, æˆ‘ä»¬çš„IOæœåŠ¡å™¨ä¹Ÿå¹¶ä¸éœ€è¦å…³å¿ƒåˆ°åº•æ˜¯å“ªä¸ªæ–‡ä»¶æè¿°ç¬¦åœ¨ç»™è‡ªå·±ä¼ é€’ä¿¡æ¯, æˆ‘ä»¬åªè¦æ¯æ—¶æ¯åˆ»éƒ½åœ¨å¤„ç†ä¿¡æ¯ï¼ˆéƒ½èƒ½é’“åˆ°é±¼ï¼‰æ‰æ˜¯æœ€é«˜æ•ˆç‡çš„ä½“ç°ã€‚</p><p>æ¢å¥è¯è¯´, åœ¨é’“é±¼ï¼ˆå¤„ç†IOï¼‰çš„æ—¶å€™, ç­‰çš„æ—¶é—´æ¯”ä¾‹è¶Šä½, æ•ˆç‡è¶Šé«˜ï¼</p><h2 id="1-2-é˜»å¡å’Œéé˜»å¡"><a href="#1-2-é˜»å¡å’Œéé˜»å¡" class="headerlink" title="1.2 é˜»å¡å’Œéé˜»å¡"></a>1.2 é˜»å¡å’Œéé˜»å¡</h2><p>è¿™ä¸¤ä¸ªæ¦‚å¿µæˆ‘ä»¬åœ¨å…ˆå‰å¯¹IOçš„å­¦ä¹ ä¸­å·²ç»è§è¿‡äº†</p><ul><li>é˜»å¡ï¼šè¿›ç¨‹ä¼šåœ¨å‡½æ•°è°ƒç”¨ä¸­å¡ä½, åœ¨æ²¡æœ‰æˆåŠŸè°ƒç”¨ä¹‹å‰ä¸ä¼šç»§ç»­å‘åè¿è¡Œ</li><li>éé˜»å¡ï¼šä¸ç®¡èƒ½å¦è·å–åˆ°æ•°æ®, å‡½æ•°éƒ½æ˜¯ç›´æ¥è¿”å›ç»“æœ;</li></ul><h2 id="1-3-å¼‚æ­¥ä¸åŒæ­¥é€šä¿¡"><a href="#1-3-å¼‚æ­¥ä¸åŒæ­¥é€šä¿¡" class="headerlink" title="1.3 å¼‚æ­¥ä¸åŒæ­¥é€šä¿¡"></a>1.3 å¼‚æ­¥ä¸åŒæ­¥é€šä¿¡</h2><ul><li>å¼‚æ­¥é€šä¿¡ï¼šåœ¨è°ƒç”¨å‘å‡ºå, è¿™ä¸ªè°ƒç”¨ç›´æ¥è¿”å›, å¹¶æ²¡æœ‰æºå¸¦ç»“æœ;ç±»ä¼¼<code>std::async/future</code>, åœ¨è°ƒç”¨å‘å‡ºå, è¢«è°ƒç”¨ç€é€šè¿‡çŠ¶æ€æˆ–é€šçŸ¥æ¥å‘ŠçŸ¥è°ƒç”¨è€…, äº¦æˆ–è€…æ˜¯ç”¨å›è°ƒå‡½æ•°æ¥å¤„ç†è¿™ä¸ªå¼‚æ­¥è°ƒç”¨</li><li>åŒæ­¥é€šä¿¡ï¼šåœ¨å‘å‡ºè°ƒç”¨å, æ²¡æœ‰å¾—åˆ°ç»“æœå‰, è¯¥è°ƒç”¨ä¸è¿”å›;ä¸€æ—¦è¿”å›å°±è¡¨æ˜è¯¥è°ƒç”¨æˆåŠŸè·å–åˆ°äº†è¿”å›å€¼ï¼ˆè°ƒç”¨è€…ä¸»åŠ¨ç­‰å¾…è°ƒç”¨ç»“æœï¼‰</li></ul><p>è¿™é‡Œçš„åŒæ­¥å’Œçº¿ç¨‹&#x2F;è¿›ç¨‹åŒæ­¥å¹¶ä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼š</p><ul><li>çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒæ­¥æŒ‡çš„æ˜¯çº¿ç¨‹å’Œè¿›ç¨‹ä¹‹é—´æœ‰ç›¸äº’åˆ¶çº¦çš„å…³ç³», éœ€è¦åœ¨æŸäº›æƒ…å†µä¸­åè°ƒä»–ä»¬çš„å·¥ä½œæ¬¡åºè€Œè¿›è¡Œç­‰å¾…</li></ul><hr><p>äº†è§£å®ŒIOæ¨¡å‹å’Œä¸Šæ–¹çš„çŸ¥è¯†å, ä¸‹é¢å°±è®©æˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹ç¬¬ä¸€ä¸ªæ¥å£å§ï¼</p><h1 id="2-fcntl"><a href="#2-fcntl" class="headerlink" title="2.fcntl"></a>2.fcntl</h1><p>è¿™ä¸ªæ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨, å¯ä»¥ç»™æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œä¸åŒçš„ç­–ç•¥è®¾ç½®ã€‚</p><p>å½“æˆ‘ä»¬åœ¨linuxä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„æ—¶å€™, é»˜è®¤åˆ›å»ºçš„éƒ½æ˜¯é˜»å¡çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>fcntl</code>æ¥å°†æ–‡ä»¶æè¿°ç¬¦è®¾ç½®æˆ<strong>éé˜»å¡</strong>çš„ã€‚</p><h2 id="2-1-æ¥å£"><a href="#2-1-æ¥å£" class="headerlink" title="2.1 æ¥å£"></a>2.1 æ¥å£</h2><p>è¯¥å‡½æ•°çš„åŸå‹å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">fcntl</span><span class="params">(<span class="type">int</span> fd, <span class="type">int</span> cmd, ... <span class="comment">/* arg */</span> )</span>;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­cmdæ˜¯æˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„ç­–ç•¥, ä¸‹é¢æ˜¯å¸¸è§çš„å‡ ç§é€‰é¡¹</p><ul><li>å¤åˆ¶ä¸€ä¸ªç°æœ‰çš„æè¿°ç¬¦ï¼ˆcmd&#x3D;F_DUPFDï¼‰</li><li>è·å¾—&#x2F;è®¾ç½®æ–‡ä»¶æè¿°ç¬¦æ ‡è®°(cmd&#x3D;F_GETFDæˆ–F_SETFD)</li><li>è·å¾—&#x2F;è®¾ç½®æ–‡ä»¶çŠ¶æ€æ ‡è®°(cmd&#x3D;F_GETFLæˆ–F_SETFL)</li><li>è·å¾—&#x2F;è®¾ç½®å¼‚æ­¥I&#x2F;Oæ‰€æœ‰æƒ(cmd&#x3D;F_GETOWNæˆ–F_SETOWN)</li><li>è·å¾—&#x2F;è®¾ç½®è®°å½•é”(cmd&#x3D;F_GETLK, F_SETLKæˆ–F_SETLKW)</li></ul><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ç¬¬ä¸‰ä¸ªåŠŸèƒ½, æ¥è·å–å’Œè®¾ç½®æ–‡ä»¶çš„çŠ¶æ€æ ‡è®°, å°±å¯ä»¥å°†æ–‡ä»¶æè¿°ç¬¦è®¾ç½®ä¸ºéé˜»å¡ï¼ˆè¿™é‡Œè¦æ³¨æ„, ä¸æ˜¯ç”¨ç¬¬äºŒç§ï¼‰</p><h2 id="2-2-è®¾ç½®éé˜»å¡"><a href="#2-2-è®¾ç½®éé˜»å¡" class="headerlink" title="2.2 è®¾ç½®éé˜»å¡"></a>2.2 è®¾ç½®éé˜»å¡</h2><p>æˆ‘ä»¬éœ€è¦å…ˆå°†æ–‡ä»¶æè¿°ç¬¦åŸæœ¬çš„å±æ€§ç»™å–å‡ºæ¥, ç„¶åå†åŠ ä¸Šéé˜»å¡çš„çŠ¶æ€, ä½¿ç”¨<code>fcntl</code>è®¾ç½®å±æ€§ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">SetNoBlock</span><span class="params">(<span class="type">int</span> fd)</span> </span><br><span class="line">&#123; </span><br><span class="line">    <span class="type">int</span> fl = fcntl(fd, F_GETFL);  <span class="comment">// å…ˆè·å–æ–‡ä»¶å·²æœ‰çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">if</span> (fl &lt; <span class="number">0</span>) &#123; </span><br><span class="line">       perror(<span class="string">&quot;fcntl error&quot;</span>);</span><br><span class="line">       <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åœ¨å·²æœ‰çŠ¶æ€çš„åŸºç¡€ä¸Š, è®¾ç½®O_NONBLOCKéé˜»å¡</span></span><br><span class="line">    fcntl(fd, F_SETFL, fl | O_NONBLOCK);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-3-stdinæµ‹è¯•"><a href="#2-3-stdinæµ‹è¯•" class="headerlink" title="2.3 stdinæµ‹è¯•"></a>2.3 stdinæµ‹è¯•</h2><p>ç„¶å, æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªä¼šå‡ºç°é˜»å¡çš„æ–‡ä»¶æè¿°ç¬¦æ¥ä½œä¸ºæµ‹è¯•ã€‚ä½†æ˜¯, å¦‚æœæ˜¯ç›´æ¥æ‰“å¼€ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶, å¹¶ä¸ä¼šå‡ºç°é˜»å¡æ€ï¼ˆå› ä¸ºæ–‡ä»¶æµä¼šè¢«ä¸€æ¬¡æ€§è¯»å–å‡ºæ¥ï¼‰</p><p>ä¸è¿‡, åœ¨æˆ‘ä»¬æœ€å¸¸ç”¨çš„3ä¸ªé»˜è®¤æ–‡ä»¶æè¿°ç¬¦ä¸­, å°±æœ‰ä¸€ä¸ªæ˜¯èƒ½å¤Ÿå®ç°è¿›ç¨‹é˜»å¡çš„, å®ƒå°±æ˜¯<code>stdin</code>, å› ä¸ºåœ¨æ§åˆ¶å°é‡Œé¢ç­‰å¾…ç”¨æˆ·è¾“å…¥çš„æ—¶å€™, è¿›ç¨‹å°±æ˜¯å¤„äºé˜»å¡çŠ¶æ€çš„ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">è¯·è¾“å…¥ï¼š</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥å°è¯•å°†stdinè®¾ç½®ä¸ºéé˜»å¡, æ¥è§‚å¯Ÿä¸€ä¸‹ç»“æœ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">SetNoBlock</span>(stdin-&gt;_fileno);</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">ssize_t</span> read_size = <span class="built_in">read</span>(stdin-&gt;_fileno, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(read_size &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;read err&quot;</span>);</span><br><span class="line">            <span class="built_in">sleep</span>(<span class="number">2</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;input:%s\n&quot;</span>, buf);</span><br><span class="line">        buf[<span class="number">0</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘è¿è¡Œ, å½“æ²¡æœ‰è¯»å–åˆ°è¾“å…¥å†…å®¹çš„æ—¶å€™, å¹¶ä¸ä¼šåœ¨<code>stdin</code>ä¸­é˜»å¡, è€Œæ˜¯ä¼šé€šè¿‡perroræ‰“å°å‡ºèµ„æºæš‚æ—¶ä¸å¯ç”¨çš„è­¦å‘Šä¿¡æ¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">read err: Resource temporarily unavailable</span><br><span class="line">asdlfjklaf</span><br><span class="line">input:asdlfjklaf</span><br><span class="line"></span><br><span class="line">read err: Resource temporarily unavailable</span><br><span class="line">adslfkjaldfjklasjfa</span><br><span class="line">input:adslfkjaldfjklasjfa</span><br><span class="line">a</span><br><span class="line">read err: Resource temporarily unavailable</span><br><span class="line">ewqrqreqqrwer</span><br><span class="line">input:ewqrqreqqrwer</span><br><span class="line">asjfa</span><br><span class="line">a</span><br><span class="line">read err: Resource temporarily unavailable</span><br><span class="line">qweioruqoruioqewur</span><br><span class="line">input:qweioruqoruioqewur</span><br><span class="line"></span><br><span class="line">a</span><br><span class="line">read err: Resource temporarily unavailable</span><br><span class="line">weqioruqoieuotqitqwertq</span><br><span class="line">input:weqioruqoieuotqitqwertq</span><br><span class="line">ï¿½ï¿½ï¿½ï¿½a</span><br><span class="line">read err: Resource temporarily unavailable</span><br><span class="line">^C</span><br></pre></td></tr></table></figure><h1 id="3-å¤šè·¯è½¬æ¥ä¹‹select"><a href="#3-å¤šè·¯è½¬æ¥ä¹‹select" class="headerlink" title="3.å¤šè·¯è½¬æ¥ä¹‹select"></a>3.å¤šè·¯è½¬æ¥ä¹‹select</h1><p>æ¥ä¸‹æ¥å°±è¦è¿›å…¥æˆ‘ä»¬çš„æ­£é¢˜äº†, å…³äº<strong>å¤šè·¯è½¬æ¥</strong>çš„çŸ¥è¯†ã€‚</p><p>åœ¨ä¹‹å‰çš„æ—¶å€™, æˆ‘ä»¬å¦‚æœæƒ³åœ¨ä¸€ä¸ªè¿›ç¨‹é‡Œé¢ç»´æŠ¤å¤šä¸ªtcpé“¾æ¥, å°±éœ€è¦ç”¨åˆ°å­çº¿ç¨‹æˆ–è€…å­è¿›ç¨‹æ¥å•ç‹¬ä¸ºæ¯ä¸€ä¸ªç”¨æˆ·æä¾›æœåŠ¡ã€‚<strong>ä½†ä¸€ä¸ªè¿›ç¨‹å¯ä»¥å¼€çš„çº¿ç¨‹æ˜¯æœ‰æ•°é‡é™åˆ¶çš„</strong>, åœ¨32ä½ç³»ç»Ÿä¸­, è¿™ä¸ªæ•°å­—å¤§æ¦‚æ˜¯2000ã€‚</p><p>å¯¹äºä¸€ä¸ªé«˜å¹¶å‘çš„æœåŠ¡å™¨æ¥è¯´, è¿™ç‚¹çº¿ç¨‹æ•°æ˜¯å®Œå…¨ä¸å¤Ÿç”¨çš„ï¼å¦‚æœä½ çš„ç½‘ç«™ä¸€æ¬¡æ€§æœ‰2000ä¸ªäººè®¿é—®, ä½ çš„æœåŠ¡å™¨å°±ä¼šå› ä¸ºå¼€ä¸å‡ºæ›´å¤šçš„çº¿ç¨‹è€Œæ— æ³•ä¸ºæ›´å¤šçš„ç”¨æˆ·æä¾›æœåŠ¡ï¼</p><p>æ‰€ä»¥, <strong>å¤šè·¯è½¬æ¥</strong>å°±å‡ºç°äº†, ä»–èƒ½å¸®æˆ‘ä»¬å®ç°å•ä¸ªè¿›ç¨‹ç›‘æ§å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦, åŒæ—¶ä¸ºå¤šä¸ªsocketé“¾æ¥æä¾›æœåŠ¡çš„æ“ä½œï¼</p><blockquote><p>æ™®é€šçš„æœ¬åœ°æ–‡ä»¶æè¿°ç¬¦ä¹Ÿæ˜¯å¯ä»¥æ‰˜ç®¡ç»™å¤šè·¯è½¬æ¥çš„ï¼</p></blockquote><h2 id="3-1-è®¤è¯†select"><a href="#3-1-è®¤è¯†select" class="headerlink" title="3.1 è®¤è¯†select"></a>3.1 è®¤è¯†select</h2><p>selectçš„å‡½æ•°åŸå‹å’Œæˆ‘ä»¬ä¹‹å‰æ¥è§¦è¿‡çš„linuxç³»ç»Ÿè°ƒç”¨æ¥å£éƒ½ä¸å¤§ç›¸ä¼¼, å®ƒçš„æ‰€æœ‰å‚æ•°éƒ½æ˜¯è¾“å…¥è¾“å‡ºå‹å‚æ•°, è€Œä¸”è¿˜ç”¨åˆ°äº†ä¸€ä¸ªæˆ‘ä»¬å¹³æ—¶è¾ƒå°‘æ¥è§¦çš„æ•°æ®ç»“æ„â€”â€”ä½å›¾</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* According to POSIX.1-2001, POSIX.1-2008 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/select.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">select</span><span class="params">(<span class="type">int</span> nfds, fd_set *readfds, fd_set *writefds, </span></span></span><br><span class="line"><span class="params"><span class="function">           fd_set *exceptfds, <span class="keyword">struct</span> timeval *timeout)</span></span>;</span><br></pre></td></tr></table></figure><p>å…ˆæ¥ä¾æ¬¡è¯´æ˜ä¸€ä¸‹æ¯ä¸€ä¸ªå‚æ•°çš„ä½œç”¨å§</p><ul><li><code>nfds</code>ï¼šéœ€è¦selectå¸®æˆ‘ä»¬ç›‘è§†çš„<code>æœ€å¤§æ–‡ä»¶æè¿°ç¬¦+1</code></li><li><code>readfds/writefds/exceptfds</code>, éœ€è¦selectå¸®æˆ‘ä»¬æ£€æµ‹çš„è¯»&#x2F;å†™&#x2F;å¼‚å¸¸æ–‡ä»¶æè¿°ç¬¦ï¼ˆé€šè¿‡<strong>ä½å›¾</strong>æ¥è®¾å®šï¼‰</li><li><code>timeout</code>ï¼šé˜»å¡ç›‘æ§çš„æ—¶é•¿, ç”¨æ¥è®¾ç½®selectå•æ¬¡é˜»å¡ç­‰å¾…çš„æ—¶é—´</li></ul><h3 id="3-1-1-timeval"><a href="#3-1-1-timeval" class="headerlink" title="3.1.1 timeval"></a>3.1.1 timeval</h3><p>é¦–å…ˆæ¥çœ‹çœ‹timeoutçš„è¿™ä¸ªå‚æ•°çš„<code>struct timeval</code>ç»“æ„ä½“æ¡†æ¶, å†…éƒ¨åŒ…å«ä¸¤ä¸ªæˆå‘˜å˜é‡, ä¸€ä¸ªè¡¨ç¤ºç§’æ•°, ä¸€ä¸ªè¡¨ç¤ºå¾®ç§’æ•°ã€‚æœ€ç»ˆselectç­‰å¾…çš„æ—¶é—´æ˜¯è¿™ä¸¤ä¸ªå‚æ•°çš„<strong>å’Œ</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> &#123;</span></span><br><span class="line">    <span class="type">long</span>    tv_sec;         <span class="comment">/* seconds */</span></span><br><span class="line">    <span class="type">long</span>    tv_usec;        <span class="comment">/* microseconds */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœè®¾ç½®æˆ0, åˆ™ä»…æ£€æµ‹æ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€, ä¸ç®¡ä»€ä¹ˆæƒ…å†µéƒ½ä¼šç«‹å³è¿”å›ï¼ˆå®Œå…¨éé˜»å¡ï¼‰</li><li>å¦‚æœè®¾ç½®æˆæŒ‡å®šçš„æ—¶é—´, åˆ™ä¼šé˜»å¡ç­‰å¾…è¿™ç«¯æ—¶é—´, å¦‚æœæœ‰æ–‡ä»¶äº‹ä»¶åˆ™è¿”å›;å¦‚æœæ²¡æœ‰ç­‰åˆ°æ–‡ä»¶æ—¶é—´, é‚£ä¹ˆæ—¶é—´åˆ°äº†å°±ä¼šè¿”å›</li><li>å¦‚æœå°†<code>timeout</code>å‚æ•°è®¾ç½®æˆ<code>nullptr</code>, åˆ™ä¼š<strong>é˜»å¡ç­‰å¾…</strong></li></ul><p>è¿™ä¸ªå‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ªè¾“å…¥è¾“å‡ºå‹å‚æ•°, è¿”å›å€¼ä¸ºå‰©ä½™çš„ç§’æ•°ï¼ˆå¦‚æœç­‰å¾…æˆåŠŸçš„è¯ï¼‰</p><h3 id="3-1-2-fd-set"><a href="#3-1-2-fd-set" class="headerlink" title="3.1.2 fd_set"></a>3.1.2 fd_set</h3><p>å‡½æ•°ä¸­æœ‰3ä¸ªå‚æ•°éƒ½æ˜¯ç”¨åˆ°äº†è¿™ä¸ª<code>fd_set</code>ç»“æ„, å®ƒæ˜¯ä¸€ä¸ªä½å›¾ç»“æ„, åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªè¾“å…¥è¾“å‡ºå‚æ•°</p><ul><li>è¾“å…¥ï¼šç”¨æˆ·å‘Šè¯‰æ“ä½œç³»ç»Ÿ, éœ€è¦å¸®æˆ‘ç›‘æ§é‚£å‡ ä¸ªæ–‡ä»¶æè¿°ç¬¦, åœ¨éœ€è¦ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦ä¸Šç½®1</li><li>è¾“å‡ºï¼šç³»ç»Ÿå‘Šè¯‰ç”¨æˆ·, é‚£äº›æ–‡ä»¶æè¿°ç¬¦çš„ç›¸å…³äº‹ä»¶å°±ç»ªäº†</li></ul><p>è™½ç„¶è¿™æ˜¯ä¸€ä¸ªä½å›¾ç»“æ„, ä½†å…¶å¹¶ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»è®¾ç½®, æ“ä½œç³»ç»Ÿé¡ºä¾¿å¸®æˆ‘ä»¬å°è£…äº†ç›¸å…³çš„è®¾ç½®â€œå‡½æ•°â€, åªéœ€è¦ä¼ å…¥fdå’Œè¯¥ç»“æ„ä½“å³å¯</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">FD_CLR</span><span class="params">(<span class="type">int</span> fd, fd_set *set)</span></span>;  <span class="comment">// æ¸…ç©ºä½å›¾ä¸­å¯¹è¯¥æ–‡ä»¶æè¿°ç¬¦çš„è®¾ç½®</span></span><br><span class="line"><span class="function"><span class="type">int</span>  <span class="title">FD_ISSET</span><span class="params">(<span class="type">int</span> fd, fd_set *set)</span></span>;<span class="comment">// åˆ¤æ–­æ˜¯å¦è¢«è®¾ç½®äº†</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FD_SET</span><span class="params">(<span class="type">int</span> fd, fd_set *set)</span></span>;  <span class="comment">// è®¾ç½®å¯¹åº”ä½ç½®çš„æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FD_ZERO</span><span class="params">(fd_set *set)</span></span>;         <span class="comment">// æ¸…ç©ºæ•´ä¸ªä½å›¾</span></span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½å›è§‰å¾—å¥‡æ€ª, ä¸ºä»€ä¹ˆè¿™äº›â€œå‡½æ•°â€æ˜¯å¤§å†™çš„å‘¢ï¼ŸLinuxä¸­å¤§å†™çš„åº”è¯¥æ˜¯å®æ‰å¯¹å§ï¼Ÿ</p><p>ç­”å¯¹äº†ï¼è¿™é‡Œçš„è®¾ç½®å‡½æ•°å…¶å®éƒ½æ˜¯å®å®šä¹‰ï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Access macros for `fd_set&#x27;.  */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>FD_SET(fd, fdsetp)__FD_SET (fd, fdsetp)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>FD_CLR(fd, fdsetp)__FD_CLR (fd, fdsetp)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>FD_ISSET(fd, fdsetp)__FD_ISSET (fd, fdsetp)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>FD_ZERO(fdsetp)__FD_ZERO (fdsetp)</span></span><br></pre></td></tr></table></figure><p>æ—¢ç„¶æ˜¯ä¸€ä¸ªé¢„å®šä¹‰å¥½çš„ä½å›¾, é‚£ä¹ˆå®ƒçš„é•¿åº¦å°±ä¼šæ”¶åˆ°æ“ä½œç³»ç»Ÿåº•å±‚çš„ä¸€å®šé™åˆ¶, ä»¥ä¸‹ä¸ºæºä»£ç ä¸­<code>fd_set</code>ç»“æ„ä½“çš„å®šä¹‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·¯å¾„ usr/include/sys/select.h</span></span><br><span class="line"><span class="comment">/* The fd_set member is required to be an array of longs.  */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">int</span> __fd_mask;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Some versions of &lt;linux/posix_types.h&gt; define this macros.  */</span></span><br><span class="line"><span class="meta">#<span class="keyword">undef</span>__NFDBITS</span></span><br><span class="line"><span class="comment">/* It&#x27;s easier to assume 8-bit bytes than to get CHAR_BIT.  */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __NFDBITS(8 * (int) sizeof (__fd_mask))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>__FD_ELT(d)((d) / __NFDBITS)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>__FD_MASK(d)((__fd_mask) (1UL &lt;&lt; ((d) % __NFDBITS)))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* fd_set for select and pselect.  */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">  &#123;</span></span><br><span class="line">    <span class="comment">/* XPG4.2 requires this member name.  Otherwise avoid the name</span></span><br><span class="line"><span class="comment">       from the global namespace.  */</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __USE_XOPEN</span></span><br><span class="line">    __fd_mask fds_bits[__FD_SETSIZE / __NFDBITS];</span><br><span class="line"><span class="meta"># <span class="keyword">define</span> __FDS_BITS(set) ((set)-&gt;fds_bits)</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    __fd_mask __fds_bits[__FD_SETSIZE / __NFDBITS];</span><br><span class="line"><span class="meta"># <span class="keyword">define</span> __FDS_BITS(set) ((set)-&gt;__fds_bits)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  &#125; fd_set;</span><br></pre></td></tr></table></figure><p>åœ¨å¦å¤–ä¸€ä¸ªå¤´æ–‡ä»¶ä¸­, å¯ä»¥æ‰¾åˆ°<code>__FD_SETSIZE</code>è¿™ä¸ªå®çš„å®šä¹‰, æ˜¯1024;ä¹Ÿå°±æ˜¯è¯´, <code>fd_set</code>è¿™ä¸ªä½å›¾æœ€å¤§çš„é•¿åº¦åªæœ‰1024ä¸ªæ¯”ç‰¹ä½, æˆ‘ä»¬ä¹Ÿåªèƒ½ç›‘çœ‹è¿™ä¹ˆå¤šæ–‡ä»¶æè¿°ç¬¦ï¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·¯å¾„ usr/include/bits/typesizes.h</span></span><br><span class="line"><span class="comment">/* Number of descriptors that can fit in an `fd_set&#x27;.  */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __FD_SETSIZE1024</span></span><br></pre></td></tr></table></figure><p>è¿™ä¹Ÿæ˜¯<code>select</code>çš„ç¼ºç‚¹ä¹‹ä¸€, åŒæ—¶ç›‘çœ‹çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡æ˜¯<strong>æœ‰é™åˆ¶</strong>çš„ï¼</p><h3 id="3-1-3-nfds"><a href="#3-1-3-nfds" class="headerlink" title="3.1.3 nfds"></a>3.1.3 nfds</h3><p>è¿™ä¸ªå‚æ•°æ˜¯selectéœ€è¦å¸®æˆ‘ä»¬ç›‘çœ‹çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦+1, è¿™æ˜¯å› ä¸ºselectåœ¨ç›‘çœ‹çš„è¿‡ç¨‹ä¸­éœ€è¦ç”¨å¾ªç¯æ¥è¿›è¡Œæ£€æµ‹, è¿™ä¸ªæœ€å¤§æ–‡ä»¶æè¿°ç¬¦+1ç›¸å½“äºæ˜¯ä¸€ä¸ªå¾ªç¯çš„è¾¹ç•Œæ¡ä»¶;</p><p>ä½ åªéœ€æ ¹æ®å½“å‰å·²æœ‰çš„æ–‡ä»¶æè¿°ç¬¦å·, è®¡ç®—å‡ºæœ€å¤§æ–‡ä»¶æè¿°ç¬¦, å†åŠ ä¸€ä¼ ç»™è¿™ä¸ªå‡½æ•°å³å¯ã€‚</p><h3 id="3-1-4-è¿”å›å€¼"><a href="#3-1-4-è¿”å›å€¼" class="headerlink" title="3.1.4 è¿”å›å€¼"></a>3.1.4 è¿”å›å€¼</h3><p>manæ‰‹å†Œä¸­å¯¹è¿”å›å€¼çš„æè¿°å¦‚ä¸‹</p><ul><li>æˆåŠŸçš„æ—¶å€™, è¿”å›äº‹ä»¶å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡</li><li>å¤±è´¥çš„æ—¶å€™è¿”å›<code>-1</code>, å¹¶è®¾ç½®errno</li><li>å¦‚æœå·²ç»<code>timeout</code>äº†è¿˜æ²¡æœ‰äº‹ä»¶å°±ç»ª, è¿”å›0</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RETURN VALUE</span><br><span class="line">       On success, select() and pselect() return the number of file descriptors contained in the three returned descriptor  sets  (that  is,  the total  number  of  bits that are set in readfds, writefds, exceptfds) which may be zero if the timeout expires before anything interesting happens.  On error, -1 is returned, and errno is set to indicate the error; the file descriptor sets are unmodified, and  timeout becomes undefined.</span><br></pre></td></tr></table></figure><h2 id="3-2-å®ä¾‹"><a href="#3-2-å®ä¾‹" class="headerlink" title="3.2 å®ä¾‹"></a>3.2 å®ä¾‹</h2><p>å‡½æ•°åŸå‹çœ‹å®Œäº†, å¾—ä»å®ä¾‹å‡ºå‘æ¥è¯•è¯•äº†</p><h3 id="3-2-1-socket"><a href="#3-2-1-socket" class="headerlink" title="3.2.1 socket"></a>3.2.1 socket</h3><p>è¿™é‡Œå…ˆå¯¹<span id="jump-select">socket</span>åšäº†ä¸€ä¸ªç®€å•çš„å°è£…, åŒ…æ‹¬åˆå§‹åŒ–, ç»‘å®šç›¸å…³çš„æ¥å£, åªéœ€è¦åœ¨å¦å¤–ä¸€ä¸ªæ–‡ä»¶é‡Œé¢è°ƒç”¨è¿™ä¸ªå¤´æ–‡ä»¶å³å¯ !</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Sock.hpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cerrno&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Sock</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> gbacklog = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">SocketInit</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> listenSock = <span class="built_in">socket</span>(PF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (listenSock &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è®¾ç½®ç«¯å£å¤ç”¨, é¿å…timewaité˜»å¡ç«¯å£</span></span><br><span class="line">        <span class="type">int</span> opt = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">setsockopt</span>(listenSock, SOL_SOCKET, SO_REUSEADDR | SO_REUSEPORT, &amp;opt, <span class="built_in">sizeof</span>(opt));</span><br><span class="line">        <span class="keyword">return</span> listenSock;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">Bind</span><span class="params">(<span class="type">int</span> socket, <span class="type">uint16_t</span> port)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> local; <span class="comment">// ç”¨æˆ·æ ˆ</span></span><br><span class="line">        <span class="built_in">memset</span>(&amp;local, <span class="number">0</span>, <span class="keyword">sizeof</span> local);</span><br><span class="line">        local.sin_family = PF_INET;</span><br><span class="line">        local.sin_port = <span class="built_in">htons</span>(port);</span><br><span class="line">        local.sin_addr.s_addr = INADDR_ANY;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.2 æœ¬åœ°socketä¿¡æ¯, å†™å…¥sock_å¯¹åº”çš„å†…æ ¸åŒºåŸŸ</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">bind</span>(socket, (<span class="type">const</span> <span class="keyword">struct</span> sockaddr *)&amp;local, <span class="built_in">sizeof</span>(local)) &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">Listen</span><span class="params">(<span class="type">int</span> socket)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">listen</span>(socket, gbacklog) &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">Accept</span><span class="params">(<span class="type">int</span> socket, std::string *clientip, <span class="type">uint16_t</span> *clientport)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> peer;</span><br><span class="line">        <span class="type">socklen_t</span> len = <span class="built_in">sizeof</span>(peer);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> serviceSock = <span class="built_in">accept</span>(socket, (<span class="keyword">struct</span> sockaddr *)&amp;peer, &amp;len);</span><br><span class="line">        <span class="keyword">if</span> (serviceSock &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// è·å–é“¾æ¥å¤±è´¥</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(clientport) *clientport = <span class="built_in">ntohs</span>(peer.sin_port);</span><br><span class="line">        <span class="keyword">if</span>(clientip) *clientip = <span class="built_in">inet_ntoa</span>(peer.sin_addr);</span><br><span class="line">        <span class="keyword">return</span> serviceSock;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¦å¤–é‡ç‚¹è¯´æ˜ä¸€ä¸‹è¿™ä¸¤è¡Œ, åœ¨ä¹‹å‰å­¦ä¹ tcpæœåŠ¡å™¨çš„æ—¶å€™å°±æåˆ°è¿‡, è¿™é‡Œçš„<code>SO_REUSEADDR</code>æ˜¯è®©ç«¯å£å¯ä»¥è¢«å¤ç”¨, ä¸ä¼šå› ä¸ºå­˜åœ¨<code>TIME_WAIT</code>çš„é“¾æ¥è€Œæ— æ³•ç»‘å®šç«¯å£ã€‚é€‚ç”¨äºæœåŠ¡å™¨å¿«é€Ÿé‡å¯çš„æƒ…å†µã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®ç«¯å£å¤ç”¨, é¿å…timewaité˜»å¡ç«¯å£</span></span><br><span class="line"><span class="type">int</span> opt = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">setsockopt</span>(listenSock, SOL_SOCKET, SO_REUSEADDR | SO_REUSEPORT, &amp;opt, <span class="built_in">sizeof</span>(opt));</span><br></pre></td></tr></table></figure><h3 id="3-2-2-åˆå§‹åŒ–"><a href="#3-2-2-åˆå§‹åŒ–" class="headerlink" title="3.2.2 åˆå§‹åŒ–"></a>3.2.2 åˆå§‹åŒ–</h3><p>è¿˜æ˜¯è€ä¸€å¥—, é€šè¿‡å‘½ä»¤è¡Œå‚æ•°è·å–åˆ°ç«¯å£å·, åˆ›å»ºsocket_fdå¹¶ç»‘å®šç«¯å£å’Œå¼€å§‹<code>listen</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="built_in">cmd_usage</span>(argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–socket, è·å–socket fdå¹¶ç»‘å®šç«¯å£</span></span><br><span class="line">    <span class="type">int</span> listensock = Sock::<span class="built_in">SocketInit</span>();</span><br><span class="line">    Sock::<span class="built_in">Bind</span>(listensock, <span class="built_in">atoi</span>(argv[<span class="number">1</span>]));</span><br><span class="line">    Sock::<span class="built_in">Listen</span>(listensock); <span class="comment">// å¼€å§‹ç›‘å¬</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯, åœ¨selectä¸­çš„æ–‡ä»¶æè¿°ç¬¦éƒ½åªå‰©ä½å›¾äº†, æ‰€ä»¥æˆ‘ä»¬å¿…é¡»è¦æœ‰ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶æè¿°ç¬¦æ•°ç»„æ¥ååŠ©æˆ‘ä»¬ç®¡ç†æ­£åœ¨ç»´æŠ¤çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</p><p>è¿™é‡Œä¸ºäº†æ–¹ä¾¿, æˆ‘è®¾ç«‹äº†ä¸€ä¸ªå…¨å±€çš„æ•°ç»„å˜é‡, é•¿åº¦ä¸º<code>sizeof(fd_set) * 8</code>, æ˜¯<code>fd_set</code>è¿™ä¸ªä½å›¾ç»“æ„ä½“èƒ½å¤Ÿæ”¯æŒçš„æœ€å¤§socketæ•°é‡</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> fdsArray[<span class="built_in">sizeof</span>(fd_set) * <span class="number">8</span>] = &#123;<span class="number">0</span>&#125;; <span class="comment">// ä¿å­˜å†å²ä¸Šæ‰€æœ‰çš„åˆæ³•fd</span></span><br><span class="line"><span class="type">int</span> fdsArraySz = <span class="built_in">sizeof</span>(fdsArray) / <span class="built_in">sizeof</span>(fdsArray[<span class="number">0</span>]);</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DFL_FD -1 <span class="comment">// æ•°ç»„ä¸­é»˜è®¤å€¼</span></span></span><br></pre></td></tr></table></figure><p>åœ¨mainå‡½æ•°ä¸­, æˆ‘ä»¬éœ€è¦é€šè¿‡éå†æ¥å°†è¿™ä¸ªæ•°ç»„è®¾ç½®ä¸ºé»˜è®¤çš„æ–‡ä»¶æè¿°ç¬¦<code>-1</code>æ¥è¡¨æ˜å½“å‰ä½ç½®æ²¡æœ‰è¢«ä½¿ç”¨, å¹¶å°†0ä¸‹æ ‡å¤„è®¾ç½®ä¸º<code>listensock</code>;å¦‚æœä½ ä½¿ç”¨çš„æ˜¯vector, åˆ™å¯ä»¥ç›´æ¥ç”¨æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–;</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†æ•°ç»„é‡Œé¢çš„æ–‡ä»¶æè¿°ç¬¦éƒ½åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼, å¹¶å°†ç¬¬ä¸€ä¸ªä¸‹æ ‡è®¾ç½®ä¸ºlistensocket</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; fdsArraySz; i++)&#123;</span><br><span class="line">    fdsArray[i] = DFL_FD;</span><br><span class="line">&#125;</span><br><span class="line">fdsArray[<span class="number">0</span>] = listensock;</span><br></pre></td></tr></table></figure><h3 id="3-2-3-ç›‘å¬"><a href="#3-2-3-ç›‘å¬" class="headerlink" title="3.2.3 ç›‘å¬"></a>3.2.3 ç›‘å¬</h3><p>åˆå§‹åŒ–å®Œæ¯•æ•°ç»„å, å°±å¯ä»¥å¼€å§‹å¾ªç¯è°ƒç”¨<code>select</code>æ¥è¿›è¡Œç›‘å¬äº†ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯, å› ä¸º<code>select</code>çš„<code>fd_set</code>æ˜¯ä¸€ä¸ªä½å›¾, è€Œä¸”æ˜¯è¾“å…¥è¾“å‡ºå‚æ•°ã€‚æ¯æ¬¡çš„<code>select</code>è°ƒç”¨ä¹‹å, è¿™äº›ä½å›¾å°±ä¼šè¢«æ“ä½œç³»ç»Ÿä¿®æ”¹ä¸ºå·²ç»å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆå³å‚æ•°æœ¬èº«ä¼šè¢«ä¿®æ”¹ï¼‰æ‰€ä»¥æˆ‘ä»¬ä¸‹ä¸€æ¬¡è°ƒç”¨ä¹‹å‰, <strong>éœ€è¦é‡æ–°è®¾ç½®ä½å›¾å‚æ•°</strong>ï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼€å§‹ç›‘å¬</span></span><br><span class="line">fd_set readfds;</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> maxFd = DFL_FD;</span><br><span class="line">    <span class="built_in">FD_ZERO</span>(&amp;readfds); <span class="comment">// æ¸…ç©ºä½å›¾</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">timeval</span> timeout = &#123;<span class="number">5</span>, <span class="number">0</span>&#125;; <span class="comment">// è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º5ç§’</span></span><br><span class="line">    <span class="comment">// éå†å…¨å±€æ•°ç»„, å°†æœ‰æ•ˆçš„fdéƒ½æ·»åŠ è¿›å», å¹¶æ›´æ–°maxfd</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; fdsArraySz; i++)</span><br><span class="line">    &#123;   </span><br><span class="line">        <span class="comment">// 1. è¿‡æ»¤ä¸åˆæ³•çš„fd</span></span><br><span class="line">        <span class="keyword">if</span> (fdsArray[i] == DFL_FD) <span class="keyword">continue</span>;   </span><br><span class="line">        <span class="comment">// 2. æ·»åŠ æ‰€æœ‰çš„åˆæ³•çš„fdåˆ°readfdsä¸­, æ–¹ä¾¿selectç»Ÿä¸€è¿›è¡Œå°±ç»ªç›‘å¬</span></span><br><span class="line">        <span class="built_in">FD_SET</span>(fdsArray[i], &amp;readfds); </span><br><span class="line">        <span class="keyword">if</span> (maxFd &lt; fdsArray[i]) &#123;</span><br><span class="line">            maxFd = fdsArray[i]; <span class="comment">// 3. æ›´æ–°å‡ºfdæœ€å¤§å€¼</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è°ƒç”¨selectå¼€å§‹ç›‘å¬</span></span><br><span class="line">    <span class="type">int</span> sret = <span class="built_in">select</span>(maxFd+<span class="number">1</span>, &amp;readfds, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>, &amp;timeout);</span><br><span class="line">    <span class="keyword">switch</span> (sret)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>: <span class="comment">// ç­‰å¾…è¶…æ—¶</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;time out ... : &quot;</span> &lt;&lt; (<span class="type">unsigned</span> <span class="type">long</span>)<span class="built_in">time</span>(<span class="literal">nullptr</span>) &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">-1</span>:<span class="comment">// ç­‰å¾…å¤±è´¥</span></span><br><span class="line">        cerr &lt;&lt; errno &lt;&lt; <span class="string">&quot; : &quot;</span> &lt;&lt; <span class="built_in">strerror</span>(errno) &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="comment">// ç­‰å¾…æˆåŠŸ</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;wait success: &quot;</span> &lt;&lt; sret &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸºæœ¬æ¡†æ¶æ­èµ·æ¥äº†, æˆ‘ä»¬è¿™æ—¶å€™å°±åªéœ€è¦å®ç°ç­‰å¾…æˆåŠŸåå–å‡ºé“¾æ¥å’ŒIOä¿¡æ¯çš„æ“ä½œäº†;</p><p>å…ˆæ¥æµ‹è¯•ä¸€ä¸‹å½“å‰çš„æ‰‹è„šæ¶å§</p><h3 id="3-2-4-æ‰‹è„šæ¶æµ‹è¯•"><a href="#3-2-4-æ‰‹è„šæ¶æµ‹è¯•" class="headerlink" title="3.2.4 æ‰‹è„šæ¶æµ‹è¯•"></a>3.2.4 æ‰‹è„šæ¶æµ‹è¯•</h3><p>ç¼–è¯‘å¯åŠ¨, ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°æ¥ç»‘å®šç«¯å£, åœ¨æ²¡æœ‰æ”¶åˆ°æ•°æ®ä¹‹å‰, è¿›ç¨‹ä¼šåœ¨selectä¸­é˜»å¡ç­‰å¾…5ç§’, éšåå› ä¸ºè¶…æ—¶è·³å‡ºé˜»å¡æ€, è¿”å›0å¹¶æ‰“å°å½“å‰æ—¶é—´æˆ³</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ g++ main.cpp -o test</span><br><span class="line">$ ./test 10000</span><br><span class="line">time out ... : 1692955522</span><br><span class="line">time out ... : 1692955527</span><br><span class="line">time out ... : 1692955532</span><br><span class="line">time out ... : 1692955537</span><br><span class="line">time out ... : 1692955542</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>telnet</code>å‘½ä»¤æ¥é“¾æ¥å½“å‰æœåŠ¡, <code>select</code>æ£€æµ‹åˆ°listensockæ–‡ä»¶æè¿°ç¬¦å°±ç»ª, ä¼šç«‹åˆ»è¿”å›ï¼ˆå¯¹äºlistensockæ¥è¯´, æ¥äº†æ–°é“¾æ¥å°±æ˜¯è¯»IOå°±ç»ªï¼‰ä½†å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å†™å–èµ°æ–°socketçš„ä»£ç , æ‰€ä»¥è¿™é‡Œä¼šä¸€ç›´æ‰“å°äº‹ä»¶å°±ç»ª;</p><p>è¿”å›å€¼ä¸º1, ä»£è¡¨æœ‰ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„äº‹ä»¶å°±ç»ªã€‚</p><p><img src="https://img.musnow.top/i/2023/08/bcd37076cf11a3ec0d3caac5f7f0501f.png" alt="image-20230825172642067"></p><h3 id="3-2-5-å¤„ç†æ–°è¿æ¥"><a href="#3-2-5-å¤„ç†æ–°è¿æ¥" class="headerlink" title="3.2.5 å¤„ç†æ–°è¿æ¥"></a>3.2.5 å¤„ç†æ–°è¿æ¥</h3><p>åœ¨<code>select</code>äº‹ä»¶å°±ç»ªå, ä½¿ç”¨å¦‚ä¸‹å‡½æ•°æ¥å¤„ç†æ–°çš„é“¾æ¥</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">HandlerEvent</span><span class="params">(<span class="type">int</span> listensock, fd_set &amp;readfds)</span></span>;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢å¤–å†™äº†ä¸€ä¸ªæ‰“å°æ•°ç»„ä¸­å…ƒç´ çš„å‡½æ•°, æ–¹ä¾¿æˆ‘ä»¬è§‚å¯Ÿç»“æœã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// @brief æ‰“å°æ•°ç»„ä¸­çš„æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">ShowArray</span><span class="params">(<span class="type">int</span> arr[], <span class="type">int</span> num)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;å½“å‰åˆæ³•sock list: &quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; num; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i] == DFL_FD )</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; arr[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦éå†æ•´ä¸ªé“¾æ¥æ•°ç»„, å¹¶åˆ¤æ–­å½“å‰ä½ç½®æ˜¯å¦æ˜¯æœ‰æ•ˆçš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ— æ•ˆç›´æ¥è·³è¿‡ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; fdsArraySz; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (fdsArray[i] == DFL_FD)</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    <span class="comment">// å¤„ç†æ–°è¿æ¥å’Œå·²æœ‰é“¾æ¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éå†çš„æ—¶å€™, æˆ‘ä»¬éœ€è¦å¯¹listensockåšå•ç‹¬çš„å¤„ç†, æ¯•ç«Ÿè·å–æ–°è¿æ¥å’Œç»´æŠ¤å·²æœ‰é“¾æ¥çš„æµç¨‹æ˜¯å®Œå…¨ä¸åŒçš„ã€‚ä¸‹é¢è¯´è¯´æµç¨‹</p><ul><li>åˆ¤æ–­æ˜¯å¦æœ‰åœ¨selectä¸­ç›‘å¬è¯¥æ–‡ä»¶æè¿°ç¬¦</li><li>æœ‰ç›‘å¬, ç»§ç»­å¾€åæ‰§è¡Œ, å¼€å§‹è¿›è¡Œ<code>accept</code>è·å–æ–°çš„é“¾æ¥</li><li>è·å–å¤±è´¥, ç›´æ¥è·³å‡ºè¯¥å‡½æ•°, ç»“æŸè¯¥è½®å¤„ç†</li><li>è·å–æˆåŠŸ, ä¸èƒ½ç›´æ¥read&#x2F;write, è€Œæ˜¯åº”è¯¥é€šè¿‡æ•°ç»„äº¤ä»˜ç»™selectå¸®æˆ‘ä»¬ç›‘å¬äº‹ä»¶</li><li>ä¸‹ä¸€è½®å¾ªç¯ä¸­, selectä¾¿ä¼šå¸®æˆ‘ä»¬ç›‘å¬è¯¥æ–°é“¾æ¥çš„äº‹ä»¶æ˜¯å¦å°±ç»ª</li></ul><p>å› ä¸ºèµ°åˆ°è¿™é‡Œçš„æ—¶å€™, æˆ‘ä»¬çš„<code>listensocket</code>é‡Œé¢æ˜¯ä¸€å®šæœ‰æ–°è¿æ¥çš„, æ‰€ä»¥å¯¹<code>accept</code>çš„è°ƒç”¨æ˜¯ä¸ä¼šé˜»å¡çº¿ç¨‹çš„ï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (i == <span class="number">0</span> &amp;&amp; fdsArray[i] == listensock)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­listensocketæœ‰æ²¡æœ‰äº‹ä»¶ç›‘å¬</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">FD_ISSET</span>(listensock, &amp;readfds))&#123;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;listensocket not set in readfds&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å…·æœ‰äº†ä¸€ä¸ªæ–°é“¾æ¥</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;get new connection&quot;</span> &lt;&lt; endl;</span><br><span class="line">    string clientip;</span><br><span class="line">    <span class="type">uint16_t</span> clientport = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> sock = Sock::<span class="built_in">Accept</span>(listensock, &amp;clientip, &amp;clientport); <span class="comment">// ä¸ä¼šé˜»å¡</span></span><br><span class="line">    <span class="keyword">if</span> (sock &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span>; <span class="comment">// å‡ºé”™äº†, ç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="comment">// æˆåŠŸè·å–æ–°è¿æ¥</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;new conn:&quot;</span> &lt;&lt; clientip &lt;&lt; <span class="string">&quot;:&quot;</span> &lt;&lt; clientport &lt;&lt; <span class="string">&quot; | sock: &quot;</span> &lt;&lt; sock &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™é‡Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥å¯¹è¿™ä¸ªsocketè¿›è¡Œç‹¬å†™, å› ä¸ºæ–°é“¾æ¥æ¥äº†å¹¶ä¸ä»£è¡¨æ–°æ•°æ®ä¸€å¹¶è¿‡æ¥äº†</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥éœ€è¦å°†æ–°çš„æ–‡ä»¶æè¿°ç¬¦åˆ©ç”¨å…¨å±€æ•°ç»„, äº¤ä»˜ç»™select</span></span><br><span class="line">    <span class="comment">// select å¸®æˆ‘ä»¬ç›‘çœ‹socketä¸Šçš„è¯»äº‹ä»¶æ˜¯å¦å°±ç»ª</span></span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; fdsArraySz; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (fdsArray[i] == DFL_FD)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¾¾åˆ°ä¸Šé™äº†</span></span><br><span class="line">    <span class="keyword">if</span> (i == fdsArraySz)</span><br><span class="line">    &#123;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;reach the maximum number of connections&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">close</span>(sock);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="comment">// æ²¡æœ‰è¾¾åˆ°</span></span><br><span class="line">    &#123;</span><br><span class="line">        fdsArray[i] = sock; <span class="comment">// æ–°çš„é“¾æ¥, æ’å…¥åˆ°æ•°ç»„ä¸­, ä¸‹æ¬¡éå†å°±ä¼šæ·»åŠ åˆ°selectç›‘çœ‹ä¸­</span></span><br><span class="line">        <span class="built_in">ShowArray</span>(fdsArray, fdsArraySz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-6-å¤„ç†å·²æœ‰é“¾æ¥"><a href="#3-2-6-å¤„ç†å·²æœ‰é“¾æ¥" class="headerlink" title="3.2.6 å¤„ç†å·²æœ‰é“¾æ¥"></a>3.2.6 å¤„ç†å·²æœ‰é“¾æ¥</h3><p>è¿™é‡Œæš‚æ—¶åªåšäº†å¯¹è¯»çš„æ“ä½œ, å½“è¯»äº‹ä»¶å°±ç»ªçš„æ—¶å€™, æˆ‘ä»¬é€šè¿‡readè¯»å–å·²æœ‰çš„æ•°æ®ã€‚è¿™é‡Œå› ä¸ºsocketä¸­è‚¯å®šæ˜¯æœ‰æ•°æ®çš„, æ‰€ä»¥ä¹Ÿä¸ä¼šå‡ºç°é˜»å¡çš„æƒ…å†µã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// end if (i == 0 &amp;&amp; fdsArray[i] == listensock)</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// å¤„ç†æ™®é€šsockçš„IOäº‹ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">FD_ISSET</span>(fdsArray[i], &amp;readfds))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// readã€recvè¯»å–å³å¯</span></span><br><span class="line">        <span class="type">char</span> buffer[<span class="number">1024</span>];</span><br><span class="line">        <span class="type">ssize_t</span> s = <span class="built_in">recv</span>(fdsArray[i], buffer, <span class="built_in">sizeof</span>(buffer), <span class="number">0</span>); <span class="comment">// ä¸ä¼šé˜»å¡</span></span><br><span class="line">        <span class="keyword">if</span> (s &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            buffer[s] = <span class="number">0</span>;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;client[&quot;</span> &lt;&lt; fdsArray[i] &lt;&lt; <span class="string">&quot;]# &quot;</span> &lt;&lt; buffer &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s == <span class="number">0</span>) <span class="comment">// å¯¹ç«¯å…³é—­</span></span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;client[&quot;</span> &lt;&lt; fdsArray[i] &lt;&lt; <span class="string">&quot;] quit, server close &quot;</span> &lt;&lt; fdsArray[i] &lt;&lt; endl;</span><br><span class="line">            <span class="built_in">close</span>(fdsArray[i]);</span><br><span class="line">            fdsArray[i] = DFL_FD; <span class="comment">// å»é™¤å¯¹è¯¥æ–‡ä»¶æè¿°ç¬¦çš„selectäº‹ä»¶ç›‘å¬</span></span><br><span class="line">            <span class="built_in">ShowArray</span>(fdsArray, fdsArraySz);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">// å¼‚å¸¸äº†</span></span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;client[&quot;</span> &lt;&lt; fdsArray[i] &lt;&lt; <span class="string">&quot;] error, server close &quot;</span> &lt;&lt; fdsArray[i] &lt;&lt; endl;</span><br><span class="line">            <span class="built_in">close</span>(fdsArray[i]);</span><br><span class="line">            fdsArray[i] = DFL_FD; <span class="comment">// å»é™¤å¯¹è¯¥æ–‡ä»¶æè¿°ç¬¦çš„selectäº‹ä»¶ç›‘å¬</span></span><br><span class="line">            <span class="built_in">ShowArray</span>(fdsArray, fdsArraySz);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘å•æ¬¡è¯»å–çš„æ—¶å€™, æœ€å¤šåªèƒ½è¯»å‡º1024å­—èŠ‚çš„æ•°æ®;å¦‚æœæƒ³ä¸€æ¬¡æ€§è¯»å–å®Œæ¯•, åˆ™éœ€è¦ä½¿ç”¨å¾ªç¯+è®¾ç½®éé˜»å¡æ¥è¿›è¡Œè¯»å–ã€‚åç»­åœ¨epollçš„ä»£ç ç¤ºä¾‹ä¸­ä¼šå±•ç¤ºè¿™ç§å†™æ³•ã€‚</p><h3 id="3-2-7-å®æµ‹"><a href="#3-2-7-å®æµ‹" class="headerlink" title="3.2.7 å®æµ‹"></a>3.2.7 å®æµ‹</h3><p>åˆ°è¿™é‡Œ, æˆ‘ä»¬è¿™å¥—ä»£ç å°±åŸºæœ¬å®Œæˆäº†, å¯ä»¥æ¥æµ‹è¯•ä¸€ä¸‹èƒ½å¦å®ç°å•çº¿ç¨‹ç›‘å¬å¤šä¸ªé“¾æ¥;</p><p>åœ¨æœ¬åœ°ä½¿ç”¨telnet+å¤šä¸ªç»ˆç«¯è¿›è¡Œæµ‹è¯•, å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆåŠŸå®ç°äº†åŒæ—¶ç›‘å¬ä¸¤ä¸ªé“¾æ¥, å¹¶æ¥å—è¿™ä¸¤ä¸ªé“¾æ¥ç»™è‡ªå·±å‘é€çš„ä¿¡æ¯çš„åŠŸèƒ½ã€‚å½“telneté€€å‡ºçš„æ—¶å€™, ä¹Ÿèƒ½æˆåŠŸå›æ”¶æ–‡ä»¶æè¿°ç¬¦ã€‚</p><p><img src="https://img.musnow.top/i/2023/08/c14d2576fc599392522042a1bb12ddc5.png" alt="image-20230825183501900"></p><p>selectçš„å°å®ç°æš‚æ—¶å…ˆçœ‹åˆ°è¿™é‡Œ, å¦‚æœæƒ³ç”¨selectå®ç°åŒæ—¶è¯»+å†™, å…¶å®æ˜¯å¾ˆå¤æ‚çš„ã€‚éœ€è¦ä¸€å¥—å®Œæ•´çš„é€»è¾‘ã€‚è¿™å°±ç•™ç€åˆ°æœ€åepollçš„æ—¶å€™å†ç»Ÿä¸€å±•ç°å§ï¼</p><h2 id="3-3-socketå°±ç»ªæ¡ä»¶"><a href="#3-3-socketå°±ç»ªæ¡ä»¶" class="headerlink" title="3.3 socketå°±ç»ªæ¡ä»¶"></a>3.3 socketå°±ç»ªæ¡ä»¶</h2><p><span id="jump3">socketä¸åŒäº‹ä»¶çš„å°±ç»ªæœ‰å„è‡ªçš„æ¡ä»¶</span></p><h3 id="3-3-1-è¯»å°±ç»ª"><a href="#3-3-1-è¯»å°±ç»ª" class="headerlink" title="3.3.1 è¯»å°±ç»ª"></a>3.3.1 è¯»å°±ç»ª</h3><ul><li>socketå†…æ ¸ä¸­, æ¥æ”¶ç¼“å†²åŒºä¸­çš„å­—èŠ‚æ•°, å¤§äºç­‰äºä½æ°´ä½æ ‡è®°<code>SO_RCVLOWAT</code>, æ­¤æ—¶å¯ä»¥æ— é˜»å¡çš„è¯»è¯¥æ–‡ä»¶æè¿°ç¬¦, å¹¶ä¸”è¿”å›å€¼å¤§äº0; </li><li>socketåœ¨TCPé€šä¿¡ä¸­, å¯¹ç«¯å…³é—­è¿æ¥, æ­¤æ—¶å¯¹è¯¥socketè¯», åˆ™è¿”å›0;</li><li>ç›‘å¬çš„socketä¸Šæœ‰æ–°çš„è¿æ¥è¯·æ±‚;</li><li>socketä¸Šæœ‰æœªå¤„ç†çš„é”™è¯¯;</li></ul><h3 id="3-3-2-å†™å°±ç»ª"><a href="#3-3-2-å†™å°±ç»ª" class="headerlink" title="3.3.2 å†™å°±ç»ª"></a>3.3.2 å†™å°±ç»ª</h3><ul><li>socketå†…æ ¸ä¸­,  å‘é€ç¼“å†²åŒºä¸­çš„å¯ç”¨å­—èŠ‚æ•°(å‘é€ç¼“å†²åŒºçš„ç©ºé—²ä½ç½®å¤§å°),  å¤§äºç­‰äºä½æ°´ä½æ ‡è®° <code>SO_SNDLOWAT</code>,  æ­¤æ—¶å¯ä»¥æ— é˜»å¡çš„å†™,  å¹¶ä¸”è¿”å›å€¼å¤§äº0;</li><li>socketçš„å†™æ“ä½œè¢«å…³é—­(closeæˆ–è€…shutdown). å¯¹ä¸€ä¸ªå†™æ“ä½œè¢«å…³é—­çš„socketè¿›è¡Œå†™æ“ä½œ,  ä¼šè§¦å‘ <code>SIGPIPE</code> ä¿¡å·;</li><li>socketä½¿ç”¨éé˜»å¡connectè¿æ¥æˆåŠŸæˆ–å¤±è´¥ä¹‹å;</li><li>socketä¸Šæœ‰æœªè¯»å–çš„é”™è¯¯;</li></ul><h3 id="3-3-3-å¼‚å¸¸å°±ç»ª"><a href="#3-3-3-å¼‚å¸¸å°±ç»ª" class="headerlink" title="3.3.3 å¼‚å¸¸å°±ç»ª"></a>3.3.3 å¼‚å¸¸å°±ç»ª</h3><p>socketä¸Šæ”¶åˆ°å¸¦å¤–æ•°æ®ï¼ˆTCPæŠ¥å¤´ä¸­çš„URGå’Œç´§æ€¥æŒ‡é’ˆï¼‰</p><h2 id="3-4-selectçš„ç‰¹ç‚¹"><a href="#3-4-selectçš„ç‰¹ç‚¹" class="headerlink" title="3.4 selectçš„ç‰¹ç‚¹"></a>3.4 selectçš„ç‰¹ç‚¹</h2><ul><li>å¯ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦æœ‰ä¸Šé™, å–å†³äº<code>fd_set</code>ä½å›¾ç»“æ„ä½“çš„é…ç½®</li><li>åœ¨ç›‘æ§æ–‡ä»¶æè¿°ç¬¦çš„æ—¶å€™, éœ€è¦ç”¨æˆ·é¢å¤–çš„æ•°ç»„æ¥ç»´æŠ¤æ–‡ä»¶æè¿°ç¬¦</li><li>æ¯æ¬¡å¾ªç¯éƒ½å¾—éå†æ•´ä¸ªæ•°ç»„, æ•ˆç‡è¾ƒä½ï¼ˆå¯ä»¥ä¼˜åŒ–ä¸ºä¿è¯æœ‰æ•ˆæ–‡ä»¶æè¿°ç¬¦éƒ½åœ¨æ•°ç»„çš„å‰æ–¹ï¼‰</li></ul><p>ä¸€ä¸‹æ˜¯å®ƒåœ¨æ•ˆç‡ä¸Šçš„ä¸€äº›ç¼ºç‚¹</p><ul><li>æ¯æ¬¡è°ƒç”¨selectéƒ½å¾—æ‰‹åŠ¨è®¾ç½®ä¸€è¾¹fdé›†å’Œï¼ˆå› ä¸º<code>fd_set</code>ä¹Ÿæ˜¯è¾“å‡ºå‹å‚æ•°, åœ¨å†…æ ¸ä¸­ä¼šè¢«ä¿®æ”¹ï¼‰</li><li>æ¯æ¬¡è°ƒç”¨select, éƒ½éœ€è¦æŠŠæ‰€æœ‰fdä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€, å°é™†åœ°</li><li>æ¯æ¬¡è°ƒç”¨, å†…æ ¸éƒ½é¡»éå†ä¼ é€’è¿›æ¥çš„ä½å›¾, æ•ˆç‡ä½</li><li>ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦æœ‰ä¸Šé™, æ•°é‡å°</li></ul><h1 id="4-å¤šè·¯è½¬æ¥ä¹‹poll"><a href="#4-å¤šè·¯è½¬æ¥ä¹‹poll" class="headerlink" title="4.å¤šè·¯è½¬æ¥ä¹‹poll"></a>4.å¤šè·¯è½¬æ¥ä¹‹poll</h1><h2 id="4-1-å‡½æ•°åŸå‹"><a href="#4-1-å‡½æ•°åŸå‹" class="headerlink" title="4.1 å‡½æ•°åŸå‹"></a>4.1 å‡½æ•°åŸå‹</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦äº†è§£çš„æ˜¯å¦å¤–ä¸€ä¸ªå¤šè·¯è½¬æ¥æ–¹æ¡ˆ, <strong>poll</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;poll.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">poll</span><span class="params">(<span class="keyword">struct</span> pollfd *fds,  <span class="type">nfds_t</span> nfds,  <span class="type">int</span> timeout)</span></span>;</span><br></pre></td></tr></table></figure><h3 id="4-1-1-å‚æ•°"><a href="#4-1-1-å‚æ•°" class="headerlink" title="4.1.1 å‚æ•°"></a>4.1.1 å‚æ•°</h3><p>è¿™é‡Œçš„å‚æ•°å°±å’Œselectå®Œå…¨ä¸åŒäº†, å‡ºç°äº†å¦å¤–ä¸€ä¸ªç»“æ„ä½“</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">pollfd</span> &#123;</span></span><br><span class="line">    <span class="type">int</span>   fd;         <span class="comment">/* file descriptor */</span></span><br><span class="line">    <span class="type">short</span> events;     <span class="comment">/* requested events */</span></span><br><span class="line">    <span class="type">short</span> revents;    <span class="comment">/* returned events */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™ä¸€ä¸ªç»“æ„ä½“åˆ†åˆ«åŒ…å«äº†ä¸‰ä¸ªæˆå‘˜</p><ul><li>æ–‡ä»¶æè¿°ç¬¦fd;</li><li>ç”¨æˆ·å‘Šè¯‰å†…æ ¸éœ€è¦ç›‘çœ‹çš„äº‹ä»¶events;</li><li>å†…æ ¸è¿”å›çš„å°±ç»ªäº‹ä»¶revents;</li></ul><p>ä½†æ˜¯ä»è¿™ä¸ªå‡½æ•°çš„å‚æ•°ä¸Šçœ‹æ¥, è²Œä¼¼å®ƒæ˜¯ä¸€ä¸ªåªæœ‰ä¸€ä¸ªå…ƒç´ çš„è¾“å…¥è¾“å‡ºå‹å‚æ•°, éš¾é“è¯´pollåªèƒ½ç›‘çœ‹ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å—ï¼ŸğŸ§</p><p>éä¹Ÿ, æˆ‘ä»¬å°†å‡½æ•°åŸå‹æ”¹ä¸€ä¸‹å°±èƒ½çœ‹æ˜ç™½äº†, å®é™…ä¸Š, ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª<strong>ç»“æ„ä½“æ•°ç»„</strong>, ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¯¥ç»“æ„ä½“æ•°ç»„çš„<strong>é•¿åº¦</strong>ï¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">poll</span><span class="params">(<span class="keyword">struct</span> pollfd fds[],  <span class="type">nfds_t</span> nfds,  <span class="type">int</span> timeout)</span>;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰ä¸ªå‚æ•°å’Œselectä¸­çš„timeoutçš„åŠŸèƒ½ç›¸åŒ, å¦‚æœåˆ°è¾¾ä¸€å®šæ—¶é—´è¿˜æ²¡æœ‰è·å–åˆ°å‚æ•°, åˆ™ç›´æ¥è¿”å›;å¦‚æœè®¾ç½®ä¸º<code>-1</code>åˆ™é˜»å¡ç­‰å¾…, è®¾ç½®ä¸º0ä¸ºå®Œå…¨éé˜»å¡ã€‚</p><p>è¿™é‡Œçš„timeoutå¹¶éè¾“å…¥è¾“å‡ºå‹å·å‚æ•°, å…¶åªæ˜¯ä¸€ä¸ªè¾“å…¥å‚æ•°, å•ä½ä¸º<strong>æ¯«ç§’</strong>ï¼ˆè®°ä½, ä¸æ˜¯ç§’, æ˜¯æ¯«ç§’ï¼‰</p><h3 id="4-1-2-è¿”å›å€¼"><a href="#4-1-2-è¿”å›å€¼" class="headerlink" title="4.1.2 è¿”å›å€¼"></a>4.1.2 è¿”å›å€¼</h3><ul><li>å°äº0, å‡ºé”™</li><li>ç­‰äº0, ç­‰å¾…è¶…æ—¶</li><li>å¤§äº0, æ–‡ä»¶æè¿°ç¬¦å·²ç»å°±ç»ªçš„æ•°é‡</li></ul><h3 id="4-1-3-äº‹ä»¶"><a href="#4-1-3-äº‹ä»¶" class="headerlink" title="4.1.3 äº‹ä»¶"></a>4.1.3 äº‹ä»¶</h3><p>è¿™é‡Œéœ€è¦äº†è§£ä¸€ä¸‹pollåŒ…å«çš„äº‹ä»¶ç±»å‹äº†, æˆ‘ä»¬éœ€è¦æ ¹æ®ä¸åŒæƒ…å†µæ¥é€‰æ‹©æƒ³è¦çš„äº‹ä»¶, å¹¶è®¾ç½®åˆ°ç»“æ„ä½“çš„<code>event</code>ä¸­;å¯¹äºselect&#x2F;poll&#x2F;epollæ¥è¯´, è¿™äº›socketçš„å°±ç»ªæ¡ä»¶éƒ½æ˜¯ç›¸åŒçš„ã€‚è¯¦è§ <a href="#jump3">3.3 socketå°±ç»ªæ¡ä»¶</a>;</p><p><img src="https://img.musnow.top/i/2023/08/748d3a20ba69bb3b3671f5b344cba650.png" alt="img"></p><h2 id="4-2-pollä¼˜ç¼ºç‚¹"><a href="#4-2-pollä¼˜ç¼ºç‚¹" class="headerlink" title="4.2 pollä¼˜ç¼ºç‚¹"></a>4.2 pollä¼˜ç¼ºç‚¹</h2><h3 id="4-2-1-ä¼˜ç‚¹"><a href="#4-2-1-ä¼˜ç‚¹" class="headerlink" title="4.2.1 ä¼˜ç‚¹"></a>4.2.1 ä¼˜ç‚¹</h3><p>åœ¨pollä¸­, ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªç»“æ„ä½“æ•°ç»„æ¥è¡¨ç¤ºéœ€è¦ç›‘å¬çš„æ–‡ä»¶æè¿°ç¬¦, ä»¥åŠäº‹ä»¶å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦</p><ul><li>å› ä¸ºç»“æ„ä½“ä¸­ç”¨æˆ·éœ€è¦ç›‘å¬çš„eventå’Œå†…æ ¸è¿”å›çš„å°±ç»ªeventå¹¶ä¸åœ¨ä¸€ä¸ªå˜é‡ä¸Š, æ‰€ä»¥åªéœ€è¦è®¾ç½®ä¸€æ¬¡å³å¯ï¼ˆå¦‚æœéœ€æ±‚æ²¡æœ‰å˜åŠ¨çš„è¯ï¼‰, æ— éœ€åƒselectæ¯æ¬¡éƒ½å¾—é‡æ–°éå†æ¥è®¾ç½®ä½å›¾</li><li>pollæ²¡æœ‰æœ€å¤§æ–‡ä»¶æè¿°ç¬¦é™åˆ¶</li><li>pollæ— éœ€ç”¨æˆ·é¢å¤–ç»´æŠ¤ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶æè¿°ç¬¦æ•°ç»„, ç›´æ¥æ²¿ç”¨è¯¥ç»“æ„ä½“æ•°ç»„å³å¯</li></ul><h3 id="4-2-2-ç¼ºç‚¹"><a href="#4-2-2-ç¼ºç‚¹" class="headerlink" title="4.2.2 ç¼ºç‚¹"></a>4.2.2 ç¼ºç‚¹</h3><ul><li>å’Œselectä¸€æ ·, pollä¹Ÿéœ€è¦è½®è¯¢æ£€æµ‹å°±ç»ªçš„fdå’Œç›¸å…³äº‹ä»¶</li><li>æ¯æ¬¡è°ƒç”¨polléœ€è¦æŠŠpollfdç»“æ„ä½“ä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€</li><li>è™½ç„¶pollæ²¡æœ‰æœ€å¤§æ–‡ä»¶æè¿°ç¬¦é™åˆ¶, ä½†æ˜¯ç›‘çœ‹çš„å¤šäº†åæ€§èƒ½ä¼šçº¿æ€§ä¸‹é™</li></ul><h2 id="4-3-çœ‹çœ‹ç¤ºä¾‹ä»£ç "><a href="#4-3-çœ‹çœ‹ç¤ºä¾‹ä»£ç " class="headerlink" title="4.3 çœ‹çœ‹ç¤ºä¾‹ä»£ç "></a>4.3 çœ‹çœ‹ç¤ºä¾‹ä»£ç </h2><p>pollçš„ä»£ç éƒ¨åˆ†çš„ä¸»æœºç»“æ„å’ŒselectåŸºæœ¬ç›¸åŒï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦æ¥è¯´ä¸€ä¸‹ä¸åŒçš„åœ°æ–¹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> NUM 1024</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DFL_FD -1</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">pollfd</span> <span class="title">fdsArray</span>[<span class="title">NUM</span>];</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ˜¯å…¨å±€çš„æ•°ç»„ï¼Œè¿™æ—¶å€™ä¸éœ€è¦è‡ªå·±ç»´æŠ¤ä¸€ä¸ªintæ–‡ä»¶æè¿°ç¬¦æ•°ç»„äº†ï¼Œç›´æ¥ä½¿ç”¨è¿™ä¸ªç»“æ„ä½“ä½œä¸ºå…¨å±€æ•°ç»„å°±OKäº†ï¼›åœ¨mainå‡½æ•°é‡Œé¢è¿˜æ˜¯è€æ ·å­ï¼Œæˆ‘ä»¬å¾—æŠŠæ•´ä¸ªæ•°ç»„çš„fdéƒ½è®¾ç½®æˆé»˜è®¤çš„fdä½œä¸ºæ ‡è¯†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; NUM; i++)</span><br><span class="line">&#123;</span><br><span class="line">    fdsArray[i].fd = DFL_FD;</span><br><span class="line">    fdsArray[i].events = <span class="number">0</span>;</span><br><span class="line">    fdsArray[i].revents = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">fdsArray[<span class="number">0</span>].fd = listensock;</span><br><span class="line">fdsArray[<span class="number">0</span>].events = POLLIN;</span><br></pre></td></tr></table></figure><p>åœ¨mainå‡½æ•°çš„ä¸»å¾ªç¯ä¸­ï¼Œä¹Ÿæ˜¯ç”¨pollæ¥ä¾æ¬¡ç›‘å¬äº‹ä»¶ï¼Œå¹¶åˆ¤æ–­pollå‡½æ•°çš„è¿”å›å€¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> timeout = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> n = poll(fdsArray, NUM, timeout);</span><br><span class="line">    <span class="keyword">switch</span> (n)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;time out ... : &quot;</span> &lt;&lt; (<span class="type">unsigned</span> <span class="type">long</span>)time(nullptr) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">-1</span>:</span><br><span class="line">            <span class="built_in">cerr</span> &lt;&lt; errno &lt;&lt; <span class="string">&quot; : &quot;</span> &lt;&lt; strerror(errno) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            HandlerEvent(listensock);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>HandlerEvent</code>å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡åˆ¤æ–­ç»“æ„ä½“å†…éƒ¨çš„<code>revent</code>æ¥å¾—çŸ¥æ˜¯å¦æœ‰äº‹ä»¶å°±ç»ª</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (fdsArray[i].revents &amp; POLLIN)&#123;&#125; <span class="comment">// è¯»äº‹ä»¶æ˜¯å¦å°±ç»ª</span></span><br></pre></td></tr></table></figure><p>å¯¹äºlistensocketæ¥è¯´ï¼Œå°±ç»ªäº†å°±æ‰§è¡Œacceptï¼›å¹¶å°†æ–°çš„æ–‡ä»¶æè¿°ç¬¦æ·»åŠ åˆ°æ•°ç»„ä¸­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; NUM; j++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (fdsArray[j].fd == DFL_FD)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é€šè¿‡forå¾ªç¯æ‰¾åˆ°å½“å‰ä½ç½®æ˜¯é»˜è®¤çš„ç»“æ„ä½“ä¸‹æ ‡</span></span><br><span class="line"><span class="keyword">if</span> (j == NUM) <span class="comment">// å¦‚æœè¾¾åˆ°ä¸Šé™æ‰break</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;æˆ‘çš„æœåŠ¡å™¨å·²ç»åˆ°äº†æœ€å¤§çš„ä¸Šé™äº†ï¼Œæ— æ³•åœ¨æ‰¿è½½æ›´å¤šåŒæ—¶ä¿æŒçš„è¿æ¥äº†&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    close(sock);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    fdsArray[j].fd = sock; <span class="comment">// å°†sockæ·»åŠ åˆ°æ•°ç»„ä¸­</span></span><br><span class="line">    fdsArray[j].events = POLLIN;</span><br><span class="line">    fdsArray[j].revents = <span class="number">0</span>;</span><br><span class="line">    ShowArray(fdsArray, NUM);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºå…¶ä»–é“¾æ¥æ¥è¯´ï¼Œå°±ç»ªäº†å°±å¼€å§‹readã€‚å¦‚æœreadå¼‚å¸¸æˆ–è€…å¯¹ç«¯å…³é—­ï¼Œé‚£å°±å°†å¯¹åº”ä½ç½®çš„ç»“æ„ä½“å…¨éƒ¨åˆå§‹åŒ–ï¼ˆæ¸…ç©ºï¼‰ï¼Œç›¸å½“äºå°†è¿™ä¸ªé“¾æ¥ä»ç›‘å¬ä¸­å»æ‰ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fdsArray[i].fd = DFL_FD; </span><br><span class="line">fdsArray[i].events = 0;</span><br><span class="line">fdsArray[i].revents = 0;</span><br></pre></td></tr></table></figure><p>å…¶ä½™çš„æ“ä½œå’Œselectå®Œå…¨ä¸€è‡´ï¼Œåœ¨è¿™é‡Œå°±ä¸å±•ç¤ºä»£ç äº†ï¼</p><h1 id="5-epoll"><a href="#5-epoll" class="headerlink" title="5.epoll"></a>5.epoll</h1><p>manæ‰‹å†Œä¸­æåˆ°, epollæ˜¯ä¸ºäº†å¤„ç†å¤§é‡socketæ–‡ä»¶æè¿°ç¬¦å¥æŸ„è€Œè¿›è¡Œäº†ä¸€å®šæ”¹è¿›çš„poll;</p><h2 id="5-1-æ¥å£"><a href="#5-1-æ¥å£" class="headerlink" title="5.1 æ¥å£"></a>5.1 æ¥å£</h2><p>epollå°±ä¸æ˜¯åªæœ‰ä¸€ä¸ªå‡½æ•°æ¥å£äº†, è€Œæ˜¯æœ‰3ä¸ªç›¸å…³çš„å‡½æ•°ï¼Œä½¿ç”¨è¿‡ç¨‹å°±æ˜¯ä¸‰éƒ¨æ›²ï¼š</p><ul><li>epoll_create åˆ›å»ºepollæ–‡ä»¶å¥æŸ„</li><li>epoll_ctl å°†éœ€è¦ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œæ³¨å†Œ</li><li>epoll_wait ç­‰å¾…æ–‡ä»¶æè¿°ç¬¦å°±ç»ª</li></ul><h3 id="5-1-1-epoll-create"><a href="#5-1-1-epoll-create" class="headerlink" title="5.1.1 epoll_create"></a>5.1.1 epoll_create</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/epoll.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">epoll_create</span><span class="params">(<span class="type">int</span> size)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">epoll_create1</span><span class="params">(<span class="type">int</span> flags)</span>;</span><br></pre></td></tr></table></figure><p>epollåœ¨ä½¿ç”¨çš„æ—¶å€™, æˆ‘ä»¬éœ€è¦ç”¨createå‡½æ•°åˆ›å»ºä¸€ä¸ªepollçš„å¥æŸ„ï¼ˆæœ¬è´¨ä¸Šä¹Ÿæ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼‰, æ¥ç®¡ç†å½“å‰è¿›ç¨‹éœ€è¦æ“ä½œç³»ç»Ÿå¸®æˆ‘ä»¬ç›‘çœ‹çš„æ–‡ä»¶æè¿°ç¬¦</p><ul><li>è‡ªä»<code>linux 2.6.8</code> å, è¿™é‡Œçš„sizeå‚æ•°æ˜¯è¢«èƒ¡å’¯çš„</li><li>epollçš„å¥æŸ„åœ¨ä½¿ç”¨å®Œæ¯•åä¹Ÿéœ€è¦ç”¨<code>close()</code>å‡½æ•°å…³é—­</li><li>é”™è¯¯çš„æ—¶å€™è¿”å›<code>-1</code>å¹¶è®¾ç½®errno, æ­£ç¡®çš„æ—¶å€™è¿”å›æ–‡ä»¶æè¿°ç¬¦</li></ul><h3 id="5-1-2-epoll-ctl"><a href="#5-1-2-epoll-ctl" class="headerlink" title="5.1.2 epoll_ctl"></a>5.1.2 epoll_ctl</h3><p>è¯¥å‡½æ•°æ˜¯å¯¹epollä¸­éœ€è¦ç›‘çœ‹çš„æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œè®¾ç½®</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/epoll.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">epoll_ctl</span><span class="params">(<span class="type">int</span> epfd,  <span class="type">int</span> op,  <span class="type">int</span> fd,  <span class="keyword">struct</span> epoll_event *event)</span>;</span><br></pre></td></tr></table></figure><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<code>epoll_create</code>çš„è¿”å›å€¼</li><li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯åŠ¨ä½œ, åŒ…å«ä¸‰ä¸ªä¸åŒçš„é€‰é¡¹<ul><li><code>EPOLL_CTL_ADD</code>ï¼šå°†æ–°çš„æ–‡ä»¶æè¿°ç¬¦æ·»åŠ åˆ°<code>epfd</code>ä¸­</li><li><code>EPOLL_CTL_MOD</code>ï¼šä¿®æ”¹å·²æœ‰æ–‡ä»¶æè¿°ç¬¦çš„ç›‘å¬äº‹ä»¶</li><li><code>EPOLL_CTL_DEL</code>ï¼šåˆ é™¤å·²æœ‰æ–‡ä»¶æè¿°ç¬¦</li></ul></li><li>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ç›®æ ‡æ–‡ä»¶æè¿°ç¬¦</li><li>ç¬¬å››ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª<code>epoll_event</code>ç»“æ„ä½“</li></ul><p>è¿™ä¸ªç»“æ„ä½“çš„å®šä¹‰å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">union</span> <span class="title">epoll_data</span> &#123;</span></span><br><span class="line">    <span class="type">void</span>        *ptr;</span><br><span class="line">    <span class="type">int</span>          fd;</span><br><span class="line">    <span class="type">uint32_t</span>     u32;</span><br><span class="line">    <span class="type">uint64_t</span>     u64;</span><br><span class="line">&#125; <span class="type">epoll_data_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">epoll_event</span> &#123;</span></span><br><span class="line">    <span class="type">uint32_t</span>     events;      <span class="comment">/* Epoll events */</span></span><br><span class="line">    <span class="type">epoll_data_t</span> data;        <span class="comment">/* User data variable */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="äº‹ä»¶"><a href="#äº‹ä»¶" class="headerlink" title="äº‹ä»¶"></a>äº‹ä»¶</h4><p>äº‹ä»¶<code>events</code>å¯ä»¥æ˜¯ä¸‹é¢çš„è¿™äº›é€‰é¡¹</p><table><thead><tr><th>äº‹ä»¶</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>EPOLLIN</td><td>è¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å¯ä»¥è¯» (åŒ…æ‹¬å¯¹ç«¯SOCKETæ­£å¸¸å…³é—­);</td></tr><tr><td>EPOLLOUT</td><td>è¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å¯ä»¥å†™;</td></tr><tr><td>EPOLLPRI</td><td>è¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦æœ‰ç´§æ€¥çš„æ•°æ®å¯è¯» (è¿™é‡Œåº”è¯¥è¡¨ç¤ºæœ‰å¸¦å¤–æ•°æ®åˆ°æ¥);</td></tr><tr><td>EPOLLERR</td><td>è¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å‘ç”Ÿé”™è¯¯;</td></tr><tr><td>EPOLLHUP</td><td>è¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦è¢«æŒ‚æ–­;</td></tr><tr><td>EPOLLET</td><td>å°†EPOLLè®¾ä¸º<strong>è¾¹ç¼˜è§¦å‘ <strong>(Edge Triggered)æ¨¡å¼,  è¿™æ˜¯ç›¸å¯¹äº</strong>æ°´å¹³è§¦å‘</strong>(Level Triggered) æ¥è¯´çš„ï¼›</td></tr><tr><td>EPOLLONESHOT</td><td><strong>åªç›‘å¬ä¸€æ¬¡äº‹ä»¶,</strong>  å½“ç›‘å¬å®Œè¿™æ¬¡äº‹ä»¶ä¹‹å,  å¦‚æœè¿˜éœ€è¦ç»§ç»­ç›‘å¬è¿™ä¸ªsocketçš„è¯,  éœ€è¦æ‰‹åŠ¨å†æ¬¡æŠŠè¿™ä¸ªsocketåŠ å…¥åˆ°EPOLLé˜Ÿåˆ—é‡Œï¼›</td></tr></tbody></table><h3 id="5-1-3-epoll-wait"><a href="#5-1-3-epoll-wait" class="headerlink" title="5.1.3 epoll_wait"></a>5.1.3 epoll_wait</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/epoll.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">epoll_wait</span><span class="params">(<span class="type">int</span> epfd,  <span class="keyword">struct</span> epoll_event *events, </span></span><br><span class="line"><span class="params">               <span class="type">int</span> maxevents,  <span class="type">int</span> timeout)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">epoll_pwait</span><span class="params">(<span class="type">int</span> epfd,  <span class="keyword">struct</span> epoll_event *events, </span></span><br><span class="line"><span class="params">                <span class="type">int</span> maxevents,  <span class="type">int</span> timeout, </span></span><br><span class="line"><span class="params">                <span class="type">const</span> <span class="type">sigset_t</span> *sigmask)</span>;</span><br></pre></td></tr></table></figure><p>æ”¹å‡½æ•°çš„ä½œç”¨æ˜¯æ”¶é›†åœ¨epollç›‘æ§çš„äº‹ä»¶ä¸­ï¼Œå·²ç»å°±ç»ªçš„äº‹ä»¶</p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯epollçš„æ–‡ä»¶æè¿°ç¬¦å¥æŸ„</li><li>å‚æ•°eventsæ˜¯<code>epoll_events</code>ç»“æ„ä½“æ•°ç»„ï¼Œæ˜¯ä¸€ä¸ªè¾“å‡ºå‹å‚æ•°ã€‚epollä¼šå°†å°±ç»ªçš„äº‹ä»¶èµ‹å€¼åˆ°eventsæ•°ç»„é‡Œé¢ï¼›</li><li>maxevents å‘Šè¯‰å†…æ ¸è¿™ä¸ªeventsçš„å¤§å°ï¼Œå…¶ä¸å¯ä»¥è¶…è¿‡<code>epoll_create</code>çš„sizeï¼›</li><li>å‚æ•°timeoutæ˜¯è¶…æ—¶æ—¶é—´ï¼Œä¹Ÿæ˜¯æ¯«ç§’ï¼ˆ0éé˜»å¡ï¼Œ-1æ°¸ä¹…é˜»å¡ï¼‰</li><li>è¿”å›å€¼ï¼šæˆåŠŸè¿”å›IOäº‹ä»¶å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦æ•°ç›®ï¼Œ0ä»£è¡¨è¶…æ—¶ï¼Œè´Ÿæ•°ä»£è¡¨å¤±è´¥</li></ul><h2 id="5-2-å·¥ä½œåŸç†"><a href="#5-2-å·¥ä½œåŸç†" class="headerlink" title="5.2 å·¥ä½œåŸç†"></a>5.2 å·¥ä½œåŸç†</h2><h3 id="5-2-1-ä»æºç çœ‹æµç¨‹"><a href="#5-2-1-ä»æºç çœ‹æµç¨‹" class="headerlink" title="5.2.1 ä»æºç çœ‹æµç¨‹"></a>5.2.1 ä»æºç çœ‹æµç¨‹</h3><p>æˆ‘ä»¬çŸ¥é“ï¼Œselecté€šè¿‡ä½å›¾æ¥å‘Šè¯‰æ“ä½œç³»ç»Ÿéœ€è¦ç®¡ç†çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œpollé€šè¿‡ç»“æ„ä½“æ•°ç»„æ¥å‘Šè¯‰æ“ä½œç³»ç»Ÿéœ€è¦ç®¡ç†çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</p><p>ä½†epollé‡Œé¢ï¼Œå´å˜æˆäº†ä¸€ä¸ªepfdæ–‡ä»¶å¥æŸ„ï¼Œæˆ‘ä»¬åªæ˜¯ç»™è¿™ä¸ªç‰¹å®šçš„å¥æŸ„äº¤ä»˜æ–‡ä»¶æè¿°ç¬¦ã€‚è¿™è¯´æ˜åº•å±‚è‚¯å®šéœ€è¦å…¶ä»–çš„æ•°æ®ç»“æ„ï¼Œæ¥ç®¡ç†æŸä¸ªè¿›ç¨‹çš„æŸä¸ªepfdäº¤ä»˜ç»™æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»¥åŠéœ€è¦ç›‘çœ‹çš„äº‹ä»¶ï¼</p><p>åœ¨<code>Linux 2.6.32.16</code>æºç <code>fs/eventpoll.c</code>ä¸­ï¼Œå¯ä»¥æ‰¾åˆ°å¦‚ä¸‹è¿™ä¸ªç»“æ„ä½“</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// linuxæºç æ–‡ä»¶è·¯å¾„ï¼šfs/eventpoll.c</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * This structure is stored inside the &quot;private_data&quot; member of the file</span></span><br><span class="line"><span class="comment"> * structure and rapresent the main data sructure for the eventpoll</span></span><br><span class="line"><span class="comment"> * interface.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eventpoll</span> &#123;</span></span><br><span class="line"><span class="comment">/* Protect the this structure access */</span></span><br><span class="line"><span class="type">spinlock_t</span> lock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * This mutex is used to ensure that files are not removed</span></span><br><span class="line"><span class="comment"> * while epoll is using them. This is held during the event</span></span><br><span class="line"><span class="comment"> * collection loop, the file cleanup path, the epoll file exit</span></span><br><span class="line"><span class="comment"> * code and the ctl operations.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mutex</span> <span class="title">mtx</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wait queue used by sys_epoll_wait() */</span></span><br><span class="line"><span class="type">wait_queue_head_t</span> wq;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wait queue used by file-&gt;poll() */</span></span><br><span class="line"><span class="type">wait_queue_head_t</span> poll_wait;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* List of ready file descriptors */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">rdllist</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* RB tree root used to store monitored fd structs */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rb_root</span> <span class="title">rbr</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * This is a single linked list that chains all the &quot;struct epitem&quot; that</span></span><br><span class="line"><span class="comment"> * happened while transfering ready events to userspace w/out</span></span><br><span class="line"><span class="comment"> * holding -&gt;lock.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">epitem</span> *<span class="title">ovflist</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* The user that created the eventpoll descriptor */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">user_struct</span> *<span class="title">user</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œé¢ï¼Œæˆ‘ä»¬æ—¢å¯ä»¥çœ‹åˆ°ç†Ÿæ‚‰çš„<code>mutex</code>é”ï¼Œåˆå¯ä»¥çœ‹åˆ°ä¸€ä¸ª<code>wait_queue</code>ç­‰å¾…é˜Ÿåˆ—ï¼Œä¸€ä¸ªåŒé“¾è¡¨ï¼Œå’Œä¸€ä¸ª<code>rb_root</code>çº¢é»‘æ ‘èŠ‚ç‚¹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> &#123;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> *<span class="title">next</span>, *<span class="title">prev</span>;</span></span><br><span class="line">&#125;; <span class="comment">// å†…æ ¸ä¸­çš„åŒé“¾è¡¨</span></span><br></pre></td></tr></table></figure><p>æŠ½è±¡å‡ºæ¥ä¹‹åï¼Œå…¶å¤§æ¦‚çš„ç»“æ„å›¾å¦‚ä¸‹</p><p><img src="https://img.musnow.top/i/2023/08/6ca5fd02f9838c2ef2d41a014623262d.png" alt="image-20230826160246637"></p><p>å½“æŸä¸€ä¸ªè¿›ç¨‹è°ƒç”¨<code>epoll_create</code>åˆ›å»º<code>epoll</code>çš„æ–‡ä»¶æè¿°ç¬¦å¥æŸ„çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šå¸®æˆ‘ä»¬åœ¨åº•å±‚åˆ›å»ºä¸€ä¸ª<code>struct eventpoll</code>ç»“æ„ä½“ï¼Œå†…éƒ¨åŒ…å«äº†å°±ç»ªé˜Ÿåˆ—å’Œä¸€ä¸ªçº¢é»‘æ ‘ï¼ˆä¸»è¦å…³æ³¨è¿™ä¸¤ä¸ªæˆå‘˜ï¼‰</p><ul><li>è°ƒç”¨<code>epoll_ctl</code>çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šå°†æˆ‘ä»¬é…ç½®çš„æ–‡ä»¶æè¿°ç¬¦å’Œå¯¹äºçš„äº‹ä»¶æ·»åŠ åˆ°çº¢é»‘æ ‘èŠ‚ç‚¹ä¸­ï¼›</li><li>é‡å¤æ·»åŠ çš„äº‹ä»¶ä¹Ÿå¯ä»¥é€šè¿‡çº¢é»‘æ ‘çš„é”®å€¼å”¯ä¸€æ€§æ£€æŸ¥å‡ºæ¥ï¼ˆé¿å…å†—ä½™ï¼‰</li><li>æ‰€æœ‰æ·»åŠ åˆ°epollä¸­çš„äº‹ä»¶éƒ½ä¼šä¸è®¾å¤‡çš„<strong>ç½‘å¡é©±åŠ¨ç¨‹åº</strong>å»ºç«‹å›è°ƒæ¶ˆæ¯ï¼Œå½“æŸä¸ªæ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„é“¾æ¥æœ‰ä¿¡æ¯ä¼ æ¥çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨<strong>å›è°ƒå‡½æ•°</strong>ï¼Œå‘ŠçŸ¥epoll<ul><li>ç½‘å¡æ”¶åˆ°æ¶ˆæ¯</li><li>é©±åŠ¨ç¨‹åºå¤„ç†ï¼Œå¹¶è°ƒç”¨å¯¹åº”çš„å›è°ƒæœºåˆ¶</li><li>epollé€šè¿‡å›è°ƒæ¶ˆæ¯æ”¶åˆ°äº‹ä»¶å°±ç»ªï¼Œå°†å…¶é“¾å…¥<code>rdllist</code>åŒé“¾è¡¨ä¸­</li><li>ä¸Šå±‚åªéœ€è¦è°ƒå›<code>epoll_wait</code>ä»è¯¥åŒé“¾è¡¨ä¸­è·å–å°±ç»ªäº‹ä»¶</li></ul></li><li>è¯¥å›è°ƒåŠæ³•åœ¨åº•å±‚ä¸º<code>ep_poll_callback</code>ï¼Œå®ƒä¼šå°†å°±ç»ªçš„äº‹ä»¶æ’å…¥åˆ°<code>rdllist</code>åŒé“¾è¡¨ä¸­</li><li>epollä¸­æ¯ä¸€ä¸ªäº‹ä»¶éƒ½ä¼šå»ºç«‹ä¸€ä¸ªå¯¹åº”çš„<code>epitem</code>ç»“æ„ä½“</li><li>å½“è°ƒç”¨<code>epoll_wait</code>æœ‰äº‹ä»¶å‘ç”Ÿçš„æ—¶å€™ï¼Œåªéœ€è¦æ£€æŸ¥<code>eventpoll</code>å¯¹è±¡çš„<code>rdllist</code>åŒé“¾è¡¨ä¸­æ˜¯å¦æœ‰<code>epitem</code>å…ƒç´ å³å¯ï¼Œæœ‰åˆ™å–å‡ºï¼›</li><li>å¦‚æœ<code>rdllist</code>ä¸ä¸ºç©ºï¼Œåˆ™å°†å‘ç”Ÿçš„äº‹ä»¶å¤åˆ¶åˆ°ç”¨æˆ·æ€ï¼Œå¹¶å°†äº‹ä»¶æ•°é‡è¿”å›ç»™ç”¨æˆ·ï¼›å¯¹æ¯”éœ€è¦éå†çš„<code>select/poll</code>ï¼Œè¿™ä¸ªè·å–å°±ç»ªäº‹ä»¶çš„<strong>æ—¶é—´å¤æ‚åº¦</strong>æ˜¯<code>O(1)</code>çš„ï¼ˆç›´æ¥åˆ¤æ–­å¹¶å–å‡ºå°±å¯ä»¥äº†ï¼‰</li></ul><p>è¿™ä¸€å¤§åœˆæ“ä½œéƒ½æ˜¯æ“ä½œç³»ç»Ÿè‡ªè¡Œå®Œæˆçš„ï¼Œå¯¹äºç”¨æˆ·æ¥è¯´æ˜¯æ— æ„ŸçŸ¥çš„ï¼</p><p>å…³äºepitemç»“æ„ä½“ï¼Œå¯ä»¥ç…ä¸€çœ¼ä¸‹é¢çš„æ³¨é‡Šï¼Œä»–ä¹Ÿæ˜¯åœ¨æºç çš„<code>fs/eventpoll.c</code>æ–‡ä»¶ä¸­</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">epitem</span> &#123;</span><br><span class="line"><span class="comment">/* RB tree node used to link this structure to the eventpoll RB tree */</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">rb_node</span> rbn; <span class="comment">// è¿™ä¸ªäº‹ä»¶å¯¹åº”çš„çº¢é»‘æ ‘èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* List header used to link this structure to the eventpoll ready list */</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">list_head</span> rdllink; <span class="comment">// è¿™ä¸ªäº‹ä»¶å¯¹åº”çš„åŒé“¾è¡¨èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Works together &quot;struct eventpoll&quot;-&gt;ovflist in keeping the</span></span><br><span class="line"><span class="comment"> * single linked chain of items.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">epitem</span> *next; </span><br><span class="line"></span><br><span class="line"><span class="comment">/* The file descriptor information this item refers to */</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">epoll_filefd</span> ffd; <span class="comment">// äº‹ä»¶å¥æŸ„ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Number of active wait queue attached to poll operations */</span></span><br><span class="line"><span class="type">int</span> nwait; </span><br><span class="line"></span><br><span class="line"><span class="comment">/* List containing poll wait queues */</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">list_head</span> pwqlist;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* The &quot;container&quot; of this item */</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">eventpoll</span> *ep; <span class="comment">// æŒ‡å‘å…¶æ‰€å±çš„epolleventå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* List header used to link this item to the &quot;struct file&quot; items list */</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">list_head</span> fllink;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* The structure that describe the interested events and the source fd */</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">epoll_event</span> event; <span class="comment">// è¯¥fdå…³æ³¨çš„äº‹ä»¶</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="5-2-2-PSHæ ‡è®°ä½"><a href="#5-2-2-PSHæ ‡è®°ä½" class="headerlink" title="5.2.2 PSHæ ‡è®°ä½"></a>5.2.2 PSHæ ‡è®°ä½</h3><p>åœ¨å­¦ä¹ TCPçš„æ—¶å€™ï¼Œæˆ‘ä»¬äº†è§£è¿‡PSHè¿™ä¸ªæ ‡è®°ä½ï¼Œå®ƒçš„ä½œç”¨æ˜¯å‘Šè¯‰å¯¹ç«¯çš„åº”ç”¨å±‚ï¼Œå°½å¿«å–èµ°ç¼“å†²åŒºä¸­çš„æ•°æ®ã€‚</p><p>å¯¹äºepollè€Œè¨€ï¼Œè¿™ä¸ªPSHçš„ä½œç”¨å°±æ˜¯è®©epollåœ¨<code>rdllist</code>é‡Œé¢æ–°å»ºä¸€ä¸ªå°±ç»ªèŠ‚ç‚¹ï¼Œè¿™æ ·ä¸Šå±‚å°±èƒ½çŸ¥é“è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„äº‹ä»¶å°±ç»ªäº†ï¼ˆè‡³äºè¯»ä¸è¯»å–ä¾æ—§æ˜¯ä¸Šå±‚çš„é—®é¢˜ï¼‰</p><ul><li>ä½ å¯èƒ½ä¼šé—®ï¼Œæ—¢ç„¶å¯¹æ–¹éƒ½å‘æ¶ˆæ¯æ¥å‚¬ä½ å–æ•°æ®äº†ï¼Œé‚£ä¸åº”è¯¥ä½ çš„æ•°æ®å¹¶æ²¡æœ‰è¢«å–èµ°å—ï¼Ÿè¿™æ—¶å€™è¯¥æ–‡ä»¶æè¿°ç¬¦çš„å°±ç»ªèŠ‚ç‚¹ä¸åº”è¯¥å·²ç»å­˜åœ¨äº†å—ï¼Ÿä¸ºä»€ä¹ˆè¿˜éœ€è¦é¢å¤–åˆ›å»ºä¸€ä¸ªå°±ç»ªäº‹ä»¶çš„èŠ‚ç‚¹æ¥é€šçŸ¥ç”¨æˆ·å‘¢ï¼Ÿ</li></ul><p>è¿™å°±æ¶‰åŠåˆ°epollçš„ä¸¤ç§å·¥ä½œç­–ç•¥LT&#x2F;ETäº†ï¼Œåæ–‡ä¼šè®²è§£ï¼›</p><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œepollå¹¶æ²¡æœ‰å¯¹URGè¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œè€Œæ˜¯è§†ä¹‹ä¸ºæ­£å¸¸çš„å¯è¯»äº‹ä»¶è¿å…¥å°±ç»ªé˜Ÿåˆ—ï¼Œä½†æ˜¯äº‹ä»¶ç±»å‹æœ‰æ‰€ä¸åŒï¼Œå¯ä»¥ç”¨<code>EPOLLPRI</code>æ¥å…³æ³¨ç´§æ€¥äº‹ä»¶</p><p>ï¼ˆå­˜ç–‘ï¼Œä½†æ˜¯æ²¡æœ‰æ‰¾åˆ°ç›¸å…³èµ„æ–™ï¼Œæš‚ä¸”è¿™ä¹ˆè®¤ä¸ºï¼‰</p></blockquote><h3 id="5-2-3-epollä¼˜ç‚¹"><a href="#5-2-3-epollä¼˜ç‚¹" class="headerlink" title="5.2.3 epollä¼˜ç‚¹"></a>5.2.3 epollä¼˜ç‚¹</h3><p>ä¸€ä¸‹æ˜¯epollç›¸æ¯”pollå’Œselectçš„ä¼˜ç‚¹</p><ul><li>æ¥å£ä½¿ç”¨æ–¹ä¾¿ï¼Œè™½ç„¶æ‹†åˆ†äº†3ä¸ªå‡½æ•°ï¼Œä½†æ˜¯æ¯ä¸ªå‡½æ•°çš„åŠŸèƒ½éå¸¸æ˜ç¡®ï¼›ä¸éœ€è¦æ¯æ¬¡ä½¿ç”¨éƒ½é‡æ–°è®¾ç½®æ–‡ä»¶æè¿°ç¬¦ï¼Œä¹Ÿå®ç°äº†è¾“å…¥å’Œè¾“å‡ºå‚æ•°çš„åˆ†ç¦»</li><li>æ•°æ®æ‹·è´è½»é‡ï¼šåœ¨éœ€è¦çš„æ—¶å€™è°ƒç”¨epoll_ctlæ¥å¤„ç†æ–‡ä»¶æè¿°ç¬¦å’Œäº‹ä»¶ï¼Œå¹¶ä¸ä¼šæ¯æ¬¡è°ƒç”¨éƒ½å¾—å¤§æ‰¹é‡åœ¨ç”¨æˆ·å’Œå†…æ ¸æ€ä¹‹é—´æ‹·è´æ•°æ®ï¼ˆpollå’Œselectéƒ½éœ€è¦ï¼‰</li><li>äº‹ä»¶å›è°ƒæœºåˆ¶ï¼šä½¿ç”¨äº‹ä»¶å›è°ƒæ¥æ›¿ä»£éå†ï¼Œå›è°ƒå‡½æ•°å°†å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦ç»“æ„åŠ å…¥åˆ°å°±ç»ªé˜Ÿåˆ—ä¸­ï¼›<code>epoll_wait</code>ç›´æ¥ä½¿ç”¨å°±ç»ªé˜Ÿåˆ—ï¼Œå°±èƒ½çŸ¥é“é‚£äº›æ–‡ä»¶æè¿°ç¬¦å°±ç»ªï¼›å³ä¾¿æ–‡ä»¶æè¿°ç¬¦è¾ƒå¤šçš„æ—¶å€™ï¼Œä¹Ÿèƒ½å¿«é€ŸçŸ¥é“å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆçœå»äº†éå†çš„æ—¶é—´æ¶ˆè€—ï¼‰</li><li>æ— ä¸Šé™ï¼šæ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰æ•°é‡é™åˆ¶</li><li>çº¿ç¨‹å®‰å…¨ï¼šåœ¨<code>eventpoll</code>ç»“æ„ä½“é‡Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ª<code>mutex</code>é”ï¼Œåœ¨linuxåº•å±‚å·²ç»å¸®æˆ‘ç»´æŠ¤äº†epollç›¸å…³æ“ä½œçš„çº¿ç¨‹å®‰å…¨æ€§ï¼</li></ul><p>åœ¨æœ‰äº›åšå®¢é‡Œé¢è¯´epollä½¿ç”¨äº†<strong>å†…å­˜æ˜ å°„æœºåˆ¶</strong>ï¼Œè¿™ç§è¯´æ³•æ˜¯<strong>é”™è¯¯</strong>çš„ï¼å› ä¸º<code>epoll_event</code>ç»“æ„ä½“æ˜¯åœ¨ç”¨æˆ·æ€åˆ›å»ºçš„ï¼Œæˆ‘ä»¬åŠ¿å¿…è¿˜æ˜¯éœ€è¦è¿›è¡Œä¸€å®šçš„ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„æ‹·è´ã€‚</p><blockquote><p>å†…å­˜æ˜ å°„æœºåˆ¶ï¼šlinuxå†…æ ¸ç›´æ¥å°†å°±ç»ªé˜Ÿåˆ—é€šè¿‡mmapçš„æ–¹å¼æ˜ å°„åˆ°ç”¨æˆ·æ€ï¼Œé¿å…æ‹·è´æ¶ˆè€—ï¼ˆä½ å¯ä»¥ç†è§£ä¸ºç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´çš„å…±äº«å†…å­˜ï¼‰</p></blockquote><h2 id="5-3-å·¥ä½œæ¨¡å¼"><a href="#5-3-å·¥ä½œæ¨¡å¼" class="headerlink" title="5.3 å·¥ä½œæ¨¡å¼"></a>5.3 å·¥ä½œæ¨¡å¼</h2><p>åœ¨epollçš„å·¥ä½œæ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æ°´å¹³è§¦å‘å’Œè¾¹ç¼˜è§¦å‘ï¼Œè¿™å°±å¥½æ¯”ç‰©ç†å®éªŒä¸­ç¤ºæ³¢å™¨çš„ä¸¤ç§è§¦å‘æ¨¡å¼ï¼›</p><p>å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªtcpé€šä¿¡çš„æ —å­ï¼š</p><ul><li>å¯¹æ–¹ç»™æˆ‘å‘é€äº†2kbæ•°æ®</li><li>æˆ‘é€šè¿‡epoll_waitæˆåŠŸè·å–åˆ°è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„è¯»äº‹ä»¶å°±ç»ª</li><li>æˆ‘å–å‡ºæ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡<code>recv</code>è¯»å–äº†1kbçš„æ•°æ®</li><li>ä½†ç¼“å†²åŒºé‡Œé¢è¿˜æœ‰1kbâ€¦â€¦</li></ul><h3 id="5-3-1-æ°´å¹³è§¦å‘-LT"><a href="#5-3-1-æ°´å¹³è§¦å‘-LT" class="headerlink" title="5.3.1 æ°´å¹³è§¦å‘ LT"></a>5.3.1 æ°´å¹³è§¦å‘ LT</h3><p>æ‰€è°“æ°´å¹³è§¦å‘ï¼Œå°±æ˜¯åªè¦fdçš„ç¼“å­˜åŒºé‡Œé¢æœ‰æ•°æ®ï¼Œé‚£ä¹ˆepollå°±ä¼šä¸€ç›´è®¤ä¸ºè¿™ä¸ªfdçš„è¯»äº‹ä»¶æ˜¯å°±ç»ªçš„ï¼Œå¹¶ä¸€ç›´é€šçŸ¥ç”¨æˆ·ï¼›</p><ul><li>ä¸Šé¢çš„æ —å­ä¸­ï¼Œå› ä¸ºç”¨æˆ·åªæ‹¿èµ°äº†1kbæ•°æ®ï¼Œç¼“å†²åŒºé‡Œé¢è¿˜æœ‰1kbï¼Œåœ¨ç¬¬äºŒæ¬¡è°ƒç”¨<code>epoll_wait</code>çš„æ—¶å€™ï¼Œepollè¿˜æ˜¯ä¼šæŠ¥å‘Šè¯¥æ–‡ä»¶æè¿°ç¬¦çš„è¯»äº‹ä»¶å°±ç»ªï¼Œè®©ç”¨æˆ·å–èµ°å‰©ä¸‹çš„æ•°æ®</li><li>åªæœ‰æ‰€æœ‰çš„æ•°æ®éƒ½è¢«å¤„ç†å®Œæ¯•ï¼Œepollæ‰ä¸ä¼šç»§ç»­é€šçŸ¥</li><li>LTæ”¯æŒé˜»å¡å’Œéé˜»å¡è¯»å†™</li></ul><p>å› ä¸ºLTæ¨¡å¼åªè¦ç¼“å†²åŒºä¸­è¿˜æœ‰å‰©ä½™æ•°æ®ï¼Œepollå°±ä¼šä¸€ç›´é€šçŸ¥æˆ‘ä»¬ï¼Œè¿™å°±å…è®¸ä¸Šå±‚ä¸éœ€è¦ä¸€æ¬¡æ€§å–èµ°æ‰€æœ‰æ•°æ®ï¼Œæˆ–è€…è¯´ä¸ç«‹åˆ»å¤„ç†å½“å‰ç¼“å†²åŒºçš„æ•°æ®ã€‚</p><p>å› æ­¤ï¼Œåœ¨LTæ¨¡å¼ä¸­ï¼Œåªè¦æ˜¯äº‹ä»¶å°±ç»ªï¼Œé‚£ä¹ˆç¼“å†²åŒºé‡Œé¢ä¸€å®šä¼šæœ‰æ•°æ®ã€‚æ‰€ä»¥å®ƒæ˜¯å³æ”¯æŒé˜»å¡ï¼Œä¹Ÿæ”¯æŒéé˜»å¡çš„æ–‡ä»¶è¯»å†™çš„ï¼</p><blockquote><p>select&#x2F;polléƒ½æ˜¯é»˜è®¤çš„LTæ¨¡å¼ï¼Œä¸”ä¸å¯ä»¥åˆ‡æ¢æ¨¡å¼ï¼›epollé»˜è®¤æ˜¯LTï¼Œä½†å¯ä»¥åˆ‡æ¢åˆ°ET</p></blockquote><h3 id="5-3-2-è¾¹ç¼˜è§¦å‘-ET"><a href="#5-3-2-è¾¹ç¼˜è§¦å‘-ET" class="headerlink" title="5.3.2 è¾¹ç¼˜è§¦å‘ ET"></a>5.3.2 è¾¹ç¼˜è§¦å‘ ET</h3><p>è¾¹ç¼˜è§¦å‘çš„å«ä¹‰ï¼Œæ˜¯åªæœ‰æŸä¸ªæ–‡ä»¶æè¿°ç¬¦çš„æ•°æ®å˜åŠ¨çš„æ—¶å€™ï¼Œæ‰ä¼šé€šçŸ¥ç”¨æˆ·ï¼›ååº”åˆ°è¯»äº‹ä»¶ä¸Šï¼Œåªæœ‰ç¼“å†²åŒºæ•°æ®å¢å¤šäº†ï¼Œæ‰ä¼šé€šçŸ¥ç”¨æˆ·ï¼›</p><ul><li>åœ¨ä¸Šé¢çš„tcpé€šä¿¡æ —å­ä¸­ï¼Œepollä¼šåœ¨æ•°æ®åˆ°æ¥çš„æ—¶å€™é€šçŸ¥ç”¨æˆ·ï¼›ä½†å³ä¾¿ç”¨æˆ·æ²¡æœ‰ä¸€æ¬¡æ€§è¯»å–å®Œæ¯•æ‰€æœ‰æ•°æ®ï¼Œepollå¹¶ä¸ä¼šç»§ç»­é€šçŸ¥äº†ï¼ˆé™¤éæœ‰PSHä¿¡æ¯åˆ°æ¥ï¼‰</li><li>åœ¨ETæ¨¡å¼ä¸‹ï¼Œæ–‡ä»¶æè¿°ç¬¦çš„äº‹ä»¶å°±ç»ªåï¼Œåªæœ‰ä¸€æ¬¡å¤„ç†æœºä¼šã€‚ç¬¬äºŒæ¬¡ä½ å°±æ— æ³•å¾—çŸ¥è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸Šæ˜¯å¦è¿˜æœ‰æ²¡æœ‰è¯»å®Œçš„æ•°æ®äº†</li><li>å› ä¸ºETæ¨¡å¼ä¸‹<code>epoll_wait</code>è¿”å›çš„æ¬¡æ•°æ›´å°‘ï¼Œæ‰€ä»¥ETçš„æ€§èƒ½è¿œé«˜äºLTï¼ˆnginxé»˜è®¤é‡‡ç”¨ETæ¨¡å¼çš„epollï¼‰</li><li>å› ä¸ºæˆ‘ä»¬åªæœ‰ä¸€æ¬¡æœºä¼šï¼Œæ‰€ä»¥æ”¶åˆ°äº‹ä»¶åå¿…é¡»ç«‹å³å¤„ç†</li><li>åªæ”¯æŒéé˜»å¡</li></ul><h3 id="5-3-3-LTå’ŒETçš„åŒºåˆ«"><a href="#5-3-3-LTå’ŒETçš„åŒºåˆ«" class="headerlink" title="5.3.3 LTå’ŒETçš„åŒºåˆ«"></a>5.3.3 LTå’ŒETçš„åŒºåˆ«</h3><p>å› ä¸ºETæ¨¡å¼ä¸‹ï¼Œepollåªä¼šæç¤ºä½ ä¸€æ¬¡äº‹ä»¶å°±ç»ªï¼Œæ‰€ä»¥å°±å€’é€¼ç¨‹åºçŒ¿åœ¨æ”¶åˆ°è¿™ä¸ªäº‹ä»¶ä¹‹åï¼Œä¸€æ¬¡æ€§å¤„ç†å®Œæ•°æ®ï¼›</p><p>å½“ç„¶ï¼ŒLTæ¨¡å¼ä¸‹ä½ ä¹Ÿå¯ä»¥è¿™ä¹ˆåšï¼ˆå¦‚æœæ¯æ¬¡éƒ½èƒ½ä¸€æ¬¡æ€§å–èµ°æ•°æ®ï¼Œé‚£ä¹ˆLTå’ŒETçš„æ€§èƒ½å·®è·å°±ä¸å¤§äº†ï¼‰ã€‚ä½†ETæ¨¡å¼å°±ç›¸å½“äºå‘Šè¯‰æ‰€æœ‰ä½¿ç”¨è€…ï¼Œå¿…é¡»è¿™ä¹ˆåšï¼Œå‡å°‘äº†å®¹é”™ç‡ï¼›</p><p>ä½†ETçš„ä»£ç å¤æ‚åº¦ä¼šå¢åŠ ï¼›</p><h3 id="5-3-4-ETå’Œéé˜»å¡"><a href="#5-3-4-ETå’Œéé˜»å¡" class="headerlink" title="5.3.4 ETå’Œéé˜»å¡"></a>5.3.4 ETå’Œéé˜»å¡</h3><p>ä¸ºä»€ä¹ˆETå¿…é¡»è¦å°†æ–‡ä»¶æè¿°ç¬¦è®¾ç½®æˆéé˜»å¡å‘¢ï¼Ÿ</p><p>å‡è®¾ä¸‹é¢è¿™ä¸ªåœºæ™¯ï¼Œå®¢æˆ·ç«¯Cç»™æœåŠ¡ç«¯Så‘é€10kbæ•°æ®ï¼Œåœ¨æ²¡æœ‰æ”¶åˆ°æœåŠ¡ç«¯å¯¹è¿™ä¸ªæ•°æ®çš„å“åº”ä¹‹å‰ï¼Œä¸ä¼šç»§ç»­å‘é€æ•°æ®ï¼›</p><p><img src="https://img.musnow.top/i/2023/08/1320c1d24627c05783f4d64dc6f43f21.png" alt="image-20230826180800176"></p><p>ä½†æœåŠ¡å™¨ä¸€æ¬¡æ€§åªè¯»å–äº†1KBï¼Œå‰©ä¸‹äº†9KBæ•°æ®åœ¨ç¼“å†²åŒºä¸­ï¼›å› ä¸ºæ•°æ®æ²¡æœ‰è¯»å®Œï¼Œæ‰€ä»¥ä¸ä¼šç»™å®¢æˆ·ç«¯å‘é€å“åº”ã€‚</p><p><img src="https://img.musnow.top/i/2023/08/42b5a34b96663a7b0314afd41e325896.png" alt="image-20230826180840435"></p><p>å› ä¸ºepollè®¾ç½®äº†ETæ¨¡å¼ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šè®¤ä¸ºæ­¤æ—¶çš„æ–‡ä»¶æè¿°ç¬¦è¯»å°±ç»ªï¼›<code>epoll_wait</code>ä¸ä¼šé’ˆå¯¹è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦è¿”å›ï¼Œå‰©ä¸‹çš„9KBæ•°æ®ä¼šä¸€ç›´ç•™åœ¨ç¼“å†²åŒºä¸­ï¼›</p><ul><li>æ³¨æ„ï¼ŒæœåŠ¡ç«¯çš„ä»£ç é€»è¾‘æ˜¯æ”¶åˆ°å°±ç»ªäº‹ä»¶å°±è¯»å–ä¸€æ¬¡ï¼›å¹¶ä¸å­˜åœ¨å†æ¬¡è¯»å–çš„å¯èƒ½</li></ul><p>é—®é¢˜å°±æ¥äº†ï¼</p><ul><li>æœåŠ¡ç«¯å¿…é¡»è¦æ”¶åˆ°å°±ç»ªäº‹ä»¶æ‰ä¼šæŠŠå‰©ä¸‹çš„9kbæ•°æ®ç»™è¯»å–å®Œæ¯•</li><li>æœåŠ¡ç«¯æƒ³è¦æ”¶åˆ°å°±ç»ªäº‹ä»¶ï¼Œå°±å¿…é¡»æ”¶åˆ°å®¢æˆ·ç«¯Cå‘æ¥çš„æ–°æ•°æ®</li><li>ä½†å®¢æˆ·ç«¯Cè®¤ä¸ºæœåŠ¡å™¨æ²¡æœ‰ç»™è‡ªå·±å‘é€å“åº”ï¼Œä¸ä¼šç»§ç»­å‘é€æ•°æ®</li></ul><p>è¿™å°±ç›¸å½“äºä¸€ä¸ªæ­»å¾ªç¯äº†ï¼</p><p><img src="https://img.musnow.top/i/2023/08/be296238e7cd395dabf1599602a8b193.png" alt="image-20230826181214987"></p><p>å› æ­¤ï¼ŒæœåŠ¡ç«¯ä¸ºäº†ä¿è¯ä¸€æ¬¡æ€§èƒ½å°†æ•°æ®å…¨éƒ¨å–å‡ºï¼Œå¿…é¡»è¦é‡‡ç”¨å¾ªç¯è¯»å–+éé˜»å¡çš„æ–¹å¼æ¥å°†ç¼“å†²åŒºè¯»å®Œï¼</p><p>å¦‚æœé‡‡ç”¨é˜»å¡å¼ï¼Œé‚£ä¹ˆåœ¨è½®è¯¢è¯»å–çš„æ—¶å€™ï¼Œå°±æœ‰å¯èƒ½å› ä¸ºç¼“å†²åŒºå·²ç»ç©ºäº†è€Œé˜»å¡ï¼å› ä¸ºæˆ‘ä»¬è¿™ä¸ªæ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„æ¨¡å‹ï¼Œè¿™æ ·ä¼šç›´æ¥å¯¼è‡´æ•´ä¸ªæœåŠ¡å™¨å®•æœºäº†ã€‚</p><p>è€ŒLTåˆ™ä¸ä¼šå‡ºç°æ­¤é—®é¢˜ï¼Œå› ä¸ºåªè¦ç¼“å†²åŒºä¸­æœ‰æ•°æ®å°±ä¼šé€šçŸ¥ä½ ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸€æ¬¡è¯»å–å®šé•¿ï¼Œå†å°†è¯»åˆ°çš„æ•°æ®æ‹¼æ¥èµ·æ¥ã€‚</p><h3 id="5-3-5-epollçš„ä½¿ç”¨åœºæ™¯"><a href="#5-3-5-epollçš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="5.3.5 epollçš„ä½¿ç”¨åœºæ™¯"></a>5.3.5 epollçš„ä½¿ç”¨åœºæ™¯</h3><p>epollçš„é«˜æ€§èƒ½æ˜¯æœ‰ä¸€å®šç‰¹æ®Šåœºæ™¯çš„ï¼Œå¦‚æœåœºæ™¯ä¸é€‚åˆï¼Œepollçš„æ€§èƒ½å¯èƒ½è¡¨ç°ä¸ä½³ï¼›</p><ul><li>å¯¹äºå¤šé“¾æ¥ä¸”é“¾æ¥ä¸­æœ‰ä¸€éƒ¨åˆ†æ´»è·ƒçš„æ—¶å€™ï¼Œé€‚åˆä½¿ç”¨epoll</li></ul><p>æ¯”å¦‚å„ç§äº’è”ç½‘APPçš„å…¥å£æœåŠ¡å™¨ï¼Œå°±å¾ˆé€‚åˆä½¿ç”¨epollæ¥å¤„ç†ä¸Šä¸‡å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼›</p><p>å¦‚æœæ˜¯ç³»ç»Ÿå†…éƒ¨å¤„ç†æœåŠ¡å™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ï¼Œé“¾æ¥æ•°è¾ƒå°‘çš„æƒ…å†µï¼Œè¿™ç§æ—¶å€™ä½¿ç”¨epollå¹¶ä¸æ–¹ä¾¿ã€‚å¾—æ ¹æ®å…·ä½“éœ€è¦é€‰æ‹©æ›´åŠ é€‚åˆçš„IOæ¨¡å‹ã€‚</p><h2 id="5-4-æƒŠç¾¤æ•ˆåº”"><a href="#5-4-æƒŠç¾¤æ•ˆåº”" class="headerlink" title="5.4 æƒŠç¾¤æ•ˆåº”"></a>5.4 æƒŠç¾¤æ•ˆåº”</h2><blockquote><p>å‚è€ƒ <a href="https://zhuanlan.zhihu.com/p/359774959">https://zhuanlan.zhihu.com/p/359774959</a></p></blockquote><h3 id="5-4-1-æ¦‚å¿µ"><a href="#5-4-1-æ¦‚å¿µ" class="headerlink" title="5.4.1 æ¦‚å¿µ"></a>5.4.1 æ¦‚å¿µ</h3><p>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¯èƒ½ä¼šé‡åˆ°epollçš„æƒŠç¾¤æ•ˆåº”ï¼›</p><ul><li>é‚£ä¹ˆä»€ä¹ˆæ˜¯æƒŠç¾¤æ•ˆåº”å‘¢ã€‚å…¶äº§ç”Ÿçš„åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</li></ul><p>æƒŠç¾¤æ•ˆåº”çš„å…·ä½“æƒ…å†µæ˜¯ï¼Œå½“æœ‰å¤šä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹åœ¨ epoll ä¸Šç­‰å¾…æŸä¸ªäº‹ä»¶ï¼ˆå¦‚å¥—æ¥å­—å¯è¯»äº‹ä»¶ï¼‰ï¼Œå½“è¯¥äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹æˆ–è¿›ç¨‹éƒ½ä¼šè¢«å”¤é†’ã€‚ç„¶è€Œï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹å¯ä»¥æˆåŠŸåœ°å¤„ç†è¿™ä¸ªäº‹ä»¶ï¼Œè€Œå…¶ä»–çš„çº¿ç¨‹æˆ–è¿›ç¨‹ä¼šè¿›è¡Œä¸å¿…è¦çš„ç«äº‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´é¢å¤–çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€é”ç«äº‰ç­‰é—®é¢˜ï¼Œä»è€Œé™ä½ç³»ç»Ÿæ€§èƒ½ã€‚</p><ul><li>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…·ä½“åœºæ™¯çš„è¯´æ˜</li></ul><p>åœ¨å¤šçº¿ç¨‹æˆ–è€…å¤šè¿›ç¨‹ç¯å¢ƒä¸‹ï¼Œæœ‰äº›äººä¸ºäº†æé«˜ç¨‹åºçš„ç¨³å®šæ€§ï¼Œå¾€å¾€ä¼šè®©<strong>å¤šä¸ªçº¿ç¨‹</strong>æˆ–è€…<strong>å¤šä¸ªè¿›ç¨‹</strong>åŒæ—¶åœ¨<code>epoll_wait</code>ç›‘å¬çš„socketæè¿°ç¬¦ã€‚å½“ä¸€ä¸ªæ–°çš„é“¾æ¥è¯·æ±‚è¿›æ¥æ—¶ï¼Œæ“ä½œç³»ç»Ÿ<strong>ä¸çŸ¥é“</strong>é€‰æ´¾é‚£ä¸ªçº¿ç¨‹æˆ–è€…è¿›ç¨‹å¤„ç†æ­¤äº‹ä»¶ï¼Œåˆ™å¹²è„†å°†å…¶ä¸­<strong>å‡ ä¸ªçº¿ç¨‹</strong>æˆ–è€…è¿›ç¨‹ç»™å”¤é†’ï¼Œè€Œå®é™…ä¸Šåªæœ‰å…¶ä¸­ä¸€ä¸ªè¿›ç¨‹æˆ–è€…çº¿ç¨‹èƒ½å¤ŸæˆåŠŸå¤„ç†acceptäº‹ä»¶ï¼Œå…¶ä»–çº¿ç¨‹éƒ½å°†å¤±è´¥ï¼Œä¸”errnoé”™è¯¯ç ä¸º<code>EAGAIN</code>ã€‚è¿™ç§ç°è±¡ç§°ä¸ºæƒŠç¾¤æ•ˆåº”ã€‚</p><p>ç»“æœæ˜¯è‚¯å®šçš„ï¼ŒæƒŠç¾¤æ•ˆåº”è‚¯å®šä¼šå¸¦æ¥èµ„æºçš„æ¶ˆè€—å’Œæ€§èƒ½çš„å½±å“ï¼Œå› ä¸ºä½ æ— ç«¯åœ°å¤šå”¤é†’äº†å‡ ä¸ªçº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹&#x2F;è¿›ç¨‹å´æ²¡æœ‰æ´»å¹²ã€‚</p><h3 id="5-4-2-å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è§£å†³åŠæ³•"><a href="#5-4-2-å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è§£å†³åŠæ³•" class="headerlink" title="5.4.2 å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è§£å†³åŠæ³•"></a>5.4.2 å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è§£å†³åŠæ³•</h3><ul><li>ä¸“é—¨çš„çº¿ç¨‹è´Ÿè´£ç­‰å¾…ï¼šåœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹ï¼Œä¸å»ºè®®è®©å¤šä¸ªçº¿ç¨‹è¿›è¡Œ<code>epoll_wait</code>ï¼Œè€Œç”¨å•ä¸ªçº¿ç¨‹è¿›è¡Œwaitï¼Œå¹¶ç”±è¯¥çº¿ç¨‹è°ƒç”¨<code>accept</code>å»ºç«‹æ–°é“¾æ¥ï¼Œå¹¶å°†å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦äº¤ä»˜ç»™å…¶ä»–çº¿ç¨‹ï¼Œæ¥å¤„ç†åç»­çš„è¯»å†™æ“ä½œã€‚</li><li>ä½¿ç”¨çº¿ç¨‹æ± ï¼šä¸ä¸ºæ¯ä¸ªé“¾æ¥éƒ½åˆ›ç«‹ä¸€ä¸ªä¸“é—¨çš„çº¿ç¨‹ï¼Œè€Œæ˜¯æ ¹æ®è¯»å†™äº‹ä»¶ï¼Œå°†å…¶äº¤ä»˜ç»™çº¿ç¨‹æ± ä¸­å·²æœ‰çº¿ç¨‹æ¥å¤„ç†ï¼›</li><li>ä½¿ç”¨ETæ¨¡å¼ï¼šè¯¥æ¨¡å¼ä¸‹è¯»å†™å°±ç»ªçš„æ—¶å€™åªä¼šé€šçŸ¥ä¸€æ¬¡ï¼Œå†åŠ ä¸Šepollæœ¬èº«æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥åªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‹¿åˆ°è¿™ä¸ªå°±ç»ªäº‹ä»¶ï¼Œä»è€Œé¿å…æƒŠç¾¤ç°è±¡ï¼›</li><li>äº’æ–¥é”ï¼šåŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œç­‰å¾…å’Œäº‹ä»¶å¤„ç†ï¼›</li></ul><h3 id="5-4-3-å¤šè¿›ç¨‹ä¸‹è§£å†³åŠæ³•"><a href="#5-4-3-å¤šè¿›ç¨‹ä¸‹è§£å†³åŠæ³•" class="headerlink" title="5.4.3 å¤šè¿›ç¨‹ä¸‹è§£å†³åŠæ³•"></a>5.4.3 å¤šè¿›ç¨‹ä¸‹è§£å†³åŠæ³•</h3><p>ç›®å‰å¾ˆå¤šå¼€æºè½¯ä»¶ï¼Œå¦‚lighttpdå’Œnginxç­‰éƒ½é‡‡ç”¨<code>master/workers</code>çš„æ¨¡å¼æé«˜è½¯ä»¶çš„ååèƒ½åŠ›åŠå¹¶å‘èƒ½åŠ›ï¼Œåœ¨nginxä¸­ç”šè‡³è¿˜é‡‡ç”¨äº†<strong>è´Ÿè½½å‡è¡¡</strong>çš„æŠ€æœ¯ï¼Œåœ¨æŸä¸ªå­è¿›ç¨‹çš„å¤„ç†èƒ½åŠ›è¾¾åˆ°ä¸€å®šè´Ÿè½½ä¹‹åï¼Œç”±å…¶ä»–<strong>è´Ÿè½½è¾ƒè½»çš„å­è¿›ç¨‹</strong>è´Ÿè´£Â·çš„è°ƒç”¨ï¼Œé‚£ä¹ˆnginxå’ŒLighttpdæ˜¯å¦‚ä½•é¿å…<code>epoll_wait</code>çš„æƒŠç¾¤æ•ˆç”¨çš„å‘¢ï¼Ÿ</p><ul><li>lighttpdçš„è§£å†³æ€è·¯æ˜¯<strong>æ— è§†</strong>æƒŠç¾¤æ•ˆåº”</li></ul><p>ä»ç„¶é‡‡ç”¨<code>master/workers</code>æ¨¡å¼ï¼Œæ¯ä¸ªå­è¿›ç¨‹ä»ç„¶è‡ªå·±åœ¨ç›‘å¬çš„socketä¸Šè°ƒç”¨<code>epoll_wait</code>ï¼Œå½“æœ‰æ–°çš„é“¾æ¥è¯·æ±‚å‘ç”Ÿæ—¶ï¼Œæ“ä½œç³»ç»Ÿä»ç„¶åªæ˜¯å”¤é†’å…¶ä¸­éƒ¨åˆ†çš„å­è¿›ç¨‹æ¥å¤„ç†è¯¥äº‹ä»¶ï¼Œä»ç„¶åªæœ‰ä¸€ä¸ªå­è¿›ç¨‹èƒ½å¤ŸæˆåŠŸå¤„ç†æ­¤äº‹ä»¶ï¼Œé‚£ä¹ˆå…¶ä»–è¢«æƒŠé†’çš„å­è¿›ç¨‹æ•è·<code>EAGAIN</code>é”™è¯¯ï¼Œå¹¶æ— è§†ã€‚</p><ul><li>nginxçš„è§£å†³æ€è·¯æ˜¯äº’æ–¥é”</li></ul><p>åœ¨åŒä¸€æ—¶åˆ»ï¼Œ<strong>æ°¸è¿œéƒ½åªæœ‰ä¸€ä¸ª</strong>å­è¿›ç¨‹åœ¨ç›‘å¬çš„socketä¸Š<code>epoll_wait</code>ï¼Œå…¶åšæ³•æ˜¯ï¼Œåˆ›å»ºä¸€ä¸ªå…¨å±€çš„<code>pthread_mutex_t</code>ï¼Œåœ¨å­è¿›ç¨‹è¿›è¡Œ<code>epoll_wait</code>å‰ï¼Œåˆ™å…ˆè·å–é”ã€‚å½“<code>epoll_wait</code>è¿”å›ä¹‹åï¼Œnginxä¼šè°ƒç”¨acceptæŠŠè¿æ¥å–å‡ºæ¥ï¼Œç„¶åé‡Šæ”¾æ–‡ä»¶é”ï¼Œè®©åˆ«çš„è¿›ç¨‹å»ç›‘å¬ã€‚</p><p>è¿™æ˜¯ä¸€ç§æŠ˜è¡·çš„åŠæ³•ï¼Œå¹¶æ²¡æœ‰å¾ˆå®Œç¾ï¼Œé¦–å…ˆè¿›ç¨‹é—´<strong>äº‰æŠ¢é”</strong>ä¼šæœ‰æ€§èƒ½å¼€è€—ï¼ˆå³ä½¿æ˜¯éé˜»å¡çš„é”ï¼‰ï¼Œä¸­é—´å¯èƒ½ä¼šæœ‰å°æ®µæ—¶é—´æ²¡æœ‰è¿›ç¨‹å»è·å–é”ï¼Œæ¯”å¦‚Aè¿›ç¨‹æ‹¿åˆ°é”ï¼Œå…¶ä»–è¿›ç¨‹å°†ä¼šè¿‡ä¸€å°æ®µæ—¶é—´å°è¯•å†å»è·å–é”ï¼Œè€Œè¿™å°æ®µæ—¶é—´é‡Œé¢å¦‚æœè¯·æ±‚é‡å¾ˆå¤§ï¼ŒAä»…æ¥å—ä¸€å°éƒ¨åˆ†è¯·æ±‚å°±è®©å‡ºé”ï¼Œåˆ™ä¸­é—´è¿‡ç¨‹ä¼šæœ‰ä¸€äº›è¿æ¥äº‹ä»¶è¢«hangä½ï¼›</p><h3 id="5-4-4-å†…æ ¸è§£å†³äº†æƒŠç¾¤æ•ˆåº”äº†å—"><a href="#5-4-4-å†…æ ¸è§£å†³äº†æƒŠç¾¤æ•ˆåº”äº†å—" class="headerlink" title="5.4.4 å†…æ ¸è§£å†³äº†æƒŠç¾¤æ•ˆåº”äº†å—"></a>5.4.4 å†…æ ¸è§£å†³äº†æƒŠç¾¤æ•ˆåº”äº†å—</h3><p>æƒŠç¾¤çš„æ ¹æœ¬åŸå› åœ¨äºepollçš„é»˜è®¤è¡Œä¸ºæ˜¯å¯¹äº<strong>å¤šè¿›ç¨‹ç›‘å¬åŒä¸€æ–‡ä»¶ä¸ä¼šè®¾ç½®äº’æ–¥</strong>ï¼Œè¿›è€Œå°†æ‰€æœ‰è¿›ç¨‹å”¤é†’ï¼Œåç»­çš„å†…æ ¸ç‰ˆæœ¬ä¸»è¦æä¾›äº†ä¸¤ç§è§£å†³æ–¹æ¡ˆ</p><ol><li>æ—¢ç„¶é»˜è®¤ä¸ä¼šè®¾ç½®äº’æ–¥ï¼Œé‚£å°±åŠ ä¸€ä¸ªäº’æ–¥åŠŸèƒ½å¥½äº†ï¼Œ<code>linux 4.5</code>å†…æ ¸ä¹‹åç»™epollæ·»åŠ äº†ä¸€ä¸ª<code>EPOLLEXCLUSIVE</code>çš„æ ‡å¿—ä½ï¼Œå¦‚æœè®¾ç½®äº†è¿™ä¸ªæ ‡å¿—ä½ï¼Œé‚£epollå°†è¿›ç¨‹æŒ‚åˆ°ç­‰å¾…é˜Ÿåˆ—æ—¶å°†ä¼šè®¾ç½®ä¸€ä¸‹äº’æ–¥æ ‡å¿—ä½ï¼Œè¿™æ—¶å®ç°è·Ÿå†…æ ¸åŸç”Ÿacceptä¸€æ ·çš„ç‰¹æ€§ï¼Œåªä¼šå”¤é†’é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªè¿›ç¨‹</li><li>ç¬¬äºŒç§æ–¹æ³•ï¼š<code>linux 3.9</code>å†…æ ¸ä¹‹åç»™socketæä¾›<code>SO_REUSEPORT</code>æ ‡å¿—ï¼Œè¿™ç§æ–¹å¼è§£å†³å¾—æ›´å½»åº•ï¼Œä»–å…è®¸ä¸åŒè¿›ç¨‹çš„socketç»‘å®šåˆ°åŒä¸€ä¸ªç«¯å£ï¼Œå–ä»£ä»¥å¾€éœ€è¦å­è¿›ç¨‹å…±äº«socketç›‘å¬çš„æ–¹å¼ï¼Œè¿™æ—¶å€™ï¼Œæ¯ä¸ªè¿›ç¨‹çš„ç›‘å¬socketå°†æŒ‡å‘<code>open_file_tables</code>ä¸‹çš„ä¸åŒèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸åŒè¿›ç¨‹æ˜¯åœ¨è‡ªå·±çš„è®¾å¤‡ç­‰å¾…é˜Ÿåˆ—ä¸‹è¢«æŒ‚èµ·çš„ï¼Œä¸å­˜åœ¨å…±äº«fdçš„é—®é¢˜ï¼Œä¹Ÿå°±ä¸å­˜åœ¨è¢«åŒæ—¶å”¤é†’çš„å¯èƒ½ã€‚è€Œå†…æ ¸åˆ™åœ¨é©±åŠ¨ä¸­å°†è®¾ç½®äº†<code>SO_REUSEPORT</code>å¹¶ä¸”ç»‘å®šåŒä¸€ç«¯å£çš„è¿™äº›socketåˆ†åˆ°åŒä¸€ä¸ªgroupä¸­ï¼Œå½“æœ‰tcpè¿æ¥äº‹ä»¶åˆ°è¾¾çš„æ—¶å€™ï¼Œå†…æ ¸å°†ä¼šå¯¹æº<code>IP+æºç«¯å£</code>å–hashç„¶åæŒ‡å®šè¿™ä¸ªgroupä¸­å…¶ä¸­ä¸€ä¸ªè¿›ç¨‹æ¥æ¥å—è¿æ¥ï¼Œç›¸å½“äºåœ¨å†…æ ¸çº§åˆ«ä¸­å®ç°äº†ä¸€ä¸ªè´Ÿè½½å‡è¡¡</li></ol><p>åŸºäºä»¥ä¸Šä¸¤ç§æ–¹æ³•ï¼Œå…¶å®epollç”Ÿæ€åœ¨ç›®å‰æ¥è¯´ä¸å­˜åœ¨æ‰€è°“çš„æƒŠç¾¤æ•ˆåº”äº†ã€‚è€Œæ–°ç‰ˆæœ¬çš„nginxä¹Ÿé‡‡ç”¨äº† <code>SO_REUSEPORT</code>æ¥è§£å†³æ­¤é—®é¢˜ã€‚</p><p>é™¤éä½ æº¢ç”¨epollï¼Œæ¯”å¦‚å¤šè¿›ç¨‹ä¹‹é—´å…±äº«äº†åŒä¸€ä¸ªepfdï¼ˆçˆ¶è¿›ç¨‹åˆ›å»ºepollç”±å¤šä¸ªå­è¿›ç¨‹æ¥è°ƒç”¨ï¼‰ï¼Œé‚£å°±ä¸èƒ½æ€ªepolläº†ï¼Œå› ä¸ºè¿™æ—¶å€™å¤šä¸ªè¿›ç¨‹éƒ½è¢«æŒ‚åˆ°è¿™ä¸ªepollä¸‹ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå·²ç»ä¸æ˜¯ä»…ä»…æ˜¯æƒŠç¾¤æ•ˆåº”çš„é—®é¢˜äº†ï¼›æ¯”å¦‚è¯´ï¼ŒAè¿›ç¨‹åœ¨epollæŒ‚äº†socket1çš„è¿æ¥äº‹ä»¶ï¼ŒBè¿›ç¨‹è°ƒç”¨äº†epoll_waitï¼Œç”±äºå±äºåŒä¸€ä¸ªepfdï¼Œå½“socket1äº§ç”Ÿäº‹ä»¶çš„æ—¶å€™ï¼Œè¿›ç¨‹Bä¹Ÿä¼šè¢«å”¤é†’ï¼Œè€Œæ›´ä¸¥é‡çš„äº‹æƒ…åœ¨äºï¼Œåœ¨Bè¿›ç¨‹çš„ç©ºé—´ä¸‹å¹¶ä¸å­˜åœ¨socket1è¿™ä¸ªfdï¼Œä»è€ŒæŠŠé—®é¢˜æå¾—å¾ˆå¤æ‚ã€‚</p><p>æ€»ç»“ï¼šåƒä¸‡ä¸è¦åœ¨å¤šçº¿ç¨‹&#x2F;å¤šè¿›ç¨‹ä¹‹é—´å…±äº«epfdï¼</p><h1 id="6-Reactoræ¨¡å‹"><a href="#6-Reactoræ¨¡å‹" class="headerlink" title="6.Reactoræ¨¡å‹"></a>6.Reactoræ¨¡å‹</h1><p>æ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬æ¥ç”¨epollç¼–å†™ä¸€ä¸ªåŸºäºReactoræ¨¡å¼çš„æœåŠ¡å™¨å§ï¼</p><h2 id="6-1-ä»€ä¹ˆæ˜¯Reactorï¼Ÿ"><a href="#6-1-ä»€ä¹ˆæ˜¯Reactorï¼Ÿ" class="headerlink" title="6.1 ä»€ä¹ˆæ˜¯Reactorï¼Ÿ"></a>6.1 ä»€ä¹ˆæ˜¯Reactorï¼Ÿ</h2><ul><li>Reactoræ¨¡å‹æ˜¯åŸºäºäº‹ä»¶é©±åŠ¨çš„ï¼Œé€šè¿‡ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¾“å…¥åŒæ—¶ä¼ é€’ç»™æœåŠ¡ç«¯è¿›è¡Œå¤„ç†</li><li>æœåŠ¡ç«¯è¯·æ±‚ç¨‹åºå¤„ç†ä¼ å…¥çš„å¤šä¸ªè¯·æ±‚ï¼Œå¹¶åˆ†å‘åˆ°ç›¸åº”çš„å¤„ç†çº¿ç¨‹</li><li>åŸºäºIOå¤šè·¯è½¬æ¥ï¼ˆå¤šè·¯å¤ç”¨ï¼‰æ¨¡å‹ï¼šå¤šä¸ªé“¾æ¥é€šç”¨ä¸€ä¸ªé˜»å¡å¯¹è±¡ï¼Œå¼•ç”¨ç¨‹åºåªéœ€è¦åœ¨ä¸€ä¸ªé˜»å¡å¯¹è±¡ç­‰å¾…ï¼Œæ— éœ€é˜»å¡ç­‰å¾…æ‰€æœ‰é“¾æ¥ï¼›å½“æœ‰æ–°é“¾æ¥æˆ–è€…äº‹ä»¶å°±ç»ªçš„æ—¶å€™ï¼Œç”±æ“ä½œç³»ç»Ÿé€šçŸ¥åº”ç”¨ç¨‹åºï¼Œå¼€å§‹è¿›è¡Œä¸šåŠ¡å¤„ç†</li><li>åŸºäºçº¿ç¨‹æ± å¤ç”¨çº¿ç¨‹èµ„æºï¼šä¸å¿…ç»™æ¯ä¸ªé“¾æ¥å•ç‹¬åˆ›å»ºçº¿ç¨‹ï¼Œè€Œæ˜¯å°†é“¾æ¥å®Œæˆåçš„ä¸šåŠ¡å¤„ç†äº¤ä»˜ç»™å·²æœ‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨ç”Ÿå‘½å‘¨æœŸä¸­å¯ä»¥å¤„ç†å¤šä¸ªé“¾æ¥çš„ä¸šåŠ¡ã€‚</li></ul><p>reactoræ¨¡å¼æœ‰ä¸‹é¢3ç§æ–¹å¼ï¼Œ<a href="https://blog.csdn.net/wlddhj/article/details/123872275">å‚è€ƒåšå®¢ @é¡½çŸ³ä¹å˜</a></p><h3 id="6-1-1-ä¸»ä»Reactorå¤šçº¿ç¨‹æ¨¡å‹"><a href="#6-1-1-ä¸»ä»Reactorå¤šçº¿ç¨‹æ¨¡å‹" class="headerlink" title="6.1.1 ä¸»ä»Reactorå¤šçº¿ç¨‹æ¨¡å‹"></a>6.1.1 ä¸»ä»Reactorå¤šçº¿ç¨‹æ¨¡å‹</h3><p>ç¬¬ä¸€ç§æ˜¯å¤šçº¿ç¨‹æ¨¡å¼çš„ï¼Œæœ‰ä¸åŒçš„ä»å±reactoræ¥è¿›è¡Œäº‹ä»¶ç›‘æ§å’Œå¤„ç†</p><ul><li>Reactorä¸»çº¿ç¨‹è´Ÿè´£ç›‘å¬äº‹ä»¶å¹¶è¿›è¡Œé“¾æ¥çš„accept</li><li>accpetè·å–åˆ°é“¾æ¥åï¼Œåˆ†é…ç»™æŸä¸€ä¸ªä»Reactorè¿›è¡Œè¯»å†™äº‹ä»¶çš„ç›‘å¬</li><li>ä»Reactorè¿›è¡Œäº‹ä»¶ç›‘å¬ï¼Œå½“æœ‰æ–°äº‹ä»¶å‘ç”Ÿçš„æ—¶å€™ï¼Œåˆ›å»ºHandlerè¿›è¡Œäº‹ä»¶å¤„ç†</li><li>Headleré€šè¿‡readè¯»å–æ•°æ®ï¼Œå¹¶å¤„ç†æ•°æ®ï¼ˆè¿™é‡Œè¿˜å¯ä»¥å°†è¯»å–æ•°æ®åçš„å“åº”æ“ä½œåˆ†å‘ç»™çº¿ç¨‹æ± è¿›è¡Œå¤„ç†ï¼Œçº¿ç¨‹æ± å¤„ç†å®Œæ¯•åè¿”å›ç»™Handlerï¼‰ï¼Œé€šè¿‡sendè¿”å›ç»™å®¢æˆ·ç«¯</li><li>Reactorä¸»çº¿ç¨‹å¯ä»¥å¯¹åº”å¤šä¸ªå­çº¿ç¨‹</li></ul><p><img src="https://img.musnow.top/i/2023/08/9b1f1f0aec63e52ed44fca99f18d6e5a.png" alt="image-20230828085218401"></p><p><img src="https://img.musnow.top/i/2023/08/ecdd89978c73b286f89f29703c620c7e.png" alt="img"></p><h3 id="6-1-2-å•Reactorå¤šçº¿ç¨‹"><a href="#6-1-2-å•Reactorå¤šçº¿ç¨‹" class="headerlink" title="6.1.2 å•Reactorå¤šçº¿ç¨‹"></a>6.1.2 å•Reactorå¤šçº¿ç¨‹</h3><ul><li>Reactoré€šè¿‡å¤šè·¯è½¬æ¥ç›‘å¬å®¢æˆ·ç«¯äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åï¼Œè¿›è¡Œåˆ†å‘</li><li>å¦‚æœæ˜¯å»ºç«‹é“¾æ¥çš„è¯·æ±‚ï¼Œåˆ™æ‰§è¡Œacceptï¼Œå»ºç«‹é“¾æ¥åï¼Œåˆ›å»ºä¸€ä¸ªHandlerå®Œæˆé“¾æ¥å»ºç«‹åçš„å„ä¸ªæ“ä½œ</li><li>å¦‚æœä¸æ˜¯é“¾æ¥è¯·æ±‚ï¼ˆè¯»å†™å°±ç»ªï¼‰åˆ™ç”±Reactoråˆ†å‘è°ƒç”¨é“¾æ¥å¯¹åº”çš„è¯»å†™Handleræ¥è¿›è¡Œå¤„ç†</li><li>Handleråªè´Ÿè´£å“åº”å…·ä½“çš„äº‹ä»¶ï¼Œè€Œä¸è¿›è¡Œå…·ä½“çš„ä¸šåŠ¡å¤„ç†</li><li>é€šè¿‡Handlerä¸­çš„readè¯»å–åˆ°æ•°æ®åï¼Œåˆ†å‘ç»™çº¿ç¨‹æ± å­ä¸­çš„çº¿ç¨‹å¤„ç†ï¼Œå¤„ç†å®Œæ¯•åè¿”å›Handlerï¼Œå†é€šè¿‡å†™æ–¹æ³•å‘é€ç»™å®¢æˆ·ç«¯</li></ul><p><img src="https://img.musnow.top/i/2023/08/18889218bcf8b973dd2140f84ee48c1d.png" alt="img"></p><h3 id="6-1-3-å•Reactorå•çº¿ç¨‹"><a href="#6-1-3-å•Reactorå•çº¿ç¨‹" class="headerlink" title="6.1.3 å•Reactorå•çº¿ç¨‹"></a>6.1.3 å•Reactorå•çº¿ç¨‹</h3><p>ç¬¬ä¸‰ç§æ˜¯å•çº¿ç¨‹æ¨¡å¼ä¸‹çš„ï¼ˆåŠå¼‚æ­¥åŠåŒæ­¥æ¨¡å‹ï¼‰ï¼Œå½“æ”¶åˆ°æŸä¸ªå®¢æˆ·ç«¯çš„å°±ç»ªäº‹ä»¶ï¼Œå°±å»å¤„ç†è¿™ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚æ­¤æ—¶Handlerä¼šå®Œæˆreadåˆ°ä¸šåŠ¡å¤„ç†åˆ°sendçš„å…¨æµç¨‹ï¼›</p><p>æœ¬æ¬¡ä¸»è¦å†™çš„æ˜¯è¯¥æ¨¡å¼ä¸‹çš„æ“ä½œï¼Œå› ä¸ºå®ƒåŸºæœ¬æ˜¯<strong>ä¸²è¡Œ</strong>è¿è¡Œçš„ï¼Œæ€è·¯æ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§æ¨¡å¼æ”¯æŒçš„å®¢æˆ·ç«¯é‡ä¸åº”è¿‡å¤šï¼Œå¦åˆ™ä¼šæå¤§å½±å“æ€§èƒ½ã€‚</p><p><img src="https://img.musnow.top/i/2023/08/bd8688effc6efb18264e9785cc78b54e.png" alt="image-20230828085239238"></p><p><img src="https://img.musnow.top/i/2023/08/b057900a9b937973503f493cfa576711.png" alt="img"></p><h3 id="6-1-4-æ€»ç»“"><a href="#6-1-4-æ€»ç»“" class="headerlink" title="6.1.4 æ€»ç»“"></a>6.1.4 æ€»ç»“</h3><p><strong>ä¸‰ç§æ¨¡å¼ç”¨ç”Ÿæ´»æ¡ˆä¾‹æ¥ç†è§£</strong></p><ol><li><p>å•Reactorå•çº¿ç¨‹ï¼Œå‰å°æ¥å¾…å‘˜å’ŒæœåŠ¡å‘˜æ˜¯åŒä¸€ä¸ªäººï¼Œå…¨ç¨‹ä¸ºé¡¾å®¢æœåŠ¡</p></li><li><p>å•Reactorå¤šçº¿ç¨‹ï¼Œ1ä¸ªå‰å°æ¥å¾…å‘˜ï¼Œå¤šä¸ªæœåŠ¡å‘˜ï¼Œæ¥å¾…å‘˜åªè´Ÿè´£æ¥å¾…</p></li><li><p>ä¸»ä»Reactorå¤šçº¿ç¨‹ï¼Œå¤šä¸ªå‰å°æ¥å¾…å‘˜ï¼Œå¤šä¸ªæœåŠ¡å‘˜</p></li></ol><p><strong>Reactoræ¨¡å‹å…·æœ‰å¦‚ä¸‹ä¼˜ç‚¹</strong></p><ol><li><p>å“åº”å¿«ï¼Œä¸å¿…ä¸ºå•ä¸ªåŒæ­¥äº‹ä»¶æ‰€é˜»å¡ï¼Œè™½ç„¶Reactoræœ¬èº«ä¾ç„¶æ˜¯åŒæ­¥çš„</p></li><li><p>å¯ä»¥æœ€å¤§ç¨‹åº¦çš„é¿å…å¤æ‚çš„å¤šçº¿ç¨‹åŠåŒæ­¥é—®é¢˜ï¼Œå¹¶ä¸”é¿å…äº†å¤šçº¿ç¨‹&#x2F;è¿›ç¨‹çš„åˆ‡æ¢å¼€é”€</p></li><li><p>æ‰©å±•æ€§å¥½ï¼Œå¯ä»¥æ–¹ä¾¿çš„é€šè¿‡å¢åŠ Reactorå®ä¾‹ä¸ªæ•°æ¥å……åˆ†åˆ©ç”¨CPUèµ„æº</p></li><li><p>å¤ç”¨æ€§å¥½ï¼ŒReactoræ¨¡å‹æœ¬èº«ä¸å…·ä½“äº‹ä»¶å¤„ç†é€»è¾‘æ— å…³ï¼Œå…·æœ‰å¾ˆé«˜çš„å¤ç”¨æ€§</p></li></ol><h2 id="6-2-ä»£ç åˆ†æ"><a href="#6-2-ä»£ç åˆ†æ" class="headerlink" title="6.2 ä»£ç åˆ†æ"></a>6.2 ä»£ç åˆ†æ</h2><p>è¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šä»£ç å§ï¼æœ¬æ¬¡å°†æ‰€æœ‰å¤„ç†æ¨¡å—éƒ½ç»™æ‹†åˆ†å¼€æ¥ï¼Œä¸€ä¸€è¿›è¡Œè¯´æ˜</p><h3 id="6-2-1-Epoller-hpp"><a href="#6-2-1-Epoller-hpp" class="headerlink" title="6.2.1 Epoller.hpp"></a>6.2.1 Epoller.hpp</h3><p>é¦–å…ˆæ˜¯å°†å¯¹epollçš„ä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨å‡½æ•°è¿›è¡Œä¸€å®šçš„å°è£…ï¼Œç»Ÿä¸€è¿›è¡Œé”™è¯¯çš„åˆ¤æ–­å¤„ç†ã€‚æ–¹ä¾¿äº†å…¶ä»–æ¨¡å—çš„è°ƒç”¨ç”¨ï¼›</p><p>è¿™éƒ¨åˆ†çš„ä»£ç éå¸¸ç®€å•ï¼Œå°±åªåœ¨æ³¨é‡Šé‡Œå†™ä¸€ä¸‹è§£æå§ï¼</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cerrno&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/epoll.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Log.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Epoller</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> gsize = <span class="number">128</span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">CreateEpoller</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> epfd = <span class="built_in">epoll_create</span>(gsize); <span class="comment">// åˆ›å»ºå¯¹åº”sizeçš„epfd</span></span><br><span class="line">        <span class="keyword">if</span> (epfd &lt; <span class="number">0</span>) <span class="comment">// é”™è¯¯åˆ¤æ–­</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">logMessage</span>(FATAL, <span class="string">&quot;epoll_create : %d : %s&quot;</span>, errno, <span class="built_in">strerror</span>(errno));</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> epfd; <span class="comment">// æ­£ç¡®è¿”å›epfd</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">bool</span> <span class="title">AddEvent</span><span class="params">(<span class="type">int</span> epfd, <span class="type">int</span> sock, <span class="type">uint32_t</span> event)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">epoll_event</span> ev;</span><br><span class="line">        ev.events = event; <span class="comment">// è®¾ç½®event</span></span><br><span class="line">        ev.data.fd = sock;</span><br><span class="line">        <span class="comment">// ç»™å¯¹åº”çš„socketæ·»åŠ åˆ°epollä¸­</span></span><br><span class="line">        <span class="type">int</span> n = <span class="built_in">epoll_ctl</span>(epfd, EPOLL_CTL_ADD, sock, &amp;ev);</span><br><span class="line">        <span class="keyword">return</span> n == <span class="number">0</span>; <span class="comment">// è¿”å›å€¼æ˜¯æ˜¯å¦è°ƒç”¨æˆåŠŸ</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">bool</span> <span class="title">ModEvent</span><span class="params">(<span class="type">int</span> epfd, <span class="type">int</span> sock, <span class="type">uint32_t</span> event)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">epoll_event</span> ev;</span><br><span class="line">        ev.events = event;</span><br><span class="line">        ev.data.fd = sock;</span><br><span class="line">        <span class="comment">// ä¿®æ”¹å·²æœ‰scoketçš„event</span></span><br><span class="line">        <span class="comment">// è¯¥socketå¿…é¡»å…ˆç”¨ADDæ·»åŠ ï¼Œå¦åˆ™æ— æ³•ä¿®æ”¹ï¼Œä¼šè¿”å›ENOENTé”™è¯¯</span></span><br><span class="line">        <span class="type">int</span> n = <span class="built_in">epoll_ctl</span>(epfd, EPOLL_CTL_MOD, sock, &amp;ev);</span><br><span class="line">        <span class="keyword">return</span> n == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">bool</span> <span class="title">DelEvent</span><span class="params">(<span class="type">int</span> epfd, <span class="type">int</span> sock)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ é™¤æŒ‡å®šsocket</span></span><br><span class="line">        <span class="type">int</span> n = <span class="built_in">epoll_ctl</span>(epfd, EPOLL_CTL_DEL, sock, <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="keyword">return</span> n == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">LoopOnce</span><span class="params">(<span class="type">int</span> epfd, <span class="keyword">struct</span> epoll_event revs[], <span class="type">int</span> num)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// å•æ¬¡waitçš„è°ƒç”¨ï¼Œä»æ•°ç»„é‡Œé¢å–å›å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">        <span class="type">int</span> n = <span class="built_in">epoll_wait</span>(epfd, revs, num, <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">-1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">logMessage</span>(FATAL, <span class="string">&quot;epoll_wait : %d : %s&quot;</span>, errno, <span class="built_in">strerror</span>(errno));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="6-2-2-Sock-hpp"><a href="#6-2-2-Sock-hpp" class="headerlink" title="6.2.2 Sock.hpp"></a>6.2.2 Sock.hpp</h3><p>åŒselectï¼Œè§ä¸Šæ–‡ <a href="#jump-select">3.2.1 socket</a> éƒ¨åˆ†ï¼›</p><h3 id="6-2-3-Log-hpp"><a href="#6-2-3-Log-hpp" class="headerlink" title="6.2.3 Log.hpp"></a>6.2.3 Log.hpp</h3><p>ä¸€ä¸ªå·¨ç®€å•çš„æ—¥å¿—ç±»</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdarg&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cerrno&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEBUG 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NOTICE 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WARNING 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FATAL 3</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *log_level[] = &#123;<span class="string">&quot;DEBUG&quot;</span>, <span class="string">&quot;NOTICE&quot;</span>, <span class="string">&quot;WARINING&quot;</span>, <span class="string">&quot;FATAL&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOGFILE <span class="string">&quot;serverTcp.log&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Log</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Log</span>():<span class="built_in">logFd</span>(<span class="number">-1</span>)</span><br><span class="line">    &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">enable</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">umask</span>(<span class="number">0</span>);</span><br><span class="line">        logFd = <span class="built_in">open</span>(LOGFILE, O_WRONLY | O_CREAT | O_APPEND, <span class="number">0666</span>);</span><br><span class="line">        <span class="built_in">assert</span>(logFd != <span class="number">-1</span>);</span><br><span class="line">        <span class="built_in">dup2</span>(logFd, <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">dup2</span>(logFd, <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">Log</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(logFd != <span class="number">-1</span>) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">fsync</span>(logFd);</span><br><span class="line">            <span class="built_in">close</span>(logFd);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> logFd;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// logMessage(DEBUG, &quot;%d&quot;, 10);</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">logMessage</span><span class="params">(<span class="type">int</span> level, <span class="type">const</span> <span class="type">char</span> *format, ...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">assert</span>(level &gt;= DEBUG);</span><br><span class="line">    <span class="built_in">assert</span>(level &lt;= FATAL);</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> *name = <span class="built_in">getenv</span>(<span class="string">&quot;USER&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> logInfo[<span class="number">1024</span>];</span><br><span class="line">    va_list ap;</span><br><span class="line">    <span class="built_in">va_start</span>(ap, format);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vsnprintf</span>(logInfo, <span class="built_in">sizeof</span>(logInfo) - <span class="number">1</span>, format, ap);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">va_end</span>(ap); <span class="comment">// ap = NULL</span></span><br><span class="line"></span><br><span class="line">    FILE *out = (level == FATAL) ? stderr : stdout;</span><br><span class="line">    <span class="built_in">fprintf</span>(out, <span class="string">&quot;%s | %u | %s | %s\n&quot;</span>,</span><br><span class="line">            log_level[level],</span><br><span class="line">            (<span class="type">unsigned</span> <span class="type">int</span>)<span class="built_in">time</span>(<span class="literal">nullptr</span>),</span><br><span class="line">            name == <span class="literal">nullptr</span> ? <span class="string">&quot;unknow&quot;</span> : name,</span><br><span class="line">            logInfo);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">fflush</span>(out); <span class="comment">// å°†Cè¯­è¨€ç¼“å†²åŒºä¸­çš„æ•°æ®åˆ·æ–°åˆ°OS</span></span><br><span class="line">    <span class="built_in">fsync</span>(<span class="built_in">fileno</span>(out));   <span class="comment">// å°†OSä¸­çš„æ•°æ®å°½å¿«å†™å…¥ç¡¬ç›˜</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-2-4-TcpServer"><a href="#6-2-4-TcpServer" class="headerlink" title="6.2.4 TcpServer"></a>6.2.4 TcpServer</h3><p>è¿™æ˜¯æˆ‘ä»¬reactoræ¨¡å‹çš„é‡ç‚¹</p><h4 id="1-Connectionç±»"><a href="#1-Connectionç±»" class="headerlink" title="1.Connectionç±»"></a>1.Connectionç±»</h4><p>è¿™é‡Œå…ˆå®šä¹‰äº†ä¸€ä¸ªConnectioné“¾æ¥ç±»ï¼Œæ¯”è¾ƒé‡è¦çš„æ˜¯ç±»é‡Œé¢æœ‰3ä¸ªå›è°ƒæ–¹æ³•çš„æŒ‡é’ˆã€‚åœ¨Reactorä¸­ï¼Œæˆ‘ä»¬ç”¨å›è°ƒæ–¹æ³•æ¥æ›¿ä»£äº†ä¸»æ‰§è¡Œæµç›´æ¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼ã€‚çº¿ç¨‹åªéœ€è¦æ¥æ”¶åˆ°è¿™ä¸ª<code>Connection</code>å¯¹è±¡ï¼Œå°±å¯ä»¥ç”¨å›è°ƒæ–¹æ³•æ¥å®ç°å¯¹é“¾æ¥çš„æ•°æ®å¤„ç†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">using <span class="type">func_t</span> = <span class="built_in">std</span>::function&lt;<span class="type">int</span>(Connection *)&gt;;</span><br><span class="line">using <span class="type">callback_t</span> = <span class="built_in">std</span>::function&lt;<span class="type">int</span>(Connection *, <span class="built_in">std</span>::<span class="built_in">string</span> &amp;)&gt;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Connection</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">public:</span><br><span class="line">    <span class="comment">// æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">    <span class="type">int</span> sock_;</span><br><span class="line">    TcpServer *R_;<span class="comment">// ä¸»æœåŠ¡å™¨çš„ç±»æŒ‡é’ˆ</span></span><br><span class="line">    <span class="comment">// è‡ªå·±çš„æ¥å—å’Œå‘é€ç¼“å†²åŒº</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> inbuffer_;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> outbuffer_;</span><br><span class="line">    <span class="comment">// è¯»ã€å†™ã€å¼‚å¸¸çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">    <span class="type">func_t</span> recver_; </span><br><span class="line">    <span class="type">func_t</span> sender_;</span><br><span class="line">    <span class="type">func_t</span> excepter_;</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">    Connection(<span class="type">int</span> sock, TcpServer *r) : sock_(sock), R_(r)</span><br><span class="line">    &#123;&#125;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">SetRecver</span><span class="params">(<span class="type">func_t</span> recver)</span> &#123; recver_ = recver; &#125;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">SetSender</span><span class="params">(<span class="type">func_t</span> sender)</span> &#123; sender_ = sender; &#125;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">SetExcepter</span><span class="params">(<span class="type">func_t</span> excepter)</span> &#123; excepter_ = excepter; &#125;</span><br><span class="line">    ~Connection() &#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="2-TcpServeræˆå‘˜å˜é‡"><a href="#2-TcpServeræˆå‘˜å˜é‡" class="headerlink" title="2.TcpServeræˆå‘˜å˜é‡"></a>2.TcpServeræˆå‘˜å˜é‡</h4><p>å†æ¥çœ‹çœ‹tcpserverçš„æˆå‘˜å˜é‡æœ‰ä»€ä¹ˆ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">private:</span><br><span class="line"><span class="comment">// æ¥æ”¶é˜Ÿåˆ—çš„é•¿åº¦</span></span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> revs_num = <span class="number">64</span>;</span><br><span class="line">    <span class="comment">// 1. ç½‘ç»œsocket</span></span><br><span class="line">    <span class="type">int</span> listensock_;</span><br><span class="line">    <span class="comment">// 2. epollçš„fd</span></span><br><span class="line">    <span class="type">int</span> epfd_;</span><br><span class="line">    <span class="comment">// 3. å°†epollå’Œä¸Šå±‚ä»£ç è¿›è¡Œç»“åˆï¼Œå·²æœ‰é“¾æ¥</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">unordered_map</span>&lt;<span class="type">int</span>, Connection *&gt; connections_;</span><br><span class="line">    <span class="comment">// 4. å°±ç»ªäº‹ä»¶åˆ—è¡¨</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">epoll_event</span> *<span class="title">revs_</span>;</span></span><br><span class="line">    <span class="comment">// 5. è®¾ç½®å®Œæ•´æŠ¥æ–‡çš„å¤„ç†å›è°ƒæ–¹æ³•</span></span><br><span class="line">    <span class="type">callback_t</span> cb_;</span><br></pre></td></tr></table></figure><h4 id="3-æ„é€ "><a href="#3-æ„é€ " class="headerlink" title="3.æ„é€ "></a>3.æ„é€ </h4><p>éšåä¾¿æ˜¯åœ¨æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–è¿™äº›æˆå‘˜å˜é‡ï¼Œå…ˆæ˜¯ä»<code>Sock.hpp</code>ä¸­è·å–åˆ°ç›‘å¬æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åå†é€šè¿‡Epollerç±»è·å–åˆ°epfdå¥æŸ„ï¼Œæœ€åæ˜¯å°†listensocketæ”¾å…¥epollçš„ç›‘å¬ä¸­ï¼›</p><p>è¿™é‡Œçš„<code>std::bind</code>çš„ä½œç”¨ï¼Œæ˜¯å°†å½“å‰TcpServerçš„<code>this</code>æŒ‡é’ˆç»‘å®šåˆ°<code>TcpServer::Accepter</code>å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸Šï¼Œå¦åˆ™åœ¨ç±»å¤–æ²¡æœ‰åŠæ³•é€šè¿‡<code>Connection</code>ç±»çš„å›è°ƒæŒ‡é’ˆæ¥è°ƒç”¨è¿™ä¸ªç±»çš„æˆå‘˜å‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">TcpServer(<span class="type">callback_t</span> cb, <span class="type">int</span> port = <span class="number">8080</span>) : cb_(cb)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// å½“å‰ç›‘å¬çš„æ–‡ä»¶æè¿°ç¬¦åŠå…¶äº‹ä»¶</span></span><br><span class="line">    revs_ = new <span class="keyword">struct</span> epoll_event[revs_num]; </span><br><span class="line">    <span class="comment">// ç½‘ç»œåŠŸèƒ½</span></span><br><span class="line">    listensock_ = Sock::SocketInit();</span><br><span class="line">    Util::SetNonBlock(listensock_);</span><br><span class="line">    Sock::Bind(listensock_, port);</span><br><span class="line">    Sock::Listen(listensock_);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤šè·¯è½¬æ¥</span></span><br><span class="line">    epfd_ = Epoller::CreateEpoller();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ·»åŠ listensockåŒ¹é…çš„connection</span></span><br><span class="line">    AddConnection(listensock_, EPOLLIN | EPOLLET,</span><br><span class="line">                  <span class="built_in">std</span>::bind(&amp;TcpServer::Accepter, this, <span class="built_in">std</span>::placeholders::_1), nullptr, nullptr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-æ·»åŠ é“¾æ¥"><a href="#4-æ·»åŠ é“¾æ¥" class="headerlink" title="4.æ·»åŠ é“¾æ¥"></a>4.æ·»åŠ é“¾æ¥</h4><p>åœ¨<code>AddConnection</code>å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä¼šå°†socketç»™æ·»åŠ åˆ°epfdä¸­ï¼›å¦‚æœè¿™ä¸ªepfdæ˜¯ä½¿ç”¨äº†<code>EPOLLET</code>çš„ETæ¨¡å¼ï¼Œåˆ™è¿˜éœ€è¦è®¾ç½®éé˜»å¡ï¼›</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">AddConnection</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">uint32_t</span> event, <span class="type">func_t</span> recver, <span class="type">func_t</span> sender, <span class="type">func_t</span> excepter)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (event &amp; EPOLLET)</span><br><span class="line">        Util::<span class="built_in">SetNonBlock</span>(sockfd);</span><br><span class="line">    <span class="comment">// æ·»åŠ sockfdåˆ°epoll</span></span><br><span class="line">    Epoller::<span class="built_in">AddEvent</span>(epfd_, sockfd, event);</span><br><span class="line">    <span class="comment">// å°†sockfdåŒ¹é…çš„Connectionä¹Ÿæ·»åŠ åˆ°å½“å‰çš„unordered_mapä¸­</span></span><br><span class="line">    Connection *conn = <span class="keyword">new</span> <span class="built_in">Connection</span>(sockfd, <span class="keyword">this</span>);</span><br><span class="line">    conn-&gt;<span class="built_in">SetRecver</span>(recver);</span><br><span class="line">    conn-&gt;<span class="built_in">SetSender</span>(sender);</span><br><span class="line">    conn-&gt;<span class="built_in">SetExcepter</span>(excepter);</span><br><span class="line"></span><br><span class="line">    connections_.<span class="built_in">insert</span>(std::<span class="built_in">make_pair</span>(sockfd, conn));</span><br><span class="line">    <span class="built_in">logMessage</span>(DEBUG, <span class="string">&quot;æ·»åŠ æ–°é“¾æ¥åˆ°connectionsæˆåŠŸ: %d&quot;</span>, sockfd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¾ç½®éé˜»å¡çš„ä»£ç å¾ˆç®€å•ï¼Œåœ¨å‰æ–‡å·²ç»æ¼”ç¤ºè¿‡äº†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Util</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">public:</span><br><span class="line">    <span class="type">static</span> <span class="type">void</span> <span class="title function_">SetNonBlock</span><span class="params">(<span class="type">int</span> fd)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> fl = fcntl(fd, F_GETFL);</span><br><span class="line">        fcntl(fd, F_SETFL, fl | O_NONBLOCK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="5-ææ„"><a href="#5-ææ„" class="headerlink" title="5.ææ„"></a>5.ææ„</h4><p>åœ¨ææ„å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†listensocketå’Œepfdä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦å…³é—­ï¼Œå¹¶ææ„æ‰é“¾æ¥æ•°ç»„</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">~<span class="built_in">TcpServer</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (listensock_ != <span class="number">-1</span>)</span><br><span class="line">        <span class="built_in">close</span>(listensock_);</span><br><span class="line">    <span class="keyword">if</span> (epfd_ != <span class="number">-1</span>)</span><br><span class="line">        <span class="built_in">close</span>(epfd_);</span><br><span class="line">    <span class="keyword">delete</span>[] revs_;</span><br><span class="line">    <span class="comment">// è¿˜éœ€è¦ææ„æ‰è¿æ¥æ± ä¸­å°šå­˜åœ¨çš„connectionå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span>&amp;c:connections_)&#123;</span><br><span class="line">        <span class="keyword">delete</span> c.second;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6-è·å–æ–°è¿æ¥Accept"><a href="#6-è·å–æ–°è¿æ¥Accept" class="headerlink" title="6.è·å–æ–°è¿æ¥Accept"></a>6.è·å–æ–°è¿æ¥Accept</h4><p>åœ¨è·å–æ–°è¿æ¥è¿™é‡Œï¼Œæˆ‘ä»¬é‡‡ç”¨äº†ä¸€ä¸ªæ­»å¾ªç¯æ¥è·å–ã€‚è¿™æ˜¯å› ä¸ºå¯¹äºlistensocketæ–‡ä»¶æè¿°ç¬¦è€Œè¨€ï¼Œåªè¦æ¥äº†ä¸€ä¸ªæ–°é“¾æ¥ï¼Œåœ¨ETæ¨¡å¼ä¸‹å°±ä¼šæç¤ºæˆ‘ä»¬ã€‚ä½†æœ‰å¯èƒ½ä¼šå‡ºç°æˆ‘ä»¬è¿˜æ²¡æœ‰æ¥å¾—åŠå–èµ°è¿™ä¸ªé“¾æ¥ï¼Œå°±åˆæ¥äº†ä¸€ä¸ªæ–°é“¾æ¥çš„æƒ…å†µï¼ˆå¯ä»¥ç®€åŒ–ç†è§£ä¸ºä¸€æ¬¡æ€§æ¥äº†ä¸¤ä¸ªé“¾æ¥ï¼‰</p><p>è¿™æ—¶å€™å› ä¸ºETçš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸€æ¬¡æ€§å–èµ°æ‰€æœ‰é“¾æ¥ï¼›ä¸ºäº†é¿å…åœ¨Acceptçš„æ—¶å€™ï¼Œå› ä¸ºé“¾æ¥å·²ç»éƒ½è¢«å–èµ°äº†è€Œé˜»å¡ä½ï¼Œæˆ‘ä»¬éœ€è¦å°†listensocketè®¾ç½®ä¸º<strong>éé˜»å¡</strong>ï¼›</p><blockquote><p>å…³äºæ–°é“¾æ¥ä¸ºä»€ä¹ˆåªå…³æ³¨è¯»äº‹ä»¶ï¼Œåœ¨æ³¨é‡Šä¸­æœ‰è¯´æ˜ï¼›</p></blockquote><p>å¯¹äºlistensocketæ¥è¯´ï¼Œè¿™ä¸ªAccepterå‡½æ•°å°±æ˜¯å®ƒçš„è¯»äº‹ä»¶å›è°ƒï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°çš„å‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ª<code>Connection *conn</code>å¯¹è±¡ï¼Œå…¶æ˜¯ä¸ºäº†ä¸å…¶ä»–äº‹ä»¶å¤„ç†å‡½æ•°ç»Ÿä¸€ï¼ˆå› ä¸ºè¿™ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ä¸åœ¨<code>Connection</code>ç±»ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»è¦è·å–ä¸€ä¸ªå¯¹è±¡æ‰èƒ½è®¿é—®åˆ°å®ƒçš„æˆå‘˜å˜é‡ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">Accepter</span><span class="params">(Connection *conn)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        std::string clientip;</span><br><span class="line">        <span class="type">uint16_t</span> clientport = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> sockfd = Sock::<span class="built_in">Accept</span>(conn-&gt;sock_, &amp;clientip, &amp;clientport);</span><br><span class="line">        <span class="keyword">if</span> (sockfd &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// æ¥æ”¶å‡½æ•°è¢«äº‹ä»¶æ‰“æ–­äº†</span></span><br><span class="line">            <span class="keyword">if</span> (errno == EINTR)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="comment">// æœ¬æ¬¡æ•°æ®æ²¡æœ‰å‡†å¤‡å¥½ï¼Œå¯ä»¥ç†è§£ä¸ºæ¥æ”¶ç¼“å†²åŒºç©ºäº†</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (errno == EAGAIN || errno == EWOULDBLOCK)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">logMessage</span>(WARNING, <span class="string">&quot;accept error&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">logMessage</span>(DEBUG, <span class="string">&quot;get a new link: %d&quot;</span>, sockfd);</span><br><span class="line">        <span class="comment">// æ³¨æ„ï¼šé»˜è®¤æˆ‘ä»¬åªè®¾ç½®äº†è®©epollå¸®æˆ‘ä»¬å…³å¿ƒè¯»äº‹ä»¶ï¼Œæ²¡æœ‰å…³å¿ƒå†™äº‹ä»¶</span></span><br><span class="line">        <span class="comment">// ä¸ºä»€ä¹ˆæ²¡æœ‰å…³æ³¨å†™äº‹ä»¶ï¼šå› ä¸ºæœ€å¼€å§‹çš„æ—¶å€™ï¼Œå†™ç©ºé—´ä¸€å®šæ˜¯å°±ç»ªçš„ï¼</span></span><br><span class="line">        <span class="comment">// è¿è¡Œä¸­å¯èƒ½æ‰ä¼šå­˜åœ¨å†™æ¡ä»¶ä¸æ»¡è¶³ -- å†™ç©ºé—´è¢«å†™æ»¡äº†</span></span><br><span class="line">        <span class="built_in">AddConnection</span>(sockfd, EPOLLIN | EPOLLET,</span><br><span class="line">                      std::<span class="built_in">bind</span>(&amp;TcpServer::TcpRecver, <span class="keyword">this</span>, std::placeholders::_1),</span><br><span class="line">                      std::<span class="built_in">bind</span>(&amp;TcpServer::TcpSender, <span class="keyword">this</span>, std::placeholders::_1),</span><br><span class="line">                      std::<span class="built_in">bind</span>(&amp;TcpServer::TcpExcepter, <span class="keyword">this</span>, std::placeholders::_1));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EAGAIN or EWOULDBLOCK</span><br><span class="line">The socket is marked nonblocking and the receive operation would block, or a receive timeout had been set and the timeout expired before data was received.  POSIX.1 allows either error to be returned for this case, and does not require these constants to have the same value, so  a  portable application should check for both possibilities.</span><br></pre></td></tr></table></figure><h4 id="7-é“¾æ¥çš„äº‹ä»¶å¤„ç†å‡½æ•°"><a href="#7-é“¾æ¥çš„äº‹ä»¶å¤„ç†å‡½æ•°" class="headerlink" title="7.é“¾æ¥çš„äº‹ä»¶å¤„ç†å‡½æ•°"></a>7.é“¾æ¥çš„äº‹ä»¶å¤„ç†å‡½æ•°</h4><p>å…¶ä»–é“¾æ¥çš„ä¸‰ä¸ªå¤„ç†å‡½æ•°åˆ†åˆ«æ˜¯<code>TcpRever/TcpSender/TcpExcepter</code>;</p><p>é¦–å…ˆï¼Œåœ¨å¤„ç†æŸä¸€ä¸ªé“¾æ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¿…é¡»è¦ä¿è¯è¿™ä¸ªé“¾æ¥åœ¨å·²æœ‰çš„mapé‡Œé¢ï¼Œå¦åˆ™ä»£è¡¨è¿™ä¸ªé“¾æ¥å·²ç»è¢«å…³é—­æˆ–è€…å¼‚å¸¸é€€å‡ºäº†ï¼›åŒç†ï¼Œåœ¨å¼‚å¸¸å’Œå…³é—­é“¾æ¥çš„å¤„ç†æµç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å°†é“¾æ¥ä»mapä¸­åˆ é™¤</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">IsExists</span><span class="params">(<span class="type">int</span> sock)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> iter = connections_.<span class="built_in">find</span>(sock);</span><br><span class="line">    <span class="keyword">if</span> (iter == connections_.<span class="built_in">end</span>())</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="è¯»"><a href="#è¯»" class="headerlink" title="è¯»"></a>è¯»</h5><p>å¯¹äºè¯»äº‹ä»¶è€Œè¨€æˆ‘ä»¬ä¹Ÿæ˜¯è¿›è¡Œå¾ªç¯è¯»å–ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦ä¹Ÿéœ€è¦è¢«è®¾ç½®ä¸ºéé˜»å¡ã€‚è¯»å–çš„å†…å®¹æ‹¼æ¥åˆ°è¯¥Connectionå¯¹è±¡çš„è¾“å…¥ç¼“å†²åŒºstringä¸­ï¼›</p><p>åœ¨è¯»å–å®Œæ¯•åï¼Œæˆ‘ä»¬éœ€è¦åœ¨åè®®é‡Œé¢å®šä¹‰ä¸€ä¸ªæ ¹æ®<strong>åº”ç”¨å±‚åè®®å­—æ®µ</strong>æ¥åˆ†ç¦»æŠ¥æ–‡çš„å‡½æ•°ï¼ˆé¿å…tcpçš„ç²˜åŒ…é—®é¢˜ï¼‰ï¼Œæœ€ç»ˆä¼šå¾—åˆ°ä¸€ä¸ªstringçš„æ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„æˆå‘˜éƒ½æ˜¯ä¸€ä¸ªå®Œæ•´çš„æŠ¥æ–‡ï¼›</p><p>æœ€åï¼Œæˆ‘ä»¬ç›´æ¥ä¸€ä¸ªforå¾ªç¯ï¼Œé€šè¿‡è¯¥tcpserverå¯¹è±¡åœ¨åˆå§‹åŒ–æ—¶å€™è®¾ç½®çš„<code>cb_</code>å‡½æ•°å›è°ƒæŒ‡é’ˆï¼Œæ¥å¤„ç†æ¯ä¸€ä¸ªæŠ¥æ–‡ï¼ˆä¸ºæ¯ä¸€ä¸ªæŠ¥æ–‡æä¾›æœåŠ¡ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">TcpRecver</span><span class="params">(Connection *conn)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">char</span> buffer[<span class="number">1024</span>];</span><br><span class="line">        <span class="type">ssize_t</span> s = <span class="built_in">recv</span>(conn-&gt;sock_, buffer, <span class="built_in">sizeof</span>(buffer) - <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (s &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            buffer[s] = <span class="number">0</span>;</span><br><span class="line">            conn-&gt;inbuffer_ += buffer;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">logMessage</span>(DEBUG, <span class="string">&quot;client quit&quot;</span>);</span><br><span class="line">            conn-&gt;<span class="built_in">excepter_</span>(conn);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (errno == EINTR) <span class="comment">// æ¥æ”¶äº‹ä»¶è¢«æ‰“æ–­</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="comment">// æ¥æ”¶ç¼“å†²åŒºç©ºäº†</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (errno == EAGAIN || errno == EWOULDBLOCK)</span><br><span class="line">                <span class="keyword">break</span>; <span class="comment">// è·³å‡ºå¾ªç¯</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// å‡ºé”™äº†</span></span><br><span class="line">                <span class="built_in">logMessage</span>(DEBUG, <span class="string">&quot;recv error: %d:%s&quot;</span>, errno, <span class="built_in">strerror</span>(errno));</span><br><span class="line">                conn-&gt;<span class="built_in">excepter_</span>(conn);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†æœ¬è½®å…¨éƒ¨è¯»å–å®Œæ¯•</span></span><br><span class="line">    std::vector&lt;std::string&gt; result;</span><br><span class="line">    <span class="built_in">PackageSplit</span>(conn-&gt;inbuffer_, &amp;result);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;message : result)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cb_</span>(conn, message);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ¡†æ¶çš„å¥½å¤„å°±åœ¨äºï¼Œä½ å¯ä»¥å•ç‹¬å®ç°ä¸åŒåè®®çš„æŠ¥æ–‡åˆ†ç¦»å‡½æ•°å’Œæ•°æ®æœåŠ¡å‡½æ•°ï¼Œè€Œä¸éœ€è¦é‡å†™TcpServerçš„å®ç°ï¼Œç›¸å½“äºè§£è€¦ï¼›</p><h5 id="å†™"><a href="#å†™" class="headerlink" title="å†™"></a>å†™</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">TcpSender</span><span class="params">(Connection *conn)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">ssize_t</span> n = <span class="built_in">send</span>(conn-&gt;sock_, conn-&gt;outbuffer_.<span class="built_in">c_str</span>(), conn-&gt;outbuffer_.<span class="built_in">size</span>(), <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span>(n &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// å»é™¤å·²ç»æˆåŠŸå‘é€çš„æ•°æ®</span></span><br><span class="line">            conn-&gt;outbuffer_.<span class="built_in">erase</span>(<span class="number">0</span>, n);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// å†™å…¥æ“ä½œè¢«æ‰“æ–­</span></span><br><span class="line">            <span class="keyword">if</span>(errno == EINTR) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="comment">// å†™å…¥ç¼“å†²åŒºæ»¡äº†ï¼Œæ²¡åŠæ³•ç»§ç»­å†™</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(errno == EAGAIN || errno == EWOULDBLOCK) <span class="keyword">break</span>; </span><br><span class="line">            <span class="keyword">else</span> <span class="comment">// å¼‚å¸¸</span></span><br><span class="line">            &#123;</span><br><span class="line">                conn-&gt;<span class="built_in">excepter_</span>(conn);</span><br><span class="line">                <span class="built_in">logMessage</span>(DEBUG, <span class="string">&quot;send error: %d:%s&quot;</span>, errno, <span class="built_in">strerror</span>(errno));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œè¿™é‡Œçš„å†™å…¥å¦‚æœé‡åˆ°<code>(errno == EAGAIN || errno == EWOULDBLOCK)</code> è¿™ä¸¤ç§æƒ…å†µï¼Œå¹¶ä¸èƒ½ç¡®ä¿è¾“å‡ºç¼“å†²åŒºä¸­çš„æ•°æ®å·²ç»è¢«å…¨éƒ¨å†™å…¥äº†ï¼›æœ‰å¯èƒ½æ˜¯å†™å…¥ç¼“å†²åŒºæ»¡äº†å¯¼è‡´æ— æ³•ç»§ç»­å†™å…¥ï¼›</p><p>è¿™ç§iæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­<code>outbuffer</code>æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œåˆ™è¿˜æ˜¯éœ€è¦è®¾ç½®<code>EPOLLOUT</code>æ ‡è®°ä½ï¼Œå‘ŠçŸ¥epollç»§ç»­å¸®æˆ‘ä»¬å…³æ³¨å†™äº‹ä»¶ï¼ˆè¿™æ ·epollå°±ä¼šå‘ä¿¡æ¯å‘ŠçŸ¥Reactorï¼ŒReactorä¼šé‡æ–°è°ƒç”¨å†™å…¥å‡½æ•°ï¼Œç»§ç»­å†™å…¥ç¼“å†²åŒºçš„å‰©ä¸‹æ•°æ®ï¼‰è¿™ä¸ªæ“ä½œä¼šåœ¨ä¸»æ‰§è¡Œæµä¸­è¿›è¡Œç»Ÿä¸€åˆ¤æ–­</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸»æ‰§è¡Œæµ</span></span><br><span class="line">conn-&gt;<span class="built_in">sender_</span>(conn); <span class="comment">// ä¸»æ‰§è¡Œæµè°ƒç”¨å‘é€å‡½æ•°</span></span><br><span class="line"><span class="comment">// åˆ¤æ–­æœ¬æ¬¡æ˜¯å¦å‘å®Œæ¯•äº†ï¼Œæ²¡æœ‰å‘å®Œæ¯•è¿˜éœ€è¦ç»§ç»­å…³å¿ƒè¯»å†™</span></span><br><span class="line"><span class="keyword">if</span>(conn-&gt;outbuffer_.<span class="built_in">empty</span>()) conn-&gt;R_-&gt;<span class="built_in">EnableReadWrite</span>(conn-&gt;sock_, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line"><span class="keyword">else</span> conn-&gt;R_-&gt;<span class="built_in">EnableReadWrite</span>(conn-&gt;sock_, <span class="literal">true</span>, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰“å¼€æˆ–è€…å…³é—­å¯¹äºç‰¹å®šsocketæ˜¯å¦è¦å…³å¿ƒè¯»æˆ–è€…å†™</span></span><br><span class="line"><span class="comment">//- EnableReadWrite(sock, true, false); //åªå…³å¿ƒè¯»</span></span><br><span class="line"><span class="comment">//- EnableReadWrite(sock, true, true);  //åŒæ—¶å…³å¿ƒè¯»å†™</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">EnableReadWrite</span><span class="params">(<span class="type">int</span> sock, <span class="type">bool</span> readable, <span class="type">bool</span> writeable)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> event = <span class="number">0</span>;</span><br><span class="line">    event |= (readable ? EPOLLIN : <span class="number">0</span>);</span><br><span class="line">    event |= (writeable ? EPOLLOUT : <span class="number">0</span>);</span><br><span class="line">    Epoller::<span class="built_in">ModEvent</span>(epfd_, sock, event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å¼‚å¸¸"><a href="#å¼‚å¸¸" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h5><p>ä¸ºäº†ç»Ÿä¸€è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼Œåœ¨ä¸Šæ–‡ä¸­å½“æˆ‘ä»¬é‡åˆ°è¯»å†™å‡ºé”™çš„æ—¶å€™ï¼Œéƒ½ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼›</p><p>åœ¨è¿™ä¸ªå‡½æ•°ä½“å†…ï¼Œä¼šå°†é“¾æ¥ä»epollä¸­åˆ é™¤ã€å…³é—­é“¾æ¥ã€é‡Šæ”¾connectionå¯¹è±¡ã€å°†æ–‡ä»¶æè¿°ç¬¦ä»mapé‡Œé¢å‰”é™¤ï¼›</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€å®šè¦å…ˆå°†socketä»epollé‡Œé¢å‰”é™¤æ‰ï¼Œå†å…³é—­socketï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">TcpExcepter</span><span class="params">(Connection *conn)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 0. åˆ¤æ–­æœ‰æ•ˆæ€§</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">IsExists</span>(conn-&gt;sock_)) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰€æœ‰çš„æœåŠ¡å™¨å¼‚å¸¸ï¼Œéƒ½ä¼šè¢«å½’ç±»åˆ°è¿™é‡Œ</span></span><br><span class="line">    <span class="comment">// 1. åˆ é™¤epollçš„ç›‘çœ‹</span></span><br><span class="line">    Epoller::<span class="built_in">DelEvent</span>(epfd_, conn-&gt;sock_);</span><br><span class="line">    <span class="built_in">logMessage</span>(DEBUG, <span class="string">&quot;remove epoll event!&quot;</span>);</span><br><span class="line">    <span class="comment">// 2. close</span></span><br><span class="line">    <span class="built_in">close</span>(conn-&gt;sock_);</span><br><span class="line">    <span class="built_in">logMessage</span>(DEBUG, <span class="string">&quot;close fd: %d&quot;</span>, conn-&gt;sock_);</span><br><span class="line">    <span class="comment">// 3. delete conn;</span></span><br><span class="line">    <span class="keyword">delete</span> connections_[conn-&gt;sock_];</span><br><span class="line">    <span class="built_in">logMessage</span>(DEBUG, <span class="string">&quot;delete connection object done&quot;</span>);</span><br><span class="line">    <span class="comment">// 4. erase conn;</span></span><br><span class="line">    connections_.<span class="built_in">erase</span>(conn-&gt;sock_);</span><br><span class="line">    <span class="built_in">logMessage</span>(DEBUG, <span class="string">&quot;erase connection from connections&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="8-è¿è¡Œ"><a href="#8-è¿è¡Œ" class="headerlink" title="8.è¿è¡Œ"></a>8.è¿è¡Œ</h4><p>å¯¹äºTcpServerè€Œè¨€ï¼Œä¸€æ¬¡çš„è¿è¡Œå°±æ˜¯è°ƒç”¨ä¸€æ¬¡<code>epoll_wait</code>ï¼Œå†æ ¹æ®äº‹ä»¶å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè°ƒç”¨ä¸åŒçš„äº‹ä»¶å¤„ç†å‡½æ•°</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dispatcher</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n = Epoller::<span class="built_in">LoopOnce</span>(epfd_, revs_, revs_num);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> sock = revs_[i].data.fd;</span><br><span class="line">        <span class="type">uint32_t</span> revent = revs_[i].events;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦å‡ºç°é”™è¯¯ï¼Œå¦‚æœå‡ºç°äº†é”™è¯¯ï¼Œé‚£å°±æŠŠEPOLLINå’ŒOUTéƒ½åŠ ä¸Š</span></span><br><span class="line">        <span class="comment">// è¿™æ ·è¿™ä¸ªé“¾æ¥ä¼šè¿›å…¥ä¸‹é¢çš„å¤„ç†å‡½æ•°ï¼Œå¹¶åœ¨å¤„ç†å‡½æ•°ä¸­å‡ºç°å¼‚å¸¸</span></span><br><span class="line">        <span class="comment">// å¤„ç†å‡½æ•°ä¸­å‡ºç°å¼‚å¸¸å›ç»Ÿä¸€è°ƒç”¨TcpExcpterå‡½æ•°</span></span><br><span class="line">        <span class="keyword">if</span>(revent &amp; EPOLLHUP) revent |= (EPOLLIN|EPOLLOUT);</span><br><span class="line">        <span class="keyword">if</span>(revent &amp; EPOLLERR) revent |= (EPOLLIN|EPOLLOUT);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (revent &amp; EPOLLIN)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">IsExists</span>(sock) &amp;&amp; connections_[sock]-&gt;recver_)</span><br><span class="line">                connections_[sock]-&gt;<span class="built_in">recver_</span>(connections_[sock]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å½“é“¾æ¥çš„å†™äº‹ä»¶è¢«æ¿€æ´»çš„æ—¶å€™ï¼Œåœ¨è¿™é‡Œå°±ä¼šè§¦å‘å†™äº‹ä»¶çš„å¤„ç†</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥å¹¶ä¸éœ€è¦åœ¨recvé‡Œé¢ä¸»åŠ¨è°ƒç”¨å†™äº‹ä»¶å¤„ç†å‡½æ•°</span></span><br><span class="line">        <span class="comment">// åªéœ€è¦å‘Šè¯‰epollè®©å®ƒå¸®æˆ‘ä»¬ç›‘æ§å†™äº‹ä»¶ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨è¿™é‡Œè§¦å‘å†™æ“ä½œ</span></span><br><span class="line">        <span class="keyword">if</span> (revent &amp; EPOLLOUT)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">IsExists</span>(sock) &amp;&amp; connections_[sock]-&gt;sender_)</span><br><span class="line">                connections_[sock]-&gt;<span class="built_in">sender_</span>(connections_[sock]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•´ä¸ªæœåŠ¡å™¨è¿è¡Œèµ·æ¥ï¼Œå°±ä¸€ç›´è°ƒç”¨åˆ†å‘å‡½æ•°å°±OKå•¦~</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">Dispatcher</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-2-5-ä¸»æ‰§è¡Œæµ"><a href="#6-2-5-ä¸»æ‰§è¡Œæµ" class="headerlink" title="6.2.5 ä¸»æ‰§è¡Œæµ"></a>6.2.5 ä¸»æ‰§è¡Œæµ</h3><p>å¯¹äºä¸»æ‰§è¡Œæµè€Œè¨€ï¼Œè¦åšçš„å°±æ˜¯è·å–åˆ°å‘½ä»¤è¡Œå‚æ•°çš„ç«¯å£ï¼Œç„¶ååˆ›å»ºtcpserverå¯¹è±¡å¹¶ç»‘å®šäº‹ä»¶å¤„ç†å‡½æ•°</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TcpServer.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Service.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">usage</span><span class="params">(std::string process)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cerr &lt;&lt; <span class="string">&quot;\nUsage: &quot;</span> &lt;&lt; process &lt;&lt; <span class="string">&quot; port\n&quot;</span></span><br><span class="line">         &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">usage</span>(argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">TcpServer <span class="title">svr</span><span class="params">(HandlerRequest, atoi(argv[<span class="number">1</span>]))</span></span>;</span><br><span class="line">    svr.<span class="built_in">Run</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº‹ä»¶å¤„ç†å‡½æ•°å¯ä»¥åšä»»æ„å°è£…ï¼Œæ¥å®ç°ä½ è‡ªå·±æƒ³è¦çš„åŠŸèƒ½</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">HandlerRequest</span><span class="params">(Connection *conn, std::string &amp;message)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// beginhandleré‡Œé¢æ˜¯å…·ä½“çš„è°ƒç”¨é€»è¾‘ï¼Œcalculatoræ˜¯æœ¬æ¬¡äº‹åŠ¡å¤„ç†å‡½æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">BeginHandler</span>(conn, message, calculator);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ˜¯æˆ‘ä»¬å•ä¸ªå®Œæ•´æŠ¥æ–‡çš„å¤„ç†å‡½æ•°ï¼Œåœ¨tcprecveræ–¹æ³•é‡Œé¢è¢«è°ƒç”¨äº†ï¼›</p><p>æ ¹æ®ä¸Šæ–‡æè¿°çš„è°ƒç”¨æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šï¼Œè¿™é‡Œä¼ å…¥æ¥çš„<code>message</code>è‚¯å®šæ˜¯ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨å±‚æŠ¥æ–‡ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ›å»ºä¸€ä¸ªå±äºæˆ‘ä»¬è‡ªå·±çš„åè®®å’Œåè®®ä¸­çš„æ•°æ®å¤„ç†å‡½æ•°å°±OKäº†ï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">BeginHandler</span><span class="params">(Connection *conn, std::string &amp;message, <span class="type">service_t</span> service)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// messageä¸€å®šæ˜¯ä¸€ä¸ªå®Œæ•´çš„æŠ¥æ–‡ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»å¯¹å®ƒè¿›è¡Œäº†è§£ç </span></span><br><span class="line">    Request req;</span><br><span class="line">    <span class="comment">// ååºåˆ—åŒ–ï¼Œè¿›è¡Œå¤„ç†çš„é—®é¢˜</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">Parser</span>(message, &amp;req))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// å†™å›é”™è¯¯æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="comment">// å¯ä»¥ç›´æ¥å…³é—­è¿æ¥</span></span><br><span class="line">        <span class="comment">// conn-&gt;excepter_(conn);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    Response resp = <span class="built_in">service</span>(req);</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; req.x &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; req.op &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; req.y &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; resp.code &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; resp.result &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line">    std::string sendstr;</span><br><span class="line">    <span class="built_in">Serialize</span>(resp, &amp;sendstr);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†å®Œæ¯•çš„ç»“æœï¼Œå‘é€å›ç»™client</span></span><br><span class="line">    conn-&gt;outbuffer_ += sendstr;</span><br><span class="line">    conn-&gt;<span class="built_in">sender_</span>(conn);</span><br><span class="line">    <span class="keyword">if</span>(conn-&gt;outbuffer_.<span class="built_in">empty</span>()) conn-&gt;R_-&gt;<span class="built_in">EnableReadWrite</span>(conn-&gt;sock_, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">else</span> conn-&gt;R_-&gt;<span class="built_in">EnableReadWrite</span>(conn-&gt;sock_, <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;--- end ---&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-2-6-åè®®å’Œæ•°æ®å¤„ç†"><a href="#6-2-6-åè®®å’Œæ•°æ®å¤„ç†" class="headerlink" title="6.2.6 åè®®å’Œæ•°æ®å¤„ç†"></a>6.2.6 åè®®å’Œæ•°æ®å¤„ç†</h3><p>ä¸‹é¢æä¾›ä¸€ä¸ªæœ€åŸºç¡€çš„è®¡ç®—å™¨åè®®ï¼Œè¿™ä¸ªåè®®çš„å¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨telnetå°±æ¨¡æ‹Ÿå‡ºè¯·æ±‚ï¼Œæ— éœ€å†™ä¸€ä¸ªtcpå®¢æˆ·ç«¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x æ“ä½œç¬¦ y#</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªåè®®ä¸­ï¼Œæ¯ä¸ªæœ‰æ•ˆæ•°æ®ä¸­éƒ½ä¼šå¸¦ä¸Šä¸€ä¸ªç©ºæ ¼ï¼Œå¹¶ä»¥<code>#</code>ä½œä¸ºå•ä¸ªæŠ¥æ–‡çš„ç»“å°¾ï¼›</p><p>å“åº”å’Œè¯·æ±‚çš„ç»“æ„ä½“æ ¼å¼ä¹Ÿéå¸¸ç®€å•ï¼Œå“åº”é‡Œé¢æ˜¯çŠ¶æ€ç å’Œè®¡ç®—ç»“æœï¼›æˆ‘ä»¬åœ¨åè®®ä¸­æ·»åŠ åºåˆ—åŒ–å’Œååºåˆ—åŒ–å‡½æ•°å°±å¯ä»¥å°†å“åº”å’Œè¯·æ±‚ç»“æ„ä½“è½¬æˆå­—ç¬¦ä¸²</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Request</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="type">int</span> y;</span><br><span class="line">    <span class="type">char</span> op;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Response</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> code;</span><br><span class="line">    <span class="type">int</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SEP <span class="string">&#x27;#&#x27;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SEP_LEN sizeof(SEP)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CRLF <span class="string">&quot;\r\n&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CRLF_LEN strlen(CRLF)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPACE <span class="string">&quot; &quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPACE_LEN strlen(SPACE)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ†ç¦»ç‹¬ç«‹æŠ¥æ–‡</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PackageSplit</span><span class="params">(std::string &amp;inbuffer, std::vector&lt;std::string&gt; *result)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        std::<span class="type">size_t</span> pos = inbuffer.<span class="built_in">find</span>(SEP);</span><br><span class="line">        <span class="keyword">if</span> (pos == std::string::npos)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        result-&gt;<span class="built_in">push_back</span>(inbuffer.<span class="built_in">substr</span>(<span class="number">0</span>, pos));</span><br><span class="line">        inbuffer.<span class="built_in">erase</span>(<span class="number">0</span>, pos + SEP_LEN);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Request</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="type">int</span> y;</span><br><span class="line">    <span class="type">char</span> op;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Response</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> code;</span><br><span class="line">    <span class="type">int</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Parser</span><span class="params">(std::string &amp;in, Request *req)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 1 + 1, 2 * 4, 5 * 9, 6 *1</span></span><br><span class="line">    std::<span class="type">size_t</span> spaceOne = in.<span class="built_in">find</span>(SPACE);</span><br><span class="line">    <span class="keyword">if</span> (std::string::npos == spaceOne)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    std::<span class="type">size_t</span> spaceTwo = in.<span class="built_in">rfind</span>(SPACE);</span><br><span class="line">    <span class="keyword">if</span> (std::string::npos == spaceTwo)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    std::string dataOne = in.<span class="built_in">substr</span>(<span class="number">0</span>, spaceOne);</span><br><span class="line">    std::string dataTwo = in.<span class="built_in">substr</span>(spaceTwo + SPACE_LEN);</span><br><span class="line">    std::string oper = in.<span class="built_in">substr</span>(spaceOne + SPACE_LEN, spaceTwo - (spaceOne + SPACE_LEN));</span><br><span class="line">    <span class="keyword">if</span> (oper.<span class="built_in">size</span>() != <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è½¬æˆå†…éƒ¨æˆå‘˜</span></span><br><span class="line">    req-&gt;x = <span class="built_in">atoi</span>(dataOne.<span class="built_in">c_str</span>());</span><br><span class="line">    req-&gt;y = <span class="built_in">atoi</span>(dataTwo.<span class="built_in">c_str</span>());</span><br><span class="line">    req-&gt;op = oper[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Serialize</span><span class="params">(<span class="type">const</span> Response &amp;resp, std::string *out)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::string ec = std::<span class="built_in">to_string</span>(resp.code);</span><br><span class="line">    std::string res = std::<span class="built_in">to_string</span>(resp.result);</span><br><span class="line"></span><br><span class="line">    *out = ec;</span><br><span class="line">    *out += SPACE;</span><br><span class="line">    *out += res;</span><br><span class="line">    *out += CRLF;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>service.hpp</code>é‡Œé¢åˆ™æ˜¯æ•°æ®å¤„ç†çš„è®¡ç®—å‡½æ•°ï¼Œé€šè¿‡æˆ‘ä»¬ä¼ å…¥çš„è¯·æ±‚ï¼Œè®¡ç®—å‡ºç»“æ„å¹¶æ„é€ å“åº”è¿”å›ç»™ç”¨æˆ·</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Protocol.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="type">service_t</span> = std::function&lt;<span class="built_in">Response</span> (<span class="type">const</span> Request &amp;req)&gt;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> Response <span class="title">calculator</span><span class="params">(<span class="type">const</span> Request &amp;req)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Response resp = &#123;<span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">switch</span> (req.op)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">        resp.result = req.x + req.y;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">        resp.result = req.x - req.y;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">        resp.result = req.x * req.y;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">    &#123; <span class="comment">// x_ / y_</span></span><br><span class="line">        <span class="keyword">if</span> (req.y == <span class="number">0</span>)</span><br><span class="line">            resp.code = <span class="number">-1</span>; <span class="comment">// -1. é™¤0</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            resp.result = req.x / req.y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;%&#x27;</span>:</span><br><span class="line">    &#123; <span class="comment">// x_ / y_</span></span><br><span class="line">        <span class="keyword">if</span> (req.y == <span class="number">0</span>)</span><br><span class="line">            resp.code = <span class="number">-2</span>; <span class="comment">// -2. æ¨¡0</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            resp.result = req.x % req.y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        resp.code = <span class="number">-3</span>; <span class="comment">// -3: éæ³•æ“ä½œç¬¦</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> resp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-2-7-æµ‹è¯•"><a href="#6-2-7-æµ‹è¯•" class="headerlink" title="6.2.7 æµ‹è¯•"></a>6.2.7 æµ‹è¯•</h3><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„æœåŠ¡å¯åŠ¨äº†ä¹‹åï¼ŒæˆåŠŸæ¥æ”¶äº†ä¸€ä¸ªé“¾æ¥ï¼Œå¹¶è®¡ç®—å‡ºäº†æˆ‘ä»¬å‘é€çš„ç»“æœ</p><p><img src="https://img.musnow.top/i/2023/08/5e164406ab4e280265a7fcd8fdc3de67.png" alt="image-20230828115411040"></p><p>å¤šä¸ªé“¾æ¥ä¹Ÿä¸åœ¨è¯ä¸‹ï¼</p><p><img src="https://img.musnow.top/i/2023/08/58a989acdf95c2dc2c89a1677f8a4d56.png" alt="image-20230828115525101"></p><h1 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h1><p>å¤šè·¯è½¬æ¥è¿™éƒ¨åˆ†æ˜¯linuxæœåŠ¡å™¨æœ€é‡è¦çš„ä¸€éƒ¨åˆ†çŸ¥è¯†ï¼Œå› ä¸ºå¤§éƒ¨åˆ†æœåŠ¡å™¨éƒ½æŠ›å¼ƒäº†æœ€ä¼ ç»Ÿçš„ä¸€ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªé“¾æ¥è¿™æ ·çš„æ–¹å¼ï¼Œè€Œé‡‡ç”¨äº†å¤šè·¯è½¬æ¥æ¥å®ç°å¯¹å¤§é‡è¿›ç¨‹çš„ç»´æŠ¤ï¼›</p><p>æœ¬æ–‡æ˜¯å­¦ä¹ é˜¶æ®µçš„äº§ç‰©ï¼Œæœ‰é”™è¯¯åœ¨æ‰€éš¾å…ï¼Œè¯·å¤§ä½¬ä»¬æŒ‡æ•™ï¼</p><p><img src="https://img.musnow.top/i/2023/08/56eecd58cac3b6593f83998c9f30eb4b.gif" alt="QQå›¾ç‰‡20220413084241"></p>]]></content>
    
    
    <summary type="html">å¤šè·¯è½¬æ¥å’Œé«˜çº§IO</summary>
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ã€C++ã€‘æ„é€ å‡½æ•°å’Œåˆå§‹åŒ–åˆ—è¡¨çš„æ€§èƒ½å·®è·</title>
    <link href="https://blog.musnow.top/posts/2628258650/"/>
    <id>https://blog.musnow.top/posts/2628258650/</id>
    <published>2023-08-24T13:55:38.000Z</published>
    <updated>2023-08-24T13:55:38.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ„é€ å‡½æ•°å’Œåˆå§‹åŒ–åˆ—è¡¨çš„æ€§èƒ½å·®è·å¯¹æ¯”æµ‹è¯•</p><span id="more"></span><h1 id="1-è¯´æ˜"><a href="#1-è¯´æ˜" class="headerlink" title="1.è¯´æ˜"></a>1.è¯´æ˜</h1><p>åœ¨C++ç±»å’Œå¯¹è±¡ä¸­ï¼Œä½ å¯èƒ½å¬åˆ°è¿‡æ›´åŠ æ¨èç”¨åˆå§‹åŒ–åˆ—è¡¨æ¥åˆå§‹åŒ–ç±»å†…æˆå‘˜ã€‚å¦‚æœç±»å†…æˆå‘˜æ˜¯è‡ªå®šä¹‰ç±»å‹ï¼Œåˆ™åªèƒ½åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­è°ƒç”¨è‡ªå®šä¹‰ç±»å‹çš„æ„é€ å‡½æ•°ã€‚</p><p>ä½†åˆå§‹åŒ–åˆ—è¡¨å’Œåœ¨æ„é€ å‡½æ•°ä½“å†…ç›´æ¥èµ‹å€¼æœ‰æ— æ€§èƒ½å·®è·å‘¢ï¼Ÿä»Šå¤©å°±ç”¨ä¸€ä»½ç›¸å¯¹ç®€å•çš„ä»£ç æ¥æµ‹è¯•ä¸€ä¸‹</p><h1 id="2-æµ‹è¯•"><a href="#2-æµ‹è¯•" class="headerlink" title="2.æµ‹è¯•"></a>2.æµ‹è¯•</h1><h2 id="2-1-ä»£ç è¯´æ˜"><a href="#2-1-ä»£ç è¯´æ˜" class="headerlink" title="2.1 ä»£ç è¯´æ˜"></a>2.1 ä»£ç è¯´æ˜</h2><p>é¦–å…ˆæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹ï¼Œå®ç°å¸¦ç¼ºçœå€¼çš„é»˜è®¤æ„é€ ï¼Œæ‹·è´æ„é€ å’Œèµ‹å€¼é‡è½½è¿™ä¸‰ä¸ªå‡½æ•°ï¼Œå¹¶åœ¨å†…éƒ¨æ–°å¢æ‰“å°æ¥åŒºåˆ†ä¸åŒçš„å‡½æ•°</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">mytest</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">mytest</span>(<span class="type">int</span> a = <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        _a = a;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;mytest() &quot;</span> &lt;&lt; a &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">mytest</span>(<span class="type">const</span> mytest&amp; st) &#123;</span><br><span class="line">        _a = st._a;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;mytest(copy) &quot;</span> &lt;&lt; st._a &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    mytest&amp; <span class="keyword">operator</span>=(<span class="type">const</span> mytest&amp; st)</span><br><span class="line">    &#123;</span><br><span class="line">        _a = st._a;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;mytest operator= &quot;</span> &lt;&lt; st._a &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _a;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å†åœ¨å¦å¤–ä¸€ä¸ªç±»ä¸­ä½¿ç”¨è¿™ä¸ªè‡ªå®šä¹‰ç±»å‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">myclass</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">myclass</span>(<span class="type">const</span> <span class="keyword">struct</span> mytest&amp; st, <span class="type">int</span> b)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;myclass() _b:&quot;</span> &lt;&lt; _b &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">mytest</span> _sa;</span><br><span class="line">    <span class="type">int</span> _b;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æ„é€ å‡½æ•°å°±æœ‰ä¸¤ç§å†™æ³•ï¼Œä¸€ç§æ˜¯åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­åˆå§‹åŒ–è¿™ä¸ªè‡ªå®šä¹‰ç±»å‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">myclass</span>(<span class="type">const</span> <span class="keyword">struct</span> mytest&amp; st, <span class="type">int</span> b)</span><br><span class="line">       :_sa(st),</span><br><span class="line">       _b(b)</span><br><span class="line">   &#123;</span><br><span class="line">       cout &lt;&lt; <span class="string">&quot;myclass() _b:&quot;</span> &lt;&lt; _b &lt;&lt; endl;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>å¦å¤–ä¸€ç§æ˜¯åœ¨æ„é€ å‡½æ•°ä½“å†…é€šè¿‡èµ‹å€¼é‡è½½æ¥åˆå§‹åŒ–è¿™ä¸ªè‡ªå®šä¹‰ç±»å‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">myclass</span>(<span class="type">const</span> <span class="keyword">struct</span> mytest&amp; st, <span class="type">int</span> b)</span><br><span class="line">&#123;</span><br><span class="line">     _sa = st;</span><br><span class="line">     _b = b;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;myclass() _b:&quot;</span> &lt;&lt; _b &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„è‡ªå®šä¹‰ç±»å‹ä¼ å‚é‡‡ç”¨äº†å¼•ç”¨ä¼ å‚ï¼Œå¹¶ä¸ä¼šå› æ­¤äº§ç”Ÿé¢å¤–çš„æ‹·è´ï¼</p><p>ä¸»å‡½æ•°ä½“å¦‚ä¸‹ï¼Œä¸ºäº†åŒºåˆ†ç¬¬ä¸€ä¸ª<code>mytest</code>çš„æ„é€ å‡½æ•°ï¼Œæˆ‘åœ¨å…¶åæ–°å¢äº†ä¸€è¡Œè¾“å‡ºä½œä¸ºåˆ†å‰²</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">mytest <span class="title">test_a</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;------&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="function">myclass <span class="title">test</span><span class="params">(test_a, <span class="number">3</span>)</span></span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-2-æµ‹è¯•"><a href="#2-2-æµ‹è¯•" class="headerlink" title="2.2 æµ‹è¯•"></a>2.2 æµ‹è¯•</h2><p>å…ˆæ¥çœ‹çœ‹ä½¿ç”¨èµ‹å€¼åˆå§‹åŒ–çš„æ–¹å¼ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶æˆ‘ä»¬åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­ä»€ä¹ˆéƒ½æ²¡æœ‰å†™ï¼Œä½†æ˜¯è¿™é‡Œ<strong>ä¾æ—§è°ƒç”¨äº†é»˜è®¤çš„æ„é€ å‡½æ•°</strong>ï¼ˆå› ä¸ºé»˜è®¤æ„é€ å‡½æ•°çš„ç¼ºçœå€¼ç»™çš„æ˜¯<code>-1</code>ï¼Œè¿™é‡Œèƒ½é€šè¿‡å‚æ•°åˆ¤æ–­å‡ºæ¥è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æ˜¾å¼è°ƒç”¨çš„æ„é€ ï¼‰</p><p>è°ƒç”¨äº†é»˜è®¤æ„é€ åï¼Œåˆé€šè¿‡èµ‹å€¼é‡è½½æ¥åˆå§‹åŒ–äº†ä¸€é<code>_sa</code>ï¼Œç›¸å½“äºä¸¤æ¬¡åˆå§‹åŒ–</p><p><img src="https://img.musnow.top/i/2023/08/ce34a7ef5363f3de7ee7ee1034f75e04.png" alt="image-20230824212849577"></p><p>ä½†å¦‚æœè°ƒç”¨åˆå§‹åŒ–åˆ—è¡¨ï¼Œåˆ™åªä¼šæœ‰ä¸€æ¬¡æ‹·è´æ„é€ ï¼Œ<strong>é¿å…äº†é¢å¤–çš„é»˜è®¤æ„é€ è°ƒç”¨</strong>ï¼</p><p><img src="https://img.musnow.top/i/2023/08/b9f31dd47442b86d7580fa6e779c1ef3.png" alt="image-20230824213021929"></p><p>åœ¨linuxä¸‹ä¹Ÿæµ‹è¯•è¿‡äº†ï¼Œç»“æœå’ŒVS2019ç›¸åŒ</p><h1 id="3-ç»“è®º"><a href="#3-ç»“è®º" class="headerlink" title="3.ç»“è®º"></a>3.ç»“è®º</h1><p>ç»“è®ºå°±å‡ºæ¥äº†ï¼šåˆå§‹åŒ–åˆ—è¡¨èƒ½èŠ‚çœä¸€æ¬¡é»˜è®¤æ„é€ çš„è°ƒç”¨ï¼Œä¼˜åŒ–æ€§èƒ½ï¼</p><h2 id="3-1-å®é™…åœºæ™¯"><a href="#3-1-å®é™…åœºæ™¯" class="headerlink" title="3.1 å®é™…åœºæ™¯"></a>3.1 å®é™…åœºæ™¯</h2><p>åœ¨ä¸Šé¢çš„åœºæ™¯ä¸­ï¼Œæ€§èƒ½å·®è·å¯èƒ½å¹¶ä¸ä¼šç‰¹åˆ«å¤§ï¼Œä½†æ˜¯åœ¨ä¸‹é¢çš„åœºæ™¯ä¸­å¯èƒ½å°±ä¸ä¸€æ ·äº†</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">mytest</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">mytest</span>(<span class="type">int</span> sz = <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        _str = <span class="keyword">new</span> <span class="type">char</span>[sz];</span><br><span class="line">        _sz = sz;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;mytest() &quot;</span> &lt;&lt; sz &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">mytest</span>(<span class="type">const</span> mytest&amp; st) &#123;</span><br><span class="line">        <span class="keyword">delete</span> _str;<span class="comment">// éœ€è¦å…ˆé”€æ¯åŸè§†çš„æ•°æ®</span></span><br><span class="line">        _str = <span class="keyword">new</span> <span class="type">char</span>[st._sz]; <span class="comment">// å†åˆ›å»ºä¸€ä¸ªæ–°çš„</span></span><br><span class="line">        _sz = st._sz;</span><br><span class="line">        <span class="comment">//çœç•¥æ‹·è´æ•°æ®çš„ä»£ç </span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;mytest(copy) &quot;</span> &lt;&lt; st._sz &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    mytest&amp; <span class="keyword">operator</span>=(<span class="type">const</span> mytest&amp; st)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> _str;<span class="comment">// éœ€è¦å…ˆé”€æ¯åŸè§†çš„æ•°æ®</span></span><br><span class="line">        _str = <span class="keyword">new</span> <span class="type">char</span>[st._sz]; <span class="comment">// å†åˆ›å»ºä¸€ä¸ªæ–°çš„</span></span><br><span class="line">        <span class="comment">//çœç•¥æ‹·è´æ•°æ®çš„ä»£ç </span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;mytest&amp; operator= &quot;</span> &lt;&lt; st._sz &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">char</span>* _str;</span><br><span class="line">    <span class="type">size_t</span> _sz;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">myclass</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">myclass</span>(<span class="type">const</span> <span class="keyword">struct</span> mytest&amp; st, <span class="type">int</span> b)</span><br><span class="line">        :_sa(st),</span><br><span class="line">        _b(b)</span><br><span class="line">    &#123;</span><br><span class="line">         <span class="comment">//_sa = st;</span></span><br><span class="line">         <span class="comment">//_b = b;</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;myclass() _b:&quot;</span> &lt;&lt; _b &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">mytest</span> _sa;</span><br><span class="line">    <span class="type">int</span> _b;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œå› ä¸º<code>mytest</code>è‡ªå®šä¹‰ç±»å‹çš„æ‹·è´æ„é€ æ¶‰åŠåˆ°äº†æ·±æ‹·è´ï¼Œæ­¤æ—¶å°±éœ€è¦å°†å·²æœ‰çš„ç©ºé—´ç»™é”€æ¯äº†ï¼Œå†newä¸€ç‰‡æ–°çš„ç©ºé—´å‡ºæ¥ï¼Œå†å°†æ•°æ®ç»™æ‹·è´è¿‡å»ã€‚</p><p>ç™½ç™½å¤šäº†ä¸€å±‚é»˜è®¤æ„é€ ä¸­çš„newç©ºé—´çš„+æ‹·è´æ„é€ ä¸­deleteåŸæœ‰ç©ºé—´çš„æ¶ˆè€—ï¼</p><p>å¦‚æœç±»ä¸­éœ€è¦æ·±æ‹·è´çš„æˆå‘˜ä¸æ­¢ä¸€ä¸ªï¼Œé‚£æ€§èƒ½å·®è·å°±æ›´å¤§ï¼</p><p>æ‰€ä»¥åœ¨C++ä¸­ï¼Œ<strong>ä¸€å¾‹ä»¥åˆå§‹åŒ–åˆ—è¡¨ä¼˜å…ˆ</strong>ï¼</p><hr><p>è¿™é‡Œé¡ºå¸¦æä¸€å˜´åˆå§‹åŒ–åˆ—è¡¨çš„å°å‘ï¼Œä¹Ÿç®—æ˜¯å¤ä¹ ï¼›</p><p>å½“ä½ ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨æ¥åˆå§‹åŒ–ç±»å†…æˆå‘˜çš„æ—¶å€™ï¼Œåˆå§‹åŒ–çš„é¡ºåºæ˜¯ç±»å†…æˆå‘˜å£°æ˜çš„é¡ºåºï¼Œè€Œ<strong>ä¸æ˜¯åˆå§‹åŒ–åˆ—è¡¨ä¸­çš„é¡ºåº</strong>ï¼è¿™ç‚¹éå¸¸é‡è¦ï¼Œå¦‚æœé¡ºåºä¸å¯¹ï¼Œå¯èƒ½ä¼šå‡ºç°ä½¿ç”¨æœªå®šä¹‰ï¼ˆè¿˜æ²¡æœ‰åˆå§‹åŒ–å®Œæˆï¼‰çš„å‚æ•°çš„bugï¼</p>]]></content>
    
    
    <summary type="html">æ„é€ å‡½æ•°å’Œåˆå§‹åŒ–åˆ—è¡¨çš„æ€§èƒ½å·®è·å¯¹æ¯”æµ‹è¯•</summary>
    
    
    
    <category term="é‡è§C++" scheme="https://blog.musnow.top/categories/%E9%81%87%E8%A7%81C/"/>
    
    
    <category term="C++" scheme="https://blog.musnow.top/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>ã€ç‰›å®¢ç½‘ã€‘BM3é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ¯kä¸ªä¸€ç»„ç¿»è½¬</title>
    <link href="https://blog.musnow.top/posts/3391123821/"/>
    <id>https://blog.musnow.top/posts/3391123821/</id>
    <published>2023-08-24T06:05:28.000Z</published>
    <updated>2023-08-24T06:05:28.000Z</updated>
    
    <content type="html"><![CDATA[<p>BM3é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ¯kä¸ªä¸€ç»„ç¿»è½¬</p><span id="more"></span><h1 id="1-é¢˜ç›®"><a href="#1-é¢˜ç›®" class="headerlink" title="1.é¢˜ç›®"></a>1.é¢˜ç›®</h1><p><a href="https://www.nowcoder.com/practice/b49c3dc907814e9bbfa8437c251b028e?tpId=295&tqId=722&ru=/exam/company&qru=/ta/format-top101/question-ranking&sourceUrl=/exam/company"><strong>BM3 é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ¯kä¸ªä¸€ç»„ç¿»è½¬</strong></a></p><p>å°†ç»™å‡ºçš„é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ¯ k ä¸ªä¸€ç»„ç¿»è½¬ï¼Œè¿”å›ç¿»è½¬åçš„é“¾è¡¨<br>å¦‚æœé“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ•°ä¸æ˜¯ k çš„å€æ•°ï¼Œ<strong>å°†æœ€åå‰©ä¸‹çš„èŠ‚ç‚¹ä¿æŒåŸæ ·</strong><br>ä½ ä¸èƒ½æ›´æ”¹èŠ‚ç‚¹ä¸­çš„å€¼ï¼Œåªèƒ½æ›´æ”¹èŠ‚ç‚¹æœ¬èº«ã€‚</p><p><img src="https://img.musnow.top/i/2023/08/95cfbee58b6d1466bde50dd0daad2383.png" alt="image-20230824140620807"></p><h1 id="2-è§£æ"><a href="#2-è§£æ" class="headerlink" title="2.è§£æ"></a>2.è§£æ</h1><h2 id="2-1-é“¾è¡¨é€†ç½®"><a href="#2-1-é“¾è¡¨é€†ç½®" class="headerlink" title="2.1 é“¾è¡¨é€†ç½®"></a>2.1 é“¾è¡¨é€†ç½®</h2><p>å…¶ä»–éƒ¨åˆ†å…¶å®å¾ˆå¥½è§£å†³ï¼ŒåŸºäºé“¾è¡¨é€†ç½®çš„ä»£ç ï¼ˆå³é€†ç½®æ•´ä¸ªé“¾è¡¨çš„ä»£ç ï¼‰</p><p>æˆ‘ä»¬åªéœ€è¦å°†æ¯ä¸€ä¸ªéœ€è¦é€†ç½®çš„å°åŒºé—´çš„å¼€å¤´ç»™è®°ä¸‹æ¥ï¼Œäº¤ä»˜ç»™é“¾è¡¨é€†ç½®å°±å¯ä»¥äº†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ— å·®åˆ«é€†ç½®</span></span><br><span class="line"><span class="function">ListNode* <span class="title">reverseNode</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="literal">nullptr</span> || head-&gt;next == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ListNode* ans = <span class="built_in">reverseNode</span>(head-&gt;next);</span><br><span class="line">    head-&gt;next-&gt;next = head;</span><br><span class="line">    head-&gt;next = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-2-è®°å½•æ¯ä¸ªéœ€è¦é€†ç½®çš„åŒºé—´"><a href="#2-2-è®°å½•æ¯ä¸ªéœ€è¦é€†ç½®çš„åŒºé—´" class="headerlink" title="2.2 è®°å½•æ¯ä¸ªéœ€è¦é€†ç½®çš„åŒºé—´"></a>2.2 è®°å½•æ¯ä¸ªéœ€è¦é€†ç½®çš„åŒºé—´</h2><p>æ¯”å¦‚å¦‚ä¸‹éƒ¨åˆ†ä»£ç ï¼Œä¸ºäº†æ–¹ä¾¿è¿›è¡Œéå†å’ŒæŒ‡é’ˆæ§åˆ¶ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªå¤´èŠ‚ç‚¹æ”¾ç½®åœ¨äº†åŸæœ¬é“¾è¡¨å¼€å¤´</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤´èŠ‚ç‚¹å’Œéå†æŒ‡é’ˆ</span></span><br><span class="line"><span class="function">ListNode <span class="title">phead</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">phead.next = head;</span><br><span class="line">ListNode* cur = &amp;phead;</span><br><span class="line"><span class="comment">// æŠŠæ¯kä¸ªèŠ‚ç‚¹å•ç‹¬å–å‡ºæ¥ï¼Œåˆ†åˆ«é€†ç½®åé“¾æ¥èµ·æ¥</span></span><br><span class="line">std::vector&lt;ListNode*&gt; begin_node_v,begin_node_prev_v;</span><br><span class="line"><span class="type">int</span> index = k<span class="number">-1</span>; <span class="comment">// åˆå§‹åŒ–ä¸ºk-1(å¿½ç•¥å¤´èŠ‚ç‚¹)ï¼ŒåŸæœ‰é“¾è¡¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å§‹ç»ˆå…¥æ ˆ</span></span><br><span class="line"><span class="type">int</span> node_count = <span class="number">0</span>;<span class="comment">// èŠ‚ç‚¹æ€»æ•°ï¼ˆåŒ…å«å¤´èŠ‚ç‚¹ï¼‰</span></span><br><span class="line"><span class="keyword">while</span> (cur != <span class="literal">nullptr</span>) &#123; <span class="comment">// ä¸çŸ¥é“æœ‰å¤šé•¿ï¼Œå¾—æ­»å¾ªç¯</span></span><br><span class="line">    <span class="keyword">if</span>(index+<span class="number">1</span> == k &amp;&amp; cur != &amp;phead)&#123;</span><br><span class="line">        begin_node_prev_v.<span class="built_in">push_back</span>(cur);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (index == k) &#123;</span><br><span class="line">        begin_node_v.<span class="built_in">push_back</span>(cur);</span><br><span class="line">        index = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cur = cur-&gt;next;</span><br><span class="line">    index++;</span><br><span class="line">    node_count ++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜åˆ›å»ºäº†ä¸¤ä¸ªvectoræ•°ç»„</p><ul><li><code>begin_node_v</code>ï¼šå¾…é€†ç½®åŒºé—´çš„å¼€å¤´</li><li><code>begin_node_prev_v</code>ï¼šå¾…é€†ç½®åŒºé—´çš„å¼€å¤´çš„ä¸Šä¸€ä¸ª</li></ul><p>ä¸‹é¢æ˜¯å¯¹è¿™ä¸¤ä¸ªæ•°ç»„çš„è¯´æ˜ï¼Œå¦‚æœç»™å‡ºçš„ç¤ºä¾‹æ˜¯å¦‚ä¸‹å½¢å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;1,2,3,4,5&#125;,2</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆä¸¤ä¸ªæ•°ç»„åˆ†åˆ«å­˜å‚¨äº†å¦‚ä¸‹å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">begin_node_v:     &#123;1,3,5&#125;</span><br><span class="line">begin_node_prev_v: &#123;2,4&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€æ¥ï¼Œç¬¬ä¸€ä¸ªæ•°ç»„å®é™…ä¸Šå­˜æ”¾çš„æ˜¯æ¯ä¸ªåŒºé—´çš„<strong>å¼€å¤´</strong>ï¼Œç¬¬äºŒä¸ªæ•°ç»„å­˜æ”¾çš„åˆ™æ˜¯æ¯ä¸ªåŒºé—´çš„<strong>ç»“å°¾</strong>ã€‚<strong>é€†ç½®äº†ä¹‹å</strong>:</p><ul><li>ç¬¬äºŒä¸ªæ•°ç»„å°±æ˜¯æ–°åŒºé—´çš„å¼€å¤´</li><li>ç¬¬ä¸€ä¸ªæ•°ç»„å°±æ˜¯æ–°åŒºé—´çš„ç»“å°¾</li></ul><p>æ–¹ä¾¿æˆ‘ä»¬å°†é€†ç½®åçš„é“¾è¡¨é‡æ–°è¿èµ·æ¥ï¼</p><h2 id="2-3-æŠ›å¼ƒæ— éœ€é€†ç½®çš„åŒºé—´"><a href="#2-3-æŠ›å¼ƒæ— éœ€é€†ç½®çš„åŒºé—´" class="headerlink" title="2.3 æŠ›å¼ƒæ— éœ€é€†ç½®çš„åŒºé—´"></a>2.3 æŠ›å¼ƒæ— éœ€é€†ç½®çš„åŒºé—´</h2><p>åœ¨ä¸Šé¢çš„å¾ªç¯ä¸­ï¼Œç”¨äº†<code>node_count</code>æ¥è®¡ç®—äº†æ•´ä¸ªé“¾è¡¨çš„é•¿åº¦ï¼Œå‡1å‰”é™¤æˆ‘è‡ªå·±æ·»åŠ çš„å¤´èŠ‚ç‚¹ï¼Œå°±æ˜¯åŸå§‹é“¾è¡¨çš„é•¿åº¦ã€‚</p><p>é¢˜ç›®æœ‰ä¸ªç‰¹æ®Šè¦æ±‚ï¼šå¦‚æœåŸå§‹é“¾è¡¨çš„é•¿åº¦å¹¶ékçš„æ•´æ•°å€ï¼Œé‚£ä¹ˆæœ€åä¸€æ®µåŒºåŸŸçš„é“¾è¡¨æ˜¯ä¸éœ€è¦é€†ç½®çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 - 2 - 3 - 4 - 5</span><br><span class="line">å½“k=3çš„æ—¶å€™ï¼Œåªéœ€è¦é€†ç½® 1-2-3</span><br><span class="line">            4-5ä¸éœ€è¦é€†ç½®</span><br><span class="line">3 - 2 - 1 - 4 - 5</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ç§æƒ…å†µï¼Œç”¨ä¾‹å’Œä¸¤ä¸ªæ•°ç»„å­˜æ”¾çš„èŠ‚ç‚¹å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç”¨ä¾‹ &#123;1,2,3,4,5&#125;,3</span><br><span class="line"></span><br><span class="line">begin_node_v:     &#123;1,4&#125;</span><br><span class="line">begin_node_prev_v: &#123;3&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬ç›´æ¥å°†<code>begin_node_v</code>é‡Œé¢çš„èŠ‚ç‚¹äº¤ä»˜ç»™é“¾è¡¨é€†ç½®å‡½æ•°ï¼Œå°±ä¼šå°†<code>4-5</code>è¿™ä¸€æ®µå¤œç»™é€†ç½®ï¼Œæœ€ç»ˆè¿”å›çš„ç»“æœæ˜¯<code>3-2-1-5-4</code>ï¼Œä¸ç¬¦åˆé¢˜ç›®è¦æ±‚ï¼</p><p>æ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å°†4ä»ç¬¬ä¸€ä¸ªæ•°ç»„ä¸­åˆ é™¤ï¼å¦‚æœåŸè§†é“¾è¡¨çš„èŠ‚ç‚¹æ•°é‡å·²ç»å°äºkäº†ï¼Œåˆ™ä¹Ÿä¸éœ€è¦é€†ç½®ï¼Œç›´æ¥è¿”å›å³å¯ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœèŠ‚ç‚¹æ€»æ•°é‡å°äºkåˆ™ä¸é€†ç½®ç›´æ¥è¿”å›</span></span><br><span class="line">node_count --;<span class="comment">//å‡-1 å¤´èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">if</span>(node_count &lt;k)&#123;</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¸æ˜¯æ•´æ•°å€ï¼Œä»£è¡¨æœ€åä¸€ä¸ªæ˜¯ä¸è¦å¤„ç†çš„</span></span><br><span class="line">ListNode* last_link = <span class="literal">nullptr</span>; </span><br><span class="line"><span class="keyword">if</span>((node_count %k) != <span class="number">0</span>) &#123;</span><br><span class="line">    last_link = begin_node_v[begin_node_v.<span class="built_in">size</span>()<span class="number">-1</span>];<span class="comment">// æœ€åä¸€ä¸ª</span></span><br><span class="line">    begin_node_v.<span class="built_in">pop_back</span>();<span class="comment">// åˆ é™¤æœ€åä¸€ä¸ª</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œä¸ºäº†æœ€ç»ˆå°†è¿™æ®µä¹ˆæœ‰é€†ç½®çš„é“¾è¡¨å’Œæ–°é“¾è¡¨è¿èµ·æ¥ï¼Œæˆ‘ä»¬è¿˜éœ€ç”¨ä¸€ä¸ªæŒ‡é’ˆè®°å½•ä¸‹è¿™ä¸€æ®µçš„å¼€å¤´ï¼›<code>last_link</code>åˆå§‹åŒ–ä¸ºç©ºæ˜¯æ–¹ä¾¿åç»­çš„åˆ¤æ–­ï¼Œå¦‚æœä¸ºç©ºä»£è¡¨ä¸å­˜åœ¨è¿™ä¸€æ®µé“¾è¡¨ï¼Œä¸éœ€è¦é“¾æ¥ã€‚</p><h2 id="2-4-åŒºé—´ç»“æŸæ ‡è¯†"><a href="#2-4-åŒºé—´ç»“æŸæ ‡è¯†" class="headerlink" title="2.4 åŒºé—´ç»“æŸæ ‡è¯†"></a>2.4 åŒºé—´ç»“æŸæ ‡è¯†</h2><p>ä¸ºäº†æ ‡è¯†æ¯æ¬¡é€†ç½®çš„ç»“æŸç¬¦ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†å¾…é€†ç½®çš„æ¯ä¸€ä¸ªå°åŒºé—´çš„æœ«å°¾éƒ½æ”¹æˆ<code>nullptr</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†æ¯ä¸ªåŒºé—´çš„æœ«å°¾èŠ‚ç‚¹çš„nexté“¾æ¥ä¸ºNullä½œä¸ºé€’å½’æ ‡è¯†</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span>&amp;n:begin_node_prev_v)&#123;</span><br><span class="line">    n-&gt;next = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-5-é€†ç½®å’Œé‡æ–°é“¾æ¥"><a href="#2-5-é€†ç½®å’Œé‡æ–°é“¾æ¥" class="headerlink" title="2.5 é€†ç½®å’Œé‡æ–°é“¾æ¥"></a>2.5 é€†ç½®å’Œé‡æ–°é“¾æ¥</h2><p>ä¸Šé¢çš„æ­¥éª¤éƒ½æ•²å®šäº†ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†ç¬¬ä¸€ä¸ªæ•°ç»„<code>begin_node_v</code>çš„èŠ‚ç‚¹å–‚ç»™é“¾è¡¨é€†ç½®å‡½æ•°äº†ï¼Œè¯¥é€†ç½®å‡½æ•°çš„è¿”å›å€¼æ˜¯æ–°é“¾è¡¨çš„å¼€å¤´ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†æ¯ä¸ªåŒºé—´äº¤ä»˜ç»™é€’å½’å¼€å§‹é€†ç½®ï¼Œå¹¶å°†é€†ç½®çš„è¿”å›å€¼ä¸ä¸Šä¸€ä¸ªåŒºé—´çš„å¼€å¤´è¿èµ·æ¥</span></span><br><span class="line">cur = &amp;phead;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span>&amp; n:begin_node_v)&#123;</span><br><span class="line">    ListNode* ptr=<span class="built_in">reverseNode</span>(n);</span><br><span class="line">    cur-&gt;next = ptr;</span><br><span class="line">    cur = n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¯´ä¸€ä¸‹curæŒ‡é’ˆçš„ä½œç”¨ï¼Œä»¥ç”¨ä¾‹<code>&#123;1,2,3,4,5&#125;,2</code>ä¸ºæ —å­ï¼Œæ­¤æ—¶<code>begin_node_v</code>æ•°ç»„ä¸­å­˜æ”¾çš„æ˜¯<code>&#123;1,3,5&#125;</code></p><ul><li>åˆå§‹åŒ–ä¸ºphead</li><li>ç¬¬ä¸€æ¬¡å¾ªç¯ï¼ŒnæŒ‡å‘çš„æ˜¯1ï¼ŒcuræŒ‡å‘çš„æ˜¯pheadï¼›é€†ç½®ç»“æŸåï¼ŒptræŒ‡å‘çš„æ˜¯2ï¼Œåˆšå¥½å°±æ˜¯æ–°é“¾è¡¨çš„å¼€å¤´ï¼Œå°†curçš„nexté“¾æ¥ä¸ºå®ƒï¼Œå¹¶å°†curæ›´æ–°ä¸º1</li><li>ç¬¬äºŒæ¬¡å¾ªç¯ï¼ŒnæŒ‡å‘çš„æ˜¯3ï¼ŒcuræŒ‡å‘çš„æ˜¯1ï¼›é€†ç½®ç»“æŸåï¼ŒptræŒ‡å‘çš„æ˜¯4ï¼Œæ­¤æ—¶curçš„nextæŒ‡å‘å®ƒï¼Œå°±æ˜¯å°†1çš„nexté“¾æ¥ä¸º4ï¼Œå†æ¬¡æ›´æ–°curä¸º3ã€‚</li><li>ç¬¬ä¸‰æ¬¡å¾ªç¯ï¼ŒnæŒ‡å‘çš„æ˜¯5ï¼ŒcuræŒ‡å‘çš„æ˜¯3ï¼›é€†ç½®ç»“æŸåï¼Œå°†3çš„nexté“¾æ¥ä¸º5ï¼Œcuræ›´æ–°ä¸º5</li><li>å¾ªç¯ç»“æŸ</li></ul><p>ç»“æŸæ—¶ï¼Œè¿™ä¸ªé“¾è¡¨å°±å·²ç»å®Œå·¥äº†ï¼æˆ‘ä»¬åªéœ€è¦åˆ¤æ–­ä¸€ä¸‹è¿˜æ²¡æœ‰å‰©ä¸‹çš„æ²¡æœ‰é€†ç½®çš„èŠ‚ç‚¹ï¼Œå°†å…¶é“¾æ¥ç»™<code>begin_node_v</code>æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼ˆä¹Ÿæ˜¯é€†ç½®éƒ¨åˆ†çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼‰çš„nextå°±å¯ä»¥äº†</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦è¿˜æœ‰å‰©ä¸‹çš„èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">if</span>(last_link !=<span class="literal">nullptr</span>)&#123;</span><br><span class="line">    begin_node_v[begin_node_v.<span class="built_in">size</span>()<span class="number">-1</span>]-&gt;next = last_link;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3-å®Œæ•´ä»£ç "><a href="#3-å®Œæ•´ä»£ç " class="headerlink" title="3.å®Œæ•´ä»£ç "></a>3.å®Œæ•´ä»£ç </h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param head ListNodeç±»</span></span><br><span class="line"><span class="comment">     * @param k intæ•´å‹</span></span><br><span class="line"><span class="comment">     * @return ListNodeç±»</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// æ— å·®åˆ«é€†ç½®</span></span><br><span class="line">    <span class="function">ListNode* <span class="title">reverseNode</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">nullptr</span> || head-&gt;next == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ListNode* ans = <span class="built_in">reverseNode</span>(head-&gt;next);</span><br><span class="line">        head-&gt;next-&gt;next = head;</span><br><span class="line">        head-&gt;next = <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">cout_vector</span><span class="params">(std::vector&lt;ListNode*&gt;&amp; begin_node_v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; e : begin_node_v) &#123;</span><br><span class="line">            cout &lt;&lt; e-&gt;val &lt;&lt; <span class="string">&quot; &quot;</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">ListNode* <span class="title">reverseKGroup</span><span class="params">(ListNode* head, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ–è€…é€†ç½®åŒºé—´ä¸º1çš„éƒ½ä¸éœ€è¦æ“ä½œ</span></span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">nullptr</span> || head-&gt;next == <span class="literal">nullptr</span> || k &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¤´èŠ‚ç‚¹å’Œéå†æŒ‡é’ˆ</span></span><br><span class="line">        <span class="function">ListNode <span class="title">phead</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">        phead.next = head;</span><br><span class="line">        ListNode* cur = &amp;phead;</span><br><span class="line">        <span class="comment">// æŠŠæ¯kä¸ªèŠ‚ç‚¹å•ç‹¬å–å‡ºæ¥ï¼Œåˆ†åˆ«é€†ç½®åé“¾æ¥èµ·æ¥</span></span><br><span class="line">        std::vector&lt;ListNode*&gt; begin_node_v,begin_node_prev_v;</span><br><span class="line">        <span class="type">int</span> index = k<span class="number">-1</span>; <span class="comment">// åˆå§‹åŒ–ä¸ºk-1(å¿½ç•¥å¤´èŠ‚ç‚¹)ï¼ŒåŸæœ‰é“¾è¡¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å§‹ç»ˆå…¥æ ˆ</span></span><br><span class="line">        <span class="type">int</span> node_count = <span class="number">0</span>;<span class="comment">// èŠ‚ç‚¹æ€»æ•°ï¼ˆåŒ…å«å¤´èŠ‚ç‚¹ï¼‰</span></span><br><span class="line">        <span class="keyword">while</span> (cur != <span class="literal">nullptr</span>) &#123; <span class="comment">// ä¸çŸ¥é“æœ‰å¤šé•¿ï¼Œå¾—æ­»å¾ªç¯</span></span><br><span class="line">            <span class="keyword">if</span>(index+<span class="number">1</span> == k &amp;&amp; cur != &amp;phead)&#123;</span><br><span class="line">                begin_node_prev_v.<span class="built_in">push_back</span>(cur);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (index == k) &#123;</span><br><span class="line">                begin_node_v.<span class="built_in">push_back</span>(cur);</span><br><span class="line">                index = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            cur = cur-&gt;next;</span><br><span class="line">            index++;</span><br><span class="line">            node_count ++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// èµ°åˆ°è¿™é‡Œå·²ç»æŠŠæ¯ä¸ªéœ€è¦é€†ç½®çš„å¼€å¤´èŠ‚ç‚¹ç»™è®°å½•ä¸‹æ¥äº†</span></span><br><span class="line">        <span class="comment">// å¦‚æœèŠ‚ç‚¹æ€»æ•°é‡å°äºkåˆ™ä¸é€†ç½®ç›´æ¥è¿”å›</span></span><br><span class="line">        node_count --;<span class="comment">//å‡-1 å¤´èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span>(node_count &lt;k)&#123;</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ä¸æ˜¯æ•´æ•°å€ï¼Œä»£è¡¨æœ€åä¸€ä¸ªæ˜¯ä¸è¦å¤„ç†çš„</span></span><br><span class="line">        ListNode* last_link = <span class="literal">nullptr</span>; </span><br><span class="line">        <span class="keyword">if</span>((node_count %k) != <span class="number">0</span>) &#123;</span><br><span class="line">            last_link = begin_node_v[begin_node_v.<span class="built_in">size</span>()<span class="number">-1</span>];<span class="comment">// æœ€åä¸€ä¸ª</span></span><br><span class="line">            begin_node_v.<span class="built_in">pop_back</span>();<span class="comment">// åˆ é™¤æœ€åä¸€ä¸ª</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// cout_vector(begin_node_v);</span></span><br><span class="line">        <span class="comment">// cout_vector(begin_node_prev_v);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†æ¯ä¸ªåŒºé—´çš„æœ«å°¾èŠ‚ç‚¹çš„nexté“¾æ¥ä¸ºNullä½œä¸ºé€’å½’æ ‡è¯†</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp;n:begin_node_prev_v)&#123;</span><br><span class="line">            n-&gt;next = <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å°†æ¯ä¸ªåŒºé—´äº¤ä»˜ç»™é€’å½’å¼€å§‹é€†ç½®ï¼Œå¹¶å°†é€†ç½®çš„è¿”å›å€¼ä¸ä¸Šä¸€ä¸ªåŒºé—´çš„å¼€å¤´è¿èµ·æ¥</span></span><br><span class="line">        cur = &amp;phead;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; n:begin_node_v)&#123;</span><br><span class="line">            ListNode* ptr=<span class="built_in">reverseNode</span>(n);</span><br><span class="line">            cur-&gt;next = ptr;</span><br><span class="line">            cur = n;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦è¿˜æœ‰å‰©ä¸‹çš„èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span>(last_link !=<span class="literal">nullptr</span>)&#123;</span><br><span class="line">            begin_node_v[begin_node_v.<span class="built_in">size</span>()<span class="number">-1</span>]-&gt;next = last_link;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> phead.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>é€šè¿‡æˆªå›¾</p><p><img src="https://img.musnow.top/i/2023/08/591fcb7e890e13ec8638e0eb567790e9.png" alt="image-20230824142627806"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;BM3é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ¯kä¸ªä¸€ç»„ç¿»è½¬&lt;/p&gt;</summary>
    
    
    
    <category term="æŠŠé¢˜ç›®éƒ½ç»™åˆ·å¹²å‡€" scheme="https://blog.musnow.top/categories/%E6%8A%8A%E9%A2%98%E7%9B%AE%E9%83%BD%E7%BB%99%E5%88%B7%E5%B9%B2%E5%87%80/"/>
    
    
    <category term="C++" scheme="https://blog.musnow.top/tags/C/"/>
    
    <category term="OJåˆ·é¢˜" scheme="https://blog.musnow.top/tags/OJ%E5%88%B7%E9%A2%98/"/>
    
    <category term="ç‰›å®¢ç½‘" scheme="https://blog.musnow.top/tags/%E7%89%9B%E5%AE%A2%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>ã€C++ã€‘æ—©ç»‘å®šã€ææ„ä¸å¤šæ€ | ä¸€é“å…³äºå¤šæ€çš„é€‰æ‹©é¢˜è®°å½•</title>
    <link href="https://blog.musnow.top/posts/2254346194/"/>
    <id>https://blog.musnow.top/posts/2254346194/</id>
    <published>2023-08-22T13:14:28.000Z</published>
    <updated>2023-08-22T13:14:28.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©åœ¨å’Œç¾¤å‹èŠå¤©çš„æ—¶å€™çœ‹åˆ°äº†ä¸€é“å¾ˆå‘çš„é¢˜ç›®ï¼Œåˆ†äº«ç»™å¤§å®¶</p><span id="more"></span><h1 id="1-çœ‹é¢˜ï¼"><a href="#1-çœ‹é¢˜ï¼" class="headerlink" title="1.çœ‹é¢˜ï¼"></a>1.çœ‹é¢˜ï¼</h1><p>å…ˆæ¥çœ‹çœ‹é¢˜ç›®</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Dad</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Dad</span>()&#123; <span class="built_in">echo</span>();&#125;</span><br><span class="line">    ~<span class="built_in">Dad</span>()&#123; <span class="built_in">echo</span>();&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">echo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;DAD &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Son</span>:Dad</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">echo</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;SON &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Son ss;</span><br></pre></td></tr></table></figure><p>è¯·é—®è¿™ä¸ªçš„è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">A  &quot;DAD DAD &quot;</span><br><span class="line">B  &quot;DAD SON &quot;</span><br><span class="line">C  &quot;SON DAD &quot;</span><br><span class="line">D  &quot;SON SON &quot;</span><br><span class="line">E  ç¼–è¯‘å‡ºé”™</span><br><span class="line">F  è¿è¡Œå‡ºé”™</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆæ˜¯Eï¼Œç¼–è¯‘å‡ºé”™ï¼</p></blockquote><h1 id="2-æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹"><a href="#2-æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹" class="headerlink" title="2.æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹"></a>2.æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹</h1><h2 id="2-1-çŸ¥è¯†ç‚¹"><a href="#2-1-çŸ¥è¯†ç‚¹" class="headerlink" title="2.1 çŸ¥è¯†ç‚¹"></a>2.1 çŸ¥è¯†ç‚¹</h2><p>å…ˆæ¥è¯´è¯´è¿™é“é¢˜ç›®é‡Œé¢æ¶‰åŠåˆ°äº†ä»€ä¹ˆçŸ¥è¯†ç‚¹</p><ul><li>å¤šæ€è°ƒç”¨ï¼›</li><li>å¤šæ€é‡å†™å‡½æ•°éœ€è¦æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ï¼›</li><li>ç±»å†…å‡½æ•°ååŠ <code>const</code>çš„ä½œç”¨ï¼›</li><li>ç±»å†…å‡½æ•°ååŠ <code>override</code>çš„ä½œç”¨ï¼›</li><li>ä»€ä¹ˆæ˜¯æ—©ç»‘å®šå’Œæ™šç»‘å®š</li></ul><p>ä¸€ä¸ªä¸€ä¸ªå¤ä¹ å§ï¼</p><ul><li>å¤šæ€è°ƒç”¨æ˜¯çˆ¶ç±»æŒ‡é’ˆ&#x2F;å¼•ç”¨æŒ‡å‘å­ç±»æ—¶ï¼Œè°ƒç”¨è™šå‡½æ•°ä¼šè°ƒç”¨å­ç±»é‡å†™åçš„ç‰ˆæœ¬</li><li>å¤šæ€é‡å†™å‡½æ•°çš„æ¡ä»¶ï¼šå‡½æ•°å&#x2F;å‚æ•°&#x2F;è¿”å›å€¼éƒ½å¿…é¡»ç›¸åŒï¼ˆæ³¨æ„è¿˜æœ‰åå˜ï¼‰</li><li>ç±»å†…å‡½æ•°ååŠ <code>const</code>ä¿®é¥°çš„æ˜¯è¿™ä¸ªå¯¹è±¡çš„<code>this</code>æŒ‡é’ˆï¼Œè¢«ä¿®é¥°çš„å‡½æ•°ä¸­æ— æ³•ä¿®æ”¹ç±»å†…æˆå‘˜å˜é‡</li><li>ç±»å†…å‡½æ•°ååŠ <code>override</code>æ˜¯è®©ç¼–è¯‘å™¨æ¥ä¸¥æ ¼æ£€æŸ¥æ˜¯å¦æ„æˆé‡è½½</li><li>æ—©ç»‘å®šï¼šé™æ€ç»‘å®šï¼›æ™šç»‘å®šï¼šåŠ¨æ€ç»‘å®šï¼ˆå…·ä½“è¯·çœ‹<a href="https://blog.musnow.top/posts/3933786088/">CPPå¤šæ€</a>çš„åšå®¢ï¼‰</li></ul><h2 id="2-2-åˆ†æé¢˜ç›®"><a href="#2-2-åˆ†æé¢˜ç›®" class="headerlink" title="2.2 åˆ†æé¢˜ç›®"></a>2.2 åˆ†æé¢˜ç›®</h2><p>æ³¨æ„çœ‹çˆ¶ç±»å’Œå­ç±»ä¸­è¿™ä¸¤ä¸ª<code>echo()</code>å‡½æ•°çš„åŒºåˆ«</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">echo</span><span class="params">()</span></span>&#123;&#125;<span class="comment">//çˆ¶ç±»</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">echo</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;&#125;<span class="comment">//å­ç±»</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œå­ç±»å‡½æ•°ä¸­<code>virtual</code>å…³é”®å­—æ˜¯å¯ä»¥çœç•¥çš„ï¼Œä½†å³ä¾¿çœç•¥äº†ï¼Œè¿™ä¸ªå‡½æ•°ä¾æ—§æ˜¯ä¸ªè™šå‡½æ•°ã€‚</p><p>è¿™é‡Œå­ç±»çš„å‡½æ•°ä¸­å¤šäº†<code>const</code>ä¿®é¥°ï¼Œè€Œè¿™ä¸ªconstä¿®é¥°çš„å°±æ˜¯å‡½æ•°ä¸­éšå«çš„<code>this</code>æŒ‡é’ˆï¼Œæ­¤æ—¶å­ç±»ä¸­<code>echo()</code>å‡½æ•°çš„å‚æ•°å°±å‘ç”Ÿäº†å˜åŒ–ï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">echo</span><span class="params">(Son* <span class="keyword">this</span>)</span> </span>&#123; &#125; <span class="comment">// ä¸åŠ const</span></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">echo</span><span class="params">(<span class="type">const</span> Son* <span class="keyword">this</span>)</span> </span>&#123; &#125; <span class="comment">// åŠ const</span></span><br></pre></td></tr></table></figure><p>æ­£æ˜¯å› ä¸ºè¿™é‡Œçš„thisæŒ‡é’ˆå‡ºç°äº†constçš„ä¿®é¥°ï¼Œæ‰€ä»¥å­ç±»çš„echoå’Œçˆ¶ç±»echoçš„å‚æ•°ç±»å‹ä¸åŒï¼Œä¸æ„æˆè™šå‡½æ•°é‡å†™ï¼å†åŠ ä¸Š<code>override</code>å…³é”®å­—çš„ä¸¥æ ¼æ£€æŸ¥ï¼Œä¼šç›´æ¥ç¼–è¯‘æŠ¥é”™ï¼</p><p>æ­£ç¡®çš„å†™æ³•æ˜¯åˆ é™¤å­ç±»echoä¸­çš„constæˆ–è€…ç»™çˆ¶ç±»echoå‡½æ•°åŠ ä¸Šconst</p><h1 id="3-å†æ¥çœ‹é¢˜"><a href="#3-å†æ¥çœ‹é¢˜" class="headerlink" title="3.å†æ¥çœ‹é¢˜"></a>3.å†æ¥çœ‹é¢˜</h1><p>å¥½äº†ï¼Œå‘äººçš„ç‚¹çœ‹å®Œäº†ï¼Œå†æ¥çœ‹ä¸ªã€Œå¸¸è§„ã€çš„ï¼Œå°±æ˜¯æŠŠä¸Šé¢çš„é¢˜å¹²æ”¹æˆèƒ½ç¼–è¯‘é€šè¿‡çš„ã€‚æ­¤æ—¶åˆåº”è¯¥é€‰è°å‘¢ï¼Ÿ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Dad</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Dad</span>()&#123; <span class="built_in">echo</span>();&#125;</span><br><span class="line">    ~<span class="built_in">Dad</span>()&#123; <span class="built_in">echo</span>();&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">echo</span><span class="params">()</span> <span class="type">const</span></span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;DAD &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Son</span>:Dad</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">echo</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;SON &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Son ss;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">A  &quot;DAD DAD &quot;</span><br><span class="line">B  &quot;DAD SON &quot;</span><br><span class="line">C  &quot;SON DAD &quot;</span><br><span class="line">D  &quot;SON SON &quot;</span><br></pre></td></tr></table></figure><p><img src="https://img.musnow.top/i/2023/08/e278c7b0a62e7383e4151067de284350.png" alt="image-20230822211806379"></p><p>ç¼–è¯‘è¿è¡Œï¼Œå¯ä»¥çœ‹åˆ°ï¼Œç»“æœæ˜¯<code>DAD DAD</code>ï¼Œåº”è¯¥é€‰A</p><h2 id="3-1-åˆ†æ"><a href="#3-1-åˆ†æ" class="headerlink" title="3.1 åˆ†æ"></a>3.1 åˆ†æ</h2><p>åœ¨ç»™ <code>Son</code> ç±»å®šä¹‰æ„é€ å‡½æ•°å’Œææ„å‡½æ•°æ—¶ï¼Œæ²¡æœ‰æŒ‡å®šè°ƒç”¨çˆ¶ç±»çš„å¯¹åº”æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ã€‚å› æ­¤ï¼Œåœ¨åˆ›å»º <code>Son</code> å¯¹è±¡ <code>ss</code> æ—¶ï¼Œä¼šé»˜è®¤è°ƒç”¨ <code>Dad</code> ç±»çš„æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ã€‚</p><p>ç”±äº <code>Dad</code> ç±»ä¸­çš„æ„é€ å‡½æ•°å’Œææ„å‡½æ•°è°ƒç”¨äº†è™šå‡½æ•° <code>echo()</code>ï¼Œè€Œè¿™ä¸ªè™šå‡½æ•°åœ¨å­ç±» <code>Son</code> ä¸­è¢«é‡å†™ï¼Œæ‰€ä»¥ä¼šæ ¹æ®å¯¹è±¡ç±»å‹è°ƒç”¨ç›¸åº”çš„é‡å†™å‡½æ•°ã€‚ç„¶è€Œï¼Œåœ¨æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ä¸­ï¼Œè™šå‡½æ•°æœºåˆ¶ä¸ä¼šæŒ‰ç…§é¢„æœŸå·¥ä½œã€‚</p><p>æ„é€ å‡½æ•°ä¸­è°ƒç”¨è™šå‡½æ•°æ—¶ï¼Œä¼šå¿½ç•¥åŠ¨æ€ç»‘å®šæœºåˆ¶ï¼Œç›´æ¥è°ƒç”¨çˆ¶ç±»çš„å‡½æ•°ç‰ˆæœ¬ã€‚å› æ­¤ï¼Œåœ¨ <code>Dad</code> çš„æ„é€ å‡½æ•°ä¸­è°ƒç”¨ <code>echo()</code>ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯ <code>Dad</code> ç±»ä¸­çš„ <code>echo()</code> å‡½æ•°ï¼Œè€Œä¸æ˜¯ <code>Son</code> ç±»ä¸­çš„é‡å†™ç‰ˆæœ¬ã€‚</p><p>åŒæ ·åœ°ï¼Œææ„å‡½æ•°ä¸­ä¹Ÿä¼šå¿½ç•¥åŠ¨æ€ç»‘å®šæœºåˆ¶ï¼Œç›´æ¥è°ƒç”¨çˆ¶ç±»çš„å‡½æ•°ç‰ˆæœ¬ã€‚æ‰€ä»¥ï¼Œåœ¨ <code>Dad</code> çš„ææ„å‡½æ•°ä¸­è°ƒç”¨ <code>echo()</code>ï¼Œä¾ç„¶è°ƒç”¨çš„æ˜¯ <code>Dad</code> ç±»ä¸­çš„ <code>echo()</code> å‡½æ•°ã€‚</p><p>å› æ­¤ï¼Œå½“åˆ›å»º <code>Son</code> å¯¹è±¡ <code>ss</code> å¹¶æ‰“å°è¾“å‡ºæ—¶ï¼Œä¼šå…ˆè°ƒç”¨ <code>Dad</code> ç±»çš„æ„é€ å‡½æ•°å¹¶æ‰“å° <code>&quot;DAD &quot;</code>ï¼Œç„¶åè°ƒç”¨ <code>Dad</code> ç±»çš„ææ„å‡½æ•°å¹¶å†æ¬¡æ‰“å° <code>&quot;DAD &quot;</code>ã€‚</p><h2 id="3-2-ç»“è®º"><a href="#3-2-ç»“è®º" class="headerlink" title="3.2 ç»“è®º"></a>3.2 ç»“è®º</h2><p>åœ¨çˆ¶ç±»çš„æ„é€ å’Œææ„ä¸­ï¼Œå¯¹è±¡çš„ç‰ˆæœ¬éƒ½è¢«ç¡®å®šä¸ºçˆ¶ç±»çš„ç‰ˆæœ¬ï¼Œä¼šé‡‡ç”¨<strong>æ—©ç»‘å®š</strong>æ¥è°ƒç”¨çˆ¶ç±»è‡ªå·±çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯å­ç±»çš„é‡å†™åçš„å‡½æ•°ï¼›</p><p>ç®€å•è®°å¿†ï¼šçˆ¶ç±»çš„æ„é€ å’Œææ„ä¸­å¦‚æœå‡ºç°è™šå‡½æ•°ï¼Œåªä¼šè°ƒç”¨çˆ¶ç±»è‡ªå·±çš„å‡½æ•°ï¼</p><hr><p>è¿™æ˜¯å› ä¸ºç¼–è¯‘å™¨éœ€è¦ä¿è¯æ­£ç¡®çš„æ„é€ å’Œææ„é¡ºåºï¼Œ<strong>å¦‚æœçˆ¶ç±»ææ„é‡Œè°ƒç”¨å­ç±»çš„è™šå‡½æ•°</strong>ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸‹é¢çš„åœºæ™¯</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Dad</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Dad</span>()&#123; <span class="built_in">echo</span>();&#125;</span><br><span class="line">    ~<span class="built_in">Dad</span>()&#123; <span class="built_in">echo</span>();&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">echo</span><span class="params">()</span> <span class="type">const</span></span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;DAD &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Son</span>:Dad</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Son</span>() &#123;</span><br><span class="line">        _a = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">Son</span>() &#123;</span><br><span class="line">        <span class="keyword">delete</span> _a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">echo</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;SON &quot;</span>;</span><br><span class="line">        <span class="keyword">delete</span> _a;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _a;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Son ss;</span><br></pre></td></tr></table></figure><p>å¦‚æœçˆ¶ç±»ä¸­çš„ææ„<code>echo()</code>è°ƒç”¨å­ç±»é‡å†™çš„å‡½æ•°ï¼Œæ­¤æ—¶å°±ä¼šå‡ºç°å­ç±»å·²ç»è¢«é”€æ¯ï¼ˆå­ç±»çš„ææ„å‡½æ•°æ—©äºçˆ¶ç±»ææ„è°ƒç”¨ï¼‰çš„<code>_a</code>è¢«äºŒæ¬¡<code>delete</code>ï¼Œä¸¤æ¬¡<code>delete</code>åŒä¸€ç‰‡ç©ºé—´æ˜¯ä¼šæŠ¥é”™çš„ï¼</p><p>æ‰€ä»¥ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œçˆ¶ç±»çš„ææ„ä¸­é‡‡ç”¨æ—©ç»‘å®šï¼Œå­ç±»é‡å†™çš„è™šå‡½æ•°ä¸ä¼šç”Ÿæ•ˆï¼</p><p>è¿™ç§è¡Œä¸ºæ˜¯ä¸ºäº†ç¡®ä¿åœ¨å¯¹è±¡çš„æ„é€ å’Œææ„è¿‡ç¨‹ä¸­ï¼Œ<strong>æŒ‰ç…§æ­£ç¡®çš„é¡ºåºè°ƒç”¨å„ä¸ªç±»çš„æ„é€ å’Œææ„å‡½æ•°</strong>ï¼Œé¿å…åœ¨å¯¹è±¡å¤„äºæœªå®Œå…¨åˆå§‹åŒ–æˆ–å·²éƒ¨åˆ†é”€æ¯çŠ¶æ€æ—¶è°ƒç”¨å­ç±»çš„å‡½æ•°ã€‚</p><blockquote><p>åŒ…æ‹¬çˆ¶ç±»çš„æ„é€ ä¹Ÿå¯ä»¥è¿™ä¹ˆç†è§£ï¼Œå¦‚æœçˆ¶ç±»æ„é€ é‡Œé¢å¯ä»¥è°ƒç”¨å­ç±»çš„è™šå‡½æ•°ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸¤æ¬¡å¯¹ä¸€ä¸ªå­ç±»å¯¹è±¡è¿›è¡Œnewç©ºé—´ï¼Œä¼šäº§ç”Ÿå†…å­˜æ³„éœ²ï¼›</p><p>ä½†æ„é€ å‡½æ•°è¿˜å’Œè™šå‡½æ•°è¡¨çš„åˆå§‹åŒ–æœ‰å…³ç³»ï¼Œæ­¤æ—¶è™šå‡½æ•°è¡¨è¿˜æ²¡æœ‰å®Œå…¨åˆå§‹åŒ–ï¼Œ<strong>å­ç±»å¯¹è±¡å°šæœªæ„é€ å®Œæˆ</strong>ï¼Œæ²¡æœ‰å¤šæ€è°ƒç”¨çš„æ¡ä»¶ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½è°ƒç”¨åˆ°å­ç±»é‡å†™åçš„è™šå‡½æ•°ã€‚</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä»Šå¤©åœ¨å’Œç¾¤å‹èŠå¤©çš„æ—¶å€™çœ‹åˆ°äº†ä¸€é“å¾ˆå‘çš„é¢˜ç›®ï¼Œåˆ†äº«ç»™å¤§å®¶&lt;/p&gt;</summary>
    
    
    
    <category term="æŠŠé¢˜ç›®éƒ½ç»™åˆ·å¹²å‡€" scheme="https://blog.musnow.top/categories/%E6%8A%8A%E9%A2%98%E7%9B%AE%E9%83%BD%E7%BB%99%E5%88%B7%E5%B9%B2%E5%87%80/"/>
    
    
    <category term="C++" scheme="https://blog.musnow.top/tags/C/"/>
    
    <category term="OJåˆ·é¢˜" scheme="https://blog.musnow.top/tags/OJ%E5%88%B7%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>ã€ç½‘ç»œã€‘IPç½‘ç»œå±‚å’Œæ•°æ®é“¾è·¯å±‚</title>
    <link href="https://blog.musnow.top/posts/3482559497/"/>
    <id>https://blog.musnow.top/posts/3482559497/</id>
    <published>2023-08-21T12:22:36.000Z</published>
    <updated>2023-08-22T04:05:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>IPåè®®è¯¦è§£</p><span id="more"></span><h1 id="1-æ¦‚å¿µ"><a href="#1-æ¦‚å¿µ" class="headerlink" title="1.æ¦‚å¿µ"></a>1.æ¦‚å¿µ</h1><h2 id="1-1-å››å±‚æ¨¡å‹"><a href="#1-1-å››å±‚æ¨¡å‹" class="headerlink" title="1.1 å››å±‚æ¨¡å‹"></a>1.1 å››å±‚æ¨¡å‹</h2><ul><li>åº”ç”¨å±‚ï¼šè§£å†³å¦‚ä½•ä¼ è¾“æ•°æ®ï¼ˆä¾ç…§ä»€ä¹ˆæ ¼å¼&#x2F;åè®®å¤„ç†æ•°æ®ï¼‰çš„é—®é¢˜</li><li>ä¼ è¾“å±‚ï¼šè§£å†³å¯é æ€§é—®é¢˜</li><li>ç½‘ç»œå±‚ï¼šæ•°æ®å¾€å“ªé‡Œä¼ ï¼Œæ€ä¹ˆæ‰¾åˆ°ç›®æ ‡ä¸»æœº</li><li>æ•°æ®é“¾è·¯å±‚ï¼ˆç‰©ç†å±‚ï¼‰ï¼šæ•°æ®åœ¨ç‰©ç†ç¡¬ä»¶å±‚é¢ä¸Šä¼ è¾“</li></ul><p>ç½‘ç»œå±‚çš„IPåè®®ï¼Œå°±æ˜¯è®©ç½‘ç»œï¼Œæ‹¥æœ‰å°†æ•°æ®ä»Aä¸»æœºå‘é€åˆ°Bä¸»æœºçš„èƒ½åŠ›ã€‚</p><blockquote><p>æ³¨æ„ï¼šæ‹¥æœ‰æ­¤èƒ½åŠ›ï¼Œå¹¶ä¸ä»£è¡¨æ¯æ¬¡éƒ½èƒ½æˆåŠŸé€è¾¾ï¼ï¼ˆå³å¯é æ€§é100%ï¼‰</p></blockquote><p>è€Œå¤±è´¥çš„æ—¶å€™ï¼Œå°±éœ€è¦<strong>ä¼ è¾“å±‚</strong>æ¥è·å–å‘ç”Ÿé”™è¯¯çš„åŸå› ï¼Œå¹¶è¿›è¡Œé”™è¯¯é‡ä¼ æˆ–è€…è¶…æ—¶é‡ä¼ ç­‰æ“ä½œã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨ä»ç½‘ç»œå±‚è·å–åˆ°ä¿¡æ¯æˆåŠŸé€è¾¾åˆ°å¯¹æ–¹çš„åé¦ˆä¹‹å‰ï¼Œä¼ è¾“å±‚éœ€è¦æš‚æ—¶ä¿ç•™å·²ç»å‘é€çš„æ•°æ®ã€‚å¦‚æœç½‘ç»œå±‚å‘é€å¤±è´¥äº†ï¼Œä¼ è¾“å±‚éœ€è¦è¿›è¡Œé‡å‘æ“ä½œï¼Œä»¥ä¿è¯å¯é æ€§ã€‚</p><p><img src="https://img.musnow.top/i/2023/02/2023e40723a2e8f8c6b0662d97d468537cbb.jpeg"></p><h2 id="1-2-ä¸»æœºã€è·¯ç”±å™¨ã€èŠ‚ç‚¹"><a href="#1-2-ä¸»æœºã€è·¯ç”±å™¨ã€èŠ‚ç‚¹" class="headerlink" title="1.2 ä¸»æœºã€è·¯ç”±å™¨ã€èŠ‚ç‚¹"></a>1.2 ä¸»æœºã€è·¯ç”±å™¨ã€èŠ‚ç‚¹</h2><ul><li>ä¸»æœºï¼šæ‹¥æœ‰IPåœ°å€ï¼Œä½†ä¸è¿›è¡Œè·¯ç”±æ§åˆ¶çš„è®¾å¤‡</li><li>è·¯ç”±å™¨ï¼šæ‹¥æœ‰IPåœ°å€ï¼Œå¹¶è¿›è¡Œè·¯ç”±æ§åˆ¶çš„è®¾å¤‡</li><li>èŠ‚ç‚¹ï¼šä¸»æœºå’Œè·¯ç”±å™¨çš„ç»Ÿç§°</li></ul><h1 id="2-IPæŠ¥æ–‡"><a href="#2-IPæŠ¥æ–‡" class="headerlink" title="2.IPæŠ¥æ–‡"></a>2.IPæŠ¥æ–‡</h1><h2 id="2-1-æŠ¥æ–‡ç»“æ„"><a href="#2-1-æŠ¥æ–‡ç»“æ„" class="headerlink" title="2.1 æŠ¥æ–‡ç»“æ„"></a>2.1 æŠ¥æ–‡ç»“æ„</h2><p>IPåè®®çš„æŠ¥æ–‡ä¸TCPçš„æŠ¥æ–‡æœ‰ä¸€å®šç¨‹åº¦ä¸Šçš„ç›¸ä¼¼</p><p>ä¸‹å›¾ä¸ºIPV4ä¸­æŠ¥æ–‡çš„æ ¼å¼ï¼ˆIPV6çš„æŠ¥æ–‡å’Œä¸‹å›¾æ˜¯ä¸åŒçš„ï¼‰</p><p><img src="https://img.musnow.top/i/2023/07/f93a3878d288a436d0a9f8320202f3c0.png" alt="image-20230724122812011"></p><ul><li>å››ä½ç‰ˆæœ¬å·ï¼šæŒ‡å®šIPåè®®çš„ç‰ˆæœ¬ï¼ŒIPV4æ¥è¯´å°±æ˜¯4</li><li>å››ä½é¦–éƒ¨é•¿åº¦ï¼šIPæŠ¥å¤´çš„é•¿åº¦ï¼ˆå’ŒTCPçš„å®šä¹‰ä¸€æ ·ï¼Œæ ‡å‡†é•¿åº¦éœ€è¦ç”¨<code>å››ä½é¦–éƒ¨é•¿åº¦ * 4å­—èŠ‚</code>ï¼Œå³æœ€å¤§æŠ¥å¤´é•¿åº¦ä¸º<code>15*4=60</code>å­—èŠ‚ï¼‰</li><li>å…«ä½æœåŠ¡ç±»å‹ï¼šåŒ…å«3ä½ä¼˜å…ˆæƒå­—æ®µï¼ˆå·²ç»å¼ƒç”¨ï¼‰ã€4ä½TOSå­—æ®µå’Œ1ä½ä¿ç•™å­—æ®µï¼ˆå¿…é¡»ç½®ä¸º0ï¼‰å››ä½TOSåˆ†åˆ«è¡¨ç¤ºï¼š<strong>æœ€å¤§ååé‡ã€æœ€é«˜å¯é æ€§ã€æœ€å°æˆæœ¬ã€æœ€å°å»¶æ—¶</strong>ã€‚åªèƒ½å››é€‰ä¸€ï¼Œéœ€è¦æ ¹æ®å…·ä½“ä¼ è¾“å±‚çš„åè®®è¦æ±‚è¿›è¡Œé€‰æ‹©ã€‚</li><li>åå…­ä½æ€»é•¿åº¦ï¼šåŒ…æ‹¬æŠ¥å¤´çš„æ•´ä¸ªæŠ¥æ–‡çš„é•¿åº¦ï¼Œå‡å»å››ä½é¦–éƒ¨é•¿åº¦å°±èƒ½å¾—å‡ºæŠ¥æ–‡ä¸­æ•°æ®å­—æ®µçš„é•¿åº¦ã€‚</li><li>åå…­ä½é¦–éƒ¨æ ¡éªŒå’Œï¼šä½¿ç”¨CRCæ ¡éªŒæ¥åˆ¤æ–­æŠ¥å¤´æ˜¯å¦æœ‰æ•°æ®æŸå</li><li>å…«ä½åè®®ï¼šä¸Šå±‚åè®®ç±»å‹ï¼ˆæ¯”å¦‚tcpã€udpã€sshç­‰ï¼‰è§£å†³å¦‚ä½•å‘ä¸Šå±‚äº¤ä»˜çš„é—®é¢˜</li><li>å…«ä½ç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼‰ï¼šç”¨äºæ§åˆ¶IPæŠ¥æ–‡èƒ½åœ¨ç½‘ç»œå±‚ä¼ è¾“çš„æ—¶é—´ï¼ˆç”Ÿå‘½å‘¨æœŸçš„é™åˆ¶ï¼‰æ¯”å¦‚æœ‰äº›æŠ¥æ–‡ç”±äºè·¯ç”±æ—¶å‡ºç°äº†é”™è¯¯ï¼Œé™·å…¥äº†è·¯ç”±çš„æ­»å¾ªç¯ï¼›äº¦æˆ–è€…æ˜¯è·¯ç”±ç¨‹åºå‡ºç°äº†BUGï¼Œå¯¼è‡´æ²¡åŠæ³•è¢«æ­£å¸¸è½¬å‘åˆ°æ­£ç¡®çš„ä¸»æœºä¸Šï¼›è¿˜æœ‰è·¯ç”±è¶…æ—¶çš„é—®é¢˜ã€‚<strong>æ­¤æ—¶è¿™ä¸ªå‡ºé”™çš„æŠ¥æ–‡å°±ä¼šåœ¨è·¯ç”±é‡Œé¢é•¿æ—¶é—´æ¸¸ç¦»è€Œæ²¡åŠæ³•æŠµè¾¾ç›®çš„åœ°</strong>ï¼ˆå¥½æ¯”å†…å­˜æ³„éœ²ï¼‰ã€‚è§„å®šäº†TTLä¹‹åï¼Œå¯ä»¥åœ¨IPæŠ¥å¤´ä¸­ä¸­è®°å½•æŠ¥æ–‡çš„ç”Ÿå‘½å‘¨æœŸæ—¶é—´ï¼Œå½“æŠ¥æ–‡è½¬å‘çš„è€—æ—¶å·²ç»å¤§äºè¿™ä¸ªTTLä¹‹åï¼Œå°±å°†è¿™ä¸ªæŠ¥æ–‡ä¸¢å¼ƒã€‚</li><li>ä¸‰åäºŒä½æºåœ°å€å’Œä¸‰åäºŒä½ä½ç›®æ ‡åœ°å€ï¼šè¡¨ç¤ºå‘é€ç«¯IPå’Œæ¥æ”¶ç«¯IP</li><li>é€‰é¡¹å­—æ®µï¼šä¸å®šé•¿ï¼Œæœ€å¤š40å­—èŠ‚ï¼ˆè¿™æ˜¯å› ä¸ºé¦–éƒ¨é»˜è®¤æ˜¯20å­—èŠ‚ï¼Œå†åŠ ä¸Šé¦–éƒ¨é•¿åº¦æœ€å¤šåªèƒ½è¡¨ç¤º60ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥é€‰é¡¹å­—æ®µå°±æ˜¯ <code>60-20=40</code>ï¼‰</li><li>æ­¤å¤„çœç•¥äº†å‡ ä¸ªå­—æ®µï¼Œä¼šåœ¨åæ–‡çš„<strong>åˆ†ç‰‡</strong>ä¸­è¯´æ˜â€¦â€¦</li></ul><p>IPåè®®çš„æŠ¥æ–‡ä¸­æ²¡æœ‰ç«¯å£å·ï¼Œå› ä¸ºç«¯å£å·æ˜¯<strong>ä¼ è¾“å±‚åº”è¯¥è§£å†³</strong>çš„äº‹æƒ…ï¼ˆUDPå’ŒTCPçš„æŠ¥å¤´ä¸­æ‰æœ‰ç«¯å£å·çš„å­—æ®µï¼‰IPå±‚åªå…³æ³¨å¦‚ä½•å°†æŠ¥æ–‡å‘é€ç»™ç›®æ ‡ä¸»æœºã€‚ä¹Ÿå°±æ˜¯ä¸¤ä¸ªä¸»æœºä¹‹é—´å¦‚ä½•æ­£å¸¸é€šä¿¡çš„é—®é¢˜ã€‚</p><h2 id="2-2-åˆ†ç‰‡"><a href="#2-2-åˆ†ç‰‡" class="headerlink" title="2.2 åˆ†ç‰‡"></a>2.2 åˆ†ç‰‡</h2><h3 id="2-2-1-è®¤è¯†MTU"><a href="#2-2-1-è®¤è¯†MTU" class="headerlink" title="2.2.1 è®¤è¯†MTU"></a>2.2.1 è®¤è¯†MTU</h3><p>MTUç›¸<span id="jump1">å½“äº</span>å‘å¿«é€’æ—¶å¯¹åŒ…è£¹å°ºå¯¸çš„é™åˆ¶ï¼Œè¿™ä¸ªé™åˆ¶æ˜¯ä¸åŒçš„<strong>æ•°æ®é“¾è·¯å±‚</strong>å¯¹åº”çš„ç‰©ç†å±‚äº§ç”Ÿçš„é™åˆ¶ã€‚</p><ul><li>ä»¥å¤ªç½‘å¸§ä¸­çš„æ•°æ®é•¿åº¦è§„å®šæœ€å°46å­—èŠ‚ï¼Œæœ€å¤§1500å­—èŠ‚ï¼›</li><li>ARPæ•°æ®åŒ…çš„é•¿åº¦ä¸å¤Ÿ46å­—èŠ‚ã€‚è¦åœ¨åé¢è¡¥å¡«å……ä½ï¼›</li><li>æœ€å¤§å€¼1500ç§°ä¸ºä»¥å¤ªç½‘çš„æœ€å¤§ä¼ è¾“å•å…ƒ(MTU)ï¼Œä¸åŒçš„ç½‘ç»œç±»å‹æœ‰ä¸åŒçš„MTUï¼›</li><li>å¦‚æœä¸€ä¸ªæ•°æ®åŒ…ä»ä»¥å¤ªç½‘è·¯ç”±åˆ°æ‹¨å·é“¾è·¯ä¸Šï¼Œæ•°æ®åŒ…é•¿åº¦å¤§äºæ‹¨å·é“¾è·¯çš„MTUäº†ï¼Œåˆ™éœ€è¦å¯¹æ•°æ®åŒ…è¿›è¡Œåˆ†ç‰‡(fragmentation)ï¼›</li><li>ä¸åŒçš„æ•°æ®é“¾è·¯å±‚æ ‡å‡†çš„MTUæ˜¯ä¸åŒçš„ï¼›</li></ul><p>æ‰€ä»¥ï¼Œæ•°æ®é“¾è·¯å±‚ä¸æ”¯æŒè¿‡å¤§çš„æ•°æ®ï¼Œè¿™å°±éœ€è¦åœ¨ç½‘ç»œå±‚å¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡ã€‚</p><p>è€Œç½‘ç»œå±‚IPåè®®ä¼š<strong>è‡ªåŠ¨</strong>å¸®æˆ‘ä»¬åˆ†ç‰‡ï¼Œå¹¶åœ¨æ¥æ”¶ç«¯ç»„è£…ã€‚è¿™ä¸ªè¡Œä¸ºå¯¹ä¼ è¾“å±‚æ¥è¯´æ˜¯ä¸éœ€è¦å…³æ³¨çš„ï¼Œåœ¨<strong>å››å±‚æ¨¡å‹</strong>ä¸­ï¼Œæ¯ä¸€å±‚ä¹‹é—´çš„åŠŸèƒ½éœ€è¦è¿›è¡Œè§£è€¦ã€‚</p><p>åˆ†ç‰‡ä¹‹åï¼Œåªè¦æœ‰ä¸€ä¸ªåˆ†ç‰‡æŠ¥æ–‡ä¸¢å¤±ï¼Œè¿™ä¸ªæŠ¥æ–‡çš„æ•´ä½“å°±ä¼šè®¤ä¸ºä¸¢å¤±äº†ï¼ˆå› ä¸ºæ²¡æœ‰åŠæ³•æ‹¼å‡ºå®Œæ•´çš„æŠ¥æ–‡æ•°æ®ï¼‰</p><hr><p>ä½†è¿™æ ·å°±å¼•å‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼š<strong>åˆ†ç‰‡ä¼šæé«˜ä¸¢åŒ…çš„æ¦‚ç‡</strong>ï¼Œå½±å“ä¼ è¾“é€Ÿç‡ï¼ˆå‘ä¸€æ¬¡å¿«é€’å’Œå‘ä¸‰æ¬¡å¿«é€’ï¼Œæ˜æ˜¾ä¸‰æ¬¡å¿«é€’ä¸¢ä¸œè¥¿çš„å¯èƒ½æ€§æ›´é«˜ï¼‰</p><p>å¯¹äºå…·æœ‰å¯é æ€§æœºåˆ¶çš„TCPè€Œè¨€ï¼Œä¸¢åŒ…é—®é¢˜ä¸å¤§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¼ è¾“å±‚è¿›è¡Œé‡ä¼ ã€‚ä½†UDPæ²¡æœ‰å¯é æ€§ï¼Œæ­¤æ—¶å‡ºç°åˆ†ç‰‡åä¸¢åŒ…äº†å°±æ²¡åŠæ³•æ‰¾å›äº†ã€‚</p><p>æ‰€ä»¥ï¼Œç½‘ç»œå±‚è¿›è¡Œåˆ†ç‰‡å¹¶ä¸æ˜¯ä¸»æµï¼ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨ä¼ è¾“å±‚å°±è¿›è¡Œåˆ†ç‰‡æ‰æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p><h3 id="2-2-2-å¦‚ä½•åˆ†ç‰‡"><a href="#2-2-2-å¦‚ä½•åˆ†ç‰‡" class="headerlink" title="2.2.2 å¦‚ä½•åˆ†ç‰‡"></a>2.2.2 å¦‚ä½•åˆ†ç‰‡</h3><p>åœ¨IPæŠ¥å¤´ä¸­ï¼Œå¦‚ä¸‹å­—æ®µå°±æ˜¯ç”¨äºåˆ†ç‰‡å’Œç»„è£…æ“ä½œçš„</p><p><img src="https://img.musnow.top/i/2023/07/4245674fedcf6b9d43b2845083017f26.png" alt="image-20230724185036181"></p><ul><li>åå…­ä½æ ‡è¯† (id): å”¯ä¸€çš„æ ‡è¯†ä¸»æœºå‘é€çš„æŠ¥æ–‡ã€‚å¦‚æœIPæŠ¥æ–‡åœ¨æ•°æ®é“¾è·¯å±‚è¢«åˆ†ç‰‡äº†ï¼Œé‚£ä¹ˆ<strong>æ¯ä¸€ä¸ªç‰‡é‡Œé¢çš„è¿™ä¸ªidéƒ½æ˜¯ç›¸åŒçš„</strong></li><li>ä¸‰ä½æ ‡å¿—å­—æ®µ: <ul><li>ç¬¬ä¸€ä½ä¿ç•™ (ä¿ç•™çš„æ„æ€æ˜¯ç°åœ¨ä¸ç”¨ï¼Œ ä½†æ˜¯è¿˜æ²¡æƒ³å¥½è¯´ä¸å®šä»¥åè¦ç”¨åˆ°)ã€‚ </li><li>ç¬¬äºŒä½ç½®ä¸º1è¡¨ç¤ºâ€œç¦æ­¢åˆ†ç‰‡â€ï¼Œ è¿™æ—¶å€™å¦‚æœæŠ¥æ–‡é•¿åº¦è¶…è¿‡MTUï¼Œ IPæ¨¡å—å°±ä¼šä¸¢å¼ƒæŠ¥æ–‡ã€‚ </li><li>ç¬¬ä¸‰ä½è¡¨ç¤ºâ€æ›´å¤šåˆ†ç‰‡â€ï¼Œ å¦‚æœåˆ†ç‰‡äº†çš„è¯ï¼Œ <strong>æœ€åä¸€ä¸ªåˆ†ç‰‡ç½®ä¸º0</strong>ï¼Œ å…¶ä»–åˆ†ç‰‡æŠ¥æ–‡éƒ½æ˜¯1ï¼›<strong>0å°±ç±»ä¼¼äºä¸€ä¸ªåˆ†ç‰‡çš„ç»“æŸæ ‡è®°</strong></li></ul></li><li>åä¸‰ä½åˆ†ç‰‡åç§» (framegament offset): æ˜¯åˆ†ç‰‡ç›¸å¯¹äºåŸå§‹IPæŠ¥æ–‡å¼€å§‹å¤„çš„åç§»ã€‚ å…¶å®å°±æ˜¯åœ¨è¡¨ç¤ºå½“å‰åˆ†ç‰‡åœ¨åŸæŠ¥æ–‡ä¸­å¤„åœ¨å“ªä¸ªä½ç½®ã€‚å®é™…åç§»çš„å­—èŠ‚æ•°æ˜¯è¿™ä¸ªå€¼ <code>* 8 </code>å¾—åˆ°çš„ã€‚å› æ­¤ï¼Œ é™¤äº†æœ€åä¸€ä¸ªæŠ¥æ–‡ä¹‹å¤–ï¼Œ <strong>å…¶ä»–æŠ¥æ–‡çš„é•¿åº¦å¿…é¡»æ˜¯8çš„æ•´æ•°å€</strong> (å¦åˆ™æŠ¥æ–‡å°±ä¸è¿ç»­äº†)</li></ul><p>æ­¤æ—¶ï¼Œåªè¦å°†ä¸‰ä½æ ‡å¿—å­—æ®µä¸­çš„<code>æ›´å¤šåˆ†ç‰‡</code>ç½®ä¸º1ï¼Œå°±ä»£è¡¨å½“å‰æŠ¥æ–‡å¹¶ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„æŠ¥æ–‡ï¼Œè€Œæ˜¯å·²ç»è¢«åˆ†ç‰‡åçš„æŠ¥æ–‡ã€‚</p><blockquote><ul><li>æ›´å¤šåˆ†ç‰‡ä¸º0ï¼Œä¸”åˆ†ç‰‡åç§»ä¸º0ï¼Œä»£è¡¨å½“å‰æŠ¥æ–‡æ²¡æœ‰è¿›è¡Œåˆ†ç‰‡ï¼›</li><li>æ›´å¤šåˆ†ç‰‡ä¸º1ï¼Œä¸”åˆ†ç‰‡åç§»ä¸º0ï¼Œä»£è¡¨å½“å‰æ˜¯åˆ†ç‰‡åæŠ¥æ–‡ä¸­çš„ç¬¬ä¸€ä¸ªï¼›</li><li>æ›´å¤šåˆ†ç‰‡ä¸º0ï¼Œä¸”åˆ†ç‰‡åç§»<strong>ä¸ä¸º0</strong>ï¼Œä»£è¡¨å½“å‰æ˜¯åˆ†ç‰‡æŠ¥æ–‡ä¸­çš„æœ€åä¸€ä¸ªï¼›</li></ul></blockquote><p>æ­¤æ—¶å°±éœ€è¦æ ¹æ®åå…­ä½æ ‡è¯†æ¥ç¡®å®šå½“å‰åˆ†ç‰‡å±äºå“ªä¸€ä¸ªâ€œç»„â€ï¼Œå†å°†å½“å‰æŠ¥æ–‡å’Œåç»­æ”¶åˆ°çš„IDç›¸åŒçš„æŠ¥æ–‡é›†åˆåœ¨ä¸€èµ·ï¼Œé€šè¿‡åä¸‰ä½ç‰‡åç§»æ¥è¿›è¡Œæ’åºï¼Œç»„è£…æˆå®Œæ•´æ•°æ®ï¼</p><p>æ¯”å¦‚ï¼Œç¬¬ä¸€ä¸ªæŠ¥æ–‡çš„èµ·å§‹åç§»é‡æ˜¯0ï¼Œç¬¬äºŒä¸ªæ˜¯1000ï¼Œç¬¬ä¸‰ä¸ªæ˜¯2000ï¼Œè¿™æ—¶å€™å°±æ ¹æ®ç‰‡åç§»æ’åºè¿›è¡Œæ‹¼æ¥å°±å¯ä»¥äº†ã€‚ï¼ˆè¿™åªæ˜¯ä¸ªæ —å­ï¼‰</p><ul><li>å¦‚ä½•ä¿è¯æ”¶å®Œäº†ï¼Ÿ</li></ul><p>æ ¹æ®åå…­ä½æ ‡è¯†ï¼ŒæŒ‰ç…§ç‰‡åç§»è¿›è¡Œæ’åºï¼Œæ’åºåå‘ç°ç¼ºå¤±äº†éƒ¨åˆ†çš„æŠ¥æ–‡ï¼Œé‚£å°±ä»£è¡¨æ²¡æœ‰è¢«æ”¶å®Œã€‚å› ä¸ºæ¯ä¸€ä¸ªæŠ¥æ–‡çš„<code>åç§»é‡+è¯¥æŠ¥æ–‡é•¿åº¦</code>ï¼Œå°±æ˜¯ä¸‹ä¸€ä¸ªæŠ¥æ–‡çš„<code>åç§»é‡</code>ï¼åªè¦æ•°æ®å¯¹ä¸ä¸Šï¼Œé‚£å°±ä»£è¡¨ä¸¢ä¸œè¥¿äº†ã€‚</p><p>è€Œå¼€å¤´å’Œç»“å°¾çš„æŠ¥æ–‡ï¼Œå°±èƒ½é€šè¿‡ä¸Šé¢æåˆ°çš„æ ¹æ®<code>æ›´å¤šåˆ†ç‰‡æ ‡è®°ä½+åˆ†ç‰‡åç§»</code>æ¥ç¡®å®šæœ‰æ²¡æœ‰ä¸¢ã€‚</p><h3 id="2-2-3-å¦‚ä½•å‡å°‘åˆ†ç‰‡"><a href="#2-2-3-å¦‚ä½•å‡å°‘åˆ†ç‰‡" class="headerlink" title="2.2.3 å¦‚ä½•å‡å°‘åˆ†ç‰‡"></a>2.2.3 å¦‚ä½•å‡å°‘åˆ†ç‰‡</h3><p>è™½ç„¶è¯´IPç½‘ç»œå±‚ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åˆ†ç‰‡ï¼Œä½†æ˜¯å¦åˆ†ç‰‡æ˜¯<strong>å¯ä»¥é€šè¿‡ä¼ è¾“å±‚</strong>æ¥è¿›è¡Œæ§åˆ¶çš„</p><p>åªè¦ä¼ è¾“å±‚ä¸€æ¬¡äº¤ä»˜çš„æ•°æ®æ²¡æœ‰è¶…è¿‡éœ€è¦åˆ†ç‰‡çš„é˜ˆå€¼ï¼Œé‚£ç½‘ç»œå±‚åœ¨ä¼ è¾“çš„æ—¶å€™å°±ä¸ä¼šè¿›è¡Œåˆ†ç‰‡äº†ï¼</p><p>å‡å°‘åˆ†ç‰‡çš„æ–¹å¼ï¼Œé‚£å°±æ˜¯åœ¨ä¼ è¾“å±‚å°±è¿›è¡Œä¸€å®šçš„åˆ†ç‰‡ï¼Œè¿™æ ·èƒ½æ›´å¥½å°†<code>ä¸¢åˆ†ç‰‡æŠ¥æ–‡</code>è¿™ä»¶äº‹åœ¨ä¼ è¾“å±‚è¿›è¡Œå¤„ç†ã€‚è€Œä¸æ˜¯åœ¨ç½‘ç»œå±‚ä¸¢åŒ…åï¼Œæ²¡åŠæ³•åœ¨ä¼ è¾“å±‚å¤±è´¥å¹¶å¤„ç†ã€‚</p><hr><h4 id="ä¼ è¾“å±‚è¿›è¡Œé™åˆ¶"><a href="#ä¼ è¾“å±‚è¿›è¡Œé™åˆ¶" class="headerlink" title="ä¼ è¾“å±‚è¿›è¡Œé™åˆ¶"></a>ä¼ è¾“å±‚è¿›è¡Œé™åˆ¶</h4><p>å¦‚æœæ˜¯TCPåè®®ï¼Œåœ¨ä¸‰æ¬¡æ¡æ‰‹çš„æ—¶å€™ï¼Œå°±ä¼šåå•†åŒæ–¹å•è¯ä¼ è¾“æ•°æ®çš„å¤§å°ã€‚ä»è€Œé¿å…ç½‘ç»œå±‚å¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡ï¼Œä»¥è§„é¿æ•°æ®é“¾è·¯å±‚çš„MTUé™åˆ¶ã€‚åŒæ—¶ä¹Ÿç»´æŠ¤äº†æ»‘åŠ¨çª—å£ï¼Œå¦‚æœç½‘ç»œå±‚çš„ä¼ è¾“å‡ºç°äº†ä¸¢åŒ…ï¼Œç”±ä¼ è¾“å±‚æ¥è¿›è¡Œé‡ä¼ æ“ä½œï¼Œä»¥å®ç°å¯é ä¼ è¾“ã€‚</p><ul><li>é™åˆ¶æˆå¤šå°‘å¥½å‘¢ï¼Ÿ</li></ul><p>ä¸€èˆ¬å»ºè®®å°†è¯¥å¤§å°è®¾ç½®ä¸ºæ¯”ç½‘ç»œä¸­çš„æœ€å°MTUå€¼å°ä¸€äº›ï¼Œä»¥é˜²æ­¢å‡ºç°åˆ†ç‰‡</p><blockquote><p>åç»­ä¼šè¡¥ä¸Šæ›´å¤šä¿¡æ¯</p></blockquote><h3 id="2-2-4-åˆ†ç‰‡çš„é™åˆ¶"><a href="#2-2-4-åˆ†ç‰‡çš„é™åˆ¶" class="headerlink" title="2.2.4 åˆ†ç‰‡çš„é™åˆ¶"></a>2.2.4 åˆ†ç‰‡çš„é™åˆ¶</h3><p>åœ¨ä¸Šæ–‡ä¸­æåˆ°ï¼ŒMTUçš„é™åˆ¶æ˜¯æœ€å¤§1500å­—èŠ‚ï¼Œè¿™ä¸ªæ•°æ®é•¿åº¦æ˜¯åŒ…å«IPåè®®çš„æŠ¥å¤´çš„ï¼ˆæ•°æ®æ˜¯ä»IPç½‘ç»œå±‚å‘ä¸‹äº¤ä»˜ç»™æ•°æ®é“¾è·¯å±‚çš„ï¼‰</p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª<strong>ç½‘ç»œå±‚çš„3000å­—èŠ‚</strong>çš„æ•°æ®ï¼Œæ­¤æ—¶ç½‘ç»œå±‚è¦è¿›è¡Œåˆ†ç‰‡ï¼Œå¹¶ä¸æ˜¯ç®€å•çš„<code>3000/1500=2</code>å°±èƒ½æå®šäº†çš„ã€‚è€Œæ˜¯è¦è®¡ç®—ä¸ŠIPæŠ¥å¤´çš„é•¿åº¦ï¼ˆ20å­—èŠ‚ï¼‰</p><p>æ¯ä¸€ä¸ªåˆ†ç‰‡éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„IPæŠ¥æ–‡ï¼Œéƒ½ä¼šæœ‰è‡ªå·±ç‹¬ç«‹çš„IPæŠ¥å¤´ï¼å¦åˆ™ç¼ºå°‘æŠ¥å¤´ï¼Œåœ¨æ¥æ”¶ç«¯æ²¡æœ‰åŠæ³•è¿›è¡Œæ•°æ®ç»„è£…æ“ä½œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">20+1480</span><br><span class="line">20+1480</span><br><span class="line">20+20</span><br></pre></td></tr></table></figure><p>ä¸€å…±éœ€è¦åˆ†3ç‰‡ï¼Œæ‰èƒ½å°†è¿™ç½‘ç»œå±‚çš„3000å­—èŠ‚çš„æ•°æ®æˆåŠŸä¼ è¾“ï¼</p><p>ä½†æ˜¯è¿™é‡Œå°±æœ‰ä¸€ä¸ªé—®é¢˜äº†ï¼Œæ˜æ˜<code>1480+1480+20 = 2980</code>ï¼Œå¹¶ä¸æ˜¯3000å­—èŠ‚å•Šï¼Ÿ</p><p>æ³¨æ„ï¼ä¸Šé¢æåˆ°çš„æ˜¯ç½‘ç»œå±‚çš„3000å­—èŠ‚æ•°æ®ã€‚å®é™…ä¸Šï¼Œ<strong>ä¼ è¾“å±‚åªå‘ä¸‹äº¤ä»˜äº†2980å­—èŠ‚</strong>ï¼ŒåŠ ä¸ŠIPæŠ¥å¤´20å­—èŠ‚æ‰æ˜¯<strong>ç½‘ç»œå±‚çš„3000å­—èŠ‚</strong>æ•°æ®ã€‚å› ä¸ºè¦è¿›è¡Œåˆ†ç‰‡ï¼ŒåŸæœ¬è¿™3000å­—èŠ‚çš„ç»Ÿä¸€æŠ¥å¤´è‚¯å®šæ˜¯è¦ä¸¢å¼ƒçš„ï¼Œæˆ‘ä»¬éœ€è¦æ“ä½œçš„æ˜¯ä¼ è¾“å±‚å‘ä¸‹äº¤ä»˜çš„<code>2980</code>å­—èŠ‚æ•°æ®ï¼Œå°†å…¶æ­£ç¡®åˆ†ç‰‡å¹¶æ·»åŠ ä¸Šæ¯ä¸€ä¸ªåˆ†ç‰‡çš„æŠ¥å¤´ï¼Œå†äº¤ç»™æ•°æ®é“¾è·¯å±‚ã€‚</p><h2 id="2-3-TTL"><a href="#2-3-TTL" class="headerlink" title="2.3 TTL"></a>2.3 TTL</h2><p>ä¸Šæ–‡æåˆ°TTLæ˜¯ç”¨æ¥æ§åˆ¶æŠ¥æ–‡çš„ç”Ÿå‘½å‘¨æœŸçš„ï¼Œå…¶ä¸ºäº†é¿å…æŠ¥æ–‡åœ¨è·¯ç”±ä¸­å‡ºç°<strong>æ­»å¾ªç¯</strong>ã€‚</p><p>æ¯”å¦‚ä¸‹å›¾ä¸­ï¼Œå‡è®¾æœ‰ä¸€ä¸ªæŠ¥æ–‡è·¯ç”±åˆ°äº†è·¯ç”±å™¨Dï¼ŒåŸæœ¬ä»–åº”è¯¥è¢«æ­£å¸¸äº¤ä»˜ç»™ä¸»æœºCï¼Œä½†è·¯ç”±å™¨Då‡ºç°äº†ä¸€äº›é—®é¢˜ï¼Œå°†è¿™ä¸ªæŠ¥æ–‡äº¤ä»˜ç»™äº†è·¯ç”±å™¨Iï¼Œè·¯ç”±å™¨Iç»™Jï¼ŒJç»™Hï¼ŒHç»™Cï¼Œè·¯ç”±å™¨Cåˆç»™Dï¼Œè·¯ç”±å™¨Dè¿˜æ˜¯æœ‰bugï¼Œåˆè½¬å‘ç»™äº†è·¯ç”±å™¨Iã€‚</p><p>è¿™æ—¶å€™ï¼Œå°±å‡ºç°äº†ä¸€ä¸ªæŠ¥æ–‡è·¯ç”±çš„æ­»å¾ªç¯ã€‚</p><p>å¦‚æœæ²¡æœ‰TTLæ¥æ§åˆ¶ç”Ÿå‘½å‘¨æœŸï¼ŒæŠ¥æ–‡å°±ä¼šä¸€ç›´åœ¨è¿™ä¸ªæ­»å¾ªç¯ä¸­è·‘ï¼Œç™½ç™½æµªè´¹è·¯ç”±å™¨çš„æ€§èƒ½ï¼</p><p><img src="https://img.musnow.top/i/2023/07/cfb3fb1c0b8d2c1d8ae655d17a5e3fef.png" alt="image-20230726201220852"></p><p>è§„å®šäº†TTLä¹‹åï¼Œå½“æŠ¥æ–‡çš„ç”Ÿå‘½å‘¨æœŸå·²ç»åˆ°äº†ï¼Œä½†å´è¿˜æ²¡æœ‰å‘é€åˆ°ç›®çš„åœ°ï¼Œé‚£å°±éœ€è¦å°†è¿™ä¸ªæŠ¥æ–‡ä¸¢å¼ƒäº†ã€‚ï¼ˆå³è¶…äº†TTLçš„æ—¶é—´å°±è®¤ä¸ºæŠ¥æ–‡æ— æ•ˆï¼‰</p><h1 id="3-ç½‘æ®µåˆ’åˆ†"><a href="#3-ç½‘æ®µåˆ’åˆ†" class="headerlink" title="3.ç½‘æ®µåˆ’åˆ†"></a>3.ç½‘æ®µåˆ’åˆ†</h1><h2 id="3-1-IPå¦‚ä½•æ‰¾åˆ°å¯¹æ–¹ä¸»æœºï¼Ÿ"><a href="#3-1-IPå¦‚ä½•æ‰¾åˆ°å¯¹æ–¹ä¸»æœºï¼Ÿ" class="headerlink" title="3.1 IPå¦‚ä½•æ‰¾åˆ°å¯¹æ–¹ä¸»æœºï¼Ÿ"></a>3.1 IPå¦‚ä½•æ‰¾åˆ°å¯¹æ–¹ä¸»æœºï¼Ÿ</h2><p>IPå¦‚ä½•æ‰¾åˆ°å¯¹æ–¹ä¸»æœºå‘¢ï¼Ÿ</p><ul><li>IP &#x3D; ç›®çš„ç½‘ç»œ + ç›®çš„ä¸»æœº</li><li>ç”±æ­¤è¿˜è¡ç”Ÿå‡ºç½‘æ®µåˆ’åˆ†</li></ul><p>ä»¥IPV4çš„ipä¸ºä¾‹ï¼Œå…¶æ ¼å¼ä¸º<code>1.1.1.1</code>ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸‹é¢çš„åˆ’åˆ†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.1.1  .1</span><br><span class="line">ç½‘æ®µ   .ä¸»æœº</span><br></pre></td></tr></table></figure><p>è¿™å°±å¥½æ¯”ä½ çš„å­¦å·ï¼Œå‰Xä½é‡Œé¢æ˜¯å­¦é™¢çš„ä»£ç ï¼Œæœ€åæ‰æ˜¯ç­çº§+ç­çº§å†…ç¼–å·ã€‚å…ˆæ‰¾åˆ°ä½ æ‰€åœ¨å­¦é™¢ï¼Œå†æ‰¾åˆ°ç­çº§ï¼Œæœ€åå†æ‰¾åˆ°ä½ ã€‚</p><p>åé¦ˆåˆ°IPé‡Œé¢ï¼Œå°±æ˜¯å…ˆæ‰¾åˆ°ç½‘æ®µï¼Œå†æ‰¾åˆ°ä¸»æœºã€‚</p><h3 id="3-1-1-å‘é€æ•°æ®çš„æœ¬è´¨"><a href="#3-1-1-å‘é€æ•°æ®çš„æœ¬è´¨" class="headerlink" title="3.1.1 å‘é€æ•°æ®çš„æœ¬è´¨"></a>3.1.1 å‘é€æ•°æ®çš„æœ¬è´¨</h3><p>IPå°±æ˜¯å…ˆæ‰¾åˆ°ç›®çš„çš„<strong>ç½‘æ®µ</strong>ï¼Œå†æ‰¾è¿™ä¸ªç½‘æ®µä¸­çš„ç›®çš„<strong>ä¸»æœº</strong>ã€‚ï¼ˆå…ˆæ ¹æ®ç›®çš„ç½‘æ®µè¿›è¡Œè·¯ç”±ï¼Œæ‰¾åˆ°ç›®çš„ç½‘ç»œï¼Œå†é€šè¿‡ä¸»æœºå·æ‰¾åˆ°ç›®çš„ä¸»æœºï¼‰</p><p>è€ŒæŸ¥æ‰¾ç›®çš„ä¸»æœºçš„è¿‡ç¨‹ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ª<strong>æ’é™¤</strong>çš„è¿‡ç¨‹ã€‚</p><p>å…ˆé€šè¿‡ç½‘æ®µæ’é™¤ä¸€ä¸ªå¤§ç±»ï¼Œå†é€šè¿‡ä¸»æœºå·æ¥æ’é™¤è¯¥ç½‘æ®µä¸­çš„å•ä¸ªä¸»æœºã€‚è¿™æ ·å°±èƒ½é¿å…æˆ‘ä»¬<strong>ä¸€ä¸ªä¸€ä¸ªéå†</strong>åœ¨å…¨ç½‘ä¸­æŸ¥æ‰¾ä¸»æœºï¼Œ<strong>æé«˜äº†æŸ¥æ‰¾çš„æ•ˆç‡</strong></p><blockquote><p>å­ç½‘åˆ’åˆ†çš„ç›®çš„ï¼šå°±æ˜¯æé«˜æŸ¥æ‰¾ç›®æ ‡ä¸»æœºçš„æ•ˆç‡</p></blockquote><p>è¿™ä¹Ÿæ˜¯å­¦æ ¡é‡Œé¢ç”¨å­¦å·çš„åŸå› ï¼Œé™¤äº†ä¸ºäº†ç»™æ¯ä¸ªå­¦ç”Ÿæä¾›ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ï¼Œè¿˜èƒ½é€šè¿‡å­¦å·æ¥æé«˜æŸ¥æ‰¾åˆ°æŸä¸€ä¸ªå­¦ç”Ÿçš„æ•ˆç‡ã€‚</p><p>åœ¨å…¨çƒäº’è”ç½‘ä¸Šï¼ŒåŒæ ·æ˜¯é€šè¿‡IPåœ°å€çš„ç½‘æ®µæ¥åˆ’åˆ†å›½å®¶ï¼Œå†åˆ’åˆ†åˆ°æ¯ä¸ªå›½å®¶å†…éƒ¨çš„ä¸åŒåŒºã€‚è¿™æ—¶å€™å°±ä¼šæœ‰ä¸€å®šIPåœ°å€èµ„æºçš„ç«äº‰ã€‚æ¯”å¦‚ç±³å›½äº’è”ç½‘å‘å±•æ—©ï¼Œä¸‹å›¾ä¸­è°·æ­Œçš„æœåŠ¡å™¨IPå°±è€æ•´é½äº†ğŸ˜‚ï¼ˆä¸è¿‡è¿™äº›æœåŠ¡å™¨éƒ½åœ¨åŒä¸€ä¸ªåœ°åŸŸï¼ŒIPå¾ˆæ¥è¿‘æ˜¯åˆç†çš„ï¼‰</p><p><img src="https://img.musnow.top/i/2023/07/5b872ab28b7ae44e7b57d513874d395c.png" alt="image-20230726132920408"></p><h3 id="3-1-2-ç½‘ç»œå·å’Œä¸»æœºå·"><a href="#3-1-2-ç½‘ç»œå·å’Œä¸»æœºå·" class="headerlink" title="3.1.2 ç½‘ç»œå·å’Œä¸»æœºå·"></a>3.1.2 ç½‘ç»œå·å’Œä¸»æœºå·</h3><ul><li>ç½‘ç»œå·ï¼šä¿è¯ç›¸äº’è¿æ¥çš„ä¸¤ä¸ªç½‘æ®µå…·æœ‰ä¸åŒçš„æ ‡è¯†</li><li>ä¸»æœºå·ï¼šåœ¨åŒä¸€ç½‘æ®µä¸­ï¼Œä¸»æœºä¹‹é—´å…·æœ‰ç›¸åŒçš„ç½‘ç»œå·ï¼Œä½†æ˜¯ä¸»æœºå·ä¸åŒä»¥è¿›è¡ŒåŒºåˆ†</li></ul><p>å…·ä½“æ¡†æ¶å¯ä»¥æŸ¥çœ‹ä¸‹å›¾ï¼Œ<code>192.168.128</code>å°±æ˜¯è¿™ä¸ªå±€åŸŸç½‘çš„ç½‘æ®µ ï¼Œè€Œæœ€åçš„10å’Œ11æ˜¯ä¸åŒä¸»æœºçš„ä¸¤ä¸ªä¸»æœºæ ‡è¯†ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç½‘æ®µä¸­çš„<code>1</code>å·ä¸»æœºå°±æ˜¯è¿™ä¸ªç½‘æ®µä¸­çš„è·¯ç”±å™¨ã€‚</p><blockquote><p>æˆ‘ä»¬å®¶é‡Œçš„è·¯ç”±å™¨é™¤äº†è¿›è¡Œè·¯ç”±è½¬å‘ï¼Œè¿˜æœ‰å­ç½‘åˆ’åˆ†çš„åŠŸèƒ½ã€‚</p></blockquote><p>å¦‚æœå‡ºç°äº†ä¸€ä¸ªå¼€å¤´å¹¶é<code>192.168.128</code>çš„IPï¼Œä¸»æœºå°±èƒ½çŸ¥é“è¿™ä¸æ˜¯å½“å‰å±€åŸŸç½‘çš„IPï¼Œäºæ˜¯å°±ä¼šå°†æŠ¥æ–‡ç›´æ¥è½¬å‘ç»™<code>192.168.128.1</code>ï¼Œè®©è·¯ç”±å™¨å»æ‰¾è¿™ä¸ªIPçš„ç›®æ ‡ä¸»æœºï¼ˆè¿›è¡Œè·¨å±€åŸŸç½‘çš„ä¸‹ä¸€å±‚è½¬å‘ï¼‰</p><p><img src="https://img.musnow.top/i/2023/07/92a09c99e1a35e35157cd259802c2b75.jpeg" alt="img"></p><p>å°±å¥½æ¯”æˆ‘ä»¬çš„å­¦å·æ˜¯å­¦æ ¡çš„æ•™åŠ¡ç³»ç»Ÿæ´¾å‘ç»™æ¯ä¸€ä½åŒå­¦çš„ï¼ŒIPä¸­çš„ç½‘æ®µä¹Ÿè¢«â€œæŸäººâ€åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ ¹æ®åœ°åŒºè¿›è¡Œäº†åˆ’åˆ†ã€‚</p><h2 id="3-2-IPåœ°å€ç±»åˆ«åˆ’åˆ†"><a href="#3-2-IPåœ°å€ç±»åˆ«åˆ’åˆ†" class="headerlink" title="3.2 IPåœ°å€ç±»åˆ«åˆ’åˆ†"></a>3.2 IPåœ°å€ç±»åˆ«åˆ’åˆ†</h2><h3 id="3-2-1-ABCDE"><a href="#3-2-1-ABCDE" class="headerlink" title="3.2.1 ABCDE"></a>3.2.1 ABCDE</h3><p>é€šè¿‡Aåˆ°Eç±»ä¸åŒçš„åˆ’åˆ†ï¼Œä¼šè¡ç”Ÿå‡ºä¸åŒèŒƒå›´çš„IPå·ï¼Œç„¶åå†åˆ†é…ç»™ä¸åŒçš„å›½å®¶æˆ–åœ°åŒº</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Aç±» 0.0.0.0åˆ°127.255.255.255 </span><br><span class="line">Bç±» 128.0.0.0åˆ°191.255.255.255 </span><br><span class="line">Cç±» 192.0.0.0åˆ°223.255.255.255 </span><br><span class="line">Dç±» 224.0.0.0åˆ°239.255.255.255 </span><br><span class="line">Eç±» 240.0.0.0åˆ°247.255.255.255</span><br></pre></td></tr></table></figure><p><img src="https://img.musnow.top/i/2023/07/f3248796ffe4f8989ee68b52f3b2f7d7.png" alt="image-20230726110410094"></p><p>ä¾ç…§ä¸Šé¢çš„åˆ’åˆ†ï¼Œå¦‚æœæˆ‘æ˜¯ä¸€ä¸ªå¤§å‹ä¼ä¸šï¼Œç”³è¯·äº†ä¸€ä¸ªBç±»çš„IPåœ°å€ã€‚æ­¤æ—¶å°±èƒ½æ”¯æŒæˆ‘çš„å±€åŸŸç½‘å†…<code>2^16</code>å°ä¸»æœºçš„ipåˆ†é…ã€‚ä½†å®é™…ä¸Šæˆ‘é¡¶å¤šä¼šæœ‰2wä¸ªä¸»æœºï¼Œæ­¤æ—¶å°±å‡ºç°äº†IPåœ°å€çš„æµªè´¹ï¼</p><h3 id="3-2-2-CIDRå’Œå­ç½‘æ©ç "><a href="#3-2-2-CIDRå’Œå­ç½‘æ©ç " class="headerlink" title="3.2.2 CIDRå’Œå­ç½‘æ©ç "></a>3.2.2 CIDRå’Œå­ç½‘æ©ç </h3><p>ä¸ºäº†é¿å…ä¸Šæ–‡ä¸­å‡ºç°çš„IPæµªè´¹é—®é¢˜ï¼ŒCIDRï¼ˆClassless Interdomain Routingï¼‰å°±å‡ºç°äº†</p><ul><li>å¼•å…¥ä¸€ä¸ªé¢å¤–çš„å­ç½‘æ©ç (subnet mask)æ¥åŒºåˆ†ç½‘ç»œå·å’Œä¸»æœºå·ï¼›</li><li>å­ç½‘æ©ç ä¹Ÿæ˜¯ä¸€ä¸ª32ä½çš„æ­£æ•´æ•°. é€šå¸¸ç”¨ä¸€ä¸² <code>0</code> æ¥ç»“å°¾ï¼Œä¸€ä¸² <code>1</code> å¼€å¤´ï¼›</li><li>å°†IPåœ°å€å’Œå­ç½‘æ©ç è¿›è¡Œ <strong>æŒ‰ä½ä¸</strong> æ“ä½œ, å¾—åˆ°çš„ç»“æœå°±æ˜¯ç½‘ç»œå·ï¼›</li><li>ç½‘ç»œå·å’Œä¸»æœºå·çš„åˆ’åˆ†ä¸è¿™ä¸ªIPåœ°å€æ˜¯Aç±»ã€Bç±»è¿˜æ˜¯Cç±»<strong>æ— å…³</strong></li></ul><p>å¦‚æœæˆ‘ä»¬éœ€è¦æ›´å¤šä¸»æœºï¼Œå°±å¯ä»¥å°†å­ç½‘æ©ç ä¸­æœ€åä¸€ä¸ª1ç½®0ï¼Œå°±èƒ½é€‚é…æ›´å¤šå±€åŸŸç½‘ä¸»æœºã€‚</p><p>æ‰€ä»¥ï¼Œç°åœ¨å·²ç»ä¸ç”¨<code>ABCDE</code>çš„ç±»åˆ«åˆ’åˆ†æ–¹å¼äº†ï¼Œéƒ½é‡‡ç”¨äº†<strong>å­ç½‘æ©ç </strong>æ–¹å¼ã€‚</p><p><img src="https://img.musnow.top/i/2023/07/06b71c71fe5cee4bfd70781717f7f031.png" alt="image-20230726133558191"></p><p>æ ¹æ®ä¸Šå›¾å¯è§ï¼ŒIPåœ°å€ä¸å­ç½‘æ©ç åšä¸è¿ç®—å¯ä»¥å¾—åˆ°ç½‘ç»œå·ï¼Œ<strong>ä¸»æœºå·</strong>çš„äºŒè¿›åˆ¶ä½ä»å…¨0åˆ°å…¨1å°±æ˜¯å­ç½‘çš„åœ°å€èŒƒå›´ï¼› </p><p>IPåœ°å€å’Œå­ç½‘æ©ç è¿˜æœ‰ä¸€ç§æ›´ç®€æ´çš„è¡¨ç¤ºæ–¹æ³•ï¼šä¾‹å¦‚<code>140.252.20.68/24</code>,è¡¨ç¤ºIPåœ°å€ä¸º<code>140.252.20.68</code>, å­ç½‘æ©ç çš„<strong>é«˜24ä½æ˜¯1</strong>ï¼Œä¹Ÿå°±æ˜¯å­ç½‘æ©ç <code>255.255.255.0</code></p><h2 id="3-3-åŸºç¡€è®¾æ–½"><a href="#3-3-åŸºç¡€è®¾æ–½" class="headerlink" title="3.3 åŸºç¡€è®¾æ–½"></a>3.3 åŸºç¡€è®¾æ–½</h2><p>æœ‰äº†ç½‘æ®µåˆ’åˆ†ï¼Œç»™ä¸åŒå›½å®¶å’Œåœ°åŒºåˆ’åˆ†äº†IPä¹‹åï¼Œå°±éœ€è¦æœ‰äººæ¥å»ºè®¾ç½‘ç»œçš„<code>åŸºç¡€è®¾æ–½</code></p><p>åœ¨æˆ‘ä»¬å›½å®¶ï¼ŒæåŸºç¡€è®¾æ–½å°±æ˜¯ä¸‰å¤§è¿è¥å•†ï¼ˆç§»åŠ¨ ç”µä¿¡ è”é€šï¼‰</p><p>æ¯”å¦‚å‡ å¹´å‰åšçš„â€œå…‰çº¤å…¥æˆ·â€å°±æ˜¯åŸºç¡€è®¾æ–½å»ºè®¾çš„ä¸€éƒ¨åˆ†ã€‚</p><p>åŸºç¡€è®¾æ–½æ­å»ºå¥½äº†åï¼Œå†é€šè¿‡å­ç½‘æ©ç å’Œå·²ç»è·å–åˆ°çš„IPçš„ç½‘æ®µæ¥åˆ’åˆ†ä¸åŒçœä»½ã€ä¸åŒå¸‚åŒºï¼›æœ€ç»ˆå†è½åˆ°æ¯ä¸ªå…¥ç½‘ç”¨æˆ·çš„å¤´ä¸Šã€‚</p><h2 id="3-4-ç¼“è§£IPåœ°å€ä¸å¤Ÿç”¨çš„åŠæ³•"><a href="#3-4-ç¼“è§£IPåœ°å€ä¸å¤Ÿç”¨çš„åŠæ³•" class="headerlink" title="3.4 ç¼“è§£IPåœ°å€ä¸å¤Ÿç”¨çš„åŠæ³•"></a>3.4 ç¼“è§£IPåœ°å€ä¸å¤Ÿç”¨çš„åŠæ³•</h2><p>æœ‰äººè‚¯å®šä¼šé—®äº†ï¼Œç°åœ¨å…¬ç½‘IPV4çš„èµ„æºé‚£ä¹ˆåŒ®ä¹ï¼Œå¤§éƒ¨åˆ†å®¶å®½éƒ½æ˜¯æ²¡æœ‰å…¬ç½‘ipçš„ï¼Œé‚£æˆ‘ä»¬å¹³æ—¶çš„ä¸Šç½‘æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</p><p>æ¢å¥è¯è¯´ï¼Œå¦‚ä½•ç¼“è§£IPåœ°å€çš„åŒ®ä¹ï¼Ÿ</p><ul><li>å¯ä»¥ä½¿ç”¨<code>åŠ¨æ€IPåˆ†é…</code>æŠ€æœ¯ï¼Œåªç»™ç›´æ¥æ¥å…¥å…¬ç½‘çš„è®¾å¤‡åˆ†é…IPåœ°å€ï¼Œæ¯ä¸€ä¸ªè®¾å¤‡æ¥å…¥ç½‘ç»œæ—¶ï¼Œå…¶è·å–åˆ°çš„IPåœ°å€ä¸ä¸€å®šå’Œä¸Šæ¬¡ç›¸åŒã€‚</li><li>NATæŠ€æœ¯ï¼ˆé‡ç‚¹ï¼‰</li><li>IPV6ï¼ˆä½†æ˜¯ç°åœ¨æ™®åŠç‡æœ‰å¾…æé«˜ï¼‰</li></ul><p>IPV6ä½¿ç”¨16å­—èŠ‚ï¼ˆ128ä½ï¼‰æ¥æ ‡è¯†ä¸€ä¸ªIPåœ°å€ï¼Œç›®å‰çœ‹æ¥ï¼Œ<code>2^128</code> ä½èƒ½ç»™â€œåœ°çƒä¸Šæ¯ä¸€ç²’æ²™å­â€éƒ½åˆ†é…ä¸€ä¸ªIPåœ°å€äº†ã€‚è™½ç„¶è¿Ÿæ—©ä¹Ÿä¼šæœ‰ä¸å¤Ÿç”¨çš„é‚£ä¸€å¤©ï¼Œä½†è‡³å°‘æ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„è§£å†³æ–¹æ¡ˆã€‚æˆ‘ä»¬å›½å®¶å°±åœ¨å¤§åŠ›æ¨å¹¿IPV6</p><p>é€šè¿‡å‰æ–‡çš„æŠ¥æ–‡ç»“æ„å›¾å¯çŸ¥ï¼ŒIPV4çš„IPåœ°å€åªæœ‰4å­—èŠ‚ï¼ˆ32ä½ï¼‰</p><hr><h1 id="4-ç§æœ‰IP"><a href="#4-ç§æœ‰IP" class="headerlink" title="4.ç§æœ‰IP"></a>4.ç§æœ‰IP</h1><h2 id="4-1-ç‰¹æ®Šçš„IPåœ°å€"><a href="#4-1-ç‰¹æ®Šçš„IPåœ°å€" class="headerlink" title="4.1 ç‰¹æ®Šçš„IPåœ°å€"></a>4.1 ç‰¹æ®Šçš„IPåœ°å€</h2><p>ä½†æ˜¯ï¼Œç›´æ¥é‡‡ç”¨CIDRçš„æ–¹å¼ä½œä¸ºå±€åŸŸç½‘æ§åˆ¶çš„æ–¹å¼ï¼Œå°±å®¹æ˜“å‡ºç°æ··ä¹±ã€‚è€Œä¸”å³ä¾¿æ˜¯é‡‡ç”¨äº†å­ç½‘æ©ç çš„æ–¹å¼ï¼Œä¾æ—§å¯èƒ½å‡ºç°IPä¸å¤Ÿç”¨çš„æƒ…å†µï¼ˆä¸€ä½ç½‘æ°‘å¾ˆå¯èƒ½æœ‰å¤šä¸ªè®¾å¤‡ï¼Œ å†åŠ ä¸Šå„ç±»æ™ºèƒ½ç»ˆç«¯ï¼Œç°åœ¨éœ€è¦ä¸Šç½‘çš„è®¾å¤‡åªä¼šè¶Šæ¥è¶Šå¤šï¼‰</p><p>éœ€è¦æ³¨æ„çš„æ˜¯CIDRåªèƒ½æé«˜IPåœ°å€çš„åˆ©ç”¨ç‡ï¼Œå¹¶ä¸èƒ½æé«˜IPåœ°å€çš„ä¸Šé™ã€‚</p><p>æ‰€ä»¥ï¼Œå°±è¡ç”Ÿå‡ºäº†éƒ¨åˆ†ç‰¹æ®Šçš„IPåœ°å€ã€‚è¿™äº›IPåœ°å€è¢«è§„å®š<strong>åªèƒ½ç”¨äºå±€åŸŸç½‘</strong>ï¼Œç”±æ­¤æ¥å‡å°‘å¯¹å…¬ç½‘IPçš„åœ°å€æ¶ˆè€—ã€‚</p><ul><li>å°†IPåœ°å€ä¸­çš„ä¸»æœºåœ°å€å…¨è®¾ä¸º0ï¼Œå°±æ˜¯è¯¥åœ°å€çš„ç½‘ç»œå·ï¼Œä»£è¡¨å½“å‰å±€åŸŸç½‘</li><li>å°†IPåœ°å€ä¸­çš„ä¸»æœºåœ°å€å…¨è®¾ä¸º1ï¼Œå°±æ˜¯å¹¿æ’­åœ°å€ï¼Œç”¨äºç»™åŒä¸€ä¸ªé“¾è·¯ä¸­ç›¸äº’è¿æ¥çš„æ‰€æœ‰ä¸»æœºå‘é€æ•°æ®åŒ…ã€‚</li><li><code>127.*</code>çš„IPåœ°å€ç”¨äº<strong>æœ¬æœºå›ç¯</strong>ã€‚æˆ‘ä»¬é€šå¸¸ä½¿ç”¨<code>127.0.0.1</code>æ¥è¿›è¡Œæœ¬åœ°æœåŠ¡çš„è®¿é—®å’Œæµ‹è¯•ï¼Œè¯¥IPåœ°å€æ˜¯IPv4å›ç¯åœ°å€çš„æ ‡å‡†è§„å®šï¼ŒIPv6çš„å›ç¯åœ°å€ä¸º<code>::1</code>ã€‚</li></ul><p>æˆ‘ä»¬åœ¨è®¡ç®—ä¸€ä¸ªå±€åŸŸç½‘ä¸­æœ‰å¤šå°‘è®¾å¤‡çš„æ—¶å€™ï¼Œéœ€è¦å‡æ‰ä¸Šæ–‡æåˆ°çš„ç½‘ç»œå·å’Œå¹¿æ’­åœ°å€ã€‚</p><hr><p>ä»¥ä¸‹æ˜¯ç‰¹æ®Šçš„åªèƒ½ç”¨äºå±€åŸŸç½‘çš„ç§æœ‰IPåœ°å€ï¼ŒåŒ…å«åœ¨è¿™ä¸ªèŒƒå›´ä¸­çš„ï¼Œ éƒ½ç§°ä¸ºç§æœ‰IPï¼Œ å…¶ä½™çš„åˆ™ç§°ä¸ºå…¨å±€IP (æˆ–å…¬ç½‘IP)</p><ul><li><code>10.*</code>, å‰8ä½æ˜¯ç½‘ç»œå·ï¼Œå…±<code>16,777,216</code>ä¸ªåœ°å€ </li><li><code>172.16.</code>åˆ°<code>172.31.</code>ï¼Œå‰12ä½æ˜¯ç½‘ç»œå·ï¼Œå…±<code>1,048,576</code>ä¸ªåœ°å€ </li><li><code>192.168.*</code>ï¼Œå‰16ä½æ˜¯ç½‘ç»œå·ï¼Œå…±<code>65,536</code>ä¸ªåœ°å€</li></ul><p>è¿™é‡Œè¦è®°ä½2çš„16æ¬¡æ–¹ä¸º<code>65536</code>ï¼Œåœ¨ç½‘ç»œçš„çŸ¥è¯†ç‚¹é‡Œé¢ç»å¸¸ä¼šæ¥è§¦åˆ°è¿™ä¸ªæ•°å­—ã€‚</p><h2 id="4-2-loopbackç¯å›"><a href="#4-2-loopbackç¯å›" class="headerlink" title="4.2 loopbackç¯å›"></a>4.2 loopbackç¯å›</h2><p>ä¸Šæ–‡æåˆ°äº†<code>127.*</code>æ˜¯ç”¨äºæœ¬åœ°ç¯å›çš„ã€‚ä¸‹å›¾æ˜¯ç¯å›é©±åŠ¨ç¨‹åºé’ˆå¯¹IPåœ°å€çš„åˆ¤æ–­</p><p><img src="https://img.musnow.top/i/2023/07/94236a76f61d44ff8b9d1b6b0150aa79.jpeg" alt="img"></p><p>åœ¨äº‘æœåŠ¡å™¨ä¸Šæ‰§è¡Œ<code>ifconfig</code>ï¼Œä¹Ÿèƒ½çœ‹åˆ°æœ¬åœ°ç¯å›çš„é…ç½®é¡¹ï¼›è¿™é‡Œæˆ‘ä»¬èƒ½å‘ç°ï¼Œæœ¬åœ°ç¯å›çš„MTUæ˜¯è¿œé«˜äºç½‘ç»œçš„1500ã€‚æ¯•ç«Ÿæ˜¯è‡ªå·±å’Œè‡ªå·±é€šä¿¡ï¼ŒåŸºæœ¬ä¸ä¼šå‡ºç°ä¸¢åŒ…ï¼Œä¼ è¾“é€Ÿåº¦ä¹Ÿæ˜¯é£å¿«ï¼Œä¹Ÿå°±ä¸ç”¨æ‹…å¿ƒæ•°æ®åŒ…å¤ªå¤§çš„é—®é¢˜</p><p>åŒæ—¶ä¹Ÿèƒ½å‘ç°ï¼Œæˆ‘ä»¬çš„äº‘æœåŠ¡å™¨è¢«åˆ†é…åˆ°çš„ipåœ°å€å¹¶ä¸æ˜¯äº‘æœåŠ¡å™¨çš„å…¬ç½‘ipï¼Œè¿™ä¹Ÿå°±è¡¨æ˜äº†æˆ‘ä»¬çš„äº‘æœåŠ¡å™¨å¹¶æ²¡æœ‰è¢«ç›´æ¥æš´éœ²åœ¨å…¬ç½‘ä¸Šï¼Œè€Œæ˜¯é€šè¿‡äº†äº‘æœåŠ¡å™¨å‚å®¶çš„å…¥ç½‘æœåŠ¡å™¨ï¼ˆæˆ–è€…ä¹Ÿå«è·¯ç”±å™¨ï¼‰æ¥è¿›è¡Œå…¬ç½‘ipçš„æ˜ å°„å’Œæ•°æ®åŒ…çš„è½¬å‘æ“ä½œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 10.0.12.2  netmask 255.255.252.0  broadcast 10.0.15.255</span><br><span class="line">        inet6 fe80::5054:ff:fec9:274f  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 52:54:00:c9:27:4f  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 277674393  bytes 80031748700 (74.5 GiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 302405663  bytes 162670581730 (151.4 GiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 111135687  bytes 27644436547 (25.7 GiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 111135687  bytes 27644436547 (25.7 GiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure><h3 id="4-2-1-ç¯å›"><a href="#4-2-1-ç¯å›" class="headerlink" title="4.2.1 ç¯å›"></a>4.2.1 ç¯å›</h3><p>ä¸Šå›¾ä¸­çš„ç¯å›é©±åŠ¨ç¨‹åºä¼šç›´æ¥å’ŒIPåè®®çš„æ¥æ”¶ç«¯ï¼ˆå³IPè¾“å…¥å‡½æ•°ï¼‰ç›¸è¿ï¼Œå½“æ£€æµ‹åˆ° <code>127.0.0.1</code> çš„IPè®¿é—®è¯·æ±‚çš„æ—¶å€™ï¼Œä¼šç›´æ¥æŠŠè¿™ä¸ªæŠ¥æ–‡è½¬å‘ç»™IPè¾“å…¥å‡½æ•°ï¼Œè€Œä¸å°†å…¶æ’å…¥åˆ°ä»¥å¤ªç½‘ä¸­ã€‚</p><p>å°±ç›¸å½“äºä½ çŸ¥é“ <code>127.0.0.1</code> è¿™ä¸ªIPåœ°å€ä»£è¡¨çš„å°±æ˜¯ä½ è‡ªå·±ï¼Œä½ æƒ³è®¿é—®è‡ªå·±ç”µè„‘ä¸Š8080ç«¯å£çš„ç¨‹åºï¼Œå³ä¾¿ä¹ˆæœ‰æ¥å…¥äº’è”ç½‘çš„çŠ¶å†µä¸‹ä¹Ÿæ˜¯èƒ½æ­£å¸¸è®¿é—®çš„ï¼</p><p>Loopbackç¯å›æ¥å£å¯¹äº<strong>æµ‹è¯•å’Œè¯Šæ–­æœ¬åœ°ä¸»æœºä¸Šçš„ç½‘ç»œæœåŠ¡å’Œåº”ç”¨ç¨‹åº</strong>éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥æ¨¡æ‹Ÿç½‘ç»œé€šä¿¡è€Œä¸æ¶‰åŠå®é™…çš„ç½‘ç»œä¼ è¾“ã€‚</p><h3 id="4-2-2-ARP"><a href="#4-2-2-ARP" class="headerlink" title="4.2.2 ARP"></a>4.2.2 ARP</h3><p>ARPæ˜¯ä¸€ä¸ªåœ¨å±€åŸŸç½‘æ•°æ®é“¾è·¯å±‚é€šè¿‡IPè·å–åˆ°å±€åŸŸç½‘ä¸»æœºMACåœ°å€çš„åè®®ï¼Œå…·ä½“è¯·å‚è€ƒåæ–‡ä¸­çš„è§£æ</p><hr><h2 id="4-3-è®¿é—®å¹¿åŸŸç½‘çš„æ­¥éª¤"><a href="#4-3-è®¿é—®å¹¿åŸŸç½‘çš„æ­¥éª¤" class="headerlink" title="4.3 è®¿é—®å¹¿åŸŸç½‘çš„æ­¥éª¤"></a>4.3 è®¿é—®å¹¿åŸŸç½‘çš„æ­¥éª¤</h2><h3 id="4-3-1-è¯´æ˜"><a href="#4-3-1-è¯´æ˜" class="headerlink" title="4.3.1 è¯´æ˜"></a>4.3.1 è¯´æ˜</h3><p>ä¸‹å›¾ä¸­èƒ½çœ‹åˆ°æˆ‘ä»¬å®¶ç”¨ä¸»æœºæ˜¯æ€ä¹ˆæ¥è¿›è¡Œå¹¿åŸŸç½‘çš„è®¿é—®çš„åŸºæœ¬æµç¨‹ï¼›</p><p>æˆ‘ä»¬å®¶é‡Œçš„è·¯ç”±å™¨é™¤äº†è¿›è¡Œè·¯ç”±è½¬å‘ï¼Œè¿˜æœ‰å­ç½‘åˆ’åˆ†çš„åŠŸèƒ½ã€‚å¯ä»¥çœ‹åˆ°å·¦ä¸‹è§’è™½ç„¶æ˜¯ä¸¤ä¸ªä¸åŒçš„å®¶åº­ï¼Œä½†å…¶å¯ä»¥åˆ†é…å‡ºå®Œå…¨ä¸€æ ·çš„å±€åŸŸç½‘çš„å­ç½‘ip <code>192.168.1.1</code>ï¼Œå’Œä¸åŒçš„WANå£IPï¼ˆWANå£å°±æ˜¯è·¯ç”±å™¨è¿æ¥äº’è”ç½‘çš„å£ï¼‰</p><p>è¿™æ˜¯å› ä¸ºæˆ‘ä»¬çš„è®¾å¤‡æ˜¯ç›´æ¥å’Œ<strong>å½“å‰è·¯ç”±å™¨</strong>ç›¸è¿çš„ï¼Œè®¿é—®çš„æ—¶å€™ä¹Ÿåªèƒ½é€šè¿‡<strong>å½“å‰è·¯ç”±å™¨</strong>æ¥è¿›è¡Œå±€åŸŸç½‘IPçš„è½¬å‘ã€‚ä¸å¯èƒ½ä¼šå‡ºç°æˆ‘è®¿é—®ä¸€ä¸ªå±€åŸŸç½‘IPï¼Œå´è·‘åˆ°äº†åˆ«äººå®¶é‡Œçš„è®¾å¤‡ä¸Šçš„æƒ…å†µã€‚å› ä¸ºè¿™ä¸ªå±€åŸŸç½‘IPè®¿é—®çš„æŠ¥æ–‡å¹¶ä¸ä¼šè¢«è½¬å‘åˆ°ä¸Šå±‚è·¯ç”±å™¨ä¸Šï¼Œä¹Ÿå°±ä¸å¯èƒ½å‡­ç©ºé£åˆ°å…¶ä»–å±€åŸŸç½‘ä¸­</p><p><img src="https://img.musnow.top/i/2023/07/1a3192c168e559aee56371f85945c32b.png" alt="image-20230726185645407"></p><p>å›¾ä¸­çš„ <code>122.77.241.3</code> å°±æ˜¯ä¸€ä¸ªå…¬ç½‘IPçš„æœåŠ¡å™¨ï¼Œå½“æˆ‘ä»¬éœ€è¦è®¿é—®è¿™ä¸ªä¸»æœºçš„æ—¶å€™ï¼Œå±€åŸŸç½‘çš„å®¶ç”¨è·¯ç”±å™¨åœ¨æ£€æµ‹åˆ°è¿™ä¸ªç›®çš„IPçš„æ—¶å€™ï¼Œå‘ç°å…¶å¹¶ä¸æ˜¯å±€åŸŸç½‘çš„IPåœ°å€ï¼Œäºæ˜¯å°±ä¼šå°†è¿™ä¸ªæŠ¥æ–‡ç»™è½¬å‘ç»™ä¸Šå±‚çš„è¿è¥å•†è·¯ç”±å™¨ã€‚</p><p>è¿è¥å•†è·¯ç”±å™¨æ˜¯ç›´æ¥æ¥å…¥äº†å…¬ç½‘IPçš„ï¼Œå…¶å°±èƒ½é€šè¿‡<code>ç½‘æ®µåˆ’åˆ†+ä¸»æœºç¼–å·</code>æ¥æŸ¥æ‰¾ç›®æ ‡ä¸»æœºï¼Œå°†æŠ¥æ–‡è½¬å‘ç»™ <code>122.77.241.3</code>  æœåŠ¡å™¨ï¼Œå†å°†æœåŠ¡å™¨è¿”å›çš„ä¿¡æ¯è½¬å‘ç»™ä½ çš„å®¶ç”¨è·¯ç”±å™¨ï¼Œå†è½¬å‘åˆ°ä½ çš„ä¸»æœºä¸Šã€‚</p><p>è¿™ä¹Ÿå‘Šè¯‰æˆ‘ä»¬ï¼Œæƒ³ç»•è¿‡è¿è¥å•†ç›´æ¥è·å¾—å…¬ç½‘IPæ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºä»<strong>ç‰©ç†å±‚é¢ä¸Š</strong>ï¼Œæˆ‘ä»¬çš„å®¶ç”¨è·¯ç”±å™¨å°±ä¸æ˜¯æ¥åœ¨å…¬ç½‘IPä¸Šçš„ï¼å³ä¾¿æ˜¯å¯ä»¥ç”³è¯·åˆ°çš„å®¶ç”¨å…¬ç½‘IPï¼Œä¹Ÿå’Œäº‘æœåŠ¡å™¨çš„å…¥ç½‘æœåŠ¡å™¨ä¸€æ ·ï¼Œæ˜¯è¿è¥å•†çš„è·¯ç”±å™¨åˆ†é…ç»™ä½ çš„ã€‚</p><blockquote><p>ä½ ä¼šå‘ç°ï¼Œå®¶ç”¨ç”³è¯·çš„å…¬ç½‘ipï¼Œå¾ˆå¤šç«¯å£éƒ½æ˜¯è¢«å±è”½çš„ï¼ˆæ¯”å¦‚ <code>80/443/8080</code>ï¼‰è¿™äº›ç«¯å£çš„å±è”½æ“ä½œï¼Œä»¥åŠæµ·å¤–ç½‘ç«™çš„ã€Œå¢™ã€ä¹Ÿæ˜¯è¿è¥å•†çš„è·¯ç”±å™¨è¿›è¡Œæ£€æµ‹å’Œå±è”½çš„ï¼</p></blockquote><h3 id="4-3-2-å†…ç½‘è®¿é—®å…¬ç½‘çš„æµç¨‹"><a href="#4-3-2-å†…ç½‘è®¿é—®å…¬ç½‘çš„æµç¨‹" class="headerlink" title="4.3.2 å†…ç½‘è®¿é—®å…¬ç½‘çš„æµç¨‹"></a>4.3.2 å†…ç½‘è®¿é—®å…¬ç½‘çš„æµç¨‹</h3><p>å‡è®¾æˆ‘ä»¬çš„æ¨¡å‹å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å¹¿åŸŸç½‘</span><br><span class="line">  â†“</span><br><span class="line">è¿è¥å•†è·¯ç”±å™¨C ï¼ˆå…¬ç½‘IPæ˜¯122.77.241.4ï¼‰</span><br><span class="line">  â†“</span><br><span class="line">å®¶ç”¨è·¯ç”±å™¨B ï¼ˆè¿è¥å•†è·¯ç”±å™¨åˆ†é…ç§æœ‰IP 10.1.1.2ï¼‰</span><br><span class="line">  â†“</span><br><span class="line">å®¶ç”¨ä¸»æœºA ï¼ˆå®¶ç”¨è·¯ç”±å™¨åˆ†é…ç§æœ‰IP 192.168.1.201ï¼‰</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®¶ç”¨ä¸»æœºAï¼Œè®¿é—®å…¬ç½‘IPçš„ä¸»æœº <code>122.77.241.10</code> çš„å…·ä½“æ­¥éª¤ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">æœ¬åœ°ä¸»æœºAå‘é€IPæŠ¥æ–‡ç»™å®¶åº­è·¯ç”±å™¨B</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">| æºIPï¼š192.168.1.201   |</span><br><span class="line">| ç›®çš„IPï¼š122.77.241.10 |</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line"></span><br><span class="line">è·¯ç”±å™¨Bæ”¶åˆ°æŠ¥æ–‡åï¼Œæ£€æµ‹ç›®çš„IPï¼Œå‘ç°å¹¶ä¸ä¼¼å±€åŸŸç½‘çš„IP</span><br><span class="line">äºæ˜¯äº¤ä»˜ç»™ä¸Šå±‚çš„è¿è¥å•†è·¯ç”±å™¨Cï¼›</span><br><span class="line">æŠ¥æ–‡çš„æºIPè¢«ä¿®æ”¹ä¸ºå®¶ç”¨è·¯ç”±å™¨Bçš„wanå£IP</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">| æºIPï¼š10.1.1.2        |</span><br><span class="line">| ç›®çš„IPï¼š122.77.241.10 |</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line"></span><br><span class="line">è¿è¥å•†è·¯ç”±å™¨Cæ”¶åˆ°æŠ¥æ–‡åï¼Œå‘ç°å…¶ä¹Ÿä¸æ˜¯è‡ªå·±æ‰€åœ¨å†…ç½‘ 10.1.1.* çš„å±€åŸŸç½‘IP</span><br><span class="line">äºæ˜¯å¼€å§‹æ‰§è¡Œå¹¿åŸŸç½‘IPå¯»å€æ“ä½œï¼Œæ‰¾åˆ°ç›®æ ‡å…¬ç½‘IPçš„ä¸»æœºï¼Œå†å°†æŠ¥æ–‡å‘é€ç»™è¯¥ä¸»æœºï¼›</span><br><span class="line">æ­¤æ—¶å‘é€çš„æŠ¥æ–‡åˆè¢«æ”¹æˆäº†</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">| æºIPï¼š122.77.241.4    |</span><br><span class="line">| ç›®çš„IPï¼š122.77.241.10 |</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br></pre></td></tr></table></figure><h3 id="4-3-3-NATæŠ€æœ¯"><a href="#4-3-3-NATæŠ€æœ¯" class="headerlink" title="4.3.3 NATæŠ€æœ¯"></a>4.3.3 NATæŠ€æœ¯</h3><p>è¿™ç§ä¸æ–­æ›¿æ¢æºIPæ¥è¿›è¡Œè·¯ç”±è½¬å‘çš„è¿‡ç¨‹ï¼Œå°±æ˜¯<strong>NATæŠ€æœ¯</strong>ï¼</p><p>ä¹Ÿæ­£æ˜¯NATæŠ€æœ¯çš„å­˜åœ¨ï¼Œè®©æˆ‘ä»¬èƒ½é€šè¿‡å¤šçº§å±€åŸŸç½‘æ¥è®©æ›´å¤šçš„è®¾å¤‡ä¸Šç½‘ï¼Œå¤§å¤§ç¼“è§£äº†å…¬ç½‘IPçš„ä¸è¶³ã€‚</p><p>ä¹Ÿæ­£æ˜¯å› ä¸ºIPV4åœ°å€ä¸è¶³çš„é—®é¢˜è¢«å¤§å¤§ç¼“è§£ï¼Œæ¨å¹¿IPV6å°±æ²¡æœ‰æˆ‘ä»¬æƒ³è±¡ä¸­çš„é‚£ä¹ˆé¡ºåˆ©äº†ã€‚æ¯•ç«ŸIPV6çš„IPæ ¼å¼å’ŒV4å®Œå…¨ä¸åŒï¼Œéœ€è¦æ¯ä¸ªå±‚çº§çš„è·¯ç”±å™¨éƒ½è¿›è¡ŒåŠŸèƒ½å‡çº§ï¼Œè¿™å¯æ˜¯ä¸€ä¸ªå·¨å¤§çš„å·¥ç¨‹ï¼</p><p><img src="https://img.musnow.top/i/2023/08/18a4c496be6f375256a5563b7ff537a2.png" alt="image-20230822092804992"></p><h3 id="4-3-4-NATæ€ä¹ˆå›æ¥ï¼ŸNAPT"><a href="#4-3-4-NATæ€ä¹ˆå›æ¥ï¼ŸNAPT" class="headerlink" title="4.3.4 NATæ€ä¹ˆå›æ¥ï¼ŸNAPT"></a>4.3.4 NATæ€ä¹ˆå›æ¥ï¼ŸNAPT</h3><p>å½“ç›®æ ‡ä¸»æœºæ”¶åˆ°è¿™ä¸ªæŠ¥æ–‡åï¼Œä»–çš„åé¦ˆæŠ¥æ–‡å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">| æºIPï¼š122.77.241.10   |</span><br><span class="line">| ç›®çš„IPï¼š122.77.241.4  |</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br></pre></td></tr></table></figure><p>åŒæ ·æ˜¯å…ˆåˆ°è¾¾è¿è¥å•†è·¯ç”±å™¨ï¼Œè¿è¥å•†è·¯ç”±å™¨éœ€è¦ç¼“å­˜æ¯ä¸€ä¸ªè½¬å‘åˆ°å…¬ç½‘çš„æŠ¥æ–‡çš„æ¥æºä¿¡æ¯ï¼›ä¸ºæ­¤è·¯ç”±å™¨ä¼šç»´æŠ¤ä¸€ä¸ª<strong>è½¬æ¢è¡¨</strong>ï¼Œè®°å½•ç€å±€åŸŸç½‘ä¸»æœºçš„<code>ç§æœ‰IPåœ°å€:ç«¯å£å·</code>ä¸å¯¹åº”çš„<code>å…¬ç½‘IPåœ°å€:NATç«¯å£å·</code>çš„æ˜ å°„å…³ç³»ã€‚</p><p>æ¯”å¦‚æ­¤æ¬¡TCPé“¾æ¥ä¸­ï¼Œæˆ‘å°†è·¯ç”±å™¨å…¬ç½‘IPçš„<code>122.77.241.4:30000</code>æ˜ å°„ç»™äº†å±€åŸŸç½‘<code>10.1.1.2:40000</code>ï¼›å½“ä»å…¬ç½‘æ”¶åˆ°æœåŠ¡å™¨çš„å“åº”æŠ¥æ–‡åï¼Œä»<strong>è½¬æ¢è¡¨</strong>é‡Œé¢å°±èƒ½å¤ŸæŸ¥åˆ°è¿™ä¸ªæ˜ å°„ï¼ˆä¸€æ¬¡é€šä¿¡ä¸­è¿™ä¸ªNATæ˜ å°„æ˜¯ä¸ä¼šå˜çš„ï¼‰ä»è€Œç¡®å®šè¯¥æŠ¥æ–‡çš„å±€åŸŸç½‘æµå‘ã€‚</p><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒNATæŠ€æœ¯åœ¨ç«¯å£æ˜ å°„çš„æ—¶å€™ä¸ä¸€å®šä¼šæ˜ å°„åˆ°å’Œå†…ç½‘ä¸»æœºç›¸åŒçš„ç«¯å£ï¼Œæ­¤æ—¶ä¸ä»…éœ€è¦ä¿®æ”¹IPæŠ¥æ–‡ä¸­çš„æ¥æºIPï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥ä¿®æ”¹ä¼ è¾“å±‚ï¼ˆæ¯”å¦‚TCPå’ŒUDPï¼‰ä¸­çš„æºç«¯å£å·</p></blockquote><p>ç¡®å®šå±€åŸŸç½‘IPåï¼Œå°±ä¿®æ”¹å½“å‰æŠ¥æ–‡çš„ç›®çš„IPï¼Œç»§ç»­å¾€å±€åŸŸç½‘è½¬å‘ï¼›åé¢çš„å­è·¯ç”±å™¨ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä¸å†èµ˜è¿°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">| æºIPï¼š122.77.241.10   |</span><br><span class="line">| ç›®çš„IPï¼š10.1.1.2      |</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br></pre></td></tr></table></figure><p>è¿™ç§<code>IP:ç«¯å£</code>çš„å…³è”å…³ç³»è¡¨ï¼Œå°±æ˜¯ç”±æ”¯æŒNATæŠ€æœ¯çš„è·¯ç”±å™¨æ¥ç»´æŠ¤çš„ï¼Œè¿™ä¸ªè½¬æ¢è¡¨è¢«ç§°ä¸º<strong>NAPT</strong>ï¼›å½“è¿™æ¬¡é“¾æ¥ç»“æŸåï¼Œè¿™å¯¹æ˜ å°„å…³ç³»å°±ä¼šä»è½¬æ¢è¡¨ä¸­è¢«åˆ é™¤ã€‚</p><p><img src="https://img.musnow.top/i/2023/08/b1d4032e4d2cfd4fad023cbd0ad0f6d8.png" alt="image-20230822093121691"></p><h3 id="4-3-5-NATå’Œä»£ç†æœåŠ¡å™¨"><a href="#4-3-5-NATå’Œä»£ç†æœåŠ¡å™¨" class="headerlink" title="4.3.5 NATå’Œä»£ç†æœåŠ¡å™¨"></a>4.3.5 NATå’Œä»£ç†æœåŠ¡å™¨</h3><p>ä»£ç†æœåŠ¡å™¨çœ‹ä¸Šå»å’ŒNATè®¾å¤‡æœ‰ä¸€å®šç±»ä¼¼ï¼Œå®¢æˆ·ç«¯å‘ä»£ç†æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œä»£ç†æœåŠ¡å™¨å°†è¯·æ±‚è½¬å‘ç»™çœŸæ­£éœ€è¦è¯·æ±‚çš„æœåŠ¡å™¨ï¼›æœåŠ¡å™¨è¿”å›ç»“æœåï¼Œä»£ç†æœåŠ¡å™¨æŠŠç»“æœä¼ å›å®¢æˆ·ç«¯ã€‚</p><h4 id="4-3-5-1-NATå’Œä»£ç†æœåŠ¡å™¨çš„åŒºåˆ«ï¼Ÿ"><a href="#4-3-5-1-NATå’Œä»£ç†æœåŠ¡å™¨çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="4.3.5.1 NATå’Œä»£ç†æœåŠ¡å™¨çš„åŒºåˆ«ï¼Ÿ"></a>4.3.5.1 NATå’Œä»£ç†æœåŠ¡å™¨çš„åŒºåˆ«ï¼Ÿ</h4><ul><li>ä»åº”ç”¨æ¥è¯´ï¼ŒNATæ˜¯å±äºç½‘ç»œåŸºç¡€è®¾ç½®ï¼Œè§£å†³çš„æ˜¯å…¬ç½‘IPä¸è¶³çš„é—®é¢˜ï¼›ä»£ç†æœåŠ¡å™¨æ›´è´´è¿‘å…·ä½“åº”ç”¨ï¼Œæ¯”å¦‚é€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œâ€œç¿»å¢™â€å’Œæ¸¸æˆåŠ é€Ÿï¼›</li><li>ä»åº•å±‚æ¥è®²ï¼ŒNATåœ¨ç½‘ç»œå±‚å·¥ä½œï¼Œå¯¹IPåœ°å€è¿›è¡Œæ›¿æ¢ï¼›ä»£ç†æœåŠ¡å™¨æ˜¯åœ¨åº”ç”¨å±‚å·¥ä½œï¼›</li><li>ä»ä½¿ç”¨èŒƒå›´æ¥è®²ï¼ŒNATä¸€èˆ¬éƒ¨ç½²åœ¨å±€åŸŸç½‘å‡ºå£ï¼Œä»£ç†æœåŠ¡å™¨æ—¢å¯ä»¥åœ¨å±€åŸŸç½‘åˆå¯ä»¥åœ¨å¹¿åŸŸç½‘éƒ¨ç½²</li><li>ä»éƒ¨ç½²ä½ç½®æ¥çœ‹ï¼ŒNATé›†æˆåœ¨è·¯ç”±å™¨æˆ–è€…é˜²ç«å¢™çš„ç¡¬ä»¶ä¸Šï¼›ä»£ç†æœåŠ¡å™¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåº”ç”¨å±‚è½¯ä»¶ï¼Œéƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Š</li></ul><p>ä»£ç†æœåŠ¡å™¨åº”ç”¨ç›¸å¯¹æ¥è¯´ä¹Ÿæ¯”è¾ƒå¹¿</p><ul><li>ç¿»å¢™ï¼šå¹¿åŸŸç½‘ä»£ç†</li><li>è´Ÿè½½å‡è¡¡ï¼šå±€åŸŸç½‘ä»£ç†</li></ul><h4 id="4-3-5-2-åå‘ä»£ç†"><a href="#4-3-5-2-åå‘ä»£ç†" class="headerlink" title="4.3.5.2 åå‘ä»£ç†"></a>4.3.5.2 åå‘ä»£ç†</h4><p>ä»£ç†æœåŠ¡å™¨åˆ†ä¸ºæ­£å‘ä»£ç†å’Œåå‘ä»£ç†ï¼Œè¿™é‡Œæ¥è¯´è¯´<strong>åå‘ä»£ç†</strong>ï¼Œåå‘ä»£ç†å¤„äºç›®æ ‡æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´ï¼Œå®¢æˆ·ç«¯é€šè¿‡åå‘ä»£ç†è®¿é—®ç›®æ ‡æœåŠ¡å™¨ï¼Œè€Œä¸ä¼šç›´æ¥è¿æ¥åˆ°ç›®æ ‡æœåŠ¡å™¨</p><ul><li>é€šè¿‡åå‘ä»£ç†æœåŠ¡å™¨ä½œä¸ºä¸€ä¸ªäº‘æœåŠ¡å™¨ä¸»æœºé›†ç¾¤çš„å…¥ç½‘æœåŠ¡å™¨</li><li>ä¸¾ä¾‹ï¼Œä¸€ä¸ªç½‘ç«™æ‹¥æœ‰10å°æä¾›æœåŠ¡çš„æœåŠ¡å™¨å’Œä¸€å°åå‘ä»£ç†æœåŠ¡å™¨</li><li>åŸŸåè§£æåˆ°åå‘ä»£ç†æœåŠ¡å™¨</li><li>åå‘ä»£ç†æœåŠ¡å™¨é€šè¿‡æœåŠ¡å™¨ç›‘æ§ç¨‹åºï¼Œè·å–åˆ°10å°æœåŠ¡å™¨ä¸­è´Ÿè½½æœ€ä½çš„é‚£ä¸ªï¼Œå¹¶å°†æŠ¥æ–‡è½¬å‘ç»™å®ƒ</li><li>åå‘ä»£ç†æœåŠ¡å™¨è¿˜ä¼šè¯†åˆ«10å°æœåŠ¡å™¨ä¸­æ˜¯å¦æœ‰å®•æœºçš„æœåŠ¡å™¨ï¼Œå¦‚æœæœ‰ï¼Œåˆ™ä¼šå‘Šè­¦ç»™ç»´æŠ¤äººå‘˜ï¼Œå¹¶ä¸å†ç»™è¿™ä¸ªå®•æœºçš„æœåŠ¡å™¨è½¬å‘æŠ¥æ–‡</li><li>åå‘ä»£ç†æœåŠ¡å™¨è¿˜å¯ä»¥è®¾ç½®é»‘ç™½åå•ï¼Œå½“é‡åˆ°DDOSæ”»å‡»çš„æ—¶å€™ï¼Œå°†æ¥æºIPæ”¾å…¥é»‘åå•è¿›è¡Œå±è”½ï¼Œé¿å…è¿‡å¤šçš„è®¿é—®è®©æ‰€æœ‰æœåŠ¡å™¨éƒ½å®•æœºå½±å“ä¸šåŠ¡ï¼›å°†æœ¬å…¬å¸çš„å…¶ä»–æœåŠ¡å™¨æ”¾å…¥ç™½åå•ï¼ˆä¸€èˆ¬ç™½åå•éƒ½å¾ˆçŸ­ï¼‰</li></ul><p>åå‘ä»£ç†çš„ä½œç”¨</p><ul><li>é€šè¿‡åå‘ä»£ç†æœåŠ¡å™¨å®ç°äº†<strong>è´Ÿè½½å‡è¡¡</strong></li><li>ä¾¿äº<strong>ç»Ÿä¸€ç®¡ç†</strong>æœåŠ¡å™¨é›†ç¾¤ï¼Œæä¾›ç»Ÿä¸€å…¥ç½‘æœåŠ¡å™¨</li><li>é¿å…äº†ç›´æ¥å°†æä¾›æœåŠ¡çš„ä¸»æœºIPæš´éœ²åœ¨å…¬ç½‘ä¸Šè€Œè¢«ç›´æ¥æ”»å‡»çš„é—®é¢˜ï¼Œæé«˜äº†<strong>å®‰å…¨æ€§</strong>ã€‚</li><li>åå‘ä»£ç†è¿˜èƒ½å¯¹ç½‘é¡µå†…å®¹è¿›è¡Œä¸€å®šçš„<strong>ç¼“å­˜</strong>ï¼Œä»è€Œå‡è½»åç«¯æœåŠ¡å™¨çš„è´Ÿæ‹…ï¼ˆæ¯”å¦‚ç¼“å­˜ç½‘é¡µå‰ç«¯çš„é™æ€èµ„æºï¼Œå½“ç”¨æˆ·è®¿é—®çš„æ—¶å€™ï¼Œç”±ä»£ç†æœåŠ¡å™¨ç›´æ¥è¿”å›èµ„æºï¼Œè€Œä¸éœ€è¦å»è¯·æ±‚å®é™…æä¾›æœåŠ¡çš„æœåŠ¡å™¨ï¼‰</li></ul><p>æ€»ä¹‹å¥½å¤„å¤šå¤šï¼</p><h4 id="4-3-5-3-æ­£å‘ä»£ç†"><a href="#4-3-5-3-æ­£å‘ä»£ç†" class="headerlink" title="4.3.5.3 æ­£å‘ä»£ç†"></a>4.3.5.3 æ­£å‘ä»£ç†</h4><p>æ­£å‘ä»£ç†æ˜¯ä½äºå®¢æˆ·ç«¯å’Œç›®æ ‡æœåŠ¡å™¨ä¹‹é—´çš„ä¸­é—´æœåŠ¡å™¨ã€‚å®¢æˆ·ç«¯é€šè¿‡æ­£å‘ä»£ç†æ¥è®¿é—®äº’è”ç½‘ä¸Šçš„èµ„æºï¼Œè€Œä¸æ˜¯ç›´æ¥è¿æ¥åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚æ­£å‘ä»£ç†çš„ä½œç”¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li><strong>è®¿é—®æ§åˆ¶å’Œè¿‡æ»¤ï¼š</strong> æ­£å‘ä»£ç†å¯ä»¥ç”¨äºé™åˆ¶ç”¨æˆ·è®¿é—®ç‰¹å®šç½‘ç«™æˆ–èµ„æºï¼Œä»¥å®æ–½è®¿é—®æ§åˆ¶ç­–ç•¥ã€‚å®ƒå¯ä»¥è¿‡æ»¤ä¸è‰¯å†…å®¹ï¼Œæä¾›æ›´å¥½çš„å®‰å…¨æ€§å’Œéšç§ä¿æŠ¤ã€‚</li><li><strong>éšè—å®¢æˆ·ç«¯èº«ä»½ï¼š</strong> æ­£å‘ä»£ç†å¯ä»¥éšè—å®¢æˆ·ç«¯çš„çœŸå® IP åœ°å€ï¼Œä»è€Œä¿æŠ¤ç”¨æˆ·çš„éšç§å’ŒåŒ¿åæ€§ã€‚ç›®æ ‡æœåŠ¡å™¨åªèƒ½çœ‹åˆ°ä»£ç†æœåŠ¡å™¨çš„ IP åœ°å€ï¼Œè€Œæ— æ³•è·å–åˆ°çœŸæ­£çš„å®¢æˆ·ç«¯ä¿¡æ¯ã€‚</li><li><strong>ç¼“å­˜å’ŒåŠ é€Ÿï¼š</strong> æ­£å‘ä»£ç†æœåŠ¡å™¨å¯ä»¥ç¼“å­˜å¸¸ç”¨çš„å†…å®¹ï¼Œä»è€Œå‡å°‘å¯¹ç›®æ ‡æœåŠ¡å™¨çš„è¯·æ±‚ï¼Œæé«˜è®¿é—®é€Ÿåº¦ã€‚</li><li><strong>çªç ´é˜²ç«å¢™é™åˆ¶ï¼š</strong> åœ¨ä¸€äº›ç½‘ç»œç¯å¢ƒä¸­ï¼Œè®¿é—®ç‰¹å®šç½‘ç«™å¯èƒ½å—åˆ°é™åˆ¶æˆ–å°é”ã€‚ä½¿ç”¨æ­£å‘ä»£ç†å¯ä»¥ç»•è¿‡è¿™äº›é™åˆ¶ï¼Œè®¿é—®è¢«å°é”çš„èµ„æºã€‚</li></ol><h2 id="4-4-ISPæ£€æµ‹å®½å¸¦è´¦æˆ·"><a href="#4-4-ISPæ£€æµ‹å®½å¸¦è´¦æˆ·" class="headerlink" title="4.4 ISPæ£€æµ‹å®½å¸¦è´¦æˆ·"></a>4.4 ISPæ£€æµ‹å®½å¸¦è´¦æˆ·</h2><blockquote><p>ä¸‹æ–‡ä¸­çš„éƒ¨åˆ†å†…å®¹æ¥è‡ªchatgptï¼Œæˆ‘å¯¹é‡Œé¢çš„å†…å®¹è¿›è¡Œäº†è¡¥å……å’Œä¿®æ”¹</p></blockquote><p>è¿è¥å•†çš„è·¯ç”±å™¨è¿˜ä¼šæ£€æµ‹æˆ‘ä»¬çš„è´¦æˆ·æ˜¯å¦è¿˜æœ‰ä½™é¢ã€‚æˆ‘ä»¬çš„å®¶ç”¨è·¯ç”±å™¨ä¸€èˆ¬æ˜¯é€šè¿‡å…‰çŒ«ç™»å½•äº†è‡ªå·±çš„å®½å¸¦è´¦æˆ·ï¼›ä¹Ÿå¯ä»¥å°†å…‰çŒ«è®¾ç½®æˆæ¡¥æ¥æ¨¡å¼ï¼Œ<strong>å°†æ¥å…¥å…‰çŒ«çš„è·¯ç”±å™¨è®¾ç½®ä¸ºå®½å¸¦å¸å·ï¼ˆPPPoEï¼‰ä¸Šç½‘æ–¹å¼</strong>ï¼Œç™»å½•è¿è¥å•†æä¾›çš„å®½å¸¦è´¦æˆ·å’Œå¯†ç ï¼Œæ¥æ¥å…¥ç½‘ç»œã€‚</p><p>ISPçš„è·¯ç”±å™¨æ£€æµ‹ä½ çš„å®½å¸¦è´¦æˆ·é€šå¸¸æ˜¯é€šè¿‡ä»¥ä¸‹æ­¥éª¤æ¥å®Œæˆçš„ï¼š</p><ol><li><strong>è®¾å¤‡è¿æ¥ä¸è¯†åˆ«ï¼š</strong> å½“ä½ çš„è®¡ç®—æœºæˆ–å…¶ä»–ç½‘ç»œè®¾å¤‡è¿æ¥åˆ°ISPæä¾›çš„è·¯ç”±å™¨æ—¶ï¼Œè·¯ç”±å™¨ä¼šåˆ†é…ä¸€ä¸ªç§æœ‰IPåœ°å€ç»™ä½ çš„è®¾å¤‡ã€‚è¿™ä¸ªIPåœ°å€æ˜¯ç”±è·¯ç”±å™¨åŠ¨æ€åˆ†é…çš„ï¼Œå¹¶ä¸”é€šå¸¸å¤„äºç‰¹å®šçš„ç§æœ‰IPåœ°å€èŒƒå›´ï¼Œæ¯”å¦‚<code>10.11.1.0/16</code>æˆ–<code>10.11.1.0/24</code>ç­‰ã€‚æ­¤æ—¶ï¼Œä½ çš„è®¾å¤‡ä¸è·¯ç”±å™¨å»ºç«‹äº†ä¸€ä¸ª<em>å¤§å±€åŸŸç½‘</em>å†…çš„è¿æ¥ã€‚ï¼ˆè¿è¥å•†å¹¶ä¸ä¼šç›´æ¥ç»™ä½ åˆ†é…<code>192.168.*</code>è¿™æ ·çš„ç§æœ‰IPï¼Œå› ä¸ºè¿™ä¸ªIPä¸€èˆ¬æ˜¯ç”¨äº<strong>æœ€åº•å±‚å±€åŸŸç½‘</strong>çš„ï¼Œç»™ä½ åˆ†é…äº†ï¼Œé‚£å®¶åº­å±€åŸŸç½‘çš„å°±æ²¡IPç”¨äº†ï¼‰</li><li><strong>è®¤è¯è¿‡ç¨‹ï¼š</strong> åœ¨ä½ å°è¯•è®¿é—®äº’è”ç½‘æ—¶ï¼ŒISPçš„è·¯ç”±å™¨ä¼šå¼•å¯¼ä½ çš„è®¾å¤‡è¿›è¡Œè®¤è¯è¿‡ç¨‹ã€‚è¿™é€šå¸¸æ¶‰åŠå‘ISPæœåŠ¡å™¨å‘é€ä½ çš„å®½å¸¦è´¦æˆ·çš„ç™»å½•å‡­æ®ï¼ˆä¾‹å¦‚ï¼Œç”¨æˆ·åå’Œå¯†ç ï¼‰ã€‚</li><li><strong>è´¦æˆ·éªŒè¯ï¼š</strong> ISPçš„æœåŠ¡å™¨ä¼šéªŒè¯ä½ æä¾›çš„ç™»å½•å‡­æ®æ˜¯å¦ä¸å…¶è®°å½•ä¸­çš„è´¦æˆ·åŒ¹é…ã€‚å¦‚æœéªŒè¯æˆåŠŸï¼Œè¯´æ˜ä½ çš„å®½å¸¦è´¦æˆ·æ˜¯æœ‰æ•ˆçš„ï¼Œè·¯ç”±å™¨ä¼šä¸ºä½ çš„è®¾å¤‡åˆ†é…ä¸€ä¸ªå…¬å…±IPåœ°å€ï¼Œè¿™ä¸ªIPåœ°å€æ˜¯å¯ä¾›äº’è”ç½‘è®¿é—®çš„ã€‚</li><li><strong>IPåœ°å€åˆ†é…ï¼š</strong> ä¸€æ—¦è®¤è¯æˆåŠŸï¼ŒISPçš„è·¯ç”±å™¨ä¼šä¸ºä½ çš„è®¾å¤‡åˆ†é…ä¸€ä¸ªå…¬å…±IPåœ°å€ã€‚è¿™ä¸ªIPåœ°å€æ˜¯åœ¨äº’è”ç½‘ä¸Šå”¯ä¸€æ ‡è¯†ä½ çš„è®¾å¤‡çš„åœ°å€ï¼Œä½¿ä½ çš„è®¾å¤‡å¯ä»¥ä¸å…¶ä»–äº’è”ç½‘è®¾å¤‡è¿›è¡Œé€šä¿¡ã€‚</li><li><strong>æ•°æ®ä¼ è¾“ï¼š</strong> ä¸€æ—¦æœ‰äº†å…¬å…±IPåœ°å€ï¼Œä½ çš„è®¾å¤‡å°±å¯ä»¥ä¸äº’è”ç½‘ä¸Šçš„å…¶ä»–è®¾å¤‡è¿›è¡Œé€šä¿¡ï¼Œå‘é€å’Œæ¥æ”¶æ•°æ®ã€‚</li></ol><p>è¿™æ ·ï¼Œé€šè¿‡è®¤è¯å’ŒIPåœ°å€åˆ†é…çš„è¿‡ç¨‹ï¼ŒISPçš„è·¯ç”±å™¨å¯ä»¥æ£€æµ‹å¹¶è¯†åˆ«ä½ çš„å®½å¸¦è´¦æˆ·ï¼Œä»è€Œè®©ä½ çš„è®¾å¤‡èƒ½å¤Ÿè®¿é—®äº’è”ç½‘ã€‚</p><p>äººè¯å°±æ˜¯ï¼Œ<strong>ç™»å½•äº†å®½å¸¦è´¦æˆ·</strong>ä»¥åï¼Œå½“æˆ‘ä»¬è·¯ç”±å™¨å‘é€çš„æŠ¥æ–‡äº¤ä»˜åˆ°è¿è¥å•†è·¯ç”±å™¨çš„æ—¶å€™ï¼Œè¯¥è·¯ç”±å™¨å°±ä¼šæ£€æµ‹ä½ è¿™ä¸ªå®½å¸¦è´¦æˆ·çš„ä½™é¢ã€‚å¦‚æœæ²¡æœ‰ä½™é¢äº†ï¼Œå°±ä¼šç›´æ¥ä¸¢å¼ƒæ‰ä½ çš„IPæŠ¥æ–‡ã€‚æˆ‘ä»¬çœ‹åˆ°çš„ç»“æœå°±æ˜¯æ— æ³•ä¸Šç½‘ï¼</p><blockquote><p>è¿™ä¸ªæ“ä½œå¹¶ä¸æ˜¯æ¯æ¬¡éƒ½ä¼šæ‰§è¡Œçš„ï¼Œåªè¦ä½ çš„è·¯ç”±å™¨èƒ½ç¨³å®šçš„æ¥å…¥åˆ°è¿è¥å•†çš„è·¯ç”±å™¨ä¸Šï¼Œé‚£å°±ä¸ä¼šæ¯æ¬¡éƒ½è¿›è¡Œå®½å¸¦è´¦æˆ·çš„éªŒè¯ï¼Œå¦åˆ™ä¼šå¢åŠ ç½‘ç»œçš„è´Ÿæ‹…ã€‚</p><p>å…·ä½“çš„éªŒè¯æµç¨‹éƒ½æ˜¯è¿è¥å•†è·¯ç”±å™¨å’Œä½ çš„æœ¬åœ°å…‰çŒ«è‡ªåŠ¨å®Œæˆçš„ã€‚</p></blockquote><p>è€Œæ‰‹æœºæ²¡æœ‰è¯è´¹ä½™é¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¾æ—§èƒ½æ‹¨é€šè¯¸å¦‚120ã€119ç­‰ç´§æ€¥å·ç ï¼Œè¿™ä¹Ÿæ˜¯è¿è¥å•†çš„æœåŠ¡å¯¹è¿™äº›ç‰¹æ®Šçš„ç”µè¯å·ç åšäº†ç±»ä¼¼äº<code>å…è´¹ç™½åå•</code>çš„æ“ä½œï¼ˆæ‰‹æœºå·ç å¯ä»¥ç±»æ¯”å…¬ç½‘IPæ¥ç†è§£ï¼‰</p><h1 id="5-åŸŸå"><a href="#5-åŸŸå" class="headerlink" title="5.åŸŸå"></a>5.åŸŸå</h1><h2 id="5-1-DNSæœåŠ¡å™¨"><a href="#5-1-DNSæœåŠ¡å™¨" class="headerlink" title="5.1 DNSæœåŠ¡å™¨"></a>5.1 DNSæœåŠ¡å™¨</h2><p>ä¸Šæ–‡è®²è¿°çš„éƒ½æ˜¯å…³äºIPåè®®çš„äº‹æƒ…ã€‚ä½†å®é™…ä¸Šæˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œä¸€èˆ¬éƒ½ä¸ä¼šç›´æ¥ä½¿ç”¨IPåœ°å€+ç«¯å£å·çš„æ–¹å¼æ¥è®¿é—®æŸä¸€ä¸ªæœåŠ¡ï¼Œè€Œæ˜¯ä½¿ç”¨åŸŸåæ¥è®¿é—®ã€‚æ¯”å¦‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">www.baidu.com</span><br><span class="line">www.google.com</span><br></pre></td></tr></table></figure><p>æ‰€è°“åŸŸåï¼Œå°±æ˜¯è¿™äº›<strong>è‹±æ–‡å­—ç¬¦ä¸²</strong>å’ŒIPçš„æ˜ å°„ã€‚</p><p>æ¯”å¦‚<code>baidu.com</code>å°±æ˜¯ä¸€ä¸ªåŸŸåï¼Œè€Œ<code>www.baidu.com</code>æ˜¯è¯¥åŸŸåä¸‹çš„ä¸‰çº§åŸŸåï¼ˆå‡ çº§åŸŸåå¯ä»¥çœ‹æœ‰å‡ ä¸ªç‚¹ï¼‰</p><p>å®é™…è®¿é—®çš„æ—¶å€™ï¼Œæ˜¯ç™¾åº¦åœ¨åŸŸåæ³¨å†Œå•†å“ªé‡Œï¼Œå°†<code>www.baidu.com</code>æŒ‡å‘äº†è‡ªå·±çš„æœåŠ¡å™¨çš„åœ°å€(å‡è®¾æŒ‡å‘çš„æ˜¯<code>1.1.1.1</code>) æˆ‘ä»¬è®¿é—®ç™¾åº¦ï¼Œå®é™…ä¸Šè®¿é—®çš„å°±æ˜¯ IPåœ°å€ <code>1.1.1.1</code>ï¼›</p><ul><li>DNSæ˜¯åº”ç”¨å±‚åè®®ï¼Œåº•å±‚ä½¿ç”¨çš„æ˜¯UDP</li><li>ç³»ç»Ÿä¼šç¼“å­˜ä¸€éƒ¨åˆ†DNSçš„ç»“æœ</li></ul><p>åœ¨ä¸»æœºæœ¬åœ°ï¼Œæœ‰ä¸€ä¸ª<code>hosts</code>æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç”¨äºè®¾ç½®ä¸»æœºåˆ°åŸŸåçš„æ˜ å°„ï¼Œåœ¨linuxé‡Œé¢å°±æ˜¯<code>/etc/hosts</code>è¿™ä¸ªæ–‡ä»¶ã€‚ åœ¨è®¿é—®åŸŸåçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿä¼šå…ˆæ£€æŸ¥è‡ªå·±æœ¬æœºå™¨çš„hostsï¼Œå¦‚æœæœ¬åœ°æ²¡æœ‰ï¼Œå°±è¯·æ±‚DNSæœåŠ¡å™¨æ¥è·å–è§£æç»“æœã€‚</p><h2 id="5-2-åŸŸåè®¿é—®ä¸»æœºæµç¨‹"><a href="#5-2-åŸŸåè®¿é—®ä¸»æœºæµç¨‹" class="headerlink" title="5.2 åŸŸåè®¿é—®ä¸»æœºæµç¨‹"></a>5.2 åŸŸåè®¿é—®ä¸»æœºæµç¨‹</h2><p>å½“æˆ‘ä»¬è®¿é—®ä¸€ä¸ªåŸŸåçš„æ—¶å€™ï¼Œé¦–å…ˆä¼šå»è¯·æ±‚ç‰¹æ®Šçš„DNSæœåŠ¡å™¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">8.8.8.8 è°·æ­Œå…¬å¸çš„DNSæœåŠ¡å™¨</span><br><span class="line">119.29.29.29 è…¾è®¯æä¾›çš„å…¬å…±DNS</span><br></pre></td></tr></table></figure><p>å…ˆè¯·æ±‚è¿™äº›DNSæœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å†…ä¼šé’ˆå¯¹åŸŸåæŸ¥è¯¢å¯¹åº”çš„DNSè§£æï¼Œæœ€åå†è®¿é—®è¯¥è§£æå¯¹åº”çš„IPåœ°å€</p><p>è€Œä½¿ç”¨åŸŸåçš„æ—¶å€™ï¼Œé»˜è®¤è®¿é—®çš„æ˜¯è¯¥ä¸»æœºçš„ <code>80(HTTP)/443(HTTPS)</code> ç«¯å£ ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åƒIPä¸€æ ·ï¼Œåœ¨åŸŸåä¹‹åç”¨<code>:ç«¯å£</code> æ¥æŒ‡å®šç‰¹å®šç«¯å£å·è¿›è¡Œè®¿é—®ï¼Œå³<code>åŸŸå:ç«¯å£</code>ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ä¸»æœºéƒ½å¯ä»¥é€šè¿‡<strong>è‡ªåŠ¨é…ç½®DNS</strong>ä»ä¸Šå±‚è·¯ç”±å™¨ä¸­è·å–åˆ°DNSæœåŠ¡å™¨çš„åœ°å€ï¼ˆæ¯”å¦‚è¿è¥å•†ä¼šåœ¨è·¯ç”±å™¨åŸºç«™ä¸­å†…ç½®DNSæœåŠ¡å™¨ï¼‰</p><h3 id="5-2-1-DNSåŠ«æŒ"><a href="#5-2-1-DNSåŠ«æŒ" class="headerlink" title="5.2.1 DNSåŠ«æŒ"></a>5.2.1 DNSåŠ«æŒ</h3><p>æ‰€è°“DNSæ±¡æŸ“å’ŒDNSåŠ«æŒï¼Œå°±æ˜¯å› ä¸ºæˆ‘ä»¬è®¿é—®çš„DNSæœåŠ¡å™¨çš„æ—¶å€™ï¼Œè·å–åˆ°çš„ç»“æœå’Œé¢„æœŸä¸åŒï¼Œä»è€Œå¯¼è‡´æ— æ³•è®¿é—®ç›®æ ‡ç½‘ç«™ï¼Œæˆ–è€…è®¿é—®äº†<strong>å‡</strong>çš„ç›®æ ‡ç½‘ç«™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">www.baidu.com æ˜æ˜åº”è¯¥æŒ‡å‘ 1.1.1.1</span><br><span class="line">ä½†è¢«åè›‹åŠ«æŒäº†DNSè§£æï¼Œå˜æˆäº†æŒ‡å‘ 1.1.1.3</span><br></pre></td></tr></table></figure><p>åè›‹å¯ä»¥åœ¨ <code>1.1.1.3</code> æœåŠ¡å™¨ä¸Šï¼Œæ­å»ºä¸€ä¸ªå’Œç™¾åº¦ã€Œçœ‹èµ·æ¥ã€ä¸€æ¨¡ä¸€æ ·çš„é¡µé¢ï¼Œå¹¶å°†ä½ çš„æŠ¥æ–‡ç»™è½¬å‘åˆ°ç™¾åº¦æœåŠ¡å™¨ä¸Šã€‚æ­¤æ—¶ä»–å°±é€šè¿‡ä¸­é—´è½¬å‘ï¼Œè·å–åˆ°äº†ä½ æŠ¥æ–‡ä¸­çš„ç”¨æˆ·ä¿¡æ¯ã€å¯†ç ç­‰ç­‰å‚æ•°ï¼›</p><p>è¿™æ—¶å€™å› ä¸ºè¿™ä¸ª<strong>å‡çš„æœåŠ¡å™¨</strong>æ˜¯ç›´æ¥ç»™ä½ æä¾›æœåŠ¡äº†ï¼Œä½¿ç”¨çš„HTTPSè¯ä¹¦ä¹Ÿæ˜¯è¿™ä¸ªå‡æœåŠ¡å™¨çš„è¯ä¹¦ï¼Œå¯¹æ–¹å¯ä»¥ç›´æ¥é€šè¿‡è‡ªå·±çš„è¯ä¹¦è§£å¯†è·å–åˆ°ä½ çš„ä¿¡æ¯ï¼Œå†è½¬å‘ç»™ç™¾åº¦ã€‚</p><h3 id="5-2-2-DNSå’Œè´Ÿè½½å‡è¡¡"><a href="#5-2-2-DNSå’Œè´Ÿè½½å‡è¡¡" class="headerlink" title="5.2.2 DNSå’Œè´Ÿè½½å‡è¡¡"></a>5.2.2 DNSå’Œè´Ÿè½½å‡è¡¡</h3><p>å¯¹äºå¤§å…¬å¸è€Œè¨€ï¼ŒDNSè§£æè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ä½œç”¨ï¼Œå°±æ˜¯é€šè¿‡ä¸åŒåŒºåŸŸçš„è®¾ç½®æ¥å®ç°è´Ÿè½½çš„å‡è¡¡ã€‚</p><p>å‡è®¾ç™¾åº¦åœ¨æ¯ä¸€ä¸ªçœä»½éƒ½è®¾ç«‹äº†ä¸€ä¸ªè‡ªå·±çš„æœºæˆ¿ï¼Œé‚£ä¹ˆå®ƒå°±å¯ä»¥é€šè¿‡DNSæœåŠ¡å™¨ï¼Œå½“ä¸åŒçœä»½çš„ç”¨æˆ·è¯·æ±‚æœåŠ¡å™¨çš„æ—¶å€™ï¼Œè¿”å›ä»–å½“å‰æ‰€å¤„çœä»½çš„æœºæˆ¿åœ°å€ã€‚è¿™æ—¶å€™å°±å®ç°äº†æ¯ä¸ªæœºæˆ¿çš„è´Ÿè½½å‡è¡¡ã€‚</p><p>åœ¨ç°å®ä¸­ï¼Œå°±æ˜¯å°†ä½ çš„è¯·æ±‚è½¬æ¥åˆ°ç¦»ä½ æœ€è¿‘çš„æ‹¥æœ‰æœºæˆ¿çš„çœä»½ï¼Œè¿™æ ·æ—¢èƒ½ä¿è¯æ‰€æœ‰æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ï¼Œåˆèƒ½ä¿è¯ä½ çš„è®¿é—®èƒ½è¾ƒå¿«åœ°è·å–åˆ°å“åº”ï¼ˆå¹¿ä¸œè®¿é—®å¹¿å·çš„æœåŠ¡å™¨ï¼Œè‚¯å®šæ¯”è®¿é—®åŒ—äº¬æœåŠ¡å™¨çš„å»¶è¿Ÿä½ä¸€äº›ï¼‰</p><h2 id="5-3-DNSåˆ†å±‚"><a href="#5-3-DNSåˆ†å±‚" class="headerlink" title="5.3 DNSåˆ†å±‚"></a>5.3 DNSåˆ†å±‚</h2><p>DNSæœåŠ¡å™¨ä¸ä¼šå­˜æ”¾æ‰€æœ‰å·²çŸ¥åŸŸåçš„IPè§£æï¼Œå› ä¸ºäº’è”ç½‘ä¸Šå­˜åœ¨å¤§é‡çš„åŸŸåï¼Œæ•°é‡åºå¤§ä¸”ä¸æ–­å¢é•¿ï¼Œå•ä¸€DNSæœåŠ¡å™¨æ— æ³•å­˜å‚¨å’Œå¤„ç†æ‰€æœ‰åŸŸåçš„IPæ˜ å°„ã€‚</p><p>å®é™…ä¸Šï¼ŒDNSæœåŠ¡å™¨é€šè¿‡<strong>åˆ†å±‚çš„æ¶æ„</strong>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åœ¨æ ¹DNSæœåŠ¡å™¨å±‚çº§ï¼Œæœ‰ä¸€ç»„å…¨çƒæ€§çš„é¡¶çº§DNSæœåŠ¡å™¨ï¼Œå®ƒä»¬å­˜å‚¨é¡¶çº§åŸŸåï¼ˆä¾‹å¦‚<code>.comã€.orgã€.net</code>ç­‰ï¼‰çš„IPåœ°å€ã€‚ç„¶åï¼Œåœ¨æ¯ä¸ªé¡¶çº§åŸŸåä¸‹ï¼Œæœ‰å…¶ä»–DNSæœåŠ¡å™¨ï¼Œè´Ÿè´£ç®¡ç†è¯¥é¡¶çº§åŸŸåä¸‹çš„å­åŸŸåï¼ˆä¾‹å¦‚ï¼Œ<code>google.comã€facebook.com</code>ç­‰ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹ç»§ç»­å‘ä¸‹ï¼Œå½¢æˆäº†ä¸€ä¸ªå±‚çº§ç»“æ„ã€‚</p><p>å½“ä½ çš„è®¾å¤‡éœ€è¦è§£ææŸä¸ªåŸŸåæ—¶ï¼Œå®ƒé¦–å…ˆä¼šå‘æœ¬åœ°DNSæœåŠ¡å™¨ï¼ˆé€šå¸¸ç”±ä½ çš„ISPï¼Œå³<strong>äº’è”ç½‘æœåŠ¡æä¾›å•†</strong>ï¼Œäººè¯å°±æ˜¯å›½å†…çš„ä¸‰å¤§è¿è¥å•†æä¾›ï¼‰å‘èµ·è¯·æ±‚ã€‚å¦‚æœæœ¬åœ°DNSæœåŠ¡å™¨çŸ¥é“æ‰€éœ€åŸŸåçš„IPåœ°å€ï¼Œå®ƒä¼šç›´æ¥è¿”å›è¯¥IPåœ°å€ç»™ä½ çš„è®¾å¤‡ã€‚ä½†å¦‚æœæœ¬åœ°DNSæœåŠ¡å™¨ä¸çŸ¥é“è¯¥åŸŸåçš„IPåœ°å€ï¼Œå®ƒä¼šå‘<strong>æ ¹DNS</strong>æœåŠ¡å™¨å‘èµ·è¯·æ±‚ã€‚</p><p>æ ¹DNSæœåŠ¡å™¨å°†æŒ‡å¯¼æœ¬åœ°DNSæœåŠ¡å™¨è½¬å‘ç›¸åº”çš„<strong>é¡¶çº§DNSæœåŠ¡å™¨</strong>ã€‚ç„¶åï¼Œé¡¶çº§DNSæœåŠ¡å™¨å¯èƒ½ä¼šè¿›ä¸€æ­¥å°†è¯·æ±‚è½¬å‘ç»™è´Ÿè´£è¯¥<strong>ç‰¹å®šåŸŸåçš„æˆæƒDNS</strong>æœåŠ¡å™¨ã€‚æœ€ç»ˆï¼Œè¿™ä¸ªæˆæƒDNSæœåŠ¡å™¨å°†è¿”å›æ‰€éœ€åŸŸåçš„IPåœ°å€ç»™æœ¬åœ°DNSæœåŠ¡å™¨ï¼Œæœ¬åœ°DNSæœåŠ¡å™¨å†å°†å…¶è¿”å›ç»™ä½ çš„è®¾å¤‡ã€‚</p><p>è¿™ä¸ªå±‚çº§ç»“æ„å…è®¸DNSç³»ç»Ÿæ›´é«˜æ•ˆåœ°å¤„ç†å¤§é‡çš„åŸŸåè§£æè¯·æ±‚ï¼Œå¹¶ç¡®ä¿åŠæ—¶æ›´æ–°å’Œç®¡ç†åŸŸåä¸IPåœ°å€çš„æ˜ å°„ã€‚æ‰€ä»¥ï¼Œå•ä¸ªDNSæœåŠ¡å™¨å¹¶ä¸ä¼šå­˜æ”¾æ‰€æœ‰å·²çŸ¥åŸŸåçš„IPè§£æï¼Œè€Œæ˜¯é€šè¿‡å±‚çº§ç»“æ„æ¥åˆ†æ•£å’Œç®¡ç†è¿™äº›ä¿¡æ¯ã€‚</p><p><img src="https://img.musnow.top/i/2023/08/74893f7e207a52fc1a4c3c683ebb0976.png" alt="img"></p><h2 id="5-4-digå·¥å…·åˆ†æDNSè§£æè¿‡ç¨‹"><a href="#5-4-digå·¥å…·åˆ†æDNSè§£æè¿‡ç¨‹" class="headerlink" title="5.4 digå·¥å…·åˆ†æDNSè§£æè¿‡ç¨‹"></a>5.4 digå·¥å…·åˆ†æDNSè§£æè¿‡ç¨‹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install bind-utils</span><br></pre></td></tr></table></figure><p>å®‰è£…äº†ä¹‹åå°±å¯ä»¥ä½¿ç”¨digå‘½ä»¤æ¥æŸ¥çœ‹åŸŸåè§£æè¿‡ç¨‹äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig åŸŸå</span><br></pre></td></tr></table></figure><h1 id="6-è·¯ç”±"><a href="#6-è·¯ç”±" class="headerlink" title="6.è·¯ç”±"></a>6.è·¯ç”±</h1><p>è·¯ç”±çš„è¿‡ç¨‹ï¼Œå°±æ˜¯ä¸‹å›¾è¿™æ ·ä¸€è·³ä¸€è·³(Hop by Hop) â€œé—®è·¯â€ çš„è¿‡ç¨‹</p><p>æ‰€è°“ â€œä¸€è·³â€ å°±æ˜¯æ•°æ®é“¾è·¯å±‚ä¸­çš„ä¸€ä¸ªåŒºé—´ã€‚å…·ä½“åœ¨ä»¥å¤ªç½‘ä¸­ï¼ŒæŒ‡ä»æºMACåœ°å€åˆ°ç›®çš„MACåœ°å€ä¹‹é—´çš„å¸§ä¼ è¾“åŒºé—´ã€‚</p><p><img src="https://img.musnow.top/i/2023/07/f1a4a3b26f00fe29305bba853e830186.png" alt="image-20230726194559495"></p><h2 id="6-1-é—®è·¯æ —å­ï¼ˆå¸®åŠ©ç†è§£ï¼‰"><a href="#6-1-é—®è·¯æ —å­ï¼ˆå¸®åŠ©ç†è§£ï¼‰" class="headerlink" title="6.1 é—®è·¯æ —å­ï¼ˆå¸®åŠ©ç†è§£ï¼‰"></a>6.1 é—®è·¯æ —å­ï¼ˆå¸®åŠ©ç†è§£ï¼‰</h2><p>æ‹¿æ—¥å¸¸ç”Ÿæ´»ä¸­é—®è·¯æ¥ä¸¾ä¾‹å­ï¼ˆè¯·å±è”½ç°åœ¨æœ‰å¯¼èˆªè¿™ä»¶äº‹ï¼‰ä¸€èˆ¬é—®è·¯ï¼Œä¼šå¾—åˆ°ä¸‰ç§ç»“æœï¼š</p><ul><li>æˆ‘ä¸çŸ¥é“</li><li>æˆ‘çŸ¥é“XXXçŸ¥é“</li><li>æˆ‘ä¸çŸ¥é“ï¼Œä½†æ˜¯ç»™ä½ ä¹±æŒ‡ï¼ˆåœ¨è·¯ç”±å¯»å€çš„è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªæƒ…å†µæ˜¯ä¸å­˜åœ¨çš„ï¼‰</li></ul><p>æ¯”å¦‚å¼ ä¸‰è¦å»å—äº¬å¤§å­¦çš„ä»™æ—æ ¡åŒºï¼Œä»–é£æœºè½åœ°å—äº¬åï¼Œä¸çŸ¥é“æ€ä¹ˆèµ°ï¼›ä»–æ‰¾äº†ä¸ªæœºåœºçš„ä¿å®‰ï¼Œé—®ä»–â€œæˆ‘æ˜¯ä»xxçœæ–°æ¥çš„å¤§å­¦ç”Ÿï¼Œåº”è¯¥æ€ä¹ˆå»å—äº¬å¤§å­¦ï¼Ÿâ€ ä¿å®‰è®©ä»–å…ˆåxxè·¯å…¬äº¤è½¦å»ä»™æ—å¤§å­¦åŸï¼Œåˆ°å“ªé‡Œå†å»é—®å…¶ä»–äººã€‚</p><p>å¼ ä¸‰åˆ°äº†ä»™æ—å¤§å­¦åŸåï¼Œåˆæ‰¾åˆ°äº†è·¯è¾¹çš„ç¯å«å·¥ï¼Œåˆé—®â€œæˆ‘ä»æœºåœºè¿‡æ¥ï¼Œåº”è¯¥æ€ä¹ˆå»å—äº¬å¤§å­¦ã€‚â€ ç¯å«å·¥ç»™ä»–æŒ‡äº†æ¡æ˜è·¯ï¼Œé‚£é‡Œå°±æ˜¯å—äº¬å¤§å­¦çš„æ•™å­¦æ¥¼ï¼Œå…¥å£å°±åœ¨è¿™é™„è¿‘ã€‚è¿™æ—¶å€™å¼ ä¸‰è·å–äº†ä¸¤ä¸ªäººï¼ˆè·¯ç”±å™¨ï¼‰çš„å¸®åŠ©ï¼ŒæˆåŠŸé€’è¾¾äº†å—äº¬å¤§å­¦çš„ä»™æ—æ ¡åŒºï¼ˆç›®æ ‡ä¸»æœºï¼‰ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œé—®è·¯å’Œä¸Šé¢å›¾ç¤ºä¸­IPæŠ¥æ–‡çš„è·¯ç”±æ˜¯å¾ˆç›¸ä¼¼çš„ï¼Œéƒ½æ˜¯ä¸€ä¸ªè·¯ç”±ä¸€ä¸ªè·¯ç”±çš„â€œé—®è·¯â€ï¼Œæœ€ç»ˆæ‰¾åˆ°ç›®æ ‡ä¸»æœºã€‚</p><hr><h2 id="6-2-è·¯ç”±è¡¨"><a href="#6-2-è·¯ç”±è¡¨" class="headerlink" title="6.2 è·¯ç”±è¡¨"></a>6.2 è·¯ç”±è¡¨</h2><p>æŠ¥æ–‡åœ¨å„ä¸ªè·¯ç”±å™¨ä¹‹é—´è·¯ç”±ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å½“ä¸€ä¸ªè·¯ç”±å™¨é‡åˆ°ä¸€ä¸ªIPæŠ¥æ–‡</p><ul><li>ä»–é¦–å…ˆæ£€æµ‹è¿™æ˜¯ä¸æ˜¯è‡ªå·±åˆ†é…çš„å±€åŸŸç½‘ä¸­çš„IPï¼Œæ˜¯åˆ™å¯ä»¥ç›´æ¥è½¬å‘åˆ°ç›®æ ‡ä¸»æœºï¼›</li><li>ä¸æ˜¯åˆ™æŸ¥çœ‹è‡ªå·±çš„<strong>è·¯ç”±è¡¨</strong>ï¼Œçœ‹çœ‹è‡ªå·±æ˜¯å¦ä¿å­˜äº†è¿™ä¸ªIPåº”è¯¥å¾€å“ªé‡Œèµ°ï¼›</li><li>å¦‚æœå®ƒè‡ªå·±ä¸çŸ¥é“ï¼Œåˆ™å¯ä»¥å’Œå…¶ä»–ä¸è‡ªå·±ç›¸è¿çš„è·¯ç”±å™¨é€šä¿¡ï¼ˆä¿¡æ¯åŒæ­¥ï¼‰ï¼Œé—®ä»–ä»¬è¿™ä¸ªIPåº”è¯¥ç»™è°ï¼ˆå°±å¥½æ¯”ä½ åœ¨å…¬å¸é‡Œé¢é—®æŸä¸€ä¸ªå·¥ä½œåº”è¯¥äº¤ç»™è°å»åšï¼‰</li><li>å¦‚æœå‘¨è¾¹çš„è·¯ç”±ï¼ˆæ—è¾¹çš„è·¯äººï¼‰éƒ½ä¸çŸ¥é“è¯¥å¾€å“ªé‡Œå»ï¼Œåˆ™è·¯ç”±å™¨ä¼šå°†å…¶äº¤ä»˜ç»™è‡ªå·±çš„<code>é»˜è®¤è·¯ç”±</code>ï¼ŒæŠ¥æ–‡ç»§ç»­è½¬å‘ï¼Œå»ä¸‹ä¸€ä¸ªäººé‚£é‡Œé—®è·¯äº†ã€‚</li></ul><p>è¿™æ ·çš„è·³è·ƒéƒ½ä¼šæœ‰ä¸€ä¸ªå‰ææ¡ä»¶ï¼šç›¸é‚»çš„ä¸¤ä¸ªä¸»æœºï¼ˆæˆ–è·¯ç”±å™¨ï¼‰ä¸€å®šæ˜¯åœ¨ç‰©ç†ä¸Šç›¸è¿ï¼Œå¤„äºåŒä¸€å±€åŸŸç½‘ä¹‹ä¸­ã€‚æ¯æ¬¡çš„è·³è·ƒï¼Œæœ¬è´¨ä¸Šæ˜¯ä»ä¸€ä¸ªå­ç½‘è·³åˆ°å¦å¤–ä¸€ä¸ªå­ç½‘ï¼›å¹¿åŸŸç½‘å¯ä»¥è®¤ä¸ºæ˜¯æœ€å¤§çš„â€œå­ç½‘â€</p><p><img src="https://img.musnow.top/i/2023/07/2eb52f0f7cb80aeed61e8a17d8402688.png" alt="image-20230727085331798"></p><h2 id="6-3-routeå‘½ä»¤"><a href="#6-3-routeå‘½ä»¤" class="headerlink" title="6.3 routeå‘½ä»¤"></a>6.3 routeå‘½ä»¤</h2><blockquote><p>åœ¨windowsç”µè„‘ä¸Šå¯ä»¥ä½¿ç”¨ <code> route print</code> å‘½ä»¤æ‰“å°è·¯ç”±è¡¨ï¼Œæœ¬æ–‡ä¸å…³æ³¨windowså¹³å°ã€‚</p></blockquote><p>åœ¨linuxå¹³å°é‡Œé¢ï¼Œå¯ä»¥é€šè¿‡<code>route</code>å‘½ä»¤æŸ¥çœ‹å½“å‰ä¸»æœºçš„è·¯ç”±è¡¨ï¼Œåœ¨Centos8ä¸»æœºä¸Šï¼Œå‘½ä»¤æ˜¾ç¤ºå¦‚ä¸‹ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè·¯ç”±è¡¨çš„åå­—å«åš <strong>å†…æ ¸IPè·¯ç”±è¡¨</strong>ï¼Œè¿™ä¹Ÿæ˜¯linuxç³»ç»Ÿä¸­çš„ä¸€ä¸ªå†…æ ¸æ•°æ®ç»“æ„ã€‚å†…éƒ¨ç»´æŠ¤äº†è·¯ç”±è¡¨çš„ç›®çš„åœ°ã€Gatewayç½‘å…³ã€Genmaskæ©ç ã€Flagsæ ‡å¿—ä½ã€Metricã€Refã€Useã€Ifaceæ¥å£</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">default         _gateway        0.0.0.0         UG    100    0        0 eth0</span><br><span class="line">172.16.0.0      0.0.0.0         255.255.0.0     U     100    0        0 eth0</span><br><span class="line">172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 docker0</span><br><span class="line">172.18.0.0      0.0.0.0         255.255.0.0     U     0      0        0 br-96d69eeef1ac</span><br><span class="line">172.19.0.0      0.0.0.0         255.255.0.0     U     0      0        0 br-fa4aff4c583e</span><br></pre></td></tr></table></figure><ul><li>Flagsä¸­ï¼ŒUä»£è¡¨å½“å‰è·¯ç”±è¡¨çš„æ¡ç›®æ˜¯æœ‰æ•ˆçš„ï¼ŒGä»£è¡¨å…¶æ˜¯ä¸€ä¸ªè·¯ç”±å™¨ã€‚</li><li>Gatewayä¸­ï¼Œ<code>_gateway</code>ä»¥åŠ<code>0.0.0.0</code>ä»£è¡¨çš„éƒ½æ˜¯é»˜è®¤ç½‘å…³</li><li>Ifaceä¸­ï¼Œåªæœ‰<code>eth0</code>æ˜¯ä¸€ä¸ªçœŸæ­£çš„ç‰©ç†ç½‘ç»œæ¥å£ï¼Œè€Œ<code>docker0/br-*</code>éƒ½æ˜¯dockerå®¹å™¨è™šæ‹Ÿå‡ºæ¥çš„æ¡¥æ¥ç½‘ç»œæ¥å£</li></ul><p>å‡è®¾æˆ‘æˆ‘ä»¬æœ‰ä¸€ä¸ªç›®çš„IPæ˜¯ <code>172.16.0.2</code>ï¼Œè·å–åˆ°è¿™ä¸ªIPåï¼Œç³»ç»Ÿå°±ä¼šå°†å…¶å’Œè·¯ç”±è¡¨ä¸­çš„å­ç½‘æ©ç ä¾æ¬¡è¿›è¡Œ<strong>æŒ‰ä½ä¸</strong>ï¼›</p><p>åœ¨linuxç¯å¢ƒä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç æ¥è¿›è¡Œè¿™ä¸¤ä¸ªIPçš„æŒ‰ä½ä¸æ“ä½œã€‚å…¶ä¸­<code>inet_addr å’Œ inet_ntoa</code>æ˜¯linuxä¸‹çš„ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨æ¥å£ã€‚ç”¨äºIPå­—ç¬¦ä¸²åˆ°æ— ç¬¦å·æ•´æ•°ä¹‹é—´çš„è½¬æ¢ï¼Œå…·ä½“çš„ä»‹ç»å¯ä»¥é˜…è¯»æˆ‘çš„ <a href="https://blog.musnow.top/posts/368672249/">UDPåšå®¢</a></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å°†ç‚¹åˆ†åè¿›åˆ¶çš„IPåœ°å€å’Œå­ç½‘æ©ç è½¬æ¢ä¸ºæ— ç¬¦å·æ•´æ•°</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> ipAddress = <span class="built_in">inet_addr</span>(<span class="string">&quot;172.16.0.2&quot;</span>);</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> subnetMask = <span class="built_in">inet_addr</span>(<span class="string">&quot;255.255.0.0&quot;</span>);</span><br><span class="line">    <span class="comment">// è¿›è¡ŒæŒ‰ä½ä¸æ“ä½œå¾—åˆ°ç½‘ç»œåœ°å€</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> networkAddress = ipAddress &amp; subnetMask;</span><br><span class="line">    <span class="comment">// å°†ç½‘ç»œåœ°å€è½¬æ¢å›ç‚¹åˆ†åè¿›åˆ¶è¡¨ç¤ºæ³•å¹¶è¾“å‡ºç»“æœ</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">in_addr</span> addr;</span><br><span class="line">    addr.s_addr = networkAddress;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;IPåœ°å€: &quot;</span> &lt;&lt; <span class="string">&quot;172.16.0.2&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;å­ç½‘æ©ç : &quot;</span> &lt;&lt; <span class="string">&quot;255.255.0.0&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;ç½‘ç»œåœ°å€: &quot;</span> &lt;&lt; <span class="built_in">inet_ntoa</span>(addr) &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// élinuxç¯å¢ƒå¯ä»¥ä½¿ç”¨ä¸‹æ–¹çš„ä»£ç è¿›è¡Œå¤„ç†</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ip_and_gmask_test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> ipAddress = <span class="number">172</span> &lt;&lt; <span class="number">24</span> | <span class="number">16</span> &lt;&lt; <span class="number">16</span> | <span class="number">0</span> &lt;&lt; <span class="number">8</span> | <span class="number">2</span>; <span class="comment">// å°† IP åœ°å€è½¬æ¢ä¸º 32 ä½æ— ç¬¦å·æ•´æ•°</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> subnetMask = <span class="number">255</span> &lt;&lt; <span class="number">24</span> | <span class="number">255</span> &lt;&lt; <span class="number">16</span> | <span class="number">0</span> &lt;&lt; <span class="number">8</span> | <span class="number">0</span>; <span class="comment">// å°†å­ç½‘æ©ç è½¬æ¢ä¸º 32 ä½æ— ç¬¦å·æ•´æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> networkAddress = ipAddress &amp; subnetMask; <span class="comment">// æŒ‰ä½ä¸</span></span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;IPåœ°å€:  172.16.0.2&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;å­ç½‘æ©ç : 255.255.0.0&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;ç½‘ç»œåœ°å€: &quot;</span> &lt;&lt; (networkAddress &gt;&gt; <span class="number">24</span>) &lt;&lt; <span class="string">&quot;.&quot;</span> &lt;&lt; ((networkAddress &gt;&gt; <span class="number">16</span>) &amp; <span class="number">255</span>) &lt;&lt; <span class="string">&quot;.&quot;</span> &lt;&lt; ((networkAddress &gt;&gt; <span class="number">8</span>) &amp; <span class="number">255</span>) &lt;&lt; <span class="string">&quot;.&quot;</span> &lt;&lt; (networkAddress &amp; <span class="number">255</span>) &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äºŒè€…è¾“å‡ºç»“æœéƒ½æ˜¯<code>172.16.0.0</code></p><p>å¾—åˆ°è¾“å‡ºç»“æœåï¼Œå†å’Œè·¯ç”±è¡¨ä¸­è¯¥é¡¹çš„<code>Destination</code>è¿›è¡Œå¯¹æ¯”ï¼ŒäºŒè€…ç›¸ç­‰ï¼Œä»£è¡¨å½“å‰IPå°±æ˜¯éœ€è¦é€šè¿‡è¯¥é¡¹è¿›è¡Œè·¯ç”±ï¼Œé‚£å°±å°†è¿™ä¸ªæŠ¥æ–‡é€šè¿‡<code>Iface</code>æ¥å£<code>eth0</code>å‘é€å‡ºå»å°±OKäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">172.16.0.0      0.0.0.0         255.255.0.0     U     100    0        0 eth0</span><br></pre></td></tr></table></figure><p>å¦‚æœæŒ‰ä½ä¸çš„ç»“æœä¸<code>Destination</code>åŒ¹é…ä¸ä¸Šï¼Œé‚£å°±ç»§ç»­å¾€ä¸‹ä¸€ä¸ªæ¡ç›®çš„å­ç½‘æ©ç è¿›è¡ŒæŒ‰ä½ä¸ã€‚å¦‚æœæ•´ä¸ªè¡¨éƒ½æŒ‰ä½ä¸å®Œæ¯•äº†ï¼Œè¿˜æ²¡æ‰¾åˆ°è¯¥å»çš„åœ°æ–¹ï¼Œé‚£å°±å°†å…¶é€šè¿‡<code>default</code>é»˜è®¤è·¯ç”±å‘é€å‡ºå»ã€‚</p><h1 id="7-æ•°æ®é“¾è·¯å±‚"><a href="#7-æ•°æ®é“¾è·¯å±‚" class="headerlink" title="7.æ•°æ®é“¾è·¯å±‚"></a>7.æ•°æ®é“¾è·¯å±‚</h1><p>å‰é¢è°ˆäº†ä¸€å¤§å †å°†æ•°æ®ä»ä¸€ä¸ªä¸»æœºåˆ°è·¯ç”±å™¨å†è·¨è¶Šå¤šä¸ªè·¯ç”±å™¨é€’è¾¾ç›®æ ‡ä¸»æœºçš„æµç¨‹ã€‚</p><p>è¦æƒ³å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ•°æ®é“¾è·¯å±‚çš„å¸®åŠ©ï¼Œå³å®ç°åŒä¸€å±€åŸŸç½‘å†…ä¸¤å°ä¸»æœºåœ¨ç‰©ç†å±‚é¢ä¸Šçš„ç›¸äº’é€šä¿¡ã€‚</p><ul><li>IPç½‘ç»œå±‚ï¼šæä¾›è·¨ç½‘ç»œæ‰¾åˆ°æ­£ç¡®è·¯ç”±è·¯å¾„ï¼Œå¹¶ä¼ è¾“æ•°æ®çš„èƒ½åŠ›</li><li>æ•°æ®é“¾è·¯å±‚ï¼šæä¾›å°†æ•°æ®åœ¨åŒä¸€ç½‘ç»œä¸­ä¼ è¾“çš„èƒ½åŠ›</li><li>ç‰©ç†å±‚ï¼šå®é™…ä¸Šçš„æ•°æ®åœ¨ç‰©ç†ï¼ˆç½‘çº¿ï¼‰ä¸Šä¼ è¾“</li></ul><p>æ•°æ®é“¾è·¯å±‚ä¹Ÿæœ‰ä¸åŒçš„ä¼ è¾“æ–¹å¼ï¼Œæœ¬æ–‡ä¸»è¦å…³æ³¨å½“å‰ä¸»æµçš„<strong>ä»¥å¤ªç½‘</strong>ï¼›</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»¥å¤ªç½‘ä¸æ˜¯ä¸€ç§å…·ä½“çš„ç½‘ç»œï¼Œè€Œæ˜¯ä¸€ç§æŠ€æœ¯æ ‡å‡†ã€‚å®ƒå³åŒ…å«äº†æ•°æ®é“¾è·¯å±‚çš„å†…å®¹ï¼Œä¹ŸåŒ…å«äº†ä¸€äº›ç‰©ç†å±‚çš„è§„å®šï¼Œæ¯”å¦‚æ‹“æ‰‘ç»“æ„å’Œè®¿é—®æ§åˆ¶æ–¹å¼ï¼Œä¼ è¾“é€Ÿç‡ç­‰ã€‚</p><hr><h2 id="7-1-è®¤è¯†å±€åŸŸç½‘çš„åŸºæœ¬æƒ…å†µ"><a href="#7-1-è®¤è¯†å±€åŸŸç½‘çš„åŸºæœ¬æƒ…å†µ" class="headerlink" title="7.1 è®¤è¯†å±€åŸŸç½‘çš„åŸºæœ¬æƒ…å†µ"></a>7.1 è®¤è¯†å±€åŸŸç½‘çš„åŸºæœ¬æƒ…å†µ</h2><h3 id="7-1-1-å±€åŸŸç½‘è®¤è¯†"><a href="#7-1-1-å±€åŸŸç½‘è®¤è¯†" class="headerlink" title="7.1.1 å±€åŸŸç½‘è®¤è¯†"></a>7.1.1 å±€åŸŸç½‘è®¤è¯†</h3><p>ä¸è¿‡åœ¨è®¤è¯†ä»¥å¤ªç½‘ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆçŸ¥é“å±€åŸŸç½‘é€šä¿¡çš„ä¸€ä¸ªåŸºæœ¬æƒ…å†µï¼›å‡è®¾ä¸‹å›¾ä¸­å°±æ˜¯ä¸€ä¸ªå±€åŸŸç½‘ï¼Œå…¶ä¸­åŒ…å«äº†ä¸åŒçš„ä¸»æœº</p><p><img src="https://img.musnow.top/i/2023/08/ffd57666730e838d74d4c8c9af7d95cd.png" alt="image-20230821171017532"></p><p>é¦–å…ˆï¼Œå¦‚æœæƒ³è¦ä¸¤å°ä¸»æœºèƒ½å¤Ÿé€šä¿¡ï¼Œæˆ‘ä»¬å°±éœ€è¦å…ˆå°†å…¶é“¾æ¥åˆ°<strong>åŒä¸€æ ¹ç½‘çº¿</strong>ä¸Šï¼ˆåœ¨è¿™é‡Œæš‚ä¸”ä¸ç®¡WIFIï¼Œå…¶å®æœ¬è´¨ä¸Šä¹Ÿæ˜¯è¿åœ¨äº†è¿™æ ¹ç½‘çº¿ä¸Šï¼‰ï¼›è¿™å°±å¥½æ¯”è¿›ç¨‹é—´é€šä¿¡çš„æ—¶å€™ï¼Œä½ éœ€è¦å…ˆèƒ½çœ‹åˆ°åŒä¸€ä»½èµ„æºï¼Œæ‰èƒ½å®ç°å¯¹è¿™ä»½èµ„æºçš„å…±äº«è®¿é—®ã€‚</p><p>è™½ç„¶æˆ‘ä»¬è®¤ä¸ºåœ¨å±€åŸŸç½‘é‡Œé¢é€šä¿¡çš„æ—¶å€™ï¼Œæ˜¯ä¸¤å°ä¸»æœºç›´æ¥äº¤æµï¼Œä½†å®é™…ä¸Šä½ å¯ä»¥æŠŠå±€åŸŸç½‘å½“ä½œä¸€ä¸ªæ•™å¸ˆï¼Œå½“å¼ ä¸‰å’Œæå››æ²Ÿé€šçš„æ—¶å€™ï¼Œå…¶å®ä¼šæœ‰å¾ˆå¤šå…¶ä»–çš„åƒç“œç¾¤ä¼—éƒ½èƒ½æ¥æ”¶åˆ°ä½ å‘é€çš„è¿™ä¸ªä¿¡æ¯ã€‚</p><p>åé¦ˆåˆ°ä»¥å¤ªç½‘æŠ¥æ–‡ä¸Šï¼Œå› ä¸ºæ¯ä¸ªä¸»æœºéƒ½æ˜¯çŸ¥é“è‡ªå·±çš„åœ°å€çš„ï¼Œæ‰€ä»¥åªè¦æ£€æµ‹åˆ°ä»¥å¤ªç½‘æŠ¥å¤´ä¸­çš„<code>ç›®çš„åœ°å€</code>ä¸æ˜¯è‡ªå·±çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä¸¢å¼ƒæ‰è¿™ä¸ªæŠ¥æ–‡ã€‚å› ä¸ºç›®æ ‡å¹¶ä¸åœ¨å’Œä½ è¯´è¯ã€‚è¿™å°±å¥½æ¯”åœ¨æ•™å®¤é‡Œé¢ï¼Œä½ éš”å£æœ‰ä¿©äººåœ¨èŠå¤©ï¼Œä»–ä»¬å¹¶æ²¡æœ‰å’Œä½ äº¤è°ˆï¼Œæ‰€ä»¥ä½ å¯ä»¥ä¸ç”¨ç®¡ä»–ä»¬èŠäº†ä»€ä¹ˆã€‚</p><blockquote><p>è¿™ä¹Ÿåé¦ˆå‡ºäº†ä¸ºä»€ä¹ˆæŸäº›å…¬å…±WIFIä¼šä¸å®‰å…¨ï¼Œå› ä¸ºåªè¦æ¥å…¥äº†è¿™ä¸ªWIFIï¼Œä½ å°±æœ‰åŠæ³•æ£€æµ‹åˆ°å…¶ä»–ç”¨æˆ·é€šè¿‡è¿™ä¸ªå±€åŸŸç½‘å‘é€äº†ä»€ä¹ˆä¿¡æ¯ï¼</p></blockquote><p>å› ä¸ºå±€åŸŸç½‘å†…çš„ä¸»æœºæ˜¯é€šè¿‡ç›®çš„åœ°å€åˆ¤æ–­æœ‰æ²¡æœ‰äººå’Œè‡ªå·±èŠå¤©çš„ï¼Œæ‰€ä»¥å³ä¾¿æˆ‘ä»¬çš„ç”µè„‘å¼€æœºåä»€ä¹ˆäº‹æƒ…éƒ½æ²¡æœ‰å¹²ï¼Œåœ¨æ“ä½œç³»ç»Ÿåº•å±‚ï¼ˆæ•°æ®é“¾è·¯å±‚ï¼‰å…¶å®ä¸€ç›´éƒ½åœ¨ä»å±€åŸŸç½‘ä¸­æ‹¿åˆ°æ–°çš„æ•°æ®é“¾è·¯å±‚æŠ¥æ–‡ï¼Œå¹¶æ£€æµ‹æ˜¯å¦æ˜¯å‘ç»™è‡ªå·±çš„æŠ¥æ–‡ï¼š</p><ul><li>æ˜¯ï¼Œå‘ä¸Šäº¤ä»˜</li><li>å¦ï¼Œä¸¢æ‰</li></ul><h3 id="7-1-2-ç¢°æ’åŸŸ"><a href="#7-1-2-ç¢°æ’åŸŸ" class="headerlink" title="7.1.2 ç¢°æ’åŸŸ"></a>7.1.2 ç¢°æ’åŸŸ</h3><p>ç”±äºæ•°æ®é“¾è·¯å±‚å‘ä¸‹æ˜¯ç›´æ¥äº¤ä»˜ç»™ç‰©ç†å±‚çš„ï¼Œåœ¨ç‰©ç†å±‚ï¼ˆç½‘çº¿ï¼‰ä¸­å…‰ç”µä¿¡å·ä¼ è¾“æ˜¯ä¸èƒ½åŒæ—¶ä¼ è¾“å¤šä¸ªæ•°æ®çš„ï¼Œè¿™å°±è¦æ±‚æˆ‘ä»¬åŒä¸€ä¸ªå±€åŸŸç½‘çš„å¤šå°ä¸»æœºä¸èƒ½åŒæ—¶å¾€å±€åŸŸç½‘ä¸­å‘æ•°æ®ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸»æœºå¼•å…¥äº†ä¼‘çœ æœºåˆ¶ï¼Œé€šè¿‡ä¸åŒæ—¶é—´çš„é”™å¼€ä¼‘çœ ï¼Œæ¥é¿å…ä¸¤å°ä¸»æœºåŒæ—¶å¾€å±€åŸŸç½‘ä¸­å‘æ•°æ®çš„æƒ…å†µã€‚</p><ul><li>ç†æƒ³æƒ…å†µï¼šåŒä¸€æ—¶é—´åªæœ‰ä¸€å°ä¸»æœºåœ¨å±€åŸŸç½‘ä¸­å‘é€æ•°æ®</li><li>ç¢°æ’é—®é¢˜ï¼šå¦‚æœå‡ºç°äº†åŒæ—¶å‘é€ï¼Œæ•°æ®å‡ºç°å†²çªï¼Œå°±éœ€è¦å‰”é™¤æ‰è¿™éƒ¨åˆ†æ•°æ®</li></ul><p>é€šè¿‡<code>ç¢°æ’åŸŸ</code>è§£å†³æ•°æ®å†²çªé—®é¢˜ï¼Œå°½é‡è¾¾åˆ°ç†æƒ³æƒ…å†µï¼›</p><p>æ¯”å¦‚æˆ‘ä»¬çš„äº¤æ¢æœºå°±æœ‰<strong>åˆ’åˆ†ç¢°æ’åŸŸ</strong>çš„åŠŸèƒ½ã€‚æ¥åˆ°äº¤æ¢æœºä¸Šçš„è®¾å¤‡ï¼Œé™¤äº†é€šè¿‡äº¤æ¢æœºè¿›è¡Œè·¯ç”±è½¬å‘ï¼Œå¦‚æœåœ¨äº¤æ¢æœºçš„è¿™éƒ¨åˆ†è®¾å¤‡ä¸­å‡ºç°äº†æ•°æ®ç¢°æ’ï¼Œé‚£ä¹ˆäº¤æ¢æœºå°±èƒ½æŠŠç¢°æ’æ§åˆ¶åœ¨å½“å‰è¿™ä¸ªå°çš„ç¢°æ’åŸŸå†…ï¼Œè€Œä¸ä¼šå‘æ›´å¤§çš„å±€åŸŸç½‘ä¸­ä¼ æ’­ã€‚</p><blockquote><p>å¦‚æœä¸€ä¸ªå±€åŸŸç½‘é‡Œé¢åªæœ‰ä¸€ä¸ªäº¤æ¢æœºï¼ˆè·¯ç”±å™¨ï¼‰é‚£ä¹ˆè¿™æ•´ä¸ªå±€åŸŸç½‘å…±äº«ç¢°æ’åŸŸ</p></blockquote><p>æ‰€ä»¥å¤§å…¬å¸å†…ä¸ºäº†é¿å…å±€åŸŸç½‘å› ä¸ºç¢°æ’é—®é¢˜è€Œå¯¼è‡´çš„ç½‘ç»œå¡é¡¿ï¼Œä¸€èˆ¬éƒ½ä¼šå°†å‡ å°ç”µè„‘æ¥å…¥ä¸€ä¸ªå°çš„äº¤æ¢æœºä¸­æ¥<strong>åˆ’åˆ†ç¢°æ’åŸŸ</strong>ã€‚</p><p>å¦‚ä¸Šæ˜¯ç‰©ç†å±‚é¢çš„äº‹æƒ…ï¼Œè½¯ä»¶å±‚é¢ä¸Šï¼Œä¸€ä¸ª<strong>MACå¸§</strong>ä¸è¦å¤ªå¤§ï¼Œå¦åˆ™ä¼šå¤§å¤§å¢åŠ ç¢°æ’çš„æ¦‚ç‡ã€‚æ‰€ä»¥MACå¸§å¿…é¡»è¦å¯¹ä¸Šå±‚äº¤ä»˜çš„æ•°æ®å¤§å°æä¸€ä¸ªè¦æ±‚ï¼Œä¸èƒ½äº¤ä»˜å¤ªå¤§çš„æ•°æ®ï¼Œè¿™å°±æ˜¯MTUçš„ç”±æ¥ï¼ˆä¸€èˆ¬éƒ½æ˜¯1500å­—èŠ‚ï¼Œè‡³äºä¸ºä»€ä¹ˆæ˜¯1500ï¼Œé‚£å°±æ˜¯å­¦æœ¯å±‚é¢çš„äº‹æƒ…äº†ï¼‰</p><h2 id="7-2-ä»¥å¤ªç½‘å¸§æ ¼å¼"><a href="#7-2-ä»¥å¤ªç½‘å¸§æ ¼å¼" class="headerlink" title="7.2 ä»¥å¤ªç½‘å¸§æ ¼å¼"></a>7.2 ä»¥å¤ªç½‘å¸§æ ¼å¼</h2><p><img src="https://img.musnow.top/i/2023/08/736bb377f1eb050bba42a13f153a435e.png" alt="image-20230803144819270"></p><p>è¿™é‡Œéœ€è¦çŸ¥é“ä¸€ä¸ªå°çŸ¥è¯†ï¼Œè™½ç„¶MACåœ°å€åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥è®¤ä¸ºæ˜¯å…¨çƒå”¯ä¸€çš„ï¼Œä½†å®é™…ä¸Šåªéœ€è¦ä¿è¯åŒä¸€ä¸ªå±€åŸŸç½‘å†…çš„MACåœ°å€æ˜¯å”¯ä¸€çš„ï¼Œå°±OKäº†</p><ul><li>ç›®çš„åœ°å€&#x2F;æºåœ°å€ï¼š48ä½çš„MACåœ°å€ï¼ŒMACæ˜¯æ¯ä¸ªä¸»æœºåœ¨å±€åŸŸç½‘å†…å”¯ä¸€çš„èº«ä»½æ ‡è¯†</li><li>å¸§åè®®ç±»å‹æœ‰ä¸‰ç§å€¼ï¼Œåˆ†åˆ«å¯¹åº”<code>IPã€ARPã€RARP</code>ï¼Œæ‰€ä»¥åªéœ€è¦2ä¸ªå­—èŠ‚</li><li>å¸§æœ«å°¾æ˜¯CRCæ ¡éªŒç ï¼Œ4ä¸ªå­—èŠ‚</li></ul><p>è¿™ä¸‰ä¸ªå°±æ˜¯ä»¥å¤ªç½‘å›ºå®šæ·»åŠ çš„æŠ¥å¤´ï¼Œåœ¨è¿›è¡Œè§£åŒ…çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦å–èµ°æ•°æ®æœ€å‰é¢çš„14ä¸ªå­—èŠ‚ï¼ˆ6+6+2ï¼‰ï¼Œå†ä¸¢å¼ƒæœ«å°¾çš„4ä¸ªå­—èŠ‚ï¼Œå°±èƒ½å–åˆ°ä¸Šå±‚çš„åŸå§‹æ•°æ®ã€‚</p><h2 id="7-3-è®¤è¯†MACåœ°å€"><a href="#7-3-è®¤è¯†MACåœ°å€" class="headerlink" title="7.3 è®¤è¯†MACåœ°å€"></a>7.3 è®¤è¯†MACåœ°å€</h2><ul><li>MACåœ°å€ç”¨æ¥è¯†åˆ«æ•°æ®é“¾è·¯å±‚ä¸­ç›¸è¿çš„èŠ‚ç‚¹ï¼›</li><li>MACåœ°å€é•¿åº¦ä¸º48ä½ï¼ˆ6ä¸ªå­—èŠ‚ï¼‰ä¸€èˆ¬ç”¨åå…­è¿›åˆ¶åŠ ä¸Šå†’å·çš„æ–¹å¼æ¥è¡¨ç¤ºï¼Œä¾‹å¦‚<code>08:00:27:03:fb:19</code></li><li>MACåœ°å€åœ¨ç½‘å¡å‡ºåœºçš„æ—¶å€™å°±ç¡®å®šäº†ï¼Œä¸èƒ½è¢«ä¿®æ”¹ã€‚è™šæ‹Ÿæœºä¸­çš„MACåœ°å€å¹¶ä¸æ˜¯çœŸå®çš„MACåœ°å€ï¼Œå¯èƒ½ä¼šå’Œå·²æœ‰çš„å†²çªï¼ˆä½†è™šæ‹Ÿæœºä¼šæ£€æµ‹å†²çªå¹¶åŠæ—¶ä¿®æ”¹ï¼Œä¸ç„¶è™šæ‹Ÿæœºå°±ä¸Šä¸äº†ç½‘äº†ï¼‰ä¹Ÿæœ‰å¾ˆå°‘éƒ¨åˆ†ç½‘å¡æ”¯æŒç”¨æˆ·é…ç½®MACåœ°å€</li></ul><h3 id="7-3-1-MACåœ°å€å’ŒIPåè®®çš„åŒºåˆ«"><a href="#7-3-1-MACåœ°å€å’ŒIPåè®®çš„åŒºåˆ«" class="headerlink" title="7.3.1 MACåœ°å€å’ŒIPåè®®çš„åŒºåˆ«"></a>7.3.1 MACåœ°å€å’ŒIPåè®®çš„åŒºåˆ«</h3><p>MACåœ°å€å’ŒIPåœ°å€çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p><ul><li>IPåœ°å€æè¿°çš„æ˜¯è·¯é€”æ€»ä½“çš„èµ·ç‚¹å’Œç»ˆç‚¹</li><li>MACåœ°å€æè¿°çš„æ˜¯è·¯é€”ä¸Šæ¯ä¸€ä¸ªå°è·¯ç”±åŒºé—´çš„èµ·ç‚¹å’Œç»ˆç‚¹</li></ul><p>å› ä¸ºæˆ‘ä»¬çš„ä¸»æœºä¸å¯èƒ½çŸ¥é“ä¸€ä¸ªå¾ˆè¿œçš„å†…ç½‘ä¸»æœºçš„MACåœ°å€ï¼Œæ‰€ä»¥å°±éœ€è¦MACåœ°å€åœ¨å°è·¯ç”±åŒºé—´æ¥æ ‡è¯†èµ·ç‚¹å’Œç»ˆç‚¹ï¼Œå¹¶å®ç°æ­£ç¡®çš„æ•°æ®ä¼ è¾“ã€‚</p><h2 id="7-4-MTUå¯¹ä¸Šå±‚çš„å½±å“"><a href="#7-4-MTUå¯¹ä¸Šå±‚çš„å½±å“" class="headerlink" title="7.4 MTUå¯¹ä¸Šå±‚çš„å½±å“"></a>7.4 MTUå¯¹ä¸Šå±‚çš„å½±å“</h2><h3 id="7-4-1-MTUå¯¹IPçš„å½±å“"><a href="#7-4-1-MTUå¯¹IPçš„å½±å“" class="headerlink" title="7.4.1 MTUå¯¹IPçš„å½±å“"></a>7.4.1 MTUå¯¹IPçš„å½±å“</h3><p>åœ¨å‰æ–‡æåˆ°è¿‡ï¼Œä¸ºäº†é¿å…å…‰ç”µä¿¡å·åœ¨ç‰©ç†å±‚ä¼ è¾“çš„æ—¶å€™å‡ºç°å†²çªï¼Œéœ€è¦é™åˆ¶ç½‘ç»œå±‚ç»™æ•°æ®é“¾è·¯å±‚ä¼ è¾“çš„å•æ¬¡çš„æ•°æ®å¤§å°ï¼ŒMTUçš„å…·ä½“è¯´æ˜å¯ä»¥å‚è€ƒæœ¬æ–‡ <a href="#jump1">2.2.1 è®¤è¯†MTU</a>ï¼›</p><p>å› ä¸ºMTUçš„å­˜åœ¨ï¼Œç½‘ç»œå±‚IPåè®®ä¸­éœ€è¦å¯¹è¾ƒå¤§çš„æ•°æ®åŒ…è¿›è¡Œåˆ†åŒ…ï¼ˆIPåˆ†ç‰‡å’Œç»„è£…é—®é¢˜åœ¨ä¸Šæ–‡ä¹Ÿè°ˆè¿‡äº†ï¼Œè¿™é‡Œå°±ä¸é‡å¤äº†ï¼‰</p><p>ä½†å› ä¸ºIPåè®®å±‚åˆ†ç‰‡å’Œç»„è£…å¯¹äºä¼ è¾“å±‚æ¥è¯´æ˜¯ä¸å¯è§çš„ï¼Œå¦‚æœIPåˆ†ç‰‡åå‡ºç°ä¸¢åŒ…å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œé‚£ä¹ˆä¼ è¾“å±‚å°±å¿…é¡»å¾—é‡ä¼ ã€‚æ‰€ä»¥ä¼ è¾“å±‚ä¸ºäº†é¿å…è¿™ç§ä¸å—è‡ªå·±æ§åˆ¶çš„äº‹æƒ…ï¼Œæœ€ç»ˆåˆ†ç‰‡çš„æ“ä½œåº”è¯¥æ˜¯ç”±<strong>ä¼ è¾“å±‚</strong>æ¥è¿›è¡Œå¤„ç†æ‰æ˜¯æœ€å¥½çš„ï¼›</p><h3 id="7-4-2-MTUå¯¹UDPçš„å½±å“"><a href="#7-4-2-MTUå¯¹UDPçš„å½±å“" class="headerlink" title="7.4.2 MTUå¯¹UDPçš„å½±å“"></a>7.4.2 MTUå¯¹UDPçš„å½±å“</h3><p>UDPæœ€å¤§å¯ä»¥ä¼ è¾“æ•°æ®æ˜¯ <code>2^16</code>å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯<code>64KB</code>ï¼Œè€Œ1500å­—èŠ‚æ˜¯<code>1.5KB</code>ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦UDPæºå¸¦çš„æ•°æ®è¶…è¿‡ <code>1472 (1500 - 20 IPé¦–éƒ¨ - 8 UDPé¦–éƒ¨)</code>ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨ç½‘ç»œå±‚è¢«åˆ†ä¸ºå¤šä¸ªIPæ•°æ®æŠ¥ã€‚</p><p>ä¸€æ—¦è¿™ä¸ªæ•°æ®æŠ¥ä¸­æœ‰ä¸€ä¸ªIPæŠ¥æ–‡ä¸¢å¤±äº†ï¼Œé‚£ä¹ˆæ•´ä¸ªUDPæŠ¥æ–‡å°±ä¼šä¸¢å¤±ã€‚å†åŠ ä¸ŠUDPå¹¶æ²¡æœ‰è¶…æ—¶é‡ä¼ æœºåˆ¶ï¼ˆä¸è¿‡å¯ä»¥æ ¹æ®å…·ä½“çš„åè®®æ¥å®šåˆ¶åº”ç­”å’Œé‡ä¼ æœºåˆ¶æ¥ä¿è¯æ•°æ®å¯é æ€§ï¼‰ï¼ŒUDPçš„æŠ¥æ–‡åœ¨IPå±‚ä¸­è¢«åˆ†ç‰‡åä¸¢åŒ…çš„æ¦‚ç‡è¿œå¤§äºTCP</p><h3 id="7-4-3-MTUå¯¹TCPçš„å½±å“"><a href="#7-4-3-MTUå¯¹TCPçš„å½±å“" class="headerlink" title="7.4.3 MTUå¯¹TCPçš„å½±å“"></a>7.4.3 MTUå¯¹TCPçš„å½±å“</h3><ul><li>TCPçš„ä¸€ä¸ªæ•°æ®æŠ¥ä¹Ÿä¸èƒ½æ— é™å¤§ï¼Œè¿˜æ˜¯å—åˆ¶äºMTU</li><li>TCPçš„å•ä¸ªæ•°æ®æŠ¥çš„æœ€å¤§æ¶ˆæ¯é•¿åº¦ï¼Œç§°ä¸º<code>MSS(Max Segment Size)</code>; </li><li>TCPåœ¨å»ºç«‹è¿æ¥çš„è¿‡ç¨‹ä¸­ï¼Œé€šä¿¡åŒæ–¹ä¼šè¿›è¡ŒMSSåå•†ã€‚æœ€ç†æƒ³çš„æƒ…å†µï¼Œ MSSçš„å€¼æ­£å¥½æ˜¯åœ¨IPä¸ä¼šè¢«åˆ†ç‰‡å¤„ç†çš„æœ€å¤§é•¿åº¦(è¿™ä¸ªé•¿åº¦ä»ç„¶æ˜¯å—åˆ¶äºæ•°æ®é“¾è·¯å±‚çš„ MTU)ã€‚</li><li>åŒæ–¹åœ¨å‘é€SYNçš„æ—¶å€™ä¼šåœ¨TCPå¤´éƒ¨å†™å…¥è‡ªå·±èƒ½æ”¯æŒçš„MSSå€¼ã€‚ç„¶ååŒæ–¹å¾—çŸ¥å¯¹æ–¹çš„MSSå€¼ä¹‹åï¼Œé€‰æ‹©è¾ƒå°çš„ä½œä¸ºæœ€ç»ˆMSSï¼Œè¿›è¡Œæ•°æ®ä¼ è¾“ï¼›</li><li>MSSçš„å€¼åœ¨TCPé¦–éƒ¨çš„40å­—èŠ‚å˜é•¿é€‰é¡¹ä¸­ <code>(kind=2)</code>ï¼›</li></ul><p><img src="https://img.musnow.top/i/2023/08/e1f2b9c52380a6bfb16d1e3ccb5c208d.png" alt="image-20230821185112918"></p><p><img src="https://img.musnow.top/i/2023/08/b4f7547b20f6d6207f43f2cee952dd35.png" alt="image-20230821202306869"></p><h2 id="7-5-ARPåè®®"><a href="#7-5-ARPåè®®" class="headerlink" title="7.5 ARPåè®®"></a>7.5 ARPåè®®</h2><h3 id="7-5-1-è¯´æ˜"><a href="#7-5-1-è¯´æ˜" class="headerlink" title="7.5.1 è¯´æ˜"></a>7.5.1 è¯´æ˜</h3><blockquote><p>ARPåè®®å±äºæ•°æ®é“¾è·¯å±‚ï¼Œæ˜¯MACå¸§åè®®çš„ä¸Šå±‚</p></blockquote><p>å› ä¸ºåœ¨å±€åŸŸç½‘å†…çš„ä¼ è¾“æ—¶ï¼Œæˆ‘ä»¬æ˜¯ç”¨macåœ°å€æ¥ä½œä¸ºä¸åŒä¸»æœºçš„æ ‡è¯†ç¬¦çš„ï¼Œæ‰€ä»¥å°±å¿…é¡»å­˜åœ¨ä¸€ä¸ªIPåœ°å€åˆ°MACåœ°å€çš„è½¬æ¢ã€‚</p><p>ARPåè®®ä¹Ÿæ˜¯åŒ…å«åœ¨ä»¥å¤ªç½‘å¸§æ ¼å¼ä¸­çš„ï¼Œå…¶ä¸­å±äºä»–è‡ªå·±çš„æ­£æ–‡åªæœ‰28ä¸ªå­—èŠ‚ï¼›å› ä¸ºMTUé™åˆ¶æœ€å°çš„æ•°æ®é•¿åº¦æ˜¯46å­—èŠ‚ï¼Œæ‰€ä»¥åœ¨å‘é€ARPæŠ¥æ–‡çš„æ—¶å€™ï¼Œéœ€è¦ç»™è¿™ä¸ª28å­—èŠ‚åé¢å¡«è¡¥ç©ºä½ã€‚</p><p><img src="https://img.musnow.top/i/2023/08/2e608f063bce6f728307d40d2aa275d3.png" alt="image-20230821192339835"></p><p>å…ˆæ¥çœ‹çœ‹ARPè¯·æ±‚&#x2F;åº”ç­”ä¸­çš„å„ä¸ªå­—æ®µçš„å«ä¹‰å§</p><ul><li>ç¡¬ä»¶ç±»å‹ï¼šæ ‡å®šåº•å±‚ä½¿ç”¨çš„æ˜¯ä»¥å¤ªç½‘è¿˜æ˜¯å…¶ä»–å¸§æ ¼å¼ï¼Œ1ä¸ºä»¥å¤ªç½‘</li><li>åè®®ç±»å‹ï¼šæŒ‡è¦è½¬æ¢çš„åœ°å€ç±»å‹ï¼Œ<code>0X0800</code>ä¸ºIPåœ°å€</li><li>ç¡¬ä»¶åœ°å€é•¿åº¦ï¼šå¯¹äºä»¥å¤ªç½‘æ¥è¯´ä¸º6å­—èŠ‚ï¼ˆè¿™é‡Œå¡«çš„æ˜¯æ•°å­—6ï¼Œæ‰€ä»¥åªéœ€è¦å ç”¨1ä¸ªå­—èŠ‚ï¼‰ï¼›</li><li>åè®®åœ°å€é•¿åº¦ï¼šå¯¹äºIPåœ°å€æ¥è¯´ä¸º4å­—èŠ‚ï¼ˆåŒä¸Šï¼‰ï¼›</li><li><code>op</code>å­—æ®µä¸º1è¡¨ç¤ºARPè¯·æ±‚ï¼Œ2è¡¨ç¤ºARPåº”ç­”</li></ul><p>å½“æˆ‘ä»¬çš„ä¸»æœºå¼€å§‹å‘é€æŠ¥æ–‡ä¹‹å‰ï¼Œæˆ‘ä»¬çš„ä¸»æœºæ˜¯ä¸çŸ¥é“æŸä¸€ä¸ªIPå¯¹äºçš„ç›®æ ‡ä¸»æœºçš„MACåœ°å€çš„ã€‚æ‰€ä»¥å°±éœ€è¦ç”¨ARPåè®®å‘å±€åŸŸç½‘å†…å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œå¹¶å¾—åˆ°ç›®æ ‡ä¸»æœºçš„ARPå“åº”ï¼Œå“åº”ä¸­å°±åŒ…å«äº†è¯¥ä¸»æœºçš„MACåœ°å€</p><h3 id="7-5-2-ARPè¯·æ±‚-x2F-å“åº”çš„æµç¨‹"><a href="#7-5-2-ARPè¯·æ±‚-x2F-å“åº”çš„æµç¨‹" class="headerlink" title="7.5.2 ARPè¯·æ±‚&#x2F;å“åº”çš„æµç¨‹"></a>7.5.2 ARPè¯·æ±‚&#x2F;å“åº”çš„æµç¨‹</h3><p>ä¸»æœºAéœ€è¦ç»™ä¸»æœºBå‘é€æ•°æ®ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸»æœºBçš„MACåœ°å€ï¼Œå®ƒå°±éœ€è¦å‘èµ·ä¸€ä¸ªARPè¯·æ±‚ï¼š</p><ul><li>ä»¥å¤ªç½‘ç›®çš„åœ°å€å¡«ä¸ºå…¨Fï¼Œä»£è¡¨å¹¿æ’­ï¼›æºåœ°å€å¡«è‡ªå·±çš„MACåœ°å€</li><li>å¸§ç±»å‹å¡«<code>0806</code>ä»£è¡¨ARPåè®®</li><li>ARPä¸­çš„OPå¡«ä¸º1ï¼Œä»£è¡¨æ˜¯ARPè¯·æ±‚</li><li>å‘é€ç«¯ä»¥å¤ªç½‘åœ°å€å’ŒIPåœ°å€å¡«ä¸º<strong>ä¸»æœºA</strong>è‡ªå·±çš„MACåœ°å€å’Œè‡ªå·±çš„IPåœ°å€</li><li>ç›®çš„ä»¥å¤ªç½‘åœ°å€å¡«ä¸ºå…¨Fï¼ŒIPåœ°å€å¡«ä¸ºç›®çš„çš„IPåœ°å€ï¼ˆæ³¨æ„æˆ‘ä»¬æ˜¯çŸ¥é“å¯¹æ–¹IPåœ°å€çš„ï¼‰</li><li>å‘ä¸‹äº¤ä»˜ç»™ä»¥å¤ªç½‘çš„MACå¸§ï¼Œç„¶åé€å…¥å±€åŸŸç½‘</li></ul><p>è¿™ä¸ªARPè¯·æ±‚çš„æŠ¥æ–‡å°±å¼€å§‹åœ¨å±€åŸŸç½‘å†…è¿›è¡Œ<strong>å¹¿æ’­</strong></p><ul><li>æ”¶åˆ°è¿™ä¸ªARPè¯·æ±‚çš„ä¸»æœºåœ¨MACå¸§æ”¶åˆ°ï¼Œå¹¶å‘ä¸Šäº¤ä»˜ç»™è‡ªå·±çš„ARPå±‚</li><li>ARPå±‚å…ˆé€šè¿‡OPä¸º1åˆ¤æ–­æ˜¯ARPçš„è¯·æ±‚</li><li>å–å‡ºè¯·æ±‚ä¸­çš„ç›®çš„IPåœ°å€ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºæœ¬æœºIPåœ°å€ï¼Œä¸æ˜¯åˆ™ä¸¢å¼ƒ</li><li>æ˜¯æœ¬æœºçš„IPåœ°å€ï¼Œä»£è¡¨è¿™ä¸ªæŠ¥æ–‡æ˜¯å‘ç»™è‡ªå·±çš„ARPè¯·æ±‚ï¼Œéœ€è¦æ„é€ ARPå“åº”</li></ul><p>äºæ˜¯<strong>ä¸»æœºB</strong>å°±æ”¶åˆ°äº†è¿™ä¸ªARPè¯·æ±‚ï¼Œå¹¶å¼€å§‹æ„é€ ARPå“åº”</p><ul><li>ä»¥å¤ªç½‘ç›®çš„åœ°å€å¡«ä¸ºARPè¯·æ±‚ä¸­çš„å‘é€ç«¯MACåœ°å€ï¼ŒæºMACåœ°å€å¡«è‡ªå·±çš„</li><li>å¸§ç±»å‹å¡«<code>0806</code>ä»£è¡¨ARPåè®®</li><li>ARPä¸­çš„OPå¡«2ï¼Œä»£è¡¨ARPå“åº”</li><li>å‘é€ç«¯ä»¥å¤ªç½‘åœ°å€å’ŒIPåœ°å€å¡«ä¸º<strong>ä¸»æœºB</strong>è‡ªå·±çš„MACåœ°å€å’Œè‡ªå·±çš„IPåœ°å€</li><li>ç›®çš„ä»¥å¤ªç½‘åœ°å€å¡«ä¸ºAçš„MACåœ°å€ï¼ˆåœ¨ARPè¯·æ±‚ä¸­å¾—çŸ¥çš„ï¼‰IPåœ°å€å¡«ä¸ºç›®çš„ä¸»æœºAçš„IPåœ°å€</li><li>å‘ä¸‹äº¤ä»˜ç»™ä»¥å¤ªç½‘çš„MACå¸§ï¼Œç„¶åé€å…¥å±€åŸŸç½‘</li></ul><p>æ­¤æ—¶è¿™ä¸ªARPçš„å“åº”å°±å¼€å§‹åœ¨å±€åŸŸç½‘ä¸­ä¼ è¾“ï¼Œå› ä¸ºæ­¤æ—¶ä»¥å¤ªç½‘çš„ç›®çš„åœ°å€ä¸å†æ˜¯å…¨Fï¼Œæ‰€ä»¥å„ä¸ªæ”¶åˆ°è¿™ä¸ªæŠ¥æ–‡çš„ä¸»æœºï¼Œ<strong>å°±å¯ä»¥ç›´æ¥é€šè¿‡MACåœ°å€æ¥åˆ¤æ–­æ˜¯å¦æ˜¯å‘ç»™è‡ªå·±çš„MACå¸§</strong>ã€‚å¦‚æœä¸æ˜¯å°±ç›´æ¥ä¸¢å¼ƒï¼Œä¸äº¤ä»˜ç»™ä¸Šå±‚ï¼›</p><p><strong>ä¸»æœºA</strong>åˆ¤æ–­ç›®çš„MACå¸§æ˜¯è‡ªå·±çš„ï¼Œäº¤ä»˜ç»™ä¸Šå±‚çš„ARPåè®®</p><ul><li>åˆ¤æ–­ARPä¸­çš„OPä¸º2ï¼Œä»£è¡¨æ˜¯ARPå“åº”</li><li>å› ä¸ºå‰é¢å·²ç»åˆ¤æ–­è¿‡ç›®çš„MACåœ°å€æ˜¯è‡ªå·±çš„äº†ï¼Œæ‰€ä»¥è¿™æ—¶å€™ä¸éœ€è¦åˆ¤æ–­ARPä¸­çš„ç›®çš„MACå’Œç›®çš„ä¸»æœºIPäº†</li><li>ç›´æ¥å–å‡ºå‘é€ç«¯ä¸»æœºMACå’Œä¸»æœºIPï¼Œå°±èƒ½å¾—åˆ°ä¸»æœºBçš„IPå’ŒMACåœ°å€çš„æ˜ å°„å…³ç³»</li></ul><p>è¿™æ—¶å€™ä¸»æœºAå°±<strong>å¾—åˆ°äº†ä¸»æœºBçš„MACåœ°å€</strong>ï¼Œå¯ä»¥æ­£å¸¸è¿›è¡Œæ•°æ®çš„å‘é€äº†ï¼</p><h3 id="7-5-3-ARPç¼“å­˜ä¸æ›´æ–°"><a href="#7-5-3-ARPç¼“å­˜ä¸æ›´æ–°" class="headerlink" title="7.5.3 ARPç¼“å­˜ä¸æ›´æ–°"></a>7.5.3 ARPç¼“å­˜ä¸æ›´æ–°</h3><ul><li>ä»»ä½•ä¸€å°ä¸»æœºå‘å‡ºçš„ä¸€å®šæ˜¯ARPçš„è¯·æ±‚ï¼›</li><li>æ¥æ”¶åˆ°çš„ARPå¯èƒ½æ˜¯å¯¹æ–¹å‘å¾€å‘é€çš„ARPè¯·æ±‚ï¼Œä¹Ÿå¯èƒ½æ˜¯æˆ‘å‘é€çš„ARPè¯·æ±‚çš„å“åº”ï¼›</li></ul><p>ä½†å¦‚æœæ¯å°ä¸»æœºéƒ½ä¸çŸ¥é“IPå’ŒMACçš„æ˜ å°„å…³ç³»ï¼Œå²‚ä¸æ˜¯æ¯æ¬¡å‘é€æ•°æ®ä¹‹å‰ï¼Œéƒ½éœ€è¦æ¥ä¸ªARPè¯·æ±‚å’Œå“åº”æ¥è·å–å¯¹æ–¹MACåœ°å€ï¼Ÿè¿™æ ·æ•´ä¸ªå±€åŸŸç½‘å†…å°±å¾—è¢«ARPè¯·æ±‚å’Œå“åº”ç»™å¡æ»¡äº†ã€‚</p><p>æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬å‘é€äº†ä¸€ä¸ªARPè¯·æ±‚åï¼Œåº”è¯¥éœ€è¦å°†ARPå“åº”ç»™æš‚æ—¶<strong>ç¼“å­˜</strong>åˆ°æœ¬æœºä¸Šï¼Œé¿å…ä¸‹æ¬¡å‘é€çš„æ—¶å€™ä¸çŸ¥é“å¯¹æ–¹çš„MACåœ°å€ã€‚æ“ä½œç³»ç»Ÿä¸­å°±æœ‰ä¸€å¼ ARPç¼“å­˜è¡¨ï¼Œä¿å­˜äº†å±€åŸŸç½‘å†…éƒ¨åˆ†ä¸»æœºçš„IPå’ŒMACåœ°å€çš„æ˜ å°„å…³ç³»ã€‚</p><blockquote><p>å¦‚æœä¸€ä¸ªä¸»æœºæƒ³è·å–åˆ°å±€åŸŸç½‘å†…æ‰€æœ‰çš„MACåœ°å€ï¼Œå°±å¯ä»¥å†™ä¸ªå¾ªç¯ï¼ŒæŠŠå±€åŸŸç½‘å†…çš„æ‰€æœ‰IPéƒ½å‘é€ä¸€æ¬¡ARPè¯·æ±‚ï¼Œå†å°†æ”¶é›†åˆ°çš„ARPå“åº”ç»™ç¼“å­˜èµ·æ¥ï¼ˆå› ä¸ºå±€åŸŸç½‘å†…çš„ä¸»æœºç½‘ç»œå·éƒ½æ˜¯ç›¸åŒçš„ï¼Œä¸»æœºå·éƒ½æ˜¯æ˜¯ä»1åˆ°254ï¼Œå¹¶ä¸å¤šï¼Œå†™ä¸ªå¾ªç¯å°±è¡Œäº†ï¼‰</p></blockquote><p>ä½†è¿™é‡Œä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæŸå°ä¸»æœºBç¦»å¼€äº†ä½ è¿™ä¸ªå±€åŸŸç½‘ï¼Œä¸»æœºCæ¥å…¥åï¼Œè·¯ç”±å™¨ç»™ä¸»æœºCåˆ†é…äº†åŸæœ¬æ˜¯ç»™ä¸»æœºBç”¨çš„IPï¼Œè¿™æ—¶å€™ä¸»æœºAé‡Œé¢çš„ARPç¼“å­˜è¡¨æ²¡æœ‰æ›´æ–°ï¼Œè¿˜æ˜¯å¡«äº†ä¸»æœºBçš„MACåœ°å€ï¼ˆä½†ä¸»æœºBå…¶å®å·²ç»ä¸åœ¨å±€åŸŸç½‘é‡Œé¢äº†ï¼‰ï¼Œè¿™æ—¶å€™è¿™ä¸ªæŠ¥æ–‡å²‚ä¸æ˜¯æ‰¾ä¸åˆ°ç›®æ ‡ä¸»æœºäº†ï¼Ÿ</p><p>æ‰€ä»¥ARPä¸ä»…ä»…éœ€è¦ç¼“å­˜ï¼Œè¿˜éœ€è¦ä¿æœ‰ä¸€å®šçš„<strong>æ›´æ–°æœºåˆ¶</strong>ï¼šå¯ä»¥è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå®šæ—¶å‘ç¼“å­˜è¡¨ä¸­å·²æœ‰IPçš„ä¸»æœºå‘é€ä¸€æ¡ARPè¯·æ±‚ï¼Œå¹¶å¾—åˆ°å¯¹æ–¹çš„ARPå“åº”ã€‚è¿™æ—¶å€™å°±å¯ä»¥æ¯”å¯¹è¿”å›çš„MACåœ°å€æ˜¯å¦æœ‰å˜åŠ¨ï¼Œæœ‰å˜åŠ¨åˆ™æ›´æ–°ã€‚</p><p>å¦‚æœä¸€ä¸ªARPè¯·æ±‚é•¿æ—¶é—´æ²¡æœ‰å¾—åˆ°å“åº”ï¼Œåˆ™å¯ä»¥è®¤ä¸ºè¯¥IPåœ°å€ç›®å‰æ²¡æœ‰å¯¹åº”çš„ä¸»æœºï¼Œå°†å…¶ä»ç¼“å­˜è¡¨ä¸­åˆ é™¤ã€‚</p><h3 id="7-5-4-ä¸­é—´äººæ”»å‡»"><a href="#7-5-4-ä¸­é—´äººæ”»å‡»" class="headerlink" title="7.5.4 ä¸­é—´äººæ”»å‡»"></a>7.5.4 ä¸­é—´äººæ”»å‡»</h3><p>ä¸Šæ–‡è®²è¿°äº†ARPçš„è¯·æ±‚å’Œå“åº”çš„æ ¼å¼ï¼Œå‡è®¾å‡ºç°äº†ä¸‹é¢çš„è¿™ä¸ªæƒ…å†µï¼š</p><ul><li>ä¸»æœºAæƒ³è·å–ä¸»æœºBçš„MACï¼Œå‘é€ARPè¯·æ±‚å¹¶è·å–åˆ°äº†å“åº”</li><li>ä¸»æœºDæŠŠè‡ªå·±çš„IPä¼ªè£…æˆä¸»æœºBçš„IPï¼Œåˆç»™ä¸»æœºAå‘é€äº†ARPå“åº”</li><li>æ­¤æ—¶ä¸»æœºAæ›´æ–°äº†ARPç¼“å­˜è¡¨ï¼Œå°†ä¸»æœºBçš„IP Bæ˜ å°„ç»™äº†MAC D</li><li>ä¸»æœºDç”¨åŒæ ·çš„åŠæ³•ï¼Œå°†ä¸»æœºBçš„ARPç¼“å­˜è¡¨ä¸­çš„IP Aæ˜ å°„ç»™äº†MAC D</li><li>æ­¤æ—¶ä¸»æœºAç»™Bå‘é€æ¶ˆæ¯ï¼Œå¡«çš„æ˜¯MAC Dï¼›Bç»™Aå‘æ¶ˆæ¯ï¼Œå¡«çš„ä¹Ÿæ˜¯MAC Dï¼›</li><li>ä¸»æœºDåœ¨æ”¶åˆ°Aå’ŒBåŒæ–¹é€šä¿¡çš„æŠ¥æ–‡åï¼Œå…ˆäº¤ä»˜ç»™è‡ªå·±çš„ä¸Šå±‚ï¼Œå†è½¬å‘ç»™å¯¹æ–¹ï¼›</li><li>Aå’ŒBçš„åŒæ–¹é€šä¿¡å°±å‡ºç°äº†ä¸€ä¸ª<strong>ä¸­é—´äººD</strong>ï¼Œæ­¤æ—¶å¦‚æœä½ çš„ä¿¡æ¯ä¸æ˜¯åŠ å¯†çš„ï¼Œé‚£å°±å¯ä»¥è¢«ä¸»æœºDæ‰€çªƒå–ï¼</li></ul><p>è¿™ä¹Ÿæ˜¯ä¸ºå•¥å‡ºç°äº†httpsæ¥é¿å…ä¸­é—´äººæ”»å‡»ï¼</p><h3 id="7-5-5-RARP"><a href="#7-5-5-RARP" class="headerlink" title="7.5.5  RARP"></a>7.5.5  RARP</h3><p>RARPï¼ˆReverse Address Resolution Protocolï¼Œé€†åœ°å€è§£æåè®®ï¼‰æ˜¯ä¸€ç§ç½‘ç»œåè®®ï¼Œç”¨äºåœ¨å±€åŸŸç½‘ï¼ˆLANï¼‰ä¸­é€šè¿‡å·²çŸ¥çš„ç‰©ç†åœ°å€æŸ¥æ‰¾ç›¸åº”çš„IPåœ°å€ã€‚</p><p>ä¸å‰é¢è®²è¿°çš„ARPï¼ˆAddress Resolution Protocolï¼Œåœ°å€è§£æåè®®ï¼‰ä¸åŒï¼ŒARPç”¨äºé€šè¿‡å·²çŸ¥çš„IPåœ°å€æŸ¥æ‰¾ç›¸åº”çš„ç‰©ç†åœ°å€ï¼Œé€šå¸¸ç”¨äºå°†ç½‘ç»œå±‚ï¼ˆIPï¼‰åœ°å€æ˜ å°„åˆ°é“¾è·¯å±‚ï¼ˆMACï¼‰åœ°å€ã€‚<strong>RARPåˆ™æ‰§è¡Œç›¸åçš„æ“ä½œ</strong>ï¼Œå®ƒå…è®¸ä¸»æœºåœ¨å¯åŠ¨æ—¶ä½¿ç”¨å…¶ç‰©ç†åœ°å€æ¥è¯·æ±‚åˆ†é…ç»™å®ƒçš„IPåœ°å€ã€‚</p><p>RARPåè®®åœ¨è¿‡å»çš„è®¡ç®—æœºç½‘ç»œä¸­ç”¨äºåœ¨æ²¡æœ‰äººå·¥é…ç½®çš„æƒ…å†µä¸‹ä¸ºè®¡ç®—æœºåˆ†é…IPåœ°å€ã€‚å½“è®¡ç®—æœºå¯åŠ¨æ—¶ï¼Œå®ƒä¼šå‘ç½‘ç»œå‘é€ä¸€ä¸ªRARPè¯·æ±‚åŒ…ï¼Œå…¶ä¸­åŒ…å«å®ƒçš„ç‰©ç†åœ°å€ï¼ˆMACåœ°å€ï¼‰ï¼Œä»¥è¯·æ±‚åˆ†é…ä¸€ä¸ªIPåœ°å€ã€‚ç½‘ç»œä¸­çš„RARPæœåŠ¡å™¨ä¼šæ¥æ”¶è¿™ä¸ªè¯·æ±‚å¹¶å›å¤åŒ…å«IPåœ°å€çš„RARPå“åº”åŒ…ã€‚</p><p>ç„¶è€Œï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼ŒRARPçš„ä½¿ç”¨é€æ¸å‡å°‘ï¼Œä¸»è¦æ˜¯å› ä¸ºå®ƒçš„å±€é™æ€§ï¼Œä¾‹å¦‚ä¸å¤ªé€‚ç”¨äºå¤§å‹ç½‘ç»œï¼Œä»¥åŠéœ€è¦ç‰¹å®šçš„æœåŠ¡å™¨æ¥ç®¡ç†åœ°å€åˆ†é…ã€‚ç°ä»£çš„ç½‘ç»œé€šå¸¸ä½¿ç”¨DHCPï¼ˆDynamic Host Configuration Protocolï¼ŒåŠ¨æ€ä¸»æœºé…ç½®åè®®ï¼‰æ¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½ï¼Œå®ƒæ›´çµæ´»ä¸”æ˜“äºç®¡ç†ï¼Œå¯ä»¥è‡ªåŠ¨åˆ†é…IPåœ°å€ä»¥åŠå…¶ä»–ç½‘ç»œé…ç½®å‚æ•°ç»™ä¸»æœºã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><h2 id="æ•°æ®é“¾è·¯å±‚"><a href="#æ•°æ®é“¾è·¯å±‚" class="headerlink" title="æ•°æ®é“¾è·¯å±‚"></a>æ•°æ®é“¾è·¯å±‚</h2><ul><li>æ•°æ®é“¾è·¯å±‚çš„ä½œç”¨ï¼šä¸¤ä¸ªè®¾å¤‡(åŒä¸€ç§æ•°æ®é“¾è·¯èŠ‚ç‚¹)ä¹‹é—´è¿›è¡Œä¼ é€’æ•°æ®ï¼›</li><li>ä»¥å¤ªç½‘æ˜¯ä¸€ç§æŠ€æœ¯æ ‡å‡†ï¼›æ—¢åŒ…å«äº†æ•°æ®é“¾è·¯å±‚çš„å†…å®¹ï¼Œ ä¹ŸåŒ…å«äº†ä¸€äº›ç‰©ç†å±‚çš„å†…å®¹ã€‚ ä¾‹å¦‚: è§„å®šäº†ç½‘ç»œæ‹“æ‰‘ç»“æ„, è®¿é—®æ§åˆ¶æ–¹å¼, ä¼ è¾“é€Ÿç‡ç­‰ï¼›</li><li>ä»¥å¤ªç½‘å¸§æ ¼å¼</li><li>ç†è§£macåœ°å€</li><li>ç†è§£arpåè®®</li><li>ç†è§£MTU</li></ul><h2 id="ç½‘ç»œå±‚"><a href="#ç½‘ç»œå±‚" class="headerlink" title="ç½‘ç»œå±‚"></a>ç½‘ç»œå±‚</h2><ul><li>ç½‘ç»œå±‚çš„ä½œç”¨: åœ¨å¤æ‚çš„ç½‘ç»œç¯å¢ƒä¸­ç¡®å®šä¸€ä¸ªåˆé€‚çš„è·¯å¾„. </li><li>ç†è§£IPåœ°å€, ç†è§£IPåœ°å€å’ŒMACåœ°å€çš„åŒºåˆ«</li><li>ç†è§£IPåè®®æ ¼å¼</li><li>äº†è§£ç½‘æ®µåˆ’åˆ†æ–¹æ³•</li><li>ç†è§£å¦‚ä½•è§£å†³IPæ•°ç›®ä¸è¶³çš„é—®é¢˜, æŒæ¡ç½‘æ®µåˆ’åˆ†çš„ä¸¤ç§æ–¹æ¡ˆ</li><li>ç†è§£ç§æœ‰IPå’Œå…¬ç½‘IP</li><li>ç†è§£ç½‘ç»œå±‚çš„IPåœ°å€è·¯ç”±è¿‡ç¨‹</li><li>ç†è§£ä¸€ä¸ªæ•°æ®åŒ…å¦‚ä½•è·¨è¶Šç½‘æ®µåˆ°è¾¾æœ€ç»ˆç›®çš„åœ°</li><li>ç†è§£IPæ•°æ®åŒ…åˆ†åŒ…çš„åŸå› </li><li>äº†è§£NATè®¾å¤‡çš„å·¥ä½œåŸç†</li></ul><h2 id="ä¼ è¾“å±‚"><a href="#ä¼ è¾“å±‚" class="headerlink" title="ä¼ è¾“å±‚"></a>ä¼ è¾“å±‚</h2><ul><li>ä¼ è¾“å±‚çš„ä½œç”¨: è´Ÿè´£æ•°æ®èƒ½å¤Ÿä»å‘é€ç«¯ä¼ è¾“æ¥æ”¶ç«¯</li><li>ç†è§£ç«¯å£å·çš„æ¦‚å¿µ</li><li>è®¤è¯†UDPåè®®, äº†è§£UDPåè®®çš„ç‰¹ç‚¹ã€‚</li><li>è®¤è¯†TCPåè®®ï¼Œç†è§£TCPåè®®çš„å¯é æ€§</li><li>ç†è§£TCPåè®®çš„çŠ¶æ€è½¬åŒ–</li><li>æŒæ¡TCPçš„è¿æ¥ç®¡ç†ï¼Œç¡®è®¤åº”ç­”, è¶…æ—¶é‡ä¼ , æ»‘åŠ¨çª—å£, æµé‡æ§åˆ¶, æ‹¥å¡æ§åˆ¶, å»¶è¿Ÿåº”ç­”, æå¸¦åº”ç­”ç‰¹æ€§</li><li>ç†è§£TCPé¢å‘å­—èŠ‚æµ, ç†è§£ç²˜åŒ…é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ</li><li>èƒ½å¤ŸåŸºäºUDPå®ç°å¯é ä¼ è¾“</li><li>ç†è§£MTUå¯¹UDP&#x2F;TCPçš„å½±å“</li></ul><h2 id="åº”ç”¨å±‚"><a href="#åº”ç”¨å±‚" class="headerlink" title="åº”ç”¨å±‚"></a>åº”ç”¨å±‚</h2><ul><li>åº”ç”¨å±‚çš„ä½œç”¨: æ»¡è¶³æˆ‘ä»¬æ—¥å¸¸éœ€æ±‚çš„ç½‘ç»œç¨‹åº, éƒ½æ˜¯åœ¨åº”ç”¨å±‚</li><li>èƒ½å¤Ÿæ ¹æ®è‡ªå·±çš„éœ€æ±‚ï¼Œè®¾è®¡åº”ç”¨å±‚åè®®</li><li>äº†è§£HTTPåè®®</li><li>ç†è§£DNSçš„åŸç†å’Œå·¥ä½œæµç¨‹</li></ul>]]></content>
    
    
    <summary type="html">IPåè®®</summary>
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ã€ç‰›å®¢ç½‘ã€‘BM001ï¼šç¿»è½¬é“¾è¡¨</title>
    <link href="https://blog.musnow.top/posts/3018206681/"/>
    <id>https://blog.musnow.top/posts/3018206681/</id>
    <published>2023-08-20T09:21:28.000Z</published>
    <updated>2023-08-20T09:21:28.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æ‰“ç®—å¼€å¯æ–°ä¸€è½®åˆ·é¢˜äº†ï¼Œå¿…é¡»å¾—åˆ·äº†ï¼Œå†ä¸åˆ·å°±å¾—æˆåºŸç‰©äº†ã€‚</p><p>ä¹Ÿå¸Œæœ›çœ‹æˆ‘åšå®¢çš„è€å“¥èƒ½ç›‘ç£ä¸€ä¸‹æˆ‘ï¼Œä¸€èµ·è¿›æ­¥å˜›ï¼</p><span id="more"></span><h1 id="é¢˜ç›®BM001"><a href="#é¢˜ç›®BM001" class="headerlink" title="é¢˜ç›®BM001"></a>é¢˜ç›®BM001</h1><p>æ‰“ç®—ä»<a href="https://www.nowcoder.com/exam/oj">ç‰›å®¢ç½‘çš„é¢è¯•top101</a>å¼€å§‹åˆ·èµ·æ¥ï¼Œä»Šå¤©æ˜¯<a href="https://www.nowcoder.com/practice/75e878df47f24fdc9dc3e400ec6058ca?tpId=295&tqId=23286&ru=/exam/oj&qru=/ta/format-top101/question-ranking&sourceUrl=/exam/oj">BM001åè½¬é“¾è¡¨</a></p><blockquote><p>ç»™å®šä¸€ä¸ªå•é“¾è¡¨çš„å¤´ç»“ç‚¹pHead(è¯¥å¤´èŠ‚ç‚¹æ˜¯æœ‰å€¼çš„ï¼Œæ¯”å¦‚åœ¨ä¸‹å›¾ï¼Œå®ƒçš„valæ˜¯1)ï¼Œé•¿åº¦ä¸ºnï¼Œåè½¬è¯¥é“¾è¡¨åï¼Œè¿”å›æ–°é“¾è¡¨çš„è¡¨å¤´ã€‚</p><p>æ•°æ®èŒƒå›´ï¼š <code>0â‰¤nâ‰¤1000</code></p><p>è¦æ±‚ï¼šç©ºé—´å¤æ‚åº¦ <code>O(1)</code> ï¼Œæ—¶é—´å¤æ‚åº¦ <code>O(n) </code>ã€‚</p></blockquote><h1 id="è§£æ³•1ï¼šå¾ªç¯"><a href="#è§£æ³•1ï¼šå¾ªç¯" class="headerlink" title="è§£æ³•1ï¼šå¾ªç¯"></a>è§£æ³•1ï¼šå¾ªç¯</h1><p>æœ€ç®€å•çš„åŠæ³•å°±æ˜¯ç”¨æŒ‡é’ˆæ¥ä¸€ä¸ªä¸€ä¸ªä¿®æ”¹é“¾æ¥ï¼Œæ¯æ¬¡éƒ½å°†å½“å‰èŠ‚ç‚¹çš„nexté“¾æ¥ä¸ºä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œæœ€ç»ˆå†å°†å¼€å¤´çš„èŠ‚ç‚¹ï¼ˆå•ç‹¬å­˜ä¸€ä¸‹åŸæœ¬çš„å¼€å¤´ï¼‰çš„nexté“¾æ¥ä¸ºç©ºï¼Œè¿”å›æœ€åä¸€ä¸ªèŠ‚ç‚¹å³å¯ã€‚</p><p>å¾ˆå¸¸è§„çš„å†™æ³•ï¼Œå‚è€ƒæ³¨é‡Š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode *<span class="title">ReverseList</span><span class="params">(ListNode *head)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// å› ä¸ºéœ€è¦O(1)ç©ºé—´å¤æ‚åº¦ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç”¨å¾ˆè ¢çš„å°†æ•°æ®éå†å‡ºæ¥åå€’åºæ”¾å›çš„åŠæ³•</span></span><br><span class="line">        <span class="comment">// æ—¶é—´å¤æ‚åº¦æ˜¯O(N) ä¹Ÿè¦æ±‚æˆ‘ä»¬å†™çš„ä»£ç ç›¸å¯¹æ¥è¯´æ•ˆç‡éœ€è¦é«˜ä¸€äº›</span></span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">nullptr</span> || head-&gt;next == <span class="literal">nullptr</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> head; <span class="comment">// åªæœ‰ä¸€ä¸ªæˆ–è€…ä¸ºç©ºçš„æƒ…å†µä¸‹ï¼Œç›´æ¥è·³è¿‡</span></span><br><span class="line">        &#125;</span><br><span class="line">        ListNode *old_head = head; <span class="comment">// å•ç‹¬å­˜å¤´</span></span><br><span class="line">        ListNode *A, *B, *C;       <span class="comment">// ä¸‰ä¸ªæŒ‡é’ˆ</span></span><br><span class="line">        A = head;</span><br><span class="line">        B = head-&gt;next;</span><br><span class="line">        C = head-&gt;next-&gt;next;</span><br><span class="line">        <span class="keyword">while</span> (C != <span class="literal">nullptr</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Bä¿®æ”¹é“¾æ¥ä¸ºBçš„å‰ä¸€ä¸ªï¼ˆAåœ¨åŸè§†é“¾è¡¨ä¸­æ˜¯Bçš„å‰ä¸€ä¸ªï¼‰</span></span><br><span class="line">            B-&gt;next = A;</span><br><span class="line">            A = B;       <span class="comment">// Aå˜æˆBï¼ˆä¹Ÿç›¸å½“äºAåœ¨åŸè§†é“¾è¡¨ä¸­ï¼Œå¾€åèµ°ä¸€æ­¥ï¼‰</span></span><br><span class="line">            B = C;       <span class="comment">// Bå¾€åèµ°ä¸€æ­¥</span></span><br><span class="line">            C = C-&gt;next; <span class="comment">// Cå¾€åèµ°ä¸€æ­¥</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// èµ°åˆ°è¿™é‡Œæ˜¯Bçš„ä¸‹ä¸€ä¸ªCå·²ç»ä¸ºnullptrï¼Œä»£è¡¨Bæ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        B-&gt;next = A; <span class="comment">// ä¾æ—§æ˜¯é“¾æ¥</span></span><br><span class="line">        old_head-&gt;next = <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="keyword">return</span> B; <span class="comment">// Bæ˜¯åŸè§†é“¾è¡¨çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ–°é“¾è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="è§£æ³•2ï¼šé€’å½’"><a href="#è§£æ³•2ï¼šé€’å½’" class="headerlink" title="è§£æ³•2ï¼šé€’å½’"></a>è§£æ³•2ï¼šé€’å½’</h1><p>ä¸€èˆ¬é¢è¯•çš„æ—¶å€™ï¼Œé¢è¯•å®˜æ›´å¸Œæœ›çœ‹åˆ°é€’å½’çš„åŠæ³•ï¼Œå› ä¸ºè¿™æ ·çš„ä»£ç æ›´åŠ ç®€æ´ï¼Œæ€è·¯ä¹Ÿæ›´åŠ æœ‰æŒ‘æˆ˜æ€§ï¼ˆåæ­£ä½ å°±è¦å¾€éš¾çš„åŠæ³•æƒ³ï¼‰</p><p>é€’å½’çš„æ€è·¯ä¹Ÿæ˜¯è®©ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„nexté“¾æ¥ä¸ºå½“å‰èŠ‚ç‚¹ã€‚ä¸»è¦åœ¨äºé€’å½’çš„æœ«ç«¯æ¡ä»¶åº”è¯¥æ˜¯<code>head-&gt;next==nullptr</code>çš„æ—¶å€™å°±éœ€è¦é€€å‡ºäº†ï¼Œå› ä¸ºæ­¤æ—¶ <code>head-&gt;next-&gt;next</code>æ˜¯æ— æ•ˆçš„ï¼Œæ²¡æœ‰åŠæ³•è¿›è¡Œé“¾æ¥ã€‚</p><p>æ•´ä¸ªè¿‡ç¨‹å¤§æ¦‚å°±æ˜¯ä¸‹é¢è¿™ä¸ªç®€å›¾äº†ï¼Œå…¶ä¸­æ–¹æ¡†ä»£è¡¨çš„æ˜¯èŠ‚ç‚¹ï¼Œåœ†å½¢ä»£è¡¨æ¯ä¸€æ­¥</p><p><img src="https://img.musnow.top/i/2023/08/4c5f69a4fcc4d859b3623b22ad5039fb.png" alt="image-20230820175040338"></p><p>ä¸Šä»£ç ï¼Œè¿™é‡Œå°† <code>head-&gt;next = NULL;</code>æ˜¯ä¸ºäº†æ“ä½œç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆåŸè§†é“¾è¡¨çš„é¦–èŠ‚ç‚¹ï¼‰çš„æ—¶å€™ï¼Œå°†ä¸‹ä¸€ä½æ”¹æˆç©ºã€‚è€Œåœ¨ä¸­é—´èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå› ä¸ºå½“å‰èŠ‚ç‚¹çš„nextä¼šåœ¨<strong>ä¸Šä¸€å±‚é€’å½’</strong>çš„æ—¶å€™è¢«ä¿®æ”¹å›å»ï¼Œæ‰€ä»¥è®¾ç½®ä¸ºç©ºä¸ä¼šå‡ºç°é—®é¢˜ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ListNode *<span class="title">ReverseList</span><span class="params">(ListNode *head)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ç‰¹åˆ¤ï¼šæ³¨æ„ä¸è¦æ¼æ‰head-&gt;next==NULLçš„æƒ…å†µ</span></span><br><span class="line">    <span class="keyword">if</span> (head == <span class="literal">NULL</span> || head-&gt;next == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é€’å½’è°ƒç”¨</span></span><br><span class="line">    ListNode *ans = <span class="built_in">ReverseList</span>(head-&gt;next);</span><br><span class="line">    <span class="comment">// è®©å½“å‰ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹çš„ next æŒ‡é’ˆæŒ‡å‘å½“å‰èŠ‚ç‚¹</span></span><br><span class="line">    head-&gt;next-&gt;next = head;</span><br><span class="line">    <span class="comment">// åŒæ—¶è®©å½“å‰ç»“ç‚¹çš„ next æŒ‡é’ˆæŒ‡å‘NULL ï¼Œä»è€Œå®ç°ä»é“¾è¡¨å°¾éƒ¨å¼€å§‹çš„å±€éƒ¨åè½¬</span></span><br><span class="line">    head-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä»Šå¤©æ‰“ç®—å¼€å¯æ–°ä¸€è½®åˆ·é¢˜äº†ï¼Œå¿…é¡»å¾—åˆ·äº†ï¼Œå†ä¸åˆ·å°±å¾—æˆåºŸç‰©äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå¸Œæœ›çœ‹æˆ‘åšå®¢çš„è€å“¥èƒ½ç›‘ç£ä¸€ä¸‹æˆ‘ï¼Œä¸€èµ·è¿›æ­¥å˜›ï¼&lt;/p&gt;</summary>
    
    
    
    <category term="æŠŠé¢˜ç›®éƒ½ç»™åˆ·å¹²å‡€" scheme="https://blog.musnow.top/categories/%E6%8A%8A%E9%A2%98%E7%9B%AE%E9%83%BD%E7%BB%99%E5%88%B7%E5%B9%B2%E5%87%80/"/>
    
    
    <category term="Cè¯­è¨€" scheme="https://blog.musnow.top/tags/C%E8%AF%AD%E8%A8%80/"/>
    
    <category term="OJåˆ·é¢˜" scheme="https://blog.musnow.top/tags/OJ%E5%88%B7%E9%A2%98/"/>
    
    <category term="ç‰›å®¢ç½‘" scheme="https://blog.musnow.top/tags/%E7%89%9B%E5%AE%A2%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>ã€C++11ã€‘futureå’Œasyncç­‰</title>
    <link href="https://blog.musnow.top/posts/2885143113/"/>
    <id>https://blog.musnow.top/posts/2885143113/</id>
    <published>2023-08-19T02:55:38.000Z</published>
    <updated>2023-08-19T09:55:38.000Z</updated>
    
    <content type="html"><![CDATA[<p>C++11çš„futureå’Œasyncç­‰å…³é”®å­—</p><span id="more"></span><h1 id="1-asyncå’Œfutureçš„æ¦‚å¿µ"><a href="#1-asyncå’Œfutureçš„æ¦‚å¿µ" class="headerlink" title="1.asyncå’Œfutureçš„æ¦‚å¿µ"></a>1.asyncå’Œfutureçš„æ¦‚å¿µ</h1><p><code>std::async</code> å’Œ <code>std::future</code> æ˜¯ C++11 å¼•å…¥çš„æ ‡å‡†åº“åŠŸèƒ½ï¼Œç”¨äºå®ç°å¼‚æ­¥ç¼–ç¨‹ï¼Œä½¿å¾—åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­æ›´å®¹æ˜“å¤„ç†å¹¶è¡Œä»»åŠ¡ã€‚å®ƒä»¬å¯ä»¥å¸®åŠ©ä½ åœ¨ä¸åŒçº¿ç¨‹ä¸­æ‰§è¡Œå‡½æ•°ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ–¹ä¾¿åœ°è·å–å‡½æ•°çš„ç»“æœã€‚</p><p>åœ¨ä¹‹å‰ä½¿ç”¨çº¿ç¨‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•å¾ˆå¥½çš„è·å–åˆ°çº¿ç¨‹æ‰€æ‰§è¡Œå‡½æ•°çš„è¿”å›å€¼ã€‚ç”šè‡³æ›´å¤šæ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨çº¿ç¨‹æ‰§è¡Œçš„éƒ½æ˜¯ä¸å…³å¿ƒè¿”å›å€¼çš„å‡½æ•°ã€‚å¦‚æœçœŸçš„æƒ³è¦è·å–çº¿ç¨‹å‡½æ•°çš„è¿”å›å€¼ï¼Œå¯ä»¥å°†ä¸€ä¸ªæŒ‡é’ˆä½œä¸ºè¾“å‡ºå‹å‚æ•°æ”¾å…¥çº¿ç¨‹æ‰€æ‰§è¡Œçš„å‡½æ•°ä¸­ã€‚ä¸»æ‰§è¡Œæµæ‰§è¡Œ<code>t.join()</code>ç­‰å¾…çº¿ç¨‹æ‰§è¡Œç»“æŸï¼Œå¹¶è·å–åˆ°è¿™ä¸ªè¿”å›å€¼ã€‚</p><p>ä½†è¿™æ ·å¹¶ä¸æ˜¯éå¸¸æ–¹ä¾¿ã€‚äºæ˜¯C++11å°±å¼•å…¥äº†å¦‚ä¸Šä¸¤ä¸ªå…³é”®å­—æ¥å¸®åŠ©æˆ‘ä»¬è·å–åˆ°çº¿ç¨‹æ‰€æ‰§è¡Œå‡½æ•°çš„è¿”å›å€¼ã€‚é€‚ç”¨äºå¼‚æ­¥æ‰§è¡ŒæŸäº›è€—æ—¶çš„å‡½æ•°ï¼Œæé«˜ç¨‹åºè¿è¡Œçš„æ•ˆç‡ï¼š</p><ul><li>å¼‚æ­¥æ‰§è¡Œè€—æ—¶å‡½æ•°</li><li>ä¸»æ‰§è¡Œæµå¹²å…¶ä»–äº‹æƒ…</li><li>é€šè¿‡<code>std::future</code>è·å–åˆ°è¿”å›å€¼</li><li>ç»§ç»­å‘åæ‰§è¡Œ</li></ul><p>åŸºæœ¬çš„å¹¶è¡Œæ¦‚å¿µåœ¨å¤šçº¿ç¨‹éƒ¨åˆ†éƒ½å·²ç»è®²è¿‡äº†ï¼Œè¿™é‡Œå°±ä¸å¤šbbï¼Œç›´æ¥ä¸Šä»£ç å§ï¼</p><h1 id="2-ä½¿ç”¨"><a href="#2-ä½¿ç”¨" class="headerlink" title="2.ä½¿ç”¨"></a>2.ä½¿ç”¨</h1><h2 id="2-1-std-launch"><a href="#2-1-std-launch" class="headerlink" title="2.1 std::launch"></a>2.1 std::launch</h2><p>åœ¨ä½¿ç”¨<code>std::async</code>ä¹‹å‰ï¼Œè¿˜éœ€è¦è®¤è¯†ä¸€ä¸ªæšä¸¾ç±»å‹ <a href="https://legacy.cplusplus.com/reference/future/launch/">launch</a>ï¼Œåœ¨ä½¿ç”¨<code>std::async</code>çš„å‡½æ•°ä¼ å‚çš„æ—¶å€™ä¼šç”¨åˆ°ï¼ˆè¿™é‡Œå…ˆè¯´ä¸€ä¸‹ï¼Œ<code>std::async</code>æ˜¯ç”¨æ¥å¸®æˆ‘ä»¬åˆ›å»ºçº¿ç¨‹çš„ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum class</span> <span class="title class_">launch</span>; <span class="comment">// std::launch</span></span><br></pre></td></tr></table></figure><p>åœ¨ <code>cplusplus</code>ç½‘ç«™ä¸Šï¼Œæœ‰è¿™ä¸ªæšä¸¾ç±»å‹çš„é‡Šä¹‰ï¼Œè¿™é‡Œé¢åªæœ‰ä¿©å€¼</p><p><img src="https://img.musnow.top/i/2023/08/d4827a8d362281d078e27fea12c949c5.png" alt="image-20230819111941932"></p><p>è¯´ä¸€ä¸‹è¿™ä¿©å€¼çš„åŒºåˆ«</p><ul><li><code>launch::async</code>ï¼Œç«‹å³åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œç›®æ ‡å‡½æ•°</li><li><code>launch::deferred</code>ï¼Œä¸ç«‹å³åˆ›å»ºçº¿ç¨‹ï¼Œè€Œæ˜¯ç­‰å¾…è°ƒç”¨<code>std::future</code>çš„<code>get()</code>å‡½æ•°æ—¶æ‰è°ƒç”¨ï¼ˆè¿™ä¸ªgetå‡½æ•°æ˜¯ç”¨æ¥è·å–è¿”å›å€¼çš„ï¼‰</li></ul><p>å¥½äº†çŸ¥é“è¿™ä¸ªå°±å¤Ÿäº†å“ˆï¼</p><h2 id="2-2-std-result-of"><a href="#2-2-std-result-of" class="headerlink" title="2.2 std::result_of"></a>2.2 std::result_of</h2><p>è¿™é‡Œè¿˜å‡ºç°äº†å¦å¤–ä¸€ä¸ªå…³é”®å­—ï¼Œå°±é¡ºå¸¦ä¹Ÿè¯´è¯´æ˜¯å¹²å˜›çš„ï¼ˆå…¶å®æˆ‘è‡ªå·±ä¹Ÿä¸çŸ¥é“ï¼Œç°å­¦ç°å–ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span> <span class="comment">// å¤´æ–‡ä»¶</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Fn</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">result_of</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Fn</span>, <span class="keyword">class</span>... ArgTypes&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">result_of</span>&lt;<span class="built_in">Fn</span>(ArgTypes...)&gt;;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯ <code>std::result_of</code> çš„åŸºæœ¬ç”¨æ³•å’Œæ¦‚å¿µï¼š</p><ol><li><strong>ä½¿ç”¨ <code>std::result_of</code> è·å–å‡½æ•°è°ƒç”¨çš„è¿”å›ç±»å‹ï¼š</strong> ä½ å¯ä»¥é€šè¿‡å°†å‡½æ•°ç±»å‹å’Œå‚æ•°ç±»å‹ä¼ é€’ç»™ <code>std::result_of</code> æ¥æ¨å¯¼å‡½æ•°è°ƒç”¨çš„è¿”å›ç±»å‹ã€‚è¿™ä½¿å¾—ä½ å¯ä»¥åœ¨ç¼–è¯‘æ—¶è·å–å‡½æ•°è°ƒç”¨çš„ç»“æœç±»å‹ï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨æŒ‡å®šå®ƒã€‚</li><li><strong>ç”¨æ³•ç¤ºä¾‹ï¼š</strong> å‡è®¾æœ‰ä¸€ä¸ªå‡½æ•° <code>int add(int a, int b)</code>ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>std::result_of</code> æ¥è·å–è¯¥å‡½æ•°åœ¨ç»™å®šå‚æ•°ä¸‹çš„è¿”å›ç±»å‹ã€‚</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::result_of&lt;<span class="keyword">decltype</span>(add) &amp;(<span class="type">int</span>, <span class="type">int</span>)&gt;::type result = <span class="built_in">add</span>(<span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Result: &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ g++ test.cpp -o test -std=c++11</span><br><span class="line">$ ./test</span><br><span class="line">Result: 8</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨<code>decltype</code>å…³é”®å­—æ¥æŒ‡å®šå‡½æ•°æŒ‡é’ˆçš„æ—¶å€™ï¼Œå‡½æ•°åå’Œå‡½æ•°å‚æ•°ä¹‹é—´éœ€è¦åŠ ä¸Š<code>&amp;</code>ï¼Œå¦åˆ™æ— æ³•æ­£ç¡®æ¨å¯¼ç±»å‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">decltype</span>(add) &amp;(<span class="type">int</span>, <span class="type">int</span>) <span class="comment">// æ­£ç¡®</span></span><br><span class="line"><span class="keyword">decltype</span>(add) (<span class="type">int</span>, <span class="type">int</span>) <span class="comment">// é”™è¯¯    </span></span><br></pre></td></tr></table></figure><h2 id="2-3-async"><a href="#2-3-async" class="headerlink" title="2.3 async"></a>2.3 async</h2><p>å…ˆæ¥çœ‹çœ‹asyncå‡½æ•°çš„æ ·æœ¬ï¼Œç¬¬ä¸€ä¸ªæƒ…å†µæ˜¯ä¸æ˜¾ç¤ºä¼ å…¥ <code>std::launch</code>ï¼Œç¬¬äºŒä¸ªå‡½æ•°é‡è½½æ˜¯ä¼ å…¥äº†<code>std::launch</code>ä½œä¸ºå¯åŠ¨ç­–ç•¥</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;future&gt;</span> <span class="comment">// å¤´æ–‡ä»¶</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// unspecified policy (1)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Fn</span>, <span class="keyword">class</span>... Args&gt;</span><br><span class="line">  future&lt;<span class="keyword">typename</span> result_of&lt;<span class="built_in">Fn</span>(Args...)&gt;::type&gt;</span><br><span class="line">    <span class="built_in">async</span> (Fn&amp;&amp; fn, Args&amp;&amp;... args);</span><br><span class="line"><span class="comment">// specific policy (2)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Fn</span>, <span class="keyword">class</span>... Args&gt;</span><br><span class="line">  future&lt;<span class="keyword">typename</span> result_of&lt;<span class="built_in">Fn</span>(Args...)&gt;::type&gt;</span><br><span class="line">    <span class="built_in">async</span> (launch policy, Fn&amp;&amp; fn, Args&amp;&amp;... args);</span><br></pre></td></tr></table></figure><p>åœ¨cplusplusç½‘ç«™ä¸Šï¼Œè¯´åˆ°äº†ç¬¬ä¸€ç§æƒ…å†µæ˜¯ç”±ç¼–è¯‘å™¨<strong>è‡ªä¸»å†³å®š</strong>åˆ°åº•æ˜¯é‡‡ç”¨ <code>std::launch::async</code> æˆ– <code>std::launch::deferred</code>ï¼Œè¿™å°±éœ€è¦æ ¹æ®å¹³å°å’Œç¼–è¯‘å™¨å®ç°ä»¥åŠè°ƒç”¨é€»è¾‘çš„ä¸åŒæ¥å…·ä½“åˆ†æäº†ã€‚æ‰€ä»¥ä¸å»ºè®®ä½¿ç”¨ç¬¬ä¸€ä¸ªï¼Œè¿˜æ˜¯ç›´æ¥æŒ‡å®š<code>launch policy</code>ï¼ˆç¿»è¯‘è¿‡æ¥æ˜¯å¯åŠ¨ç­–ç•¥ï¼‰çš„ä¼šå¥½ä¸€ç‚¹ã€‚</p><p>æ‰€ä»¥åªçœ‹ç¬¬äºŒä¸ªğŸ‘‡</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Fn</span>, <span class="keyword">class</span>... Args&gt;</span><br><span class="line">  future&lt;<span class="keyword">typename</span> result_of&lt;<span class="built_in">Fn</span>(Args...)&gt;::type&gt;</span><br><span class="line">    <span class="built_in">async</span> (launch policy, Fn&amp;&amp; fn, Args&amp;&amp;... args);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé‡‡ç”¨äº†å¯å˜æ¨¡æ¿å‚æ•°æ¥æ¥æ”¶å¤šä¸ªå‡½æ•°å‚æ•°ï¼Œç±»ä¼¼äºå¯å˜å‚æ•°åˆ—è¡¨ã€‚è¿™é‡Œè¿˜ä½¿ç”¨äº†<code>typename</code>å…³é”®å­—æ¥å‘ŠçŸ¥ç¼–è¯‘å™¨<code>result_of&lt;Fn(Args...)&gt;::type</code>æ˜¯ä¸€ä¸ªå‚æ•°ç±»å‹ï¼Œéœ€è¦åœ¨æ¨¡æ¿å®ä¾‹åŒ–äº†ä¹‹åå†å»è·å–ç¡®å®šçš„ç±»å‹ã€‚è€Œ<code>class Fn</code>æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆçš„æ¨¡æ¿å˜é‡ã€‚</p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<code>std::launch</code>ï¼Œä¸Šæ–‡å·²ç»æåˆ°è¿‡ä¸¤ä¸ªä¸åŒé€‰é¡¹çš„åŒºåˆ«äº†</li><li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯å‡½æ•°ï¼Œç›´æ¥ä¸¢å‡½æ•°åå°±å¯ä»¥äº†</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¿™ä¸ªå‡½æ•°çš„å‚æ•°ï¼Œä¹Ÿæ˜¯ç›´æ¥ä¸¢å‚æ•°å°±å¯ä»¥äº†</li></ul><p>å¦‚ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„è°ƒç”¨ç¤ºä¾‹ï¼ˆå¹¶éå®Œæ•´ç¤ºä¾‹ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;future&gt;</span> <span class="comment">// å¤´æ–‡ä»¶</span></span></span><br><span class="line"><span class="comment">// å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è°ƒç”¨</span></span><br><span class="line">std::<span class="built_in">async</span>(std::launch::async, add, <span class="number">3</span>, <span class="number">5</span>);</span><br></pre></td></tr></table></figure><p>è°ƒç”¨äº†è¿™ä¸ªå‡½æ•°åï¼ŒCPPä¼šå¸®æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œå‡½æ•°ï¼Œå¹¶æ ¹æ®ç¬¬ä¸€ä¸ªå¯åŠ¨å‚æ•°çš„ä¸åŒï¼Œå†³å®šå•¥æ—¶å€™åˆ›å»ºè¿™ä¸ªçº¿ç¨‹ã€‚æœ€ç»ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>future</code>è·å–åˆ°çº¿ç¨‹æ‰§è¡Œå‡½æ•°çš„è¿”å›å€¼ã€‚</p><h2 id="2-4-future"><a href="#2-4-future" class="headerlink" title="2.4 future"></a>2.4 future</h2><p>äººå¦‚å…¶åï¼Œè¿™ä¸ªç±»å‹æ˜¯ç”¨æ¥å£°æ˜ä¸€ä¸ª<code>æœªæ¥</code>çš„å˜é‡çš„ã€‚å› ä¸º<code>std::async</code>ä¼šå¸®æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œå‡½æ•°ï¼Œæ­¤æ—¶è¯¥çº¿ç¨‹å‡½æ•°çš„è¿”å›å€¼æ˜¯æœªçŸ¥çš„ï¼Œè¿™ä¸ªæœªæ¥å˜é‡å°±æ˜¯æå‰çš„ä¸€ä¸ªå£°æ˜ï¼Œå½“çº¿ç¨‹æ‰§è¡Œå®Œæ¯•å‡½æ•°å¹¶è¿”å›å€¼çš„æ—¶å€™ï¼Œè¿™ä¸ªå˜é‡çš„å€¼æ‰çœŸæ­£è¢«åˆå§‹åŒ–ä¸ºæˆ‘ä»¬çœŸæ­£éœ€è¦çš„é‚£ä¸ªå€¼ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;  future;</span><br><span class="line"><span class="comment">// specialization : T is a reference type (R&amp;)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">R</span>&amp;&gt; future&lt;R&amp;&gt;;     </span><br><span class="line"><span class="comment">// specialization : T is void</span></span><br><span class="line"><span class="keyword">template</span> &lt;&gt;         future&lt;<span class="type">void</span>&gt;;  </span><br></pre></td></tr></table></figure><p>å…¶æœ‰å¦‚ä¸‹å‡ ä¸ªæˆå‘˜å‡½æ•°</p><ul><li>getï¼šè·å–å¯¹åº”asyncæ‰€æ‰§è¡Œå‡½æ•°çš„è¿”å›å€¼ï¼Œå¦‚æœå‡½æ•°æ²¡æœ‰æ‰§è¡Œå®Œæ¯•åˆ™é˜»å¡ç­‰å¾…</li><li>validï¼šboolï¼Œåˆ¤æ–­å½“å‰futureç±»å‹åˆ°åº•æœ‰æ²¡æœ‰å’Œä¸€ä¸ªasyncå‡½æ•°æ‰€å¯¹åº”</li><li>shareï¼šå°†<code>future</code>å¯¹è±¡è½¬æˆä¸€ä¸ª<code>std::shared_future</code>å¯¹è±¡</li><li>waitï¼šç­‰å¾…å¼‚æ­¥ä»»åŠ¡å®Œæˆï¼Œä½†ä¸è·å–ç»“æœ</li><li>wait_forï¼šç­‰å¾…å¼‚æ­¥ä»»åŠ¡å®Œæˆï¼Œä½†æœ‰ç­‰å¾…çš„æ—¶é•¿ï¼ˆæ²¡ç­‰åˆ°å°±è¿”å›é”™è¯¯ï¼‰</li><li>wait_untilï¼šç­‰å¾…å¼‚æ­¥ä»»åŠ¡å®Œæˆï¼Œç›´åˆ°ä¸€ä¸ªç¡®å®šçš„æ—¶é—´ï¼ˆæ²¡ç­‰åˆ°å°±è¿”å›é”™è¯¯ï¼‰</li></ul><p>åé¢ä¸‰ä¸ªwaitå‡½æ•°å’ŒCPPçº¿ç¨‹ä¸­çš„waitå‡½æ•°å¦‚å‡ºä¸€è¾™ã€‚</p><h2 id="2-5-share-future"><a href="#2-5-share-future" class="headerlink" title="2.5 share_future"></a>2.5 share_future</h2><p><code>share_future</code>å°±å¥½æ¯”<code>share_ptr</code>æ™ºèƒ½æŒ‡é’ˆï¼Œå…¶è®©<code>future</code>å¯¹è±¡ä»å•ä¸€æ‰€æœ‰æƒå˜æˆäº†å¤šäººå¯ç”¨ã€‚æœ¬æ¥æ˜¯ä¸€ä¸ªåªèƒ½åä¸€äººçš„é¤æ¡Œï¼Œç°åœ¨å˜æˆäº†å¯ä»¥åå¾ˆå¤šäººçš„å¤§æ¡Œå­ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;  shared_future;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">R</span>&amp;&gt; shared_future&lt;R&amp;&gt;;   <span class="comment">// specialization : T is a reference type (R&amp;)</span></span><br><span class="line"><span class="keyword">template</span> &lt;&gt;         shared_future&lt;<span class="type">void</span>&gt;; <span class="comment">// specialization : T is void</span></span><br></pre></td></tr></table></figure><p>æˆå‘˜å‡½æ•°å’Œ<code>future</code>å®Œå…¨ä¸€æ ·ï¼ˆåªä¸è¿‡ä¹ˆæœ‰<code>share()</code>å‡½æ•°ï¼‰è¿™é‡Œå°±ä¸èµ˜è¿°äº†ï¼›</p><ul><li><code>future</code>æ˜¯å•äººé¤æ¡Œï¼Œä¸€æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œgetå‡½æ•°ï¼›å½“getè¢«æ‰§è¡Œåï¼Œè¿™ä¸ªfutureä¼š<strong>å¤±æ•ˆ</strong>ã€‚</li><li><code>share_future</code>æ˜¯å¤§æ¡Œå­ï¼Œæ‰€æœ‰äººä¸€èµ·ååœ¨è¿™ä¸ªæ¡Œå­ä¸Šç­‰æœåŠ¡å‘˜ä¸Šèœï¼Œäº’ä¸å¹²æ‰°ï¼›</li></ul><h2 id="2-5-æµ‹è¯•"><a href="#2-5-æµ‹è¯•" class="headerlink" title="2.5 æµ‹è¯•"></a>2.5 æµ‹è¯•</h2><h3 id="2-5-1-æ­£å¸¸æµ‹è¯•"><a href="#2-5-1-æ­£å¸¸æµ‹è¯•" class="headerlink" title="2.5.1 æ­£å¸¸æµ‹è¯•"></a>2.5.1 æ­£å¸¸æµ‹è¯•</h3><p>å¦‚ä¸‹ä»£ç æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨ç¤ºä¾‹ï¼Œå¹¶ä¸”é€šè¿‡æä¾›ä¸åŒçš„<code>std::launch</code>å¯åŠ¨ç­–ç•¥ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½è§‚å¯Ÿåˆ°ä¸åŒçš„ç°è±¡</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;future&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span> <span class="comment">// result_of</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/unistd.h&gt;</span> <span class="comment">//sleep</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Add  Thread &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; | Sleeping before add...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Main Thread &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; | Start&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="comment">//std::future&lt;int&gt; futureResult = std::async(std::launch::deferred, add, 3, 5); // ä¸ä¼šåˆ›å»ºæ–°çº¿ç¨‹</span></span><br><span class="line">    std::future&lt;<span class="type">int</span>&gt; futureResult = std::<span class="built_in">async</span>(std::launch::async, add, <span class="number">3</span>, <span class="number">5</span>); <span class="comment">// åˆ›å»ºæ–°çº¿ç¨‹</span></span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">3</span>); </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Main Thread &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; | Waiting for result...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="type">int</span> result = futureResult.<span class="built_in">get</span>();  <span class="comment">// ç­‰å¾…å¼‚æ­¥ä»»åŠ¡å®Œæˆå¹¶è·å–ç»“æœ</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Main Thread &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; | Result: &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">3</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨<code>std::launch::async</code>ä½œä¸ºå¯åŠ¨ç­–ç•¥ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ‰§è¡Œaddå‡½æ•°çš„çº¿ç¨‹idå’Œä¸»çº¿ç¨‹çš„idæ˜¯ä¸åŒçš„ï¼Œé€šè¿‡linuxä¸‹çš„<code>ps -aL</code>å‘½ä»¤ä¹Ÿèƒ½è§‚å¯Ÿåˆ°å‡ºç°ä¸¤ä¸ªçº¿ç¨‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> :; <span class="keyword">do</span> ps jax | <span class="built_in">head</span> -1 &amp;&amp; ps -aL |  grep -v grep;<span class="built_in">sleep</span> 1; <span class="built_in">echo</span> <span class="string">&quot;########################&quot;</span>; <span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>ç¨‹åºæ‰§è¡Œè¾“å‡ºç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Main Thread 139869475694400 | Start</span><br><span class="line">Add  Thread 139869457655552 | Sleeping before add...</span><br><span class="line">Main Thread 139869475694400 | Waiting for result...</span><br><span class="line">Main Thread 139869475694400 | Result: 8</span><br></pre></td></tr></table></figure><p>ä½†å¦‚æœä½¿ç”¨<code>std::launch::deferred</code>ä½œä¸ºå¯åŠ¨ç­–ç•¥ï¼Œåˆ™ä¼šå‘ç°è¿™ä¸¤ä¸ªçº¿ç¨‹çš„idæ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œè¿™ä»£è¡¨å®é™…ä¸Šå…¶æ‰§è¡Œäº†å¹¶è¡Œçš„ç­–ç•¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Main Thread 139789724776256 | Start</span><br><span class="line">Main Thread 139789724776256 | Waiting for result...</span><br><span class="line">Add  Thread 139789724776256 | Sleeping before add...</span><br><span class="line">Main Thread 139789724776256 | Result: 8</span><br></pre></td></tr></table></figure><h3 id="2-5-2-å¤šçº¿ç¨‹getä¸€ä¸ªfuture"><a href="#2-5-2-å¤šçº¿ç¨‹getä¸€ä¸ªfuture" class="headerlink" title="2.5.2 å¤šçº¿ç¨‹getä¸€ä¸ªfuture"></a>2.5.2 å¤šçº¿ç¨‹getä¸€ä¸ªfuture</h3><p>åœ¨å¦‚ä¸‹ä»£ç ä¸­ï¼Œæˆ‘å†™äº†ä¸€ä¸ª<code>void future_get_func(std::future&lt;int&gt;&amp; fu)</code>çš„å‡½æ•°ï¼Œå°è¯•å¼€ä¸€ä¸ªçº¿ç¨‹æ¥getï¼Œç„¶åä¸»æ‰§è¡Œæµåˆgetä¸€æ¬¡ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;future&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span> <span class="comment">// result_of</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/unistd.h&gt;</span> <span class="comment">// sleep</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Add  Thread &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; | Sleeping before add...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">future_get_func_shared</span><span class="params">(std::shared_future&lt;<span class="type">int</span>&gt;&amp; fu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> result = fu.<span class="built_in">get</span>();  <span class="comment">// ç­‰å¾…å¼‚æ­¥ä»»åŠ¡å®Œæˆå¹¶è·å–ç»“æœ</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Func Thread &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; | Result: &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">future_get_func</span><span class="params">(std::future&lt;<span class="type">int</span>&gt;&amp; fu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> result = fu.<span class="built_in">get</span>();  <span class="comment">// ç­‰å¾…å¼‚æ­¥ä»»åŠ¡å®Œæˆå¹¶è·å–ç»“æœ</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Func Thread &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; | Result: &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Main Thread &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; | Start&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="comment">//std::future&lt;int&gt; futureResult = std::async(std::launch::deferred, add, 3, 5); // ä¸ä¼šåˆ›å»ºæ–°çº¿ç¨‹</span></span><br><span class="line">    std::future&lt;<span class="type">int</span>&gt; futureResult = std::<span class="built_in">async</span>(std::launch::async, add, <span class="number">3</span>, <span class="number">5</span>); <span class="comment">// åˆ›å»ºæ–°çº¿ç¨‹</span></span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">3</span>); </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Main Thread &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; | Waiting for result...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å°è¯•æµ‹è¯•å¤šçº¿ç¨‹getä¼šå‘ç”Ÿä»€ä¹ˆ</span></span><br><span class="line">    </span><br><span class="line">    <span class="function">std::thread <span class="title">t1</span><span class="params">(future_get_func, std::ref(futureResult))</span></span>; <span class="comment">// å¼€ä¸ªçº¿ç¨‹æ¥get</span></span><br><span class="line">    t1.<span class="built_in">detach</span>(); <span class="comment">// ç›´æ¥åˆ†ç¦»çº¿ç¨‹</span></span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> result = futureResult.<span class="built_in">get</span>();  <span class="comment">// ç­‰å¾…å¼‚æ­¥ä»»åŠ¡å®Œæˆå¹¶è·å–ç»“æœ</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Main Thread &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; | Result: &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">3</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚ä¸‹åˆ›å»ºçº¿ç¨‹çš„ä¼ å‚å¿…é¡»è¦ç”¨<code>std::ref</code>åŒ…è£¹ï¼Œæ¥å‘ŠçŸ¥çº¿ç¨‹è¿™æ˜¯ä¸€ä¸ªå¼•ç”¨å¯¹è±¡ï¼Œå¦åˆ™ç¼–è¯‘ä¼šæŠ¥é”™ã€‚å› ä¸º <code>std::thread</code> è¦æ±‚å‚æ•°å¯ä»¥åœ¨<strong>æ„é€ å‡½æ•°ä¸­è¢«è°ƒç”¨</strong>ï¼Œè€Œ <code>std::future</code> å¹¶ä¸èƒ½ç›´æ¥ä¼ é€’ç»™ <code>std::thread</code>ï¼›</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::thread <span class="title">t1</span><span class="params">(future_get_func, std::ref(futureResult))</span></span>; <span class="comment">//æ­£ç¡®</span></span><br><span class="line"><span class="function">std::thread <span class="title">t1</span><span class="params">(future_get_func, futureResult)</span></span>; <span class="comment">//é”™è¯¯</span></span><br></pre></td></tr></table></figure><p>ç¼–è¯‘é€šè¿‡åæ‰§è¡Œï¼Œä¼šå‘ç°è·‘å‡ºæ¥äº†ä¸€ä¸ª<code>std::future_error</code>å¼‚å¸¸ï¼Œä»£è¡¨æˆ‘ä»¬åœ¨ä¸€ä¸ªæ— æ•ˆçš„<code>future</code>ä¸Šè°ƒç”¨äº†<code>get</code>å‡½æ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Main Thread 139869577889600 | Start</span><br><span class="line">Add  Thread 139869559850752 | Sleeping before add...</span><br><span class="line">Main Thread 139869577889600 | Waiting for result...</span><br><span class="line">Func Thread 139869551458048 | Result: 8</span><br><span class="line">terminate called after throwing an instance of &#x27;std::future_error&#x27;</span><br><span class="line">  what():  std::future_error: No associated state</span><br><span class="line">Aborted</span><br></pre></td></tr></table></figure><p>è®°ä½äº†ï¼Œ<code>std::future</code>åœ¨è°ƒç”¨äº†ä¸€æ¬¡<code>get</code>ä¹‹åå°†ä¸å†ä¸å¯¹åº”çš„<code>std::async</code>å…³è”ï¼Œæ‰€ä»¥æ‰ä¼šéœ€è¦<code>share_future</code>çš„å‡ºç°ï¼</p><p>æ”¹æˆ<code>share_future</code>å†æ‰§è¡Œä¸Šé¢è¿™å¥—é€»è¾‘ï¼Œå°±ä¼šå‘ç°æˆåŠŸè·‘èµ·æ¥äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Main Thread 140369883957056 | Start</span><br><span class="line">Add  Thread 140369865918208 | Sleeping before add...</span><br><span class="line">Main Thread 140369883957056 | Waiting for result...</span><br><span class="line">Func Thread 140369857525504 | Result: 8</span><br><span class="line">Main Thread 140369883957056 | Result: 8</span><br></pre></td></tr></table></figure><h3 id="2-5-3-å¼‚å¸¸å¤„ç†"><a href="#2-5-3-å¼‚å¸¸å¤„ç†" class="headerlink" title="2.5.3 å¼‚å¸¸å¤„ç†"></a>2.5.3 å¼‚å¸¸å¤„ç†</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Add  Thread &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; | Sleeping before add...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;An error occurred&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœ<code>async</code>æ‰§è¡Œçš„å‡½æ•°ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œé‚£ä¹ˆè¿™ä¸ªå¼‚å¸¸å°†ä¼šè¢«ä¼ å›ä¸»æ‰§è¡Œæµï¼Œå¯ä»¥åœ¨ä¸»æ‰§è¡Œæµä¸­è¢«å¤„ç†ã€‚è€Œå¦‚æœç›´æ¥ä½¿ç”¨çº¿ç¨‹æ¥æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œå…¶å¼‚å¸¸ä¸ä¼šè¢«æ•æ‰ï¼Œè€Œæ˜¯ä¼šå¯¼è‡´æ•´ä¸ªè¿›ç¨‹é€€å‡ºã€‚</p><p>ä¸‹å›¾ï¼Œä½¿ç”¨asyncè¿è¡Œï¼ŒæˆåŠŸæ‰“å°å‡ºå¼‚å¸¸ï¼ˆæ•è·æˆåŠŸï¼‰</p><p><img src="https://img.musnow.top/i/2023/08/b54e8cd394dd45ba670b272df2a385a3.png" alt="image-20230819141820459"></p><p>ä¸‹å›¾ï¼Œä½¿ç”¨çº¿ç¨‹è¿è¡Œï¼Œè¿›ç¨‹é€€å‡º</p><p><img src="https://img.musnow.top/i/2023/08/4a36220784bc763e51be69552f6211d1.png" alt="image-20230819141716295"></p><h2 id="2-6-launch-deferredçš„çœŸæ­£æ„ä¹‰"><a href="#2-6-launch-deferredçš„çœŸæ­£æ„ä¹‰" class="headerlink" title="2.6 launch::deferredçš„çœŸæ­£æ„ä¹‰"></a>2.6 launch::deferredçš„çœŸæ­£æ„ä¹‰</h2><p>å¦‚æœ<code>std::launch::deferred</code>æ˜¯åŒæ­¥æ‰§è¡Œï¼Œè¿™æ ·å†™ä¸æ˜¯å¤šæ­¤ä¸€ä¸¾å—ï¼Ÿ</p><p>NONONO éä¹Ÿéä¹Ÿï¼Œå’Œç›´æ¥è°ƒç”¨<code>Add</code>å‡½æ•°ç›¸æ¯”ï¼Œç”¨è¿™æ ·çš„æ–¹å¼è°ƒç”¨<code>Add</code>å‡½æ•°è¿˜æ˜¯æœ‰äº›åŒºåˆ«çš„ï¼š</p><ul><li>æ¨è¿Ÿæ‰§è¡Œï¼šç›´æ¥è°ƒç”¨Addå‡½æ•°æ˜¯ç«‹é©¬æ‰§è¡Œï¼Œä½†æ˜¯ç”¨asyncå¯ä»¥æ¨è¿Ÿåˆ°è°ƒç”¨getçš„æ—¶å€™æ‰æ‰§è¡Œ</li><li>å»¶è¿Ÿè®¡ç®—ï¼šæœ‰çš„æ—¶å€™æˆ‘ä»¬å¹¶ä¸æ˜¯éœ€è¦ç«‹é©¬ä½¿ç”¨è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼ï¼Œæ‰€ä»¥å°±å¯ä»¥å»¶è¿Ÿä¸€ä¼šå†æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œå…ˆæŠŠå‡½æ•°çš„è°ƒç”¨æèµ·æ¥ï¼Œåé¢åªéœ€è¦ä¸€ä¸ªgetå°±èƒ½è·å–åˆ°ç»“æœäº†</li><li>é¿å…çº¿ç¨‹åˆ›å»ºï¼šå¹¶ä¸æ˜¯ä»€ä¹ˆæ—¶å€™å¤šçº¿ç¨‹éƒ½æ›´å¥½ï¼Œæœ‰äº›æ—¶å€™åˆ›å»ºä¸€ä¸ªçº¿ç¨‹çš„æ¶ˆè€—è¿˜ä¸å¦‚ç›´æ¥æ‰§è¡Œå‡½æ•°æ¥çš„å¿«ï¼ˆæ¯”å¦‚å‡½æ•°å¹²çš„æ´»å¾ˆå°çš„æƒ…å†µï¼‰</li></ul><p>æ‰€ä»¥ï¼Œè¿™ä¸ªå…³é”®å­—å¤šå°‘è¿˜æ˜¯æœ‰ç‚¹ä½œç”¨äº†ã€‚</p><h2 id="2-7-future-error-x2F-errc-x2F-status"><a href="#2-7-future-error-x2F-errc-x2F-status" class="headerlink" title="2.7 future_error&#x2F;errc&#x2F;status"></a>2.7 future_error&#x2F;errc&#x2F;status</h2><p>é™¤äº†<code>future</code>å’Œ<code>share_future</code>ï¼Œè¿˜æœ‰å¦‚ä¸‹å‡ ä¸ªç±»å‹</p><ol><li><strong><code>std::future_error</code>ï¼š</strong> <code>std::future_error</code> æ˜¯ä¸€ä¸ªå¼‚å¸¸ç±»ï¼Œç”¨äºè¡¨ç¤ºä¸ <code>std::future</code> ç›¸å…³çš„é”™è¯¯ã€‚å½“åœ¨ä½¿ç”¨ <code>std::future</code> æ—¶å‡ºç°é”™è¯¯ï¼Œä¾‹å¦‚è·å–ç»“æœæ—¶å¼‚æ­¥ä»»åŠ¡æŠ›å‡ºäº†å¼‚å¸¸ï¼Œå°±ä¼šæŠ›å‡º <code>std::future_error</code> å¼‚å¸¸ã€‚å®ƒæ˜¯ä¸€ä¸ª<strong>æ ‡å‡†å¼‚å¸¸ç±»å‹</strong>ï¼Œé€šå¸¸é€šè¿‡æ•è·å¼‚å¸¸å¯¹è±¡æ¥å¤„ç†å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„é—®é¢˜ã€‚</li><li><strong><code>std::future_errc</code>ï¼š</strong> <code>std::future_errc</code> æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œç”¨äºè¡¨ç¤º <code>std::future_error</code> ä¸­çš„ä¸åŒé”™è¯¯æƒ…å†µã€‚è¿™æ ·çš„æšä¸¾ç±»å‹æ˜¯ä¸ºäº†åœ¨å¤„ç†å¼‚å¸¸æ—¶æ›´åŠ æ˜ç¡®å’Œæ–¹ä¾¿ã€‚å®ƒåŒ…å«äº†ä¸€ç³»åˆ—å¯èƒ½çš„é”™è¯¯ï¼Œå¦‚ <code>broken_promise</code>ï¼ˆpromise è¢«ç ´åï¼Œå³ promise å¯¹è±¡çš„ set_value æˆ– set_exception è¢«å¤šæ¬¡è°ƒç”¨ï¼‰å’Œ <code>future_already_retrieved</code>ï¼ˆfuture å¯¹è±¡å·²ç»è¢«è·å–è¿‡ä¸€æ¬¡ï¼‰ç­‰ã€‚</li><li><strong><code>std::future_status</code>ï¼š</strong> <code>std::future_status</code> æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œç”¨äºè¡¨ç¤º <code>std::future</code> çš„çŠ¶æ€ã€‚å®ƒæè¿°äº†ä¸€ä¸ª <code>std::future</code> å¯¹è±¡çš„å½“å‰æƒ…å†µï¼ŒæŒ‡ç¤ºå¼‚æ­¥ä»»åŠ¡æ˜¯å¦å·²å®Œæˆã€æ˜¯å¦æœ‰æ•ˆç­‰ã€‚<code>std::future_status</code> åŒ…å«ä¸‰ä¸ªå€¼ï¼š<code>ready</code>ï¼ˆå¼‚æ­¥ä»»åŠ¡å·²å®Œæˆï¼Œå¯ä»¥è·å–ç»“æœï¼‰ã€<code>timeout</code>ï¼ˆç­‰å¾…è¶…æ—¶ï¼Œå³å¼‚æ­¥ä»»åŠ¡è¿˜æœªå®Œæˆï¼‰ã€<code>deferred</code>ï¼ˆå¼‚æ­¥ä»»åŠ¡å»¶è¿Ÿæ‰§è¡Œï¼‰ã€‚</li></ol><h1 id="3-ä¸ºä»€ä¹ˆC-ä¼šå‡ºç°futrueï¼Ÿ"><a href="#3-ä¸ºä»€ä¹ˆC-ä¼šå‡ºç°futrueï¼Ÿ" class="headerlink" title="3.ä¸ºä»€ä¹ˆC++ä¼šå‡ºç°futrueï¼Ÿ"></a>3.ä¸ºä»€ä¹ˆC++ä¼šå‡ºç°futrueï¼Ÿ</h1><p>ä¸ºå•¥è¦å‡ºä¸€ä¸ªfutureï¼Ÿç›´æ¥ç”¨è€åŠæ³•ä¸ä¹Ÿå¯ä»¥è¿™ä¹ˆç©å—ï¼Ÿ</p><p>C++ æ ‡å‡†åº“å¼•å…¥ <code>std::future</code> å’Œç›¸å…³çš„å¼‚æ­¥ç¼–ç¨‹æœºåˆ¶ï¼Œæ˜¯ä¸ºäº†æ›´å¥½åœ°æ”¯æŒå¹¶å‘ç¼–ç¨‹å’Œå¤šçº¿ç¨‹ç¯å¢ƒã€‚è¿™äº›æœºåˆ¶çš„å‡ºç°æœ‰å‡ ä¸ªåŸå› å’ŒåŠ¨æœºï¼š</p><ol><li><strong>å¹¶å‘æ€§å’Œæ€§èƒ½æå‡ï¼š</strong> åœ¨ç°ä»£è®¡ç®—æœºä½“ç³»ç»“æ„ä¸­ï¼Œå¤šæ ¸å¤„ç†å™¨å·²ç»æˆä¸ºå¸¸æ€ã€‚ä¸ºäº†å……åˆ†åˆ©ç”¨è¿™äº›å¤šæ ¸èµ„æºï¼Œç¼–å†™å¹¶å‘ä»£ç å˜å¾—é‡è¦ã€‚<code>std::future</code> æä¾›äº†ä¸€ç§æ–¹å¼ï¼Œå¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¸­åŒæ—¶æ‰§è¡Œä»»åŠ¡ï¼Œå¹¶ä¸”å¯ä»¥æ–¹ä¾¿åœ°è·å–ä»»åŠ¡çš„ç»“æœï¼Œä»è€Œå…è®¸ç¨‹åºåœ¨å¤šæ ¸å¤„ç†å™¨ä¸Šå¹¶è¡Œæ‰§è¡Œï¼Œæé«˜æ€§èƒ½ã€‚</li><li><strong>ä»»åŠ¡åˆ†ç¦»ï¼š</strong> åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›å°†ä¸€ä¸ªå¤§çš„ä»»åŠ¡æ‹†åˆ†æˆå¤šä¸ªå­ä»»åŠ¡ï¼Œåœ¨ä¸åŒçš„çº¿ç¨‹ä¸­å¹¶è¡Œæ‰§è¡Œï¼Œç„¶ååˆå¹¶å­ä»»åŠ¡çš„ç»“æœã€‚<code>std::future</code> å…è®¸ä½ åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„ä»»åŠ¡å®Œæˆï¼Œä»è€Œæ”¯æŒè¿™ç§ä»»åŠ¡åˆ†ç¦»å’Œå¹¶è¡Œæ‰§è¡Œçš„æ¨¡å¼ã€‚</li><li><strong>é¿å…é˜»å¡ï¼š</strong> åœ¨ä¼ ç»Ÿçš„åŒæ­¥ç¼–ç¨‹ä¸­ï¼Œå¦‚æœæŸä¸ªæ“ä½œéœ€è¦ç­‰å¾…ï¼Œä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ã€‚è€Œå¼‚æ­¥ç¼–ç¨‹æœºåˆ¶å…è®¸çº¿ç¨‹ç»§ç»­æ‰§è¡Œå…¶ä»–æ“ä½œï¼Œè€Œä¸å¿…ç­‰å¾…ä¸€ä¸ªæ½œåœ¨çš„è€—æ—¶æ“ä½œå®Œæˆã€‚<code>std::future</code> å…è®¸ä½ åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å‘èµ·å¼‚æ­¥æ“ä½œï¼Œå¹¶åœ¨éœ€è¦çš„æ—¶å€™è·å–æ“ä½œçš„ç»“æœï¼Œä»è€Œé¿å…äº†ä¸å¿…è¦çš„é˜»å¡ã€‚</li><li><strong>å¼‚å¸¸å¤„ç†ï¼š</strong> åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå¤„ç†å¼‚æ­¥ä»»åŠ¡çš„å¼‚å¸¸å¯èƒ½å˜å¾—å¤æ‚ï¼Œå› ä¸ºå¼‚æ­¥ä»»åŠ¡åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚<code>std::future</code> å¼•å…¥äº†å¼‚å¸¸ä¼ é€’æœºåˆ¶ï¼Œå…è®¸å¼‚æ­¥ä»»åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶å°†è¿™äº›å¼‚å¸¸ä¼ é€’åˆ°ç­‰å¾…ç»“æœçš„çº¿ç¨‹ä¸­ã€‚</li></ol><p>æ€»ä¹‹ï¼ŒC++ çš„ <code>std::future</code> å’Œç›¸å…³çš„å¼‚æ­¥ç¼–ç¨‹æœºåˆ¶æä¾›äº†ä¸€ç§æ›´é«˜çº§åˆ«ã€æ›´æ–¹ä¾¿çš„æ–¹å¼æ¥å¤„ç†å¤šçº¿ç¨‹å¹¶å‘ç¼–ç¨‹ã€‚è¿™äº›æœºåˆ¶ä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿæ›´å®¹æ˜“åœ°åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨çš„æ€§èƒ½ï¼Œå¹¶æ›´çµæ´»åœ°è®¾è®¡å¹¶å‘ä»£ç ï¼Œä»è€Œåœ¨é¢å¯¹å¹¶å‘å’Œå¼‚æ­¥ä»»åŠ¡æ—¶èƒ½å¤Ÿæ›´å¥½åœ°ç®¡ç†èµ„æºã€æé«˜æ•ˆç‡å’Œå¤„ç†å¼‚å¸¸ã€‚</p><h1 id="4-promise"><a href="#4-promise" class="headerlink" title="4.promise"></a>4.promise</h1><h2 id="4-1-æ¦‚å¿µ"><a href="#4-1-æ¦‚å¿µ" class="headerlink" title="4.1 æ¦‚å¿µ"></a>4.1 æ¦‚å¿µ</h2><p><code>std::promise</code> æ˜¯ C++ æ ‡å‡†åº“ä¸­ç”¨äºåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­äº§ç”Ÿç»“æœï¼Œç„¶ååœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­è·å–ç»“æœçš„å·¥å…·ã€‚å®ƒæä¾›äº†ä¸€äº›æˆå‘˜å‡½æ•°æ¥è®¾ç½®ç»“æœã€å¤„ç†å¼‚å¸¸ä»¥åŠè·å–å…³è”çš„ <code>std::future</code> å¯¹è±¡ç­‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;  promise;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">R</span>&amp;&gt; promise&lt;R&amp;&gt;;     <span class="comment">// specialization : T is a reference type (R&amp;)</span></span><br><span class="line"><span class="keyword">template</span> &lt;&gt;         promise&lt;<span class="type">void</span>&gt;;   <span class="comment">// specialization : T is void</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„ <code>std::promise</code> æˆå‘˜å‡½æ•°åŠå…¶ç”¨æ³•ï¼š</p><ol><li><p><strong><code>set_value</code>ï¼š</strong> ç”¨äºè®¾ç½®ç»“æœå€¼ã€‚å¦‚æœä½ å·²ç»é€šè¿‡ <code>get_future()</code> è·å–äº†ä¸€ä¸ª <code>std::future</code> å¯¹è±¡ï¼Œè°ƒç”¨ <code>set_value</code> å°†ä¼šä½¿ç­‰å¾…ç»“æœçš„çº¿ç¨‹è¢«å”¤é†’å¹¶è·å–ç»“æœã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::promise&lt;<span class="type">int</span>&gt; promiseObj;</span><br><span class="line">std::future&lt;<span class="type">int</span>&gt; futureResult = promiseObj.<span class="built_in">get_future</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨æŸä¸ªçº¿ç¨‹ä¸­è®¾ç½®ç»“æœå€¼</span></span><br><span class="line">promiseObj.<span class="built_in">set_value</span>(<span class="number">42</span>);</span><br></pre></td></tr></table></figure></li><li><p><strong><code>set_exception</code>ï¼š</strong> ç”¨äºè®¾ç½®å¼‚å¸¸ï¼Œå°†åœ¨ç­‰å¾…ç»“æœçš„çº¿ç¨‹ä¸­æŠ›å‡ºã€‚è¿™å…è®¸ä½ åœ¨äº§ç”Ÿç»“æœçš„çº¿ç¨‹ä¸­å¤„ç†å¼‚å¸¸æƒ…å†µã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// äº§ç”Ÿå¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;An error occurred&quot;</span>);</span><br><span class="line">&#125; </span><br><span class="line"><span class="built_in">catch</span> (...) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// å°†å¼‚å¸¸è®¾ç½®åˆ° promise å¯¹è±¡ä¸­</span></span><br><span class="line">    promiseObj.<span class="built_in">set_exception</span>(std::<span class="built_in">current_exception</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong><code>get_future</code>ï¼š</strong> è¿”å›ä¸ <code>std::promise</code> å…³è”çš„ <code>std::future</code> å¯¹è±¡ã€‚é€šè¿‡è¿™ä¸ª <code>std::future</code>ï¼Œä½ å¯ä»¥åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­ç­‰å¾…å¹¶è·å–ç»“æœã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">std::promise&lt;<span class="type">int</span>&gt; promiseObj;</span><br><span class="line">std::future&lt;<span class="type">int</span>&gt; futureResult = promiseObj.<span class="built_in">get_future</span>();</span><br></pre></td></tr></table></figure></li><li><p><strong><code>swap</code>ï¼š</strong> äº¤æ¢ä¸¤ä¸ª <code>std::promise</code> å¯¹è±¡çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬å…³è”çš„ <code>std::future</code> å¯¹è±¡å’Œè®¾ç½®çš„ç»“æœã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::promise&lt;<span class="type">int</span>&gt; promise1;</span><br><span class="line">std::promise&lt;<span class="type">int</span>&gt; promise2;</span><br><span class="line"></span><br><span class="line"><span class="comment">// äº¤æ¢ä¸¤ä¸ª promise å¯¹è±¡çš„çŠ¶æ€</span></span><br><span class="line">promise1.<span class="built_in">swap</span>(promise2);</span><br></pre></td></tr></table></figure></li><li><p><strong><code>valid</code>ï¼š</strong> æ£€æŸ¥ <code>std::promise</code> å¯¹è±¡æ˜¯å¦æœ‰æ•ˆï¼Œå³æ˜¯å¦ä¸ä¸€ä¸ª <code>std::future</code> å¯¹è±¡å…³è”ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">std::promise&lt;<span class="type">int</span>&gt; promiseObj;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (promiseObj.<span class="built_in">valid</span>()) &#123;</span><br><span class="line">    <span class="comment">// promiseObj æœ‰æ•ˆ</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// promiseObj æ— æ•ˆ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>è¿˜æœ‰ä¸‹é¢è¿™ä¿©ä¸ªæˆå‘˜å‡½æ•°ï¼Œçœ‹åå­—ä¹Ÿèƒ½çŒœå‡ºæ¥å®ƒæ˜¯å¹²å˜›çš„ï¼Œå°±ä¸å¤šè¯´äº†</p><ul><li><p><a href="https://legacy.cplusplus.com/reference/future/promise/set_value_at_thread_exit/"><strong>set_value_at_thread_exit</strong></a></p><p>Set value at thread exit (public member function )</p></li><li><p><a href="https://legacy.cplusplus.com/reference/future/promise/set_exception_at_thread_exit/"><strong>set_exception_at_thread_exit</strong></a></p><p>Set exception at thread exit (public member function )</p></li></ul><p>è¿™äº›æˆå‘˜å‡½æ•°å…è®¸ä½ åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­äº§ç”Ÿç»“æœæˆ–å¼‚å¸¸ï¼Œ<strong>å¹¶åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­ç­‰å¾…å’Œå¤„ç†è¿™äº›ç»“æœæˆ–å¼‚å¸¸</strong>ã€‚å®ƒä»¬ä¸ºå¤šçº¿ç¨‹ç¼–ç¨‹æä¾›äº†ä¸€ç§å¯é çš„æ–¹å¼æ¥ä¼ é€’æ•°æ®å’Œæ§åˆ¶æµã€‚è¯·æ³¨æ„ï¼Œåœ¨ä½¿ç”¨ <code>std::promise</code> æ—¶ï¼Œä½ éœ€è¦ä»”ç»†å¤„ç†å¼‚å¸¸å’Œçº¿ç¨‹åŒæ­¥ï¼Œä»¥ç¡®ä¿æ­£ç¡®çš„ç»“æœä¼ é€’ã€‚</p><h2 id="4-2-ç¤ºä¾‹"><a href="#4-2-ç¤ºä¾‹" class="headerlink" title="4.2 ç¤ºä¾‹"></a>4.2 ç¤ºä¾‹</h2><p>ç„¶åä¸‹å¤´æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ä½¿ç”¨ç¤ºä¾‹ï¼›ä½ å¯ä»¥ç†è§£ä¸º<code>promise</code>å°±æ˜¯ä¸€ä¸ªç”¨æ¥æ‰¿æ‹…çº¿ç¨‹æ‰€æ‰§è¡Œå‡½æ•°çš„å‚æ•°å’Œå¼‚å¸¸çš„ä¸€ä¸ªå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>set_value</code>å¹¶åœ¨ä¸»æ‰§è¡Œæµä¸­ä½¿ç”¨<code>future.get</code>æ¥è·å–åˆ°è¿™ä¸ªå€¼ï¼Œä¹Ÿå¯ä»¥è®¾ç½®å¼‚å¸¸ï¼Œå¹¶åœ¨ä¸»æ‰§è¡Œæµä¸­å¤„ç†è¿™ä¸ªå¼‚å¸¸ï¼›</p><p>ä¸è¿‡<code>promise</code>å’Œ<code>future</code>ä¸€æ ·ï¼Œæ˜¯<strong>ä¸€æ¬¡æ€§</strong>çš„ï¼Œè®¾ç½®valueå’Œå¼‚å¸¸éƒ½åªèƒ½è®¾ç½®ä¸€æ¬¡ï¼Œè®¾ç½®å®Œæ¯•åå°±ä¸èƒ½å†è®¾ç½®äº†</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;future&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">worker</span><span class="params">(std::promise&lt;<span class="type">int</span>&gt;&amp; p)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    p.<span class="built_in">set_value</span>(<span class="number">42</span>); <span class="comment">// è®¾ç½®å€¼</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::promise&lt;<span class="type">int</span>&gt; promiseObj;</span><br><span class="line">    std::future&lt;<span class="type">int</span>&gt; futureResult = promiseObj.<span class="built_in">get_future</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function">std::thread <span class="title">t</span><span class="params">(worker, std::ref(promiseObj))</span></span>; <span class="comment">// é€šè¿‡çº¿ç¨‹æ‰§è¡Œ</span></span><br><span class="line">    t.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> result = futureResult.<span class="built_in">get</span>(); <span class="comment">// ä¸»çº¿ç¨‹ä¸­è·å–å€¼</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Result: &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="5-packaged-task"><a href="#5-packaged-task" class="headerlink" title="5.packaged_task"></a>5.packaged_task</h1><p><code>std::packaged_task</code> æ˜¯ C++ æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªç±»æ¨¡æ¿ï¼Œç”¨äºå°†ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼ˆå‡½æ•°ã€å‡½æ•°å¯¹è±¡æˆ–å¯è°ƒç”¨æˆå‘˜å‡½æ•°ï¼‰å°è£…æˆä¸€ä¸ªå¯ä»¥<strong>å¼‚æ­¥</strong>æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ <code>std::future</code> è·å–ä»»åŠ¡çš„è¿”å›å€¼ã€‚å®ƒåœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­èµ·åˆ°äº†è¿æ¥å¼‚æ­¥ä»»åŠ¡å’Œçº¿ç¨‹é—´é€šä¿¡çš„æ¡¥æ¢ä½œç”¨ã€‚</p><p><code>std::packaged_task</code> çš„ä¸»è¦ä½œç”¨æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ol><li><strong>å°è£…ä»»åŠ¡ï¼š</strong> <code>std::packaged_task</code> å…è®¸ä½ å°†ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡å°è£…æˆä¸€ä¸ªä»»åŠ¡ï¼Œè¿™ä¸ªä»»åŠ¡å¯ä»¥åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­å¼‚æ­¥æ‰§è¡Œã€‚ä½ å¯ä»¥å°†å‡½æ•°ã€å‡½æ•°å¯¹è±¡æˆ–å¯è°ƒç”¨æˆå‘˜å‡½æ•°å°è£…ä¸ºä¸€ä¸ª <code>std::packaged_task</code> å®ä¾‹ã€‚</li><li><strong>å¼‚æ­¥æ‰§è¡Œï¼š</strong> é€šè¿‡å°† <code>std::packaged_task</code> å®ä¾‹ä¼ é€’ç»™ä¸€ä¸ª <code>std::thread</code> æˆ–å…¶ä»–æ”¯æŒå¼‚æ­¥æ‰§è¡Œçš„æœºåˆ¶ï¼Œä½ å¯ä»¥åœ¨æ–°çš„çº¿ç¨‹ä¸­æ‰§è¡Œå°è£…çš„ä»»åŠ¡ï¼Œè€Œä¸éœ€è¦æ˜¾å¼åˆ›å»ºçº¿ç¨‹å‡½æ•°ã€‚</li><li><strong>è·å–è¿”å›å€¼ï¼š</strong> <code>std::packaged_task</code> å¯ä»¥ä¸ <code>std::future</code> ä¸€èµ·ä½¿ç”¨ï¼Œä»¥è·å–å¼‚æ­¥ä»»åŠ¡çš„è¿”å›å€¼ã€‚ä½ å¯ä»¥é€šè¿‡ <code>packaged_task</code> çš„ <code>get_future</code> æ–¹æ³•è·å–ä¸€ä¸ªä¸ä»»åŠ¡å…³è”çš„ <code>std::future</code> å¯¹è±¡ï¼Œç„¶ååœ¨é€‚å½“çš„æ—¶å€™ä½¿ç”¨ <code>std::future</code> çš„ <code>get</code> æ–¹æ³•æ¥è·å–ä»»åŠ¡çš„è¿”å›å€¼ã€‚</li><li><strong>çº¿ç¨‹æ± ï¼š</strong> <code>std::packaged_task</code> ç»“åˆçº¿ç¨‹æ± çš„ä½¿ç”¨ï¼Œå¯ä»¥æ›´çµæ´»åœ°æ§åˆ¶ä»»åŠ¡çš„æ‰§è¡Œæ–¹å¼ã€‚çº¿ç¨‹æ± å¯ä»¥é¢„å…ˆåˆ›å»ºä¸€ç»„çº¿ç¨‹ï¼Œç„¶åå°†å°è£…å¥½çš„ä»»åŠ¡åˆ†é…ç»™è¿™äº›çº¿ç¨‹æ‰§è¡Œï¼Œé¿å…äº†é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„å¼€é”€ã€‚</li></ol><h2 id="5-1-ç¤ºä¾‹"><a href="#5-1-ç¤ºä¾‹" class="headerlink" title="5.1 ç¤ºä¾‹"></a>5.1 ç¤ºä¾‹</h2><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>std::packaged_task</code> æ¥å¼‚æ­¥æ‰§è¡Œä¸€ä¸ªå‡½æ•°å¹¶è·å–å…¶è¿”å›å€¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;future&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">std::packaged_task&lt;<span class="title">int</span><span class="params">(<span class="type">int</span>, <span class="type">int</span>)</span>&gt; <span class="title">task</span><span class="params">(add)</span></span>;</span><br><span class="line">    std::future&lt;<span class="type">int</span>&gt; future = task.<span class="built_in">get_future</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function">std::thread <span class="title">worker</span><span class="params">(std::move(task), <span class="number">3</span>, <span class="number">5</span>)</span></span>;</span><br><span class="line">    worker.<span class="built_in">join</span>(); <span class="comment">// é€šè¿‡çº¿ç¨‹å¼‚æ­¥æ‰§è¡Œè¿™ä¸ªtask</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> result = future.<span class="built_in">get</span>(); <span class="comment">// ç­‰å¾…è¿”å›å€¼</span></span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Result: &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>std::packaged_task</code> å°è£…äº†ä¸€ä¸ªå‡½æ•° <code>add</code>ï¼Œç„¶åé€šè¿‡ <code>std::thread</code> å¼‚æ­¥æ‰§è¡Œï¼Œæœ€åé€šè¿‡ <code>std::future</code> è·å–å¼‚æ­¥ä»»åŠ¡çš„è¿”å›å€¼ã€‚</p><h2 id="5-2-make-ready-at-thread-exit"><a href="#5-2-make-ready-at-thread-exit" class="headerlink" title="5.2 make_ready_at_thread_exit"></a>5.2 make_ready_at_thread_exit</h2><p><code>packaged_task</code>çš„æˆå‘˜å‡½æ•°ä¸­ï¼Œä¸»è¦è¿˜æ˜¯è¿™ä¸ªéœ€è¦å•ç‹¬è¯´æ˜ï¼›å…ˆçœ‹å¦‚ä¸‹ä»£ç </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;future&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">std::packaged_task&lt;<span class="title">int</span><span class="params">()</span>&gt; <span class="title">task</span><span class="params">([]()&#123; <span class="keyword">return</span> <span class="number">42</span>; &#125;)</span></span>;</span><br><span class="line">    std::future&lt;<span class="type">int</span>&gt; future = task.<span class="built_in">get_future</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function">std::thread <span class="title">worker</span><span class="params">([&amp;task]() &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="comment">// æ¨¡æ‹Ÿä¸€äº›å·¥ä½œ</span></span></span></span><br><span class="line"><span class="params"><span class="function">        std::this_thread::sleep_for(std::chrono::seconds(<span class="number">2</span>));</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="comment">// è®¾ç½®ä»»åŠ¡ç»“æœå€¼</span></span></span></span><br><span class="line"><span class="params"><span class="function">        task.make_ready_at_thread_exit();</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;)</span></span>;</span><br><span class="line"></span><br><span class="line">    worker.<span class="built_in">detach</span>(); <span class="comment">// åˆ†ç¦»çº¿ç¨‹ï¼Œä¸ç­‰å¾…å…¶ç»“æŸ</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾…ä»»åŠ¡ç»“æœ</span></span><br><span class="line">    <span class="type">int</span> result = future.<span class="built_in">get</span>();</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Result: &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è®©<code>packaged_task</code>æ‰§è¡Œçš„æ˜¯ä¸€ä¸ª<code>return 42</code>çš„å‡½æ•°ï¼Œè€Œçº¿ç¨‹é‡Œé¢è¿˜ä¼šè¿›è¡Œå…¶ä»–å¤„ç†ã€‚</p><p>è€Œ<code>make_ready_at_thread_exit()</code>çš„ä½œç”¨ï¼Œå°±æ˜¯ç¡®è®¤å½“å‰çš„<code>worker</code>çº¿ç¨‹å·²ç»å¹²å®Œè‡ªå·±çš„æ´»äº†ï¼Œå¯ä»¥æ‰§è¡Œ<code>packaged_task</code>å°è£…çš„å‡½æ•°äº†ï¼</p><p>ç›¸å½“äºæ˜¯ä¸€ä¸ªç¡®è®¤<code>packaged_task</code>ä¸­å°è£…çš„ä»»åŠ¡åˆ°åº•åœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œçš„ä¸€ä¸ªå‡½æ•°ã€‚è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œå°±ä¼šå¼€å§‹æ‰§è¡Œå…¶åŒ…è£…çš„å¼‚æ­¥å‡½æ•°ï¼Œå¹¶è¿”å›ç»“æœç»™<code>future.get()</code>çš„æ‰§è¡Œæµ</p><h1 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h1><p>æ”¶å·¥</p>]]></content>
    
    
    <summary type="html">C++11çš„futureå’Œasyncç­‰</summary>
    
    
    
    <category term="é‡è§C++" scheme="https://blog.musnow.top/categories/%E9%81%87%E8%A7%81C/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="C++" scheme="https://blog.musnow.top/tags/C/"/>
    
    <category term="C++11" scheme="https://blog.musnow.top/tags/C-11/"/>
    
  </entry>
  
  <entry>
    <title>ã€é¢ç»ã€‘230816äº‘è´¦æˆ¿ä¸€é¢</title>
    <link href="https://blog.musnow.top/posts/1199148787/"/>
    <id>https://blog.musnow.top/posts/1199148787/</id>
    <published>2023-08-16T10:32:14.000Z</published>
    <updated>2023-08-16T10:32:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>230816äº‘è´¦æˆ¿ä¸€é¢</p><span id="more"></span><h2 id="1-ä»€ä¹ˆæ˜¯ç§»åŠ¨æ„é€ "><a href="#1-ä»€ä¹ˆæ˜¯ç§»åŠ¨æ„é€ " class="headerlink" title="1.ä»€ä¹ˆæ˜¯ç§»åŠ¨æ„é€ "></a>1.ä»€ä¹ˆæ˜¯ç§»åŠ¨æ„é€ </h2><h2 id="2-å¾ªç¯é“¾è¡¨å¦‚ä½•å®ç°"><a href="#2-å¾ªç¯é“¾è¡¨å¦‚ä½•å®ç°" class="headerlink" title="2.å¾ªç¯é“¾è¡¨å¦‚ä½•å®ç°"></a>2.å¾ªç¯é“¾è¡¨å¦‚ä½•å®ç°</h2><h2 id="3-ç”¨äº†é‚£äº›stlå®¹å™¨"><a href="#3-ç”¨äº†é‚£äº›stlå®¹å™¨" class="headerlink" title="3.ç”¨äº†é‚£äº›stlå®¹å™¨"></a>3.ç”¨äº†é‚£äº›stlå®¹å™¨</h2><h2 id="4-æ ‘çš„ç±»å‹"><a href="#4-æ ‘çš„ç±»å‹" class="headerlink" title="4.æ ‘çš„ç±»å‹"></a>4.æ ‘çš„ç±»å‹</h2><p>è¿™é‡Œé—®äº†æˆ‘mysqlç”¨çš„æ˜¯ä»€ä¹ˆï¼Œæˆ‘ç­”äº†çº¢é»‘æ ‘ã€‚ä½†å…¶å®æ˜¯B+æ ‘ï¼ˆæ²¡å­¦ï¼‰</p><h2 id="5-C-11æ–°ç‰¹æ€§"><a href="#5-C-11æ–°ç‰¹æ€§" class="headerlink" title="5.C++11æ–°ç‰¹æ€§"></a>5.C++11æ–°ç‰¹æ€§</h2><h2 id="6-C-11future"><a href="#6-C-11future" class="headerlink" title="6.C++11future"></a>6.C++11future</h2><p>æ²¡å¬è¯´è¿‡ï¼Œå¾—å­¦</p><h2 id="7-linuxè¿›ç¨‹é€šä¿¡çš„æ–¹å¼"><a href="#7-linuxè¿›ç¨‹é€šä¿¡çš„æ–¹å¼" class="headerlink" title="7.linuxè¿›ç¨‹é€šä¿¡çš„æ–¹å¼"></a>7.linuxè¿›ç¨‹é€šä¿¡çš„æ–¹å¼</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç®¡é“ </span><br><span class="line">å…±äº«å†…å­˜</span><br><span class="line">ä¿¡å·é‡</span><br><span class="line">socket</span><br><span class="line">æœ¬åœ°æ–‡ä»¶</span><br></pre></td></tr></table></figure><p>å…¨ç­”å‡ºæ¥äº†ï¼Œè¿˜é—®äº†è°æœ€å¿«ï¼ˆå…±äº«å†…å­˜æœ€å¿«ï¼‰</p><p>ç„¶ååˆé—®äº†è¿›ç¨‹ä¹‹é—´å¦‚ä½•åŒæ­¥ï¼ˆä¸ä¼šï¼‰</p><p>tnndç°åœ¨æ‰æƒ³èµ·æ¥ã€‚è¿›ç¨‹åŒæ­¥ç›´æ¥ç”¨ä¿¡å·é‡å°±å¯ä»¥å•Šï¼ï¼ï¼ï¼ï¼æˆ‘æ€ä¹ˆä¿¡å·é‡ç­”å‡ºæ¥äº†ä¸çŸ¥åˆ°è¿™ç©æ„æ˜¯å¹²å˜›çš„å‘¢â€¦â€¦è¯´ç™½äº†è¿˜æ˜¯å­¦è‰ºä¸ç²¾</p><h2 id="8-gitçš„åŸºæœ¬å‘½ä»¤"><a href="#8-gitçš„åŸºæœ¬å‘½ä»¤" class="headerlink" title="8.gitçš„åŸºæœ¬å‘½ä»¤"></a>8.gitçš„åŸºæœ¬å‘½ä»¤</h2><p>æˆ‘è¯´äº†ä¸‹é¢è¿™äº›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git add </span><br><span class="line">git push</span><br><span class="line">git commit </span><br><span class="line">git log</span><br><span class="line">git reset </span><br><span class="line">git rebase</span><br><span class="line">git merge</span><br></pre></td></tr></table></figure><h2 id="9-ç‰ˆæœ¬å·ç®¡ç†"><a href="#9-ç‰ˆæœ¬å·ç®¡ç†" class="headerlink" title="9.ç‰ˆæœ¬å·ç®¡ç†"></a>9.ç‰ˆæœ¬å·ç®¡ç†</h2><p>æˆ‘ç­”æˆ‘ç”¨äº†3ä¸ªç‰ˆæœ¬å·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¤§ç‰ˆæœ¬.åŠŸèƒ½ç‰ˆæœ¬.bugä¿®å¤ç‰ˆæœ¬</span><br></pre></td></tr></table></figure><h2 id="è°¢è°¢æƒ é¡¾"><a href="#è°¢è°¢æƒ é¡¾" class="headerlink" title="è°¢è°¢æƒ é¡¾"></a>è°¢è°¢æƒ é¡¾</h2><p>æ³»è¯ï¼Œå¤ªå¤šä¸œè¥¿æ²¡ç­”ä¸Šæ¥ï¼Œå·²ç»å‘äº†æ„Ÿè°¢ä¿¡äº†</p>]]></content>
    
    
    <summary type="html">230816äº‘è´¦æˆ¿ä¸€é¢</summary>
    
    
    
    <category term="æ±‚èŒè·¯ä¸Šä¸€å»ä¸å¤è¿”" scheme="https://blog.musnow.top/categories/%E6%B1%82%E8%81%8C%E8%B7%AF%E4%B8%8A%E4%B8%80%E5%8E%BB%E4%B8%8D%E5%A4%8D%E8%BF%94/"/>
    
    
    <category term="é¢ç»" scheme="https://blog.musnow.top/tags/%E9%9D%A2%E7%BB%8F/"/>
    
  </entry>
  
  <entry>
    <title>ã€Pythonã€‘å…ƒç»„/åˆ—è¡¨/é›†åˆçš„åŒºåˆ«</title>
    <link href="https://blog.musnow.top/posts/1142930252/"/>
    <id>https://blog.musnow.top/posts/1142930252/</id>
    <published>2023-08-15T13:15:18.000Z</published>
    <updated>2023-08-15T13:15:18.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-è¯´æ˜"><a href="#1-è¯´æ˜" class="headerlink" title="1.è¯´æ˜"></a>1.è¯´æ˜</h1><p>å…ƒç»„ï¼ˆtupleï¼‰ã€åˆ—è¡¨ï¼ˆlistï¼‰å’Œé›†åˆï¼ˆsetï¼‰æ˜¯Pythonä¸­å¸¸è§çš„æ•°æ®ç»“æ„ï¼Œå®ƒä»¬æœ‰ä¸€äº›é‡è¦çš„åŒºåˆ«ã€‚</p><span id="more"></span><ol><li><p><strong>å¯å˜æ€§</strong>ï¼šåˆ—è¡¨æ˜¯å¯å˜çš„ï¼ˆmutableï¼‰ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œæ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹æ“ä½œã€‚å…ƒç»„æ˜¯ä¸å¯å˜çš„ï¼ˆimmutableï¼‰ï¼Œä¸€æ—¦åˆ›å»ºå°±æ— æ³•ä¿®æ”¹ã€‚é›†åˆä¹Ÿæ˜¯å¯å˜çš„ï¼Œä½†æ˜¯å®ƒå…·æœ‰å»é‡åŠŸèƒ½ï¼Œä¸å…è®¸å­˜åœ¨é‡å¤çš„å…ƒç´ ï¼Œå¹¶ä¸”æ²¡æœ‰å›ºå®šçš„é¡ºåºã€‚</p></li><li><p><strong>è¯­æ³•</strong>ï¼šåˆ—è¡¨ä½¿ç”¨æ–¹æ‹¬å·<code>[]</code>æ¥è¡¨ç¤ºï¼Œå…ƒç´ ä¹‹é—´ç”¨é€—å·<code>,</code>åˆ†éš”ï¼›å…ƒç»„ä½¿ç”¨åœ†æ‹¬å·<code>()``æ¥è¡¨ç¤ºï¼Œå…ƒç´ ä¹‹é—´åŒæ ·ç”¨é€—å·</code>,<code>åˆ†éš”ï¼›é›†åˆä½¿ç”¨å¤§æ‹¬å·</code>{}<code>æ¥è¡¨ç¤ºï¼Œå…ƒç´ ä¹‹é—´ä¹Ÿç”¨é€—å·</code>,&#96;åˆ†éš”ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">my_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">my_tuple = (<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">my_set = &#123;<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ç´¢å¼•å’Œåˆ‡ç‰‡</strong>ï¼šåˆ—è¡¨å’Œå…ƒç»„éƒ½æ”¯æŒé€šè¿‡ç´¢å¼•è®¿é—®å…ƒç´ å’Œåˆ‡ç‰‡æ“ä½œã€‚è€Œé›†åˆæ˜¯æ— åºçš„ï¼Œä¸æ”¯æŒç´¢å¼•å’Œåˆ‡ç‰‡æ“ä½œã€‚</p></li><li><p><strong>é‡å¤å…ƒç´ </strong>ï¼šåˆ—è¡¨å’Œå…ƒç»„å…è®¸å­˜åœ¨é‡å¤çš„å…ƒç´ ï¼Œè€Œé›†åˆä¼šè‡ªåŠ¨å»é™¤é‡å¤çš„å…ƒç´ ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">my_list = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>]  <span class="comment"># åˆ—è¡¨ä¸­å¯ä»¥æœ‰é‡å¤å…ƒç´ </span></span><br><span class="line">my_tuple = (<span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>)      <span class="comment"># å…ƒç»„ä¸­ä¹Ÿå¯ä»¥æœ‰é‡å¤å…ƒç´ </span></span><br><span class="line">my_set = &#123;<span class="number">6</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">7</span>&#125;        <span class="comment"># é›†åˆä¼šè‡ªåŠ¨å»é™¤é‡å¤çš„å…ƒç´ </span></span><br><span class="line"><span class="comment"># å¦‚ä¸Šmy_set = &#123;6,7&#125;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>å¯å“ˆå¸Œæ€§</strong>ï¼šé›†åˆçš„å…ƒç´ å¿…é¡»æ˜¯å¯å“ˆå¸Œï¼ˆhashableï¼‰çš„ï¼Œè€Œåˆ—è¡¨å’Œå…ƒç»„çš„å…ƒç´ å¯ä»¥æ˜¯å¯å“ˆå¸Œæˆ–ä¸å¯å“ˆå¸Œçš„ã€‚å¯å“ˆå¸Œçš„æ„æ€æ˜¯è¯¥å¯¹è±¡çš„å€¼åœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­ä¸å‘ç”Ÿæ”¹å˜ï¼Œä¸”èƒ½å¤Ÿå”¯ä¸€åœ°ç¡®å®šä¸€ä¸ªå¯¹è±¡ã€‚</p></li></ol><p>æ€»çš„æ¥è¯´</p><ul><li>å…ƒç»„é€‚ç”¨äºå­˜å‚¨å›ºå®šçš„ã€ä¸å¯å˜çš„æ•°æ®ï¼›</li><li>åˆ—è¡¨é€‚ç”¨äºéœ€è¦é¢‘ç¹å¯¹å…¶ä¸­çš„å…ƒç´ è¿›è¡Œå¢åˆ æ”¹æ“ä½œçš„æƒ…å†µï¼›</li><li>é›†åˆé€‚ç”¨äºéœ€è¦ç¡®ä¿å…ƒç´ å”¯ä¸€æ€§ä¸”ä¸å…³å¿ƒå…ƒç´ çš„é¡ºåºçš„åœºæ™¯ã€‚</li></ul><p>é€‰æ‹©ä½¿ç”¨å“ªç§æ•°æ®ç»“æ„å–å†³äºå…·ä½“çš„éœ€æ±‚å’Œé—®é¢˜çš„ç‰¹ç‚¹ã€‚</p><h1 id="2-å¯å“ˆå¸Œæ€§"><a href="#2-å¯å“ˆå¸Œæ€§" class="headerlink" title="2.å¯å“ˆå¸Œæ€§"></a>2.å¯å“ˆå¸Œæ€§</h1><h2 id="2-1-æ¦‚å¿µ"><a href="#2-1-æ¦‚å¿µ" class="headerlink" title="2.1 æ¦‚å¿µ"></a>2.1 æ¦‚å¿µ</h2><p>å¯å“ˆå¸Œæ€§ï¼ˆhashabilityï¼‰æ˜¯æŒ‡ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å…·æœ‰å“ˆå¸Œå€¼ï¼ˆhash valueï¼‰ï¼Œå¹¶ä¸”èƒ½å¤Ÿä¿æŒä¸å˜ã€‚åœ¨Pythonä¸­ï¼Œå¯å“ˆå¸Œçš„å¯¹è±¡æ˜¯æŒ‡é‚£äº›åœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­ä¸å¯å˜çš„å¯¹è±¡ã€‚</p><p>å“ˆå¸Œå€¼æ˜¯ä¸€ä¸ªå›ºå®šé•¿åº¦çš„æ•´æ•°ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†ä¸€ä¸ªå¯¹è±¡ã€‚å“ˆå¸Œå€¼æ˜¯é€šè¿‡å°†å¯¹è±¡çš„å†…å®¹è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—æ¥è®¡ç®—å¾—åˆ°çš„ã€‚å¯å“ˆå¸Œçš„å¯¹è±¡å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ol><li>å“ˆå¸Œå€¼ä¸ä¼šæ”¹å˜ï¼šä¸€ä¸ªå¯¹è±¡çš„å“ˆå¸Œå€¼åœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­æ˜¯ä¸å˜çš„ï¼Œå³ä½¿å¯¹è±¡çš„å†…å®¹å‘ç”Ÿäº†æ”¹å˜ã€‚</li><li>ç›¸ç­‰çš„å¯¹è±¡å…·æœ‰ç›¸åŒçš„å“ˆå¸Œå€¼ï¼šå¦‚æœä¸¤ä¸ªå¯¹è±¡æ˜¯ç›¸ç­‰çš„ï¼Œåˆ™å®ƒä»¬çš„å“ˆå¸Œå€¼ä¹Ÿç›¸ç­‰ã€‚</li></ol><p>å¯å“ˆå¸Œæ€§åœ¨Pythonä¸­éå¸¸é‡è¦ï¼Œä¸»è¦ä½“ç°åœ¨ä¸¤ä¸ªæ–¹é¢ï¼š</p><ol><li>å­—å…¸çš„é”®ï¼ˆkeyï¼‰å¿…é¡»æ˜¯å¯å“ˆå¸Œçš„å¯¹è±¡ï¼šå› ä¸ºå­—å…¸æ˜¯åŸºäºå“ˆå¸Œè¡¨å®ç°çš„ï¼Œå®ƒä½¿ç”¨é”®çš„å“ˆå¸Œå€¼æ¥ç´¢å¼•å’Œå¿«é€ŸæŸ¥æ‰¾å¯¹åº”çš„å€¼ã€‚æ‰€ä»¥å­—å…¸ä¸­çš„é”®å¿…é¡»æ˜¯ä¸å¯å˜çš„å¯¹è±¡ï¼Œä¾‹å¦‚æ•´æ•°ã€æµ®ç‚¹æ•°ã€å­—ç¬¦ä¸²ã€å…ƒç»„ç­‰éƒ½æ˜¯å¯å“ˆå¸Œçš„ã€‚</li><li>é›†åˆçš„å…ƒç´ å¿…é¡»æ˜¯å¯å“ˆå¸Œçš„å¯¹è±¡ï¼šé›†åˆä¹Ÿæ˜¯åŸºäºå“ˆå¸Œè¡¨å®ç°çš„ï¼Œå®ƒä½¿ç”¨å“ˆå¸Œå€¼æ¥ç¡®å®šå…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­ï¼Œå¹¶ä¸”ä¿è¯é›†åˆä¸­çš„å…ƒç´ å”¯ä¸€æ€§ã€‚æ‰€ä»¥é›†åˆä¸­çš„å…ƒç´ ä¹Ÿå¿…é¡»æ˜¯ä¸å¯å˜çš„å¯¹è±¡ã€‚</li></ol><p>æ€»ç»“èµ·æ¥ï¼Œå¯å“ˆå¸Œæ€§æ˜¯æŒ‡å¯¹è±¡åœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­ä¸å‘ç”Ÿæ”¹å˜ï¼Œå¹¶ä¸”èƒ½å¤Ÿé€šè¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—å¾—åˆ°ä¸€ä¸ªå›ºå®šçš„ã€å”¯ä¸€çš„å“ˆå¸Œå€¼ã€‚å¯å“ˆå¸Œçš„å¯¹è±¡å¯ä»¥ä½œä¸ºå­—å…¸çš„é”®å’Œé›†åˆçš„å…ƒç´ ä½¿ç”¨ã€‚</p><h2 id="2-2-è‡ªå®šä¹‰ç±»å‹çš„å¯å“ˆå¸Œæ€§"><a href="#2-2-è‡ªå®šä¹‰ç±»å‹çš„å¯å“ˆå¸Œæ€§" class="headerlink" title="2.2 è‡ªå®šä¹‰ç±»å‹çš„å¯å“ˆå¸Œæ€§"></a>2.2 è‡ªå®šä¹‰ç±»å‹çš„å¯å“ˆå¸Œæ€§</h2><p>è‡ªå®šä¹‰ç±»å‹ï¼ˆCustom typesï¼‰å¯ä»¥ç»´æŠ¤å¯å“ˆå¸Œæ€§ï¼Œä½†éœ€è¦æ»¡è¶³ä¸€å®šçš„æ¡ä»¶ã€‚</p><p>åœ¨Pythonä¸­ï¼Œå¯¹è±¡çš„å¯å“ˆå¸Œæ€§æ˜¯ç”±å…¶æ‰€å±ç±»çš„<code>__hash__()</code>æ–¹æ³•å’Œ<code>__eq__()</code>æ–¹æ³•å…±åŒå†³å®šçš„ã€‚ä¸‹é¢æ˜¯å…³äºè‡ªå®šä¹‰ç±»å‹ç»´æŠ¤å¯å“ˆå¸Œæ€§çš„æ¡ä»¶ï¼š</p><ol><li><p><code>__hash__()</code>æ–¹æ³•çš„å®ç°ï¼šè‡ªå®šä¹‰ç±»å‹å¿…é¡»å®šä¹‰<code>__hash__()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªæ•´æ•°ä½œä¸ºå¯¹è±¡çš„å“ˆå¸Œå€¼ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¯ä½¿ç”¨å†…ç½®å‡½æ•°<code>hash()</code>æ¥è®¡ç®—å“ˆå¸Œå€¼ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__hash__</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">hash</span>((self.attribute1, self.attribute2, ...))</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<code>__hash__()</code>æ–¹æ³•åº”è¯¥è¿”å›ä¸€ä¸ªä¸å¯å˜çš„å€¼ï¼Œå¹¶ä¸”ç›¸ç­‰çš„å¯¹è±¡åº”è¯¥å…·æœ‰ç›¸ç­‰çš„å“ˆå¸Œå€¼ã€‚</p></li><li><p><code>__eq__()</code>æ–¹æ³•çš„å®ç°ï¼šä¸ºäº†ç¡®ä¿ç›¸ç­‰çš„å¯¹è±¡å…·æœ‰ç›¸ç­‰çš„å“ˆå¸Œå€¼ï¼Œè‡ªå®šä¹‰ç±»å‹ä¹Ÿå¿…é¡»å®šä¹‰<code>__eq__()</code>æ–¹æ³•æ¥æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚<code>__eq__()</code>æ–¹æ³•é€šå¸¸ä¸<code>__hash__()</code>æ–¹æ³•é…åˆä½¿ç”¨ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, other</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, self.__class__):</span><br><span class="line">        <span class="keyword">return</span> (self.attribute1 == other.attribute1) <span class="keyword">and</span> (self.attribute2 == other.attribute2) <span class="keyword">and</span> ...</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<code>__eq__()</code>æ–¹æ³•åº”è¯¥è¿”å›å¸ƒå°”å€¼è¡¨ç¤ºä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚</p></li></ol><p>é€šè¿‡æ­£ç¡®å®ç°<code>__hash__()</code>å’Œ<code>__eq__()</code>æ–¹æ³•ï¼Œè‡ªå®šä¹‰ç±»å‹å°±å¯ä»¥ç»´æŠ¤å¯å“ˆå¸Œæ€§ã€‚è¿™æ ·ï¼Œå¯¹è±¡å°±å¯ä»¥ä½œä¸ºå­—å…¸çš„é”®æˆ–é›†åˆçš„å…ƒç´ ï¼Œå¹¶èƒ½å¤Ÿä¿æŒä¸å˜æ€§å’Œç›¸ç­‰æ€§çš„åˆ¤æ–­ã€‚</p><p>ç„¶è€Œï¼Œè¯·æ³¨æ„ï¼Œå¦‚æœè‡ªå®šä¹‰ç±»å‹ä¸­çš„å±æ€§æ˜¯å¯å˜çš„ï¼ˆä¾‹å¦‚åˆ—è¡¨ã€é›†åˆç­‰ï¼‰ï¼Œåˆ™å¯¹è±¡å¯èƒ½ä¼šå‘ç”Ÿæ”¹å˜ï¼Œå¯¼è‡´å“ˆå¸Œå€¼çš„æ”¹å˜ã€‚å› æ­¤ï¼Œåœ¨å®šä¹‰å¯å“ˆå¸Œçš„è‡ªå®šä¹‰ç±»å‹æ—¶ï¼Œ<strong>åº”è¯¥é¿å…ä½¿ç”¨å¯å˜çš„å±æ€§</strong>ã€‚</p><h3 id="2-2-1-hash-è‡ªå®šä¹‰ç±»å‹"><a href="#2-2-1-hash-è‡ªå®šä¹‰ç±»å‹" class="headerlink" title="2.2.1 hash(è‡ªå®šä¹‰ç±»å‹)"></a>2.2.1 hash(è‡ªå®šä¹‰ç±»å‹)</h3><p>å½“æˆ‘ä»¬ä½¿ç”¨ <code>hash</code>å‡½æ•°æ¥å¤„ç†è‡ªå®šä¹‰ç±»å‹æ—¶ï¼Œpythonå°±ä¼šè°ƒç”¨è¿™ä¸ªè‡ªå®šä¹‰ç±»å‹çš„ <code>__hash__()</code>å‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">hash</span>(p1)</span><br><span class="line"><span class="comment"># ç­‰ä»·äº</span></span><br><span class="line">p1.__hash__()</span><br></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>__hash__ </code>æ–¹æ³•è¿”å›å¯¹è±¡çš„æ ‡è¯†ç¬¦ï¼Œè€Œ <code>__eq__</code> æ–¹æ³•åœ¨ä¸¤ä¸ªå¯¹è±¡ç›¸åŒæ—¶è¿”å› Trueã€‚å¦‚æœæƒ³è¦è¦†ç›–è¿™ä¸ªé»˜è®¤è¡Œä¸ºï¼Œæˆ‘ä»¬å¯ä»¥å®ç°<code> __hash__</code> æ–¹æ³•å’Œ <code>__eq__</code> æ–¹æ³•ã€‚</p><h3 id="2-2-2-åªå®ç°eq"><a href="#2-2-2-åªå®ç°eq" class="headerlink" title="2.2.2 åªå®ç°eq"></a>2.2.2 åªå®ç°eq</h3><p>å¦‚æœä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹åªå®ç°äº† <code>__eq__</code>è€Œæ²¡æœ‰å®ç° <code>__hash__</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å‹å°±ä¸å…·å¤‡å¯å“ˆå¸Œæ€§ï¼Œä¹Ÿå°±ä¸èƒ½ä½œä¸ºdictæˆ–è€…é›†å’Œçš„é”®å€¼</p><p>æ¯”å¦‚å¦‚ä¸‹personå¯¹è±¡åªå®ç°äº† <code>__eq__</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">isinstance</span>(other, Person) <span class="keyword">and</span> self.age == other.age</span><br></pre></td></tr></table></figure><p>å¦‚æœå°è¯•å°†è¿™ä¸ªå¯¹è±¡æ”¾å…¥setï¼Œå°±ä¼šæŠ¥é”™</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">members = &#123;</span><br><span class="line">    Person(<span class="string">&#x27;John&#x27;</span>, <span class="number">22</span>),</span><br><span class="line">    Person(<span class="string">&#x27;Jane&#x27;</span>, <span class="number">22</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TypeError: unhashable type: &#x27;Person&#x27;</span><br></pre></td></tr></table></figure><p>åŒæ—¶personå¯¹è±¡å¤±å»äº†hashåŠŸèƒ½</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">hash</span>(Person(<span class="string">&#x27;John&#x27;</span>, <span class="number">22</span>))</span><br><span class="line"><span class="comment"># TypeError: unhashable type: &#x27;Person&#x27;</span></span><br></pre></td></tr></table></figure><p>ä¸ºäº†ä½¿å¾— Person ç±»å¯å“ˆå¸Œï¼Œæˆ‘ä»¬è¿˜éœ€è¦å®ç° <code>__hash__</code> æ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">isinstance</span>(other, Person) <span class="keyword">and</span> self.age == other.age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__hash__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">hash</span>(self.age)</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼ŒPerson ç±»æ—¢æ”¯æŒåŸºäº age çš„ç­‰å€¼æ¯”è¾ƒï¼Œåˆå…·æœ‰å“ˆå¸ŒåŠŸèƒ½ã€‚</p><p>ä¸ºäº†ä½¿å¾— Person èƒ½å¤Ÿæ­£å¸¸ç”¨äºå­—å…¸è¿™ç§æ•°æ®ç»“æ„ï¼Œç±»çš„å“ˆå¸Œå€¼å¿…é¡»å…·æœ‰ä¸å¯å˜æ€§ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°† age å®šä¹‰ä¸ºåªè¯»å±æ€§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self._age = age</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">age</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self._age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">isinstance</span>(other, Person) <span class="keyword">and</span> self.age == other.age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__hash__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">hash</span>(self.age)</span><br></pre></td></tr></table></figure><h3 id="2-2-3-æ€»ç»“"><a href="#2-2-3-æ€»ç»“" class="headerlink" title="2.2.3 æ€»ç»“"></a>2.2.3 æ€»ç»“</h3><ul><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>__hash__</code> æ–¹æ³•è¿”å›å¯¹è±¡çš„ IDï¼Œ<code>__eq__ </code>æ–¹æ³•ä½¿ç”¨ is æ“ä½œç¬¦è¿›è¡Œæ¯”è¾ƒã€‚</li><li>å¦‚æœå®ç°äº† <code>__eq__</code> æ–¹æ³•ï¼ŒPython ä¼šå°†<code> __hash__</code> æ–¹æ³•è®¾ç½®ä¸º Noneï¼Œé™¤éå®ç°äº†è‡ªå®šä¹‰çš„<code> __hash__</code> æ–¹æ³•ã€‚</li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;1-è¯´æ˜&quot;&gt;&lt;a href=&quot;#1-è¯´æ˜&quot; class=&quot;headerlink&quot; title=&quot;1.è¯´æ˜&quot;&gt;&lt;/a&gt;1.è¯´æ˜&lt;/h1&gt;&lt;p&gt;å…ƒç»„ï¼ˆtupleï¼‰ã€åˆ—è¡¨ï¼ˆlistï¼‰å’Œé›†åˆï¼ˆsetï¼‰æ˜¯Pythonä¸­å¸¸è§çš„æ•°æ®ç»“æ„ï¼Œå®ƒä»¬æœ‰ä¸€äº›é‡è¦çš„åŒºåˆ«ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="é€Ÿé€šPython" scheme="https://blog.musnow.top/categories/%E9%80%9F%E9%80%9APython/"/>
    
    
    <category term="Python" scheme="https://blog.musnow.top/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>ã€Pythonã€‘seleniumé‡åˆ°ActionChains.move_to_element() takes 2 positional arguments but 4 were givenæŠ¥é”™</title>
    <link href="https://blog.musnow.top/posts/2142561511/"/>
    <id>https://blog.musnow.top/posts/2142561511/</id>
    <published>2023-08-15T04:06:19.000Z</published>
    <updated>2023-08-15T05:15:17.000Z</updated>
    
    <content type="html"><![CDATA[<p>åˆšå¼€å§‹å­¦çš„æ—¶å€™ï¼Œç”¨ç«ç»’çš„seleniumæ’ä»¶å½•åˆ¶äº†ä¸€ä¸ªæ“ä½œï¼Œå¯¼å‡ºä¸ºäº†pythonæ–‡ä»¶ï¼›</p><span id="more"></span><p>ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤è¿è¡Œè¿™ä¸ªæ–‡ä»¶ï¼ˆå¦‚æœæ²¡æœ‰pytestç”¨pipå®‰è£…ä¸€ä¸‹å°±è¡Œï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install pytest</span><br><span class="line">pip install selenium</span><br></pre></td></tr></table></figure><p>ç”¨å¦‚ä¸‹å‘½ä»¤æ‰§è¡Œå¯¼å‡ºçš„æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pytest test_test01.py</span><br></pre></td></tr></table></figure><p>ä¼šå¾—åˆ°è¿™ä¸ªæŠ¥é”™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">      actions = ActionChains(self.driver)</span><br><span class="line">&gt;     actions.move_to_element(element, 0, 0).perform()</span><br><span class="line">E     TypeError: ActionChains.move_to_element() takes 2 positional arguments but 4 were given</span><br><span class="line"></span><br><span class="line">test_test1.py:42: TypeError</span><br></pre></td></tr></table></figure><p>å¯æˆ‘å‹æ ¹æ²¡æœ‰ä¿®æ”¹è¿‡å¯¼å‡ºçš„æ–‡ä»¶ï¼Œè¿™ä¸ªæŠ¥é”™æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿ</p><p>ç›®æµ‹æ˜¯é«˜ä½ç‰ˆæœ¬çš„pythonçš„seleniumåŒ…ä¸­ï¼ŒæŠ¥é”™çš„<code>ActionChains.move_to_element()</code>è¿™ä¸ªå‡½æ•°çš„ä¼ å‚è¢«ä¿®æ”¹è¿‡ï¼›è€Œæ’ä»¶ç”Ÿæˆçš„ä»£ç ä¸­ï¼Œä¸Šæ–¹çš„è¿™ä¸ªå°±æ˜¯æ­£ç¡®çš„ä¼ å‚ï¼Œä¸‹æ–¹çš„è¿™ä¸ªå¸¦<code>0,0</code>çš„ä¼ å‚æ˜¯é”™è¯¯çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3 | mouseOver | css=.row:nth-child(5) &gt; .col-sm-3:nth-child(3) &gt; .xe-widget | </span></span><br><span class="line">element = self.driver.find_element(By.CSS_SELECTOR, <span class="string">&quot;.row:nth-child(5) &gt; .col-sm-3:nth-child(3) &gt; .xe-widget&quot;</span>)</span><br><span class="line">actions = ActionChains(self.driver)</span><br><span class="line">actions.move_to_element(element).perform()  <span class="comment"># æ­£ç¡®</span></span><br><span class="line"><span class="comment"># 4 | mouseOut | css=.row:nth-child(5) &gt; .col-sm-3:nth-child(3) &gt; .xe-widget | </span></span><br><span class="line">element = self.driver.find_element(By.CSS_SELECTOR, <span class="string">&quot;body&quot;</span>)</span><br><span class="line">actions = ActionChains(self.driver)</span><br><span class="line">actions.move_to_element(element, <span class="number">0</span>, <span class="number">0</span>).perform() <span class="comment"># é”™è¯¯</span></span><br></pre></td></tr></table></figure><p><img src="https://img.musnow.top/i/2023/08/1585f2651b13965219be66828b1d5dbb.png" alt="image-20230815130034250"></p><p>å¯ä»¥æŸ¥çœ‹å‡½æ•°å®šä¹‰ï¼Œåªæ¥å—ä¸€ä¸ªå‚æ•°</p><p><img src="https://img.musnow.top/i/2023/08/98f151c08184d9de59cdca2d7bc0aa14.png" alt="image-20230815130102297"></p><p>æŠŠè¿™é‡Œçš„ä¸¤ä¸ª<code>0,0</code>åˆ é™¤æ‰å°±è¡Œäº†ï¼Œè¿è¡Œçš„ç»“æœå’Œæˆ‘å½•åˆ¶çš„æ•ˆæœç›¸åŒï¼Œæ²¡æœ‰é—®é¢˜ï¼</p><p><img src="https://img.musnow.top/i/2023/08/93101cc08b96ec6f3328e904dc331b31.png" alt="image-20230815130134022"></p><p>é¡ºå¸¦é™„ä¸Šæœ¬æ¬¡debugçš„ç‰ˆæœ¬å·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python             3.10.5</span><br><span class="line">pytest             7.4.0</span><br><span class="line">selenium           4.11.2</span><br><span class="line">ç«ç‹æµè§ˆå™¨ç‰ˆæœ¬ 116.0.2ï¼ˆ64ä½ï¼‰</span><br><span class="line">ç«ç‹æµè§ˆå™¨Selenium IDEæ’ä»¶ç‰ˆæœ¬ 3.17.4</span><br></pre></td></tr></table></figure><p>å¦‚æœå¸®åˆ°äº†ä½ ï¼Œè¿˜è¯·è¯„è®ºæ”¯æŒæˆ‘ä¸€ä¸‹ï¼Œè°¢è°¢ï¼</p>]]></content>
    
    
    <summary type="html">pythonçš„seleniumé‡åˆ°ActionChains.move_to_element() takes 2 positional arguments but 4 were givenæŠ¥é”™</summary>
    
    
    
    <category term="é€Ÿé€šPython" scheme="https://blog.musnow.top/categories/%E9%80%9F%E9%80%9APython/"/>
    
    
    <category term="Python" scheme="https://blog.musnow.top/tags/Python/"/>
    
    <category term="selenium" scheme="https://blog.musnow.top/tags/selenium/"/>
    
  </entry>
  
  <entry>
    <title>ã€Pythonã€‘è‡ªåŠ¨åŒ–æµ‹è¯•selenium</title>
    <link href="https://blog.musnow.top/posts/192617188/"/>
    <id>https://blog.musnow.top/posts/192617188/</id>
    <published>2023-08-14T04:15:19.000Z</published>
    <updated>2023-08-15T03:15:17.000Z</updated>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ è‡ªåŠ¨åŒ–æµ‹è¯•seleniumçš„ç¬”è®°</p><span id="more"></span><h1 id="1-ä»€ä¹ˆæ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•"><a href="#1-ä»€ä¹ˆæ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•" class="headerlink" title="1.ä»€ä¹ˆæ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•"></a>1.ä»€ä¹ˆæ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•</h1><p>è‡ªåŠ¨åŒ–æµ‹è¯•æŒ‡è½¯ä»¶æµ‹è¯•çš„è‡ªåŠ¨åŒ–ï¼Œåœ¨é¢„è®¾çŠ¶æ€ä¸‹è¿è¡Œåº”ç”¨ç¨‹åºæˆ–è€…ç³»ç»Ÿï¼Œé¢„è®¾æ¡ä»¶åŒ…æ‹¬æ­£å¸¸å’Œå¼‚å¸¸ï¼Œæœ€åè¯„ä¼°è¿è¡Œç»“æœã€‚å°†äººä¸ºé©±åŠ¨çš„æµ‹è¯•è¡Œä¸ºè½¬åŒ–ä¸ºæœºå™¨æ‰§è¡Œçš„è¿‡ç¨‹ã€‚</p><p>è¯´ç™½äº†å°±æ˜¯ç¼–å†™ä¸€ç³»åˆ—ä»£ç æ¥å®ç°è‡ªåŠ¨å¸®æˆ‘ä»¬æµ‹è¯•æŸä¸€ä¸ªåŠŸèƒ½æ˜¯å¦æœ‰å•¥é—®é¢˜ã€‚æ¯”èµ·è‡ªå·±å¼„ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•èƒ½è¦†ç›–åˆ°æ›´å¤šæƒ…å†µï¼Œç‰¹åˆ«æ˜¯æŸäº›åœ¨å®é™…æƒ…å†µä¸­ä¸å¥½é€šè¿‡äººå·¥æ¨¡æ‹Ÿå‡ºçš„é—®é¢˜ã€‚</p><p>ä¸‹å›¾æ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•çš„é‡‘å­—å¡”æ¨¡å‹ï¼Œä»ä¸‹å¾€ä¸Šä»£è¡¨æµ‹è¯•éœ€è¦çš„æ—¶é—´å’ŒæŠ•å…¥ï¼Œå•å…ƒæµ‹è¯•åº”è¯¥æ˜¯æŠ•å…¥æœ€å¤§çš„æµ‹è¯•ã€‚</p><p><img src="https://img.musnow.top/i/2023/08/5f7243ac0ec65b8cd62f68a8941bfb27.png" alt="img"></p><h2 id="1-1-å•å…ƒæµ‹è¯•"><a href="#1-1-å•å…ƒæµ‹è¯•" class="headerlink" title="1.1 å•å…ƒæµ‹è¯•"></a>1.1 å•å…ƒæµ‹è¯•</h2><p>æ‰€è°“å•å…ƒæµ‹è¯•ï¼Œå°±æ˜¯æˆ‘ä»¬ä»£ç ä¸­æ¯ä¸€ä¸ªå‡½æ•°ã€ç¨‹åºæ¨¡å—çš„æµ‹è¯•ã€‚</p><p>å•å…ƒæµ‹è¯•é€šå¸¸éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li><strong>ç¼–å†™æµ‹è¯•ç”¨ä¾‹</strong>ï¼šä¸ºæ¯ä¸ªå‡½æ•°ã€æ–¹æ³•æˆ–ç±»ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œè¿™äº›ç”¨ä¾‹åŒ…æ‹¬è¾“å…¥æ•°æ®ã€é¢„æœŸè¾“å‡ºä»¥åŠå¯¹åº”çš„å‡½æ•°è°ƒç”¨ã€‚</li><li><strong>è¿è¡Œæµ‹è¯•</strong>ï¼šä½¿ç”¨å•å…ƒæµ‹è¯•æ¡†æ¶è¿è¡Œç¼–å†™çš„æµ‹è¯•ç”¨ä¾‹ã€‚æµ‹è¯•æ¡†æ¶ä¼šæ‰§è¡Œæµ‹è¯•å¹¶æŠ¥å‘Šæ¯ä¸ªæµ‹è¯•çš„ç»“æœã€‚</li><li><strong>æ–­è¨€æµ‹è¯•ç»“æœ</strong>ï¼šæµ‹è¯•æ¡†æ¶ä¼šè‡ªåŠ¨æ¯”è¾ƒå®é™…è¾“å‡ºä¸é¢„æœŸè¾“å‡ºï¼Œå¦‚æœä¸åŒ¹é…åˆ™ä¼šäº§ç”Ÿé”™è¯¯æŠ¥å‘Šã€‚</li><li><strong>ä¿®å¤é”™è¯¯</strong>ï¼šå¦‚æœæµ‹è¯•å¤±è´¥ï¼Œå¼€å‘äººå‘˜éœ€è¦æ£€æŸ¥ä»£ç å¹¶ä¿®å¤é—®é¢˜ï¼Œç¡®ä¿ä»£ç æŒ‰é¢„æœŸå·¥ä½œã€‚</li><li><strong>é‡å¤æµ‹è¯•</strong>ï¼šåœ¨æ¯æ¬¡ä»£ç æ›´æ”¹åï¼Œéƒ½éœ€è¦é‡æ–°è¿è¡Œç›¸åº”çš„å•å…ƒæµ‹è¯•ï¼Œä»¥ç¡®ä¿æ–°çš„æ›´æ”¹æ²¡æœ‰ç ´åç°æœ‰çš„åŠŸèƒ½ã€‚</li></ol><p>å•å…ƒæµ‹è¯•çš„ç›®æ ‡ï¼Œå°±æ˜¯ä¿è¯æˆ‘ä»¬å†™å‡ºæ¥çš„å‡½æ•°æ˜¯ä¾ç…§æˆ‘ä»¬çš„é¢„æœŸè¿è¡Œçš„ï¼Œèƒ½å¾—åˆ°æˆ‘ä»¬éœ€è¦çš„ç»“æœã€‚è€Œæœ€ç»ˆç›®çš„ï¼Œå°±æ˜¯é¿å…å½“ä¸€ä¸ªå‡½æ•°å·²ç»æŠ•å…¥ä½¿ç”¨äº†ï¼Œæ‰å‘ç°è¿™ä¸ªå‡½æ•°çš„è¿è¡Œä¸é¢„æœŸç»“æœä¸ç¬¦åˆã€‚</p><h2 id="1-2-æ¥å£æµ‹è¯•"><a href="#1-2-æ¥å£æµ‹è¯•" class="headerlink" title="1.2 æ¥å£æµ‹è¯•"></a>1.2 æ¥å£æµ‹è¯•</h2><p>ç›®å‰ä¸€èˆ¬é‡‡ç”¨åç«¯æä¾›APIæ¥å£ï¼Œå‰ç«¯ä½¿ç”¨é™æ€é¡µé¢çš„æ–¹å¼æ¥å®ç°å‰åç«¯åˆ†ç¦»ã€‚</p><p>è€Œæ¥å£æµ‹è¯•ï¼Œå°±æ˜¯ä¿è¯æˆ‘ä»¬åç«¯æä¾›çš„APIæ¥å£èƒ½æ­£ç¡®åˆ†ç¦»æˆ‘ä»¬é¢„æœŸçš„å‚æ•°ï¼Œå¹¶æä¾›ä¸ä¹‹ç›¸ç¬¦åˆçš„è¿”å›ç»“æœã€‚</p><p>å½“æˆ‘ä»¬å®Œæˆäº†åç«¯æ¥å£çš„ç¼–å†™åï¼Œå°±èƒ½åœ¨äº§å“å‰æœŸè¿›è¡Œæ¥å£æµ‹è¯•ï¼Œé¿å…äº§å“å·²ç»ä¸Šçº¿äº†æ‰å‘ç°æ¥å£æœ‰é—®é¢˜çš„æƒ…å†µã€‚</p><ul><li>äº§å“å‰æœŸæ¥å£å®Œæˆåä»‹å…¥</li><li>ç”¨ä¾‹ç»´æŠ¤é‡å°</li><li>é€‚åˆæ¥å£å˜åŠ¨è¾ƒå°ï¼Œç•Œé¢å˜åŠ¨é¢‘ç¹çš„é¡¹ç›®</li></ul><p>å¸¸è§çš„æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·æœ‰ï¼šRobotFrameworkï¼ŒJMeterï¼ŒSoapUIï¼ŒTestNG+HttpClientï¼ŒPostman ç­‰ã€‚</p><h2 id="1-3-UIæµ‹è¯•"><a href="#1-3-UIæµ‹è¯•" class="headerlink" title="1.3 UIæµ‹è¯•"></a>1.3 UIæµ‹è¯•</h2><p>å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œä»–ä»¬æ¥è§¦åˆ°çš„å…¶å®è¿˜æ˜¯UIï¼ˆå‰ç«¯ï¼‰ï¼Œåœ¨å®Œæˆäº†æ¥å£æµ‹è¯•åï¼Œæˆ‘ä»¬éœ€è¦å¯¹å‰ç«¯ç•Œé¢çš„æ“ä½œè¿›è¡Œæµ‹è¯•ã€‚ç‰¹ç‚¹ï¼š</p><ul><li>ç”¨ä¾‹ç»´æŠ¤é‡å¤§</li><li>é¡µé¢ç›¸å…³æ€§å¼ºï¼Œéœ€è¦å®ŒæˆåæœŸé¡¹ç›®å¼€å‘åæ‰ä»‹å…¥</li><li>ç”±äºå‰ç«¯ç•Œé¢ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¤æ‚ï¼ŒUIæµ‹è¯•é€‚åˆç•Œé¢å˜åŠ¨è¾ƒå°çš„é¡¹ç›®</li></ul><p>UIè‡ªåŠ¨åŒ–æµ‹è¯•çš„å¥½å¤„</p><ul><li>å‡å°‘é‡å¤æµ‹è¯•çš„æ—¶é—´ï¼Œå®ç°å¿«é€Ÿå›å½’æµ‹è¯•</li><li>åˆ›å»ºå¯é çš„æµ‹è¯•è¿‡ç¨‹ï¼Œé¿å…æµ‹è¯•è¿‡ç¨‹ä¸­çš„äººä¸ºé”™è¯¯</li><li>å¯ä»¥å®ç°å¾ˆå¤šæ›´åŠ ç¹ççš„æµ‹è¯•ï¼Œæˆ–è€…éš¾ä»¥ç”¨äººå·¥å®ç°çš„æµ‹è¯•ï¼Œå‡å°‘äººåŠ›æˆæœ¬</li><li>æ›´å¥½çš„åˆ©ç”¨èµ„æºå’Œæµ‹è¯•è„šæœ¬</li></ul><p>UIå±‚çš„æµ‹è¯•æ¡†æ¶æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚Windowså®¢æˆ·ç«¯æµ‹è¯•çš„AutoITï¼Œwebæµ‹è¯•çš„seleniumä»¥åŠTestPlant eggPlantï¼ŒRobot frameworkï¼ŒQTPç­‰ã€‚</p><h2 id="1-4-è‡ªåŠ¨åŒ–æµ‹è¯•é€‚ç”¨å¯¹è±¡"><a href="#1-4-è‡ªåŠ¨åŒ–æµ‹è¯•é€‚ç”¨å¯¹è±¡" class="headerlink" title="1.4 è‡ªåŠ¨åŒ–æµ‹è¯•é€‚ç”¨å¯¹è±¡"></a>1.4 è‡ªåŠ¨åŒ–æµ‹è¯•é€‚ç”¨å¯¹è±¡</h2><ol><li>äº§å“å‹é¡¹ç›®ã€‚äº§å“å‹çš„é¡¹ç›®ï¼Œæ–°ç‰ˆæœ¬æ˜¯åœ¨æ—§ç‰ˆæœ¬çš„åŸºç¡€ä¸Šè¿›è¡Œæ”¹è¿›ï¼ŒåŠŸèƒ½å˜ä¸å¤§çš„é¡¹ç›®ï¼Œä½†é¡¹ç›®çš„æ–°è€åŠŸèƒ½éƒ½å¿…é¡»é‡å¤çš„è¿›è¡Œå›å½’æµ‹è¯•ã€‚<strong>å›å½’æµ‹è¯•æ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•çš„å¼ºé¡¹</strong>ï¼Œå®ƒèƒ½å¤Ÿå¾ˆå¥½çš„éªŒè¯ä½ æ˜¯å¦å¼•å…¥äº†æ–°çš„ç¼ºé™·ï¼Œè€çš„ç¼ºé™·æ˜¯å¦ä¿®æ”¹è¿‡æ¥äº†ã€‚åœ¨æŸç§ç¨‹åº¦ä¸Šå¯ä»¥æŠŠè‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·å«åšå›å½’æµ‹è¯•å·¥å…·ã€‚</li><li>æœºæ¢°é¢‘ç¹çš„æµ‹è¯•ã€‚æ¯æ¬¡éœ€è¦è¾“å…¥å¤§é‡ç”¨ä¾‹ï¼Œå¹¶ä¸”åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­è¿è¡Œçš„å‘¨æœŸæ¯”è¾ƒé•¿ã€‚ æ¯”å¦‚å…¼å®¹æ€§æµ‹è¯•ã€‚</li></ol><p>ä»¥ä¸‹æƒ…å†µå°±ä¸é€‚ç”¨äºè‡ªåŠ¨åŒ–æµ‹è¯•ï¼š</p><ol><li>éœ€æ±‚å˜åŠ¨é¢‘ç¹ï¼Œè‡ªåŠ¨åŒ–è„šæœ¬ä¸èƒ½å¾ˆå¥½çš„å¤ç”¨ï¼ˆå†™ä¸ªæµ‹è¯•è„šæœ¬çš„æ—¶é—´éƒ½å¤Ÿäººå·¥æµ‹è¯•äº†ï¼Œè‡ªç„¶ä¸é€‚åˆè‡ªåŠ¨åŒ–æµ‹è¯•ï¼‰</li><li>é¡¹ç›®å‘¨æœŸçŸ­ï¼Œè‡ªåŠ¨åŒ–è„šæœ¬ç¼–å†™å®Œæ¯•åä½¿ç”¨æ¬¡æ•°ä¸å¤šï¼ˆæ²¡å•¥æ—¶é—´å†™è„šæœ¬ï¼‰</li><li>äº¤äº’æ€§è¾ƒå¼ºï¼Œéœ€è¦äººå·¥å¹²é¢„çš„é¡¹ç›®ï¼Œè‡ªåŠ¨åŒ–æ— æ³•å®æ–½</li></ol><h2 id="1-5-å¦‚ä½•å®æ–½è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Ÿ"><a href="#1-5-å¦‚ä½•å®æ–½è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Ÿ" class="headerlink" title="1.5 å¦‚ä½•å®æ–½è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Ÿ"></a>1.5 å¦‚ä½•å®æ–½è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Ÿ</h2><p>å•çº¯çš„è®²ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•çš„å…·ä½“å®ç°ï¼Œåº”è¯¥æ˜¯åŒ…å«ä¸‹é¢ä¸ƒä¸ªè¿‡ç¨‹çš„ã€‚</p><ol><li>åˆ†æï¼šæ€»ä½“æŠŠæ¡ç³»ç»Ÿé€»è¾‘ï¼Œåˆ†æå‡ºç³»ç»Ÿçš„æ ¸å¿ƒä½“ç³»æ¶æ„ã€‚</li><li>è®¾è®¡ï¼šè®¾è®¡æµ‹è¯•ç”¨ä¾‹ï¼Œæµ‹è¯•ç”¨ä¾‹è¦è¶³å¤Ÿæ˜ç¡®å’Œæ¸…æ™°ï¼Œè¦†ç›–é¢å¹¿è€Œç²¾</li><li>å®ç°ï¼šå®ç°è„šæœ¬ï¼Œæœ‰ä¸¤ä¸ªè¦æ±‚ä¸€æ˜¯æ–­è¨€ï¼ŒäºŒæ˜¯åˆç†çš„è¿ç”¨å‚æ•°åŒ–ã€‚</li><li>æ‰§è¡Œï¼šæ‰§è¡Œè„šæœ¬è¿œè¿œæ²¡æœ‰æˆ‘ä»¬æƒ³è±¡ä¸­é‚£ä¹ˆç®€å•ã€‚è„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å¼‚å¸¸éœ€è¦æˆ‘ä»¬ä»”ç»†çš„å»åˆ†æåŸå› ã€‚</li><li>æ€»ç»“ï¼šæµ‹è¯•ç»“æœçš„åˆ†æï¼Œå’Œæµ‹è¯•è¿‡ç¨‹çš„æ€»ç»“æ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•çš„å…³é”®ã€‚</li><li>ç»´æŠ¤ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬çš„ç»´æŠ¤æ˜¯ä¸€ä¸ªéš¾ä»¥è§£å†³ä½†åˆå¿…é¡»è¦è§£å†³çš„é—®é¢˜ã€‚</li><li>åˆ†æï¼šåœ¨è‡ªåŠ¨åŒ–æµ‹è¯•è¿‡ç¨‹ä¸­æ·±åˆ»çš„åˆ†æè‡ªåŠ¨åŒ–ç”¨ä¾‹çš„è¦†ç›–é£é™©å’Œè„šæœ¬ç»´æŠ¤çš„æˆæœ¬ã€‚</li></ol><p><img src="https://img.musnow.top/i/2023/08/a5e5ecae7b4936d6e5873bfab8420fab.jpeg" alt="img"></p><h1 id="2-å®‰è£…Seleniumç¯å¢ƒ"><a href="#2-å®‰è£…Seleniumç¯å¢ƒ" class="headerlink" title="2.å®‰è£…Seleniumç¯å¢ƒ"></a>2.å®‰è£…Seleniumç¯å¢ƒ</h1><p>æœ¬æ–‡ä½¿ç”¨å„ä¸ªè½¯ä»¶çš„ç‰ˆæœ¬å·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python             3.10.5</span><br><span class="line">pytest             7.4.0</span><br><span class="line">selenium           4.11.2</span><br><span class="line">ç«ç‹æµè§ˆå™¨ç‰ˆæœ¬   116.0.2ï¼ˆ64ä½ï¼‰</span><br><span class="line">ç«ç‹æµè§ˆå™¨Selenium IDEæ’ä»¶ç‰ˆæœ¬ 3.17.4</span><br></pre></td></tr></table></figure><h2 id="2-1-ç«ç‹å®‰è£…Selenium-IDE"><a href="#2-1-ç«ç‹å®‰è£…Selenium-IDE" class="headerlink" title="2.1 ç«ç‹å®‰è£…Selenium IDE"></a>2.1 ç«ç‹å®‰è£…Selenium IDE</h2><p>æ‰“å¼€ç«ç‹ï¼Œç‚¹å‡»å³ä¸Šè§’é€‰æ‹©æ¡†ï¼Œè¿›å…¥<code>æ‰©å±•å’Œä¸»é¢˜</code></p><p><img src="https://img.musnow.top/i/2023/08/675970df60fdda1c5931a6e121a4bc00.png" alt="image-20230815131901498"></p><p>ç‚¹å‡»å·¦ä¾§æ‰©å±•ï¼Œæœç´¢ <code>Selenium IDE</code></p><p><img src="https://img.musnow.top/i/2023/08/7704b53b2e4ac86a133773adc5af5a74.png" alt="image-20230815131919494"></p><p>ç¬¬ä¸€ä¸ªå°±æ˜¯æˆ‘ä»¬è¦çš„ï¼Œå›¾æ ‡æ˜¯è“è‰²çš„ï¼Œä¸­é—´æœ‰ä¸€ä¸ªSeå­—æ¯</p><p><img src="https://img.musnow.top/i/2023/08/505fb45af8a3d4f3f13c1c9dc5e64f5e.png" alt="image-20230815132002494"></p><p>è¿›å…¥åï¼Œç‚¹å‡»è·å–æ’ä»¶ï¼ˆè¿™é‡Œæˆ‘å·²ç»å®‰è£…äº†ï¼Œæ‰€ä»¥æ˜¾ç¤ºçš„æ˜¯<code>ç§»é™¤</code>ï¼‰</p><p><img src="https://img.musnow.top/i/2023/08/788ae4be22001f41bf790a034765fec3.png" alt="image-20230815132027959"></p><h2 id="2-2-windowså®‰è£…python"><a href="#2-2-windowså®‰è£…python" class="headerlink" title="2.2 windowså®‰è£…python"></a>2.2 windowså®‰è£…python</h2><p>åœ¨windowsä¸Špythonå®‰è£…çš„åŸºç¡€æ­¥éª¤å‚è€ƒæˆ‘çš„è¿™ç¯‡åšå®¢ï¼š<a href="https://blog.musnow.top/posts/800910784/">ã€Pythonã€‘åœ¨ä½ çš„äº‘æœåŠ¡&#x2F;ç”µè„‘ä¸Šæ­å»ºPythonç¯å¢ƒ</a></p><blockquote><p>åˆæ¬¡å®‰è£…pythonçš„æ—¶å€™ï¼Œä¸€å®šè¦å‹¾é€‰<code>ADD PYTHON TO PATH</code>è¿™ä¸ªé€‰é¡¹ï¼Œè¿™ä¸ªåœ¨ä¸Šæ–‡ä¸­æœ‰æåŠã€‚å› ä¸ºéå¸¸é‡è¦æ‰€ä»¥å¤šè¯´å‡ æ¬¡ï¼</p></blockquote><p>å®‰è£…å¥½pythonåï¼Œä½¿ç”¨pipå®‰è£…å¦‚ä¸‹ä¸¤ä¸ªåŒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install pytest</span><br><span class="line">pip install selenium</span><br></pre></td></tr></table></figure><p>å¦‚æœæŒ‰ç…§çš„å¾ˆæ…¢å¯ä»¥åŠ ä¸Šé•œåƒæº</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install pytest -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line">pip install selenium  -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure><p>windowsä¸‹å¦‚ä½•é…ç½®pipé•œåƒæºå‚è€ƒï¼š<a href="https://blog.musnow.top/posts/783373963/">ã€Pythonã€‘pipä¸‹è½½ä½¿ç”¨å›½å†…é•œåƒæº</a></p><h2 id="2-3-å®‰è£…ç«ç‹é©±åŠ¨geckodriver"><a href="#2-3-å®‰è£…ç«ç‹é©±åŠ¨geckodriver" class="headerlink" title="2.3 å®‰è£…ç«ç‹é©±åŠ¨geckodriver"></a>2.3 å®‰è£…ç«ç‹é©±åŠ¨geckodriver</h2><p>å¦‚æœä½ å°è¯•ç›´æ¥è¿è¡Œseleniumçš„ä»£ç ï¼Œææœ‰å¯èƒ½ä¼šé‡åˆ°å¦‚ä¸‹æŠ¥é”™ï¼Œè¿™æ˜¯å› ä¸ºä½ æ²¡æœ‰å®‰è£…ç«ç‹å¯¹åº”çš„é©±åŠ¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WebDriverException: Message: &#x27;geckodriver&#x27; executable needs to be in PATH.</span><br></pre></td></tr></table></figure><p>ç«ç‹é©±åŠ¨ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/mozilla/geckodriver/releases">https://github.com/mozilla/geckodriver/releases</a></p><blockquote><p>chromeé©±åŠ¨ä¸‹è½½åœ°å€ï¼š<a href="https://registry.npmmirror.com/binary.html?path=chromedriver/">https://registry.npmmirror.com/binary.html?path=chromedriver/</a></p><p>å› ä¸ºæœ¬æ–‡æ“ä½œç”¨çš„éƒ½æ˜¯ç«ç‹ï¼Œæ‰€ä»¥ä¸æåŠchromeçš„æ“ä½œã€‚è¯·è‡ªè¡ŒæŸ¥é˜…å…¶ä»–æ–‡ç« </p></blockquote><p>ä¸‹è½½å¥½äº†ä¹‹åï¼Œå°†å…¶ä¸­çš„<strong>geckodriver.exe</strong>è§£å‹åˆ°windowsä¸‹pythonçš„å®‰è£…è·¯å¾„çš„Scriptsæ–‡ä»¶å¤¹ä¸‹ï¼›</p><p><img src="https://img.musnow.top/i/2023/08/f98740f110e8fa5a23720fe182c5f4ec.png" alt="image-20230815133452659"></p><p>å¦‚æœä½ ç”¨çš„æ˜¯ä¸Šé¢æåˆ°é‚£ç‰‡åšå®¢é‡Œé¢çš„å®‰è£…æ–¹å¼ï¼Œé‚£ä¹ˆåœ¨windowså¹³å°ä¸‹pythoné»˜è®¤çš„å®‰è£…è·¯å¾„å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\moth\AppData\Local\Programs\Python\Python310</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ä¸çŸ¥é“ä½ ç”µè„‘ä¸Špythonçš„å®‰è£…è·¯å¾„ï¼Œå¯ä»¥åœ¨vscodeçš„è§£æå™¨ä¸­æ‰¾åˆ°ï¼›å½“ä½ åœ¨vscodeä¸­æ‰“å¼€ä¸€ä¸ª<code>test.py</code>æ–‡ä»¶ï¼Œå³ä¸‹è§’å°±ä¼šæ˜¾ç¤ºå½“å‰ä½¿ç”¨çš„è§£æå™¨</p><p><img src="https://img.musnow.top/i/2023/08/27c18246029010c4cba8bf021c591c4b.png" alt="image-20230815133144736"></p><p>ç‚¹å‡»å®ƒï¼Œå°±èƒ½çœ‹åˆ°ä½ å®‰è£…çš„pythonçš„è·¯å¾„</p><p><img src="https://img.musnow.top/i/2023/08/f6f36703a94c25baa339161db2b7620f.png" alt="image-20230815133218786"></p><p>æ³¨æ„ï¼šå¦‚æœä½ çš„pythonæ˜¯ç”¨windowså•†åº—å®‰è£…çš„ï¼Œé‚£è·¯å¾„é‡Œé¢æ˜¯æ²¡æœ‰<code>Scripts</code>æ–‡ä»¶å¤¹çš„ï¼æ‰€ä»¥å¼ºçƒˆä¸æ¨èä½¿ç”¨windowså•†åº—æ¥å®‰è£…pythonï¼ˆè™½ç„¶ç¡®å®æ–¹ä¾¿ï¼‰</p><p>ä½ å¯ä»¥åœ¨windowsè®¾ç½®-è½¯ä»¶é‡Œé¢æ‰¾åˆ°å¾®è½¯å•†åº—å®‰è£…çš„pythonï¼Œå°†å…¶å¸è½½ï¼Œç„¶åå†ç”¨ä¸Šé¢æåˆ°çš„åŠæ³•é‡æ–°å®‰è£…ä½ éœ€è¦çš„ç‰ˆæœ¬çš„pythonï¼</p><p><img src="https://img.musnow.top/i/2023/08/19a0c5b80c517e0349dd13990cd0fa20.png" alt="image-20230815133414861"></p><h2 id="2-4-å°è¯•å½•åˆ¶ä¸€æ®µæ“ä½œ"><a href="#2-4-å°è¯•å½•åˆ¶ä¸€æ®µæ“ä½œ" class="headerlink" title="2.4 å°è¯•å½•åˆ¶ä¸€æ®µæ“ä½œ"></a>2.4 å°è¯•å½•åˆ¶ä¸€æ®µæ“ä½œ</h2><p>ä¸Šé¢çš„å®‰è£…éƒ½å®Œæˆåï¼Œå°±å¯ä»¥æ¥å°è¯•å½•åˆ¶ä¸€æ®µæ“ä½œäº†ã€‚è¿™é‡Œæˆ‘ä½¿ç”¨äº†æˆ‘è‡ªå·±çš„å¯¼èˆªé¡µæ¥æµ‹è¯•ï¼Œæ‰“å¼€ç«ç‹åï¼Œç‚¹å‡»å³ä¸Šè§’çš„è¿™ä¸ªæ‹¼å›¾å›¾æ ‡</p><p><img src="https://img.musnow.top/i/2023/08/fb90390f0aff1a2820c140b12077a854.png" alt="image-20230815134108580"></p><p>é€‰æ‹©selenium IDEè¿è¡Œæ‰©å±•</p><p><img src="https://img.musnow.top/i/2023/08/3ba9c91a72a965561c3fea6fbcdf1748.png" alt="image-20230815134140312"></p><p>ç‚¹å‡»ç¬¬ä¸€ä¸ªï¼Œåœ¨æ–°é¡¹ç›®ä¸­å½•åˆ¶ä¸€ä¸ªæ–°æ“ä½œ</p><p><img src="https://img.musnow.top/i/2023/08/0563b92346edda8ceaff25c860021a28.png" alt="image-20230815134200268"></p><p>éšä¾¿è¾“å…¥ä¸€ä¸ªé¡¹ç›®åå­—</p><p><img src="https://img.musnow.top/i/2023/08/fc89ef1ad4154870d475f18af9b6556e.png" alt="image-20230815134322768"></p><p>é€‰æ‹©ä½ éœ€è¦å½•åˆ¶çš„é¡µé¢urlï¼Œè¿™é‡Œæˆ‘å¡«äº†æˆ‘è‡ªå·±çš„ä¸»é¡µ <code>web.musnow.top</code>ï¼Œå¡«å†™å¥½äº†ä¹‹åç‚¹å‡»<code>START RECORDING</code>å¼€å§‹å½•åˆ¶</p><p><img src="https://img.musnow.top/i/2023/08/8847799a1733896d2e5e4ae55f90d7e1.png" alt="image-20230815134406281"></p><p>å¼€å§‹å½•åˆ¶åï¼Œå³ä¸‹è§’ä¼šå‡ºç°æ­£åœ¨å½•åˆ¶çš„æç¤ºï¼›ä»¥ä¸‹æ˜¯æˆ‘å½•åˆ¶äº†çš„æ“ä½œã€‚</p><p>è¿™é‡Œæˆ‘åœ¨æˆ‘ä¸»é¡µçš„è¾“å…¥æ¡†ä¸­è¾“å…¥äº†ä½ å¥½ï¼Œç‚¹å‡»å›è½¦</p><p><img src="https://img.musnow.top/i/2023/08/ff3b88eb18dab22c70b6c09921a5591d.png" alt="image-20230815134237407"></p><p>ç„¶åæˆ‘åˆç‚¹å‡»äº†ç¬¬ä¸€ä¸ªæœç´¢ç»“æœï¼Œå½•åˆ¶åˆ°è¿™é‡Œå°±ç»“æŸäº†</p><p><img src="https://img.musnow.top/i/2023/08/9f6a20e2c5fafc002b388bd88d269c09.png" alt="image-20230815134253921"></p><p>è¿›å…¥selenium IDEçš„é¡µé¢ï¼Œç‚¹å‡»å³ä¸Šè§’çš„çº¢è‰²æ–¹æ¡†åœæ­¢å½•åˆ¶ï¼ˆä¸‹å›¾ä¸­æ˜¯å·²ç»åœæ­¢å½•åˆ¶åçš„æ ·å­ï¼‰ä¸­é—´ä¼šæ˜¾ç¤ºä½ è¿™æ¬¡å½•åˆ¶åšäº†ä»€ä¹ˆ</p><p><img src="https://img.musnow.top/i/2023/08/72cf250e219008d0b84d630202c991e3.png" alt="image-20230815134532977"></p><p>å°†æœ¬æ¬¡å½•åˆ¶ä¿å­˜ï¼Œéšä¾¿èµ·ä¸ªåå­—ï¼Œç„¶åå³é”®å·¦ä¾§çš„å½•åˆ¶åï¼Œé€‰æ‹©<code>export</code>å¯¼å‡º</p><p><img src="https://img.musnow.top/i/2023/08/d7b0752110452ed307257ad03f6a2d27.png" alt="image-20230815134638917"></p><p>é€‰æ‹©pythonä»£ç ï¼Œç‚¹å‡»å¯¼å‡ºï¼›å¼¹å‡ºçš„æ¡†ä¼šè®©ä½ é€‰æ‹©å¯¼å‡ºè·¯å¾„</p><p><img src="https://img.musnow.top/i/2023/08/fe41c77fb7b5c7c3306313bc9c9798e9.png" alt="image-20230815134652459"></p><p>ä¸‹é¢å°±æ˜¯æˆ‘å¯¼å‡ºåçš„ä»£ç ï¼ŒSelenium IDEä¼šå°†æ–‡ä»¶å‘½åä¸º<code>é¡¹ç›®å_å½•åˆ¶å.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Generated by Selenium IDE</span></span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.action_chains <span class="keyword">import</span> ActionChains</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.wait <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.desired_capabilities <span class="keyword">import</span> DesiredCapabilities</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestTest1</span>():</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">setup_method</span>(<span class="params">self, method</span>):</span><br><span class="line">    self.driver = webdriver.Firefox()</span><br><span class="line">    self.<span class="built_in">vars</span> = &#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">teardown_method</span>(<span class="params">self, method</span>):</span><br><span class="line">    self.driver.quit()</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">wait_for_window</span>(<span class="params">self, timeout = <span class="number">2</span></span>):</span><br><span class="line">    time.sleep(<span class="built_in">round</span>(timeout / <span class="number">1000</span>))</span><br><span class="line">    wh_now = self.driver.window_handles</span><br><span class="line">    wh_then = self.<span class="built_in">vars</span>[<span class="string">&quot;window_handles&quot;</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(wh_now) &gt; <span class="built_in">len</span>(wh_then):</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">set</span>(wh_now).difference(<span class="built_in">set</span>(wh_then)).pop()</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">test_test1</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="comment"># Test name: test1</span></span><br><span class="line">    <span class="comment"># Step # | name | target | value</span></span><br><span class="line">    <span class="comment"># 1 | open | / | </span></span><br><span class="line">    self.driver.get(<span class="string">&quot;https://web.musnow.top/&quot;</span>)</span><br><span class="line">    <span class="comment"># 2 | setWindowSize | 1721x935 | </span></span><br><span class="line">    self.driver.set_window_size(<span class="number">1721</span>, <span class="number">935</span>)</span><br><span class="line">    <span class="comment"># 3 | mouseOver | css=.row:nth-child(5) &gt; .col-sm-3:nth-child(3) &gt; .xe-widget | </span></span><br><span class="line">    element = self.driver.find_element(By.CSS_SELECTOR, <span class="string">&quot;.row:nth-child(5) &gt; .col-sm-3:nth-child(3) &gt; .xe-widget&quot;</span>)</span><br><span class="line">    actions = ActionChains(self.driver)</span><br><span class="line">    actions.move_to_element(element).perform()</span><br><span class="line">    <span class="comment"># 4 | mouseOut | css=.row:nth-child(5) &gt; .col-sm-3:nth-child(3) &gt; .xe-widget | </span></span><br><span class="line">    element = self.driver.find_element(By.CSS_SELECTOR, <span class="string">&quot;body&quot;</span>)</span><br><span class="line">    actions = ActionChains(self.driver)</span><br><span class="line">    actions.move_to_element(element, <span class="number">0</span>, <span class="number">0</span>).perform()</span><br><span class="line">    <span class="comment"># 5 | click | id=txt | </span></span><br><span class="line">    self.driver.find_element(By.ID, <span class="string">&quot;txt&quot;</span>).click()</span><br><span class="line">    <span class="comment"># 6 | type | id=txt | ä½ å¥½</span></span><br><span class="line">    self.driver.find_element(By.ID, <span class="string">&quot;txt&quot;</span>).send_keys(<span class="string">&quot;ä½ å¥½&quot;</span>)</span><br><span class="line">    <span class="comment"># 7 | sendKeys | id=txt | $&#123;KEY_ENTER&#125;</span></span><br><span class="line">    self.<span class="built_in">vars</span>[<span class="string">&quot;window_handles&quot;</span>] = self.driver.window_handles</span><br><span class="line">    <span class="comment"># 8 | selectWindow | handle=$&#123;win5784&#125; | </span></span><br><span class="line">    self.driver.find_element(By.ID, <span class="string">&quot;txt&quot;</span>).send_keys(Keys.ENTER)</span><br><span class="line">    <span class="comment"># 9 | click | css=.\_paragraph_5yh6i_2 &gt; span &gt; span | </span></span><br><span class="line">    self.<span class="built_in">vars</span>[<span class="string">&quot;win5784&quot;</span>] = self.wait_for_window(<span class="number">2000</span>)</span><br><span class="line">    <span class="comment"># 10 | selectWindow | handle=$&#123;win5879&#125; | </span></span><br><span class="line">    self.driver.switch_to.window(self.<span class="built_in">vars</span>[<span class="string">&quot;win5784&quot;</span>])</span><br><span class="line">    self.<span class="built_in">vars</span>[<span class="string">&quot;window_handles&quot;</span>] = self.driver.window_handles</span><br><span class="line">    self.driver.find_element(By.CSS_SELECTOR, <span class="string">&quot;.\\_paragraph_5yh6i_2 &gt; span &gt; span&quot;</span>).click()</span><br><span class="line">    self.<span class="built_in">vars</span>[<span class="string">&quot;win5879&quot;</span>] = self.wait_for_window(<span class="number">2000</span>)</span><br><span class="line">    self.driver.switch_to.window(self.<span class="built_in">vars</span>[<span class="string">&quot;win5879&quot;</span>])</span><br><span class="line">  </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿è¡Œè¿™ä¸ªæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pytest æ–‡ä»¶å</span><br></pre></td></tr></table></figure><p>ç›´æ¥è¿è¡Œä¼šé‡åˆ°å¦‚ä¸‹çš„æŠ¥é”™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">      actions = ActionChains(self.driver)</span><br><span class="line">&gt;     actions.move_to_element(element, 0, 0).perform()</span><br><span class="line">E     TypeError: ActionChains.move_to_element() takes 2 positional arguments but 4 were given</span><br><span class="line"></span><br><span class="line">test_test1.py:42: TypeError</span><br></pre></td></tr></table></figure><p>æŠ¥é”™çš„æ„æ€æ˜¯ <code>ActionChains.move_to_element()</code>å‡½æ•°åªéœ€è¦æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä½†å´æä¾›äº†4ä¸ªå‚æ•°ï¼Œå‡ºé”™çš„æ˜¯ç¬¬å››åäºŒè¡Œçš„ä½ç½®</p><p><img src="https://img.musnow.top/i/2023/08/d388df2e932b91864e089c1e81ee1fc4.png" alt="image-20230815135043228"></p><p>è§£å†³åŠæ³•æ˜¯å°†è¿™é‡Œçš„<code>,0,0</code>ç»™åˆ é™¤ï¼Œç±»ä¼¼38è¡Œï¼Œåªä¼ å…¥<code>element</code>å‚æ•°å°±å¯ä»¥äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">actions.move_to_element(element).perform()</span><br></pre></td></tr></table></figure><p>å®Œæ•´è§£å†³åŠæ³•å‚è€ƒï¼š<a href="https://blog.csdn.net/muxuen/article/details/132296695?spm=1001.2014.3001.5501">ã€Pythonã€‘seleniumé‡åˆ°ActionChains.move_to_element() takes 2 positional arguments but 4 were givenæŠ¥é”™</a></p><p>ä¿®æ”¹å¥½äº†ä¹‹åï¼Œå†ç”¨<code>pytest</code>è¿è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œå…¶ä¼šå¼¹å‡ºä¸€ä¸ªç«ç‹çš„æµè§ˆå™¨çª—å£ï¼Œå¹¶åœ¨çª—å£é‡Œé¢å¤ç°æˆ‘ä»¬åˆšåˆšå½•åˆ¶çš„æ“ä½œäº†ï¼</p><h1 id="3-ä»£ç å­¦ä¹ "><a href="#3-ä»£ç å­¦ä¹ " class="headerlink" title="3.ä»£ç å­¦ä¹ "></a>3.ä»£ç å­¦ä¹ </h1><p>åªä¼šå½•åˆ¶æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å­¦ä¼šè¿™ä¸ªåº“çš„<strong>webdriver API</strong>åŸºæœ¬ä½¿ç”¨ï¼›</p><blockquote><p>éœ€è¦æ³¨æ„æ˜¯ï¼Œä¸åŒç‰ˆæœ¬çš„python <code>selenium</code>åŒ…å…¶å†…éƒ¨å‡½æ•°æœ‰æ‰€åŒºåˆ«ï¼Œè¯·ç¡®è®¤æ‚¨çš„ç‰ˆæœ¬å’Œæœ¬æ–‡æ‰€ä½¿ç”¨çš„ç‰ˆæœ¬ç›¸åŒï¼å¦åˆ™ä¼šå‡ºé—®é¢˜çš„ğŸ˜¶â€ğŸŒ«ï¸</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium   4.11.2</span><br></pre></td></tr></table></figure></blockquote><h2 id="3-1-å°è¯•ç‰›åˆ€"><a href="#3-1-å°è¯•ç‰›åˆ€" class="headerlink" title="3.1 å°è¯•ç‰›åˆ€"></a>3.1 å°è¯•ç‰›åˆ€</h2><p>åœ¨<a href="https://www.baidu.com/">ç™¾åº¦ä¸»é¡µ</a>ï¼Œç”¨F12æ‰“å¼€å¼€å‘è€…æ¨¡å¼ï¼Œé€‰ä¸­æœç´¢æ¡†ï¼Œèƒ½å®šä½åˆ°å¦‚ä¸‹htmlä»£ç </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;kw&quot;</span> <span class="attr">name</span>=<span class="string">&quot;wd&quot;</span> <span class="attr">class</span>=<span class="string">&quot;s_ipt&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> <span class="attr">maxlength</span>=<span class="string">&quot;255&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å…ˆæ¥çœ‹çœ‹å¦‚ä¸‹çš„ç¤ºä¾‹ä»£ç å§ï¼Œè¿™ä¸ªä»£ç çš„ä½œç”¨æ˜¯åœ¨ç™¾åº¦é‡Œé¢æœç´¢seleniumï¼›</p><p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©äº†<code>webdriver.Firefox()</code>ç«ç‹ä½œä¸ºé©±åŠ¨ï¼›éšåä½¿ç”¨äº†<code>By.ID</code>å®šä½åˆ°äº†<code>kw</code>çš„ä½ç½®ï¼Œå³è¿™ä¸ªæœç´¢æ¡†ï¼Œå¹¶åœ¨å†…éƒ¨<code>send_keys</code>è¾“å…¥äº†<code>selenium</code>æ–‡å­—ã€‚</p><p>ä¼‘çœ äº†2ç§’åï¼Œåˆé€šè¿‡IDæ‰¾åˆ°äº†<code>su</code>çš„htmlæ ‡ç­¾ï¼ˆè¿™æ˜¯ç¡®è®¤æœç´ çš„æŒ‰é’®ï¼‰ï¼Œå¹¶ä½¿ç”¨<code>click()</code>æ–¹æ³•ç‚¹å‡»äº†è¿™ä¸ªæŒ‰é’®ï¼›</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding = utf-8</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">browser = webdriver.Firefox()  <span class="comment"># ä½¿ç”¨ç«ç‹çš„æµè§ˆå™¨é©±åŠ¨ï¼ˆå¿…é¡»åœ¨pythonå®‰è£…ç›®å½•é‡Œé¢å®‰è£…å¯¹åº”é©±åŠ¨ï¼‰</span></span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">browser.get(<span class="string">&quot;http://www.baidu.com&quot;</span>)  <span class="comment"># æ‰“å¼€ç½‘é¡µ</span></span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">browser.find_element(By.ID,<span class="string">&quot;kw&quot;</span>).send_keys(<span class="string">&quot;selenium&quot;</span>)  <span class="comment"># æ‰¾åˆ°ç½‘é¡µä¸­çš„idä¸ºkwçš„åœ°æ–¹ï¼Œè¾“å…¥&quot;selenium&quot;</span></span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">browser.find_element(By.ID,<span class="string">&quot;su&quot;</span>).click()  <span class="comment"># ç‚¹å‡»idä¸ºsuçš„æŒ‰é’®</span></span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">browser.quit()  <span class="comment"># é€€å‡ºç½‘é¡µ</span></span><br></pre></td></tr></table></figure><p>é™¤äº†<code>quit()</code>ï¼Œè¿˜æœ‰<code>close()</code>åŠæ³•ä¹Ÿèƒ½å…³é—­ç½‘é¡µ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">browser.close() <span class="comment"># ä¹Ÿå¯ä»¥å…³é—­çª—å£ã€‚</span></span><br><span class="line"><span class="comment"># ä¸¤è€…çš„åŒºåˆ«æ˜¯ï¼š</span></span><br><span class="line"><span class="comment"># closeæ–¹æ³•å…³é—­å½“å‰çš„æµè§ˆå™¨çª—å£ï¼Œquitæ–¹æ³•ä¸ä»…å…³é—­çª—å£ï¼Œè¿˜ä¼šå½»åº•çš„é€€å‡ºwebdriverï¼Œé‡Šæ”¾ä¸driver</span></span><br><span class="line"><span class="comment"># serverä¹‹é—´çš„è¿æ¥ã€‚æ‰€ä»¥ç®€å•æ¥è¯´quitæ˜¯æ›´åŠ å½»åº•çš„closeï¼Œquitä¼šæ›´å¥½çš„é‡Šæ”¾èµ„æºã€‚</span></span><br></pre></td></tr></table></figure><p>æœ€ç»ˆè¿è¡Œçš„æ•ˆæœå¦‚ä¸‹ï¼ˆå½•åˆ¶çš„åŠ¨å›¾ï¼Œæ•ˆæœå¯èƒ½ä¸å’‹åœ°ï¼‰</p><p><img src="https://img.musnow.top/i/2023/08/d4c8fa950322bfc4a2afc519e76431e7.gif" alt="GIF"></p><h2 id="3-2-å…ƒç´ çš„å®šä½"><a href="#3-2-å…ƒç´ çš„å®šä½" class="headerlink" title="3.2 å…ƒç´ çš„å®šä½"></a>3.2 å…ƒç´ çš„å®šä½</h2><h3 id="3-2-1-åŸºæœ¬è¯´æ˜"><a href="#3-2-1-åŸºæœ¬è¯´æ˜" class="headerlink" title="3.2.1 åŸºæœ¬è¯´æ˜"></a>3.2.1 åŸºæœ¬è¯´æ˜</h3><p>åœ¨htmlä¸­å…ƒç´ çš„å®šä½æ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•çš„æ ¸å¿ƒï¼Œè„šæœ¬å¿…é¡»è¦çŸ¥é“ä½ éœ€è¦æ“ä½œçš„æ˜¯ä»€ä¹ˆé¡µé¢çš„å…ƒç´ ï¼Œæ‰èƒ½æ­£å¸¸è¿›è¡Œè‡ªåŠ¨åŒ–å¤„ç†ï¼›</p><p>è€Œåœ¨htmlä¸­ï¼Œä¸€ä¸ªå¯¹è±¡å¯ä»¥ç”¨ä¸åŒçš„åŠæ³•æ¥å®šä½åˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">id</span><br><span class="line">name</span><br><span class="line">class name</span><br><span class="line">link text</span><br><span class="line">partial link text</span><br><span class="line">tag name</span><br><span class="line">xpath</span><br><span class="line">css selector</span><br></pre></td></tr></table></figure><p>å‰é¢æåˆ°è¿‡ï¼Œç™¾åº¦çš„è¾“å…¥æ¡†htmlæ˜¯ä¸‹é¢è¿™æ ·çš„ã€‚å…‰æ˜¯åœ¨è¿™ä¸€è¡Œhtmlä»£ç ä¸­ï¼Œå°±åŒ…å«äº†idã€nameã€classè¿™ä¸‰ä¸ªå¯ä»¥ç”¨äºæˆ‘ä»¬æ¥å®šä½çš„å…ƒç´ ï¼Œè¿˜æœ‰â€œçœ‹ä¸åˆ°â€çš„cssä¹Ÿèƒ½å®šä½åˆ°è¿™é‡Œã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;kw&quot;</span> <span class="attr">name</span>=<span class="string">&quot;wd&quot;</span> <span class="attr">class</span>=<span class="string">&quot;s_ipt&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> <span class="attr">maxlength</span>=<span class="string">&quot;255&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æµè§ˆå™¨å¼€å‘è€…æ¨¡å¼ä¸­ï¼Œå³ä¾§å°±èƒ½çœ‹åˆ°å’Œkwç›¸å…³çš„cssæ˜¯<code>#kw</code></p><p><img src="https://img.musnow.top/i/2023/08/1edeb92795c9e4d2407c09bfbc396b53.png" alt="image-20230815142146714"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¦æƒ³å®šä½åˆ°<strong>å”¯ä¸€å…ƒç´ </strong>ï¼Œå¿…é¡»è¦ä¿è¯è¿™ä¸ªå…ƒç´ çš„æ ‡è¯†ç¬¦åœ¨æ•´ä¸ªé¡µé¢æ˜¯å”¯ä¸€çš„ï¼å‡è®¾ç™¾åº¦çš„ä¸»é¡µæœ‰ä¸¤ä¸ª<code>id=&quot;kw&quot;</code>çš„å…ƒç´ ï¼Œé‚£å°±æ²¡æœ‰åŠæ³•é€šè¿‡idæ¥å®šä½åˆ°è¾“å…¥æ¡†ï¼è¿™å°±è¦æ±‚å†™å‰ç«¯çš„æœ‹å‹ä»¬ï¼Œå°½å¯èƒ½åœ°ä¸ºæ¯ä¸€ä¸ªéœ€è¦æµ‹è¯•çš„é¡µé¢å…ƒç´ ç•™ä¸‹ä¸€ä¸ªå”¯ä¸€çš„idæˆ–è€…nameï¼Œä¿è¯è‡ªåŠ¨åŒ–è„šæœ¬èƒ½æ­£å¸¸è¿è¡Œï¼</p><p>ä¸åŒå®šä½æ–¹å¼ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹<code>By.</code>æ¥è‡ªä»€ä¹ˆï¼Œä»¥åŠä¼ å…¥å¯¹åº”çš„å‚æ•°å°±å¯ä»¥äº†ï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  é€šè¿‡id æ–¹å¼å®šä½</span></span><br><span class="line">browser.find_element(By.ID,<span class="string">&quot;kw&quot;</span>).send_keys(<span class="string">&quot;selenium1&quot;</span>) <span class="comment"># æ‰¾åˆ°ç½‘é¡µä¸­çš„idä¸ºkwçš„åœ°æ–¹ï¼Œè¾“å…¥&quot;selenium&quot;</span></span><br><span class="line"><span class="comment">#  é€šè¿‡name æ–¹å¼å®šä½</span></span><br><span class="line">browser.find_element(By.NAME,<span class="string">&quot;wd&quot;</span>).send_keys(<span class="string">&quot;selenium2&quot;</span>)</span><br><span class="line"><span class="comment">#  é€šè¿‡tag name æ–¹å¼å®šä½</span></span><br><span class="line">browser.find_element(By.TAG_NAME,<span class="string">&quot;input&quot;</span>).send_keys(<span class="string">&quot;selenium3&quot;</span>) <span class="comment"># ä¸èƒ½æˆåŠŸï¼Œå› ä¸ºinputå…ƒç´ å¤ªå¤šäº†ï¼Œä¸å”¯ä¸€ï¼</span></span><br><span class="line"><span class="comment">#  é€šè¿‡class name æ–¹å¼å®šä½</span></span><br><span class="line">browser.find_element(By.CLASS_NAME,<span class="string">&quot;s_ipt&quot;</span>).send_keys(<span class="string">&quot;selenium4&quot;</span>)</span><br><span class="line"><span class="comment">#  é€šè¿‡CSS æ–¹å¼å®šä½</span></span><br><span class="line">browser.find_element(By.CSS_SELECTOR,<span class="string">&quot;#kw&quot;</span>).send_keys(<span class="string">&quot;selenium5&quot;</span>)</span><br><span class="line"><span class="comment">#  é€šè¿‡XPATH æ–¹å¼å®šä½</span></span><br><span class="line">browser.find_element(By.XPATH,<span class="string">&quot;//*[@id=&#x27;kw&#x27;]&quot;</span>).send_keys(<span class="string">&quot;selenium6&quot;</span>)</span><br></pre></td></tr></table></figure><p>å½“è¿è¡Œåˆ°inputå®šä½çš„æ—¶å€™ï¼Œç”±äºå®šä½ä¸å”¯ä¸€ï¼Œå°±ä¼šå‡ºç°å¦‚ä¸‹æŠ¥é”™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.ElementNotInteractableException: Message: Element &lt;input name=&quot;ie&quot; type=&quot;hidden&quot;&gt; is not reachable by keyboard</span><br><span class="line">Stacktrace:</span><br><span class="line">RemoteError@chrome://remote/content/shared/RemoteError.sys.mjs:8:8</span><br><span class="line">WebDriverError@chrome://remote/content/shared/webdriver/Errors.sys.mjs:187:5</span><br><span class="line">ElementNotInteractableError@chrome://remote/content/shared/webdriver/Errors.sys.mjs:347:5</span><br><span class="line">webdriverSendKeysToElement@chrome://remote/content/marionette/interaction.sys.mjs:631:13</span><br><span class="line">interaction.sendKeysToElement@chrome://remote/content/marionette/interaction.sys.mjs:605:11</span><br><span class="line">sendKeysToElement@chrome://remote/content/marionette/actors/MarionetteCommandsChild.sys.mjs:535:29</span><br><span class="line">receiveMessage@chrome://remote/content/marionette/actors/MarionetteCommandsChild.sys.mjs:152:31</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºæœ‰ä¸€ä¸ª<code>&lt;input name=&quot;ie&quot; type=&quot;hidden&quot;&gt;</code> æ ‡ç­¾è¢«éšè—äº†ï¼Œæˆ‘ä»¬çš„<code>send_keys</code>å‡½æ•°ï¼ˆç›¸å½“äºé”®ç›˜ï¼‰æ˜¯æ²¡æœ‰åŠæ³•å¾€è¿™ä¸ªæ ‡ç­¾é‡Œé¢è¾“å…¥ä¿¡æ¯çš„ï¼Œæ•´ä¸ªè¿›ç¨‹ä¹Ÿå°±æ­¤é€€å‡ºäº†ã€‚</p><h3 id="3-2-2-Xpath"><a href="#3-2-2-Xpath" class="headerlink" title="3.2.2 Xpath"></a>3.2.2 Xpath</h3><p>è¿™é‡Œå¯¹XPATHåšä¸€ä¸ªå°å°çš„è§£é‡Š</p><blockquote><p>XPathï¼ˆXML Path Languageï¼‰æ˜¯ä¸€ç§ç”¨äºåœ¨XMLæ–‡æ¡£ä¸­å®šä½å…ƒç´ å’ŒèŠ‚ç‚¹çš„è¯­è¨€ã€‚å®ƒæ˜¯ä¸€ç§åŸºäºæ ‘ç»“æ„çš„è¡¨è¾¾å¼è¯­è¨€ï¼Œé€šå¸¸ç”¨äºåœ¨XMLæ–‡æ¡£ä¸­è¿›è¡Œå¯¼èˆªå’Œæœç´¢æ“ä½œã€‚XPath å¯ä»¥å¸®åŠ©æ‚¨æ ¹æ®å…ƒç´ çš„å±‚æ¬¡ç»“æ„ã€å±æ€§å’Œæ–‡æœ¬å†…å®¹æ¥ç²¾ç¡®å®šä½ç‰¹å®šçš„å…ƒç´ æˆ–èŠ‚ç‚¹ã€‚å› ä¸ºHTMLå¯ä»¥çœ‹åšXMLçš„ä¸€ç§å®ç°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨XPathæ¥å®šä½HTMLä¸­çš„å…ƒç´ ã€‚</p><p>ä½ å¯ä»¥ç†è§£ä½Xpathç±»ä¼¼äºæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯ä»¥é€šè¿‡ç‰¹å®šçš„è¡¨è¾¾å¼æ¥åŒ¹é…åˆ°æˆ‘ä»¬æƒ³è¦çš„ä½ç½®ã€‚è¿™é‡Œåªåšäº†è§£å³å¯ï¼Œåç»­æœ‰éœ€è¦å†æ·±å…¥å­¦ä¹ ï¼›</p></blockquote><h3 id="3-2-3-link-text"><a href="#3-2-3-link-text" class="headerlink" title="3.2.3 link text"></a>3.2.3 link text</h3><p>ä¸Šé¢çš„æ —å­ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ç”¨åˆ°<code>link text / partial link text</code> è¿™ä¸¤ç§æ–¹å¼æ¥å®šä½å…ƒç´ ï¼Œ</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;å­¦ä¹ è‡ªåŠ¨åŒ–æµ‹è¯•seleniumçš„ç¬”è®°&lt;/p&gt;</summary>
    
    
    
    <category term="é€Ÿé€šPython" scheme="https://blog.musnow.top/categories/%E9%80%9F%E9%80%9APython/"/>
    
    
    <category term="Python" scheme="https://blog.musnow.top/tags/Python/"/>
    
    <category term="selenium" scheme="https://blog.musnow.top/tags/selenium/"/>
    
  </entry>
  
</feed>
