<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æ…•é›ªçš„å¯’èˆ</title>
  
  <subtitle>é›ªä¸‹äº†ä¸€å¤œ</subtitle>
  <link href="https://blog.musnow.top/atom.xml" rel="self"/>
  
  <link href="https://blog.musnow.top/"/>
  <updated>2023-09-26T04:40:46.000Z</updated>
  <id>https://blog.musnow.top/</id>
  
  <author>
    <name>æ…•é›ªå¹´å</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ã€C++ã€‘C++17çš„é‚£äº›æ–°ç‰¹æ€§</title>
    <link href="https://blog.musnow.top/posts/3858168547/"/>
    <id>https://blog.musnow.top/posts/3858168547/</id>
    <published>2023-09-26T04:40:46.000Z</published>
    <updated>2023-09-26T04:40:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ C++17çš„æ–°ç‰¹æ€§</p><h1 id="1-æ„é€ å‡½æ•°æ¨¡æ¿æ¨å¯¼"><a href="#1-æ„é€ å‡½æ•°æ¨¡æ¿æ¨å¯¼" class="headerlink" title="1.æ„é€ å‡½æ•°æ¨¡æ¿æ¨å¯¼"></a>1.æ„é€ å‡½æ•°æ¨¡æ¿æ¨å¯¼</h1><p>åœ¨ä¹‹å‰ï¼Œæˆ‘ä»¬å¦‚æœæƒ³ç”¨stlå®¹å™¨ï¼Œéƒ½éœ€è¦ç”¨<code>&lt;&gt;</code> æ¥æ‰‹åŠ¨æŒ‡å®šå‚æ•°ç±»å‹ã€‚ä½†åœ¨C++17ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦è¿™ä¹ˆåšäº†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::vector v1 = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line">    std::pair p1  = &#123;<span class="number">1</span>,<span class="number">2.4234</span>&#125;;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">typeid</span>(v1).<span class="built_in">name</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">typeid</span>(p1).<span class="built_in">name</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨C++11ç¼–è¯‘ï¼Œè¿™ä¸ªä»£ç ä¼šæŠ¥é”™ã€‚æŠ¥é”™çš„æ„æ€æ˜¯è®©æˆ‘ä»¬æŒ‡å®šå‚æ•°çš„æ¨¡æ¿ç±»å‹ã€‚</p><p>æ¯”å¦‚ <code>std::pair p1  = &#123;1,2.4234&#125;;</code> åœ¨C++11ä¸­åº”è¯¥å†™æˆ <code>std::pair&lt;int,double&gt; p1  = &#123;1,2.4234&#125;;</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">test.cpp:16:10: error: use of class template &#x27;std::pair&#x27; requires template arguments</span><br><span class="line">    std::pair p1  = &#123;1,2.4234&#125;;</span><br><span class="line">         ^</span><br><span class="line">/usr/bin/../lib/gcc/x86_64-linux-gnu/11/../../../../include/c++/11/bits/stl_pair.h:211:12: note: template is declared here</span><br><span class="line">    struct pair</span><br><span class="line">           ^</span><br><span class="line">3 errors generated.</span><br><span class="line">make: *** [makefile:3: test] Error 1</span><br></pre></td></tr></table></figure><p>åœ¨C++17ä¸­ï¼Œè¿™æ ·çš„å†™æ³•å°±æ˜¯å¯ä»¥è¢«é€šè¿‡çš„äº†ï¼Œä¹Ÿèƒ½æ­£å¸¸æ¨æ–­å‡ºå‚æ•°çš„ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ä¸€ä¸ªintçš„vectorï¼Œå’Œä¸€ä¸ªint+doubleçš„pairï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ make</span><br><span class="line">clang++ test.cpp -o test -std=c++17</span><br><span class="line">$ ./test</span><br><span class="line">St6vectorIiSaIiEE</span><br><span class="line">St4pairIidE</span><br></pre></td></tr></table></figure><h1 id="2-ç»“æ„åŒ–ç»‘å®š"><a href="#2-ç»“æ„åŒ–ç»‘å®š" class="headerlink" title="2.ç»“æ„åŒ–ç»‘å®š"></a>2.ç»“æ„åŒ–ç»‘å®š</h1><p>æˆ‘ä»¬å¯ä»¥ç”¨ <code>auto[å˜é‡1,å˜é‡2]</code>çš„æ–¹å¼æ¥æ¥å—ä¸€ä¸ªtupleæˆ–è€…pairçš„è¿”å›å€¼ï¼Œå°†å…¶ç»‘å®šåˆ°ä¸¤ä¸ªä¸åŒçš„å˜é‡ä¸Šã€‚</p><p>tupleæ˜¯C++11æ–°å¢çš„ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œå®ƒå’Œpairçš„ç”¨æ³•ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯å…ƒç»„æ”¯æŒæ— æ•°ä¸ªå‚æ•°ã€‚è€Œpairä»…æ”¯æŒä¸¤ä¸ªã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::tuple&lt;<span class="type">int</span>, <span class="type">double</span>&gt; <span class="title">func_tuple</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">tuple</span>&lt;<span class="type">int</span>,<span class="type">double</span>&gt;(<span class="number">1</span>, <span class="number">2.2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::pair&lt;<span class="type">int</span>, <span class="type">double</span>&gt; <span class="title">func_pair</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="number">1</span>,<span class="number">2</span>&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> [i, d] = <span class="built_in">func_tuple</span>(); </span><br><span class="line">    cout &lt;&lt; <span class="built_in">typeid</span>(i).<span class="built_in">name</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">typeid</span>(d).<span class="built_in">name</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> [x,y] = <span class="built_in">func_pair</span>();</span><br><span class="line">    cout &lt;&lt; <span class="built_in">typeid</span>(x).<span class="built_in">name</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">typeid</span>(y).<span class="built_in">name</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨C++11æ¥ç¼–è¯‘ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œä½†ç¼–è¯‘ä¾æ—§èƒ½æˆåŠŸã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬çš„ç¼–è¯‘å™¨æ˜¯æ”¯æŒC++17çš„ï¼Œä½†åˆè¢«æŒ‡å®šäº†<code>-std=c++11</code>ï¼Œæ‰€ä»¥ç»™ç”¨æˆ·æŠ¥äº†ä¸ªè­¦å‘Šï¼Œä½†æ²¡æœ‰æŠ¥é”™ï¼ˆå› ä¸ºè¿™ä¸ªè¯­æ³•åœ¨C++17é‡Œé¢æ˜¯æ­£ç¡®çš„ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">clang++ test.cpp -o test -std=c++11</span><br><span class="line">test.cpp:34:10: warning: decomposition declarations are a C++17 extension [-Wc++17-extensions]</span><br><span class="line">    auto [i, d] = func_tuple(); </span><br><span class="line">         ^~~~~~</span><br><span class="line">test.cpp:40:10: warning: decomposition declarations are a C++17 extension [-Wc++17-extensions]</span><br><span class="line">    auto [x,y] = func_pair();</span><br><span class="line">         ^~~~~</span><br><span class="line">2 warnings generated.</span><br></pre></td></tr></table></figure><p>è¿è¡Œè¾“å‡ºç»“æœå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">i</span><br><span class="line">d</span><br><span class="line"></span><br><span class="line">i</span><br><span class="line">d</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šç»“æ„åŒ–ç»‘å®šä¸èƒ½åº”ç”¨äºconstexprï¼</p><p>ç»“æ„åŒ–ç»‘å®šä¸æ­¢å¯ä»¥ç»‘å®špairå’Œtupleï¼Œè¿˜å¯ä»¥ç»‘å®šæ•°ç»„å’Œç»“æ„ä½“ç­‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨æ„è¿™é‡Œçš„structçš„æˆå‘˜ä¸€å®šè¦æ˜¯publicçš„ï¼Œä¸ç„¶å¤–éƒ¨æ— æ³•è®¿é—®ï¼Œè¿˜æ€ä¹ˆç»‘å®šï¼Ÿ</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="type">int</span> y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›å€¼æ˜¯pointçš„å‡½æ•°</span></span><br><span class="line"><span class="function">Point <span class="title">func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="number">1</span>, <span class="number">2</span>&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> array[<span class="number">3</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">    <span class="keyword">auto</span> [a, b, c] = array;</span><br><span class="line">    cout &lt;&lt; a &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; b &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; c &lt;&lt; endl;</span><br><span class="line">    <span class="comment">// ç›´æ¥æ¨å¯¼å‡ºä¸¤ä¸ªæˆå‘˜å˜é‡å¹¶èµ‹å€¼ç»™å˜é‡xå’Œy</span></span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span> [x, y] = <span class="built_in">func</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆåŠŸç¼–è¯‘å¹¶è¾“å‡ºç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ make</span><br><span class="line">clang++ test.cpp -o test -std=c++17</span><br><span class="line">$ ./test</span><br><span class="line">1 2 3</span><br><span class="line">1 2</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰ç±»å‹ä¹Ÿèƒ½å®ç°ç»“æ„åŒ–ç»‘å®šï¼Œè¿™é‡Œä»ç½‘ä¸Šæ‰’äº†ä¸€ä¸ªä»£ç ä¸‹æ¥ï¼Œå°±ä¸è‡ªå·±åšæµ‹è¯•äº†</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éœ€è¦å®ç°ç›¸å…³çš„tuple_sizeå’Œtuple_elementå’Œget&lt;N&gt;æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Entry</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        name_ = <span class="string">&quot;name&quot;</span>;</span><br><span class="line">        age_ = <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::string <span class="title">GetName</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> name_; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">GetAge</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> age_; &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string name_;</span><br><span class="line">    <span class="type">int</span> age_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">size_t</span> I&gt;</span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">get</span><span class="params">(<span class="type">const</span> Entry&amp; e)</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span> <span class="params">(I == <span class="number">0</span>)</span> <span class="keyword">return</span> e.<span class="title">GetName</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span> (I == <span class="number">1</span>) <span class="keyword">return</span> e.<span class="built_in">GetAge</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> std &#123;</span><br><span class="line">    <span class="keyword">template</span>&lt;&gt; <span class="keyword">struct</span> <span class="title class_">tuple_size</span>&lt;Entry&gt; : integral_constant&lt;<span class="type">size_t</span>, <span class="number">2</span>&gt; &#123;&#125;;</span><br><span class="line">    <span class="keyword">template</span>&lt;&gt; <span class="keyword">struct</span> <span class="title class_">tuple_element</span>&lt;<span class="number">0</span>, Entry&gt; &#123; <span class="keyword">using</span> type = std::string; &#125;;</span><br><span class="line">    <span class="keyword">template</span>&lt;&gt; <span class="keyword">struct</span> <span class="title class_">tuple_element</span>&lt;<span class="number">1</span>, Entry&gt; &#123; <span class="keyword">using</span> type = <span class="type">int</span>; &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Entry e;</span><br><span class="line">    e.<span class="built_in">Init</span>();</span><br><span class="line">    <span class="keyword">auto</span> [name, age] = e;</span><br><span class="line">    cout &lt;&lt; name &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; age &lt;&lt; endl; <span class="comment">// name 10</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3-ifè¯­å¥æ–°å¢åˆå§‹æ¡ä»¶"><a href="#3-ifè¯­å¥æ–°å¢åˆå§‹æ¡ä»¶" class="headerlink" title="3.ifè¯­å¥æ–°å¢åˆå§‹æ¡ä»¶"></a>3.ifè¯­å¥æ–°å¢åˆå§‹æ¡ä»¶</h1><p>åœ¨ä¹‹å‰æˆ‘ä»¬éƒ½æ˜¯ç”¨ <code>if(åˆ¤æ–­æ¡ä»¶)</code> æ¥ä½¿ç”¨ifè¯­å¥çš„ï¼ŒC++17ä¸­ç»™ifæ–°å¢äº†ä¸€ä¸ªç±»ä¼¼forå¾ªç¯ä¸­ç¬¬ä¸€ä¸ªå‚æ•°çš„ç›¸åŒå‚æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(åˆå§‹åŒ–æ¡ä»¶,åˆ¤æ–­æ¡ä»¶)</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="type">int</span> i=<span class="number">20</span>;i&lt;<span class="number">39</span>)&#123;</span><br><span class="line">    cout &lt;&lt;<span class="string">&quot;i&lt;39!&quot;</span>&lt;&lt;endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œæ•ˆæœå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">i&lt;39!</span><br></pre></td></tr></table></figure><h1 id="4-å†…è”å˜é‡"><a href="#4-å†…è”å˜é‡" class="headerlink" title="4.å†…è”å˜é‡"></a>4.å†…è”å˜é‡</h1><p>åœ¨ä¹‹å‰æˆ‘ä»¬æƒ³åˆå§‹åŒ–ä¸€ä¸ªç±»ä¸­çš„staticå˜é‡ï¼Œéœ€è¦åœ¨ç±»ä¸­å®šä¹‰ï¼Œç±»å¤–åˆå§‹åŒ–ã€‚ä½†å¦‚æœæ˜¯constçš„staticå˜é‡ï¼Œå°±èƒ½ç›´æ¥åœ¨ç±»ä¸­é€šè¿‡ç¼ºçœå€¼çš„æ–¹å¼æ¥åˆå§‹åŒ–ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨å¤´æ–‡ä»¶é‡Œé¢è¿™æ ·æ˜¯èƒ½é€šè¿‡ç¼–è¯‘çš„ï¼Œä½†æ˜¯ä¸å»ºè®®åœ¨å¤´æ–‡ä»¶ä¸­åˆå§‹åŒ–staticå˜é‡ï¼Œä¼šäº§ç”ŸODRå†²çª:</span></span><br><span class="line"><span class="comment">// Variable &#x27;value&#x27; defined in a header file; variable definitions in header files can lead to ODR violations</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> value;  </span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> value_c=<span class="number">10</span>;  <span class="comment">// constå¯ä»¥ç›´æ¥åˆå§‹åŒ–</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> A::value = <span class="number">10</span>;</span><br></pre></td></tr></table></figure><p>åœ¨C++17ä¸­å†…è”å˜é‡å¼•å…¥åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å®ç°åœ¨å¤´æ–‡ä»¶ä¸­åˆå§‹åŒ–staticéconstå˜é‡ï¼Œæˆ–è€…ç›´æ¥ç”¨ç¼ºçœå€¼æ¥åˆå§‹åŒ–äº†</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> value;</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> value_c = <span class="number">10</span>;</span><br><span class="line">    <span class="comment">// static int value = 10;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="type">int</span> A::value = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ========= æˆ–è€… ========</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">B</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">inline</span> <span class="type">static</span> <span class="type">int</span> value = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">inline</span> <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> value_c = <span class="number">10</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç›¸æ¯”äºåŸæœ¬staticå˜é‡åˆå§‹åŒ–éœ€è¦æ”¾åˆ°å¦å¤–ä¸€ä¸ªcppæºæ–‡ä»¶ä¸­ï¼Œè¿™ç§ç›´æ¥åœ¨å¤´æ–‡ä»¶é‡Œé¢å£°æ˜+åˆå§‹åŒ–çš„æ–¹å¼èƒ½æ›´å¥½çš„ç¡®å®šå˜é‡çš„åˆå§‹å€¼ã€‚</p><h1 id="5-æŠ˜å è¡¨è¾¾å¼"><a href="#5-æŠ˜å è¡¨è¾¾å¼" class="headerlink" title="5.æŠ˜å è¡¨è¾¾å¼"></a>5.æŠ˜å è¡¨è¾¾å¼</h1><p>C++17å¼•å…¥äº†æŠ˜å è¡¨è¾¾å¼ä½¿å¯å˜å‚æ•°æ¨¡æ¿ç¼–ç¨‹æ›´æ–¹ä¾¿ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ... Ts&gt;</span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">sum</span><span class="params">(Ts ... ts)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (ts + ...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> a &#123;<span class="built_in">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)&#125;; <span class="comment">// 15</span></span><br><span class="line">std::string a&#123;<span class="string">&quot;hello &quot;</span>&#125;;</span><br><span class="line">std::string b&#123;<span class="string">&quot;world&quot;</span>&#125;;</span><br><span class="line">cout &lt;&lt; <span class="built_in">sum</span>(a, b) &lt;&lt; endl; <span class="comment">// hello world</span></span><br></pre></td></tr></table></figure><p>å®è¯è¯´ï¼Œå¯å˜æ¨¡æ¿å‚æ•°è¿™éƒ¨åˆ†å°±æ²¡æœ‰å¼„æ˜ç™½è¿‡ï¼Œå®é™…ä¸Šä¹Ÿæ²¡æœ‰ç”¨è¿‡ï¼Œç›´æ¥è·³è¿‡ï¼</p><h1 id="6-constexpr-lambdaè¡¨è¾¾å¼"><a href="#6-constexpr-lambdaè¡¨è¾¾å¼" class="headerlink" title="6.constexpr+lambdaè¡¨è¾¾å¼"></a>6.constexpr+lambdaè¡¨è¾¾å¼</h1><p>C++17å‰lambdaè¡¨è¾¾å¼åªèƒ½åœ¨è¿è¡Œæ—¶ä½¿ç”¨ï¼ŒC++17å¼•å…¥äº†constexpr lambdaè¡¨è¾¾å¼ï¼Œå¯ä»¥ç”¨äºåœ¨ç¼–è¯‘æœŸè¿›è¡Œè®¡ç®—ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int main() &#123; // c++17å¯ç¼–è¯‘</span><br><span class="line">    constexpr auto lamb = [] (int n) &#123; return n * n; &#125;;</span><br><span class="line">    static_assert(lamb(3) == 9, &quot;a&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§„åˆ™å’Œæ™®é€šçš„constexprå‡½æ•°ç›¸åŒï¼Œå‚è€ƒæˆ‘çš„C++11å’Œ14çš„æ–‡ç« ã€‚è¿™é‡Œåšç®€å•è¯´æ˜ï¼š</p><p>constexprä¿®é¥°çš„å‡½æ•°ä½“ä¸èƒ½åŒ…å«æ±‡ç¼–è¯­å¥ã€gotoè¯­å¥ã€labelã€tryå—ã€é™æ€å˜é‡ã€çº¿ç¨‹å±€éƒ¨å­˜å‚¨ã€æ²¡æœ‰åˆå§‹åŒ–çš„æ™®é€šå˜é‡ï¼Œä¸èƒ½åŠ¨æ€åˆ†é…å†…å­˜ï¼Œä¸èƒ½æœ‰new deleteç­‰ï¼Œä¸èƒ½è™šå‡½æ•°ã€‚</p><h1 id="7-åµŒå¥—å‘½åç©ºé—´"><a href="#7-åµŒå¥—å‘½åç©ºé—´" class="headerlink" title="7.åµŒå¥—å‘½åç©ºé—´"></a>7.åµŒå¥—å‘½åç©ºé—´</h1><p>åœ¨ä¹‹å‰å¦‚æœéœ€è¦åµŒå¥—å‘½åç©ºé—´ï¼Œéœ€è¦è¿™æ ·å†™</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> A &#123;</span><br><span class="line">    <span class="keyword">namespace</span> B &#123;</span><br><span class="line">        <span class="keyword">namespace</span> C &#123;</span><br><span class="line">            <span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>C++17ä¸­å¯ä»¥ç›´æ¥ç”¨ç±»ä¼¼è®¿é—®é™å®šç¬¦çš„æ–¹å¼ï¼Œå‰é¢åŠ ä¸€ä¸ªnamespaceæ¥æ ‡æ˜åµŒå¥—çš„å‘½åç©ºé—´ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// c++17ï¼Œæ–¹ä¾¿äº†ï¼Œå¯è¯»æ€§ä¹Ÿæ›´å¥½</span></span><br><span class="line"><span class="keyword">namespace</span> A::B::C &#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="8-has-includeé¢„å¤„ç†è¡¨è¾¾å¼"><a href="#8-has-includeé¢„å¤„ç†è¡¨è¾¾å¼" class="headerlink" title="8.__has_includeé¢„å¤„ç†è¡¨è¾¾å¼"></a>8.__has_includeé¢„å¤„ç†è¡¨è¾¾å¼</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">if</span> defined __has_include <span class="comment">// åˆ¤æ–­æ˜¯å¦æ”¯æŒè¿™ä¸ªè¡¨è¾¾å¼</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> __has_include(<span class="string">&lt;charconv&gt;</span>) <span class="comment">// æ”¯æŒï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨è¯¥å¤´æ–‡ä»¶</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> has_charconv 1 <span class="comment">// å¤´æ–‡ä»¶å­˜åœ¨ï¼Œå®šä¹‰ä¸€ä¸ªå®</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;charconv&gt;</span> <span class="comment">// å¼•ç”¨è¿™ä¸ªå¤´æ–‡ä»¶</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>å¦‚æœä¸€ä¸ªä»£ç ä¼šåœ¨å¤šä¸ªä¸åŒçš„å¹³å°ä¸‹è·‘ï¼Œè¿™ä¸ªåŠŸèƒ½å°±å¾ˆé‡è¦ã€‚æ¯”å¦‚æˆ‘ä¹‹å‰å†™é¡¹ç›®çš„æ—¶å€™éœ€è¦ä½¿ç”¨åˆ°jsoncppï¼Œåœ¨centoså’Œdeepinä¸‹ï¼Œå®‰è£…jsoncppçš„includeè·¯å¾„æ˜¯ä¸åŒçš„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//centos</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;json/json.h&gt;</span></span></span><br><span class="line"><span class="comment">//deepin</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;jsoncpp/json/json.h&gt;</span></span></span><br></pre></td></tr></table></figure><p>è¿™ç§åœºæ™¯ä¸‹å°±å¯ä»¥ä½¿ç”¨ä¸Šé¢æåˆ°çš„è¿™ä¸ªé¢„å¤„ç†è¡¨è¾¾å¼è¿›è¡Œåˆ¤æ–­ï¼Œæ¥ç¡®è®¤ä½ çš„jsoncppè·¯å¾„åˆ°åº•åœ¨å“ªé‡Œã€‚æ³¨æ„ï¼Œè¿™åªèƒ½è§£å†³ä»yumå’Œaptå®‰è£…çš„jsoncppï¼Œå¦‚æœæ˜¯è‡ªå·±æ‰‹åŠ¨å®‰è£…çš„ï¼Œé‚£é¬¼çŸ¥é“ä½ å®‰è£…åˆ°å“ªé‡Œå»äº†ï¼ŸğŸ¤£</p><p>æ‰€ä»¥å¾ˆå¤šå¤§å‹é¡¹ç›®å¦‚æœéœ€è¦ä½¿ç”¨jsoncppè¿™ç§ç¬¬ä¸‰æ–¹ä¾èµ–é¡¹ç›®ï¼Œä¸€èˆ¬éƒ½ä¼šé‡‡ç”¨<code>git submodule</code>çš„æ–¹å¼ï¼Œç›´æ¥å°†ç¬¬ä¸‰æ–¹åº“ä¸‹è½½åˆ°å½“å‰é¡¹ç›®è·¯å¾„ä¸‹ï¼Œä»¥é¿å…ä¸åŒå¹³å°çš„ä¾èµ–é¡¹<code>include</code>è·¯å¾„ä¸å¯¹è€Œå¯¼è‡´æ— æ³•ç¼–è¯‘ç¨‹åºçš„é—®é¢˜ã€‚</p><h1 id="9-thisæŒ‡é’ˆæ•è·ï¼ˆlambdaï¼‰"><a href="#9-thisæŒ‡é’ˆæ•è·ï¼ˆlambdaï¼‰" class="headerlink" title="9.thisæŒ‡é’ˆæ•è·ï¼ˆlambdaï¼‰"></a>9.thisæŒ‡é’ˆæ•è·ï¼ˆlambdaï¼‰</h1><p>åœ¨lambdaè¡¨è¾¾å¼ä¸­ï¼Œé‡‡ç”¨<code>[this]</code>æ–¹å¼æ•è·çš„thisæŒ‡é’ˆæ˜¯<strong>å€¼ä¼ é€’</strong>æ•è·çš„ï¼Œä½†åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œä¼šå‡ºç°è®¿é—®å·²ç»è¢«é‡Šæ”¾äº†çš„ç©ºé—´çš„è¡Œä¸ºï¼›æ¯”å¦‚å¦‚ä¸‹ä»£ç </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Foo</span></span><br><span class="line">&#123;</span><br><span class="line">    std::unique_ptr&lt;<span class="type">int</span>&gt; p;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::function&lt;<span class="title">void</span><span class="params">()</span>&gt; <span class="title">f</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        p.<span class="built_in">reset</span>(<span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">10</span>));</span><br><span class="line">        <span class="keyword">return</span> [&amp;]</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="number">5</span> &lt;&lt; endl;</span><br><span class="line">            cout &lt;&lt; *p &lt;&lt; endl; <span class="comment">// å®é™…ä¸Šæ˜¯è¿™ä¸€æ­¥æŠ¥é”™çš„</span></span><br><span class="line">            <span class="comment">// è¿™é‡Œå¯¹*pçš„è®¿é—®å¯ä»¥è§£æä¸º *(this-&gt;p)ï¼Œä½†å®é™…ä¸ŠthisæŒ‡é’ˆå·²ç»è¢«é”€æ¯äº†</span></span><br><span class="line">            <span class="comment">// æ³¨æ„ï¼Œè¿™é‡Œé‡‡ç”¨äº†æ™ºèƒ½æŒ‡é’ˆï¼Œä¸å­˜åœ¨å†…å­˜æ³„æ¼ï¼ŒpæŒ‡é’ˆæŒ‡å‘çš„ç©ºé—´ä¹Ÿè¢«é”€æ¯äº†</span></span><br><span class="line">            <span class="comment">// ä½†æˆ‘ä»¬çš„æŠ¥é”™å…¶å®æ˜¯å¯¹thisæŒ‡é’ˆè§£å¼•ç”¨çš„æ—¶å€™å°±æŠ›å‡ºäº†</span></span><br><span class="line">            cout &lt;&lt; <span class="number">6</span> &lt;&lt; endl;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> foo = <span class="keyword">new</span> <span class="built_in">Foo</span>();</span><br><span class="line">    cout &lt;&lt; <span class="number">1</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">auto</span> f = foo-&gt;<span class="built_in">f</span>();  <span class="comment">// è·å–äº†ä¸€ä¸ªç±»å†…æˆå‘˜å‡½æ•°</span></span><br><span class="line">    cout &lt;&lt; <span class="number">2</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">delete</span> foo;  <span class="comment">// é”€æ¯è¿™ä¸ªå¯¹è±¡</span></span><br><span class="line">    cout &lt;&lt; <span class="number">3</span> &lt;&lt; endl;</span><br><span class="line">    <span class="comment">// å°è¯•åœ¨é”€æ¯åç»§ç»­ä½¿ç”¨è¿™ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡lambdaä¸­=æ•è·çš„thisæŒ‡é’ˆæ¥è®¿é—®å¯¹è±¡çš„</span></span><br><span class="line">    <span class="built_in">f</span>();  <span class="comment">// è¿™é‡Œç›´æ¥æŠ¥é”™äº† Segmentation fault (core dumped)</span></span><br><span class="line">    cout &lt;&lt; <span class="number">4</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œå¯ä»¥çœ‹åˆ°æ˜¯åœ¨<code>*p</code>çš„ä½ç½®æŠ¥é”™é€€å‡ºçš„ï¼›å…·ä½“çš„åŸå› å‚è€ƒä»£ç ä¸­çš„æ³¨é‡Šã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">5</span><br><span class="line">Segmentation fault (core dumped)</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„ï¼Œlambdaè¡¨è¾¾å¼ä¸­ï¼Œä½¿ç”¨&#x3D;å’Œ&amp;éƒ½ä¼šé»˜è®¤é‡‡ç”¨<strong>ä¼ å€¼æ•è·thisæŒ‡é’ˆ</strong>ï¼Œå› ä¸ºthisæŒ‡é’ˆæ˜¯å­˜åœ¨äºå‡½æ•°ä½œç”¨åŸŸä¸­çš„ä¸€ä¸ªéšè—å‚æ•°ï¼Œå¹¶ä¸æ˜¯ç‹¬ç«‹åœ¨æˆå‘˜å‡½æ•°å¤–çš„å˜é‡ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥è¢«æ•æ‰åˆ°çš„ï¼›å¦å¤–ï¼ŒthisæŒ‡é’ˆæ˜¯ä¸èƒ½è¢«ä¼ å¼•ç”¨æ•è·çš„ï¼Œ<code>[&amp;this]</code> çš„å†™æ³•æ˜¯ä¸å…è®¸çš„ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">clang++ test.cpp -o test -std=c++17</span><br><span class="line">test.cpp:84:18: error: &#x27;this&#x27; cannot be captured by reference</span><br><span class="line">        return [&amp;this]</span><br><span class="line">                 ^</span><br><span class="line">1 error generated.</span><br></pre></td></tr></table></figure><p>C++17ä¸­æä¾›äº†ä¸€ä¸ªç‰¹æ®Šçš„å†™æ³• <code>[*this]</code> é€šè¿‡ä¼ å€¼çš„æ–¹å¼æ•è·äº†å½“å‰å¯¹è±¡æœ¬èº«ï¼Œæ­¤æ—¶lambdaè¡¨è¾¾å¼ä¸­å­˜åœ¨çš„å°±æ˜¯ä¸€ä¸ªå¯¹è±¡çš„æ‹·è´ï¼Œå³ä¾¿å½“å‰å¯¹è±¡è¢«é”€æ¯äº†ï¼Œæˆ‘ä»¬ä¾æ—§å¯ä»¥é€šè¿‡è¿™ä¸ªæ‹·è´è®¿é—®åˆ°ç›®æ ‡ï¼›</p><p>ä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Foo</span></span><br><span class="line">&#123;</span><br><span class="line">    std::shared_ptr&lt;<span class="type">int</span>&gt; p; <span class="comment">// ä¸èƒ½ç”¨unique_ptrï¼Œå› ä¸ºå®ƒçš„æ‹·è´æ„é€ å‡½æ•°æ˜¯è¢«deleteç¦æ­¢ä½¿ç”¨çš„</span></span><br><span class="line"></span><br><span class="line">    <span class="function">std::function&lt;<span class="title">void</span><span class="params">()</span>&gt; <span class="title">f</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        p.<span class="built_in">reset</span>(<span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">10</span>));</span><br><span class="line">        <span class="keyword">return</span> [*<span class="keyword">this</span>]</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="number">5</span> &lt;&lt; endl;</span><br><span class="line">            cout &lt;&lt; *p &lt;&lt; endl;</span><br><span class="line">            cout &lt;&lt; <span class="number">6</span> &lt;&lt; endl;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> foo = <span class="keyword">new</span> <span class="built_in">Foo</span>();</span><br><span class="line">    cout &lt;&lt; <span class="number">1</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">auto</span> f = foo-&gt;<span class="built_in">f</span>();  <span class="comment">// è·å–äº†ä¸€ä¸ªç±»å†…æˆå‘˜å‡½æ•°</span></span><br><span class="line">    cout &lt;&lt; <span class="number">2</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">delete</span> foo;  <span class="comment">// é”€æ¯è¿™ä¸ªå¯¹è±¡</span></span><br><span class="line">    cout &lt;&lt; <span class="number">3</span> &lt;&lt; endl;</span><br><span class="line">    <span class="comment">// å°è¯•åœ¨é”€æ¯åç»§ç»­ä½¿ç”¨è¿™ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡lambdaä¸­=æ•è·çš„thisæŒ‡é’ˆæ¥è®¿é—®å¯¹è±¡çš„</span></span><br><span class="line">    <span class="built_in">f</span>();  <span class="comment">// è¿™é‡Œç›´æ¥æŠ¥é”™äº† Segmentation fault (core dumped)</span></span><br><span class="line">    cout &lt;&lt; <span class="number">4</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶é‡æ–°ç¼–è¯‘ï¼Œå°±èƒ½æˆåŠŸè®¿é—®åˆ°æŒ‡é’ˆpæŒ‡å‘çš„å¯¹è±¡äº†ï¼Œå¹¶ä¸å—fooå¯¹è±¡å·²ç»è¢«deleteçš„å½±å“ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">5</span><br><span class="line">10</span><br><span class="line">6</span><br><span class="line">4</span><br></pre></td></tr></table></figure><h1 id="10-å­—ç¬¦ä¸²è½¬æ¢"><a href="#10-å­—ç¬¦ä¸²è½¬æ¢" class="headerlink" title="10.å­—ç¬¦ä¸²è½¬æ¢"></a>10.å­—ç¬¦ä¸²è½¬æ¢</h1><blockquote><p>æ²¡çœ‹æ‡‚è¿™ä¸¤ä¸ªå‡½æ•°æ˜¯å¹²å˜›çš„ï¼Œæ‰¾åˆ°çš„ä»£ç è¿ç¼–è¯‘éƒ½è¿‡ä¸å»ï¼Œè·³è¿‡å§</p></blockquote><p>æ–°å¢from_charså‡½æ•°å’Œto_charså‡½æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://zh.cppreference.com/w/cpp/utility/from_chars</span><br><span class="line">https://blog.csdn.net/defaultbyzt/article/details/120151801</span><br></pre></td></tr></table></figure><h1 id="11-std-variant"><a href="#11-std-variant" class="headerlink" title="11.std::variant"></a>11.std::variant</h1><p>C++17å¢åŠ <code>std::variant</code>å®ç°ç±»ä¼¼unionçš„åŠŸèƒ½ï¼Œä½†å´æ¯”unionæ›´é«˜çº§ï¼Œä¸¾ä¸ªä¾‹å­unioné‡Œé¢ä¸èƒ½æœ‰stringè¿™ç§ç±»å‹ï¼Œä½†<code>std::variant</code>å´å¯ä»¥ï¼Œè¿˜å¯ä»¥æ”¯æŒæ›´å¤šå¤æ‚ç±»å‹ï¼Œå¦‚mapç­‰ï¼Œçœ‹ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123; <span class="comment">// c++17å¯ç¼–è¯‘</span></span><br><span class="line">    <span class="function">std::variant&lt;<span class="type">int</span>, std::string&gt; <span class="title">var</span><span class="params">(<span class="string">&quot;hello&quot;</span>)</span></span>;</span><br><span class="line">    cout &lt;&lt; var.<span class="built_in">index</span>() &lt;&lt; endl;</span><br><span class="line">    var = <span class="number">123</span>;</span><br><span class="line">    cout &lt;&lt; var.<span class="built_in">index</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        var = <span class="string">&quot;world&quot;</span>;</span><br><span class="line">        std::string str = std::<span class="built_in">get</span>&lt;std::string&gt;(var); <span class="comment">// é€šè¿‡ç±»å‹è·å–å€¼</span></span><br><span class="line">        var = <span class="number">3</span>;</span><br><span class="line">        <span class="type">int</span> i = std::<span class="built_in">get</span>&lt;<span class="number">0</span>&gt;(var); <span class="comment">// é€šè¿‡indexè·å–å¯¹åº”å€¼</span></span><br><span class="line">        cout &lt;&lt; str &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; i &lt;&lt; endl;</span><br><span class="line">    &#125; <span class="built_in">catch</span>(...) &#123;</span><br><span class="line">        <span class="comment">// xxx;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šä¸€èˆ¬æƒ…å†µä¸‹variantçš„ç¬¬ä¸€ä¸ªç±»å‹ä¸€èˆ¬è¦æœ‰å¯¹åº”çš„æ„é€ å‡½æ•°ï¼Œå¦åˆ™ç¼–è¯‘å¤±è´¥ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="built_in">A</span>(<span class="type">int</span> i)&#123;&#125;  </span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::variant&lt;A, <span class="type">int</span>&gt; var; <span class="comment">// ç¼–è¯‘å¤±è´¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä½•é¿å…è¿™ç§æƒ…å†µå‘¢ï¼Œå¯ä»¥ä½¿ç”¨<code>std::monostate</code>æ¥æ‰“ä¸ªæ¡©ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªç©ºçŠ¶æ€ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::variant&lt;std::monostate, A&gt; var; <span class="comment">// å¯ä»¥ç¼–è¯‘æˆåŠŸ</span></span><br></pre></td></tr></table></figure><h2 id="12-std-optional"><a href="#12-std-optional" class="headerlink" title="12.std::optional"></a>12.std::optional</h2><p><a href="https://en.cppreference.com/w/cpp/utility/optional">https://en.cppreference.com/w/cpp/utility/optional</a></p><p>æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³åœ¨å¼‚å¸¸çš„æ—¶å€™æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸çš„å¯¹è±¡ï¼Œäº¦æˆ–è€…æ˜¯åœ¨å‡ºç°ä¸€äº›ä¸å¯é¢„æœŸçš„é”™è¯¯çš„æ—¶å€™ï¼Œè¿”å›ä¸€ä¸ªç©ºå€¼ã€‚è¦æ€ä¹ˆåŒºåˆ†ç©ºå€¼å’Œå¼‚å¸¸çš„å¯¹è±¡å‘¢ï¼Ÿ</p><p>åœ¨pythonä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªä¸“é—¨çš„Noneå¯¹è±¡å¯ä»¥æ¥å¤„ç†è¿™ä»¶äº‹ã€‚åœ¨MySQLä¸­ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰NULLæ¥æ ‡è¯†ç©ºï¼›ä½†åœ¨CPPä¸­ï¼Œæˆ‘ä»¬åªå‰©ä¸‹ä¸€ä¸ª<code>nullptr</code>ï¼Œå…¶æœ¬è´¨æ˜¯ä¸ª<strong>æŒ‡é’ˆ</strong>ï¼Œä¸Pyä¸­çš„Noneå’ŒMySQLä¸­çš„NULLå®Œå…¨ä¸åŒï¼å¦‚æœæƒ³ç”¨æŒ‡é’ˆæ¥åŒºåˆ†ç©ºå’Œå¼‚å¸¸å¯¹è±¡ï¼Œé‚£å°±éœ€è¦ç”¨åˆ°åŠ¨æ€å†…å­˜ç®¡ç†ï¼Œäº¦æˆ–è€…æ˜¯ç”¨æ™ºèƒ½æŒ‡é’ˆæ¥é¿å…å†…å­˜æ³„æ¼ã€‚</p><p>è¯´äººè¯å°±æ˜¯ï¼Œåœ¨CPPä¸­æ²¡æœ‰ä¸€ä¸ªç±»ä¼¼Noneçš„å«ä¹‰ä¸ºç©ºçš„å¯¹è±¡ï¼Œæ¥å‘Šè¯‰è°ƒç”¨è¿™ä¸ªç¨‹åºçš„äººï¼Œåˆ°åº•æ˜¯å‘ç”Ÿäº†é”™è¯¯ï¼Œç”Ÿæˆäº†ä¸€ä¸ªé”™è¯¯çš„å¯¹è±¡ï¼Œè¿˜æ˜¯è¯´å‹æ ¹ä»€ä¹ˆéƒ½æ²¡æœ‰å¼„å‡ºæ¥ã€‚</p><p>äºæ˜¯<code>std::optional</code>å°±å‡ºç°äº†ï¼Œå…¶å¯ä»¥åŒ…å«ä¸€ä¸ªç±»å‹ï¼Œå¹¶æœ‰<code>std::nullopt</code>æ¥ä¸“é—¨æ ‡è¯†â€œç©ºâ€è¿™ä¸ªå«ä¹‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;optional&gt;</span></span></span><br><span class="line"><span class="function">std::optional&lt;<span class="type">int</span>&gt; <span class="title">StoI</span><span class="params">(<span class="type">const</span> std::string &amp;s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">stoi</span>(s);</span><br><span class="line">    &#125; <span class="built_in">catch</span>(...) &#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="literal">nullopt</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::string s&#123;<span class="string">&quot;123&quot;</span>&#125;;</span><br><span class="line">    std::optional&lt;<span class="type">int</span>&gt; o = <span class="built_in">StoI</span>(s);</span><br><span class="line">    <span class="keyword">if</span> (o) &#123;</span><br><span class="line">        cout &lt;&lt; *o &lt;&lt; endl;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;error&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬è¿›è¡Œäº†ifçš„åˆ¤æ–­ï¼Œé¦–å…ˆåˆ¤æ–­å˜é‡oæœ¬èº«ï¼Œä¸ºçœŸä»£è¡¨çš„ç¡®è¿”å›äº†ä¸€ä¸ªintå€¼ï¼Œä¸ºå‡ä»£è¡¨è¿”å›çš„æ˜¯<code>nullopt</code>ï¼›</p><p>éšåå†ä½¿ç”¨<code>*o</code>æ¥è®¿é—®åˆ°å†…éƒ¨æ‰˜ç®¡çš„æˆå‘˜ã€‚</p><p>éœ€è¦æ³¨æ„è¿™é‡Œæ˜¯ä¸¤å±‚çš„é€»è¾‘å…³ç³»ï¼Œåªæœ‰optionalå¯¹è±¡ä¸­æˆåŠŸæ‰˜ç®¡äº†ä¸€ä¸ªæŒ‡å®šçš„å‚æ•°ç±»å‹ï¼Œå…¶æœ¬èº«æ‰æ˜¯çœŸçš„ã€‚å¦‚æœæƒ³è®¿é—®å®ƒæ‰˜ç®¡çš„å¯¹è±¡ï¼Œåˆ™éœ€è¦ç”¨è§£å¼•ç”¨ã€‚</p><p>æ¯”å¦‚è¿™é‡Œï¼Œæˆ‘ä»¬çš„oå¯¹è±¡æ‰˜ç®¡çš„æ˜¯ä¸€ä¸ªboolç±»å‹çš„å‡ï¼Œä½†å‡å¹¶ä¸ä»£è¡¨ç©ºï¼Œoå¯¹è±¡æœ¬èº«çš„åˆ¤æ–­æ˜¯çœŸï¼Œå†…éƒ¨å¯¹<code>*o</code>çš„åˆ¤æ–­æ‰æ˜¯åˆ¤æ–­æ‰˜ç®¡çš„boolå€¼åˆ°åº•æ˜¯çœŸæ˜¯å‡ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;optional&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::optional&lt;<span class="type">bool</span>&gt; o = <span class="literal">false</span>;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">typeid</span>(o).<span class="built_in">name</span>() &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">if</span> (o) <span class="comment">// è¿™é‡Œåˆ¤æ–­çš„æ˜¯optionalå¯¹è±¡æ˜¯å¦æœ‰æ‰˜ç®¡ä¸€ä¸ªboolå€¼</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(*o)&#123; <span class="comment">// è¿™é‡Œåˆ¤æ–­çš„æ˜¯æ‰˜ç®¡çš„boolå€¼æœ¬èº«</span></span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;true&quot;</span> &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;false&quot;</span> &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// è¿™é‡Œåˆ™ä»£è¡¨æ‰˜ç®¡çš„æ˜¯nullopt</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;error&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆè¿è¡Œæ‰“å°çš„ç»“æœæ˜¯<code>false</code>ï¼›</p><h1 id="13-std-any"><a href="#13-std-any" class="headerlink" title="13.std::any"></a>13.std::any</h1><p><a href="https://en.cppreference.com/w/cpp/utility/any">https://en.cppreference.com/w/cpp/utility/any</a></p><p>è¿™ä¸ªç±»å‹å¯ä»¥æ‰˜ç®¡ä»»æ„ç±»å‹çš„å€¼ï¼Œä¸ä¹‹å¯¹åº”çš„è¿˜æœ‰ä¸€ä¸ª<code>std::any_cast</code>æ¥å°†å…¶æ‰˜ç®¡çš„å€¼è½¬æˆæˆ‘ä»¬éœ€è¦çš„ç±»å‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;any&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123; <span class="comment">// c++17å¯ç¼–è¯‘</span></span><br><span class="line">    std::any a = <span class="number">1</span>;</span><br><span class="line">    cout &lt;&lt; a.<span class="built_in">type</span>().<span class="built_in">name</span>() &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; std::<span class="built_in">any_cast</span>&lt;<span class="type">int</span>&gt;(a) &lt;&lt; endl;</span><br><span class="line">    a = <span class="number">2.2f</span>;</span><br><span class="line">    cout &lt;&lt; a.<span class="built_in">type</span>().<span class="built_in">name</span>() &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; std::<span class="built_in">any_cast</span>&lt;<span class="type">float</span>&gt;(a) &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">if</span> (a.<span class="built_in">has_value</span>()) &#123;</span><br><span class="line">        cout &lt;&lt; a.<span class="built_in">type</span>().<span class="built_in">name</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    a.<span class="built_in">reset</span>();</span><br><span class="line">    <span class="keyword">if</span> (a.<span class="built_in">has_value</span>()) &#123;</span><br><span class="line">        cout &lt;&lt; a.<span class="built_in">type</span>().<span class="built_in">name</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    a = std::<span class="built_in">string</span>(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">    cout &lt;&lt; a.<span class="built_in">type</span>().<span class="built_in">name</span>() &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; std::<span class="built_in">any_cast</span>&lt;std::string&gt;(a) &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i 1</span><br><span class="line">f 2.2</span><br><span class="line">fNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEE a</span><br></pre></td></tr></table></figure><p>è™½ç„¶anyçš„å‡ºç°è®©cppä¹Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šèƒ½å®ç°â€œå¼±ç±»å‹â€å˜é‡ï¼Œä½†åœ¨å…·ä½“çš„å¼€å‘ä¸­ï¼Œæ˜ç¡®å˜é‡çš„ç±»å‹ä¾æ—§æ¯”ä½¿ç”¨anyå¥½å¾—å¤šã€‚ç‰¹åˆ«æ˜¯åœ¨å˜é‡çš„ç±»å‹å¹¶ä¸å¯ä»¥è¢«ç›´æ¥è½¬æ¢çš„æƒ…å†µä¸‹ã€‚</p><h1 id="14-std-apply"><a href="#14-std-apply" class="headerlink" title="14.std::apply"></a>14.std::apply</h1><p>ä½¿ç”¨<code>std::apply</code>å¯ä»¥å°†tupleå±•å¼€ä½œä¸ºå‡½æ•°çš„å‚æ•°ä¼ å…¥ï¼Œè§ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tuple&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> first, <span class="type">int</span> second)</span> </span>&#123; <span class="keyword">return</span> first + second; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> add_lambda = [](<span class="keyword">auto</span> first, <span class="keyword">auto</span> second) &#123; <span class="keyword">return</span> first + second; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; std::<span class="built_in">apply</span>(add, std::<span class="built_in">pair</span>(<span class="number">1</span>, <span class="number">2</span>)) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">add</span>(std::<span class="built_in">pair</span>(<span class="number">1</span>, <span class="number">2</span>)) &lt;&lt; <span class="string">&quot;\n&quot;</span>; <span class="comment">// error</span></span><br><span class="line">    std::cout &lt;&lt; std::<span class="built_in">apply</span>(add_lambda, std::<span class="built_in">tuple</span>(<span class="number">2.0f</span>, <span class="number">3.0f</span>)) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="15-std-make-from-tuple"><a href="#15-std-make-from-tuple" class="headerlink" title="15.std::make_from_tuple"></a>15.std::make_from_tuple</h1><p>ä½¿ç”¨make_from_tupleå¯ä»¥å°†tupleå±•å¼€ä½œä¸ºæ„é€ å‡½æ•°å‚æ•°</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Foo</span> &#123;</span><br><span class="line">    <span class="built_in">Foo</span>(<span class="type">int</span> first, <span class="type">float</span> second, <span class="type">int</span> third) &#123;</span><br><span class="line">        std::cout &lt;&lt; first &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; second &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; third &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">auto</span> tuple = std::<span class="built_in">make_tuple</span>(<span class="number">42</span>, <span class="number">3.14f</span>, <span class="number">0</span>);</span><br><span class="line">   std::<span class="built_in">make_from_tuple</span>&lt;Foo&gt;(std::<span class="built_in">move</span>(tuple));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="16-std-string-view"><a href="#16-std-string-view" class="headerlink" title="16.std::string_view"></a>16.std::string_view</h1><p><a href="https://zhuanlan.zhihu.com/p/166359481">https://zhuanlan.zhihu.com/p/166359481</a></p><p><a href="https://en.cppreference.com/w/cpp/string/basic_string_view">https://en.cppreference.com/w/cpp/string/basic_string_view</a></p><p>å¦‚æœæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªstringçš„åªè¯»ç±»å‹çš„è¯ï¼Œå¯ä»¥ç”¨string_viewæ¥æ‰˜ç®¡ã€‚å…¶å†…éƒ¨åªåŒ…å«ä¸€ä¸ªæŒ‡å‘ç›®æ ‡å­—ç¬¦ä¸²çš„æŒ‡é’ˆï¼Œä»¥åŠå­—ç¬¦ä¸²çš„é•¿åº¦ã€‚</p><p>string_viewå†…éƒ¨å°è£…äº†stringçš„æ‰€æœ‰åªè¯»æ¥å£ï¼Œæœ¬æ¥å°±æ˜¯ç»™ä½ è¯»çš„ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå› ä¸ºå†…éƒ¨åªæœ‰ä¸€ä¸ªæŒ‡é’ˆï¼Œæ‰€ä»¥å½“string_viewæ‰˜ç®¡çš„stringè¢«é”€æ¯äº†ï¼Œä¸ä¹‹å…³è”çš„æ‰€æœ‰string_viewéƒ½ä¼šå¤±æ•ˆï¼åŒæ ·æ˜¯å› ä¸ºå†…éƒ¨åªæœ‰ä¸€ä¸ªæŒ‡é’ˆå’Œå­—ç¬¦ä¸²çš„é•¿åº¦ä¸¤ä¸ªå˜é‡ï¼Œæ‰€ä»¥åœ¨ä¼ å€¼æ‹·è´çš„æ—¶å€™ï¼Œstring_viewçš„æ•ˆç‡ä¼šé«˜å¾ˆå¤šã€‚</p><ul><li>è¿™å’Œ<code>const string&amp;</code> ç±»å‹çš„ä¼ å€¼åˆæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿä¼ å¼•ç”¨ä¸æ˜¯ä¹Ÿæ²¡æœ‰æ‹·è´æ¶ˆè€—å—ï¼Ÿ</li></ul><p>è¿™ä¸ªé—®é¢˜å¾ˆå¥½ï¼Œæˆ‘ä¸çŸ¥é“ï¼ç™¾åº¦ä¹Ÿæ²¡æœ‰ç™¾åº¦å‡ºæ¥â€¦â€¦</p><p>æˆ‘èƒ½æƒ³åˆ°çš„å°±æ˜¯ç”¨<code>string_view</code>ä½œä¸ºå‚æ•°çš„æ—¶å€™ï¼Œå¦‚æœå…¥å‚æ˜¯ä¸€ä¸ªå¸¸é‡å­—ç¬¦ä¸²ï¼Œæ­¤æ—¶ä¸éœ€è¦æ„é€ stringï¼Œè€Œä½¿ç”¨<code>const string&amp;</code> æ¥å—å¸¸é‡å­—ç¬¦ä¸²çš„æ—¶å€™ä¾æ—§éœ€è¦æ„é€ ä¸€ä¸ªstringå¯¹è±¡ã€‚è¿™éƒ¨åˆ†å°±ä¼šæœ‰ä¸€å®šçš„æ¶ˆè€—ã€‚</p><h1 id="17-as-const"><a href="#17-as-const" class="headerlink" title="17.as_const"></a>17.as_const</h1><p>C++17ä½¿ç”¨as_constå¯ä»¥å°†å·¦å€¼è½¬æˆconstç±»å‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">std::string str = <span class="string">&quot;str&quot;</span>;</span><br><span class="line"><span class="type">const</span> std::string&amp; constStr = std::<span class="built_in">as_const</span>(str);</span><br></pre></td></tr></table></figure><h1 id="18-file-system"><a href="#18-file-system" class="headerlink" title="18.file_system"></a>18.file_system</h1><p>C++17æ­£å¼å°†file_systemçº³å…¥æ ‡å‡†ä¸­ï¼Œæä¾›äº†å…³äºæ–‡ä»¶çš„å¤§å¤šæ•°åŠŸèƒ½ï¼ŒåŸºæœ¬ä¸Šåº”æœ‰å°½æœ‰ï¼Œè¿™é‡Œç®€å•ä¸¾å‡ ä¸ªä¾‹å­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> fs = std::filesystem;</span><br><span class="line">fs::<span class="built_in">create_directory</span>(dir_path); <span class="comment">// åˆ›å»ºæ–‡ä»¶æˆ–è€…è·¯å¾„</span></span><br><span class="line">fs::<span class="built_in">copy_file</span>(src, dst, fs::copy_options::skip_existing); <span class="comment">// æ–‡ä»¶cp</span></span><br><span class="line">fs::<span class="built_in">exists</span>(filename); <span class="comment">// æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">fs::<span class="built_in">current_path</span>(err_code); <span class="comment">// è·å–å½“å‰è·¯å¾„</span></span><br></pre></td></tr></table></figure><h1 id="19-shared-mutex"><a href="#19-shared-mutex" class="headerlink" title="19.shared_mutex"></a>19.shared_mutex</h1><p>è¿™ç©æ„æ˜¯ä¸ªè¯»å†™é”ã€‚ç®€å•ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯è¯»å†™é”ï¼š</p><ul><li>è¯»è€…å¯ä»¥æœ‰å¤šä¸ªï¼Œå†™è€…åªèƒ½æœ‰ä¸€ä¸ª</li><li>å†™é”æ˜¯äº’æ–¥çš„ï¼Œå¦‚æœAæœ‰é”ï¼ŒBæƒ³æ‹¿é”å°±å¾—é˜»å¡ç­‰å¾…</li><li>è¯»é”æ˜¯å…±äº«çš„ï¼ŒCæœ‰è¯»é”ï¼ŒDä¹Ÿæƒ³è¯»ï¼Œä¸¤ä¸ªäººå¯ä»¥ä¸€èµ·çœ‹</li><li>è¯»å†™é”æ˜¯äº’æ–¥çš„ï¼Œæœ‰äººå†™çš„æ—¶å€™ä¸èƒ½è¯»ï¼Œæœ‰äººè¯»çš„æ—¶å€™ä¸èƒ½å†™</li></ul><p>æ¢åˆ°ä¸“ä¸šæœ¯è¯­ä¸Šï¼Œå°±æ˜¯åˆ†ä¸ºç‹¬å é”ï¼ˆå†™é”ï¼‰å’Œå…±äº«é”ï¼ˆè¯»é”ï¼‰ï¼›</p><p>åœ¨C++14ä¸­å…¶å®å·²ç»æœ‰äº†ä¸€ä¸ª<code>shared_timed_mutex</code>ï¼ŒC++17ä¸­è¿™ä¸ªé”çš„æ“ä½œä¸å…¶åŸºæœ¬ä¸€è‡´ï¼Œåªä¸è¿‡å¤šäº†å‡ ä¸ªå’Œæ—¶é—´ç›¸å…³çš„æ¥å£</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">try_lock_for</span>(...);</span><br><span class="line"><span class="built_in">try_lock_shared_for</span>(...);</span><br><span class="line"><span class="built_in">try_lock_shared_until</span>(...);</span><br><span class="line"><span class="built_in">try_lock_until</span>(...);</span><br></pre></td></tr></table></figure><p>å…·ä½“ä½¿ç”¨å¯ä»¥å‚è€ƒ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://zh.cppreference.com/w/cpp/thread/shared_mutex</span><br><span class="line">https://zhuanlan.zhihu.com/p/610781321</span><br></pre></td></tr></table></figure><h1 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h1><p>å…³äºC++17å¸¸ç”¨çš„åŸºæœ¬å°±æ˜¯è¿™äº›äº†ï¼Œåç»­é‡åˆ°æ–°çš„å†æ›´æ–°æœ¬æ–‡ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å­¦ä¹ C++17çš„æ–°ç‰¹æ€§&lt;/p&gt;
&lt;h1 id=&quot;1-æ„é€ å‡½æ•°æ¨¡æ¿æ¨å¯¼&quot;&gt;&lt;a href=&quot;#1-æ„é€ å‡½æ•°æ¨¡æ¿æ¨å¯¼&quot; class=&quot;headerlink&quot; title=&quot;1.æ„é€ å‡½æ•°æ¨¡æ¿æ¨å¯¼&quot;&gt;&lt;/a&gt;1.æ„é€ å‡½æ•°æ¨¡æ¿æ¨å¯¼&lt;/h1&gt;&lt;p&gt;åœ¨ä¹‹å‰ï¼Œæˆ‘ä»¬å¦‚æœæƒ³ç”¨stlå®¹å™¨ï¼Œéƒ½éœ€è¦</summary>
      
    
    
    
    <category term="é‡è§C++" scheme="https://blog.musnow.top/categories/%E9%81%87%E8%A7%81C/"/>
    
    
    <category term="C++" scheme="https://blog.musnow.top/tags/C/"/>
    
    <category term="æ•°æ®ç»“æ„" scheme="https://blog.musnow.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    <category term="C++17" scheme="https://blog.musnow.top/tags/C-17/"/>
    
  </entry>
  
  <entry>
    <title>ã€é¢ç»ã€‘230915ä¸Šæµ·æˆç£ç½‘ç»œç§‘æŠ€C/LINUXå®ä¹ ç”Ÿ</title>
    <link href="https://blog.musnow.top/posts/2553205100/"/>
    <id>https://blog.musnow.top/posts/2553205100/</id>
    <published>2023-09-15T06:50:14.000Z</published>
    <updated>2023-09-15T06:50:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>10åˆ†é’Ÿå°±é¢å®Œäº†ï¼Œå ªç§°æ€¥é€Ÿï¼Œé¢è¯•å®˜è¯´æˆ‘ç­”çš„ä¸é”™ï¼›è€Œä¸”ä¸Šæ¥è‡ªæˆ‘ä»‹ç»å®Œæ¯•åå°±é—®é—®é¢˜ï¼Œä¸å¤šæ¯”æ¯”ğŸ¤£</p><span id="more"></span><h1 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h1><h2 id="1-Linuxä¸‹çº¿ç¨‹äº’æ–¥æ€ä¹ˆå®ç°"><a href="#1-Linuxä¸‹çº¿ç¨‹äº’æ–¥æ€ä¹ˆå®ç°" class="headerlink" title="1.Linuxä¸‹çº¿ç¨‹äº’æ–¥æ€ä¹ˆå®ç°"></a>1.Linuxä¸‹çº¿ç¨‹äº’æ–¥æ€ä¹ˆå®ç°</h2><p>åŠ é”ï¼Œpthreadï¼Œç„¶åæˆ‘è¿˜æåˆ°äº†cppçš„åŸå­å˜é‡</p><p><a href="https://blog.musnow.top/posts/1309150756/">https://blog.musnow.top/posts/1309150756/</a></p><h2 id="2-CPPå¤šæ€æ€ä¹ˆå®ç°"><a href="#2-CPPå¤šæ€æ€ä¹ˆå®ç°" class="headerlink" title="2.CPPå¤šæ€æ€ä¹ˆå®ç°"></a>2.CPPå¤šæ€æ€ä¹ˆå®ç°</h2><p>è™šå‡½æ•°è¡¨ï¼Œå·´æ‹‰å·´æ‹‰</p><p><a href="https://blog.musnow.top/posts/3933786088/">https://blog.musnow.top/posts/3933786088/</a></p><h2 id="3-CPPä¸ºå•¥è¦å¼•å…¥æ¨¡æ¿"><a href="#3-CPPä¸ºå•¥è¦å¼•å…¥æ¨¡æ¿" class="headerlink" title="3.CPPä¸ºå•¥è¦å¼•å…¥æ¨¡æ¿"></a>3.CPPä¸ºå•¥è¦å¼•å…¥æ¨¡æ¿</h2><p>ä»£ç æ›´é«˜å¤ç”¨</p><p><a href="https://blog.musnow.top/posts/2940029419/">https://blog.musnow.top/posts/2940029419/</a></p><h2 id="4-NATæ€ä¹ˆå®ç°çš„ï¼Ÿ"><a href="#4-NATæ€ä¹ˆå®ç°çš„ï¼Ÿ" class="headerlink" title="4.NATæ€ä¹ˆå®ç°çš„ï¼Ÿ"></a>4.NATæ€ä¹ˆå®ç°çš„ï¼Ÿ</h2><p>è½¬åŒ–è¡¨ï¼ŒIPåœ°å€æ›¿æ¢ï¼Œå·´æ‹‰å·´æ‹‰å§è¯´ä¸€å¤§å †</p><p><a href="https://blog.musnow.top/posts/3482559497/">https://blog.musnow.top/posts/3482559497/</a></p><h2 id="5-è¿›ç¨‹é€šä¿¡"><a href="#5-è¿›ç¨‹é€šä¿¡" class="headerlink" title="5.è¿›ç¨‹é€šä¿¡"></a>5.è¿›ç¨‹é€šä¿¡</h2><p>è€é—®é¢˜äº†</p><h2 id="6-inet-ntoaå‡½æ•°çŸ¥é“å—ï¼Ÿè¿ç»­è°ƒç”¨ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#6-inet-ntoaå‡½æ•°çŸ¥é“å—ï¼Ÿè¿ç»­è°ƒç”¨ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="6.inet_ntoaå‡½æ•°çŸ¥é“å—ï¼Ÿè¿ç»­è°ƒç”¨ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>6.inet_ntoaå‡½æ•°çŸ¥é“å—ï¼Ÿè¿ç»­è°ƒç”¨ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h2><blockquote><p>è¿™æ˜¯æœ€åä¸€ä¸ªé—®é¢˜ï¼Œé¢è¯•å®˜è¯´æˆ‘ç­”çš„æŒºå¥½çš„</p></blockquote><p>æˆ‘å…ˆè¯´äº†è¿™ä¸ªå‡½æ•°æ˜¯ç”¨äº16ä½IPåœ°å€å’Œå­—ç¬¦ä¸²çš„è½¬æ¢çš„ï¼›</p><p>ç„¶åé¢è¯•å®˜è¿™é‡Œé—®äº†ä¸€ä¸ªä¸šåŠ¡ä¸Šçš„é—®é¢˜</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s %s\n&quot;</span>,<span class="built_in">inet_ntoa</span>(x),<span class="built_in">inet_ntoa</span>(y));<span class="comment">// xå’Œyæ˜¯ä¸¤ä¸ªipåœ°å€</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°ä¼šä¸ä¼šæœ‰ä»€ä¹ˆé”™è¯¯çš„åœ°æ–¹ï¼Ÿ</p><blockquote><p>è¯·æ³¨æ„ï¼Œè¿™é‡Œæ˜¯é¢è¯•æ—¶å€™çš„æè¿°ï¼Œé¢è¯•å®˜è‚¯å®šåªèƒ½ç»™ä½ æè¿°ä¸ªå¤§æ¦‚çš„ï¼Œå¹¶ä¸ä¼šç»†è‡´åˆ°å…·ä½“çš„ä¼ å‚åº”è¯¥ä¼ ä»€ä¹ˆç±»å‹çš„å˜é‡ï¼Œæ‰€ä»¥ä¼ å‚xå’Œyä¹Ÿåªæ˜¯ä¸ªä¼ªä»£ç ï¼Œæƒ³é—®çš„åœ°æ–¹ä¸åœ¨è¿™é‡Œï¼</p></blockquote><p>è¿™é‡Œæˆ‘è¯´äº†<code>inet_ntoa</code>æ˜¯é‡‡ç”¨staticå˜é‡æ¥è¿”å›ipå­—ç¬¦ä¸²çš„ï¼Œçº¿ç¨‹ä¸å®‰å…¨ï¼Œæœ‰å¯èƒ½ä¸¤ä¸ªè°ƒç”¨æœ€ç»ˆè¿”å›äº†ä¸€ä¸ªç›¸åŒçš„IPåœ°å€ï¼Œåˆæ˜è¯´äº†æˆ‘ä¸ç¡®å®šï¼›ï¼ˆè‚¯å®šæœ‰é—®é¢˜ï¼Œä¸ç„¶é—®ä½ å¹²å˜›ï¼Ÿï¼‰</p><hr><p>é¢è¯•ç»“æŸäº†ï¼Œæ¥æµ‹è¯•ä¸€ä¸‹åˆ°åº•æ˜¯å•¥æƒ…å†µå§ï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">in_addr</span> ip1;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">in_addr</span> ip2;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">inet_aton</span>(<span class="string">&quot;192.168.3.1&quot;</span>,&amp;ip1);</span><br><span class="line">    <span class="built_in">inet_aton</span>(<span class="string">&quot;10.161.33.42&quot;</span>,&amp;ip2);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s %s\n&quot;</span>,<span class="built_in">inet_ntoa</span>(ip1),<span class="built_in">inet_ntoa</span>(ip2));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼Œä¸¤ä¸ªIPåœ°å€è¿”å›äº†åŒä¸€ä¸ªï¼Œæˆ‘çŒœå¯¹äº†ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">192.168.3.1 192.168.3.1</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ‰“å°ä¸€ä¸‹åœ°å€ï¼Œä¼šå¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼Œä¸¤æ¬¡è°ƒç”¨è¿”å›äº†ç›¸åŒçš„åœ°å€ï¼Œè‡ªç„¶æ‰“å°å‡ºæ¥çš„ç»“æœç›¸åŒï¼›</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%x %x\n&quot;</span>,<span class="built_in">inet_ntoa</span>(ip1),<span class="built_in">inet_ntoa</span>(ip2));</span><br><span class="line"><span class="comment">//68db1ef0 68db1ef0</span></span><br></pre></td></tr></table></figure><p>å¯¹äºè¿™ä¸ªå‡½æ•°è€Œè¨€ï¼Œå®ƒéœ€è¦ç»™æˆ‘ä»¬è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆå¿…é¡»ä¿è¯è¿™ä¸ªå­—ç¬¦ä¸²èƒ½åœ¨å‡½æ•°å¤–è¢«æ­£å¸¸è®¿é—®ï¼ˆä¸èƒ½è¢«é‡Šæ”¾ï¼‰ï¼Œå†åŠ ä¸Šè¿™æ˜¯ä¸€ä¸ªCè¯­è¨€æ¥å£ï¼Œé‚£ä¹ˆå°±åªæœ‰ä¸‰ç§æ–¹æ¡ˆäº†</p><ul><li>å‡½æ•°é‡Œé¢mallocï¼Œéœ€è¦ç”¨æˆ·æ‰‹åŠ¨free</li><li>staticå˜é‡</li><li>è®©ç”¨æˆ·ä¼ å…¥ä¸€ä¸ªæœ‰æ•ˆçš„åœ°å€ï¼Œå°†æ•°æ®å†™å…¥ä½œä¸ºè¾“å‡ºå‹å‚æ•°</li></ul><p>ç¬¬ä¸€ä¸ªæ–¹æ¡ˆè‚¯å®šæ˜¯ä¸å¯è¡Œçš„ï¼è¿™ç›¸å½“äºå®˜æ–¹æä¾›äº†ä¸€ä¸ª<strong>æå…¶å®¹æ˜“å¯¼è‡´å†…å­˜æ³„æ¼</strong>çš„æ¥å£ï¼è¿™ä¸å¾—è¢«å¼€å‘è€…å–·æ­»ï¼Ÿæ¯”å¦‚æœ¬é¢˜æåˆ°çš„åœºæ™¯é‡Œé¢å°±æ˜¯ä¸¤æ¬¡printfè€Œå·²ï¼Œé™¤æ­¤ä¹‹å¤–æ²¡æœ‰ä¿å­˜è¿™ä¸ªè¿”å›å€¼ï¼Œæ›´åˆ«æfreeäº†ï¼Œè¿™é‡Œå°±ç›´æ¥ä¸¤æ¬¡å†…å­˜æ³„æ¼äº†ï¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s %s\n&quot;</span>,inet_ntoa(ip1),inet_ntoa(ip2));</span><br><span class="line"><span class="comment">// å¦‚æœç”¨mallocåçš„å­—ç¬¦ä¸²åœ°å€åšè¿”å›å€¼ï¼Œè¿™é‡Œå°±æ˜¯ä¸¤ä¸ªå†…å­˜æ³„æ¼</span></span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰ä¸ªæ–¹æ¡ˆä¹Ÿä¸æ–¹ä¾¿ï¼Œç³»ç»Ÿä¾èµ–ç”¨æˆ·ä¼ å…¥ä¸€ä¸ªæ•°ç»„çš„å…¥å‚ï¼Œæˆ‘ä»¬çŸ¥é“ipv4çš„IPåœ°å€å­—ç¬¦ä¸²æœ€é•¿æ˜¯<code>3*4+3=15</code>ä½ï¼Œé‚£ä¹ˆå¦‚æœç”¨æˆ·åªä¼ å…¥ä¸€ä¸ª<code>char arr[12]</code>å‘¢ï¼Ÿè¶Šç•Œè®¿é—®çš„é—®é¢˜æ€ä¹ˆè§£å†³ï¼Ÿç›¸å½“äºç³»ç»Ÿä¹‹ä¸­ä¾æ—§ä¼šå‡ºç°å‚æ•°ä¸åŒ¹é…è€Œå¯èƒ½å¯¼è‡´çš„åœ°å€è®¿é—®é”™è¯¯ï¼</p><p><strong>è€Œè¿™ä¸ªå‡½æ•°æœ¬èº«çš„å·¥ä½œå¾ˆç®€å•ï¼Œå®Œå…¨æ²¡å¿…è¦å¼„é‚£ä¹ˆå¤æ‚</strong>ï¼›</p><p>æœ€ç»ˆlinuxç³»ç»Ÿé‡‡ç”¨äº†staticå˜é‡çš„æ–¹å¼ï¼Œæ¥è¿”å›è¿™ä¸ªIPåœ°å€çš„å­—ç¬¦ä¸²ï¼›manæ‰‹å†Œé‡Œé¢æ˜¯è¿™ä¹ˆè¯´çš„ï¼Œç›´æ¥çœ‹æœ€åä¸€å¥ï¼Œç¿»è¯‘è¿‡æ¥çš„æ„æ€æ˜¯<strong>åç»­çš„è°ƒç”¨ä¼šè¦†ç›–æ‰å‰é¢çš„å€¼</strong>ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> The inet_ntoa() function converts the Internet host address in, </span><br><span class="line"> given in network byte order, to a string in IPv4 dotted-decimal notation.  </span><br><span class="line"> The string  is returned in a statically allocated buffer,</span><br><span class="line">which subsequent calls will overwrite.</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æœ€ç»ˆæˆ‘ä»¬çœ‹åˆ°çš„ç»“æœå°±æ˜¯ä¸¤æ¬¡æ‰“å°å‡ºäº†ç›¸åŒçš„IPåœ°å€ï¼›</p><p>è¿™é‡Œè¿˜æ¶‰åŠåˆ°ç¬¬äºŒä¸ªçŸ¥è¯†ç‚¹ï¼Œ<a href="https://blog.musnow.top/posts/3888883052/">printfçš„ä¼ å‚é¡ºåº</a>;</p><p>ç®€å•è¯´æ¥å°±æ˜¯printfæ˜¯ä»å³å¾€å·¦æ‰§è¡Œçš„ï¼ˆå…¶å®æ‰€æœ‰å‡½æ•°çš„ä¼ å‚éƒ½æ˜¯è¿™æ ·ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç¼ºçœå€¼è¦ä»å³è¾¹å¾€å·¦ç»™ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s %s\n&quot;</span>,<span class="built_in">inet_ntoa</span>(ip1),<span class="built_in">inet_ntoa</span>(ip2));</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹</p><ul><li>ip2ç»“æ„ä½“ä¼ ç»™å‡½æ•°ï¼Œè½¬æˆipåœ°å€å­—ç¬¦ä¸²åå­˜åœ¨staticå˜é‡ä¸­</li><li>ip1ç»“æ„ä½“ä¼ ç»™å‡½æ•°ï¼Œè½¬æˆipåœ°å€å­—ç¬¦ä¸²åå­˜åœ¨äº†staticå˜é‡ä¸­ï¼Œè¦†ç›–äº†ip2çš„ç»“æœ</li></ul><p>æœ€ç»ˆæ‰“å°å‡ºæ¥çš„ä¸¤ä¸ªå­—ç¬¦ä¸²éƒ½æ˜¯ip1çš„åœ°å€ï¼</p><p>å¯¹äº<code>inet_aton</code>å‡½æ•°è€Œè¨€ï¼Œ<strong>æ­£ç¡®çš„è°ƒç”¨</strong>åŠæ³•æ˜¯æ¯æ¬¡è°ƒç”¨åéƒ½å–èµ°è¿”å›çš„IPåœ°å€å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç”¨<code>std::string</code>æ¥æ”¶ï¼Œä¹Ÿå¯ä»¥ç”¨strcmpæ‹·è´åˆ°ä¸€ä¸ªè‡ªå·±å®šä¹‰çš„å­—ç¬¦ä¸²æ•°ç»„å˜é‡ä¸­ï¼›</p><p>ä½ å­¦ä¼šäº†å—ï¼Œéªšå¹´ï¼Ÿ</p><blockquote><p><code>inet_aton</code>è¿™ä¸ªå‡½æ•°æœ€æ—©å‡ºç°äºæœ¬ç«™çš„æ­¤åšå®¢ï¼š<a href="https://blog.musnow.top/posts/368672249/">ã€Linuxã€‘æ¥å†™ä¸€ä¸ªudpçš„æœåŠ¡ç«¯+å®¢æˆ·ç«¯</a></p></blockquote><h1 id="é¡¹ç›®"><a href="#é¡¹ç›®" class="headerlink" title="é¡¹ç›®"></a>é¡¹ç›®</h1><p>å› ä¸ºæ˜¯cppçš„å²—ä½ï¼Œæ‰€ä»¥æ²¡æœ‰é—®pythonçš„æœºå™¨äººé¡¹ç›®é—®é¢˜ï¼›</p><h2 id="1-è§†é¢‘ç‚¹æ’­ä¼ ä¸€åŠå…³é—­äº†æ€ä¹ˆè§£å†³"><a href="#1-è§†é¢‘ç‚¹æ’­ä¼ ä¸€åŠå…³é—­äº†æ€ä¹ˆè§£å†³" class="headerlink" title="1.è§†é¢‘ç‚¹æ’­ä¼ ä¸€åŠå…³é—­äº†æ€ä¹ˆè§£å†³"></a>1.è§†é¢‘ç‚¹æ’­ä¼ ä¸€åŠå…³é—­äº†æ€ä¹ˆè§£å†³</h2><p>ä¸¤æ¬¡é¢è¯•éƒ½é—®åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æåˆ°äº†å°†æ–°çš„æ–‡ä»¶å’Œæœ¬åœ°å·²æœ‰æ–‡ä»¶è¿›è¡Œæ ¡éªŒï¼Œè·³è¿‡å·²æœ‰æ•°æ®</p><h2 id="2-ä¼ ä¸€åŠå‰©ä¸‹çš„æ•°æ®åç«¯æ€ä¹ˆå¤„ç†ï¼Œä»€ä¹ˆæ—¶å€™åˆ é™¤ï¼Ÿ"><a href="#2-ä¼ ä¸€åŠå‰©ä¸‹çš„æ•°æ®åç«¯æ€ä¹ˆå¤„ç†ï¼Œä»€ä¹ˆæ—¶å€™åˆ é™¤ï¼Ÿ" class="headerlink" title="2.ä¼ ä¸€åŠå‰©ä¸‹çš„æ•°æ®åç«¯æ€ä¹ˆå¤„ç†ï¼Œä»€ä¹ˆæ—¶å€™åˆ é™¤ï¼Ÿ"></a>2.ä¼ ä¸€åŠå‰©ä¸‹çš„æ•°æ®åç«¯æ€ä¹ˆå¤„ç†ï¼Œä»€ä¹ˆæ—¶å€™åˆ é™¤ï¼Ÿ</h2><p>æˆ‘æåˆ°äº†å‰åç«¯ç”¨md5éªŒè¯æ¥ç¡®è®¤è§†é¢‘æ–‡ä»¶æ— è¯¯ï¼Œå¦‚æœæœ‰é—®é¢˜ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œä¸€å°æ—¶ååˆ é™¤é”™è¯¯çš„æ•°æ®</p><h2 id="3-ç”¨æˆ·ä¿®æ”¹äº†è§†é¢‘åä¸Šä¼ æ€ä¹ˆå¤„ç†ï¼Ÿ"><a href="#3-ç”¨æˆ·ä¿®æ”¹äº†è§†é¢‘åä¸Šä¼ æ€ä¹ˆå¤„ç†ï¼Ÿ" class="headerlink" title="3.ç”¨æˆ·ä¿®æ”¹äº†è§†é¢‘åä¸Šä¼ æ€ä¹ˆå¤„ç†ï¼Ÿ"></a>3.ç”¨æˆ·ä¿®æ”¹äº†è§†é¢‘åä¸Šä¼ æ€ä¹ˆå¤„ç†ï¼Ÿ</h2><p>åŒç¬¬ä¸€ä¸ªï¼Œè¿›è¡Œä¸€å®šçš„æ•°æ®æ ¡éªŒï¼Œç„¶åå†å¤å†™æ²¡æœ‰çš„æ•°æ®ï¼›</p><blockquote><p>ç„¶è€Œè¿™äº›åŠŸèƒ½æˆ‘ä¸€ä¸ªéƒ½æ²¡æœ‰å®ç°ğŸ¤£</p></blockquote><h1 id="æ•ˆç‡"><a href="#æ•ˆç‡" class="headerlink" title="æ•ˆç‡"></a>æ•ˆç‡</h1><p>é¢ç»è¿˜æ²¡å†™å®Œï¼Œç»“æœå·²ç»å‡ºå•¦ï¼Œè¿‡äº†åˆè¯•ï¼ä½†æ˜¯è¦çº¿ä¸‹å¤è¯•ï¼›</p>]]></content>
    
    
    <summary type="html">230915ä¸Šæµ·æˆç£ç½‘ç»œç§‘æŠ€C/LINUXå®ä¹ ç”Ÿ</summary>
    
    
    
    <category term="æ±‚èŒè·¯ä¸Šä¸€å»ä¸å¤è¿”" scheme="https://blog.musnow.top/categories/%E6%B1%82%E8%81%8C%E8%B7%AF%E4%B8%8A%E4%B8%80%E5%8E%BB%E4%B8%8D%E5%A4%8D%E8%BF%94/"/>
    
    
    <category term="é¢ç»" scheme="https://blog.musnow.top/tags/%E9%9D%A2%E7%BB%8F/"/>
    
  </entry>
  
  <entry>
    <title>ã€MySQLã€‘å­—èŠ‚è·³åŠ¨MySQLè¿ç¯40é—®</title>
    <link href="https://blog.musnow.top/posts/3873856211/"/>
    <id>https://blog.musnow.top/posts/3873856211/</id>
    <published>2023-09-15T00:52:14.000Z</published>
    <updated>2023-09-15T00:52:30.000Z</updated>
    
    <content type="html"><![CDATA[<p>å­—èŠ‚MySQLè¿ç¯40é—®ï¼Œç½‘å›¾</p><span id="more"></span><p><img src="https://img.musnow.top/i/2023/09/188abb653b96cb823385befe4c196698.jpg" alt="QQå›¾ç‰‡20230915081943"></p><p>è™½ç„¶æ„Ÿè§‰è¿™ç©æ„å’Œå­—èŠ‚è·³åŠ¨æ²¡å…³ç³»ï¼Œä½†æ˜¯ç®¡ä»–çš„ï¼Ÿç›´æ¥å¼€å§‹å›ç­”ï¼</p><h1 id="1-MySQLä¸­æœ‰å“ªå‡ ç§é”ï¼Ÿ"><a href="#1-MySQLä¸­æœ‰å“ªå‡ ç§é”ï¼Ÿ" class="headerlink" title="1.MySQLä¸­æœ‰å“ªå‡ ç§é”ï¼Ÿ"></a>1.MySQLä¸­æœ‰å“ªå‡ ç§é”ï¼Ÿ</h1><blockquote><p>ä¼šçš„ä¸å…¨ï¼Œæ‰€ä»¥æŸ¥çš„GPT</p></blockquote><p>MySQLä¸­æœ‰å¤šç§ç±»å‹çš„é”ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š</p><ol><li>å…±äº«é”ï¼ˆShared Lockï¼‰ï¼šä¹Ÿç§°ä¸º<strong>è¯»é”</strong>ï¼Œå¤šä¸ªä¼šè¯å¯ä»¥åŒæ—¶æŒæœ‰å…±äº«é”ï¼Œå¹¶ä¸”ä¸äº’æ–¥ã€‚å…±äº«é”é€‚ç”¨äºè¯»å–æ“ä½œï¼Œå¤šä¸ªä¼šè¯å¯ä»¥å¹¶å‘è¯»å–åŒä¸€ä»½æ•°æ®è€Œä¸ä¼šäº§ç”Ÿå†²çªã€‚</li><li>æ’ä»–é”ï¼ˆExclusive Lockï¼‰ï¼šä¹Ÿç§°ä¸º<strong>å†™é”</strong>ï¼Œæ’ä»–é”ä¸å…¶ä»–ä»»ä½•é”éƒ½äº’æ–¥ï¼Œåªæœ‰ä¸€ä¸ªä¼šè¯å¯ä»¥æŒæœ‰æ’ä»–é”ã€‚æ’ä»–é”é€‚ç”¨äºå†™å…¥æˆ–ä¿®æ”¹æ“ä½œï¼Œç¡®ä¿åœ¨æŸä¸ªä¼šè¯æŒæœ‰æ’ä»–é”çš„æ—¶å€™ï¼Œå…¶ä»–ä¼šè¯æ— æ³•åŒæ—¶è¿›è¡Œå†™å…¥æ“ä½œã€‚</li><li>è®°å½•é”ï¼ˆRecord Lockï¼‰ï¼šè®°å½•é”ï¼ˆ<strong>è¡Œé”</strong>ï¼‰æ˜¯é’ˆå¯¹æŸæ¡è®°å½•çš„é”å®šï¼Œç”¨äºä¿æŠ¤ç‰¹å®šè®°å½•çš„å®Œæ•´æ€§ã€‚åœ¨ä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“æ—¶ï¼Œè¯»å–æˆ–ä¿®æ”¹æŸæ¡è®°å½•æ—¶ä¼šè‡ªåŠ¨ç»™è¯¥è®°å½•åŠ ä¸Šè®°å½•é”ï¼Œå…¶ä»–ä¼šè¯åˆ™æ— æ³•å¯¹è¯¥è®°å½•è¿›è¡Œå¹¶å‘å†™å…¥æˆ–åˆ é™¤æ“ä½œã€‚</li><li>Gapé”ï¼šGapé”æ˜¯InnoDBå¼•æ“çš„ä¸€ç§é”æœºåˆ¶ï¼Œ<strong>ç”¨äºé˜²æ­¢å¹»è¯»</strong>ã€‚å®ƒé”å®šäº†ä¸€ä¸ªèŒƒå›´ï¼Œä½†ä¸åŒ…å«å®é™…çš„è®°å½•ï¼Œç”¨äºé˜²æ­¢å…¶ä»–ä¼šè¯åœ¨è¿™ä¸ªèŒƒå›´å†…æ’å…¥æ–°è®°å½•ï¼Œä»¥é¿å…å¹»è¯»ç°è±¡çš„å‘ç”Ÿã€‚</li><li>è¡¨é”ï¼ˆTable Lockï¼‰ï¼šè¡¨é”æ˜¯å¯¹æ•´ä¸ªè¡¨æ ¼è¿›è¡Œé”å®šï¼Œå¯ä»¥åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ä½¿ç”¨ï¼Œä½†ä¼šé˜»å¡å…¶ä»–ä¼šè¯çš„è¯»å–å’Œå†™å…¥æ“ä½œã€‚åœ¨éœ€è¦å¹¶å‘è¯»å†™çš„æƒ…å†µä¸‹ï¼Œè¡¨é”çš„æ€§èƒ½è¾ƒä½ï¼Œå› æ­¤ä¸€èˆ¬ä¸æ¨èä½¿ç”¨ã€‚</li></ol><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªNEXT-KEYé”ï¼š</p><p>NEXT-KEY é”æ˜¯ InnoDB å­˜å‚¨å¼•æ“ä¸­çš„ä¸€ç§é”æœºåˆ¶ï¼Œç”¨äº<strong>è§£å†³å¹»è¯»</strong>é—®é¢˜ã€‚å®ƒæ˜¯é€šè¿‡å°† Gap é”å’Œ è®°å½•é” ç»„åˆè€Œæˆçš„ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œå½“ä¸€ä¸ªäº‹åŠ¡åœ¨ InnoDB è¡¨ä¸­æ‰§è¡ŒèŒƒå›´æŸ¥è¯¢æ—¶ï¼Œå¦‚ä½¿ç”¨ <code>&lt;</code>ã€<code>&lt;=</code>ã€<code>&gt;</code>ã€<code>&gt;=</code> ç­‰æ“ä½œç¬¦ï¼ŒInnoDB å¼•æ“ä¼šä¸ºæŸ¥è¯¢æ¶‰åŠåˆ°çš„èŒƒå›´åŠ ä¸Š NEXT-KEY é”ã€‚è¿™ä¸ª NEXT-KEY é”åŒ…å«ä¸¤éƒ¨åˆ†ï¼š</p><ol><li>Gap é”ï¼šé”å®šäº†æŸ¥è¯¢èŒƒå›´å†…çš„é—´éš™ï¼ˆGapï¼‰ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡å‘è¯¥èŒƒå›´å†…æ’å…¥æ–°çš„è®°å½•ã€‚</li><li>è®°å½•é”ï¼šé”å®šäº†æ»¡è¶³æŸ¥è¯¢æ¡ä»¶çš„è®°å½•ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡å¯¹è¿™äº›è®°å½•è¿›è¡Œå¹¶å‘ä¿®æ”¹æˆ–åˆ é™¤ã€‚</li></ol><p>é€šè¿‡ä½¿ç”¨ NEXT-KEY é”ï¼ŒInnoDB å¯ä»¥æœ‰æ•ˆåœ°é¿å…å¹»è¯»ç°è±¡çš„å‘ç”Ÿã€‚å®ƒä¿è¯äº†åœ¨ä¸€ä¸ªäº‹åŠ¡è¯»å–ä¸€ä¸ªèŒƒå›´çš„æ•°æ®æ—¶ï¼Œ<strong>å…¶ä»–äº‹åŠ¡æ— æ³•å¹¶å‘åœ°åœ¨è¯¥èŒƒå›´å†…æ’å…¥æ–°çš„è®°å½•</strong>ï¼Œä»è€Œä¿è¯äº†è¯»å–çš„ä¸€è‡´æ€§ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒNEXT-KEY é”åªåœ¨äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸º<strong>å¯é‡å¤è¯»</strong>ï¼ˆREPEATABLE READï¼‰æˆ–æ›´é«˜çº§åˆ«æ—¶ä½¿ç”¨ï¼ˆMySQLé»˜è®¤éš”ç¦»çº§åˆ«ä¸ºå¯é‡å¤è¯»ï¼‰ã€‚åœ¨è¾ƒé«˜çš„å¹¶å‘ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨ NEXT-KEY é”å¯èƒ½ä¼šå¢åŠ é”å†²çªçš„æ¦‚ç‡ï¼Œå› æ­¤åœ¨è®¾è®¡æ•°æ®åº“å’ŒæŸ¥è¯¢æ—¶éœ€è¦è€ƒè™‘åˆ°é”çš„å¼€é”€å’Œäº‹åŠ¡çš„éš”ç¦»çº§åˆ«ã€‚</p><h1 id="2-MySQLä¸­æœ‰å“ªäº›ä¸åŒçš„è¡¨æ ¼ï¼Ÿ"><a href="#2-MySQLä¸­æœ‰å“ªäº›ä¸åŒçš„è¡¨æ ¼ï¼Ÿ" class="headerlink" title="2.MySQLä¸­æœ‰å“ªäº›ä¸åŒçš„è¡¨æ ¼ï¼Ÿ"></a>2.MySQLä¸­æœ‰å“ªäº›ä¸åŒçš„è¡¨æ ¼ï¼Ÿ</h1><blockquote><p>è¿™ä¸ªä¹Ÿæ˜¯GPTå›ç­”çš„ï¼Œæ³¨æ„ï¼Œè¡¨æ ¼å’Œå­˜å‚¨å¼•æ“ä¸æ˜¯åŒä¸€ä¸ªæ¦‚å¿µï¼</p></blockquote><p>åœ¨MySQLä¸­ï¼Œæœ‰ä»¥ä¸‹å‡ ç§ä¸åŒçš„è¡¨æ ¼ç±»å‹ï¼š</p><ol><li>MyISAMï¼šMyISAMæ˜¯æ—§ç‰ˆæœ¬MySQLçš„é»˜è®¤è¡¨æ ¼ç±»å‹ã€‚å®ƒæä¾›äº†å¿«é€Ÿçš„è¯»å–é€Ÿåº¦ï¼Œé€‚ç”¨äºå¤§é‡çš„å¹¶å‘è¯»å–æ“ä½œã€‚ä¸è¿‡ï¼ŒMyISAMä¸æ”¯æŒäº‹åŠ¡å¤„ç†å’Œå´©æºƒæ¢å¤åŠŸèƒ½ã€‚</li><li>InnoDBï¼šInnoDBæ˜¯ä¸€ç§æ”¯æŒäº‹åŠ¡å¤„ç†å’Œå´©æºƒæ¢å¤åŠŸèƒ½çš„è¡¨æ ¼ç±»å‹ã€‚å®ƒæä¾›äº†è¡Œçº§é”å®šå’Œå¤–é”®çº¦æŸç­‰é«˜çº§åŠŸèƒ½ï¼Œé€‚ç”¨äºéœ€è¦æ•°æ®å®Œæ•´æ€§å’Œå¹¶å‘å†™å…¥æ“ä½œçš„åœºæ™¯ã€‚InnoDBæ˜¯<strong>MySQL 5.5ç‰ˆæœ¬å</strong>çš„é»˜è®¤è¡¨æ ¼ç±»å‹ã€‚</li><li>Memoryï¼šMemoryï¼ˆä¹Ÿç§°ä¸ºHeapï¼‰è¡¨æ ¼æ˜¯å°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ä¸´æ—¶è¡¨æ ¼ç±»å‹ã€‚å®ƒåœ¨è¯»å–å’Œå†™å…¥æ–¹é¢éå¸¸å¿«é€Ÿï¼Œä½†å®ƒçš„æ•°æ®æ˜¯ä¸´æ—¶çš„ï¼Œå½“æ•°æ®åº“æœåŠ¡å™¨é‡å¯æ—¶ï¼Œè¡¨æ ¼ä¸­çš„æ•°æ®å°†ä¼šä¸¢å¤±ã€‚</li><li>Archiveï¼šArchiveè¡¨æ ¼æ˜¯ä¸€ç§é«˜åº¦å‹ç¼©çš„è¡¨æ ¼ç±»å‹ï¼Œé€‚ç”¨äºå­˜å‚¨å¤§é‡å†å²æ•°æ®å’Œå½’æ¡£æ•°æ®ã€‚å®ƒå¯¹äºè¯»å–æ“ä½œä¸å¤ªæœ‰æ•ˆï¼Œä½†åœ¨å¤§é‡å†™å…¥å’Œå­˜å‚¨ç©ºé—´æ–¹é¢å…·æœ‰ä¼˜åŠ¿ã€‚</li><li>CSVï¼šCSVè¡¨æ ¼å…è®¸å°†æ•°æ®ä»¥CSVï¼ˆé€—å·åˆ†éš”å€¼ï¼‰æ ¼å¼å­˜å‚¨åœ¨æ–‡ä»¶ä¸­ï¼Œæ”¯æŒå¯¼å…¥å’Œå¯¼å‡ºæ•°æ®ã€‚å®ƒä¸æ”¯æŒç´¢å¼•ï¼Œäº‹åŠ¡å¤„ç†å’Œå…¶ä»–é«˜çº§ç‰¹æ€§ã€‚</li></ol><p>é™¤äº†ä»¥ä¸Šåˆ—ä¸¾çš„å‡ ç§å¸¸è§çš„è¡¨æ ¼ç±»å‹å¤–ï¼ŒMySQLè¿˜æ”¯æŒå…¶ä»–ä¸€äº›ç‰¹æ®Šç”¨é€”çš„è¡¨æ ¼ç±»å‹ï¼Œå¦‚Partitionedï¼ˆåˆ†åŒºè¡¨æ ¼ï¼‰å’ŒFederatedï¼ˆè”åˆè¡¨æ ¼ï¼‰ç­‰ã€‚</p><ul><li>è¡¨æ ¼å’Œå­˜å‚¨å¼•æ“æ˜¯åŒä¸€ä¸ªä¸œè¥¿å—ï¼Ÿå¹¶<strong>ä¸æ˜¯</strong>ï¼</li></ul><p>åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œè¡¨æ ¼ï¼ˆTableï¼‰æ˜¯æŒ‡ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ•°æ®ç»“æ„ï¼Œç”¨æ¥ç»„ç»‡å’Œå­˜å‚¨æ•°æ®ã€‚ä¸€å¼ è¡¨æ ¼ç”±è‹¥å¹²åˆ—ï¼ˆColumnï¼‰å’Œè‹¥å¹²è¡Œï¼ˆRowï¼‰ç»„æˆï¼Œæ¯åˆ—å®šä¹‰äº†ä¸€ç§æ•°æ®ç±»å‹å’Œä¸€ä¸ªå­—æ®µåï¼Œè¡¨æ ¼ä¸­çš„æ¯ä¸€è¡Œåˆ™ä»£è¡¨ä¸€ä¸ªå®ä½“æˆ–è®°å½•ï¼Œæ¯ä¸ªå•å…ƒæ ¼å­˜å‚¨ç€å¯¹åº”åˆ—çš„ä¸€ä¸ªæ•°å€¼æˆ–å­—ç¬¦ä¸²ã€‚</p><p>å­˜å‚¨å¼•æ“ï¼ˆStorage Engineï¼‰åˆ™æ˜¯æŒ‡å®ç°äº†æ•°æ®åº“çš„è¡¨æ ¼å’Œç´¢å¼•ç­‰åŠŸèƒ½çš„åº•å±‚è½¯ä»¶æ¨¡å—ï¼Œå®ƒè´Ÿè´£å°†è¡¨æ ¼æ•°æ®å­˜å‚¨åˆ°ç£ç›˜ã€è·Ÿè¸ªå¹¶å¤„ç†äº‹åŠ¡ã€æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ç­‰ä»»åŠ¡ã€‚ä¸åŒçš„å­˜å‚¨å¼•æ“å…·æœ‰å„è‡ªçš„ç‰¹ç‚¹å’Œä¼˜ç¼ºç‚¹ï¼Œåœ¨ä¸åŒåœºæ™¯ä¸‹é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“å¯ä»¥æé«˜æ•°æ®åº“çš„æ€§èƒ½å’Œå¯é æ€§ã€‚</p><h1 id="3-MyISAMå’ŒInnoDBçš„åŒºåˆ«ï¼Ÿ"><a href="#3-MyISAMå’ŒInnoDBçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="3.MyISAMå’ŒInnoDBçš„åŒºåˆ«ï¼Ÿ"></a>3.MyISAMå’ŒInnoDBçš„åŒºåˆ«ï¼Ÿ</h1><p>MyISAM</p><ul><li>ä¸æ”¯æŒäº‹åŠ¡ï¼›</li><li>é‡‡ç”¨éèšç°‡ç´¢å¼•ï¼Œæ™®é€šç´¢å¼•å’Œä¸»é”®ç´¢å¼•çš„å½¢å¼ç›¸åŒï¼›</li><li>ä¸€å¼ è¡¨åŒ…å«ä¸‰ä¸ªæœ¬åœ°æ–‡ä»¶ï¼›</li></ul><p>InnoDB</p><ul><li>æ”¯æŒäº‹åŠ¡ï¼›</li><li>é‡‡ç”¨èšç°‡ç´¢å¼•ï¼Œæ™®é€šç´¢å¼•å­˜æ”¾çš„æ˜¯ä¸»é”®ç´¢å¼•ä¸­çš„keyå€¼ï¼Œéœ€è¦å›è¡¨æŸ¥è¯¢ï¼›å¯ä»¥ç”¨ç´¢å¼•è¦†ç›–æ¥ä¼˜åŒ–ï¼›</li><li>ä¸€å¼ è¡¨åŒ…å«ä¸¤ä¸ªæœ¬åœ°æ–‡ä»¶ï¼›</li></ul><h1 id="4-InnoDBæ”¯æŒçš„å››ç§äº‹åŠ¡éš”ç¦»çº§åˆ«å’ŒåŒºåˆ«"><a href="#4-InnoDBæ”¯æŒçš„å››ç§äº‹åŠ¡éš”ç¦»çº§åˆ«å’ŒåŒºåˆ«" class="headerlink" title="4.InnoDBæ”¯æŒçš„å››ç§äº‹åŠ¡éš”ç¦»çº§åˆ«å’ŒåŒºåˆ«"></a>4.InnoDBæ”¯æŒçš„å››ç§äº‹åŠ¡éš”ç¦»çº§åˆ«å’ŒåŒºåˆ«</h1><p>å››ç§éš”ç¦»çº§åˆ«ï¼šè¯»æœªæäº¤ï¼Œè¯»å·²æäº¤ï¼Œå¯é‡å¤è¯»ï¼Œä¸²è¡ŒåŒ–ï¼›</p><p>è¿™éƒ¨åˆ†ç›´æ¥å»çœ‹æˆ‘çš„<a href="https://blog.musnow.top/posts/3474107655/">MySQLç´¢å¼•</a>åšå®¢ï¼Œé‡Œé¢è¯¦ç»†ä»‹ç»äº†åŒºåˆ«ï¼Œè¿™é‡Œå°±ä¸é‡å†™ä¸€éäº†ï¼›</p><h1 id="5-CHARå’ŒVARCHARçš„åŒºåˆ«"><a href="#5-CHARå’ŒVARCHARçš„åŒºåˆ«" class="headerlink" title="5.CHARå’ŒVARCHARçš„åŒºåˆ«"></a>5.CHARå’ŒVARCHARçš„åŒºåˆ«</h1><ul><li>charæ˜¯å®šé•¿å­—ç¬¦ä¸²ï¼Œæœ€é•¿255ï¼›varcharæ˜¯å˜é•¿å­—ç¬¦ä¸²ï¼Œæœ€é•¿65535ï¼›</li><li>è¿™å°±æ„å‘³ç€varcharéœ€è¦æ›´å¤šç©ºé—´æ¥å­˜æ”¾å½“å‰å­—ç¬¦ä¸²é•¿åº¦ç­‰ä¿¡æ¯ï¼Œå¹¶ä¸”ä¼šæ ¹æ®å½“å‰å­—ç¬¦ä¸²é•¿åº¦åŠ¨æ€å¼€è¾Ÿç©ºé—´å¤§å°ï¼Œä¸ä¼šæœ‰é¢å¤–çš„å­˜å‚¨ç©ºé—´æµªè´¹ï¼›</li><li>è€Œcharæ˜¯å®šæ­»çš„ç©ºé—´ï¼Œ<code>char(8)</code>é‡Œé¢å³ä¾¿åªæœ‰ä¸€ä¸ªå­—ç¬¦ä¹Ÿä¼šå ç”¨å…«ä¸ªçš„ç©ºé—´ï¼ˆä¼šç”¨ç©ºæ ¼è¿›è¡Œè¡¥é½ï¼‰ï¼›</li><li>åœ¨å­—ç¬¦ä¸²é•¿åº¦ç¡®å®šçš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚è®¡ç®—é•¿åº¦ç¡®å®šçš„MD5ï¼Œé‚£å°±å¯ä»¥ç”¨charå®šé•¿å­˜å‚¨ï¼›é•¿åº¦ä¸ç¡®å®šçš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚äººåã€é‚®ç®±ç­‰ä¿¡æ¯ï¼Œå¯ä»¥é‡‡ç”¨varcharï¼›</li></ul><p>é¡ºå¸¦è¯´ä¸€ä¸‹varcharå’Œtextçš„åŒºåˆ«ï¼›éœ€è¦è¿›è¡Œç´¢å¼•çš„é•¿æ–‡å¯ä»¥ç”¨TEXTè¿›è¡Œå­˜å‚¨ï¼ˆæ³¨æ„ï¼Œåªæœ‰MyISAMæ”¯æŒå…¨æ–‡ç´¢å¼•ï¼‰</p><ol><li>å­˜å‚¨ç©ºé—´ï¼šVARCHARåˆ—å­˜å‚¨çš„å†…å®¹é•¿åº¦æ˜¯å¯å˜çš„ï¼Œè€ŒTEXTåˆ—å¯ä»¥å­˜å‚¨å¤§é‡çš„å¯å˜é•¿åº¦çš„æ–‡æœ¬æ•°æ®ã€‚VARCHARåœ¨å­˜å‚¨æ—¶ä¼šæ ¹æ®å®é™…å­˜å‚¨çš„å†…å®¹é•¿åº¦è¿›è¡Œè°ƒæ•´ï¼Œè€ŒTEXTæ²¡æœ‰å›ºå®šçš„æœ€å¤§é•¿åº¦é™åˆ¶ï¼Œå¯ä»¥ç”¨æ¥å­˜å‚¨éå¸¸é•¿çš„æ–‡æœ¬ã€‚ç”±äºTEXTå¯ä»¥å­˜å‚¨æ›´å¤§çš„æ•°æ®é‡ï¼Œå› æ­¤å®ƒé€šå¸¸å ç”¨æ›´å¤šçš„å­˜å‚¨ç©ºé—´ã€‚</li><li>æŸ¥è¯¢æ€§èƒ½ï¼šç”±äºVARCHARå…·æœ‰å›ºå®šçš„æœ€å¤§é•¿åº¦é™åˆ¶ï¼Œæ•°æ®åº“å¯ä»¥æ›´å¥½åœ°ä¼˜åŒ–å’Œç®¡ç†å­˜å‚¨ç©ºé—´ï¼Œè¿™å¯èƒ½ä¼šåœ¨æŸäº›æƒ…å†µä¸‹æå‡æŸ¥è¯¢æ€§èƒ½ã€‚è€ŒTEXTç”±äºå…¶å¯å˜é•¿åº¦å’Œå¤§å®¹é‡ï¼Œå¯èƒ½ä¼šå¯¹æŸäº›æŸ¥è¯¢æ“ä½œç¨æœ‰å½±å“ã€‚</li><li>ç´¢å¼•å’Œæ’åºï¼šVARCHARå¯ä»¥è¢«ç´¢å¼•å’Œæ’åºï¼Œè¿™æ„å‘³ç€å¯ä»¥æ ¹æ®è¿™äº›åˆ—è¿›è¡Œå¿«é€Ÿæœç´¢å’Œæ’åºæ“ä½œã€‚è€ŒTEXTç±»å‹é€šå¸¸ä¸ç›´æ¥æ”¯æŒç´¢å¼•å’Œæ’åºï¼Œéœ€è¦é¢å¤–çš„é…ç½®å’Œå¤„ç†æ‰èƒ½å®ç°ç±»ä¼¼çš„åŠŸèƒ½ã€‚</li></ol><p>å¦‚ä¸‹user1è¡¨åšæµ‹è¯•ï¼Œä¼šå‘ç°æˆ‘ä»¬æ— æ³•ç»™TEXTç±»å‹ä¸Šæ™®é€šç´¢å¼•ã€‚ç»™å‡ºçš„æç¤ºæ˜¯ï¼Œ<code>BLOG/TEXT</code>ç±»å‹ä¸èƒ½åœ¨æ²¡æœ‰æŒ‡å®šé•¿åº¦çš„æ—¶å€™ä¸Šç´¢å¼•ï¼›å› ä¸ºä½ çš„é•¿åº¦ä¸ç¡®å®šï¼Œå¦‚æœMySQLå°†ä¸€ä¸ªå‡ ä¸‡å­—çš„TEXTå­˜åˆ°å†…å­˜é‡Œé¢ä½œä¸ºç´¢å¼•èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå°±ä¼šå ç”¨è¿‡å¤šçš„å†…å­˜ç©ºé—´ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello_mysql]&gt; desc user1;</span><br><span class="line">+-------+------------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type             | Null | Key | Default | Extra |</span><br><span class="line">+-------+------------------+------+-----+---------+-------+</span><br><span class="line">| id    | int(10) unsigned | NO   | PRI | NULL    |       |</span><br><span class="line">| name  | varchar(200)     | NO   |     | NULL    |       |</span><br><span class="line">| info  | text             | NO   |     | NULL    |       |</span><br><span class="line">+-------+------------------+------+-----+---------+-------+</span><br><span class="line">3 rows in set (0.001 sec)</span><br><span class="line">MariaDB [hello_mysql]&gt; alter table user1 add index(info);</span><br><span class="line">ERROR 1170 (42000): BLOB/TEXT column &#x27;info&#x27; used in key specification without a key length</span><br></pre></td></tr></table></figure><p>å³ä¾¿åœ¨åˆ›å»ºåˆ—çš„æ—¶å€™ç»™å®šäº†TEXTçš„é•¿åº¦ï¼Œä¾æ—§ä¸èƒ½åˆ›å»ºç´¢å¼•ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello_mysql]&gt; alter table user1 add info1 TEXT(20) NOT NULL;</span><br><span class="line">Query OK, 0 rows affected (0.002 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [hello_mysql]&gt; desc user1;</span><br><span class="line">+-------+------------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type             | Null | Key | Default | Extra |</span><br><span class="line">+-------+------------------+------+-----+---------+-------+</span><br><span class="line">| id    | int(10) unsigned | NO   | PRI | NULL    |       |</span><br><span class="line">| name  | varchar(200)     | NO   |     | NULL    |       |</span><br><span class="line">| info  | text             | NO   |     | NULL    |       |</span><br><span class="line">| info1 | tinytext         | NO   |     | NULL    |       |</span><br><span class="line">+-------+------------------+------+-----+---------+-------+</span><br><span class="line">4 rows in set (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello_mysql]&gt; alter table user1 add index(info1);</span><br><span class="line">ERROR 1170 (42000): BLOB/TEXT column &#x27;info1&#x27; used in key specification without a key length</span><br></pre></td></tr></table></figure><p>æ­£ç¡®çš„å†™æ³•å¦‚ä¸‹ï¼Œéœ€è¦åœ¨åˆ›å»ºç´¢å¼•çš„æ—¶å€™ï¼Œæ‹¬å·æŒ‡å®šç´¢å¼•çš„é•¿åº¦ï¼›æ¯”å¦‚<code>index(info1(10))</code>å«ä¹‰å°±æ˜¯ç»™info1åˆ—çš„å‰10ä¸ªå­—ç¬¦å»ºç«‹ç´¢å¼•ã€‚åªè¦TEXTé‡Œé¢å­˜æ”¾çš„æ–‡æœ¬å‰10ä¸ªå­—ç¬¦é‡å¤ç‡ä½ï¼Œé‚£ä¹ˆè¿™ä¸ªç´¢å¼•å°±æ˜¯æœ‰æ„ä¹‰çš„ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello_mysql]&gt; alter table user1 add index(info1(10));</span><br><span class="line">Query OK, 0 rows affected (0.007 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure><h1 id="6-ä¸»é”®å’Œå€™é€‰é”®-ç -æœ‰å•¥åŒºåˆ«ï¼Ÿ"><a href="#6-ä¸»é”®å’Œå€™é€‰é”®-ç -æœ‰å•¥åŒºåˆ«ï¼Ÿ" class="headerlink" title="6.ä¸»é”®å’Œå€™é€‰é”®(ç )æœ‰å•¥åŒºåˆ«ï¼Ÿ"></a>6.ä¸»é”®å’Œå€™é€‰é”®(ç )æœ‰å•¥åŒºåˆ«ï¼Ÿ</h1><p>å€™é€‰é”®æ˜¯ä¸€äº›å¯ä»¥é€‰ç”¨ï¼ˆå¤‡é€‰ï¼‰ä¸ºä¸»é”®æˆ–è€…å”¯ä¸€é”®çš„ç±»å‹ï¼›</p><p>æ¯”å¦‚ä¸€ä¸ªå­¦ç”Ÿè¡¨é‡Œé¢ï¼ŒåŒ…å«å­¦ç”Ÿä¸»é”®çš„INTè‡ªå¢IDï¼Œå­¦ç”Ÿå­¦å·ï¼Œå­¦ç”Ÿèº«ä»½è¯ï¼Œå­¦ç”Ÿå§“åï¼Œå­¦ç”Ÿæ€§åˆ«ç­‰ç­‰ä¿¡æ¯ï¼›åœ¨è¿™ä¸ªè¡¨é‡Œé¢ï¼Œé™¤äº†ä¸»é”®è¿™ä¸ªINTçš„IDï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æŠŠå­¦ç”Ÿçš„å­¦å·å’Œå­¦ç”Ÿçš„èº«ä»½è¯ä½œä¸ºä¸»é”®æˆ–è€…å”¯ä¸€é”®ï¼Œå› ä¸ºä»–ä»¬éƒ½åŒ…å«å”¯ä¸€æ€§ï¼</p><p>è¿™æ—¶å€™ï¼Œè¿™äº›å¯ä»¥ä½œä¸ºä¸»é”®çš„åˆ—ï¼Œå°±å«åšå€™é€‰é”®ï¼›</p><ul><li>å€™é€‰é”®ä¹Ÿéœ€è¦ä¿æŒå”¯ä¸€æ€§</li><li>å€™é€‰é”®éœ€è¦éµå¾ªæœ€å°åŸåˆ™ï¼Œä¸èƒ½æ˜¯æŸä¸€ä¸ªèšåˆå”¯ä¸€æ ‡è¯†çš„å­é›†ï¼›ï¼ˆæ¯”å¦‚æˆ‘éœ€è¦ç”¨<strong>éƒ¨é—¨IDå’Œéƒ¨é—¨å†…å‘˜å·¥ID</strong>æ¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªå‘˜å·¥ï¼Œæ­¤æ—¶éƒ¨é—¨IDå°±ä¸èƒ½ä½œä¸ºè¿™ä¸ªå‘˜å·¥è¡¨çš„å€™é€‰é”®ï¼Œå› ä¸ºåœ¨æ•´ä¸ªè¡¨ä¸­éƒ¨é—¨IDä¼šé‡å¤ï¼‰</li></ul><p>åœ¨ã€Šæ•°æ®åº“ç³»ç»Ÿæ¦‚ç‡ã€‹è¿™é—¨è¯¾é‡Œé¢ï¼Œä¼šæŠŠé”®ç§°ä½œä¸ºç ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚</p><blockquote><p>åˆ°åº•æ˜¯è°æŠŠkeyç¿»è¯‘æˆç çš„ï¼ŸçœŸæ— è¯­ğŸ˜’</p></blockquote><h1 id="7-myisamchkæ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„"><a href="#7-myisamchkæ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„" class="headerlink" title="7.myisamchkæ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„"></a>7.myisamchkæ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„</h1><p>ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼ˆåœ¨bashä¸‹ä½¿ç”¨ï¼Œä¸æ˜¯åœ¨MySQLå‘½ä»¤è¡Œä½¿ç”¨ï¼‰</p><blockquote><p>Myisamchkæ˜¯MyISAMè¡¨ç»´æŠ¤çš„ä¸€ä¸ªéå¸¸å®ç”¨çš„å·¥å…·ã€‚å¯ä»¥ä½¿ç”¨myisamchkå®ç”¨ç¨‹åºæ¥è·å¾—æœ‰å…³æ•°æ®åº“è¡¨çš„ä¿¡æ¯æˆ–æ£€æŸ¥ã€ä¿®å¤ã€ä¼˜åŒ–ä»–ä»¬ã€‚myisamchké€‚ç”¨MyISAMè¡¨(å¯¹åº”.MYIå’Œ.MYDæ–‡ä»¶çš„è¡¨)ã€‚</p></blockquote><p>è¿™ä¸ªå‘½ä»¤äº†è§£å³å¯ï¼Œä¸‹é¢æ˜¯ä¸¤ç¯‡ä½¿ç”¨åšå®¢ã€‚æœ‰éœ€è¦å†å»æ·±å…¥å­¦ä¹ ç”¨æ³•</p><p><a href="http://www.4u4v.net/myisamchk-gadgets-manual.html">http://www.4u4v.net/myisamchk-gadgets-manual.html</a></p><p><a href="https://www.cnblogs.com/analyzer/articles/1381538.html">https://www.cnblogs.com/analyzer/articles/1381538.html</a></p><h1 id="8-å¦‚æœè¡¨ä¸­æœ‰ä¸€åˆ—å®šä¹‰ä¸ºTIMESTAMPä¼šå‘ç”Ÿä»€ä¹ˆ"><a href="#8-å¦‚æœè¡¨ä¸­æœ‰ä¸€åˆ—å®šä¹‰ä¸ºTIMESTAMPä¼šå‘ç”Ÿä»€ä¹ˆ" class="headerlink" title="8.å¦‚æœè¡¨ä¸­æœ‰ä¸€åˆ—å®šä¹‰ä¸ºTIMESTAMPä¼šå‘ç”Ÿä»€ä¹ˆ"></a>8.å¦‚æœè¡¨ä¸­æœ‰ä¸€åˆ—å®šä¹‰ä¸ºTIMESTAMPä¼šå‘ç”Ÿä»€ä¹ˆ</h1><p>TIMESTAMPåº•å±‚ä¸€èˆ¬æ˜¯4ä¸ªå­—èŠ‚ï¼Œåœ¨MySQLé‡Œé¢è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œä¼šæ ¹æ®ç³»ç»Ÿæ—¶åŒºï¼Œè½¬æˆå¯è¯»æ—¶é—´è¿›è¡Œè¾“å‡ºã€‚åŒ…æ‹¬ä½¿ç”¨cpp develåŒ…è·å–åˆ°çš„ä¹Ÿæ˜¯å¯è¯»æ—¶é—´ï¼›</p><p>å› ä¸ºåªæœ‰4ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥TIMESTAMPæœ€å¤šèƒ½è¡¨ç¤º <code>1970-01-01 00:00:01</code>åˆ°<code>2038-01-19 03:14:07</code>ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ª2038å¹´é—®é¢˜ï¼Œéœ€è¦æ”¹æˆ8å­—èŠ‚å­˜å‚¨æ‰èƒ½å­˜æ”¾æ›´é•¿çš„æ—¶é—´ã€‚</p><p>å¦å¤–ï¼Œå¦‚æœä½ æƒ³æ›´åŠ ç²¾ç¡®çš„æ ‡è¯†æ—¶é—´ï¼Œè€Œä¸ä¾èµ–äºMySQLå¯¹æ—¶é—´æˆ³çš„è‡ªåŠ¨è½¬æ¢ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨BIGINTæˆ–è€…DECIMALç±»å‹æ¥å­˜æ”¾æ—¶é—´æˆ³æ•°å­—ï¼Œå†åœ¨åº”ç”¨å±‚è¿›è¡Œæ—¶é—´æˆ³å’Œå¯è¯»æ—¶é—´ä¹‹é—´çš„è½¬æ¢ã€‚</p><h1 id="9-æ€ä¹ˆçœ‹åˆ°è¡¨æ ¼å®šä¹‰çš„æ‰€æœ‰ç´¢å¼•"><a href="#9-æ€ä¹ˆçœ‹åˆ°è¡¨æ ¼å®šä¹‰çš„æ‰€æœ‰ç´¢å¼•" class="headerlink" title="9.æ€ä¹ˆçœ‹åˆ°è¡¨æ ¼å®šä¹‰çš„æ‰€æœ‰ç´¢å¼•"></a>9.æ€ä¹ˆçœ‹åˆ°è¡¨æ ¼å®šä¹‰çš„æ‰€æœ‰ç´¢å¼•</h1><p>ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> è¡¨å;</span><br><span class="line"><span class="keyword">show</span> keys <span class="keyword">from</span> è¡¨å;</span><br></pre></td></tr></table></figure><h1 id="10-LIKEå£°æ˜ä¸­çš„-æ˜¯ä»€ä¹ˆæ„æ€"><a href="#10-LIKEå£°æ˜ä¸­çš„-æ˜¯ä»€ä¹ˆæ„æ€" class="headerlink" title="10.LIKEå£°æ˜ä¸­çš„%æ˜¯ä»€ä¹ˆæ„æ€"></a>10.LIKEå£°æ˜ä¸­çš„%æ˜¯ä»€ä¹ˆæ„æ€</h1><p>ä»£è¡¨é€šé…ç¬¦ï¼ŒåŒ¹é…æ‰€æœ‰å­—ç¬¦ä¸²ã€‚ä¸‹é¢ä¸¾å‡ ä¸ªä¾‹å­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥è¯¢ &#x27;å¼ %&#x27;</span><br><span class="line">    å¼ ä¸½ä¸½</span><br><span class="line">    å¼ æ‰£æ‰£</span><br><span class="line">    å¼ ä¸‰</span><br><span class="line">    å¼ é˜¿æ–¯é¡¿</span><br><span class="line"></span><br><span class="line">æŸ¥è¯¢ &#x27;%å¼ %&#x27;</span><br><span class="line">é‡Œå¼ é‡Œ</span><br><span class="line">    åå¤§å¼ æ’’æ‰“å‘</span><br><span class="line"></span><br><span class="line">æŸ¥è¯¢ &#x27;%å¼ &#x27;</span><br><span class="line">xxå¼ </span><br><span class="line">xxxxxå¼ </span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„ï¼Œåªæœ‰<code>å…³é”®å­—%</code>çš„ä½¿ç”¨æ–¹å¼æ‰èƒ½ç”¨ä¸Šç´¢å¼•ï¼Œå¦å¤–ä¸¤ç§åŒ¹é…æ–¹å¼æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼</p><h1 id="11-åˆ—å¯¹æ¯”è¿ç®—ç¬¦æ˜¯ä»€ä¹ˆ"><a href="#11-åˆ—å¯¹æ¯”è¿ç®—ç¬¦æ˜¯ä»€ä¹ˆ" class="headerlink" title="11.åˆ—å¯¹æ¯”è¿ç®—ç¬¦æ˜¯ä»€ä¹ˆ"></a>11.åˆ—å¯¹æ¯”è¿ç®—ç¬¦æ˜¯ä»€ä¹ˆ</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ç­‰äº =</span><br><span class="line">ä¸ç­‰äº &lt;&gt; !=</span><br><span class="line">å¤§äºå’Œå¤§äºç­‰äº  &gt; &gt;=</span><br><span class="line">å°äºå’Œå°äºç­‰äº  &lt; &lt;=</span><br><span class="line">åŒºé—´ BETWEEN .. AND ...</span><br><span class="line">æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ IN</span><br><span class="line">æ¨¡ç³ŠåŒ¹é… LIKE</span><br><span class="line">NULLæ¯”è¾ƒ IS NULL, IS NOT NULL</span><br></pre></td></tr></table></figure><h1 id="12-BLOBå’ŒTEXTæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#12-BLOBå’ŒTEXTæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="12.BLOBå’ŒTEXTæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>12.BLOBå’ŒTEXTæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h1><p>GPTè¯´çš„ï¼š</p><ol><li>å­˜å‚¨å®¹é‡ï¼šBLOBå¯ä»¥å­˜å‚¨äºŒè¿›åˆ¶æ•°æ®ï¼Œè€ŒTEXTåªèƒ½å­˜å‚¨çº¯æ–‡æœ¬æ•°æ®ã€‚</li><li>å­—ç¬¦é›†æ’åºè§„åˆ™ï¼šBLOBæ²¡æœ‰å­—ç¬¦é›†æ’åºè§„åˆ™ï¼Œè€ŒTEXTæœ‰ï¼Œé»˜è®¤ä¸ºå­—ç¬¦é›†çš„æ’åºè§„åˆ™ã€‚</li><li>æ•°æ®æ’åºå’Œæ¯”è¾ƒï¼šBLOBä¼šæŒ‰äºŒè¿›åˆ¶æ–¹å¼è¿›è¡Œæ’åºå’Œæ¯”è¾ƒï¼Œè€ŒTEXTä¼šæŒ‰å­—ç¬¦æ’åºè§„åˆ™è¿›è¡Œæ’åºå’Œæ¯”è¾ƒã€‚</li><li>å­˜å‚¨æ–¹å¼ï¼šBLOBæ•°æ®ä»¥äºŒè¿›åˆ¶å½¢å¼å­˜å‚¨ï¼Œæ²¡æœ‰å­—ç¬¦é›†è½¬æ¢ï¼›è€ŒTEXTæ•°æ®ä¼šæ ¹æ®å­—ç¬¦é›†è¿›è¡Œè½¬æ¢å’Œå­˜å‚¨ã€‚</li><li>ç´¢å¼•ï¼šåœ¨MySQLä¸­ï¼ŒBLOBå’ŒTEXTåˆ—å¯ä»¥æœ‰ç´¢å¼•ï¼Œä½†æœ‰ä¸€äº›é™åˆ¶ã€‚BLOBåˆ—æˆ–å‰ç¼€ç´¢å¼•çš„æœ€å¤§é•¿åº¦æ˜¯768å­—èŠ‚ï¼Œå¯¹äºUTF-8å­—ç¬¦é›†æ˜¯255ä¸ªå­—ç¬¦ã€‚è€ŒTEXTåˆ—æˆ–å‰ç¼€ç´¢å¼•çš„æœ€å¤§é•¿åº¦æ˜¯3072å­—èŠ‚ï¼Œåœ¨UTF-8å­—ç¬¦é›†ä¸­æ˜¯1024ä¸ªå­—ç¬¦ã€‚</li><li>é»˜è®¤å€¼ï¼šBLOBå’ŒTEXTåˆ—ä¸èƒ½å…·æœ‰é»˜è®¤å€¼ã€‚</li></ol><p>æ€»çš„æ¥è¯´ï¼ŒBLOBé€‚åˆå­˜å‚¨äºŒè¿›åˆ¶æ•°æ®ï¼Œä¾‹å¦‚å›¾åƒã€éŸ³é¢‘æˆ–è§†é¢‘æ–‡ä»¶ç­‰ã€‚è€ŒTEXTé€‚åˆå­˜å‚¨çº¯æ–‡æœ¬æ•°æ®ï¼Œå¦‚é•¿æ–‡æœ¬ã€æ–‡ç« å†…å®¹ç­‰ã€‚æ ¹æ®å…·ä½“çš„éœ€æ±‚ï¼Œä½ å¯ä»¥é€‰æ‹©é€‚å½“çš„æ•°æ®ç±»å‹æ¥å­˜å‚¨ç›¸åº”çš„æ•°æ®ã€‚</p><blockquote><p>å®é™…ä¸Šï¼ŒæŠŠå›¾ç‰‡ã€éŸ³é¢‘è¿™äº›é™æ€èµ„æºå­˜å…¥æ•°æ®åº“æ˜¯ä¸åˆç†çš„â€¦â€¦</p></blockquote><h1 id="13-MySQL-fetch-arrayå’ŒMySQL-fetch-objæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#13-MySQL-fetch-arrayå’ŒMySQL-fetch-objæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="13.MySQL_fetch_arrayå’ŒMySQL_fetch_objæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>13.MySQL_fetch_arrayå’ŒMySQL_fetch_objæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h1><p>PHPé‡Œé¢çš„å‡½æ•°ï¼Œä¸å­¦ï¼Œç›´æ¥è·³è¿‡</p><h1 id="14-MyISAMè¡¨æ ¼å°†åœ¨é‚£é‡Œå­˜å‚¨ï¼Ÿå¹¶ä¸”è¿˜æä¾›å…¶å­˜å‚¨æ ¼å¼ï¼Ÿ"><a href="#14-MyISAMè¡¨æ ¼å°†åœ¨é‚£é‡Œå­˜å‚¨ï¼Ÿå¹¶ä¸”è¿˜æä¾›å…¶å­˜å‚¨æ ¼å¼ï¼Ÿ" class="headerlink" title="14.MyISAMè¡¨æ ¼å°†åœ¨é‚£é‡Œå­˜å‚¨ï¼Ÿå¹¶ä¸”è¿˜æä¾›å…¶å­˜å‚¨æ ¼å¼ï¼Ÿ"></a>14.MyISAMè¡¨æ ¼å°†åœ¨é‚£é‡Œå­˜å‚¨ï¼Ÿå¹¶ä¸”è¿˜æä¾›å…¶å­˜å‚¨æ ¼å¼ï¼Ÿ</h1><p>åœ¨linuxä¸‹ï¼ŒMyISAMè¡¨æ ¼ä»¥æ–‡ä»¶å½¢å¼å­˜å‚¨åœ¨æ•°æ®ç›®å½•ä¸‹çš„å¯¹åº”æ•°æ®åº“ç›®å½•ä¸­ã€‚æ¯ä¸ªè¡¨æ ¼å¯¹åº”ä¸€ä¸ª.MYDæ•°æ®æ–‡ä»¶ï¼ˆç”¨äºå­˜å‚¨è¡¨æ ¼æ•°æ®ï¼‰å’Œä¸€ä¸ª.MYIç´¢å¼•æ–‡ä»¶ï¼ˆç”¨äºå­˜å‚¨è¡¨æ ¼ç´¢å¼•ï¼‰ï¼Œä»¥åŠä¸€ä¸ª.frmè¡¨æ ¼å®šä¹‰æ–‡ä»¶ï¼ˆåŒ…å«è¡¨æ ¼å®šä¹‰ä¿¡æ¯ï¼Œå¦‚å­—æ®µåã€æ•°æ®ç±»å‹ç­‰ï¼‰</p><p>MyISAMä½¿ç”¨ä¸€ç§ç§°ä¸ºâ€œé™æ€è¡Œæ ¼å¼â€çš„å­˜å‚¨æ ¼å¼æ¥å­˜å‚¨è¡¨æ ¼æ•°æ®ã€‚è¿™ç§æ ¼å¼ç”¨äºåœ¨ç£ç›˜ä¸Šä¿å­˜ç”±å®šé•¿è¡Œç»„æˆçš„è¡¨æ ¼ï¼Œæ¯ä¸ªè¡Œå®šé•¿ï¼Œå ç”¨ç›¸åŒçš„å­˜å‚¨ç©ºé—´ï¼Œä»¥ä¾¿æ›´å¿«åœ°è¯»å–å’Œå†™å…¥æ•°æ®ã€‚MyISAMè¡¨æ ¼è¿˜æ”¯æŒåŠ¨æ€è¡Œæ ¼å¼ï¼Œè¿™ç§æ ¼å¼å…è®¸å¯å˜è¡Œé•¿åº¦ï¼Œå› æ­¤å¯ä»¥æ›´æœ‰æ•ˆåœ°å­˜å‚¨å¯å˜é•¿åº¦çš„æ•°æ®ç±»å‹ï¼ˆå¦‚VARCHARï¼ŒTEXTç­‰ï¼‰ã€‚</p><h1 id="15-MySQLå¦‚ä½•ä¼˜åŒ–DISTINCT"><a href="#15-MySQLå¦‚ä½•ä¼˜åŒ–DISTINCT" class="headerlink" title="15.MySQLå¦‚ä½•ä¼˜åŒ–DISTINCT?"></a>15.MySQLå¦‚ä½•ä¼˜åŒ–DISTINCT?</h1><p>ä½¿ç”¨ç´¢å¼•ï¼Œå‡å°‘æŸ¥è¯¢è¡Œæ•°æ¥ä¼˜åŒ–å»é‡æ“ä½œ</p><h1 id="16-å¦‚ä½•æ˜¾ç¤ºå‰50è¡Œï¼Ÿ"><a href="#16-å¦‚ä½•æ˜¾ç¤ºå‰50è¡Œï¼Ÿ" class="headerlink" title="16.å¦‚ä½•æ˜¾ç¤ºå‰50è¡Œï¼Ÿ"></a>16.å¦‚ä½•æ˜¾ç¤ºå‰50è¡Œï¼Ÿ</h1><p>æŸ¥è¯¢è¯­å¥åå¸¦ä¸Šlimitå°±å¯ä»¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> è¡¨å limit <span class="number">50</span>;</span><br></pre></td></tr></table></figure><h1 id="17-å¯ä»¥ä½¿ç”¨å¤šå°‘åˆ—åˆ›å»ºç´¢å¼•ï¼Ÿ"><a href="#17-å¯ä»¥ä½¿ç”¨å¤šå°‘åˆ—åˆ›å»ºç´¢å¼•ï¼Ÿ" class="headerlink" title="17.å¯ä»¥ä½¿ç”¨å¤šå°‘åˆ—åˆ›å»ºç´¢å¼•ï¼Ÿ"></a>17.å¯ä»¥ä½¿ç”¨å¤šå°‘åˆ—åˆ›å»ºç´¢å¼•ï¼Ÿ</h1><p>æ ¹æ®å®é™…ä½¿ç”¨åœºæ™¯æ¥ç¡®å®šç”¨å‡ åˆ—ï¼Œå¹¶æ²¡æœ‰å›ºå®šé™åˆ¶ã€‚ç†è®ºä¸Šæ¥è¯´éœ€è¦ä¿æŒæœ€å°åŸåˆ™ï¼Œä¸è¦åŒ…å«å¤šä½™çš„æ— æ•ˆåˆ—ï¼ˆé™¤éä½ éœ€è¦ç”¨æ¥è¿›è¡Œç´¢å¼•ä¼˜åŒ–ï¼Œå‡å°‘å›è¡¨æ“ä½œï¼‰</p><h1 id="18-nowå’Œcurrent-dateæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#18-nowå’Œcurrent-dateæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="18.nowå’Œcurrent_dateæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>18.nowå’Œcurrent_dateæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h1><p>nowä¼šè¿”å›ä¸€ç›´åˆ°æ—¶åˆ†ç§’çš„ä¿¡æ¯ï¼Œcurrent_dateåªä¼šè¿”å›å½“æ—¥æ—¥æœŸ</p><h1 id="19-ä»€ä¹ˆæ˜¯éæ ‡å‡†å­—ç¬¦ä¸²ç±»å‹"><a href="#19-ä»€ä¹ˆæ˜¯éæ ‡å‡†å­—ç¬¦ä¸²ç±»å‹" class="headerlink" title="19.ä»€ä¹ˆæ˜¯éæ ‡å‡†å­—ç¬¦ä¸²ç±»å‹"></a>19.ä»€ä¹ˆæ˜¯éæ ‡å‡†å­—ç¬¦ä¸²ç±»å‹</h1><blockquote><p>GPT</p></blockquote><p>éæ ‡å‡†å­—ç¬¦ä¸²ç±»å‹æ˜¯æŒ‡åœ¨æ•°æ®åº“ä¸­æ²¡æœ‰æ˜ç¡®å®šä¹‰æˆ–æ ‡å‡†åŒ–çš„å­—ç¬¦ä¸²æ•°æ®ç±»å‹ã€‚è¿™äº›ç±»å‹é€šå¸¸æ˜¯ç‰¹å®šæ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰æˆ–åº”ç”¨ç¨‹åºå¼€å‘æ¡†æ¶æ‰€æ”¯æŒçš„æ‰©å±•ã€‚ç”±äºä¸åŒçš„DBMSå’Œæ¡†æ¶æœ‰å„è‡ªçš„ç‰¹æ€§å’Œéœ€æ±‚ï¼Œå¯èƒ½ä¼šå¼•å…¥é¢å¤–çš„éæ ‡å‡†å­—ç¬¦ä¸²ç±»å‹ä»¥æ»¡è¶³ç‰¹å®šçš„æ•°æ®å­˜å‚¨å’Œæ“ä½œéœ€æ±‚ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼ŒMySQLæ•°æ®åº“åœ¨å…¶æ ‡å‡†å­—ç¬¦ä¸²ç±»å‹ä¸­åŒ…å«äº†CHARã€VARCHARã€TEXTç­‰ã€‚è€Œéæ ‡å‡†å­—ç¬¦ä¸²ç±»å‹å¯èƒ½æ˜¯æ ¹æ®å…·ä½“éœ€æ±‚å’Œæ‰©å±•å¼€å‘çš„ï¼Œå¦‚JSONã€XMLã€BLOBã€CLOBç­‰ã€‚è¿™äº›éæ ‡å‡†ç±»å‹åœ¨ä¸€äº›ç‰¹å®šåœºæ™¯ä¸­ä½¿ç”¨å¹¿æ³›ï¼Œä¾‹å¦‚å­˜å‚¨éç»“æ„åŒ–çš„æ–‡æœ¬æ•°æ®ã€å¤§å‹äºŒè¿›åˆ¶æ•°æ®ã€ä»¥åŠå­˜å‚¨å’ŒæŸ¥è¯¢å¤æ‚çš„ç»“æ„åŒ–æ•°æ®ç­‰ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œéæ ‡å‡†å­—ç¬¦ä¸²ç±»å‹åœ¨ä¸åŒçš„DBMSå’Œå¼€å‘æ¡†æ¶ä¹‹é—´å¯èƒ½å­˜åœ¨å·®å¼‚ï¼Œå¹¶ä¸”åœ¨è·¨å¹³å°å’Œè¿ç§»æ—¶å¯èƒ½ä¼šå‡ºç°å…¼å®¹æ€§é—®é¢˜ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨éæ ‡å‡†å­—ç¬¦ä¸²ç±»å‹æ—¶ï¼Œå»ºè®®ä»”ç»†äº†è§£ç›¸å…³çš„æ–‡æ¡£å’Œè§„èŒƒï¼Œå¹¶è¯„ä¼°å…¶å¯¹åº”ç”¨ç¨‹åºçš„å½±å“å’Œå¯ç§»æ¤æ€§ã€‚</p><h1 id="20-ä»€ä¹ˆæ˜¯é€šç”¨SQLå‡½æ•°"><a href="#20-ä»€ä¹ˆæ˜¯é€šç”¨SQLå‡½æ•°" class="headerlink" title="20.ä»€ä¹ˆæ˜¯é€šç”¨SQLå‡½æ•°"></a>20.ä»€ä¹ˆæ˜¯é€šç”¨SQLå‡½æ•°</h1><p>ä»¥ä¸‹åˆ—ä¸¾äº†ä¸€äº›å¸¸è§çš„é€šç”¨SQLå‡½æ•°ï¼š</p><ol><li>èšåˆå‡½æ•°ï¼šå¦‚SUMã€AVGã€COUNTã€MINã€MAXç­‰ï¼Œç”¨äºå¯¹æ•°æ®è¿›è¡Œç»Ÿè®¡å’Œèšåˆè®¡ç®—ã€‚</li><li>å­—ç¬¦ä¸²å‡½æ•°ï¼šå¦‚CONCATã€SUBSTRINGã€UPPERã€LOWERã€LENGTHç­‰ï¼Œç”¨äºå¤„ç†å’Œæ“ä½œå­—ç¬¦ä¸²æ•°æ®ã€‚</li><li>æ•°å€¼å‡½æ•°ï¼šå¦‚ABSã€ROUNDã€CEILINGã€FLOORç­‰ï¼Œç”¨äºæ‰§è¡Œæ•°å€¼è®¡ç®—å’Œè½¬æ¢ã€‚</li><li>æ—¥æœŸå’Œæ—¶é—´å‡½æ•°ï¼šå¦‚DATE, TIME, YEAR, MONTH, DAYç­‰ï¼Œç”¨äºå¤„ç†æ—¥æœŸå’Œæ—¶é—´æ•°æ®çš„è®¡ç®—å’Œæ ¼å¼åŒ–ã€‚</li><li>æ¡ä»¶å‡½æ•°ï¼šå¦‚IF, CASE WHEN, COALESCEç­‰ï¼Œç”¨äºæ ¹æ®æ¡ä»¶æ‰§è¡Œä¸åŒçš„é€»è¾‘å’Œè¿”å›ä¸åŒçš„ç»“æœã€‚</li><li>ç±»å‹è½¬æ¢å‡½æ•°ï¼šå¦‚CASTã€CONVERTç­‰ï¼Œç”¨äºåœ¨ä¸åŒçš„æ•°æ®ç±»å‹ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚</li></ol><p>è¿™åªæ˜¯ä¸€å°éƒ¨åˆ†é€šç”¨SQLå‡½æ•°çš„ä¾‹å­ï¼Œå®é™…ä¸Šè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„å‡½æ•°å¯ç”¨äºä¸åŒçš„æ•°æ®å¤„ç†å’ŒæŸ¥è¯¢éœ€æ±‚ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡è¿™äº›å‡½æ•°åœ¨å¤§å¤šæ•°DBMSä¸­éƒ½å­˜åœ¨ï¼Œä½†æŸäº›ç‰¹å®šçš„DBMSå¯èƒ½ä¼šæä¾›é¢å¤–çš„å‡½æ•°æˆ–æœ‰ç¨å¾®ä¸åŒçš„è¯­æ³•ï¼Œå› æ­¤åœ¨ä½¿ç”¨å‡½æ•°æ—¶åº”æŸ¥é˜…ç›¸åº”çš„æ–‡æ¡£å’Œè§„èŒƒä»¥ç¡®ä¿å…¼å®¹æ€§å’Œæ­£ç¡®æ€§ã€‚</p><h1 id="21-MySQLæ”¯æŒäº‹åŠ¡å—ï¼Ÿ"><a href="#21-MySQLæ”¯æŒäº‹åŠ¡å—ï¼Ÿ" class="headerlink" title="21.MySQLæ”¯æŒäº‹åŠ¡å—ï¼Ÿ"></a>21.MySQLæ”¯æŒäº‹åŠ¡å—ï¼Ÿ</h1><p>è‚¯å®šæ”¯æŒï¼Œè¿™ä¸ªé—®é¢˜ç¬¬å››ç‚¹å°±å·²ç»è¯¦ç»†é—®äº†</p><h1 id="22-MySQLé‡Œé¢è®°å½•è´§å¸ç”¨ä»€ä¹ˆç±»å‹å¥½ï¼Ÿ"><a href="#22-MySQLé‡Œé¢è®°å½•è´§å¸ç”¨ä»€ä¹ˆç±»å‹å¥½ï¼Ÿ" class="headerlink" title="22.MySQLé‡Œé¢è®°å½•è´§å¸ç”¨ä»€ä¹ˆç±»å‹å¥½ï¼Ÿ"></a>22.MySQLé‡Œé¢è®°å½•è´§å¸ç”¨ä»€ä¹ˆç±»å‹å¥½ï¼Ÿ</h1><p>å› ä¸ºæµ®ç‚¹æ•°çš„ç²¾åº¦é—®é¢˜ï¼Œå¯ä»¥ç”¨BIGINTæ¥å­˜æ”¾ä»¥<strong>åˆ†</strong>ä¸ºå•ä½çš„è´§å¸ï¼Œå®é™…è°ƒç”¨çš„æ—¶å€™å†åŠ ä¸Šå°æ•°ç‚¹ï¼Œæ¥ä¿è¯æ•°æ®å‡†ç¡®ã€‚</p><p>å¦‚æœä¸ç”¨BIGINTï¼Œé‚£å°±éœ€è¦ç”¨DECIMALæ¥å­˜æ”¾è´§å¸ã€‚</p><blockquote><p>Bç«™å†²æµªçœ‹åˆ°çš„</p></blockquote><h1 id="23-MySQLæœ‰å…³æƒé™çš„è¡¨æœ‰é‚£å‡ ä¸ª"><a href="#23-MySQLæœ‰å…³æƒé™çš„è¡¨æœ‰é‚£å‡ ä¸ª" class="headerlink" title="23.MySQLæœ‰å…³æƒé™çš„è¡¨æœ‰é‚£å‡ ä¸ª"></a>23.MySQLæœ‰å…³æƒé™çš„è¡¨æœ‰é‚£å‡ ä¸ª</h1><p>åœ¨MySQLä¸­ï¼Œæœ‰å‡ ä¸ªä¸æƒé™ç›¸å…³çš„ç³»ç»Ÿè¡¨å’Œè§†å›¾ï¼Œç”¨äºç®¡ç†ç”¨æˆ·ã€è§’è‰²å’Œæƒé™ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æƒé™ç›¸å…³çš„è¡¨å’Œè§†å›¾ï¼š</p><ol><li>mysql.userï¼šè¿™ä¸ªè¡¨åŒ…å«äº†MySQLå®ä¾‹ä¸Šçš„æ‰€æœ‰ç”¨æˆ·è´¦æˆ·ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·åã€å¯†ç ç­‰ã€‚è¯¥è¡¨è®°å½•äº†æ¯ä¸ªç”¨æˆ·çš„å…¨å±€æƒé™ã€‚</li><li>mysql.dbï¼šè¿™ä¸ªè¡¨è®°å½•äº†ç”¨æˆ·å¯¹æ•°æ®åº“çº§åˆ«çš„æƒé™ã€‚å®ƒæŒ‡å®šäº†å“ªä¸ªç”¨æˆ·å¯¹å“ªä¸ªæ•°æ®åº“å…·æœ‰ä»€ä¹ˆæ ·çš„æƒé™ã€‚</li><li>mysql.tables_privï¼šè¿™ä¸ªè¡¨è®°å½•äº†ç”¨æˆ·å¯¹è¡¨çº§åˆ«çš„æƒé™ã€‚å®ƒå­˜å‚¨äº†ç”¨æˆ·å¯¹æŸä¸ªå…·ä½“è¡¨çš„æƒé™ä¿¡æ¯ï¼ˆå¦‚SELECTã€INSERTã€UPDATEã€DELETEç­‰ï¼‰ã€‚</li><li>mysql.columns_privï¼šè¿™ä¸ªè¡¨è®°å½•äº†ç”¨æˆ·å¯¹åˆ—çº§åˆ«çš„æƒé™ã€‚å®ƒå­˜å‚¨äº†ç”¨æˆ·å¯¹è¡¨ä¸­æŸä¸ªå…·ä½“åˆ—çš„æƒé™ä¿¡æ¯ã€‚</li><li>mysql.procs_privï¼šè¿™ä¸ªè¡¨è®°å½•äº†ç”¨æˆ·å¯¹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„æƒé™ã€‚</li><li>mysql.rolesï¼šè¿™ä¸ªè¡¨å­˜å‚¨äº†è§’è‰²çš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬è§’è‰²åã€è§’è‰²çš„åˆ›å»ºè€…ç­‰ã€‚</li></ol><p>é™¤äº†ä¸Šè¿°çš„è¡¨ä¹‹å¤–ï¼ŒMySQLè¿˜æä¾›äº†ä¸€äº›æƒé™ç›¸å…³çš„è§†å›¾ï¼Œè¿™äº›è§†å›¾å¯ä»¥æ–¹ä¾¿åœ°æŸ¥çœ‹ç”¨æˆ·ã€è§’è‰²å’Œæƒé™çš„ä¿¡æ¯ï¼Œå¦‚ï¼š</p><ul><li>information_schema.USER_PRIVILEGESï¼šæ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·çš„æƒé™ä¿¡æ¯ã€‚</li><li>information_schema.SCHEMA_PRIVILEGESï¼šæ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“çš„æƒé™ä¿¡æ¯ã€‚</li><li>information_schema.TABLE_PRIVILEGESï¼šæ˜¾ç¤ºæ‰€æœ‰è¡¨çš„æƒé™ä¿¡æ¯ã€‚</li><li>information_schema.COLUMN_PRIVILEGESï¼šæ˜¾ç¤ºæ‰€æœ‰åˆ—çš„æƒé™ä¿¡æ¯ã€‚</li></ul><p>å¦‚ä¸‹æ˜¯ä¸ªä½¿ç”¨ç¤ºä¾‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> information_schema.USER_PRIVILEGES;</span><br></pre></td></tr></table></figure><p>è¿™äº›è¡¨å’Œè§†å›¾å¯ä»¥é€šè¿‡æŸ¥è¯¢ç›¸åº”çš„ç³»ç»Ÿè¡¨æˆ–è§†å›¾æ¥æŸ¥çœ‹å’Œç®¡ç†ç”¨æˆ·ã€è§’è‰²å’Œæƒé™ã€‚è¯·æ³¨æ„ï¼Œå…·ä½“çš„ç³»ç»Ÿè¡¨å’Œè§†å›¾åç§°å¯èƒ½å› MySQLç‰ˆæœ¬å’Œé…ç½®è€Œæœ‰æ‰€ä¸åŒã€‚ä¸ºäº†ç¡®ä¿å‡†ç¡®æ€§ï¼Œè¯·å‚è€ƒMySQLå®˜æ–¹æ–‡æ¡£æˆ–ç‰¹å®šç‰ˆæœ¬çš„æ–‡æ¡£ã€‚</p><h1 id="24-åˆ—çš„å­—ç¬¦ä¸²ç±»å‹å¯ä»¥æ˜¯ä»€ä¹ˆ"><a href="#24-åˆ—çš„å­—ç¬¦ä¸²ç±»å‹å¯ä»¥æ˜¯ä»€ä¹ˆ" class="headerlink" title="24.åˆ—çš„å­—ç¬¦ä¸²ç±»å‹å¯ä»¥æ˜¯ä»€ä¹ˆ"></a>24.åˆ—çš„å­—ç¬¦ä¸²ç±»å‹å¯ä»¥æ˜¯ä»€ä¹ˆ</h1><p>TEXT CHAR VARCHARï¼Œè¯¦è§ç¬¬äº”ç‚¹</p><h1 id="25-MySQLä½œä¸ºå‘å¸ƒç³»ç»Ÿçš„å­˜å‚¨ï¼Œä¸€å¤©äº”ä¸‡æ¡ä»¥ä¸Šçš„å¢é‡ï¼Œé¢„è®¡è¿ç»´ä¸‰å¹´ï¼Œå¦‚ä½•ä¼˜åŒ–ï¼Ÿ"><a href="#25-MySQLä½œä¸ºå‘å¸ƒç³»ç»Ÿçš„å­˜å‚¨ï¼Œä¸€å¤©äº”ä¸‡æ¡ä»¥ä¸Šçš„å¢é‡ï¼Œé¢„è®¡è¿ç»´ä¸‰å¹´ï¼Œå¦‚ä½•ä¼˜åŒ–ï¼Ÿ" class="headerlink" title="25.MySQLä½œä¸ºå‘å¸ƒç³»ç»Ÿçš„å­˜å‚¨ï¼Œä¸€å¤©äº”ä¸‡æ¡ä»¥ä¸Šçš„å¢é‡ï¼Œé¢„è®¡è¿ç»´ä¸‰å¹´ï¼Œå¦‚ä½•ä¼˜åŒ–ï¼Ÿ"></a>25.MySQLä½œä¸ºå‘å¸ƒç³»ç»Ÿçš„å­˜å‚¨ï¼Œä¸€å¤©äº”ä¸‡æ¡ä»¥ä¸Šçš„å¢é‡ï¼Œé¢„è®¡è¿ç»´ä¸‰å¹´ï¼Œå¦‚ä½•ä¼˜åŒ–ï¼Ÿ</h1><blockquote><p>æ²¡è§è¿‡è¿™ç§ä¸šåŠ¡ï¼Œåªèƒ½é—®GPT</p></blockquote><p>å¯¹äºä¸€ä¸ªMySQLä½œä¸ºå‘å¸ƒç³»ç»Ÿå­˜å‚¨çš„åœºæ™¯ï¼Œå¤„ç†æ¯å¤©è¶…è¿‡äº”ä¸‡æ¡å¢é‡æ•°æ®å¹¶ä¸”éœ€è¦ä¿æŒä¸‰å¹´çš„æ•°æ®ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›ä¼˜åŒ–å»ºè®®ï¼š</p><ol><li>æ•°æ®åº“ç¡¬ä»¶å’Œé…ç½®ä¼˜åŒ–ï¼š<ul><li>ç¡¬ä»¶æ€§èƒ½ï¼šç¡®ä¿æ•°æ®åº“æœåŠ¡å™¨å…·å¤‡è¶³å¤Ÿçš„è®¡ç®—ã€å†…å­˜å’Œå­˜å‚¨èµ„æºï¼Œä»¥å¤„ç†é«˜è´Ÿè½½çš„å†™å…¥å’Œè¯»å–æ“ä½œã€‚</li><li>å­˜å‚¨è®¾å¤‡ï¼šä½¿ç”¨é«˜æ€§èƒ½çš„å­˜å‚¨è®¾å¤‡ï¼ˆå¦‚SSDï¼‰æ¥æé«˜å†™å…¥å’Œè¯»å–é€Ÿåº¦ã€‚</li><li>MySQLå‚æ•°è°ƒä¼˜ï¼šæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´MySQLçš„é…ç½®å‚æ•°ï¼Œä¾‹å¦‚è®¾ç½®åˆç†çš„ç¼“å†²åŒºå¤§å°ã€å¹¶å‘è¿æ¥æ•°ã€æŸ¥è¯¢ç¼“å­˜ç­‰ã€‚</li></ul></li><li>æ•°æ®åº“æ¶æ„ä¼˜åŒ–ï¼š<ul><li>åˆ†åº“åˆ†è¡¨ï¼šè€ƒè™‘å°†æ•°æ®è¿›è¡Œåˆ†åº“åˆ†è¡¨æ¥åˆ†æ‹…å•ä¸ªæ•°æ®åº“çš„è´Ÿè½½å‹åŠ›ã€‚æ ¹æ®æ•°æ®çš„ç‰¹ç‚¹å’Œè®¿é—®æ¨¡å¼ï¼Œåˆç†åˆ’åˆ†æ•°æ®åˆ°ä¸åŒçš„åº“è¡¨ä¸­ã€‚</li><li>ç´¢å¼•ä¼˜åŒ–ï¼šæ ¹æ®æŸ¥è¯¢éœ€æ±‚åˆ›å»ºåˆé€‚çš„ç´¢å¼•ï¼Œä»¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚é¿å…è¿‡å¤šçš„ç´¢å¼•å’Œå†—ä½™ç´¢å¼•ï¼Œä»¥å‡å°‘ç»´æŠ¤æˆæœ¬ã€‚</li><li>åˆ†åŒºè¡¨ï¼šå¦‚æœæ•°æ®çš„æ—¶é—´èŒƒå›´æœ‰æ˜æ˜¾çš„ç•Œé™ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨MySQLçš„åˆ†åŒºè¡¨åŠŸèƒ½ï¼Œå°†æ•°æ®æŒ‰æ—¶é—´èŒƒå›´è¿›è¡Œåˆ†åŒºï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½å’Œç»´æŠ¤æ•ˆç‡ã€‚</li></ul></li><li>æ•°æ®å†™å…¥ä¼˜åŒ–ï¼š<ul><li>æ‰¹é‡æ’å…¥ï¼šä½¿ç”¨æ‰¹é‡æ’å…¥æ–¹å¼ï¼ˆå¦‚INSERT INTO â€¦ VALUES (), (), ()â€¦ï¼‰æ¥å‡å°‘å•æ¡æ’å…¥çš„å¼€é”€ï¼Œæé«˜å†™å…¥æ€§èƒ½ã€‚</li><li>äº‹åŠ¡å¤„ç†ï¼šå°†å¤šä¸ªå†™å…¥æ“ä½œæ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ï¼Œå‡å°‘IOå¼€é”€ã€‚</li></ul></li><li>æ•°æ®å½’æ¡£å’Œå‹ç¼©ï¼š<ul><li>æ•°æ®å½’æ¡£ï¼šå¯¹äºå†å²æ•°æ®ï¼Œå¯ä»¥å°†å…¶å½’æ¡£åˆ°ç‹¬ç«‹çš„å­˜å‚¨ä»‹è´¨ä¸­ï¼Œä¾‹å¦‚å°†æ—§æ•°æ®è¿ç§»åˆ°å½’æ¡£æ•°æ®åº“æˆ–è€…ç¦»çº¿å­˜å‚¨ç³»ç»Ÿä¸­ä»¥å‡è½»ä¸»æ•°æ®åº“çš„è´Ÿè½½ã€‚</li><li>æ•°æ®å‹ç¼©ï¼šå¯¹äºä¸é¢‘ç¹æŸ¥è¯¢çš„å†å²æ•°æ®ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å‹ç¼©ç®—æ³•ï¼ˆä¾‹å¦‚MySQLçš„å‹ç¼©è¡¨åŠŸèƒ½æˆ–è€…ç¬¬ä¸‰æ–¹å‹ç¼©åº“ï¼‰è¿›è¡Œå­˜å‚¨ï¼Œä»¥å‡å°‘å­˜å‚¨ç©ºé—´å ç”¨ã€‚</li></ul></li><li>ç›‘æ§å’Œä¼˜åŒ–å·¥å…·ï¼š<ul><li>ä½¿ç”¨ç›‘æ§å·¥å…·å®æ—¶ç›‘æµ‹æ•°æ®åº“çš„æ€§èƒ½æŒ‡æ ‡ï¼Œå¦‚æŸ¥è¯¢é€Ÿåº¦ã€ç£ç›˜ä½¿ç”¨ã€é”ç­‰æƒ…å†µï¼ŒåŠæ—¶å‘ç°æ½œåœ¨çš„æ€§èƒ½ç“¶é¢ˆå¹¶è¿›è¡Œè°ƒä¼˜ã€‚</li><li>ä½¿ç”¨æ€§èƒ½ä¼˜åŒ–å·¥å…·ï¼Œå¦‚Explainåˆ†æã€æ…¢æŸ¥è¯¢æ—¥å¿—ç­‰ï¼Œæ¥æ‰¾å‡ºæ…¢æŸ¥è¯¢å’Œä½æ•ˆçš„SQLè¯­å¥ï¼Œå¹¶è¿›è¡Œä¼˜åŒ–ã€‚</li></ul></li></ol><p>ä»¥ä¸Šæ˜¯ä¸€äº›å¸¸è§çš„ä¼˜åŒ–å»ºè®®ï¼Œå…·ä½“ä¼˜åŒ–æ–¹æ¡ˆè¿˜éœ€è¦æ ¹æ®å®é™…åœºæ™¯å’Œéœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚åŒæ—¶ï¼Œå»ºè®®åœ¨è¿›è¡Œä¼˜åŒ–å‰ï¼Œå……åˆ†äº†è§£åº”ç”¨çš„è¯»å†™ç‰¹å¾ã€æ•°æ®è®¿é—®æ¨¡å¼å’Œä¸šåŠ¡éœ€æ±‚ï¼Œä»¥ä¾¿æœ‰é’ˆå¯¹æ€§åœ°è¿›è¡Œä¼˜åŒ–å·¥ä½œã€‚</p><h1 id="26-é”çš„ä¼˜åŒ–ç­–ç•¥ï¼Ÿ"><a href="#26-é”çš„ä¼˜åŒ–ç­–ç•¥ï¼Ÿ" class="headerlink" title="26.é”çš„ä¼˜åŒ–ç­–ç•¥ï¼Ÿ"></a>26.é”çš„ä¼˜åŒ–ç­–ç•¥ï¼Ÿ</h1><h1 id="27-ç´¢å¼•çš„åº•å±‚å®ç°å’Œä¼˜åŒ–ï¼Ÿ"><a href="#27-ç´¢å¼•çš„åº•å±‚å®ç°å’Œä¼˜åŒ–ï¼Ÿ" class="headerlink" title="27.ç´¢å¼•çš„åº•å±‚å®ç°å’Œä¼˜åŒ–ï¼Ÿ"></a>27.ç´¢å¼•çš„åº•å±‚å®ç°å’Œä¼˜åŒ–ï¼Ÿ</h1><p>åº•å±‚ç”¨B+å®ç°ï¼Œä¼˜åŒ–ç´¢å¼•æ–¹å¼è§ç´¢å¼•åšå®¢ <a href="https://blog.musnow.top/posts/3474107655/">https://blog.musnow.top/posts/3474107655/</a></p><h1 id="28-ä»€ä¹ˆæƒ…å†µä¸‹æœ‰ç´¢å¼•ä½†æ˜¯æ— æ³•ä½¿ç”¨"><a href="#28-ä»€ä¹ˆæƒ…å†µä¸‹æœ‰ç´¢å¼•ä½†æ˜¯æ— æ³•ä½¿ç”¨" class="headerlink" title="28.ä»€ä¹ˆæƒ…å†µä¸‹æœ‰ç´¢å¼•ä½†æ˜¯æ— æ³•ä½¿ç”¨"></a>28.ä»€ä¹ˆæƒ…å†µä¸‹æœ‰ç´¢å¼•ä½†æ˜¯æ— æ³•ä½¿ç”¨</h1><p>ç´¢å¼•å¤±æ•ˆï¼Œè§ç´¢å¼•åšå®¢ <a href="https://blog.musnow.top/posts/3474107655/">https://blog.musnow.top/posts/3474107655/</a></p><h1 id="29-å®è·µä¸­å¦‚ä½•ä¼˜åŒ–MySQL"><a href="#29-å®è·µä¸­å¦‚ä½•ä¼˜åŒ–MySQL" class="headerlink" title="29.å®è·µä¸­å¦‚ä½•ä¼˜åŒ–MySQL"></a>29.å®è·µä¸­å¦‚ä½•ä¼˜åŒ–MySQL</h1><p>å¤ªå®½æ³›äº†ï¼Œä¸å¥½å›ç­”</p><ul><li>ç´¢å¼•ä¼˜åŒ–</li><li>åˆ†è¡¨</li><li>äº‹åŠ¡éš”ç¦»æ€§é€‰æ‹©</li></ul><h1 id="30-ä¼˜åŒ–æ•°æ®åº“çš„åŠæ³•ï¼Ÿ"><a href="#30-ä¼˜åŒ–æ•°æ®åº“çš„åŠæ³•ï¼Ÿ" class="headerlink" title="30.ä¼˜åŒ–æ•°æ®åº“çš„åŠæ³•ï¼Ÿ"></a>30.ä¼˜åŒ–æ•°æ®åº“çš„åŠæ³•ï¼Ÿ</h1><p>å’Œ29é¢˜é‡åˆï¼Œä¸åšå›ç­”</p><h1 id="31-ç®€å•æè¿°ç´¢å¼•ã€ä¸»é”®ã€å”¯ä¸€ç´¢å¼•ã€è”åˆç´¢å¼•çš„åŒºåˆ«ï¼Œå¯¹æ•°æ®åº“æ€§èƒ½æœ‰ä»€ä¹ˆå½±å“ï¼ˆè¯»å†™ä¸¤æ–¹é¢ï¼‰"><a href="#31-ç®€å•æè¿°ç´¢å¼•ã€ä¸»é”®ã€å”¯ä¸€ç´¢å¼•ã€è”åˆç´¢å¼•çš„åŒºåˆ«ï¼Œå¯¹æ•°æ®åº“æ€§èƒ½æœ‰ä»€ä¹ˆå½±å“ï¼ˆè¯»å†™ä¸¤æ–¹é¢ï¼‰" class="headerlink" title="31.ç®€å•æè¿°ç´¢å¼•ã€ä¸»é”®ã€å”¯ä¸€ç´¢å¼•ã€è”åˆç´¢å¼•çš„åŒºåˆ«ï¼Œå¯¹æ•°æ®åº“æ€§èƒ½æœ‰ä»€ä¹ˆå½±å“ï¼ˆè¯»å†™ä¸¤æ–¹é¢ï¼‰"></a>31.ç®€å•æè¿°ç´¢å¼•ã€ä¸»é”®ã€å”¯ä¸€ç´¢å¼•ã€è”åˆç´¢å¼•çš„åŒºåˆ«ï¼Œå¯¹æ•°æ®åº“æ€§èƒ½æœ‰ä»€ä¹ˆå½±å“ï¼ˆè¯»å†™ä¸¤æ–¹é¢ï¼‰</h1><p>è§ç´¢å¼•åšå®¢ <a href="https://blog.musnow.top/posts/3474107655/">https://blog.musnow.top/posts/3474107655/</a></p><h1 id="32-æ•°æ®åº“çš„äº‹åŠ¡æ˜¯ä»€ä¹ˆ"><a href="#32-æ•°æ®åº“çš„äº‹åŠ¡æ˜¯ä»€ä¹ˆ" class="headerlink" title="32.æ•°æ®åº“çš„äº‹åŠ¡æ˜¯ä»€ä¹ˆ"></a>32.æ•°æ®åº“çš„äº‹åŠ¡æ˜¯ä»€ä¹ˆ</h1><p>è§äº‹åŠ¡åšå®¢ <a href="https://blog.musnow.top/posts/2200233148/">https://blog.musnow.top/posts/2200233148/</a></p><h1 id="33-SQLæ³¨å…¥æ¼æ´çš„äº§ç”Ÿå’ŒåŸå› ï¼Œå¦‚ä½•é˜²æ­¢"><a href="#33-SQLæ³¨å…¥æ¼æ´çš„äº§ç”Ÿå’ŒåŸå› ï¼Œå¦‚ä½•é˜²æ­¢" class="headerlink" title="33.SQLæ³¨å…¥æ¼æ´çš„äº§ç”Ÿå’ŒåŸå› ï¼Œå¦‚ä½•é˜²æ­¢"></a>33.SQLæ³¨å…¥æ¼æ´çš„äº§ç”Ÿå’ŒåŸå› ï¼Œå¦‚ä½•é˜²æ­¢</h1><p>SQLæ³¨å…¥æ¼æ´æ˜¯ä¸€ç§å¸¸è§çš„å®‰å…¨æ¼æ´ï¼Œå®ƒå¯ä»¥ä½¿æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„SQLè¯­å¥æ¥ç»•è¿‡åº”ç”¨ç¨‹åºçš„è¾“å…¥éªŒè¯ï¼Œè¿›è€Œæ‰§è¡Œéæ³•çš„æ•°æ®åº“æ“ä½œæˆ–è·å–æ•æ„Ÿä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯SQLæ³¨å…¥æ¼æ´äº§ç”Ÿçš„åŸå› å’Œä¸€äº›é˜²æ­¢æ–¹æ³•ï¼š</p><ol><li>åŸå› ï¼š<ul><li>ä¸æ­£ç¡®çš„è¾“å…¥éªŒè¯ï¼šå½“åº”ç”¨ç¨‹åºæ²¡æœ‰å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œå……åˆ†éªŒè¯å’Œè¿‡æ»¤æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è¾“å…¥ç‰¹å®šçš„å­—ç¬¦æˆ–è¯­å¥æ¥ä¿®æ”¹SQLè¯­å¥çš„ç»“æ„ï¼Œä»è€Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚</li><li>æ‹¼æ¥å­—ç¬¦ä¸²æ„é€ SQLè¯­å¥ï¼šå¦‚æœåº”ç”¨ç¨‹åºä½¿ç”¨æ‹¼æ¥å­—ç¬¦ä¸²çš„æ–¹å¼æ„é€ SQLæŸ¥è¯¢è¯­å¥ï¼Œå¹¶ä¸”æœªå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œæ­£ç¡®çš„è½¬ä¹‰å¤„ç†ï¼Œå°±å®¹æ˜“å—åˆ°SQLæ³¨å…¥æ”»å‡»ã€‚</li></ul></li><li>é˜²æ­¢æ–¹æ³•ï¼š<ul><li>ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢æˆ–é¢„ç¼–è¯‘è¯­å¥ï¼šå‚æ•°åŒ–æŸ¥è¯¢å°†ç”¨æˆ·è¾“å…¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™SQLè¯­å¥ï¼Œè€Œä¸æ˜¯ç›´æ¥æ‹¼æ¥å­—ç¬¦ä¸²ã€‚è¿™æ ·å¯ä»¥é€šè¿‡æ•°æ®åº“é©±åŠ¨ç¨‹åºè‡ªåŠ¨å¤„ç†è½¬ä¹‰å’Œç¼–ç ï¼Œæœ‰æ•ˆé˜²æ­¢SQLæ³¨å…¥æ”»å‡»ã€‚</li><li>è¾“å…¥éªŒè¯å’Œè¿‡æ»¤ï¼šå¯¹ç”¨æˆ·çš„è¾“å…¥æ•°æ®è¿›è¡ŒéªŒè¯å’Œè¿‡æ»¤ï¼Œåªæ¥å—ç¬¦åˆè§„èŒƒçš„æ•°æ®ã€‚å¯ä»¥ä½¿ç”¨ç™½åå•ã€é»‘åå•ã€æ­£åˆ™è¡¨è¾¾å¼ç­‰æ–¹æ³•è¿›è¡Œè¾“å…¥éªŒè¯å’Œè¿‡æ»¤ã€‚</li><li>æœ€å°æƒé™åŸåˆ™ï¼šåœ¨æ•°æ®åº“ä¸­ä¸ºåº”ç”¨ç¨‹åºä½¿ç”¨çš„è´¦å·è®¾ç½®æœ€å°æƒé™ï¼Œå³åªæˆäºˆåº”ç”¨ç¨‹åºå®Œæˆå¿…è¦æ“ä½œæ‰€éœ€çš„æœ€ä½æƒé™ï¼Œé¿å…æ”»å‡»è€…åˆ©ç”¨æ³¨å…¥æ¼æ´è¿›è¡Œæ›´å±é™©çš„æ“ä½œã€‚</li><li>ä¸è¦ç›´æ¥æš´éœ²æ•°æ®åº“é”™è¯¯ä¿¡æ¯ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸è¦å°†è¯¦ç»†çš„æ•°æ®åº“é”™è¯¯ä¿¡æ¯è¿”å›ç»™ç”¨æˆ·ï¼Œä»¥é˜²æ­¢æ”»å‡»è€…ä»ä¸­è·å–å…³é”®ä¿¡æ¯ã€‚å¯ä»¥è®°å½•é”™è¯¯æ—¥å¿—å¹¶ç»™ç”¨æˆ·ä¸€ä¸ªå‹å¥½çš„é”™è¯¯æç¤ºã€‚</li><li>å®šæœŸæ›´æ–°å’Œä¿®è¡¥æ•°æ®åº“å’Œåº”ç”¨ç¨‹åºï¼šåŠæ—¶å®‰è£…æ•°æ®åº“å’Œåº”ç”¨ç¨‹åºçš„å®‰å…¨è¡¥ä¸ï¼Œä»¥ä¿®å¤å·²çŸ¥çš„æ¼æ´ï¼Œå¹¶ç¡®ä¿ä½¿ç”¨æœ€æ–°çš„å®‰å…¨æªæ–½ã€‚</li></ul></li></ol><p>æ€»ä¹‹ï¼Œä¸ºäº†é˜²æ­¢SQLæ³¨å…¥æ¼æ´ï¼Œå…³é”®æ˜¯è¦å¯¹ç”¨æˆ·è¾“å…¥æ•°æ®è¿›è¡Œåˆç†éªŒè¯ã€è¿‡æ»¤å’Œè½¬ä¹‰å¤„ç†ï¼Œå¹¶ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢æˆ–é¢„ç¼–è¯‘è¯­å¥æ¥æ„é€ SQLè¯­å¥ã€‚åŒæ—¶ï¼Œä¿æŒåº”ç”¨ç¨‹åºå’Œæ•°æ®åº“çš„å®‰å…¨æ€§ï¼Œå¹¶åŠæ—¶æ›´æ–°å’Œä¿®è¡¥å·²çŸ¥çš„å®‰å…¨æ¼æ´ã€‚</p><h1 id="34-å¦‚ä½•ä¸ºè¡¨ä¸­å­—æ®µé€‰æ‹©åˆé€‚æ•°æ®ç±»å‹"><a href="#34-å¦‚ä½•ä¸ºè¡¨ä¸­å­—æ®µé€‰æ‹©åˆé€‚æ•°æ®ç±»å‹" class="headerlink" title="34.å¦‚ä½•ä¸ºè¡¨ä¸­å­—æ®µé€‰æ‹©åˆé€‚æ•°æ®ç±»å‹"></a>34.å¦‚ä½•ä¸ºè¡¨ä¸­å­—æ®µé€‰æ‹©åˆé€‚æ•°æ®ç±»å‹</h1><p>è‚¯å®šæ˜¯æ ¹æ®å…·ä½“æƒ…å†µå›ç­”</p><h1 id="35-å­˜å‚¨æ—¶æœŸï¼Ÿ"><a href="#35-å­˜å‚¨æ—¶æœŸï¼Ÿ" class="headerlink" title="35.å­˜å‚¨æ—¶æœŸï¼Ÿ"></a>35.å­˜å‚¨æ—¶æœŸï¼Ÿ</h1><p>æ„Ÿè§‰è¿™é“é¢˜æœ‰é—®é¢˜ï¼Œä¸ç®¡ä»–</p><h1 id="36-ç´¢å¼•ç›¸å…³é—®é¢˜ï¼Ÿ"><a href="#36-ç´¢å¼•ç›¸å…³é—®é¢˜ï¼Ÿ" class="headerlink" title="36.ç´¢å¼•ç›¸å…³é—®é¢˜ï¼Ÿ"></a>36.ç´¢å¼•ç›¸å…³é—®é¢˜ï¼Ÿ</h1><p>å’Œ31é‡åˆï¼Œä¸å›ç­”</p><h1 id="37-è§£é‡ŠMySQLä¸­å¤–è¿æ¥ã€å†…è¿æ¥ã€è‡ªè¿æ¥çš„åŒºåˆ«"><a href="#37-è§£é‡ŠMySQLä¸­å¤–è¿æ¥ã€å†…è¿æ¥ã€è‡ªè¿æ¥çš„åŒºåˆ«" class="headerlink" title="37.è§£é‡ŠMySQLä¸­å¤–è¿æ¥ã€å†…è¿æ¥ã€è‡ªè¿æ¥çš„åŒºåˆ«"></a>37.è§£é‡ŠMySQLä¸­å¤–è¿æ¥ã€å†…è¿æ¥ã€è‡ªè¿æ¥çš„åŒºåˆ«</h1><ol><li>å†…è¿æ¥ï¼ˆINNER JOINï¼‰ï¼š<ul><li>å†…è¿æ¥è¿”å›ä¸¤ä¸ªè¡¨ä¸­æ»¡è¶³è¿æ¥æ¡ä»¶çš„è®°å½•ï¼Œå³åªè¿”å›ä¸¤ä¸ªè¡¨ä¸­èƒ½å¤ŸåŒ¹é…çš„è¡Œã€‚</li><li>å†…è¿æ¥ä½¿ç”¨ä¸€ä¸ªè¿æ¥è°“è¯ï¼ˆJOINï¼‰æˆ–è€…åœ¨FROMå­å¥ä¸­ä½¿ç”¨é€—å·ï¼ˆ,ï¼‰æ¥è¡¨ç¤ºã€‚</li><li>å†…è¿æ¥å¯ä»¥æ ¹æ®æŒ‡å®šçš„è¿æ¥æ¡ä»¶å°†ä¸¤ä¸ªè¡¨ä¸­çš„åˆ—è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœæœªæä¾›è¿æ¥æ¡ä»¶ï¼Œåˆ™ä¼šè¿”å›ä¸¤ä¸ªè¡¨çš„ç¬›å¡å°”ç§¯ã€‚</li><li>è¯­æ³•ç¤ºä¾‹ï¼šSELECT * FROM è¡¨1 INNER JOIN è¡¨2 ON è¡¨1.åˆ— &#x3D; è¡¨2.åˆ—;</li></ul></li><li>å¤–è¿æ¥ï¼ˆOUTER JOINï¼‰ï¼š<ul><li>å¤–è¿æ¥å°†è¿”å›ä¸¤ä¸ªè¡¨ä¸­æ»¡è¶³è¿æ¥æ¡ä»¶çš„è®°å½•ï¼Œå¹¶ä¸”è¿˜åŒ…æ‹¬ä¸æ»¡è¶³è¿æ¥æ¡ä»¶çš„è®°å½•ã€‚</li><li>å¤–è¿æ¥åˆ†ä¸ºå·¦å¤–è¿æ¥ï¼ˆLEFT JOINï¼‰å’Œå³å¤–è¿æ¥ï¼ˆRIGHT JOINï¼‰ã€‚</li><li>å·¦å¤–è¿æ¥è¿”å›å·¦è¡¨ä¸­çš„æ‰€æœ‰è®°å½•ï¼Œä»¥åŠå³è¡¨ä¸­ä¸å·¦è¡¨æ»¡è¶³è¿æ¥æ¡ä»¶çš„è®°å½•ã€‚å¦‚æœå³è¡¨ä¸­æ²¡æœ‰åŒ¹é…çš„è®°å½•ï¼Œåˆ™ä¼šè¿”å›NULLå€¼ã€‚</li><li>å³å¤–è¿æ¥è¿”å›å³è¡¨ä¸­çš„æ‰€æœ‰è®°å½•ï¼Œä»¥åŠå·¦è¡¨ä¸­ä¸å³è¡¨æ»¡è¶³è¿æ¥æ¡ä»¶çš„è®°å½•ã€‚å¦‚æœå·¦è¡¨ä¸­æ²¡æœ‰åŒ¹é…çš„è®°å½•ï¼Œåˆ™ä¼šè¿”å›NULLå€¼ã€‚</li><li>è¯­æ³•ç¤ºä¾‹ï¼š<ul><li>å·¦å¤–è¿æ¥ï¼šSELECT * FROM è¡¨1 LEFT JOIN è¡¨2 ON è¡¨1.åˆ— &#x3D; è¡¨2.åˆ—;</li><li>å³å¤–è¿æ¥ï¼šSELECT * FROM è¡¨1 RIGHT JOIN è¡¨2 ON è¡¨1.åˆ— &#x3D; è¡¨2.åˆ—;</li></ul></li></ul></li><li>è‡ªè¿æ¥ï¼ˆSELF JOINï¼‰ï¼š<ul><li>è‡ªè¿æ¥æ˜¯æŒ‡å°†è¡¨è§†ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„å®ä¾‹ï¼Œä½¿ç”¨åˆ«åæ¥åŒºåˆ†å®ƒä»¬ï¼Œç„¶åæ ¹æ®æŸäº›æ¡ä»¶å°†å®ƒä»¬è¿æ¥åœ¨ä¸€èµ·ã€‚</li><li>è‡ªè¿æ¥é€šå¸¸ç”¨äºåœ¨åŒä¸€ä¸ªè¡¨ä¸­æ ¹æ®æŸç§å…³ç³»è¿›è¡Œæ•°æ®æŸ¥è¯¢ã€‚</li><li>è¯­æ³•ç¤ºä¾‹ï¼šSELECT åˆ«å1.åˆ—, åˆ«å2.åˆ— FROM è¡¨ åˆ«å1, è¡¨ åˆ«å2 WHERE åˆ«å1.åˆ— &#x3D; åˆ«å2.åˆ—;</li></ul></li></ol><p>æ€»ç»“ï¼š</p><ul><li>å†…è¿æ¥è¿”å›ä¸¤ä¸ªè¡¨ä¸­åŒ¹é…çš„è®°å½•ï¼Œå¤–è¿æ¥è¿”å›æ»¡è¶³è¿æ¥æ¡ä»¶çš„è®°å½•ä»¥åŠä¸æ»¡è¶³è¿æ¥æ¡ä»¶çš„è®°å½•ï¼Œè€Œè‡ªè¿æ¥æ˜¯å¯¹åŒä¸€ä¸ªè¡¨è¿›è¡Œè¿æ¥æ“ä½œã€‚</li><li>å†…è¿æ¥å’Œå¤–è¿æ¥éœ€è¦ä½¿ç”¨JOINå…³é”®å­—ï¼Œè€Œè‡ªè¿æ¥ä½¿ç”¨åŒä¸€ä¸ªè¡¨çš„åˆ«åè¿›è¡Œè¿æ¥ã€‚</li><li>å†…è¿æ¥å’Œå¤–è¿æ¥å¯ä»¥æ ¹æ®è¿æ¥æ¡ä»¶å°†ä¸¤ä¸ªè¡¨è¿›è¡Œå…³è”ï¼Œè€Œè‡ªè¿æ¥å¯ä»¥æ ¹æ®è¡¨ä¸­çš„æŸäº›æ¡ä»¶è¿›è¡Œå…³è”ã€‚</li></ul><h1 id="38-MySQLä¸­äº‹åŠ¡å›æ»šæœºåˆ¶æè¿°"><a href="#38-MySQLä¸­äº‹åŠ¡å›æ»šæœºåˆ¶æè¿°" class="headerlink" title="38.MySQLä¸­äº‹åŠ¡å›æ»šæœºåˆ¶æè¿°"></a>38.MySQLä¸­äº‹åŠ¡å›æ»šæœºåˆ¶æè¿°</h1><p>è§äº‹åŠ¡åšå®¢ <a href="https://blog.musnow.top/posts/2200233148/">https://blog.musnow.top/posts/2200233148/</a></p><h1 id="39-SQLè¯­è¨€åŒ…å«å“ªå‡ éƒ¨åˆ†ï¼Ÿæ¯éƒ¨åˆ†éƒ½æœ‰å“ªäº›æ“ä½œå…³é”®å­—"><a href="#39-SQLè¯­è¨€åŒ…å«å“ªå‡ éƒ¨åˆ†ï¼Ÿæ¯éƒ¨åˆ†éƒ½æœ‰å“ªäº›æ“ä½œå…³é”®å­—" class="headerlink" title="39.SQLè¯­è¨€åŒ…å«å“ªå‡ éƒ¨åˆ†ï¼Ÿæ¯éƒ¨åˆ†éƒ½æœ‰å“ªäº›æ“ä½œå…³é”®å­—"></a>39.SQLè¯­è¨€åŒ…å«å“ªå‡ éƒ¨åˆ†ï¼Ÿæ¯éƒ¨åˆ†éƒ½æœ‰å“ªäº›æ“ä½œå…³é”®å­—</h1><p>åŒ…æ‹¬DQLæ•°æ®æŸ¥è¯¢è¯­è¨€ï¼ŒDMLæ•°æ®æ“ä½œè¯­è¨€ï¼ˆå¢åˆ æ”¹ï¼‰ï¼Œæ•°æ®æ§åˆ¶è¯­è¨€DCLç”¨æ¥ç®¡ç†æ•°æ®åº“ï¼Œäº‹åŠ¡æ§åˆ¶è¯­è¨€TCLç”¨æ¥æ§åˆ¶äº‹åŠ¡ï¼Œæ•°æ®å®šä¹‰è¯­è¨€DDLç”¨æ¥åˆ›å»ºåˆ é™¤è¡¨</p><ol><li>æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼ˆData Query Languageï¼ŒDQLï¼‰ï¼šç”¨äºä»æ•°æ®åº“ä¸­æŸ¥è¯¢å’Œæ£€ç´¢æ•°æ®ã€‚å¸¸ç”¨çš„æ“ä½œå…³é”®å­—åŒ…æ‹¬ï¼š<ul><li>SELECTï¼šç”¨äºä»ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨ä¸­é€‰æ‹©æ•°æ®åˆ—ä»¥è¿›è¡ŒæŸ¥è¯¢ã€‚</li><li>FROMï¼šæŒ‡å®šè¦æŸ¥è¯¢çš„è¡¨ã€‚</li><li>WHEREï¼šç”¨äºæŒ‡å®šæŸ¥è¯¢çš„æ¡ä»¶ã€‚</li><li>GROUP BYï¼šæŒ‰ç…§æŒ‡å®šçš„åˆ—å¯¹ç»“æœè¿›è¡Œåˆ†ç»„ã€‚</li><li>HAVINGï¼šç”¨äºæŒ‡å®šå¯¹åˆ†ç»„åçš„ç»“æœè¿›è¡Œç­›é€‰çš„æ¡ä»¶ã€‚</li><li>ORDER BYï¼šæŒ‡å®šç»“æœé›†çš„æ’åºæ–¹å¼ã€‚</li></ul></li><li>æ•°æ®æ“ä½œè¯­è¨€ï¼ˆData Manipulation Languageï¼ŒDMLï¼‰ï¼šç”¨äºå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®è¿›è¡Œå¢åŠ ã€ä¿®æ”¹å’Œåˆ é™¤æ“ä½œã€‚å¸¸ç”¨çš„æ“ä½œå…³é”®å­—åŒ…æ‹¬ï¼š<ul><li>INSERT INTOï¼šå‘è¡¨ä¸­æ’å…¥æ–°çš„è¡Œæˆ–æ•°æ®ã€‚</li><li>UPDATEï¼šæ›´æ–°è¡¨ä¸­å·²æœ‰çš„æ•°æ®ã€‚</li><li>DELETE FROMï¼šä»è¡¨ä¸­åˆ é™¤æŒ‡å®šçš„è¡Œæˆ–æ•°æ®ã€‚</li></ul></li><li>æ•°æ®å®šä¹‰è¯­è¨€ï¼ˆData Definition Languageï¼ŒDDLï¼‰ï¼šç”¨äºåˆ›å»ºã€ä¿®æ”¹å’Œåˆ é™¤æ•°æ®åº“å’Œè¡¨ç»“æ„ã€‚å¸¸ç”¨çš„æ“ä½œå…³é”®å­—åŒ…æ‹¬ï¼š<ul><li>CREATE DATABASEï¼šåˆ›å»ºæ–°çš„æ•°æ®åº“ã€‚</li><li>CREATE TABLEï¼šåˆ›å»ºæ–°çš„æ•°æ®è¡¨ã€‚</li><li>ALTER TABLEï¼šä¿®æ”¹å·²å­˜åœ¨çš„æ•°æ®è¡¨ç»“æ„ã€‚</li><li>DROP DATABASEï¼šåˆ é™¤ç°æœ‰çš„æ•°æ®åº“ã€‚</li><li>DROP TABLEï¼šåˆ é™¤ç°æœ‰çš„æ•°æ®è¡¨ã€‚</li></ul></li><li>æ•°æ®æ§åˆ¶è¯­è¨€ï¼ˆData Control Languageï¼ŒDCLï¼‰ï¼šç”¨äºç®¡ç†æ•°æ®åº“ä¸­çš„ç”¨æˆ·æƒé™å’Œè®¿é—®æƒé™ã€‚å¸¸ç”¨çš„æ“ä½œå…³é”®å­—åŒ…æ‹¬ï¼š<ul><li>GRANTï¼šæˆäºˆç”¨æˆ·ç‰¹å®šçš„æƒé™ã€‚</li><li>REVOKEï¼šæ’¤é”€ç”¨æˆ·çš„æƒé™ã€‚</li></ul></li><li>äº‹åŠ¡æ§åˆ¶è¯­è¨€ï¼ˆTransaction Control Languageï¼ŒTCLï¼‰ï¼šç”¨äºç®¡ç†æ•°æ®åº“çš„äº‹åŠ¡å¤„ç†ã€‚å¸¸ç”¨çš„æ“ä½œå…³é”®å­—åŒ…æ‹¬ï¼š<ul><li>COMMITï¼šæäº¤ä¸€ä¸ªäº‹åŠ¡ï¼Œä½¿å…¶æ°¸ä¹…ç”Ÿæ•ˆã€‚</li><li>ROLLBACKï¼šå›æ»šä¸€ä¸ªäº‹åŠ¡ï¼Œæ’¤é”€ä¹‹å‰çš„æ“ä½œï¼Œä½¿å…¶ä¸ç”Ÿæ•ˆã€‚</li><li>SAVEPOINTï¼šåœ¨äº‹åŠ¡ä¸­è®¾ç½®ä¿å­˜ç‚¹ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶è¿›è¡Œå›æ»šã€‚</li></ul></li></ol><h1 id="40-å®Œæ•´æ€§çš„çº¦æŸåŒ…æ‹¬é‚£äº›ï¼Ÿ"><a href="#40-å®Œæ•´æ€§çš„çº¦æŸåŒ…æ‹¬é‚£äº›ï¼Ÿ" class="headerlink" title="40.å®Œæ•´æ€§çš„çº¦æŸåŒ…æ‹¬é‚£äº›ï¼Ÿ"></a>40.å®Œæ•´æ€§çš„çº¦æŸåŒ…æ‹¬é‚£äº›ï¼Ÿ</h1><p>åŸå­æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ï¼›è¿™é‡Œè¯´çš„å®Œæ•´æ€§åº”è¯¥å°±æ˜¯ä¸€è‡´æ€§ï¼›</p><p>å…·ä½“çš„è§£é‡Šä¾æ—§æ˜¯å»çœ‹äº‹åŠ¡çš„åšå®¢ <a href="https://blog.musnow.top/posts/2200233148/">https://blog.musnow.top/posts/2200233148/</a></p>]]></content>
    
    
    <summary type="html">å­—èŠ‚MySQLè¿ç¯40é—®</summary>
    
    
    
    <category term="å­¦ä¹ sql" scheme="https://blog.musnow.top/categories/%E5%AD%A6%E4%B9%A0sql/"/>
    
    
    <category term="mysql" scheme="https://blog.musnow.top/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>ã€é¢ç»ã€‘230913ä¸Šæµ·é›¶å¿µç§‘æŠ€CPPå®ä¹ ç”Ÿ</title>
    <link href="https://blog.musnow.top/posts/2719794733/"/>
    <id>https://blog.musnow.top/posts/2719794733/</id>
    <published>2023-09-13T09:32:14.000Z</published>
    <updated>2023-09-13T10:32:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>230913ä¸Šæµ·é›¶å¿µç§‘æŠ€CPPå®ä¹ ç”Ÿé¢è¯•è®°å½•</p><span id="more"></span><p>ä¸Šæ¥å…ˆåšäº†ä¸ªè‡ªæˆ‘ä»‹ç»ï¼Œç„¶åé¢è¯•å®˜ä»‹ç»äº†ä»–ä»¬æ˜¯åšç³»ç»Ÿè¿›ç¨‹è°ƒåº¦çš„ï¼›</p><h1 id="CPP"><a href="#CPP" class="headerlink" title="CPP"></a>CPP</h1><p>é¢˜ç›®é¡ºåºå¹¶éå®é™…é—®çš„é¡ºåº</p><h2 id="1-ç±»çš„å¤§å°"><a href="#1-ç±»çš„å¤§å°" class="headerlink" title="1.ç±»çš„å¤§å°"></a>1.ç±»çš„å¤§å°</h2><p>ç±»çš„å¤§å°å’Œä»€ä¹ˆä¸œè¥¿æœ‰å…³ç³»ï¼Ÿ</p><p>æˆ‘ç­”äº†æˆå‘˜å˜é‡å’Œè™šå‡½æ•°è¡¨</p><h2 id="2-å¤šæ€æ€ä¹ˆå®ç°çš„"><a href="#2-å¤šæ€æ€ä¹ˆå®ç°çš„" class="headerlink" title="2.å¤šæ€æ€ä¹ˆå®ç°çš„"></a>2.å¤šæ€æ€ä¹ˆå®ç°çš„</h2><p>é¡ºç€è™šå‡½æ•°è¡¨é—®çš„ï¼Œå°±è¯´äº†ä¸€ä¸‹åŠ¨æ€å¤šæ€çš„åŸºæœ¬å®ç°æ–¹å¼</p><h2 id="3-åªèƒ½åœ¨æ ˆä¸Šçš„ç±»"><a href="#3-åªèƒ½åœ¨æ ˆä¸Šçš„ç±»" class="headerlink" title="3.åªèƒ½åœ¨æ ˆä¸Šçš„ç±»"></a>3.åªèƒ½åœ¨æ ˆä¸Šçš„ç±»</h2><p>ç¦æ­¢æ‹·è´æ„é€ å’Œèµ‹å€¼ï¼Œæ„é€ å‡½æ•°ç§æœ‰åŒ–ï¼Œæä¾›å•ç‹¬å‡½æ•°åœ¨æ ˆä¸Šå¼€è¾Ÿç©ºé—´ï¼›</p><p>é¡ºä¾¿é—®äº†ä¸€ä¸‹åŠ¨æ€å†…å­˜ç®¡ç†çš„åŸºç¡€å½¢å¼</p><h2 id="4-æ™ºèƒ½æŒ‡é’ˆ"><a href="#4-æ™ºèƒ½æŒ‡é’ˆ" class="headerlink" title="4.æ™ºèƒ½æŒ‡é’ˆ"></a>4.æ™ºèƒ½æŒ‡é’ˆ</h2><p>å“ªäº›ç±»å‹ï¼Ÿæœ‰å•¥åŒºåˆ«ï¼Ÿweak ptræ€ä¹ˆè§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜çš„ï¼Ÿ</p><p>weak ptrçš„lockå‡½æ•°ç”¨è¿‡å—ï¼Ÿæœ‰æ²¡æœ‰åŠæ³•è·å–åˆ°shared ptrçš„å¼•ç”¨è®¡æ•°ï¼Ÿ</p><p>unique_ptrå¯ä»¥è½¬æˆshare_ptrå—ï¼Ÿ</p><p>å¦‚æœè¦ç”¨C++11çš„ç±»å‹è½¬æ¢ï¼Œè¦ä½¿ç”¨å“ªä¸€ä¸ªæ¥è¿›è¡Œunique_ptrå’Œshare_ptrçš„è½¬æ¢ï¼Ÿï¼ˆè¿™ä¸ªä¸ä¼šï¼Œåº”è¯¥æ˜¯static_castï¼‰</p><p>å®šåˆ¶åˆ é™¤å™¨æ˜¯å¹²å˜›çš„ï¼Ÿ</p><p>æ™ºèƒ½æŒ‡é’ˆçº¿ç¨‹å®‰å…¨å—ï¼Ÿ</p><p>æ‹·è´æ„é€ share_pträ¼šä¸ä¼šæœ‰å†…å­˜æ³„æ¼ï¼Ÿ</p><h2 id="5-ç±»å‹è½¬æ¢"><a href="#5-ç±»å‹è½¬æ¢" class="headerlink" title="5.ç±»å‹è½¬æ¢"></a>5.ç±»å‹è½¬æ¢</h2><p>C++11çš„ç±»å‹è½¬æ¢ï¼Œå‡ ä¸ªï¼ŒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>æŒ‡é’ˆä¹‹é—´è½¬æ¢è¦ç”¨ä»€ä¹ˆï¼Ÿï¼ˆä¸ä¼šï¼Œç­”çš„staticï¼‰</p><p>dynamic_castçˆ¶å­è½¬æ¢çš„æ—¶å€™ï¼Œå‘ä¸Šè¿˜æ˜¯å‘ä¸‹æ˜¯å®‰å…¨çš„ï¼Ÿï¼ˆå­è½¬æˆçˆ¶æ˜¯å®‰å…¨çš„ï¼Œå³å‘ä¸Šå®‰å…¨ï¼‰</p><h2 id="6-å•ä¾‹"><a href="#6-å•ä¾‹" class="headerlink" title="6.å•ä¾‹"></a>6.å•ä¾‹</h2><p>å‡ ç§ç±»å‹ï¼Œæ€ä¹ˆå®ç°ï¼Ÿ</p><h2 id="7-æ¨¡æ¿"><a href="#7-æ¨¡æ¿" class="headerlink" title="7.æ¨¡æ¿"></a>7.æ¨¡æ¿</h2><p>æ¨¡æ¿çš„å£°æ˜å’Œå®šä¹‰ä¸ºå•¥ä¸èƒ½åˆ†ç¦»ï¼Ÿï¼ˆå¿˜è®°äº†ï¼‰</p><p>æ¨¡æ¿ç‰¹åŒ–æ˜¯ä»€ä¹ˆï¼Ÿå‡½æ•°æ¨¡æ¿æ”¯æŒåŠç‰¹åŒ–å—ï¼Ÿï¼ˆä¸æ”¯æŒï¼‰</p><h2 id="8-C-çº¿ç¨‹å’Œasyncæœ‰å•¥åŒºåˆ«ï¼Ÿ"><a href="#8-C-çº¿ç¨‹å’Œasyncæœ‰å•¥åŒºåˆ«ï¼Ÿ" class="headerlink" title="8.C++çº¿ç¨‹å’Œasyncæœ‰å•¥åŒºåˆ«ï¼Ÿ"></a>8.C++çº¿ç¨‹å’Œasyncæœ‰å•¥åŒºåˆ«ï¼Ÿ</h2><p>threadæ˜¯ç±»ï¼Œaysncæ˜¯å‡½æ•°</p><p>asyncæœ‰ä¸¤ç§ç”¨æ³•ï¼Œä¸€ä¸ªæ˜¯ç«‹é©¬å¼‚æ­¥æ‰§è¡Œï¼Œä¼šå¼€ä¸€ä¸ªçº¿ç¨‹ï¼›ç¬¬äºŒä¸ªæ˜¯å»¶è¿ŸåŒæ­¥æ‰§è¡Œï¼Œåœ¨ä½¿ç”¨<code>future.get</code>çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œã€‚</p><p>è¿™éƒ¨åˆ†æ˜¯åœ¨äº‘è´¦æˆ¿é¢è¯•çš„æ—¶å€™é—®é“çš„ï¼Œå¾—äºæˆ‘ä¸“é—¨å»å­¦äº†ï¼Œå¼€å¿ƒï¼</p><h2 id="9-C-14æ–°ç‰¹æ€§"><a href="#9-C-14æ–°ç‰¹æ€§" class="headerlink" title="9.C++14æ–°ç‰¹æ€§"></a>9.C++14æ–°ç‰¹æ€§</h2><p>çŸ¥é“çš„å…¨è¯´äº†ï¼Œautoï¼Œlambdaæ–°ç‰¹æ€§ï¼Œconstexprï¼ˆå’Œc++11çš„åŒºåˆ«ï¼‰ï¼Œå˜é‡æ¨¡æ¿ï¼ŒäºŒè¿›åˆ¶å˜é‡ï¼Œç„¶åè¿˜è¯´äº†æœ€åå‡ ä¸ªstdçš„å‡½æ•°çœ‹ä¸æ˜ç™½ï¼›é¢è¯•å®˜äººå¾ˆå¥½ï¼Œä¸€ç›´è¯´æ²¡å…³ç³»ï¼›</p><p>ä¸“é—¨é—®äº†<code>constexpr</code>å£°æ˜å˜é‡å’Œconstæœ‰å•¥åŒºåˆ«ï¼ˆä¸çŸ¥é“ï¼‰</p><blockquote><p>GPTçš„å›ç­”</p><ol><li>æ—¶é—´ç‚¹ï¼š<code>constexpr</code> æ˜¯åœ¨ç¼–è¯‘æ—¶ç¡®å®šå€¼çš„ï¼Œè€Œ <code>const</code> æ˜¯åœ¨è¿è¡Œæ—¶ç¡®å®šå€¼çš„ã€‚</li><li>ç¼–è¯‘æœŸè®¡ç®—ï¼š<code>constexpr</code> å˜é‡å¯ä»¥ç”¨äºç¼–è¯‘æ—¶æœŸé—´çš„è®¡ç®—ï¼Œæ¯”å¦‚æ•°ç»„å¤§å°ã€æ¨¡æ¿å‚æ•°ç­‰éœ€è¦åœ¨ç¼–è¯‘é˜¶æ®µç¡®å®šå¤§å°çš„åœºæ™¯ã€‚è€Œ <code>const</code> å˜é‡åªæ˜¯è¡¨ç¤ºå®ƒçš„å€¼ä¸å¯ä»¥ä¿®æ”¹ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µæ— æ³•ä½¿ç”¨ <code>const</code> å˜é‡è¿›è¡Œç¼–è¯‘æœŸè®¡ç®—ã€‚</li><li>åˆå§‹åŒ–ï¼š<code>constexpr</code> å˜é‡å¿…é¡»åœ¨å£°æ˜æ—¶è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶ä¸”åªèƒ½ä½¿ç”¨å¸¸é‡è¡¨è¾¾å¼åˆå§‹åŒ–ï¼›<code>const</code> å˜é‡å¯ä»¥åœ¨å£°æ˜æ—¶åˆå§‹åŒ–ï¼Œä¹Ÿå¯ä»¥ç¨åèµ‹å€¼ï¼Œä½†èµ‹å€¼åå°±ä¸èƒ½å†ä¿®æ”¹ã€‚</li><li>åœ°å€ï¼š<code>constexpr</code> å˜é‡å¾€å¾€ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–ï¼Œå¯èƒ½ä¸ä¼šå ç”¨å†…å­˜ç©ºé—´ï¼Œå¹¶ä¸”åœ¨ç¼–è¯‘æœŸé—´è¢«æ¶ˆé™¤ã€‚<code>const</code> å˜é‡åœ¨è¿è¡Œæ—¶åˆ†é…å†…å­˜ï¼Œå¹¶ä¸”æœ‰ç›¸åº”çš„å†…å­˜åœ°å€ã€‚</li><li>ä½†æ˜¯è¿™ä¸¤ä¸ªå…³é”®å­—å£°æ˜çš„å˜é‡éƒ½å…·æœ‰å¸¸é‡å±æ€§ï¼Œä¸å¯ä¿®æ”¹ï¼›</li></ol></blockquote><p>å¯¹C++17æœ‰æ²¡æœ‰äº†è§£ï¼Ÿï¼ˆæ— ï¼‰</p><h2 id="10-stlç”¨è¿‡ä»€ä¹ˆï¼Ÿ"><a href="#10-stlç”¨è¿‡ä»€ä¹ˆï¼Ÿ" class="headerlink" title="10.stlç”¨è¿‡ä»€ä¹ˆï¼Ÿ"></a>10.stlç”¨è¿‡ä»€ä¹ˆï¼Ÿ</h2><p>æŠŠå¸¸ç”¨çš„stléƒ½è¯´äº†ä¸€é</p><p>stlçº¿ç¨‹å®‰å…¨å—ï¼Ÿå½“ç„¶ä¸</p><h2 id="11-vectorå’ŒarrayåŒºåˆ«"><a href="#11-vectorå’ŒarrayåŒºåˆ«" class="headerlink" title="11.vectorå’ŒarrayåŒºåˆ«"></a>11.vectorå’ŒarrayåŒºåˆ«</h2><p>arrayæ˜¯å®šé•¿æ•°ç»„ï¼ŒvectoråŠ¨æ€å¼€è¾Ÿ</p><p>arrayå¯ä»¥ä½¿ç”¨è¿­ä»£å™¨ï¼Œä¿è¯ä»£ç é£æ ¼ç»Ÿä¸€</p><p>è¿™é‡Œé¡ºä¾¿æåˆ°äº†<code>[]</code>çš„é‡è½½ï¼Œé¢è¯•å®˜é—®äº†vectoré‡Œé¢atå‡½æ•°å’Œ<code>[]</code>é‡è½½çš„åŒºåˆ«ï¼ˆatä¼šæŠ›å¼‚å¸¸ï¼Œ<code>[]</code>ä¸ä¼šï¼‰</p><h2 id="12-emplace-backå’Œpush-backåŒºåˆ«"><a href="#12-emplace-backå’Œpush-backåŒºåˆ«" class="headerlink" title="12.emplace_backå’Œpush_backåŒºåˆ«"></a>12.emplace_backå’Œpush_backåŒºåˆ«</h2><p>æˆ‘è¯´äº†emplace_backèƒ½èŠ‚çœä¸€æ¬¡æ‹·è´çš„æ¶ˆè€—ï¼›</p><p>é¢è¯•å®˜é—®è¦æ€ä¹ˆä½¿ç”¨æ‰èƒ½èŠ‚çœè¿™ä¸ªæ¶ˆè€—ï¼Ÿä½¿ç”¨æ–¹å¼ï¼ˆä¸ä¼šï¼‰</p><p>emplace_backæ—¢ç„¶é«˜æ•ˆï¼Œä¸ºå•¥æ²¡æœ‰å–ä»£push_backï¼Ÿï¼ˆä¸ä¼šï¼Œè¿™é‡Œæˆ‘å°±è¯´äº†ä¸€ä¸‹è®¾è®¡è€ƒè™‘å…¼å®¹æ€§çš„é—®é¢˜ï¼‰</p><h2 id="13-åˆå§‹åŒ–åˆ—è¡¨ã€æ„é€ å‡½æ•°ä½“å†…åˆå§‹åŒ–ã€æˆå‘˜å˜é‡ç»™ç¼ºçœå€¼"><a href="#13-åˆå§‹åŒ–åˆ—è¡¨ã€æ„é€ å‡½æ•°ä½“å†…åˆå§‹åŒ–ã€æˆå‘˜å˜é‡ç»™ç¼ºçœå€¼" class="headerlink" title="13.åˆå§‹åŒ–åˆ—è¡¨ã€æ„é€ å‡½æ•°ä½“å†…åˆå§‹åŒ–ã€æˆå‘˜å˜é‡ç»™ç¼ºçœå€¼"></a>13.åˆå§‹åŒ–åˆ—è¡¨ã€æ„é€ å‡½æ•°ä½“å†…åˆå§‹åŒ–ã€æˆå‘˜å˜é‡ç»™ç¼ºçœå€¼</h2><p>é‚£ä¸ªæ›´å¥½ï¼Ÿæœ‰å•¥åŒºåˆ«ï¼Ÿ</p><p>å¼•ç”¨æ˜¯æ²¡æœ‰åŠæ³•ä½¿ç”¨ç¼ºçœå€¼çš„ï¼Œåªæœ‰å¸¸é‡&#x2F;æ™®é€šå˜é‡å¯ä»¥ç”¨ç¼ºçœå€¼ï¼›</p><p>åœ¨VS2019é‡Œé¢è°ƒè¯•æµ‹è¯•äº†ä¸€ä¸‹è¿è¡Œé¡ºåºï¼š</p><ul><li>ç¼ºçœå€¼ï¼ˆä¼šä¼˜åŒ–æˆåˆå§‹åŒ–åˆ—è¡¨ï¼‰&#x2F;åˆå§‹åŒ–åˆ—è¡¨</li><li>å‡½æ•°ä½“å†…</li></ul><p>å…·ä½“çš„æµ‹è¯•å‚è€ƒ <a href="https://blog.musnow.top/posts/2894176175/">CPPç±»å’Œå¯¹è±¡é»˜è®¤æˆå‘˜å‡½æ•°</a>ï¼Œé‡Œé¢è¯¦ç»†æ³¨æ˜äº†æ„é€ é¡ºåºï¼›</p><h2 id="14-é»˜è®¤æ„é€ å‡½æ•°"><a href="#14-é»˜è®¤æ„é€ å‡½æ•°" class="headerlink" title="14.é»˜è®¤æ„é€ å‡½æ•°"></a>14.é»˜è®¤æ„é€ å‡½æ•°</h2><p>ä»€ä¹ˆæ—¶å€™å¯ä»¥ä¸è‡ªå·±å†™æ„é€ å‡½æ•°ï¼Ÿ</p><p>è¿™é‡Œæ²¡æœ‰ç­”å…¨ï¼Œæ„Ÿè§‰è‡ªå·±å·²ç»è¢«ç»•æ™•äº†</p><h2 id="15-functionå’Œbindçš„ä½œç”¨"><a href="#15-functionå’Œbindçš„ä½œç”¨" class="headerlink" title="15.functionå’Œbindçš„ä½œç”¨"></a>15.functionå’Œbindçš„ä½œç”¨</h2><p>å¦‚é¢˜</p><h2 id="16-final-x2F-overide-x2F-explicit"><a href="#16-final-x2F-overide-x2F-explicit" class="headerlink" title="16.final&#x2F;overide&#x2F;explicit"></a>16.final&#x2F;overide&#x2F;explicit</h2><p>ä½œç”¨</p><p>explicitå¿˜è®°äº†ï¼Œ<strong>é¢è¯•å®˜è¯´æ²¡å…³ç³»ï¼Œåæ­£ä¹Ÿä¸ç”¨</strong>ğŸ¤£</p><h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><h2 id="1-è¿›ç¨‹é€šä¿¡"><a href="#1-è¿›ç¨‹é€šä¿¡" class="headerlink" title="1.è¿›ç¨‹é€šä¿¡"></a>1.è¿›ç¨‹é€šä¿¡</h2><p>æœ‰å“ªäº›ï¼Œè¿™é‡Œä¸»è¦é—®äº†å…±äº«å†…å­˜å’Œç®¡é“çš„ä¼˜åŠ£ï¼Œä½¿ç”¨è°çš„èµ„æºæ¶ˆè€—æ›´ä¼˜ï¼ˆè¿™é‡Œé—®çš„æ˜¯èµ„æºæ¶ˆè€—ï¼Œä¸æ˜¯é€šä¿¡é€Ÿåº¦ï¼‰</p><blockquote><p>æˆ‘ç­”çš„æ˜¯å› ä¸ºç®¡é“æ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦ç»´æŠ¤æ–‡ä»¶å’Œè¿›ç¨‹ä¹‹é—´çš„å…³ç³»ï¼Œæ‰€ä»¥æ¶ˆè€—ä¼šé«˜ä¸€ç‚¹ï¼›ç„¶åå…±äº«å†…å­˜æ˜¯ç›´æ¥åœ¨é¡µè¡¨ä¸Šæ“ä½œï¼Œæ²¡æœ‰é¢å¤–çš„æ¶ˆè€—ï¼›</p><p>å’±ä¹Ÿä¸çŸ¥é“å¯¹ä¸å¯¹ï¼Œæ„Ÿè§‰ç­”æ¡ˆåº”è¯¥æ˜¯ä¸‹é¢è¿™ä¸ª</p><p><img src="https://img.musnow.top/i/2023/09/17766a5a0226a48b578aed58d9ed5c1d.png" alt="image-20230913212808024"></p></blockquote><p>é—®æœ‰æ²¡æœ‰ç”¨è¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆçŸ¥é“è¿™ç©æ„ï¼Œæ²¡ç”¨è¿‡ï¼‰</p><h2 id="2-è¿›ç¨‹å’Œçº¿ç¨‹åŒºåˆ«"><a href="#2-è¿›ç¨‹å’Œçº¿ç¨‹åŒºåˆ«" class="headerlink" title="2.è¿›ç¨‹å’Œçº¿ç¨‹åŒºåˆ«"></a>2.è¿›ç¨‹å’Œçº¿ç¨‹åŒºåˆ«</h2><p>è¯´äº†èµ„æºæ¶ˆè€—åŒºåˆ«ï¼ŒåŠŸèƒ½æ¯”è¾ƒéš”ç¦»çš„æ—¶å€™é€‚åˆç”¨è¿›ç¨‹ï¼Œè¿˜ä¸¾äº†ä¸ªepollçš„reactoræ¨¡å¼çš„ä¾‹å­ï¼ˆæˆ‘çç¼–çš„ï¼Œè¯´å®è¯ï¼Œä¹Ÿä¸çŸ¥é“å¯¹ä¸å¯¹ï¼‰</p><h2 id="3-å¼€å‘ç¯å¢ƒ"><a href="#3-å¼€å‘ç¯å¢ƒ" class="headerlink" title="3.å¼€å‘ç¯å¢ƒ"></a>3.å¼€å‘ç¯å¢ƒ</h2><p>å‰æœŸç”¨vs2019ï¼ŒåæœŸç”¨vscode+remote sshï¼›</p><p>é¢è¯•å®˜é—®æˆ‘å¾ˆå¤šä¸ªæ–‡ä»¶æ€ä¹ˆè¿›è¡Œç¼–è¯‘å’Œç®¡ç†ï¼Œæˆ‘è¯´äº†makefileï¼›é—®æœ‰æ²¡æœ‰ç”¨è¿‡cmakeï¼ˆæ— ï¼‰</p><h2 id="4-ç¼–è¯‘é“¾æ¥è¿‡ç¨‹"><a href="#4-ç¼–è¯‘é“¾æ¥è¿‡ç¨‹" class="headerlink" title="4.ç¼–è¯‘é“¾æ¥è¿‡ç¨‹"></a>4.ç¼–è¯‘é“¾æ¥è¿‡ç¨‹</h2><p>è¿™ä¸ªå…¶å®æ˜¯ç¬¬ä¸€ä¸ªé—®çš„é—®é¢˜ï¼Œå°±ç®€å•åœ°è¯´äº†ä¸€ä¸‹ï¼›</p><h2 id="5-åŠ¨é™æ€åº“"><a href="#5-åŠ¨é™æ€åº“" class="headerlink" title="5.åŠ¨é™æ€åº“"></a>5.åŠ¨é™æ€åº“</h2><p>æœ‰å•¥åŒºåˆ«ï¼Ÿä¼˜ç¼ºç‚¹ï¼Ÿ</p><h1 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h1><p>æ²¡æœ‰é—®ç½‘ç»œï¼Œä¹Ÿæ²¡æœ‰å†™OJï¼Œä¹Ÿæ²¡æœ‰é—®é¡¹ç›®ï¼›</p><p>è¿™æ¬¡çš„é¢è¯•å®˜å¾ˆè€å¿ƒï¼Œä¼šå¼•å¯¼ä½ å›ç­”é—®é¢˜ã€‚çˆ±äº†ï¼›</p>]]></content>
    
    
    <summary type="html">230913ä¸Šæµ·é›¶å¿µç§‘æŠ€CPPå®ä¹ ç”Ÿ</summary>
    
    
    
    <category term="æ±‚èŒè·¯ä¸Šä¸€å»ä¸å¤è¿”" scheme="https://blog.musnow.top/categories/%E6%B1%82%E8%81%8C%E8%B7%AF%E4%B8%8A%E4%B8%80%E5%8E%BB%E4%B8%8D%E5%A4%8D%E8%BF%94/"/>
    
    
    <category term="é¢ç»" scheme="https://blog.musnow.top/tags/%E9%9D%A2%E7%BB%8F/"/>
    
  </entry>
  
  <entry>
    <title>ã€MySQLã€‘äº‹åŠ¡</title>
    <link href="https://blog.musnow.top/posts/2200233148/"/>
    <id>https://blog.musnow.top/posts/2200233148/</id>
    <published>2023-09-10T00:52:14.000Z</published>
    <updated>2023-09-10T00:52:30.000Z</updated>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ äº†ä¹‹åï¼Œä½ ä¼šå¯¹MySQLå¦‚ä½•è¿›è¡Œæ•°æ®çš„è®¿é—®æ§åˆ¶æœ‰æ›´æ·±åˆ»çš„äº†è§£ï¼›</p><span id="more"></span><p>æœ¬æ–‡ä¸­æœ‰å¤§é‡æˆªå›¾ï¼Œå¦‚æœå‡ºç°404çš„å›¾ç‰‡ï¼Œè¯·è¯„è®ºå‘ŠçŸ¥ï¼Œè°¢è°¢ï¼›</p><h1 id="1-ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ" class="headerlink" title="1.ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ"></a>1.ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ</h1><h2 id="1-1-åœºæ™¯ä¸¾ä¾‹"><a href="#1-1-åœºæ™¯ä¸¾ä¾‹" class="headerlink" title="1.1 åœºæ™¯ä¸¾ä¾‹"></a>1.1 åœºæ™¯ä¸¾ä¾‹</h2><h3 id="1-1-1-è½¬è´¦"><a href="#1-1-1-è½¬è´¦" class="headerlink" title="1.1.1 è½¬è´¦"></a>1.1.1 è½¬è´¦</h3><p>å½“Aéœ€è¦ç»™Bè½¬è´¦50å…ƒçš„æ—¶å€™ï¼Œåå°åº”è¯¥è¿›è¡Œå¦‚ä½•å¤„ç†ï¼Ÿ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å…ˆåˆ¤æ–­ç”¨æˆ·è¿˜æœ‰å¤šå°‘ä½™é¢ï¼ˆè¿™é‡Œçš„user_id=Aåªæ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼ŒçŸ¥é“ä»€ä¹ˆæ„æ€å°±è¡Œï¼‰</span></span><br><span class="line"><span class="keyword">select</span> money <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> user_id<span class="operator">=</span>A;</span><br><span class="line"><span class="comment">-- å¦‚æœä½™é¢å……è¶³ï¼Œé‚£å°±ç»™Aæ‰£50</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> money <span class="operator">=</span> money <span class="operator">-</span> <span class="number">50</span> <span class="keyword">where</span> user_id<span class="operator">=</span>A;</span><br><span class="line"><span class="comment">-- ç„¶åç»™BåŠ 50</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> money <span class="operator">=</span> money <span class="operator">+</span> <span class="number">50</span> <span class="keyword">where</span> user_id<span class="operator">=</span>B;</span><br></pre></td></tr></table></figure><p>è¿™ä¸€ä¸ªæ“ä½œï¼Œéœ€è¦3ä¸ªSQLè¯­å¥æ‰èƒ½å®Œæˆï¼Œä½†å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬å³ä¾¿åœ¨å½“å‰çš„æœåŠ¡å™¨ç«¯å¯¹è¿™3æ¡è¯­å¥çš„æ“ä½œè¿›è¡ŒåŠ é”ï¼Œä¹Ÿæ²¡æœ‰åŠæ³•é¿å…å¦‚ä¸‹çš„æƒ…å†µ</p><ul><li>æœåŠ¡å™¨è´Ÿè½½è¿‡é«˜ï¼Œè¿›ç¨‹è¢«killäº†</li><li>æœåŠ¡å™¨æ–­ç”µäº†</li><li>MySQLæœåŠ¡å™¨æŠ½é£æŒ‚æ‰äº†</li><li>ç­‰ç­‰ä¸å¯æŠ—åŠ›</li></ul><p>è¿™æ—¶å€™ï¼Œå¦‚æœåœ¨æ‰§è¡Œç¬¬ä¸€æ¡æŸ¥è¯¢è¯­å¥åå°±æŒ‚æ‰äº†ï¼Œé‚£è¿˜ä¸ä¼šæœ‰å•¥é—®é¢˜ï¼›ä½†å¦‚æœæ˜¯åœ¨æ‰§è¡Œå®Œæ¯•ç¬¬äºŒæ¡æ‰£é’±çš„è¯­å¥ä¹‹åæŒ‚æ‰äº†ï¼Œé‚£é—®é¢˜å°±å¤§äº†ï¼</p><ul><li>Aç»™Bè½¬é’±ï¼ŒAçš„é’±æ‰£äº†ï¼ŒBçš„é’±æ²¡æœ‰åŠ ï¼Œè¿™æ€ä¹ˆå¯ä»¥ï¼Ÿ</li></ul><p>æœ€ç»ˆè¿˜éœ€è¦ç¨‹åºå‘˜é€šè¿‡MySQLçš„æ—¥å¿—ä¸€ä¸ªä¸ªæ ¸å¯¹åˆ°åº•æ˜¯è°å‡ºç°äº†è¿™æ ·çš„æƒ…å†µï¼Œç»™äººå®¶æŠŠé’±åŠ å›å»ï¼Œé‚£å¤ªè¿‡éº»çƒ¦ï¼›åœ¨æ•°æ®é‡å¤§çš„æ—¶å€™ï¼Œè¿™ç§å·¥ä½œæ›´æ˜¯ä¸åº”è¯¥ç”±äººå·¥æ‰‹åŠ¨å®Œæˆçš„ï¼</p><p>æ‰€ä»¥ï¼ŒMySQLå°±éœ€è¦æä¾›ä¸€ç§æ–¹æ³•ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿå®ç°ç±»ä¼¼åŸå­æ€§çš„æ“ä½œã€‚åœ¨æ‰§è¡Œè¿™3æ¡è¯­å¥çš„æ—¶å€™ï¼Œ<strong>åªèƒ½å‡ºç°ä¸¤ç§æƒ…å†µ</strong>ï¼š</p><ul><li>æˆåŠŸæ‰§è¡Œï¼ŒAæ‰£äº†é’±ï¼ŒBä¹ŸåŠ äº†é’±ï¼Œè½¬è´¦æˆåŠŸï¼›</li><li>æ‰§è¡Œå¤±è´¥ï¼Œä½†æ˜¯Aå’ŒBçš„é’±éƒ½æ²¡æœ‰å˜åŒ–ï¼Œå¹¶å‘ŠçŸ¥ç”¨æˆ·è½¬è´¦å¤±è´¥ï¼›</li></ul><p>è¿™æ ·æ‰æ˜¯é è°±çš„ç»“æœï¼</p><h3 id="1-1-2-å–ç¥¨"><a href="#1-1-2-å–ç¥¨" class="headerlink" title="1.1.2 å–ç¥¨"></a>1.1.2 å–ç¥¨</h3><p>å¦å¤–<span id="jump1">ä¸€ä¸ªåœºæ™¯</span>å°±æ˜¯å–ç¥¨ï¼Œå…¶ä¹ŸåŒ…å«äº†å¤šæ¡SQL</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> ticket <span class="keyword">where</span> tid<span class="operator">=</span>?; <span class="comment">-- æŸ¥è¯¢æŸæŸè½¦æ¬¡é«˜é“çš„ç¥¨è¿˜æœ‰æ²¡æœ‰ä½™é‡</span></span><br><span class="line"><span class="comment">-- æœ‰ä½™é‡ï¼Œè¿›è¡Œå”®å–æµç¨‹ï¼›è¿™é‡Œå¯èƒ½è¦æ“ä½œå¦å¤–ä¸€å¼ è¡¨æ¥æ·»åŠ ä¹°ç¥¨è€…çš„ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">update</span> ticket <span class="keyword">set</span> num<span class="operator">=</span>num<span class="number">-1</span> <span class="keyword">where</span> tid<span class="operator">=</span>?; <span class="comment">-- å”®å–æµç¨‹ç»“æŸï¼Œæ‰£å»è¿™å¼ ç¥¨</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæœ‰ä¸¤ä¸ªå®¢æˆ·ç«¯éƒ½åŒæ—¶æ¥æ‰§è¡Œè¿™ä¸¤æ¡SQLè¯­å¥ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°é—®é¢˜ï¼›</p><ul><li>åªå‰©ä¸€å¼ ç¥¨</li><li>å®¢æˆ·ç«¯Aè¿›è¡ŒæŸ¥è¯¢ï¼Œå‘ç°æœ‰ç¥¨ï¼Œå¼€å§‹æ‰§è¡Œå–ç¥¨æµç¨‹</li><li>å®¢æˆ·ç«¯Bè¿›è¡ŒæŸ¥è¯¢ï¼Œä¹Ÿå‘ç°æœ‰ç¥¨ï¼Œå¼€å§‹æ‰§è¡Œå–ç¥¨æµç¨‹</li><li>æ­¤æ—¶Aæ‰§è¡Œå®Œæ¯•ï¼Œå°†ç¥¨çš„æ•°é‡-1ï¼Œå–å®Œç¥¨äº†ï¼›</li><li>éšåBæ‰§è¡Œå®Œæ¯•ï¼Œä¹Ÿå°†ç¥¨çš„æ•°é‡-1ï¼Œæ­¤æ—¶å°±ä¼šå‡ºç°ç¥¨æ•°æ˜¯è´Ÿæ•°çš„æƒ…å†µï¼</li><li>æ›´éš¾å—çš„æ˜¯ï¼ŒåŒä¸€å¼ ç¥¨è¢«é”™è¯¯åœ°å–ç»™äº†ä¸¤ä¸ªç”¨æˆ·ï¼</li></ul><p>è¿™æ—¶å€™åœ¨å®¢æˆ·ç«¯é‡Œé¢åŠ é”æ˜¯ä¸é¡¶ç”¨çš„ï¼Œä¸¤ä¸ªå®¢æˆ·ç«¯éƒ½ä¸æ˜¯åŒä¸€ä¸ªè¿›ç¨‹ï¼Œé”æ— æ³•å…±äº«ï¼›éœ€è¦MySQLè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±è¿˜å¾—æä¾›æ›´åŠ ä¸¥æ ¼çš„è®¿é—®æ§åˆ¶ï¼Œåœ¨Aæ²¡æœ‰å®Œæˆæ•´ä¸ªå–ç¥¨é€»è¾‘ï¼Œç¥¨æ•°æ²¡æœ‰æ‰£æ‰çš„æƒ…å†µä¸‹ï¼Œ<strong>Bä¸å¯ä»¥æ¥æŸ¥è¯¢ç¥¨æ•°</strong>ï¼›</p><h2 id="1-2-äº‹åŠ¡çš„ä»‹ç»"><a href="#1-2-äº‹åŠ¡çš„ä»‹ç»" class="headerlink" title="1.2 äº‹åŠ¡çš„ä»‹ç»"></a>1.2 äº‹åŠ¡çš„ä»‹ç»</h2><p>äº‹åŠ¡ï¼ˆtransactionï¼‰å°±æ˜¯ä¸€ç»„DMLè¯­å¥çš„é›†åˆï¼Œè¿™äº›è¯­å¥åœ¨é€»è¾‘ä¸Šæ˜¯ä¸€ä¸ªæ•´ä½“ï¼›æ‰§è¡Œè¿™ç»„è¯­å¥ï¼Œå¿…é¡»å…¨éƒ¨æˆåŠŸï¼Œäº¦æˆ–è€…æ˜¯å…¨éƒ¨å¤±è´¥ã€‚</p><p>åœ¨æ‰§è¡Œè¿™ç»„SQLçš„æ—¶å€™ï¼ŒMySQLéœ€è¦å°†å…¶è§†ä½œä¸€ä¸ªåŸå­æ€§çš„æ“ä½œï¼›è¿™ä¸ªæ“ä½œä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡æ‰“æ–­ï¼Œå‡ºç°é—®é¢˜çš„æ—¶å€™è¿˜éœ€è¦å›æ»šåˆ°å¼€å§‹æ‰§è¡Œä¹‹å‰çš„åˆå§‹çŠ¶æ€ï¼›äº‹åŠ¡è¿˜èƒ½ä½¿ä¸åŒå®¢æˆ·ç«¯çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸åŒçš„ï¼Œä¸åŒäº‹åŠ¡ä¹‹é—´çš„æ“ä½œä¸ä¼šç›¸äº’å½±å“ï¼›åªæœ‰äº‹åŠ¡ç»“æŸåï¼ŒåŒæ–¹æ‰èƒ½çœ‹åˆ°å¯¹æ–¹çš„æ“ä½œï¼ˆæ ¹æ®éš”ç¦»çº§åˆ«ä¸åŒï¼Œè¿™ç‚¹ä¹Ÿä¼šæœ‰åŒºåˆ«ï¼‰ï¼›</p><p>æ­£å¦‚ä¸Šé¢çš„ä¸¤ä¸ªåœºæ™¯æ‰€æåˆ°çš„æ“ä½œï¼ŒåŒä¸€ä¸ªæ—¶åˆ»å¯¹äºMySQLçš„ä¸€ä¸ªæ•°æ®åº“æ¥è¯´ï¼Œå…¶å¯èƒ½æœ‰å¤šä¸ªå®¢æˆ·ç«¯è¿›è¡Œä¸åŒä¸šåŠ¡çš„æ“ä½œï¼Œå¦‚æœéƒ½åœ¨è®¿é—®åŒä¸€ä¸ªè¡¨ï¼Œåœ¨ä¸åŠ è®¿é—®æ§åˆ¶çš„æƒ…å†µä¸‹ï¼Œä¸€å®šä¼šå‡ºç°è®¿é—®ä¸´ç•Œèµ„æºçš„æ•°æ®äºŒä¹‰æ€§é—®é¢˜ã€‚</p><blockquote><p>äº‹åŠ¡çš„å‡ºç°ï¼Œæ˜¯å®¢æˆ·ç«¯åœ¨å®é™…åº”ç”¨åœºæ™¯ä¸‹çš„éœ€è¦ï¼Œ</p></blockquote><p>æ‰€ä»¥ï¼Œä¸€ä¸ªå®Œæ•´çš„äº‹åŠ¡ï¼Œé™¤äº†æ˜¯å¤šæ¡DMLè¯­å¥çš„é›†åˆï¼Œè¿˜éœ€è¦æ»¡è¶³ä¸‹é¢4ä¸ªç‰¹æ€§</p><ul><li>åŸå­æ€§ï¼šä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼›å¦‚æœäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç°é”™è¯¯ï¼Œé‚£å°±éœ€è¦å›æ»šï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„çŠ¶æ€ï¼Œå°±å¥½æ¯”è¿™ä¸ªäº‹åŠ¡å¹¶æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€èˆ¬</li><li>ä¸€è‡´æ€§ï¼šäº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œç»“æŸåï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åã€‚è¿›è¡Œçš„æ“ä½œå¤åˆæˆ‘ä»¬é¢„è®¾çš„è¦æ±‚ï¼›è¿™åŒ…å«æ•°æ®çš„å‡†ç¡®åº¦ã€ä¸²è”æ€§ä»¥åŠåç»­æ•°æ®åº“å¯ä»¥è‡ªå‘å®Œæˆé¢„å®šçš„å·¥ä½œï¼›</li><li>éš”ç¦»æ€§ï¼šæ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹æ•°æ®åº“ä¸­çš„æ•°æ®è¿›è¡ŒCURDæ“ä½œï¼Œéš”ç¦»æ€§ä¿è¯è¿™äº›äº‹åŠ¡ä¹‹é—´çš„æ“ä½œå¹¶ä¸ä¼šç”±äºå¹¶å‘çš„äº¤å‰è¿è¡Œè€Œå‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µã€‚äº‹åŠ¡éš”ç¦»æ€§åˆ†ä¸ºä¸åŒçº§åˆ«ï¼Œå…·ä½“çš„åŒºåˆ«ä¼šåœ¨åæ–‡è¯¦è§£<ul><li>è¯»æœªæäº¤ï¼ˆRead Uncommittedï¼‰</li><li>è¯»å·²æäº¤ï¼ˆRead Committedï¼‰</li><li>å¯é‡å¤è¯»ï¼ˆRepeatble Readï¼‰</li><li>ä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰</li></ul></li><li>æŒä¹…æ€§ï¼šäº‹åŠ¡å¤„ç†å®Œæ¯•åï¼Œå¯¹äº‹åŠ¡çš„ä¿®æ”¹æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿå®•æœºäº†ä¹Ÿä¸ä¼šä¸¢å¤±ï¼ˆé™¤éç¡¬ç›˜åäº†ï¼‰</li></ul><p>ä¸Šé¢çš„å››ä¸ªå±æ€§ï¼Œç®€ç§°ä¸ºACIDï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åŸå­æ€§ï¼ˆAtomicityï¼Œæˆ–ç§°ä¸å¯åˆ†å‰²æ€§ï¼‰</span><br><span class="line">ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</span><br><span class="line">éš”ç¦»æ€§ï¼ˆIsolationï¼Œåˆç§°ç‹¬ç«‹æ€§ï¼‰</span><br><span class="line">æŒä¹…æ€§ï¼ˆDurabilityï¼‰</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œä¸€è‡´æ€§æ˜¯ç”±åŸå­æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§æ¥ä¿è¯çš„ï¼Œåªè¦æ»¡è¶³äº†è¿™ä¸‰ä¸ªæ€§è´¨ï¼Œè‡ªç„¶èƒ½å®ç°ä¸€è‡´æ€§ã€‚ç®€å•è®°å¿†ï¼ŒAIDæ¥ä¿è¯Cï¼›</p><h2 id="1-3-äº‹åŠ¡çš„å­˜å‚¨å¼•æ“æ”¯æŒ"><a href="#1-3-äº‹åŠ¡çš„å­˜å‚¨å¼•æ“æ”¯æŒ" class="headerlink" title="1.3 äº‹åŠ¡çš„å­˜å‚¨å¼•æ“æ”¯æŒ"></a>1.3 äº‹åŠ¡çš„å­˜å‚¨å¼•æ“æ”¯æŒ</h2><p>åœ¨MySQLä¸­ï¼Œåªæœ‰<code>Innodb</code>æ”¯æŒäº‹åŠ¡ï¼Œ<code>MyISAM</code>æ˜¯ä¸æ”¯æŒäº‹åŠ¡çš„ï¼›</p><p>æˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹è¯­å¥æ¥æŸ¥è¯¢MySQLçš„å¼•æ“å’Œæ”¯æŒçš„ç‰¹æ€§</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello_mysql]<span class="operator">&gt;</span> <span class="keyword">show</span> engines \G</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">      Engine: MEMORY</span><br><span class="line">     Support: YES</span><br><span class="line">     Comment: Hash based, stored <span class="keyword">in</span> memory, useful <span class="keyword">for</span> temporary tables</span><br><span class="line">Transactions: <span class="keyword">NO</span></span><br><span class="line">          XA: <span class="keyword">NO</span></span><br><span class="line">  Savepoints: <span class="keyword">NO</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">2.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">      Engine: MRG_MyISAM</span><br><span class="line">     Support: YES</span><br><span class="line">     Comment: Collection <span class="keyword">of</span> identical MyISAM tables</span><br><span class="line">Transactions: <span class="keyword">NO</span></span><br><span class="line">          XA: <span class="keyword">NO</span></span><br><span class="line">  Savepoints: <span class="keyword">NO</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">3.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">      Engine: CSV</span><br><span class="line">     Support: YES</span><br><span class="line">     Comment: Stores tables <span class="keyword">as</span> CSV files</span><br><span class="line">Transactions: <span class="keyword">NO</span></span><br><span class="line">          XA: <span class="keyword">NO</span></span><br><span class="line">  Savepoints: <span class="keyword">NO</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">4.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">      Engine: BLACKHOLE</span><br><span class="line">     Support: YES</span><br><span class="line">     Comment: <span class="operator">/</span>dev<span class="operator">/</span><span class="keyword">null</span> storage engine (anything you write <span class="keyword">to</span> it disappears)</span><br><span class="line">Transactions: <span class="keyword">NO</span></span><br><span class="line">          XA: <span class="keyword">NO</span></span><br><span class="line">  Savepoints: <span class="keyword">NO</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">5.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">      Engine: MyISAM</span><br><span class="line">     Support: YES</span><br><span class="line">     Comment: Non<span class="operator">-</span>transactional engine <span class="keyword">with</span> good performance <span class="keyword">and</span> small data footprint</span><br><span class="line">Transactions: <span class="keyword">NO</span></span><br><span class="line">          XA: <span class="keyword">NO</span></span><br><span class="line">  Savepoints: <span class="keyword">NO</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">6.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">      Engine: ARCHIVE</span><br><span class="line">     Support: YES</span><br><span class="line">     Comment: gzip<span class="operator">-</span>compresses tables <span class="keyword">for</span> a low storage footprint</span><br><span class="line">Transactions: <span class="keyword">NO</span></span><br><span class="line">          XA: <span class="keyword">NO</span></span><br><span class="line">  Savepoints: <span class="keyword">NO</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">7.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">      Engine: FEDERATED</span><br><span class="line">     Support: YES</span><br><span class="line">     Comment: Allows <span class="keyword">to</span> access tables <span class="keyword">on</span> other MariaDB servers, supports transactions <span class="keyword">and</span> more</span><br><span class="line">Transactions: YES</span><br><span class="line">          XA: <span class="keyword">NO</span></span><br><span class="line">  Savepoints: YES</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">8.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">      Engine: PERFORMANCE_SCHEMA</span><br><span class="line">     Support: YES</span><br><span class="line">     Comment: Performance Schema</span><br><span class="line">Transactions: <span class="keyword">NO</span></span><br><span class="line">          XA: <span class="keyword">NO</span></span><br><span class="line">  Savepoints: <span class="keyword">NO</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">9.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">      Engine: SEQUENCE</span><br><span class="line">     Support: YES</span><br><span class="line">     Comment: Generated tables filled <span class="keyword">with</span> sequential <span class="keyword">values</span></span><br><span class="line">Transactions: YES</span><br><span class="line">          XA: <span class="keyword">NO</span></span><br><span class="line">  Savepoints: YES</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">10.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">      Engine: InnoDB</span><br><span class="line">     Support: <span class="keyword">DEFAULT</span> <span class="comment">-- é»˜è®¤å¼•æ“</span></span><br><span class="line">     Comment: Supports transactions, <span class="type">row</span><span class="operator">-</span>level locking, <span class="keyword">foreign</span> keys <span class="keyword">and</span> encryption <span class="keyword">for</span> tables <span class="comment">-- æè¿°</span></span><br><span class="line">Transactions: YES  <span class="comment">-- æ”¯æŒäº‹åŠ¡</span></span><br><span class="line">          XA: YES  </span><br><span class="line">  Savepoints: YES  <span class="comment">-- æ”¯æŒäº‹åŠ¡ä¸­çš„ä¿å­˜ç‚¹</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">11.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">      Engine: Aria</span><br><span class="line">     Support: YES</span><br><span class="line">     Comment: Crash<span class="operator">-</span>safe tables <span class="keyword">with</span> MyISAM heritage</span><br><span class="line">Transactions: <span class="keyword">NO</span></span><br><span class="line">          XA: <span class="keyword">NO</span></span><br><span class="line">  Savepoints: <span class="keyword">NO</span></span><br><span class="line"><span class="number">11</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.000</span> sec)</span><br></pre></td></tr></table></figure><h2 id="1-4-ä¿å­˜ç‚¹"><a href="#1-4-ä¿å­˜ç‚¹" class="headerlink" title="1.4 ä¿å­˜ç‚¹"></a>1.4 ä¿å­˜ç‚¹</h2><p>æ‰€è°“ä¿å­˜ç‚¹ï¼Œå°±æ˜¯åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç»™å½“å‰çš„æ•°æ®è®¾ç½®ä¸€ä¸ªsavepointï¼Œè¿™æ ·åœ¨å‡ºç°é—®é¢˜çš„æ—¶å€™ï¼Œå¯ä»¥å›é€€åˆ°å½“å‰çš„æ•°æ®ä¸­ï¼›å°±å¥½æ¯”ä¹‹åçš„æ“ä½œæ²¡æœ‰è¿›è¡Œä¸€æ ·ï¼›</p><p>æ¸¸æˆä¸­çš„ä¿å­˜ç‚¹å…¶å®ä¹Ÿæ˜¯è¿™æ ·çš„åŠŸèƒ½ï¼Œè®©ç©å®¶å›é€€åˆ°æ‰“æŸä¸ªBOSSä¹‹å‰ï¼ŒåŒ…æ‹¬å½“æ—¶ä½ æ”¶é›†çš„ææ–™ï¼Œéƒ½ä¼šå›é€€åˆ°æ‰“è¿™ä¸ªBOSSä¹‹å‰çš„çŠ¶æ€ï¼›</p><p>ä½ å¯ä»¥ç†è§£ä¸ºï¼Œæ˜¯ç»™å½“å‰çš„æ•°æ®æ‹äº†å¼ ç…§ç‰‡ï¼Œå‡ºç°é—®é¢˜çš„æ—¶å€™ï¼Œç”¨è¿™ä¸ªç…§ç‰‡é‡Œé¢çš„ä¸œè¥¿å¤å†™æ‰æ–°çš„ä¸œè¥¿ã€‚è¿™ä¾¿æ˜¯ä¿å­˜ç‚¹çš„ä½œç”¨ï¼›</p><h2 id="1-5-åŸºç¡€å‘½ä»¤æ“ä½œ"><a href="#1-5-åŸºç¡€å‘½ä»¤æ“ä½œ" class="headerlink" title="1.5 åŸºç¡€å‘½ä»¤æ“ä½œ"></a>1.5 åŸºç¡€å‘½ä»¤æ“ä½œ</h2><p>å…ˆæä¸€ä¸‹äº‹åŠ¡çš„å¼€å¯å’Œç»“æŸæ–¹å¼ï¼Œä»¥åŠå¦‚ä½•è®¾ç½®ä¿å­˜ç‚¹å’Œå›æ»šå§</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¼€å¯ï¼Œè¿™ä¸¤ç§æ–¹å¼æ˜¯ä¸€æ ·çš„</span></span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">start</span> transaction;</span><br><span class="line"><span class="comment">-- è®¾ç½®ä¿å­˜ç‚¹ï¼ˆåå­—å¯ä»¥è‡ªç”±æ›´æ”¹ï¼Œä½†ä¸èƒ½æœ‰é‡å¤ï¼‰</span></span><br><span class="line"><span class="keyword">savepoint</span> save1; <span class="comment">-- åˆ›å»ºä¸€ä¸ªä¿å­˜ç‚¹save1</span></span><br><span class="line"><span class="keyword">rollback</span> <span class="keyword">to</span> save1; <span class="comment">-- å›æ»šåˆ°ä¿å­˜ç‚¹save1</span></span><br><span class="line"><span class="keyword">rollback</span>; <span class="comment">-- å›æ»šåˆ°äº‹åŠ¡å¼€å§‹</span></span><br><span class="line"><span class="comment">-- ç»“æŸ</span></span><br><span class="line"><span class="keyword">commit</span>; <span class="comment">-- æäº¤äº‹åŠ¡</span></span><br></pre></td></tr></table></figure><h1 id="2-ä½¿ç”¨"><a href="#2-ä½¿ç”¨" class="headerlink" title="2.ä½¿ç”¨"></a>2.ä½¿ç”¨</h1><p>äº†è§£äº†äº‹åŠ¡ä¸ºä»€ä¹ˆå­˜åœ¨ï¼Œä¸‹é¢å°±æ˜¯æ¥ä½¿ç”¨ä¸€ä¸‹äº‹åŠ¡äº†ï¼›</p><h2 id="2-1-æäº¤æ–¹å¼"><a href="#2-1-æäº¤æ–¹å¼" class="headerlink" title="2.1 æäº¤æ–¹å¼"></a>2.1 æäº¤æ–¹å¼</h2><p>äº‹åŠ¡çš„æäº¤æ–¹å¼æœ‰ä¸¤ç§æ–¹å¼</p><ul><li>è‡ªåŠ¨æäº¤</li><li>æ‰‹åŠ¨æäº¤</li></ul><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMySQLçš„è‡ªåŠ¨æäº¤æ˜¯å¤„äºå¼€å¯çŠ¶æ€çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello_mysql]&gt; show variables like &#x27;autocommit&#x27;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| autocommit    | ON    |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.001 sec)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„è¯­å¥æ¥è®¾ç½®æ˜¯å¦å¼€å¯è‡ªåŠ¨æäº¤ï¼ˆåªå¯¹å½“å‰ä¼šè¯ç”Ÿæ•ˆï¼‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> autocommit <span class="operator">=</span> <span class="number">0</span>; <span class="comment">-- å…³é—­è‡ªåŠ¨æäº¤</span></span><br><span class="line"><span class="keyword">set</span> autocommit <span class="operator">=</span> <span class="number">1</span>; <span class="comment">-- å¼€å¯</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªæäº¤æ–¹å¼æœ‰å•¥åŒºåˆ«å‘¢ï¼Ÿæ˜¯ä¸æ˜¯å¼€äº†è‡ªåŠ¨æäº¤å°±ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡äº†ï¼Ÿåæ–‡æˆ‘ä»¬å†é€šè¿‡å®æµ‹æ¥è¯´æ˜ï¼›</p><h2 id="2-2-åœºæ™¯æ¼”ç¤º"><a href="#2-2-åœºæ™¯æ¼”ç¤º" class="headerlink" title="2.2 åœºæ™¯æ¼”ç¤º"></a>2.2 åœºæ™¯æ¼”ç¤º</h2><p>æœ€å¼€å§‹æµ‹è¯•çš„æ—¶å€™ï¼Œå…ˆå°†äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºè¯»æœªæäº¤ï¼›è¯·æ³¨æ„ï¼Œä¸è¦åœ¨æœ‰ç”Ÿäº§ç¯å¢ƒçš„MySQLä¸­è¿›è¡Œæ­¤é¡¹æ“ä½œï¼›</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è®¾ç½®å…¨å±€éš”ç¦»çº§åˆ«ä¸ºè¯»æœªæäº¤</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level READ UNCOMMITTED; </span><br><span class="line"><span class="comment">-- é‡å¯mysqlç»ˆç«¯åæŸ¥çœ‹éš”ç¦»çº§åˆ«</span></span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@tx</span>_isolation; </span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@tx</span>_isolation   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+</span></span><br><span class="line"><span class="operator">|</span> READ<span class="operator">-</span>UNCOMMITTED <span class="operator">|</span>   <span class="comment">-- æˆåŠŸè®¾ç½®è¯»æœªæäº¤çš„éš”ç¦»çº§çº§åˆ«</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.000</span> sec)</span><br></pre></td></tr></table></figure><h3 id="2-2-1-æ•°æ®å›æ»šæ¼”ç¤º"><a href="#2-2-1-æ•°æ®å›æ»šæ¼”ç¤º" class="headerlink" title="2.2.1 æ•°æ®å›æ»šæ¼”ç¤º"></a>2.2.1 æ•°æ®å›æ»šæ¼”ç¤º</h3><p>è®¾ç½®å®Œæ¯•åï¼Œè¿›å…¥æµ‹è¯•æ•°æ®åº“ï¼Œåˆ›å»ºå¦‚ä¸‹æµ‹è¯•è¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test_ruc(</span><br><span class="line">id <span class="type">int</span> unsigned <span class="keyword">primary</span> key,</span><br><span class="line">user_id <span class="type">int</span> unsigned <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>å…ˆç»™è¡¨é‡Œé¢æ’å…¥å‡ ä¸ªåŸºæœ¬çš„æ•°æ®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test_ruc <span class="keyword">values</span> (<span class="number">1</span>,<span class="number">10</span>,<span class="string">&#x27;æå&#x27;</span>),(<span class="number">2</span>,<span class="number">20</span>,<span class="string">&#x27;ç‹äº”&#x27;</span>);</span><br></pre></td></tr></table></figure><p>æ’å…¥åï¼Œæˆ‘ä»¬åœ¨ä¸¤ä¾§çš„ç»ˆç«¯ä¸­éƒ½å¯ä»¥çœ‹åˆ°å·²æœ‰çš„æ•°æ®</p><p><img src="https://img.musnow.top/i/2023/09/319fbe3f23373d34fb0eff4a249ef16b.png" alt="image-20230910163833837"></p><p>éšååœ¨ä¸¤ä¸ªç»ˆç«¯ä¸­éƒ½å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œå·¦ä¾§ç»ˆç«¯æ’å…¥ä¸€ä¸ªæ•°æ®ï¼Œå³ä¾§ç»ˆç«¯æŸ¥çœ‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test_ruc <span class="keyword">values</span> (<span class="number">3</span>,<span class="number">30</span>,<span class="string">&#x27;å·¦ä¾§ç»ˆç«¯æ’å…¥&#x27;</span>);</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¾§çš„ç»ˆç«¯éƒ½å¯ä»¥çœ‹åˆ°è¿™ä»½æ•°æ®</p><p><img src="https://img.musnow.top/i/2023/09/8021cf95d4fa8a29c24771161f17cf52.png" alt="image-20230910164315360"></p><p>æ­¤æ—¶å°†å·¦ä¾§ç»ˆç«¯å¼ºåˆ¶é€€å‡ºï¼ˆä½¿ç”¨<code>CTRL+\</code>ï¼‰ï¼Œå³ä¾§å†æ¬¡æŸ¥è¯¢ï¼Œä¼šå‘ç°æ–°æ’å…¥çš„æ•°æ®æ²¡æœ‰äº†ï¼›è¿™é‡Œä¾¿æ˜¯äº‹åŠ¡çš„<strong>åŸå­æ€§</strong>çš„ä½“ç°ï¼Œå·¦ä¾§çš„ç»ˆç«¯æ‰€æ‰§è¡Œçš„äº‹åŠ¡æ²¡æœ‰<code>commit</code>å°±å› ä¸ºå¼‚å¸¸é€€å‡ºäº†ï¼ŒMySQLè‡ªåŠ¨å°†æ•°æ®å›æ»šåˆ°äº†è¿™ä¸ªäº‹åŠ¡æ‰§è¡Œä¹‹å‰ï¼Œå³æ²¡æœ‰æ’å…¥è¿™ä»½æ–°æ•°æ®ï¼›</p><p><img src="https://img.musnow.top/i/2023/09/db2ea78350e2fe7927f8367f7aecf2db.png" alt="image-20230910164414488"></p><p>å·¦ä¾§é‡æ–°é“¾æ¥MySQLï¼Œå¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼›åœ¨å³ä¾§æ’å…¥ä¸€ä¸ªæ•°æ®ï¼Œéšååˆ›å»ºä¿å­˜ç‚¹<code>save1</code>ï¼›æ’å…¥ç¬¬äºŒä¸ªæ•°æ®ï¼Œåˆ›å»ºä¿å­˜ç‚¹<code>save2</code>ï¼›</p><p>åœ¨å·¦ä¾§æŸ¥è¯¢ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å³ä¾§æ’å…¥çš„ä¸¤æ¡æ–°æ•°æ®ï¼›</p><p><img src="https://img.musnow.top/i/2023/09/cf012a62e99049bc5b41b66583e7b49a.png" alt="image-20230910165426916"></p><p>åœ¨å³ä¾§å›æ»šåˆ°ä¿å­˜ç‚¹save1ï¼Œä¼šå‘ç°æ’å…¥çš„æ•°æ®2æ²¡æœ‰äº†ï¼›è¿™ä¸ä¿å­˜ç‚¹çš„é¢„æœŸæ“ä½œç›¸ç¬¦åˆï¼›</p><p><img src="https://img.musnow.top/i/2023/09/99e569e2c4fde9770594fc1176aa52ec.png" alt="image-20230910165719357"></p><p>å°†å³ä¾§ç»ˆç«¯å¼ºåˆ¶é€€å‡ºï¼Œå†æ¬¡æŸ¥è¯¢æ•°æ®ï¼Œå¯ä»¥çœ‹åˆ°ç¬¬ä¸€æ¬¡æ’å…¥çš„æ•°æ®ä¹Ÿæ²¡æœ‰äº†ï¼Œæ•°æ®åˆå›åˆ°äº†å³ä¾§ç»ˆç«¯äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„æ ·å­ã€‚</p><p><img src="https://img.musnow.top/i/2023/09/60cb747da1ac4756bce1c6e6ff12ace0.png" alt="image-20230910171826318"></p><p>è¿™é‡Œèƒ½å¾—å‡ºä¸€ä¸ªç»“è®ºï¼šå¦‚æœç»ˆç«¯å¼‚å¸¸é€€å‡ºï¼ŒMySQLä¼šå°†æ•°æ®å›æ»šåˆ°äº‹åŠ¡å¼€å§‹æ—¶ï¼›ä½ å¯ä»¥ç†è§£ä¸ºï¼Œæˆ‘ä»¬ä½¿ç”¨<code>begin;</code>çš„æ—¶å€™å°±å·²ç»åˆ›å»ºäº†ä¸€ä¸ªéšè—çš„ä¿å­˜ç‚¹ï¼ŒMySQLåœ¨å¼‚å¸¸çš„æ—¶å€™åªä¼šå°†æ•°æ®å›é€€åˆ°è¿™ä¸ª<strong>äº‹åŠ¡å¼€å§‹ä¹‹æ—¶</strong>çš„éšè—ä¿å­˜ç‚¹ï¼Œæ— è®ºä¸­é€”ç”¨æˆ·æœ‰æ²¡æœ‰è®¾ç½®å…¶ä»–ä¿å­˜ç‚¹ï¼</p><p>å³ï¼šåœ¨å¼‚å¸¸é€€å‡ºçš„æ—¶å€™ï¼ŒMySQLä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æ‰§è¡Œ<code>rollback</code>å‘½ä»¤å›é€€åˆ°äº‹åŠ¡å¼€å¤´ï¼</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">rollback</span>; <span class="comment">-- å›é€€åˆ°äº‹åŠ¡å¼€å¤´</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±èƒ½é¿å…æœ€å¼€å§‹æåˆ°çš„ï¼Œè½¬è´¦ç³»ç»Ÿä¸­ç»™Aæ‰£äº†é’±ä½†æ˜¯æ²¡æœ‰ç»™BåŠ é’±çš„é—®é¢˜ï¼</p><h3 id="2-2-2-æ•°æ®æŒä¹…åŒ–æ¼”ç¤º"><a href="#2-2-2-æ•°æ®æŒä¹…åŒ–æ¼”ç¤º" class="headerlink" title="2.2.2 æ•°æ®æŒä¹…åŒ–æ¼”ç¤º"></a>2.2.2 æ•°æ®æŒä¹…åŒ–æ¼”ç¤º</h3><p>æ¥ç€æˆ‘ä»¬å†æ¥çœ‹çœ‹ï¼Œå¦‚æœæ‰§è¡Œäº†commitä¹‹ååˆä¼šæ˜¯ä»€ä¹ˆæƒ…å†µï¼›</p><p>å³ä¾§æäº¤äº†äº‹åŠ¡åé€€å‡ºï¼Œå·¦ä¾§ä¾æ—§èƒ½æŸ¥è¯¢å€’å·²ç»æäº¤çš„æ•°æ®ã€‚ä»£è¡¨æ•°æ®å·²ç»è¢«æŒä¹…åŒ–å†™å…¥åˆ°äº†ç£ç›˜ï¼ˆå½“ç„¶è¿™ä¸ªæ—¶å€™ä¹Ÿä¸ä¸€å®šç«‹åˆ»åˆ·ç›˜äº†ï¼Œä½†æ˜¯è¿™å·²ç»èƒ½ä»£è¡¨MySQLå°†æˆ‘ä»¬çš„æ•°æ®åŠ å…¥åˆ°äº†æŒä¹…åŒ–ç­–ç•¥ä¸­ï¼Œå¹¶ä¸éœ€è¦æˆ‘ä»¬ç®¡å•¥æ—¶å€™åˆ·ç›˜çš„é—®é¢˜ï¼ï¼‰</p><p><img src="https://img.musnow.top/i/2023/09/e04e7e3b782a176b62e140c1143b1695.png" alt="image-20230910213252764"></p><h3 id="2-2-3-è‡ªåŠ¨æäº¤"><a href="#2-2-3-è‡ªåŠ¨æäº¤" class="headerlink" title="2.2.3 è‡ªåŠ¨æäº¤"></a>2.2.3 è‡ªåŠ¨æäº¤</h3><p>å‰é¢æåˆ°äº†ï¼ŒMySQLçš„è‡ªåŠ¨æäº¤é»˜è®¤æ˜¯å¼€å¯çš„ï¼›é‚£ä¹ˆè¿™ä¸ªè‡ªåŠ¨æäº¤æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿæ˜¯ä¸æ˜¯å¼€å¯äº†è‡ªåŠ¨æäº¤ï¼Œå°±ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºäº‹åŠ¡äº†ï¼Ÿ</p><p><strong>å¹¶ä¸æ˜¯</strong>ï¼åœ¨ä¹‹å‰çš„æµ‹è¯•ä¸­ï¼Œ<code>autocommit</code>æ˜¯å¼€å¯çš„ï¼›æˆ‘ä»¬å·²ç»è¯æ˜äº†ï¼Œæ‰‹åŠ¨<code>begin</code>åˆ›å»ºçš„äº‹åŠ¡ï¼Œåœ¨æ²¡æœ‰æ‰‹åŠ¨<code>commit</code>çš„æ—¶å€™ä¸ä¼šè¢«å†™å…¥ç£ç›˜ï¼ˆä¸è¿›è¡ŒæŒä¹…åŒ–ï¼‰ï¼›è¿™ä»£è¡¨æˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºçš„äº‹åŠ¡ï¼Œä¸ä¼šå—åˆ°<code>autocommit</code>æ˜¯å¦å¼€å…³çš„å½±å“ï¼›ï¼ˆå¼€ç€çš„æ—¶å€™éƒ½æ²¡æœ‰è‡ªåŠ¨æäº¤ï¼Œå…³é—­çš„æ—¶å€™è‚¯å®šæ›´ä¸ä¼šè‡ªåŠ¨æäº¤äº†ï¼‰</p><ul><li>é‚£ä¹ˆè¿™ä¸ª<code>autocommit</code>ä¼šå½±å“è°å‘¢ï¼Ÿ</li></ul><p>å¼€å¯ä¸¤ä¸ªç»ˆç«¯ï¼Œå·¦ä¾§å°†è‡ªåŠ¨æäº¤å…³é—­ï¼Œéšåæ’å…¥ä¸€ä¸ªæ•°æ®ï¼›æ’å…¥åä¼šå‘ç°å³ä¾§çœ‹ä¸åˆ°å·¦ä¾§æ–°æ’å…¥çš„æ•°æ®ï¼</p><blockquote><p>å¤‡æ³¨ï¼š<code>set autocommit = 0;</code>è¯­å¥åªä¼šå½±å“å½“å‰ç»ˆç«¯ï¼Œä¸ä¼šå½±å“å¦å¤–çš„ç»ˆç«¯ã€‚</p></blockquote><p><img src="https://img.musnow.top/i/2023/09/05a473c988222c4e9f669040110ce010.png" alt="image-20230911081342217"></p><p>æ­¤æ—¶æ‰‹åŠ¨è¿›è¡Œ<code>commit</code>ï¼Œå³ä¾§å°±çœ‹å¾—åˆ°æ•°æ®äº†ï¼</p><p><img src="https://img.musnow.top/i/2023/09/b0c20ecfa43ae1ba23143c78abea5a3d.png" alt="image-20230911081509985"></p><p>è€Œå¦‚æœæˆ‘ä»¬ä¸æ‰‹åŠ¨æ‰§è¡Œ<code>commit</code>å°±æŠŠå·¦ä¾§ç»ˆç«¯<code>CTRL+\</code>é€€å‡ºï¼Œé‚£ä¹ˆæ–°æ’å…¥çš„è¿™ä¸€æ¡æ•°æ®ä¼šä¸¢å¤±ï¼</p><h3 id="2-2-4-å•æ¡SQLå’Œäº‹åŠ¡çš„å…³ç³»"><a href="#2-2-4-å•æ¡SQLå’Œäº‹åŠ¡çš„å…³ç³»" class="headerlink" title="2.2.4 å•æ¡SQLå’Œäº‹åŠ¡çš„å…³ç³»"></a>2.2.4 å•æ¡SQLå’Œäº‹åŠ¡çš„å…³ç³»</h3><p>æ¬¸ï¼Ÿæˆ‘ä»¬æ˜æ˜æ²¡æœ‰<code>begin</code>å¼€å¯äº‹åŠ¡ï¼Œä¸ºä»€ä¹ˆå¯ä»¥æ‰§è¡Œ<code>commit</code>å‘¢ï¼Ÿ</p><p>è¿™æ˜¯å› ä¸ºï¼Œåœ¨MySQLä¸­ï¼Œæ¯ä¸€ä¸ªä¸ä¸»åŠ¨ä½¿ç”¨äº‹åŠ¡çš„å•æ¡SQLè¯­å¥ï¼Œéƒ½ä¼šè§†ä½œä¸€ä¸ªäº‹åŠ¡è¿›è¡Œæ“ä½œï¼æ—¢æˆ‘ä»¬ä¹‹å‰æ²¡å­¦ä¹ äº‹åŠ¡æ—¶ï¼Œæ‰§è¡Œçš„æ‰€æœ‰å•æ¡SQLä¹Ÿæ˜¯ä¸€ä¸ªä¸ªå„è‡ªç‹¬ç«‹çš„äº‹åŠ¡ï¼</p><p>çŸ¥é“äº†è¿™ä¸€ç‚¹ï¼Œä½ å°±èƒ½ç†è§£<strong>è‡ªåŠ¨æäº¤çš„ä½œç”¨</strong>äº†ï¼šåœ¨æ‰§è¡Œå•æ¡SQLçš„æ—¶å€™ï¼Œæ˜¯å¦è‡ªåŠ¨æäº¤è¯¥SQLè¯­å¥çš„äº‹åŠ¡ã€‚</p><p>å°†<code>autocommit</code>é‡æ–°å¼€å¯ï¼Œå†è¿›è¡Œæµ‹è¯•ï¼›ä¼šå‘ç°å·¦ä¾§æ’å…¥çš„æ•°æ®å³ä¾§å¯ä»¥ç«‹é©¬çœ‹åˆ°ï¼Œæ— éœ€æ‰‹åŠ¨<code>commit</code>ã€‚è¿™ä¾¿æ˜¯è‡ªåŠ¨æäº¤çš„ä½œç”¨çš„ä½“ç°ï¼</p><p><img src="https://img.musnow.top/i/2023/09/2fa8f41ee1644efb200d2fdbe65677ac.png" alt="image-20230911082134863"></p><h2 id="2-3-ç»“è®º"><a href="#2-3-ç»“è®º" class="headerlink" title="2.3 ç»“è®º"></a>2.3 ç»“è®º</h2><p>ç»è¿‡ä¸Šé¢çš„è¿™äº›ç®€å•æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°äº‹åŠ¡çš„åŸå­æ€§å’ŒæŒä¹…æ€§ï¼Œåšä¸€ä¸ªæ€»ç»“</p><ul><li>è¾“å…¥äº†<code>begin/start transaction</code>æ‰‹åŠ¨åˆ›å»ºçš„äº‹åŠ¡ï¼Œå¿…é¡»é€šè¿‡<code>commit</code>æ‰‹åŠ¨æŒ¡æäº¤ï¼Œæ‰ä¼šæŒä¹…åŒ–ï¼›è¿™ä¸€ç‚¹å’Œ<code>autocommit</code>æ— å…³ï¼</li><li>äº‹åŠ¡å¯ä»¥è®¾ç½®ä¿å­˜ç‚¹å’Œæ‰‹åŠ¨å›æ»šï¼Œå‡ºç°å¼‚å¸¸çš„æ—¶å€™ï¼ŒMySQLä¼šè‡ªåŠ¨å›é€€åˆ°äº‹åŠ¡å¼€å¤´ï¼›</li><li>å¯¹äº<code>InnoDB</code>å­˜å‚¨å¼•æ“è€Œè¨€ï¼Œæ‰€æœ‰çš„å•æ¡SQLè¯­å¥éƒ½ä¼šè¢«è§†ä½œä¸€ä¸ªäº‹åŠ¡ï¼Œè‡ªåŠ¨æäº¤ï¼›</li><li><code>select</code>è¯­å¥ä¼šæœ‰ä¸€äº›å·®åˆ«ï¼Œå› ä¸ºMySQLæœ‰MVCCè®¿é—®æ§åˆ¶ï¼ˆåæ–‡è®²è§£ï¼‰</li></ul><p>æ“ä½œäº‹åŠ¡çš„ä¸€äº›æ³¨æ„äº‹é¡¹</p><ul><li>åªæœ‰<code>InnoDB</code>æ‰æ”¯æŒäº‹åŠ¡ï¼Œ<code>MyISAM</code>ä¸æ”¯æŒ;</li><li>ä¸€ä¸ªäº‹åŠ¡è¢«æäº¤äº†ä¹‹åï¼Œä¸å¯ä»¥æ‰§è¡Œ<code>rollback</code>;</li><li>åˆ›å»ºäº†ä¿å­˜ç‚¹åï¼Œå¯ä»¥é€‰æ‹©å›é€€åˆ°å“ªä¸€ä¸ªä¿å­˜ç‚¹ï¼Œäº¦æˆ–è€…æ˜¯å›é€€åˆ°äº‹åŠ¡å¼€å¤´ï¼›</li></ul><h1 id="3-äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#3-äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="3.äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>3.äº‹åŠ¡éš”ç¦»çº§åˆ«</h1><h2 id="3-1-åŸºæœ¬è¯´æ˜"><a href="#3-1-åŸºæœ¬è¯´æ˜" class="headerlink" title="3.1 åŸºæœ¬è¯´æ˜"></a>3.1 åŸºæœ¬è¯´æ˜</h2><p>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«å’Œäº‹åŠ¡çš„éš”ç¦»æ€§æ¯æ¯ç›¸å…³</p><ul><li>MySQLçš„å•ä¸ªæ•°æ®åº“å¯èƒ½è¢«å¤šä¸ªè¿›ç¨‹&#x2F;çº¿ç¨‹åŒæ—¶è¿›è¡Œè®¿é—®å’Œäº‹åŠ¡æ“ä½œï¼›</li><li>ä¸€ä¸ªäº‹åŠ¡æ˜¯ç”±å¤šä¸ªSQLè¯­å¥ç»„æˆçš„ï¼Œä»»ä½•ä¸€ä¸ªäº‹åŠ¡ï¼Œéƒ½ä¼šå­˜åœ¨æ‰§è¡Œå‰&#x2F;ä¸­&#x2F;åçš„é˜¶æ®µã€‚æ‰€è°“åŸå­æ€§ï¼Œå°±æ˜¯MySQLè¦ä¿è¯å„ä¸ªå®¢æˆ·ç«¯è¦ä¹ˆåªèƒ½çœ‹åˆ°äº‹åŠ¡æ‰§è¡Œå‰æˆ–è€…æ‰§è¡Œåçš„æ•°æ®ï¼›æ‰§è¡Œä¸­çš„äº‹åŠ¡ï¼Œå¯¹äºå…¶ä»–ç”¨æˆ·æ¥çœ‹æ˜¯åŸå­çš„ï¼Œå‡ºç°å¼‚å¸¸ä¼šè¢«è‡ªåŠ¨å›æ»šï¼›</li><li>ä½†äº‹åŠ¡æ¯•ç«Ÿè¿˜æ˜¯å­˜åœ¨æ‰§è¡Œä¸­çš„æ¦‚å¿µï¼Œå…¶ä»–å®¢æˆ·ç«¯æ˜¯æœ‰å¯èƒ½çœ‹åˆ°æŸä¸ªäº‹ç‰©æ‰§è¡Œä¸­çš„çŠ¶æ€çš„ï¼Œè¿™å°±éœ€è¦éš”ç¦»æ€§æ¥ä»‹å…¥äº†ï¼›</li><li>éš”ç¦»æ€§ï¼šä¿è¯äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å°½é‡ä¸å—å¹²æ‰°ï¼›</li><li>éš”ç¦»çº§åˆ«ï¼šå…è®¸äº‹åŠ¡å—ä¸åŒç¨‹åº¦çš„å¹²æ‰°ï¼›</li></ul><p>å¼€å¤´å°±æåˆ°äº†ï¼ŒMySQLçš„äº‹åŠ¡æœ‰4ç§éš”ç¦»çº§åˆ«</p><ul><li>è¯»æœªæäº¤ï¼ˆRead Uncommittedï¼‰ï¼šåœ¨è¿™ä¸ªéš”ç¦»çº§åˆ«ä¸­ï¼Œæ‰€æœ‰äº‹åŠ¡éƒ½å¯ä»¥çœ‹åˆ°å…¶ä»–äº‹ç‰©è¿˜æ²¡æœ‰æäº¤çš„å†…å®¹ï¼ˆä½ å¯ä»¥ç†è§£ä¸ºå‹æ ¹æ²¡æœ‰éš”ç¦»æ€§ï¼Œä¹‹å‰çš„æµ‹è¯•ä½¿ç”¨çš„å°±æ˜¯è¿™ä¸ªéš”ç¦»çº§åˆ«ï¼‰è¿™ç§æƒ…å†µä¸‹å°±å®¹æ˜“å¼•èµ·å¹¶å‘å’Œè¯»å–æ•°æ®çš„ä¸ä¸€è‡´é—®é¢˜ï¼Œè¿˜æœ‰<strong>è„è¯»</strong>é—®é¢˜ï¼ˆå¯¹æ–¹æ²¡æœ‰commitçš„æ•°æ®å°±å«åšè„æ•°æ®ï¼‰ï¼Œç”Ÿäº§ç¯å¢ƒä¸­æ˜¯æ‰“æ­»ä¸èƒ½ç”¨è¿™ä¸ªéš”ç¦»çº§åˆ«çš„ï¼</li><li>è¯»å·²æäº¤ï¼ˆRead Committedï¼‰ï¼šåœ¨è¿™ä¸ªéš”ç¦»çº§åˆ«ä¸­ï¼Œäº‹åŠ¡åªå¯ä»¥çœ‹åˆ°å…¶ä»–äº‹åŠ¡å·²ç»æäº¤äº†çš„å†…å®¹ã€‚è¿™å·²ç»æ»¡è¶³äº†éš”ç¦»çš„åŸºæœ¬å®šä¹‰ï¼šåªèƒ½çœ‹åˆ°å…¶ä»–äº‹åŠ¡å¼€å§‹å‰æˆ–è€…å¼€å§‹åçš„å†…å®¹ï¼›ä½†æ˜¯è¿™ç§éš”ç¦»æ¨¡å¼ä¼šäº§ç”Ÿ<strong>ä¸å¯é‡å¤è¯»</strong>çš„é—®é¢˜ï¼ˆç›¸åŒ<code>select</code>ä¼šå‡ºç°ä¸åŒç»“æœï¼‰ï¼›</li><li>å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰ï¼šä¸ºäº†è§£å†³ä¸å¯é‡å¤è¯»çš„é—®é¢˜ï¼Œè¿™ä¸ªéš”ç¦»çº§åˆ«ä¿è¯äº†äº‹åŠ¡åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å¤šæ¬¡è¯»å–ç›¸åŒæ•°æ®æ—¶ä¼šå¾—åˆ°ç›¸åŒç»“æœï¼›ä½†æ˜¯è¿™ä¸ªéš”ç¦»çº§åˆ«åœ¨æŸäº›æ•°æ®åº“ä¸­å¯èƒ½ä¼šå‡ºç°<strong>å¹»è¯»</strong>é—®é¢˜ï¼›MySQLé»˜è®¤é‡‡ç”¨æ­¤éš”ç¦»çº§åˆ«ï¼›</li><li>ä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ï¼šæ‰€è°“ä¸²è¡ŒåŒ–ï¼Œå°±æ˜¯MySQLç»™æ•°æ®åº“çš„æ‰€æœ‰æ“ä½œéƒ½ä¸Šé”ï¼Œå¿…é¡»è¦æ’é˜Ÿè¿è¡Œã€‚ä¸€ä¸ªäº‹åŠ¡åœ¨è¿è¡Œæ—¶ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡å¾—ç­‰å®ƒè¿è¡Œå®Œæ¯•äº†æ‰èƒ½è¿›æ¥è¿è¡Œï¼Œè¿™æ ·èƒ½æœ€å¤§ç¨‹åº¦ä¿è¯éš”ç¦»æ€§ï¼›ä½†æ˜¯ä¼šé™ä½æ•ˆç‡ï¼›</li></ul><p>éš”ç¦»çº§åˆ«æ˜¯ç”±MySQLè¿›è¡Œå„ç§ç±»å‹çš„åŠ é”æ¥å®ç°çš„ï¼Œæ¯”å¦‚è¡¨é”ã€è¡Œé”ã€è¯»å†™é”ã€é—´éš™é”ï¼ˆGAPï¼‰ã€NEXT-KEYé”ï¼ˆGAP+è¡Œé”ï¼‰ç­‰ç­‰ï¼›</p><blockquote><p>è¿™é‡Œè¿˜éœ€è¦éªŒè¯å¦å¤–ä¸€ä»¶äº‹ï¼ŒMySQLå¦‚æœå¼€å¯äº†ä¸²è¡ŒåŒ–ï¼Œå®¢æˆ·ç«¯c&#x2F;cppæ“ä½œè¿˜éœ€è¦åŠ é”å—ï¼Ÿ<code>mysqlquery</code>çš„æ“ä½œæ˜¯ä¼šé˜»å¡è¿˜æ˜¯ç›´æ¥é”™è¯¯é€€å‡ºï¼Ÿ</p></blockquote><p>åœ¨MySQLä¸­ï¼Œäº‹åŠ¡çš„éš”ç¦»çº§åˆ«å¯ä»¥åˆ†åˆ«è®¾ç½®å…¨å±€çš„éš”ç¦»çº§åˆ«å’Œå½“å‰å®¢æˆ·ç«¯çš„éš”ç¦»çº§åˆ«ï¼›å¦‚æœæ²¡æœ‰ä¸»åŠ¨è®¾ç½®å®¢æˆ·ç«¯çš„éš”ç¦»çº§åˆ«ï¼Œåˆ™ä¼šç»§æ‰¿å…¨å±€çš„éš”ç¦»çº§åˆ«ã€‚é¡¾åæ€ä¹‰ï¼Œä¼šè¯éš”ç¦»çº§åˆ«åªä¼šå½±å“å½“å‰çš„ä¼šè¯ï¼Œä¸ä¼šå½±å“å¦å¤–çš„å®¢æˆ·ç«¯ï¼›</p><p>å¦å¤–ï¼Œå…¨å±€çš„éš”ç¦»çº§åˆ«ä¼šåœ¨æ•°æ®åº“æœåŠ¡é‡å¯åï¼Œè¢«é‡ç½®ä¸ºé…ç½®æ–‡ä»¶ä¸­é»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼ˆä¸€èˆ¬æ˜¯RRï¼‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è®¾ç½® ä¼šè¯/å…¨å±€ éš”ç¦»çº§åˆ«</span></span><br><span class="line"><span class="keyword">set</span> [session <span class="operator">|</span> <span class="keyword">global</span>] transaction isolation level [read uncommitted <span class="operator">|</span> read committed <span class="operator">|</span> repeatable read <span class="operator">|</span> serializable ]</span><br><span class="line"><span class="comment">-- æŸ¥çœ‹å½“å‰ä¼šè¯çš„éš”ç¦»çº§åˆ«</span></span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@session</span>.tx_isolation;</span><br><span class="line"><span class="comment">-- æŸ¥çœ‹å…¨å±€çš„éš”ç¦»çº§åˆ«</span></span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@tx</span>_isolation;</span><br></pre></td></tr></table></figure><h2 id="3-2-è¯»æœªæäº¤"><a href="#3-2-è¯»æœªæäº¤" class="headerlink" title="3.2 è¯»æœªæäº¤"></a>3.2 è¯»æœªæäº¤</h2><p>è¿™ä¸ªéš”ç¦»çº§åˆ«åœ¨ç¬¬äºŒå¤§ç‚¹é‡Œé¢å°±å·²ç»æµ‹è¯•è¿‡äº†ï¼Œå·¦ä¾§ç»ˆç«¯æ’å…¥çš„æ•°æ®ï¼Œå³ä¾¿æ²¡æœ‰commitï¼Œåœ¨å³ä¾§ç»ˆç«¯ä¸­ä¹Ÿèƒ½çœ‹å¾—åˆ°ï¼Œè¿™é‡Œå°±ä¸äºŒæ¬¡æ¼”ç¤ºäº†</p><p><img src="https://img.musnow.top/i/2023/09/8021cf95d4fa8a29c24771161f17cf52.png" alt="image-20230910164315360"></p><p>æ¸…æ¥šå·²æœ‰çš„æ•°æ®ï¼Œæ¥æµ‹è¯•ä¸€ä¸‹ä¼šè¯éš”ç¦»çº§åˆ«çš„ä½œç”¨ï¼›é»˜è®¤æƒ…å†µä¸‹ï¼Œå…¨å±€å’Œä¼šè¯çš„éš”ç¦»çº§åˆ«éƒ½æ˜¯RRï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello_mysql]&gt; select @@tx_isolation;</span><br><span class="line">+-----------------+</span><br><span class="line">| @@tx_isolation  |</span><br><span class="line">+-----------------+</span><br><span class="line">| REPEATABLE-READ |</span><br><span class="line">+-----------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello_mysql]&gt; select @@session.tx_isolation;</span><br><span class="line">+------------------------+</span><br><span class="line">| @@session.tx_isolation |</span><br><span class="line">+------------------------+</span><br><span class="line">| REPEATABLE-READ        |</span><br><span class="line">+------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><p>å°†å·¦ä¾§çš„ç»ˆç«¯ä¸­çš„ä¼šè¯éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºè¯»æœªæäº¤</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> session transaction isolation level read uncommitted;</span><br></pre></td></tr></table></figure><p><strong>æ’å…¥æ•°æ®ä¹‹å‰</strong>ï¼Œæ‰§è¡Œä¸€æ¬¡<code>select</code>å…¨åˆ—æŸ¥è¯¢ï¼Œä¸¤ä¾§éƒ½æ˜¯ç©ºï¼›</p><p>åœ¨å·¦ä¾§æ’å…¥æ•°æ®åï¼Œå³ä¾§æŸ¥çœ‹ä¼šå‘ç°ä¾æ—§æ˜¯<code>empty set</code>æ²¡æœ‰ç»“æœï¼›åªæœ‰å·¦ä¾§<code>commit</code>ä¹‹åï¼Œå³ä¾§æ‰èƒ½çœ‹åˆ°æ•°æ®ï¼›è¿™æ˜¯å› ä¸ºåœ¨ä¹‹å‰æµ‹è¯•çš„æ—¶å€™ï¼Œ<strong>æˆ‘ä»¬å°†è‡ªåŠ¨æäº¤å…³é—­äº†</strong>ï¼›å³ä¾§çœ‹ä¸åˆ°æˆ‘ä»¬è¿˜æ²¡æœ‰æäº¤çš„äº‹åŠ¡ï¼›</p><p><img src="https://img.musnow.top/i/2023/09/9c76acac8deca528d4226b226146de13.png" alt="image-20230911100829407"></p><p>å³ä¾§æ‰‹åŠ¨å¼€å¯äº‹åŠ¡åï¼Œå³ä¾¿æ²¡æœ‰è¿›è¡Œ<code>commit</code>ï¼Œä½†æ˜¯å·¦ä¾§å› ä¸ºè®¾ç½®äº†è¯»æœªæäº¤ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥çœ‹åˆ°å³ä¾§è¿˜æ²¡æœ‰æäº¤çš„äº‹åŠ¡ä¸­çš„ä¿®æ”¹ã€‚è¿™ä¾¿æ˜¯è¿™ä¸ªéš”ç¦»çº§åˆ«çš„ç‰¹æ€§ï¼›</p><p><img src="https://img.musnow.top/i/2023/09/6ba51b47e8c05b4171645e423f1ad6a2.png" alt="image-20230911101100927"></p><h2 id="3-3-è¯»å·²æäº¤"><a href="#3-3-è¯»å·²æäº¤" class="headerlink" title="3.3 è¯»å·²æäº¤"></a>3.3 è¯»å·²æäº¤</h2><p>æ¥ä¸‹æ¥å†å°†å…¨å±€éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºè¯»å·²æäº¤ï¼Œé‡æ–°å¼€å¯ä¸¤ä¸ªç»ˆç«¯è¿›è¡Œæµ‹è¯•ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global transaction isolation level read committed;</span><br></pre></td></tr></table></figure><p>è®¾ç½®å®Œæ¯•ï¼Œé‡å¯ç»ˆç«¯åï¼Œå¯ä»¥çœ‹åˆ°ä¸¤ä¾§çš„éš”ç¦»çº§åˆ«éƒ½æ˜¯è¯»å·²æäº¤ï¼Œè‡ªåŠ¨æäº¤éƒ½æ˜¯å¼€å¯çš„ï¼›</p><p><img src="https://img.musnow.top/i/2023/09/bc6c1464a3c9331191aee2a24f9273e4.png" alt="image-20230911102633596"></p><p>ä¸¤ä¾§éƒ½å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œå·¦ä¾§æ’å…¥æ•°æ®ï¼Œå³ä¾§æŸ¥çœ‹ï¼Œå‘ç°æ²¡æœ‰å†…å®¹ï¼›</p><p><img src="https://img.musnow.top/i/2023/09/8e60ab3a2b5b4bff70b80ed22bce706b.png" alt="image-20230911103402950"></p><p>å·¦ä¾§commitä¹‹åï¼Œå³ä¾§æ‰å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ•°æ®ï¼›</p><p><img src="https://img.musnow.top/i/2023/09/9ec9807c381ccebd42a77a741151c422.png" alt="image-20230911103432740"></p><p>è¿™ç¬¦åˆæˆ‘ä»¬å¯¹<strong>è¯»å·²æäº¤</strong>è¿™ä¸ªéš”ç¦»çº§åˆ«çš„å­—é¢ç†è§£ï¼Œä½†æ˜¯è¿™å¹¶ä¸ä»£è¡¨è¿™ä¸ªéš”ç¦»çº§åˆ«æ²¡æœ‰é—®é¢˜ï¼</p><h3 id="3-3-1-å‡ºé—®é¢˜çš„åœºæ™¯"><a href="#3-3-1-å‡ºé—®é¢˜çš„åœºæ™¯" class="headerlink" title="3.3.1 å‡ºé—®é¢˜çš„åœºæ™¯"></a>3.3.1 å‡ºé—®é¢˜çš„åœºæ™¯</h3><p>æ¥çœ‹çœ‹ä¸‹é¢è¿™ä¸ªåœºæ™¯ï¼š</p><ul><li>å…¬å¸éœ€è¦æ ¹æ®å‘˜å·¥å·¥èµ„ï¼Œåˆ†å‘ä¸åŒçº§åˆ«çš„å¥–é‡‘ï¼š<ul><li>2000-4000 çº§åˆ«ä¸€</li><li>4001-8000 çº§åˆ«äºŒ</li><li>8001-15000 çº§åˆ«ä¸‰</li></ul></li><li>ç”²å¼€å¯äº†ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå¼€å§‹ç”¨MySQLç­›é€‰ä¸åŒå·¥èµ„åŒºé—´çš„å‘˜å·¥ï¼Œè®°å½•ä¸‹æ¥ï¼›</li><li>ä¹™å¼€å¯äº†ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œæƒ³è¦ç»™å‘˜å·¥ä¸åŠ å·¥èµ„<ul><li>ä¸åŸæœ¬çš„å·¥èµ„æ˜¯3000</li><li>ä¹™ç»™ä¸åŠ äº†2000å·¥èµ„ï¼Œä¸çš„å·¥èµ„å˜æˆäº†5000ï¼Œè·³åˆ°äº†å·¥èµ„çº§åˆ«äºŒï¼›</li><li>ä¹™æäº¤ä¿®æ”¹ï¼ˆcommitï¼‰</li></ul></li><li>å‡è®¾ç”²å·²ç»å®Œæˆäº†å¯¹2000-4000çº§åˆ«å·¥èµ„çš„å‘˜å·¥ç­›é€‰ï¼Œæ­¤æ—¶ä¹™è¿‡æ¥ç»™ä¸åŠ äº†å·¥èµ„ï¼Œä¸è·³åˆ°äº†å·¥èµ„çº§åˆ«äºŒï¼›</li><li>å› ä¸ºéš”ç¦»çº§åˆ«æ˜¯è¯»å·²æäº¤ï¼Œç”²åœ¨ç­›é€‰å·¥èµ„çº§åˆ«äºŒçš„äººå‘˜æ—¶ï¼Œä¼šæŠŠåˆšåˆšè¢«ä¿®æ”¹è¿‡çš„ä¸ä¹Ÿç»™çº³å…¥è¿›å»ï¼›</li><li>è¿™æ—¶å€™ï¼Œå¯¹äºç”²è€Œè¨€ï¼Œ<strong>ä¸å°±åŒæ—¶å‡ºç°åœ¨äº†å·¥èµ„çº§åˆ«ä¸€å’ŒäºŒçš„äººå‘˜ä¸­ï¼Œè¿™æ˜æ˜¾æ˜¯ä¸åˆç†çš„</strong>ï¼</li></ul><p>è¿™ä¸ªåœºæ™¯è¢«ç§°ä¸º<code>ä¸å¯é‡å¤è¯»</code>ï¼Œå³åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼ŒåŒä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œå¯èƒ½ä¼šå› ä¸ºå…¶ä»–äº‹åŠ¡çš„æäº¤è€Œäº§ç”Ÿä¸åŒçš„ç»“æœï¼›æ¢åšSQLè¯­å¥æ¥æè¿°ï¼Œåœ¨è¯»å·²æäº¤çš„éš”ç¦»çº§åˆ«ä¸­ï¼ŒåŒä¸€ä¸ªselectè¯­å¥åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œç¬¬äºŒæ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œå¯èƒ½ä¼šè·å–åˆ°å’Œç¬¬ä¸€æ¬¡ä¸åŒçš„ç»“æœï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜æ‰è¢«ç§°ä½œ<code>ä¸å¯é‡å¤è¯»</code>ï¼ˆä¸å¯ä»¥é‡å¤æ‰§è¡Œselectï¼‰é—®é¢˜ï¼›</p><hr><p>æ¥å®é™…æ¼”ç¤ºä¸€ä¸‹ï¼Œä¸¤ä¾§éƒ½å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå·¦ä¾§ç»ˆç«¯æ›´æ–°è¡¨ä¸­çš„ç”¨æˆ·idï¼Œåªè¦å®ƒä¸æäº¤ï¼Œå³ä¾§å°±çœ‹ä¸åˆ°ä¿®æ”¹ã€‚</p><p><img src="https://img.musnow.top/i/2023/09/8789693271635e5d27c7ad0873937af8.png" alt="image-20230911105147039"></p><p>ä½†æ˜¯æäº¤äº†ä¹‹åï¼Œå³ä¾§å°±èƒ½çœ‹åˆ°è¿™ä¸ªç”¨æˆ·idçš„æ”¹å˜ï¼Œåœ¨è¿›è¡Œæ•°æ®ç­›é€‰çš„æ—¶å€™ï¼Œè¿™ç§æƒ…å½¢å°±ä¼šå‡ºç°é—®é¢˜ï¼</p><p><img src="https://img.musnow.top/i/2023/09/c9f4f3c119361dfcfab135c9e4342921.png" alt="image-20230911105214340"></p><h2 id="3-4-å¯é‡å¤è¯»"><a href="#3-4-å¯é‡å¤è¯»" class="headerlink" title="3.4 å¯é‡å¤è¯»"></a>3.4 å¯é‡å¤è¯»</h2><p>æ‰€ä»¥ï¼Œä¸ºäº†é¿å…ä¸Šé¢æåˆ°çš„è¿™ä¸ªé—®é¢˜ï¼ŒMySQLè¿˜æä¾›äº†ä¸€ä¸ªå¯é‡å¤è¯»çš„éš”ç¦»çº§åˆ«ï¼Œä¸”é»˜è®¤é‡‡ç”¨çš„å°±æ˜¯è¿™ä¸ªéš”ç¦»çº§åˆ«ï¼›</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level  repeatable read;</span><br></pre></td></tr></table></figure><p>å¯é‡å¤è¯»å°±è§£å†³äº†ä¸Šé¢æåˆ°çš„é—®é¢˜ï¼Œå³ä¾¿å…¶ä»–äº‹åŠ¡æäº¤äº†ä¿®æ”¹ï¼Œå½“å‰äº‹åŠ¡ä¹Ÿçœ‹ä¸åˆ°è¿™ä»½ä¿®æ”¹ï¼Œåªæœ‰å½“å‰äº‹åŠ¡ç»“æŸåï¼Œæ‰èƒ½çœ‹åˆ°æœ€æ–°çš„æ•°æ®ï¼›</p><p>çœ‹ä¸‹å›¾ï¼Œä¸¤ä¾§éƒ½å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œä¸ç®¡å·¦ä¾§æ˜¯å¦æœ‰æäº¤äº‹åŠ¡ï¼Œå³ä¾§éƒ½çœ‹ä¸åˆ°å·¦ä¾§æ–°æ’å…¥çš„æ•°æ®ï¼›</p><p><img src="https://img.musnow.top/i/2023/09/c702bd94bb9b4f1b39da177aba23faf0.png" alt="image-20230911150201158"></p><p>åªæœ‰å³ä¾§ä¹Ÿæäº¤äº†è‡ªå·±çš„äº‹åŠ¡ï¼Œæ‰èƒ½çœ‹åˆ°å·¦ä¾§æ’å…¥çš„æ–°æ•°æ®ï¼›</p><p><img src="https://img.musnow.top/i/2023/09/8e5ce5e2e310cf65a10b003bb0036e3e.png" alt="image-20230911150323005"></p><p>è¿™å°±ä¿è¯äº†ï¼Œå³ä¾§è¿™ä¸ªäº‹åŠ¡åœ¨è¿è¡Œçš„å§‹ç»ˆï¼Œå®ƒæ‰§è¡Œçš„ç›¸åŒ<code>select</code>è¯­å¥çš„ç»“æœæ°¸è¿œéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸ä¼šå‡ºç°ä¸å¯é‡å¤è¯»çš„é—®é¢˜ï¼</p><p>è€Œå¦‚æœåœ¨RRçº§åˆ«ä¸­ï¼ŒåŒæ—¶è®¿é—®ç›¸åŒæ•°æ®ï¼Œä¼šå‡ºç°<strong>åŠ é”</strong>çš„æƒ…å†µï¼Œä¸‹å›¾ä¸­ï¼Œå³ä¾§æ’å…¥äº†ä¸»é”®ä¸º6çš„æ•°æ®ï¼Œæ­¤æ—¶å·¦ä¾§å¦‚æœä¹Ÿå°è¯•æ’å…¥ä¸€ä¸ªä¸»é”®ä¸º6çš„æ•°æ®ï¼Œä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼›</p><p><img src="https://img.musnow.top/i/2023/09/fa7dbb9ad31fd27e00307f37aac40a4e.png" alt="image-20230911151027879"></p><p>å¦‚æœå¾ˆä¹…éƒ½ä¸ç»§ç»­æ“ä½œï¼Œå°±ä¼šå› ä¸ºç­‰å¾…è¶…æ—¶ï¼Œè·³å‡ºç­‰å¾…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello_mysql]&gt; insert into test_ruc values (6,60,&#x27;å¤©æ•°&#x27;);</span><br><span class="line">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</span><br></pre></td></tr></table></figure><p>ä½†å½“å‰äº‹åŠ¡ä¸­æ’å…¥çš„æ•°æ®ä¾æ—§æ˜¯å­˜åœ¨çš„ï¼Œå½“å‰äº‹åŠ¡ä¹Ÿæ²¡æœ‰ç»“æŸ</p><p><img src="https://img.musnow.top/i/2023/09/d8de538b5a89adf04842efd2097239c6.png" alt="image-20230911151335335"></p><p>å†æ¬¡å°è¯•æ’å…¥è¿™ä¸ªä¸»é”®ä¸º6çš„æ•°æ®ï¼Œä¾æ—§ä¼šé™·å…¥é˜»å¡æ€ï¼Œåªæœ‰å³ä¾§çš„äº‹åŠ¡è¢«æäº¤äº†ä¹‹åï¼Œå·¦ä¾§æ‰ä¼šå‡ºç°ä¸»é”®å†²çªçš„æç¤ºï¼Œç¦æ­¢æ’å…¥ï¼›</p><p><img src="https://img.musnow.top/i/2023/09/be7f7f5c5a63329fbe574ba4ff22d085.png" alt="image-20230911151444595"></p><p>å·¦ä¾§commitäº†ä¹‹åï¼Œå³ä¾§æ‰èƒ½çœ‹åˆ°å·¦ä¾§æ–°æ’å…¥çš„ä¸»é”®ä¸º5çš„æ•°æ®ï¼›</p><p><img src="https://img.musnow.top/i/2023/09/0827a5499036b9e5b024b60f174ec44a.png" alt="image-20230911151710391"></p><h2 id="3-5-ä¸²è¡ŒåŒ–"><a href="#3-5-ä¸²è¡ŒåŒ–" class="headerlink" title="3.5 ä¸²è¡ŒåŒ–"></a>3.5 ä¸²è¡ŒåŒ–</h2><p>è¿™ä¸ªå°±æ¯”è¾ƒç®€å•äº†ï¼Œä¸€ä¸ªäº‹åŠ¡æ²¡ç»“æŸï¼Œå¦å¤–ä¸€ä¸ªå°±é˜»å¡ç­‰å¾…ï¼›</p><p>ä¸²è¡ŒåŒ–æ˜¯æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œä½†å…¶å¹¶å‘æ€§èƒ½å¾ˆä½ï¼Œå®é™…ä¸Šç”¨çš„ä¹Ÿä¸å¤šï¼›</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level  serializable;</span><br></pre></td></tr></table></figure><p>ä¸¤ä¾§ç»ˆç«¯éƒ½å¼€å§‹äº‹åŠ¡ï¼ŒæŸ¥è¯¢çš„æ—¶å€™æ˜¯ä¸ä¼šåŠ é”çš„ï¼Œä½†æ˜¯å·¦ä¾§æ‰§è¡Œ<code>update</code>çš„æ—¶å€™ï¼Œé˜»å¡äº†ï¼ˆå¯ä»¥é€šè¿‡å·¦ä¾§updateçš„æ‰§è¡Œæ—¶é—´è§‚å¯Ÿåˆ°é˜»å¡ç°è±¡ï¼Œæˆªå›¾çœ‹çš„ä¸æ˜¯å¾ˆæ˜æ˜¾ï¼‰ï¼›å³ä¾§ä¹Ÿæ‰§è¡Œä¸€æ¬¡<code>update</code>ï¼Œå·¦ä¾§çš„updateå°±ç«‹é©¬æˆåŠŸäº†ï¼Œå³ä¾§æ˜¾ç¤ºæŠ¥é”™æ£€æµ‹åˆ°æ­»é”ï¼Œå»ºè®®å°è¯•é‡å¯äº‹åŠ¡ï¼›</p><p><img src="https://img.musnow.top/i/2023/09/d75f063fa7959ec6c7926eba70d25e35.png" alt="image-20230911110259760"></p><p>å†æ¥è¯•è¯•ï¼Œä¸¤ä¾§éƒ½å¼€å¯äº‹åŠ¡ï¼Œå·¦ä¾§å°è¯•æ’å…¥ä¸€ä¸ªæ•°æ®ï¼Œ<strong>ä¼šé˜»å¡</strong>ï¼›å³ä¾§<code>commit</code>ä¹‹åï¼Œå·¦ä¾§çš„æ’å…¥å°±ç«‹é©¬æˆåŠŸäº†ï¼</p><p><img src="https://img.musnow.top/i/2023/09/8f8ed448629e2b9a842eb819c91f6cea.png" alt="image-20230911110525989"></p><p>è¿™ä¾¿æ˜¯ä¸²è¡ŒåŒ–çš„è¡¨ç°ï¼šä¸¤ä¸ªäº‹åŠ¡å¦‚æœéƒ½æ˜¯åœ¨æ‰§è¡Œselectçš„è¯»å–æ“ä½œï¼Œåˆ™ä¸ä¼šè¢«é˜»å¡ï¼Œä½†å¦‚æœæœ‰ä¸€ä¸ªäº‹åŠ¡è¦æ‰§è¡Œ<strong>å¢åˆ æ”¹</strong>ï¼Œé‚£ä¹ˆå°±å¿…é¡»ç­‰å¾…å…¶ä»–äº‹åŠ¡éƒ½ç»“æŸäº†ï¼Œè¿™ä¸ªæ“ä½œæ‰èƒ½è¢«æ‰§è¡Œï¼›</p><h3 id="3-5-1-ä¸²è¡ŒåŒ–çš„é€‚ç”¨åœºæ™¯"><a href="#3-5-1-ä¸²è¡ŒåŒ–çš„é€‚ç”¨åœºæ™¯" class="headerlink" title="3.5.1 ä¸²è¡ŒåŒ–çš„é€‚ç”¨åœºæ™¯"></a>3.5.1 ä¸²è¡ŒåŒ–çš„é€‚ç”¨åœºæ™¯</h3><p>å›åˆ° <a href="#jump1">1.1.2 å–ç¥¨</a> çš„åœºæ™¯ï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œå¦‚æœä½ éœ€è¦ä¿è¯å®¢æˆ·ç«¯Açš„å–ç¥¨é€»è¾‘å®Œå…¨æ‰§è¡Œå®Œæ¯•äº†ï¼Œå®¢æˆ·ç«¯Bæ‰èƒ½è¿‡æ¥æŸ¥è¯¢ç¥¨æ•°ï¼Œé‚£å°±éœ€è¦ä½¿ç”¨ä¸²è¡ŒåŒ–ï¼›</p><p>ä½†æ˜¯ï¼Œä¸²è¡ŒåŒ–ä¸­ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥æ‰§è¡ŒæŸ¥è¯¢æ“ä½œçš„ï¼é‚£ä¹ˆåœ¨Aæ²¡æœ‰ç»“æŸçš„æƒ…å†µä¸‹ï¼ŒBä¸è¿˜æ˜¯ä¼šæŸ¥è¯¢åˆ°æœ‰å‰©ä½™ç¥¨æ•°ï¼Ÿ</p><blockquote><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬çš„å–ç¥¨æ“ä½œå¹¶ä¸æ˜¯ç›´è¿æ•°æ®åº“å®ç°çš„ï¼Œè€Œæ˜¯æœ‰ä¸€ä¸ªæœåŠ¡ç«¯è¿›ç¨‹æ¥æä¾›APIï¼Œä¾›å®¢æˆ·ç«¯æ¥æŸ¥è¯¢å‰©ä½™ç¥¨æ•°ï¼Œå‰©ä¸‹çš„å–ç¥¨æ“ä½œå…¶å®éƒ½æ˜¯æœåŠ¡ç«¯æ¥å®ç°çš„ï¼ˆè®©å®¢æˆ·ç«¯ç›´è¿MySQLæ¥æ‰§è¡ŒSQLæ˜¯éå¸¸ä¸å¯é çš„ï¼Œå¾ˆæœ‰å¯èƒ½å‡ºç°SQLæ³¨å…¥æ”»å‡»ï¼‰</p></blockquote><p>æ‰€ä»¥ï¼Œè¿™ä¸ªé—®é¢˜å¾—åœ¨æœåŠ¡ç«¯è¿›ç¨‹ä¸­åŠ é”è§£å†³ï¼MySQLæœ¬èº«å³ä¾¿ä½¿ç”¨ä¸²è¡ŒåŒ–ä¹Ÿæ˜¯æ²¡æœ‰åŠæ³•è§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼›</p><p>ä½†æ˜¯ï¼Œåˆ«å¿˜äº†ï¼ŒMySQLè¿˜æœ‰å¦å¤–ä¸€ä¸ªä¸œè¥¿â€”â€”<strong>çº¦æŸ</strong>ï¼›ä½ å¯ä»¥è®¾ç½®ä¸€ä¸ªè§¦å‘å™¨ï¼Œæ›´æ–°å‰©ä½™ç¥¨æ•°çš„æ—¶å€™ï¼Œæ‹’ç»å°†ç¥¨æ•°è®¾ç½®ä¸ºè´Ÿæ•°ï¼›è¿™æ ·å®¢æˆ·ç«¯Bå³ä¾¿è¿›å…¥äº†å–ç¥¨ä¸šåŠ¡ï¼Œæœ€ç»ˆå°†å‰©ä½™ç¥¨æ•°çš„æ•°æ®è®¾ç½®ä¸ºè´Ÿæ•°çš„æ—¶å€™ï¼Œ<strong>ä¹Ÿä¼šè¢«MySQLé˜»æ­¢æ’å…¥</strong>ï¼Œè¿™ä¸ªå–ç¥¨çš„äº‹åŠ¡Bå°±ç›¸å½“äºé”™è¯¯é€€å‡ºäº†ï¼Œæ‰€æœ‰æ“ä½œéƒ½ä¼šè¢«å›æ»šï¼è€Œéš”ç¦»çº§åˆ«å°±æ˜¯é¿å…Aå’ŒBåŒæ—¶ä¿®æ”¹ä¸€ä¸ªæ•°æ®è€Œå¯¼è‡´çš„é”™è¯¯ï¼›</p><p>äºŒè€…ç›¸è¾…ç›¸æˆï¼Œå°±èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼›å½“ç„¶ï¼Œåœ¨æœåŠ¡ç«¯APIå¤„ç†é€»è¾‘ä¸­åŠ é”æ˜¯æ›´å¥½çš„è§£å†³åŠæ³•ï¼Œæ—¢å¯ä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œåˆèƒ½éš”ç¦»å®¢æˆ·ç«¯å’ŒMySQLæœåŠ¡ï¼›</p><blockquote><p>åæ–‡è®²åˆ°çš„å½“å‰è¯»ä¹Ÿèƒ½åœ¨æŸç§ç¨‹åº¦ä¸Šè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåæ­£è§£å†³çš„åŠæ³•å¤šå¤šï¼</p></blockquote><h3 id="3-5-2-ä¸²è¡ŒåŒ–å’ŒCPP"><a href="#3-5-2-ä¸²è¡ŒåŒ–å’ŒCPP" class="headerlink" title="3.5.2 ä¸²è¡ŒåŒ–å’ŒCPP"></a>3.5.2 ä¸²è¡ŒåŒ–å’ŒCPP</h3><p>å¦‚æœå°† MySQL çš„éš”ç¦»çº§åˆ«ï¼ˆisolation levelï¼‰è®¾ç½®ä¸ºæœ€é«˜çº§åˆ«çš„ä¸²è¡ŒåŒ–ï¼ˆSERIALIZABLEï¼‰ï¼Œé‚£ä¹ˆå¹¶å‘çš„å¤šçº¿ç¨‹æ“ä½œå¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹æƒ…å†µä¹‹ä¸€ï¼š</p><ol><li>é˜»å¡ï¼šå½“ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ä½¿ç”¨æŸä¸ªæ•°æ®æ—¶ï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦ç­‰å¾…è¯¥çº¿ç¨‹é‡Šæ”¾é”æ‰èƒ½ç»§ç»­è¿›è¡Œæ“ä½œã€‚è¿™ä¼šå¯¼è‡´å…¶ä»–çº¿ç¨‹åœ¨è·å¾—æ‰€éœ€é”ä¹‹å‰è¢«é˜»å¡ã€‚</li><li>é”™è¯¯é€€å‡ºï¼šå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œç›¸åŒçš„æ•°æ®ï¼Œå¹¶ä¸”å®ƒä»¬æ— æ³•åŒæ—¶æŒæœ‰è®¿é—®è¯¥æ•°æ®çš„é”ï¼Œå°±ä¼šå¼•å‘æ­»é”ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæŸäº›çº¿ç¨‹ä¼šè¢«ç³»ç»Ÿç»ˆæ­¢ï¼Œä»è€Œå¯¼è‡´é”™è¯¯é€€å‡ºã€‚</li></ol><p>æ‰€ä»¥ï¼Œå¹¶ä¸æ˜¯è¯´ä½ å°†MySQLçš„éš”ç¦»çº§åˆ«è®¾ç½®å¥½äº†ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å°±å•¥äº‹ä¸ç”¨å¹²äº†ï¼›æœ€å¥½çš„æ“ä½œä¾æ—§æ˜¯åœ¨å®¢æˆ·ç«¯å°±åŠ é”è¿›è¡Œä¸€å®šçš„è®¿é—®æ§åˆ¶ï¼Œå› ä¸ºMySQL Queryå‡½æ•°çš„é”™è¯¯é€€å‡º+é€€å‡ºæƒ…å†µè¯†åˆ«ï¼Œç›¸æ¯”äºå®¢æˆ·ç«¯è¿›è¡Œè®¿é—®æ§åˆ¶æ›´éš¾ä»¥æ“ä½œï¼›</p><h2 id="3-6-æ€»ç»“"><a href="#3-6-æ€»ç»“" class="headerlink" title="3.6 æ€»ç»“"></a>3.6 æ€»ç»“</h2><ul><li>éš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œå®‰å…¨æ€§è¶Šé«˜ï¼Œæ•°æ®åº“çš„å¹¶å‘æ€§èƒ½å°±è¶Šä½ï¼›æˆ‘ä»¬éœ€è¦æ ¹æ®ä¸šåŠ¡é€»è¾‘ï¼Œé€‰ç”¨åˆé€‚çš„éš”ç¦»çº§åˆ«ï¼›</li><li>ä¸å¯é‡å¤è¯»çš„é—®é¢˜åœ¨äºå…¶ä»–å®¢æˆ·ç«¯çš„ä¿®æ”¹å’Œåˆ é™¤ï¼ŒåŒæ ·çš„selectè¯­å¥ä¼šæŸ¥å‡ºä¸åŒçš„ç»“æœï¼Œæ˜¯ä¸åˆç†çš„ï¼›</li><li>å¹»è¯»çš„é‡ç‚¹åœ¨äºæ–°å¢ï¼Œå…¶ä»–å®¢æˆ·ç«¯æ–°å¢çš„è®°å½•å¯èƒ½è¢«æˆ‘ä»¬å½“å‰çš„å®¢æˆ·ç«¯æŸ¥è¯¢åˆ°ï¼›ä½†æ˜¯åœ¨MySQLä¸­ï¼Œè¿™ä¸ªé—®é¢˜æ˜¯ä¸å­˜åœ¨çš„ï¼Œå› ä¸º<code>InnoDB</code>é€šè¿‡NEXT-KEYé”è§£å†³äº†å¹»è¯»é—®é¢˜ï¼›</li><li>äº‹åŠ¡ä¹Ÿåˆ†ä¸ºé•¿çŸ­äº‹åŠ¡çš„æ¦‚å¿µï¼Œäº‹åŠ¡ä¹‹é—´äº’ç›¸å½±å“ï¼Œä¸»è¦æŒ‡çš„æ˜¯äº‹åŠ¡åœ¨å¹¶è¡Œé˜¶æ®µï¼ˆéƒ½æ²¡æœ‰<code>commit</code>çš„æ—¶å€™ï¼‰äº§ç”Ÿçš„å½±å“ï¼›</li><li>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨MySQLé»˜è®¤çš„RRçš„äº‹åŠ¡çº§åˆ«å°±å¯ä»¥äº†ï¼›</li></ul><p>ä¸‹é¢ç»™å‡ºä¸€ä¸ªä¸åŒäº‹åŠ¡çº§åˆ«ä¹‹é—´çš„åŒºåˆ«çš„è¡¨æ ¼ï¼ŒYä»£è¡¨ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼ŒNä»£è¡¨ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜</p><table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th>è„è¯»</th><th>ä¸å¯é‡å¤è¯»</th><th>å¹»è¯»</th><th>åŠ é”è¯»</th></tr></thead><tbody><tr><td>è¯»æœªæäº¤</td><td>Y</td><td>Y</td><td>Y</td><td>ä¸åŠ é”</td></tr><tr><td>è¯»å·²æäº¤</td><td>N</td><td>Y</td><td>Y</td><td>ä¸åŠ é”</td></tr><tr><td>å¯é‡å¤è¯»</td><td>N</td><td>N</td><td>N</td><td>ä¸åŠ é”</td></tr><tr><td>ä¸²è¡ŒåŒ–</td><td>N</td><td>N</td><td>N</td><td>åŠ é”</td></tr></tbody></table><h2 id="3-7-ä¸€è‡´æ€§"><a href="#3-7-ä¸€è‡´æ€§" class="headerlink" title="3.7 ä¸€è‡´æ€§"></a>3.7 ä¸€è‡´æ€§</h2><ul><li>äº‹åŠ¡æ‰§è¡Œçš„ç»“æœï¼Œå¿…é¡»ä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ï¼Œå˜åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚å½“æ•°æ®åº“åªåŒ…å«äº‹åŠ¡ æˆåŠŸæäº¤çš„ç»“æœæ—¶ï¼Œæ•°æ®åº“å¤„äºä¸€è‡´æ€§çŠ¶æ€ã€‚</li><li>å¦‚æœç³»ç»Ÿè¿è¡Œå‘ç”Ÿä¸­æ–­ï¼ŒæŸä¸ªäº‹åŠ¡å°šæœªå®Œæˆè€Œè¢«è¿«ä¸­ æ–­ï¼Œè€Œæ”¹æœªå®Œæˆçš„äº‹åŠ¡å¯¹æ•°æ®åº“æ‰€åšçš„ä¿®æ”¹å·²è¢«å†™å…¥æ•°æ®åº“ï¼Œæ­¤æ—¶æ•°æ®åº“å°±å¤„äºä¸€ç§ä¸æ­£ç¡®ï¼ˆä¸ä¸€è‡´ï¼‰çš„çŠ¶æ€ã€‚å› æ­¤ä¸€è‡´æ€§æ˜¯é€šè¿‡<strong>åŸå­æ€§</strong>æ¥ä¿è¯çš„ã€‚</li><li>å…¶å®ä¸€è‡´æ€§å’Œç”¨æˆ·çš„ä¸šåŠ¡é€»è¾‘å¼ºç›¸å…³ï¼Œä¸€èˆ¬MySQLæä¾›æŠ€æœ¯æ”¯æŒï¼Œä½†æ˜¯ä¸€è‡´æ€§è¿˜æ˜¯è¦ç”¨æˆ·ä¸šåŠ¡é€»è¾‘åšæ”¯æ’‘ï¼ˆæ¯”å¦‚å®¢æˆ·ç«¯å¦‚æœä¸ä½¿ç”¨äº‹åŠ¡ï¼Œé‚£MySQLä¹Ÿæ²¡æœ‰åŠæ³•å¸®åŠ©ç»´æŠ¤ï¼‰ï¼Œæ‰€ä»¥è¯´ï¼Œä¸€è‡´æ€§æ˜¯ç”±ç”¨æˆ·å†³å®šæ˜¯å¦ç»´æŠ¤çš„ã€‚ </li><li>æŠ€æœ¯ä¸Šï¼Œé€šè¿‡AIDä¿è¯C</li></ul><h1 id="4-éš”ç¦»æ€§çš„ç†è§£"><a href="#4-éš”ç¦»æ€§çš„ç†è§£" class="headerlink" title="4.éš”ç¦»æ€§çš„ç†è§£"></a>4.éš”ç¦»æ€§çš„ç†è§£</h1><p>è¯´å®Œäº†éš”ç¦»çº§åˆ«ï¼Œæ¥ä¸‹æ¥å†æ·±å…¥ç†è§£ä¸€ä¸‹éš”ç¦»æ€§</p><h2 id="4-1-MVCC"><a href="#4-1-MVCC" class="headerlink" title="4.1 MVCC"></a>4.1 MVCC</h2><p>æ•°æ®åº“å¹¶å‘çš„åœºæ™¯ä¸€å…±æœ‰ä¸‹é¢ä¸‰ç§</p><ul><li><code>è¯»-è¯»</code>ï¼šä¸å­˜åœ¨ä»»ä½•é—®é¢˜ï¼Œä¸éœ€è¦è®¿é—®æ§åˆ¶</li><li><code>è¯»-å†™</code>ï¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¯èƒ½ä¼šé‡åˆ°éš”ç¦»æ€§ä¸­çš„è„è¯»ã€å¹»è¯»ã€ä¸å¯é‡å¤è¯»é—®é¢˜ï¼›</li><li><code>å†™-å†™</code>ï¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œè¿˜æœ‰å¯èƒ½å‡ºç°æ›´æ–°ä¸¢å¤±é—®é¢˜ï¼›</li></ul><p>æˆ‘ä»¬ä¸»è¦å…³æ³¨çš„æ˜¯è¯»å†™å¹¶å‘çš„æƒ…å†µï¼Œè¿™ä¹Ÿæ˜¯æ•°æ®åº“æœ€å¸¸é‡åˆ°çš„å¤„ç†åœºæ™¯ï¼›</p><p>å†MySQLä¸­ï¼Œé‡‡ç”¨äº†MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰æ¥è§£å†³è¯»å†™å†²çªï¼Œè¿™æ˜¯ä¸€ç§æ— é”çš„å¹¶å‘æ§åˆ¶æœºåˆ¶ï¼›</p><p>åœ¨äº†è§£MVCCä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£å‡ ä¸ªå‰ç½®çŸ¥è¯†ï¼š</p><ul><li>ä¸‰ä¸ªéšè—åˆ—å­—æ®µ</li><li>UNDOæ—¥å¿—</li><li>READ VIEW</li></ul><h3 id="4-1-1-éšè—åˆ—å­—æ®µ"><a href="#4-1-1-éšè—åˆ—å­—æ®µ" class="headerlink" title="4.1.1 éšè—åˆ—å­—æ®µ"></a>4.1.1 éšè—åˆ—å­—æ®µ</h3><p>åœ¨MySQLä¸­ï¼Œæ¯ä¸€ä¸ªè¡¨éƒ½å­˜åœ¨ä¸‰ä¸ªéšè—çš„åˆ—å­—æ®µ</p><ul><li>DB_TRX_IDï¼š6 byteï¼Œæœ€è¿‘ä¿®æ”¹(ä¿®æ”¹&#x2F;æ’å…¥)äº‹åŠ¡IDï¼Œè®°å½•åˆ›å»ºè¿™æ¡è®°å½•&#x2F;æœ€åä¸€æ¬¡ä¿®æ”¹è¯¥è®°å½•çš„äº‹åŠ¡IDï¼›</li><li>DB_ROLL_PTR: 7 byteï¼Œå›æ»šæŒ‡é’ˆï¼ŒæŒ‡å‘è¿™æ¡è®°å½•çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼ˆç®€å•ç†è§£æˆï¼ŒæŒ‡å‘å†å²ç‰ˆæœ¬å°± è¡Œï¼Œè¿™äº›æ•°æ®ä¸€èˆ¬åœ¨ <code>undo log</code> ä¸­ï¼‰ </li><li>DB_ROW_ID: 6 byteï¼Œéšå«çš„è‡ªå¢IDï¼ˆéšè—ä¸»é”®ï¼‰ï¼Œå¦‚æœæ•°æ®è¡¨æ²¡æœ‰ä¸»é”®ï¼Œ InnoDB ä¼šè‡ªåŠ¨ä»¥ DB_ROW_ID äº§ç”Ÿä¸€ä¸ª<strong>èšç°‡ç´¢å¼•</strong>ï¼›</li><li>è¡¥å……ï¼šå®é™…è¿˜æœ‰ä¸€ä¸ªåˆ é™¤flagéšè—å­—æ®µï¼Œæ—¢è®°å½•è¢«æ›´æ–°æˆ–åˆ é™¤å¹¶ä¸ä»£è¡¨çœŸçš„åˆ é™¤ï¼Œè€Œæ˜¯åˆ é™¤flagå˜äº†ï¼›</li></ul><p>å‡è®¾æœ‰å¦‚ä¸‹è¡¨ç»“æ„</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> student(</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">11</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    age <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- æ’å…¥ä¸€æ¡è®°å½•</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student (name, age) <span class="keyword">values</span> (<span class="string">&#x27;å¼ ä¸‰&#x27;</span>, <span class="number">19</span>);</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆè¿™ä¸ªè¡¨ä¸­çš„å®é™…æ•°æ®æ˜¯è¿™æ ·çš„</p><table><thead><tr><th>name</th><th>age</th><th>DB_TRX_ID(åˆ›å»ºè¿™ä¸ªè®°å½•çš„äº‹åŠ¡ID)</th><th>DB_ROW_IDï¼ˆéšè—ä¸»é”®ï¼‰</th><th>DB_ROLL_PTRï¼ˆå›æ»šæŒ‡é’ˆï¼‰</th></tr></thead><tbody><tr><td>å¼ ä¸‰</td><td>19</td><td>NULL</td><td>1</td><td>NULL</td></tr></tbody></table><p>æˆ‘ä»¬å¹¶ä¸çŸ¥é“åˆ›å»ºè¿™ä¸ªè®°å½•çš„äº‹åŠ¡IDï¼Œæ‰€ä»¥è®¾ç½®ä¸ºNULLï¼›å› ä¸ºæ˜¯ç¬¬ä¸€æ¡è®°å½•ï¼Œæ‰€ä»¥éšè—ä¸»é”®æ˜¯1ï¼›å› ä¸ºæ˜¯ç¬¬ä¸€æ¡è®°å½•ï¼Œæ‰€ä»¥æ²¡æœ‰å›æ»šçš„åœ°æ–¹ï¼Œå›æ»šæŒ‡é’ˆä¹Ÿæ˜¯NULLï¼ˆæ¢å¥è¯è¯´ï¼Œå¦‚æœå›æ»šæŒ‡é’ˆä¸ºNULLï¼Œä»£è¡¨è¿™ä¸ªå°±æ˜¯è¿™ä¸ªè¡¨ä¸­çš„ç¬¬ä¸€æ¡è®°å½•äº†ï¼‰</p><h3 id="4-1-2-undoæ—¥å¿—"><a href="#4-1-2-undoæ—¥å¿—" class="headerlink" title="4.1.2 undoæ—¥å¿—"></a>4.1.2 undoæ—¥å¿—</h3><p>MySQLæ˜¯ä»¥æœåŠ¡è¿›ç¨‹çš„æ–¹å¼åœ¨å†…å­˜ä¸­è¿è¡Œçš„ï¼Œæˆ‘ä»¬å¯¹æ•°æ®çš„CURDæ“ä½œï¼Œéƒ½éœ€è¦é€šè¿‡MySQLå°†å…¶åˆ·å…¥åˆ°ç¡¬ç›˜ä¸Šè¿›è¡ŒæŒä¹…åŒ–ï¼ŒMySQLä¸ºè¿™äº›æ“ä½œä¼šæä¾›ä¸€ä¸ªä¸“é—¨çš„<code>buffer pool</code>å†…å­˜ç¼“å†²åŒºï¼›è€Œ<code>undo log/redo log</code>ä¹Ÿæ˜¯å†…å­˜ä¸­çš„ä¸€å—åŒºåŸŸï¼Œå¯¹äºMySQLè€Œè¨€</p><ul><li>æ—¥å¿—éœ€è¦ç«‹åˆ»åˆ·ç›˜ï¼ˆæœ‰ä¸€ä¸ªä¸“é—¨çš„çº¿ç¨‹æ¥ç®¡ç†æ—¥å¿—ï¼‰</li><li>æ•°æ®æ ¹æ®è¿è¡Œç­–ç•¥ï¼Œé€‰æ‹©åˆé€‚çš„æ—¶é—´åˆ·ç›˜ï¼ˆå› ä¸ºæ•°æ®é‡ä¸€èˆ¬æ¯”è¾ƒå¤§ï¼Œå¦‚æœå®æ—¶åˆ·ç›˜ä¼šé€ æˆè¾ƒå¤§IOè´Ÿè½½ï¼Œå½±å“è¿›ç¨‹è¿è¡Œï¼‰</li></ul><p>å…ˆæ¥è¯´è¯´<code>redo log</code>ï¼Œè¿™é‡ŒåŒ…å«äº†MySQLä¸­çš„æ‰€æœ‰å°šæœªè½ç›˜çš„CURDæ“ä½œï¼›å¦‚æœMySQLè¿˜æ²¡æœ‰å†™å…¥æ•°æ®çš„æ—¶å€™å°±æŒ‚äº†ï¼Œé‚£ä¹ˆä¸‹æ¬¡å¯åŠ¨çš„æ—¶å€™å°±ä¼šä»<code>redo log</code>é‡Œé¢æ¢å¤æ•°æ®ï¼Œæ¥ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ï¼›</p><p>åœ¨MySQLå­˜å‚¨è·¯å¾„<code>/var/lib/mysql</code>ä¸­çš„<code>ib_logfile0/ib_logfile1</code>å°±æ˜¯<code>redo log</code>ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-rw-rw----. 1 mysql mysql  50331648 Sep 11 03:16 ib_logfile0</span><br><span class="line">-rw-rw----. 1 mysql mysql  50331648 Sep  9 21:03 ib_logfile1</span><br></pre></td></tr></table></figure><p>è€Œ<code>undo log</code>ä¸»è¦ç”¨äºä»¥ä¸‹åŠŸèƒ½</p><ol><li>å›æ»šäº‹åŠ¡</li><li>MVCCï¼ˆå¤šç‰ˆæœ¬æ§åˆ¶&#x2F;éš”ç¦»æ€§å’Œéš”ç¦»çº§åˆ«ï¼‰</li></ol><p>å‡è®¾æˆ‘ä»¬æ¥äº†ä¸€ä¸ªupdateæ“ä½œï¼Œå°†åˆšåˆšæ’å…¥çš„å¼ ä¸‰çš„å¹´é¾„æ”¹æˆ30å²ï¼Œå¯¹äºMySQLè€Œè¨€å°±ä¼šåœ¨<code>undo log</code>é‡Œé¢åšå¦‚ä¸‹å¤„ç†ï¼›</p><ul><li>è¯¥updateæ“ä½œå¯¹åº”çš„äº‹åŠ¡<code>DB_TRX_ID</code>æ˜¯10ï¼›</li><li>å°†æ—§æ•°æ®æ”¾å…¥<code>undo log</code>ä¸­ï¼Œå¹¶å°†å½“å‰æ•°æ®çš„<code>DB_ROLL_PTR</code>æŒ‡å‘æ—§æ•°æ®çš„åœ°å€ï¼›</li><li>å¦‚æœéœ€è¦å›æ»šï¼Œé‚£ä¹ˆå°±é€šè¿‡<code>DB_ROLL_PTR</code>æ‰¾åˆ°æ—§æ•°æ®ï¼Œå¤å†™å›å»ï¼›</li></ul><p><img src="https://img.musnow.top/i/2023/09/6f386ba45e0c26e72de76bff973c4a4f.png" alt="image-20230911172501941"></p><p>å¦‚æœå†æ¥ä¸€æ¬¡ä¿®æ”¹ï¼Œå°†å¼ ä¸‰çš„åå­—æ”¹æˆæå››ï¼Œä¹Ÿæ˜¯ä¾ç…§è¿™ä¸ªé€»è¾‘åœ¨<code>undo log</code>ä¸­æ–°å¢æ—§æ•°æ®ï¼Œå¹¶é“¾æ¥<code>DB_ROLL_PTR</code>æŒ‡é’ˆï¼›</p><ul><li>äº‹åŠ¡11ä¿®æ”¹è¿™æ¡æ•°æ®ï¼Œå…ˆç”³è¯·é”ï¼›</li><li>å°†ç°æœ‰æ•°æ®å¤åˆ¶åˆ°<code>undo log</code>ä¸­ï¼ˆå¤´æ’ï¼‰ï¼Œå¹¶å°†<code>DB_ROLL_PTR</code>æŒ‡é’ˆæŒ‡å‘æ—§æ•°æ®çš„åœ°å€ï¼›</li><li>ä¿®æ”¹è®°å½•ä¸­çš„nameï¼Œå¹¶ä¸”å°†<code>DB_TRX_ID</code>æ”¹æˆå½“å‰äº‹åŠ¡çš„ID 11ï¼›</li><li>äº‹åŠ¡11æäº¤ï¼Œé‡Šæ”¾é”ï¼›</li></ul><p><img src="https://img.musnow.top/i/2023/09/d4a9aca8bdd9c3e38daa5b07896e7684.png" alt="image-20230911173024425"></p><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªç±»ä¼¼äºé“¾è¡¨çš„å†å²ç‰ˆæœ¬é“¾ï¼›æ¯æ¬¡å›é€€çš„æ—¶å€™ï¼Œéƒ½å¯ä»¥æ‰¾åˆ°å†å²æ•°æ®ï¼Œè¦†ç›–å½“å‰çš„æ•°æ®ã€‚è¿™äº›ç‰ˆæœ¬æˆ‘ä»¬ç§°ä¹‹ä¸º<code>å¿«ç…§</code>ï¼›</p><p>è€Œæ’å…¥å’Œåˆ é™¤éƒ½å¯ä»¥å†™å…¥<code>undo log</code>ï¼Œä½†æ˜¯åªæœ‰æ›´æ–°å’Œåˆ é™¤èƒ½å½¢æˆå†å²ç‰ˆæœ¬é“¾ï¼›</p><ul><li>åˆ é™¤æ˜¯å°†åˆ é™¤flagç½®ä¸ºçœŸï¼Œæ—§æ•°æ®ä¾æ—§å¯ä»¥å†™å…¥åˆ°<code>undo log</code>ä¸­ï¼Œå¦‚æœéœ€è¦å›æ»šï¼Œå°†è¿™è¡Œè®°å½•æ¢å¤ï¼›</li><li>æ’å…¥å¹¶æ²¡æœ‰å†å²ç‰ˆæœ¬ï¼Œä½†ä¹Ÿéœ€è¦å°†å…¶æ”¾å…¥<code>undo log</code>ä¸­ï¼Œäº‹åŠ¡å›æ»šçš„æ—¶å€™éœ€è¦å°†æ–°æ’å…¥çš„æ•°æ®åˆ é™¤ï¼›</li><li>äº‹åŠ¡æäº¤äº†ä¹‹åï¼Œå·²æœ‰çš„å†å²è®°å½•å¯ä»¥è¢«åˆ é™¤ï¼›</li></ul><p>å¢åˆ æ”¹éƒ½è¯´äº†ï¼Œé‚£ä¹ˆ<code>select</code>å‘¢ï¼Ÿ</p><p>ä¸€èˆ¬è€Œè¨€ï¼ŒæŸ¥è¯¢ä¸ä¼šäº§ç”Ÿæ•°æ®å†™å…¥æ“ä½œï¼Œä¹Ÿä¸éœ€è¦è®¾ç½®å†å²ç‰ˆæœ¬é“¾ï¼›</p><p>ä½†æ˜¯åœ¨ä¹‹å‰å…³äºRRçº§åˆ«éš”ç¦»æ€§çš„éªŒè¯ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†<code>select</code>æ— æ³•çœ‹åˆ°å¦å¤–ä¸€ä¸ªäº‹åŠ¡å·²ç»æäº¤äº†çš„æ•°æ®ï¼Œè¿™è¯´æ˜<code>select</code>æœ‰æ—¶å€™è¯»å–çš„æ˜¯<strong>å†å²ç‰ˆæœ¬</strong>çš„æ•°æ®ï¼Œè€Œå¹¶éå½“å‰æœ€æ–°çš„æ•°æ®ï¼</p><p>è¯»å–å†å²æ•°æ®æˆ‘ä»¬ç§°ä¹‹ä¸º<code>å¿«ç…§è¯»</code>ï¼Œåœ¨RRçº§åˆ«ä¸­é»˜è®¤é‡‡ç”¨çš„å°±æ˜¯å¿«ç…§è¯»ï¼›è¯»å–æœ€æ–°æ•°æ®å«åšå½“å‰è¯»ï¼ˆå¢åˆ æ”¹éƒ½æ˜¯å½“å‰è¯»ï¼‰ï¼›è¿˜æœ‰ä¸€ç§è¯»å–æ˜¯ä¸ºäº†æ›´æ–°è€ŒæŸ¥è¯¢ï¼›</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ... <span class="comment">-- åœ¨RRçº§åˆ«ä¸‹ï¼Œé»˜è®¤æ˜¯å¿«ç…§è¯»</span></span><br><span class="line"><span class="keyword">select</span> ... <span class="keyword">for</span> <span class="keyword">update</span>; <span class="comment">-- ä¸ºäº†æ›´æ–°è€ŒæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">-- MySQLä¼šå°†å½“å‰è¡Œä¸Šæ’ä»–é”ï¼Œä¸Šé”äº†ä¹‹åï¼Œå…¶ä»–å®¢æˆ·ç«¯åªèƒ½æŸ¥è¯¢è¯¥è¡Œï¼Œæ— æ³•ä¿®æ”¹</span></span><br><span class="line"><span class="keyword">select</span> ... lock <span class="keyword">in</span> share mode; <span class="comment">-- æŸ¥è¯¢æœ€æ–°æ•°æ®ï¼ˆå½“å‰è¯»ï¼‰</span></span><br><span class="line"><span class="comment">-- æ˜¯ä¸²è¡ŒåŒ–çš„ï¼Œåªæœ‰å…¶ä»–äº‹åŠ¡å®Œæˆäº†ï¼Œæ‰èƒ½æŸ¥è¯¢åˆ°æœ€æ–°ç»“æœï¼›</span></span><br></pre></td></tr></table></figure><p>é™¤äº†æ‰‹åŠ¨æŒ‡å®š<code>select</code>çš„æŸ¥è¯¢æ–¹å¼ä»¥å¤–ï¼Œéš”ç¦»çº§åˆ«ä¼šå½±å“<code>select</code>çš„é»˜è®¤è¡Œä¸ºï¼Œæ¯”å¦‚åœ¨ä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«çš„åœºæ™¯ä¸‹ï¼Œé»˜è®¤æ‰§è¡Œçš„å°±æ˜¯<strong>å½“å‰è¯»</strong>ï¼›</p><p>åœ¨RRæ¨¡å¼ä¸‹è¿›è¡Œæµ‹è¯•ï¼Œä¼šå‘ç°å½“å‰è¯»ä¼šé˜»å¡å½“å‰çš„å®¢æˆ·ç«¯ï¼ˆå³ä¾§å®¢æˆ·ç«¯é˜»å¡ï¼‰ï¼›</p><p><img src="https://img.musnow.top/i/2023/09/4025f787fda333689872e3295712df1b.png" alt="image-20230911200703608"></p><p>åªæœ‰å·¦ä¾§çš„äº‹åŠ¡åœ¨æäº¤äº†ä¹‹åï¼Œå³ä¾§çš„æŸ¥è¯¢æ‰ä¼šè¿”å›æœ€æ–°çš„ç»“æœï¼›</p><p><img src="https://img.musnow.top/i/2023/09/1675840504edd0a5689e3a6ec052a4dd.png" alt="image-20230911201033979"></p><p>è¿™æ˜¯å› ä¸º<strong>å½“å‰è¯»</strong>ï¼ŒåŒ…æ‹¬å¢åˆ æ”¹æ“ä½œï¼Œæ˜¯éœ€è¦åŠ é”çš„ï¼›å¦‚æœè¦åœ¨RRæ¨¡å¼ä¸‹å®ç°å½“å‰è¯»ï¼Œé‚£ä¹ˆæ•´ä¸ªç³»ç»Ÿå°±éœ€è¦<strong>ä¸²è¡ŒåŒ–</strong>æ‰§è¡Œï¼›</p><p>è€Œå¿«ç…§è¯»ä¸éœ€è¦åŠ é”ï¼Œå› ä¸ºå®ƒå¯ä»¥è¯»å–å†å²ç‰ˆæœ¬ï¼Œè€Œå†å²ç‰ˆæœ¬æ˜¯ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹çš„ï¼Œä¹Ÿå°±ä¸éœ€è¦ç»´æŠ¤è®¿é—®æ§åˆ¶ï¼Œæé«˜äº†å¹¶å‘æ•ˆç‡ï¼›</p><p>é‚£ä¹ˆï¼ŒMySQLæ˜¯å¦‚ä½•å®ç°å¿«ç…§è¯»çš„å‘¢ï¼Ÿ</p><h3 id="4-1-3-Read-View"><a href="#4-1-3-Read-View" class="headerlink" title="4.1.3 Read View"></a>4.1.3 Read View</h3><p><code>Read View</code>å°±æ˜¯MySQLä¸ºå¿«ç…§è¯»ç”Ÿæˆçš„ä¸€ä¸ª<strong>è¯»è§†å›¾</strong>ï¼›åœ¨äº‹åŠ¡æ‰§è¡Œå¿«ç…§è¯»çš„æ—¶å€™ï¼ˆå³æ‰§è¡Œ<code>select</code>çš„æ—¶å€™ï¼‰å°†å½“å‰æ•°æ®æ‹ä¸€å¼ ç…§ï¼Œè¿™æ ·åœ¨è¿™ä¸ªäº‹åŠ¡ä¸­ï¼Œåç»­çš„æ‰€æœ‰<code>select</code>éƒ½åªä¼šçœ‹åˆ°è¿™ä¸ªç…§ç‰‡é‡Œé¢çš„ç»“æœï¼Œçœ‹ä¸åˆ°å…¶ä»–äº‹åŠ¡æœ€æ–°çš„ä¿®æ”¹ï¼ˆä¸ç®¡å…¶ä»–äº‹åŠ¡æ˜¯å¦commitï¼‰ã€‚</p><blockquote><p>å¿«ç…§è¯»çš„ç°è±¡æˆ‘ä»¬å·²ç»åœ¨æœ¬æ–‡ <code>3.4 å¯é‡å¤è¯»</code> ä¸­æ¼”ç¤ºè¿‡äº†ï¼Œè¿™é‡Œå°±ä¸å†äºŒæ¬¡æ¼”ç¤ºäº†ï¼›</p></blockquote><p><code>Read View</code>åœ¨MySQLçš„æºç ä¸­å…¶å®å°±æ˜¯ä¸€ä¸ªç±»ï¼Œè¯¥ç±»ä¸­åŒ…å«ä¸€äº›å¯è¯»æ€§åˆ¤æ–­çš„ä¿¡æ¯ï¼Œå†…éƒ¨æœ‰æ¡ä»¶ï¼Œæ¥æ ‡æ˜å½“å‰äº‹åŠ¡èƒ½å¤Ÿçœ‹åˆ°é‚£ä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼Œå³æœ‰å¯èƒ½æ˜¯å½“å‰æœ€æ–°çš„æ•°æ®ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯<code>undo log</code>ä¸­çš„æŸä¸ªå†å²ç‰ˆæœ¬ï¼›</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ReadView</span> &#123;</span><br><span class="line"><span class="comment">// çœç•¥...</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">/** é«˜æ°´ä½ï¼Œå¤§äºç­‰äºè¿™ä¸ªIDçš„äº‹åŠ¡å‡ä¸å¯è§*/</span></span><br><span class="line">    <span class="type">trx_id_t</span> m_low_limit_id</span><br><span class="line">    <span class="comment">/** ä½æ°´ä½ï¼šå°äºè¿™ä¸ªIDçš„äº‹åŠ¡å‡å¯è§ */</span></span><br><span class="line">    <span class="type">trx_id_t</span> m_up_limit_id;</span><br><span class="line">    <span class="comment">/** åˆ›å»ºè¯¥ Read View çš„äº‹åŠ¡ID*/</span></span><br><span class="line">    <span class="type">trx_id_t</span> m_creator_trx_id;</span><br><span class="line">    <span class="comment">/** åˆ›å»ºè§†å›¾æ—¶çš„æ´»è·ƒäº‹åŠ¡idåˆ—è¡¨ï¼Œæ˜¯ä¸€ä¸ªä½å›¾ */</span></span><br><span class="line">    <span class="type">ids_t</span> m_ids;</span><br><span class="line">    <span class="comment">/** é…åˆpurgeï¼Œæ ‡è¯†è¯¥è§†å›¾ä¸éœ€è¦å°äºm_low_limit_noçš„UNDO LOGï¼Œ</span></span><br><span class="line"><span class="comment">    * å¦‚æœå…¶ä»–è§†å›¾ä¹Ÿä¸éœ€è¦ï¼Œåˆ™å¯ä»¥åˆ é™¤å°äºm_low_limit_noçš„UNDO LOG*/</span></span><br><span class="line">    <span class="type">trx_id_t</span> m_low_limit_no;</span><br><span class="line">    <span class="comment">/** æ ‡è®°è§†å›¾æ˜¯å¦è¢«å…³é—­*/</span></span><br><span class="line">    <span class="type">bool</span> m_closed;</span><br><span class="line">    <span class="comment">// çœç•¥...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å•ç‹¬è¯´æ˜ä¸€ä¸‹è¿™é‡Œçš„4ä¸ªé‡è¦çš„å˜é‡ï¼›å…¶ä¸­éœ€è¦æ³¨æ„ï¼Œåœ¨è¿™é‡Œé¢<strong>upæ˜¯ä½æ°´ä½ï¼Œlowæ˜¯é«˜æ°´ä½</strong>ï¼Œè¿™æ˜¯ç”±ä»–ä»¬ä¿å­˜çš„æ•°æ®çš„æ€§è´¨å†³å®šçš„ï¼Œè¯·ä¸è¦å’Œè¿™ä¸¤ä¸ªå•è¯çš„æœ¬æ„æ··æ·†ï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">m_ids; <span class="comment">// ä¸€å¼ ä½å›¾ï¼Œç”¨æ¥ä¿å­˜Read Viewç”Ÿæˆæ—¶ï¼Œç³»ç»Ÿæ­£æ´»è·ƒï¼ˆæ²¡æœ‰ç»“æŸçš„ï¼‰çš„äº‹åŠ¡ID</span></span><br><span class="line">up_limit_id; <span class="comment">// è®°å½•m_idsåˆ—è¡¨ä¸­äº‹åŠ¡IDæœ€å°çš„ID </span></span><br><span class="line">low_limit_id; <span class="comment">// ReadViewç”Ÿæˆæ—¶åˆ»ç³»ç»Ÿå°šæœªåˆ†é…çš„ä¸‹ä¸€ä¸ªäº‹åŠ¡IDï¼Œä¹Ÿå°±æ˜¯ç›®å‰å·²å‡ºç°è¿‡çš„äº‹åŠ¡IDçš„æœ€å¤§å€¼+1</span></span><br><span class="line">creator_trx_id <span class="comment">// åˆ›å»ºè¯¥ReadViewçš„äº‹åŠ¡ID</span></span><br></pre></td></tr></table></figure><p>è¦çŸ¥é“ï¼Œå½“å‰äº‹åŠ¡æ˜¯çŸ¥é“è‡ªå·±çš„äº‹åŠ¡IDçš„ï¼ˆ<code>DB_TRX_ID</code>ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‰‹ä¸­å°±æœ‰å¿«ç…§è¯»ä¸­æœ€å¤§æœ€å°çš„äº‹åŠ¡IDï¼Œä»¥åŠå½“å‰æ´»è·ƒä¸­çš„äº‹åŠ¡IDï¼›é‚£ä¹ˆåœ¨è¯»å–ç‰ˆæœ¬é“¾çš„æ—¶å€™ï¼Œå°±è¿›è¡Œå¦‚ä¸‹åŒ¹é…ï¼Œè®¾å½“å‰å¼€å¯çš„è¿™ä¸ª<strong>äº‹åŠ¡ä¸ºA</strong>:</p><ul><li>ç‰ˆæœ¬é“¾ä¸­çš„äº‹åŠ¡IDä¸å­˜åœ¨äº<code>m_ids</code>ä¸­ï¼Œä»£è¡¨<strong>äº‹åŠ¡Aå¼€å¯</strong>çš„æ—¶å€™ï¼Œè¿™ä¸ªäº‹åŠ¡å·²ç»æäº¤äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¯»å–è¿™ä¸ªäº‹åŠ¡æ“ä½œçš„ç»“æœï¼›</li><li>ç‰ˆæœ¬é“¾ä¸­çš„äº‹åŠ¡IDå­˜åœ¨äº<code>m_ids</code>ä¸­ï¼Œä»£è¡¨äº‹åŠ¡Aå¼€å¯çš„æ—¶å€™ï¼Œè¿™ä¸ªäº‹åŠ¡æ˜¯<strong>æ´»è·ƒçŠ¶æ€</strong>ï¼Œé‚£ä¹ˆæˆ‘å°±ä¸åº”è¯¥è¯»åˆ°è¿™ä¸ªäº‹åŠ¡çš„æ“ä½œç»“æœï¼›</li><li>ç‰ˆæœ¬é“¾çš„ä¸­çš„äº‹åŠ¡IDå¤§äº<code>low_limit_id</code>ï¼Œä»£è¡¨äº‹åŠ¡Aå¼€å¯çš„æ—¶å€™ï¼Œè¿™ä¸ªäº‹åŠ¡è¿˜ä¸å­˜åœ¨ï¼Œæ‰€ä»¥ä¹Ÿä¸åº”è¯¥çœ‹åˆ°è¿™ä¸ªåœ¨Aä¹‹åæ¥çš„äº‹åŠ¡çš„æ“ä½œç»“æœï¼›ï¼ˆAè¿˜æ²¡æ“ä½œå®Œæ¯•ï¼Œè¿™ä¸ªæ–°äº‹åŠ¡å°±æ¥äº†ï¼‰</li><li>ç‰ˆæœ¬é“¾ä¸­çš„äº‹ç‰©IDå°äº<code>up_limit_id</code>ï¼Œä»£è¡¨äº‹ç‰©Aå¼€å¯çš„æ—¶å€™ï¼Œè¿™ä¸ªäº‹ç‰©éƒ½ä¸çŸ¥é“æ˜¯æ˜¯å®ƒçš„çˆ¶äº²è¾ˆè¿˜æ˜¯çˆ·çˆ·è¾ˆäº†ï¼Œ<strong>é•¿è¾ˆç»™ä½ ç•™ä¸‹çš„ä¸œè¥¿è‚¯å®šå¾—å¥½å¥½æ”¶ç€</strong>ï¼›è¯´äººè¯ï¼šè¿™ä¸ªæ˜¯Aæ¥ä¹‹å‰çš„ä¹‹å‰å°±å·²ç»ç»“æŸäº†çš„äº‹ç‰©ï¼Œè‚¯å®šæ˜¯å¯ä»¥è¯»å–å…¶ç»“æœçš„ï¼›</li></ul><p>åœ¨MySQLä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æºç ï¼Œé“¾æ¥ä¹Ÿè´´å‡ºæ¥äº†ï¼Œgithubä¸Šå¯ä»¥æŸ¥çœ‹æºç ï¼›è¿™ä¸ªå‡½æ•°å°±æ˜¯ç”¨æ¥åˆ¤æ–­å½“å‰äº‹åŠ¡åº”è¯¥èƒ½çœ‹åˆ°é‚£äº›ç‰ˆæœ¬é“¾çš„ï¼Œå…·ä½“çš„åˆ¤æ–­é€»è¾‘å‚è€ƒä¸­æ–‡æ³¨é‡Šï¼ˆè‹±æ–‡æ³¨é‡Šæ˜¯å®˜æ–¹ç•™çš„ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™ä¸ªå‡½æ•°æ˜¯ReadViewç±»çš„æˆå‘˜å‡½æ•° ReadView::changes_visible </span></span><br><span class="line"><span class="comment">// æºç é“¾æ¥ https://github.com/mysql/mysql-server/blob/ea1efa9822d81044b726aab20c857d5e1b7e046a/storage/innobase/include/read0types.h#L162  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// [[nodiscard]] ä»£è¡¨è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼ä¸èƒ½è¢«å¿½ç•¥ï¼Œä¸€å®šéœ€è¦ä½¿ç”¨è¯¥è¿”å›å€¼ï¼›å¦åˆ™ç¼–è¯‘å™¨ä¼šçˆ†è­¦å‘Šï¼›å³å‘ŠçŸ¥ç¨‹åºå‘˜å¿…é¡»å…³æ³¨è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼ï¼</span></span><br><span class="line"><span class="comment">// å‡½æ•°çš„è¿”å›å€¼æ˜¯å½“å‰äº‹åŠ¡èƒ½å¦çœ‹åˆ°æŸä¸€ä¸ªäº‹åŠ¡idå€¼çš„ç‰ˆæœ¬é“¾ï¼Œå…¥å‚æ˜¯ç›®æ ‡äº‹åŠ¡id</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** Check whether the changes by id are visible.</span></span><br><span class="line"><span class="comment">  @param[in]    id      transaction id to check against the view</span></span><br><span class="line"><span class="comment">  @param[in]    name    table name</span></span><br><span class="line"><span class="comment">  @return whether the view sees the modifications of id. */</span></span><br><span class="line">  [[nodiscard]] <span class="function"><span class="type">bool</span> <span class="title">changes_visible</span><span class="params">(<span class="type">trx_id_t</span> id,</span></span></span><br><span class="line"><span class="params"><span class="function">                                     <span class="type">const</span> <span class="type">table_name_t</span> &amp;name)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">    <span class="built_in">ut_ad</span>(id &gt; <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°äºæœ€å°çš„äº‹åŠ¡idæˆ–è€…ç­‰äºå½“å‰äº‹åŠ¡idï¼Œåˆ™ä»£è¡¨è¿™ä¸ªäº‹åŠ¡æˆ‘ä»¬å¯ä»¥çœ‹åˆ° </span></span><br><span class="line">    <span class="keyword">if</span> (id &lt; m_up_limit_id || id == m_creator_trx_id) &#123;</span><br><span class="line">      <span class="keyword">return</span> (<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">check_trx_id_sanity</span>(id, name);</span><br><span class="line"><span class="comment">// å¦‚æœè¿™ä¸ªidæ¯”å½“å‰äº‹åŠ¡ä¸­çš„é«˜æ°´ä½è¿˜å¤§ï¼Œè¯´æ˜è¿™ä¸ªidæ˜¯åæ¥è€…ï¼Œä¸åº”è¯¥çœ‹åˆ°</span></span><br><span class="line">    <span class="keyword">if</span> (id &gt;= m_low_limit_id) &#123;</span><br><span class="line">      <span class="keyword">return</span> (<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// å¦‚æœå½“å‰äº‹åŠ¡åˆ›å»ºæ—¶ï¼Œæ²¡æœ‰æ´»è·ƒäº‹åŠ¡</span></span><br><span class="line">    <span class="comment">// ä¸” m_up_limit_id &lt;= id &lt; m_low_limit_id </span></span><br><span class="line">    <span class="comment">// é‚£ä¹ˆè¿™ä¸ªäº‹åŠ¡IDå°±å¯ä»¥è¢«çœ‹åˆ°ï¼Œè¿”å›çœŸ</span></span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span> (m_ids.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">      <span class="built_in">return</span> (<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">ids_t</span>::value_type *p = m_ids.<span class="built_in">data</span>();</span><br><span class="line"><span class="comment">// å¦‚æœä¸Šé¢éƒ½æ²¡æœ‰åŒ¹é…åˆ°ï¼Œé‚£å°±æ£€æŸ¥è¿™ä¸ªidæ˜¯å¦åœ¨æ´»è·ƒåˆ—è¡¨m_idsä¸­</span></span><br><span class="line">    <span class="comment">// std::binary_searchçš„è¿”å›å€¼ï¼šæ˜¯å¦åœ¨ä½å›¾ä¸­ï¼Œtrueä»£è¡¨åœ¨ï¼Œfalseä»£è¡¨ä¸åœ¨</span></span><br><span class="line">    <span class="comment">// å¦‚æœåœ¨ï¼Œé‚£ä¹ˆè¿™ä¸ªäº‹åŠ¡æ˜¯æ´»è·ƒçŠ¶æ€ï¼Œä¸èƒ½è¢«çœ‹åˆ°</span></span><br><span class="line">    <span class="comment">// å¦‚æœä¸åœ¨ï¼Œé‚£ä¹ˆè¿™ä¸ªäº‹åŠ¡æ˜¯å·²ç»æäº¤äº†ï¼Œå¯ä»¥è¢«çœ‹åˆ°</span></span><br><span class="line">    <span class="keyword">return</span> (!std::<span class="built_in">binary_search</span>(p, p + m_ids.<span class="built_in">size</span>(), id));</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæŸ¥åˆ°ä¸åº”è¯¥çœ‹åˆ°å½“å‰ç‰ˆæœ¬ï¼Œæ¥ä¸‹æ¥å°±æ˜¯éå†ä¸‹ä¸€ä¸ªç‰ˆæœ¬ï¼Œç›´åˆ°ç¬¦åˆæ¡ä»¶ï¼Œå³å¯ä»¥çœ‹åˆ°ã€‚è¿™ä¾¿æ˜¯æˆ‘ä»¬selectå½“å‰è¯»çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨äº§ç”Ÿçš„<code>ReadView</code>ç»“æ„ä½“çš„ä½œç”¨ï¼›</p><p>æ ¹æ®è¿™ä»½æºç ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½çŸ¥é“<code>m_ids</code>ä½å›¾ä¸­ï¼Œå¹¶ä¸éœ€è¦å­˜æ”¾å½“å‰äº‹åŠ¡IDï¼Œå› ä¸ºä¼šæœ‰é¢å¤–çš„åˆ¤æ–­æ¥å¤„ç†å½“å‰äº‹åŠ¡IDï¼</p><h2 id="4-2-å¿«ç…§è¯»å®æ“"><a href="#4-2-å¿«ç…§è¯»å®æ“" class="headerlink" title="4.2 å¿«ç…§è¯»å®æ“"></a>4.2 å¿«ç…§è¯»å®æ“</h2><h3 id="4-2-1-å¿«ç…§æ˜¯ä»€ä¹ˆæ—¶å€™ç”Ÿæˆçš„ï¼Ÿ"><a href="#4-2-1-å¿«ç…§æ˜¯ä»€ä¹ˆæ—¶å€™ç”Ÿæˆçš„ï¼Ÿ" class="headerlink" title="4.2.1 å¿«ç…§æ˜¯ä»€ä¹ˆæ—¶å€™ç”Ÿæˆçš„ï¼Ÿ"></a>4.2.1 å¿«ç…§æ˜¯ä»€ä¹ˆæ—¶å€™ç”Ÿæˆçš„ï¼Ÿ</h3><p>å‡è®¾å½“å‰çš„äº‹åŠ¡æµç¨‹å¦‚ä¸‹ï¼Œäº‹åŠ¡2èƒ½çœ‹åˆ°äº‹åŠ¡1çš„æ“ä½œç»“æœå—ï¼Ÿ</p><table><thead><tr><th>äº‹åŠ¡1</th><th>äº‹åŠ¡2</th></tr></thead><tbody><tr><td>äº‹åŠ¡å¼€å§‹</td><td>äº‹åŠ¡å¼€å§‹</td></tr><tr><td>æ’å…¥æ•°æ®1å¹¶æäº¤äº‹åŠ¡</td><td></td></tr><tr><td></td><td>ç¬¬ä¸€æ¬¡æŸ¥è¯¢</td></tr><tr><td>é‡å¼€ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œæ’å…¥æ•°æ®2å¹¶æäº¤</td><td></td></tr><tr><td></td><td>ç¬¬äºŒæ¬¡æŸ¥è¯¢</td></tr></tbody></table><p>æ¥å®æ“ä¸€ä¸‹ï¼Œå¼€ä¸¤ä¸ªMySQLç»ˆç«¯ï¼Œéš”ç¦»çº§åˆ«è®¾ç½®ä¸ºRRï¼›å›¾ä¸­é»„å­—æ ‡å‡ºäº†æ¯ä¸€ä¸ªSQLçš„æ‰§è¡Œé¡ºåºï¼›æˆ‘ä»¬ä¼šå‘ç°ï¼Œå½“å·¦ä¾§ç»ˆç«¯æäº¤äº†ç¬¬ä¸€ä¸ªæ’å…¥çš„æ•°æ®åï¼Œå³ä¾§æ‰æŸ¥è¯¢ï¼Œ<strong>æ˜¯å¯ä»¥çœ‹åˆ°è¿™æ¡æ–°æ’å…¥çš„æ•°æ®çš„</strong>ï¼</p><p>è€Œå·¦ä¾§æ’å…¥çš„ç¬¬äºŒæ¡æ•°æ®å³ä¾§å°±çœ‹ä¸åˆ°äº†ï¼Œå¾ˆæ˜æ˜¾ï¼Œæ­¤æ—¶è®¿é—®çš„å°±æ˜¯å¿«ç…§ä¸­çš„æ—§æ•°æ®ï¼Œè€Œä¸æ˜¯æ–°æ•°æ®äº†ï¼›</p><p><img src="https://img.musnow.top/i/2023/09/c8def576b68454081f60029cfa781b5a.png" alt="image-20230912094327001"></p><p>è¿™å°±å‘Šè¯‰æˆ‘ä»¬ï¼šå¿«ç…§è¯»çš„<strong>å¿«ç…§</strong>æ˜¯åœ¨äº‹åŠ¡ä¸­ç¬¬ä¸€æ¬¡æ‰§è¡Œ<code>select</code>è¯­å¥çš„æ—¶å€™ç”Ÿæˆçš„ï¼å¹¶ä¸æ˜¯äº‹åŠ¡å¼€å§‹çš„æ—¶å€™ç”Ÿæˆçš„ï¼</p><p>è¿™ä¹Ÿéå¸¸åˆç†ï¼Œå¦‚æœä½ çš„å½“å‰äº‹åŠ¡å‹æ ¹æ²¡æœ‰è¿›è¡Œ<code>select</code>è¯­å¥ï¼Œé‚£æˆ‘ä¹Ÿå°±æ²¡æœ‰å¿…è¦ç”Ÿæˆå¿«ç…§äº†ï¼Œæ¯•ç«Ÿå¿«ç…§çš„åº•å±‚æ˜¯<code>ReadView</code>å¯¹è±¡ï¼Œä¹Ÿæ˜¯ä¼šå ç”¨å†…å­˜ç©ºé—´çš„ï¼è€Œå¢åˆ æ”¹æ“ä½œæœ¬èº«å°±æ˜¯å½“å‰è¯»ï¼Œæ— éœ€ç”Ÿæˆå¿«ç…§ï¼</p><h3 id="4-2-2-å®ä¾‹è§£é‡ŠReadViewçš„æˆå‘˜å˜é‡"><a href="#4-2-2-å®ä¾‹è§£é‡ŠReadViewçš„æˆå‘˜å˜é‡" class="headerlink" title="4.2.2 å®ä¾‹è§£é‡ŠReadViewçš„æˆå‘˜å˜é‡"></a>4.2.2 å®ä¾‹è§£é‡ŠReadViewçš„æˆå‘˜å˜é‡</h3><p>ç”¨å®é™…ä¾‹å­æ¥è§£é‡Šä¸€ä¸‹ReadViewé‡Œé¢çš„4ä¸ªæˆå‘˜å˜é‡åˆ°åº•åº”è¯¥å­˜æ”¾ä»€ä¹ˆå€¼ï¼›</p><p>å‡è®¾æœ‰ä¸‹é¢è¿™ä¸ªæ•°æ®</p><table><thead><tr><th>name</th><th>age</th><th>DB_TRX_ID(åˆ›å»ºè¿™ä¸ªè®°å½•çš„äº‹åŠ¡ID)</th><th>DB_ROW_IDï¼ˆéšè—ä¸»é”®ï¼‰</th><th>DB_ROLL_PTRï¼ˆå›æ»šæŒ‡é’ˆï¼‰</th></tr></thead><tbody><tr><td>å¼ ä¸‰</td><td>19</td><td>NULL</td><td>1</td><td>NULL</td></tr></tbody></table><p>ä¸€å…±æœ‰4ä¸ªäº‹åŠ¡åŒæ—¶è¿è¡Œï¼Œäº‹åŠ¡åºå·å°±æ˜¯äº‹åŠ¡ID</p><table><thead><tr><th>äº‹åŠ¡2</th><th>äº‹åŠ¡3</th><th>äº‹åŠ¡4</th><th>äº‹åŠ¡5</th></tr></thead><tbody><tr><td>äº‹åŠ¡å¼€å§‹</td><td>äº‹åŠ¡å¼€å§‹</td><td>äº‹åŠ¡å¼€å§‹</td><td>äº‹åŠ¡å¼€å§‹</td></tr><tr><td>â€¦â€¦</td><td>â€¦â€¦</td><td>â€¦â€¦</td><td>ä¿®æ”¹å¼ ä¸‰çš„å¹´é¾„å¹¶æäº¤</td></tr><tr><td>è¿è¡Œ</td><td>å¿«ç…§è¯»</td><td>è¿è¡Œ</td><td>â€¦â€¦</td></tr><tr><td>â€¦â€¦</td><td>â€¦â€¦</td><td>â€¦â€¦</td><td>â€¦â€¦</td></tr></tbody></table><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œäº‹åŠ¡3å¯¹æŸè¡Œæ•°æ®è¿›è¡Œäº†å¿«ç…§è¯»ï¼ŒMySQLå°±ä¼šåœ¨è¿™æ—¶å€™ç”Ÿæˆä¸€ä¸ª<code>ReadView</code>ï¼Œå†…éƒ¨å˜é‡èµ‹å€¼å¦‚ä¸‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">m_ids; <span class="comment">// 2,4 (å½“å‰äº‹åŠ¡5å·²ç»æäº¤äº†ï¼Œæ‰€ä»¥é™¤äº†è‡ªå·±å°±åªæœ‰2å’Œ4æ´»è·ƒä¸­)</span></span><br><span class="line">up_limit_id; <span class="comment">// 2 (m_idsä¸­æœ€å°äº‹åŠ¡ID)</span></span><br><span class="line">low_limit_id; <span class="comment">// 5 + 1 = 6 (å½“å‰å·²ç»å‡ºç°çš„æœ€å¤§äº‹åŠ¡ID+1)</span></span><br><span class="line">creator_trx_id <span class="comment">// 3 (å½“å‰äº‹åŠ¡ID)</span></span><br></pre></td></tr></table></figure><p>å½“äº‹åŠ¡3è¿›è¡Œå¿«ç…§è¯»çš„æ—¶å€™ï¼Œå°±ä¼šæ‹¿äº‹åŠ¡5çš„è¿™ä»½æ•°æ®è¿›è¡Œæ¯”è¾ƒï¼Œæœ€ç»ˆå¾—åˆ°çš„ç»“æœæ˜¯ï¼Œäº‹åŠ¡3çš„å¿«ç…§æ˜¯<strong>å¯ä»¥</strong>çœ‹åˆ°äº‹åŠ¡5å¯¹æ•°æ®è¿›è¡Œçš„ä¿®æ”¹çš„ï¼</p><p>è€Œä¸”å¯¹äºå…¨å±€æ¥è¯´ï¼Œäº‹åŠ¡5æäº¤çš„è¿™ä»½æ•°æ®ä¹Ÿæ˜¯å½“å‰æœ€æ–°çš„æ•°æ®ï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¯”è¾ƒæµç¨‹ï¼ˆä¾ç…§ä¸Šæ–¹MySQLçš„æºç ï¼‰</span></span><br><span class="line"><span class="number">5</span> &lt; up_limit_id || <span class="number">5</span> == <span class="number">3</span>; <span class="comment">// ä¸å°äºæœ€å°çš„ï¼Œä¸”ä¹Ÿä¸ç­‰äºå½“å‰çš„äº‹åŠ¡ID 3</span></span><br><span class="line"><span class="number">5</span> &gt; low_limit_id; <span class="comment">// ä¸å¤§äºæœ€å¤§çš„</span></span><br><span class="line"><span class="comment">// åˆ¤æ–­5æ˜¯å¦åœ¨m_idsé‡Œé¢</span></span><br><span class="line">m_ids.<span class="built_in">contains</span>(<span class="number">5</span>); <span class="comment">// ä¸åœ¨</span></span><br><span class="line"><span class="comment">// ç»“è®ºï¼šreturn true;</span></span><br></pre></td></tr></table></figure><h2 id="4-3-å½“å‰è¯»å®æ“"><a href="#4-3-å½“å‰è¯»å®æ“" class="headerlink" title="4.3 å½“å‰è¯»å®æ“"></a>4.3 å½“å‰è¯»å®æ“</h2><p>å¿«ç…§è¯»çš„åœºæ™¯åŸºæœ¬ææ˜ç™½äº†ï¼Œå†æ¥è¯•è¯•å½“å‰è¯»ï¼ˆè¿™é‡Œå°æä¸€å˜´ï¼Œ<strong>å†™-å†™å¹¶å‘</strong>å¯ä»¥ç†è§£ä¸ºæ‰€æœ‰æ“ä½œéƒ½æ˜¯å½“å‰è¯»ï¼Œéœ€è¦ä¸²è¡ŒåŒ–ï¼‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ... lock <span class="keyword">in</span> share mode;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ä¸¤ä¸ªä¸åŒçš„æ“ä½œæµç¨‹ï¼Œæœ€ç»ˆä¼šå¾—åˆ°ä¸åŒçš„ç»“æœï¼›æ“ä½œä¹‹å‰ï¼Œå…ˆæ‰§è¡Œå¦‚ä¸‹ä¸¤ä¸ªsql</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> test_ruc;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test_ruc <span class="keyword">values</span> (<span class="number">1</span>,<span class="number">20</span>,<span class="string">&#x27;å¼ ä¸‰&#x27;</span>);</span><br></pre></td></tr></table></figure><p>åœ¨ç¬¬ä¸€æ¬¡æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬åœ¨å·¦ä¾§ç»ˆç«¯æ›´æ–°æ•°æ®ä¹‹å‰å°±æ‰§è¡Œäº†ä¸€æ¬¡å¿«ç…§è¯»ï¼Œæ­¤æ—¶MySQLä¼šç”Ÿæˆå¿«ç…§ï¼Œå³ä¾¿åœ¨å·¦ä¾§ç»ˆç«¯çš„äº‹åŠ¡commitäº†ä¹‹åï¼Œå³ä¾§ä¹Ÿæ— æ³•çœ‹åˆ°æœ€æ–°çš„<code>user_id=18</code>çš„æ•°æ®ï¼›<strong>æ­¤æ—¶ä½¿ç”¨å½“å‰è¯»ï¼Œå°±å¯ä»¥è¯»å–åˆ°æœ€æ–°çš„æ•°æ®</strong>ï¼</p><p><img src="https://img.musnow.top/i/2023/09/c7088a7f3657cc02ea436a8bfd30cb88.png" alt="image-20230912103634717"></p><p>è€Œåœ¨ç¬¬äºŒæ¬¡æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬è®©å·¦ä¾§ç»ˆç«¯å®Œæˆæ‰€æœ‰æ“ä½œï¼Œå³ä¾§ç»ˆç«¯å†å»æŸ¥è¯¢ï¼Œä¼šå‘ç°å¿«ç…§è¯»å’Œå½“å‰è¯»éƒ½èƒ½æŸ¥è¯¢åˆ°æœ€æ–°çš„ä¿®æ”¹ï¼›</p><p><img src="https://img.musnow.top/i/2023/09/615e7b7cfb64f9d8f4020469bd669cf3.png" alt="image-20230912103902180"></p><p>ç”±æ­¤å¯è§</p><ul><li>å¿«ç…§è¯»çš„å¿«ç…§æ˜¯ç¬¬ä¸€æ¬¡selectæŸ¥è¯¢çš„æ—¶å€™ç”Ÿæˆçš„</li><li>å½“å‰è¯»èƒ½ç»•è¿‡å¿«ç…§æŸ¥çœ‹åˆ°æœ€æ–°æ•°æ®ï¼</li></ul><h2 id="4-4-RRå’ŒRCçš„åŒºåˆ«"><a href="#4-4-RRå’ŒRCçš„åŒºåˆ«" class="headerlink" title="4.4 RRå’ŒRCçš„åŒºåˆ«"></a>4.4 RRå’ŒRCçš„åŒºåˆ«</h2><ul><li>æ­£æ˜¯Read Viewç”Ÿæˆæ—¶æœºçš„ä¸åŒï¼Œä»è€Œé€ æˆRC,RRçº§åˆ«ä¸‹å¿«ç…§è¯»çš„ç»“æœçš„ä¸åŒ</li><li>åœ¨RRçº§åˆ«ä¸‹çš„æŸä¸ªäº‹åŠ¡çš„å¯¹æŸæ¡è®°å½•çš„ç¬¬ä¸€æ¬¡å¿«ç…§è¯»ä¼šåˆ›å»ºä¸€ä¸ªå¿«ç…§åŠRead View, å°†å½“å‰ç³»ç»Ÿæ´» è·ƒçš„å…¶ä»–äº‹åŠ¡è®°å½•èµ·æ¥</li><li>æ­¤ååœ¨è°ƒç”¨å¿«ç…§è¯»çš„æ—¶å€™ï¼Œè¿˜æ˜¯ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªRead Viewï¼Œæ‰€ä»¥åªè¦å½“å‰äº‹åŠ¡åœ¨å…¶ä»–äº‹åŠ¡æäº¤æ›´æ–°ä¹‹å‰ä½¿ç”¨è¿‡å¿«ç…§è¯»ï¼Œé‚£ä¹ˆä¹‹åçš„å¿«ç…§è¯»ä½¿ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªRead Viewï¼Œæ‰€ä»¥å¯¹ä¹‹åçš„ä¿®æ”¹ä¸å¯è§ï¼›</li><li>å³RRçº§åˆ«ä¸‹ï¼Œå¿«ç…§è¯»ç”ŸæˆRead Viewæ—¶ï¼ŒRead Viewä¼šè®°å½•æ­¤æ—¶æ‰€æœ‰å…¶ä»–æ´»åŠ¨äº‹åŠ¡çš„å¿«ç…§ï¼Œè¿™äº›äº‹åŠ¡çš„ä¿®æ”¹å¯¹äºå½“å‰äº‹åŠ¡éƒ½æ˜¯ä¸å¯è§çš„ã€‚è€Œæ—©äºRead Viewåˆ›å»ºçš„äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹å‡æ˜¯å¯è§ï¼›</li><li>è€Œåœ¨RCçº§åˆ«ä¸‹çš„ï¼Œäº‹åŠ¡ä¸­ï¼Œæ¯æ¬¡å¿«ç…§è¯»éƒ½ä¼š<strong>æ–°ç”Ÿæˆä¸€ä¸ªå¿«ç…§</strong>å’ŒRead View, è¿™å°±æ˜¯æˆ‘ä»¬åœ¨RCçº§åˆ«ä¸‹çš„äº‹åŠ¡ä¸­å¯ä»¥çœ‹åˆ°åˆ«çš„äº‹åŠ¡æäº¤çš„æ›´æ–°çš„åŸå› ï¼›</li><li>æ€»ä¹‹åœ¨RCéš”ç¦»çº§åˆ«ä¸‹ï¼Œæ˜¯æ¯ä¸ªå¿«ç…§è¯»éƒ½ä¼šç”Ÿæˆå¹¶è·å–æœ€æ–°çš„Read Viewï¼›è€Œåœ¨RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œåˆ™æ˜¯åŒä¸€ä¸ªäº‹åŠ¡ä¸­çš„ç¬¬ä¸€ä¸ªå¿«ç…§è¯»æ‰ä¼šåˆ›å»ºRead Viewï¼Œä¹‹åçš„å¿«ç…§è¯»è·å–çš„éƒ½æ˜¯åŒä¸€ä¸ªRead Viewã€‚ </li><li>æ­£æ˜¯RCæ¯æ¬¡å¿«ç…§è¯»ï¼Œéƒ½ä¼šå½¢æˆRead Viewï¼Œæ‰€ä»¥ï¼ŒRCæ‰ä¼šæœ‰ä¸å¯é‡å¤è¯»é—®é¢˜ã€‚</li></ul><h1 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h1><p>å…³äºMySQLäº‹åŠ¡çš„å†…å®¹åˆ°è¿™é‡ŒåŸºæœ¬å°±OVERäº†ï¼Œå†…å®¹å¤šå¤šï¼Œä¹Ÿéœ€è¦å¤šå¤šç†è§£å’Œå¤ä¹ ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å¯ä»¥æ·±å…¥é˜…è¯»å¦‚ä¸‹æ–‡ç« </span><br><span class="line">https://blog.csdn.net/SnailMann/article/details/94724197</span><br><span class="line">https://www.cnblogs.com/f-ck-need-u/archive/2018/05/08/9010872.html</span><br><span class="line">https://blog.csdn.net/chenghan_yang/article/details/97630626</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">äº‹åŠ¡çš„å­¦ä¹ </summary>
    
    
    
    <category term="å­¦ä¹ sql" scheme="https://blog.musnow.top/categories/%E5%AD%A6%E4%B9%A0sql/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="mysql" scheme="https://blog.musnow.top/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>ã€MySQLã€‘ç´¢å¼•</title>
    <link href="https://blog.musnow.top/posts/3474107655/"/>
    <id>https://blog.musnow.top/posts/3474107655/</id>
    <published>2023-09-07T09:52:14.000Z</published>
    <updated>2023-09-07T09:52:30.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-ç´¢å¼•"><a href="#1-ç´¢å¼•" class="headerlink" title="1.ç´¢å¼•"></a>1.ç´¢å¼•</h1><h2 id="1-1-ä¸ºå•¥éœ€è¦ç´¢å¼•ï¼Ÿ"><a href="#1-1-ä¸ºå•¥éœ€è¦ç´¢å¼•ï¼Ÿ" class="headerlink" title="1.1 ä¸ºå•¥éœ€è¦ç´¢å¼•ï¼Ÿ"></a>1.1 ä¸ºå•¥éœ€è¦ç´¢å¼•ï¼Ÿ</h2><p>å¯¹äºæ•°æ®åº“è€Œè¨€ï¼ŒæŸ¥è¯¢å§‹ç»ˆæ˜¯ä¸€ä¸ªé«˜é¢‘çš„æ“ä½œï¼›å‡è®¾åœ¨æ•°æ®é‡åˆ°ç™¾ä¸‡çº§çš„æ—¶å€™ï¼ŒæŸ¥è¯¢ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯å°±è¦èŠ±5ç§’ä¸­ï¼Œé‚£ç”¨æˆ·è‚¯å®šä¸æ„¿æ„ç­‰å¾…ä½ çš„ç³»ç»Ÿå“åº”ï¼Œè¿™å°±é€ æˆäº†ç”¨æˆ·æµå¤±ã€‚</p><p>æ‰€ä»¥ï¼ŒMySQLå¿…é¡»ä½¿ç”¨æŸç§æ–¹å¼æ¥ä¿è¯æŸ¥è¯¢çš„é«˜é€Ÿå¯é ï¼Œç´¢å¼•å°±è¯ç”Ÿäº†ï¼›</p><p>å¯¹äºä½¿ç”¨è€…è€Œè¨€ï¼Œç´¢å¼•æ˜¯å¾ˆé¦™çš„ï¼Œå› ä¸ºä½ åªéœ€è¦æ‰§è¡Œ<code>create index</code>ç»™æŒ‡å®šçš„åˆ—ï¼Œé‚£ä¹ˆMySQLå°±ä¼šè‡ªåŠ¨å¸®ä½ ç»´æŠ¤ä¸€ç³»åˆ—ç´¢å¼•åˆ›å»ºçš„æ“ä½œï¼ŒæŸ¥è¯¢å˜å˜å¿«ï¼</p><p>ä½†ï¼ŒæŸ¥è¯¢é€Ÿåº¦çš„æé«˜æ˜¯ä»¥æ’å…¥ã€æ›´æ–°ã€åˆ é™¤ç­‰æ“ä½œçš„é€Ÿåº¦ä¸ºä»£ä»·çš„ï¼Œè¿™äº›å†™æ“ä½œä¼šå¢åŠ å¤§é‡çš„IOï¼›ç´¢å¼•çš„ä»·å€¼åœ¨äºæé«˜æµ·é‡æ•°æ®çš„æŸ¥è¯¢é€Ÿåº¦ï¼›</p><p>å¸¸è§çš„ç´¢å¼•</p><ul><li>ä¸»é”®ç´¢å¼•</li><li>å”¯ä¸€é”®ç´¢å¼•</li><li>æ™®é€šç´¢å¼•</li><li>å¤åˆç´¢å¼•</li><li>å…¨æ–‡ç´¢å¼•</li></ul><h2 id="1-2-ç´¢å¼•çš„æ•ˆæœ"><a href="#1-2-ç´¢å¼•çš„æ•ˆæœ" class="headerlink" title="1.2 ç´¢å¼•çš„æ•ˆæœ"></a>1.2 ç´¢å¼•çš„æ•ˆæœ</h2><p>é€šè¿‡å¦‚ä¸‹çš„å¤§æ•°æ®ç”¨ä¾‹ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°ç´¢å¼•çš„æ•ˆæœå‡ ä½•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> database if <span class="keyword">exists</span> `bit_index`;</span><br><span class="line"><span class="keyword">create</span> database if <span class="keyword">not</span> <span class="keyword">exists</span> `bit_index` <span class="keyword">default</span> <span class="type">character</span> <span class="keyword">set</span> utf8;</span><br><span class="line">use `bit_index`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ„å»ºä¸€ä¸ª8000000æ¡è®°å½•çš„æ•°æ®</span></span><br><span class="line"><span class="comment">-- æ„å»ºçš„æµ·é‡è¡¨æ•°æ®éœ€è¦æœ‰å·®å¼‚æ€§ï¼Œæ‰€ä»¥ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹æ¥åˆ›å»ºï¼Œ æ‹·è´ä¸‹é¢ä»£ç å°±å¯ä»¥äº†ï¼Œæš‚æ—¶ä¸ç”¨ç†è§£</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- äº§ç”Ÿéšæœºå­—ç¬¦ä¸²</span></span><br><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> rand_string(n <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">returns</span> <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">declare</span> chars_str <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">default</span></span><br><span class="line"><span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ&#x27;</span>;</span><br><span class="line"><span class="keyword">declare</span> return_str <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">declare</span> i <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">while i <span class="operator">&lt;</span> n do</span><br><span class="line"><span class="keyword">set</span> return_str <span class="operator">=</span>concat(return_str,<span class="built_in">substring</span>(chars_str,<span class="built_in">floor</span>(<span class="number">1</span><span class="operator">+</span>rand()<span class="operator">*</span><span class="number">52</span>),<span class="number">1</span>));</span><br><span class="line"><span class="keyword">set</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span> while;</span><br><span class="line"><span class="keyword">return</span> return_str;</span><br><span class="line"><span class="keyword">end</span> $$</span><br><span class="line">delimiter ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- äº§ç”Ÿéšæœºæ•°å­—</span></span><br><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> rand_num( )</span><br><span class="line"><span class="keyword">returns</span> <span class="type">int</span>(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">declare</span> i <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">set</span> i <span class="operator">=</span> <span class="built_in">floor</span>(<span class="number">10</span><span class="operator">+</span>rand()<span class="operator">*</span><span class="number">500</span>);</span><br><span class="line"><span class="keyword">return</span> i;</span><br><span class="line"><span class="keyword">end</span> $$</span><br><span class="line">delimiter ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ›å»ºå­˜å‚¨è¿‡ç¨‹ï¼Œå‘é›‡å‘˜è¡¨æ·»åŠ æµ·é‡æ•°æ®</span></span><br><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> insert_emp(<span class="keyword">in</span> <span class="keyword">start</span> <span class="type">int</span>(<span class="number">10</span>),<span class="keyword">in</span> max_num <span class="type">int</span>(<span class="number">10</span>))</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">declare</span> i <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">set</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">repeat</span><br><span class="line"><span class="keyword">set</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> EMP <span class="keyword">values</span> ((<span class="keyword">start</span><span class="operator">+</span>i)</span><br><span class="line">,rand_string(<span class="number">6</span>),<span class="string">&#x27;SALESMAN&#x27;</span>,<span class="number">0001</span>,curdate(),<span class="number">2000</span>,<span class="number">400</span>,rand_num());</span><br><span class="line">until i <span class="operator">=</span> max_num</span><br><span class="line"><span class="keyword">end</span> repeat;</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">end</span> $$</span><br><span class="line">delimiter ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- é›‡å‘˜è¡¨</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `EMP` (</span><br><span class="line">  `empno` <span class="type">int</span>(<span class="number">6</span>) unsigned zerofill <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;é›‡å‘˜ç¼–å·&#x27;</span>,</span><br><span class="line">  `ename` <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;é›‡å‘˜å§“å&#x27;</span>,</span><br><span class="line">  `job` <span class="type">varchar</span>(<span class="number">9</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;é›‡å‘˜èŒä½&#x27;</span>,</span><br><span class="line">  `mgr` <span class="type">int</span>(<span class="number">4</span>) unsigned zerofill <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;é›‡å‘˜é¢†å¯¼ç¼–å·&#x27;</span>,</span><br><span class="line">  `hiredate` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;é›‡ä½£æ—¶é—´&#x27;</span>,</span><br><span class="line">  `sal` <span class="type">decimal</span>(<span class="number">7</span>,<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å·¥èµ„æœˆè–ª&#x27;</span>,</span><br><span class="line">  `comm` <span class="type">decimal</span>(<span class="number">7</span>,<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å¥–é‡‘&#x27;</span>,</span><br><span class="line">  `deptno` <span class="type">int</span>(<span class="number">2</span>) unsigned zerofill <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;éƒ¨é—¨ç¼–å·&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ï¼Œæ·»åŠ 8000000æ¡è®°å½•</span></span><br><span class="line"><span class="keyword">call</span> insert_emp(<span class="number">100001</span>, <span class="number">8000000</span>);</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªè¡¨é‡Œé¢ï¼Œæœ‰å¤§é‡çš„æ•°æ®ï¼Œå…¶é»˜è®¤çŠ¶æ€ä¸‹ï¼Œå¹¶æ²¡æœ‰é…ç½®ç´¢å¼•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [bit_index]&gt; desc EMP;</span><br><span class="line">+----------+--------------------------+------+-----+---------+-------+</span><br><span class="line">| Field    | Type                     | Null | Key | Default | Extra |</span><br><span class="line">+----------+--------------------------+------+-----+---------+-------+</span><br><span class="line">| empno    | int(6) unsigned zerofill | NO   |     | NULL    |       |</span><br><span class="line">| ename    | varchar(10)              | YES  |     | NULL    |       |</span><br><span class="line">| job      | varchar(9)               | YES  |     | NULL    |       |</span><br><span class="line">| mgr      | int(4) unsigned zerofill | YES  |     | NULL    |       |</span><br><span class="line">| hiredate | datetime                 | YES  |     | NULL    |       |</span><br><span class="line">| sal      | decimal(7,2)             | YES  |     | NULL    |       |</span><br><span class="line">| comm     | decimal(7,2)             | YES  |     | NULL    |       |</span><br><span class="line">| deptno   | int(2) unsigned zerofill | YES  |     | NULL    |       |</span><br><span class="line">+----------+--------------------------+------+-----+---------+-------+</span><br><span class="line">8 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å¦‚æœä½ ç›´æ¥å…¨åˆ—æŸ¥è¯¢ï¼Œè¿›ç¨‹å°±ä¼šé˜»å¡åœ¨è¿™é‡Œ</p><p><img src="https://img.musnow.top/i/2023/09/bd7ed9436789f27dec4d4ba2ab40ea5b.png" alt="image-20230907172052198"></p><p>è¿›MySQLçš„æ–‡ä»¶è·¯å¾„çœ‹çœ‹ï¼Œä¼šå‘ç°è¿™å¼ è¡¨çš„å¤§å°å·²ç»åˆ°äº†æƒŠäººçš„564mbï¼Œè™½ç„¶æˆ‘ä»¬çš„å†…å­˜ä¹Ÿè®¸èƒ½å­˜çš„ä¸‹è¿™ä¹ˆå¤§çš„æ•°æ®ï¼Œä½†å®é™…IOè¯»å†™è¿™ä¹ˆå¤§é‡çš„æ•°æ®æ˜¯éå¸¸è€—æ—¶çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@vm-cnt8:/var/lib/mysql/bit_index]# ll -h</span><br><span class="line">total 565M</span><br><span class="line">-rw-rw----. 1 mysql mysql   61 Sep  6 05:36 db.opt</span><br><span class="line">-rw-rw----. 1 mysql mysql  770 Sep  6 05:36 EMP.frm</span><br><span class="line">-rw-rw----. 1 mysql mysql 564M Sep  6 05:39 EMP.ibd</span><br></pre></td></tr></table></figure><p>åœ¨ä¹‹å‰çš„æŸ¥è¯¢æ“ä½œä¸­æåˆ°è¿‡ï¼Œå¯¹äºè¿™ç§å¤§æ•°æ®è¡¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬åº”è¯¥é¿å…ä½¿ç”¨å…¨åˆ—æŸ¥è¯¢ï¼Œè€Œåº”è¯¥è®¾ç½®<code>limit</code>åªæŸ¥è¯¢å‡ºå°‘é‡ç”¨ä¾‹æ•°æ®ï¼Œæ¥åˆ¤æ–­è¿™ä¸ªè¡¨çš„æ•°æ®ç»“æ„å’Œä½œç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [bit_index]&gt; select * from EMP limit 3;</span><br><span class="line">+--------+--------+----------+------+---------------------+---------+--------+--------+</span><br><span class="line">| empno  | ename  | job      | mgr  | hiredate            | sal     | comm   | deptno |</span><br><span class="line">+--------+--------+----------+------+---------------------+---------+--------+--------+</span><br><span class="line">| 100002 | FNXAKX | SALESMAN | 0001 | 2023-09-06 00:00:00 | 2000.00 | 400.00 |    327 |</span><br><span class="line">| 100003 | rQbLBy | SALESMAN | 0001 | 2023-09-06 00:00:00 | 2000.00 | 400.00 |    394 |</span><br><span class="line">| 100004 | wRVdDF | SALESMAN | 0001 | 2023-09-06 00:00:00 | 2000.00 | 400.00 |    195 |</span><br><span class="line">+--------+--------+----------+------+---------------------+---------+--------+--------+</span><br><span class="line">3 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure><p>åœ¨æ²¡æœ‰ç´¢å¼•çš„æƒ…å†µä¸‹è¿›è¡Œä¸€ä¸ªæŸ¥è¯¢ï¼Œç”¨æ—¶å¤§çº¦åœ¨1.6ç§’å·¦å³</p><p><img src="https://img.musnow.top/i/2023/09/cec2caa51179f05f7309b5c968a539df.png" alt="image-20230907172357990"></p><p>è¿™æ—¶å€™æˆ‘ä»¬æ¥å¯¹empnoåˆ—åˆ›å»ºä¸€ä¸ªä¸»é”®ç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> EMP <span class="keyword">add</span> <span class="keyword">primary</span> key(empno);</span><br></pre></td></tr></table></figure><p>å› ä¸ºè¡¨ä¸­çš„æ•°æ®å¾ˆå¤šï¼Œæ‰€ä»¥è®¾ç½®ä¸»é”®ç´¢å¼•ä¹Ÿéœ€è¦è€—è´¹ä¸€å®šæ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´å†…ï¼Œå…¶å®å°±æ˜¯MySQLåœ¨åå°å¸®æˆ‘ä»¬åˆ›å»ºç´¢å¼•æ‰€éœ€è¦çš„æ•°æ®ç»“æ„çš„è¿‡ç¨‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [bit_index]&gt; alter table EMP add primary key(empno);</span><br><span class="line">Query OK, 0 rows affected (17.184 sec)              </span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure><p>å†æ¥æŸ¥è¯¢ä¸€ä¸‹åˆšåˆšæŸ¥è¯¢çš„æ•°æ®ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œç”¨æ—¶åªæœ‰<code>0.000 sec</code>ï¼Œç›´æ¥ç§’å›ï¼</p><p><img src="https://img.musnow.top/i/2023/09/0a7e44f14cf052534721da8beca3a073.png" alt="image-20230907172541115"></p><p>è¿™ä¾¿æ˜¯ç´¢å¼•åœ¨æå‡æ€§èƒ½æ–¹é¢çš„é‡å¤§ä½œç”¨ï¼</p><h2 id="1-3-MySQLå’Œæ–‡ä»¶ç³»ç»Ÿ"><a href="#1-3-MySQLå’Œæ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="1.3 MySQLå’Œæ–‡ä»¶ç³»ç»Ÿ"></a>1.3 MySQLå’Œæ–‡ä»¶ç³»ç»Ÿ</h2><h3 id="1-3-1-Linuxæ–‡ä»¶ç³»ç»Ÿ"><a href="#1-3-1-Linuxæ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="1.3.1 Linuxæ–‡ä»¶ç³»ç»Ÿ"></a>1.3.1 Linuxæ–‡ä»¶ç³»ç»Ÿ</h3><p>åœ¨ä¹‹å‰å¯¹<a href="https://blog.musnow.top/posts/2864480005/">Linuxæ–‡ä»¶ç³»ç»Ÿ</a>çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨ç£ç›˜ä¸­ï¼Œä¸€ä¸ªåŒºå—æ˜¯512KBï¼Œåœ¨Linuxç³»ç»Ÿä¸­ï¼Œä¸ºäº†æé«˜æ•ˆç‡ï¼Œä¼šé‡‡ç”¨4KBçš„åˆ†å—å¯¹æ•°æ®è¿›è¡Œè¯»å–ã€‚å“ªæ€•ä½ åªæ˜¯ä¿®æ”¹1KBï¼Œä¹Ÿæ˜¯éœ€è¦å°†4KBå®Œæ•´è¯»å–ï¼Œå†å†™å…¥å›å»çš„ã€‚</p><p><img src="https://img.musnow.top/i/2023/09/cda9058519a11abeed3a167eb6690d0c.png" alt="image-20230907174710578"></p><p>å› ä¸ºæœºæ¢°ç¡¬ç›˜ç‰©ç†ç»“æ„çš„é™åˆ¶ï¼Œ<strong>éšæœºè¯»å–çš„æ€§èƒ½ä¸ä½³</strong>ï¼Œä¸€æ¬¡æ€§è¯»å–100KBæ•°æ®ï¼Œè¿œè¿œä¼˜äº100æ¬¡è¯»å–1KBã€‚å› ä¸ºä¸€æ¬¡æ€§è¯»å–çš„æ—¶å€™ï¼Œåªéœ€è¦ä¸€æ¬¡å¯»é“å°±èƒ½å°†ç£å¤´æ‘†åˆ°æ­£ç¡®çš„ä½ç½®ï¼Œå¾€é‡Œé¢å†™æ•°æ®å°±å®Œäº‹äº†ã€‚ä½†å¤šæ¬¡è¯»å–å°æ•°æ®çš„æ—¶å€™ï¼Œå°½ç®¡ç›¸é‚»çš„ä¸¤æ¬¡IOæ“ä½œåœ¨åŒä¸€æ—¶åˆ»å‘å‡ºï¼Œä½†å¦‚æœå®ƒä»¬çš„è¯·æ±‚çš„æ‰‡åŒºåœ°å€ç›¸å·®å¾ˆå¤§çš„è¯ä¹Ÿåªèƒ½ç§°ä¸ºéšæœºè®¿é—®ï¼Œè€Œéè¿ç»­è®¿é—®ã€‚</p><p>éšæœºè®¿é—®å°±è¦å¤šæ¬¡å¯»é“ï¼Œæ¯æ¬¡å†™å…¥çš„é‡åˆå¾ˆå°‘ï¼Œå¤§å¤§å¢åŠ äº†IOçš„è´Ÿæ‹…ã€‚</p><h3 id="1-3-2-MySQLå’Œç£ç›˜äº¤äº’åŸºæœ¬å•ä½-16KB"><a href="#1-3-2-MySQLå’Œç£ç›˜äº¤äº’åŸºæœ¬å•ä½-16KB" class="headerlink" title="1.3.2 MySQLå’Œç£ç›˜äº¤äº’åŸºæœ¬å•ä½ 16KB"></a>1.3.2 MySQLå’Œç£ç›˜äº¤äº’åŸºæœ¬å•ä½ 16KB</h3><p>è€ŒMySQLä¸­ï¼Œä¸ºäº†æ›´å¥½çš„å®ç°å¯¹æ•°æ®IOé‡çš„ç¼©å‡å’Œæ§åˆ¶ï¼Œå…¶å†…éƒ¨å°†16KBä½œä¸ºä¸€æ¬¡IOçš„åŸºæœ¬å•ä½ï¼Œè¿™ä¸ªå¤§å°æˆ‘ä»¬å«åšMySQLçš„æ–‡ä»¶Pageï¼›</p><ul><li>MySQLä¸­çš„æ•°æ®æ–‡ä»¶ï¼Œéƒ½æ˜¯ä»¥Pageä¸ºåŸºæœ¬å•ä½ä¿å­˜è‡³ç£ç›˜é‡Œé¢çš„ï¼›</li><li>MySQLä¸­çš„CURDæ“ä½œï¼Œéƒ½éœ€è¦é€šè¿‡è®¡ç®—æ¥å®šä½åˆ°éœ€è¦ä¿®æ”¹å’Œè®¿é—®çš„æ•°æ®çš„ä½ç½®ï¼›</li><li>æ¶‰åŠåˆ°è®¡ç®—çš„æ“ä½œéƒ½éœ€è¦CPUå‚ä¸ï¼ŒCPUåªèƒ½å¤„ç†å†…å­˜ä¸­çš„æ•°æ®ï¼Œè¿™å°±è¦æ±‚MySQLéœ€è¦æå‰å°†ä¸€éƒ¨åˆ†æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼›</li><li>æ‰€ä»¥åœ¨MySQLè¿è¡Œçš„è¿™æ®µæ—¶é—´å†…ï¼Œå…¶æ“ä½œçš„æ•°æ®ä¼šåŒæ—¶å­˜åœ¨äºå†…å­˜å’Œç£ç›˜ä¸­ï¼Œéœ€è¦ä»¥ç‰¹å®šçš„ç­–ç•¥å°†å†…å­˜ä¸­çš„æ•°æ®åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼›è¿™ä¸ªæ“ä½œå°±æ˜¯IOï¼ŒåŸºæœ¬å•ä½æ˜¯Pageï¼›</li><li>ä¸ºäº†æ›´å¥½çš„ç®¡ç†è¿™äº›æ“ä½œï¼ŒMySQLä¼šè‡ªå·±ç»´æŠ¤ä¸€ä¸ª<code>buffer pool</code>çš„å†…å­˜ç©ºé—´ï¼Œæ¥è¿›è¡Œç¼“å­˜ã€‚</li><li>MySQLæ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå®ƒçš„æ‰€æœ‰æ–‡ä»¶IOæ“ä½œéƒ½éœ€è¦é€šè¿‡æ“ä½œç³»ç»Ÿæä¾›çš„æ¥å£æ¥å®ç°ï¼ä½†å†…éƒ¨çš„åˆ·ç›˜é€»è¾‘æ˜¯å¯ä»¥ç”±MySQLæ¥è°ƒç”¨ç³»ç»Ÿæ¥å£æ¥è‡ªä¸»æ§åˆ¶çš„ï¼Œè€Œä¸éœ€è¦å‘†æ¿åœ°éµå®ˆæ“ä½œç³»ç»Ÿçš„è‡ªåŠ¨ç­–ç•¥ï¼›ï¼ˆMySQLåˆ›å»º<code>buffer pool</code>ä¹Ÿæ˜¯åŸºäºæ›´é«˜çš„è‡ªä¸»æ€§æ¥è€ƒè™‘çš„ï¼‰</li><li>æœ€ç»ˆç›®æ ‡æ˜¯å°½å¯èƒ½åœ°å‡å°‘IOæ“ä½œï¼Œæé«˜è¿è¡Œæ•ˆç‡ï¼›</li></ul><p>è¿è¡Œå¦‚ä¸‹å‘½ä»¤å¯ä»¥çœ‹åˆ°MySQLä¸­å…³äºPageè®¾ç½®çš„å…¨å±€å˜é‡ï¼Œå³16KB</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [bit_index]&gt; SHOW GLOBAL STATUS LIKE &#x27;innodb_page_size&#x27;;</span><br><span class="line">+------------------+-------+</span><br><span class="line">| Variable_name    | Value |</span><br><span class="line">+------------------+-------+</span><br><span class="line">| Innodb_page_size | 16384 |</span><br><span class="line">+------------------+-------+</span><br><span class="line">1 row in set (0.001 sec)</span><br></pre></td></tr></table></figure><h3 id="1-3-3-ä¸ºä»€ä¹ˆè¦ç”¨Pageä¸ºå•ä½è¿›è¡Œäº¤äº’ï¼Ÿ"><a href="#1-3-3-ä¸ºä»€ä¹ˆè¦ç”¨Pageä¸ºå•ä½è¿›è¡Œäº¤äº’ï¼Ÿ" class="headerlink" title="1.3.3 ä¸ºä»€ä¹ˆè¦ç”¨Pageä¸ºå•ä½è¿›è¡Œäº¤äº’ï¼Ÿ"></a>1.3.3 ä¸ºä»€ä¹ˆè¦ç”¨Pageä¸ºå•ä½è¿›è¡Œäº¤äº’ï¼Ÿ</h3><p>ä¸ºä½•MySQLå’Œç£ç›˜è¿›è¡ŒIOäº¤äº’çš„æ—¶å€™ï¼Œè¦é‡‡ç”¨Pageçš„æ–¹æ¡ˆè¿›è¡Œäº¤äº’å‘¢ï¼Ÿç”¨å¤šå°‘ï¼ŒåŠ è½½å¤šå°‘ä¸é¦™å—ï¼Ÿ</p><p>å…ˆæ¥ä¸ªæµ‹è¯•ç”¨ä¾‹çœ‹çœ‹å§ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ç”¨æˆ·è¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¸»é”®é»˜è®¤ç”Ÿæˆä¸»é”®ç´¢å¼•</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> <span class="keyword">user</span> (</span><br><span class="line">    id <span class="type">int</span> <span class="keyword">primary</span> key, </span><br><span class="line">    age <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">16</span>) <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- æ’å…¥å¤šæ¡è®°å½•ï¼Œä¸»é”®æ²¡æœ‰æŒ‰é¡ºåºæ’å…¥</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> (id, age, name) <span class="keyword">values</span>(<span class="number">3</span>, <span class="number">18</span>, <span class="string">&#x27;æ¨è¿‡&#x27;</span>);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> (id, age, name) <span class="keyword">values</span>(<span class="number">4</span>, <span class="number">16</span>, <span class="string">&#x27;å°é¾™å¥³&#x27;</span>);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> (id, age, name) <span class="keyword">values</span>(<span class="number">2</span>, <span class="number">26</span>, <span class="string">&#x27;é»„è“‰&#x27;</span>);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> (id, age, name) <span class="keyword">values</span>(<span class="number">5</span>, <span class="number">36</span>, <span class="string">&#x27;éƒ­é–&#x27;</span>);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> (id, age, name) <span class="keyword">values</span>(<span class="number">1</span>, <span class="number">56</span>, <span class="string">&#x27;æ¬§é˜³é”‹&#x27;</span>);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"><span class="comment">-- æœ€ç»ˆå‘ç°æ•°æ®æ˜¯æœ‰åºçš„</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>; </span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----+-----------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> age <span class="operator">|</span> name      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----+-----------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>  <span class="operator">|</span> <span class="number">56</span>  <span class="operator">|</span> æ¬§é˜³é”‹     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>  <span class="operator">|</span> <span class="number">26</span>  <span class="operator">|</span> é»„è“‰       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span>  <span class="operator">|</span> <span class="number">18</span>  <span class="operator">|</span> æ¨è¿‡       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4</span>  <span class="operator">|</span> <span class="number">16</span>  <span class="operator">|</span> å°é¾™å¥³     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">5</span>  <span class="operator">|</span> <span class="number">36</span>  <span class="operator">|</span> éƒ­é–       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----+-----------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„5æ¡è®°å½•ä¸­ï¼Œå¦‚æœMySQLè¦æŸ¥æ‰¾id&#x3D;2çš„è®°å½•ï¼Œç¬¬ä¸€æ¬¡åŠ è½½id&#x3D;1ï¼Œç¬¬äºŒæ¬¡åŠ è½½id&#x3D;2ï¼Œä¸€æ¬¡ä¸€æ¡è®°å½•ï¼Œ<strong>é‚£ä¹ˆå°±éœ€è¦2æ¬¡IO</strong>ã€‚å¦‚æœè¦æ‰¾id&#x3D;5ï¼Œé‚£ä¹ˆå°±éœ€è¦5æ¬¡IOã€‚</p><p>ä½†ï¼Œå¦‚æœè¿™5æ¡(æˆ–è€…æ›´å¤š)éƒ½è¢«ä¿å­˜åœ¨ä¸€ä¸ªPageä¸­(16KBï¼Œèƒ½ä¿å­˜å¾ˆå¤šè®°å½•)ï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡IOæŸ¥æ‰¾id&#x3D;2çš„æ—¶å€™ï¼Œæ•´ä¸ªPageä¼šè¢«åŠ è½½åˆ°MySQLçš„<code>Buffer Pool</code>ä¸­ï¼Œè¿™é‡Œå®Œæˆäº†ä¸€æ¬¡IOã€‚ä½†æ˜¯å¾€åå¦‚æœåœ¨æŸ¥æ‰¾id&#x3D;1,3,4,5ç­‰ï¼Œå®Œå…¨ä¸éœ€è¦è¿›è¡ŒIOäº†ï¼Œè€Œæ˜¯ç›´æ¥åœ¨å†…å­˜ä¸­è¿›è¡Œäº†ã€‚æ‰€ä»¥ï¼Œå°±åœ¨å•Pageé‡Œé¢ï¼Œå¤§å¤§å‡å°‘äº†IOçš„æ¬¡æ•°ï¼</p><p>è™½ç„¶æˆ‘ä»¬ä¸èƒ½ä¿è¯åç»­çš„å‡ æ¬¡IOä¸€å®šåœ¨è¿™æ¬¡åŠ è½½çš„Pageä¸­ï¼Œä½†æ ¹æ®<code>å±€éƒ¨æ€§åŸç†</code>ï¼Œå…¶è®¿é—®ç›¸è¿‘çš„å‡ æ¡æ•°æ®çš„æ¦‚ç‡æ˜¯å¾ˆå¤§çš„ï¼æ‰€ä»¥è¿™æ ·æœ€ç»ˆæ˜¯èƒ½æå‡IOæ•ˆç‡çš„ï¼</p><p>å¾€å¾€IOæ•ˆç‡ä½ä¸‹çš„æœ€ä¸»è¦çŸ›ç›¾ä¸æ˜¯IOå•æ¬¡æ•°æ®é‡çš„å¤§å°ï¼Œ<strong>è€Œæ˜¯IOçš„æ¬¡æ•°</strong>ã€‚</p><h2 id="1-4-B-æ ‘å’ŒPage"><a href="#1-4-B-æ ‘å’ŒPage" class="headerlink" title="1.4 B+æ ‘å’ŒPage"></a>1.4 B+æ ‘å’ŒPage</h2><p>æœ‰äº†å¯¹Pageçš„è®¤è¯†ï¼Œæ¥ä¸‹æ¥å°±éœ€è¦ç”¨ä¸€ä¸ªæ•°æ®ç»“æ„æ¥ç»´æŠ¤è¿™äº›åŠ è½½åˆ°<code>Buffer Pool</code>å½“ä¸­çš„Pageäº†ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬çš„B+æ ‘å°±ç™»åœºäº†ã€‚</p><h3 id="1-4-1-å•ä¸ªPage"><a href="#1-4-1-å•ä¸ªPage" class="headerlink" title="1.4.1 å•ä¸ªPage"></a>1.4.1 å•ä¸ªPage</h3><p>å•ä¸ªPageé‡Œé¢å­˜æ”¾çš„è‚¯å®šæ˜¯ä¸€éƒ¨åˆ†çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥åŠ ä¸Šå‰åæŒ‡é’ˆï¼Œä»¥åŒé“¾è¡¨çš„å½¢å¼å°†æ‰€æœ‰Pageè¿èµ·æ¥ï¼Œè¿™æ ·å°±èƒ½å®ç°æ•°æ®çš„éå†ï¼›åœ¨MySQLä¸­ï¼Œå°±æ˜¯è¿™ä¹ˆæ“ä½œçš„ã€‚</p><p><img src="https://img.musnow.top/i/2023/09/fafa9750da8082ecdf3927663eb49941.png" alt="image-20230907182425023"></p><p>å› ä¸ºå­˜åœ¨ä¸»é”®ï¼ŒMySQLè¿˜ä¼šç»™å•ä¸ªPageä¸­çš„æ•°æ®ä¾ç…§ä¸»é”®è¿›è¡Œæ’åºï¼Œä»ä¸Šå›¾å°±èƒ½çœ‹å‡ºé˜¿é‡Œï¼Œå•ä¸ªPageä¸­æ•°æ®æ˜¯ä¾ç…§ä¸»é”®æŒ‰åºæ’åˆ—çš„ï¼›ä¸”æ¯ä¸€ä¸ªæ•°æ®éƒ½ä¼šé“¾æ¥åˆ°ä¸‹ä¸€ä¸ªæ•°æ®ä¸Šï¼›</p><p>è¿™æ ·æ’åºåï¼Œæ•°æ®åº“åœ¨è¿›è¡Œæ•°æ®ç­›é€‰çš„æ—¶å€™ï¼Œå°±èƒ½æ›´å¥½çš„å®šä½åˆ°æ•°æ®çš„ä½ç½®ï¼Œå‡å°‘æŸ¥è¯¢è€—æ—¶ã€‚æ’å…¥æ—¶æ’åºä¹Ÿèƒ½è®©åç»­åœ¨è¿›è¡Œæ•°æ®é™åº&#x2F;å‡åºè¾“å‡ºçš„æ—¶å€™ï¼Œæ— éœ€äºŒæ¬¡å¯¹æ•°æ®è¿›è¡Œæ’åºäº†ï¼›</p><h3 id="1-4-2-å¤šä¸ªPage"><a href="#1-4-2-å¤šä¸ªPage" class="headerlink" title="1.4.2 å¤šä¸ªPage"></a>1.4.2 å¤šä¸ªPage</h3><p>æ—¢ç„¶ä¸€ä¸ªPageæ˜¯å¦‚æ­¤ï¼Œé‚£å¤šä¸ªPageå‘¢ï¼Ÿ</p><ul><li>å‰é¢æåˆ°äº†ï¼Œå½“MySQLéœ€è¦åŠ è½½æ•°æ®çš„æ—¶å€™ï¼Œä¼šå°†å’Œè¿™ä¸ªæ•°æ®ç›¸é‚»è¿‘çš„å…¶ä»–æ•°æ®ï¼Œä»¥16KBä¸ºå•ä½ä¸€èµ·åŠ è½½åˆ°ä¸€ä¸ªPageé‡Œé¢ï¼Œå¹¶è¿æ¥åˆ°è¿™ä¸ªåŒå‘é“¾è¡¨ä¸Šï¼›</li><li>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¤šä¸ªPageçš„éå†æ¥è¿›è¡Œæ•°æ®çš„å®šä½</li><li>å¯é“¾è¡¨æ˜¯ä¸€ä¸ªçº¿æ€§ç»“æ„ï¼ŒMySQLè‚¯å®šä¸å¯èƒ½ç”¨çº¿æ€§ç»“æ„æ¥ç»´æŠ¤æ•°æ®å§ï¼Ÿé‚£æ ·æŸ¥è¯¢çš„æ•ˆç‡ä¹Ÿå¤ªä½äº†ï¼Œæ¯æ¬¡éƒ½éœ€è¦O(N)çš„éå†ï¼Œæ•°æ®ä¸€å¤šå°±æ…¢æ…¢æ…¢ï¼</li></ul><p><img src="https://img.musnow.top/i/2023/09/12d3385dee351703d07d0104f014b80a.png" alt="image-20230907183025895"></p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬è‚¯å®šè¦åœ¨åŒå‘é“¾è¡¨çš„åŸºç¡€ä¸Šæ·»åŠ å…¶ä»–çš„ç»“æ„æ¥è¿›è¡ŒæŸ¥æ‰¾çš„ä¼˜åŒ–ï¼è¿™æ—¶å€™å°±å¯ä»¥å¼•å…¥<strong>ç›®å½•</strong>äº†</p><h4 id="é¡µç›®å½•"><a href="#é¡µç›®å½•" class="headerlink" title="é¡µç›®å½•"></a>é¡µç›®å½•</h4><p>åœ¨æˆ‘ä»¬çœ‹ä¹¦çš„æ—¶å€™ï¼Œå°±ä¼šæœ‰ç›®å½•æ¥å¸®åŠ©æˆ‘ä»¬å¿«é€ŸæŸ¥æ‰¾åˆ°æŸä¸€ä¸ªç« èŠ‚ã€‚æ¯”å¦‚æˆ‘ä»¬æƒ³çœ‹ç¬¬ä¹ç« çš„å†…å®¹ï¼Œé‚£å°±å¯ä»¥å…ˆçœ‹ç›®å½•ï¼Œæ‰¾åˆ°ç¬¬ä¹ç« çš„é¡µç ï¼Œå†è¿›è¡Œé˜…è¯»ã€‚</p><p>å¯¹äºMySQLä¸­çš„æ•°æ®ï¼Œè¿™ä¸ªæƒ…æ™¯ä¹Ÿæ˜¯é€‚ç”¨çš„ï¼Œæˆ‘ä»¬ç»™æ•°æ®ä¸Šä¸€ä¸ªç›®å½•ï¼ŒæŸ¥è¯¢çš„æ—¶å€™å…ˆæ ¹æ®ç›®å½•å®šä½åˆ°å…·ä½“çš„pageï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“1-10å·æ•°æ®éƒ½åœ¨è¿™ä¸ªpageé‡Œé¢ï¼Œé‚£å°±ç›´æ¥å»é‡Œé¢æ‰¾å°±è¡Œäº†ï¼›è¿™æ—¶å€™æŸ¥æ‰¾çš„æ•ˆç‡å°±æ¯”å•çº¯çš„ä»é“¾è¡¨å¼€å¤´è¿›è¡Œéå†å¿«å¤šäº†ï¼</p><p>å½“ç„¶ï¼Œå’Œä¹¦ç±çš„ç›®å½•éœ€è¦æ¶ˆè€—çº¸å¼ ä¸€æ ·ï¼Œåœ¨MySQLä¸­å¯¹æ•°æ®è®¾ç½®ç›®å½•ä¹Ÿæ˜¯éœ€è¦æ¶ˆè€—ç©ºé—´çš„ï¼Œè¿™å°±æ˜¯ä¸€ç§ç”¨ç©ºé—´æ¢æ—¶é—´çš„åšæ³•ï¼Œè€Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ—¶é—´æ˜¾ç„¶æ›´åŠ å®è´µï¼</p><h4 id="å•é¡µç›®å½•"><a href="#å•é¡µç›®å½•" class="headerlink" title="å•é¡µç›®å½•"></a>å•é¡µç›®å½•</h4><p>åœ¨å•ä¸ªPageé‡Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥å®‰å¦‚ä¸‹çš„æ–¹å¼è®¾å®šä¸€ä¸ªç›®å½•ï¼Œå—ä¸€å®šé—´éš”å°±è®¾ç½®ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ä½œä¸ºç›®å½•ã€‚åœ¨æ•°æ®é‡å°çš„æ—¶å€™ï¼Œè¿™ä¸ªç›®å½•çš„ä½œç”¨ä¸ç®—å¤§ï¼Œä½†æ•°æ®é‡ä¸€å¤§ï¼Œç›®å½•å¯¹æœç´¢æ•ˆç‡çš„æå‡æ˜¯éå¸¸å¯è§‚çš„ï¼</p><blockquote><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬è¦æŸ¥æ‰¾id&#x3D;4è®°å½•ï¼Œä¹‹å‰å¿…é¡»çº¿æ€§éå†4æ¬¡ï¼Œæ‰èƒ½æ‹¿åˆ°ç»“æœã€‚ç°åœ¨ç›´æ¥é€šè¿‡ç›®å½•2[3]ï¼Œç›´æ¥è¿›è¡Œå®šä½æ–°çš„èµ·å§‹ä½ç½®ï¼Œåªéœ€è¦éå†3æ¬¡å°±èƒ½æ‰¾åˆ°ç»“æœï¼Œæé«˜äº†æ•ˆç‡ã€‚</p></blockquote><p>å³ä¾¿åœ¨å•ä¸ªPageä¸­æ·»åŠ ç›®å½•ä¼šå¯¼è‡´è¿™ä¸ªPageå®é™…å­˜æ”¾çš„æ•°æ®å˜å°‘ï¼Œä½†è¿™æ˜¯å¿…è¦çš„ç‰ºç‰²ï¼</p><p><img src="https://img.musnow.top/i/2023/09/052c18b6ad7065a68f008d8234f08dfc.png" alt="image-20230907191523912"></p><h4 id="å¤šé¡µç›®å½•"><a href="#å¤šé¡µç›®å½•" class="headerlink" title="å¤šé¡µç›®å½•"></a>å¤šé¡µç›®å½•</h4><p>å‰é¢æåˆ°ï¼ŒMySQLä¼šè‡ªåŠ¨æŠŠæ–°çš„æ•°æ®åŠ è½½åˆ°ä¸€ä¸ªPageä¸­ï¼Œå¹¶é“¾æ¥åˆ°å·²æœ‰é“¾è¡¨ä¸Šï¼›ä½†æ˜¯çº¿æ€§éå†éœ€è¦å¤§é‡çš„IOï¼Œæ¯æ¬¡é‡åˆ°æ–°çš„Pageçš„æ—¶å€™ï¼Œå°±éœ€è¦å°†å…¶åŠ è½½åˆ°å†…å­˜é‡Œé¢ï¼Œè¿›è¡Œéå†ï¼Œè¿™å°±ä½¿å¾—å•ä¸ªPageä¸­çš„ç›®å½•ä¸é‚£ä¹ˆå®ç”¨äº†ï¼›</p><ul><li>å•ä¸ªPageçš„ç›®å½•æ˜¯å°èŠ‚ç›®å½•</li><li>å¤šä¸ªPageçš„ç›®å½•æ˜¯ç« èŠ‚ç›®å½•</li></ul><p>æ‰€ä»¥æˆ‘ä»¬å¿…é¡»ç»™å¤šä¸ªPageä¹ŸåŠ ä¸Šä¸€ä¸ªé¡¶å±‚çš„ç« èŠ‚ç›®å½•ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–æ•ˆç‡ï¼</p><ul><li>ä½¿ç”¨ä¸€ä¸ªPageæ¥æŒ‡å‘å¤šä¸ªPageï¼Œå­˜æ”¾æ¯ä¸ªPageçš„èµ·å§‹keyå€¼ï¼ˆå‡è®¾æ¯ä¸ªPageä¸­çš„keyéƒ½æœ‰åºä¸”ä¸ºå‡åºï¼‰ï¼›è¿™ä¸ªPageä¸­ä¸å­˜æ”¾å®é™…çš„æ•°æ®ï¼Œåªæœ‰ç›®å½•å€¼ï¼›</li><li>éå†çš„æ—¶å€™ï¼Œå…ˆé€šè¿‡å¤šPageçš„ç›®å½•æ‰¾åˆ°æˆ‘ä»¬è¦å»çš„Pageï¼Œå†å»è®¿é—®è¯¥å®é™…å­˜å‚¨æ•°æ®çš„Pageä¸­çš„å•Pageç›®å½•ï¼Œæœ€ç»ˆæŸ¥æ‰¾åˆ°ç›®æ ‡æ•°æ®ï¼›</li><li>æ‰€ä»¥ï¼Œæ¯ä¸ªå¤šPageçš„ç›®å½•é¡¹ä¸­å°±æ˜¯ä¸€ä¸ªé”®å€¼+å¯¹åº”æ™®é€šPageçš„æŒ‡é’ˆ</li></ul><p><img src="https://img.musnow.top/i/2023/09/f14ce259e947e2cc699ae2341e3e83cd.png" alt="image-20230907192840730"></p><p>ä¸€å±‚ç›®å½•Pageä¸å¤Ÿï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å†åŠ ä¸€å±‚ã€‚è¿™æ ·å°±å®ç°äº†ä¸€ä¸ªç±»ä¼¼äºäºŒå‰æ ‘çš„ç»“æ„ï¼Œåªä¸è¿‡æ¯ä¸€ä¸ªèŠ‚ç‚¹Pageä¸­éƒ½åŒ…å«å¤šä¸ªPageçš„key+æŒ‡é’ˆï¼Œæœ€ç»ˆåªæœ‰å¶å­èŠ‚ç‚¹æ˜¯å®é™…å­˜å‚¨æ•°æ®çš„ï¼</p><p><img src="https://img.musnow.top/i/2023/09/485204263a90e86428707dd92244878b.png" alt="image-20230907193042036"></p><p>è¿™ä¸ªæ•°æ®ç»“æ„å°±å«åšB+æ ‘ï¼ˆæ³¨æ„ï¼Œä¸æ˜¯Bæ ‘ï¼ï¼‰è€Œæ•´ä¸ªä¸Šå›¾ä¸­çš„æ•°æ®æ¥å°±æ˜¯MySQLä¸­å¯¹userè¡¨åšçš„ç´¢å¼•ï¼</p><p>æ­¤æ—¶çš„æŸ¥è¯¢ï¼Œéœ€è¦ç»è¿‡çš„èŠ‚ç‚¹è‚¯å®šå˜å°‘äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬éœ€è¦æŸ¥è¯¢<code>id=12</code>çš„ç”¨æˆ·ï¼š</p><ul><li>é¡¶å±‚åˆ¤æ–­ï¼Œ12&gt;11&gt;1ï¼Œå‘å³èµ°ã€2æ¬¡æ¯”è¾ƒã€‘</li><li>ç¬¬äºŒå±‚åˆ¤æ–­ï¼Œ12&gt;11ä¸”12&lt;16ï¼Œå‘å·¦èµ°ï¼Œæ¥åˆ°å…·ä½“çš„Pageã€2æ¬¡æ¯”è¾ƒã€‘</li><li>æŸ¥æ‰¾å•é¡µç›®å½•ï¼Œ12&gt;11ä¸”12&lt;13ï¼›ã€2æ¬¡æ¯”è¾ƒã€‘</li><li>ä»11å¼€å§‹éå†ï¼Œèµ°ä¸€æ­¥å°±èƒ½æ‰¾åˆ°ã€1æ¬¡æ¯”è¾ƒã€‘</li></ul><p>æœ€ç»ˆï¼Œæˆ‘ä»¬æŸ¥æ‰¾12çš„æ“ä½œåªç”¨äº†7æ¬¡å°±æˆåŠŸäº†ã€‚è€Œä»æŠ•å¼€å§‹éå†éœ€è¦12æ¬¡æ‰èƒ½æ‰¾åˆ°å®ƒï¼›</p><p>éå†æ¬¡æ•°çš„å‡å°‘ï¼Œå°±ç­‰åŒäºIOæ¬¡æ•°çš„å‡å°‘ï¼Œæœ€ç»ˆæŸ¥è¯¢çš„æ•ˆç‡å°±å˜é«˜äº†ï¼</p><blockquote><p>è¿™é‡Œçš„åˆ†æå¯èƒ½æœ‰è¯¯ï¼Œä¸è¿‡ç»“è®ºæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œåˆ†é¡µè‚¯å®šèƒ½å¢åŠ æŸ¥æ‰¾çš„æ•ˆç‡ï¼</p></blockquote><p>å¦å¤–ï¼ŒMySQLè¿˜å¯ä»¥æ ¹æ®è®¿é—®çš„é¢‘ç‡ï¼Œå®šæœŸçš„é‡Šæ”¾ä¸€äº›Pageï¼›æ¯”å¦‚åœ¨B+æ ‘ä¸­ï¼Œå¯èƒ½æ ‘çš„å³åŠéƒ¨åˆ†å¾ˆå°‘è¢«è®¿é—®ï¼Œé‚£å°±å¯ä»¥æš‚æ—¶é‡Šæ”¾è¿™éƒ¨åˆ†Pageçš„ç©ºé—´ï¼Œç»™å…¶ä»–è¡¨ä½¿ç”¨ï¼ŒçœŸåˆ°é‡åˆ°è®¿é—®çš„æ—¶å€™ï¼Œå†å»è¯»ç›˜å»é™¤è¿™éƒ¨åˆ†æ•°æ®ã€‚<strong>è¿™æ˜¯ç”±MySQLçš„ç¼“å­˜ç­–ç•¥æ¥è‡ªä¸»å†³å®šçš„</strong>ï¼›</p><p>æ¯•ç«Ÿå½“ä¸€ä¸ªè¡¨éå¸¸å¤§çš„æ—¶å€™ï¼Œå°†å…¶å…¨éƒ¨åŠ è½½åˆ°å†…å­˜é‡Œé¢æ˜¯ä¸å¯è¡Œçš„ï¼å¿…é¡»è¦ç”¨ç¼“å­˜ç­–ç•¥å’Œå±€éƒ¨æ€§åŸç†æ¥åŠ è½½é¢‘ç¹ä½¿ç”¨çš„æ•°æ®åˆ°å†…å­˜ä¸­ï¼Œæ‰èƒ½åœ¨æ•ˆç‡å’Œè´Ÿè½½ä¸Šè¾¾åˆ°å¹³è¡¡ï¼›</p><p>ä¸ç„¶ä½ çš„MySQLæ— è„‘ç¼“å­˜Pageå¯¼è‡´å ç”¨è¿‡å¤šå†…å­˜ï¼Œæ“ä½œç³»ç»Ÿçœ‹ä¸ä¸‹å»ç›´æ¥ç»™ä½ KILLäº†ï¼Œé‚£ä¸šåŠ¡å°±å®Œè›‹äº†ï¼ğŸ¤£</p><h3 id="1-4-3-å°ç»“"><a href="#1-4-3-å°ç»“" class="headerlink" title="1.4.3 å°ç»“"></a>1.4.3 å°ç»“</h3><ul><li>Pageåˆ†ä¸ºç›®å½•é¡µå’Œæ•°æ®é¡µã€‚ç›®å½•é¡µåªæ”¾å„ä¸ªä¸‹çº§Pageçš„æœ€å°é”®å€¼å’Œè¯¥Pageçš„æŒ‡é’ˆã€‚</li><li>æŸ¥æ‰¾çš„æ—¶å€™ï¼Œè‡ªé¡¶å‘ä¸‹æ‰¾ï¼Œåªéœ€è¦åŠ è½½éƒ¨åˆ†ç›®å½•é¡µåˆ°å†…å­˜ï¼Œå³å¯å®Œæˆç®—æ³•çš„æ•´ä¸ªæŸ¥æ‰¾è¿‡ç¨‹ï¼Œå¤§å¤§å‡å°‘äº†IOæ¬¡æ•°</li><li>èŒƒå›´æŸ¥è¯¢çš„æ—¶å€™ï¼Œå¯ä»¥æ‰¾åˆ°åŒºé—´è¾¹ç•Œçš„ä¸¤ä¸ªèŠ‚ç‚¹çš„ä½ç½®ï¼Œç„¶åç›´æ¥é€šè¿‡å¶å­èŠ‚ç‚¹çš„é“¾è¡¨è¿›è¡Œéå†ï¼Œå–å‡ºæ•°æ®å³å¯ï¼</li><li>MySQLå¯ä»¥æ ¹æ®è®¿é—®é¢‘ç‡ï¼Œé€‚å½“åœ°é¢„å…ˆåŠ è½½æˆ–è€…é‡Šæ”¾ä¸€äº›Pageçš„ç©ºé—´ï¼Œå¹¶ä¸æ˜¯è¯´ä¸€å¼ è¡¨çš„æ‰€æœ‰æ•°æ®éƒ½å¿…é¡»å…¨éƒ¨åŠ è½½åˆ°å†…å­˜é‡Œé¢ï¼›</li></ul><p>åç»­æˆ‘è¿˜ä¼šå­¦ä¹ Bæ ‘å’ŒB+æ ‘æ•°æ®ç»“æ„åœ¨CPPä¸­çš„å®ç°ï¼Œæ•¬è¯·å…³æ³¨æˆ‘çš„åšå®¢ï¼</p><h2 id="1-5-ä¸ºä»€ä¹ˆå…¶ä»–æ•°æ®ç»“æ„ä¸é€‚åˆç´¢å¼•ï¼Ÿ"><a href="#1-5-ä¸ºä»€ä¹ˆå…¶ä»–æ•°æ®ç»“æ„ä¸é€‚åˆç´¢å¼•ï¼Ÿ" class="headerlink" title="1.5 ä¸ºä»€ä¹ˆå…¶ä»–æ•°æ®ç»“æ„ä¸é€‚åˆç´¢å¼•ï¼Ÿ"></a>1.5 ä¸ºä»€ä¹ˆå…¶ä»–æ•°æ®ç»“æ„ä¸é€‚åˆç´¢å¼•ï¼Ÿ</h2><p>åœ¨è®¤è¯†è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè¦è®°ä½ä¸Šæ–‡æåˆ°çš„ä¸€ä¸ªç»“è®ºï¼šçœŸæ­£å½±å“ç´¢å¼•æ€§èƒ½çš„ï¼Œæ˜¯å’Œç¡¬ç›˜IOçš„æ¬¡æ•°ï¼ŒIOæ¬¡æ•°è¶Šå°‘ï¼Œæ€§èƒ½è¶Šé«˜ï¼›</p><ul><li>é“¾è¡¨ã€çº¿æ€§è¡¨ï¼šéƒ½æ˜¯çº¿æ€§éå†ï¼Œå‹æ ¹æ²¡æœ‰ç´¢å¼•çš„åŠŸèƒ½</li><li>äºŒå‰æœç´¢æ ‘ï¼šåœ¨æç«¯åœºæ™¯ä¸‹ä¼šé€€åŒ–æˆæ™®é€šäºŒå‰æ ‘ï¼Œè¿˜æ˜¯çº¿æ€§éå†</li><li><code>AVLTree/RBTree</code>ï¼šè™½ç„¶ç›¸å¯¹å¹³è¡¡ï¼Œä½†äºŒå‰ç»“æ„ä¼šå¯¼è‡´æ ‘çš„æ•´ä½“è¿‡é«˜ï¼Œè‡ªé¡¶å‘ä¸‹æŸ¥è¯¢çš„æ—¶å€™ï¼Œéœ€è¦ç»è¿‡å¤šå±‚çš„å¤šæ¬¡IOï¼Œæ‰èƒ½æ‰¾åˆ°ç›®æ ‡æ•°æ®ï¼ˆB+æ ‘çš„å±‚æ•°æ›´å°‘ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹B+æ ‘æ›´ä¼˜ç§€ï¼‰</li><li>HASHï¼šè™½ç„¶æŸ¥æ‰¾çš„æ—¶å€™å¾ˆå¿«ï¼ŒåŸºæœ¬èƒ½åšåˆ°O(1)ï¼Œä½†èŒƒå›´æŸ¥è¯¢çš„æ•ˆæœä¸ä½³ï¼›åœ¨MySQLä¸­ä¹Ÿæ˜¯æ”¯æŒHASHç´¢å¼•çš„ï¼Œæ¯”å¦‚<code>MEMOY/HEAP/NDB</code>å­˜å‚¨å¼•æ“ï¼›</li></ul><p><img src="https://img.musnow.top/i/2023/09/ab7bb4e2660ff869b45d61974beb6ed7.png" alt="image-20230907193621724"></p><p>é‚£Bæ ‘ä¸ºä»€ä¹ˆä¸é€‚åˆå‘¢ï¼Ÿä½œä¸ºä¸€ä¸ªå¤šå‰æ ‘ç»“æ„ï¼ŒBæ ‘çš„åŒå±‚èƒ½æ¯”çº¢é»‘æ ‘å­˜å‚¨æ›´å¤šä¿¡æ¯ï¼Œçœ‹ä¸Šå»ä¹Ÿæ˜¯å¯ä»¥åšç´¢å¼•çš„å‘€ï¼Ÿ</p><p>ç‰µæ‰¯åˆ°Bæ ‘å’ŒB+æ ‘çš„åŒºåˆ«äº†ï¼Œæ¥çœ‹çœ‹äºŒè€…çš„ç»“æ„å›¾</p><p><img src="https://img.musnow.top/i/2023/09/d485930385b11585cdb3c15e87e2b2df.png" alt="image-20230907145442565"></p><p>æ–‡å­—è¯´æ˜å¦‚ä¸‹ï¼š</p><ul><li>Bæ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½ä¼šå­˜æ”¾ä¸€å®šçš„æ•°æ®å’ŒpageæŒ‡é’ˆï¼›</li><li>B+æ ‘åªæœ‰å¶å­èŠ‚ç‚¹ä¼šå­˜æ”¾æ•°æ®ï¼Œéå¶å­èŠ‚ç‚¹åªæœ‰pageçš„ç›®å½•ï¼›</li><li>B+æ ‘çš„å¶å­èŠ‚ç‚¹å…¨éƒ¨ç›¸è¿ï¼›</li></ul><p>è¿™å°±å¼•å‡ºäº†B+æ ‘çš„ä¸¤ä¸ªä¼˜ç‚¹ï¼š</p><ul><li>å› ä¸ºB+æ ‘çš„éå¶å­èŠ‚ç‚¹åªéœ€è¦å­˜å‚¨pageç›®å½•ï¼Œæ‰€ä»¥åœ¨ä¸€ä¸ªéå¶å­èŠ‚ç‚¹ä¸­å°±èƒ½å­˜æ”¾è¾ƒå¤šçš„ç›®å½•ç´¢å¼•ï¼Œä½¿å¾—æ ‘æ•´ä½“æ›´çŸ®ï¼›</li><li>B+æ ‘çš„å¶å­èŠ‚ç‚¹å…¨éƒ¨ç›¸è¿ï¼Œæ–¹ä¾¿è¿›è¡ŒèŒƒå›´éå†ï¼Œæ¯”å¦‚<code>where sal&gt;100 and sal &lt; 300</code>çš„è¿™ç§èŒƒå›´æ¡ä»¶ï¼Œå°±å¯ä»¥ç›´æ¥é€šè¿‡å¶å­èŠ‚ç‚¹çš„é“¾è¡¨å‘åéå†æ¥è§£å†³ï¼›</li></ul><p>æœ€ç»ˆçš„æ•ˆç‡é—®é¢˜ä¾æ—§è½åˆ°äº†å¦‚ä½•è®©æ ‘æ›´çŸ®æ¥<strong>å‡å°‘IOæ¬¡æ•°</strong>ï¼Œå› ä¸ºåœ¨æ•´ä½“ä¸ŠB+æ ‘éƒ½èƒ½åšåˆ°è¾ƒçŸ®ï¼ŒæŸ¥è¯¢æ•ˆç‡ä¼˜ç§€ï¼Œæ–¹ä¾¿èŒƒå›´æŸ¥è¯¢ï¼›æ‰€ä»¥MySQLä¸»è¦é€‰ç”¨äº†B+æ ‘ä½œä¸ºç´¢å¼•ç»“æ„ã€‚</p><h2 id="1-6-èšç°‡-x2F-éèšç°‡ç´¢å¼•"><a href="#1-6-èšç°‡-x2F-éèšç°‡ç´¢å¼•" class="headerlink" title="1.6 èšç°‡&#x2F;éèšç°‡ç´¢å¼•"></a>1.6 èšç°‡&#x2F;éèšç°‡ç´¢å¼•</h2><h3 id="1-6-1-è¯´æ˜"><a href="#1-6-1-è¯´æ˜" class="headerlink" title="1.6.1 è¯´æ˜"></a>1.6.1 è¯´æ˜</h3><p>InnoDBçš„æ•°æ®æ˜¯å’ŒB+æ ‘ä¸€èµ·å­˜æ”¾çš„ï¼Œå¶å­èŠ‚ç‚¹é‡Œé¢æœ‰æ•°æ®ï¼›è¿™ç§æ•°æ®å’Œç´¢å¼•åœ¨ä¸€èµ·çš„å½¢å¼ï¼Œå«åš<strong>èšç°‡ç´¢å¼•</strong>ã€‚</p><p><img src="https://img.musnow.top/i/2023/09/c569f1a484e8f61b916751b6d6305a2b.png" alt="image-20230907145652553"></p><p>MyISAMçš„å¶å­ä¸­æ²¡æœ‰æ•°æ®ï¼Œè€Œæ˜¯å­˜æ”¾çš„æŒ‡å‘æ•°æ®è¡¨å¯¹åº”ä½ç½®çš„æŒ‡é’ˆï¼Œæœ‰é¢å¤–çš„ä¸€å¼ è¡¨æ¥å­˜æ”¾æ‰€æœ‰æ•°æ®ï¼›è¿™ç§æ•°æ®å’Œç´¢å¼•åˆ†ç¦»çš„å½¢å¼ï¼Œå«åš<strong>éèšç°‡ç´¢å¼•</strong>ï¼›</p><p><img src="https://img.musnow.top/i/2023/09/6be83a012b547b33adf2f8e9cab5252d.png" alt="image-20230907145704130"></p><p>å¯¹äºMyISAMå­˜å‚¨å¼•æ“æ¥è¯´ï¼Œ<strong>å…¶å¾ˆé€‚åˆè¿›è¡ŒæŸ¥è¯¢</strong>ï¼Œç‰¹åˆ«æ˜¯å¤§æ–‡æœ¬æŸ¥æ‰¾å’Œå…¨æ–‡ç´¢å¼•ï¼ˆåæ–‡ä¼šæåˆ°ï¼‰ï¼›</p><h3 id="1-6-2-å®æœºæ¼”ç¤º"><a href="#1-6-2-å®æœºæ¼”ç¤º" class="headerlink" title="1.6.2 å®æœºæ¼”ç¤º"></a>1.6.2 å®æœºæ¼”ç¤º</h3><blockquote><p>åœ¨MySQLä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®é™…æ–‡ä»¶çš„æ•°é‡çœ‹å‡ºInnoDBå’ŒMyISAMå­˜å‚¨å¼•æ“çš„åŒºåˆ«ï¼›å…¶ä¹Ÿåæ˜ äº†èšç°‡&#x2F;éèšç°‡ç´¢å¼•çš„æ€§è´¨ã€‚</p></blockquote><p>è¿™é‡Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œåˆ›å»ºuser1è¡¨ï¼Œé»˜è®¤é‡‡ç”¨çš„æ˜¯InnoDBä½œä¸ºå­˜å‚¨å¼•æ“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello_mysql]&gt; create table user1( id int unsigned primary key, name varchar(200) NOT NULL );</span><br><span class="line">Query OK, 0 rows affected (0.008 sec)</span><br></pre></td></tr></table></figure><p>åœ¨MySQLçš„æ–‡ä»¶å­˜å‚¨è·¯å¾„ä¸­ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°user1è¡¨å¯¹åº”äº†ä¸¤ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­<code>.ibd</code>åç¼€æŒ‡çš„å°±æ˜¯InnoDBï¼Œå…¶å†…éƒ¨åŒæ—¶åŒ…å«äº†è¯¥è¡¨ä¸­çš„æ•°æ®å’Œç´¢å¼•å€¼ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@vm-cnt8:/var/lib/mysql/hello_mysql]# ll</span><br><span class="line">total 104</span><br><span class="line">-rw-rw----. 1 mysql mysql    61 Sep  7 02:59 db.opt</span><br><span class="line">-rw-rw----. 1 mysql mysql  1545 Sep  7 03:00 user1.frm</span><br><span class="line">-rw-rw----. 1 mysql mysql 98304 Sep  7 03:00 user1.ibd</span><br></pre></td></tr></table></figure><p>å†æ¥åˆ›å»ºä¸€ä¸ªå±æ€§å®Œå…¨ç›¸åŒçš„user2è¡¨ï¼Œä½†é‡‡ç”¨MyISAMå­˜å‚¨å¼•æ“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello_mysql]&gt; create table user2( id int unsigned primary key, name varchar(200) NOT NULL ) engine=MyISAM;</span><br><span class="line">Query OK, 0 rows affected (0.002 sec)</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶èƒ½çœ‹åˆ°ï¼ŒMyISAMå¯¹åº”çš„å­˜å‚¨æ–‡ä»¶æœ‰3ä¸ªï¼Œ<code>.MYI</code>åŒ…å«çš„æ˜¯ç´¢å¼•ï¼Œ<code>.MYD</code>åŒ…å«çš„æ˜¯å®é™…æ•°æ®ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@vm-cnt8:/var/lib/mysql/hello_mysql]# ll</span><br><span class="line">total 112</span><br><span class="line">-rw-rw----. 1 mysql mysql    61 Sep  7 02:59 db.opt</span><br><span class="line">-rw-rw----. 1 mysql mysql  1545 Sep  7 03:00 user1.frm</span><br><span class="line">-rw-rw----. 1 mysql mysql 98304 Sep  7 03:00 user1.ibd</span><br><span class="line">-rw-rw----. 1 mysql mysql  1545 Sep  7 03:03 user2.frm</span><br><span class="line">-rw-rw----. 1 mysql mysql     0 Sep  7 03:03 user2.MYD</span><br><span class="line">-rw-rw----. 1 mysql mysql  1024 Sep  7 03:03 user2.MYI</span><br></pre></td></tr></table></figure><p>ä¸¤è¡¨éƒ½æœ‰ä¸€ä¸ªå ç”¨ç©ºé—´å®Œå…¨ç›¸åŒçš„<code>.frm</code>æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸­å­˜å‚¨çš„å°±æ˜¯è¯¥è¡¨çš„ç»“æ„å±æ€§ä¿¡æ¯ï¼Œå› ä¸ºä¸¤ä¸ªè¡¨çš„ç»“æ„å®Œå…¨ç›¸åŒï¼Œæ‰€ä»¥è¿™ä¸ªæ–‡ä»¶çš„å¤§å°ä¹Ÿç›¸åŒï¼›</p><h2 id="1-7-å›è¡¨æŸ¥æ‰¾"><a href="#1-7-å›è¡¨æŸ¥æ‰¾" class="headerlink" title="1.7 å›è¡¨æŸ¥æ‰¾"></a>1.7 å›è¡¨æŸ¥æ‰¾</h2><p>åˆ›å»º<strong>è¾…åŠ©ç´¢å¼•</strong>çš„æ—¶å€™ï¼ŒMyISAMä¾æ—§åˆ›å»ºä¸€ä¸ªB+æ ‘ï¼Œå¶å­èŠ‚ç‚¹ä¹Ÿæ˜¯æŒ‡å‘å¯¹åº”ä½ç½®çš„æŒ‡é’ˆï¼›æ‰€ä»¥åœ¨MyISAMä¸­ï¼Œä¸»é”®&#x2F;éä¸»é”®ç´¢å¼•åŒºåˆ«ä¸å¤§ï¼Œæ— éæ˜¯æ˜¯å¦å…è®¸å†—ä½™æ•°æ®çš„é—®é¢˜ã€‚</p><p><img src="https://img.musnow.top/i/2023/09/2540a3c70fb29ad3e861374ef8a0cbe1.png" alt="image-20230907145845574"></p><p>InnoDBçš„è¾…åŠ©ç´¢å¼•ä¸­ï¼Œä¸å†ç›´æ¥å­˜æ”¾èŠ‚ç‚¹æ•°æ®ï¼Œè€Œæ˜¯å­˜æ”¾<strong>ä¸»é”®keyå€¼</strong>ï¼ŒæŸ¥è¯¢çš„æ—¶å€™æ ¹æ®keyå€¼å›åˆ°<strong>ä¸»é”®ç´¢å¼•è¡¨</strong>ä¸­è¿›è¡ŒæŸ¥è¯¢ï¼Œéœ€è¦<strong>æŸ¥è¯¢ä¸¤æ¬¡</strong>æ‰èƒ½è·å–åˆ°ç»“æœã€‚</p><blockquote><p>å¦‚æœè¾…åŠ©ç´¢å¼•ä¸­è¿˜ä¿å­˜æ•°æ®ï¼Œå°±ä¼šé€ æˆæå¤§çš„ç©ºé—´æµªè´¹ï¼Œä¸€ä»½æ•°æ®è¢«ä¿å­˜ä¸¤æ¬¡ç”šè‡³æ›´å¤šæ¬¡ï¼Œæ˜¾ç„¶æ˜¯ä¸åˆç†çš„ã€‚</p></blockquote><p>InnoDBè¿™ä¸ªå…ˆæŸ¥è¾…åŠ©ç´¢å¼•è¡¨ï¼Œå†å›åˆ°ä¸»é”®è¡¨ä¸­æŸ¥è¯¢çš„åŠ¨ä½œï¼Œå«åš<code>å›è¡¨æŸ¥è¯¢</code>ï¼›</p><p>è¯è™½æ˜¯è¿™ä¹ˆè¯´ï¼Œä½†ä¹Ÿå¹¶ä¸æ˜¯æ¯æ¬¡æŸ¥è¯¢æˆ‘ä»¬éƒ½éœ€è¦å›è¡¨çš„ã€‚æ¯”å¦‚ä¸‹å›¾æ˜¯ä¸€ä¸ªå¤åˆé”®çš„ç´¢å¼•è¡¨ï¼Œå‡è®¾æ•°å­—æ˜¯ç”¨æˆ·IDï¼ˆä¸»é”®ï¼‰ï¼Œæ–‡å­—æ˜¯ç”¨æˆ·å§“åï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡ç”¨æˆ·å§“åæŸ¥è¯¢ç”¨æˆ·IDçš„æ—¶å€™ï¼Œå°±ä¸éœ€è¦å›åˆ°ä¸»é”®è¡¨ä¹Ÿèƒ½è·å–åˆ°ç»“æœã€‚</p><p><img src="https://img.musnow.top/i/2023/09/6004dda4aa0dd67277e214f2fa4497db.png" alt="image-20230907144213435"></p><p>å¦å¤–ï¼Œåœ¨ä¸€èˆ¬çš„æ•°æ®åº“ä¸­ï¼ŒB+æ ‘å¹¶ä¸ä¼šå¾ˆæ·±ï¼Œæ‰€ä»¥å³ä¾¿éœ€è¦è¿›è¡Œå›è¡¨çš„ä¸¤æ¬¡æŸ¥è¯¢ï¼Œæ•ˆç‡ä¹Ÿä¸ä¼šå—åˆ°è¾ƒå¤§å½±å“ï¼›ï¼ˆä½†è‚¯å®šä¼šæœ‰ä¸€å®šæŸå¤±ï¼‰</p><h1 id="2-ç´¢å¼•æ“ä½œ"><a href="#2-ç´¢å¼•æ“ä½œ" class="headerlink" title="2.ç´¢å¼•æ“ä½œ"></a>2.ç´¢å¼•æ“ä½œ</h1><h2 id="2-1-åˆ›å»ºç´¢å¼•çš„åŸåˆ™"><a href="#2-1-åˆ›å»ºç´¢å¼•çš„åŸåˆ™" class="headerlink" title="2.1 åˆ›å»ºç´¢å¼•çš„åŸåˆ™"></a>2.1 åˆ›å»ºç´¢å¼•çš„åŸåˆ™</h2><ul><li>æ¯”è¾ƒé¢‘ç¹ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µåº”è¯¥åˆ›å»ºç´¢å¼•</li><li>å”¯ä¸€æ€§å¤ªå·®çš„å­—æ®µä¸é€‚åˆå•ç‹¬åˆ›å»ºç´¢å¼•ï¼Œå³ä½¿é¢‘ç¹ä½œä¸ºæŸ¥è¯¢æ¡ä»¶</li><li>æ›´æ–°éå¸¸é¢‘ç¹çš„å­—æ®µä¸é€‚åˆä½œåˆ›å»ºç´¢å¼•ï¼ˆå› ä¸ºæ¯æ¬¡æ›´æ–°éƒ½å¾—é‡ç½®ç´¢å¼•ï¼Œå¢åŠ IOå‹åŠ›ï¼‰</li><li>ä¸ä¼šå‡ºç°åœ¨whereå­å¥ä¸­çš„å­—æ®µä¸è¯¥åˆ›å»ºç´¢å¼•ï¼ˆä¸ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µï¼‰</li></ul><p>å¦å¤–ï¼Œå¦‚æœåœ¨åˆ›å»ºè¡¨çš„æ—¶å€™ä¹ˆæœ‰æŒ‡å®šä¸»é”®ï¼Œé‚£ä¹ˆMySQLä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªéšè—çš„è‡ªå¢ä¸»é”®IDï¼ˆä¸ç„¶å°±æ²¡åŠæ³•æ”¯æŒå…¶ä»–ç´¢å¼•å’Œå…¶æœ¬èº«çš„å¿«é€ŸæŸ¥æ‰¾äº†ï¼‰</p><h2 id="2-2-åˆ›å»ºä¸»é”®ç´¢å¼•"><a href="#2-2-åˆ›å»ºä¸»é”®ç´¢å¼•" class="headerlink" title="2.2 åˆ›å»ºä¸»é”®ç´¢å¼•"></a>2.2 åˆ›å»ºä¸»é”®ç´¢å¼•</h2><p>åˆ›å»ºè¡¨çš„æ—¶å€™æŒ‡å®š<code>primary key</code>ï¼Œé»˜è®¤å°±ä¼šåˆ›å»ºä¸»é”®ç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> user1( id <span class="type">int</span> unsigned <span class="keyword">primary</span> key, name <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> );</span><br></pre></td></tr></table></figure><p>åˆ›å»ºè¡¨çš„æœ€åï¼ŒæŒ‡å®šæŸåˆ—ä¸ºä¸»é”®ç´¢å¼•ï¼Œè¿™ä¸ªå’Œç¬¬ä¸€ç§æ–¹å¼æœ¬è´¨ä¸Šæ²¡åŒºåˆ«</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> user1( id <span class="type">int</span> unsigned , name <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, <span class="keyword">primary</span> key(id) );</span><br></pre></td></tr></table></figure><p>åˆ›å»ºè¡¨äº†ä¹‹åå†æ·»åŠ ä¸»é”®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»ºè¡¨</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> user1( id <span class="type">int</span> unsigned , name <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>);</span><br><span class="line"><span class="comment">-- æ·»åŠ ä¸»é”®</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user1 <span class="keyword">add</span> <span class="keyword">primary</span> key(id);</span><br></pre></td></tr></table></figure><p>ä¸»é”®ç´¢å¼•çš„ç‰¹ç‚¹ï¼š</p><ul><li>ä¸€ä¸ªè¡¨é‡Œé¢æœ¬æ¥å°±åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ï¼Œæ‰€ä»¥ä¸»é”®ç´¢å¼•ä¹Ÿåªæœ‰ä¸€ä¸ªï¼ˆå¤åˆä¸»é”®ä¹Ÿåªç®—ä¸€ä¸ªä¸»é”®ï¼‰</li><li>ä¸»é”®ç´¢å¼•çš„æ•ˆç‡é«˜ï¼ˆä¸»é”®åˆ—ä¸å¯é‡å¤ï¼‰</li><li>ä¸»é”®åˆ—ä¸èƒ½ä¸ºNULLï¼Œæ‰€ä»¥ä¹Ÿä¸å­˜åœ¨æ— æ³•è¢«ç´¢å¼•çš„å€¼</li><li>ä¸€èˆ¬éƒ½ä¼šç”¨æ•°å­—æ¥ä½œä¸ºä¸»é”®ï¼Œåœ¨ç´¢å¼•ä¸­æ–¹ä¾¿æ•°æ®æ¯”è¾ƒ</li></ul><h2 id="2-3-å”¯ä¸€é”®ç´¢å¼•"><a href="#2-3-å”¯ä¸€é”®ç´¢å¼•" class="headerlink" title="2.3 å”¯ä¸€é”®ç´¢å¼•"></a>2.3 å”¯ä¸€é”®ç´¢å¼•</h2><p>å½“ä½ ç»™æŸä¸€åˆ—è®¾ç½®ä¸ºå”¯ä¸€é”®çš„æ—¶å€™ï¼ŒMySQLå°±ä¼šè‡ªåŠ¨åˆ›å»ºå”¯ä¸€é”®ç´¢å¼•ï¼›å”¯ä¸€é”®ç´¢å¼•å…¶å®å°±æ˜¯æ™®é€šçš„è¾…åŠ©ç´¢å¼•ï¼Œåªä¸è¿‡å…¶å’Œä¸»é”®ä¸€æ ·éƒ½åŒ…å«å”¯ä¸€çš„é”®å€¼çº¦æŸï¼›</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç›´æ¥æŒ‡å®šå”¯ä¸€é”®</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> user2(id <span class="type">int</span> <span class="keyword">primary</span> key, name <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">unique</span>);</span><br><span class="line"><span class="comment">-- åˆ›å»ºè¯­å¥æœ«å°¾æŒ‡å®šå”¯ä¸€é”®</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> user2(id <span class="type">int</span> <span class="keyword">primary</span> key, name <span class="type">varchar</span>(<span class="number">200</span>),<span class="keyword">unique</span>(name));</span><br><span class="line"><span class="comment">-- åˆ›å»ºåå†æ·»åŠ å”¯ä¸€é”®</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> user2(id <span class="type">int</span> <span class="keyword">primary</span> key, name <span class="type">varchar</span>(<span class="number">200</span>));</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user2 <span class="keyword">add</span> <span class="keyword">unique</span>(name);</span><br></pre></td></tr></table></figure><p>å”¯ä¸€ç´¢å¼•çš„ç‰¹ç‚¹ï¼š</p><ul><li>ä¸€ä¸ªè¡¨ä¸­ï¼Œå¯ä»¥æœ‰å¤šä¸ªå”¯ä¸€ç´¢å¼•ï¼ŒåŒ…æ‹¬å¤åˆå”¯ä¸€é”®çš„ç´¢å¼•ï¼›</li><li>æŸ¥è¯¢æ•ˆç‡é«˜ï¼›</li><li>å¦‚æœåœ¨æŸä¸€åˆ—å»ºç«‹å”¯ä¸€ç´¢å¼•ï¼Œå¿…é¡»ä¿è¯è¿™åˆ—ä¸èƒ½æœ‰é‡å¤æ•°æ®ï¼›</li><li>å¦‚æœä¸€ä¸ªå”¯ä¸€ç´¢å¼•ä¸ŠæŒ‡å®š<code>not null</code>ï¼Œç­‰ä»·äºä¸»é”®ç´¢å¼•ï¼›</li><li>å¦‚æœåˆ é™¤å”¯ä¸€é”®ç´¢å¼•ï¼Œä¹Ÿä¼šåŒæ—¶åˆ é™¤å”¯ä¸€çš„çº¦æŸå±æ€§ï¼›</li></ul><h2 id="2-4-æ™®é€šé”®ç´¢å¼•"><a href="#2-4-æ™®é€šé”®ç´¢å¼•" class="headerlink" title="2.4 æ™®é€šé”®ç´¢å¼•"></a>2.4 æ™®é€šé”®ç´¢å¼•</h2><p>åˆ›å»ºæ™®é€šç´¢å¼•ä¾æ—§æœ‰3ç§æ–¹å¼</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åœ¨è¡¨çš„å®šä¹‰æœ€åï¼ŒæŒ‡å®šæŸåˆ—ä¸ºç´¢å¼•</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> user3(id <span class="type">int</span> <span class="keyword">primary</span> key,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    email <span class="type">varchar</span>(<span class="number">30</span>),</span><br><span class="line">    index(name)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ›å»ºå®Œè¡¨ä»¥åæŒ‡å®šæŸåˆ—ä¸ºæ™®é€šç´¢å¼•</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> user3(id <span class="type">int</span> <span class="keyword">primary</span> key, name <span class="type">varchar</span>(<span class="number">20</span>), email</span><br><span class="line"><span class="type">varchar</span>(<span class="number">30</span>));</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user3 <span class="keyword">add</span> index(name);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ›å»ºç´¢å¼•çš„æ—¶å€™æŒ‡å®šåå­—</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> user3(id <span class="type">int</span> <span class="keyword">primary</span> key, name <span class="type">varchar</span>(<span class="number">20</span>), email</span><br><span class="line"><span class="type">varchar</span>(<span class="number">30</span>));</span><br><span class="line"><span class="keyword">create</span> index idx_name <span class="keyword">on</span> user3(name); <span class="comment">-- åˆ›å»ºä¸€ä¸ªç´¢å¼•åä¸º idx_name çš„ç´¢å¼•</span></span><br></pre></td></tr></table></figure><p>æ™®é€šç´¢å¼•çš„ç‰¹ç‚¹ï¼š</p><ul><li>ä¸€ä¸ªè¡¨ä¸­å¯ä»¥æœ‰å¤šä¸ªæ™®é€šç´¢å¼•</li><li>æ™®é€šç´¢å¼•ä¸­çš„é”®å€¼å¯ä»¥é‡å¤ï¼Œä½†ä¸è¦åœ¨å¤§é‡é‡å¤çš„é”®å€¼ä¸Šå»ºç«‹ç´¢å¼•ï¼ˆæ¯”å¦‚æ€§åˆ«ï¼‰</li></ul><h2 id="2-5-å¤åˆ-x2F-è”åˆç´¢å¼•"><a href="#2-5-å¤åˆ-x2F-è”åˆç´¢å¼•" class="headerlink" title="2.5 å¤åˆ&#x2F;è”åˆç´¢å¼•"></a>2.5 å¤åˆ&#x2F;è”åˆç´¢å¼•</h2><p>ç»™å¤šä¸ªé”®å€¼åˆ›å»ºç´¢å¼•ï¼Œæ“ä½œå¦‚ä¸‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index ç´¢å¼•åå­— <span class="keyword">on</span> è¡¨å(å­—æ®µ<span class="number">1</span>,å­—æ®µ<span class="number">2</span>);</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æˆ‘ä»¬åˆ›å»ºçš„ç´¢å¼•ï¼Œåœ¨å­—æ®µ1å’Œå­—æ®µ2ä¸Šä¼šå…±ç”¨ä¸€ä¸ªç´¢å¼•çš„<code>Key_name</code>ï¼Œç´¢å¼•åå­—æ˜¯ç›¸åŒçš„ã€‚</p><p>å¤åˆç´¢å¼•æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œå¦‚æœä½¿ç”¨InnoDBæ—¶ï¼Œ<strong>éœ€è¦æŸ¥è¯¢çš„ç»“æœåŒ…å«åœ¨ç´¢å¼•å­—æ®µä¸­</strong>ï¼Œé‚£å°±å¯ä»¥èŠ‚çœä¸€æ¬¡è¿”è¿˜åˆ°ä¸»é”®ç´¢å¼•ä¸­æŸ¥è¯¢çš„å›è¡¨æ­¥éª¤ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜æ•ˆç‡ï¼ˆåœ¨ä¸Šæ–‡ä¸­å·²ç»æåŠæ­¤äº‹ï¼‰</p><ul><li>ä¸Šé¢è¿™ç§æ“ä½œå«åš<strong>ç´¢å¼•è¦†ç›–</strong>ï¼ˆè¦†ç›–ç´¢å¼•ï¼‰ï¼Œç›´æ¥ä»æ™®é€šç´¢å¼•è¡¨ä¸­æŸ¥è¯¢åˆ°ç»“æœï¼›</li><li>å»ºç«‹å¤åˆç´¢å¼•ç›¸æ¯”äºå»ºç«‹å¤šä¸ªå•åˆ—ç´¢å¼•ï¼Œè¿˜èƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘ç©ºé—´æ¶ˆè€—ï¼Œæé«˜æ•ˆç‡ï¼›</li></ul><p>å¦å¤–ï¼Œåœ¨è¿›è¡Œå¤åˆç´¢å¼•çš„æŸ¥è¯¢çš„æ—¶å€™ï¼Œ<strong>æˆ‘ä»¬åªèƒ½ä½¿ç”¨ç”¨æˆ·åæ¥æŸ¥è¯¢ç”¨æˆ·ID</strong>ï¼Œè¿”è¿‡æ¥æ˜¯ä¸è¡Œçš„ï¼ˆä¸ä¼šä½¿ç”¨ç´¢å¼•ï¼‰ã€‚å› ä¸ºåœ¨MySQLå¯¹ç´¢å¼•è¿›è¡ŒåŒ¹é…çš„æ—¶å€™ï¼Œåªä¼šåŒ¹é…æœ€å·¦ä¾§çš„ç´¢å¼•å€¼ï¼›</p><p>æ¯”å¦‚ä¸‹å›¾ä¸­ï¼Œå……å½“åˆ¤æ–­æ¡ä»¶çš„æ˜¯ç”¨æˆ·åå­—ï¼Œé€šè¿‡ç”¨æˆ·åå­—æŸ¥ç”¨æˆ·IDæ˜¯OKçš„ï¼Œåè¿‡æ¥å°±ä¸è¡Œï¼›è¿™ç§æƒ…å†µä¸‹MySQLä¸ä¼šä½¿ç”¨ç´¢å¼•ï¼Œä¾æ—§æ˜¯å…¨è¡¨éå†ï¼›</p><p><img src="https://img.musnow.top/i/2023/09/6004dda4aa0dd67277e214f2fa4497db.png" alt="image-20230907144213435"></p><p>è¿™ç§å«åšMySQLç´¢å¼•çš„<strong>æœ€å·¦åŒ¹é…åŸåˆ™</strong></p><blockquote><p>è¯¦è§£ï¼š<a href="https://blog.csdn.net/weixin_47162914/article/details/123793589">è”åˆç´¢å¼•-æœ€å·¦åŒ¹é…åŸåˆ™</a></p></blockquote><p>MySQLåœ¨åˆ›å»ºå¤åˆç´¢å¼•çš„æ—¶å€™ï¼Œé¦–å…ˆä¼š<strong>å¯¹æœ€å·¦è¾¹å­—æ®µæ’åº</strong>ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå­—æ®µï¼Œç„¶åå†åœ¨ä¿è¯ç¬¬ä¸€ä¸ªå­—æ®µæœ‰åºçš„æƒ…å†µä¸‹ï¼Œå†æ’åºç¬¬äºŒä¸ªå­—æ®µï¼Œä»¥æ­¤ç±»æ¨ã€‚æ‰€ä»¥è”åˆç´¢å¼•æœ€å·¦åˆ—æ˜¯ç»å¯¹æœ‰åºçš„ï¼Œå…¶ä»–å­—æ®µæ— åºã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼šå¯ä»¥æŠŠè”åˆç´¢å¼•çœ‹æˆâ€œç”µè¯ç°¿â€ï¼Œå§“åä½œä¸ºè”åˆç´¢å¼•ï¼Œå§“æ˜¯ç¬¬ä¸€åˆ—ï¼Œåæ˜¯ç¬¬äºŒåˆ—ï¼Œå½“æŸ¥æ‰¾äººåæ—¶ï¼Œæ˜¯å…ˆç¡®å®šè¿™ä¸ªäººå§“å†æ ¹æ®åç¡®å®šäººã€‚åªæœ‰åæ²¡æœ‰å§“å°±æŸ¥ä¸åˆ°ã€‚</p><h2 id="2-6-å…¨æ–‡ç´¢å¼•"><a href="#2-6-å…¨æ–‡ç´¢å¼•" class="headerlink" title="2.6 å…¨æ–‡ç´¢å¼•"></a>2.6 å…¨æ–‡ç´¢å¼•</h2><p>å¦‚æœå¯¹æ–‡ç« æˆ–è€…å¤§é‡æ–‡å­—çš„å­—æ®µè¿›è¡Œæ£€ç´¢çš„æ—¶å€™ï¼Œå°±ä¼šä½¿ç”¨åˆ°å…¨æ–‡ç´¢å¼•ã€‚MySQLæä¾›å…¨æ–‡ç´¢å¼•æœºåˆ¶ï¼Œä½†æ˜¯è¦æ±‚è¡¨çš„å­˜å‚¨å¼•æ“å¿…é¡»æ˜¯<code>MyISAM</code>ï¼›è€Œä¸”é»˜è®¤çš„å…¨æ–‡ç´¢å¼•åªæ”¯æŒè‹±æ–‡ï¼Œä¸æ”¯æŒä¸­æ–‡ã€‚å¦‚æœå¯¹ä¸­æ–‡è¿›è¡Œå…¨æ–‡æ£€ç´¢ï¼Œå¯ä»¥ä½¿ç”¨sphinxçš„ä¸­æ–‡ç‰ˆ(coreseek)ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»ºè¡¨ï¼ŒFULLTEXTè®¾ç½®å…¨æ–‡ç´¢å¼•</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> articles (</span><br><span class="line">    id <span class="type">INT</span> UNSIGNED AUTO_INCREMENT <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    title <span class="type">VARCHAR</span>(<span class="number">200</span>),</span><br><span class="line">    body TEXT,</span><br><span class="line">    FULLTEXT (title,body) </span><br><span class="line">)engine<span class="operator">=</span>MyISAM;</span><br><span class="line"><span class="comment">-- æ’å…¥æµ‹è¯•æ•°æ®</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> articles (title,body) <span class="keyword">VALUES</span></span><br><span class="line">    (<span class="string">&#x27;MySQL Tutorial&#x27;</span>,<span class="string">&#x27;DBMS stands for DataBase ...&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;How To Use MySQL Well&#x27;</span>,<span class="string">&#x27;After you went through a ...&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;Optimizing MySQL&#x27;</span>,<span class="string">&#x27;In this tutorial we will show ...&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;1001 MySQL Tricks&#x27;</span>,<span class="string">&#x27;1. Never run mysqld as root. 2. ...&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;MySQL vs. YourSQL&#x27;</span>,<span class="string">&#x27;In the following database comparison ...&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;MySQL Security&#x27;</span>,<span class="string">&#x27;When configured properly, MySQL ...&#x27;</span>);</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå¥½è¡¨ä¹‹åï¼ŒæŸ¥è¯¢è¡¨ä¸­ç´¢å¼•ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°titleå’Œbodyå­—æ®µéƒ½ç”¨ä¸Šäº†ç´¢å¼•åå­—ä¸º<code>title</code>çš„å…¨æ–‡ç´¢å¼•</p><p><img src="https://img.musnow.top/i/2023/09/f0c396d35a81e6ab863f7bec84174f48.png" alt="image-20230907155913783"></p><p>å‡è®¾æˆ‘ä»¬æŸ¥è¯¢è¿™ä¸ªè¡¨ä¸­æœ‰æ²¡æœ‰åŒ…å«databaseçš„æ–‡å­—æ•°æ®ï¼Œè™½ç„¶æˆåŠŸæŸ¥è¯¢äº†ç»“æœï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä½¿ç”¨åˆ°å…¨æ–‡ç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> articles <span class="keyword">where</span> body <span class="keyword">like</span> <span class="string">&#x27;%database%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------------+------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> title             <span class="operator">|</span> body                                     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------------+------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> MySQL Tutorial    <span class="operator">|</span> DBMS stands <span class="keyword">for</span> DataBase ...             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> MySQL vs. YourSQL <span class="operator">|</span> <span class="keyword">In</span> the following database comparison ... <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------------+------------------------------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.000</span> sec)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨explainè¯­å¥å¯ä»¥çœ‹å‡ºæ˜¯å¦æœ‰ä½¿ç”¨å…¨æ–‡ç´¢å¼•ï¼Œè¿™é‡Œçš„keyä¸ºNULLå°±ä»£è¡¨ä¹ˆæœ‰ä½¿ç”¨ä¸Šç´¢å¼•ï¼›è¿™ä¸ªå·¥å…·çš„ä½œç”¨æ˜¯<strong>é¢„æ‰§è¡Œ</strong>ï¼Œå¹¶ä¸ä¼šå®é™…ä¸Šè¿è¡Œè¿™ä¸ªè¯­å¥ï¼Œä½†æ˜¯ä¼šå‘Šè¯‰ä½ æˆ‘æƒ³<strong>æ€ä¹ˆè¿è¡Œå®ƒ</strong>ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">explain select * from articles where body like &#x27;%database%&#x27;\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: articles</span><br><span class="line">         type: ALL</span><br><span class="line">possible_keys: NULL</span><br><span class="line">          key: NULL</span><br><span class="line">      key_len: NULL</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 6</span><br><span class="line">        Extra: Using where</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><p>è¦æƒ³ä½¿ç”¨å…¨æ–‡ç´¢å¼•ï¼Œå¾—è¿™ä¹ˆå†™</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> articles <span class="keyword">WHERE</span> <span class="keyword">MATCH</span> (title,body) AGAINST (<span class="string">&#x27;database&#x27;</span>);</span><br></pre></td></tr></table></figure><p>å†ç”¨explainå·¥å…·çœ‹çœ‹ï¼Œæ­¤æ—¶å°±å¯ä»¥çœ‹åˆ°keyé‡Œé¢æ˜¾ç¤ºçš„æ˜¯titleï¼ŒæˆåŠŸä½¿ç”¨ä¸Šäº†å…¨æ–‡ç´¢å¼•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">explain SELECT * FROM articles WHERE MATCH (title,body) AGAINST</span><br><span class="line">    -&gt; (&#x27;database&#x27;)\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: articles</span><br><span class="line">         type: fulltext</span><br><span class="line">possible_keys: title</span><br><span class="line">          key: title</span><br><span class="line">      key_len: 0</span><br><span class="line">          ref: </span><br><span class="line">         rows: 1</span><br><span class="line">        Extra: Using where</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><h3 id="explainå·¥å…·"><a href="#explainå·¥å…·" class="headerlink" title="explainå·¥å…·"></a>explainå·¥å…·</h3><p>è¿™é‡Œå¯¹explainå·¥å…·æ˜¾ç¤ºçš„åˆ—ä½œä¸€ä¸ªè¯´æ˜ã€‚è¿™ä¸ªå·¥å…·çš„ä½œç”¨æ˜¯<strong>é¢„æ‰§è¡Œ</strong>ï¼Œå¹¶ä¸ä¼šå®é™…ä¸Šè¿è¡Œè¿™ä¸ªè¯­å¥ï¼Œä½†æ˜¯ä¼šå‘Šè¯‰ä½ æˆ‘æƒ³<strong>æ€ä¹ˆè¿è¡Œå®ƒ</strong>ï¼›è¾“å‡ºç»“æœåŒ…å«å¦‚ä¸‹åˆ—ï¼š</p><ul><li>id â€” é€‰æ‹©æ ‡è¯†ç¬¦ï¼Œid è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆè¢«æ‰§è¡Œï¼›</li><li>select_type â€” è¡¨ç¤ºæŸ¥è¯¢çš„ç±»å‹ï¼›</li><li>table â€” è¾“å‡ºç»“æœé›†çš„è¡¨ï¼›</li><li>partitions â€” åŒ¹é…çš„åˆ†åŒºï¼›</li><li>type â€” è¡¨ç¤ºè¡¨çš„è¿æ¥ç±»å‹ï¼›</li><li>possible_keys â€” è¡¨ç¤ºæŸ¥è¯¢æ—¶ï¼Œå¯èƒ½ä½¿ç”¨çš„ç´¢å¼•ï¼›</li><li><strong>key â€” è¡¨ç¤ºå®é™…ä½¿ç”¨çš„ç´¢å¼•ï¼›</strong></li><li>key_len â€” ç´¢å¼•å­—æ®µçš„é•¿åº¦ï¼›</li><li>refâ€”  åˆ—ä¸ç´¢å¼•çš„æ¯”è¾ƒï¼›</li><li>rows â€” å¤§æ¦‚ä¼°ç®—çš„è¡Œæ•°ï¼›</li><li>filtered â€” æŒ‰è¡¨æ¡ä»¶è¿‡æ»¤çš„è¡Œç™¾åˆ†æ¯”ï¼›</li><li>Extra â€” æ‰§è¡Œæƒ…å†µçš„æè¿°å’Œè¯´æ˜ã€‚</li></ul><h2 id="2-7-æŸ¥è¯¢-x2F-åˆ é™¤ç´¢å¼•"><a href="#2-7-æŸ¥è¯¢-x2F-åˆ é™¤ç´¢å¼•" class="headerlink" title="2.7 æŸ¥è¯¢&#x2F;åˆ é™¤ç´¢å¼•"></a>2.7 æŸ¥è¯¢&#x2F;åˆ é™¤ç´¢å¼•</h2><p>å¦‚æœéœ€è¦åˆ é™¤ä¸»é”®ç´¢å¼•ï¼Œç›´æ¥æŠŠä¸»é”®åˆ äº†å°±è¡Œäº†</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å <span class="keyword">drop</span> <span class="keyword">primary</span> key;</span><br></pre></td></tr></table></figure><p>åˆ é™¤æ™®é€šç´¢å¼•è¯­å¥å¦‚ä¸‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å <span class="keyword">drop</span> index ç´¢å¼•åå­—;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œç´¢å¼•çš„åå­—ä¸ä¸€å®šå’Œå­—æ®µåç›¸åŒï¼ˆåœ¨åˆ›å»ºç´¢å¼•çš„æ—¶å€™å¯ä»¥æŒ‡å®šç´¢å¼•åå­—ï¼‰ï¼Œéœ€è¦ä½¿ç”¨å¦‚ä¸‹è¯­å¥æŸ¥çœ‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> keys <span class="keyword">from</span> è¡¨å;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚user2è¡¨ä¸­åŒ…å«idä¸»é”®ç´¢å¼•å’Œnameçš„ä¸»é”®ç´¢å¼•ï¼Œå…¶ç»“æœæŸ¥è¯¢å¦‚ä¸‹ï¼›å…¶ä¸­çš„<code>Key_name</code>æ‰æ˜¯ç´¢å¼•çš„åå­—ï¼Œä¸ä¸€å®šå’Œå­—æ®µåç›¸åŒï¼åˆ é™¤ç´¢å¼•çš„æ—¶å€™éœ€è¦ä½¿ç”¨ç´¢å¼•åå­—ï¼</p><p><img src="https://img.musnow.top/i/2023/09/e01d3842d22be7c1f41568ef3802d1e0.png" alt="image-20230907153259042"></p><p>è¿˜å¯ä»¥ç”¨å¦‚ä¸‹è¯­å¥æ¥æ›´åŠ æ¸…æ¥šçš„çœ‹åˆ°æ¯ä¸ªç´¢å¼•çš„ç›¸å…³å±æ€§</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> è¡¨å\G;</span><br></pre></td></tr></table></figure><p>æˆ‘ç»™user2è¡¨æ·»åŠ ä¸€ä¸ªé”®å€¼ï¼Œå¹¶è®¾ç½®æ™®é€šç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user2 <span class="keyword">add</span> qq <span class="type">varchar</span>(<span class="number">40</span>); <span class="comment">-- æ·»åŠ ä¸€ä¸ªé”®å€¼</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user2 <span class="keyword">add</span> index(qq); <span class="comment">-- æ·»åŠ æ™®é€šç´¢å¼•</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>show index from è¡¨å\G;</code>è¯­å¥æŸ¥çœ‹user2è¡¨çš„ç´¢å¼•å±æ€§ï¼›åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œå”¯ä¸€é”®ç´¢å¼•çš„å±æ€§å’Œæ™®é€šç´¢å¼•æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œ<strong>æ‰€ä»¥æ‰è¯´å”¯ä¸€é”®çš„ç´¢å¼•æœ¬è´¨ä¸Šè¿˜æ˜¯æ™®é€šç´¢å¼•</strong>ã€‚</p><p>è¿™é‡Œè¿˜å†™æ˜äº†ç´¢å¼•çš„ç±»å‹æ˜¯BTREEï¼Œå…¶å°±æ˜¯B+æ ‘ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello_mysql]&gt; desc user2;</span><br><span class="line">+-------+------------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type             | Null | Key | Default | Extra |</span><br><span class="line">+-------+------------------+------+-----+---------+-------+</span><br><span class="line">| id    | int(10) unsigned | NO   | PRI | NULL    |       |</span><br><span class="line">| name  | varchar(200)     | NO   | UNI | NULL    |       |</span><br><span class="line">| qq    | varchar(40)      | YES  | MUL | NULL    |       |</span><br><span class="line">+-------+------------------+------+-----+---------+-------+</span><br><span class="line">3 rows in set (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello_mysql]&gt; show index from user2\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">        Table: user2</span><br><span class="line">   Non_unique: 0</span><br><span class="line">     Key_name: PRIMARY</span><br><span class="line"> Seq_in_index: 1</span><br><span class="line">  Column_name: id</span><br><span class="line">    Collation: A</span><br><span class="line">  Cardinality: 0</span><br><span class="line">     Sub_part: NULL</span><br><span class="line">       Packed: NULL</span><br><span class="line">         Null: </span><br><span class="line">   Index_type: BTREE</span><br><span class="line">      Comment: </span><br><span class="line">Index_comment: </span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">        Table: user2</span><br><span class="line">   Non_unique: 0</span><br><span class="line">     Key_name: name</span><br><span class="line"> Seq_in_index: 1</span><br><span class="line">  Column_name: name</span><br><span class="line">    Collation: A</span><br><span class="line">  Cardinality: 0</span><br><span class="line">     Sub_part: NULL</span><br><span class="line">       Packed: NULL</span><br><span class="line">         Null: </span><br><span class="line">   Index_type: BTREE</span><br><span class="line">      Comment: </span><br><span class="line">Index_comment: </span><br><span class="line">*************************** 3. row ***************************</span><br><span class="line">        Table: user2</span><br><span class="line">   Non_unique: 1</span><br><span class="line">     Key_name: qq</span><br><span class="line"> Seq_in_index: 1</span><br><span class="line">  Column_name: qq</span><br><span class="line">    Collation: A</span><br><span class="line">  Cardinality: NULL</span><br><span class="line">     Sub_part: NULL</span><br><span class="line">       Packed: NULL</span><br><span class="line">         Null: YES</span><br><span class="line">   Index_type: BTREE</span><br><span class="line">      Comment: </span><br><span class="line">Index_comment: </span><br><span class="line">3 rows in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br></pre></td></tr></table></figure><h2 id="2-8-ä»€ä¹ˆæ—¶å€™ç´¢å¼•ä¼šå¤±æ•ˆï¼Ÿ"><a href="#2-8-ä»€ä¹ˆæ—¶å€™ç´¢å¼•ä¼šå¤±æ•ˆï¼Ÿ" class="headerlink" title="2.8 ä»€ä¹ˆæ—¶å€™ç´¢å¼•ä¼šå¤±æ•ˆï¼Ÿ"></a>2.8 ä»€ä¹ˆæ—¶å€™ç´¢å¼•ä¼šå¤±æ•ˆï¼Ÿ</h2><blockquote><p><a href="https://cloud.tencent.com/developer/article/2035778">https://cloud.tencent.com/developer/article/2035778</a></p><p><a href="https://zhuanlan.zhihu.com/p/361172794">https://zhuanlan.zhihu.com/p/361172794</a></p></blockquote><h3 id="2-8-1-å¦‚æœæ¡ä»¶ä¸­æœ‰or-x2F-and"><a href="#2-8-1-å¦‚æœæ¡ä»¶ä¸­æœ‰or-x2F-and" class="headerlink" title="2.8.1 å¦‚æœæ¡ä»¶ä¸­æœ‰or&#x2F;and"></a>2.8.1 å¦‚æœæ¡ä»¶ä¸­æœ‰or&#x2F;and</h3><p>å¦‚æœæ¡ä»¶ä¸­æœ‰or&#x2F;andï¼Œå³ä½¿å…¶ä¸­<strong>æœ‰éƒ¨åˆ†æ¡ä»¶å¸¦ç´¢å¼•</strong>ä¹Ÿä¸ä¼šä½¿ç”¨ï¼›</p><p>å…ˆè¯´ç»“è®ºï¼šå¦‚æœåœ¨ä½¿ç”¨andå’Œorè¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œåªæœ‰ä¸¤åˆ—éƒ½åŒ…å«äº†ç´¢å¼•æ‰ä¼šä½¿ç”¨ï¼›</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»ºç¤ºä¾‹è¡¨ï¼Œå…¶ä¸­idæ˜¯ä¸»é”®ï¼Œuser_idæ²¡æœ‰åˆ›å»ºç´¢å¼•</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> user3(</span><br><span class="line">id <span class="type">int</span> unsigned <span class="keyword">primary</span> key,</span><br><span class="line">user_id <span class="type">int</span> unsigned <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- æ’å…¥ç¤ºä¾‹æ•°æ®</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> user3 <span class="keyword">values</span> </span><br><span class="line">(<span class="number">1</span>,<span class="number">10</span>,<span class="string">&#x27;ç”²&#x27;</span>),(<span class="number">2</span>,<span class="number">20</span>,<span class="string">&#x27;ä¸™&#x27;</span>),(<span class="number">3</span>,<span class="number">30</span>,<span class="string">&#x27;ä¹™&#x27;</span>),(<span class="number">4</span>,<span class="number">40</span>,<span class="string">&#x27;ä¸&#x27;</span>),</span><br><span class="line">(<span class="number">5</span>,<span class="number">50</span>,<span class="string">&#x27;å°¼æ–¯&#x27;</span>),(<span class="number">6</span>,<span class="number">23</span>,<span class="string">&#x27;ä¼é¹…&#x27;</span>),(<span class="number">7</span>,<span class="number">14</span>,<span class="string">&#x27;å€ªæµ©&#x27;</span>),(<span class="number">9</span>,<span class="number">21</span>,<span class="string">&#x27;test&#x27;</span>);</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™å¦‚æœç”¨å¦‚ä¸‹è¯­å¥è¿›è¡ŒæŸ¥è¯¢ï¼Œé‚£å°±ä¸ä¼šä½¿ç”¨ç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user3 <span class="keyword">where</span> id<span class="operator">=</span><span class="number">3</span> <span class="keyword">or</span> user_id<span class="operator">=</span><span class="number">40</span>;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>explain</code>å‘½ä»¤æ¥æŸ¥çœ‹è¿è¡Œè¿‡ç¨‹ï¼Œå¯ä»¥çœ‹åˆ°keyä¸€åˆ—ä¸ºç©ºï¼Œä»£è¡¨æ²¡æœ‰ä½¿ç”¨ç´¢å¼•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello_mysql]&gt; explain select * from user3 where id=3 or user_id=40\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: user3</span><br><span class="line">         type: ALL</span><br><span class="line">possible_keys: PRIMARY</span><br><span class="line">          key: NULL</span><br><span class="line">      key_len: NULL</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 4</span><br><span class="line">        Extra: Using where</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br><span class="line"></span><br><span class="line">MariaDB [hello_mysql]&gt; explain select * from user3 where id=2 and user_id=30\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: NULL</span><br><span class="line">         type: NULL</span><br><span class="line">possible_keys: NULL</span><br><span class="line">          key: NULL</span><br><span class="line">      key_len: NULL</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: NULL</span><br><span class="line">        Extra: Impossible WHERE noticed after reading const tables</span><br><span class="line">1 row in set (0.001 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br></pre></td></tr></table></figure><p>ç›´æ¥æŸ¥è¯¢idï¼Œæœ‰ä½¿ç”¨ç´¢å¼•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello_mysql]&gt; explain select * from user3 where id=2\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: user3</span><br><span class="line">         type: const</span><br><span class="line">possible_keys: PRIMARY</span><br><span class="line">          key: PRIMARY</span><br><span class="line">      key_len: 4</span><br><span class="line">          ref: const</span><br><span class="line">         rows: 1</span><br><span class="line">        Extra: </span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å¦‚æœç»™<code>user_id</code>åˆ—åŠ ä¸Šç´¢å¼•åé‡æ–°æ“ä½œï¼Œé‚£ç»“æœå°±ä¸ä¸€æ ·äº†</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user3 <span class="keyword">add</span> <span class="keyword">unique</span>(user_id); <span class="comment">-- å”¯ä¸€é”®ç´¢å¼•</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ‰ä½¿ç”¨ç´¢å¼•ï¼ˆåœ¨æˆ‘çš„æµ‹è¯•ä¸­ï¼Œå¹¶ä¸æ˜¯æ¯æ¬¡éƒ½ä¼šä½¿ç”¨ç´¢å¼•ï¼Œè¿™å¤§æ¦‚æ˜¯å› ä¸ºæˆ‘çš„å†…å®¹åˆ—å¤ªå°‘äº†ï¼Œä¸å¦‚ç›´æ¥éå†ï¼Ÿï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello_mysql]&gt; explain select * from user3 where id=2 and user_id=20\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: user3</span><br><span class="line">         type: const</span><br><span class="line">possible_keys: PRIMARY,user_id</span><br><span class="line">          key: PRIMARY</span><br><span class="line">      key_len: 4</span><br><span class="line">          ref: const</span><br><span class="line">         rows: 1</span><br><span class="line">        Extra: </span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br></pre></td></tr></table></figure><h3 id="2-8-2-å¤åˆç´¢å¼•æ²¡æœ‰ä½¿ç”¨æœ€å·¦åˆ—"><a href="#2-8-2-å¤åˆç´¢å¼•æ²¡æœ‰ä½¿ç”¨æœ€å·¦åˆ—" class="headerlink" title="2.8.2 å¤åˆç´¢å¼•æ²¡æœ‰ä½¿ç”¨æœ€å·¦åˆ—"></a>2.8.2 å¤åˆç´¢å¼•æ²¡æœ‰ä½¿ç”¨æœ€å·¦åˆ—</h3><p>ä½¿ç”¨sn + name + ageåˆ›å»ºå¤åˆç´¢å¼•ï¼Œæˆ‘ä»¬å‡è®¾å®ƒä»¬çš„é¡ºåºæ˜¯ A + B + Cï¼Œä»¥ä¸‹è”åˆç´¢å¼•çš„ä½¿ç”¨æƒ…å†µå¦‚ä¸‹ï¼š</p><p><img src="https://img.musnow.top/i/2023/09/d5285b42e3341a5dda532dfdaf6fc7dc.png" alt="image"></p><p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œåªæœ‰A+B+Cæˆ–è€…A+B&#x2F;A+Cæ‰èƒ½è§¦å‘ç´¢å¼•ï¼Œè€Œä½¿ç”¨B+Cæ— æ³•è§¦å‘ç´¢å¼•ï¼Œå› ä¸ºæ²¡æœ‰ä½¿ç”¨æœ€å·¦åˆ—ï¼›</p><h3 id="2-8-3-é”™è¯¯æ¨¡ç³ŠæŸ¥è¯¢"><a href="#2-8-3-é”™è¯¯æ¨¡ç³ŠæŸ¥è¯¢" class="headerlink" title="2.8.3  é”™è¯¯æ¨¡ç³ŠæŸ¥è¯¢"></a>2.8.3  é”™è¯¯æ¨¡ç³ŠæŸ¥è¯¢</h3><p>æ¨¡ç³ŠæŸ¥è¯¢çš„æ—¶å€™ï¼Œåªæœ‰<code>å…³é”®å­—%</code>æ‰èƒ½ç”¨åˆ°ç´¢å¼•ï¼Œä½¿ç”¨<code>%å…³é”®å­—</code>æˆ–è€…<code>%å…³é”®å­—%</code>éƒ½æ˜¯æ— æ³•ä½¿ç”¨ç´¢å¼•çš„ï¼›</p><p>æµ‹è¯•è¡¨ç»“æ„å¦‚ä¸‹ï¼Œå…¶ä¸­enameæ˜¯ç”¨æˆ·åï¼Œæˆ‘ç»™ä»–æ·»åŠ äº†ä¸€ä¸ªæ™®é€šç´¢å¼•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [bit_index]&gt; desc EMP;</span><br><span class="line">+----------+--------------------------+------+-----+---------+-------+</span><br><span class="line">| Field    | Type                     | Null | Key | Default | Extra |</span><br><span class="line">+----------+--------------------------+------+-----+---------+-------+</span><br><span class="line">| empno    | int(6) unsigned zerofill | NO   | PRI | NULL    |       |</span><br><span class="line">| ename    | varchar(10)              | YES  |     | NULL    |       |</span><br><span class="line">| job      | varchar(9)               | YES  |     | NULL    |       |</span><br><span class="line">| mgr      | int(4) unsigned zerofill | YES  |     | NULL    |       |</span><br><span class="line">| hiredate | datetime                 | YES  |     | NULL    |       |</span><br><span class="line">| sal      | decimal(7,2)             | YES  |     | NULL    |       |</span><br><span class="line">| comm     | decimal(7,2)             | YES  |     | NULL    |       |</span><br><span class="line">| deptno   | int(2) unsigned zerofill | YES  |     | NULL    |       |</span><br><span class="line">+----------+--------------------------+------+-----+---------+-------+</span><br><span class="line">8 rows in set (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [bit_index]&gt; alter table EMP add index(ename);</span><br><span class="line">Query OK, 0 rows affected (11.911 sec)              </span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure><p>ç„¶åè¿›è¡Œæµ‹è¯•ã€‚æ³¨æ„çœ‹ä¸‹æ–¹3æ¬¡æŸ¥è¯¢çš„likeæ¡ä»¶åŒºåˆ«ï¼Œä»¥åŠæ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•ï¼›å¯ä»¥çœ‹åˆ°ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡ä½¿ç”¨<code>FN%</code>ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„æ—¶å€™ï¼Œæ‰ä½¿ç”¨äº†ç´¢å¼•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [bit_index]&gt; explain select * from EMP where ename like &#x27;FN%&#x27;\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: EMP</span><br><span class="line">         type: range</span><br><span class="line">possible_keys: ename</span><br><span class="line">          key: ename</span><br><span class="line">      key_len: 33</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 22000</span><br><span class="line">        Extra: Using index condition</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br><span class="line"></span><br><span class="line">MariaDB [bit_index]&gt; explain select * from EMP where ename like &#x27;%FN%&#x27;\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: EMP</span><br><span class="line">         type: ALL</span><br><span class="line">possible_keys: NULL</span><br><span class="line">          key: NULL</span><br><span class="line">      key_len: NULL</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 7968250</span><br><span class="line">        Extra: Using where</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br><span class="line"></span><br><span class="line">MariaDB [bit_index]&gt; explain select * from EMP where ename like &#x27;%FN&#x27;\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: EMP</span><br><span class="line">         type: ALL</span><br><span class="line">possible_keys: NULL</span><br><span class="line">          key: NULL</span><br><span class="line">      key_len: NULL</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 7968250</span><br><span class="line">        Extra: Using where</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br></pre></td></tr></table></figure><h3 id="2-8-4-åˆ—è¿ç®—"><a href="#2-8-4-åˆ—è¿ç®—" class="headerlink" title="2.8.4 åˆ—è¿ç®—"></a>2.8.4 åˆ—è¿ç®—</h3><p>å¦‚æœåŒ…å«ç´¢å¼•çš„åˆ—è¿›è¡Œäº†è¿ç®—ï¼Œä¹Ÿä¸ä¼šä½¿ç”¨ç´¢å¼•ï¼›</p><p>æ¯”å¦‚ä¸‹æ–¹ï¼Œç›´æ¥è¿›è¡Œ<code>id=5</code>æŸ¥è¯¢çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼Œä½†ç”¨<code>id+2=5</code>è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello_mysql]&gt; explain select * from user3 where id=5\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: user3</span><br><span class="line">         type: const</span><br><span class="line">possible_keys: PRIMARY</span><br><span class="line">          key: PRIMARY</span><br><span class="line">      key_len: 4</span><br><span class="line">          ref: const</span><br><span class="line">         rows: 1</span><br><span class="line">        Extra: </span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br><span class="line"></span><br><span class="line">MariaDB [hello_mysql]&gt; explain select * from user3 where id+2=5\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: user3</span><br><span class="line">         type: ALL</span><br><span class="line">possible_keys: NULL</span><br><span class="line">          key: NULL</span><br><span class="line">      key_len: NULL</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 8</span><br><span class="line">        Extra: Using where</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br></pre></td></tr></table></figure><h3 id="2-8-5-ä½¿ç”¨å‡½æ•°"><a href="#2-8-5-ä½¿ç”¨å‡½æ•°" class="headerlink" title="2.8.5 ä½¿ç”¨å‡½æ•°"></a>2.8.5 ä½¿ç”¨å‡½æ•°</h3><p>æŸ¥è¯¢åˆ—å¦‚æœä½¿ç”¨ä»»æ„ MySQL æä¾›çš„å‡½æ•°å°±ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œè¿™ä¸€ç‚¹çš„æƒ…å†µå’Œä¸Šä¸€ç‚¹è¿›è¡Œè¿ç®—å…¶å®æ˜¯ç±»ä¼¼çš„ï¼Œæ¯•ç«Ÿå‡½æ•°ä¹Ÿæ˜¯ä¸€ç§å†…ç½®çš„è¿ç®—ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello_mysql]&gt; explain select * from user3 where ifnull(id,0)=5\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: user3</span><br><span class="line">         type: ALL</span><br><span class="line">possible_keys: NULL</span><br><span class="line">          key: NULL</span><br><span class="line">      key_len: NULL</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 8</span><br><span class="line">        Extra: Using where</span><br><span class="line">1 row in set (0.001 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br></pre></td></tr></table></figure><h3 id="2-8-6-ç±»å‹è½¬æ¢"><a href="#2-8-6-ç±»å‹è½¬æ¢" class="headerlink" title="2.8.6 ç±»å‹è½¬æ¢"></a>2.8.6 ç±»å‹è½¬æ¢</h3><p>å½“æŸ¥è¯¢çš„æ¡ä»¶å’Œå…¶æœ¬èº«çš„æ•°æ®ç±»å‹ä¸åŒæ—¶ï¼Œä¸ä¼šè§¦å‘ç´¢å¼•ï¼›</p><p>æ¯”å¦‚ address ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œè€ŒæŸ¥è¯¢çš„æ—¶å€™è®¾ç½®äº† int ç±»å‹çš„å€¼å°±ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://img.musnow.top/i/2023/09/fb421f166c9d97c932ad6c579ea55f10.png" alt="image"></p><h3 id="2-8-7-ä½¿ç”¨is-not-null"><a href="#2-8-7-ä½¿ç”¨is-not-null" class="headerlink" title="2.8.7 ä½¿ç”¨is not null"></a>2.8.7 ä½¿ç”¨is not null</h3><p>å½“åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨äº† is not null ä¹Ÿä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œè€Œ is null åˆ™ä¼šæ­£å¸¸è§¦å‘ç´¢å¼•çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://img.musnow.top/i/2023/09/87c89678b12c5b3a0fbb33686e46c6ec.png" alt="image.png"></p><h1 id="3-ç´¢å¼•ä¼˜åŒ–"><a href="#3-ç´¢å¼•ä¼˜åŒ–" class="headerlink" title="3.ç´¢å¼•ä¼˜åŒ–"></a>3.ç´¢å¼•ä¼˜åŒ–</h1><h2 id="3-1-å…³è”æŸ¥è¯¢ä¼˜åŒ–"><a href="#3-1-å…³è”æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="3.1 å…³è”æŸ¥è¯¢ä¼˜åŒ–"></a>3.1 å…³è”æŸ¥è¯¢ä¼˜åŒ–</h2><p>ä¿è¯è¢«é©±åŠ¨è¡¨çš„JOINå­—æ®µå·²ç»åˆ›å»ºäº†ç´¢å¼•ï¼Œéœ€è¦ JOIN çš„å­—æ®µï¼Œæ•°æ®ç±»å‹ä¿æŒç»å¯¹ä¸€è‡´ã€‚</p><ul><li>LEFT JOIN æ—¶ï¼Œ<strong>é€‰æ‹©å°è¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼Œ å¤§è¡¨ä½œä¸ºè¢«é©±åŠ¨è¡¨</strong> ã€‚å‡å°‘å¤–å±‚å¾ªç¯çš„æ¬¡æ•°ã€‚</li><li>INNER JOIN æ—¶ï¼ŒMySQLä¼šè‡ªåŠ¨å°†å°ç»“æœé›†çš„è¡¨é€‰ä¸ºé©±åŠ¨è¡¨ ã€‚</li></ul><p><strong>é€‰æ‹©ç›¸ä¿¡MySQLä¼˜åŒ–ç­–ç•¥</strong>ã€‚èƒ½å¤Ÿç›´æ¥å¤šè¡¨å…³è”çš„å°½é‡ç›´æ¥å…³è”ï¼Œä¸ç”¨å­æŸ¥è¯¢ã€‚(å‡å°‘æŸ¥è¯¢çš„è¶Ÿæ•°ï¼‰</p><blockquote><p>ä¸å»ºè®®ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå»ºè®®å°†å­æŸ¥è¯¢SQLæ‹†å¼€ç»“åˆç¨‹åºå¤šæ¬¡æŸ¥è¯¢ï¼Œæˆ–ä½¿ç”¨ JOIN æ¥ä»£æ›¿å­æŸ¥è¯¢ï¼Œå‚è€ƒç¬¬äºŒç‚¹ï¼›</p></blockquote><p>å¦å¤–ï¼Œè¡ç”Ÿè¡¨å»ºä¸äº†ç´¢å¼•ã€‚è¿™ç‚¹ä¹Ÿéœ€è¦æ³¨æ„</p><h2 id="3-2-å­æŸ¥è¯¢ä¼˜åŒ–"><a href="#3-2-å­æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="3.2 å­æŸ¥è¯¢ä¼˜åŒ–"></a>3.2 å­æŸ¥è¯¢ä¼˜åŒ–</h2><p>MySQLä»4.1ç‰ˆæœ¬å¼€å§‹æ”¯æŒå­æŸ¥è¯¢ï¼Œä½¿ç”¨å­æŸ¥è¯¢å¯ä»¥è¿›è¡ŒSELECTè¯­å¥çš„åµŒå¥—æŸ¥è¯¢ï¼Œå³ä¸€ä¸ªSELECTæŸ¥è¯¢çš„ç»“æœä½œä¸ºå¦ä¸€ä¸ªSELECTè¯­å¥çš„æ¡ä»¶ã€‚ </p><p>å­æŸ¥è¯¢å¯ä»¥ä¸€æ¬¡æ€§å®Œæˆå¾ˆå¤šé€»è¾‘ä¸Šéœ€è¦å¤šä¸ªæ­¥éª¤æ‰èƒ½å®Œæˆçš„SQLæ“ä½œï¼Œå­æŸ¥è¯¢æ˜¯ MySQL çš„ä¸€é¡¹é‡è¦çš„åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ª SQL è¯­å¥å®ç°æ¯”è¾ƒå¤æ‚çš„æŸ¥è¯¢ã€‚</p><p>ä½†æ˜¯ï¼Œ<strong>å­æŸ¥è¯¢çš„æ‰§è¡Œæ•ˆç‡ä¸é«˜</strong>ã€‚åŸå› ï¼š </p><ul><li>æ‰§è¡Œå­æŸ¥è¯¢æ—¶ï¼ŒMySQLéœ€è¦ä¸ºå†…å±‚æŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢ç»“æœ å»ºç«‹ä¸€ä¸ªä¸´æ—¶è¡¨ ï¼Œç„¶åå¤–å±‚æŸ¥è¯¢è¯­å¥ä»ä¸´æ—¶è¡¨ä¸­æŸ¥è¯¢è®°å½•ã€‚æŸ¥è¯¢å®Œæ¯•åï¼Œå†æ’¤é”€è¿™äº›ä¸´æ—¶è¡¨ã€‚è¿™æ ·ä¼šæ¶ˆè€—è¿‡å¤šçš„CPUå’ŒIOèµ„æºï¼Œäº§ç”Ÿå¤§é‡çš„æ…¢æŸ¥è¯¢ã€‚ </li><li>å­æŸ¥è¯¢çš„ç»“æœé›†å­˜å‚¨çš„<strong>ä¸´æ—¶è¡¨</strong>ï¼Œä¸è®ºæ˜¯å†…å­˜ä¸´æ—¶è¡¨è¿˜æ˜¯ç£ç›˜ä¸´æ—¶è¡¨éƒ½<strong>ä¸ä¼šå­˜åœ¨ç´¢å¼•</strong> ï¼Œæ‰€ä»¥æŸ¥è¯¢æ€§èƒ½ä¼šå—åˆ°ä¸€å®šçš„å½±å“ã€‚</li><li>å¯¹äºè¿”å›ç»“æœé›†æ¯”è¾ƒå¤§çš„å­æŸ¥è¯¢ï¼Œå…¶å¯¹æŸ¥è¯¢æ€§èƒ½çš„å½±å“ä¹Ÿå°±è¶Šå¤§ã€‚ åœ¨MySQLä¸­ï¼Œå¯ä»¥ä½¿ç”¨è¿æ¥ï¼ˆJOINï¼‰æŸ¥è¯¢æ¥æ›¿ä»£å­æŸ¥è¯¢ã€‚è¿æ¥æŸ¥è¯¢ä¸éœ€è¦å»ºç«‹ä¸´æ—¶è¡¨ ï¼Œå…¶é€Ÿåº¦æ¯”å­æŸ¥è¯¢è¦å¿« ï¼Œå¦‚æœæŸ¥è¯¢ä¸­ä½¿ç”¨ç´¢å¼•çš„è¯ï¼Œæ€§èƒ½å°±ä¼šæ›´å¥½ã€‚</li></ul><p>ç»“è®ºï¼šå°½é‡ä¸è¦ä½¿ç”¨ NOT IN æˆ–è€… NOT EXISTSï¼Œç”¨<code>LEFT JOIN xxx ON xx WHERE xx IS NULL</code>æ›¿ä»£ï¼›</p><h2 id="3-3-æ’åºä¼˜åŒ–"><a href="#3-3-æ’åºä¼˜åŒ–" class="headerlink" title="3.3 æ’åºä¼˜åŒ–"></a>3.3 æ’åºä¼˜åŒ–</h2><ul><li>SQL ä¸­ï¼Œå¯ä»¥åœ¨ WHERE å­å¥å’Œ ORDER BY å­å¥ä¸­ä½¿ç”¨ç´¢å¼•ï¼Œç›®çš„æ˜¯åœ¨ WHERE å­å¥ä¸­ é¿å…å…¨è¡¨æ‰« æ ï¼Œåœ¨ ORDER BY å­å¥ é¿å…ä½¿ç”¨ FileSort æ’åº ã€‚å½“ç„¶ï¼ŒæŸäº›æƒ…å†µä¸‹å…¨è¡¨æ‰«æï¼Œæˆ–è€… FileSort æ’ åºä¸ä¸€å®šæ¯”ç´¢å¼•æ…¢ã€‚ä½†æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦é¿å…ï¼Œä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</li><li>å°½é‡ä½¿ç”¨ Index å®Œæˆ ORDER BY æ’åºã€‚å¦‚æœ WHERE å’Œ ORDER BY åé¢æ˜¯ç›¸åŒçš„åˆ—å°±ä½¿ç”¨å•ç´¢å¼•åˆ—ï¼› å¦‚æœä¸åŒå°±ä½¿ç”¨è”åˆç´¢å¼•ã€‚</li><li>æ— æ³•ä½¿ç”¨ Index æ—¶ï¼Œéœ€è¦å¯¹ FileSort æ–¹å¼è¿›è¡Œè°ƒä¼˜ã€‚</li></ul><h2 id="3-4-GROUP-BYä¼˜åŒ–"><a href="#3-4-GROUP-BYä¼˜åŒ–" class="headerlink" title="3.4 GROUP BYä¼˜åŒ–"></a>3.4 GROUP BYä¼˜åŒ–</h2><p>group byä½¿ç”¨ç´¢å¼•çš„åŸåˆ™å‡ ä¹è·Ÿ<code>order by</code>ä¸€è‡´ ï¼Œgroup byå³ä½¿æ²¡æœ‰è¿‡æ»¤æ¡ä»¶ç”¨åˆ°ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ç´¢å¼•ã€‚</p><ul><li>group by å…ˆæ’åºå†åˆ†ç»„ï¼Œéµç…§ç´¢å¼•å»ºçš„<strong>æœ€ä½³å·¦å‰ç¼€æ³•åˆ™</strong>ï¼›</li><li>å½“æ— æ³•ä½¿ç”¨ç´¢å¼•åˆ—äº‹ï¼Œå¢å¤§ <code>max_length_for_sort_data</code> å’Œ <code>sort_buffer_size</code> å‚æ•°çš„è®¾ç½®ï¼›</li><li>whereæ•ˆç‡é«˜äºhavingï¼Œèƒ½å†™åœ¨whereé™å®šçš„æ¡ä»¶å°±ä¸è¦å†™åœ¨havingä¸­äº†ï¼</li><li>å‡å°‘ä½¿ç”¨order byï¼Œå’Œä¸šåŠ¡æ²Ÿé€šèƒ½ä¸æ’åºå°±ä¸æ’åºï¼Œæˆ–å°†æ’åºæ”¾åˆ°ç¨‹åºç«¯å»åšã€‚Order byã€group byã€distinctè¿™äº›è¯­å¥è¾ƒä¸ºè€—è´¹CPUï¼Œæ•°æ®åº“çš„CPUèµ„æºæ˜¯æå…¶å®è´µçš„ã€‚</li><li>åŒ…å«äº†order byã€group byã€distinctè¿™äº›æŸ¥è¯¢çš„è¯­å¥ï¼Œwhereæ¡ä»¶è¿‡æ»¤å‡ºæ¥çš„ç»“æœé›†è¯·ä¿æŒåœ¨1000è¡Œ ä»¥å†…ï¼Œå¦åˆ™SQLä¼šå¾ˆæ…¢ã€‚</li></ul><h2 id="3-5-ç´¢å¼•è¦†ç›–"><a href="#3-5-ç´¢å¼•è¦†ç›–" class="headerlink" title="3.5 ç´¢å¼•è¦†ç›–"></a>3.5 ç´¢å¼•è¦†ç›–</h2><p>è¿™ä¸€ç‚¹åœ¨ä¸Šæ–‡çš„å›è¡¨æŸ¥æ‰¾ä¸­å·²ç»æåŠäº†ï¼Œå³ä½¿ç”¨å¤åˆç´¢å¼•ï¼Œå¹¶å°†ä½ éœ€è¦æŸ¥è¯¢çš„ç›®æ ‡å­—æ®µä»¥æœ€å·¦åŒ¹é…åŸåˆ™è®¾ç½®åˆ°å¤åˆç´¢å¼•ä¸­ï¼Œå‡å°‘å›è¡¨æ“ä½œã€‚</p><p>å½“ç„¶ï¼Œè¿™ä¾æ—§éœ€è¦éµå¾ªç´¢å¼•åˆ›å»ºçš„åŸåˆ™ï¼Œå³å¦‚æœæŸåˆ—æ•°æ®é‡å¤é‡è¿‡å¤šï¼Œåˆ™ä¸åº”è¯¥ä½œä¸ºç´¢å¼•åˆ—ï¼ˆå¦‚æœçœŸçš„éœ€è¦ï¼Œå¯ä»¥æ”¾åœ¨å¤åˆç´¢å¼•çš„æœ€åé¢ï¼Œè¿™æ ·èƒ½å‡å°‘ä»¥ä¹‹ä¸ºæŸ¥è¯¢åˆ¤æ®çš„åœºæ™¯ï¼‰</p>]]></content>
    
    
    <summary type="html">ç´¢å¼•çš„å­¦ä¹ </summary>
    
    
    
    <category term="å­¦ä¹ sql" scheme="https://blog.musnow.top/categories/%E5%AD%A6%E4%B9%A0sql/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="mysql" scheme="https://blog.musnow.top/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>ã€MySQLã€‘å¤åˆæŸ¥è¯¢ | å†…å¤–é“¾æ¥</title>
    <link href="https://blog.musnow.top/posts/2529084145/"/>
    <id>https://blog.musnow.top/posts/2529084145/</id>
    <published>2023-09-06T23:52:14.000Z</published>
    <updated>2023-09-06T23:52:30.000Z</updated>
    
    <content type="html"><![CDATA[<p>å„ç±»å¤åˆæŸ¥è¯¢å’Œç¬›å¡å°”ç§¯ã€å†…å¤–é“¾æ¥çš„æ“ä½œ</p><span id="more"></span><h1 id="1-åŸºç¡€æŸ¥è¯¢"><a href="#1-åŸºç¡€æŸ¥è¯¢" class="headerlink" title="1.åŸºç¡€æŸ¥è¯¢"></a>1.åŸºç¡€æŸ¥è¯¢</h1><p>åœ¨ä¹‹å‰çš„MySQLçš„CURDåŸºæœ¬æ“ä½œåšå®¢ä¸­ï¼Œè®²è¿°äº†ä¸€éƒ¨åˆ†æŸ¥è¯¢çš„è¯­æ³•ï¼Œä½†æ˜¯åœ¨å®é™…çš„ç”Ÿäº§æ´»åŠ¨ä¸­ï¼Œé‚£ç§æœ€åŸºç¡€çš„æŸ¥è¯¢æ–¹å¼ä¸è¶³ä»¥æ»¡è¶³å¤æ‚æŸ¥è¯¢æ¡ä»¶æ—¶çš„è¦æ±‚ï¼Œæ‰€ä»¥åœ¨æ™®é€šæŸ¥è¯¢çš„åŸºç¡€ä¸Šï¼ŒMySQLè¿˜æä¾›äº†åŠŸèƒ½æ›´å¼ºå¤§çš„å¤åˆæŸ¥è¯¢ï¼Œæœ¬æ–‡å°±è®©æˆ‘ä»¬ä¸€èµ·æ¥å­¦å­¦å¤åˆæŸ¥è¯¢çš„æ“ä½œå§ï¼</p><blockquote><p>ä¾æ—§æ˜¯ä½¿ç”¨scottæä¾›çš„è¿™å¼ è¡¨ï¼Œæ¥è¿›è¡Œå¤åˆæŸ¥è¯¢çš„æ“ä½œã€‚</p></blockquote><p>åœ¨é‚£ä¹‹å‰ï¼Œå…ˆå¤ä¹ ä¸€ä¸‹æ™®é€šæŸ¥è¯¢çš„åŸºæœ¬æ“ä½œå§ï¼</p><ul><li>æŸ¥è¯¢å·¥èµ„é«˜äº500æˆ–è€…å²—ä½ä¸ºMANAGERçš„æˆå‘˜ï¼ŒåŒæ—¶ä»–ä»¬çš„å§“åé¦–å­—æ¯ä¸ºå¤§å†™J</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> (sal <span class="operator">&gt;</span> <span class="number">500</span> <span class="keyword">or</span> job <span class="operator">=</span> <span class="string">&#x27;MANAGER&#x27;</span>) <span class="keyword">and</span> ename <span class="keyword">like</span> <span class="string">&#x27;J%&#x27;</span>;</span><br></pre></td></tr></table></figure><ul><li>æŒ‰ç…§éƒ¨é—¨å·å‡åºã€é›‡å‘˜çš„å·¥èµ„é™åºæ’åº</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> deptno, sal <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure><ul><li>æ˜¾ç¤ºå·¥èµ„é«˜äºå¹³å‡å·¥èµ„çš„å‘˜å·¥ä¿¡æ¯</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&gt;</span> (<span class="keyword">select</span> <span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp);</span><br></pre></td></tr></table></figure><ul><li>æ˜¾ç¤ºæ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„å’Œæœ€é«˜å·¥èµ„</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> deptno, <span class="built_in">avg</span>(sal), <span class="built_in">max</span>(sal) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno;</span><br></pre></td></tr></table></figure><ul><li>æ˜¾ç¤ºæ¯ç§å²—ä½çš„é›‡å‘˜æ•°é‡å’Œå¹³å‡å·¥èµ„</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> job,<span class="built_in">count</span>(<span class="operator">*</span>),<span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> job;</span><br><span class="line"><span class="comment">-- é»˜è®¤æƒ…å†µä¸‹ä¼šä¿ç•™6ä½å°æ•°ï¼Œå¯ä»¥ç”¨formatå‡½æ•°ä¿ç•™åˆ°2ä½</span></span><br><span class="line"><span class="keyword">select</span> job,<span class="built_in">count</span>(<span class="operator">*</span>),format(<span class="built_in">avg</span>(sal),<span class="number">2</span>) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> job;</span><br><span class="line"><span class="comment">-- æ ¼å¼åŒ–åçš„è¾“å‡ºç»“æœå¦‚ä¸‹</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+----------+--------------------+</span></span><br><span class="line"><span class="operator">|</span> job       <span class="operator">|</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="operator">|</span> format(<span class="built_in">avg</span>(sal),<span class="number">2</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+----------+--------------------+</span></span><br><span class="line"><span class="operator">|</span> ANALYST   <span class="operator">|</span>        <span class="number">2</span> <span class="operator">|</span> <span class="number">3</span>,<span class="number">000.00</span>           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> CLERK     <span class="operator">|</span>        <span class="number">4</span> <span class="operator">|</span> <span class="number">1</span>,<span class="number">037.50</span>           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MANAGER   <span class="operator">|</span>        <span class="number">3</span> <span class="operator">|</span> <span class="number">2</span>,<span class="number">758.33</span>           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> PRESIDENT <span class="operator">|</span>        <span class="number">1</span> <span class="operator">|</span> <span class="number">5</span>,<span class="number">000.00</span>           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> SALESMAN  <span class="operator">|</span>        <span class="number">4</span> <span class="operator">|</span> <span class="number">1</span>,<span class="number">400.00</span>           <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+----------+--------------------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.000</span> sec)</span><br></pre></td></tr></table></figure><h1 id="2-å¤šè¡¨æŸ¥è¯¢"><a href="#2-å¤šè¡¨æŸ¥è¯¢" class="headerlink" title="2.å¤šè¡¨æŸ¥è¯¢"></a>2.å¤šè¡¨æŸ¥è¯¢</h1><p>åŸºç¡€æŸ¥è¯¢çš„æ“ä½œå°±å¤ä¹ ä¸Šé¢å‡ ä¸ªå°±å·®ä¸å¤šäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å…ˆçœ‹å¤åˆæŸ¥è¯¢çš„ç¬¬ä¸€ä¸ªå¤§ç‚¹ï¼Œå¤šè¡¨æŸ¥è¯¢ã€‚</p><p>æ‰€è°“å¤šè¡¨æŸ¥è¯¢ï¼Œå°±æ˜¯å°†ä¸€ä¸ªè¡¨å’Œå¦å¤–ä¸€ä¸ªè¡¨åˆå¹¶ï¼Œå†åœ¨è¿™ä¸ªåˆå¹¶äº†ä¹‹åçš„è¡¨é‡Œé¢è¿›è¡ŒæŸ¥è¯¢ï¼›</p><ul><li>æ¯”å¦‚ï¼šæ˜¾ç¤ºé›‡å‘˜åã€é›‡å‘˜å·¥èµ„ä»¥åŠæ‰€åœ¨éƒ¨é—¨çš„åå­—</li></ul><p>å› ä¸ºé›‡å‘˜åæ˜¯åœ¨empè¡¨é‡Œé¢ï¼Œéƒ¨é—¨åå­—æ˜¯åœ¨deptè¡¨é‡Œé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦è¿›è¡Œå¤šè¡¨çš„è”åˆæŸ¥è¯¢æ‰èƒ½ä¸€æ¬¡å–åˆ°ç»“æœï¼ˆä¸€æ¬¡æŸ¥è¯¢çš„æ•ˆç‡ä¼˜äºä¸¤æ¬¡ç‹¬ç«‹æŸ¥è¯¢ï¼‰</p><p>å…¶åŸºæœ¬è¯­å¥å°±æ˜¯åœ¨fromåé¢æ·»åŠ å¤šä¸ªè¡¨ï¼Œå¹¶ä½¿ç”¨<code>è¡¨å.è¡¨ä¸­å­—æ®µå</code>æ¥æŒ‡å®šæŸä¸€ä¸ªè¡¨ä¸­çš„å­—æ®µï¼›å¦‚æœè¿™ä¸ªå­—æ®µåªæœ‰ä¸€ä¸ªè¡¨ä¸­æœ‰ï¼Œé‚£å°±å¯ä»¥ä¸ç”¨æŒ‡å®šè¡¨åï¼ˆä½†ä¾æ—§å»ºè®®æŒ‡å®šè¡¨åé¿å…å‡ºé”™ï¼‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> è¡¨<span class="number">1</span>,è¡¨<span class="number">2</span>,...;</span><br></pre></td></tr></table></figure><h2 id="2-1-ç¬›å¡å°”ç§¯"><a href="#2-1-ç¬›å¡å°”ç§¯" class="headerlink" title="2.1 ç¬›å¡å°”ç§¯"></a>2.1 ç¬›å¡å°”ç§¯</h2><p>å…ˆæ¥ä¸€ä¸ªå…¨åˆ—æŸ¥è¯¢ï¼Œçœ‹çœ‹æ•ˆæœ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp,dept;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œdeptè¡¨ç›´æ¥æ‹¼æ¥åœ¨äº†empè¡¨ä¹‹åï¼Œè€Œä¸”empè¡¨ä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½è¢«æ ¹æ®deptä¸­ä¸åŒçš„éƒ¨é—¨IDé‡å¤äº†4æ¬¡ã€‚è¿™æ˜¯å› ä¸ºåœ¨MySQLä¸­ï¼Œä»–å¹¶ä¸çŸ¥é“ä½ éœ€è¦ä»€ä¹ˆæ•°æ®ï¼Œæ‰€ä»¥è¿›è¡Œæ•°æ®æ‹¼æ¥çš„æ—¶å€™ï¼Œæ˜¯é‡‡ç”¨ç©·ä¸¾çš„æ–¹å¼æ¥æ‹¼æ¥çš„ï¼</p><p>è¿™ä¸ªä¸åŠ ä»»ä½•è¿‡æ»¤æ¡ä»¶ï¼Œç©·ä¸¾æ‹¼æ¥å¾—åˆ°çš„ç»“æœè¢«ç§°ä¸º<code>ç¬›å¡å°”ç§¯</code>ï¼</p><p><img src="https://img.musnow.top/i/2023/09/3ab44ca912fdd37336acec9da9271b4e.png" alt="image-20230908082727650"></p><h2 id="2-2-æŒ‡å®šæ¡ä»¶"><a href="#2-2-æŒ‡å®šæ¡ä»¶" class="headerlink" title="2.2 æŒ‡å®šæ¡ä»¶"></a>2.2 æŒ‡å®šæ¡ä»¶</h2><p>æ¥ä¸‹æ¥å†å›åˆ°ä¸Šé¢æåˆ°çš„é—®é¢˜ï¼šæ˜¾ç¤ºé›‡å‘˜åã€é›‡å‘˜å·¥èµ„ä»¥åŠæ‰€åœ¨éƒ¨é—¨çš„åå­—ï¼›</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> emp.ename,emp.sal,dept.dname <span class="keyword">from</span> emp,dept;</span><br></pre></td></tr></table></figure><p>è™½ç„¶æˆ‘ä»¬é€‰ä¸­äº†æˆ‘ä»¬éœ€è¦çš„åˆ—æ¥æ˜¾ç¤ºï¼Œä½†ä¾æ—§æ²¡æœ‰è§£å†³ç¬›å¡å°”ç§¯ä¸­ç©·ä¸¾å‡ºæ¥çš„æ— æ•ˆæ•°æ®ï¼›</p><p><img src="https://img.musnow.top/i/2023/09/962f9b4daf49a81d8a0c1a5cedcff9ba.png" alt="image-20230908083214029"></p><p>è¿™æ—¶å€™å°±éœ€è¦æ·»åŠ ä¸Šç­›é€‰æ¡ä»¶ï¼Œæ¥å‰”é™¤æ‰æ— æ•ˆçš„æ•°æ®ã€‚</p><p>å’Œå½“å‰å‘˜å·¥çš„éƒ¨é—¨ç¼–å·ä¸åŒçš„éƒ¨é—¨æ•°æ®å°±æ˜¯æ— æ•ˆçš„ï¼Œæˆ‘ä»¬æ·»åŠ ä¸Šå‘˜å·¥éƒ¨é—¨ç¼–å·å’Œéƒ¨é—¨è¡¨ä¸­çš„éƒ¨é—¨ç¼–å·ç›¸åŒçš„æ¡ä»¶ï¼Œå°±å¯ä»¥å‰”é™¤æ‰æ— æ•ˆçš„æ•°æ®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> emp.ename,emp.sal,dept.dname <span class="keyword">from</span> emp,dept <span class="keyword">where</span> emp.deptno <span class="operator">=</span> dept.deptno;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™ç­›é€‰å‡ºæ¥çš„æ•°æ®ï¼Œæ‰æ˜¯æ­£ç¡®çš„æ¯ä¸ªå‘˜å·¥å’Œå…¶å¯¹åº”çš„éƒ¨é—¨åå­—çš„æ•°æ®ï¼›æ¯ä¸ªå‘˜å·¥ä¹Ÿä¸åœ¨ä¼šé‡å¤4æ¬¡äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [scott]&gt; select emp.ename,emp.sal,dept.dname from emp,dept where emp.deptno = dept.deptno;</span><br><span class="line">+--------+---------+------------+</span><br><span class="line">| ename  | sal     | dname      |</span><br><span class="line">+--------+---------+------------+</span><br><span class="line">| SMITH  |  800.00 | RESEARCH   |</span><br><span class="line">| ALLEN  | 1600.00 | SALES      |</span><br><span class="line">| WARD   | 1250.00 | SALES      |</span><br><span class="line">| JONES  | 2975.00 | RESEARCH   |</span><br><span class="line">| MARTIN | 1250.00 | SALES      |</span><br><span class="line">| BLAKE  | 2850.00 | SALES      |</span><br><span class="line">| CLARK  | 2450.00 | ACCOUNTING |</span><br><span class="line">| SCOTT  | 3000.00 | RESEARCH   |</span><br><span class="line">| KING   | 5000.00 | ACCOUNTING |</span><br><span class="line">| TURNER | 1500.00 | SALES      |</span><br><span class="line">| ADAMS  | 1100.00 | RESEARCH   |</span><br><span class="line">| JAMES  |  950.00 | SALES      |</span><br><span class="line">| FORD   | 3000.00 | RESEARCH   |</span><br><span class="line">| MILLER | 1300.00 | ACCOUNTING |</span><br><span class="line">+--------+---------+------------+</span><br><span class="line">14 rows in set (0.004 sec)</span><br></pre></td></tr></table></figure><p>å†æ¥åšä¸¤ä¸ªå°ç»ƒä¹ </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ˜¾ç¤ºéƒ¨é—¨å·ä¸º10çš„éƒ¨é—¨åå­—ï¼Œå‘˜å·¥åå­—å’Œå‘˜å·¥å·¥èµ„ï¼›</span></span><br><span class="line">MariaDB [scott]<span class="operator">&gt;</span> <span class="keyword">select</span> emp.ename,emp.sal,dept.dname <span class="keyword">from</span> emp,dept <span class="keyword">where</span> emp.deptno <span class="operator">=</span> dept.deptno <span class="keyword">and</span> dept.deptno <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------+---------+------------+</span></span><br><span class="line"><span class="operator">|</span> ename  <span class="operator">|</span> sal     <span class="operator">|</span> dname      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+---------+------------+</span></span><br><span class="line"><span class="operator">|</span> CLARK  <span class="operator">|</span> <span class="number">2450.00</span> <span class="operator">|</span> ACCOUNTING <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> KING   <span class="operator">|</span> <span class="number">5000.00</span> <span class="operator">|</span> ACCOUNTING <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MILLER <span class="operator">|</span> <span class="number">1300.00</span> <span class="operator">|</span> ACCOUNTING <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+---------+------------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.001</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ˜¾ç¤ºå„ä¸ªéƒ¨é—¨å‘˜å·¥çš„å§“åï¼Œå·¥èµ„ï¼Œå·¥èµ„çº§åˆ«</span></span><br><span class="line">MariaDB [scott]<span class="operator">&gt;</span> <span class="keyword">select</span> emp.ename,emp.sal,salgrade.grade <span class="keyword">from</span> emp,salgrade <span class="keyword">where</span> emp.sal <span class="keyword">between</span> losal <span class="keyword">and</span> hisal;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> ename  <span class="operator">|</span> sal     <span class="operator">|</span> grade <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> SMITH  <span class="operator">|</span>  <span class="number">800.00</span> <span class="operator">|</span>     <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> ALLEN  <span class="operator">|</span> <span class="number">1600.00</span> <span class="operator">|</span>     <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> WARD   <span class="operator">|</span> <span class="number">1250.00</span> <span class="operator">|</span>     <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> JONES  <span class="operator">|</span> <span class="number">2975.00</span> <span class="operator">|</span>     <span class="number">4</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARTIN <span class="operator">|</span> <span class="number">1250.00</span> <span class="operator">|</span>     <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> BLAKE  <span class="operator">|</span> <span class="number">2850.00</span> <span class="operator">|</span>     <span class="number">4</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> CLARK  <span class="operator">|</span> <span class="number">2450.00</span> <span class="operator">|</span>     <span class="number">4</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> SCOTT  <span class="operator">|</span> <span class="number">3000.00</span> <span class="operator">|</span>     <span class="number">4</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> KING   <span class="operator">|</span> <span class="number">5000.00</span> <span class="operator">|</span>     <span class="number">5</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> TURNER <span class="operator">|</span> <span class="number">1500.00</span> <span class="operator">|</span>     <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> ADAMS  <span class="operator">|</span> <span class="number">1100.00</span> <span class="operator">|</span>     <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> JAMES  <span class="operator">|</span>  <span class="number">950.00</span> <span class="operator">|</span>     <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> FORD   <span class="operator">|</span> <span class="number">3000.00</span> <span class="operator">|</span>     <span class="number">4</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MILLER <span class="operator">|</span> <span class="number">1300.00</span> <span class="operator">|</span>     <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+---------+-------+</span></span><br><span class="line"><span class="number">14</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.001</span> sec)</span><br></pre></td></tr></table></figure><h1 id="3-è‡ªé“¾æ¥"><a href="#3-è‡ªé“¾æ¥" class="headerlink" title="3.è‡ªé“¾æ¥"></a>3.è‡ªé“¾æ¥</h1><p>æ‰€è°“è‡ªè¿æ¥ï¼Œæ˜¯åœ¨åŒä¸€å¼ è¡¨ä¸­è¿›è¡Œé“¾æ¥å’ŒæŸ¥è¯¢</p><p>æ¯”å¦‚æ˜¾ç¤ºå‘˜å·¥FORDä¸Šçº§é¢†å¯¼çš„å‘˜å·¥ç¼–å·å’Œå§“å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä½¿ç”¨å­æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">select</span> empno,ename <span class="keyword">from</span> emp <span class="keyword">where</span> emp.empno<span class="operator">=</span>(<span class="keyword">select</span> mgr <span class="keyword">from</span> emp <span class="keyword">where</span></span><br><span class="line">ename<span class="operator">=</span><span class="string">&#x27;FORD&#x27;</span>);</span><br><span class="line"><span class="comment">-- ä½¿ç”¨å¤šè¡¨æŸ¥è¯¢ï¼ˆå…¶å®æ˜¯ç»™empè¡¨èµ·ä¸¤ä¸ªä¸åŒçš„åˆ«åï¼‰</span></span><br><span class="line"><span class="keyword">select</span> leader.empno,leader.ename <span class="keyword">from</span> emp leader, emp worker <span class="keyword">where</span></span><br><span class="line">leader.empno <span class="operator">=</span> worker.mgr <span class="keyword">and</span> worker.ename<span class="operator">=</span><span class="string">&#x27;FORD&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è¿™ç§åœ¨ä¸€å¼ è¡¨é‡Œé¢è¿›è¡Œç¬›å¡å„¿ç§¯çš„æŸ¥è¯¢æ“ä½œï¼Œå°±å«åšè‡ªé“¾æ¥ã€‚æœ€ç»ˆéƒ½å¯ä»¥è·å–åˆ°æ­£ç¡®ç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+--------+-------+</span><br><span class="line">| empno  | ename |</span><br><span class="line">+--------+-------+</span><br><span class="line">| 007566 | JONES |</span><br><span class="line">+--------+-------+</span><br><span class="line">1 row in set (0.001 sec)</span><br></pre></td></tr></table></figure><h1 id="4-å­æŸ¥è¯¢"><a href="#4-å­æŸ¥è¯¢" class="headerlink" title="4.å­æŸ¥è¯¢"></a>4.å­æŸ¥è¯¢</h1><p>å­æŸ¥è¯¢å€¼å¾—æ˜¯ï¼Œå°†ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ä½œä¸ºå­æ“ä½œï¼ŒåµŒå…¥åˆ°ä¸€ä¸ªsqlè¯­å¥ä¸­ï¼›</p><p>æˆ‘ä»¬å¯ä»¥æŠŠå­æŸ¥è¯¢çš„ç»“æœä¹Ÿå½“ä½œæ˜¯ä¸€å¼ è¡¨æ¥è¿›è¡Œå¤„ç†ï¼Œè¿™æ ·ä¸€æƒ³å°±èƒ½ç†è§£å­æŸ¥è¯¢æ˜¯æ€ä¹ˆç©çš„äº†ã€‚</p><h2 id="4-1-å•è¡Œå­æŸ¥è¯¢"><a href="#4-1-å•è¡Œå­æŸ¥è¯¢" class="headerlink" title="4.1 å•è¡Œå­æŸ¥è¯¢"></a>4.1 å•è¡Œå­æŸ¥è¯¢</h2><p>æ˜¾ç¤ºå’ŒSMITHåŒä¸€ä¸ªéƒ¨é—¨çš„å‘˜å·¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> deptno <span class="operator">=</span> (<span class="keyword">select</span> deptno <span class="keyword">from</span> emp <span class="keyword">where</span> ename<span class="operator">=</span><span class="string">&#x27;smith&#x27;</span>);</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªæŸ¥è¯¢ä¸­ï¼Œå­æŸ¥è¯¢è¯­å¥æ˜¯<code>(select deptno from emp where ename=&#39;smith&#39;)</code>ï¼Œè¿™ä¸ªè¯­å¥è¿”å›çš„ç»“æœåªæœ‰ä¸€è¡Œï¼Œæ‰€ä»¥è¢«ç§°ä¸ºå•è¡Œå­æŸ¥è¯¢ï¼›</p><h2 id="4-2-å¤šè¡Œå­æŸ¥è¯¢"><a href="#4-2-å¤šè¡Œå­æŸ¥è¯¢" class="headerlink" title="4.2 å¤šè¡Œå­æŸ¥è¯¢"></a>4.2 å¤šè¡Œå­æŸ¥è¯¢</h2><p>æœ‰å•è¡ŒæŸ¥è¯¢ï¼Œè‡ªç„¶ä¹Ÿæœ‰å¤šè¡ŒæŸ¥è¯¢ã€‚ä½†æ˜¯å¦‚æœä¸€ä¸ªè¯­å¥è¿”å›äº†å¤šæ¡ç»“æœï¼Œå°†å…¶ç›´æ¥ä½œä¸ºåˆ¤æ®è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œè¿™ä¼šå¯¼è‡´åˆ¤æ®ä¸å”¯ä¸€ï¼ŒMySQLä¸çŸ¥é“ä½ åˆ°åº•æƒ³è¦æ¯”è¾ƒçš„æ˜¯é‚£ä¸€éƒ¨åˆ†çš„æ•°æ®ã€‚è¿™æ—¶å€™å°±éœ€è¦ç”¨ä¸‹é¢å‡ ä¸ªå…³é”®å­—æ¥å¸®å¿™äº†</p><ul><li>inï¼šæŸ¥è¯¢å­˜åœ¨äºæŸæŸç»“æœé‡Œé¢çš„æ•°æ®</li><li>allï¼šæŸ¥è¯¢æ¯”è¿™ä¸ªç»“æœä¸­æ‰€æœ‰å€¼éƒ½å¤§&#x2F;å°çš„æ•°æ®</li><li>anyï¼šæŸ¥è¯¢æ¯”è¿™ä¸ªç»“æœä¸­æŸä¸€ä¸ªå€¼å¤§&#x2F;å°çš„æ•°æ®</li></ul><p>ä»¥ä¸‹æ˜¯å‡ ä¸ªç¤ºä¾‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢å’Œ10å·éƒ¨é—¨å·¥ä½œå²—ä½ç›¸åŒçš„å‘˜å·¥åå­—ã€å²—ä½ã€å·¥èµ„ã€éƒ¨é—¨å·ï¼Œä½†æ˜¯ä¸åŒ…å«10å·éƒ¨é—¨è‡ªå·±çš„å‘˜å·¥</span></span><br><span class="line"><span class="keyword">select</span> ename,job,sal,deptno <span class="keyword">from</span> emp <span class="keyword">where</span> job <span class="keyword">in</span> (<span class="keyword">select</span> job <span class="keyword">from</span> emp <span class="keyword">where</span> deptno<span class="operator">=</span><span class="number">10</span>) <span class="keyword">and</span> deptno <span class="operator">&lt;&gt;</span> <span class="number">10</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+---------+---------+--------+</span></span><br><span class="line"><span class="operator">|</span> ename <span class="operator">|</span> job     <span class="operator">|</span> sal     <span class="operator">|</span> deptno <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+---------+---------+--------+</span></span><br><span class="line"><span class="operator">|</span> SMITH <span class="operator">|</span> CLERK   <span class="operator">|</span>  <span class="number">800.00</span> <span class="operator">|</span>     <span class="number">20</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> JONES <span class="operator">|</span> MANAGER <span class="operator">|</span> <span class="number">2975.00</span> <span class="operator">|</span>     <span class="number">20</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> BLAKE <span class="operator">|</span> MANAGER <span class="operator">|</span> <span class="number">2850.00</span> <span class="operator">|</span>     <span class="number">30</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> ADAMS <span class="operator">|</span> CLERK   <span class="operator">|</span> <span class="number">1100.00</span> <span class="operator">|</span>     <span class="number">20</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> JAMES <span class="operator">|</span> CLERK   <span class="operator">|</span>  <span class="number">950.00</span> <span class="operator">|</span>     <span class="number">30</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+---------+---------+--------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.001</span> sec)</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ˜¾ç¤ºéƒ¨é—¨å·¥èµ„æ¯”30å·éƒ¨é—¨æ‰€æœ‰å‘˜å·¥å·¥èµ„éƒ½é«˜çš„å‘˜å·¥å§“åã€å·¥èµ„ã€éƒ¨é—¨å·</span></span><br><span class="line"><span class="keyword">select</span> ename,sal,deptno <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&gt;</span> <span class="keyword">all</span>(<span class="keyword">select</span> sal <span class="keyword">from</span> emp <span class="keyword">where</span> deptno <span class="operator">=</span> <span class="number">30</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+---------+--------+</span></span><br><span class="line"><span class="operator">|</span> ename <span class="operator">|</span> sal     <span class="operator">|</span> deptno <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+---------+--------+</span></span><br><span class="line"><span class="operator">|</span> JONES <span class="operator">|</span> <span class="number">2975.00</span> <span class="operator">|</span>     <span class="number">20</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> SCOTT <span class="operator">|</span> <span class="number">3000.00</span> <span class="operator">|</span>     <span class="number">20</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> KING  <span class="operator">|</span> <span class="number">5000.00</span> <span class="operator">|</span>     <span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> FORD  <span class="operator">|</span> <span class="number">3000.00</span> <span class="operator">|</span>     <span class="number">20</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+---------+--------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.001</span> sec)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å„ç±»å¤åˆæŸ¥è¯¢å’Œç¬›å¡å°”ç§¯ã€å†…å¤–é“¾æ¥çš„æ“ä½œ</summary>
    
    
    
    <category term="å­¦ä¹ sql" scheme="https://blog.musnow.top/categories/%E5%AD%A6%E4%B9%A0sql/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="mysql" scheme="https://blog.musnow.top/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>ã€Linuxã€‘rootå’Œå­ç”¨æˆ·éƒ½èƒ½æ‰§è¡Œçš„å‘½ä»¤ï¼Œsudoæ— æ³•æ‰§è¡Œï¼ˆå·²è§£å†³ï¼‰</title>
    <link href="https://blog.musnow.top/posts/2473452644/"/>
    <id>https://blog.musnow.top/posts/2473452644/</id>
    <published>2023-09-01T10:12:55.000Z</published>
    <updated>2023-09-01T10:12:55.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å…¨æµç¨‹å¸–å­ <a href="https://ask.oceanbase.com/t/topic/35604437/7">https://ask.oceanbase.com/t/topic/35604437/7</a></p></blockquote><h1 id="1-é—®é¢˜"><a href="#1-é—®é¢˜" class="headerlink" title="1.é—®é¢˜"></a>1.é—®é¢˜</h1><p>å¦‚é¢˜ï¼Œåœ¨ç¼–è¯‘miniobçš„æ—¶å€™é‡åˆ°å¦‚ä¸‹é”™è¯¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[mu@vm-cnt8:~/code/miniob]$ sudo bash build.sh init</span><br><span class="line">build.sh init</span><br><span class="line">HEAD is now at 5df3037d Merge branch <span class="string">&#x27;release-2.1.12-stable-pull&#x27;</span> into patches-2.1</span><br><span class="line">build.sh: line 83: cmake: <span class="built_in">command</span> not found</span><br><span class="line">build.sh: line 91: cmake: <span class="built_in">command</span> not found</span><br><span class="line">build.sh: line 99: cmake: <span class="built_in">command</span> not found</span><br><span class="line">build.sh: line 107: cmake: <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure><p>æ ¹æ®å­—é¢æ„æ€ï¼Œæ˜¯cmakeå‘½ä»¤æ‰¾ä¸åˆ°ï¼Œä½†æ˜¯æˆ‘çš„ç³»ç»Ÿé‡Œé¢å·²ç»æœ‰äº†ç¬¦åˆæ¡ä»¶çš„ç¯å¢ƒï¼›ä»¥ä¸‹æ˜¯gihub&#x2F;miniobä»“åº“ä¸­docsé‡Œé¢<code>how_to_build.md</code>çš„å†…å®¹</p><blockquote><p>MiniOB éœ€è¦ä½¿ç”¨ï¼š</p><ul><li>cmake ç‰ˆæœ¬ &gt;&#x3D; 3.13</li><li>gcc&#x2F;clang gccå»ºè®®8.3ä»¥ä¸Šï¼Œç¼–è¯‘å™¨éœ€è¦æ”¯æŒc++20æ–°æ ‡å‡†</li><li>flex (2.5+), bison (3.7+) ç”¨äºç”Ÿæˆè¯æ³•è¯­æ³•åˆ†æä»£ç </li></ul></blockquote><p>æˆ‘ä½¿ç”¨çš„ç³»ç»Ÿæ˜¯centos8-steamçš„vmwareè™šæ‹Ÿæœºï¼›å½“å‰ä½¿ç”¨çš„miniobçš„commitä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">76221e46e66ef408771ce886aa0c586a09374b0d</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯æˆ‘çš„ç³»ç»Ÿä¸­å„ä¸ªä¾èµ–é¡¹çš„ç‰ˆæœ¬å·ï¼Œå¯ä»¥çœ‹åˆ°åœ¨å­ç”¨æˆ·ä¸­ï¼Œä¾èµ–é¡¹çš„æ‰€æœ‰å‘½ä»¤éƒ½å¯ä»¥æ­£å¸¸æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[mu@vm-cnt8:~/code/miniob]$ gcc --version</span><br><span class="line">gcc (GCC) 8.5.0 20210514 (Red Hat 8.5.0-20)</span><br><span class="line">Copyright (C) 2018 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the <span class="built_in">source</span> <span class="keyword">for</span> copying conditions.  There is NO</span><br><span class="line">warranty; not even <span class="keyword">for</span> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br><span class="line"></span><br><span class="line">[mu@vm-cnt8:~/code/miniob]$ cmake --version</span><br><span class="line">cmake version 3.27.4</span><br><span class="line"></span><br><span class="line">CMake suite maintained and supported by Kitware (kitware.com/cmake).</span><br><span class="line">[mu@vm-cnt8:~/code/miniob]$ flex --version</span><br><span class="line">flex 2.6.1</span><br><span class="line">[mu@vm-cnt8:~/code/miniob]$ bison --version</span><br><span class="line">bison (GNU Bison) 3.8</span><br><span class="line">Written by Robert Corbett and Richard Stallman.</span><br><span class="line"></span><br><span class="line">Copyright (C) 2021 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the <span class="built_in">source</span> <span class="keyword">for</span> copying conditions.  There is NO</span><br><span class="line">warranty; not even <span class="keyword">for</span> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br></pre></td></tr></table></figure><p>åœ¨rootä¸­ï¼Œä¹Ÿå¯ä»¥æ­£å¸¸æ‰§è¡Œè¿™äº›å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@vm-cnt8:~]# cmake --version</span><br><span class="line">cmake version 3.27.4</span><br><span class="line"></span><br><span class="line">CMake suite maintained and supported by Kitware (kitware.com/cmake).</span><br><span class="line">[root@vm-cnt8:~]# flex --version</span><br><span class="line">flex 2.6.1</span><br><span class="line">[root@vm-cnt8:~]# bison --version</span><br><span class="line">bison (GNU Bison) 3.8</span><br><span class="line">Written by Robert Corbett and Richard Stallman.</span><br><span class="line"></span><br><span class="line">Copyright (C) 2021 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the source for copying conditions.  There is NO</span><br><span class="line">warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯sudoæ‰§è¡Œminiobçš„å®‰è£…è„šæœ¬çš„æ—¶å€™ï¼Œå´æ‰¾ä¸åˆ°cmakeå‘½ä»¤</p><h1 id="2-debugè¿‡ç¨‹"><a href="#2-debugè¿‡ç¨‹" class="headerlink" title="2.debugè¿‡ç¨‹"></a>2.debugè¿‡ç¨‹</h1><p>ç»è¿‡å¤§ä½¬çš„æ•™å­¦ï¼ŒçŸ¥é“äº†ä¸€ä¸ªæ–°çš„sudoç”¨æ³•ï¼š<code>sudo -E</code></p><blockquote><p><code>sudo -E</code> æ˜¯ç»§æ‰¿å½“å‰ç”¨æˆ·çš„ç¯å¢ƒå˜é‡è¿è¡Œsudoåé¢çš„å‘½ä»¤ï¼Œå¦åˆ™ç¯å¢ƒå˜é‡ä¼šè¢«æ¸…ç†æ‰ï¼›</p></blockquote><p>ä½†æ˜¯åœ¨åˆæ¬¡ä½¿ç”¨çš„æ—¶å€™ï¼Œä¾æ—§æ— æ³•æˆåŠŸç¼–è¯‘miniobï¼Œä¹Ÿæ‰¾ä¸åˆ°cmakeå‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[mu@vm-cnt8:~/code/miniob]$ sudo -E bash build.sh init</span><br><span class="line">[sudo] password for mu: </span><br><span class="line">build.sh init</span><br><span class="line">HEAD is now at 5df3037d Merge branch &#x27;release-2.1.12-stable-pull&#x27; into patches-2.1</span><br><span class="line">build.sh: line 83: cmake: command not found</span><br><span class="line">build.sh: line 91: cmake: command not found</span><br><span class="line">build.sh: line 99: cmake: command not found</span><br><span class="line">build.sh: line 107: cmake: command not found</span><br><span class="line"></span><br><span class="line">[mu@vm-cnt8:~]$ sudo -E cmake --version</span><br><span class="line">[sudo] password for mu: </span><br><span class="line">sudo: cmake: command not found</span><br></pre></td></tr></table></figure><h1 id="3-æœ€ç»ˆè§£å†³ï¼šPATHç¯å¢ƒå˜é‡"><a href="#3-æœ€ç»ˆè§£å†³ï¼šPATHç¯å¢ƒå˜é‡" class="headerlink" title="3.æœ€ç»ˆè§£å†³ï¼šPATHç¯å¢ƒå˜é‡"></a>3.æœ€ç»ˆè§£å†³ï¼šPATHç¯å¢ƒå˜é‡</h1><p>æœ€ç»ˆçš„è§£å†³åŠæ³•æ˜¯æˆ‘è‡ªå·±æƒ³å‡ºæ¥çš„ï¼ˆå¤§ä½¬ä¹Ÿå›å¤äº†æˆ‘è¿™ä¸ªè§£å†³æ–¹æ¡ˆï¼‰</p><p>å½“å‰åœ¨å­ç”¨æˆ·ä½¿ç”¨ <code>sudo -E</code>æ˜¯æ‰¾ä¸åˆ°cmakeå‘½ä»¤çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[mu@vm-cnt8:~]$ sudo -E cmake --version</span><br><span class="line">[sudo] password for mu: </span><br><span class="line">sudo: cmake: command not found</span><br></pre></td></tr></table></figure><p>æˆ‘çš„ç³»ç»Ÿé‡Œé¢çš„PATHç¯å¢ƒå˜é‡å¦‚ä¸‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mu@vm-cnt8:~]$ sudo <span class="built_in">env</span> | grep PATH</span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin</span><br></pre></td></tr></table></figure><p>è€Œcmakeçš„è·¯å¾„å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[mu@vm-cnt8:~]$ type cmake</span><br><span class="line">cmake is /usr/local/bin/cmake</span><br><span class="line">[mu@vm-cnt8:~]$ whereis cmake</span><br><span class="line">cmake: /usr/local/bin/cmake /usr/share/cmake</span><br></pre></td></tr></table></figure><p>æœ‰æ²¡æœ‰å¯èƒ½ï¼Œæ˜¯å› ä¸ºcmakeä¸åœ¨PATHç¯å¢ƒå˜é‡é‡Œé¢ï¼Œå¯¼è‡´sudoçš„æ—¶å€™æ‰¾ä¸åˆ°å‘½ä»¤å‘¢ï¼Ÿè™½ç„¶åœ¨rootå’Œmuç”¨æˆ·ä¸‹éƒ½å¯ä»¥ç›´æ¥æ‰§è¡Œcmakeã€‚</p><p>äºæ˜¯æˆ‘å°±å»rooté‡Œé¢æ‰§è¡Œäº†ä¸€ä¸‹è½¯è¿æ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@vm-cnt8:~]# ls /usr/bin | grep cmake</span><br><span class="line">[root@vm-cnt8:~]# ln -s /usr/local/bin/cmake /usr/bin/cmake</span><br><span class="line">[root@vm-cnt8:~]# ll /usr/bin | grep cmake</span><br><span class="line">lrwxrwxrwx. 1 root root          20 Sep  1 05:57 cmake -&gt; /usr/local/bin/cmake</span><br></pre></td></tr></table></figure><p>å†æ¥è¯•è¯•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo -E cmake --version</span><br><span class="line">cmake version 3.27.4</span><br><span class="line"></span><br><span class="line">CMake suite maintained and supported by Kitware (kitware.com/cmake).</span><br></pre></td></tr></table></figure><p>æœ€åå†æ¥è¯•è¯•ç¼–è¯‘ï¼Œåº”è¯¥æ˜¯OKäº†ï¼ŒinitæˆåŠŸæ‰§è¡Œï¼Œç¼–è¯‘ä¹Ÿé€šè¿‡äº†ï¼Œæ²¡æœ‰æŠ¥é”™</p><p><img src="https://img.musnow.top/i/2023/09/7e206210ba3f9ffa5df6a492ae7b457a.png" alt="image-20230901181050840"></p><p>æ„Ÿè°¢miniobç¤¾åŒºå¤§ä½¬ä»¬çš„å¸®åŠ©ï¼</p><h1 id="4-ç»“è®º"><a href="#4-ç»“è®º" class="headerlink" title="4.ç»“è®º"></a>4.ç»“è®º</h1><p>å¦‚æœå‡ºç°ä¸€ä¸ªå‘½ä»¤ï¼Œrootå’Œå­ç”¨æˆ·éƒ½å¯ä»¥æ‰§è¡Œï¼Œä½†æ˜¯å­ç”¨æˆ·ä¸­sudoå´æ‰¾ä¸åˆ°æ­¤å‘½ä»¤ï¼Œå¯ä»¥å°è¯•æ£€æŸ¥ä¸€ä¸‹è¯¥å‘½ä»¤æ‰€åœ¨è·¯å¾„æ˜¯å¦ä¸å½“å‰ç³»ç»Ÿçš„PATHç¯å¢ƒå˜é‡ä¸ç¬¦åˆï¼</p>]]></content>
    
    
    <summary type="html">rootå’Œå­ç”¨æˆ·éƒ½èƒ½æ‰§è¡Œçš„å‘½ä»¤ï¼Œsudoå´æ— æ³•æ‰§è¡Œï¼Œå¦‚ä½•è§£å†³ï¼Ÿ</summary>
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ã€winã€‘Windowsä¸‹MSI Afterburnerå¦‚ä½•è®©å…¶ä¸åœ¨æŸä¸ªè½¯ä»¶ä¸­æ˜¾ç¤ºå¸§æ•°</title>
    <link href="https://blog.musnow.top/posts/4160666395/"/>
    <id>https://blog.musnow.top/posts/4160666395/</id>
    <published>2023-08-31T13:44:31.000Z</published>
    <updated>2023-08-31T13:44:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>Windowsä¸‹MSI Afterburnerå¦‚ä½•è®©å…¶ä¸åœ¨æŸä¸ªè½¯ä»¶ä¸­æ˜¾ç¤ºå¸§æ•°</p><span id="more"></span><h1 id="1-é—®é¢˜è¯´æ˜"><a href="#1-é—®é¢˜è¯´æ˜" class="headerlink" title="1.é—®é¢˜è¯´æ˜"></a>1.é—®é¢˜è¯´æ˜</h1><p>æ€»æ‰€å‘¨çŸ¥ï¼Œ<code>MSI Afterburner</code>è¿™ä¸ªè½¯ä»¶å¯ä»¥åœ¨æ¸¸æˆé‡Œé¢å±•ç¤ºä½ å½“å‰ç”µè„‘çš„å„é¡¹ç”Ÿå‘½ä½“å¾ï¼ŒåŒ…æ‹¬GPU&#x2F;CPUåŠŸè€—é¢‘ç‡æ¸©åº¦ï¼Œå†…å­˜å ç”¨ï¼Œå½“å‰å¸§æ•°ç­‰ç­‰æ•°æ®ï¼Œä¸ç®¡æ˜¯ç”¨æ¥ç›‘çœ‹ç”µè„‘è¿è¡Œæ˜¯å¦æ­£å¸¸ï¼Œè¿˜æ˜¯ç”¨æ¥å°è¶…ä¸€ä¸‹æ˜¾å¡ï¼Œéƒ½æ˜¯å¾ˆå¥½ç”¨çš„ä¸œè¥¿ï¼Œå†åŠ ä¸Šæ¯«æ— å¹¿å‘Š+å…è´¹ï¼Œå‡ ä¹æ˜¯äººæ‰‹å¿…å¤‡çš„PCè‰¯è¯</p><p><img src="https://img.musnow.top/i/2023/08/22a440a97052d98344faa1679af7e4a1.png" alt="image-20230831211541651"></p><p>ä½†æ€»æœ‰æ—¶å€™è¿™ä¸ªè½¯ä»¶ä¼šæŠ½é£ï¼Œæ¯”å¦‚æˆ‘çš„ç”µè„‘é‡Œé¢ï¼Œæœ€æ–°ç‰ˆæœ¬çš„è¿™ä¸ªè½¯ä»¶ï¼Œå°±ä¼šæŠŠç…§ç‰‡è«åå…¶å¦™çš„ä¹Ÿè¯†åˆ«æˆäº†ä¸€ä¸ªæ¸¸æˆï¼Œåœ¨é‡Œé¢æ˜¾ç¤ºå¸§æ•°ï¼Œæœ€ç¦»è°±çš„æ˜¯ï¼Œæœ€ä¸‹æ–¹çš„é¢„è§ˆå…¶ä»–å›¾ç‰‡çš„å°æ¡†æ¡†é‡Œé¢ï¼Œä¹Ÿç»™ä½ æ˜¾ç¤ºäº†å¸§æ•°</p><p><img src="https://img.musnow.top/i/2023/08/33033ee6b815fd496aefff2db7b41983.png" alt="image-20230831211739693"></p><p>è¿™è‚¯å®šå¾ˆæ¼ç«ï¼Œæˆ‘ä»¬è¦æ€ä¹ˆæ ·æ‰èƒ½è®©ä»–ä¸åœ¨è¿™é‡Œé¢æ˜¾ç¤ºå‘¢ï¼Ÿ</p><h1 id="2-é…ç½®"><a href="#2-é…ç½®" class="headerlink" title="2.é…ç½®"></a>2.é…ç½®</h1><p>å’Œ<code>MSI Afterburner</code>æ†ç»‘ä¸‹è½½çš„æœ‰è¿™ä¹ˆä¸€ä¸ªè½¯ä»¶ï¼Œå…¶å®å®ƒæ‰æ˜¯è´Ÿè´£å°†æ•°æ®æŠ•å±åˆ°ä½ çš„å±å¹•ä¸Šçš„è½¯ä»¶ï¼Œåœ¨è¿™é‡Œé¢ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¾ç½®åœ¨æŸä¸ªè½¯ä»¶ä¸­ä¸æ˜¾ç¤ºå¸§æ•°</p><p><img src="https://img.musnow.top/i/2023/08/38ddd77df81cad02c8ac53f0834550f8.png" alt="image-20230831212031500"></p><p>å¯¹äºæ­£å¸¸å®‰è£…çš„è½¯ä»¶ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æ‰¾åˆ°è½¯ä»¶çš„å®‰è£…è·¯å¾„ï¼Œé€‰ä¸­å®ƒçš„exeå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå†è®¾ç½®ä¸€ä¸‹æŠŠå¸§æ•°å™¨å…³é—­ï¼Œå°±å¯ä»¥é¿å…é”™è¯¯åœ°æ˜¾ç¤ºå¸§æ•°å½±å“è½¯ä»¶è‡ªèº«çš„ä½¿ç”¨</p><p><img src="https://img.musnow.top/i/2023/08/952d106d45b52990e2bd63ae4ddc5534.png" alt="image-20230831212050181"></p><p>ä½†æ˜¯windowsè‡ªå¸¦çš„ç›¸å†Œå°±æœ‰ç‚¹æ¼ç«äº†ï¼Œ<strong>æˆ‘ä»¬å‹æ ¹ä¸çŸ¥é“å®ƒçš„å¯æ‰§è¡Œæ–‡ä»¶åœ¨å“ªé‡Œ</strong>ï¼</p><h1 id="3-windowsç³»ç»Ÿåº”ç”¨çš„å¯æ‰§è¡Œæ–‡ä»¶"><a href="#3-windowsç³»ç»Ÿåº”ç”¨çš„å¯æ‰§è¡Œæ–‡ä»¶" class="headerlink" title="3.windowsç³»ç»Ÿåº”ç”¨çš„å¯æ‰§è¡Œæ–‡ä»¶"></a>3.windowsç³»ç»Ÿåº”ç”¨çš„å¯æ‰§è¡Œæ–‡ä»¶</h1><p>windowsç»å¤§éƒ¨åˆ†çš„ç³»ç»Ÿè‡ªå¸¦è½¯ä»¶éƒ½åœ¨è¿™é‡Œé¢ï¼Œä½ éœ€è¦æ‰“å¼€æ˜¾ç¤ºéšè—æ–‡ä»¶å¤¹æ‰èƒ½çœ‹åˆ°æ­¤æ–‡ä»¶å¤¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\WindowsApps\</span><br></pre></td></tr></table></figure><p>è€Œ<a href="https://zhidao.baidu.com/question/1550787637804576787.html">ç…§ç‰‡è½¯ä»¶è·¯å¾„</a>å¦‚ä¸‹ï¼ˆæˆ‘çš„win11ç‰ˆæœ¬æ˜¯<code>22H2 22621.963</code>ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\WindowsApps\Microsoft.Windows.Photos_2023.11080.4003.0_x64__8wekyb3d8bbwe</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢æœ‰ä¸€ä¸ª<code>PhotosApp.exe</code>ï¼Œå°±æ˜¯windowsè‡ªå¸¦ç…§ç‰‡çš„å¯æ‰§è¡Œæ–‡ä»¶äº†ï¼›</p><p>ä½†æ˜¯ï¼ä½ ä¼šå‘ç°ä½ å‹æ ¹æ²¡æœ‰ <code>C:\Program Files\WindowsApps\</code>è¿™ä¸ªæ–‡ä»¶å¤¹çš„è¿›å…¥æƒé™ï¼Œæ›´åˆ«ææ‰¾åˆ°è¿™ä¸ªç…§ç‰‡è½¯ä»¶çš„exeäº†ï¼</p><p>ç™¾åº¦äº†ä¸€ä¸‹ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªæ•™ç¨‹ <a href="https://www.bkqs.com.cn/content/kn928o443.html">Win10ä¸‹WindowsAppsæƒé™æ€ä¹ˆè·å–</a>ï¼›é¡ºå¸¦ä¸€æï¼Œä¸ºäº†é¿å…åŸæ–‡å¤±æ•ˆï¼Œè¿™ç¯‡æ–‡ç« ä¹Ÿè½¬è½½åˆ°äº†æœ¬ç«™ã€‚</p><blockquote><p>æ³¨æ„ï¼æ¯•ç«Ÿè¿™ç®—æ˜¯ç³»ç»Ÿåº•å±‚æ–‡ä»¶å¤¹äº†ï¼Œæˆ‘ä¸ç¡®å®šè¿™æ ·ä¿®æ”¹æ–‡ä»¶å¤¹æƒé™æ˜¯å¦ä¼šå‡ºç°é—®é¢˜ï¼å¦‚æœä½ æ‹…å¿ƒå‡ºç°é—®é¢˜ï¼Œ<strong>è¯·ä¸è¦æ“ä½œ</strong>ï¼Œåœ¨ä¸æ‰“æ¸¸æˆçš„æ—¶å€™ä¸è¦å¯åŠ¨MSI Afterbuneræ˜¯æ›´å¥½çš„é€‰æ‹©ï¼</p><p>å¦‚æœå‡ºç°é—®é¢˜ï¼Œå‚è€ƒ ã€<a href="https://blog.csdn.net/oh_futrue/article/details/91042020">WindowsApps æƒé™é—®é¢˜å¯¼è‡´Microsoft StoreåŠå…¶ä¸‹è½½çš„åº”ç”¨ä¸èƒ½å¯åŠ¨ï¼ˆé—ªé€€ï¼‰çš„è§£å†³åŠæ³•</a>ã€‘ å¤åŸæƒé™ï¼å®åœ¨ä¸è¡Œå°±ææ€•è¦é‡è£…ç³»ç»Ÿäº† ğŸ¤£</p><p><img src="https://img.musnow.top/i/2023/08/91c5e537eee80c51f1e2788b15a7d997.png" alt="image-20230831214242664"></p><p>ç›®å‰æˆ‘è¿™è¾¹è¿˜ä¹ˆæœ‰å‡ºç°å¼‚å¸¸æƒ…å†µï¼Œæ¯•ç«Ÿæˆ‘ä¿®æ”¹ä¸ºäº†<code>everyone</code>ç†è®ºä¸Šæ¥è¯´æ˜¯å¹¶ä¸ä¼šå‡ºç°æƒé™ä¸å¤Ÿè€Œå¯¼è‡´æŸä¸ªç¨‹åºæ— æ³•æ‰§è¡Œçš„é—®é¢˜çš„</p></blockquote><p>æ ¹æ®æ•™ç¨‹é‡Œé¢çš„æ­¥éª¤ä¸€æ­¥ä¸€æ­¥æ¥ï¼Œå°±å¯ä»¥è·å–åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹çš„è¿›å…¥æƒé™</p><p><img src="https://img.musnow.top/i/2023/08/f35c62ab02b889383a3f88a3b9700629.png" alt="image-20230831212801573"></p><h1 id="4-ç¦ç”¨ç…§ç‰‡ä¸­çš„å¸§æ•°æ˜¾ç¤º"><a href="#4-ç¦ç”¨ç…§ç‰‡ä¸­çš„å¸§æ•°æ˜¾ç¤º" class="headerlink" title="4.ç¦ç”¨ç…§ç‰‡ä¸­çš„å¸§æ•°æ˜¾ç¤º"></a>4.ç¦ç”¨ç…§ç‰‡ä¸­çš„å¸§æ•°æ˜¾ç¤º</h1><p>æ‰¾åˆ°è¿™ä¸ª<code>PhotosApp.exe</code>ä¹‹åï¼Œåœ¨<code>RivaTuner</code>è¿™ä¸ªè½¯ä»¶é‡Œé¢é€‰ä¸­è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå°†å…¶çš„displayå…³é—­</p><p><img src="https://img.musnow.top/i/2023/08/b98f245a377bbfe1369b7cb9809fc9a5.png" alt="image-20230831212557862"></p><p>å¥½äº†ï¼Œè¿™ä¸‹æ²¡æœ‰èƒ¡ä¹±æ˜¾ç¤ºå¸§æ•°äº†ï¼</p><p><img src="https://img.musnow.top/i/2023/08/d0f3baad38aec23619141b8cf92b6292.png" alt="image-20230831212631268"></p>]]></content>
    
    
    <summary type="html">Windowsä¸‹MSI Afterburnerå¦‚ä½•è®©å…¶ä¸åœ¨æŸä¸ªè½¯ä»¶ä¸­æ˜¾ç¤ºå¸§æ•°</summary>
    
    
    
    <category term="ç”µè„‘ä½¿ç”¨å°è´´å£«" scheme="https://blog.musnow.top/categories/%E7%94%B5%E8%84%91%E4%BD%BF%E7%94%A8%E5%B0%8F%E8%B4%B4%E5%A3%AB/"/>
    
    
    <category term="windows" scheme="https://blog.musnow.top/tags/windows/"/>
    
  </entry>
  
  <entry>
    <title>ã€winã€‘Windowsä¸‹Cç›˜é‡Œé¢çš„WindowsAppsæ–‡ä»¶å¤¹æƒé™æ€ä¹ˆè·å–</title>
    <link href="https://blog.musnow.top/posts/3712817486/"/>
    <id>https://blog.musnow.top/posts/3712817486/</id>
    <published>2023-08-31T13:34:31.000Z</published>
    <updated>2023-08-31T13:34:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>é¿å…åŸæ–‡å¤±æ•ˆï¼Œè½¬è½½æ­¤æ–‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åŸæ–‡ https://www.bkqs.com.cn/content/kn928o443.html</span><br></pre></td></tr></table></figure><h1 id="Winä¸‹WindowsAppsæƒé™æ€ä¹ˆè·å–"><a href="#Winä¸‹WindowsAppsæƒé™æ€ä¹ˆè·å–" class="headerlink" title="Winä¸‹WindowsAppsæƒé™æ€ä¹ˆè·å–"></a>Winä¸‹WindowsAppsæƒé™æ€ä¹ˆè·å–</h1><p><code>2023-01-31 14:32:17</code></p><p>Win10ä¸‹WindowsAppsæƒé™æ€ä¹ˆè·å–ï¼ŸWindowsAppså®‰è£…çš„æ˜¯Windowsåº”ç”¨å•†åº—çš„åº”ç”¨ç¨‹åºï¼Œè®¿é—®æ­¤æ–‡ä»¶å¤¹éœ€è¦è·å–æƒé™æ‰èƒ½è¿›å…¥ã€‚å…·ä½“æ€ä¹ˆè®¾ç½®å‘¢ï¼Ÿä¸€èµ·æ¥äº†è§£ä¸‹å§ï¼</p><p><img src="https://img.musnow.top/i/2023/08/df83e62f3e53e132acb209f09a797b6f.png"></p><h2 id="æ“ä½œæ–¹æ³•"><a href="#æ“ä½œæ–¹æ³•" class="headerlink" title="æ“ä½œæ–¹æ³•"></a>æ“ä½œæ–¹æ³•</h2><ul><li><p>01</p><p>1ã€åœ¨è®¡ç®—æœºä¸­ï¼Œæ‰“å¼€æ­¤ç”µè„‘ã€‚ç‚¹å‡»æŸ¥çœ‹é€‰é¡¹ï¼Œå¹¶å‹¾é€‰é€‰é¡¹æ¡†ä¸­çš„â€œéšè—çš„é¡¹ç›®â€ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/ac1473123b0f35d32f01b7539023fb51.png"></p></li><li><p>02</p><p>2ã€åœ¨æ­¤ç”µè„‘çª—å£ä¸­ï¼Œæ‰¾åˆ°ç³»ç»Ÿç›˜ä¸‹çš„â€œWindowsAppsâ€ï¼ˆéšè—çš„æ–‡ä»¶å¤¹ï¼‰ï¼Œå…·ä½“è·¯å¾„ä¸ºâ€œC:\Program Files\WindowsAppsâ€ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/9a1d5608930d12c04e4303e3b923a747.png"></p></li><li><p>03</p><p>3ã€é€‰ä¸­WindowsAppsæ–‡ä»¶å¤¹ï¼Œå¹¶ç‚¹å‡»é¼ æ ‡å³é”®ï¼Œåœ¨å¼¹å‡ºçš„é€‰é¡¹æ¡†ä¸­ç‚¹å‡»â€œå±æ€§â€é€‰é¡¹ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/32e95c80075f35fb9004e63797b1f1d7.png"></p></li><li><p>04</p><p>4ã€ç‚¹å‡»å±æ€§é€‰é¡¹åï¼Œè¿™ä¸ªæ—¶å€™ä¼šæ‰“å¼€â€œWindowsAppså±æ€§â€å¯¹è¯æ¡†ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/5ede94735ea0e66cb1115012e795b0df.png"></p></li><li><p>05</p><p>5ã€åœ¨WindowsAppså±æ€§å¯¹è¯æ¡†ä¸­ï¼Œåˆ‡æ¢åˆ°â€œå®‰å…¨â€é€‰é¡¹å¡ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/b92921c8b6547e8a81e68752e96c830f.png"></p></li><li><p>06</p><p>6ã€åœ¨å®‰å…¨é€‰é¡¹å¡ä¸‹ï¼Œçœ‹åˆ°æç¤ºâ€œå¿…é¡»å…·æœ‰è¯»å–æƒé™æ‰èƒ½æŸ¥çœ‹å¯¹è±¡å±æ€§â€ï¼Œå¹¶ç‚¹å‡»â€œé«˜çº§â€é€‰é¡¹æŒ‰é’®ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/a13b0247ca7b99c1793189336e492c85.png"></p></li><li><p>07</p><p>7ã€ç‚¹å‡»é«˜çº§é€‰é¡¹åï¼Œè¿™ä¸ªæ—¶å€™ä¼šæ‰“å¼€â€œWindowsAppsçš„é«˜çº§å®‰å…¨è®¾ç½®â€å¯¹è¯çª—å£ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/434d13327223687c0ae808b9e5bd0226.png"></p></li><li><p>08</p><p>8ã€åœ¨WindowsAppsçš„é«˜çº§å®‰å…¨è®¾ç½®å¯¹è¯çª—å£ä¸­ï¼Œç‚¹å‡»æ‰€æœ‰è€…åçš„â€œæ›´æ”¹â€æŒ‰é’®ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/c7060a1aacb894d0ea904202291e9267.png"></p></li><li><p>09</p><p>9ã€ç‚¹å‡»æ›´æ”¹åï¼Œè¿™ä¸ªæ—¶å€™ä¼šæ‰“å¼€â€œé€‰æ‹©ç”¨æˆ·æˆ–ç»„â€å¯¹è¯æ¡†ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/9b02a003b59c4ce73a72690fc414c038.png"></p></li><li><p>10</p><p>10ã€åœ¨è¾“å…¥è¦é€‰æ‹©çš„å¯¹è±¡åç§°è¾“å…¥æ¡†ä¸­ï¼Œè¾“å…¥â€œEveryoneâ€ï¼Œå¹¶ç‚¹å‡»â€œç¡®å®šâ€æŒ‰é’®ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/fa792f7c20c081c4079f02f6734e2e8d.png"></p></li><li><p>11</p><p>11ã€ç‚¹å‡»ç¡®å®šåï¼Œè¿™ä¸ªæ—¶å€™ä¼šè·³è½¬åˆ°WindowsAppsçš„é«˜çº§å®‰å…¨è®¾ç½®å¯¹è¯çª—å£ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/f132cedbea9f1c6677375c0661e68994.png"></p></li><li><p>12</p><p>12ã€æ¥ç€å‹¾é€‰æ‰€æœ‰è€…ä¸‹çš„â€œæ›¿æ¢å­å®¹å™¨å’Œå¯¹è±¡çš„æ‰€æœ‰è€…â€ï¼Œå¹¶ç‚¹å‡»â€œç¡®å®šâ€æŒ‰é’®ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/bf8f5bb96b5daa6290850574d2258bb7.png"></p></li><li><p>13</p><p>13ã€ç‚¹å‡»ç¡®å®šåï¼Œè¿™ä¸ªæ—¶å€™ä¼šå¼¹å‡ºWindowså®‰å…¨å¯¹è¯æ¡†ï¼Œè¿›è¡Œæ›´æ”¹æ‰€æœ‰æƒã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/74051d49c0138f62d250c588acb0eaa4.png"></p></li><li><p>14</p><p>14ã€æ›´æ”¹æ‰€æœ‰æƒå®Œæˆåï¼Œè¿™ä¸ªæ—¶å€™å°±èƒ½æ­£å¸¸è®¿é—®â€œWindowsAppsâ€æ–‡ä»¶å¤¹äº†ã€‚å¦‚å›¾æ‰€ç¤ºï¼›</p><p><img src="https://img.musnow.top/i/2023/08/c523ded7262708fbef624c1c742997f8.png"></p></li></ul>]]></content>
    
    
    <summary type="html">Winä¸‹Cç›˜é‡Œé¢çš„WindowsAppsæƒé™æ€ä¹ˆè·å–</summary>
    
    
    
    <category term="ç”µè„‘ä½¿ç”¨å°è´´å£«" scheme="https://blog.musnow.top/categories/%E7%94%B5%E8%84%91%E4%BD%BF%E7%94%A8%E5%B0%8F%E8%B4%B4%E5%A3%AB/"/>
    
    
    <category term="windows" scheme="https://blog.musnow.top/tags/windows/"/>
    
  </entry>
  
  <entry>
    <title>ã€Linuxã€‘centos8å®‰è£…bison3.8</title>
    <link href="https://blog.musnow.top/posts/1067381808/"/>
    <id>https://blog.musnow.top/posts/1067381808/</id>
    <published>2023-08-30T10:31:55.000Z</published>
    <updated>2023-08-30T10:31:55.000Z</updated>
    
    <content type="html"><![CDATA[<p>centos8å®‰è£…<code>bison3.8</code>çš„æ•™ç¨‹ï¼Œæ„Ÿè§‰è¿™ä¸ªè½¯ä»¶åŒ…å¾ˆ<code>å°ä¼—</code>å•Šï¼Œç™¾åº¦æ‰¾ä¸åˆ°å®‰è£…æ•™ç¨‹ï¼Œæœ€ç»ˆè¿˜æ˜¯åœ¨èµ·è„šæ—®æ—¯é‡Œé¢ç¿»å‡ºæ¥äº†å¾ˆä¹…ä¹‹å‰çš„æ–‡æ¡£ï¼Œå¥½åœ¨æ²¡æœ‰è¿‡æ—¶ï¼›</p><span id="more"></span><blockquote><p><a href="https://linux.cn/lfs/LFS-BOOK-7.7-systemd/chapter06/bison.html">https://linux.cn/lfs/LFS-BOOK-7.7-systemd/chapter06/bison.html</a></p></blockquote><p><img src="https://img.musnow.top/i/2023/09/db6be01dbd28cd3371fdf8e5d657b968.png" alt="image-20230901215525821"></p><p>è™½ç„¶centos8ä¸­ä½ å¯ä»¥ä½¿ç”¨yumç›´æ¥å®‰è£…ï¼Œä½†æ˜¯å“ªä¸ªå®‰è£…çš„ç‰ˆæœ¬å¤ªä½äº†ï¼Œè¾¾ä¸åˆ°å¦‚ä»Šçš„éœ€æ±‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y bison</span><br></pre></td></tr></table></figure><p>æˆ‘è¿™è¾¹ç›´æ¥ç”¨yumå®‰è£…çš„æ˜¯<code>3.0.4</code>çš„ç‰ˆæœ¬ï¼Œå·²ç»æ˜¯2015å¹´çš„ä¸œè¥¿äº†ï¼Œæœ€æ–°çš„ç‰ˆæœ¬å·²ç»åˆ°3.8äº†ï¼Œè€Œä¸”æˆ‘æ­£åœ¨ä½¿ç”¨çš„æ–°é¡¹ç›®miniobå°±è¦æ±‚æ›´é«˜çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥è€ç‰ˆæœ¬è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bison (GNU Bison) 3.0.4</span><br><span class="line">Written by Robert Corbett and Richard Stallman.</span><br><span class="line"></span><br><span class="line">Copyright (C) 2015 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the source for copying conditions.  There is NO</span><br><span class="line">warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br></pre></td></tr></table></figure><p>å…ˆç”¨yumæŠŠå®‰è£…å¥½äº†çš„åˆ æ‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum remove bison</span><br></pre></td></tr></table></figure><blockquote><p>æˆ‘çœ‹æœ‰çš„æ–‡ç« è¯´éœ€è¦å…ˆå®‰è£…å‰ç½®ä¾èµ–é¡¹<code>flex</code>ï¼Œè¿™é‡Œå¸¦ä¸Šå§ã€‚å› ä¸ºæˆ‘çš„ç³»ç»Ÿé‡Œé¢ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™å°±å·²ç»å®‰è£…å¥½äº†è¿™ä¸ªä¸œè¥¿äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install flex</span><br></pre></td></tr></table></figure></blockquote><p>å»å®˜ç½‘ <a href="http://ftp.gnu.org/gnu/bison/">http://ftp.gnu.org/gnu/bison/</a> ä¸‹è½½æœ€æ–°çš„å‹ç¼©åŒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.gnu.org/gnu/bison/bison-3.8.tar.gz</span><br></pre></td></tr></table></figure><p>è§£å‹å¹¶è¿›å…¥æ–‡ä»¶å¤¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf bison-3.8.tar.gz</span><br><span class="line">cd bison-3.8</span><br></pre></td></tr></table></figure><p>é…ç½®å®‰è£…è·¯å¾„ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨äº†<code>/usr/local</code>è¿™ä¸ªç›®å½•ï¼Œå¦‚æœä½ æŸ¥çœ‹è¿‡å®‰è£…åçš„bisonï¼Œä½ ä¼šå‘ç°å®ƒçš„å®‰è£…åŒ…çš„é€»è¾‘æ˜¯å’Œ<code>/usr/local</code>ç›®å½•ä¸€è‡´çš„ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¿®æ”¹æˆä½ è‡ªå·±æƒ³è¦çš„ç›®å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ls /usr/local/</span><br><span class="line">bin  doc  etc  games  include  lib  lib64  libexec  openssl-1.1.1  sbin  share  src</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é…ç½®å®‰è£…è·¯å¾„ä¸º<code>/usr/local</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure -prefix=/usr/local/</span><br></pre></td></tr></table></figure><p>ç›®å½•é…ç½®å¥½äº†ä¹‹åï¼Œmakeå®‰è£…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make install</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœè¦å¸è½½ï¼Œç”¨<code>make uninstall</code></p></blockquote><p>å®‰è£…å¥½äº†ä¹‹åæ‰§è¡Œ<code>bison --version</code>ï¼Œä½ ä¼šå¾—åˆ°å¦‚ä¸‹è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-bash: /usr/bin/bison: No such file or directory</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨<code>/usr/local</code>é‡Œé¢å®‰è£…çš„ä¸œè¥¿æ²¡æœ‰åœ¨pathä¸­ï¼Œæ²¡æœ‰åŠæ³•ç›´æ¥æ‰§è¡Œï¼Œéœ€è¦æˆ‘ä»¬å°†å…¶è½¯é“¾æ¥åˆ°<code>/usr/bin</code>é‡Œé¢ï¼›</p><p>å¦‚æœä½ çš„å®‰è£…æ­£ç¡®äº†ï¼Œåº”è¯¥å¯ä»¥åœ¨<code>/usr/local/bin</code>é‡Œé¢æ‰¾åˆ°<code>bison</code>; å¦‚æœä½ å®‰è£…çš„è·¯å¾„ä¸åŒï¼Œé‚£å°±å»ä½ å®‰è£…è·¯å¾„ä¸‹æ‰¾<code>bison</code>çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼›</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls /usr/local/bin</span></span><br><span class="line">2to3-3.10  bison  cmake  cpack  ctest  docker-compose  idle3.10  pip3.10  pydoc3.10  python3.10  python3.10-config  yacc</span><br></pre></td></tr></table></figure><p>å°†å…¶è½¯è¿æ¥ä¸€ä¸‹å°±okäº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ln -s /usr/local/bin/bison /usr/bin/bison</span></span><br><span class="line"><span class="comment"># ls /usr/bin/bison</span></span><br><span class="line">/usr/bin/bison</span><br></pre></td></tr></table></figure><p>å†æ¬¡æ£€æŸ¥ç‰ˆæœ¬ï¼Œå®‰è£…<code>3.8</code>æˆåŠŸï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># bison --version</span><br><span class="line">bison (GNU Bison) 3.8</span><br><span class="line">Written by Robert Corbett and Richard Stallman.</span><br><span class="line"></span><br><span class="line">Copyright (C) 2021 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the source for copying conditions.  There is NO</span><br><span class="line">warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;centos8å®‰è£…&lt;code&gt;bison3.8&lt;/code&gt;çš„æ•™ç¨‹ï¼Œæ„Ÿè§‰è¿™ä¸ªè½¯ä»¶åŒ…å¾ˆ&lt;code&gt;å°ä¼—&lt;/code&gt;å•Šï¼Œç™¾åº¦æ‰¾ä¸åˆ°å®‰è£…æ•™ç¨‹ï¼Œæœ€ç»ˆè¿˜æ˜¯åœ¨èµ·è„šæ—®æ—¯é‡Œé¢ç¿»å‡ºæ¥äº†å¾ˆä¹…ä¹‹å‰çš„æ–‡æ¡£ï¼Œå¥½åœ¨æ²¡æœ‰è¿‡æ—¶ï¼›&lt;/p&gt;</summary>
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ã€Linuxã€‘centos8å®‰è£…cmake3.27.4</title>
    <link href="https://blog.musnow.top/posts/343476194/"/>
    <id>https://blog.musnow.top/posts/343476194/</id>
    <published>2023-08-30T10:30:55.000Z</published>
    <updated>2023-08-30T10:30:55.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç¬¬ä¸€æ­¥ï¼Œå»<a href="https://cmake.org/download/">å®˜ç½‘</a>ä¸‹å®‰è£…åŒ…ï¼Œä¸€å®šä¸è¦ä¸‹é”™äº†</p><p><img src="https://img.musnow.top/i/2023/08/a7b64c50664a8d69fb805fcbb17edcbe.png" alt="image-20230830175242958"></p><p>ä¸‹å¥½äº†ä¹‹åï¼Œç”¨ftpè½¯ä»¶ä¼ åˆ°äº‘æœåŠ¡å™¨æˆ–è€…è™šæ‹Ÿæœºä¸Šï¼Œä¹Ÿå¯ä»¥ç”¨wgetç›´æ¥ä¸‹è½½</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/Kitware/CMake/releases/download/v3.27.4/cmake-3.27.4.tar.gz</span><br></pre></td></tr></table></figure><p>æˆ‘ç”¨çš„æ˜¯centos8ç³»ç»Ÿï¼Œå®‰è£…ä¹‹å‰å…ˆå‡†å¤‡å¥½è¿™äº›ä¾èµ–é¡¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y gcc gcc-c++ make automake</span><br><span class="line">yum install -y openssl  openssl-devel</span><br></pre></td></tr></table></figure><p>æŠŠä¸‹è½½å¥½çš„å®‰è£…åŒ…ä¼ ä¸Šå»åï¼Œè§£å‹ï¼ˆåœ¨rootç”¨æˆ·ä¸‹æ“ä½œï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf cmake-3.27.4.tar.gz </span><br></pre></td></tr></table></figure><p>è§£å‹å®Œæ¯•åè¿›å…¥æ–‡ä»¶å¤¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd cmake-3.27.4</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bootstrap</span><br></pre></td></tr></table></figure><p>è€å¿ƒç­‰å€™å®Œæˆåï¼Œä¾æ¬¡è¿è¡Œä¸‹é¢ä¸¤ä¸ªå‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gmake</span><br><span class="line">gmake install</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆåˆ¤æ–­æ˜¯å¦å®‰è£…æˆåŠŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake --version</span><br></pre></td></tr></table></figure><p>å‡ºç°å¦‚ä¸‹ä¿¡æ¯å°±æ˜¯æå®šäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># cmake --version</span><br><span class="line">cmake version 3.27.4</span><br><span class="line"></span><br><span class="line">CMake suite maintained and supported by Kitware (kitware.com/cmake).</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ç¬¬ä¸€æ­¥ï¼Œå»&lt;a href=&quot;https://cmake.org/download/&quot;&gt;å®˜ç½‘&lt;/a&gt;ä¸‹å®‰è£…åŒ…ï¼Œä¸€å®šä¸è¦ä¸‹é”™äº†&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img.musnow.top/i/2023/08/a7b64c50664a8d69fb805fcbb</summary>
      
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ã€C++ã€‘C++14çš„é‚£äº›æ–°ç‰¹æ€§</title>
    <link href="https://blog.musnow.top/posts/1184922698/"/>
    <id>https://blog.musnow.top/posts/1184922698/</id>
    <published>2023-08-28T14:40:46.000Z</published>
    <updated>2023-08-28T14:40:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ C++14çš„é‚£äº›æ–°ç‰¹æ€§</p><span id="more"></span><p><img src="https://img.musnow.top/i/2023/08/0061de987afa3c3003cbfa4762397ac5.png" alt="v2-642fda8762a7dcda4556e14c8ff5c1ef_1440w"></p><p>ä¸ºäº†æ–¹ä¾¿æŒ‡å®šä½¿ç”¨C++14æ¥ç¼–è¯‘ä»£ç ï¼Œæœ¬æ–‡çš„æµ‹è¯•éƒ½æ˜¯åœ¨linuxä¸‹è¿›è¡Œçš„ï¼Œg++ç‰ˆæœ¬å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ g++ --version</span><br><span class="line">g++ (GCC) 8.5.0 20210514 (Red Hat 8.5.0-4)</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ å’Œæˆ‘ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä½¿ç”¨VSCæ¥é“¾æ¥linuxè¿›è¡Œä»£ç ç¼–å†™ï¼Œé‚£ä¸€å®šè¦è®°å¾—ä¿®æ”¹C++æ’ä»¶é‡Œé¢çš„CPPç‰ˆæœ¬ï¼Œå¦åˆ™é»˜è®¤ä»¥C++11æ¥è¿›è¡Œè¯­æ³•é«˜äº®çš„è¯ï¼Œä¼šæŠŠC++11ä¸æ”¯æŒçš„è¯­æ³•æ ‡çº¢ï¼Œå½±å“æˆ‘ä»¬å­¦ä¹ </p><p><img src="https://img.musnow.top/i/2023/08/8363f819fd562b1bd452551e970ff4a3.png" alt="image-20230828230838973"></p><blockquote><p>æœ¬æ–‡å‚è€ƒ <a href="https://zhuanlan.zhihu.com/p/588826142">https://zhuanlan.zhihu.com/p/588826142</a> è¿›è¡Œå­¦ä¹ ;</p><p>å®˜æ–¹æ–‡æ¡£ <a href="https://zh.cppreference.com/w/cpp/14">https://zh.cppreference.com/w/cpp/14</a></p></blockquote><h1 id="1-lambdaæ–°ç‰¹æ€§"><a href="#1-lambdaæ–°ç‰¹æ€§" class="headerlink" title="1.lambdaæ–°ç‰¹æ€§"></a>1.lambdaæ–°ç‰¹æ€§</h1><p>C++14ç»™lambdaè¡¨è¾¾å¼æ·»åŠ äº†ä¸¤ä¸ªæ–°åŠŸèƒ½</p><ul><li>å‚æ•°æ¨æ–­ï¼ˆautoï¼‰</li><li>å‚æ•°åˆå§‹åŒ–åæ•è·ï¼ˆå¯ä»¥åœ¨<code>[]</code>å¯¹æŸä¸ªæ–°å‚æ•°è¿›è¡Œèµ‹å€¼ï¼‰</li></ul><p>å…ˆæ¥å¤ä¹ ä¸€ä¸‹C++11ä¸­å­¦ä¹ çš„lambdaæ•è·çš„åŸºæœ¬æ–¹å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[val]ï¼šè¡¨ç¤ºå€¼ä¼ é€’æ–¹å¼æ•æ‰å˜é‡val</span><br><span class="line">[=]ï¼šè¡¨ç¤ºå€¼ä¼ é€’æ–¹å¼æ•è·æ‰€æœ‰çˆ¶ä½œç”¨åŸŸä¸­çš„å˜é‡(åŒ…æ‹¬this)</span><br><span class="line">[&amp;val]ï¼šè¡¨ç¤ºå¼•ç”¨ä¼ é€’æ•æ‰å˜é‡val</span><br><span class="line">[&amp;]ï¼šè¡¨ç¤ºå¼•ç”¨ä¼ é€’æ•æ‰æ‰€æœ‰çˆ¶ä½œç”¨åŸŸä¸­çš„å˜é‡(åŒ…æ‹¬this)</span><br><span class="line">[this]ï¼šè¡¨ç¤ºå€¼ä¼ é€’æ–¹å¼æ•æ‰å½“å‰çš„thisæŒ‡é’ˆ</span><br></pre></td></tr></table></figure><p>åœ¨C++14ä¸­ï¼Œæ–°å¢çš„æ˜¯ä¸‹é¢çš„è¿™ç§æƒ…å†µ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">30</span>;</span><br><span class="line"><span class="comment">// [] ä¸­èµ‹å€¼äº†ä¸€ä¸ªå‚æ•°</span></span><br><span class="line"><span class="comment">// () ä¸­å¯ä»¥ä½¿ç”¨autoå…³é”®å­—æ¥æ¨æ–­å‚æ•°ç±»å‹</span></span><br><span class="line"><span class="keyword">auto</span> func = [x = <span class="number">3</span>](<span class="keyword">auto</span> y) &#123;<span class="keyword">return</span> x + y; &#125;;</span><br><span class="line">cout &lt;&lt; <span class="built_in">func</span>(a) &lt;&lt; endl;</span><br></pre></td></tr></table></figure><p>è¿è¡Œæµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ°æˆåŠŸè¾“å‡ºäº†ç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ make</span><br><span class="line">g++ test.cpp -o test -std=c++14</span><br><span class="line">$ ./test</span><br><span class="line">33</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸€ä¸‹ç±»å‹ï¼Œä¹Ÿèƒ½æ­£å¸¸è°ƒç”¨</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> a = <span class="number">30.2</span>;</span><br><span class="line"><span class="keyword">auto</span> func = [x = <span class="number">3</span>](<span class="keyword">auto</span> y)</span><br><span class="line">&#123; <span class="keyword">return</span> x + y; &#125;;</span><br><span class="line">cout &lt;&lt; <span class="built_in">func</span>(a) &lt;&lt; endl;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">33.2</span><br></pre></td></tr></table></figure><p>å¦‚æœæƒ³å°†èµ‹å€¼å‚æ•°å’ŒåŸæœ¬çš„æ•è·æ–¹å¼ä¸€èµ·ä½¿ç”¨ï¼Œåˆ™éœ€è¦å°†<strong>èµ‹å€¼å‚æ•°</strong>æ”¾åœ¨<code>[]</code>çš„æœ€<strong>åé¢</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_lambda2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">10</span>, b = <span class="number">20</span>;</span><br><span class="line">    <span class="type">int</span> c = <span class="number">1</span>, d = <span class="number">3</span>, e = <span class="number">5</span>;</span><br><span class="line">    <span class="comment">// èµ‹å€¼çš„å‚æ•°è¦æ”¾åœ¨[]çš„æœ€åé¢ï¼Œæ•è·æ–¹å¼æ”¾åœ¨å‰é¢</span></span><br><span class="line">    <span class="keyword">auto</span> func6 = [=, f = <span class="number">30</span>, g = <span class="number">40</span>]</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">return</span> (a + b + c + d + e + f + g);</span><br><span class="line">    &#125;;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">func6</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">109</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–æ•è·çš„å¥½å¤„æ˜¯å¯ä»¥æ”¯æŒ<strong>ç§»åŠ¨æ•è·</strong>äº†ï¼›ä¸ç„¶åœ¨C++11ä¸­ï¼Œlambdaå°±åªèƒ½ä½¿ç”¨èµ‹å€¼æ•è·å’Œå¼•ç”¨æ•è·</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::unique_ptr&lt;Item&gt; <span class="title">item</span><span class="params">(<span class="keyword">new</span> Item())</span></span>;</span><br><span class="line"><span class="comment">// std::moveæ”¹ä¸ºå³å€¼è¿›è¡Œèµ‹å€¼åæ•è·</span></span><br><span class="line"><span class="keyword">auto</span> func = [m = std::<span class="built_in">move</span>(item)] &#123; <span class="comment">/* do something */</span> &#125;;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–°ç‰¹æ€§çš„æå‡ºï¼Œä¹Ÿè®©lambdaæˆåŠŸæœ‰äº†å’Œbindæ¯”æ‹¼çš„èƒ½åŠ›ã€‚åœ¨C++11ä¸­ï¼Œbindçš„ä¼˜åŠ¿å°±æ˜¯åœ¨äº<strong>ç§»åŠ¨æ•è·</strong>çš„æ”¯æŒï¼›å¦‚ä»Šlambdaä¹Ÿæœ‰äº†è¿™ä»½èƒ½åŠ›äº†ï¼Œæˆ‘ä»¬å¯ä»¥æ›´çµæ´»åœ°æ ¹æ®åœºæ™¯é€‰ç”¨lambdaæˆ–è€…bindï¼Œè€Œä¸æ˜¯åªèƒ½ä½¿ç”¨bindäº†ã€‚</p><h1 id="2-å˜é‡æ¨¡æ¿"><a href="#2-å˜é‡æ¨¡æ¿" class="headerlink" title="2.å˜é‡æ¨¡æ¿"></a>2.å˜é‡æ¨¡æ¿</h1><h2 id="2-1-ç¤ºä¾‹"><a href="#2-1-ç¤ºä¾‹" class="headerlink" title="2.1 ç¤ºä¾‹"></a>2.1 ç¤ºä¾‹</h2><p>çœ‹æ¸…æ¥šè¿™ä¸ªåå­—å•Šï¼æ˜¯<strong>å˜é‡æ¨¡æ¿</strong>ï¼Œå¯ä¸æ˜¯ä»€ä¹ˆå‡½æ•°æ¨¡æ¿å“ˆï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">T pi = <span class="built_in">T</span>(<span class="number">3.1415926535897932385L</span>); <span class="comment">// variable template</span></span><br><span class="line"><span class="comment">// æ•°å­—æœ€åçš„Lä»£è¡¨è¿™æ˜¯ä¸€ä¸ªé•¿æµ®ç‚¹å‹</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_value_template</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; pi&lt;<span class="type">double</span>&gt; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; pi&lt;<span class="type">float</span>&gt; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; pi&lt;<span class="type">int</span>&gt; &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šå°±æ˜¯ä¸€ä¸ªæœ€æœ€æœ€ç®€å•çš„å˜é‡æ¨¡æ¿ï¼Œæˆ‘ä»¬åœ¨ä¼ å…¥å¯¹åº”çš„ç±»å‹åï¼Œä»–å°±ä¼šè½¬æˆæˆ‘ä»¬éœ€è¦çš„ç±»å‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ make</span><br><span class="line">g++ test.cpp -o test -std=c++14</span><br><span class="line">$ ./test</span><br><span class="line">3.14159</span><br><span class="line">3.14159</span><br><span class="line">3</span><br></pre></td></tr></table></figure><h2 id="2-2-ç±»ä¸­ä½¿ç”¨"><a href="#2-2-ç±»ä¸­ä½¿ç”¨" class="headerlink" title="2.2 ç±»ä¸­ä½¿ç”¨"></a>2.2 ç±»ä¸­ä½¿ç”¨</h2><p>å½“ä½ éœ€è¦åœ¨ç±»ä¸­ä½¿ç”¨æ¨¡æ¿å˜é‡çš„æ—¶å€™ï¼Œè¿™ä¸ªå˜é‡å¿…é¡»å®šä¹‰ä¸º<code>static</code>ï¼›</p><p>å› ä¸ºå®ƒæ˜¯æ¨¡æ¿ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ¥ç”¨æ¨¡æ¿æœ¬èº«å°±æœ‰çš„ç‰¹æ€§ï¼Œå°†è¿™ä¸ªæ¨¡æ¿é’ˆå¯¹æŸä¸€ä¸ªç±»å‹è¿›è¡Œ<strong>ç‰¹åŒ–</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Limits</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> T min; <span class="comment">// å£°æ˜é™æ€æˆå‘˜æ¨¡æ¿</span></span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="type">const</span> T Limits::min = &#123; &#125;; <span class="comment">// å®šä¹‰é™æ€æˆå‘˜æ¨¡æ¿ï¼Œå…¨éƒ¨ä½¿ç”¨é»˜è®¤å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸‹é¢ä¸‰ä¸ªæ˜¯æ¨¡æ¿å˜é‡çš„ç‰¹åŒ–</span></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="type">const</span> <span class="type">float</span> Limits::min&lt;<span class="type">float</span>&gt; = <span class="number">4.5</span>;</span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> Limits::min&lt;<span class="type">double</span>&gt; = <span class="number">5.5</span>;</span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="type">const</span> std::string Limits::min&lt;std::string&gt; = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; Limits::min&lt;<span class="type">int</span>&gt; &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; Limits::min&lt;<span class="type">float</span>&gt; &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; Limits::min&lt;<span class="type">double</span>&gt; &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; Limits::min&lt;std::string&gt; &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">0</span><br><span class="line">4.5</span><br><span class="line">5.5</span><br><span class="line">hello</span><br></pre></td></tr></table></figure><h2 id="2-3-å’Œç±»å‹è½¬æ¢çš„åŒºåˆ«"><a href="#2-3-å’Œç±»å‹è½¬æ¢çš„åŒºåˆ«" class="headerlink" title="2.3 å’Œç±»å‹è½¬æ¢çš„åŒºåˆ«"></a>2.3 å’Œç±»å‹è½¬æ¢çš„åŒºåˆ«</h2><p>è¿™é‡Œæˆ‘åˆç›´æ¥å®šä¹‰äº†ä¸€ä¸ªå˜é‡ï¼Œä½¿ç”¨<code>static_cast</code>ç›´æ¥è½¬æ¢å˜é‡ï¼Œçœ‹çœ‹ç»“æœä¼šä¸ä¼šæœ‰ä»€ä¹ˆåŒºåˆ«</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ•°å­—æœ€åçš„Lä»£è¡¨è¿™æ˜¯ä¸€ä¸ªé•¿æµ®ç‚¹å‹</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">T pi = <span class="built_in">T</span>(<span class="number">3.1415926535897932385L</span>); <span class="comment">// å˜é‡æ¨¡æ¿</span></span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="type">double</span> lpi = <span class="number">3.1415926535897932385L</span>; <span class="comment">// ç›´æ¥å®šä¹‰é•¿æµ®ç‚¹å‹</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_value_template</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; pi&lt;<span class="type">double</span>&gt; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; pi&lt;<span class="type">float</span>&gt; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; pi&lt;<span class="type">int</span>&gt; &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot; ----- \n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(lpi) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(lpi) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(lpi) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸Šå»äºŒè€…çš„ç»“æœå®Œå…¨ç›¸åŒï¼Œé‚£ä¹ˆæ—¢ç„¶å¯ä»¥ç›´æ¥ä½¿ç”¨å˜é‡ç±»å‹è½¬æ¢ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æ–°å¢ä¸€ä¸ªæ¨¡æ¿å˜é‡å‘¢ï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">3.14159</span><br><span class="line">3.14159</span><br><span class="line">3</span><br><span class="line"> ----- </span><br><span class="line">3.14159</span><br><span class="line">3.14159</span><br><span class="line">3</span><br></pre></td></tr></table></figure><blockquote><p>ä»¥ä¸‹å†…å®¹æ¥è‡ªGPTï¼Œæˆ‘è§‰å¾—å®ƒè¯´çš„å¾ˆå¯¹</p></blockquote><p>å®šä¹‰ä¸€ä¸ªå˜é‡å¹¶ä½¿ç”¨æ•°æ®è½¬æ¢ï¼ˆç±»å‹è½¬æ¢ï¼‰æ˜¯ä¸€ç§å¸¸è§çš„ç¼–ç¨‹æ–¹å¼ï¼Œä½†ä¸å˜é‡æ¨¡æ¿æœ‰ä¸€äº›åŒºåˆ«ï¼š</p><ol><li><strong>é€šç”¨æ€§ï¼š</strong> å˜é‡æ¨¡æ¿å…è®¸ä½ é€šè¿‡æ¨¡æ¿å‚æ•°æ¥ç”Ÿæˆå¤šä¸ªä¸åŒç±»å‹çš„å˜é‡ï¼Œä»è€Œåœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ã€‚è¿™ä½¿å¾—ä»£ç æ›´å…·é€šç”¨æ€§å’Œå¯æ‰©å±•æ€§ï¼Œå› ä¸ºä½ å¯ä»¥ä¸ºå¤šä¸ªç±»å‹ç”Ÿæˆç›¸åº”çš„å˜é‡ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œç›´æ¥å®šä¹‰å˜é‡å¹¶ä½¿ç”¨æ•°æ®è½¬æ¢é€šå¸¸åªé€‚ç”¨äºç‰¹å®šçš„ä¸€ç§æ•°æ®ç±»å‹ã€‚</li><li><strong>æ¨¡æ¿åŒ–ï¼š</strong> å˜é‡æ¨¡æ¿æ˜¯ä¸€ç§æ¨¡æ¿åŒ–çš„æ–¹å¼æ¥ç”Ÿæˆå˜é‡ï¼Œå®ƒéµå¾ª C++ çš„æ¨¡æ¿æœºåˆ¶ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨æ¨¡æ¿<strong>ç‰¹åŒ–</strong>ã€éƒ¨åˆ†ç‰¹åŒ–ç­‰æŠ€æœ¯æ¥å®šåˆ¶åŒ–ç”Ÿæˆçš„å˜é‡ï¼Œä»¥æ»¡è¶³ä¸åŒçš„éœ€æ±‚ã€‚è€Œä½¿ç”¨æ•°æ®è½¬æ¢æ—¶ï¼Œä½ å¿…é¡»æ˜¾å¼åœ°æ‰§è¡Œç±»å‹è½¬æ¢ï¼Œè¿™å¯èƒ½ä¼šåœ¨ä»£ç ä¸­å¼•å…¥ä¸å¿…è¦çš„é‡å¤ã€‚</li><li><strong>ç¼–è¯‘æ—¶è®¡ç®—ï¼š</strong> å˜é‡æ¨¡æ¿é€šå¸¸ç”¨äºåœ¨ç¼–è¯‘æ—¶ç”Ÿæˆå€¼ï¼Œå› æ­¤å¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µè¿›è¡Œç±»å‹æ£€æŸ¥å’Œè®¡ç®—ã€‚è¿™æœ‰åŠ©äºæé«˜ä»£ç çš„æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚è€Œæ•°æ®è½¬æ¢å¯èƒ½åœ¨è¿è¡Œæ—¶è¿›è¡Œï¼Œå¯èƒ½ä¼šå¼•å…¥ä¸€äº›è¿è¡Œæ—¶å¼€é”€å’Œç±»å‹é”™è¯¯çš„é£é™©ã€‚</li><li><strong>æŠ½è±¡æ€§ï¼š</strong> å˜é‡æ¨¡æ¿å¯ä»¥åœ¨æ›´é«˜çš„æŠ½è±¡å±‚æ¬¡ä¸Šæ“ä½œæ•°æ®ï¼Œä½¿ä»£ç æ›´å…·è¡¨è¾¾åŠ›å’Œå¯è¯»æ€§ã€‚å®ƒå…è®¸ä½ ä»¥æ›´è‡ªç„¶çš„æ–¹å¼æè¿°æŸä¸ªå€¼ä¸ç‰¹å®šç±»å‹ä¹‹é—´çš„å…³ç³»ï¼Œè€Œä¸å¿…æ˜¾å¼è¿›è¡Œç±»å‹è½¬æ¢ã€‚</li></ol><p>æ€»ä¹‹ï¼Œå˜é‡æ¨¡æ¿æä¾›äº†ä¸€ç§æ›´çµæ´»ã€é€šç”¨å’Œæ¨¡æ¿åŒ–çš„æ–¹å¼æ¥ç”Ÿæˆå˜é‡ï¼Œé€‚ç”¨äºéœ€è¦åœ¨ä¸åŒç±»å‹ä¸Šå·¥ä½œçš„æƒ…å†µã€‚å½“ä½ éœ€è¦ä¸ºå¤šä¸ªç±»å‹ç”Ÿæˆç‰¹å®šçš„å˜é‡æˆ–å€¼æ—¶ï¼Œå˜é‡æ¨¡æ¿æ˜¯ä¸€ç§æ›´ä¼˜é›…å’Œå¼ºå¤§çš„é€‰æ‹©ã€‚</p><h1 id="3-constexpré™åˆ¶æ”¾å®½"><a href="#3-constexpré™åˆ¶æ”¾å®½" class="headerlink" title="3.constexpré™åˆ¶æ”¾å®½"></a>3.constexpré™åˆ¶æ”¾å®½</h1><p>åœ¨C++11ä¸­è¢«å¼•å…¥çš„constexprï¼Œå¯ä»¥è®©ç¼–è¯‘å™¨åœ¨ç¼–è¯‘ç¨‹åºçš„æœŸé—´ï¼Œå°±å°†ä¸€éƒ¨åˆ†å·¥ä½œå®Œæˆï¼Œä¸å¿…ç­‰åˆ°è¿è¡ŒæœŸé—´å†åšï¼›åœ¨C++11ä¸­ï¼Œconstexprçš„é™åˆ¶å¾ˆä¸¥æ ¼ï¼Œè¿™å¯¼è‡´å®ƒå¹¶ä¸å¥½ç”¨ï¼š</p><ul><li>constexprä¿®é¥°å˜é‡ï¼Œè¦æ±‚å˜é‡å¿…é¡»å¯ä»¥åœ¨ç¼–è¯‘å™¨æ¨å¯¼å‡ºæ¥</li><li>constexprä¿®é¥°å‡½æ•°ï¼ˆè¿”å›å€¼ï¼‰ï¼Œå‡½æ•°å†…é™¤äº†å¯ä»¥åŒ…å«usingå’ŒtypedefæŒ‡ä»¤ä»¥åŠ<code>static_asssert</code>æ–­è¨€å¤–ï¼Œåªèƒ½åŒ…å«ä¸€æ¡<code>return</code>è¯­å¥</li><li>constexpråŒæ—¶å¯ä»¥ä¿®é¥°æ„é€ å‡½æ•°ï¼Œä½†ä¹Ÿä¼šè¦æ±‚ä½¿ç”¨è¿™ä¸ªæ„é€ å‡½æ•°çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨ç¼–è¯‘å™¨å°±æŠŠç›¸å…³çš„å†…å®¹å…¨æ¨å¯¼å‡ºæ¥</li></ul><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ¯”è¾ƒåŸºç¡€çš„C++11ä¸­çš„ç”¨ä¾‹ï¼Œç»™è¯¥å‡½æ•°è®¾ç½®äº†<code>constexpr</code>å…³é”®å­—åï¼Œè¯¥å‡½æ•°å°±å¯ä»¥åœ¨ç¼–è¯‘æœŸé—´è¢«è®¡ç®—å‡ºç»“æœï¼Œå†ç”¨<code>static_assert</code>åœ¨ç¼–è¯‘æœŸé—´æ–­è¨€ç»“æœæ˜¯å¦æ­£ç¡®ï¼›</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">constexpr</span> <span class="type">int</span> <span class="title">factorial</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (n &lt;= <span class="number">1</span>) ? <span class="number">1</span> : n * <span class="built_in">factorial</span>(n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">test_constexpr1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constexpr</span> <span class="type">int</span> result = <span class="built_in">factorial</span>(<span class="number">5</span>); <span class="comment">// ç¼–è¯‘æ—¶è®¡ç®—é˜¶ä¹˜</span></span><br><span class="line">    <span class="built_in">static_assert</span>(result == <span class="number">120</span>, <span class="string">&quot;Factorial of 5 should be 120&quot;</span>); <span class="comment">// ç¼–è¯‘æ—¶æ–­è¨€</span></span><br><span class="line">    cout &lt;&lt; result &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœåœ¨C++11ä¸­çš„constexprå‡½æ•°å†…åŒ…å«å…¶ä»–è¯­å¥ï¼Œç¼–è¯‘çš„æ—¶å€™ä¼šæŠ¥é”™ï¼Œç¿»è¯‘è¿‡æ¥æ˜¯è¯¥å‡½æ•°å†…éƒ¨ä¸æ˜¯ä¸€ä¸ªreturnè¿”å›è¯­å¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ g++ test.cpp -o test -std=c++11</span><br><span class="line">test.cpp: In function â€˜constexpr int FuncNew(int)â€™:</span><br><span class="line">test.cpp:96:1: error: body of â€˜constexprâ€™ function â€˜constexpr int FuncNew(int)â€™ not a return-statement</span><br><span class="line"> &#125;</span><br><span class="line"> ^</span><br></pre></td></tr></table></figure><p>c++14ä¸­ï¼Œå¯¹constexprçš„é™åˆ¶æ”¾å®½äº†ï¼Œå…è®¸ä½¿ç”¨<strong>å¾ªç¯ã€ifã€switch</strong>ç­‰ç­‰è¯­å¥ï¼Œä½†æ˜¯ä¸»æ—¨è¿˜æ˜¯ä¸€æ ·çš„ï¼Œéœ€è¦åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥è®¡ç®—å‡ºå…¨éƒ¨å†…å®¹ï¼›é™åˆ¶æ”¾å®½ä¹‹åï¼Œè¿™ä¸ªå…³é”®å­—ä¾¿å¯ä»¥æ›´çµæ´»çš„ä½¿ç”¨äº†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¡ç®—å‰né¡¹å’Œï¼ŒC++11</span></span><br><span class="line"><span class="function"><span class="keyword">constexpr</span> <span class="type">int</span> <span class="title">Func</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n &gt; <span class="number">0</span> ? <span class="built_in">Func</span>(n - <span class="number">1</span>) + n : <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è®¡ç®—å‰Né¡¹å’Œï¼ŒC++14</span></span><br><span class="line"><span class="function"><span class="keyword">constexpr</span> <span class="type">int</span> <span class="title">FuncNew</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        sum += i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="4-äºŒè¿›åˆ¶å˜é‡"><a href="#4-äºŒè¿›åˆ¶å˜é‡" class="headerlink" title="4.äºŒè¿›åˆ¶å˜é‡"></a>4.äºŒè¿›åˆ¶å˜é‡</h1><p>å¯ä»¥ä½¿ç”¨<code>0b</code>æˆ–è€…<code>0B</code>å¼€å¤´ç›´æ¥å®šä¹‰äºŒè¿›åˆ¶å˜é‡ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;    </span><br><span class="line">    <span class="type">int</span> bit1 = <span class="number">0b1001</span>;</span><br><span class="line">    <span class="type">int</span> bit2 = <span class="number">0B</span>1011;</span><br><span class="line">    std::cout &lt;&lt; bit1 &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; bit2 &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ g++ test.cpp -o test -std=c++14</span><br><span class="line">$ ./test</span><br><span class="line">9 11</span><br></pre></td></tr></table></figure><p>æˆ‘åœ¨æµ‹è¯•ä¸­å‘ç°ï¼Œå½“æˆ‘ç”¨C++11ç¼–è¯‘æ­¤ä»£ç çš„æ—¶å€™ï¼Œä¼¼ä¹ä¹Ÿæ²¡æœ‰å¼•å‘ç¼–è¯‘é”™è¯¯ï¼Œéš¾é“è¯´0bæ˜¯åœ¨C++11é‡Œé¢å°±æ”¯æŒäº†å—ï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ g++ test.cpp -o test -std=c++11</span><br><span class="line">$ ./test</span><br><span class="line">9 11</span><br></pre></td></tr></table></figure><p>GPTç»™å‡ºäº†0Bè¿™ç§äºŒè¿›åˆ¶å˜é‡æ˜¯åœ¨C++14ä¸­å¼•å…¥çš„ç¡®è®¤ï¼Œå¹¶æåˆ°äº†ä¸ºä»€ä¹ˆä¼šå‡ºç°ä¸Šè¿°æƒ…å†µï¼›è™½ç„¶C++11çœ‹ä¸Šå»ç¼–è¯‘å’Œè¿è¡Œéƒ½æ²¡æœ‰é—®é¢˜ï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯å¾—éµå¾ªç‰ˆæœ¬ï¼Œé€‰ç”¨æ­£ç¡®çš„ç‰ˆæœ¬è¿›è¡Œç¼–è¯‘ï¼Œæ‰èƒ½æ ¹æœ¬ä¸Šé¿å…é”™è¯¯</p><blockquote><p>C++æ ‡å‡†é€šå¸¸æ˜¯å‘åå…¼å®¹çš„ï¼Œè¿™æ„å‘³ç€è¾ƒæ–°ç‰ˆæœ¬çš„ç¼–è¯‘å™¨é€šå¸¸ä¼šç»§ç»­æ”¯æŒè¾ƒæ—§ç‰ˆæœ¬çš„æ ‡å‡†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨ä½¿ç”¨æ”¯æŒC++11æ ‡å‡†çš„ç¼–è¯‘å™¨ï¼ˆå¦‚g++ï¼‰æ—¶ï¼Œä½¿ç”¨äº†C++14æˆ–æ›´é«˜ç‰ˆæœ¬çš„ç‰¹æ€§ï¼Œé€šå¸¸ä¸ä¼šå¼•å‘ç¼–è¯‘é”™è¯¯ï¼Œå› ä¸ºè¿™äº›ç¼–è¯‘å™¨ä¼šå°½é‡å‘åå…¼å®¹ï¼Œä»¥ä¿æŒç°æœ‰ä»£ç çš„å¯ç¼–è¯‘æ€§ã€‚</p><p>åœ¨ä½ æåˆ°çš„æƒ…å†µä¸‹ï¼Œå³ä½¿ä½ ä½¿ç”¨g++ç¼–è¯‘å™¨ä»¥C++11æ ‡å‡†ç¼–è¯‘ï¼Œå®ƒä»ç„¶å¯ä»¥ç†è§£å’Œæ¥å—C++14å¼•å…¥çš„äºŒè¿›åˆ¶å­—é¢é‡ç‰¹æ€§ã€‚è¿™æ˜¯ç¼–è¯‘å™¨å¼€å‘è€…çš„ä¸€ç§è®¾è®¡é€‰æ‹©ï¼Œä»¥ä¾¿ä½¿ä»£ç çš„è¿ç§»æ›´åŠ å¹³æ»‘ã€‚ä½†æ˜¯ï¼Œä¸ºäº†éµå¾ªæœ€ä½³å®è·µå’Œä¿æŒä»£ç çš„å¯è¯»æ€§ï¼Œå½“ä½ åœ¨ä½¿ç”¨ç‰¹å®šC++æ ‡å‡†çš„åŠŸèƒ½æ—¶ï¼Œæœ€å¥½å°†ç¼–è¯‘å™¨é€‰é¡¹è®¾ç½®ä¸ºè¯¥æ ‡å‡†çš„ç‰ˆæœ¬ï¼Œä»¥ç¡®ä¿ä»£ç çš„å¯ç§»æ¤æ€§ã€‚</p></blockquote><h1 id="5-æ•°å­—åˆ†éš”ç¬¦"><a href="#5-æ•°å­—åˆ†éš”ç¬¦" class="headerlink" title="5.æ•°å­—åˆ†éš”ç¬¦"></a>5.æ•°å­—åˆ†éš”ç¬¦</h1><p>åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ä½¿ç”¨æ•°å­—çš„æ—¶å€™ï¼Œä¸ºäº†æ›´å¥½çš„å¯è¯»æ€§ï¼Œæˆ‘ä»¬ä¼šä»¥3ä¸ªæ•°ç»„æˆ–è€…4ä¸ªæ•°ç»„ä¸ºåˆ†å‰²ï¼Œæ‰“ä¸€ä¸ªç‚¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1,0000,0000 ä¸€äº¿</span><br><span class="line">100,000,000</span><br></pre></td></tr></table></figure><p>C++14ä¸­ï¼Œä¹Ÿæ”¯æŒäº†è¿™æ ·çš„æ‰“ç‚¹ï¼Œä»¥æ–¹ä¾¿æˆ‘ä»¬æ›´å¥½çš„çœ‹å‡ºå¤§æ•°å­—çš„ä½æ•°</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_num_div</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> big_num1 = <span class="number">100000000</span>;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> big_num2 = <span class="number">100&#x27;000&#x27;000</span>;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> big_num3 = <span class="number">1&#x27;0000&#x27;0000</span>;</span><br><span class="line">    cout &lt;&lt; big_num1 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; big_num2 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; big_num3 &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„ï¼Œè¿™æ ·çš„æ“ä½œä¸ä¼šå¯¹æ•°å­—æœ¬èº«æœ‰ä»»ä½•å½±å“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">100000000</span><br><span class="line">100000000</span><br><span class="line">100000000</span><br></pre></td></tr></table></figure><p>åœ¨C++11ä¸­è¿™ç§è¯­æ³•æ˜¯ä¸æ”¯æŒçš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ g++ test.cpp -o test -std=c++11</span><br><span class="line">test.cpp:116:29: warning: multi-character character constant [-Wmultichar]</span><br><span class="line">     long long big_num2 = 100&#x27;000&#x27;000;</span><br><span class="line">                             ^~~~~</span><br><span class="line">test.cpp:117:27: warning: multi-character character constant [-Wmultichar]</span><br><span class="line">     long long big_num3 = 1&#x27;0000&#x27;0000;</span><br><span class="line">                           ^~~~~~</span><br><span class="line">test.cpp: In function â€˜void test_num_div()â€™:</span><br><span class="line">test.cpp:116:29: error: expected â€˜,â€™ or â€˜;â€™ before &#x27;\x303030&#x27;</span><br><span class="line">     long long big_num2 = 100&#x27;000&#x27;000;</span><br><span class="line">                             ^~~~~</span><br><span class="line">test.cpp:117:27: error: expected â€˜,â€™ or â€˜;â€™ before &#x27;\x30303030&#x27;</span><br><span class="line">     long long big_num3 = 1&#x27;0000&#x27;0000;</span><br><span class="line">                           ^~~~~~</span><br></pre></td></tr></table></figure><h1 id="6-è¿”å›å€¼autoæ¨å¯¼"><a href="#6-è¿”å›å€¼autoæ¨å¯¼" class="headerlink" title="6.è¿”å›å€¼autoæ¨å¯¼"></a>6.è¿”å›å€¼autoæ¨å¯¼</h1><p>c++14æ–°å¢äº†å‡½æ•°è¿”å›å€¼çš„æ¨å¯¼ï¼Œå½“è¿”å›å€¼å£°æ˜ä¸ºautoæ—¶ï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®ä½ çš„returnè¯­å¥æ¨å¯¼å‡ºä½ çš„è¿”å›å€¼ç±»å‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">Func</span><span class="params">(T x, T y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">Func</span>(<span class="number">3</span>, <span class="number">4</span>) &lt;&lt; std::endl; <span class="comment">// è¿”å›å€¼æ¨å¯¼ä¸ºint</span></span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">Func</span>(<span class="number">3.1</span>, <span class="number">4.2</span>) &lt;&lt; std::endl; <span class="comment">// è¿”å›å€¼æ¨å¯¼ä¸ºdouble</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ make</span><br><span class="line">g++ test.cpp -o test -std=c++14</span><br><span class="line">$ ./test</span><br><span class="line">7</span><br><span class="line">7.3</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ¨å¯¼æ˜¯æœ‰é™åˆ¶æ¡ä»¶çš„</p><p>1ã€å¦‚æœæœ‰å¤šä¸ªæ¨å¯¼è¯­å¥ï¼Œé‚£ä¹ˆå¤šä¸ªæ¨å¯¼çš„ç»“æœå¿…é¡»ä¸€è‡´</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¼–è¯‘æŠ¥é”™ï¼Œç¬¬ä¸€ä¸ªreturnæ¨å¯¼ä¸ºintï¼Œç¬¬äºŒä¸ªreturnæ¨å¯¼ä¸ºdoubleï¼Œä¸¤æ¬¡æ¨å¯¼ç»“æœä¸ä¸€è‡´</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">Func</span><span class="params">(<span class="type">int</span> flag)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (flag &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">3.14</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ã€å¦‚æœæ²¡æœ‰returnæˆ–è€…returnä¸ºvoidç±»å‹ï¼Œé‚£ä¹ˆautoä¼šè¢«æ¨å¯¼ä¸ºvoidã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">f</span><span class="params">()</span> </span>&#123;&#125;              <span class="comment">// returns void</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">g</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">f</span>(); &#125; <span class="comment">// returns void</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span>* <span class="title">x</span><span class="params">()</span> </span>&#123;&#125;             <span class="comment">// error: cannot deduce auto* from void</span></span><br></pre></td></tr></table></figure><p>3ã€ä¸€æ—¦åœ¨å‡½æ•°ä¸­çœ‹åˆ°returnè¯­å¥ï¼Œä»è¯¥è¯­å¥æ¨å¯¼å‡ºçš„è¿”å›ç±»å‹å°±å¯ä»¥åœ¨å‡½æ•°çš„å…¶ä½™éƒ¨åˆ†ä¸­ä½¿ç”¨ï¼ŒåŒ…æ‹¬åœ¨å…¶ä»–returnè¯­å¥ä¸­ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">Sum</span><span class="params">(<span class="type">int</span> i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i &lt;= <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> i; <span class="comment">// è¿”å›å€¼è¢«æ¨å¯¼ä¸ºint</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Sum</span>(i - <span class="number">1</span>) + i; <span class="comment">// sumçš„è¿”å›å€¼å·²ç»è¢«æ¨å¯¼å‡ºæ¥äº†ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯æ²¡æœ‰é—®é¢˜çš„</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœè¿˜æ²¡è¢«æ¨å¯¼å‡ºæ¥ï¼Œé‚£å°±ä¸èƒ½ä½¿ç”¨ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">Sum</span><span class="params">(<span class="type">int</span> i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Sum</span>(i - <span class="number">1</span>) + i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–è¯‘æŠ¥é”™ï¼Œå› ä¸ºSumçš„è¿”å›å€¼è¿˜æ²¡æœ‰è¢«æ¨å¯¼å‡ºæ¥ï¼Œæ‰€ä»¥è¿˜ä¸èƒ½ä½¿ç”¨</span></span><br><span class="line">error: use of â€˜<span class="function"><span class="keyword">auto</span> <span class="title">Sum</span><span class="params">(<span class="type">int</span>)</span>â€™ before deduction of â€˜<span class="keyword">auto</span>â€™</span></span><br></pre></td></tr></table></figure><p>4ã€ä¸èƒ½æ¨å¯¼åˆå§‹åŒ–åˆ—è¡¨ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">func</span> <span class="params">()</span> </span>&#123; <span class="keyword">return</span> &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–è¯‘æŠ¥é”™</span></span><br><span class="line">error: returning initializer list</span><br></pre></td></tr></table></figure><p>5ã€è™šå‡½æ•°ä¸èƒ½ä½¿ç”¨è¿”å›å€¼æ¨å¯¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Item</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">auto</span> <span class="title">Func</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–è¯‘æŠ¥é”™</span></span><br><span class="line">error: <span class="keyword">virtual</span> function cannot have deduced <span class="keyword">return</span> type</span><br></pre></td></tr></table></figure><h1 id="7-deprecated-æ ‡è®°"><a href="#7-deprecated-æ ‡è®°" class="headerlink" title="7.[[deprecated]]æ ‡è®°"></a>7.<code>[[deprecated]]</code>æ ‡è®°</h1><p>è¿™ä¸ªæ ‡è®°çš„ä½œç”¨æ˜¯å‘ŠçŸ¥å…¶ä»–äººï¼ŒæŸä¸ªå‡½æ•°è¢«å¼ƒç”¨äº†ï¼Œä¸å…è®¸ç»§ç»­è°ƒç”¨è¯¥å‡½æ•°ï¼›è¯¥å­—æ®µçš„å¥½å¤„åœ¨äºï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•å·²ç»åœ¨åç»­ä¸éœ€è¦ä½¿ç”¨äº†ï¼Œä½ å¯ä»¥å…ˆç»™ä»–åŠ ä¸Šè¿™ä¸ªå…³é”®å­—ï¼Œç„¶åå†è¿›è¡Œå…¶ä»–çš„ä»£ç æ£€æŸ¥ï¼Œç¡®è®¤æ— è¯¯åï¼Œå†å°†è¿™ä¸ªå‡½æ•°æ•´ä½“æ¸…é™¤ï¼›</p><p>åˆ«äººä¹Ÿä¸éœ€è¦å»æ£€æŸ¥å‡½æ•°çš„å®ç°ï¼Œå› ä¸ºåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ç¼–è¯‘å™¨å°±ä¼šå‘Šè¯‰ä½ è¿™ä¸ªå‡½æ•°è¢«å¼ƒç”¨ï¼›<strong>ä½†æ˜¯ç¼–è¯‘ä¾æ—§æ˜¯æˆåŠŸçš„</strong>ï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[[deprecated]]</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">test_return_auto</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">Func</span>(<span class="number">3</span>, <span class="number">4</span>) &lt;&lt; std::endl; <span class="comment">// è¿”å›å€¼æ¨å¯¼ä¸ºint</span></span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">Func</span>(<span class="number">3.1</span>, <span class="number">4.2</span>) &lt;&lt; std::endl; <span class="comment">// è¿”å›å€¼æ¨å¯¼ä¸ºdouble</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">test_return_auto</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¼šè­¦å‘Šä½ ï¼Œè¿™ä¸ªå‡½æ•°å·²ç»è¢«å¼ƒç”¨äº†ï¼›ä½†è¿™é‡Œåªæ˜¯è­¦å‘Šï¼Œç¼–è¯‘ä¾æ—§æˆåŠŸäº†ï¼Œæ‰€ä»¥æœ€ç»ˆè¿˜æ˜¯éœ€è¦ç¨‹åºçŒ¿å»ç…ä¸€çœ¼å„ä¸ªè­¦å‘Šåˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ make</span><br><span class="line">g++ test.cpp -o test -std=c++14</span><br><span class="line">test.cpp: In function â€˜int main()â€™:</span><br><span class="line">test.cpp:145:22: warning: â€˜int test_return_auto()â€™ is deprecated [-Wdeprecated-declarations]</span><br><span class="line">     test_return_auto();</span><br><span class="line">                      ^</span><br><span class="line">test.cpp:132:5: note: declared here</span><br><span class="line"> int test_return_auto()</span><br><span class="line">     ^~~~~~~~~~~~~~~~</span><br><span class="line">test.cpp:145:22: warning: â€˜int test_return_auto()â€™ is deprecated [-Wdeprecated-declarations]</span><br><span class="line">     test_return_auto();</span><br><span class="line">                      ^</span><br><span class="line">test.cpp:132:5: note: declared here</span><br><span class="line"> int test_return_auto()</span><br><span class="line">     ^~~~~~~~~~~~~~~~</span><br></pre></td></tr></table></figure><hr><h1 id="stdåº“çš„æ–°ç‰¹æ€§"><a href="#stdåº“çš„æ–°ç‰¹æ€§" class="headerlink" title="stdåº“çš„æ–°ç‰¹æ€§"></a>stdåº“çš„æ–°ç‰¹æ€§</h1><p>ä»¥ä¸‹æ˜¯STDåº“çš„æ–°å¢å†…å®¹ï¼</p><h2 id="8-std-make-unique"><a href="#8-std-make-unique" class="headerlink" title="8.std::make_unique"></a>8.std::make_unique</h2><p>è¿™ä¸ªä¸œè¥¿åœ¨cplusplusç½‘ç«™ä¸Šæ‰¾ä¸åˆ°é‡Šä¹‰ï¼Œæ‰€ä»¥å°±å»<a href="https://zh.cppreference.com/">cppçš„å®˜ç½‘</a>ä¸Šæ‰¾äº†</p><blockquote><p><a href="https://zh.cppreference.com/w/cpp/memory/unique_ptr/make_unique">https://zh.cppreference.com/w/cpp/memory/unique_ptr/make_unique</a></p></blockquote><p>è¯¥å‡½æ•°å®šä¹‰åœ¨<code>&lt;memory&gt;</code>å¤´æ–‡ä»¶ä¸­</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt; <span class="keyword">class</span> T, <span class="keyword">class</span>... Args &gt;</span></span><br><span class="line"><span class="function">unique_ptr&lt;T&gt; <span class="title">make_unique</span><span class="params">( Args&amp;&amp;... args )</span></span>;</span><br><span class="line"><span class="comment">//(1)(C++14 èµ·) (ä»…å¯¹éæ•°ç»„ç±»å‹)</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt; <span class="keyword">class</span> T &gt;</span></span><br><span class="line"><span class="function">unique_ptr&lt;T&gt; <span class="title">make_unique</span><span class="params">( std::<span class="type">size_t</span> size )</span></span>;</span><br><span class="line"><span class="comment">//(2)(C++14 èµ·) (ä»…å¯¹æœªçŸ¥è¾¹ç•Œæ•°ç»„)</span></span><br><span class="line"><span class="keyword">template</span>&lt; <span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span>... Args &gt;</span><br><span class="line"><span class="comment">/* unspecified */</span> <span class="built_in">make_unique</span>( Args&amp;&amp;... args ) = <span class="keyword">delete</span>;</span><br><span class="line"><span class="comment">//(3)(C++14 èµ·) (ä»…å¯¹å·²çŸ¥è¾¹ç•Œæ•°ç»„)</span></span><br></pre></td></tr></table></figure><p>ä½œç”¨æ˜¯æ„é€  <code>T</code> ç±»å‹å¯¹è±¡å¹¶å°†å…¶åŒ…è£…è¿› <a href="https://zh.cppreference.com/w/cpp/memory/unique_ptr">std::unique_ptr</a>ï¼›</p><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>args</td><td>å°†è¦æ„é€ çš„ <code>T</code> å®ä¾‹æ‰€ç”¨çš„å‚æ•°åˆ—è¡¨ã€‚</td></tr><tr><td>size</td><td>è¦æ„é€ çš„æ•°ç»„å¤§å°</td></tr></tbody></table><ol><li>æ„é€ éæ•°ç»„ç±»å‹ <code>T</code> å¯¹è±¡ã€‚ä¼ é€’å‚æ•° <code>args</code> ç»™ <code>T</code> çš„æ„é€ å‡½æ•°ã€‚æ­¤é‡è½½åªæœ‰åœ¨ <code>T</code> ä¸æ˜¯æ•°ç»„ç±»å‹æ—¶æ‰ä¼šå‚ä¸é‡è½½å†³è®®ã€‚å‡½æ•°ç­‰ä»·äºï¼š</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unique_ptr</span>&lt;T&gt;(<span class="keyword">new</span> <span class="built_in">T</span>(std::forward&lt;Args&gt;(args)...))</span><br></pre></td></tr></table></figure><ol start="2"><li>æ„é€ æ‹¥æœ‰åŠ¨æ€å¤§å°çš„æ•°ç»„ã€‚<a href="https://zh.cppreference.com/w/cpp/language/value_initialization">å€¼åˆå§‹åŒ–</a>æ•°ç»„å…ƒç´ ã€‚æ­¤é‡è½½åªæœ‰åœ¨ <code>T</code> æ˜¯æœªçŸ¥è¾¹ç•Œæ•°ç»„æ—¶æ‰ä¼šå‚ä¸é‡è½½å†³è®®ã€‚å‡½æ•°ç­‰ä»·äºï¼š</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unique_ptr</span>&lt;T&gt;(<span class="keyword">new</span> std::<span class="type">remove_extent_t</span>&lt;T&gt;[size]())</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç¤ºä¾‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">test_class</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">test_class</span>(<span class="type">int</span> a=<span class="number">-1</span>):_a(a)&#123;&#125;</span><br><span class="line">    <span class="type">int</span> _a;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::unique_ptr&lt;test_class&gt; pt = std::<span class="built_in">make_unique</span>&lt;test_class&gt;(<span class="number">3</span>);</span><br><span class="line">    cout &lt;&lt; pt-&gt;_a &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ make</span><br><span class="line">g++ test.cpp -o test -std=c++14</span><br><span class="line">$ ./test</span><br><span class="line">3</span><br></pre></td></tr></table></figure><h2 id="9-std-shared-timed-mutexä¸std-shared-lock"><a href="#9-std-shared-timed-mutexä¸std-shared-lock" class="headerlink" title="9.std::shared_timed_mutexä¸std::shared_lock"></a>9.std::shared_timed_mutexä¸std::shared_lock</h2><p>c++11å¼•å…¥äº†å¤šçº¿ç¨‹çº¿ç¨‹çš„ä¸€äº›åº“ï¼Œä½†æ˜¯æ˜¯æ²¡æœ‰è¯»å†™é”çš„ï¼Œå› æ­¤åœ¨c++14å¼•å…¥äº†è¯»å†™é”çš„ç›¸å…³å®ç°ï¼ˆå¤´æ–‡ä»¶shared_mutexï¼‰ï¼Œå…¶å®c++14è¯»å†™é”ä¹Ÿè¿˜ä¸å¤Ÿå®Œå–„ï¼Œç›´åˆ°c++17è¯»å†™é”è¿™å—æ‰ç®—æ˜¯å®Œå¤‡èµ·æ¥ã€‚</p><p><code>std::shared_timed_mutex</code>æ˜¯å¸¦è¶…æ—¶çš„è¯»å†™é”å¯¹è±¡ï¼Œæ¥å£è¿˜ç®—æ¯”è¾ƒç®€æ´æ˜“æ‡‚ï¼Œå’Œä¹‹å‰æ¥è§¦è¿‡çš„å…¶ä»–é”åŸºæœ¬ä¸€è‡´ï¼›å†…éƒ¨æˆå‘˜ä¸­<code>lock()</code>æ˜¯å†™é”ï¼Œ<code>lock_shared()</code>æ˜¯è¯»é”;</p><p><a href="https://zh.cppreference.com/w/cpp/thread/shared_timed_mutex">https://zh.cppreference.com/w/cpp/thread/shared_timed_mutex</a></p><p><img src="https://img.musnow.top/i/2023/08/9c8a79016b52e8d7845bdee6a98fc151.png" alt="image-20230829082045636"></p><p><code>std::shared_lock</code>æ˜¯åŠ é”çš„RAIIå®ç°ï¼Œå³æ„é€ æ—¶åŠ é”ï¼Œææ„æ—¶è§£é”ï¼›æˆ‘ä»¬ä½¿ç”¨<code>shared_lock/unique_lock</code>æ¥ä»<code>shared_timed_mutex</code>ä¸­è·å–é”çš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨è·å–è¯»é”å’Œå†™é”ï¼›</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">std::shared_timed_mutex mutex;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">readOperation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è¯»é”æ˜¯å¤šäººå¯ä»¥è·å–çš„ï¼Œæ‰€ä»¥è¦ç”¨shared_lock (è¯»é”)</span></span><br><span class="line">    <span class="function">std::shared_lock&lt;std::shared_timed_mutex&gt; <span class="title">lock</span><span class="params">(mutex)</span></span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Read operation: &quot;</span> &lt;&lt; sharedResource &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">writeOperation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å†™é”äº’æ–¥è·å–ï¼Œç”¨unique_lock (å†™é”)</span></span><br><span class="line">    <span class="function">std::unique_lock&lt;std::shared_timed_mutex&gt; <span class="title">lock</span><span class="params">(mutex)</span></span>;</span><br><span class="line">    sharedResource++;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Write operation: &quot;</span> &lt;&lt; sharedResource &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="10-std-exchange"><a href="#10-std-exchange" class="headerlink" title="10.std::exchange"></a>10.std::exchange</h2><p>c++14æ–°å¢äº†ä¸€ä¸ªæ¥å£<code>std::exchange</code>ï¼ˆå¤´æ–‡ä»¶utilityï¼‰ï¼Œå…¶å®è¿™ä¸ªä¹Ÿå¹¶ä¸ç®—æ˜¯æ–°å¢çš„ï¼Œå› ä¸ºè¿™ä¸ªæ¥å£å…¶å®åœ¨c++11çš„æ—¶å€™å°±æœ‰äº†ï¼Œåªä¸è¿‡åœ¨c++11ä¸­ä½œä¸ºä¸€ä¸ªå†…éƒ¨å‡½æ•°ï¼Œä¸æš´éœ²ç»™ç”¨æˆ·ä½¿ç”¨ï¼Œåœ¨c++14ä¸­æ‰æŠŠå®ƒæš´éœ²å‡ºæ¥ç»™ç”¨æˆ·ä½¿ç”¨ã€‚ä½¿ç”¨æ–¹æ³•ä¹Ÿå¾ˆç®€å•ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::string s1 = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    std::string s2 = <span class="string">&quot;world&quot;</span>;</span><br><span class="line">    std::<span class="built_in">exchange</span>(s1, s2);</span><br><span class="line">    std::cout &lt;&lt; s1 &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; s2 &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line">world world</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œexchangeä¼šæŠŠç¬¬äºŒä¸ªå€¼èµ‹å€¼ç»™ç¬¬ä¸€ä¸ªå€¼ï¼Œä½†æ˜¯ä¸ä¼šæ”¹å˜ç¬¬äºŒä¸ªå€¼ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹å®ƒçš„å®ç°å§ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Assign @p __new_val to @p __obj and return its previous value.</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> _Tp, <span class="keyword">typename</span> _Up = _Tp&gt;</span><br><span class="line">  _GLIBCXX20_CONSTEXPR</span><br><span class="line">  <span class="keyword">inline</span> _Tp</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">exchange</span>(_Tp&amp; __obj, _Up&amp;&amp; __new_val)</span><br><span class="line">  <span class="built_in">noexcept</span>(__and_&lt;is_nothrow_move_constructible&lt;_Tp&gt;,</span><br><span class="line">    is_nothrow_assignable&lt;_Tp&amp;, _Up&gt;&gt;::value)</span><br><span class="line">  &#123; <span class="keyword">return</span> std::__exchange(__obj, std::forward&lt;_Up&gt;(__new_val)); &#125;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// C++11 version of std::exchange for internal use.</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> _Tp, <span class="keyword">typename</span> _Up = _Tp&gt;</span><br><span class="line">  _GLIBCXX20_CONSTEXPR</span><br><span class="line">  <span class="keyword">inline</span> _Tp</span><br><span class="line">  __exchange(_Tp&amp; __obj, _Up&amp;&amp; __new_val)</span><br><span class="line">  &#123;</span><br><span class="line">    _Tp __old_val = std::<span class="built_in">move</span>(__obj);</span><br><span class="line">    __obj = std::forward&lt;_Up&gt;(__new_val);</span><br><span class="line">    <span class="keyword">return</span> __old_val;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ³¨é‡Šæˆ‘ä»¬å¯ä»¥æ˜ç™½å«ä¹‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯æŠŠç¬¬äºŒä¸ªå€¼èµ‹å€¼ç»™ç¬¬ä¸€ä¸ªå€¼ï¼ŒåŒæ—¶è¿”å›ç¬¬ä¸€ä¸ªå€¼çš„æ—§å€¼ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿™é‡Œè¯´æ˜ä¸€ä¸ªå…³é”®çš„ç‚¹ã€‚exchangeçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸‡èƒ½å¼•ç”¨ï¼Œæ‰€ä»¥è¯´ä»–æ˜¯æ—¢å¯ä»¥æ¥æ”¶å·¦å€¼ï¼Œä¹Ÿå¯ä»¥æ¥æ”¶å³å€¼çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥ä½¿ç”¨ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::string s1 = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    <span class="comment">// ç¬¬äºŒä¸ªå€¼æ˜¯çº¯å³å€¼</span></span><br><span class="line">    std::<span class="built_in">exchange</span>(s1, <span class="string">&quot;world&quot;</span>);</span><br><span class="line">    std::cout &lt;&lt; s1 &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    std::string s2 = <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">    <span class="comment">// ç¬¬äºŒä¸ªå€¼é€šè¿‡moveè¯­ä¹‰è½¬æˆå³å€¼</span></span><br><span class="line">    std::<span class="built_in">exchange</span>(s1, std::<span class="built_in">move</span>(s2));</span><br><span class="line">    std::cout &lt;&lt; s1 &lt;&lt; <span class="string">&quot; | &quot;</span> &lt;&lt; s2 &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœï¼Œæ³¨æ„è¿™é‡Œs2ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå› ä¸ºs2çš„ä¸œè¥¿å·²ç»è¢«ç§»åŠ¨æ‹·è´ç»™s1äº†</span></span><br><span class="line">world</span><br><span class="line">hello world | </span><br></pre></td></tr></table></figure><h2 id="11-std-integer-sequence"><a href="#11-std-integer-sequence" class="headerlink" title="11.std::integer_sequence"></a>11.std::integer_sequence</h2><p>ç±»æ¨¡æ¿ <code>std::integer_sequence</code> è¡¨ç¤ºä¸€ä¸ªç¼–è¯‘æ—¶çš„æ•´æ•°åºåˆ—ã€‚åœ¨ç”¨ä½œ<a href="https://zh.cppreference.com/w/cpp/language/function_template">å‡½æ•°æ¨¡æ¿</a>çš„å®å‚æ—¶ï¼Œèƒ½æ¨å¯¼<a href="https://zh.cppreference.com/w/cpp/language/parameter_pack">å‚æ•°åŒ…</a> <code>Ints</code> å¹¶å°†å®ƒç”¨äºåŒ…å±•å¼€ã€‚</p><p><a href="https://zh.cppreference.com/w/cpp/utility/integer_sequence">https://zh.cppreference.com/w/cpp/utility/integer_sequence</a></p><p>è¿™ä¸ªå®åœ¨æ˜¯å¤ªéš¾æ‡‚äº†ï¼Œæä¸æ˜ç™½æ˜¯å¹²å˜›çš„ï¼Œæ”¾å¼ƒäº†ğŸ˜¥</p><h2 id="12-std-quoted"><a href="#12-std-quoted" class="headerlink" title="12.std::quoted"></a>12.std::quoted</h2><p><a href="https://zh.cppreference.com/w/cpp/io/manip/quoted">https://zh.cppreference.com/w/cpp/io/manip/quoted</a></p><p>è¯¥å‡½æ•°æ¨¡æ¿ä½äº <code>&lt;iomanip&gt;</code> å¤´æ–‡ä»¶ä¸­ï¼Œç”¨äºåœ¨è¾“å…¥è¾“å‡ºæµä¸­å¤„ç†è¢«å¼•å·åŒ…å›´çš„å­—ç¬¦ä¸²ã€‚å®ƒé€šå¸¸ç”¨äºå¤„ç† CSVï¼ˆé€—å·åˆ†éš”å€¼ï¼‰æ–‡ä»¶æˆ–å…¶ä»–æ ¼å¼ï¼Œå…¶ä¸­å­—æ®µè¢«å¼•å·æ‹¬èµ·æ¥ä»¥å¤„ç†åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚é€—å·ã€æ¢è¡Œç¬¦ç­‰ï¼‰çš„æƒ…å†µã€‚</p><p>å¯¹äº<code>cout</code>è€Œè¨€ï¼Œquotedä¼šå°†å­—ç¬¦ä¸²åŒ…å›´åœ¨åŒå¼•å·ä¸­è¾“å‡º</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">test_quorted</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::string data = <span class="string">&quot;Hello, \&quot;world\&quot;\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¾“å‡ºæµä¸­ä½¿ç”¨ std::quotedï¼Œä¼šå°†å­—ç¬¦ä¸²åœ¨&quot;å†…åŒ…å›´è¾“å‡º</span></span><br><span class="line">    std::cout &lt;&lt; std::<span class="built_in">quoted</span>(data) &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">&quot;Hello, \&quot;world\&quot;</span><br><span class="line">&quot;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯å®˜æ–¹ç»™çš„ä¸€ä¸ªç¤ºä¾‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::stringstream ss;</span><br><span class="line">    std::string in = <span class="string">&quot;String with spaces, and embedded \&quot;quotes\&quot; too&quot;</span>;</span><br><span class="line">    std::string out;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">auto</span> show = [&amp;](<span class="type">const</span> <span class="keyword">auto</span>&amp; what) &#123;</span><br><span class="line">        &amp;what == &amp;in</span><br><span class="line">            ?   std::cout &lt;&lt; <span class="string">&quot;read in     [&quot;</span> &lt;&lt; in &lt;&lt; <span class="string">&quot;]\n&quot;</span></span><br><span class="line">                          &lt;&lt; <span class="string">&quot;stored as   [&quot;</span> &lt;&lt; ss.<span class="built_in">str</span>() &lt;&lt; <span class="string">&quot;]\n&quot;</span></span><br><span class="line">            :   std::cout &lt;&lt; <span class="string">&quot;written out [&quot;</span> &lt;&lt; out &lt;&lt; <span class="string">&quot;]\n\n&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"> </span><br><span class="line">    ss &lt;&lt; std::<span class="built_in">quoted</span>(in);</span><br><span class="line">    <span class="built_in">show</span>(in);</span><br><span class="line">    ss &gt;&gt; std::<span class="built_in">quoted</span>(out);</span><br><span class="line">    <span class="built_in">show</span>(out);</span><br><span class="line"> </span><br><span class="line">    ss.<span class="built_in">str</span>(<span class="string">&quot;&quot;</span>); <span class="comment">// clear the stream buffer</span></span><br><span class="line"> </span><br><span class="line">    in = <span class="string">&quot;String with spaces, and embedded $quotes$ too&quot;</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> delim &#123;<span class="string">&#x27;$&#x27;</span>&#125;;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> escape &#123;<span class="string">&#x27;%&#x27;</span>&#125;;</span><br><span class="line"> </span><br><span class="line">    ss &lt;&lt; std::<span class="built_in">quoted</span>(in, delim, escape);</span><br><span class="line">    <span class="built_in">show</span>(in);</span><br><span class="line">    ss &gt;&gt; std::<span class="built_in">quoted</span>(out, delim, escape);</span><br><span class="line">    <span class="built_in">show</span>(out);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">read in     [String with spaces, and embedded &quot;quotes&quot; too]</span><br><span class="line">stored as   [&quot;String with spaces, and embedded \&quot;quotes\&quot; too&quot;]</span><br><span class="line">written out [String with spaces, and embedded &quot;quotes&quot; too]</span><br><span class="line"> </span><br><span class="line">read in     [String with spaces, and embedded $quotes$ too]</span><br><span class="line">stored as   [$String with spaces, and embedded %$quotes%$ too$]</span><br><span class="line">written out [String with spaces, and embedded $quotes$ too]</span><br></pre></td></tr></table></figure><p>åœ¨ç»™å®šçš„ä»£ç ä¸­ï¼Œ<code>delim</code> å’Œ <code>escape</code> æ˜¯ç”¨äºæŒ‡å®šè‡ªå®šä¹‰çš„åˆ†éš”ç¬¦å’Œè½¬ä¹‰å­—ç¬¦çš„å‚æ•°ã€‚è¿™äº›å‚æ•°æ˜¯ç”¨äº <code>std::quoted</code> å‡½æ•°çš„é‡è½½å½¢å¼ï¼Œå…è®¸ä½ æŒ‡å®šä¸åŒäºé»˜è®¤å¼•å·çš„å­—ç¬¦æ¥åŒ…å›´å­—ç¬¦ä¸²ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªä¸åŒäºé»˜è®¤è½¬ä¹‰å­—ç¬¦çš„å­—ç¬¦æ¥è½¬ä¹‰å¼•å·å­—ç¬¦ã€‚ä»¥ä¸‹æ˜¯å…³äºè¿™ä¸¤ä¸ªå‚æ•°çš„è¯¦ç»†è§£é‡Šï¼š</p><ol><li><code>delim</code>: åˆ†éš”ç¬¦ åœ¨ç¬¬ä¸€ä¸ªç”¨æ³•ä¸­ï¼Œ<code>std::quoted</code> å‡½æ•°ä½¿ç”¨äº†ä¸‰ä¸ªå‚æ•°çš„é‡è½½å½¢å¼ï¼š<code>std::quoted(in, delim, escape)</code>ã€‚<code>delim</code> å‚æ•°ç”¨äºæŒ‡å®šåŒ…å›´å­—ç¬¦ä¸²çš„åˆ†éš”ç¬¦ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œ<code>std::quoted</code> ä½¿ç”¨åŒå¼•å·ä½œä¸ºé»˜è®¤åˆ†éš”ç¬¦ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½æƒ³è¦ä½¿ç”¨å…¶ä»–å­—ç¬¦æ¥åŒ…å›´å­—ç¬¦ä¸²ï¼Œä»¥é¿å…ä¸å­—ç¬¦ä¸²æœ¬èº«çš„å­—ç¬¦å†²çªã€‚åœ¨ä½ çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œåˆ†éš”ç¬¦ <code>delim</code> è¢«è®¾ç½®ä¸º <code>$</code>ï¼Œè¿™æ„å‘³ç€å­—ç¬¦ä¸²ä¼šè¢«åŒ…å›´åœ¨ <code>$</code> å­—ç¬¦å†…ã€‚</li><li><code>escape</code>: è½¬ä¹‰å­—ç¬¦ <code>escape</code> å‚æ•°å…è®¸ä½ æŒ‡å®šä¸€ä¸ªå­—ç¬¦ï¼Œç”¨äºè½¬ä¹‰åˆ†éš”ç¬¦å­—ç¬¦æœ¬èº«ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>std::quoted</code> ä½¿ç”¨åŒå¼•å· <code>&quot;</code> ä½œä¸ºè½¬ä¹‰å­—ç¬¦ï¼Œä»¥ç¡®ä¿åœ¨å­—ç¬¦ä¸²ä¸­åµŒå…¥çš„å¼•å·ä¸ä¼šè¢«è§£é‡Šä¸ºç»“æŸå¼•å·ã€‚ä½†å¦‚æœä½ é€‰æ‹©äº†è‡ªå®šä¹‰çš„åˆ†éš”ç¬¦ï¼Œä½ å¯èƒ½è¿˜éœ€è¦æŒ‡å®šä¸€ä¸ªä¸åŒäºé»˜è®¤è½¬ä¹‰å­—ç¬¦çš„å­—ç¬¦æ¥è¿›è¡Œè½¬ä¹‰ã€‚åœ¨ä½ çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œè½¬ä¹‰å­—ç¬¦ <code>escape</code> è¢«è®¾ç½®ä¸º <code>%</code>ï¼Œè¿™æ„å‘³ç€åœ¨å­—ç¬¦ä¸²ä¸­ï¼Œå¦‚æœä½ æƒ³è¦è¡¨ç¤ºåˆ†éš”ç¬¦ <code>$</code> æœ¬èº«ï¼Œä½ éœ€è¦ä½¿ç”¨ <code>%$</code>ã€‚</li></ol><p>è¿™éƒ¨åˆ†ä¹Ÿä¸æ˜¯å¾ˆå®¹æ˜“ææ˜ç™½å®ƒæ˜¯å¹²å˜›çš„ï¼Œå¦‚æœé¢è¯•å®˜é—®é“äº†å°±è¯´æˆ‘ä¸ä¼šå§ğŸ˜­</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;å­¦ä¹ C++14çš„é‚£äº›æ–°ç‰¹æ€§&lt;/p&gt;</summary>
    
    
    
    <category term="é‡è§C++" scheme="https://blog.musnow.top/categories/%E9%81%87%E8%A7%81C/"/>
    
    
    <category term="C++" scheme="https://blog.musnow.top/tags/C/"/>
    
    <category term="æ•°æ®ç»“æ„" scheme="https://blog.musnow.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    <category term="C++14" scheme="https://blog.musnow.top/tags/C-14/"/>
    
  </entry>
  
  <entry>
    <title>ã€leetcodeã€‘1137. ç¬¬ N ä¸ªæ³°æ³¢é‚£å¥‘æ•°</title>
    <link href="https://blog.musnow.top/posts/563921472/"/>
    <id>https://blog.musnow.top/posts/563921472/</id>
    <published>2023-08-27T09:32:44.000Z</published>
    <updated>2023-08-27T09:32:44.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æ˜¯å­¦ä¹ åŠ¨å½’çš„ç¬¬ä¸€å¤©ï¼Œå…ˆæ¥ä¸€é“ç®€å•é¢˜ç»ƒç»ƒæ‰‹å§ï¼</p><h1 id="1-é¢˜ç›®"><a href="#1-é¢˜ç›®" class="headerlink" title="1.é¢˜ç›®"></a>1.é¢˜ç›®</h1><blockquote><p>leetcode <a href="https://leetcode.cn/problems/n-th-tribonacci-number/">1137. ç¬¬ N ä¸ªæ³°æ³¢é‚£å¥‘æ•°</a></p></blockquote><p>æ³°æ³¢é‚£å¥‘åºåˆ— Tn å®šä¹‰å¦‚ä¸‹ï¼š </p><p>T0 &#x3D; 0, T1 &#x3D; 1, T2 &#x3D; 1, ä¸”åœ¨ n &gt;&#x3D; 0 çš„æ¡ä»¶ä¸‹ <code>Tn+3 = Tn + Tn+1 + Tn+2</code></p><p>ç»™ä½ æ•´æ•° <code>n</code>ï¼Œè¯·è¿”å›ç¬¬ n ä¸ªæ³°æ³¢é‚£å¥‘æ•° Tn çš„å€¼ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„ä¸æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Œå“ªä¸ªæ˜¯ <code>Tn = Tn-1 + Tn-2</code>ï¼Œè€Œè¿™é‡Œæ˜¯ä¸‰ä¸ªï¼›</p><h1 id="2-åŠ¨å½’è§£æ³•"><a href="#2-åŠ¨å½’è§£æ³•" class="headerlink" title="2.åŠ¨å½’è§£æ³•"></a>2.åŠ¨å½’è§£æ³•</h1><p>åŠ¨æ€é€’å½’çš„æ€è·¯æ˜¯éœ€è¦æ‰¾åˆ°ä¸€ä¸ªé€’å½’æ–¹ç¨‹ï¼Œæœ¬é¢˜ä¸­çš„é€’å½’æ–¹ç¨‹å·²ç»ç»™å‡ºæ¥äº†ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“nå°äº3çš„æ—¶å€™ï¼Œè¿™ä¸ªé€’å½’æ–¹ç¨‹æ˜¯ä¸å¯ç”¨çš„ï¼ˆå› ä¸ºæˆ‘ä»¬æ²¡æœ‰åŠæ³•è®¡ç®—T<sub>è´Ÿæ•°</sub>çš„å€¼ï¼‰</p><h2 id="2-1-è§£æ³•1-é€’å½’"><a href="#2-1-è§£æ³•1-é€’å½’" class="headerlink" title="2.1 è§£æ³•1-é€’å½’"></a>2.1 è§£æ³•1-é€’å½’</h2><p>å¦‚ä¸‹æ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ªè§£æ³•ï¼Œé€šè¿‡é€’å½’å‡½æ•°è®¡ç®—æ•°å€¼ï¼Œå¹¶æå‰å†™å…¥0ã€1ã€2è¿™ä¸‰ä¸ªæ•°å€¼åˆ°æ•°ç»„é‡Œé¢ã€‚</p><p>å¦‚æœæ•°ç»„é‡Œé¢æœ‰å€¼ï¼Œç›´æ¥å–å‡ºæ¥ï¼Œå¦‚æœæ²¡æœ‰å€¼ï¼Œåœ¨è®¡ç®—äº†ä¹‹åå†èµ‹å€¼åˆ°æ•°ç»„é‡Œé¢ã€‚è¿™æ ·å°±èƒ½ä¿è¯åœ¨æ•´ä¸ªé€’å½’æµç¨‹ä¸­ï¼Œç›¸åŒä¸‹æ ‡å¤„çš„æ•°æ®åªä¼šè¢«è®¡ç®—ä¸€æ¬¡ï¼ˆä¸è¿™ä¹ˆåšä¼šè¶…æ—¶ï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> DEF -1 <span class="comment">//é»˜è®¤å€¼</span></span></span><br><span class="line">    <span class="comment">// ç›´æ¥ç”¨é€’å½’ä¼šè¶…æ—¶</span></span><br><span class="line">    <span class="comment">// æƒ³æ³•æ˜¯å°†æ•°æ®å­˜åˆ°vectoré‡Œé¢ï¼Œé¿å…é’ˆå¯¹æŸä¸€ä¸ªæ•°çš„äºŒæ¬¡é€’å½’è¿ç®—</span></span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> <span class="title function_">fib</span><span class="params">(<span class="type">int</span> n,<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;&amp; _map)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(_map[n] != DEF)&#123;</span><br><span class="line">            <span class="keyword">return</span> _map[n];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> ans = fib(n<span class="number">-1</span>,_map) + fib(n<span class="number">-2</span>,_map)+fib(n<span class="number">-3</span>,_map);</span><br><span class="line">        _map[n] = ans;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">tribonacci</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt; _map(<span class="number">40</span>,DEF);</span><br><span class="line">        _map[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        _map[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        _map[<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–å¹¶ä¼ å¼•ç”¨ç»™é€’å½’å‡½æ•°</span></span><br><span class="line">        <span class="keyword">return</span> fib(n,_map);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è¯¥æ–¹æ³•çš„é€šè¿‡ç‡å¦‚å›¾</p><p><img src="https://img.musnow.top/i/2023/08/6da34c2bc594bf2893b2b0edaee08c21.png" alt="image-20230827172927657"></p><h2 id="2-2-æ–¹æ³•2-è¿­ä»£"><a href="#2-2-æ–¹æ³•2-è¿­ä»£" class="headerlink" title="2.2 æ–¹æ³•2-è¿­ä»£"></a>2.2 æ–¹æ³•2-è¿­ä»£</h2><p>è¿˜æ˜¯ç›¸åŒçš„æ€è·¯ï¼Œåªä¸è¿‡è¿™æ¬¡æˆ‘ä»¬ä¸ç”¨é€’å½’ï¼Œè€Œæ˜¯ç”¨è¿­ä»£æ¥è®¡ç®—å‡ºæ•°ç»„é‡Œé¢å¯¹åº”ä¸‹æ ‡çš„å€¼ï¼Œæœ€åå†è¿”å›ç»™ç”¨æˆ·</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">tribonacci</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(n&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt; _map(n+<span class="number">1</span>,DEF);</span><br><span class="line">    _map[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    _map[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    _map[<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">3</span>;i&lt;_map.size();i++)&#123;</span><br><span class="line">        _map[i] = _map[i<span class="number">-3</span>] +_map[i<span class="number">-2</span>]+_map[i<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> _map[n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥åŠæ³•çš„é€šè¿‡ç‡å¦‚å›¾ï¼Œæ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦éƒ½æ˜¯<code>O(N)</code></p><p><img src="https://img.musnow.top/i/2023/08/eddf5511ea8346939633d018000e406f.png" alt="image-20230827173201195"></p><h2 id="2-3-è¿­ä»£-å˜é‡"><a href="#2-3-è¿­ä»£-å˜é‡" class="headerlink" title="2.3 è¿­ä»£+å˜é‡"></a>2.3 è¿­ä»£+å˜é‡</h2><p>æ—¢ç„¶åœ¨è®¡ç®—çš„æ—¶å€™æˆ‘ä»¬åªéœ€è¦ç”¨åˆ°å½“å‰æ•°æ®å’Œè¯¥æ•°æ®ä¹‹å‰çš„3ä¸ªå˜é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥ç”¨å›ºå®šçš„å‡ ä¸ªå˜é‡æ¥å®ç°è¿™ä¸ªæ“ä½œï¼Œæ¯æ¬¡è®¡ç®—ä¹‹åï¼Œéƒ½å¯¹å˜é‡è¿›è¡Œä¸€æ¬¡è½®æ¢å°±okäº†ï¼Œå®˜æ–¹çš„é¢˜è§£å°±æ˜¯è¿™ä¹ˆæ“ä½œçš„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">tribonacci</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> p = <span class="number">0</span>, q = <span class="number">0</span>, r = <span class="number">1</span>, s = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">3</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        p = q;</span><br><span class="line">        q = r;</span><br><span class="line">        r = s;</span><br><span class="line">        s = p + q + r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦è¿˜æ˜¯O(N)ï¼Œä½†æ˜¯ç©ºé—´å¤æ‚åº¦å°±é™åˆ°O(1)äº†ï¼</p><p><img src="https://img.musnow.top/i/2023/08/0681a6444a756d58fe395a2202b0ce18.png" alt="image-20230827173339364"></p><h1 id="3-çŸ©é˜µè®¡ç®—"><a href="#3-çŸ©é˜µè®¡ç®—" class="headerlink" title="3.çŸ©é˜µè®¡ç®—"></a>3.çŸ©é˜µè®¡ç®—</h1><p>å¦‚æœä¸ç”¨é€’å½’ï¼Œè¿˜å¯ä»¥ç”¨çŸ©é˜µä¹˜æ³•è¿ç®—ï¼Œè¯¥æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(LogN)</code></p><p><a href="https://leetcode.cn/problems/n-th-tribonacci-number/solutions/921898/di-n-ge-tai-bo-na-qi-shu-by-leetcode-sol-kn16/">https://leetcode.cn/problems/n-th-tribonacci-number/solutions/921898/di-n-ge-tai-bo-na-qi-shu-by-leetcode-sol-kn16/</a></p><p><img src="https://img.musnow.top/i/2023/08/a0431301252e331d1d2e9ac952358063.png" alt="image-20230827173653674"></p><p>å¥ˆä½•æœ¬äººçº¿ä»£çŸ¥è¯†å¿˜è®°äº†ï¼Œå®Œå…¨çœ‹ä¸æ‡‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">public:</span><br><span class="line">    <span class="type">int</span> <span class="title function_">tribonacci</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">long</span>&gt;&gt; q = &#123;&#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>&#125;, &#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>&#125;&#125;;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">long</span>&gt;&gt; res = <span class="built_in">pow</span>(q, n);</span><br><span class="line">        <span class="keyword">return</span> res[<span class="number">0</span>][<span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">long</span>&gt;&gt; <span class="built_in">pow</span>(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">long</span>&gt;&gt;&amp; a, <span class="type">long</span> n) &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">long</span>&gt;&gt; ret = &#123;&#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>&#125;&#125;;</span><br><span class="line">        <span class="keyword">while</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((n &amp; <span class="number">1</span>) == <span class="number">1</span>) &#123;</span><br><span class="line">                ret = multiply(ret, a);</span><br><span class="line">            &#125;</span><br><span class="line">            n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">            a = multiply(a, a);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">long</span>&gt;&gt; multiply(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">long</span>&gt;&gt;&amp; a, <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">long</span>&gt;&gt;&amp; b) &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">long</span>&gt;&gt; c(<span class="number">3</span>, <span class="built_in">vector</span>&lt;<span class="type">long</span>&gt;(<span class="number">3</span>));</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">                c[i][j] = a[i][<span class="number">0</span>] * b[<span class="number">0</span>][j] + a[i][<span class="number">1</span>] * b[<span class="number">1</span>][j] + a[i][<span class="number">2</span>] * b[<span class="number">2</span>][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æµ‹äº†ä¸€ä¸‹æ•ˆæœï¼Œå¥½åƒæ•ˆç‡å’Œä½¿ç”¨2.3çš„åŠæ³•æ²¡å•¥åŒºåˆ«ï¼Œé‚£æˆ‘è¿˜æ˜¯ç”¨åŠ¨å½’å§ğŸ˜­</p><p><img src="https://img.musnow.top/i/2023/08/858eede4f1ef9c10b2eb69f2150eae9d.png" alt="image-20230827173941225"></p><p>ä»¥åæœ‰æ—¶é—´äº†å†æ¥çº ç»“è¿™ä¸ªç­”æ¡ˆçš„æ€è·¯</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä»Šå¤©æ˜¯å­¦ä¹ åŠ¨å½’çš„ç¬¬ä¸€å¤©ï¼Œå…ˆæ¥ä¸€é“ç®€å•é¢˜ç»ƒç»ƒæ‰‹å§ï¼&lt;/p&gt;
&lt;h1 id=&quot;1-é¢˜ç›®&quot;&gt;&lt;a href=&quot;#1-é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;1.é¢˜ç›®&quot;&gt;&lt;/a&gt;1.é¢˜ç›®&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;leetcode &lt;a href=</summary>
      
    
    
    
    <category term="æŠŠé¢˜ç›®éƒ½ç»™åˆ·å¹²å‡€" scheme="https://blog.musnow.top/categories/%E6%8A%8A%E9%A2%98%E7%9B%AE%E9%83%BD%E7%BB%99%E5%88%B7%E5%B9%B2%E5%87%80/"/>
    
    
    <category term="C++" scheme="https://blog.musnow.top/tags/C/"/>
    
    <category term="OJåˆ·é¢˜" scheme="https://blog.musnow.top/tags/OJ%E5%88%B7%E9%A2%98/"/>
    
    <category term="leetcode" scheme="https://blog.musnow.top/tags/leetcode/"/>
    
  </entry>
  
  <entry>
    <title>ã€ç½‘ç»œã€‘CDN/PCDN/SDNè¯¦è§£</title>
    <link href="https://blog.musnow.top/posts/292924834/"/>
    <id>https://blog.musnow.top/posts/292924834/</id>
    <published>2023-08-27T02:49:28.000Z</published>
    <updated>2023-08-27T02:49:28.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ´å®çš„å­¦ä¹ åŸå› ï¼šäº¬ä¸œå®ä¹ ç”Ÿæ‹›è˜æ¡ç›®ä¸Šå†™äº†è¿™äº›æŠ€æœ¯ï¼Œé‚£å°±ç»™ä»–å­¦äº†ï¼</p><span id="more"></span><blockquote><p>å‚è€ƒ<br><a href="https://blog.csdn.net/baidu_41651554/article/details/122218513">https://blog.csdn.net/baidu_41651554/article/details/122218513</a></p></blockquote><p>å—¨å—¨å—¨ï¼Œç›´æ¥ä¸Šèœï¼</p><h1 id="1-CDN"><a href="#1-CDN" class="headerlink" title="1.CDN"></a>1.CDN</h1><p>CDNçš„å…¨ç¨‹æ˜¯content delivery networkï¼Œå†…å®¹åˆ†å‘ç½‘ç»œï¼›è¯´äººè¯å°±æ˜¯æŠŠç½‘ç«™äº§ç”Ÿçš„å†…å®¹åˆ†å‘åˆ°å„ä¸ªç”¨æˆ·è¯·æ±‚çš„ç½‘ç»œé‡Œå»ï¼Œå…·æœ‰ <strong>åˆ†å¸ƒå¼</strong> ç½‘ç»œçš„ç‰¹ç‚¹ï¼</p><h2 id="1-1-å‰ç½®å£°æ˜"><a href="#1-1-å‰ç½®å£°æ˜" class="headerlink" title="1.1 å‰ç½®å£°æ˜"></a>1.1 å‰ç½®å£°æ˜</h2><p>å½“ä»£ç½‘ç»œå½¢åŠ¿é”™ç»¼å¤æ‚ï¼Œç‰¹åˆ«æ˜¯è§†é¢‘ã€éŸ³é¢‘ç±»ç½‘ç»œæœåŠ¡çš„å…´èµ·ï¼Œç»™äº’è”ç½‘çš„è´·æ¬¾é€ æˆäº†å¾ˆå¤§çš„å‹åŠ›å•Šï¼</p><p>ä»¥ä¹‹å‰å¾ˆç«çš„â€œå»¶ç¦§æ”»ç•¥â€ä¸ºä¾‹ï¼Œå½“æ—¶æ›¾ç»åœ¨æŸè§†é¢‘APPå®ç°äº†1åƒä¸‡ç”¨æˆ·åŒæ—¶åœ¨çº¿è§‚çœ‹ã€‚å¦‚æœå¤§å®¶è§‚çœ‹çš„æ˜¯1080pæ¸…æ™°åº¦çš„è§†é¢‘ï¼ˆç†è®ºä¸Šéœ€è¦4Mbpså¸¦å®½ï¼‰ï¼Œé‚£ä¹ˆï¼Œç´¯è®¡éœ€è¦çš„æµé‡å¸¦å®½æ˜¯<br>$$<br>10,000,000Ã—4Mbps&#x3D;40,000,000Mbps&#x3D;40Tbps<br>$$<br>è¿™ä¸ªæ•°å­—è€ææ€–äº†ï¼å¯¹äºä¼˜é…·ã€çˆ±å¥‡è‰ºè¿™æ ·çš„äº’è”ç½‘è§†é¢‘å†…å®¹æä¾›å•†æ¥è¯´ï¼Œè¿™æ— ç–‘æ˜¯éå¸¸å·¨å¤§çš„æµé‡å‹åŠ›ã€‚</p><p>å¦‚æœæŒ‰æœåŠ¡å™¨ç”¨çš„10Gbpsçš„ä¸‡å…†ç½‘å¡æ¥ç®—ï¼Œé‚£ä¹Ÿéœ€è¦å››åƒå—ä¸‡å…†ç½‘å¡æ‰èƒ½é¡¶å¾—ä½è¿™ä¹ˆå¤§çš„æµé‡æ¶ˆè€—ï¼Œæ›´åˆ«æå‹æ ¹æ²¡æœ‰é‚£ä¹ˆå¤šåœ°æ–¹ç»™ä½ æ’è¿™ä¹ˆå¤šç½‘å¡çš„äº‹æƒ…äº†ï¼›</p><p>æœ‰è¿™ä¹ˆä¸€ä¸ªè¯´æ³•ï¼šå½“ç”¨æˆ·æ‰“å¼€ä¸€ä¸ªé¡µé¢ï¼Œç­‰å¾…è¶…è¿‡4ç§’ï¼Œä»–å°±ä¼šå…³é—­è¿™ä¸ªé¡µé¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªç”¨æˆ·å°±ä¼šæµå¤±ã€‚ç”¨æˆ·æµå¤±å¯¹äºå…¬å¸æ¥è¯´å¯å°±æ˜¯é‡‘é’±æµå¤±ï¼</p><p>æ‰€ä»¥ï¼Œæ²¡æœ‰ä»»ä½•ä¸€å®¶äº’è”ç½‘æœåŠ¡æä¾›å•†åŸå› å› ä¸ºç½‘ç»œçš„é—®é¢˜è€Œæµå¤±å®¢æˆ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—åƒä¸ªåŠæ³•æ¥è§£å†³è¿™ç§æµé‡çŸ­æ—¶é—´æš´å‘çš„é—®é¢˜ï¼</p><p>è€ŒCDNï¼Œå°±æ˜¯ä¸€é¡¹éå¸¸æœ‰æ•ˆçš„<strong>ç¼©çŸ­æ—¶å»¶</strong>çš„æŠ€æœ¯ã€‚</p><h2 id="1-2-æŠ€æœ¯ä¸»ä½“"><a href="#1-2-æŠ€æœ¯ä¸»ä½“" class="headerlink" title="1.2 æŠ€æœ¯ä¸»ä½“"></a>1.2 æŠ€æœ¯ä¸»ä½“</h2><p>CDNç¼©çŸ­ç”¨æˆ·å»¶æ—¶çš„åŠæ³•ä¹Ÿéå¸¸â€œç®€å•â€ï¼Œå…¶å®å°±æ˜¯å°†äº‘æœåŠ¡éƒ¨ç½²åˆ°ç”¨æˆ·èº«è¾¹ã€‚åœ¨è®¿é—®çš„æ—¶å€™ï¼Œæ ¹æ®DNSçš„å¤šçº¿è§£æèƒ½åŠ›ï¼ˆå³ä¸ºä¸åŒåœ°åŒºæä¾›ä¸åŒçš„IPè§£æï¼‰é€‰æ‹©ç¦»ç”¨æˆ·æœ€è¿‘çš„æœåŠ¡å™¨æ¥ä¸ºç”¨æˆ·æä¾›æœåŠ¡ã€‚</p><p><img src="https://img.musnow.top/i/2023/08/1298b6b472d89a0007ac82fb213b1aeb.png" alt="image-20230827105913951"></p><p>å› ä¸ºè¿™æ ·ï¼ŒCDNå°±åœ¨å†…å®¹å±‚é¢ä¸Šè¿›è¡Œäº†ä¸€å®šçš„ç­›é€‰å’Œåˆ†å‘ï¼Œæ‰€ä»¥ä»–å°±å«å†…å®¹åˆ†å‘ç½‘ç»œï¼›</p><p>å…·ä½“æ¥è¯´ï¼ŒCDNå°±æ˜¯é‡‡ç”¨æ›´å¤šçš„ç¼“å­˜æœåŠ¡å™¨ï¼ˆCDNè¾¹ç¼˜èŠ‚ç‚¹ï¼‰ï¼Œå¸ƒæ”¾åœ¨ç”¨æˆ·è®¿é—®ç›¸å¯¹é›†ä¸­çš„åœ°åŒºæˆ–ç½‘ç»œä¸­ã€‚å½“ç”¨æˆ·è®¿é—®ç½‘ç«™æ—¶ï¼Œåˆ©ç”¨å…¨å±€è´Ÿè½½æŠ€æœ¯ï¼Œå°†ç”¨æˆ·çš„è®¿é—®æŒ‡å‘è·ç¦»æœ€è¿‘çš„ç¼“å­˜æœåŠ¡å™¨ä¸Šï¼Œç”±ç¼“å­˜æœåŠ¡å™¨å“åº”ç”¨æˆ·è¯·æ±‚ã€‚ï¼ˆæœ‰ç‚¹åƒç”µå•†çš„æœ¬åœ°ä»“ï¼‰</p><p>å¤§å®¶å¯èƒ½è§‰å¾—ï¼Œè¿™ä¸ªä¸å°±æ˜¯â€œé•œåƒæœåŠ¡å™¨â€å˜›ï¼Ÿå…¶å®ä¸ä¸€æ ·ã€‚é•œåƒæœåŠ¡å™¨æ˜¯æºå†…å®¹æœåŠ¡å™¨çš„å®Œæ•´å¤åˆ¶ã€‚è€ŒCDNï¼Œæ˜¯éƒ¨åˆ†å†…å®¹çš„ç¼“å­˜ï¼Œæ™ºèƒ½ç¨‹åº¦æ›´é«˜ã€‚</p><p>ç¡®åˆ‡åœ°è¯´ï¼Œ<strong>CDN&#x3D;æ›´æ™ºèƒ½çš„é•œåƒ+ç¼“å­˜+æµé‡å¯¼æµ</strong></p><p>è€Œä¸”è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCDNå¹¶ä¸æ˜¯åªèƒ½ç¼“å­˜è§†é¢‘å†…å®¹ï¼Œå®ƒè¿˜å¯ä»¥å¯¹ç½‘ç«™çš„é™æ€èµ„æºï¼ˆä¾‹å¦‚å„ç±»å‹å›¾ç‰‡ã€htmlã€cssã€jsç­‰ï¼‰è¿›è¡Œåˆ†å‘ï¼Œå¯¹ç§»åŠ¨åº”ç”¨APPçš„é™æ€å†…å®¹ï¼ˆä¾‹å¦‚å®‰è£…åŒ…apkæ–‡ä»¶ã€APPå†…çš„å›¾ç‰‡è§†é¢‘ç­‰ï¼‰è¿›è¡Œåˆ†å‘ã€‚</p><p>CDNçš„å…·ä½“å·¥ä½œæµç¨‹ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæŸä¸ªç”¨æˆ·æƒ³è¦è®¿é—®ä¼˜é…·çš„è§†é¢‘ç‚¹æ’­å†…å®¹ï¼Œé‚£ä¹ˆï¼š</p><p><img src="https://img.musnow.top/i/2023/08/8ad3d099d1138c6b02472adeb5a2097c.png" alt="img"></p><p>å…·ä½“æ­¥éª¤å¦‚ä¸‹</p><ol><li>å½“ç”¨æˆ·ç‚¹å‡»å¯¹åº”èµ„æºå†…å®¹ï¼Œåº”ç”¨æ ¹æ®åŸŸååœ°å€åˆ°åº•å±‚è§¦å‘DNSè¯·æ±‚ï¼›</li><li>å…ˆæ˜¯è¯·æ±‚çš„æœ¬åœ°è¿è¥å•†çš„DNSï¼Œå†è½¬å‘åˆ°CDNåŸŸåæœåŠ¡çš„DNSï¼›</li><li>CDNåŸŸåæœåŠ¡çš„DNSä¼šå°†CDNçš„<strong>å…¨å±€å‡è¡¡è´Ÿè½½æœåŠ¡å™¨</strong>çš„IPåœ°å€è¿”å›ç»™ç”¨æˆ·ï¼›</li><li>ç”¨æˆ·å‘CDNçš„è´Ÿè½½å‡è¡¡è®¾å¤‡å‘èµ·URLçš„è®¿é—®è¯·æ±‚ï¼›</li><li>CDNçš„è´Ÿè½½å‡è¡¡è®¾å¤‡æ ¹æ®ç”¨æˆ·IPåœ°å€ï¼Œä»¥åŠç”¨æˆ·è¯·æ±‚çš„å†…å®¹URLï¼Œé€‰æ‹©ä¸€å°ç”¨æˆ·æ‰€å±åŒºåŸŸï¼ˆç¦»ç”¨æˆ·è¶Šè¿‘è¶Šå¥½ï¼‰çš„<strong>ç¼“å­˜æœåŠ¡å™¨</strong>ï¼›</li><li>è´Ÿè½½å‡è¡¡è®¾å¤‡å‘Šè¯‰ç”¨æˆ·è¿™å°ç¼“å­˜æœåŠ¡å™¨çš„IPåœ°å€ï¼Œè®©ç”¨æˆ·å‘æ‰€é€‰æ‹©çš„ç¼“å­˜æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼›</li><li>ç”¨æˆ·å‘ç¼“å­˜æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œç¼“å­˜æœåŠ¡å™¨å“åº”ï¼Œå°†ç”¨æˆ·è¯·æ±‚å†…å®¹å‘é€ç»™ç”¨æˆ·</li><li>å¦‚æœè¿™å°æœåŠ¡å™¨ä¸Šæ²¡æœ‰ç”¨æˆ·æƒ³è¦çš„å†…å®¹ï¼Œé‚£å°±æ ¹æ®CDNè®¾ç½®çš„<strong>å›æºæœåŠ¡å™¨</strong>ï¼ˆåˆç§°æºç«™ï¼‰æ¥è¯·æ±‚è¯¥URL</li><li>ç¼“å­˜æœåŠ¡å™¨ä»<strong>æºç«™</strong>æ‹‰å–å†…å®¹ç¼“å­˜åˆ°æœ¬åœ°ï¼Œå¹¶ä¼ è¾“ç»™ç”¨æˆ·ï¼›å¹¶æ ¹æ®ç”¨æˆ·è®¾ç½®çš„ç¼“å­˜ç­–ç•¥æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ä¿ç•™è¯¥èµ„æºåˆ°æœ¬åœ°ï¼Œæ˜¯åˆ™è¿›è¡Œç¼“å­˜ã€‚</li></ol><p>åœ¨CDNå·¥ä½œçš„æ•´ä¸ªæµç¨‹ä¸­ï¼Œæºç«™çš„æœåŠ¡å™¨IPæ˜¯å¯¹ç”¨æˆ·ä¸å¯è§çš„ï¼›CDNæœåŠ¡åœ¨å®ç°äº†ä¸€å®šçš„èµ„æºè®¿é—®åŠ é€Ÿçš„åŸºç¡€ä¸Šï¼Œè¿˜é™„å¸¦äº†éšè—æºç«™IPçš„åŠŸèƒ½ï¼Œé¿å…æºç«™ç›´æ¥é­å—ç«åŠ›æ‰“å‡»ï¼ˆæŒ‡æœåŠ¡å™¨è¢«æ”»å‡»ï¼‰</p><h2 id="1-3-é™æ€åŠ é€Ÿ"><a href="#1-3-é™æ€åŠ é€Ÿ" class="headerlink" title="1.3 é™æ€åŠ é€Ÿ"></a>1.3 é™æ€åŠ é€Ÿ</h2><p>æ‰€è°“é™æ€åŠ é€Ÿï¼Œæ˜¯åªåŠ é€Ÿæºç«™æ‰€æä¾›æœåŠ¡ä¸­çš„é™æ€èµ„æºï¼ŒåŒ…æ‹¬jsã€htmlã€cssã€å›¾ç‰‡ã€éŸ³è§†é¢‘ç­‰ä¸ä¼šå‡ºç°å˜åŠ¨çš„èµ„æºæ–‡ä»¶ã€‚å°†è¿™äº›èµ„æºåœ¨CDNäº‘æœåŠ¡å™¨å†…è¿›è¡Œç¼“å­˜ï¼Œç”¨æˆ·è®¿é—®é™æ€èµ„æºçš„æ—¶å€™ä»CDNä¼ è¾“ç»™ç”¨æˆ·ï¼Œè®¿é—®aspã€phpã€jspç­‰åŠ¨æ€èµ„æºçš„æ—¶å€™ï¼Œä»æºç«™æŠ“å–ï¼Œæ—¢ä¿è¯äº†æ•°æ®çš„åŠæ—¶æ€§ï¼Œåˆæé«˜äº†é™æ€èµ„æºçš„åŠ è½½é€Ÿåº¦ã€‚</p><p>ç›¸æ¯”äºåŠ¨æ€èµ„æºæ–‡ä»¶ï¼Œé™æ€èµ„æºï¼Œç‰¹åˆ«æ˜¯å›¾ç‰‡ï¼Œæ˜¯è®¿é—®è¿‡ç¨‹ä¸­æ¶ˆè€—æµé‡è¾ƒå¤§çš„éƒ¨åˆ†ï¼›ä½¿ç”¨é™æ€èµ„æºåŠ é€Ÿèƒ½å¤§å¤§å‡è½»æºç«™çš„ç½‘ç»œè´·æ¬¾å’Œèµ„æºè´Ÿè½½çš„å‹åŠ›ï¼Œåˆå‡å°‘äº†ç”¨æˆ·çš„åŠ è½½é€Ÿåº¦ï¼Œä½¿å¾—ç½‘ç»œæœåŠ¡èƒ½æ›´å¿«çš„å±•ç°åœ¨ç”¨æˆ·é¢å‰ï¼›</p><h2 id="1-4-åŠ¨æ€åŠ é€Ÿ"><a href="#1-4-åŠ¨æ€åŠ é€Ÿ" class="headerlink" title="1.4 åŠ¨æ€åŠ é€Ÿ"></a>1.4 åŠ¨æ€åŠ é€Ÿ</h2><p>åŠ¨æ€åŠ é€Ÿæ˜¯æŒ‡CDNçš„DNSè§£æä¸­é€šè¿‡åŠ¨æ€é“¾è·¯æ¢æµ‹ï¼Œç›‘æ§ç½‘ç»œç¯å¢ƒçš„å˜åŒ–ï¼Œç›‘æ§å„åœ°ç½‘ç»œå»¶è¿Ÿï¼Œå¯»æ‰¾åˆ°ä¸€æ¡æœ€<strong>ç¨³å®šã€æœ€é«˜æ•ˆã€æœ€å¿«é€Ÿ</strong>çš„è·¯å¾„ï¼Œå›æºåŠ¨æ€èµ„æºï¼Œä»è€Œå®ç°åŠ¨æ€èµ„æºï¼ˆå¦‚aspã€phpã€jspç­‰ï¼‰åŠ é€Ÿã€‚ç„¶åæ„æˆé“¾è·¯åˆ—è¡¨ï¼Œç»‘å®šåˆ°DNSè§£æä¸Šï¼Œæ›´æ–°åˆ°CDNçš„æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸Šã€‚ç®€å•æ¶æ„è§ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://img.musnow.top/i/2023/08/9b51e87fe04bacbd8591b55e5d62f679.png" alt="img"></p><h2 id="1-5-æ•°æ®èŠ‚ç‚¹çš„æ›´æ–°å’ŒåŒæ­¥"><a href="#1-5-æ•°æ®èŠ‚ç‚¹çš„æ›´æ–°å’ŒåŒæ­¥" class="headerlink" title="1.5 æ•°æ®èŠ‚ç‚¹çš„æ›´æ–°å’ŒåŒæ­¥"></a>1.5 æ•°æ®èŠ‚ç‚¹çš„æ›´æ–°å’ŒåŒæ­¥</h2><p>cdnåˆ†ä¸ºæ¨æ‹‰ä¸¤ç§æ–¹å¼</p><ul><li>æ¨æ˜¯æœåŠ¡å™¨å°†å†…å®¹æ¨åˆ°cdnèŠ‚ç‚¹ä¸Š</li><li>æ‹‰æ˜¯cdnåœ¨ç¬¬ä¸€æ¬¡æ¥å—è¯·æ±‚çš„æ—¶å€™ä»æœåŠ¡å™¨æ‹‰å–èµ„æºè¿›è¡Œå“åº”å¹¶ä¿å­˜</li></ul><p>å½“èµ„æºåœ¨cdnç¼“å­˜ä¹‹åï¼Œå¦‚æœæœåŠ¡å™¨ä¸Šçš„èµ„æºå‘ç”Ÿå˜åŒ–ï¼ŒcdnèŠ‚ç‚¹æ˜¯ä¸ä¼šçŸ¥é“çš„ï¼Œé™¤éç¼“å­˜æ—¶é—´åˆ°æœŸé‡æ–°æ‹‰å–æˆ–è€…ä¿®æ”¹æ–°èµ„æºçš„è®¿é—®ã€‚</p><p>åŠ¨æ€èµ„æºçš„è¯ï¼Œä¸€èˆ¬éƒ½æ˜¯æ— å»¶è¿Ÿçš„ã€‚é™æ€å¯¹äº css å’Œ js æ¥è¯´ï¼Œå»ºè®®åœ¨ç¼–è¯‘ç”Ÿæˆçš„é˜¶æ®µï¼Œä¸ºæ–‡ä»¶ååŠ ä¸Šæ—¶é—´æˆ³ã€‚è€Œä¸”æœ€å¥½æ˜¯åœ¨æ–‡ä»¶åé‡Œé¢ï¼Œè€Œä¸æ˜¯ querystring é‡Œé¢åŠ ã€‚è¿™æ˜¯æœ€æ–¹ä¾¿çš„æ–¹æ¡ˆï¼Œå› ä¸ºä¸€æ—¦å‘ç”Ÿäº†æ›´æ–°ï¼Œæ¯æ¬¡å»å–çš„ä¸€å®šæ˜¯æ–°æ–‡ä»¶ï¼Œä¸æ¶‰åŠç¼“å­˜åˆ·æ–°çš„é—®é¢˜ã€‚</p><h2 id="1-6-CDNçš„å¥½å¤„"><a href="#1-6-CDNçš„å¥½å¤„" class="headerlink" title="1.6 CDNçš„å¥½å¤„"></a>1.6 CDNçš„å¥½å¤„</h2><h3 id="1-6-1-å¯¹æœåŠ¡å•†"><a href="#1-6-1-å¯¹æœåŠ¡å•†" class="headerlink" title="1.6.1 å¯¹æœåŠ¡å•†"></a>1.6.1 å¯¹æœåŠ¡å•†</h3><p>é‡‡ç”¨CDNæŠ€æœ¯ï¼Œæœ€å¤§çš„å¥½å¤„ï¼Œå°±æ˜¯åŠ é€Ÿäº†ç½‘ç«™çš„è®¿é—®â€”â€”ç”¨æˆ·ä¸å†…å®¹ä¹‹é—´çš„ç‰©ç†è·ç¦»ç¼©çŸ­ï¼Œç”¨æˆ·çš„ç­‰å¾…æ—¶é—´ä¹Ÿå¾—ä»¥ç¼©çŸ­ã€‚</p><p>è€Œä¸”ï¼Œåˆ†å‘è‡³ä¸åŒçº¿è·¯çš„ç¼“å­˜æœåŠ¡å™¨ï¼Œä¹Ÿè®©<strong>è·¨è¿è¥å•†</strong>ä¹‹é—´çš„è®¿é—®å¾—ä»¥åŠ é€Ÿã€‚ä¾‹å¦‚ä¸­å›½ç§»åŠ¨æ‰‹æœºç”¨æˆ·è®¿é—®ä¸­å›½ç”µä¿¡ç½‘ç»œçš„å†…å®¹æºï¼Œå¯ä»¥é€šè¿‡åœ¨ä¸­å›½ç§»åŠ¨å‡è®¾CDNæœåŠ¡å™¨ï¼Œè¿›è¡ŒåŠ é€Ÿã€‚æ•ˆæœæ˜¯éå¸¸æ˜æ˜¾çš„ã€‚</p><p>æ­¤å¤–ï¼ŒCDNè¿˜æœ‰å®‰å…¨æ–¹é¢çš„å¥½å¤„ã€‚å†…å®¹è¿›è¡Œåˆ†å‘åï¼Œ<strong>æºæœåŠ¡å™¨çš„IPè¢«éšè—</strong>ï¼Œå—åˆ°æ”»å‡»çš„æ¦‚ç‡ä¼šå¤§å¹…ä¸‹é™ã€‚è€Œä¸”ï¼Œå½“æŸä¸ªæœåŠ¡å™¨æ•…éšœæ—¶ï¼Œç³»ç»Ÿä¼šè°ƒç”¨ä¸´è¿‘çš„å¥åº·æœåŠ¡å™¨ï¼Œè¿›è¡ŒæœåŠ¡ï¼Œé¿å…å¯¹ç”¨æˆ·é€ æˆå½±å“ã€‚</p><p>æ­£å› ä¸ºCDNçš„å¥½å¤„å¾ˆå¤šï¼Œæ‰€ä»¥ï¼Œç›®å‰æ‰€æœ‰ä¸»æµçš„äº’è”ç½‘æœåŠ¡æä¾›å•†ï¼Œéƒ½é‡‡ç”¨äº†CDNæŠ€æœ¯ã€‚æ‰€æœ‰çš„äº‘æœåŠ¡æä¾›å•†ï¼Œä¹Ÿéƒ½æä¾›äº†CDNæœåŠ¡ï¼ˆä»·æ ¼ï¼ŒæŒ‰æµé‡è®¡è´¹ï¼‰</p><h3 id="1-6-2-å¯¹é€šä¿¡è¡Œä¸š"><a href="#1-6-2-å¯¹é€šä¿¡è¡Œä¸š" class="headerlink" title="1.6.2 å¯¹é€šä¿¡è¡Œä¸š"></a>1.6.2 å¯¹é€šä¿¡è¡Œä¸š</h3><ul><li><strong>äº’è”ç½‘æœåŠ¡æä¾›å•†</strong>é‡‡ç”¨CDNï¼Œæ˜¯ä»¥å­˜å‚¨æ¢æ—¶å»¶ã€‚èŠ±é’±è´­ç½®CDNæœåŠ¡å™¨æˆ–äº‘è®¡ç®—æœåŠ¡ï¼Œä»¥æ­¤æ¢å–æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚</li><li><strong>é€šä¿¡è¿è¥å•†</strong>ä¹Ÿè¿½æ§CDNï¼Œä½†å®ƒä»¬çš„ç›®çš„ï¼Œæ˜¯ä»¥å­˜å‚¨æ¢å¸¦å®½ â€”â€”é€šè¿‡æœåŠ¡â€œä¸‹æ²‰â€ï¼Œå‡è½»ä¸Šå±‚éª¨å¹²ç½‘ç»œçš„æµé‡å‹åŠ›ï¼Œé¿å…ç¡¬ä»¶æ‰©å®¹ï¼Œé™ä½ç½‘ç»œå»ºè®¾æˆæœ¬ã€‚</li></ul><p>ä»¥ä¸Šæ–‡æåˆ°çš„çˆ±å¥‡è‰ºçœ‹è§†é¢‘çš„é«˜å¸¦å®½é—®é¢˜ä¸ºä¾‹ï¼Œå¦‚æœä¸é‡‡ç”¨CDNï¼Œé‚£å°±æ˜¯å·¨å¤§çš„æµé‡æµå…¥åŒä¸€ä¸ªæœºæˆ¿ï¼Œè¿™ä¼šå¯¼è‡´è¿™ä¸ªæœºæˆ¿å…¥ç½‘&#x2F;å‡ºç½‘çš„çº¿è·¯è¢«æ‹¥å¡ï¼Œå½±å“å…¶ä»–ä¸šåŠ¡çš„è¿›è¡Œï¼</p><p>åŒæ ·çš„ï¼Œå¦‚æœå¤§é‡çš„ä¸šåŠ¡æµé‡æ•°æ®åœ¨éª¨å¹²ç½‘è·‘æ¥è·‘å»ï¼Œ<strong>éª¨å¹²ç½‘è‚¯å®šåƒä¸æ¶ˆï¼Œè¦æ‹¼å‘½æ‰©å®¹</strong>ã€‚å¦‚æœè¿™äº›ä¸šåŠ¡æµé‡æ•°æ®åœ¨åº•å±‚å°±è¢«è§£å†³äº†ï¼Œé‚£ä¹ˆï¼Œéª¨å¹²ç½‘çš„å¸¦å®½å‹åŠ›è‡ªç„¶å°±å‡è½»äº†ã€‚</p><p>å¾ˆå¤šè¿è¥å•†å·²ç»å°†CDNä¸‹æ²‰åˆ°åœ°å¸‚çº§ï¼Œä»¥æ­¤å‡è½»å‹åŠ›ï¼ŒåŒæ—¶å¯ä»¥æå‡ç”¨æˆ·ä½“éªŒï¼å¯è°“æ˜¯ä¸€ä¸¾ä¸¤å¾—çš„ç¾äº‹ï¼</p><p><img src="https://img.musnow.top/i/2023/08/9806e61f7d240e45b2701d25668935e7.png" alt="img"></p><h1 id="2-PCDN"><a href="#2-PCDN" class="headerlink" title="2.PCDN"></a>2.PCDN</h1><p>PCDNæŠ€æœ¯æ˜¯P2PæŠ€æœ¯+CDNæŠ€æœ¯çš„é›†å’Œï¼Œåœ¨è®¤è¯†PCDNä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè¦ç®€å•äº†è§£ä¸€ä¸‹P2PæŠ€æœ¯</p><h2 id="2-1-P2P"><a href="#2-1-P2P" class="headerlink" title="2.1 P2P"></a>2.1 P2P</h2><p>P2På³<code>Peer to Peer</code>ï¼Œæ˜¯ä¸€ç§å¯¹ç­‰è¿æ¥æ–¹å¼ï¼Œçº¯P2Pæ¶æ„åŒ…å«å¦‚ä¸‹å†…å®¹</p><ul><li>æ²¡æœ‰æ€»æ˜¯åœ¨çº¿çš„æœåŠ¡å™¨</li><li>ä»»æ„ç«¯ä¹‹é—´ç›´æ¥é€šä¿¡</li><li>å¯¹ç­‰æ–¹ä¹‹é—´å¯ä»¥é—´æ–­é“¾æ¥ï¼Œå¹¶å¯ä»¥åŠ¨æ€æ”¹å˜IPåœ°å€</li></ul><p>å®é™…çš„ç”¨ä¾‹å¦‚ä¸‹</p><ul><li>æ–‡ä»¶åˆ†å‘ï¼ˆBTä¸‹è½½ï¼‰</li><li>æµåª’ä½“</li><li>VolP</li><li>å†…ç½‘ç©¿é€å¼è®¿é—®ï¼ˆå»ºç«‹P2Pé“¾æ¥ï¼Œç›´æ¥å’Œå†…ç½‘ä¸»æœºé€šä¿¡ï¼‰</li></ul><p><img src="https://img.musnow.top/i/2023/08/ebc51e20db9f5b31b0067fead78826ae.png" alt="image"></p><p>å…³äºP2Pæƒ³äº†è§£æ›´å¤šä¿¡æ¯å¯ä»¥æŸ¥çœ‹æ­¤æ–‡ï¼š<a href="https://cloud.tencent.com/developer/article/2095486">è¯¦è§£P2PæŠ€æœ¯</a></p><h2 id="2-2-PCDN"><a href="#2-2-PCDN" class="headerlink" title="2.2 PCDN"></a>2.2 PCDN</h2><h3 id="2-2-1-æµç¨‹"><a href="#2-2-1-æµç¨‹" class="headerlink" title="2.2.1 æµç¨‹"></a>2.2.1 æµç¨‹</h3><p>å‰é¢æåˆ°äº†ï¼ŒPCDNæ˜¯P2P+CDNï¼Œé‚£ä¹ˆå…¶æ˜¯å¦‚ä½•å°†P2PæŠ€æœ¯å’ŒCDNç»“åˆèµ·æ¥çš„å‘¢ï¼Ÿ</p><p>åœ¨é˜¿é‡Œäº‘å®˜ç½‘ä¸Šå¯ä»¥çœ‹åˆ°å¯¹PCDNçš„ä»‹ç»ï¼š<a href="https://developer.aliyun.com/article/130907">ä¸€ç¯‡æ–‡ç« è§£è¯»æé€Ÿã€é™è´¹é»‘ç§‘æŠ€ï¼šPCDNå®šä¹‰ã€åŠŸèƒ½ã€æ¶æ„ã€åœºæ™¯å’Œä¼˜åŠ¿</a>ï¼›æœ¬æ–‡æ˜¯å¯¹è¿™ç¯‡æ–‡ç« çš„ä¸ªäººç†è§£ã€‚</p><blockquote><p>PCDNäº§å“æ˜¯ä¸ä¼ ç»ŸCDNäº’è¡¥åä½œçš„å…³ç³»ï¼Œä»¥P2PæŠ€æœ¯ä¸ºæ ¸å¿ƒçš„åˆ†å¸ƒå¼PCDNç³»ç»Ÿå¯ä¸ä¼ ç»ŸCDNã€äº‘CDNæ— ç¼é›†æˆï¼Œå½¢æˆäº’è¡¥åä½œï¼Œç›¸å¯¹äºCDNæ‹¥æœ‰æˆæœ¬æ›´ä½ã€è´¨é‡æ›´å¥½ä¸¤æ–¹é¢çš„æ ¸å¿ƒä¼˜åŠ¿ã€‚</p></blockquote><p>P2P å†…å®¹åˆ†å‘ç½‘ç»œï¼ˆè‹±æ–‡åï¼šP2P CDNï¼Œä»¥ä¸‹ç®€ç§°PCDNï¼‰æ˜¯ä»¥P2PæŠ€æœ¯ä¸ºåŸºç¡€ï¼Œé€šè¿‡æŒ–æ˜åˆ©ç”¨è¾¹ç¼˜ç½‘ç»œæµ·é‡ç¢ç‰‡åŒ–é—²ç½®èµ„æºè€Œæ„å»ºçš„ä½æˆæœ¬é«˜å“è´¨å†…å®¹åˆ†å‘ç½‘ç»œæœåŠ¡ã€‚ä½ å¯ä»¥é€šè¿‡é›†æˆPCDN SDKï¼ˆä»¥ä¸‹ç®€ç§°SDKï¼‰æ¥å…¥è¯¥æœåŠ¡åèƒ½è·å¾—ç­‰åŒï¼ˆæˆ–ç•¥é«˜äºï¼‰CDNçš„åˆ†å‘è´¨é‡ï¼ŒåŒæ—¶æ˜¾è‘—é™ä½åˆ†å‘æˆæœ¬ã€‚é€‚ç”¨äº<strong>è§†é¢‘ç‚¹æ’­ã€ç›´æ’­ã€å¤§æ–‡ä»¶ä¸‹è½½</strong>ç­‰ä¸šåŠ¡åœºæ™¯ã€‚</p><p>ä½¿ç”¨PCDNåçš„httpè¯·æ±‚å¤„ç†æµç¨‹å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://img.musnow.top/i/2023/08/d2bba1440e3c9b80ec949459fd8617a8.png" alt="image-20230827133437729"></p><p>P2Pçš„åŠ å…¥ï¼Œå°±æ˜¯å°†ä¸€äº›æ•°æ®<strong>é¢„å…ˆç•™å­˜åœ¨éƒ¨åˆ†ç»ˆç«¯è®¾å¤‡</strong>ï¼ˆæ¯”å¦‚å®¶ç”¨è·¯ç”±å™¨ï¼Œä¸ªäººç”µè„‘ï¼Œä¸ªäººNASï¼‰ç­‰äº§å“ä¸Šï¼Œå†é€šè¿‡P2PæŠ€æœ¯ï¼Œä»è¿™äº›Peeråšç§ç«¯è·å–åˆ°ä¸€éƒ¨åˆ†æ•°æ®ï¼Œä»¥æ­¤ä¸ºå‘¨è¾¹ç”¨æˆ·æä¾›æœåŠ¡ã€‚</p><p>ä½¿ç”¨PCDNçš„SDKåï¼Œåœ¨è¯·æ±‚DNSä¹‹åï¼Œè¿˜ä¼šå»è¯·æ±‚<strong>PCDNçš„è°ƒåº¦ç³»ç»Ÿ</strong>ï¼ŒPCDNåŒæ—¶ä¼šè¿”å›å¯ç”¨çš„CDNæœåŠ¡å™¨ï¼Œå’Œå¯ç”¨çš„P2Påšç§ç«¯ï¼Œç”¨æˆ·èƒ½åŒæ—¶ä»<strong>å¤šç«¯</strong>è·å–åˆ°æ•°æ®ï¼ˆæ ¹æ®æ–‡ä»¶åˆ†å—ï¼Œä»ä¸åŒåœ°æ–¹è·å–åŒä¸€æ–‡ä»¶ä¸åŒåˆ†å—çš„æ•°æ®ï¼Œæé«˜æ–‡ä»¶ä¸‹è½½é€Ÿåº¦ï¼‰</p><p>æ¯”å¦‚ä¸€ä¸ªæ–‡ä»¶æœ‰1MBï¼Œé‚£ä¹ˆä½¿ç”¨PCDNï¼Œæˆ‘ä»¬å¯èƒ½æœåŠ¡å•†çš„ä»<strong>CDNæœåŠ¡å™¨</strong>æ‹‰å–äº†500KBï¼Œå†ä»ä¸Šå›¾ä¸­æ‰€ç¤ºçš„ä¸¤ä¸ªpeeridç«¯è·å–åˆ°äº†500KBæ•°æ®ï¼›</p><p>å› ä¸ºp2pä½¿ç”¨çš„æ˜¯ä¸ªäººçš„peerç»ˆç«¯èŠ‚ç‚¹ï¼Œä¸ä»…æ•°é‡å¤šï¼Œ<strong>ä¸”åˆ†å¸ƒæ¯”CDNæœåŠ¡å™¨æ›´å¹¿</strong>ï¼Œç†è®ºä¸Šæ¥è¯´è‡³å°‘èƒ½è·å¾—<strong>ç­‰åŒäº</strong>ä»…ä½¿ç”¨CDNæŠ€æœ¯çš„é€Ÿåº¦ä¼˜åŠ¿ï¼Œå¦‚æœç”¨æˆ·å¯ä»¥è¿æ¥åˆ°çš„peerè¾ƒå¤šï¼Œåˆ™é€Ÿåº¦å°±ä¼š<strong>å¤§äº</strong>ä»…ä½¿ç”¨CDNæŠ€æœ¯ï¼</p><p>è€Œè¿™äº›ä½œä¸ºpeerçš„åšç§ç«¯ï¼Œä¼šå®šæœŸä»CDNç¼“å­˜ä¸€éƒ¨åˆ†çƒ­é—¨æ•°æ®åˆ°æœ¬åœ°ï¼Œå¹¶ä¸ºå…¶ä»–ä¸è‡ªå·±å»ºç«‹P2Pé“¾æ¥çš„ç»ˆç«¯æä¾›æœåŠ¡ã€‚</p><blockquote><p>äº¬ä¸œäº‘è·¯ç”±å™¨ã€è¿…é›·çš„ç½‘å¿ƒäº‘ã€ç™¾åº¦äº‘ç›˜PCå®¢æˆ·ç«¯çš„é—²æ—¶å¸¦å®½ä¸Šä¼ ï¼Œå…¶å®éƒ½æ˜¯ä½¿ç”¨äº†PCDNæŠ€æœ¯çš„ç»ˆç«¯äº§å“ï¼Œå…¶ä¼šåœ¨å ç”¨ä¸€å°éƒ¨åˆ†ç”¨æˆ·å¸¦å®½çš„åŸºç¡€ä¸Šï¼Œç»™ç”¨æˆ·æä¾›äº¬è±†&#x2F;ç°é‡‘å¥–åŠ±ï¼›<br>ä½†æ˜¯PCDNä¼¼ä¹å’Œè¿è¥å•†çš„æ”¿ç­–å†²çªï¼Œå…·ä½“çš„å°±ä¸äº†è§£äº†ï¼Œæœ¬æ–‡åªæ˜¯æ¥å­¦ä¹ æŠ€æœ¯çš„ã€‚</p></blockquote><h3 id="2-2-2-ä¼˜ç‚¹"><a href="#2-2-2-ä¼˜ç‚¹" class="headerlink" title="2.2.2 ä¼˜ç‚¹"></a>2.2.2 ä¼˜ç‚¹</h3><p>ä»¥ä¸‹ä¼˜ç‚¹æ¥è‡ªé˜¿é‡Œäº‘é‚£ç¯‡æ–‡ç« </p><ul><li><p>ä»·æ ¼ä½ï¼šé€šè¿‡P2PæŠ€æœ¯å¯ä¸ºå®¢æˆ·æä¾›æ›´ä½æˆæœ¬çš„å†…å®¹åˆ†å‘æœåŠ¡ï¼Œï¼ˆä»¥å³°å€¼å¸¦å®½è®¡ä»·ï¼‰ä¸ºäº‘CDNä»·æ ¼çš„1&#x2F;2ï¼Œä¸ºä¼ ç»ŸCDNä»·æ ¼çš„1&#x2F;4ï¼Œå¯æ˜¾è‘—é™ä½å®¢æˆ·çš„åˆ†å‘æˆæœ¬ï¼›</p><p>å› ä¸ºä½¿ç”¨äº†æ›´å¤šP2PèŠ‚ç‚¹ï¼Œå‡è½»äº†CDNæœåŠ¡å™¨ã€æºç«™æœåŠ¡å™¨çš„ç½‘ç»œå¸¦å®½å‹åŠ›ï¼Œæ‰€ä»¥PCDNèƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šèµ·åˆ°é™æœ¬å¢æ•ˆçš„ä½œç”¨ã€‚</p></li><li><p>è´¨é‡å¥½ï¼šé€šè¿‡CDN+P2På¤šçº§èŠ‚ç‚¹è°ƒåº¦ï¼Œä¸€ä¸ªè¯·æ±‚å¯ç”±CDNå’Œå¤šä¸ªP2PæºåŒæ—¶æä¾›å†…å®¹ï¼Œé€šè¿‡èµ„æºå†—ä½™æé«˜äº†æœåŠ¡å¯ç”¨æ€§ï¼Œæ’­æ”¾æµç•…ç‡é«˜äºçº¯CDNï¼Œåœ¨å¤§æ–‡ä»¶ä¸‹è½½åœºæ™¯ä¸­æ›´æ˜¯èƒ½æå¤§æé«˜ä¸‹è½½é€Ÿåº¦ï¼›é€šè¿‡è°ƒç”¨æµ·é‡åˆ†å¸ƒå¼P2PèŠ‚ç‚¹ï¼Œ å¹³å‡æ’­æ”¾æµç•…ç‡ &gt; 97%ï¼Œå¹³å‡é¦–æ’­æ—¶é—´å°äº1ç§’ï¼Œç”¨æˆ·ä½“éªŒå¾—åˆ°æœ‰æ•ˆæå‡ã€‚</p></li><li><p>æˆç†Ÿç¨³å®šï¼šå¤šå¹´ä¸ºä¼˜é…·åœŸè±†æä¾›ä¼˜è´¨çš„è§†é¢‘æ’­æ”¾ã€ä¸‹è½½ç­‰åŠ é€ŸæœåŠ¡ï¼Œæ¥å…¥å¸¦å®½è¶…10Tï¼Œç»å†äº†æµ·é‡ç”¨æˆ·è§„æ¨¡çš„<strong>é•¿æ—¶é—´éªŒè¯</strong>ã€‚æ‹¥æœ‰å†…ç½‘ç©¿é€ã€ç¼“å­˜å¤„ç†ã€ç§å­ç®¡ç†ã€ä¼ è¾“ç­–ç•¥ç­‰å„æ–¹é¢çš„æ ¸å¿ƒæŠ€æœ¯å’Œä¸“åˆ©ï¼›ï¼ˆè¿™æ˜¯é˜¿é‡Œäº‘ç»™è‡ªå·±æ‰“çš„å¹¿å‘Šï¼‰</p></li></ul><p><img src="https://img.musnow.top/i/2023/08/16fb75b6c4dae42f968da0e5510cd069.png" alt="image-20230827135320425"></p><h2 id="2-3-å¸¸è§åè¯"><a href="#2-3-å¸¸è§åè¯" class="headerlink" title="2.3 å¸¸è§åè¯"></a>2.3 å¸¸è§åè¯</h2><p>ä»¥ä¸‹æ˜¯PCDNä¸­å¸¸è§çš„åè¯ï¼›è¿™é‡Œé¢æ¼äº†çš„ä¸€çº§èŠ‚ç‚¹æŒ‡çš„åº”è¯¥æ˜¯CDNæœåŠ¡å™¨ï¼›</p><p><img src="https://img.musnow.top/i/2023/08/121f5a17dd247d2ba0cd17676bf53139.png" alt="image-20230827134515066"></p><p>ç”±æ­¤å¯è§ï¼Œä¸Šæ–‡æåˆ°çš„äº¬ä¸œäº‘è·¯ç”±å™¨ã€è¿…é›·çš„ç½‘å¿ƒäº‘ï¼Œè¿™äº›å®¢æˆ·ç«¯åœ¨ç”¨æˆ·çš„ç”µè„‘å¯åŠ¨åï¼Œå…¶å°±æ˜¯ä½œä¸ºPCDNçš„<strong>ä¸‰çº§èŠ‚ç‚¹</strong>æ¥å…¥æ•´ä¸ªPCDNçš„ç½‘ç»œçš„ï¼Œå…¶æä¾›çš„ä¹Ÿæ˜¯ä¸‰çº§å¸¦å®½ï¼›</p><h2 id="2-4-åŸºç¡€æ¶æ„"><a href="#2-4-åŸºç¡€æ¶æ„" class="headerlink" title="2.4 åŸºç¡€æ¶æ„"></a>2.4 åŸºç¡€æ¶æ„</h2><p>å…³é”®ç»„ä»¶</p><ul><li>indexæœåŠ¡ï¼šå…¨å±€è°ƒåº¦ï¼ŒæŠŠç”¨æˆ·è¯·æ±‚è°ƒåº¦åˆ°æœ€ä½³çš„æœºæˆ¿</li><li>ZooKeeper (Global&amp;Local)ï¼šæœåŠ¡æ´»åŠ¨æƒ…å†µæ±‡æŠ¥ç»™è°ƒåº¦æœåŠ¡ï¼ŒåŠ¨æ€é…ç½®æ›´æ–°</li><li>Nignx Proxyï¼šæ”¯æŒç§æœ‰åè®®çš„Nginxä»£ç†æœåŠ¡ï¼Œé’ˆå¯¹ä¸åŒæ–‡ä»¶ä¸€è‡´æ€§Hashåˆ°ä¸åŒçš„ChannelæœåŠ¡</li><li>ChannelæœåŠ¡ï¼šè®°å½•æ–‡ä»¶å’Œæ‹¥æœ‰æ–‡ä»¶çš„ç«¯ç‚¹åœ°å€ä¿¡æ¯ï¼Œä¸ºä¸‹è½½æä¾›å°±è¿‘çš„ç«¯ç‚¹åœ°å€</li><li>RealyæœåŠ¡ï¼šæœåŠ¡P2På»ºç«‹è¿æ¥å’Œé€šè®¯</li><li>HotæœåŠ¡ï¼šhotæ–‡ä»¶å‘ç°å’Œæ¨é€</li></ul><p>ä»¥ä¸‹æ˜¯PCDNæŠ€æœ¯çš„æ¶æ„å›¾</p><p><img src="https://img.musnow.top/i/2023/08/459dd3bd580e337a248093066360ca91.png" alt="image-20230827135429913"></p><p>æ•´ä¸ªæŠ€æœ¯çš„æµç¨‹åœ¨ä¸Šæ–‡å·²ç»è®²è§£è¿‡äº†ã€‚è¿™é‡Œçš„æ¶æ„å›¾é˜¿é‡Œäº‘çš„æ–‡ç« å¹¶æ²¡æœ‰æä¾›æ›´å¤šçš„è¯´æ˜ï¼Œå…·ä½“çš„å°±å¾—åœ¨çœŸæ­£éœ€è¦å¼€å‘PCDNçš„æ—¶å€™åœ¨å…¬å¸å†…éƒ¨æ·±å…¥å­¦ä¹ äº†ã€‚</p><h2 id="2-5-é€‚ç”¨èŒƒå›´"><a href="#2-5-é€‚ç”¨èŒƒå›´" class="headerlink" title="2.5 é€‚ç”¨èŒƒå›´"></a>2.5 é€‚ç”¨èŒƒå›´</h2><p>PCDNäº§å“é€‚ç”¨äºè§†é¢‘ç‚¹æ’­ã€ç›´æ’­ã€å¤§æ–‡ä»¶ä¸‹è½½ç­‰ä¸šåŠ¡é¢†åŸŸã€‚</p><ul><li>è§†é¢‘ç‚¹æ’­ï¼šé•¿è§†é¢‘ç‚¹æ’­ï¼Œçƒ­åº¦é›†ä¸­çš„çŸ­è§†é¢‘ç‚¹æ’­ã€‚</li><li>è§†é¢‘ç›´æ’­ï¼šå¤§å‹æ™šä¼šèµ›äº‹ç›´æ’­ã€åœ°æ–¹ç½‘å°ç›´æ’­ã€ç§€åœºäº’åŠ¨ç›´æ’­ã€‚</li><li>å¤§æ–‡ä»¶ä¸‹è½½ï¼šè¶…è¿‡1MBä¸”çƒ­åº¦é›†ä¸­çš„çš„æ–‡ä»¶åˆ†å‘ï¼Œå¦‚åº”ç”¨å¸‚åœºåˆ†å‘ã€åœ¨çº¿éŸ³é¢‘åˆ†å‘ã€‚</li></ul><h1 id="3-SDN"><a href="#3-SDN" class="headerlink" title="3.SDN"></a>3.SDN</h1><p>SDNå…¨ç§°<code>Software Defined Network</code>ï¼Œæ¦‚å¿µæœ€æ—©ç”±æ–¯å¦ç¦å¤§å­¦çš„<code>Nick McKeown</code>æ•™æˆäº2009å¹´æå‡ºï¼›è°·æ­Œäº2010åˆ°2012å¹´å»ºç«‹çš„æ•°æ®ä¸­å¿ƒç½‘ç»œB4æ˜¯SDNçš„æˆåŠŸæ¡ˆä¾‹ï¼›</p><p>è¯¥æŠ€æœ¯å­¦ä¹ äºbç«™<a href="https://www.bilibili.com/video/BV15L411E7eE/?share_source=copy_web&vd_source=7fc715db968d24a91828ac8fad0e1ad8">ã€408 è®¡ç®—æœºç½‘ç»œæ–°å¢è€ƒç‚¹â€”è½¯ä»¶å®šä¹‰ç½‘ç»œSDNï¼ˆå­—å¹•ç‰ˆï¼‰ã€‘</a></p><h2 id="3-1-çœ‹çœ‹è·¯ç”±å™¨çš„åŠŸèƒ½"><a href="#3-1-çœ‹çœ‹è·¯ç”±å™¨çš„åŠŸèƒ½" class="headerlink" title="3.1 çœ‹çœ‹è·¯ç”±å™¨çš„åŠŸèƒ½"></a>3.1 çœ‹çœ‹è·¯ç”±å™¨çš„åŠŸèƒ½</h2><p>è·¯ç”±å™¨å…·å¤‡å¦‚ä¸‹åŠŸèƒ½</p><ul><li>æŠ¥æ–‡è½¬å‘</li><li>è·¯ç”±é€‰æ‹©</li></ul><p>åœ¨å½“å‰çš„è·¯ç”±å™¨æ¶æ„ä¸­ï¼Œåˆ†ä¸ºæ•°æ®å±‚é¢å’Œæ§åˆ¶å±‚é¢ã€‚</p><ul><li>ä¸ºäº†æ„å»ºå‡ºè‡ªå·±çš„è·¯ç”±è¡¨ï¼Œè·¯ç”±å™¨å¿…é¡»è¦å’Œå‘¨è¾¹çš„å…¶ä»–è·¯ç”±å™¨å®šæœŸé€šä¿¡ï¼Œæ‰èƒ½é€šè¿‡è‡ªå·±çš„è·¯ç”±ç®—æ³•è®¾ç½®å‡ºè·¯ç”±è¡¨ï¼Œå¹¶é€‰æ‹©æ­£ç¡®çš„è·¯ç”±è·¯å¾„ï¼ˆè¿™ä¸ªè€—æ—¶è¾ƒé•¿ï¼‰</li><li>åœ¨æ•°æ®å±‚é¢ï¼Œè·¯ç”±å™¨é‡‡ç”¨ç¡¬ä»¶ï¼ŒæŸ¥è¡¨è¿›è¡Œè½¬å‘ï¼ˆè€—æ—¶ä½ï¼‰</li></ul><p><img src="https://img.musnow.top/i/2023/08/f7ec770dd37e6f4a19c73cd9133cdf90.png" alt="image-20230827143545493"></p><blockquote><p><strong>åˆ†ç»„</strong>æ˜¯ç½‘ç»œä¸“æœ‰åè¯ã€‚å¤§å¤šæ•°<a href="https://baike.baidu.com/item/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/18763?fromModule=lemma_inlink">è®¡ç®—æœºç½‘ç»œ</a>éƒ½ä¸èƒ½è¿ç»­åœ°ä¼ é€ä»»æ„é•¿çš„æ•°æ®ï¼Œæ‰€ä»¥å®é™…ä¸Šç½‘ç»œç³»ç»ŸæŠŠ<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%88%86%E5%89%B2/4395664?fromModule=lemma_inlink">æ•°æ®åˆ†å‰²</a>æˆå°å—ï¼Œç„¶åé€å—åœ°å‘é€ï¼Œè¿™ç§å°å—å°±ç§°ä½œåˆ†ç»„ï¼ˆpacketï¼‰ã€‚ä¹Ÿæœ‰äº›ä¹¦ç±æŠŠåˆ†ç»„å®šä¹‰ä¸ºç½‘ç»œå±‚çš„<a href="https://baike.baidu.com/item/%E5%8D%8F%E8%AE%AE%E6%95%B0%E6%8D%AE%E5%8D%95%E5%85%83/8226389?fromModule=lemma_inlink">åè®®æ•°æ®å•å…ƒ</a>ã€‚</p><p>è¯´ç™½äº†åˆ†ç»„å°±æ˜¯ä¸€ä¸ªæŠ¥æ–‡ï¼</p></blockquote><h2 id="3-2-SDNæ ¸å¿ƒæ€æƒ³"><a href="#3-2-SDNæ ¸å¿ƒæ€æƒ³" class="headerlink" title="3.2 SDNæ ¸å¿ƒæ€æƒ³"></a>3.2 SDNæ ¸å¿ƒæ€æƒ³</h2><blockquote><p>SDNè¿™ç§æ–°å‹<strong>ç½‘ç»œä½“ç³»ç»“æ„</strong>çš„æ ¸å¿ƒæ€æƒ³ï¼Œæ˜¯å°†ç½‘ç»œçš„æ§åˆ¶å±‚å’Œæ•°æ®å±‚é¢ç»ç’ƒï¼Œè®©æ§åˆ¶å±‚å¯ä»¥é€šè¿‡è½¯ä»¶æ¥æ§åˆ¶æ•°æ®å±‚çš„è¾ƒå¤šè®¾å¤‡</p></blockquote><p>åœ¨SDNä½“ç³»ä¸­ï¼Œè·¯ç”±å™¨çš„è·¯ç”±è½¯ä»¶è¢«å‰¥ç¦»å¼€ï¼Œè·¯ç”±å™¨ä¹‹é—´ä¹Ÿä¸å†éœ€è¦äº¤æ¢è·¯ç”±ä¿¡æ¯ã€‚</p><ul><li>æ§åˆ¶å±‚é¢ï¼šæœ‰ä¸€ä¸ªé€»è¾‘ä¸Šé›†ä¸­çš„è¿œç¨‹æ§åˆ¶å™¨ï¼Œå¯¹å¤šä¸ªäº¤æ¢æœºè¿›è¡Œæ§åˆ¶ï¼›è¯¥è¿œç¨‹æ§åˆ¶å™¨å¯ä»¥ç”±å¤šå°ç‰©ç†ä¸»æœºç»„æˆ</li></ul><p>è¿œç¨‹æ§åˆ¶å™¨ä¼šæŒæ¡å„ä¸ªä¸»æœºå’Œæ•´ä¸ªç½‘ç»œä½“ç³»çš„çŠ¶æ€ï¼Œå¹¶ä¸ºæ¯ä¸€ä¸ªè·¯ç”±åˆ†ç»„è®¡ç®—å‡ºæœ€ä½³çš„è·¯ç”±ï¼Œå’Œç”Ÿæˆæ­£ç¡®çš„è½¬å‘è¡¨ï¼›è¿™æ—¶å€™ï¼Œåº•å±‚çš„è·¯ç”±å™¨ç¡¬ä»¶å°±ä»…ä»…éœ€è¦è¿›è¡ŒæŸ¥è¡¨è½¬å‘ï¼Œè€Œä¸éœ€è¦è¿›è¡Œè€—æ—¶çš„è·¯ç”±è¡¨ç”Ÿäº§å’Œç®—æ³•è®¡ç®—äº†ï¼Œå¤§å¤§å‡è½»äº†åº•å±‚äº¤æ¢æœºå’Œè·¯ç”±å™¨ç¡¬ä»¶çš„å‹åŠ›ã€‚</p><p><img src="https://img.musnow.top/i/2023/08/feb23bbf0d7ea8acff297ff8111488fa.png" alt="image-20230827145453526"></p><h2 id="3-3-OpenFlowåè®®"><a href="#3-3-OpenFlowåè®®" class="headerlink" title="3.3 OpenFlowåè®®"></a>3.3 OpenFlowåè®®</h2><p>OpenFlowåè®®æ˜¯ä¸€ä¸ªå—åˆ°é«˜åº¦è®¤å¯çš„æ ‡å‡†ï¼Œå…¶ä¸€èˆ¬åœ¨SDNä¸­è¿›è¡Œä½¿ç”¨ï¼Œä½†SDNå¹¶ä¸ä¸€å®šè¦ç”¨OpenFlowï¼›</p><blockquote><p>OpenFlowåè®®ç”±<strong>å¼€æ”¾ç½‘ç»œåŸºé‡‘ä¼šONF</strong>è´Ÿè´£æŒ‡å®šï¼Œè¯¥åŸºé‡‘ä¼šè‡´åŠ›äºSDNçš„å‘å±•å’Œæ ‡å‡†åŒ–ï¼›OpenFlowåè®®ç›®å‰è¾ƒä¸ºæˆç†Ÿçš„æ˜¯1.3ç‰ˆæœ¬</p></blockquote><p>OpenFlowåè®®æ˜¯SDNä½“ç³»ç»“æ„ä¸­ï¼Œæ§åˆ¶å±‚é¢å’Œæ•°æ®å±‚é¢ä¹‹é—´çš„é€šä¿¡æ¥å£ï¼Œè¯¥åè®®å¯ä»¥å…è®¸æ§åˆ¶å±‚é¢çš„æ§åˆ¶å™¨å¯¹æ•°æ®å±‚é¢çš„ç‰©ç†è®¾å¤‡è¿›è¡Œç›´æ¥çš„è®¿é—®å’Œæ§åˆ¶ã€‚</p><p><img src="https://img.musnow.top/i/2023/08/0c9a0b49911c437a7d31a4090004fa1a.png" alt="image-20230827145816552"></p><h2 id="3-4-è·¯ç”±è½¬å‘çš„åŒºåˆ«"><a href="#3-4-è·¯ç”±è½¬å‘çš„åŒºåˆ«" class="headerlink" title="3.4 è·¯ç”±è½¬å‘çš„åŒºåˆ«"></a>3.4 è·¯ç”±è½¬å‘çš„åŒºåˆ«</h2><h3 id="3-4-1-ä¼ ç»Ÿè·¯ç”±è¡¨"><a href="#3-4-1-ä¼ ç»Ÿè·¯ç”±è¡¨" class="headerlink" title="3.4.1 ä¼ ç»Ÿè·¯ç”±è¡¨"></a>3.4.1 ä¼ ç»Ÿè·¯ç”±è¡¨</h3><p>ä¼ ç»Ÿçš„è·¯ç”±è½¬å‘æ˜¯æŸ¥è¯¢è·¯ç”±è¡¨ï¼Œæ ¹æ®åœ°å€æ©ç è®¡ç®—ç›®çš„ç½‘ç»œï¼Œåˆ¤æ–­æ˜¯å¦ä¸å½“å‰æ¡ç›®åŒ¹é…ï¼Œå¦‚æœåŒ¹é…ï¼Œåˆ™ä»å¯¹åº”çš„ã€Œä¸‹ä¸€æ¡ã€ä¸­å‘é€å‡ºå»ã€‚</p><p>è·¯ç”±è½¬å‘è¿™éƒ¨åˆ†å†…å®¹åœ¨æˆ‘çš„IPåè®®è¯¦è§£åšå®¢ä¸­æœ‰æ‰€æ¶‰åŠï¼š<a href="https://blog.musnow.top/posts/3482559497/">ç‚¹æˆ‘</a></p><p><img src="https://img.musnow.top/i/2023/08/e154eeaf46fb0ce68d4ca6c6ea946920.png" alt="image-20230827150215508"></p><h3 id="3-4-2-SDNå¹¿ä¹‰è½¬å‘"><a href="#3-4-2-SDNå¹¿ä¹‰è½¬å‘" class="headerlink" title="3.4.2 SDNå¹¿ä¹‰è½¬å‘"></a>3.4.2 SDNå¹¿ä¹‰è½¬å‘</h3><p>SDNåœ¨è¿™åŸºç¡€ä¸Šæ–°å¢äº†æ›´å¤šçš„å†…å®¹ï¼Œç§°ä¸º<strong>å¹¿ä¹‰è½¬å‘</strong>ï¼š</p><ol><li>è¿›è¡ŒåŒ¹é…ï¼šèƒ½å¤Ÿå¯¹ç½‘ç»œä½“ç³»ç»“æ„ä¸­çš„å„å±‚ï¼ˆæ•°æ®é“¾è·¯å±‚ï¼Œç½‘ç»œå±‚ï¼Œä¼ è¾“å±‚ï¼‰é¦–éƒ¨ä¸­çš„å­—æ®µè¿›è¡ŒåŒ¹é…</li><li>æ‰§è¡ŒåŠ¨ä½œï¼šä¸ä»…è½¬å‘åˆ†ç»„ï¼Œè¿˜å¯ä»¥å®ç°è´Ÿè½½å‡è¡¡ã€é‡å†™IPé¦–éƒ¨ï¼ˆç±»ä¼¼NATä¸­çš„è·¯ç”±åœ°å€è½¬æ¢ï¼‰ã€äººä¸ºé˜»æŒ¡æˆ–ä¸¢å¼ƒä¸€äº›åˆ†ç»„ï¼ˆç±»ä¼¼é˜²ç«å¢™ï¼‰</li></ol><p>åœ¨SDNå¹¿ä¹‰è½¬å‘ä¸­ï¼Œå®Œæˆè¿™ä¸€æ“ä½œçš„è®¾å¤‡ä¸å†ç§°ä¸ºè·¯ç”±å™¨ï¼Œè€Œæ˜¯å«åšOpenFlowäº¤æ¢æœºï¼ˆæˆ–åˆ†ç»„äº¤æ¢æœºï¼‰ï¼Œä¹Ÿå¯ä»¥ç®€ç§°ä¸ºäº¤æ¢æœºã€‚</p><h3 id="3-4-3-æµè¡¨"><a href="#3-4-3-æµè¡¨" class="headerlink" title="3.4.3 æµè¡¨"></a>3.4.3 æµè¡¨</h3><p>åœ¨SDNä¸­æ›¿ä»£ äº†ä¼ ç»Ÿè·¯ç”±è¡¨çš„æ˜¯ã€Œæµè¡¨ï¼ˆFlow Tableï¼‰ã€</p><ul><li>ä¸€ä¸ªæµå°±æ˜¯æ•´ä¸ªç½‘ç»œä¸­çš„ä¸€ç»„åˆ†ç»„åºåˆ—ï¼Œåœ¨æ­¤åºåˆ—ä¸­çš„æ¯ä¸ªåˆ†ç»„éƒ½æ˜¯<code>å…±äº«åˆ†ç»„é¦–éƒ¨æŸäº›å­—æ®µçš„å€¼</code>ï¼Œä¾‹å¦‚ï¼ŒæŸä¸ªæµå¯ä»¥æ˜¯å…±äº«ç›¸åŒçš„æºIPå’Œç›®çš„IPåœ°å€çš„ä¸€è¿ä¸²åˆ†ç»„</li><li>OpenFlowäº¤æ¢æœºä¸­çš„åˆ˜è¡¨æ˜¯ç”±SDNè¿œç¨‹æ§åˆ¶å™¨æ¥ç®¡ç†çš„ï¼ŒSDNè¿œç¨‹æ§åˆ¶å™¨é€šè¿‡ä¸€ä¸ªå®‰å…¨ä¿¡é“ï¼Œé€šè¿‡OpenFlowåè®®æ¥ç®¡ç†OpenFlowäº¤æ¢æœºä¸­çš„æµè¡¨</li></ul><p><img src="https://img.musnow.top/i/2023/08/da25636e91b2ab521809adc0d568a7d4.png" alt="image-20230827150934738"></p><ul><li>æ¯ä¸ªOpenFlowäº¤æ¢æœºå¿…é¡»æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªæµè¡¨</li><li>æ¯ä¸€ä¸ªæµè¡¨åŒ…å«å¤šä¸ªæµè¡¨é¡¹ç›®</li><li>æ¯ä¸ªæµè¡¨é¡¹åŒ…å«ä¸‰ä¸ªå­—æ®µï¼šé¦–éƒ¨å­—æ®µå€¼ï¼ˆåŒ¹é…å­—æ®µï¼‰ã€è®¡æ•°å™¨ã€åŠ¨ä½œï¼ˆç±»ä¼¼ä¸‹ä¸€è·³ï¼‰</li></ul><p>OpenFlowçš„é¦–éƒ¨å­—æ®µå€¼è·¨è¶Šäº†ä¸‰ä¸ªå±‚æ¬¡çš„é¦–éƒ¨ï¼Œæ—¢å¯ä»¥å¤„ç†æ•°æ®é“¾è·¯å±‚çš„MACå¸§ï¼Œåˆå¯ä»¥å¤„ç†IPæŠ¥æ–‡ï¼Œæˆ–è€…æ˜¯TCP&#x2F;UDPçš„ç«¯å£</p><p><img src="https://img.musnow.top/i/2023/08/fa579c04d7c630a4b94a6158c1b0d384.png" alt="image-20230827151212669"></p><p>è®¡æ•°å™¨å­—æ®µåŒ…å«ä¸€ç»„è®¡æ•°å™¨</p><ul><li>è®°å½•å·²ç»ä¸è¯¥æµè¡¨é¡¹åŒ¹é…çš„åˆ†ç»„æ•°é‡çš„è®¡æ•°å™¨ï¼›</li><li>è®°å½•è¯¥æµè¡¨é¡¹ä¸Šæ¬¡æ›´æ–°åˆ°ç°åœ¨ç»å†çš„æ—¶é—´çš„è®¡æ•°å™¨</li></ul><p>åŠ¨ä½œå­—æ®µæ˜¯ä¸€æ—åŠ¨ä½œï¼Œå½“åˆ†ç»„åŒ¹é…åˆ°æŸä¸ªæµè¡¨é¡¹æ—¶ï¼Œæ‰§è¡Œä¸‹æ–¹çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªåŠ¨ä½œ</p><ul><li>æŠŠåˆ†ç»„è½¬å‘åˆ°æŒ‡å®šçš„ç«¯å£</li><li>ä¸¢å¼ƒåˆ†ç»„</li><li>æŠŠåˆ†ç»„è¿›è¡Œå¤åˆ¶åï¼Œä»å¤šä¸ªç«¯å£è½¬å‘å‡ºå»</li><li>é‡å†™åˆ†ç»„ä¸­çš„é¦–éƒ¨å­—æ®µ</li></ul><h3 id="3-4-4-VLAN"><a href="#3-4-4-VLAN" class="headerlink" title="3.4.4 VLAN"></a>3.4.4 VLAN</h3><blockquote><p>å…³äºè¯¥æŠ¥æ–‡ä¸­VLANéƒ¨åˆ†å¯ä»¥æŸ¥çœ‹æ­¤åšå®¢ï¼š<a href="https://blog.csdn.net/LawssssCat/article/details/127204720">https://blog.csdn.net/LawssssCat/article/details/127204720</a></p></blockquote><p>VLANæ˜¯ä¸€ç§ç”¨äºè¿›ä¸€æ­¥è™šæ‹ŸåŒ–åˆ’åˆ†å±€åŸŸç½‘çš„æ–¹å¼ï¼Œå‡å¦‚ä¸€å°è·¯ç”±å™¨æœ‰4ä¸ªç½‘å£ï¼Œå…¶å¯ä»¥é€šè¿‡å°†LAN1å’ŒLAN2è®¾ç½®æˆVLAN10ï¼ŒLAN3å’ŒLAN4è®¾ç½®æˆVLAN20æ¥æ¨¡æ‹Ÿå‡ºä¸¤ä¸ªå±€åŸŸç½‘</p><p><img src="https://img.musnow.top/i/2023/08/8cfceb7090ae21914683d034f680f485.png" alt="image-20230827153454860"></p><p>vlanï¼ˆvirtual lanï¼‰æŠ€æœ¯æä¾›äº†ä¸€ç§çµæ´»çš„è§£å†³æ–¹æ¡ˆï¼›å°†äº¤æ¢æœºçš„æ¥å£æ ¹æ®ä¸šåŠ¡éœ€è¦æ·»åŠ åˆ°ä¸åŒçš„vlanä¸­ï¼Œä»è€Œå®ç°äºŒå±‚éš”ç¦»ã€‚</p><ul><li>éš”ç¦»å¹¿æ’­åŸŸï¼Œå³å¹¿æ’­åŒ…åªåœ¨æœ¬ vlan ä¸­ä¼ æ’­ï¼Œä»è€Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥æé«˜æ•´ä¸ªç½‘ç»œçš„å¤„ç†èƒ½åŠ›ï¼›</li><li>æé«˜å®‰å…¨æ€§ï¼Œä¸€ä¸ª vlan å†…çš„ç”¨æˆ·å’Œå…¶ä»– vlan å†…çš„ç”¨æˆ·ä¸èƒ½äº’è®¿ï¼Œæé«˜äº†ç½‘ç»œçš„å®‰å…¨æ€§ï¼›</li><li>å¢åŠ å¸¦å®½åˆ©ç”¨&#x2F;é™ä½å»¶è¿Ÿ&#x2F;ç®¡ç†ä½œç”¨</li></ul><h2 id="3-5-ä¸¾ä¾‹"><a href="#3-5-ä¸¾ä¾‹" class="headerlink" title="3.5 ä¸¾ä¾‹"></a>3.5 ä¸¾ä¾‹</h2><h3 id="3-5-1-ç®€å•è½¬å‘"><a href="#3-5-1-ç®€å•è½¬å‘" class="headerlink" title="3.5.1 ç®€å•è½¬å‘"></a>3.5.1 ç®€å•è½¬å‘</h3><p>é€šè¿‡ä¸åŒçš„æµè¡¨é¡¹æ¥è®¾ç½®è½¬å‘è·¯å¾„å’Œè½¬å‘åŠ¨ä½œï¼ŒåŠ¨ä½œä¸­çš„<code>è½¬å‘(3)</code>ä»£è¡¨ä»è¯¥äº¤æ¢æœºçš„3å·ç«¯å£è½¬å‘å‡ºå»ã€‚ç«¯å£å·åœ¨å›¾ä¸­æœ‰æ ‡æ³¨ï¼›</p><p><img src="https://img.musnow.top/i/2023/08/6faaa19507feedb4784efd2c5a5ac376.png" alt="image-20230827151650945"></p><h3 id="3-5-2-è´Ÿè½½å‡è¡¡"><a href="#3-5-2-è´Ÿè½½å‡è¡¡" class="headerlink" title="3.5.2 è´Ÿè½½å‡è¡¡"></a>3.5.2 è´Ÿè½½å‡è¡¡</h3><p>ç¬¬äºŒä¸ªæ —å­æ˜¯è´Ÿè½½å‡è¡¡çš„æ —å­ï¼Œåœ¨ä¸‹é¢çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬æƒ³è¦H3å‘é€çš„åˆ†ç»„é€šè¿‡<code>S2-S1-S3-H5/H6</code>ï¼Œè¦H4å‘é€çš„åˆ†ç»„é€šè¿‡<code>S2-S3-H5/H6</code>ï¼›ä»¥è¾¾åˆ°è´Ÿè½½å‡è¡¡çš„ç›®çš„ã€‚</p><p><img src="https://img.musnow.top/i/2023/08/5f152f13954536e40cb1b6b815f0c9ad.png" alt="image-20230827151718483"></p><p>ä½¿ç”¨ä¼ ç»Ÿçš„æºIPå’Œç›®çš„IPçš„è½¬å‘æ–¹å¼ï¼Œæ— æ³•å®ç°è¿™æ ·çš„è´Ÿè½½å‡è¡¡ã€‚åœ¨ä¼ ç»Ÿåœºæ™¯ä¸‹ï¼Œå½“S2åœ¨æ•°æ®é“¾è·¯å±‚å‘ç°ç›®çš„MACåœ°å€æ˜¯S3çš„MACåœ°å€çš„æ—¶å€™ï¼Œæ— è®ºå¦‚ä½•éƒ½ä¼šç›´æ¥å‘é€ç»™S3ï¼Œè€Œä¸æ˜¯ä»S1å¤„ç»•è·¯ã€‚</p><p>ä½†åœ¨SDNåœºæ™¯ä¸­ï¼Œå°±å¯ä»¥é€šè¿‡ä¸¤ä¸ªä¸åŒçš„æµè¡¨é¡¹æ¥è§„å®šä¸åŒè½¬å‘åŠ¨ä½œï¼Œå®ç°è¿™æ ·çš„è´Ÿè½½å‡è¡¡ï¼ˆè¿™é‡Œçš„<code>è½¬å‘(4)</code>ä»£è¡¨ä»S2çš„4å·ç«¯å£è½¬å‘å‡ºå»ï¼‰</p><p><img src="https://img.musnow.top/i/2023/08/2d076ac5eca2dc6f7480020f2e0fd57f.png" alt="image-20230827151948106"></p><h3 id="3-5-3-é˜²ç«å¢™"><a href="#3-5-3-é˜²ç«å¢™" class="headerlink" title="3.5.3 é˜²ç«å¢™"></a>3.5.3 é˜²ç«å¢™</h3><p>å¦‚æœæˆ‘ä»¬æƒ³è®©S2ä¸»æœºåªæ¥æ”¶æ¥è‡ªS1çš„æ•°æ®è€Œä¸æ¥å—S3çš„æ•°æ®ï¼Œå°±å¯ä»¥é€šè¿‡åªè®¾ç½®S1çš„æºIPåœ°å€çš„æµè¡¨é¡¹ï¼Œæ¥ä¸¢å¼ƒS3å‘é€çš„æ•°æ®ï¼ˆåŒ¹é…ä¸ä¸Šçš„æ•°æ®å°±ä¼šè¢«ä¸¢å¼ƒï¼‰</p><p><img src="https://img.musnow.top/i/2023/08/f7be65147a7d7897ae6d4402ad2d8f26.png" alt="image-20230827152217555"></p><h2 id="3-6-SDNä½“ç³»ç»“æ„çš„ç‰¹å¾"><a href="#3-6-SDNä½“ç³»ç»“æ„çš„ç‰¹å¾" class="headerlink" title="3.6 SDNä½“ç³»ç»“æ„çš„ç‰¹å¾"></a>3.6 SDNä½“ç³»ç»“æ„çš„ç‰¹å¾</h2><p>ä¸‹å›¾ä¸­åŒ…å«äº†SDNçš„ä½“ç³»ç»“æ„ä¸€è§ˆå›¾å’ŒSDNçš„å››ä¸ªå…³é”®ç‰¹å¾</p><ol><li>åŸºäºæµçš„è½¬å‘</li><li>æ•°æ®å±‚é¢ä¸æ§åˆ¶å±‚é¢åˆ†ç¦»</li><li>ä½äºæ•°æ®å±‚é¢åˆ†ç»„äº¤æ¢æœºä¹‹å¤–çš„ç½‘ç»œæ§åˆ¶åŠŸèƒ½</li><li>å¯ç¼–ç¨‹çš„ç½‘ç»œ</li></ol><p>å…¶ä¸­ï¼ŒSDNæ§åˆ¶å™¨æ˜¯è¿™ä¸ªæ¶æ„ä¸­æœ€å¤æ‚çš„è®¾å¤‡ï¼Œå…¶é€šè¿‡å—å‘APIæ§åˆ¶åº•å±‚çš„OpenFlowäº¤æ¢æœºï¼Œé€šè¿‡åŒ—å‘APIæ¥å—å…¶ä»–ç½‘ç»œæ§åˆ¶å™¨çš„ç­–ç•¥é…ç½®ã€‚</p><p><img src="https://img.musnow.top/i/2023/08/a6678beda5464d34757501e8cc95580e.png" alt="image-20230827152358531"></p><h3 id="3-6-1-SDNæ§åˆ¶å™¨"><a href="#3-6-1-SDNæ§åˆ¶å™¨" class="headerlink" title="3.6.1 SDNæ§åˆ¶å™¨"></a>3.6.1 SDNæ§åˆ¶å™¨</h3><p>SDNæ§åˆ¶å™¨å¯ä»¥åˆ†æˆä¸‰ä¸ªå±‚æ¬¡</p><ul><li>å…¶é€šä¿¡å±‚é€šè¿‡OpenFlowåè®®ä¸äº¤æ¢æœºé€šä¿¡</li><li>ä¸­é—´é—´æ¥æ ¹æ®å„ç§ç­–ç•¥ç®¡ç†å„ä¸ªäº¤æ¢æœº</li><li>åŒ—å‘APIæ¥æ”¶æ¥è‡ªå…¶ä»–æ§åˆ¶ç­–ç•¥å‘èµ·ç«¯çš„é…ç½®</li></ul><p><img src="https://img.musnow.top/i/2023/08/46dc0f081cfa38af5ea0d3d89e0ccc68.png" alt="image-20230827152554869"></p><p>è¿™é‡Œä½¿ç”¨çš„<code>RESTful API </code>æ˜¯åŸºäºHTTPçš„APIï¼Œä¹Ÿæ˜¯æˆ‘ä»¬è¾ƒå¸¸è§çš„APIæ¥å£ï¼›</p><h3 id="3-6-2-å¼€æºSDNæ§åˆ¶å™¨"><a href="#3-6-2-å¼€æºSDNæ§åˆ¶å™¨" class="headerlink" title="3.6.2 å¼€æºSDNæ§åˆ¶å™¨"></a>3.6.2 å¼€æºSDNæ§åˆ¶å™¨</h3><p>å¸¸ç”¨çš„å¼€æºSDNæ§åˆ¶å™¨æœ‰OPEN DAYLIGHTå’ŒONOSï¼›</p><h3 id="3-6-3-SDNçš„ä¼˜åŠ¿"><a href="#3-6-3-SDNçš„ä¼˜åŠ¿" class="headerlink" title="3.6.3 SDNçš„ä¼˜åŠ¿"></a>3.6.3 SDNçš„ä¼˜åŠ¿</h3><blockquote><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/as12138/article/details/131273381">https://blog.csdn.net/as12138/article/details/131273381</a></p></blockquote><p>SDNç›¸æ¯”äºä¼ ç»Ÿç½‘ç»œæ¶æ„ï¼Œæœ‰è®¸å¤šä¼˜ç‚¹å’Œä¼˜åŠ¿ã€‚</p><ol><li><p>é«˜åº¦å¯ç¼–ç¨‹æ€§ï¼šSDNæ¶æ„ä¸­çš„æ§åˆ¶å™¨è´Ÿè´£ç®¡ç†äº¤æ¢æœºå’Œè·¯ç”±å™¨ï¼Œä½¿å¾—ç½‘ç»œæ›´åŠ å¯ç¼–ç¨‹ã€å¯é…ç½®ã€‚ç®¡ç†å‘˜å¯ä»¥é€šè¿‡æ§åˆ¶å™¨å®ç°çµæ´»è°ƒæ•´ç½‘ç»œæ‹“æ‰‘ã€ç®¡ç†æµé‡å’Œé…ç½®æµè°ƒåº¦ç­–ç•¥ï¼Œæå‡ç½‘ç»œçš„å¯æ¼”å˜æ€§ã€å¯å®šåˆ¶åŒ–å’Œå¯ä¼¸ç¼©æ€§ã€‚</p></li><li><p>ç½‘ç»œæ™ºèƒ½é›†ä¸­åŒ–ï¼šåœ¨SDNä¸­ï¼Œç½‘ç»œæ™ºèƒ½è¢«é›†ä¸­åœ¨æ§åˆ¶å™¨ä¸­ï¼Œé€šè¿‡æ§åˆ¶å™¨è¿›è¡Œé›†ä¸­å¼ç®¡ç†å’Œæ§åˆ¶ã€‚è¿™ç§åˆ†ç¦»çš„æ¨¡å¼é¿å…äº†ç½‘ç»œè®¾å¤‡ä¸­ä»»åŠ¡çš„å¤æ‚ï¼Œæå‡äº†ç½‘ç»œçš„å¯ç®¡ç†æ€§å’Œå¯æ§åˆ¶æ€§ã€‚æ­¤å¤–ï¼Œé›†ä¸­åŒ–çš„ç®¡ç†æ–¹å¼ä¹Ÿå¯ä»¥åœ¨ç½‘ç»œä¸­é—´ä»¶å’Œåº”ç”¨ä¸­å®ç°æ™ºèƒ½æ§åˆ¶ï¼Œå¦‚åˆ†å¸ƒå¼å­˜å‚¨ã€äº‘è®¡ç®—ç­‰ã€‚</p></li><li><p>å¯æ‰©å±•æ€§ï¼šSDNä¸­çš„ç½‘ç»œè®¾å¤‡æ˜¯é€šç”¨çš„ç¡¬ä»¶è®¾å¤‡ï¼Œä¸éœ€è¦ç‰¹å®šçš„åŠŸèƒ½åŒºåˆ†ï¼ŒåŒæ—¶ä¹Ÿä¸éœ€è¦æ›´æ–°ç¡¬ä»¶ï¼Œåªéœ€æ›´æ–°æ§åˆ¶å™¨å³å¯å®ç°æ‹“æ‰‘å¯ä¼¸ç¼©å’Œçµæ´»çš„ç½‘ç»œç®¡ç†ã€‚</p></li><li><p>è‡ªåŠ¨åŒ–å’Œæé«˜æ•ˆç‡ï¼šSDNä¸­å¯ä»¥å®ç°ç½‘ç»œçš„è‡ªåŠ¨åŒ–ï¼Œé€šè¿‡æ§åˆ¶å™¨è¿›è¡Œè‡ªåŠ¨åŒ–çš„ç½‘ç»œç®¡ç†ï¼Œå¯ä»¥é¿å…æ‰‹åŠ¨ç®¡ç†ç½‘ç»œçš„å±€é™æ€§å’Œä¸ç¡®å®šæ€§ï¼Œä»è€Œæé«˜ç½‘ç»œçš„æ•ˆç‡å’Œç¨³å®šæ€§ï¼ŒåŒæ—¶ï¼Œè‡ªåŠ¨åŒ–ç½‘ç»œç®¡ç†ä¹Ÿå¯ä»¥é™ä½ç½‘ç»œç»´æŠ¤çš„æˆæœ¬å’Œæ—¶é—´ã€‚</p></li><li><p>å®‰å…¨å¯é æ€§æå‡ï¼šç½‘ç»œå®‰å…¨å’Œå¯é æ€§æ˜¯ä¼ä¸šç½‘ç»œä¸­æœ€åŸºæœ¬çš„éœ€æ±‚ã€‚ä¼ ç»Ÿçš„ç½‘ç»œå®‰å…¨å¾€å¾€éœ€è¦é€šè¿‡ä¸€äº›ç‰¹å®šè®¾å¤‡å’Œåè®®æ¥å®ç°ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒSDNä¸­çš„æ§åˆ¶å™¨å¯ä»¥æ ¹æ®ç½‘ç»œå®æ—¶çŠ¶æ€è‡ªåŠ¨ä¼˜åŒ–ç®¡ç†ç­–ç•¥ï¼Œå®‰å…¨å¯é çš„æ–¹å¼æ¥æé«˜ç½‘ç»œçš„å®‰å…¨æ€§ã€‚</p></li></ol><p>æ€»ä¹‹ï¼ŒSDNçš„ä¼˜åŠ¿åœ¨äºå…¶çµæ´»çš„å¯ç¼–ç¨‹æ€§ã€é›†ä¸­å¼æ™ºèƒ½ç®¡ç†ã€é«˜æ•ˆçš„è‡ªåŠ¨åŒ–ç½‘ç»œç®¡ç†å’Œå¢å¼ºç½‘ç»œå®‰å…¨æ€§ã€‚ä»¥ä¸Šä¼˜åŠ¿ä¹Ÿæ˜¯SDNæŠ€æœ¯åº”ç”¨å¹¿æ³›çš„ä¸»è¦åŸå› ï¼Œè¶Šæ¥è¶Šå¤šçš„ä¼ä¸šå’Œç»„ç»‡å°†SDNæŠ€æœ¯åº”ç”¨åˆ°è‡ªå·±çš„ç½‘ç»œæ¶æ„ä¸­ï¼Œä»¥æ»¡è¶³æœªæ¥ç½‘ç»œçš„éœ€æ±‚å’ŒæŒ‘æˆ˜ã€‚</p><h2 id="3-6-4-SDNåº”ç”¨å‰æ™¯"><a href="#3-6-4-SDNåº”ç”¨å‰æ™¯" class="headerlink" title="3.6.4 SDNåº”ç”¨å‰æ™¯"></a>3.6.4 SDNåº”ç”¨å‰æ™¯</h2><p>SDNæŠ€æœ¯ç›®å‰å·²ç»å®ç°äº†åŸºç¡€ç½‘ç»œé…ç½®ã€æµæ§åˆ¶ã€ç½‘ç»œå®‰å…¨ç­‰åŠŸèƒ½ã€‚åœ¨æœªæ¥ï¼ŒSDNæŠ€æœ¯è¿˜ä¼šé¢ä¸´æ›´å¤šçš„æŒ‘æˆ˜å’Œæœºé‡ã€‚</p><ol><li><p>5Gæ—¶ä»£ï¼š5GæŠ€æœ¯å°†ä¼šæ”¹å˜ç½‘ç»œçš„é¢è²Œï¼ŒåŠ é€Ÿç‰©è”ç½‘åº”ç”¨çš„æ™®åŠã€‚SDNä½œä¸ºæ¶æ„çµæ´»ã€å¯ç¼–ç¨‹çš„ç½‘ç»œæ–¹å¼ï¼Œå°†ä¼šåœ¨5Gç½‘ç»œä¸­å‘æŒ¥é‡è¦ä½œç”¨ï¼Œå®ç°ç½‘ç»œçš„è‡ªåŠ¨åŒ–å’Œæ™ºèƒ½åŒ–ç®¡ç†ã€‚</p></li><li><p>IoTè®¾å¤‡ï¼šç‰©è”ç½‘æŠ€æœ¯å¸¦æ¥å¤§é‡è®¾å¤‡çš„è¿æ¥ï¼ŒSDNæŠ€æœ¯çš„ä»·å€¼åœ¨äºè‡ªåŠ¨åŒ–äº†ç‰©è”ç½‘è®¾å¤‡çš„ç®¡ç†ã€å®‰å…¨å’Œç›‘æ§ã€‚æœªæ¥ï¼ŒSDNæŠ€æœ¯å°†ä¼šæˆä¸ºç‰©è”ç½‘ç®¡ç†çš„é‡è¦å·¥å…·ã€‚</p></li><li><p>AIï¼šéšç€äººå·¥æ™ºèƒ½çš„å‘å±•ï¼ŒSDNçš„ä¸šç•Œåº”ç”¨å·²ç»å¼€å§‹å¤§è§„æ¨¡è½åœ°ã€‚è¿™å°†åŠ é€Ÿæ™ºèƒ½äº¤é€šã€æ™ºèƒ½åŸå¸‚å’Œè‡ªåŠ¨é©¾é©¶ç­‰é¢†åŸŸçš„å‘å±•ã€‚</p></li><li><p>é›†æˆæ–°æŠ€æœ¯ï¼šSDNå¯ä»¥å¾ˆå®¹æ˜“åœ°ä¸å…¶ä»–æŠ€æœ¯ç›¸ç»“åˆï¼Œä¾‹å¦‚NFVï¼ˆç½‘ç»œåŠŸèƒ½è™šæ‹ŸåŒ–ï¼‰å’ŒAIï¼ˆäººå·¥æ™ºèƒ½ï¼‰ï¼Œä»¥æé«˜ç½‘ç»œçš„æ•ˆç‡å’Œé€‚åº”æ€§ã€‚</p></li><li><p>äº‘è®¡ç®—ï¼šSDNæŠ€æœ¯çš„çµæ´»æ€§å’Œå¯ç¼–ç¨‹æ€§ï¼Œä¹Ÿä½¿å¾—SDNä¸äº‘è®¡ç®—ç­‰æ–°æŠ€æœ¯çš„ç»“åˆå˜å¾—æ›´åŠ è‡ªç„¶ã€‚åœ¨æœªæ¥ï¼ŒSDNæŠ€æœ¯å°†ä¸äº‘æŠ€æœ¯ç´§å¯†ç»“åˆï¼Œå®ç°ä¸šåŠ¡æµç¨‹çš„è‡ªåŠ¨åŒ–ã€å¿«é€Ÿåº”ç”¨éƒ¨ç½²å’Œå¼¹æ€§äº‘èµ„æºç®¡ç†ã€‚</p></li></ol><p>æ€»è€Œè¨€ä¹‹ï¼ŒSDNæŠ€æœ¯å°†ä¸ºæœªæ¥ç½‘ç»œçš„å‘å±•å’Œå®ç°å„ç§åº”ç”¨æä¾›æ”¯æ’‘ã€‚åœ¨æ—¥ç›Šå¢é•¿çš„ç½‘ç»œéœ€æ±‚å’Œå¤æ‚çš„ç½‘ç»œæŠ€æœ¯èƒŒæ™¯ä¸‹ï¼ŒSDNçš„çµæ´»æ€§å’Œé«˜å¯ç”¨æ€§å°†ä¼šå¸¦æ¥æ›´å¤§çš„å‘å±•ç©ºé—´å’Œå¸‚åœºéœ€æ±‚ã€‚SDNæŠ€æœ¯åº”å½“ç»§ç»­ç ”ç©¶å’Œå‘å±•ï¼Œä»¥æ»¡è¶³æ›´å¤šçš„ç½‘ç»œéœ€æ±‚å’ŒæŒ‘æˆ˜ã€‚</p><h2 id="3-7-æ€»ç»“"><a href="#3-7-æ€»ç»“" class="headerlink" title="3.7 æ€»ç»“"></a>3.7 æ€»ç»“</h2><p><img src="https://img.musnow.top/i/2023/08/3a0e7fd1ff2494f51ec6121d4a60e108.png" alt="image-20230827152810972"></p>]]></content>
    
    
    <summary type="html">æœ´å®çš„å­¦ä¹ åŸå› ï¼šäº¬ä¸œå®ä¹ ç”Ÿæ‹›è˜æ¡ç›®ä¸Šå†™äº†è¿™äº›æŠ€æœ¯ï¼Œé‚£å°±ç»™ä»–å­¦äº†ï¼</summary>
    
    
    
    <category term="å·®ç”Ÿæ–‡å…·å¤š" scheme="https://blog.musnow.top/categories/%E5%B7%AE%E7%94%9F%E6%96%87%E5%85%B7%E5%A4%9A/"/>
    
    
    <category term="CDN" scheme="https://blog.musnow.top/tags/CDN/"/>
    
    <category term="SDN" scheme="https://blog.musnow.top/tags/SDN/"/>
    
    <category term="P2P" scheme="https://blog.musnow.top/tags/P2P/"/>
    
  </entry>
  
  <entry>
    <title>ã€APIã€‘APIçš„å„ç§åˆ†ç±»è¯¦è§£</title>
    <link href="https://blog.musnow.top/posts/73383828/"/>
    <id>https://blog.musnow.top/posts/73383828/</id>
    <published>2023-08-26T12:15:18.000Z</published>
    <updated>2023-08-26T12:15:18.000Z</updated>
    
    <content type="html"><![CDATA[<p>APIï¼Œå³åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿åº”ç”¨ç¨‹åºä¹‹é—´çš„æ•°æ®å’ŒåŠŸèƒ½äº¤äº’è€Œè®¾è®¡çš„ä¸€äº›æ ‡å‡†æ–¹æ³•ã€‚API çš„åˆ†ç±»å¯ä»¥ä»å¤šä¸ªç»´åº¦è¿›è¡Œï¼Œæˆ‘ä¼šå¯¹ API çš„åˆ†ç±»ç»´åº¦è¿›è¡Œç®€å•çš„ä»‹ç»ã€‚</p><span id="more"></span><h2 id="æ ¹æ®ä½¿ç”¨æ–¹å¼çš„ä¸åŒ"><a href="#æ ¹æ®ä½¿ç”¨æ–¹å¼çš„ä¸åŒ" class="headerlink" title="æ ¹æ®ä½¿ç”¨æ–¹å¼çš„ä¸åŒ"></a>æ ¹æ®ä½¿ç”¨æ–¹å¼çš„ä¸åŒ</h2><p>é€šå¸¸æƒ…å†µä¸‹ï¼ŒAPI å¯ä»¥åˆ†ä¸ºä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼šå†…éƒ¨ API å’Œå¤–éƒ¨ APIã€‚</p><p>å†…éƒ¨ API æ˜¯æŒ‡ä¾›ä¼ä¸šå†…éƒ¨å¼€å‘äººå‘˜å’Œåº”ç”¨æ‰€ä½¿ç”¨çš„ APIã€‚å½“ä¼ä¸šéœ€è¦ä¸€äº›å®šåˆ¶åŒ–çš„åº”ç”¨ç¨‹åºæˆ–è€…é›†æˆç‰¹å®šçš„åŠŸèƒ½æ—¶ï¼Œå†…éƒ¨ API å¯ä»¥æä¾›æ›´å¥½çš„æŠ€æœ¯æ”¯æŒï¼ŒåŒæ—¶ä¹Ÿèƒ½ä¿è¯æ•°æ®çš„å®‰å…¨æ€§å’Œå¯é æ€§ã€‚</p><p>å¤–éƒ¨ API åˆ™æ˜¯ä¾›å…¬ä¼—å¼€å‘è€…ä½¿ç”¨çš„ APIï¼Œé€šè¿‡æä¾›æ•°æ®å’ŒæœåŠ¡ï¼Œä½¿å¾—å¤–éƒ¨çš„å¼€å‘è€…å¯ä»¥æ„å»ºä¸°å¯Œçš„åº”ç”¨ç¨‹åºå¹¶ä¸å½“å‰çš„ç”Ÿæ€ç³»ç»Ÿè¿›è¡Œåä½œã€‚è¶Šæ¥è¶Šå¤šçš„å„ç±»å…¬å¸éƒ½å¼€å§‹å‘å…¬ä¼—æä¾›è‡ªå·±çš„ APIï¼Œç¤ºä¾‹åŒ…æ‹¬ Facebookã€Twitterã€Google ç­‰ã€‚</p><h2 id="æ ¹æ®è®¿é—®æ–¹å¼çš„ä¸åŒ"><a href="#æ ¹æ®è®¿é—®æ–¹å¼çš„ä¸åŒ" class="headerlink" title="æ ¹æ®è®¿é—®æ–¹å¼çš„ä¸åŒ"></a>æ ¹æ®è®¿é—®æ–¹å¼çš„ä¸åŒ</h2><p>æ ¹æ® API çš„è®¿é—®æ–¹å¼ï¼ŒAPI å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>RESTful API RESTï¼ˆRepresentational State Transferï¼‰æ˜¯ä¸€ç§åŸºäº HTTP åè®®çš„ Web åº”ç”¨ç¨‹åºæ¶æ„æ ‡å‡†ã€‚RESTful API éµå¾ª RESTful æ¶æ„çš„åŸåˆ™ï¼Œé€šå¸¸ç”±èµ„æºè·¯å¾„å’Œè¯·æ±‚æ–¹æ³•ç»„æˆï¼Œä»¥è¾¾åˆ°å¯è¯»æ€§é«˜ã€çµæ´»æ€§å¥½çš„ç›®çš„ã€‚</li><li>SOAP API SOAPï¼ˆSimple Object Access Protocolï¼‰æ˜¯ä¸€ç§åŸºäº XML ç¼–ç çš„è¿œç¨‹è°ƒç”¨åè®®ï¼Œæ¯”è¾ƒå¤æ‚è€Œä¸”å¤„ç†æ—¶é—´å’Œç½‘ç»œèµ„æºä½¿ç”¨ç‡é«˜ã€‚è™½ç„¶ SOAP æŠ€æœ¯å·²ç»é€æ¸æ·¡å‡ºå¸‚åœºï¼Œä½†åœ¨æŸäº›ç‰¹æ®Šåœºæ™¯ä¸‹ä»ç„¶ä¼šæœ‰æ‰€åº”ç”¨ã€‚</li><li>GraphQL API GraphQL æ˜¯ç”± Facebook å…¬å¸å¼€æºçš„ä¸€ç§æ•°æ®æŸ¥è¯¢è¯­è¨€å’Œ API æ‰§è¡Œå¼•æ“ï¼Œå¯ä»¥å‘ˆç°å‡º XML schema æ¥è¡¨è¾¾æ•´ä¸ªæ•°æ®çš„ç»“æ„ï¼Œå¹¶ä¸ºå‰ç«¯å·¥ç¨‹å¸ˆæä¾›è‡ªç”±å®šä¹‰è·å–æ‰€éœ€å±æ€§ã€ä»£ç é‡ç”¨ç­‰äººæ€§åŒ–çš„ç‰¹è‰²ã€‚</li><li>gRPC API gRPC å¯ä»¥ç†è§£ä¸º Google Remote Procedure Callï¼Œæ˜¯ Google æœ€æ–°å¼€æºçš„è·¨è¯­è¨€ RPC æ¡†æ¶ã€‚å€ŸåŠ©åŸºäº HTTP&#x2F;2 çš„äºŒè¿›åˆ¶ä¼ è¾“åè®®ï¼ŒgRPC æä¾›äº†æ¯” JSON å’Œ RESTful æ›´å¿«é€Ÿå’Œæ›´å¯é çš„é€šè®¯æ–¹å¼ã€‚</li></ul><h2 id="æ ¹æ®åŠŸèƒ½çš„ä¸åŒ"><a href="#æ ¹æ®åŠŸèƒ½çš„ä¸åŒ" class="headerlink" title="æ ¹æ®åŠŸèƒ½çš„ä¸åŒ"></a>æ ¹æ®åŠŸèƒ½çš„ä¸åŒ</h2><p>æ ¹æ® API çš„åŠŸèƒ½æ€§è´¨ï¼ŒAPI å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š</p><ul><li>Web API Web API ä¸€èˆ¬éƒ½é’ˆå¯¹ Web åº”ç”¨ç¨‹åºï¼Œæä¾›ä¸€äº›æ ‡å‡†çš„æ¥å£ï¼Œä¾‹å¦‚ï¼šW3C DOM æ¥å£ã€HTTP æ¥å£ã€WebSocket æ¥å£ã€Web Worker æ¥å£ç­‰ã€‚è¿™äº› API å¸®åŠ©æµè§ˆå™¨å–å¾—ç”¨æˆ·å…ƒç´ ä¿¡æ¯ã€å‘é€ AJAX è¯·æ±‚ç­‰ç­‰ã€‚</li><li>æ“ä½œç³»ç»Ÿ API æ“ä½œç³»ç»Ÿ APIï¼ˆå¦‚ Windows API æˆ– POSIX APIï¼‰æä¾›äº†ä¸æ“ä½œç³»ç»Ÿè½¯ä»¶äº¤äº’çš„æ–¹æ³•ï¼Œå…è®¸åº”ç”¨ç¨‹åºæŸ¥è¯¢åŠæ§åˆ¶ç¡¬ä»¶è®¾å¤‡æˆ–æ“ä½œç³»ç»Ÿå†…æ ¸ä»»åŠ¡ç­‰ã€‚æ­¤ç±» API å‡ ä¹é€‚ç”¨äºä»»ä½•ç±»å‹çš„ç¯å¢ƒã€‚</li><li>æ•°æ®åº“ API æ•°æ®åº“ API å¯ä»¥ä½¿åº”ç”¨ç¨‹åºé€šè¿‡æŸäº› API å®ç°å¯¹ä¸€äº›æ•°æ®å­˜å‚¨çš„æ“ä½œï¼Œä¾‹å¦‚ï¼šSQLã€NoSQL ç­‰æ•°æ®åº“é‡Œéƒ½æœ‰ç›¸å…³çš„ API è°ƒç”¨ã€‚</li></ul><p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼ŒAPI æ”¯æŒè®¿é—®ä¸åŒçš„åŠŸèƒ½æ¨¡å—ï¼Œä¾‹å¦‚æ•°æ®è½¬æ¢ã€æ•°æ®åˆ†æã€ç½‘ç»œå®‰å…¨ã€é—¨æˆ·ç®¡ç†ã€æ—¥å†ç­‰ç­‰ï¼Œè¿˜å¯ä»¥æ ¹æ®ä¸åŒçš„éœ€æ±‚è¿›è¡Œå®¢åˆ¶åŒ–çš„å¼€å‘ã€‚</p><p>æ€»ä¹‹ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åˆé€‚çš„ API ç±»å‹æ˜¯éå¸¸é‡è¦çš„ï¼Œèƒ½å¤Ÿå¿«é€Ÿã€é«˜æ•ˆåœ°æ„å»ºéœ€è¦çš„åº”ç”¨ç¨‹åºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€Œluffy_feã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚</span><br><span class="line">åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/qq_42107247/article/details/130508490</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;APIï¼Œå³åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿åº”ç”¨ç¨‹åºä¹‹é—´çš„æ•°æ®å’ŒåŠŸèƒ½äº¤äº’è€Œè®¾è®¡çš„ä¸€äº›æ ‡å‡†æ–¹æ³•ã€‚API çš„åˆ†ç±»å¯ä»¥ä»å¤šä¸ªç»´åº¦è¿›è¡Œï¼Œæˆ‘ä¼šå¯¹ API çš„åˆ†ç±»ç»´åº¦è¿›è¡Œç®€å•çš„ä»‹ç»ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="API" scheme="https://blog.musnow.top/tags/API/"/>
    
  </entry>
  
  <entry>
    <title>ã€Linuxã€‘é«˜çº§IOå’Œå¤šè·¯è½¬æ¥ | select/poll/epoll</title>
    <link href="https://blog.musnow.top/posts/3390191280/"/>
    <id>https://blog.musnow.top/posts/3390191280/</id>
    <published>2023-08-25T00:22:36.000Z</published>
    <updated>2023-08-25T04:05:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¤šè·¯è½¬æ¥å’Œé«˜çº§IO</p><span id="more"></span><p>å’³å’³ï¼Œå†™çš„æ—¶å€™å‡ºäº†ç‚¹é—®é¢˜ï¼Œæ ‡ç‚¹ç¬¦å·å…¨ä¹±äº†ï¼ˆæ‰¹é‡æ›¿æ¢äº†å‡ æ¬¡ï¼‰ï¼Œå¹²è„†å°±æŠŠå…¨æ–‡çš„é€—å·å’Œå¥å·éƒ½æ”¹æˆè‹±æ–‡çš„äº†ï¼ˆä¸ç„¶ä»£ç å—é‡Œé¢çš„ä»£ç éƒ½æ˜¯ä¸­æ–‡æ ‡ç‚¹å°±è·‘ä¸åŠ¨äº†ï¼‰</p><h1 id="1-é«˜çº§IO"><a href="#1-é«˜çº§IO" class="headerlink" title="1.é«˜çº§IO"></a>1.é«˜çº§IO</h1><h2 id="1-1-äº”ç§IOæ¨¡å‹"><a href="#1-1-äº”ç§IOæ¨¡å‹" class="headerlink" title="1.1 äº”ç§IOæ¨¡å‹"></a>1.1 äº”ç§IOæ¨¡å‹</h2><p>ç”¨é’“é±¼ä½¬çš„æ —å­, æ¥çœ‹çœ‹äº”ç§ä¸åŒçš„IOæ¨¡å‹å§</p><ul><li>A, æ‹¿ç€é±¼ç«¿å»é’“é±¼, ä¸€ç›´ç›¯ç€é±¼æ¼‚, é±¼æ¼‚æœ‰åŠ¨é™å°±æ”¶é’©</li><li>B, æ‹¿ç€é±¼ç«¿å»é’“é±¼, æ—¶ä¸æ—¶çœ‹çœ‹é±¼æ¼‚, æœ‰åŠ¨é™å°±æ”¶è´­</li><li>C, æ‹¿ç€é±¼ç«¿å»é’“é±¼, åœ¨é±¼æ¼‚ä¸Šå¼„ä¸ªé“ƒé“›, ç„¶åå¹²å…¶ä»–çš„äº‹æƒ…, å¬åˆ°é“ƒé“›çš„å£°éŸ³å°±æ”¶é’©</li><li>D, æ‹¿äº†ä¸€å¤§å †é±¼ç«¿è¿‡æ¥, éƒ½æ‘†å¼„å¥½, åªè¦æœ‰ä¸€ä¸ªé±¼æ¼‚æœ‰åŠ¨é™, å°±æ”¶é’©</li><li>Eæ˜¯å¤§è€æ¿, ç›´æ¥å«äººå¸®å¿™é’“é±¼, é’“åˆ°ä¸€å®šæ•°é‡çš„ğŸŸåé€šçŸ¥è‡ªå·±, è‡ªå·±è¿‡æ¥å–ğŸŸï¼ˆæ²¡æœ‰å‚ä¸é’“é±¼è¿‡ç¨‹ï¼‰</li></ul><p>è¿™äº”ç§é’“é±¼æ–¹å¼, å°±å¯¹åº”äº†äº”ç§IOæ¨¡å‹</p><ul><li>A, <strong>é˜»å¡ç­‰å¾…</strong>, ç­‰å¾…åˆ°æ•°æ®å°±ç«‹å³è¯»å–</li><li>B, <strong>è½®è¯¢æ£€æµ‹</strong>, æ£€æµ‹åˆ°æ•°æ®çš„æ—¶å€™è¯»å–</li><li>C, åˆ©ç”¨é“ƒé“›æ¥ä½œä¸ºé€šçŸ¥æ–¹å¼, å¬åˆ°äº†ä¿¡å·ä¹‹å, å°±å»è¯»å–æ•°æ®ï¼ˆ<strong>ä¿¡å·é©±åŠ¨</strong>ï¼‰</li><li>D, ä¸€æ¬¡æ€§æ£€æµ‹å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆ<strong>å¤šè·¯è½¬æ¥</strong>ï¼‰</li><li>E, æ²¡æœ‰è‡ªå·±å‚ä¸é’“é±¼è¿‡ç¨‹, æœ‰åˆ«äººå¸®å¿™ç›‘æ§æ–‡ä»¶æè¿°ç¬¦, è‡ªå·±åªå…³å¿ƒæ‹¿èµ°æ•°æ®ï¼ˆ<strong>å¼‚æ­¥IO</strong>ï¼‰</li></ul><p>åœ¨è¿™äº”ç§IOæ¨¡å¼ä¸­, <strong>Dçš„æ•ˆç‡æ˜¯æœ€é«˜çš„</strong>ã€‚å› ä¸ºå®ƒä¸€æ¬¡æ€§ç›‘æ§äº†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦, è¿™äº›æ–‡ä»¶æè¿°ç¬¦çš„IOåœ¨ä¸€å®šç¨‹åº¦ä¸Šé‡åˆäº†, æ›´å®¹æ˜“ç­‰åˆ°æ•°æ®ã€‚</p><p>è¦çŸ¥é“, Dæ˜¯è¿‡æ¥é’“é±¼çš„, ä»–åªè¦èƒ½é’“åˆ°é±¼å°±å¤Ÿäº†, å¹¶ä¸ç”¨å…³å¿ƒåˆ°åº•æ˜¯å“ªä¸ªé±¼é’©é’“ä¸Šæ¥çš„é±¼ã€‚åŒç†, æˆ‘ä»¬çš„IOæœåŠ¡å™¨ä¹Ÿå¹¶ä¸éœ€è¦å…³å¿ƒåˆ°åº•æ˜¯å“ªä¸ªæ–‡ä»¶æè¿°ç¬¦åœ¨ç»™è‡ªå·±ä¼ é€’ä¿¡æ¯, æˆ‘ä»¬åªè¦æ¯æ—¶æ¯åˆ»éƒ½åœ¨å¤„ç†ä¿¡æ¯ï¼ˆéƒ½èƒ½é’“åˆ°é±¼ï¼‰æ‰æ˜¯æœ€é«˜æ•ˆç‡çš„ä½“ç°ã€‚</p><p>æ¢å¥è¯è¯´, åœ¨é’“é±¼ï¼ˆå¤„ç†IOï¼‰çš„æ—¶å€™, ç­‰çš„æ—¶é—´æ¯”ä¾‹è¶Šä½, æ•ˆç‡è¶Šé«˜ï¼</p><h2 id="1-2-é˜»å¡å’Œéé˜»å¡"><a href="#1-2-é˜»å¡å’Œéé˜»å¡" class="headerlink" title="1.2 é˜»å¡å’Œéé˜»å¡"></a>1.2 é˜»å¡å’Œéé˜»å¡</h2><p>è¿™ä¸¤ä¸ªæ¦‚å¿µæˆ‘ä»¬åœ¨å…ˆå‰å¯¹IOçš„å­¦ä¹ ä¸­å·²ç»è§è¿‡äº†</p><ul><li>é˜»å¡ï¼šè¿›ç¨‹ä¼šåœ¨å‡½æ•°è°ƒç”¨ä¸­å¡ä½, åœ¨æ²¡æœ‰æˆåŠŸè°ƒç”¨ä¹‹å‰ä¸ä¼šç»§ç»­å‘åè¿è¡Œ</li><li>éé˜»å¡ï¼šä¸ç®¡èƒ½å¦è·å–åˆ°æ•°æ®, å‡½æ•°éƒ½æ˜¯ç›´æ¥è¿”å›ç»“æœ;</li></ul><h2 id="1-3-å¼‚æ­¥ä¸åŒæ­¥é€šä¿¡"><a href="#1-3-å¼‚æ­¥ä¸åŒæ­¥é€šä¿¡" class="headerlink" title="1.3 å¼‚æ­¥ä¸åŒæ­¥é€šä¿¡"></a>1.3 å¼‚æ­¥ä¸åŒæ­¥é€šä¿¡</h2><ul><li>å¼‚æ­¥é€šä¿¡ï¼šåœ¨è°ƒç”¨å‘å‡ºå, è¿™ä¸ªè°ƒç”¨ç›´æ¥è¿”å›, å¹¶æ²¡æœ‰æºå¸¦ç»“æœ;ç±»ä¼¼<code>std::async/future</code>, åœ¨è°ƒç”¨å‘å‡ºå, è¢«è°ƒç”¨ç€é€šè¿‡çŠ¶æ€æˆ–é€šçŸ¥æ¥å‘ŠçŸ¥è°ƒç”¨è€…, äº¦æˆ–è€…æ˜¯ç”¨å›è°ƒå‡½æ•°æ¥å¤„ç†è¿™ä¸ªå¼‚æ­¥è°ƒç”¨</li><li>åŒæ­¥é€šä¿¡ï¼šåœ¨å‘å‡ºè°ƒç”¨å, æ²¡æœ‰å¾—åˆ°ç»“æœå‰, è¯¥è°ƒç”¨ä¸è¿”å›;ä¸€æ—¦è¿”å›å°±è¡¨æ˜è¯¥è°ƒç”¨æˆåŠŸè·å–åˆ°äº†è¿”å›å€¼ï¼ˆè°ƒç”¨è€…ä¸»åŠ¨ç­‰å¾…è°ƒç”¨ç»“æœï¼‰</li></ul><p>è¿™é‡Œçš„åŒæ­¥å’Œçº¿ç¨‹&#x2F;è¿›ç¨‹åŒæ­¥å¹¶ä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼š</p><ul><li>çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒæ­¥æŒ‡çš„æ˜¯çº¿ç¨‹å’Œè¿›ç¨‹ä¹‹é—´æœ‰ç›¸äº’åˆ¶çº¦çš„å…³ç³», éœ€è¦åœ¨æŸäº›æƒ…å†µä¸­åè°ƒä»–ä»¬çš„å·¥ä½œæ¬¡åºè€Œè¿›è¡Œç­‰å¾…</li></ul><hr><p>äº†è§£å®ŒIOæ¨¡å‹å’Œä¸Šæ–¹çš„çŸ¥è¯†å, ä¸‹é¢å°±è®©æˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹ç¬¬ä¸€ä¸ªæ¥å£å§ï¼</p><h1 id="2-fcntl"><a href="#2-fcntl" class="headerlink" title="2.fcntl"></a>2.fcntl</h1><p>è¿™ä¸ªæ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨, å¯ä»¥ç»™æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œä¸åŒçš„ç­–ç•¥è®¾ç½®ã€‚</p><p>å½“æˆ‘ä»¬åœ¨linuxä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„æ—¶å€™, é»˜è®¤åˆ›å»ºçš„éƒ½æ˜¯é˜»å¡çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>fcntl</code>æ¥å°†æ–‡ä»¶æè¿°ç¬¦è®¾ç½®æˆ<strong>éé˜»å¡</strong>çš„ã€‚</p><h2 id="2-1-æ¥å£"><a href="#2-1-æ¥å£" class="headerlink" title="2.1 æ¥å£"></a>2.1 æ¥å£</h2><p>è¯¥å‡½æ•°çš„åŸå‹å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">fcntl</span><span class="params">(<span class="type">int</span> fd, <span class="type">int</span> cmd, ... <span class="comment">/* arg */</span> )</span>;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­cmdæ˜¯æˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„ç­–ç•¥, ä¸‹é¢æ˜¯å¸¸è§çš„å‡ ç§é€‰é¡¹</p><ul><li>å¤åˆ¶ä¸€ä¸ªç°æœ‰çš„æè¿°ç¬¦ï¼ˆcmd&#x3D;F_DUPFDï¼‰</li><li>è·å¾—&#x2F;è®¾ç½®æ–‡ä»¶æè¿°ç¬¦æ ‡è®°(cmd&#x3D;F_GETFDæˆ–F_SETFD)</li><li>è·å¾—&#x2F;è®¾ç½®æ–‡ä»¶çŠ¶æ€æ ‡è®°(cmd&#x3D;F_GETFLæˆ–F_SETFL)</li><li>è·å¾—&#x2F;è®¾ç½®å¼‚æ­¥I&#x2F;Oæ‰€æœ‰æƒ(cmd&#x3D;F_GETOWNæˆ–F_SETOWN)</li><li>è·å¾—&#x2F;è®¾ç½®è®°å½•é”(cmd&#x3D;F_GETLK, F_SETLKæˆ–F_SETLKW)</li></ul><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ç¬¬ä¸‰ä¸ªåŠŸèƒ½, æ¥è·å–å’Œè®¾ç½®æ–‡ä»¶çš„çŠ¶æ€æ ‡è®°, å°±å¯ä»¥å°†æ–‡ä»¶æè¿°ç¬¦è®¾ç½®ä¸ºéé˜»å¡ï¼ˆè¿™é‡Œè¦æ³¨æ„, ä¸æ˜¯ç”¨ç¬¬äºŒç§ï¼‰</p><h2 id="2-2-è®¾ç½®éé˜»å¡"><a href="#2-2-è®¾ç½®éé˜»å¡" class="headerlink" title="2.2 è®¾ç½®éé˜»å¡"></a>2.2 è®¾ç½®éé˜»å¡</h2><p>æˆ‘ä»¬éœ€è¦å…ˆå°†æ–‡ä»¶æè¿°ç¬¦åŸæœ¬çš„å±æ€§ç»™å–å‡ºæ¥, ç„¶åå†åŠ ä¸Šéé˜»å¡çš„çŠ¶æ€, ä½¿ç”¨<code>fcntl</code>è®¾ç½®å±æ€§ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">SetNoBlock</span><span class="params">(<span class="type">int</span> fd)</span> </span><br><span class="line">&#123; </span><br><span class="line">    <span class="type">int</span> fl = fcntl(fd, F_GETFL);  <span class="comment">// å…ˆè·å–æ–‡ä»¶å·²æœ‰çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">if</span> (fl &lt; <span class="number">0</span>) &#123; </span><br><span class="line">       perror(<span class="string">&quot;fcntl error&quot;</span>);</span><br><span class="line">       <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åœ¨å·²æœ‰çŠ¶æ€çš„åŸºç¡€ä¸Š, è®¾ç½®O_NONBLOCKéé˜»å¡</span></span><br><span class="line">    fcntl(fd, F_SETFL, fl | O_NONBLOCK);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-3-stdinæµ‹è¯•"><a href="#2-3-stdinæµ‹è¯•" class="headerlink" title="2.3 stdinæµ‹è¯•"></a>2.3 stdinæµ‹è¯•</h2><p>ç„¶å, æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªä¼šå‡ºç°é˜»å¡çš„æ–‡ä»¶æè¿°ç¬¦æ¥ä½œä¸ºæµ‹è¯•ã€‚ä½†æ˜¯, å¦‚æœæ˜¯ç›´æ¥æ‰“å¼€ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶, å¹¶ä¸ä¼šå‡ºç°é˜»å¡æ€ï¼ˆå› ä¸ºæ–‡ä»¶æµä¼šè¢«ä¸€æ¬¡æ€§è¯»å–å‡ºæ¥ï¼‰</p><p>ä¸è¿‡, åœ¨æˆ‘ä»¬æœ€å¸¸ç”¨çš„3ä¸ªé»˜è®¤æ–‡ä»¶æè¿°ç¬¦ä¸­, å°±æœ‰ä¸€ä¸ªæ˜¯èƒ½å¤Ÿå®ç°è¿›ç¨‹é˜»å¡çš„, å®ƒå°±æ˜¯<code>stdin</code>, å› ä¸ºåœ¨æ§åˆ¶å°é‡Œé¢ç­‰å¾…ç”¨æˆ·è¾“å…¥çš„æ—¶å€™, è¿›ç¨‹å°±æ˜¯å¤„äºé˜»å¡çŠ¶æ€çš„ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">è¯·è¾“å…¥ï¼š</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥å°è¯•å°†stdinè®¾ç½®ä¸ºéé˜»å¡, æ¥è§‚å¯Ÿä¸€ä¸‹ç»“æœ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">SetNoBlock</span>(stdin-&gt;_fileno);</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">ssize_t</span> read_size = <span class="built_in">read</span>(stdin-&gt;_fileno, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(read_size &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;read err&quot;</span>);</span><br><span class="line">            <span class="built_in">sleep</span>(<span class="number">2</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;input:%s\n&quot;</span>, buf);</span><br><span class="line">        buf[<span class="number">0</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘è¿è¡Œ, å½“æ²¡æœ‰è¯»å–åˆ°è¾“å…¥å†…å®¹çš„æ—¶å€™, å¹¶ä¸ä¼šåœ¨<code>stdin</code>ä¸­é˜»å¡, è€Œæ˜¯ä¼šé€šè¿‡perroræ‰“å°å‡ºèµ„æºæš‚æ—¶ä¸å¯ç”¨çš„è­¦å‘Šä¿¡æ¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">read err: Resource temporarily unavailable</span><br><span class="line">asdlfjklaf</span><br><span class="line">input:asdlfjklaf</span><br><span class="line"></span><br><span class="line">read err: Resource temporarily unavailable</span><br><span class="line">adslfkjaldfjklasjfa</span><br><span class="line">input:adslfkjaldfjklasjfa</span><br><span class="line">a</span><br><span class="line">read err: Resource temporarily unavailable</span><br><span class="line">ewqrqreqqrwer</span><br><span class="line">input:ewqrqreqqrwer</span><br><span class="line">asjfa</span><br><span class="line">a</span><br><span class="line">read err: Resource temporarily unavailable</span><br><span class="line">qweioruqoruioqewur</span><br><span class="line">input:qweioruqoruioqewur</span><br><span class="line"></span><br><span class="line">a</span><br><span class="line">read err: Resource temporarily unavailable</span><br><span class="line">weqioruqoieuotqitqwertq</span><br><span class="line">input:weqioruqoieuotqitqwertq</span><br><span class="line">ï¿½ï¿½ï¿½ï¿½a</span><br><span class="line">read err: Resource temporarily unavailable</span><br><span class="line">^C</span><br></pre></td></tr></table></figure><h1 id="3-å¤šè·¯è½¬æ¥ä¹‹select"><a href="#3-å¤šè·¯è½¬æ¥ä¹‹select" class="headerlink" title="3.å¤šè·¯è½¬æ¥ä¹‹select"></a>3.å¤šè·¯è½¬æ¥ä¹‹select</h1><p>æ¥ä¸‹æ¥å°±è¦è¿›å…¥æˆ‘ä»¬çš„æ­£é¢˜äº†, å…³äº<strong>å¤šè·¯è½¬æ¥</strong>çš„çŸ¥è¯†ã€‚</p><p>åœ¨ä¹‹å‰çš„æ—¶å€™, æˆ‘ä»¬å¦‚æœæƒ³åœ¨ä¸€ä¸ªè¿›ç¨‹é‡Œé¢ç»´æŠ¤å¤šä¸ªtcpé“¾æ¥, å°±éœ€è¦ç”¨åˆ°å­çº¿ç¨‹æˆ–è€…å­è¿›ç¨‹æ¥å•ç‹¬ä¸ºæ¯ä¸€ä¸ªç”¨æˆ·æä¾›æœåŠ¡ã€‚<strong>ä½†ä¸€ä¸ªè¿›ç¨‹å¯ä»¥å¼€çš„çº¿ç¨‹æ˜¯æœ‰æ•°é‡é™åˆ¶çš„</strong>, åœ¨32ä½ç³»ç»Ÿä¸­, è¿™ä¸ªæ•°å­—å¤§æ¦‚æ˜¯2000ã€‚</p><p>å¯¹äºä¸€ä¸ªé«˜å¹¶å‘çš„æœåŠ¡å™¨æ¥è¯´, è¿™ç‚¹çº¿ç¨‹æ•°æ˜¯å®Œå…¨ä¸å¤Ÿç”¨çš„ï¼å¦‚æœä½ çš„ç½‘ç«™ä¸€æ¬¡æ€§æœ‰2000ä¸ªäººè®¿é—®, ä½ çš„æœåŠ¡å™¨å°±ä¼šå› ä¸ºå¼€ä¸å‡ºæ›´å¤šçš„çº¿ç¨‹è€Œæ— æ³•ä¸ºæ›´å¤šçš„ç”¨æˆ·æä¾›æœåŠ¡ï¼</p><p>æ‰€ä»¥, <strong>å¤šè·¯è½¬æ¥</strong>å°±å‡ºç°äº†, ä»–èƒ½å¸®æˆ‘ä»¬å®ç°å•ä¸ªè¿›ç¨‹ç›‘æ§å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦, åŒæ—¶ä¸ºå¤šä¸ªsocketé“¾æ¥æä¾›æœåŠ¡çš„æ“ä½œï¼</p><blockquote><p>æ™®é€šçš„æœ¬åœ°æ–‡ä»¶æè¿°ç¬¦ä¹Ÿæ˜¯å¯ä»¥æ‰˜ç®¡ç»™å¤šè·¯è½¬æ¥çš„ï¼</p></blockquote><h2 id="3-1-è®¤è¯†select"><a href="#3-1-è®¤è¯†select" class="headerlink" title="3.1 è®¤è¯†select"></a>3.1 è®¤è¯†select</h2><p>selectçš„å‡½æ•°åŸå‹å’Œæˆ‘ä»¬ä¹‹å‰æ¥è§¦è¿‡çš„linuxç³»ç»Ÿè°ƒç”¨æ¥å£éƒ½ä¸å¤§ç›¸ä¼¼, å®ƒçš„æ‰€æœ‰å‚æ•°éƒ½æ˜¯è¾“å…¥è¾“å‡ºå‹å‚æ•°, è€Œä¸”è¿˜ç”¨åˆ°äº†ä¸€ä¸ªæˆ‘ä»¬å¹³æ—¶è¾ƒå°‘æ¥è§¦çš„æ•°æ®ç»“æ„â€”â€”ä½å›¾</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* According to POSIX.1-2001, POSIX.1-2008 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/select.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">select</span><span class="params">(<span class="type">int</span> nfds, fd_set *readfds, fd_set *writefds, </span></span></span><br><span class="line"><span class="params"><span class="function">           fd_set *exceptfds, <span class="keyword">struct</span> timeval *timeout)</span></span>;</span><br></pre></td></tr></table></figure><p>å…ˆæ¥ä¾æ¬¡è¯´æ˜ä¸€ä¸‹æ¯ä¸€ä¸ªå‚æ•°çš„ä½œç”¨å§</p><ul><li><code>nfds</code>ï¼šéœ€è¦selectå¸®æˆ‘ä»¬ç›‘è§†çš„<code>æœ€å¤§æ–‡ä»¶æè¿°ç¬¦+1</code></li><li><code>readfds/writefds/exceptfds</code>, éœ€è¦selectå¸®æˆ‘ä»¬æ£€æµ‹çš„è¯»&#x2F;å†™&#x2F;å¼‚å¸¸æ–‡ä»¶æè¿°ç¬¦ï¼ˆé€šè¿‡<strong>ä½å›¾</strong>æ¥è®¾å®šï¼‰</li><li><code>timeout</code>ï¼šé˜»å¡ç›‘æ§çš„æ—¶é•¿, ç”¨æ¥è®¾ç½®selectå•æ¬¡é˜»å¡ç­‰å¾…çš„æ—¶é—´</li></ul><h3 id="3-1-1-timeval"><a href="#3-1-1-timeval" class="headerlink" title="3.1.1 timeval"></a>3.1.1 timeval</h3><p>é¦–å…ˆæ¥çœ‹çœ‹timeoutçš„è¿™ä¸ªå‚æ•°çš„<code>struct timeval</code>ç»“æ„ä½“æ¡†æ¶, å†…éƒ¨åŒ…å«ä¸¤ä¸ªæˆå‘˜å˜é‡, ä¸€ä¸ªè¡¨ç¤ºç§’æ•°, ä¸€ä¸ªè¡¨ç¤ºå¾®ç§’æ•°ã€‚æœ€ç»ˆselectç­‰å¾…çš„æ—¶é—´æ˜¯è¿™ä¸¤ä¸ªå‚æ•°çš„<strong>å’Œ</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> &#123;</span></span><br><span class="line">    <span class="type">long</span>    tv_sec;         <span class="comment">/* seconds */</span></span><br><span class="line">    <span class="type">long</span>    tv_usec;        <span class="comment">/* microseconds */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœè®¾ç½®æˆ0, åˆ™ä»…æ£€æµ‹æ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€, ä¸ç®¡ä»€ä¹ˆæƒ…å†µéƒ½ä¼šç«‹å³è¿”å›ï¼ˆå®Œå…¨éé˜»å¡ï¼‰</li><li>å¦‚æœè®¾ç½®æˆæŒ‡å®šçš„æ—¶é—´, åˆ™ä¼šé˜»å¡ç­‰å¾…è¿™ç«¯æ—¶é—´, å¦‚æœæœ‰æ–‡ä»¶äº‹ä»¶åˆ™è¿”å›;å¦‚æœæ²¡æœ‰ç­‰åˆ°æ–‡ä»¶æ—¶é—´, é‚£ä¹ˆæ—¶é—´åˆ°äº†å°±ä¼šè¿”å›</li><li>å¦‚æœå°†<code>timeout</code>å‚æ•°è®¾ç½®æˆ<code>nullptr</code>, åˆ™ä¼š<strong>é˜»å¡ç­‰å¾…</strong></li></ul><p>è¿™ä¸ªå‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ªè¾“å…¥è¾“å‡ºå‹å‚æ•°, è¿”å›å€¼ä¸ºå‰©ä½™çš„ç§’æ•°ï¼ˆå¦‚æœç­‰å¾…æˆåŠŸçš„è¯ï¼‰</p><h3 id="3-1-2-fd-set"><a href="#3-1-2-fd-set" class="headerlink" title="3.1.2 fd_set"></a>3.1.2 fd_set</h3><p>å‡½æ•°ä¸­æœ‰3ä¸ªå‚æ•°éƒ½æ˜¯ç”¨åˆ°äº†è¿™ä¸ª<code>fd_set</code>ç»“æ„, å®ƒæ˜¯ä¸€ä¸ªä½å›¾ç»“æ„, åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªè¾“å…¥è¾“å‡ºå‚æ•°</p><ul><li>è¾“å…¥ï¼šç”¨æˆ·å‘Šè¯‰æ“ä½œç³»ç»Ÿ, éœ€è¦å¸®æˆ‘ç›‘æ§é‚£å‡ ä¸ªæ–‡ä»¶æè¿°ç¬¦, åœ¨éœ€è¦ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦ä¸Šç½®1</li><li>è¾“å‡ºï¼šç³»ç»Ÿå‘Šè¯‰ç”¨æˆ·, é‚£äº›æ–‡ä»¶æè¿°ç¬¦çš„ç›¸å…³äº‹ä»¶å°±ç»ªäº†</li></ul><p>è™½ç„¶è¿™æ˜¯ä¸€ä¸ªä½å›¾ç»“æ„, ä½†å…¶å¹¶ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»è®¾ç½®, æ“ä½œç³»ç»Ÿé¡ºä¾¿å¸®æˆ‘ä»¬å°è£…äº†ç›¸å…³çš„è®¾ç½®â€œå‡½æ•°â€, åªéœ€è¦ä¼ å…¥fdå’Œè¯¥ç»“æ„ä½“å³å¯</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">FD_CLR</span><span class="params">(<span class="type">int</span> fd, fd_set *set)</span></span>;  <span class="comment">// æ¸…ç©ºä½å›¾ä¸­å¯¹è¯¥æ–‡ä»¶æè¿°ç¬¦çš„è®¾ç½®</span></span><br><span class="line"><span class="function"><span class="type">int</span>  <span class="title">FD_ISSET</span><span class="params">(<span class="type">int</span> fd, fd_set *set)</span></span>;<span class="comment">// åˆ¤æ–­æ˜¯å¦è¢«è®¾ç½®äº†</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FD_SET</span><span class="params">(<span class="type">int</span> fd, fd_set *set)</span></span>;  <span class="comment">// è®¾ç½®å¯¹åº”ä½ç½®çš„æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FD_ZERO</span><span class="params">(fd_set *set)</span></span>;         <span class="comment">// æ¸…ç©ºæ•´ä¸ªä½å›¾</span></span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½å›è§‰å¾—å¥‡æ€ª, ä¸ºä»€ä¹ˆè¿™äº›â€œå‡½æ•°â€æ˜¯å¤§å†™çš„å‘¢ï¼ŸLinuxä¸­å¤§å†™çš„åº”è¯¥æ˜¯å®æ‰å¯¹å§ï¼Ÿ</p><p>ç­”å¯¹äº†ï¼è¿™é‡Œçš„è®¾ç½®å‡½æ•°å…¶å®éƒ½æ˜¯å®å®šä¹‰ï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Access macros for `fd_set&#x27;.  */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>FD_SET(fd, fdsetp)__FD_SET (fd, fdsetp)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>FD_CLR(fd, fdsetp)__FD_CLR (fd, fdsetp)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>FD_ISSET(fd, fdsetp)__FD_ISSET (fd, fdsetp)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>FD_ZERO(fdsetp)__FD_ZERO (fdsetp)</span></span><br></pre></td></tr></table></figure><p>æ—¢ç„¶æ˜¯ä¸€ä¸ªé¢„å®šä¹‰å¥½çš„ä½å›¾, é‚£ä¹ˆå®ƒçš„é•¿åº¦å°±ä¼šæ”¶åˆ°æ“ä½œç³»ç»Ÿåº•å±‚çš„ä¸€å®šé™åˆ¶, ä»¥ä¸‹ä¸ºæºä»£ç ä¸­<code>fd_set</code>ç»“æ„ä½“çš„å®šä¹‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·¯å¾„ usr/include/sys/select.h</span></span><br><span class="line"><span class="comment">/* The fd_set member is required to be an array of longs.  */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">int</span> __fd_mask;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Some versions of &lt;linux/posix_types.h&gt; define this macros.  */</span></span><br><span class="line"><span class="meta">#<span class="keyword">undef</span>__NFDBITS</span></span><br><span class="line"><span class="comment">/* It&#x27;s easier to assume 8-bit bytes than to get CHAR_BIT.  */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __NFDBITS(8 * (int) sizeof (__fd_mask))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>__FD_ELT(d)((d) / __NFDBITS)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>__FD_MASK(d)((__fd_mask) (1UL &lt;&lt; ((d) % __NFDBITS)))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* fd_set for select and pselect.  */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">  &#123;</span></span><br><span class="line">    <span class="comment">/* XPG4.2 requires this member name.  Otherwise avoid the name</span></span><br><span class="line"><span class="comment">       from the global namespace.  */</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __USE_XOPEN</span></span><br><span class="line">    __fd_mask fds_bits[__FD_SETSIZE / __NFDBITS];</span><br><span class="line"><span class="meta"># <span class="keyword">define</span> __FDS_BITS(set) ((set)-&gt;fds_bits)</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    __fd_mask __fds_bits[__FD_SETSIZE / __NFDBITS];</span><br><span class="line"><span class="meta"># <span class="keyword">define</span> __FDS_BITS(set) ((set)-&gt;__fds_bits)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  &#125; fd_set;</span><br></pre></td></tr></table></figure><p>åœ¨å¦å¤–ä¸€ä¸ªå¤´æ–‡ä»¶ä¸­, å¯ä»¥æ‰¾åˆ°<code>__FD_SETSIZE</code>è¿™ä¸ªå®çš„å®šä¹‰, æ˜¯1024;ä¹Ÿå°±æ˜¯è¯´, <code>fd_set</code>è¿™ä¸ªä½å›¾æœ€å¤§çš„é•¿åº¦åªæœ‰1024ä¸ªæ¯”ç‰¹ä½, æˆ‘ä»¬ä¹Ÿåªèƒ½ç›‘çœ‹è¿™ä¹ˆå¤šæ–‡ä»¶æè¿°ç¬¦ï¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·¯å¾„ usr/include/bits/typesizes.h</span></span><br><span class="line"><span class="comment">/* Number of descriptors that can fit in an `fd_set&#x27;.  */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __FD_SETSIZE1024</span></span><br></pre></td></tr></table></figure><p>è¿™ä¹Ÿæ˜¯<code>select</code>çš„ç¼ºç‚¹ä¹‹ä¸€, åŒæ—¶ç›‘çœ‹çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡æ˜¯<strong>æœ‰é™åˆ¶</strong>çš„ï¼</p><h3 id="3-1-3-nfds"><a href="#3-1-3-nfds" class="headerlink" title="3.1.3 nfds"></a>3.1.3 nfds</h3><p>è¿™ä¸ªå‚æ•°æ˜¯selectéœ€è¦å¸®æˆ‘ä»¬ç›‘çœ‹çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦+1, è¿™æ˜¯å› ä¸ºselectåœ¨ç›‘çœ‹çš„è¿‡ç¨‹ä¸­éœ€è¦ç”¨å¾ªç¯æ¥è¿›è¡Œæ£€æµ‹, è¿™ä¸ªæœ€å¤§æ–‡ä»¶æè¿°ç¬¦+1ç›¸å½“äºæ˜¯ä¸€ä¸ªå¾ªç¯çš„è¾¹ç•Œæ¡ä»¶;</p><p>ä½ åªéœ€æ ¹æ®å½“å‰å·²æœ‰çš„æ–‡ä»¶æè¿°ç¬¦å·, è®¡ç®—å‡ºæœ€å¤§æ–‡ä»¶æè¿°ç¬¦, å†åŠ ä¸€ä¼ ç»™è¿™ä¸ªå‡½æ•°å³å¯ã€‚</p><h3 id="3-1-4-è¿”å›å€¼"><a href="#3-1-4-è¿”å›å€¼" class="headerlink" title="3.1.4 è¿”å›å€¼"></a>3.1.4 è¿”å›å€¼</h3><p>manæ‰‹å†Œä¸­å¯¹è¿”å›å€¼çš„æè¿°å¦‚ä¸‹</p><ul><li>æˆåŠŸçš„æ—¶å€™, è¿”å›äº‹ä»¶å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡</li><li>å¤±è´¥çš„æ—¶å€™è¿”å›<code>-1</code>, å¹¶è®¾ç½®errno</li><li>å¦‚æœå·²ç»<code>timeout</code>äº†è¿˜æ²¡æœ‰äº‹ä»¶å°±ç»ª, è¿”å›0</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RETURN VALUE</span><br><span class="line">       On success, select() and pselect() return the number of file descriptors contained in the three returned descriptor  sets  (that  is,  the total  number  of  bits that are set in readfds, writefds, exceptfds) which may be zero if the timeout expires before anything interesting happens.  On error, -1 is returned, and errno is set to indicate the error; the file descriptor sets are unmodified, and  timeout becomes undefined.</span><br></pre></td></tr></table></figure><h2 id="3-2-å®ä¾‹"><a href="#3-2-å®ä¾‹" class="headerlink" title="3.2 å®ä¾‹"></a>3.2 å®ä¾‹</h2><p>å‡½æ•°åŸå‹çœ‹å®Œäº†, å¾—ä»å®ä¾‹å‡ºå‘æ¥è¯•è¯•äº†</p><h3 id="3-2-1-socket"><a href="#3-2-1-socket" class="headerlink" title="3.2.1 socket"></a>3.2.1 socket</h3><p>è¿™é‡Œå…ˆå¯¹<span id="jump-select">socket</span>åšäº†ä¸€ä¸ªç®€å•çš„å°è£…, åŒ…æ‹¬åˆå§‹åŒ–, ç»‘å®šç›¸å…³çš„æ¥å£, åªéœ€è¦åœ¨å¦å¤–ä¸€ä¸ªæ–‡ä»¶é‡Œé¢è°ƒç”¨è¿™ä¸ªå¤´æ–‡ä»¶å³å¯ !</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Sock.hpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cerrno&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Sock</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> gbacklog = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">SocketInit</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> listenSock = <span class="built_in">socket</span>(PF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (listenSock &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è®¾ç½®ç«¯å£å¤ç”¨, é¿å…timewaité˜»å¡ç«¯å£</span></span><br><span class="line">        <span class="type">int</span> opt = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">setsockopt</span>(listenSock, SOL_SOCKET, SO_REUSEADDR | SO_REUSEPORT, &amp;opt, <span class="built_in">sizeof</span>(opt));</span><br><span class="line">        <span class="keyword">return</span> listenSock;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">Bind</span><span class="params">(<span class="type">int</span> socket, <span class="type">uint16_t</span> port)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> local; <span class="comment">// ç”¨æˆ·æ ˆ</span></span><br><span class="line">        <span class="built_in">memset</span>(&amp;local, <span class="number">0</span>, <span class="keyword">sizeof</span> local);</span><br><span class="line">        local.sin_family = PF_INET;</span><br><span class="line">        local.sin_port = <span class="built_in">htons</span>(port);</span><br><span class="line">        local.sin_addr.s_addr = INADDR_ANY;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.2 æœ¬åœ°socketä¿¡æ¯, å†™å…¥sock_å¯¹åº”çš„å†…æ ¸åŒºåŸŸ</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">bind</span>(socket, (<span class="type">const</span> <span class="keyword">struct</span> sockaddr *)&amp;local, <span class="built_in">sizeof</span>(local)) &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">Listen</span><span class="params">(<span class="type">int</span> socket)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">listen</span>(socket, gbacklog) &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">Accept</span><span class="params">(<span class="type">int</span> socket, std::string *clientip, <span class="type">uint16_t</span> *clientport)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> peer;</span><br><span class="line">        <span class="type">socklen_t</span> len = <span class="built_in">sizeof</span>(peer);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> serviceSock = <span class="built_in">accept</span>(socket, (<span class="keyword">struct</span> sockaddr *)&amp;peer, &amp;len);</span><br><span class="line">        <span class="keyword">if</span> (serviceSock &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// è·å–é“¾æ¥å¤±è´¥</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(clientport) *clientport = <span class="built_in">ntohs</span>(peer.sin_port);</span><br><span class="line">        <span class="keyword">if</span>(clientip) *clientip = <span class="built_in">inet_ntoa</span>(peer.sin_addr);</span><br><span class="line">        <span class="keyword">return</span> serviceSock;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¦å¤–é‡ç‚¹è¯´æ˜ä¸€ä¸‹è¿™ä¸¤è¡Œ, åœ¨ä¹‹å‰å­¦ä¹ tcpæœåŠ¡å™¨çš„æ—¶å€™å°±æåˆ°è¿‡, è¿™é‡Œçš„<code>SO_REUSEADDR</code>æ˜¯è®©ç«¯å£å¯ä»¥è¢«å¤ç”¨, ä¸ä¼šå› ä¸ºå­˜åœ¨<code>TIME_WAIT</code>çš„é“¾æ¥è€Œæ— æ³•ç»‘å®šç«¯å£ã€‚é€‚ç”¨äºæœåŠ¡å™¨å¿«é€Ÿé‡å¯çš„æƒ…å†µã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®ç«¯å£å¤ç”¨, é¿å…timewaité˜»å¡ç«¯å£</span></span><br><span class="line"><span class="type">int</span> opt = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">setsockopt</span>(listenSock, SOL_SOCKET, SO_REUSEADDR | SO_REUSEPORT, &amp;opt, <span class="built_in">sizeof</span>(opt));</span><br></pre></td></tr></table></figure><h3 id="3-2-2-åˆå§‹åŒ–"><a href="#3-2-2-åˆå§‹åŒ–" class="headerlink" title="3.2.2 åˆå§‹åŒ–"></a>3.2.2 åˆå§‹åŒ–</h3><p>è¿˜æ˜¯è€ä¸€å¥—, é€šè¿‡å‘½ä»¤è¡Œå‚æ•°è·å–åˆ°ç«¯å£å·, åˆ›å»ºsocket_fdå¹¶ç»‘å®šç«¯å£å’Œå¼€å§‹<code>listen</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="built_in">cmd_usage</span>(argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–socket, è·å–socket fdå¹¶ç»‘å®šç«¯å£</span></span><br><span class="line">    <span class="type">int</span> listensock = Sock::<span class="built_in">SocketInit</span>();</span><br><span class="line">    Sock::<span class="built_in">Bind</span>(listensock, <span class="built_in">atoi</span>(argv[<span class="number">1</span>]));</span><br><span class="line">    Sock::<span class="built_in">Listen</span>(listensock); <span class="comment">// å¼€å§‹ç›‘å¬</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯, åœ¨selectä¸­çš„æ–‡ä»¶æè¿°ç¬¦éƒ½åªå‰©ä½å›¾äº†, æ‰€ä»¥æˆ‘ä»¬å¿…é¡»è¦æœ‰ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶æè¿°ç¬¦æ•°ç»„æ¥ååŠ©æˆ‘ä»¬ç®¡ç†æ­£åœ¨ç»´æŠ¤çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</p><p>è¿™é‡Œä¸ºäº†æ–¹ä¾¿, æˆ‘è®¾ç«‹äº†ä¸€ä¸ªå…¨å±€çš„æ•°ç»„å˜é‡, é•¿åº¦ä¸º<code>sizeof(fd_set) * 8</code>, æ˜¯<code>fd_set</code>è¿™ä¸ªä½å›¾ç»“æ„ä½“èƒ½å¤Ÿæ”¯æŒçš„æœ€å¤§socketæ•°é‡</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> fdsArray[<span class="built_in">sizeof</span>(fd_set) * <span class="number">8</span>] = &#123;<span class="number">0</span>&#125;; <span class="comment">// ä¿å­˜å†å²ä¸Šæ‰€æœ‰çš„åˆæ³•fd</span></span><br><span class="line"><span class="type">int</span> fdsArraySz = <span class="built_in">sizeof</span>(fdsArray) / <span class="built_in">sizeof</span>(fdsArray[<span class="number">0</span>]);</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DFL_FD -1 <span class="comment">// æ•°ç»„ä¸­é»˜è®¤å€¼</span></span></span><br></pre></td></tr></table></figure><p>åœ¨mainå‡½æ•°ä¸­, æˆ‘ä»¬éœ€è¦é€šè¿‡éå†æ¥å°†è¿™ä¸ªæ•°ç»„è®¾ç½®ä¸ºé»˜è®¤çš„æ–‡ä»¶æè¿°ç¬¦<code>-1</code>æ¥è¡¨æ˜å½“å‰ä½ç½®æ²¡æœ‰è¢«ä½¿ç”¨, å¹¶å°†0ä¸‹æ ‡å¤„è®¾ç½®ä¸º<code>listensock</code>;å¦‚æœä½ ä½¿ç”¨çš„æ˜¯vector, åˆ™å¯ä»¥ç›´æ¥ç”¨æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–;</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†æ•°ç»„é‡Œé¢çš„æ–‡ä»¶æè¿°ç¬¦éƒ½åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼, å¹¶å°†ç¬¬ä¸€ä¸ªä¸‹æ ‡è®¾ç½®ä¸ºlistensocket</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; fdsArraySz; i++)&#123;</span><br><span class="line">    fdsArray[i] = DFL_FD;</span><br><span class="line">&#125;</span><br><span class="line">fdsArray[<span class="number">0</span>] = listensock;</span><br></pre></td></tr></table></figure><h3 id="3-2-3-ç›‘å¬"><a href="#3-2-3-ç›‘å¬" class="headerlink" title="3.2.3 ç›‘å¬"></a>3.2.3 ç›‘å¬</h3><p>åˆå§‹åŒ–å®Œæ¯•æ•°ç»„å, å°±å¯ä»¥å¼€å§‹å¾ªç¯è°ƒç”¨<code>select</code>æ¥è¿›è¡Œç›‘å¬äº†ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯, å› ä¸º<code>select</code>çš„<code>fd_set</code>æ˜¯ä¸€ä¸ªä½å›¾, è€Œä¸”æ˜¯è¾“å…¥è¾“å‡ºå‚æ•°ã€‚æ¯æ¬¡çš„<code>select</code>è°ƒç”¨ä¹‹å, è¿™äº›ä½å›¾å°±ä¼šè¢«æ“ä½œç³»ç»Ÿä¿®æ”¹ä¸ºå·²ç»å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆå³å‚æ•°æœ¬èº«ä¼šè¢«ä¿®æ”¹ï¼‰æ‰€ä»¥æˆ‘ä»¬ä¸‹ä¸€æ¬¡è°ƒç”¨ä¹‹å‰, <strong>éœ€è¦é‡æ–°è®¾ç½®ä½å›¾å‚æ•°</strong>ï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼€å§‹ç›‘å¬</span></span><br><span class="line">fd_set readfds;</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> maxFd = DFL_FD;</span><br><span class="line">    <span class="built_in">FD_ZERO</span>(&amp;readfds); <span class="comment">// æ¸…ç©ºä½å›¾</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">timeval</span> timeout = &#123;<span class="number">5</span>, <span class="number">0</span>&#125;; <span class="comment">// è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º5ç§’</span></span><br><span class="line">    <span class="comment">// éå†å…¨å±€æ•°ç»„, å°†æœ‰æ•ˆçš„fdéƒ½æ·»åŠ è¿›å», å¹¶æ›´æ–°maxfd</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; fdsArraySz; i++)</span><br><span class="line">    &#123;   </span><br><span class="line">        <span class="comment">// 1. è¿‡æ»¤ä¸åˆæ³•çš„fd</span></span><br><span class="line">        <span class="keyword">if</span> (fdsArray[i] == DFL_FD) <span class="keyword">continue</span>;   </span><br><span class="line">        <span class="comment">// 2. æ·»åŠ æ‰€æœ‰çš„åˆæ³•çš„fdåˆ°readfdsä¸­, æ–¹ä¾¿selectç»Ÿä¸€è¿›è¡Œå°±ç»ªç›‘å¬</span></span><br><span class="line">        <span class="built_in">FD_SET</span>(fdsArray[i], &amp;readfds); </span><br><span class="line">        <span class="keyword">if</span> (maxFd &lt; fdsArray[i]) &#123;</span><br><span class="line">            maxFd = fdsArray[i]; <span class="comment">// 3. æ›´æ–°å‡ºfdæœ€å¤§å€¼</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è°ƒç”¨selectå¼€å§‹ç›‘å¬</span></span><br><span class="line">    <span class="type">int</span> sret = <span class="built_in">select</span>(maxFd+<span class="number">1</span>, &amp;readfds, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>, &amp;timeout);</span><br><span class="line">    <span class="keyword">switch</span> (sret)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>: <span class="comment">// ç­‰å¾…è¶…æ—¶</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;time out ... : &quot;</span> &lt;&lt; (<span class="type">unsigned</span> <span class="type">long</span>)<span class="built_in">time</span>(<span class="literal">nullptr</span>) &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">-1</span>:<span class="comment">// ç­‰å¾…å¤±è´¥</span></span><br><span class="line">        cerr &lt;&lt; errno &lt;&lt; <span class="string">&quot; : &quot;</span> &lt;&lt; <span class="built_in">strerror</span>(errno) &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="comment">// ç­‰å¾…æˆåŠŸ</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;wait success: &quot;</span> &lt;&lt; sret &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸºæœ¬æ¡†æ¶æ­èµ·æ¥äº†, æˆ‘ä»¬è¿™æ—¶å€™å°±åªéœ€è¦å®ç°ç­‰å¾…æˆåŠŸåå–å‡ºé“¾æ¥å’ŒIOä¿¡æ¯çš„æ“ä½œäº†;</p><p>å…ˆæ¥æµ‹è¯•ä¸€ä¸‹å½“å‰çš„æ‰‹è„šæ¶å§</p><h3 id="3-2-4-æ‰‹è„šæ¶æµ‹è¯•"><a href="#3-2-4-æ‰‹è„šæ¶æµ‹è¯•" class="headerlink" title="3.2.4 æ‰‹è„šæ¶æµ‹è¯•"></a>3.2.4 æ‰‹è„šæ¶æµ‹è¯•</h3><p>ç¼–è¯‘å¯åŠ¨, ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°æ¥ç»‘å®šç«¯å£, åœ¨æ²¡æœ‰æ”¶åˆ°æ•°æ®ä¹‹å‰, è¿›ç¨‹ä¼šåœ¨selectä¸­é˜»å¡ç­‰å¾…5ç§’, éšåå› ä¸ºè¶…æ—¶è·³å‡ºé˜»å¡æ€, è¿”å›0å¹¶æ‰“å°å½“å‰æ—¶é—´æˆ³</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ g++ main.cpp -o test</span><br><span class="line">$ ./test 10000</span><br><span class="line">time out ... : 1692955522</span><br><span class="line">time out ... : 1692955527</span><br><span class="line">time out ... : 1692955532</span><br><span class="line">time out ... : 1692955537</span><br><span class="line">time out ... : 1692955542</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>telnet</code>å‘½ä»¤æ¥é“¾æ¥å½“å‰æœåŠ¡, <code>select</code>æ£€æµ‹åˆ°listensockæ–‡ä»¶æè¿°ç¬¦å°±ç»ª, ä¼šç«‹åˆ»è¿”å›ï¼ˆå¯¹äºlistensockæ¥è¯´, æ¥äº†æ–°é“¾æ¥å°±æ˜¯è¯»IOå°±ç»ªï¼‰ä½†å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å†™å–èµ°æ–°socketçš„ä»£ç , æ‰€ä»¥è¿™é‡Œä¼šä¸€ç›´æ‰“å°äº‹ä»¶å°±ç»ª;</p><p>è¿”å›å€¼ä¸º1, ä»£è¡¨æœ‰ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„äº‹ä»¶å°±ç»ªã€‚</p><p><img src="https://img.musnow.top/i/2023/08/bcd37076cf11a3ec0d3caac5f7f0501f.png" alt="image-20230825172642067"></p><h3 id="3-2-5-å¤„ç†æ–°è¿æ¥"><a href="#3-2-5-å¤„ç†æ–°è¿æ¥" class="headerlink" title="3.2.5 å¤„ç†æ–°è¿æ¥"></a>3.2.5 å¤„ç†æ–°è¿æ¥</h3><p>åœ¨<code>select</code>äº‹ä»¶å°±ç»ªå, ä½¿ç”¨å¦‚ä¸‹å‡½æ•°æ¥å¤„ç†æ–°çš„é“¾æ¥</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">HandlerEvent</span><span class="params">(<span class="type">int</span> listensock, fd_set &amp;readfds)</span></span>;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢å¤–å†™äº†ä¸€ä¸ªæ‰“å°æ•°ç»„ä¸­å…ƒç´ çš„å‡½æ•°, æ–¹ä¾¿æˆ‘ä»¬è§‚å¯Ÿç»“æœã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// @brief æ‰“å°æ•°ç»„ä¸­çš„æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">ShowArray</span><span class="params">(<span class="type">int</span> arr[], <span class="type">int</span> num)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;å½“å‰åˆæ³•sock list: &quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; num; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i] == DFL_FD )</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; arr[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦éå†æ•´ä¸ªé“¾æ¥æ•°ç»„, å¹¶åˆ¤æ–­å½“å‰ä½ç½®æ˜¯å¦æ˜¯æœ‰æ•ˆçš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ— æ•ˆç›´æ¥è·³è¿‡ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; fdsArraySz; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (fdsArray[i] == DFL_FD)</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    <span class="comment">// å¤„ç†æ–°è¿æ¥å’Œå·²æœ‰é“¾æ¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éå†çš„æ—¶å€™, æˆ‘ä»¬éœ€è¦å¯¹listensockåšå•ç‹¬çš„å¤„ç†, æ¯•ç«Ÿè·å–æ–°è¿æ¥å’Œç»´æŠ¤å·²æœ‰é“¾æ¥çš„æµç¨‹æ˜¯å®Œå…¨ä¸åŒçš„ã€‚ä¸‹é¢è¯´è¯´æµç¨‹</p><ul><li>åˆ¤æ–­æ˜¯å¦æœ‰åœ¨selectä¸­ç›‘å¬è¯¥æ–‡ä»¶æè¿°ç¬¦</li><li>æœ‰ç›‘å¬, ç»§ç»­å¾€åæ‰§è¡Œ, å¼€å§‹è¿›è¡Œ<code>accept</code>è·å–æ–°çš„é“¾æ¥</li><li>è·å–å¤±è´¥, ç›´æ¥è·³å‡ºè¯¥å‡½æ•°, ç»“æŸè¯¥è½®å¤„ç†</li><li>è·å–æˆåŠŸ, ä¸èƒ½ç›´æ¥read&#x2F;write, è€Œæ˜¯åº”è¯¥é€šè¿‡æ•°ç»„äº¤ä»˜ç»™selectå¸®æˆ‘ä»¬ç›‘å¬äº‹ä»¶</li><li>ä¸‹ä¸€è½®å¾ªç¯ä¸­, selectä¾¿ä¼šå¸®æˆ‘ä»¬ç›‘å¬è¯¥æ–°é“¾æ¥çš„äº‹ä»¶æ˜¯å¦å°±ç»ª</li></ul><p>å› ä¸ºèµ°åˆ°è¿™é‡Œçš„æ—¶å€™, æˆ‘ä»¬çš„<code>listensocket</code>é‡Œé¢æ˜¯ä¸€å®šæœ‰æ–°è¿æ¥çš„, æ‰€ä»¥å¯¹<code>accept</code>çš„è°ƒç”¨æ˜¯ä¸ä¼šé˜»å¡çº¿ç¨‹çš„ï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (i == <span class="number">0</span> &amp;&amp; fdsArray[i] == listensock)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­listensocketæœ‰æ²¡æœ‰äº‹ä»¶ç›‘å¬</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">FD_ISSET</span>(listensock, &amp;readfds))&#123;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;listensocket not set in readfds&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å…·æœ‰äº†ä¸€ä¸ªæ–°é“¾æ¥</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;get new connection&quot;</span> &lt;&lt; endl;</span><br><span class="line">    string clientip;</span><br><span class="line">    <span class="type">uint16_t</span> clientport = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> sock = Sock::<span class="built_in">Accept</span>(listensock, &amp;clientip, &amp;clientport); <span class="comment">// ä¸ä¼šé˜»å¡</span></span><br><span class="line">    <span class="keyword">if</span> (sock &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span>; <span class="comment">// å‡ºé”™äº†, ç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="comment">// æˆåŠŸè·å–æ–°è¿æ¥</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;new conn:&quot;</span> &lt;&lt; clientip &lt;&lt; <span class="string">&quot;:&quot;</span> &lt;&lt; clientport &lt;&lt; <span class="string">&quot; | sock: &quot;</span> &lt;&lt; sock &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™é‡Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥å¯¹è¿™ä¸ªsocketè¿›è¡Œç‹¬å†™, å› ä¸ºæ–°é“¾æ¥æ¥äº†å¹¶ä¸ä»£è¡¨æ–°æ•°æ®ä¸€å¹¶è¿‡æ¥äº†</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥éœ€è¦å°†æ–°çš„æ–‡ä»¶æè¿°ç¬¦åˆ©ç”¨å…¨å±€æ•°ç»„, äº¤ä»˜ç»™select</span></span><br><span class="line">    <span class="comment">// select å¸®æˆ‘ä»¬ç›‘çœ‹socketä¸Šçš„è¯»äº‹ä»¶æ˜¯å¦å°±ç»ª</span></span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; fdsArraySz; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (fdsArray[i] == DFL_FD)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¾¾åˆ°ä¸Šé™äº†</span></span><br><span class="line">    <span class="keyword">if</span> (i == fdsArraySz)</span><br><span class="line">    &#123;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;reach the maximum number of connections&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">close</span>(sock);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="comment">// æ²¡æœ‰è¾¾åˆ°</span></span><br><span class="line">    &#123;</span><br><span class="line">        fdsArray[i] = sock; <span class="comment">// æ–°çš„é“¾æ¥, æ’å…¥åˆ°æ•°ç»„ä¸­, ä¸‹æ¬¡éå†å°±ä¼šæ·»åŠ åˆ°selectç›‘çœ‹ä¸­</span></span><br><span class="line">        <span class="built_in">ShowArray</span>(fdsArray, fdsArraySz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-6-å¤„ç†å·²æœ‰é“¾æ¥"><a href="#3-2-6-å¤„ç†å·²æœ‰é“¾æ¥" class="headerlink" title="3.2.6 å¤„ç†å·²æœ‰é“¾æ¥"></a>3.2.6 å¤„ç†å·²æœ‰é“¾æ¥</h3><p>è¿™é‡Œæš‚æ—¶åªåšäº†å¯¹è¯»çš„æ“ä½œ, å½“è¯»äº‹ä»¶å°±ç»ªçš„æ—¶å€™, æˆ‘ä»¬é€šè¿‡readè¯»å–å·²æœ‰çš„æ•°æ®ã€‚è¿™é‡Œå› ä¸ºsocketä¸­è‚¯å®šæ˜¯æœ‰æ•°æ®çš„, æ‰€ä»¥ä¹Ÿä¸ä¼šå‡ºç°é˜»å¡çš„æƒ…å†µã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// end if (i == 0 &amp;&amp; fdsArray[i] == listensock)</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// å¤„ç†æ™®é€šsockçš„IOäº‹ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">FD_ISSET</span>(fdsArray[i], &amp;readfds))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// readã€recvè¯»å–å³å¯</span></span><br><span class="line">        <span class="type">char</span> buffer[<span class="number">1024</span>];</span><br><span class="line">        <span class="type">ssize_t</span> s = <span class="built_in">recv</span>(fdsArray[i], buffer, <span class="built_in">sizeof</span>(buffer), <span class="number">0</span>); <span class="comment">// ä¸ä¼šé˜»å¡</span></span><br><span class="line">        <span class="keyword">if</span> (s &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            buffer[s] = <span class="number">0</span>;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;client[&quot;</span> &lt;&lt; fdsArray[i] &lt;&lt; <span class="string">&quot;]# &quot;</span> &lt;&lt; buffer &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s == <span class="number">0</span>) <span class="comment">// å¯¹ç«¯å…³é—­</span></span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;client[&quot;</span> &lt;&lt; fdsArray[i] &lt;&lt; <span class="string">&quot;] quit, server close &quot;</span> &lt;&lt; fdsArray[i] &lt;&lt; endl;</span><br><span class="line">            <span class="built_in">close</span>(fdsArray[i]);</span><br><span class="line">            fdsArray[i] = DFL_FD; <span class="comment">// å»é™¤å¯¹è¯¥æ–‡ä»¶æè¿°ç¬¦çš„selectäº‹ä»¶ç›‘å¬</span></span><br><span class="line">            <span class="built_in">ShowArray</span>(fdsArray, fdsArraySz);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">// å¼‚å¸¸äº†</span></span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;client[&quot;</span> &lt;&lt; fdsArray[i] &lt;&lt; <span class="string">&quot;] error, server close &quot;</span> &lt;&lt; fdsArray[i] &lt;&lt; endl;</span><br><span class="line">            <span class="built_in">close</span>(fdsArray[i]);</span><br><span class="line">            fdsArray[i] = DFL_FD; <span class="comment">// å»é™¤å¯¹è¯¥æ–‡ä»¶æè¿°ç¬¦çš„selectäº‹ä»¶ç›‘å¬</span></span><br><span class="line">            <span class="built_in">ShowArray</span>(fdsArray, fdsArraySz);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘å•æ¬¡è¯»å–çš„æ—¶å€™, æœ€å¤šåªèƒ½è¯»å‡º1024å­—èŠ‚çš„æ•°æ®;å¦‚æœæƒ³ä¸€æ¬¡æ€§è¯»å–å®Œæ¯•, åˆ™éœ€è¦ä½¿ç”¨å¾ªç¯+è®¾ç½®éé˜»å¡æ¥è¿›è¡Œè¯»å–ã€‚åç»­åœ¨epollçš„ä»£ç ç¤ºä¾‹ä¸­ä¼šå±•ç¤ºè¿™ç§å†™æ³•ã€‚</p><h3 id="3-2-7-å®æµ‹"><a href="#3-2-7-å®æµ‹" class="headerlink" title="3.2.7 å®æµ‹"></a>3.2.7 å®æµ‹</h3><p>åˆ°è¿™é‡Œ, æˆ‘ä»¬è¿™å¥—ä»£ç å°±åŸºæœ¬å®Œæˆäº†, å¯ä»¥æ¥æµ‹è¯•ä¸€ä¸‹èƒ½å¦å®ç°å•çº¿ç¨‹ç›‘å¬å¤šä¸ªé“¾æ¥;</p><p>åœ¨æœ¬åœ°ä½¿ç”¨telnet+å¤šä¸ªç»ˆç«¯è¿›è¡Œæµ‹è¯•, å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆåŠŸå®ç°äº†åŒæ—¶ç›‘å¬ä¸¤ä¸ªé“¾æ¥, å¹¶æ¥å—è¿™ä¸¤ä¸ªé“¾æ¥ç»™è‡ªå·±å‘é€çš„ä¿¡æ¯çš„åŠŸèƒ½ã€‚å½“telneté€€å‡ºçš„æ—¶å€™, ä¹Ÿèƒ½æˆåŠŸå›æ”¶æ–‡ä»¶æè¿°ç¬¦ã€‚</p><p><img src="https://img.musnow.top/i/2023/08/c14d2576fc599392522042a1bb12ddc5.png" alt="image-20230825183501900"></p><p>selectçš„å°å®ç°æš‚æ—¶å…ˆçœ‹åˆ°è¿™é‡Œ, å¦‚æœæƒ³ç”¨selectå®ç°åŒæ—¶è¯»+å†™, å…¶å®æ˜¯å¾ˆå¤æ‚çš„ã€‚éœ€è¦ä¸€å¥—å®Œæ•´çš„é€»è¾‘ã€‚è¿™å°±ç•™ç€åˆ°æœ€åepollçš„æ—¶å€™å†ç»Ÿä¸€å±•ç°å§ï¼</p><h2 id="3-3-socketå°±ç»ªæ¡ä»¶"><a href="#3-3-socketå°±ç»ªæ¡ä»¶" class="headerlink" title="3.3 socketå°±ç»ªæ¡ä»¶"></a>3.3 socketå°±ç»ªæ¡ä»¶</h2><p><span id="jump3">socketä¸åŒäº‹ä»¶çš„å°±ç»ªæœ‰å„è‡ªçš„æ¡ä»¶</span></p><h3 id="3-3-1-è¯»å°±ç»ª"><a href="#3-3-1-è¯»å°±ç»ª" class="headerlink" title="3.3.1 è¯»å°±ç»ª"></a>3.3.1 è¯»å°±ç»ª</h3><ul><li>socketå†…æ ¸ä¸­, æ¥æ”¶ç¼“å†²åŒºä¸­çš„å­—èŠ‚æ•°, å¤§äºç­‰äºä½æ°´ä½æ ‡è®°<code>SO_RCVLOWAT</code>, æ­¤æ—¶å¯ä»¥æ— é˜»å¡çš„è¯»è¯¥æ–‡ä»¶æè¿°ç¬¦, å¹¶ä¸”è¿”å›å€¼å¤§äº0; </li><li>socketåœ¨TCPé€šä¿¡ä¸­, å¯¹ç«¯å…³é—­è¿æ¥, æ­¤æ—¶å¯¹è¯¥socketè¯», åˆ™è¿”å›0;</li><li>ç›‘å¬çš„socketä¸Šæœ‰æ–°çš„è¿æ¥è¯·æ±‚;</li><li>socketä¸Šæœ‰æœªå¤„ç†çš„é”™è¯¯;</li></ul><h3 id="3-3-2-å†™å°±ç»ª"><a href="#3-3-2-å†™å°±ç»ª" class="headerlink" title="3.3.2 å†™å°±ç»ª"></a>3.3.2 å†™å°±ç»ª</h3><ul><li>socketå†…æ ¸ä¸­,  å‘é€ç¼“å†²åŒºä¸­çš„å¯ç”¨å­—èŠ‚æ•°(å‘é€ç¼“å†²åŒºçš„ç©ºé—²ä½ç½®å¤§å°),  å¤§äºç­‰äºä½æ°´ä½æ ‡è®° <code>SO_SNDLOWAT</code>,  æ­¤æ—¶å¯ä»¥æ— é˜»å¡çš„å†™,  å¹¶ä¸”è¿”å›å€¼å¤§äº0;</li><li>socketçš„å†™æ“ä½œè¢«å…³é—­(closeæˆ–è€…shutdown). å¯¹ä¸€ä¸ªå†™æ“ä½œè¢«å…³é—­çš„socketè¿›è¡Œå†™æ“ä½œ,  ä¼šè§¦å‘ <code>SIGPIPE</code> ä¿¡å·;</li><li>socketä½¿ç”¨éé˜»å¡connectè¿æ¥æˆåŠŸæˆ–å¤±è´¥ä¹‹å;</li><li>socketä¸Šæœ‰æœªè¯»å–çš„é”™è¯¯;</li></ul><h3 id="3-3-3-å¼‚å¸¸å°±ç»ª"><a href="#3-3-3-å¼‚å¸¸å°±ç»ª" class="headerlink" title="3.3.3 å¼‚å¸¸å°±ç»ª"></a>3.3.3 å¼‚å¸¸å°±ç»ª</h3><p>socketä¸Šæ”¶åˆ°å¸¦å¤–æ•°æ®ï¼ˆTCPæŠ¥å¤´ä¸­çš„URGå’Œç´§æ€¥æŒ‡é’ˆï¼‰</p><h2 id="3-4-selectçš„ç‰¹ç‚¹"><a href="#3-4-selectçš„ç‰¹ç‚¹" class="headerlink" title="3.4 selectçš„ç‰¹ç‚¹"></a>3.4 selectçš„ç‰¹ç‚¹</h2><ul><li>å¯ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦æœ‰ä¸Šé™, å–å†³äº<code>fd_set</code>ä½å›¾ç»“æ„ä½“çš„é…ç½®</li><li>åœ¨ç›‘æ§æ–‡ä»¶æè¿°ç¬¦çš„æ—¶å€™, éœ€è¦ç”¨æˆ·é¢å¤–çš„æ•°ç»„æ¥ç»´æŠ¤æ–‡ä»¶æè¿°ç¬¦</li><li>æ¯æ¬¡å¾ªç¯éƒ½å¾—éå†æ•´ä¸ªæ•°ç»„, æ•ˆç‡è¾ƒä½ï¼ˆå¯ä»¥ä¼˜åŒ–ä¸ºä¿è¯æœ‰æ•ˆæ–‡ä»¶æè¿°ç¬¦éƒ½åœ¨æ•°ç»„çš„å‰æ–¹ï¼‰</li></ul><p>ä¸€ä¸‹æ˜¯å®ƒåœ¨æ•ˆç‡ä¸Šçš„ä¸€äº›ç¼ºç‚¹</p><ul><li>æ¯æ¬¡è°ƒç”¨selectéƒ½å¾—æ‰‹åŠ¨è®¾ç½®ä¸€è¾¹fdé›†å’Œï¼ˆå› ä¸º<code>fd_set</code>ä¹Ÿæ˜¯è¾“å‡ºå‹å‚æ•°, åœ¨å†…æ ¸ä¸­ä¼šè¢«ä¿®æ”¹ï¼‰</li><li>æ¯æ¬¡è°ƒç”¨select, éƒ½éœ€è¦æŠŠæ‰€æœ‰fdä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€, å°é™†åœ°</li><li>æ¯æ¬¡è°ƒç”¨, å†…æ ¸éƒ½é¡»éå†ä¼ é€’è¿›æ¥çš„ä½å›¾, æ•ˆç‡ä½</li><li>ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦æœ‰ä¸Šé™, æ•°é‡å°</li></ul><h1 id="4-å¤šè·¯è½¬æ¥ä¹‹poll"><a href="#4-å¤šè·¯è½¬æ¥ä¹‹poll" class="headerlink" title="4.å¤šè·¯è½¬æ¥ä¹‹poll"></a>4.å¤šè·¯è½¬æ¥ä¹‹poll</h1><h2 id="4-1-å‡½æ•°åŸå‹"><a href="#4-1-å‡½æ•°åŸå‹" class="headerlink" title="4.1 å‡½æ•°åŸå‹"></a>4.1 å‡½æ•°åŸå‹</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦äº†è§£çš„æ˜¯å¦å¤–ä¸€ä¸ªå¤šè·¯è½¬æ¥æ–¹æ¡ˆ, <strong>poll</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;poll.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">poll</span><span class="params">(<span class="keyword">struct</span> pollfd *fds,  <span class="type">nfds_t</span> nfds,  <span class="type">int</span> timeout)</span></span>;</span><br></pre></td></tr></table></figure><h3 id="4-1-1-å‚æ•°"><a href="#4-1-1-å‚æ•°" class="headerlink" title="4.1.1 å‚æ•°"></a>4.1.1 å‚æ•°</h3><p>è¿™é‡Œçš„å‚æ•°å°±å’Œselectå®Œå…¨ä¸åŒäº†, å‡ºç°äº†å¦å¤–ä¸€ä¸ªç»“æ„ä½“</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">pollfd</span> &#123;</span></span><br><span class="line">    <span class="type">int</span>   fd;         <span class="comment">/* file descriptor */</span></span><br><span class="line">    <span class="type">short</span> events;     <span class="comment">/* requested events */</span></span><br><span class="line">    <span class="type">short</span> revents;    <span class="comment">/* returned events */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™ä¸€ä¸ªç»“æ„ä½“åˆ†åˆ«åŒ…å«äº†ä¸‰ä¸ªæˆå‘˜</p><ul><li>æ–‡ä»¶æè¿°ç¬¦fd;</li><li>ç”¨æˆ·å‘Šè¯‰å†…æ ¸éœ€è¦ç›‘çœ‹çš„äº‹ä»¶events;</li><li>å†…æ ¸è¿”å›çš„å°±ç»ªäº‹ä»¶revents;</li></ul><p>ä½†æ˜¯ä»è¿™ä¸ªå‡½æ•°çš„å‚æ•°ä¸Šçœ‹æ¥, è²Œä¼¼å®ƒæ˜¯ä¸€ä¸ªåªæœ‰ä¸€ä¸ªå…ƒç´ çš„è¾“å…¥è¾“å‡ºå‹å‚æ•°, éš¾é“è¯´pollåªèƒ½ç›‘çœ‹ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å—ï¼ŸğŸ§</p><p>éä¹Ÿ, æˆ‘ä»¬å°†å‡½æ•°åŸå‹æ”¹ä¸€ä¸‹å°±èƒ½çœ‹æ˜ç™½äº†, å®é™…ä¸Š, ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª<strong>ç»“æ„ä½“æ•°ç»„</strong>, ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¯¥ç»“æ„ä½“æ•°ç»„çš„<strong>é•¿åº¦</strong>ï¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">poll</span><span class="params">(<span class="keyword">struct</span> pollfd fds[],  <span class="type">nfds_t</span> nfds,  <span class="type">int</span> timeout)</span>;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰ä¸ªå‚æ•°å’Œselectä¸­çš„timeoutçš„åŠŸèƒ½ç›¸åŒ, å¦‚æœåˆ°è¾¾ä¸€å®šæ—¶é—´è¿˜æ²¡æœ‰è·å–åˆ°å‚æ•°, åˆ™ç›´æ¥è¿”å›;å¦‚æœè®¾ç½®ä¸º<code>-1</code>åˆ™é˜»å¡ç­‰å¾…, è®¾ç½®ä¸º0ä¸ºå®Œå…¨éé˜»å¡ã€‚</p><p>è¿™é‡Œçš„timeoutå¹¶éè¾“å…¥è¾“å‡ºå‹å·å‚æ•°, å…¶åªæ˜¯ä¸€ä¸ªè¾“å…¥å‚æ•°, å•ä½ä¸º<strong>æ¯«ç§’</strong>ï¼ˆè®°ä½, ä¸æ˜¯ç§’, æ˜¯æ¯«ç§’ï¼‰</p><h3 id="4-1-2-è¿”å›å€¼"><a href="#4-1-2-è¿”å›å€¼" class="headerlink" title="4.1.2 è¿”å›å€¼"></a>4.1.2 è¿”å›å€¼</h3><ul><li>å°äº0, å‡ºé”™</li><li>ç­‰äº0, ç­‰å¾…è¶…æ—¶</li><li>å¤§äº0, æ–‡ä»¶æè¿°ç¬¦å·²ç»å°±ç»ªçš„æ•°é‡</li></ul><h3 id="4-1-3-äº‹ä»¶"><a href="#4-1-3-äº‹ä»¶" class="headerlink" title="4.1.3 äº‹ä»¶"></a>4.1.3 äº‹ä»¶</h3><p>è¿™é‡Œéœ€è¦äº†è§£ä¸€ä¸‹pollåŒ…å«çš„äº‹ä»¶ç±»å‹äº†, æˆ‘ä»¬éœ€è¦æ ¹æ®ä¸åŒæƒ…å†µæ¥é€‰æ‹©æƒ³è¦çš„äº‹ä»¶, å¹¶è®¾ç½®åˆ°ç»“æ„ä½“çš„<code>event</code>ä¸­;å¯¹äºselect&#x2F;poll&#x2F;epollæ¥è¯´, è¿™äº›socketçš„å°±ç»ªæ¡ä»¶éƒ½æ˜¯ç›¸åŒçš„ã€‚è¯¦è§ <a href="#jump3">3.3 socketå°±ç»ªæ¡ä»¶</a>;</p><p><img src="https://img.musnow.top/i/2023/08/748d3a20ba69bb3b3671f5b344cba650.png" alt="img"></p><h2 id="4-2-pollä¼˜ç¼ºç‚¹"><a href="#4-2-pollä¼˜ç¼ºç‚¹" class="headerlink" title="4.2 pollä¼˜ç¼ºç‚¹"></a>4.2 pollä¼˜ç¼ºç‚¹</h2><h3 id="4-2-1-ä¼˜ç‚¹"><a href="#4-2-1-ä¼˜ç‚¹" class="headerlink" title="4.2.1 ä¼˜ç‚¹"></a>4.2.1 ä¼˜ç‚¹</h3><p>åœ¨pollä¸­, ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªç»“æ„ä½“æ•°ç»„æ¥è¡¨ç¤ºéœ€è¦ç›‘å¬çš„æ–‡ä»¶æè¿°ç¬¦, ä»¥åŠäº‹ä»¶å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦</p><ul><li>å› ä¸ºç»“æ„ä½“ä¸­ç”¨æˆ·éœ€è¦ç›‘å¬çš„eventå’Œå†…æ ¸è¿”å›çš„å°±ç»ªeventå¹¶ä¸åœ¨ä¸€ä¸ªå˜é‡ä¸Š, æ‰€ä»¥åªéœ€è¦è®¾ç½®ä¸€æ¬¡å³å¯ï¼ˆå¦‚æœéœ€æ±‚æ²¡æœ‰å˜åŠ¨çš„è¯ï¼‰, æ— éœ€åƒselectæ¯æ¬¡éƒ½å¾—é‡æ–°éå†æ¥è®¾ç½®ä½å›¾</li><li>pollæ²¡æœ‰æœ€å¤§æ–‡ä»¶æè¿°ç¬¦é™åˆ¶</li><li>pollæ— éœ€ç”¨æˆ·é¢å¤–ç»´æŠ¤ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶æè¿°ç¬¦æ•°ç»„, ç›´æ¥æ²¿ç”¨è¯¥ç»“æ„ä½“æ•°ç»„å³å¯</li></ul><h3 id="4-2-2-ç¼ºç‚¹"><a href="#4-2-2-ç¼ºç‚¹" class="headerlink" title="4.2.2 ç¼ºç‚¹"></a>4.2.2 ç¼ºç‚¹</h3><ul><li>å’Œselectä¸€æ ·, pollä¹Ÿéœ€è¦è½®è¯¢æ£€æµ‹å°±ç»ªçš„fdå’Œç›¸å…³äº‹ä»¶</li><li>æ¯æ¬¡è°ƒç”¨polléœ€è¦æŠŠpollfdç»“æ„ä½“ä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€</li><li>è™½ç„¶pollæ²¡æœ‰æœ€å¤§æ–‡ä»¶æè¿°ç¬¦é™åˆ¶, ä½†æ˜¯ç›‘çœ‹çš„å¤šäº†åæ€§èƒ½ä¼šçº¿æ€§ä¸‹é™</li></ul><h2 id="4-3-çœ‹çœ‹ç¤ºä¾‹ä»£ç "><a href="#4-3-çœ‹çœ‹ç¤ºä¾‹ä»£ç " class="headerlink" title="4.3 çœ‹çœ‹ç¤ºä¾‹ä»£ç "></a>4.3 çœ‹çœ‹ç¤ºä¾‹ä»£ç </h2><p>pollçš„ä»£ç éƒ¨åˆ†çš„ä¸»æœºç»“æ„å’ŒselectåŸºæœ¬ç›¸åŒï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦æ¥è¯´ä¸€ä¸‹ä¸åŒçš„åœ°æ–¹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> NUM 1024</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DFL_FD -1</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">pollfd</span> <span class="title">fdsArray</span>[<span class="title">NUM</span>];</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ˜¯å…¨å±€çš„æ•°ç»„ï¼Œè¿™æ—¶å€™ä¸éœ€è¦è‡ªå·±ç»´æŠ¤ä¸€ä¸ªintæ–‡ä»¶æè¿°ç¬¦æ•°ç»„äº†ï¼Œç›´æ¥ä½¿ç”¨è¿™ä¸ªç»“æ„ä½“ä½œä¸ºå…¨å±€æ•°ç»„å°±OKäº†ï¼›åœ¨mainå‡½æ•°é‡Œé¢è¿˜æ˜¯è€æ ·å­ï¼Œæˆ‘ä»¬å¾—æŠŠæ•´ä¸ªæ•°ç»„çš„fdéƒ½è®¾ç½®æˆé»˜è®¤çš„fdä½œä¸ºæ ‡è¯†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; NUM; i++)</span><br><span class="line">&#123;</span><br><span class="line">    fdsArray[i].fd = DFL_FD;</span><br><span class="line">    fdsArray[i].events = <span class="number">0</span>;</span><br><span class="line">    fdsArray[i].revents = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">fdsArray[<span class="number">0</span>].fd = listensock;</span><br><span class="line">fdsArray[<span class="number">0</span>].events = POLLIN;</span><br></pre></td></tr></table></figure><p>åœ¨mainå‡½æ•°çš„ä¸»å¾ªç¯ä¸­ï¼Œä¹Ÿæ˜¯ç”¨pollæ¥ä¾æ¬¡ç›‘å¬äº‹ä»¶ï¼Œå¹¶åˆ¤æ–­pollå‡½æ•°çš„è¿”å›å€¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> timeout = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> n = poll(fdsArray, NUM, timeout);</span><br><span class="line">    <span class="keyword">switch</span> (n)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;time out ... : &quot;</span> &lt;&lt; (<span class="type">unsigned</span> <span class="type">long</span>)time(nullptr) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">-1</span>:</span><br><span class="line">            <span class="built_in">cerr</span> &lt;&lt; errno &lt;&lt; <span class="string">&quot; : &quot;</span> &lt;&lt; strerror(errno) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            HandlerEvent(listensock);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>HandlerEvent</code>å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡åˆ¤æ–­ç»“æ„ä½“å†…éƒ¨çš„<code>revent</code>æ¥å¾—çŸ¥æ˜¯å¦æœ‰äº‹ä»¶å°±ç»ª</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (fdsArray[i].revents &amp; POLLIN)&#123;&#125; <span class="comment">// è¯»äº‹ä»¶æ˜¯å¦å°±ç»ª</span></span><br></pre></td></tr></table></figure><p>å¯¹äºlistensocketæ¥è¯´ï¼Œå°±ç»ªäº†å°±æ‰§è¡Œacceptï¼›å¹¶å°†æ–°çš„æ–‡ä»¶æè¿°ç¬¦æ·»åŠ åˆ°æ•°ç»„ä¸­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; NUM; j++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (fdsArray[j].fd == DFL_FD)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é€šè¿‡forå¾ªç¯æ‰¾åˆ°å½“å‰ä½ç½®æ˜¯é»˜è®¤çš„ç»“æ„ä½“ä¸‹æ ‡</span></span><br><span class="line"><span class="keyword">if</span> (j == NUM) <span class="comment">// å¦‚æœè¾¾åˆ°ä¸Šé™æ‰break</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;æˆ‘çš„æœåŠ¡å™¨å·²ç»åˆ°äº†æœ€å¤§çš„ä¸Šé™äº†ï¼Œæ— æ³•åœ¨æ‰¿è½½æ›´å¤šåŒæ—¶ä¿æŒçš„è¿æ¥äº†&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    close(sock);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    fdsArray[j].fd = sock; <span class="comment">// å°†sockæ·»åŠ åˆ°æ•°ç»„ä¸­</span></span><br><span class="line">    fdsArray[j].events = POLLIN;</span><br><span class="line">    fdsArray[j].revents = <span class="number">0</span>;</span><br><span class="line">    ShowArray(fdsArray, NUM);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºå…¶ä»–é“¾æ¥æ¥è¯´ï¼Œå°±ç»ªäº†å°±å¼€å§‹readã€‚å¦‚æœreadå¼‚å¸¸æˆ–è€…å¯¹ç«¯å…³é—­ï¼Œé‚£å°±å°†å¯¹åº”ä½ç½®çš„ç»“æ„ä½“å…¨éƒ¨åˆå§‹åŒ–ï¼ˆæ¸…ç©ºï¼‰ï¼Œç›¸å½“äºå°†è¿™ä¸ªé“¾æ¥ä»ç›‘å¬ä¸­å»æ‰ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fdsArray[i].fd = DFL_FD; </span><br><span class="line">fdsArray[i].events = 0;</span><br><span class="line">fdsArray[i].revents = 0;</span><br></pre></td></tr></table></figure><p>å…¶ä½™çš„æ“ä½œå’Œselectå®Œå…¨ä¸€è‡´ï¼Œåœ¨è¿™é‡Œå°±ä¸å±•ç¤ºä»£ç äº†ï¼</p><h1 id="5-epoll"><a href="#5-epoll" class="headerlink" title="5.epoll"></a>5.epoll</h1><p>manæ‰‹å†Œä¸­æåˆ°, epollæ˜¯ä¸ºäº†å¤„ç†å¤§é‡socketæ–‡ä»¶æè¿°ç¬¦å¥æŸ„è€Œè¿›è¡Œäº†ä¸€å®šæ”¹è¿›çš„poll;</p><h2 id="5-1-æ¥å£"><a href="#5-1-æ¥å£" class="headerlink" title="5.1 æ¥å£"></a>5.1 æ¥å£</h2><p>epollå°±ä¸æ˜¯åªæœ‰ä¸€ä¸ªå‡½æ•°æ¥å£äº†, è€Œæ˜¯æœ‰3ä¸ªç›¸å…³çš„å‡½æ•°ï¼Œä½¿ç”¨è¿‡ç¨‹å°±æ˜¯ä¸‰éƒ¨æ›²ï¼š</p><ul><li>epoll_create åˆ›å»ºepollæ–‡ä»¶å¥æŸ„</li><li>epoll_ctl å°†éœ€è¦ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œæ³¨å†Œ</li><li>epoll_wait ç­‰å¾…æ–‡ä»¶æè¿°ç¬¦å°±ç»ª</li></ul><h3 id="5-1-1-epoll-create"><a href="#5-1-1-epoll-create" class="headerlink" title="5.1.1 epoll_create"></a>5.1.1 epoll_create</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/epoll.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">epoll_create</span><span class="params">(<span class="type">int</span> size)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">epoll_create1</span><span class="params">(<span class="type">int</span> flags)</span>;</span><br></pre></td></tr></table></figure><p>epollåœ¨ä½¿ç”¨çš„æ—¶å€™, æˆ‘ä»¬éœ€è¦ç”¨createå‡½æ•°åˆ›å»ºä¸€ä¸ªepollçš„å¥æŸ„ï¼ˆæœ¬è´¨ä¸Šä¹Ÿæ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼‰, æ¥ç®¡ç†å½“å‰è¿›ç¨‹éœ€è¦æ“ä½œç³»ç»Ÿå¸®æˆ‘ä»¬ç›‘çœ‹çš„æ–‡ä»¶æè¿°ç¬¦</p><ul><li>è‡ªä»<code>linux 2.6.8</code> å, è¿™é‡Œçš„sizeå‚æ•°æ˜¯è¢«å¿½ç•¥çš„</li><li>epollçš„å¥æŸ„åœ¨ä½¿ç”¨å®Œæ¯•åä¹Ÿéœ€è¦ç”¨<code>close()</code>å‡½æ•°å…³é—­</li><li>é”™è¯¯çš„æ—¶å€™è¿”å›<code>-1</code>å¹¶è®¾ç½®errno, æ­£ç¡®çš„æ—¶å€™è¿”å›æ–‡ä»¶æè¿°ç¬¦</li></ul><h3 id="5-1-2-epoll-ctl"><a href="#5-1-2-epoll-ctl" class="headerlink" title="5.1.2 epoll_ctl"></a>5.1.2 epoll_ctl</h3><p>è¯¥å‡½æ•°æ˜¯å¯¹epollä¸­éœ€è¦ç›‘çœ‹çš„æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œè®¾ç½®</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/epoll.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">epoll_ctl</span><span class="params">(<span class="type">int</span> epfd,  <span class="type">int</span> op,  <span class="type">int</span> fd,  <span class="keyword">struct</span> epoll_event *event)</span>;</span><br></pre></td></tr></table></figure><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<code>epoll_create</code>çš„è¿”å›å€¼</li><li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯åŠ¨ä½œ, åŒ…å«ä¸‰ä¸ªä¸åŒçš„é€‰é¡¹<ul><li><code>EPOLL_CTL_ADD</code>ï¼šå°†æ–°çš„æ–‡ä»¶æè¿°ç¬¦æ·»åŠ åˆ°<code>epfd</code>ä¸­</li><li><code>EPOLL_CTL_MOD</code>ï¼šä¿®æ”¹å·²æœ‰æ–‡ä»¶æè¿°ç¬¦çš„ç›‘å¬äº‹ä»¶</li><li><code>EPOLL_CTL_DEL</code>ï¼šåˆ é™¤å·²æœ‰æ–‡ä»¶æè¿°ç¬¦</li></ul></li><li>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ç›®æ ‡æ–‡ä»¶æè¿°ç¬¦</li><li>ç¬¬å››ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª<code>epoll_event</code>ç»“æ„ä½“</li></ul><p>è¿™ä¸ªç»“æ„ä½“çš„å®šä¹‰å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">union</span> <span class="title">epoll_data</span> &#123;</span></span><br><span class="line">    <span class="type">void</span>        *ptr;</span><br><span class="line">    <span class="type">int</span>          fd;</span><br><span class="line">    <span class="type">uint32_t</span>     u32;</span><br><span class="line">    <span class="type">uint64_t</span>     u64;</span><br><span class="line">&#125; <span class="type">epoll_data_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">epoll_event</span> &#123;</span></span><br><span class="line">    <span class="type">uint32_t</span>     events;      <span class="comment">/* Epoll events */</span></span><br><span class="line">    <span class="type">epoll_data_t</span> data;        <span class="comment">/* User data variable */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="äº‹ä»¶"><a href="#äº‹ä»¶" class="headerlink" title="äº‹ä»¶"></a>äº‹ä»¶</h4><p>äº‹ä»¶<code>events</code>å¯ä»¥æ˜¯ä¸‹é¢çš„è¿™äº›é€‰é¡¹</p><table><thead><tr><th>äº‹ä»¶</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>EPOLLIN</td><td>è¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å¯ä»¥è¯» (åŒ…æ‹¬å¯¹ç«¯SOCKETæ­£å¸¸å…³é—­);</td></tr><tr><td>EPOLLOUT</td><td>è¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å¯ä»¥å†™;</td></tr><tr><td>EPOLLPRI</td><td>è¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦æœ‰ç´§æ€¥çš„æ•°æ®å¯è¯» (è¿™é‡Œåº”è¯¥è¡¨ç¤ºæœ‰å¸¦å¤–æ•°æ®åˆ°æ¥);</td></tr><tr><td>EPOLLERR</td><td>è¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å‘ç”Ÿé”™è¯¯;</td></tr><tr><td>EPOLLHUP</td><td>è¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦è¢«æŒ‚æ–­;</td></tr><tr><td>EPOLLET</td><td>å°†EPOLLè®¾ä¸º<strong>è¾¹ç¼˜è§¦å‘ <strong>(Edge Triggered)æ¨¡å¼,  è¿™æ˜¯ç›¸å¯¹äº</strong>æ°´å¹³è§¦å‘</strong>(Level Triggered) æ¥è¯´çš„ï¼›</td></tr><tr><td>EPOLLONESHOT</td><td><strong>åªç›‘å¬ä¸€æ¬¡äº‹ä»¶,</strong>  å½“ç›‘å¬å®Œè¿™æ¬¡äº‹ä»¶ä¹‹å,  å¦‚æœè¿˜éœ€è¦ç»§ç»­ç›‘å¬è¿™ä¸ªsocketçš„è¯,  éœ€è¦æ‰‹åŠ¨å†æ¬¡æŠŠè¿™ä¸ªsocketåŠ å…¥åˆ°EPOLLé˜Ÿåˆ—é‡Œï¼›</td></tr></tbody></table><h3 id="5-1-3-epoll-wait"><a href="#5-1-3-epoll-wait" class="headerlink" title="5.1.3 epoll_wait"></a>5.1.3 epoll_wait</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/epoll.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">epoll_wait</span><span class="params">(<span class="type">int</span> epfd,  <span class="keyword">struct</span> epoll_event *events, </span></span><br><span class="line"><span class="params">               <span class="type">int</span> maxevents,  <span class="type">int</span> timeout)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">epoll_pwait</span><span class="params">(<span class="type">int</span> epfd,  <span class="keyword">struct</span> epoll_event *events, </span></span><br><span class="line"><span class="params">                <span class="type">int</span> maxevents,  <span class="type">int</span> timeout, </span></span><br><span class="line"><span class="params">                <span class="type">const</span> <span class="type">sigset_t</span> *sigmask)</span>;</span><br></pre></td></tr></table></figure><p>æ”¹å‡½æ•°çš„ä½œç”¨æ˜¯æ”¶é›†åœ¨epollç›‘æ§çš„äº‹ä»¶ä¸­ï¼Œå·²ç»å°±ç»ªçš„äº‹ä»¶</p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯epollçš„æ–‡ä»¶æè¿°ç¬¦å¥æŸ„</li><li>å‚æ•°eventsæ˜¯<code>epoll_events</code>ç»“æ„ä½“æ•°ç»„ï¼Œæ˜¯ä¸€ä¸ªè¾“å‡ºå‹å‚æ•°ã€‚epollä¼šå°†å°±ç»ªçš„äº‹ä»¶èµ‹å€¼åˆ°eventsæ•°ç»„é‡Œé¢ï¼›</li><li>maxevents å‘Šè¯‰å†…æ ¸è¿™ä¸ªeventsçš„å¤§å°ï¼Œå…¶ä¸å¯ä»¥è¶…è¿‡<code>epoll_create</code>çš„sizeï¼›</li><li>å‚æ•°timeoutæ˜¯è¶…æ—¶æ—¶é—´ï¼Œä¹Ÿæ˜¯æ¯«ç§’ï¼ˆ0éé˜»å¡ï¼Œ-1æ°¸ä¹…é˜»å¡ï¼‰</li><li>è¿”å›å€¼ï¼šæˆåŠŸè¿”å›IOäº‹ä»¶å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦æ•°ç›®ï¼Œ0ä»£è¡¨è¶…æ—¶ï¼Œè´Ÿæ•°ä»£è¡¨å¤±è´¥</li></ul><h2 id="5-2-å·¥ä½œåŸç†"><a href="#5-2-å·¥ä½œåŸç†" class="headerlink" title="5.2 å·¥ä½œåŸç†"></a>5.2 å·¥ä½œåŸç†</h2><h3 id="5-2-1-ä»æºç çœ‹æµç¨‹"><a href="#5-2-1-ä»æºç çœ‹æµç¨‹" class="headerlink" title="5.2.1 ä»æºç çœ‹æµç¨‹"></a>5.2.1 ä»æºç çœ‹æµç¨‹</h3><p>æˆ‘ä»¬çŸ¥é“ï¼Œselecté€šè¿‡ä½å›¾æ¥å‘Šè¯‰æ“ä½œç³»ç»Ÿéœ€è¦ç®¡ç†çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œpollé€šè¿‡ç»“æ„ä½“æ•°ç»„æ¥å‘Šè¯‰æ“ä½œç³»ç»Ÿéœ€è¦ç®¡ç†çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</p><p>ä½†epollé‡Œé¢ï¼Œå´å˜æˆäº†ä¸€ä¸ªepfdæ–‡ä»¶å¥æŸ„ï¼Œæˆ‘ä»¬åªæ˜¯ç»™è¿™ä¸ªç‰¹å®šçš„å¥æŸ„äº¤ä»˜æ–‡ä»¶æè¿°ç¬¦ã€‚è¿™è¯´æ˜åº•å±‚è‚¯å®šéœ€è¦å…¶ä»–çš„æ•°æ®ç»“æ„ï¼Œæ¥ç®¡ç†æŸä¸ªè¿›ç¨‹çš„æŸä¸ªepfdäº¤ä»˜ç»™æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»¥åŠéœ€è¦ç›‘çœ‹çš„äº‹ä»¶ï¼</p><p>åœ¨<code>Linux 2.6.32.16</code>æºç <code>fs/eventpoll.c</code>ä¸­ï¼Œå¯ä»¥æ‰¾åˆ°å¦‚ä¸‹è¿™ä¸ªç»“æ„ä½“</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// linuxæºç æ–‡ä»¶è·¯å¾„ï¼šfs/eventpoll.c</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * This structure is stored inside the &quot;private_data&quot; member of the file</span></span><br><span class="line"><span class="comment"> * structure and rapresent the main data sructure for the eventpoll</span></span><br><span class="line"><span class="comment"> * interface.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eventpoll</span> &#123;</span></span><br><span class="line"><span class="comment">/* Protect the this structure access */</span></span><br><span class="line"><span class="type">spinlock_t</span> lock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * This mutex is used to ensure that files are not removed</span></span><br><span class="line"><span class="comment"> * while epoll is using them. This is held during the event</span></span><br><span class="line"><span class="comment"> * collection loop, the file cleanup path, the epoll file exit</span></span><br><span class="line"><span class="comment"> * code and the ctl operations.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mutex</span> <span class="title">mtx</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wait queue used by sys_epoll_wait() */</span></span><br><span class="line"><span class="type">wait_queue_head_t</span> wq;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wait queue used by file-&gt;poll() */</span></span><br><span class="line"><span class="type">wait_queue_head_t</span> poll_wait;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* List of ready file descriptors */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">rdllist</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* RB tree root used to store monitored fd structs */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rb_root</span> <span class="title">rbr</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * This is a single linked list that chains all the &quot;struct epitem&quot; that</span></span><br><span class="line"><span class="comment"> * happened while transfering ready events to userspace w/out</span></span><br><span class="line"><span class="comment"> * holding -&gt;lock.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">epitem</span> *<span class="title">ovflist</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* The user that created the eventpoll descriptor */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">user_struct</span> *<span class="title">user</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œé¢ï¼Œæˆ‘ä»¬æ—¢å¯ä»¥çœ‹åˆ°ç†Ÿæ‚‰çš„<code>mutex</code>é”ï¼Œåˆå¯ä»¥çœ‹åˆ°ä¸€ä¸ª<code>wait_queue</code>ç­‰å¾…é˜Ÿåˆ—ï¼Œä¸€ä¸ªåŒé“¾è¡¨ï¼Œå’Œä¸€ä¸ª<code>rb_root</code>çº¢é»‘æ ‘èŠ‚ç‚¹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> &#123;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> *<span class="title">next</span>, *<span class="title">prev</span>;</span></span><br><span class="line">&#125;; <span class="comment">// å†…æ ¸ä¸­çš„åŒé“¾è¡¨</span></span><br></pre></td></tr></table></figure><p>æŠ½è±¡å‡ºæ¥ä¹‹åï¼Œå…¶å¤§æ¦‚çš„ç»“æ„å›¾å¦‚ä¸‹</p><p><img src="https://img.musnow.top/i/2023/08/6ca5fd02f9838c2ef2d41a014623262d.png" alt="image-20230826160246637"></p><p>å½“æŸä¸€ä¸ªè¿›ç¨‹è°ƒç”¨<code>epoll_create</code>åˆ›å»º<code>epoll</code>çš„æ–‡ä»¶æè¿°ç¬¦å¥æŸ„çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šå¸®æˆ‘ä»¬åœ¨åº•å±‚åˆ›å»ºä¸€ä¸ª<code>struct eventpoll</code>ç»“æ„ä½“ï¼Œå†…éƒ¨åŒ…å«äº†å°±ç»ªé˜Ÿåˆ—å’Œä¸€ä¸ªçº¢é»‘æ ‘ï¼ˆä¸»è¦å…³æ³¨è¿™ä¸¤ä¸ªæˆå‘˜ï¼‰</p><ul><li>è°ƒç”¨<code>epoll_ctl</code>çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šå°†æˆ‘ä»¬é…ç½®çš„æ–‡ä»¶æè¿°ç¬¦å’Œå¯¹äºçš„äº‹ä»¶æ·»åŠ åˆ°çº¢é»‘æ ‘èŠ‚ç‚¹ä¸­ï¼›</li><li>é‡å¤æ·»åŠ çš„äº‹ä»¶ä¹Ÿå¯ä»¥é€šè¿‡çº¢é»‘æ ‘çš„é”®å€¼å”¯ä¸€æ€§æ£€æŸ¥å‡ºæ¥ï¼ˆé¿å…å†—ä½™ï¼‰</li><li>æ‰€æœ‰æ·»åŠ åˆ°epollä¸­çš„äº‹ä»¶éƒ½ä¼šä¸è®¾å¤‡çš„<strong>ç½‘å¡é©±åŠ¨ç¨‹åº</strong>å»ºç«‹å›è°ƒæ¶ˆæ¯ï¼Œå½“æŸä¸ªæ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„é“¾æ¥æœ‰ä¿¡æ¯ä¼ æ¥çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨<strong>å›è°ƒå‡½æ•°</strong>ï¼Œå‘ŠçŸ¥epoll<ul><li>ç½‘å¡æ”¶åˆ°æ¶ˆæ¯</li><li>é©±åŠ¨ç¨‹åºå¤„ç†ï¼Œå¹¶è°ƒç”¨å¯¹åº”çš„å›è°ƒæœºåˆ¶</li><li>epollé€šè¿‡å›è°ƒæ¶ˆæ¯æ”¶åˆ°äº‹ä»¶å°±ç»ªï¼Œå°†å…¶é“¾å…¥<code>rdllist</code>åŒé“¾è¡¨ä¸­</li><li>ä¸Šå±‚åªéœ€è¦è°ƒå›<code>epoll_wait</code>ä»è¯¥åŒé“¾è¡¨ä¸­è·å–å°±ç»ªäº‹ä»¶</li></ul></li><li>è¯¥å›è°ƒåŠæ³•åœ¨åº•å±‚ä¸º<code>ep_poll_callback</code>ï¼Œå®ƒä¼šå°†å°±ç»ªçš„äº‹ä»¶æ’å…¥åˆ°<code>rdllist</code>åŒé“¾è¡¨ä¸­</li><li>epollä¸­æ¯ä¸€ä¸ªäº‹ä»¶éƒ½ä¼šå»ºç«‹ä¸€ä¸ªå¯¹åº”çš„<code>epitem</code>ç»“æ„ä½“</li><li>å½“è°ƒç”¨<code>epoll_wait</code>æœ‰äº‹ä»¶å‘ç”Ÿçš„æ—¶å€™ï¼Œåªéœ€è¦æ£€æŸ¥<code>eventpoll</code>å¯¹è±¡çš„<code>rdllist</code>åŒé“¾è¡¨ä¸­æ˜¯å¦æœ‰<code>epitem</code>å…ƒç´ å³å¯ï¼Œæœ‰åˆ™å–å‡ºï¼›</li><li>å¦‚æœ<code>rdllist</code>ä¸ä¸ºç©ºï¼Œåˆ™å°†å‘ç”Ÿçš„äº‹ä»¶å¤åˆ¶åˆ°ç”¨æˆ·æ€ï¼Œå¹¶å°†äº‹ä»¶æ•°é‡è¿”å›ç»™ç”¨æˆ·ï¼›å¯¹æ¯”éœ€è¦éå†çš„<code>select/poll</code>ï¼Œè¿™ä¸ªè·å–å°±ç»ªäº‹ä»¶çš„<strong>æ—¶é—´å¤æ‚åº¦</strong>æ˜¯<code>O(1)</code>çš„ï¼ˆç›´æ¥åˆ¤æ–­å¹¶å–å‡ºå°±å¯ä»¥äº†ï¼‰</li></ul><p>è¿™ä¸€å¤§åœˆæ“ä½œéƒ½æ˜¯æ“ä½œç³»ç»Ÿè‡ªè¡Œå®Œæˆçš„ï¼Œå¯¹äºç”¨æˆ·æ¥è¯´æ˜¯æ— æ„ŸçŸ¥çš„ï¼</p><p>å…³äºepitemç»“æ„ä½“ï¼Œå¯ä»¥ç…ä¸€çœ¼ä¸‹é¢çš„æ³¨é‡Šï¼Œä»–ä¹Ÿæ˜¯åœ¨æºç çš„<code>fs/eventpoll.c</code>æ–‡ä»¶ä¸­</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">epitem</span> &#123;</span><br><span class="line"><span class="comment">/* RB tree node used to link this structure to the eventpoll RB tree */</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">rb_node</span> rbn; <span class="comment">// è¿™ä¸ªäº‹ä»¶å¯¹åº”çš„çº¢é»‘æ ‘èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* List header used to link this structure to the eventpoll ready list */</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">list_head</span> rdllink; <span class="comment">// è¿™ä¸ªäº‹ä»¶å¯¹åº”çš„åŒé“¾è¡¨èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Works together &quot;struct eventpoll&quot;-&gt;ovflist in keeping the</span></span><br><span class="line"><span class="comment"> * single linked chain of items.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">epitem</span> *next; </span><br><span class="line"></span><br><span class="line"><span class="comment">/* The file descriptor information this item refers to */</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">epoll_filefd</span> ffd; <span class="comment">// äº‹ä»¶å¥æŸ„ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Number of active wait queue attached to poll operations */</span></span><br><span class="line"><span class="type">int</span> nwait; </span><br><span class="line"></span><br><span class="line"><span class="comment">/* List containing poll wait queues */</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">list_head</span> pwqlist;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* The &quot;container&quot; of this item */</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">eventpoll</span> *ep; <span class="comment">// æŒ‡å‘å…¶æ‰€å±çš„epolleventå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* List header used to link this item to the &quot;struct file&quot; items list */</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">list_head</span> fllink;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* The structure that describe the interested events and the source fd */</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">epoll_event</span> event; <span class="comment">// è¯¥fdå…³æ³¨çš„äº‹ä»¶</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="5-2-2-PSHæ ‡è®°ä½"><a href="#5-2-2-PSHæ ‡è®°ä½" class="headerlink" title="5.2.2 PSHæ ‡è®°ä½"></a>5.2.2 PSHæ ‡è®°ä½</h3><p>åœ¨å­¦ä¹ TCPçš„æ—¶å€™ï¼Œæˆ‘ä»¬äº†è§£è¿‡PSHè¿™ä¸ªæ ‡è®°ä½ï¼Œå®ƒçš„ä½œç”¨æ˜¯å‘Šè¯‰å¯¹ç«¯çš„åº”ç”¨å±‚ï¼Œå°½å¿«å–èµ°ç¼“å†²åŒºä¸­çš„æ•°æ®ã€‚</p><p>å¯¹äºepollè€Œè¨€ï¼Œè¿™ä¸ªPSHçš„ä½œç”¨å°±æ˜¯è®©epollåœ¨<code>rdllist</code>é‡Œé¢æ–°å»ºä¸€ä¸ªå°±ç»ªèŠ‚ç‚¹ï¼Œè¿™æ ·ä¸Šå±‚å°±èƒ½çŸ¥é“è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„äº‹ä»¶å°±ç»ªäº†ï¼ˆè‡³äºè¯»ä¸è¯»å–ä¾æ—§æ˜¯ä¸Šå±‚çš„é—®é¢˜ï¼‰</p><ul><li>ä½ å¯èƒ½ä¼šé—®ï¼Œæ—¢ç„¶å¯¹æ–¹éƒ½å‘æ¶ˆæ¯æ¥å‚¬ä½ å–æ•°æ®äº†ï¼Œé‚£ä¸åº”è¯¥ä½ çš„æ•°æ®å¹¶æ²¡æœ‰è¢«å–èµ°å—ï¼Ÿè¿™æ—¶å€™è¯¥æ–‡ä»¶æè¿°ç¬¦çš„å°±ç»ªèŠ‚ç‚¹ä¸åº”è¯¥å·²ç»å­˜åœ¨äº†å—ï¼Ÿä¸ºä»€ä¹ˆè¿˜éœ€è¦é¢å¤–åˆ›å»ºä¸€ä¸ªå°±ç»ªäº‹ä»¶çš„èŠ‚ç‚¹æ¥é€šçŸ¥ç”¨æˆ·å‘¢ï¼Ÿ</li></ul><p>è¿™å°±æ¶‰åŠåˆ°epollçš„ä¸¤ç§å·¥ä½œç­–ç•¥LT&#x2F;ETäº†ï¼Œåæ–‡ä¼šè®²è§£ï¼›</p><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œepollå¹¶æ²¡æœ‰å¯¹URGè¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œè€Œæ˜¯è§†ä¹‹ä¸ºæ­£å¸¸çš„å¯è¯»äº‹ä»¶è¿å…¥å°±ç»ªé˜Ÿåˆ—ï¼Œä½†æ˜¯äº‹ä»¶ç±»å‹æœ‰æ‰€ä¸åŒï¼Œå¯ä»¥ç”¨<code>EPOLLPRI</code>æ¥å…³æ³¨ç´§æ€¥äº‹ä»¶</p><p>ï¼ˆå­˜ç–‘ï¼Œä½†æ˜¯æ²¡æœ‰æ‰¾åˆ°ç›¸å…³èµ„æ–™ï¼Œæš‚ä¸”è¿™ä¹ˆè®¤ä¸ºï¼‰</p></blockquote><h3 id="5-2-3-epollä¼˜ç‚¹"><a href="#5-2-3-epollä¼˜ç‚¹" class="headerlink" title="5.2.3 epollä¼˜ç‚¹"></a>5.2.3 epollä¼˜ç‚¹</h3><p>ä¸€ä¸‹æ˜¯epollç›¸æ¯”pollå’Œselectçš„ä¼˜ç‚¹</p><ul><li>æ¥å£ä½¿ç”¨æ–¹ä¾¿ï¼Œè™½ç„¶æ‹†åˆ†äº†3ä¸ªå‡½æ•°ï¼Œä½†æ˜¯æ¯ä¸ªå‡½æ•°çš„åŠŸèƒ½éå¸¸æ˜ç¡®ï¼›ä¸éœ€è¦æ¯æ¬¡ä½¿ç”¨éƒ½é‡æ–°è®¾ç½®æ–‡ä»¶æè¿°ç¬¦ï¼Œä¹Ÿå®ç°äº†è¾“å…¥å’Œè¾“å‡ºå‚æ•°çš„åˆ†ç¦»</li><li>æ•°æ®æ‹·è´è½»é‡ï¼šåœ¨éœ€è¦çš„æ—¶å€™è°ƒç”¨epoll_ctlæ¥å¤„ç†æ–‡ä»¶æè¿°ç¬¦å’Œäº‹ä»¶ï¼Œå¹¶ä¸ä¼šæ¯æ¬¡è°ƒç”¨éƒ½å¾—å¤§æ‰¹é‡åœ¨ç”¨æˆ·å’Œå†…æ ¸æ€ä¹‹é—´æ‹·è´æ•°æ®ï¼ˆpollå’Œselectéƒ½éœ€è¦ï¼‰</li><li>äº‹ä»¶å›è°ƒæœºåˆ¶ï¼šä½¿ç”¨äº‹ä»¶å›è°ƒæ¥æ›¿ä»£éå†ï¼Œå›è°ƒå‡½æ•°å°†å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦ç»“æ„åŠ å…¥åˆ°å°±ç»ªé˜Ÿåˆ—ä¸­ï¼›<code>epoll_wait</code>ç›´æ¥ä½¿ç”¨å°±ç»ªé˜Ÿåˆ—ï¼Œå°±èƒ½çŸ¥é“é‚£äº›æ–‡ä»¶æè¿°ç¬¦å°±ç»ªï¼›å³ä¾¿æ–‡ä»¶æè¿°ç¬¦è¾ƒå¤šçš„æ—¶å€™ï¼Œä¹Ÿèƒ½å¿«é€ŸçŸ¥é“å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆçœå»äº†éå†çš„æ—¶é—´æ¶ˆè€—ï¼‰</li><li>æ— ä¸Šé™ï¼šæ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰æ•°é‡é™åˆ¶</li><li>çº¿ç¨‹å®‰å…¨ï¼šåœ¨<code>eventpoll</code>ç»“æ„ä½“é‡Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ª<code>mutex</code>é”ï¼Œåœ¨linuxåº•å±‚å·²ç»å¸®æˆ‘ç»´æŠ¤äº†epollç›¸å…³æ“ä½œçš„çº¿ç¨‹å®‰å…¨æ€§ï¼</li></ul><p>åœ¨æœ‰äº›åšå®¢é‡Œé¢è¯´epollä½¿ç”¨äº†<strong>å†…å­˜æ˜ å°„æœºåˆ¶</strong>ï¼Œè¿™ç§è¯´æ³•æ˜¯<strong>é”™è¯¯</strong>çš„ï¼å› ä¸º<code>epoll_event</code>ç»“æ„ä½“æ˜¯åœ¨ç”¨æˆ·æ€åˆ›å»ºçš„ï¼Œæˆ‘ä»¬åŠ¿å¿…è¿˜æ˜¯éœ€è¦è¿›è¡Œä¸€å®šçš„ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„æ‹·è´ã€‚</p><blockquote><p>å†…å­˜æ˜ å°„æœºåˆ¶ï¼šlinuxå†…æ ¸ç›´æ¥å°†å°±ç»ªé˜Ÿåˆ—é€šè¿‡mmapçš„æ–¹å¼æ˜ å°„åˆ°ç”¨æˆ·æ€ï¼Œé¿å…æ‹·è´æ¶ˆè€—ï¼ˆä½ å¯ä»¥ç†è§£ä¸ºç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´çš„å…±äº«å†…å­˜ï¼‰</p></blockquote><h2 id="5-3-å·¥ä½œæ¨¡å¼"><a href="#5-3-å·¥ä½œæ¨¡å¼" class="headerlink" title="5.3 å·¥ä½œæ¨¡å¼"></a>5.3 å·¥ä½œæ¨¡å¼</h2><p>åœ¨epollçš„å·¥ä½œæ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æ°´å¹³è§¦å‘å’Œè¾¹ç¼˜è§¦å‘ï¼Œè¿™å°±å¥½æ¯”ç‰©ç†å®éªŒä¸­ç¤ºæ³¢å™¨çš„ä¸¤ç§è§¦å‘æ¨¡å¼ï¼›</p><p>å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªtcpé€šä¿¡çš„æ —å­ï¼š</p><ul><li>å¯¹æ–¹ç»™æˆ‘å‘é€äº†2kbæ•°æ®</li><li>æˆ‘é€šè¿‡epoll_waitæˆåŠŸè·å–åˆ°è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„è¯»äº‹ä»¶å°±ç»ª</li><li>æˆ‘å–å‡ºæ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡<code>recv</code>è¯»å–äº†1kbçš„æ•°æ®</li><li>ä½†ç¼“å†²åŒºé‡Œé¢è¿˜æœ‰1kbâ€¦â€¦</li></ul><h3 id="5-3-1-æ°´å¹³è§¦å‘-LT"><a href="#5-3-1-æ°´å¹³è§¦å‘-LT" class="headerlink" title="5.3.1 æ°´å¹³è§¦å‘ LT"></a>5.3.1 æ°´å¹³è§¦å‘ LT</h3><p>æ‰€è°“æ°´å¹³è§¦å‘ï¼Œå°±æ˜¯åªè¦fdçš„ç¼“å­˜åŒºé‡Œé¢æœ‰æ•°æ®ï¼Œé‚£ä¹ˆepollå°±ä¼šä¸€ç›´è®¤ä¸ºè¿™ä¸ªfdçš„è¯»äº‹ä»¶æ˜¯å°±ç»ªçš„ï¼Œå¹¶ä¸€ç›´é€šçŸ¥ç”¨æˆ·ï¼›</p><ul><li>ä¸Šé¢çš„æ —å­ä¸­ï¼Œå› ä¸ºç”¨æˆ·åªæ‹¿èµ°äº†1kbæ•°æ®ï¼Œç¼“å†²åŒºé‡Œé¢è¿˜æœ‰1kbï¼Œåœ¨ç¬¬äºŒæ¬¡è°ƒç”¨<code>epoll_wait</code>çš„æ—¶å€™ï¼Œepollè¿˜æ˜¯ä¼šæŠ¥å‘Šè¯¥æ–‡ä»¶æè¿°ç¬¦çš„è¯»äº‹ä»¶å°±ç»ªï¼Œè®©ç”¨æˆ·å–èµ°å‰©ä¸‹çš„æ•°æ®</li><li>åªæœ‰æ‰€æœ‰çš„æ•°æ®éƒ½è¢«å¤„ç†å®Œæ¯•ï¼Œepollæ‰ä¸ä¼šç»§ç»­é€šçŸ¥</li><li>LTæ”¯æŒé˜»å¡å’Œéé˜»å¡è¯»å†™</li></ul><p>å› ä¸ºLTæ¨¡å¼åªè¦ç¼“å†²åŒºä¸­è¿˜æœ‰å‰©ä½™æ•°æ®ï¼Œepollå°±ä¼šä¸€ç›´é€šçŸ¥æˆ‘ä»¬ï¼Œè¿™å°±å…è®¸ä¸Šå±‚ä¸éœ€è¦ä¸€æ¬¡æ€§å–èµ°æ‰€æœ‰æ•°æ®ï¼Œæˆ–è€…è¯´ä¸ç«‹åˆ»å¤„ç†å½“å‰ç¼“å†²åŒºçš„æ•°æ®ã€‚</p><p>å› æ­¤ï¼Œåœ¨LTæ¨¡å¼ä¸­ï¼Œåªè¦æ˜¯äº‹ä»¶å°±ç»ªï¼Œé‚£ä¹ˆç¼“å†²åŒºé‡Œé¢ä¸€å®šä¼šæœ‰æ•°æ®ã€‚æ‰€ä»¥å®ƒæ˜¯å³æ”¯æŒé˜»å¡ï¼Œä¹Ÿæ”¯æŒéé˜»å¡çš„æ–‡ä»¶è¯»å†™çš„ï¼</p><blockquote><p>select&#x2F;polléƒ½æ˜¯é»˜è®¤çš„LTæ¨¡å¼ï¼Œä¸”ä¸å¯ä»¥åˆ‡æ¢æ¨¡å¼ï¼›epollé»˜è®¤æ˜¯LTï¼Œä½†å¯ä»¥åˆ‡æ¢åˆ°ET</p></blockquote><h3 id="5-3-2-è¾¹ç¼˜è§¦å‘-ET"><a href="#5-3-2-è¾¹ç¼˜è§¦å‘-ET" class="headerlink" title="5.3.2 è¾¹ç¼˜è§¦å‘ ET"></a>5.3.2 è¾¹ç¼˜è§¦å‘ ET</h3><p>è¾¹ç¼˜è§¦å‘çš„å«ä¹‰ï¼Œæ˜¯åªæœ‰æŸä¸ªæ–‡ä»¶æè¿°ç¬¦çš„æ•°æ®å˜åŠ¨çš„æ—¶å€™ï¼Œæ‰ä¼šé€šçŸ¥ç”¨æˆ·ï¼›ååº”åˆ°è¯»äº‹ä»¶ä¸Šï¼Œåªæœ‰ç¼“å†²åŒºæ•°æ®å¢å¤šäº†ï¼Œæ‰ä¼šé€šçŸ¥ç”¨æˆ·ï¼›</p><ul><li>åœ¨ä¸Šé¢çš„tcpé€šä¿¡æ —å­ä¸­ï¼Œepollä¼šåœ¨æ•°æ®åˆ°æ¥çš„æ—¶å€™é€šçŸ¥ç”¨æˆ·ï¼›ä½†å³ä¾¿ç”¨æˆ·æ²¡æœ‰ä¸€æ¬¡æ€§è¯»å–å®Œæ¯•æ‰€æœ‰æ•°æ®ï¼Œepollå¹¶ä¸ä¼šç»§ç»­é€šçŸ¥äº†ï¼ˆé™¤éæœ‰PSHä¿¡æ¯åˆ°æ¥ï¼‰</li><li>åœ¨ETæ¨¡å¼ä¸‹ï¼Œæ–‡ä»¶æè¿°ç¬¦çš„äº‹ä»¶å°±ç»ªåï¼Œåªæœ‰ä¸€æ¬¡å¤„ç†æœºä¼šã€‚ç¬¬äºŒæ¬¡ä½ å°±æ— æ³•å¾—çŸ¥è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸Šæ˜¯å¦è¿˜æœ‰æ²¡æœ‰è¯»å®Œçš„æ•°æ®äº†</li><li>å› ä¸ºETæ¨¡å¼ä¸‹<code>epoll_wait</code>è¿”å›çš„æ¬¡æ•°æ›´å°‘ï¼Œæ‰€ä»¥ETçš„æ€§èƒ½è¿œé«˜äºLTï¼ˆnginxé»˜è®¤é‡‡ç”¨ETæ¨¡å¼çš„epollï¼‰</li><li>å› ä¸ºæˆ‘ä»¬åªæœ‰ä¸€æ¬¡æœºä¼šï¼Œæ‰€ä»¥æ”¶åˆ°äº‹ä»¶åå¿…é¡»ç«‹å³å¤„ç†</li><li>åªæ”¯æŒéé˜»å¡</li></ul><h3 id="5-3-3-LTå’ŒETçš„åŒºåˆ«"><a href="#5-3-3-LTå’ŒETçš„åŒºåˆ«" class="headerlink" title="5.3.3 LTå’ŒETçš„åŒºåˆ«"></a>5.3.3 LTå’ŒETçš„åŒºåˆ«</h3><p>å› ä¸ºETæ¨¡å¼ä¸‹ï¼Œepollåªä¼šæç¤ºä½ ä¸€æ¬¡äº‹ä»¶å°±ç»ªï¼Œæ‰€ä»¥å°±å€’é€¼ç¨‹åºçŒ¿åœ¨æ”¶åˆ°è¿™ä¸ªäº‹ä»¶ä¹‹åï¼Œä¸€æ¬¡æ€§å¤„ç†å®Œæ•°æ®ï¼›</p><p>å½“ç„¶ï¼ŒLTæ¨¡å¼ä¸‹ä½ ä¹Ÿå¯ä»¥è¿™ä¹ˆåšï¼ˆå¦‚æœæ¯æ¬¡éƒ½èƒ½ä¸€æ¬¡æ€§å–èµ°æ•°æ®ï¼Œé‚£ä¹ˆLTå’ŒETçš„æ€§èƒ½å·®è·å°±ä¸å¤§äº†ï¼‰ã€‚ä½†ETæ¨¡å¼å°±ç›¸å½“äºå‘Šè¯‰æ‰€æœ‰ä½¿ç”¨è€…ï¼Œå¿…é¡»è¿™ä¹ˆåšï¼Œå‡å°‘äº†å®¹é”™ç‡ï¼›</p><p>ä½†ETçš„ä»£ç å¤æ‚åº¦ä¼šå¢åŠ ï¼›</p><h3 id="5-3-4-ETå’Œéé˜»å¡"><a href="#5-3-4-ETå’Œéé˜»å¡" class="headerlink" title="5.3.4 ETå’Œéé˜»å¡"></a>5.3.4 ETå’Œéé˜»å¡</h3><p>ä¸ºä»€ä¹ˆETå¿…é¡»è¦å°†æ–‡ä»¶æè¿°ç¬¦è®¾ç½®æˆéé˜»å¡å‘¢ï¼Ÿ</p><p>å‡è®¾ä¸‹é¢è¿™ä¸ªåœºæ™¯ï¼Œå®¢æˆ·ç«¯Cç»™æœåŠ¡ç«¯Så‘é€10kbæ•°æ®ï¼Œåœ¨æ²¡æœ‰æ”¶åˆ°æœåŠ¡ç«¯å¯¹è¿™ä¸ªæ•°æ®çš„å“åº”ä¹‹å‰ï¼Œä¸ä¼šç»§ç»­å‘é€æ•°æ®ï¼›</p><p><img src="https://img.musnow.top/i/2023/08/1320c1d24627c05783f4d64dc6f43f21.png" alt="image-20230826180800176"></p><p>ä½†æœåŠ¡å™¨ä¸€æ¬¡æ€§åªè¯»å–äº†1KBï¼Œå‰©ä¸‹äº†9KBæ•°æ®åœ¨ç¼“å†²åŒºä¸­ï¼›å› ä¸ºæ•°æ®æ²¡æœ‰è¯»å®Œï¼Œæ‰€ä»¥ä¸ä¼šç»™å®¢æˆ·ç«¯å‘é€å“åº”ã€‚</p><p><img src="https://img.musnow.top/i/2023/08/42b5a34b96663a7b0314afd41e325896.png" alt="image-20230826180840435"></p><p>å› ä¸ºepollè®¾ç½®äº†ETæ¨¡å¼ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šè®¤ä¸ºæ­¤æ—¶çš„æ–‡ä»¶æè¿°ç¬¦è¯»å°±ç»ªï¼›<code>epoll_wait</code>ä¸ä¼šé’ˆå¯¹è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦è¿”å›ï¼Œå‰©ä¸‹çš„9KBæ•°æ®ä¼šä¸€ç›´ç•™åœ¨ç¼“å†²åŒºä¸­ï¼›</p><ul><li>æ³¨æ„ï¼ŒæœåŠ¡ç«¯çš„ä»£ç é€»è¾‘æ˜¯æ”¶åˆ°å°±ç»ªäº‹ä»¶å°±è¯»å–ä¸€æ¬¡ï¼›å¹¶ä¸å­˜åœ¨å†æ¬¡è¯»å–çš„å¯èƒ½</li></ul><p>é—®é¢˜å°±æ¥äº†ï¼</p><ul><li>æœåŠ¡ç«¯å¿…é¡»è¦æ”¶åˆ°å°±ç»ªäº‹ä»¶æ‰ä¼šæŠŠå‰©ä¸‹çš„9kbæ•°æ®ç»™è¯»å–å®Œæ¯•</li><li>æœåŠ¡ç«¯æƒ³è¦æ”¶åˆ°å°±ç»ªäº‹ä»¶ï¼Œå°±å¿…é¡»æ”¶åˆ°å®¢æˆ·ç«¯Cå‘æ¥çš„æ–°æ•°æ®</li><li>ä½†å®¢æˆ·ç«¯Cè®¤ä¸ºæœåŠ¡å™¨æ²¡æœ‰ç»™è‡ªå·±å‘é€å“åº”ï¼Œä¸ä¼šç»§ç»­å‘é€æ•°æ®</li></ul><p>è¿™å°±ç›¸å½“äºä¸€ä¸ªæ­»å¾ªç¯äº†ï¼</p><p><img src="https://img.musnow.top/i/2023/08/be296238e7cd395dabf1599602a8b193.png" alt="image-20230826181214987"></p><p>å› æ­¤ï¼ŒæœåŠ¡ç«¯ä¸ºäº†ä¿è¯ä¸€æ¬¡æ€§èƒ½å°†æ•°æ®å…¨éƒ¨å–å‡ºï¼Œå¿…é¡»è¦é‡‡ç”¨å¾ªç¯è¯»å–+éé˜»å¡çš„æ–¹å¼æ¥å°†ç¼“å†²åŒºè¯»å®Œï¼</p><p>å¦‚æœé‡‡ç”¨é˜»å¡å¼ï¼Œé‚£ä¹ˆåœ¨è½®è¯¢è¯»å–çš„æ—¶å€™ï¼Œå°±æœ‰å¯èƒ½å› ä¸ºç¼“å†²åŒºå·²ç»ç©ºäº†è€Œé˜»å¡ï¼å› ä¸ºæˆ‘ä»¬è¿™ä¸ªæ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„æ¨¡å‹ï¼Œè¿™æ ·ä¼šç›´æ¥å¯¼è‡´æ•´ä¸ªæœåŠ¡å™¨å®•æœºäº†ã€‚</p><p>è€ŒLTåˆ™ä¸ä¼šå‡ºç°æ­¤é—®é¢˜ï¼Œå› ä¸ºåªè¦ç¼“å†²åŒºä¸­æœ‰æ•°æ®å°±ä¼šé€šçŸ¥ä½ ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸€æ¬¡è¯»å–å®šé•¿ï¼Œå†å°†è¯»åˆ°çš„æ•°æ®æ‹¼æ¥èµ·æ¥ã€‚</p><h3 id="5-3-5-epollçš„ä½¿ç”¨åœºæ™¯"><a href="#5-3-5-epollçš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="5.3.5 epollçš„ä½¿ç”¨åœºæ™¯"></a>5.3.5 epollçš„ä½¿ç”¨åœºæ™¯</h3><p>epollçš„é«˜æ€§èƒ½æ˜¯æœ‰ä¸€å®šç‰¹æ®Šåœºæ™¯çš„ï¼Œå¦‚æœåœºæ™¯ä¸é€‚åˆï¼Œepollçš„æ€§èƒ½å¯èƒ½è¡¨ç°ä¸ä½³ï¼›</p><ul><li>å¯¹äºå¤šé“¾æ¥ä¸”é“¾æ¥ä¸­æœ‰ä¸€éƒ¨åˆ†æ´»è·ƒçš„æ—¶å€™ï¼Œé€‚åˆä½¿ç”¨epoll</li></ul><p>æ¯”å¦‚å„ç§äº’è”ç½‘APPçš„å…¥å£æœåŠ¡å™¨ï¼Œå°±å¾ˆé€‚åˆä½¿ç”¨epollæ¥å¤„ç†ä¸Šä¸‡å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼›</p><p>å¦‚æœæ˜¯ç³»ç»Ÿå†…éƒ¨å¤„ç†æœåŠ¡å™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ï¼Œé“¾æ¥æ•°è¾ƒå°‘çš„æƒ…å†µï¼Œè¿™ç§æ—¶å€™ä½¿ç”¨epollå¹¶ä¸æ–¹ä¾¿ã€‚å¾—æ ¹æ®å…·ä½“éœ€è¦é€‰æ‹©æ›´åŠ é€‚åˆçš„IOæ¨¡å‹ã€‚</p><h2 id="5-4-æƒŠç¾¤æ•ˆåº”"><a href="#5-4-æƒŠç¾¤æ•ˆåº”" class="headerlink" title="5.4 æƒŠç¾¤æ•ˆåº”"></a>5.4 æƒŠç¾¤æ•ˆåº”</h2><blockquote><p>å‚è€ƒ <a href="https://zhuanlan.zhihu.com/p/359774959">https://zhuanlan.zhihu.com/p/359774959</a></p></blockquote><h3 id="5-4-1-æ¦‚å¿µ"><a href="#5-4-1-æ¦‚å¿µ" class="headerlink" title="5.4.1 æ¦‚å¿µ"></a>5.4.1 æ¦‚å¿µ</h3><p>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¯èƒ½ä¼šé‡åˆ°epollçš„æƒŠç¾¤æ•ˆåº”ï¼›</p><ul><li>é‚£ä¹ˆä»€ä¹ˆæ˜¯æƒŠç¾¤æ•ˆåº”å‘¢ã€‚å…¶äº§ç”Ÿçš„åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</li></ul><p>æƒŠç¾¤æ•ˆåº”çš„å…·ä½“æƒ…å†µæ˜¯ï¼Œå½“æœ‰å¤šä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹åœ¨ epoll ä¸Šç­‰å¾…æŸä¸ªäº‹ä»¶ï¼ˆå¦‚å¥—æ¥å­—å¯è¯»äº‹ä»¶ï¼‰ï¼Œå½“è¯¥äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹æˆ–è¿›ç¨‹éƒ½ä¼šè¢«å”¤é†’ã€‚ç„¶è€Œï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹å¯ä»¥æˆåŠŸåœ°å¤„ç†è¿™ä¸ªäº‹ä»¶ï¼Œè€Œå…¶ä»–çš„çº¿ç¨‹æˆ–è¿›ç¨‹ä¼šè¿›è¡Œä¸å¿…è¦çš„ç«äº‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´é¢å¤–çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€é”ç«äº‰ç­‰é—®é¢˜ï¼Œä»è€Œé™ä½ç³»ç»Ÿæ€§èƒ½ã€‚</p><ul><li>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…·ä½“åœºæ™¯çš„è¯´æ˜</li></ul><p>åœ¨å¤šçº¿ç¨‹æˆ–è€…å¤šè¿›ç¨‹ç¯å¢ƒä¸‹ï¼Œæœ‰äº›äººä¸ºäº†æé«˜ç¨‹åºçš„ç¨³å®šæ€§ï¼Œå¾€å¾€ä¼šè®©<strong>å¤šä¸ªçº¿ç¨‹</strong>æˆ–è€…<strong>å¤šä¸ªè¿›ç¨‹</strong>åŒæ—¶åœ¨<code>epoll_wait</code>ç›‘å¬çš„socketæè¿°ç¬¦ã€‚å½“ä¸€ä¸ªæ–°çš„é“¾æ¥è¯·æ±‚è¿›æ¥æ—¶ï¼Œæ“ä½œç³»ç»Ÿ<strong>ä¸çŸ¥é“</strong>é€‰æ´¾é‚£ä¸ªçº¿ç¨‹æˆ–è€…è¿›ç¨‹å¤„ç†æ­¤äº‹ä»¶ï¼Œåˆ™å¹²è„†å°†å…¶ä¸­<strong>å‡ ä¸ªçº¿ç¨‹</strong>æˆ–è€…è¿›ç¨‹ç»™å”¤é†’ï¼Œè€Œå®é™…ä¸Šåªæœ‰å…¶ä¸­ä¸€ä¸ªè¿›ç¨‹æˆ–è€…çº¿ç¨‹èƒ½å¤ŸæˆåŠŸå¤„ç†acceptäº‹ä»¶ï¼Œå…¶ä»–çº¿ç¨‹éƒ½å°†å¤±è´¥ï¼Œä¸”errnoé”™è¯¯ç ä¸º<code>EAGAIN</code>ã€‚è¿™ç§ç°è±¡ç§°ä¸ºæƒŠç¾¤æ•ˆåº”ã€‚</p><p>ç»“æœæ˜¯è‚¯å®šçš„ï¼ŒæƒŠç¾¤æ•ˆåº”è‚¯å®šä¼šå¸¦æ¥èµ„æºçš„æ¶ˆè€—å’Œæ€§èƒ½çš„å½±å“ï¼Œå› ä¸ºä½ æ— ç«¯åœ°å¤šå”¤é†’äº†å‡ ä¸ªçº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹&#x2F;è¿›ç¨‹å´æ²¡æœ‰æ´»å¹²ã€‚</p><h3 id="5-4-2-å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è§£å†³åŠæ³•"><a href="#5-4-2-å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è§£å†³åŠæ³•" class="headerlink" title="5.4.2 å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è§£å†³åŠæ³•"></a>5.4.2 å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è§£å†³åŠæ³•</h3><ul><li>ä¸“é—¨çš„çº¿ç¨‹è´Ÿè´£ç­‰å¾…ï¼šåœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹ï¼Œä¸å»ºè®®è®©å¤šä¸ªçº¿ç¨‹è¿›è¡Œ<code>epoll_wait</code>ï¼Œè€Œç”¨å•ä¸ªçº¿ç¨‹è¿›è¡Œwaitï¼Œå¹¶ç”±è¯¥çº¿ç¨‹è°ƒç”¨<code>accept</code>å»ºç«‹æ–°é“¾æ¥ï¼Œå¹¶å°†å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦äº¤ä»˜ç»™å…¶ä»–çº¿ç¨‹ï¼Œæ¥å¤„ç†åç»­çš„è¯»å†™æ“ä½œã€‚</li><li>ä½¿ç”¨çº¿ç¨‹æ± ï¼šä¸ä¸ºæ¯ä¸ªé“¾æ¥éƒ½åˆ›ç«‹ä¸€ä¸ªä¸“é—¨çš„çº¿ç¨‹ï¼Œè€Œæ˜¯æ ¹æ®è¯»å†™äº‹ä»¶ï¼Œå°†å…¶äº¤ä»˜ç»™çº¿ç¨‹æ± ä¸­å·²æœ‰çº¿ç¨‹æ¥å¤„ç†ï¼›</li><li>ä½¿ç”¨ETæ¨¡å¼ï¼šè¯¥æ¨¡å¼ä¸‹è¯»å†™å°±ç»ªçš„æ—¶å€™åªä¼šé€šçŸ¥ä¸€æ¬¡ï¼Œå†åŠ ä¸Šepollæœ¬èº«æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥åªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‹¿åˆ°è¿™ä¸ªå°±ç»ªäº‹ä»¶ï¼Œä»è€Œé¿å…æƒŠç¾¤ç°è±¡ï¼›</li><li>äº’æ–¥é”ï¼šåŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œç­‰å¾…å’Œäº‹ä»¶å¤„ç†ï¼›</li></ul><h3 id="5-4-3-å¤šè¿›ç¨‹ä¸‹è§£å†³åŠæ³•"><a href="#5-4-3-å¤šè¿›ç¨‹ä¸‹è§£å†³åŠæ³•" class="headerlink" title="5.4.3 å¤šè¿›ç¨‹ä¸‹è§£å†³åŠæ³•"></a>5.4.3 å¤šè¿›ç¨‹ä¸‹è§£å†³åŠæ³•</h3><p>ç›®å‰å¾ˆå¤šå¼€æºè½¯ä»¶ï¼Œå¦‚lighttpdå’Œnginxç­‰éƒ½é‡‡ç”¨<code>master/workers</code>çš„æ¨¡å¼æé«˜è½¯ä»¶çš„ååèƒ½åŠ›åŠå¹¶å‘èƒ½åŠ›ï¼Œåœ¨nginxä¸­ç”šè‡³è¿˜é‡‡ç”¨äº†<strong>è´Ÿè½½å‡è¡¡</strong>çš„æŠ€æœ¯ï¼Œåœ¨æŸä¸ªå­è¿›ç¨‹çš„å¤„ç†èƒ½åŠ›è¾¾åˆ°ä¸€å®šè´Ÿè½½ä¹‹åï¼Œç”±å…¶ä»–<strong>è´Ÿè½½è¾ƒè½»çš„å­è¿›ç¨‹</strong>è´Ÿè´£Â·çš„è°ƒç”¨ï¼Œé‚£ä¹ˆnginxå’ŒLighttpdæ˜¯å¦‚ä½•é¿å…<code>epoll_wait</code>çš„æƒŠç¾¤æ•ˆç”¨çš„å‘¢ï¼Ÿ</p><ul><li>lighttpdçš„è§£å†³æ€è·¯æ˜¯<strong>æ— è§†</strong>æƒŠç¾¤æ•ˆåº”</li></ul><p>ä»ç„¶é‡‡ç”¨<code>master/workers</code>æ¨¡å¼ï¼Œæ¯ä¸ªå­è¿›ç¨‹ä»ç„¶è‡ªå·±åœ¨ç›‘å¬çš„socketä¸Šè°ƒç”¨<code>epoll_wait</code>ï¼Œå½“æœ‰æ–°çš„é“¾æ¥è¯·æ±‚å‘ç”Ÿæ—¶ï¼Œæ“ä½œç³»ç»Ÿä»ç„¶åªæ˜¯å”¤é†’å…¶ä¸­éƒ¨åˆ†çš„å­è¿›ç¨‹æ¥å¤„ç†è¯¥äº‹ä»¶ï¼Œä»ç„¶åªæœ‰ä¸€ä¸ªå­è¿›ç¨‹èƒ½å¤ŸæˆåŠŸå¤„ç†æ­¤äº‹ä»¶ï¼Œé‚£ä¹ˆå…¶ä»–è¢«æƒŠé†’çš„å­è¿›ç¨‹æ•è·<code>EAGAIN</code>é”™è¯¯ï¼Œå¹¶æ— è§†ã€‚</p><ul><li>nginxçš„è§£å†³æ€è·¯æ˜¯äº’æ–¥é”</li></ul><p>åœ¨åŒä¸€æ—¶åˆ»ï¼Œ<strong>æ°¸è¿œéƒ½åªæœ‰ä¸€ä¸ª</strong>å­è¿›ç¨‹åœ¨ç›‘å¬çš„socketä¸Š<code>epoll_wait</code>ï¼Œå…¶åšæ³•æ˜¯ï¼Œåˆ›å»ºä¸€ä¸ªå…¨å±€çš„<code>pthread_mutex_t</code>ï¼Œåœ¨å­è¿›ç¨‹è¿›è¡Œ<code>epoll_wait</code>å‰ï¼Œåˆ™å…ˆè·å–é”ã€‚å½“<code>epoll_wait</code>è¿”å›ä¹‹åï¼Œnginxä¼šè°ƒç”¨acceptæŠŠè¿æ¥å–å‡ºæ¥ï¼Œç„¶åé‡Šæ”¾æ–‡ä»¶é”ï¼Œè®©åˆ«çš„è¿›ç¨‹å»ç›‘å¬ã€‚</p><p>è¿™æ˜¯ä¸€ç§æŠ˜è¡·çš„åŠæ³•ï¼Œå¹¶æ²¡æœ‰å¾ˆå®Œç¾ï¼Œé¦–å…ˆè¿›ç¨‹é—´<strong>äº‰æŠ¢é”</strong>ä¼šæœ‰æ€§èƒ½å¼€è€—ï¼ˆå³ä½¿æ˜¯éé˜»å¡çš„é”ï¼‰ï¼Œä¸­é—´å¯èƒ½ä¼šæœ‰å°æ®µæ—¶é—´æ²¡æœ‰è¿›ç¨‹å»è·å–é”ï¼Œæ¯”å¦‚Aè¿›ç¨‹æ‹¿åˆ°é”ï¼Œå…¶ä»–è¿›ç¨‹å°†ä¼šè¿‡ä¸€å°æ®µæ—¶é—´å°è¯•å†å»è·å–é”ï¼Œè€Œè¿™å°æ®µæ—¶é—´é‡Œé¢å¦‚æœè¯·æ±‚é‡å¾ˆå¤§ï¼ŒAä»…æ¥å—ä¸€å°éƒ¨åˆ†è¯·æ±‚å°±è®©å‡ºé”ï¼Œåˆ™ä¸­é—´è¿‡ç¨‹ä¼šæœ‰ä¸€äº›è¿æ¥äº‹ä»¶è¢«hangä½ï¼›</p><h3 id="5-4-4-å†…æ ¸è§£å†³äº†æƒŠç¾¤æ•ˆåº”äº†å—"><a href="#5-4-4-å†…æ ¸è§£å†³äº†æƒŠç¾¤æ•ˆåº”äº†å—" class="headerlink" title="5.4.4 å†…æ ¸è§£å†³äº†æƒŠç¾¤æ•ˆåº”äº†å—"></a>5.4.4 å†…æ ¸è§£å†³äº†æƒŠç¾¤æ•ˆåº”äº†å—</h3><p>æƒŠç¾¤çš„æ ¹æœ¬åŸå› åœ¨äºepollçš„é»˜è®¤è¡Œä¸ºæ˜¯å¯¹äº<strong>å¤šè¿›ç¨‹ç›‘å¬åŒä¸€æ–‡ä»¶ä¸ä¼šè®¾ç½®äº’æ–¥</strong>ï¼Œè¿›è€Œå°†æ‰€æœ‰è¿›ç¨‹å”¤é†’ï¼Œåç»­çš„å†…æ ¸ç‰ˆæœ¬ä¸»è¦æä¾›äº†ä¸¤ç§è§£å†³æ–¹æ¡ˆ</p><ol><li>æ—¢ç„¶é»˜è®¤ä¸ä¼šè®¾ç½®äº’æ–¥ï¼Œé‚£å°±åŠ ä¸€ä¸ªäº’æ–¥åŠŸèƒ½å¥½äº†ï¼Œ<code>linux 4.5</code>å†…æ ¸ä¹‹åç»™epollæ·»åŠ äº†ä¸€ä¸ª<code>EPOLLEXCLUSIVE</code>çš„æ ‡å¿—ä½ï¼Œå¦‚æœè®¾ç½®äº†è¿™ä¸ªæ ‡å¿—ä½ï¼Œé‚£epollå°†è¿›ç¨‹æŒ‚åˆ°ç­‰å¾…é˜Ÿåˆ—æ—¶å°†ä¼šè®¾ç½®ä¸€ä¸‹äº’æ–¥æ ‡å¿—ä½ï¼Œè¿™æ—¶å®ç°è·Ÿå†…æ ¸åŸç”Ÿacceptä¸€æ ·çš„ç‰¹æ€§ï¼Œåªä¼šå”¤é†’é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªè¿›ç¨‹</li><li>ç¬¬äºŒç§æ–¹æ³•ï¼š<code>linux 3.9</code>å†…æ ¸ä¹‹åç»™socketæä¾›<code>SO_REUSEPORT</code>æ ‡å¿—ï¼Œè¿™ç§æ–¹å¼è§£å†³å¾—æ›´å½»åº•ï¼Œä»–å…è®¸ä¸åŒè¿›ç¨‹çš„socketç»‘å®šåˆ°åŒä¸€ä¸ªç«¯å£ï¼Œå–ä»£ä»¥å¾€éœ€è¦å­è¿›ç¨‹å…±äº«socketç›‘å¬çš„æ–¹å¼ï¼Œè¿™æ—¶å€™ï¼Œæ¯ä¸ªè¿›ç¨‹çš„ç›‘å¬socketå°†æŒ‡å‘<code>open_file_tables</code>ä¸‹çš„ä¸åŒèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸åŒè¿›ç¨‹æ˜¯åœ¨è‡ªå·±çš„è®¾å¤‡ç­‰å¾…é˜Ÿåˆ—ä¸‹è¢«æŒ‚èµ·çš„ï¼Œä¸å­˜åœ¨å…±äº«fdçš„é—®é¢˜ï¼Œä¹Ÿå°±ä¸å­˜åœ¨è¢«åŒæ—¶å”¤é†’çš„å¯èƒ½ã€‚è€Œå†…æ ¸åˆ™åœ¨é©±åŠ¨ä¸­å°†è®¾ç½®äº†<code>SO_REUSEPORT</code>å¹¶ä¸”ç»‘å®šåŒä¸€ç«¯å£çš„è¿™äº›socketåˆ†åˆ°åŒä¸€ä¸ªgroupä¸­ï¼Œå½“æœ‰tcpè¿æ¥äº‹ä»¶åˆ°è¾¾çš„æ—¶å€™ï¼Œå†…æ ¸å°†ä¼šå¯¹æº<code>IP+æºç«¯å£</code>å–hashç„¶åæŒ‡å®šè¿™ä¸ªgroupä¸­å…¶ä¸­ä¸€ä¸ªè¿›ç¨‹æ¥æ¥å—è¿æ¥ï¼Œç›¸å½“äºåœ¨å†…æ ¸çº§åˆ«ä¸­å®ç°äº†ä¸€ä¸ªè´Ÿè½½å‡è¡¡</li></ol><p>åŸºäºä»¥ä¸Šä¸¤ç§æ–¹æ³•ï¼Œå…¶å®epollç”Ÿæ€åœ¨ç›®å‰æ¥è¯´ä¸å­˜åœ¨æ‰€è°“çš„æƒŠç¾¤æ•ˆåº”äº†ã€‚è€Œæ–°ç‰ˆæœ¬çš„nginxä¹Ÿé‡‡ç”¨äº† <code>SO_REUSEPORT</code>æ¥è§£å†³æ­¤é—®é¢˜ã€‚</p><p>é™¤éä½ æº¢ç”¨epollï¼Œæ¯”å¦‚å¤šè¿›ç¨‹ä¹‹é—´å…±äº«äº†åŒä¸€ä¸ªepfdï¼ˆçˆ¶è¿›ç¨‹åˆ›å»ºepollç”±å¤šä¸ªå­è¿›ç¨‹æ¥è°ƒç”¨ï¼‰ï¼Œé‚£å°±ä¸èƒ½æ€ªepolläº†ï¼Œå› ä¸ºè¿™æ—¶å€™å¤šä¸ªè¿›ç¨‹éƒ½è¢«æŒ‚åˆ°è¿™ä¸ªepollä¸‹ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå·²ç»ä¸æ˜¯ä»…ä»…æ˜¯æƒŠç¾¤æ•ˆåº”çš„é—®é¢˜äº†ï¼›æ¯”å¦‚è¯´ï¼ŒAè¿›ç¨‹åœ¨epollæŒ‚äº†socket1çš„è¿æ¥äº‹ä»¶ï¼ŒBè¿›ç¨‹è°ƒç”¨äº†epoll_waitï¼Œç”±äºå±äºåŒä¸€ä¸ªepfdï¼Œå½“socket1äº§ç”Ÿäº‹ä»¶çš„æ—¶å€™ï¼Œè¿›ç¨‹Bä¹Ÿä¼šè¢«å”¤é†’ï¼Œè€Œæ›´ä¸¥é‡çš„äº‹æƒ…åœ¨äºï¼Œåœ¨Bè¿›ç¨‹çš„ç©ºé—´ä¸‹å¹¶ä¸å­˜åœ¨socket1è¿™ä¸ªfdï¼Œä»è€ŒæŠŠé—®é¢˜æå¾—å¾ˆå¤æ‚ã€‚</p><p>æ€»ç»“ï¼šåƒä¸‡ä¸è¦åœ¨å¤šçº¿ç¨‹&#x2F;å¤šè¿›ç¨‹ä¹‹é—´å…±äº«epfdï¼</p><h1 id="6-Reactoræ¨¡å‹"><a href="#6-Reactoræ¨¡å‹" class="headerlink" title="6.Reactoræ¨¡å‹"></a>6.Reactoræ¨¡å‹</h1><p>æ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬æ¥ç”¨epollç¼–å†™ä¸€ä¸ªåŸºäºReactoræ¨¡å¼çš„æœåŠ¡å™¨å§ï¼</p><h2 id="6-1-ä»€ä¹ˆæ˜¯Reactorï¼Ÿ"><a href="#6-1-ä»€ä¹ˆæ˜¯Reactorï¼Ÿ" class="headerlink" title="6.1 ä»€ä¹ˆæ˜¯Reactorï¼Ÿ"></a>6.1 ä»€ä¹ˆæ˜¯Reactorï¼Ÿ</h2><ul><li>Reactoræ¨¡å‹æ˜¯åŸºäºäº‹ä»¶é©±åŠ¨çš„ï¼Œé€šè¿‡ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¾“å…¥åŒæ—¶ä¼ é€’ç»™æœåŠ¡ç«¯è¿›è¡Œå¤„ç†</li><li>æœåŠ¡ç«¯è¯·æ±‚ç¨‹åºå¤„ç†ä¼ å…¥çš„å¤šä¸ªè¯·æ±‚ï¼Œå¹¶åˆ†å‘åˆ°ç›¸åº”çš„å¤„ç†çº¿ç¨‹</li><li>åŸºäºIOå¤šè·¯è½¬æ¥ï¼ˆå¤šè·¯å¤ç”¨ï¼‰æ¨¡å‹ï¼šå¤šä¸ªé“¾æ¥é€šç”¨ä¸€ä¸ªé˜»å¡å¯¹è±¡ï¼Œå¼•ç”¨ç¨‹åºåªéœ€è¦åœ¨ä¸€ä¸ªé˜»å¡å¯¹è±¡ç­‰å¾…ï¼Œæ— éœ€é˜»å¡ç­‰å¾…æ‰€æœ‰é“¾æ¥ï¼›å½“æœ‰æ–°é“¾æ¥æˆ–è€…äº‹ä»¶å°±ç»ªçš„æ—¶å€™ï¼Œç”±æ“ä½œç³»ç»Ÿé€šçŸ¥åº”ç”¨ç¨‹åºï¼Œå¼€å§‹è¿›è¡Œä¸šåŠ¡å¤„ç†</li><li>åŸºäºçº¿ç¨‹æ± å¤ç”¨çº¿ç¨‹èµ„æºï¼šä¸å¿…ç»™æ¯ä¸ªé“¾æ¥å•ç‹¬åˆ›å»ºçº¿ç¨‹ï¼Œè€Œæ˜¯å°†é“¾æ¥å®Œæˆåçš„ä¸šåŠ¡å¤„ç†äº¤ä»˜ç»™å·²æœ‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨ç”Ÿå‘½å‘¨æœŸä¸­å¯ä»¥å¤„ç†å¤šä¸ªé“¾æ¥çš„ä¸šåŠ¡ã€‚</li></ul><p>reactoræ¨¡å¼æœ‰ä¸‹é¢3ç§æ–¹å¼ï¼Œ<a href="https://blog.csdn.net/wlddhj/article/details/123872275">å‚è€ƒåšå®¢ @é¡½çŸ³ä¹å˜</a></p><h3 id="6-1-1-ä¸»ä»Reactorå¤šçº¿ç¨‹æ¨¡å‹"><a href="#6-1-1-ä¸»ä»Reactorå¤šçº¿ç¨‹æ¨¡å‹" class="headerlink" title="6.1.1 ä¸»ä»Reactorå¤šçº¿ç¨‹æ¨¡å‹"></a>6.1.1 ä¸»ä»Reactorå¤šçº¿ç¨‹æ¨¡å‹</h3><p>ç¬¬ä¸€ç§æ˜¯å¤šçº¿ç¨‹æ¨¡å¼çš„ï¼Œæœ‰ä¸åŒçš„ä»å±reactoræ¥è¿›è¡Œäº‹ä»¶ç›‘æ§å’Œå¤„ç†</p><ul><li>Reactorä¸»çº¿ç¨‹è´Ÿè´£ç›‘å¬äº‹ä»¶å¹¶è¿›è¡Œé“¾æ¥çš„accept</li><li>accpetè·å–åˆ°é“¾æ¥åï¼Œåˆ†é…ç»™æŸä¸€ä¸ªä»Reactorè¿›è¡Œè¯»å†™äº‹ä»¶çš„ç›‘å¬</li><li>ä»Reactorè¿›è¡Œäº‹ä»¶ç›‘å¬ï¼Œå½“æœ‰æ–°äº‹ä»¶å‘ç”Ÿçš„æ—¶å€™ï¼Œåˆ›å»ºHandlerè¿›è¡Œäº‹ä»¶å¤„ç†</li><li>Headleré€šè¿‡readè¯»å–æ•°æ®ï¼Œå¹¶å¤„ç†æ•°æ®ï¼ˆè¿™é‡Œè¿˜å¯ä»¥å°†è¯»å–æ•°æ®åçš„å“åº”æ“ä½œåˆ†å‘ç»™çº¿ç¨‹æ± è¿›è¡Œå¤„ç†ï¼Œçº¿ç¨‹æ± å¤„ç†å®Œæ¯•åè¿”å›ç»™Handlerï¼‰ï¼Œé€šè¿‡sendè¿”å›ç»™å®¢æˆ·ç«¯</li><li>Reactorä¸»çº¿ç¨‹å¯ä»¥å¯¹åº”å¤šä¸ªå­çº¿ç¨‹</li></ul><p><img src="https://img.musnow.top/i/2023/08/9b1f1f0aec63e52ed44fca99f18d6e5a.png" alt="image-20230828085218401"></p><p><img src="https://img.musnow.top/i/2023/08/ecdd89978c73b286f89f29703c620c7e.png" alt="img"></p><h3 id="6-1-2-å•Reactorå¤šçº¿ç¨‹"><a href="#6-1-2-å•Reactorå¤šçº¿ç¨‹" class="headerlink" title="6.1.2 å•Reactorå¤šçº¿ç¨‹"></a>6.1.2 å•Reactorå¤šçº¿ç¨‹</h3><ul><li>Reactoré€šè¿‡å¤šè·¯è½¬æ¥ç›‘å¬å®¢æˆ·ç«¯äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åï¼Œè¿›è¡Œåˆ†å‘</li><li>å¦‚æœæ˜¯å»ºç«‹é“¾æ¥çš„è¯·æ±‚ï¼Œåˆ™æ‰§è¡Œacceptï¼Œå»ºç«‹é“¾æ¥åï¼Œåˆ›å»ºä¸€ä¸ªHandlerå®Œæˆé“¾æ¥å»ºç«‹åçš„å„ä¸ªæ“ä½œ</li><li>å¦‚æœä¸æ˜¯é“¾æ¥è¯·æ±‚ï¼ˆè¯»å†™å°±ç»ªï¼‰åˆ™ç”±Reactoråˆ†å‘è°ƒç”¨é“¾æ¥å¯¹åº”çš„è¯»å†™Handleræ¥è¿›è¡Œå¤„ç†</li><li>Handleråªè´Ÿè´£å“åº”å…·ä½“çš„äº‹ä»¶ï¼Œè€Œä¸è¿›è¡Œå…·ä½“çš„ä¸šåŠ¡å¤„ç†</li><li>é€šè¿‡Handlerä¸­çš„readè¯»å–åˆ°æ•°æ®åï¼Œåˆ†å‘ç»™çº¿ç¨‹æ± å­ä¸­çš„çº¿ç¨‹å¤„ç†ï¼Œå¤„ç†å®Œæ¯•åè¿”å›Handlerï¼Œå†é€šè¿‡å†™æ–¹æ³•å‘é€ç»™å®¢æˆ·ç«¯</li></ul><p><img src="https://img.musnow.top/i/2023/08/18889218bcf8b973dd2140f84ee48c1d.png" alt="img"></p><h3 id="6-1-3-å•Reactorå•çº¿ç¨‹"><a href="#6-1-3-å•Reactorå•çº¿ç¨‹" class="headerlink" title="6.1.3 å•Reactorå•çº¿ç¨‹"></a>6.1.3 å•Reactorå•çº¿ç¨‹</h3><p>ç¬¬ä¸‰ç§æ˜¯å•çº¿ç¨‹æ¨¡å¼ä¸‹çš„ï¼ˆåŠå¼‚æ­¥åŠåŒæ­¥æ¨¡å‹ï¼‰ï¼Œå½“æ”¶åˆ°æŸä¸ªå®¢æˆ·ç«¯çš„å°±ç»ªäº‹ä»¶ï¼Œå°±å»å¤„ç†è¿™ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚æ­¤æ—¶Handlerä¼šå®Œæˆreadåˆ°ä¸šåŠ¡å¤„ç†åˆ°sendçš„å…¨æµç¨‹ï¼›</p><p>æœ¬æ¬¡ä¸»è¦å†™çš„æ˜¯è¯¥æ¨¡å¼ä¸‹çš„æ“ä½œï¼Œå› ä¸ºå®ƒåŸºæœ¬æ˜¯<strong>ä¸²è¡Œ</strong>è¿è¡Œçš„ï¼Œæ€è·¯æ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§æ¨¡å¼æ”¯æŒçš„å®¢æˆ·ç«¯é‡ä¸åº”è¿‡å¤šï¼Œå¦åˆ™ä¼šæå¤§å½±å“æ€§èƒ½ã€‚</p><p><img src="https://img.musnow.top/i/2023/08/bd8688effc6efb18264e9785cc78b54e.png" alt="image-20230828085239238"></p><p><img src="https://img.musnow.top/i/2023/08/b057900a9b937973503f493cfa576711.png" alt="img"></p><h3 id="6-1-4-æ€»ç»“"><a href="#6-1-4-æ€»ç»“" class="headerlink" title="6.1.4 æ€»ç»“"></a>6.1.4 æ€»ç»“</h3><p><strong>ä¸‰ç§æ¨¡å¼ç”¨ç”Ÿæ´»æ¡ˆä¾‹æ¥ç†è§£</strong></p><ol><li><p>å•Reactorå•çº¿ç¨‹ï¼Œå‰å°æ¥å¾…å‘˜å’ŒæœåŠ¡å‘˜æ˜¯åŒä¸€ä¸ªäººï¼Œå…¨ç¨‹ä¸ºé¡¾å®¢æœåŠ¡</p></li><li><p>å•Reactorå¤šçº¿ç¨‹ï¼Œ1ä¸ªå‰å°æ¥å¾…å‘˜ï¼Œå¤šä¸ªæœåŠ¡å‘˜ï¼Œæ¥å¾…å‘˜åªè´Ÿè´£æ¥å¾…</p></li><li><p>ä¸»ä»Reactorå¤šçº¿ç¨‹ï¼Œå¤šä¸ªå‰å°æ¥å¾…å‘˜ï¼Œå¤šä¸ªæœåŠ¡å‘˜</p></li></ol><p><strong>Reactoræ¨¡å‹å…·æœ‰å¦‚ä¸‹ä¼˜ç‚¹</strong></p><ol><li><p>å“åº”å¿«ï¼Œä¸å¿…ä¸ºå•ä¸ªåŒæ­¥äº‹ä»¶æ‰€é˜»å¡ï¼Œè™½ç„¶Reactoræœ¬èº«ä¾ç„¶æ˜¯åŒæ­¥çš„</p></li><li><p>å¯ä»¥æœ€å¤§ç¨‹åº¦çš„é¿å…å¤æ‚çš„å¤šçº¿ç¨‹åŠåŒæ­¥é—®é¢˜ï¼Œå¹¶ä¸”é¿å…äº†å¤šçº¿ç¨‹&#x2F;è¿›ç¨‹çš„åˆ‡æ¢å¼€é”€</p></li><li><p>æ‰©å±•æ€§å¥½ï¼Œå¯ä»¥æ–¹ä¾¿çš„é€šè¿‡å¢åŠ Reactorå®ä¾‹ä¸ªæ•°æ¥å……åˆ†åˆ©ç”¨CPUèµ„æº</p></li><li><p>å¤ç”¨æ€§å¥½ï¼ŒReactoræ¨¡å‹æœ¬èº«ä¸å…·ä½“äº‹ä»¶å¤„ç†é€»è¾‘æ— å…³ï¼Œå…·æœ‰å¾ˆé«˜çš„å¤ç”¨æ€§</p></li></ol><h2 id="6-2-ä»£ç åˆ†æ"><a href="#6-2-ä»£ç åˆ†æ" class="headerlink" title="6.2 ä»£ç åˆ†æ"></a>6.2 ä»£ç åˆ†æ</h2><p>è¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šä»£ç å§ï¼æœ¬æ¬¡å°†æ‰€æœ‰å¤„ç†æ¨¡å—éƒ½ç»™æ‹†åˆ†å¼€æ¥ï¼Œä¸€ä¸€è¿›è¡Œè¯´æ˜</p><h3 id="6-2-1-Epoller-hpp"><a href="#6-2-1-Epoller-hpp" class="headerlink" title="6.2.1 Epoller.hpp"></a>6.2.1 Epoller.hpp</h3><p>é¦–å…ˆæ˜¯å°†å¯¹epollçš„ä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨å‡½æ•°è¿›è¡Œä¸€å®šçš„å°è£…ï¼Œç»Ÿä¸€è¿›è¡Œé”™è¯¯çš„åˆ¤æ–­å¤„ç†ã€‚æ–¹ä¾¿äº†å…¶ä»–æ¨¡å—çš„è°ƒç”¨ç”¨ï¼›</p><p>è¿™éƒ¨åˆ†çš„ä»£ç éå¸¸ç®€å•ï¼Œå°±åªåœ¨æ³¨é‡Šé‡Œå†™ä¸€ä¸‹è§£æå§ï¼</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cerrno&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/epoll.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Log.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Epoller</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> gsize = <span class="number">128</span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">CreateEpoller</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> epfd = <span class="built_in">epoll_create</span>(gsize); <span class="comment">// åˆ›å»ºå¯¹åº”sizeçš„epfd</span></span><br><span class="line">        <span class="keyword">if</span> (epfd &lt; <span class="number">0</span>) <span class="comment">// é”™è¯¯åˆ¤æ–­</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">logMessage</span>(FATAL, <span class="string">&quot;epoll_create : %d : %s&quot;</span>, errno, <span class="built_in">strerror</span>(errno));</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> epfd; <span class="comment">// æ­£ç¡®è¿”å›epfd</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">bool</span> <span class="title">AddEvent</span><span class="params">(<span class="type">int</span> epfd, <span class="type">int</span> sock, <span class="type">uint32_t</span> event)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">epoll_event</span> ev;</span><br><span class="line">        ev.events = event; <span class="comment">// è®¾ç½®event</span></span><br><span class="line">        ev.data.fd = sock;</span><br><span class="line">        <span class="comment">// ç»™å¯¹åº”çš„socketæ·»åŠ åˆ°epollä¸­</span></span><br><span class="line">        <span class="type">int</span> n = <span class="built_in">epoll_ctl</span>(epfd, EPOLL_CTL_ADD, sock, &amp;ev);</span><br><span class="line">        <span class="keyword">return</span> n == <span class="number">0</span>; <span class="comment">// è¿”å›å€¼æ˜¯æ˜¯å¦è°ƒç”¨æˆåŠŸ</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">bool</span> <span class="title">ModEvent</span><span class="params">(<span class="type">int</span> epfd, <span class="type">int</span> sock, <span class="type">uint32_t</span> event)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">epoll_event</span> ev;</span><br><span class="line">        ev.events = event;</span><br><span class="line">        ev.data.fd = sock;</span><br><span class="line">        <span class="comment">// ä¿®æ”¹å·²æœ‰scoketçš„event</span></span><br><span class="line">        <span class="comment">// è¯¥socketå¿…é¡»å…ˆç”¨ADDæ·»åŠ ï¼Œå¦åˆ™æ— æ³•ä¿®æ”¹ï¼Œä¼šè¿”å›ENOENTé”™è¯¯</span></span><br><span class="line">        <span class="type">int</span> n = <span class="built_in">epoll_ctl</span>(epfd, EPOLL_CTL_MOD, sock, &amp;ev);</span><br><span class="line">        <span class="keyword">return</span> n == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">bool</span> <span class="title">DelEvent</span><span class="params">(<span class="type">int</span> epfd, <span class="type">int</span> sock)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ é™¤æŒ‡å®šsocket</span></span><br><span class="line">        <span class="type">int</span> n = <span class="built_in">epoll_ctl</span>(epfd, EPOLL_CTL_DEL, sock, <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="keyword">return</span> n == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">LoopOnce</span><span class="params">(<span class="type">int</span> epfd, <span class="keyword">struct</span> epoll_event revs[], <span class="type">int</span> num)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// å•æ¬¡waitçš„è°ƒç”¨ï¼Œä»æ•°ç»„é‡Œé¢å–å›å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">        <span class="type">int</span> n = <span class="built_in">epoll_wait</span>(epfd, revs, num, <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">-1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">logMessage</span>(FATAL, <span class="string">&quot;epoll_wait : %d : %s&quot;</span>, errno, <span class="built_in">strerror</span>(errno));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="6-2-2-Sock-hpp"><a href="#6-2-2-Sock-hpp" class="headerlink" title="6.2.2 Sock.hpp"></a>6.2.2 Sock.hpp</h3><p>åŒselectï¼Œè§ä¸Šæ–‡ <a href="#jump-select">3.2.1 socket</a> éƒ¨åˆ†ï¼›</p><h3 id="6-2-3-Log-hpp"><a href="#6-2-3-Log-hpp" class="headerlink" title="6.2.3 Log.hpp"></a>6.2.3 Log.hpp</h3><p>ä¸€ä¸ªå·¨ç®€å•çš„æ—¥å¿—ç±»</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdarg&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cerrno&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEBUG 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NOTICE 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WARNING 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FATAL 3</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *log_level[] = &#123;<span class="string">&quot;DEBUG&quot;</span>, <span class="string">&quot;NOTICE&quot;</span>, <span class="string">&quot;WARINING&quot;</span>, <span class="string">&quot;FATAL&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOGFILE <span class="string">&quot;serverTcp.log&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Log</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Log</span>():<span class="built_in">logFd</span>(<span class="number">-1</span>)</span><br><span class="line">    &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">enable</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">umask</span>(<span class="number">0</span>);</span><br><span class="line">        logFd = <span class="built_in">open</span>(LOGFILE, O_WRONLY | O_CREAT | O_APPEND, <span class="number">0666</span>);</span><br><span class="line">        <span class="built_in">assert</span>(logFd != <span class="number">-1</span>);</span><br><span class="line">        <span class="built_in">dup2</span>(logFd, <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">dup2</span>(logFd, <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">Log</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(logFd != <span class="number">-1</span>) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">fsync</span>(logFd);</span><br><span class="line">            <span class="built_in">close</span>(logFd);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> logFd;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// logMessage(DEBUG, &quot;%d&quot;, 10);</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">logMessage</span><span class="params">(<span class="type">int</span> level, <span class="type">const</span> <span class="type">char</span> *format, ...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">assert</span>(level &gt;= DEBUG);</span><br><span class="line">    <span class="built_in">assert</span>(level &lt;= FATAL);</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> *name = <span class="built_in">getenv</span>(<span class="string">&quot;USER&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> logInfo[<span class="number">1024</span>];</span><br><span class="line">    va_list ap;</span><br><span class="line">    <span class="built_in">va_start</span>(ap, format);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vsnprintf</span>(logInfo, <span class="built_in">sizeof</span>(logInfo) - <span class="number">1</span>, format, ap);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">va_end</span>(ap); <span class="comment">// ap = NULL</span></span><br><span class="line"></span><br><span class="line">    FILE *out = (level == FATAL) ? stderr : stdout;</span><br><span class="line">    <span class="built_in">fprintf</span>(out, <span class="string">&quot;%s | %u | %s | %s\n&quot;</span>,</span><br><span class="line">            log_level[level],</span><br><span class="line">            (<span class="type">unsigned</span> <span class="type">int</span>)<span class="built_in">time</span>(<span class="literal">nullptr</span>),</span><br><span class="line">            name == <span class="literal">nullptr</span> ? <span class="string">&quot;unknow&quot;</span> : name,</span><br><span class="line">            logInfo);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">fflush</span>(out); <span class="comment">// å°†Cè¯­è¨€ç¼“å†²åŒºä¸­çš„æ•°æ®åˆ·æ–°åˆ°OS</span></span><br><span class="line">    <span class="built_in">fsync</span>(<span class="built_in">fileno</span>(out));   <span class="comment">// å°†OSä¸­çš„æ•°æ®å°½å¿«å†™å…¥ç¡¬ç›˜</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-2-4-TcpServer"><a href="#6-2-4-TcpServer" class="headerlink" title="6.2.4 TcpServer"></a>6.2.4 TcpServer</h3><p>è¿™æ˜¯æˆ‘ä»¬reactoræ¨¡å‹çš„é‡ç‚¹</p><h4 id="1-Connectionç±»"><a href="#1-Connectionç±»" class="headerlink" title="1.Connectionç±»"></a>1.Connectionç±»</h4><p>è¿™é‡Œå…ˆå®šä¹‰äº†ä¸€ä¸ªConnectioné“¾æ¥ç±»ï¼Œæ¯”è¾ƒé‡è¦çš„æ˜¯ç±»é‡Œé¢æœ‰3ä¸ªå›è°ƒæ–¹æ³•çš„æŒ‡é’ˆã€‚åœ¨Reactorä¸­ï¼Œæˆ‘ä»¬ç”¨å›è°ƒæ–¹æ³•æ¥æ›¿ä»£äº†ä¸»æ‰§è¡Œæµç›´æ¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼ã€‚çº¿ç¨‹åªéœ€è¦æ¥æ”¶åˆ°è¿™ä¸ª<code>Connection</code>å¯¹è±¡ï¼Œå°±å¯ä»¥ç”¨å›è°ƒæ–¹æ³•æ¥å®ç°å¯¹é“¾æ¥çš„æ•°æ®å¤„ç†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">using <span class="type">func_t</span> = <span class="built_in">std</span>::function&lt;<span class="type">int</span>(Connection *)&gt;;</span><br><span class="line">using <span class="type">callback_t</span> = <span class="built_in">std</span>::function&lt;<span class="type">int</span>(Connection *, <span class="built_in">std</span>::<span class="built_in">string</span> &amp;)&gt;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Connection</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">public:</span><br><span class="line">    <span class="comment">// æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">    <span class="type">int</span> sock_;</span><br><span class="line">    TcpServer *R_;<span class="comment">// ä¸»æœåŠ¡å™¨çš„ç±»æŒ‡é’ˆ</span></span><br><span class="line">    <span class="comment">// è‡ªå·±çš„æ¥å—å’Œå‘é€ç¼“å†²åŒº</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> inbuffer_;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> outbuffer_;</span><br><span class="line">    <span class="comment">// è¯»ã€å†™ã€å¼‚å¸¸çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">    <span class="type">func_t</span> recver_; </span><br><span class="line">    <span class="type">func_t</span> sender_;</span><br><span class="line">    <span class="type">func_t</span> excepter_;</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">    Connection(<span class="type">int</span> sock, TcpServer *r) : sock_(sock), R_(r)</span><br><span class="line">    &#123;&#125;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">SetRecver</span><span class="params">(<span class="type">func_t</span> recver)</span> &#123; recver_ = recver; &#125;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">SetSender</span><span class="params">(<span class="type">func_t</span> sender)</span> &#123; sender_ = sender; &#125;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">SetExcepter</span><span class="params">(<span class="type">func_t</span> excepter)</span> &#123; excepter_ = excepter; &#125;</span><br><span class="line">    ~Connection() &#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="2-TcpServeræˆå‘˜å˜é‡"><a href="#2-TcpServeræˆå‘˜å˜é‡" class="headerlink" title="2.TcpServeræˆå‘˜å˜é‡"></a>2.TcpServeræˆå‘˜å˜é‡</h4><p>å†æ¥çœ‹çœ‹tcpserverçš„æˆå‘˜å˜é‡æœ‰ä»€ä¹ˆ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">private:</span><br><span class="line"><span class="comment">// æ¥æ”¶é˜Ÿåˆ—çš„é•¿åº¦</span></span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> revs_num = <span class="number">64</span>;</span><br><span class="line">    <span class="comment">// 1. ç½‘ç»œsocket</span></span><br><span class="line">    <span class="type">int</span> listensock_;</span><br><span class="line">    <span class="comment">// 2. epollçš„fd</span></span><br><span class="line">    <span class="type">int</span> epfd_;</span><br><span class="line">    <span class="comment">// 3. å°†epollå’Œä¸Šå±‚ä»£ç è¿›è¡Œç»“åˆï¼Œå·²æœ‰é“¾æ¥</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">unordered_map</span>&lt;<span class="type">int</span>, Connection *&gt; connections_;</span><br><span class="line">    <span class="comment">// 4. å°±ç»ªäº‹ä»¶åˆ—è¡¨</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">epoll_event</span> *<span class="title">revs_</span>;</span></span><br><span class="line">    <span class="comment">// 5. è®¾ç½®å®Œæ•´æŠ¥æ–‡çš„å¤„ç†å›è°ƒæ–¹æ³•</span></span><br><span class="line">    <span class="type">callback_t</span> cb_;</span><br></pre></td></tr></table></figure><h4 id="3-æ„é€ "><a href="#3-æ„é€ " class="headerlink" title="3.æ„é€ "></a>3.æ„é€ </h4><p>éšåä¾¿æ˜¯åœ¨æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–è¿™äº›æˆå‘˜å˜é‡ï¼Œå…ˆæ˜¯ä»<code>Sock.hpp</code>ä¸­è·å–åˆ°ç›‘å¬æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åå†é€šè¿‡Epollerç±»è·å–åˆ°epfdå¥æŸ„ï¼Œæœ€åæ˜¯å°†listensocketæ”¾å…¥epollçš„ç›‘å¬ä¸­ï¼›</p><p>è¿™é‡Œçš„<code>std::bind</code>çš„ä½œç”¨ï¼Œæ˜¯å°†å½“å‰TcpServerçš„<code>this</code>æŒ‡é’ˆç»‘å®šåˆ°<code>TcpServer::Accepter</code>å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸Šï¼Œå¦åˆ™åœ¨ç±»å¤–æ²¡æœ‰åŠæ³•é€šè¿‡<code>Connection</code>ç±»çš„å›è°ƒæŒ‡é’ˆæ¥è°ƒç”¨è¿™ä¸ªç±»çš„æˆå‘˜å‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">TcpServer(<span class="type">callback_t</span> cb, <span class="type">int</span> port = <span class="number">8080</span>) : cb_(cb)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// å½“å‰ç›‘å¬çš„æ–‡ä»¶æè¿°ç¬¦åŠå…¶äº‹ä»¶</span></span><br><span class="line">    revs_ = new <span class="keyword">struct</span> epoll_event[revs_num]; </span><br><span class="line">    <span class="comment">// ç½‘ç»œåŠŸèƒ½</span></span><br><span class="line">    listensock_ = Sock::SocketInit();</span><br><span class="line">    Util::SetNonBlock(listensock_);</span><br><span class="line">    Sock::Bind(listensock_, port);</span><br><span class="line">    Sock::Listen(listensock_);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤šè·¯è½¬æ¥</span></span><br><span class="line">    epfd_ = Epoller::CreateEpoller();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ·»åŠ listensockåŒ¹é…çš„connection</span></span><br><span class="line">    AddConnection(listensock_, EPOLLIN | EPOLLET,</span><br><span class="line">                  <span class="built_in">std</span>::bind(&amp;TcpServer::Accepter, this, <span class="built_in">std</span>::placeholders::_1), nullptr, nullptr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-æ·»åŠ é“¾æ¥"><a href="#4-æ·»åŠ é“¾æ¥" class="headerlink" title="4.æ·»åŠ é“¾æ¥"></a>4.æ·»åŠ é“¾æ¥</h4><p>åœ¨<code>AddConnection</code>å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä¼šå°†socketç»™æ·»åŠ åˆ°epfdä¸­ï¼›å¦‚æœè¿™ä¸ªepfdæ˜¯ä½¿ç”¨äº†<code>EPOLLET</code>çš„ETæ¨¡å¼ï¼Œåˆ™è¿˜éœ€è¦è®¾ç½®éé˜»å¡ï¼›</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">AddConnection</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">uint32_t</span> event, <span class="type">func_t</span> recver, <span class="type">func_t</span> sender, <span class="type">func_t</span> excepter)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (event &amp; EPOLLET)</span><br><span class="line">        Util::<span class="built_in">SetNonBlock</span>(sockfd);</span><br><span class="line">    <span class="comment">// æ·»åŠ sockfdåˆ°epoll</span></span><br><span class="line">    Epoller::<span class="built_in">AddEvent</span>(epfd_, sockfd, event);</span><br><span class="line">    <span class="comment">// å°†sockfdåŒ¹é…çš„Connectionä¹Ÿæ·»åŠ åˆ°å½“å‰çš„unordered_mapä¸­</span></span><br><span class="line">    Connection *conn = <span class="keyword">new</span> <span class="built_in">Connection</span>(sockfd, <span class="keyword">this</span>);</span><br><span class="line">    conn-&gt;<span class="built_in">SetRecver</span>(recver);</span><br><span class="line">    conn-&gt;<span class="built_in">SetSender</span>(sender);</span><br><span class="line">    conn-&gt;<span class="built_in">SetExcepter</span>(excepter);</span><br><span class="line"></span><br><span class="line">    connections_.<span class="built_in">insert</span>(std::<span class="built_in">make_pair</span>(sockfd, conn));</span><br><span class="line">    <span class="built_in">logMessage</span>(DEBUG, <span class="string">&quot;æ·»åŠ æ–°é“¾æ¥åˆ°connectionsæˆåŠŸ: %d&quot;</span>, sockfd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¾ç½®éé˜»å¡çš„ä»£ç å¾ˆç®€å•ï¼Œåœ¨å‰æ–‡å·²ç»æ¼”ç¤ºè¿‡äº†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Util</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">public:</span><br><span class="line">    <span class="type">static</span> <span class="type">void</span> <span class="title function_">SetNonBlock</span><span class="params">(<span class="type">int</span> fd)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> fl = fcntl(fd, F_GETFL);</span><br><span class="line">        fcntl(fd, F_SETFL, fl | O_NONBLOCK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="5-ææ„"><a href="#5-ææ„" class="headerlink" title="5.ææ„"></a>5.ææ„</h4><p>åœ¨ææ„å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†listensocketå’Œepfdä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦å…³é—­ï¼Œå¹¶ææ„æ‰é“¾æ¥æ•°ç»„</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">~<span class="built_in">TcpServer</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (listensock_ != <span class="number">-1</span>)</span><br><span class="line">        <span class="built_in">close</span>(listensock_);</span><br><span class="line">    <span class="keyword">if</span> (epfd_ != <span class="number">-1</span>)</span><br><span class="line">        <span class="built_in">close</span>(epfd_);</span><br><span class="line">    <span class="keyword">delete</span>[] revs_;</span><br><span class="line">    <span class="comment">// è¿˜éœ€è¦ææ„æ‰è¿æ¥æ± ä¸­å°šå­˜åœ¨çš„connectionå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span>&amp;c:connections_)&#123;</span><br><span class="line">        <span class="keyword">delete</span> c.second;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6-è·å–æ–°è¿æ¥Accept"><a href="#6-è·å–æ–°è¿æ¥Accept" class="headerlink" title="6.è·å–æ–°è¿æ¥Accept"></a>6.è·å–æ–°è¿æ¥Accept</h4><p>åœ¨è·å–æ–°è¿æ¥è¿™é‡Œï¼Œæˆ‘ä»¬é‡‡ç”¨äº†ä¸€ä¸ªæ­»å¾ªç¯æ¥è·å–ã€‚è¿™æ˜¯å› ä¸ºå¯¹äºlistensocketæ–‡ä»¶æè¿°ç¬¦è€Œè¨€ï¼Œåªè¦æ¥äº†ä¸€ä¸ªæ–°é“¾æ¥ï¼Œåœ¨ETæ¨¡å¼ä¸‹å°±ä¼šæç¤ºæˆ‘ä»¬ã€‚ä½†æœ‰å¯èƒ½ä¼šå‡ºç°æˆ‘ä»¬è¿˜æ²¡æœ‰æ¥å¾—åŠå–èµ°è¿™ä¸ªé“¾æ¥ï¼Œå°±åˆæ¥äº†ä¸€ä¸ªæ–°é“¾æ¥çš„æƒ…å†µï¼ˆå¯ä»¥ç®€åŒ–ç†è§£ä¸ºä¸€æ¬¡æ€§æ¥äº†ä¸¤ä¸ªé“¾æ¥ï¼‰</p><p>è¿™æ—¶å€™å› ä¸ºETçš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸€æ¬¡æ€§å–èµ°æ‰€æœ‰é“¾æ¥ï¼›ä¸ºäº†é¿å…åœ¨Acceptçš„æ—¶å€™ï¼Œå› ä¸ºé“¾æ¥å·²ç»éƒ½è¢«å–èµ°äº†è€Œé˜»å¡ä½ï¼Œæˆ‘ä»¬éœ€è¦å°†listensocketè®¾ç½®ä¸º<strong>éé˜»å¡</strong>ï¼›</p><blockquote><p>å…³äºæ–°é“¾æ¥ä¸ºä»€ä¹ˆåªå…³æ³¨è¯»äº‹ä»¶ï¼Œåœ¨æ³¨é‡Šä¸­æœ‰è¯´æ˜ï¼›</p></blockquote><p>å¯¹äºlistensocketæ¥è¯´ï¼Œè¿™ä¸ªAccepterå‡½æ•°å°±æ˜¯å®ƒçš„è¯»äº‹ä»¶å›è°ƒï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°çš„å‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ª<code>Connection *conn</code>å¯¹è±¡ï¼Œå…¶æ˜¯ä¸ºäº†ä¸å…¶ä»–äº‹ä»¶å¤„ç†å‡½æ•°ç»Ÿä¸€ï¼ˆå› ä¸ºè¿™ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ä¸åœ¨<code>Connection</code>ç±»ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»è¦è·å–ä¸€ä¸ªå¯¹è±¡æ‰èƒ½è®¿é—®åˆ°å®ƒçš„æˆå‘˜å˜é‡ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">Accepter</span><span class="params">(Connection *conn)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        std::string clientip;</span><br><span class="line">        <span class="type">uint16_t</span> clientport = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> sockfd = Sock::<span class="built_in">Accept</span>(conn-&gt;sock_, &amp;clientip, &amp;clientport);</span><br><span class="line">        <span class="keyword">if</span> (sockfd &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// æ¥æ”¶å‡½æ•°è¢«äº‹ä»¶æ‰“æ–­äº†</span></span><br><span class="line">            <span class="keyword">if</span> (errno == EINTR)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="comment">// æœ¬æ¬¡æ•°æ®æ²¡æœ‰å‡†å¤‡å¥½ï¼Œå¯ä»¥ç†è§£ä¸ºæ¥æ”¶ç¼“å†²åŒºç©ºäº†</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (errno == EAGAIN || errno == EWOULDBLOCK)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">logMessage</span>(WARNING, <span class="string">&quot;accept error&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">logMessage</span>(DEBUG, <span class="string">&quot;get a new link: %d&quot;</span>, sockfd);</span><br><span class="line">        <span class="comment">// æ³¨æ„ï¼šé»˜è®¤æˆ‘ä»¬åªè®¾ç½®äº†è®©epollå¸®æˆ‘ä»¬å…³å¿ƒè¯»äº‹ä»¶ï¼Œæ²¡æœ‰å…³å¿ƒå†™äº‹ä»¶</span></span><br><span class="line">        <span class="comment">// ä¸ºä»€ä¹ˆæ²¡æœ‰å…³æ³¨å†™äº‹ä»¶ï¼šå› ä¸ºæœ€å¼€å§‹çš„æ—¶å€™ï¼Œå†™ç©ºé—´ä¸€å®šæ˜¯å°±ç»ªçš„ï¼</span></span><br><span class="line">        <span class="comment">// è¿è¡Œä¸­å¯èƒ½æ‰ä¼šå­˜åœ¨å†™æ¡ä»¶ä¸æ»¡è¶³ -- å†™ç©ºé—´è¢«å†™æ»¡äº†</span></span><br><span class="line">        <span class="built_in">AddConnection</span>(sockfd, EPOLLIN | EPOLLET,</span><br><span class="line">                      std::<span class="built_in">bind</span>(&amp;TcpServer::TcpRecver, <span class="keyword">this</span>, std::placeholders::_1),</span><br><span class="line">                      std::<span class="built_in">bind</span>(&amp;TcpServer::TcpSender, <span class="keyword">this</span>, std::placeholders::_1),</span><br><span class="line">                      std::<span class="built_in">bind</span>(&amp;TcpServer::TcpExcepter, <span class="keyword">this</span>, std::placeholders::_1));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EAGAIN or EWOULDBLOCK</span><br><span class="line">The socket is marked nonblocking and the receive operation would block, or a receive timeout had been set and the timeout expired before data was received.  POSIX.1 allows either error to be returned for this case, and does not require these constants to have the same value, so  a  portable application should check for both possibilities.</span><br></pre></td></tr></table></figure><h4 id="7-é“¾æ¥çš„äº‹ä»¶å¤„ç†å‡½æ•°"><a href="#7-é“¾æ¥çš„äº‹ä»¶å¤„ç†å‡½æ•°" class="headerlink" title="7.é“¾æ¥çš„äº‹ä»¶å¤„ç†å‡½æ•°"></a>7.é“¾æ¥çš„äº‹ä»¶å¤„ç†å‡½æ•°</h4><p>å…¶ä»–é“¾æ¥çš„ä¸‰ä¸ªå¤„ç†å‡½æ•°åˆ†åˆ«æ˜¯<code>TcpRever/TcpSender/TcpExcepter</code>;</p><p>é¦–å…ˆï¼Œåœ¨å¤„ç†æŸä¸€ä¸ªé“¾æ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¿…é¡»è¦ä¿è¯è¿™ä¸ªé“¾æ¥åœ¨å·²æœ‰çš„mapé‡Œé¢ï¼Œå¦åˆ™ä»£è¡¨è¿™ä¸ªé“¾æ¥å·²ç»è¢«å…³é—­æˆ–è€…å¼‚å¸¸é€€å‡ºäº†ï¼›åŒç†ï¼Œåœ¨å¼‚å¸¸å’Œå…³é—­é“¾æ¥çš„å¤„ç†æµç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å°†é“¾æ¥ä»mapä¸­åˆ é™¤</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">IsExists</span><span class="params">(<span class="type">int</span> sock)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> iter = connections_.<span class="built_in">find</span>(sock);</span><br><span class="line">    <span class="keyword">if</span> (iter == connections_.<span class="built_in">end</span>())</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="è¯»"><a href="#è¯»" class="headerlink" title="è¯»"></a>è¯»</h5><p>å¯¹äºè¯»äº‹ä»¶è€Œè¨€æˆ‘ä»¬ä¹Ÿæ˜¯è¿›è¡Œå¾ªç¯è¯»å–ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦ä¹Ÿéœ€è¦è¢«è®¾ç½®ä¸ºéé˜»å¡ã€‚è¯»å–çš„å†…å®¹æ‹¼æ¥åˆ°è¯¥Connectionå¯¹è±¡çš„è¾“å…¥ç¼“å†²åŒºstringä¸­ï¼›</p><p>åœ¨è¯»å–å®Œæ¯•åï¼Œæˆ‘ä»¬éœ€è¦åœ¨åè®®é‡Œé¢å®šä¹‰ä¸€ä¸ªæ ¹æ®<strong>åº”ç”¨å±‚åè®®å­—æ®µ</strong>æ¥åˆ†ç¦»æŠ¥æ–‡çš„å‡½æ•°ï¼ˆé¿å…tcpçš„ç²˜åŒ…é—®é¢˜ï¼‰ï¼Œæœ€ç»ˆä¼šå¾—åˆ°ä¸€ä¸ªstringçš„æ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„æˆå‘˜éƒ½æ˜¯ä¸€ä¸ªå®Œæ•´çš„æŠ¥æ–‡ï¼›</p><p>æœ€åï¼Œæˆ‘ä»¬ç›´æ¥ä¸€ä¸ªforå¾ªç¯ï¼Œé€šè¿‡è¯¥tcpserverå¯¹è±¡åœ¨åˆå§‹åŒ–æ—¶å€™è®¾ç½®çš„<code>cb_</code>å‡½æ•°å›è°ƒæŒ‡é’ˆï¼Œæ¥å¤„ç†æ¯ä¸€ä¸ªæŠ¥æ–‡ï¼ˆä¸ºæ¯ä¸€ä¸ªæŠ¥æ–‡æä¾›æœåŠ¡ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">TcpRecver</span><span class="params">(Connection *conn)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">char</span> buffer[<span class="number">1024</span>];</span><br><span class="line">        <span class="type">ssize_t</span> s = <span class="built_in">recv</span>(conn-&gt;sock_, buffer, <span class="built_in">sizeof</span>(buffer) - <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (s &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            buffer[s] = <span class="number">0</span>;</span><br><span class="line">            conn-&gt;inbuffer_ += buffer;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">logMessage</span>(DEBUG, <span class="string">&quot;client quit&quot;</span>);</span><br><span class="line">            conn-&gt;<span class="built_in">excepter_</span>(conn);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (errno == EINTR) <span class="comment">// æ¥æ”¶äº‹ä»¶è¢«æ‰“æ–­</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="comment">// æ¥æ”¶ç¼“å†²åŒºç©ºäº†</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (errno == EAGAIN || errno == EWOULDBLOCK)</span><br><span class="line">                <span class="keyword">break</span>; <span class="comment">// è·³å‡ºå¾ªç¯</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// å‡ºé”™äº†</span></span><br><span class="line">                <span class="built_in">logMessage</span>(DEBUG, <span class="string">&quot;recv error: %d:%s&quot;</span>, errno, <span class="built_in">strerror</span>(errno));</span><br><span class="line">                conn-&gt;<span class="built_in">excepter_</span>(conn);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†æœ¬è½®å…¨éƒ¨è¯»å–å®Œæ¯•</span></span><br><span class="line">    std::vector&lt;std::string&gt; result;</span><br><span class="line">    <span class="built_in">PackageSplit</span>(conn-&gt;inbuffer_, &amp;result);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;message : result)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cb_</span>(conn, message);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ¡†æ¶çš„å¥½å¤„å°±åœ¨äºï¼Œä½ å¯ä»¥å•ç‹¬å®ç°ä¸åŒåè®®çš„æŠ¥æ–‡åˆ†ç¦»å‡½æ•°å’Œæ•°æ®æœåŠ¡å‡½æ•°ï¼Œè€Œä¸éœ€è¦é‡å†™TcpServerçš„å®ç°ï¼Œç›¸å½“äºè§£è€¦ï¼›</p><h5 id="å†™"><a href="#å†™" class="headerlink" title="å†™"></a>å†™</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">TcpSender</span><span class="params">(Connection *conn)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">ssize_t</span> n = <span class="built_in">send</span>(conn-&gt;sock_, conn-&gt;outbuffer_.<span class="built_in">c_str</span>(), conn-&gt;outbuffer_.<span class="built_in">size</span>(), <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span>(n &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// å»é™¤å·²ç»æˆåŠŸå‘é€çš„æ•°æ®</span></span><br><span class="line">            conn-&gt;outbuffer_.<span class="built_in">erase</span>(<span class="number">0</span>, n);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// å†™å…¥æ“ä½œè¢«æ‰“æ–­</span></span><br><span class="line">            <span class="keyword">if</span>(errno == EINTR) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="comment">// å†™å…¥ç¼“å†²åŒºæ»¡äº†ï¼Œæ²¡åŠæ³•ç»§ç»­å†™</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(errno == EAGAIN || errno == EWOULDBLOCK) <span class="keyword">break</span>; </span><br><span class="line">            <span class="keyword">else</span> <span class="comment">// å¼‚å¸¸</span></span><br><span class="line">            &#123;</span><br><span class="line">                conn-&gt;<span class="built_in">excepter_</span>(conn);</span><br><span class="line">                <span class="built_in">logMessage</span>(DEBUG, <span class="string">&quot;send error: %d:%s&quot;</span>, errno, <span class="built_in">strerror</span>(errno));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œè¿™é‡Œçš„å†™å…¥å¦‚æœé‡åˆ°<code>(errno == EAGAIN || errno == EWOULDBLOCK)</code> è¿™ä¸¤ç§æƒ…å†µï¼Œå¹¶ä¸èƒ½ç¡®ä¿è¾“å‡ºç¼“å†²åŒºä¸­çš„æ•°æ®å·²ç»è¢«å…¨éƒ¨å†™å…¥äº†ï¼›æœ‰å¯èƒ½æ˜¯å†™å…¥ç¼“å†²åŒºæ»¡äº†å¯¼è‡´æ— æ³•ç»§ç»­å†™å…¥ï¼›</p><p>è¿™ç§iæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­<code>outbuffer</code>æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œåˆ™è¿˜æ˜¯éœ€è¦è®¾ç½®<code>EPOLLOUT</code>æ ‡è®°ä½ï¼Œå‘ŠçŸ¥epollç»§ç»­å¸®æˆ‘ä»¬å…³æ³¨å†™äº‹ä»¶ï¼ˆè¿™æ ·epollå°±ä¼šå‘ä¿¡æ¯å‘ŠçŸ¥Reactorï¼ŒReactorä¼šé‡æ–°è°ƒç”¨å†™å…¥å‡½æ•°ï¼Œç»§ç»­å†™å…¥ç¼“å†²åŒºçš„å‰©ä¸‹æ•°æ®ï¼‰è¿™ä¸ªæ“ä½œä¼šåœ¨ä¸»æ‰§è¡Œæµä¸­è¿›è¡Œç»Ÿä¸€åˆ¤æ–­</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸»æ‰§è¡Œæµ</span></span><br><span class="line">conn-&gt;<span class="built_in">sender_</span>(conn); <span class="comment">// ä¸»æ‰§è¡Œæµè°ƒç”¨å‘é€å‡½æ•°</span></span><br><span class="line"><span class="comment">// åˆ¤æ–­æœ¬æ¬¡æ˜¯å¦å‘å®Œæ¯•äº†ï¼Œæ²¡æœ‰å‘å®Œæ¯•è¿˜éœ€è¦ç»§ç»­å…³å¿ƒè¯»å†™</span></span><br><span class="line"><span class="keyword">if</span>(conn-&gt;outbuffer_.<span class="built_in">empty</span>()) conn-&gt;R_-&gt;<span class="built_in">EnableReadWrite</span>(conn-&gt;sock_, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line"><span class="keyword">else</span> conn-&gt;R_-&gt;<span class="built_in">EnableReadWrite</span>(conn-&gt;sock_, <span class="literal">true</span>, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰“å¼€æˆ–è€…å…³é—­å¯¹äºç‰¹å®šsocketæ˜¯å¦è¦å…³å¿ƒè¯»æˆ–è€…å†™</span></span><br><span class="line"><span class="comment">//- EnableReadWrite(sock, true, false); //åªå…³å¿ƒè¯»</span></span><br><span class="line"><span class="comment">//- EnableReadWrite(sock, true, true);  //åŒæ—¶å…³å¿ƒè¯»å†™</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">EnableReadWrite</span><span class="params">(<span class="type">int</span> sock, <span class="type">bool</span> readable, <span class="type">bool</span> writeable)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> event = <span class="number">0</span>;</span><br><span class="line">    event |= (readable ? EPOLLIN : <span class="number">0</span>);</span><br><span class="line">    event |= (writeable ? EPOLLOUT : <span class="number">0</span>);</span><br><span class="line">    Epoller::<span class="built_in">ModEvent</span>(epfd_, sock, event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å¼‚å¸¸"><a href="#å¼‚å¸¸" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h5><p>ä¸ºäº†ç»Ÿä¸€è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼Œåœ¨ä¸Šæ–‡ä¸­å½“æˆ‘ä»¬é‡åˆ°è¯»å†™å‡ºé”™çš„æ—¶å€™ï¼Œéƒ½ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼›</p><p>åœ¨è¿™ä¸ªå‡½æ•°ä½“å†…ï¼Œä¼šå°†é“¾æ¥ä»epollä¸­åˆ é™¤ã€å…³é—­é“¾æ¥ã€é‡Šæ”¾connectionå¯¹è±¡ã€å°†æ–‡ä»¶æè¿°ç¬¦ä»mapé‡Œé¢å‰”é™¤ï¼›</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€å®šè¦å…ˆå°†socketä»epollé‡Œé¢å‰”é™¤æ‰ï¼Œå†å…³é—­socketï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">TcpExcepter</span><span class="params">(Connection *conn)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 0. åˆ¤æ–­æœ‰æ•ˆæ€§</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">IsExists</span>(conn-&gt;sock_)) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰€æœ‰çš„æœåŠ¡å™¨å¼‚å¸¸ï¼Œéƒ½ä¼šè¢«å½’ç±»åˆ°è¿™é‡Œ</span></span><br><span class="line">    <span class="comment">// 1. åˆ é™¤epollçš„ç›‘çœ‹</span></span><br><span class="line">    Epoller::<span class="built_in">DelEvent</span>(epfd_, conn-&gt;sock_);</span><br><span class="line">    <span class="built_in">logMessage</span>(DEBUG, <span class="string">&quot;remove epoll event!&quot;</span>);</span><br><span class="line">    <span class="comment">// 2. close</span></span><br><span class="line">    <span class="built_in">close</span>(conn-&gt;sock_);</span><br><span class="line">    <span class="built_in">logMessage</span>(DEBUG, <span class="string">&quot;close fd: %d&quot;</span>, conn-&gt;sock_);</span><br><span class="line">    <span class="comment">// 3. delete conn;</span></span><br><span class="line">    <span class="keyword">delete</span> connections_[conn-&gt;sock_];</span><br><span class="line">    <span class="built_in">logMessage</span>(DEBUG, <span class="string">&quot;delete connection object done&quot;</span>);</span><br><span class="line">    <span class="comment">// 4. erase conn;</span></span><br><span class="line">    connections_.<span class="built_in">erase</span>(conn-&gt;sock_);</span><br><span class="line">    <span class="built_in">logMessage</span>(DEBUG, <span class="string">&quot;erase connection from connections&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="8-è¿è¡Œ"><a href="#8-è¿è¡Œ" class="headerlink" title="8.è¿è¡Œ"></a>8.è¿è¡Œ</h4><p>å¯¹äºTcpServerè€Œè¨€ï¼Œä¸€æ¬¡çš„è¿è¡Œå°±æ˜¯è°ƒç”¨ä¸€æ¬¡<code>epoll_wait</code>ï¼Œå†æ ¹æ®äº‹ä»¶å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè°ƒç”¨ä¸åŒçš„äº‹ä»¶å¤„ç†å‡½æ•°</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dispatcher</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n = Epoller::<span class="built_in">LoopOnce</span>(epfd_, revs_, revs_num);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> sock = revs_[i].data.fd;</span><br><span class="line">        <span class="type">uint32_t</span> revent = revs_[i].events;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦å‡ºç°é”™è¯¯ï¼Œå¦‚æœå‡ºç°äº†é”™è¯¯ï¼Œé‚£å°±æŠŠEPOLLINå’ŒOUTéƒ½åŠ ä¸Š</span></span><br><span class="line">        <span class="comment">// è¿™æ ·è¿™ä¸ªé“¾æ¥ä¼šè¿›å…¥ä¸‹é¢çš„å¤„ç†å‡½æ•°ï¼Œå¹¶åœ¨å¤„ç†å‡½æ•°ä¸­å‡ºç°å¼‚å¸¸</span></span><br><span class="line">        <span class="comment">// å¤„ç†å‡½æ•°ä¸­å‡ºç°å¼‚å¸¸å›ç»Ÿä¸€è°ƒç”¨TcpExcpterå‡½æ•°</span></span><br><span class="line">        <span class="keyword">if</span>(revent &amp; EPOLLHUP) revent |= (EPOLLIN|EPOLLOUT);</span><br><span class="line">        <span class="keyword">if</span>(revent &amp; EPOLLERR) revent |= (EPOLLIN|EPOLLOUT);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (revent &amp; EPOLLIN)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">IsExists</span>(sock) &amp;&amp; connections_[sock]-&gt;recver_)</span><br><span class="line">                connections_[sock]-&gt;<span class="built_in">recver_</span>(connections_[sock]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å½“é“¾æ¥çš„å†™äº‹ä»¶è¢«æ¿€æ´»çš„æ—¶å€™ï¼Œåœ¨è¿™é‡Œå°±ä¼šè§¦å‘å†™äº‹ä»¶çš„å¤„ç†</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥å¹¶ä¸éœ€è¦åœ¨recvé‡Œé¢ä¸»åŠ¨è°ƒç”¨å†™äº‹ä»¶å¤„ç†å‡½æ•°</span></span><br><span class="line">        <span class="comment">// åªéœ€è¦å‘Šè¯‰epollè®©å®ƒå¸®æˆ‘ä»¬ç›‘æ§å†™äº‹ä»¶ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨è¿™é‡Œè§¦å‘å†™æ“ä½œ</span></span><br><span class="line">        <span class="keyword">if</span> (revent &amp; EPOLLOUT)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">IsExists</span>(sock) &amp;&amp; connections_[sock]-&gt;sender_)</span><br><span class="line">                connections_[sock]-&gt;<span class="built_in">sender_</span>(connections_[sock]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•´ä¸ªæœåŠ¡å™¨è¿è¡Œèµ·æ¥ï¼Œå°±ä¸€ç›´è°ƒç”¨åˆ†å‘å‡½æ•°å°±OKå•¦~</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">Dispatcher</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-2-5-ä¸»æ‰§è¡Œæµ"><a href="#6-2-5-ä¸»æ‰§è¡Œæµ" class="headerlink" title="6.2.5 ä¸»æ‰§è¡Œæµ"></a>6.2.5 ä¸»æ‰§è¡Œæµ</h3><p>å¯¹äºä¸»æ‰§è¡Œæµè€Œè¨€ï¼Œè¦åšçš„å°±æ˜¯è·å–åˆ°å‘½ä»¤è¡Œå‚æ•°çš„ç«¯å£ï¼Œç„¶ååˆ›å»ºtcpserverå¯¹è±¡å¹¶ç»‘å®šäº‹ä»¶å¤„ç†å‡½æ•°</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TcpServer.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Service.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">usage</span><span class="params">(std::string process)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cerr &lt;&lt; <span class="string">&quot;\nUsage: &quot;</span> &lt;&lt; process &lt;&lt; <span class="string">&quot; port\n&quot;</span></span><br><span class="line">         &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">usage</span>(argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">TcpServer <span class="title">svr</span><span class="params">(HandlerRequest, atoi(argv[<span class="number">1</span>]))</span></span>;</span><br><span class="line">    svr.<span class="built_in">Run</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº‹ä»¶å¤„ç†å‡½æ•°å¯ä»¥åšä»»æ„å°è£…ï¼Œæ¥å®ç°ä½ è‡ªå·±æƒ³è¦çš„åŠŸèƒ½</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">HandlerRequest</span><span class="params">(Connection *conn, std::string &amp;message)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// beginhandleré‡Œé¢æ˜¯å…·ä½“çš„è°ƒç”¨é€»è¾‘ï¼Œcalculatoræ˜¯æœ¬æ¬¡äº‹åŠ¡å¤„ç†å‡½æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">BeginHandler</span>(conn, message, calculator);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ˜¯æˆ‘ä»¬å•ä¸ªå®Œæ•´æŠ¥æ–‡çš„å¤„ç†å‡½æ•°ï¼Œåœ¨tcprecveræ–¹æ³•é‡Œé¢è¢«è°ƒç”¨äº†ï¼›</p><p>æ ¹æ®ä¸Šæ–‡æè¿°çš„è°ƒç”¨æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šï¼Œè¿™é‡Œä¼ å…¥æ¥çš„<code>message</code>è‚¯å®šæ˜¯ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨å±‚æŠ¥æ–‡ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ›å»ºä¸€ä¸ªå±äºæˆ‘ä»¬è‡ªå·±çš„åè®®å’Œåè®®ä¸­çš„æ•°æ®å¤„ç†å‡½æ•°å°±OKäº†ï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">BeginHandler</span><span class="params">(Connection *conn, std::string &amp;message, <span class="type">service_t</span> service)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// messageä¸€å®šæ˜¯ä¸€ä¸ªå®Œæ•´çš„æŠ¥æ–‡ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»å¯¹å®ƒè¿›è¡Œäº†è§£ç </span></span><br><span class="line">    Request req;</span><br><span class="line">    <span class="comment">// ååºåˆ—åŒ–ï¼Œè¿›è¡Œå¤„ç†çš„é—®é¢˜</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">Parser</span>(message, &amp;req))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// å†™å›é”™è¯¯æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="comment">// å¯ä»¥ç›´æ¥å…³é—­è¿æ¥</span></span><br><span class="line">        <span class="comment">// conn-&gt;excepter_(conn);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    Response resp = <span class="built_in">service</span>(req);</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; req.x &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; req.op &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; req.y &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; resp.code &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; resp.result &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line">    std::string sendstr;</span><br><span class="line">    <span class="built_in">Serialize</span>(resp, &amp;sendstr);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†å®Œæ¯•çš„ç»“æœï¼Œå‘é€å›ç»™client</span></span><br><span class="line">    conn-&gt;outbuffer_ += sendstr;</span><br><span class="line">    conn-&gt;<span class="built_in">sender_</span>(conn);</span><br><span class="line">    <span class="keyword">if</span>(conn-&gt;outbuffer_.<span class="built_in">empty</span>()) conn-&gt;R_-&gt;<span class="built_in">EnableReadWrite</span>(conn-&gt;sock_, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">else</span> conn-&gt;R_-&gt;<span class="built_in">EnableReadWrite</span>(conn-&gt;sock_, <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;--- end ---&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-2-6-åè®®å’Œæ•°æ®å¤„ç†"><a href="#6-2-6-åè®®å’Œæ•°æ®å¤„ç†" class="headerlink" title="6.2.6 åè®®å’Œæ•°æ®å¤„ç†"></a>6.2.6 åè®®å’Œæ•°æ®å¤„ç†</h3><p>ä¸‹é¢æä¾›ä¸€ä¸ªæœ€åŸºç¡€çš„è®¡ç®—å™¨åè®®ï¼Œè¿™ä¸ªåè®®çš„å¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨telnetå°±æ¨¡æ‹Ÿå‡ºè¯·æ±‚ï¼Œæ— éœ€å†™ä¸€ä¸ªtcpå®¢æˆ·ç«¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x æ“ä½œç¬¦ y#</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªåè®®ä¸­ï¼Œæ¯ä¸ªæœ‰æ•ˆæ•°æ®ä¸­éƒ½ä¼šå¸¦ä¸Šä¸€ä¸ªç©ºæ ¼ï¼Œå¹¶ä»¥<code>#</code>ä½œä¸ºå•ä¸ªæŠ¥æ–‡çš„ç»“å°¾ï¼›</p><p>å“åº”å’Œè¯·æ±‚çš„ç»“æ„ä½“æ ¼å¼ä¹Ÿéå¸¸ç®€å•ï¼Œå“åº”é‡Œé¢æ˜¯çŠ¶æ€ç å’Œè®¡ç®—ç»“æœï¼›æˆ‘ä»¬åœ¨åè®®ä¸­æ·»åŠ åºåˆ—åŒ–å’Œååºåˆ—åŒ–å‡½æ•°å°±å¯ä»¥å°†å“åº”å’Œè¯·æ±‚ç»“æ„ä½“è½¬æˆå­—ç¬¦ä¸²</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Request</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="type">int</span> y;</span><br><span class="line">    <span class="type">char</span> op;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Response</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> code;</span><br><span class="line">    <span class="type">int</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SEP <span class="string">&#x27;#&#x27;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SEP_LEN sizeof(SEP)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CRLF <span class="string">&quot;\r\n&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CRLF_LEN strlen(CRLF)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPACE <span class="string">&quot; &quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPACE_LEN strlen(SPACE)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ†ç¦»ç‹¬ç«‹æŠ¥æ–‡</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PackageSplit</span><span class="params">(std::string &amp;inbuffer, std::vector&lt;std::string&gt; *result)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        std::<span class="type">size_t</span> pos = inbuffer.<span class="built_in">find</span>(SEP);</span><br><span class="line">        <span class="keyword">if</span> (pos == std::string::npos)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        result-&gt;<span class="built_in">push_back</span>(inbuffer.<span class="built_in">substr</span>(<span class="number">0</span>, pos));</span><br><span class="line">        inbuffer.<span class="built_in">erase</span>(<span class="number">0</span>, pos + SEP_LEN);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Request</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="type">int</span> y;</span><br><span class="line">    <span class="type">char</span> op;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Response</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> code;</span><br><span class="line">    <span class="type">int</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Parser</span><span class="params">(std::string &amp;in, Request *req)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 1 + 1, 2 * 4, 5 * 9, 6 *1</span></span><br><span class="line">    std::<span class="type">size_t</span> spaceOne = in.<span class="built_in">find</span>(SPACE);</span><br><span class="line">    <span class="keyword">if</span> (std::string::npos == spaceOne)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    std::<span class="type">size_t</span> spaceTwo = in.<span class="built_in">rfind</span>(SPACE);</span><br><span class="line">    <span class="keyword">if</span> (std::string::npos == spaceTwo)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    std::string dataOne = in.<span class="built_in">substr</span>(<span class="number">0</span>, spaceOne);</span><br><span class="line">    std::string dataTwo = in.<span class="built_in">substr</span>(spaceTwo + SPACE_LEN);</span><br><span class="line">    std::string oper = in.<span class="built_in">substr</span>(spaceOne + SPACE_LEN, spaceTwo - (spaceOne + SPACE_LEN));</span><br><span class="line">    <span class="keyword">if</span> (oper.<span class="built_in">size</span>() != <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è½¬æˆå†…éƒ¨æˆå‘˜</span></span><br><span class="line">    req-&gt;x = <span class="built_in">atoi</span>(dataOne.<span class="built_in">c_str</span>());</span><br><span class="line">    req-&gt;y = <span class="built_in">atoi</span>(dataTwo.<span class="built_in">c_str</span>());</span><br><span class="line">    req-&gt;op = oper[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Serialize</span><span class="params">(<span class="type">const</span> Response &amp;resp, std::string *out)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::string ec = std::<span class="built_in">to_string</span>(resp.code);</span><br><span class="line">    std::string res = std::<span class="built_in">to_string</span>(resp.result);</span><br><span class="line"></span><br><span class="line">    *out = ec;</span><br><span class="line">    *out += SPACE;</span><br><span class="line">    *out += res;</span><br><span class="line">    *out += CRLF;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>service.hpp</code>é‡Œé¢åˆ™æ˜¯æ•°æ®å¤„ç†çš„è®¡ç®—å‡½æ•°ï¼Œé€šè¿‡æˆ‘ä»¬ä¼ å…¥çš„è¯·æ±‚ï¼Œè®¡ç®—å‡ºç»“æ„å¹¶æ„é€ å“åº”è¿”å›ç»™ç”¨æˆ·</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Protocol.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="type">service_t</span> = std::function&lt;<span class="built_in">Response</span> (<span class="type">const</span> Request &amp;req)&gt;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> Response <span class="title">calculator</span><span class="params">(<span class="type">const</span> Request &amp;req)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Response resp = &#123;<span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">switch</span> (req.op)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">        resp.result = req.x + req.y;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">        resp.result = req.x - req.y;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">        resp.result = req.x * req.y;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">    &#123; <span class="comment">// x_ / y_</span></span><br><span class="line">        <span class="keyword">if</span> (req.y == <span class="number">0</span>)</span><br><span class="line">            resp.code = <span class="number">-1</span>; <span class="comment">// -1. é™¤0</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            resp.result = req.x / req.y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;%&#x27;</span>:</span><br><span class="line">    &#123; <span class="comment">// x_ / y_</span></span><br><span class="line">        <span class="keyword">if</span> (req.y == <span class="number">0</span>)</span><br><span class="line">            resp.code = <span class="number">-2</span>; <span class="comment">// -2. æ¨¡0</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            resp.result = req.x % req.y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        resp.code = <span class="number">-3</span>; <span class="comment">// -3: éæ³•æ“ä½œç¬¦</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> resp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-2-7-æµ‹è¯•"><a href="#6-2-7-æµ‹è¯•" class="headerlink" title="6.2.7 æµ‹è¯•"></a>6.2.7 æµ‹è¯•</h3><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„æœåŠ¡å¯åŠ¨äº†ä¹‹åï¼ŒæˆåŠŸæ¥æ”¶äº†ä¸€ä¸ªé“¾æ¥ï¼Œå¹¶è®¡ç®—å‡ºäº†æˆ‘ä»¬å‘é€çš„ç»“æœ</p><p><img src="https://img.musnow.top/i/2023/08/5e164406ab4e280265a7fcd8fdc3de67.png" alt="image-20230828115411040"></p><p>å¤šä¸ªé“¾æ¥ä¹Ÿä¸åœ¨è¯ä¸‹ï¼</p><p><img src="https://img.musnow.top/i/2023/08/58a989acdf95c2dc2c89a1677f8a4d56.png" alt="image-20230828115525101"></p><h1 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h1><p>å¤šè·¯è½¬æ¥è¿™éƒ¨åˆ†æ˜¯linuxæœåŠ¡å™¨æœ€é‡è¦çš„ä¸€éƒ¨åˆ†çŸ¥è¯†ï¼Œå› ä¸ºå¤§éƒ¨åˆ†æœåŠ¡å™¨éƒ½æŠ›å¼ƒäº†æœ€ä¼ ç»Ÿçš„ä¸€ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªé“¾æ¥è¿™æ ·çš„æ–¹å¼ï¼Œè€Œé‡‡ç”¨äº†å¤šè·¯è½¬æ¥æ¥å®ç°å¯¹å¤§é‡è¿›ç¨‹çš„ç»´æŠ¤ï¼›</p><p>æœ¬æ–‡æ˜¯å­¦ä¹ é˜¶æ®µçš„äº§ç‰©ï¼Œæœ‰é”™è¯¯åœ¨æ‰€éš¾å…ï¼Œè¯·å¤§ä½¬ä»¬æŒ‡æ•™ï¼</p><p><img src="https://img.musnow.top/i/2023/08/56eecd58cac3b6593f83998c9f30eb4b.gif" alt="QQå›¾ç‰‡20220413084241"></p>]]></content>
    
    
    <summary type="html">å¤šè·¯è½¬æ¥å’Œé«˜çº§IO</summary>
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ã€C++ã€‘æ„é€ å‡½æ•°å’Œåˆå§‹åŒ–åˆ—è¡¨çš„æ€§èƒ½å·®è·</title>
    <link href="https://blog.musnow.top/posts/2628258650/"/>
    <id>https://blog.musnow.top/posts/2628258650/</id>
    <published>2023-08-24T13:55:38.000Z</published>
    <updated>2023-08-24T13:55:38.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ„é€ å‡½æ•°å’Œåˆå§‹åŒ–åˆ—è¡¨çš„æ€§èƒ½å·®è·å¯¹æ¯”æµ‹è¯•</p><span id="more"></span><h1 id="1-è¯´æ˜"><a href="#1-è¯´æ˜" class="headerlink" title="1.è¯´æ˜"></a>1.è¯´æ˜</h1><p>åœ¨C++ç±»å’Œå¯¹è±¡ä¸­ï¼Œä½ å¯èƒ½å¬åˆ°è¿‡æ›´åŠ æ¨èç”¨åˆå§‹åŒ–åˆ—è¡¨æ¥åˆå§‹åŒ–ç±»å†…æˆå‘˜ã€‚å¦‚æœç±»å†…æˆå‘˜æ˜¯è‡ªå®šä¹‰ç±»å‹ï¼Œåˆ™åªèƒ½åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­è°ƒç”¨è‡ªå®šä¹‰ç±»å‹çš„æ„é€ å‡½æ•°ã€‚</p><p>ä½†åˆå§‹åŒ–åˆ—è¡¨å’Œåœ¨æ„é€ å‡½æ•°ä½“å†…ç›´æ¥èµ‹å€¼æœ‰æ— æ€§èƒ½å·®è·å‘¢ï¼Ÿä»Šå¤©å°±ç”¨ä¸€ä»½ç›¸å¯¹ç®€å•çš„ä»£ç æ¥æµ‹è¯•ä¸€ä¸‹</p><h1 id="2-æµ‹è¯•"><a href="#2-æµ‹è¯•" class="headerlink" title="2.æµ‹è¯•"></a>2.æµ‹è¯•</h1><h2 id="2-1-ä»£ç è¯´æ˜"><a href="#2-1-ä»£ç è¯´æ˜" class="headerlink" title="2.1 ä»£ç è¯´æ˜"></a>2.1 ä»£ç è¯´æ˜</h2><p>é¦–å…ˆæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹ï¼Œå®ç°å¸¦ç¼ºçœå€¼çš„é»˜è®¤æ„é€ ï¼Œæ‹·è´æ„é€ å’Œèµ‹å€¼é‡è½½è¿™ä¸‰ä¸ªå‡½æ•°ï¼Œå¹¶åœ¨å†…éƒ¨æ–°å¢æ‰“å°æ¥åŒºåˆ†ä¸åŒçš„å‡½æ•°</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">mytest</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">mytest</span>(<span class="type">int</span> a = <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        _a = a;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;mytest() &quot;</span> &lt;&lt; a &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">mytest</span>(<span class="type">const</span> mytest&amp; st) &#123;</span><br><span class="line">        _a = st._a;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;mytest(copy) &quot;</span> &lt;&lt; st._a &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    mytest&amp; <span class="keyword">operator</span>=(<span class="type">const</span> mytest&amp; st)</span><br><span class="line">    &#123;</span><br><span class="line">        _a = st._a;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;mytest operator= &quot;</span> &lt;&lt; st._a &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _a;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å†åœ¨å¦å¤–ä¸€ä¸ªç±»ä¸­ä½¿ç”¨è¿™ä¸ªè‡ªå®šä¹‰ç±»å‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">myclass</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">myclass</span>(<span class="type">const</span> <span class="keyword">struct</span> mytest&amp; st, <span class="type">int</span> b)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;myclass() _b:&quot;</span> &lt;&lt; _b &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">mytest</span> _sa;</span><br><span class="line">    <span class="type">int</span> _b;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æ„é€ å‡½æ•°å°±æœ‰ä¸¤ç§å†™æ³•ï¼Œä¸€ç§æ˜¯åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­åˆå§‹åŒ–è¿™ä¸ªè‡ªå®šä¹‰ç±»å‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">myclass</span>(<span class="type">const</span> <span class="keyword">struct</span> mytest&amp; st, <span class="type">int</span> b)</span><br><span class="line">       :_sa(st),</span><br><span class="line">       _b(b)</span><br><span class="line">   &#123;</span><br><span class="line">       cout &lt;&lt; <span class="string">&quot;myclass() _b:&quot;</span> &lt;&lt; _b &lt;&lt; endl;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>å¦å¤–ä¸€ç§æ˜¯åœ¨æ„é€ å‡½æ•°ä½“å†…é€šè¿‡èµ‹å€¼é‡è½½æ¥åˆå§‹åŒ–è¿™ä¸ªè‡ªå®šä¹‰ç±»å‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">myclass</span>(<span class="type">const</span> <span class="keyword">struct</span> mytest&amp; st, <span class="type">int</span> b)</span><br><span class="line">&#123;</span><br><span class="line">     _sa = st;</span><br><span class="line">     _b = b;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;myclass() _b:&quot;</span> &lt;&lt; _b &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„è‡ªå®šä¹‰ç±»å‹ä¼ å‚é‡‡ç”¨äº†å¼•ç”¨ä¼ å‚ï¼Œå¹¶ä¸ä¼šå› æ­¤äº§ç”Ÿé¢å¤–çš„æ‹·è´ï¼</p><p>ä¸»å‡½æ•°ä½“å¦‚ä¸‹ï¼Œä¸ºäº†åŒºåˆ†ç¬¬ä¸€ä¸ª<code>mytest</code>çš„æ„é€ å‡½æ•°ï¼Œæˆ‘åœ¨å…¶åæ–°å¢äº†ä¸€è¡Œè¾“å‡ºä½œä¸ºåˆ†å‰²</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">mytest <span class="title">test_a</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;------&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="function">myclass <span class="title">test</span><span class="params">(test_a, <span class="number">3</span>)</span></span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-2-æµ‹è¯•"><a href="#2-2-æµ‹è¯•" class="headerlink" title="2.2 æµ‹è¯•"></a>2.2 æµ‹è¯•</h2><p>å…ˆæ¥çœ‹çœ‹ä½¿ç”¨èµ‹å€¼åˆå§‹åŒ–çš„æ–¹å¼ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶æˆ‘ä»¬åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­ä»€ä¹ˆéƒ½æ²¡æœ‰å†™ï¼Œä½†æ˜¯è¿™é‡Œ<strong>ä¾æ—§è°ƒç”¨äº†é»˜è®¤çš„æ„é€ å‡½æ•°</strong>ï¼ˆå› ä¸ºé»˜è®¤æ„é€ å‡½æ•°çš„ç¼ºçœå€¼ç»™çš„æ˜¯<code>-1</code>ï¼Œè¿™é‡Œèƒ½é€šè¿‡å‚æ•°åˆ¤æ–­å‡ºæ¥è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æ˜¾å¼è°ƒç”¨çš„æ„é€ ï¼‰</p><p>è°ƒç”¨äº†é»˜è®¤æ„é€ åï¼Œåˆé€šè¿‡èµ‹å€¼é‡è½½æ¥åˆå§‹åŒ–äº†ä¸€é<code>_sa</code>ï¼Œç›¸å½“äºä¸¤æ¬¡åˆå§‹åŒ–</p><p><img src="https://img.musnow.top/i/2023/08/ce34a7ef5363f3de7ee7ee1034f75e04.png" alt="image-20230824212849577"></p><p>ä½†å¦‚æœè°ƒç”¨åˆå§‹åŒ–åˆ—è¡¨ï¼Œåˆ™åªä¼šæœ‰ä¸€æ¬¡æ‹·è´æ„é€ ï¼Œ<strong>é¿å…äº†é¢å¤–çš„é»˜è®¤æ„é€ è°ƒç”¨</strong>ï¼</p><p><img src="https://img.musnow.top/i/2023/08/b9f31dd47442b86d7580fa6e779c1ef3.png" alt="image-20230824213021929"></p><p>åœ¨linuxä¸‹ä¹Ÿæµ‹è¯•è¿‡äº†ï¼Œç»“æœå’ŒVS2019ç›¸åŒ</p><h1 id="3-ç»“è®º"><a href="#3-ç»“è®º" class="headerlink" title="3.ç»“è®º"></a>3.ç»“è®º</h1><p>ç»“è®ºå°±å‡ºæ¥äº†ï¼šåˆå§‹åŒ–åˆ—è¡¨èƒ½èŠ‚çœä¸€æ¬¡é»˜è®¤æ„é€ çš„è°ƒç”¨ï¼Œä¼˜åŒ–æ€§èƒ½ï¼</p><h2 id="3-1-å®é™…åœºæ™¯"><a href="#3-1-å®é™…åœºæ™¯" class="headerlink" title="3.1 å®é™…åœºæ™¯"></a>3.1 å®é™…åœºæ™¯</h2><p>åœ¨ä¸Šé¢çš„åœºæ™¯ä¸­ï¼Œæ€§èƒ½å·®è·å¯èƒ½å¹¶ä¸ä¼šç‰¹åˆ«å¤§ï¼Œä½†æ˜¯åœ¨ä¸‹é¢çš„åœºæ™¯ä¸­å¯èƒ½å°±ä¸ä¸€æ ·äº†</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">mytest</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">mytest</span>(<span class="type">int</span> sz = <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        _str = <span class="keyword">new</span> <span class="type">char</span>[sz];</span><br><span class="line">        _sz = sz;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;mytest() &quot;</span> &lt;&lt; sz &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">mytest</span>(<span class="type">const</span> mytest&amp; st) &#123;</span><br><span class="line">        <span class="keyword">delete</span> _str;<span class="comment">// éœ€è¦å…ˆé”€æ¯åŸè§†çš„æ•°æ®</span></span><br><span class="line">        _str = <span class="keyword">new</span> <span class="type">char</span>[st._sz]; <span class="comment">// å†åˆ›å»ºä¸€ä¸ªæ–°çš„</span></span><br><span class="line">        _sz = st._sz;</span><br><span class="line">        <span class="comment">//çœç•¥æ‹·è´æ•°æ®çš„ä»£ç </span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;mytest(copy) &quot;</span> &lt;&lt; st._sz &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    mytest&amp; <span class="keyword">operator</span>=(<span class="type">const</span> mytest&amp; st)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> _str;<span class="comment">// éœ€è¦å…ˆé”€æ¯åŸè§†çš„æ•°æ®</span></span><br><span class="line">        _str = <span class="keyword">new</span> <span class="type">char</span>[st._sz]; <span class="comment">// å†åˆ›å»ºä¸€ä¸ªæ–°çš„</span></span><br><span class="line">        <span class="comment">//çœç•¥æ‹·è´æ•°æ®çš„ä»£ç </span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;mytest&amp; operator= &quot;</span> &lt;&lt; st._sz &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">char</span>* _str;</span><br><span class="line">    <span class="type">size_t</span> _sz;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">myclass</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">myclass</span>(<span class="type">const</span> <span class="keyword">struct</span> mytest&amp; st, <span class="type">int</span> b)</span><br><span class="line">        :_sa(st),</span><br><span class="line">        _b(b)</span><br><span class="line">    &#123;</span><br><span class="line">         <span class="comment">//_sa = st;</span></span><br><span class="line">         <span class="comment">//_b = b;</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;myclass() _b:&quot;</span> &lt;&lt; _b &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">mytest</span> _sa;</span><br><span class="line">    <span class="type">int</span> _b;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œå› ä¸º<code>mytest</code>è‡ªå®šä¹‰ç±»å‹çš„æ‹·è´æ„é€ æ¶‰åŠåˆ°äº†æ·±æ‹·è´ï¼Œæ­¤æ—¶å°±éœ€è¦å°†å·²æœ‰çš„ç©ºé—´ç»™é”€æ¯äº†ï¼Œå†newä¸€ç‰‡æ–°çš„ç©ºé—´å‡ºæ¥ï¼Œå†å°†æ•°æ®ç»™æ‹·è´è¿‡å»ã€‚</p><p>ç™½ç™½å¤šäº†ä¸€å±‚é»˜è®¤æ„é€ ä¸­çš„newç©ºé—´çš„+æ‹·è´æ„é€ ä¸­deleteåŸæœ‰ç©ºé—´çš„æ¶ˆè€—ï¼</p><p>å¦‚æœç±»ä¸­éœ€è¦æ·±æ‹·è´çš„æˆå‘˜ä¸æ­¢ä¸€ä¸ªï¼Œé‚£æ€§èƒ½å·®è·å°±æ›´å¤§ï¼</p><p>æ‰€ä»¥åœ¨C++ä¸­ï¼Œ<strong>ä¸€å¾‹ä»¥åˆå§‹åŒ–åˆ—è¡¨ä¼˜å…ˆ</strong>ï¼</p><hr><p>è¿™é‡Œé¡ºå¸¦æä¸€å˜´åˆå§‹åŒ–åˆ—è¡¨çš„å°å‘ï¼Œä¹Ÿç®—æ˜¯å¤ä¹ ï¼›</p><p>å½“ä½ ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨æ¥åˆå§‹åŒ–ç±»å†…æˆå‘˜çš„æ—¶å€™ï¼Œåˆå§‹åŒ–çš„é¡ºåºæ˜¯ç±»å†…æˆå‘˜å£°æ˜çš„é¡ºåºï¼Œè€Œ<strong>ä¸æ˜¯åˆå§‹åŒ–åˆ—è¡¨ä¸­çš„é¡ºåº</strong>ï¼è¿™ç‚¹éå¸¸é‡è¦ï¼Œå¦‚æœé¡ºåºä¸å¯¹ï¼Œå¯èƒ½ä¼šå‡ºç°ä½¿ç”¨æœªå®šä¹‰ï¼ˆè¿˜æ²¡æœ‰åˆå§‹åŒ–å®Œæˆï¼‰çš„å‚æ•°çš„bugï¼</p>]]></content>
    
    
    <summary type="html">æ„é€ å‡½æ•°å’Œåˆå§‹åŒ–åˆ—è¡¨çš„æ€§èƒ½å·®è·å¯¹æ¯”æµ‹è¯•</summary>
    
    
    
    <category term="é‡è§C++" scheme="https://blog.musnow.top/categories/%E9%81%87%E8%A7%81C/"/>
    
    
    <category term="C++" scheme="https://blog.musnow.top/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>ã€ç‰›å®¢ç½‘ã€‘BM3é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ¯kä¸ªä¸€ç»„ç¿»è½¬</title>
    <link href="https://blog.musnow.top/posts/3391123821/"/>
    <id>https://blog.musnow.top/posts/3391123821/</id>
    <published>2023-08-24T06:05:28.000Z</published>
    <updated>2023-08-24T06:05:28.000Z</updated>
    
    <content type="html"><![CDATA[<p>BM3é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ¯kä¸ªä¸€ç»„ç¿»è½¬</p><span id="more"></span><h1 id="1-é¢˜ç›®"><a href="#1-é¢˜ç›®" class="headerlink" title="1.é¢˜ç›®"></a>1.é¢˜ç›®</h1><p><a href="https://www.nowcoder.com/practice/b49c3dc907814e9bbfa8437c251b028e?tpId=295&tqId=722&ru=/exam/company&qru=/ta/format-top101/question-ranking&sourceUrl=/exam/company"><strong>BM3 é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ¯kä¸ªä¸€ç»„ç¿»è½¬</strong></a></p><p>å°†ç»™å‡ºçš„é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ¯ k ä¸ªä¸€ç»„ç¿»è½¬ï¼Œè¿”å›ç¿»è½¬åçš„é“¾è¡¨<br>å¦‚æœé“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ•°ä¸æ˜¯ k çš„å€æ•°ï¼Œ<strong>å°†æœ€åå‰©ä¸‹çš„èŠ‚ç‚¹ä¿æŒåŸæ ·</strong><br>ä½ ä¸èƒ½æ›´æ”¹èŠ‚ç‚¹ä¸­çš„å€¼ï¼Œåªèƒ½æ›´æ”¹èŠ‚ç‚¹æœ¬èº«ã€‚</p><p><img src="https://img.musnow.top/i/2023/08/95cfbee58b6d1466bde50dd0daad2383.png" alt="image-20230824140620807"></p><h1 id="2-è§£æ"><a href="#2-è§£æ" class="headerlink" title="2.è§£æ"></a>2.è§£æ</h1><h2 id="2-1-é“¾è¡¨é€†ç½®"><a href="#2-1-é“¾è¡¨é€†ç½®" class="headerlink" title="2.1 é“¾è¡¨é€†ç½®"></a>2.1 é“¾è¡¨é€†ç½®</h2><p>å…¶ä»–éƒ¨åˆ†å…¶å®å¾ˆå¥½è§£å†³ï¼ŒåŸºäºé“¾è¡¨é€†ç½®çš„ä»£ç ï¼ˆå³é€†ç½®æ•´ä¸ªé“¾è¡¨çš„ä»£ç ï¼‰</p><p>æˆ‘ä»¬åªéœ€è¦å°†æ¯ä¸€ä¸ªéœ€è¦é€†ç½®çš„å°åŒºé—´çš„å¼€å¤´ç»™è®°ä¸‹æ¥ï¼Œäº¤ä»˜ç»™é“¾è¡¨é€†ç½®å°±å¯ä»¥äº†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ— å·®åˆ«é€†ç½®</span></span><br><span class="line"><span class="function">ListNode* <span class="title">reverseNode</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="literal">nullptr</span> || head-&gt;next == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ListNode* ans = <span class="built_in">reverseNode</span>(head-&gt;next);</span><br><span class="line">    head-&gt;next-&gt;next = head;</span><br><span class="line">    head-&gt;next = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-2-è®°å½•æ¯ä¸ªéœ€è¦é€†ç½®çš„åŒºé—´"><a href="#2-2-è®°å½•æ¯ä¸ªéœ€è¦é€†ç½®çš„åŒºé—´" class="headerlink" title="2.2 è®°å½•æ¯ä¸ªéœ€è¦é€†ç½®çš„åŒºé—´"></a>2.2 è®°å½•æ¯ä¸ªéœ€è¦é€†ç½®çš„åŒºé—´</h2><p>æ¯”å¦‚å¦‚ä¸‹éƒ¨åˆ†ä»£ç ï¼Œä¸ºäº†æ–¹ä¾¿è¿›è¡Œéå†å’ŒæŒ‡é’ˆæ§åˆ¶ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªå¤´èŠ‚ç‚¹æ”¾ç½®åœ¨äº†åŸæœ¬é“¾è¡¨å¼€å¤´</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤´èŠ‚ç‚¹å’Œéå†æŒ‡é’ˆ</span></span><br><span class="line"><span class="function">ListNode <span class="title">phead</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">phead.next = head;</span><br><span class="line">ListNode* cur = &amp;phead;</span><br><span class="line"><span class="comment">// æŠŠæ¯kä¸ªèŠ‚ç‚¹å•ç‹¬å–å‡ºæ¥ï¼Œåˆ†åˆ«é€†ç½®åé“¾æ¥èµ·æ¥</span></span><br><span class="line">std::vector&lt;ListNode*&gt; begin_node_v,begin_node_prev_v;</span><br><span class="line"><span class="type">int</span> index = k<span class="number">-1</span>; <span class="comment">// åˆå§‹åŒ–ä¸ºk-1(å¿½ç•¥å¤´èŠ‚ç‚¹)ï¼ŒåŸæœ‰é“¾è¡¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å§‹ç»ˆå…¥æ ˆ</span></span><br><span class="line"><span class="type">int</span> node_count = <span class="number">0</span>;<span class="comment">// èŠ‚ç‚¹æ€»æ•°ï¼ˆåŒ…å«å¤´èŠ‚ç‚¹ï¼‰</span></span><br><span class="line"><span class="keyword">while</span> (cur != <span class="literal">nullptr</span>) &#123; <span class="comment">// ä¸çŸ¥é“æœ‰å¤šé•¿ï¼Œå¾—æ­»å¾ªç¯</span></span><br><span class="line">    <span class="keyword">if</span>(index+<span class="number">1</span> == k &amp;&amp; cur != &amp;phead)&#123;</span><br><span class="line">        begin_node_prev_v.<span class="built_in">push_back</span>(cur);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (index == k) &#123;</span><br><span class="line">        begin_node_v.<span class="built_in">push_back</span>(cur);</span><br><span class="line">        index = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cur = cur-&gt;next;</span><br><span class="line">    index++;</span><br><span class="line">    node_count ++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜åˆ›å»ºäº†ä¸¤ä¸ªvectoræ•°ç»„</p><ul><li><code>begin_node_v</code>ï¼šå¾…é€†ç½®åŒºé—´çš„å¼€å¤´</li><li><code>begin_node_prev_v</code>ï¼šå¾…é€†ç½®åŒºé—´çš„å¼€å¤´çš„ä¸Šä¸€ä¸ª</li></ul><p>ä¸‹é¢æ˜¯å¯¹è¿™ä¸¤ä¸ªæ•°ç»„çš„è¯´æ˜ï¼Œå¦‚æœç»™å‡ºçš„ç¤ºä¾‹æ˜¯å¦‚ä¸‹å½¢å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;1,2,3,4,5&#125;,2</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆä¸¤ä¸ªæ•°ç»„åˆ†åˆ«å­˜å‚¨äº†å¦‚ä¸‹å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">begin_node_v:     &#123;1,3,5&#125;</span><br><span class="line">begin_node_prev_v: &#123;2,4&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€æ¥ï¼Œç¬¬ä¸€ä¸ªæ•°ç»„å®é™…ä¸Šå­˜æ”¾çš„æ˜¯æ¯ä¸ªåŒºé—´çš„<strong>å¼€å¤´</strong>ï¼Œç¬¬äºŒä¸ªæ•°ç»„å­˜æ”¾çš„åˆ™æ˜¯æ¯ä¸ªåŒºé—´çš„<strong>ç»“å°¾</strong>ã€‚<strong>é€†ç½®äº†ä¹‹å</strong>:</p><ul><li>ç¬¬äºŒä¸ªæ•°ç»„å°±æ˜¯æ–°åŒºé—´çš„å¼€å¤´</li><li>ç¬¬ä¸€ä¸ªæ•°ç»„å°±æ˜¯æ–°åŒºé—´çš„ç»“å°¾</li></ul><p>æ–¹ä¾¿æˆ‘ä»¬å°†é€†ç½®åçš„é“¾è¡¨é‡æ–°è¿èµ·æ¥ï¼</p><h2 id="2-3-æŠ›å¼ƒæ— éœ€é€†ç½®çš„åŒºé—´"><a href="#2-3-æŠ›å¼ƒæ— éœ€é€†ç½®çš„åŒºé—´" class="headerlink" title="2.3 æŠ›å¼ƒæ— éœ€é€†ç½®çš„åŒºé—´"></a>2.3 æŠ›å¼ƒæ— éœ€é€†ç½®çš„åŒºé—´</h2><p>åœ¨ä¸Šé¢çš„å¾ªç¯ä¸­ï¼Œç”¨äº†<code>node_count</code>æ¥è®¡ç®—äº†æ•´ä¸ªé“¾è¡¨çš„é•¿åº¦ï¼Œå‡1å‰”é™¤æˆ‘è‡ªå·±æ·»åŠ çš„å¤´èŠ‚ç‚¹ï¼Œå°±æ˜¯åŸå§‹é“¾è¡¨çš„é•¿åº¦ã€‚</p><p>é¢˜ç›®æœ‰ä¸ªç‰¹æ®Šè¦æ±‚ï¼šå¦‚æœåŸå§‹é“¾è¡¨çš„é•¿åº¦å¹¶ékçš„æ•´æ•°å€ï¼Œé‚£ä¹ˆæœ€åä¸€æ®µåŒºåŸŸçš„é“¾è¡¨æ˜¯ä¸éœ€è¦é€†ç½®çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 - 2 - 3 - 4 - 5</span><br><span class="line">å½“k=3çš„æ—¶å€™ï¼Œåªéœ€è¦é€†ç½® 1-2-3</span><br><span class="line">            4-5ä¸éœ€è¦é€†ç½®</span><br><span class="line">3 - 2 - 1 - 4 - 5</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ç§æƒ…å†µï¼Œç”¨ä¾‹å’Œä¸¤ä¸ªæ•°ç»„å­˜æ”¾çš„èŠ‚ç‚¹å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç”¨ä¾‹ &#123;1,2,3,4,5&#125;,3</span><br><span class="line"></span><br><span class="line">begin_node_v:     &#123;1,4&#125;</span><br><span class="line">begin_node_prev_v: &#123;3&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬ç›´æ¥å°†<code>begin_node_v</code>é‡Œé¢çš„èŠ‚ç‚¹äº¤ä»˜ç»™é“¾è¡¨é€†ç½®å‡½æ•°ï¼Œå°±ä¼šå°†<code>4-5</code>è¿™ä¸€æ®µå¤œç»™é€†ç½®ï¼Œæœ€ç»ˆè¿”å›çš„ç»“æœæ˜¯<code>3-2-1-5-4</code>ï¼Œä¸ç¬¦åˆé¢˜ç›®è¦æ±‚ï¼</p><p>æ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å°†4ä»ç¬¬ä¸€ä¸ªæ•°ç»„ä¸­åˆ é™¤ï¼å¦‚æœåŸè§†é“¾è¡¨çš„èŠ‚ç‚¹æ•°é‡å·²ç»å°äºkäº†ï¼Œåˆ™ä¹Ÿä¸éœ€è¦é€†ç½®ï¼Œç›´æ¥è¿”å›å³å¯ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœèŠ‚ç‚¹æ€»æ•°é‡å°äºkåˆ™ä¸é€†ç½®ç›´æ¥è¿”å›</span></span><br><span class="line">node_count --;<span class="comment">//å‡-1 å¤´èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">if</span>(node_count &lt;k)&#123;</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¸æ˜¯æ•´æ•°å€ï¼Œä»£è¡¨æœ€åä¸€ä¸ªæ˜¯ä¸è¦å¤„ç†çš„</span></span><br><span class="line">ListNode* last_link = <span class="literal">nullptr</span>; </span><br><span class="line"><span class="keyword">if</span>((node_count %k) != <span class="number">0</span>) &#123;</span><br><span class="line">    last_link = begin_node_v[begin_node_v.<span class="built_in">size</span>()<span class="number">-1</span>];<span class="comment">// æœ€åä¸€ä¸ª</span></span><br><span class="line">    begin_node_v.<span class="built_in">pop_back</span>();<span class="comment">// åˆ é™¤æœ€åä¸€ä¸ª</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œä¸ºäº†æœ€ç»ˆå°†è¿™æ®µä¹ˆæœ‰é€†ç½®çš„é“¾è¡¨å’Œæ–°é“¾è¡¨è¿èµ·æ¥ï¼Œæˆ‘ä»¬è¿˜éœ€ç”¨ä¸€ä¸ªæŒ‡é’ˆè®°å½•ä¸‹è¿™ä¸€æ®µçš„å¼€å¤´ï¼›<code>last_link</code>åˆå§‹åŒ–ä¸ºç©ºæ˜¯æ–¹ä¾¿åç»­çš„åˆ¤æ–­ï¼Œå¦‚æœä¸ºç©ºä»£è¡¨ä¸å­˜åœ¨è¿™ä¸€æ®µé“¾è¡¨ï¼Œä¸éœ€è¦é“¾æ¥ã€‚</p><h2 id="2-4-åŒºé—´ç»“æŸæ ‡è¯†"><a href="#2-4-åŒºé—´ç»“æŸæ ‡è¯†" class="headerlink" title="2.4 åŒºé—´ç»“æŸæ ‡è¯†"></a>2.4 åŒºé—´ç»“æŸæ ‡è¯†</h2><p>ä¸ºäº†æ ‡è¯†æ¯æ¬¡é€†ç½®çš„ç»“æŸç¬¦ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†å¾…é€†ç½®çš„æ¯ä¸€ä¸ªå°åŒºé—´çš„æœ«å°¾éƒ½æ”¹æˆ<code>nullptr</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†æ¯ä¸ªåŒºé—´çš„æœ«å°¾èŠ‚ç‚¹çš„nexté“¾æ¥ä¸ºNullä½œä¸ºé€’å½’æ ‡è¯†</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span>&amp;n:begin_node_prev_v)&#123;</span><br><span class="line">    n-&gt;next = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-5-é€†ç½®å’Œé‡æ–°é“¾æ¥"><a href="#2-5-é€†ç½®å’Œé‡æ–°é“¾æ¥" class="headerlink" title="2.5 é€†ç½®å’Œé‡æ–°é“¾æ¥"></a>2.5 é€†ç½®å’Œé‡æ–°é“¾æ¥</h2><p>ä¸Šé¢çš„æ­¥éª¤éƒ½æ•²å®šäº†ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†ç¬¬ä¸€ä¸ªæ•°ç»„<code>begin_node_v</code>çš„èŠ‚ç‚¹å–‚ç»™é“¾è¡¨é€†ç½®å‡½æ•°äº†ï¼Œè¯¥é€†ç½®å‡½æ•°çš„è¿”å›å€¼æ˜¯æ–°é“¾è¡¨çš„å¼€å¤´ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†æ¯ä¸ªåŒºé—´äº¤ä»˜ç»™é€’å½’å¼€å§‹é€†ç½®ï¼Œå¹¶å°†é€†ç½®çš„è¿”å›å€¼ä¸ä¸Šä¸€ä¸ªåŒºé—´çš„å¼€å¤´è¿èµ·æ¥</span></span><br><span class="line">cur = &amp;phead;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span>&amp; n:begin_node_v)&#123;</span><br><span class="line">    ListNode* ptr=<span class="built_in">reverseNode</span>(n);</span><br><span class="line">    cur-&gt;next = ptr;</span><br><span class="line">    cur = n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¯´ä¸€ä¸‹curæŒ‡é’ˆçš„ä½œç”¨ï¼Œä»¥ç”¨ä¾‹<code>&#123;1,2,3,4,5&#125;,2</code>ä¸ºæ —å­ï¼Œæ­¤æ—¶<code>begin_node_v</code>æ•°ç»„ä¸­å­˜æ”¾çš„æ˜¯<code>&#123;1,3,5&#125;</code></p><ul><li>åˆå§‹åŒ–ä¸ºphead</li><li>ç¬¬ä¸€æ¬¡å¾ªç¯ï¼ŒnæŒ‡å‘çš„æ˜¯1ï¼ŒcuræŒ‡å‘çš„æ˜¯pheadï¼›é€†ç½®ç»“æŸåï¼ŒptræŒ‡å‘çš„æ˜¯2ï¼Œåˆšå¥½å°±æ˜¯æ–°é“¾è¡¨çš„å¼€å¤´ï¼Œå°†curçš„nexté“¾æ¥ä¸ºå®ƒï¼Œå¹¶å°†curæ›´æ–°ä¸º1</li><li>ç¬¬äºŒæ¬¡å¾ªç¯ï¼ŒnæŒ‡å‘çš„æ˜¯3ï¼ŒcuræŒ‡å‘çš„æ˜¯1ï¼›é€†ç½®ç»“æŸåï¼ŒptræŒ‡å‘çš„æ˜¯4ï¼Œæ­¤æ—¶curçš„nextæŒ‡å‘å®ƒï¼Œå°±æ˜¯å°†1çš„nexté“¾æ¥ä¸º4ï¼Œå†æ¬¡æ›´æ–°curä¸º3ã€‚</li><li>ç¬¬ä¸‰æ¬¡å¾ªç¯ï¼ŒnæŒ‡å‘çš„æ˜¯5ï¼ŒcuræŒ‡å‘çš„æ˜¯3ï¼›é€†ç½®ç»“æŸåï¼Œå°†3çš„nexté“¾æ¥ä¸º5ï¼Œcuræ›´æ–°ä¸º5</li><li>å¾ªç¯ç»“æŸ</li></ul><p>ç»“æŸæ—¶ï¼Œè¿™ä¸ªé“¾è¡¨å°±å·²ç»å®Œå·¥äº†ï¼æˆ‘ä»¬åªéœ€è¦åˆ¤æ–­ä¸€ä¸‹è¿˜æ²¡æœ‰å‰©ä¸‹çš„æ²¡æœ‰é€†ç½®çš„èŠ‚ç‚¹ï¼Œå°†å…¶é“¾æ¥ç»™<code>begin_node_v</code>æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼ˆä¹Ÿæ˜¯é€†ç½®éƒ¨åˆ†çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼‰çš„nextå°±å¯ä»¥äº†</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦è¿˜æœ‰å‰©ä¸‹çš„èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">if</span>(last_link !=<span class="literal">nullptr</span>)&#123;</span><br><span class="line">    begin_node_v[begin_node_v.<span class="built_in">size</span>()<span class="number">-1</span>]-&gt;next = last_link;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3-å®Œæ•´ä»£ç "><a href="#3-å®Œæ•´ä»£ç " class="headerlink" title="3.å®Œæ•´ä»£ç "></a>3.å®Œæ•´ä»£ç </h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param head ListNodeç±»</span></span><br><span class="line"><span class="comment">     * @param k intæ•´å‹</span></span><br><span class="line"><span class="comment">     * @return ListNodeç±»</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// æ— å·®åˆ«é€†ç½®</span></span><br><span class="line">    <span class="function">ListNode* <span class="title">reverseNode</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">nullptr</span> || head-&gt;next == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ListNode* ans = <span class="built_in">reverseNode</span>(head-&gt;next);</span><br><span class="line">        head-&gt;next-&gt;next = head;</span><br><span class="line">        head-&gt;next = <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">cout_vector</span><span class="params">(std::vector&lt;ListNode*&gt;&amp; begin_node_v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; e : begin_node_v) &#123;</span><br><span class="line">            cout &lt;&lt; e-&gt;val &lt;&lt; <span class="string">&quot; &quot;</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">ListNode* <span class="title">reverseKGroup</span><span class="params">(ListNode* head, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ–è€…é€†ç½®åŒºé—´ä¸º1çš„éƒ½ä¸éœ€è¦æ“ä½œ</span></span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">nullptr</span> || head-&gt;next == <span class="literal">nullptr</span> || k &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¤´èŠ‚ç‚¹å’Œéå†æŒ‡é’ˆ</span></span><br><span class="line">        <span class="function">ListNode <span class="title">phead</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">        phead.next = head;</span><br><span class="line">        ListNode* cur = &amp;phead;</span><br><span class="line">        <span class="comment">// æŠŠæ¯kä¸ªèŠ‚ç‚¹å•ç‹¬å–å‡ºæ¥ï¼Œåˆ†åˆ«é€†ç½®åé“¾æ¥èµ·æ¥</span></span><br><span class="line">        std::vector&lt;ListNode*&gt; begin_node_v,begin_node_prev_v;</span><br><span class="line">        <span class="type">int</span> index = k<span class="number">-1</span>; <span class="comment">// åˆå§‹åŒ–ä¸ºk-1(å¿½ç•¥å¤´èŠ‚ç‚¹)ï¼ŒåŸæœ‰é“¾è¡¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å§‹ç»ˆå…¥æ ˆ</span></span><br><span class="line">        <span class="type">int</span> node_count = <span class="number">0</span>;<span class="comment">// èŠ‚ç‚¹æ€»æ•°ï¼ˆåŒ…å«å¤´èŠ‚ç‚¹ï¼‰</span></span><br><span class="line">        <span class="keyword">while</span> (cur != <span class="literal">nullptr</span>) &#123; <span class="comment">// ä¸çŸ¥é“æœ‰å¤šé•¿ï¼Œå¾—æ­»å¾ªç¯</span></span><br><span class="line">            <span class="keyword">if</span>(index+<span class="number">1</span> == k &amp;&amp; cur != &amp;phead)&#123;</span><br><span class="line">                begin_node_prev_v.<span class="built_in">push_back</span>(cur);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (index == k) &#123;</span><br><span class="line">                begin_node_v.<span class="built_in">push_back</span>(cur);</span><br><span class="line">                index = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            cur = cur-&gt;next;</span><br><span class="line">            index++;</span><br><span class="line">            node_count ++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// èµ°åˆ°è¿™é‡Œå·²ç»æŠŠæ¯ä¸ªéœ€è¦é€†ç½®çš„å¼€å¤´èŠ‚ç‚¹ç»™è®°å½•ä¸‹æ¥äº†</span></span><br><span class="line">        <span class="comment">// å¦‚æœèŠ‚ç‚¹æ€»æ•°é‡å°äºkåˆ™ä¸é€†ç½®ç›´æ¥è¿”å›</span></span><br><span class="line">        node_count --;<span class="comment">//å‡-1 å¤´èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span>(node_count &lt;k)&#123;</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ä¸æ˜¯æ•´æ•°å€ï¼Œä»£è¡¨æœ€åä¸€ä¸ªæ˜¯ä¸è¦å¤„ç†çš„</span></span><br><span class="line">        ListNode* last_link = <span class="literal">nullptr</span>; </span><br><span class="line">        <span class="keyword">if</span>((node_count %k) != <span class="number">0</span>) &#123;</span><br><span class="line">            last_link = begin_node_v[begin_node_v.<span class="built_in">size</span>()<span class="number">-1</span>];<span class="comment">// æœ€åä¸€ä¸ª</span></span><br><span class="line">            begin_node_v.<span class="built_in">pop_back</span>();<span class="comment">// åˆ é™¤æœ€åä¸€ä¸ª</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// cout_vector(begin_node_v);</span></span><br><span class="line">        <span class="comment">// cout_vector(begin_node_prev_v);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†æ¯ä¸ªåŒºé—´çš„æœ«å°¾èŠ‚ç‚¹çš„nexté“¾æ¥ä¸ºNullä½œä¸ºé€’å½’æ ‡è¯†</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp;n:begin_node_prev_v)&#123;</span><br><span class="line">            n-&gt;next = <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å°†æ¯ä¸ªåŒºé—´äº¤ä»˜ç»™é€’å½’å¼€å§‹é€†ç½®ï¼Œå¹¶å°†é€†ç½®çš„è¿”å›å€¼ä¸ä¸Šä¸€ä¸ªåŒºé—´çš„å¼€å¤´è¿èµ·æ¥</span></span><br><span class="line">        cur = &amp;phead;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; n:begin_node_v)&#123;</span><br><span class="line">            ListNode* ptr=<span class="built_in">reverseNode</span>(n);</span><br><span class="line">            cur-&gt;next = ptr;</span><br><span class="line">            cur = n;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦è¿˜æœ‰å‰©ä¸‹çš„èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span>(last_link !=<span class="literal">nullptr</span>)&#123;</span><br><span class="line">            begin_node_v[begin_node_v.<span class="built_in">size</span>()<span class="number">-1</span>]-&gt;next = last_link;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> phead.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>é€šè¿‡æˆªå›¾</p><p><img src="https://img.musnow.top/i/2023/08/591fcb7e890e13ec8638e0eb567790e9.png" alt="image-20230824142627806"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;BM3é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ¯kä¸ªä¸€ç»„ç¿»è½¬&lt;/p&gt;</summary>
    
    
    
    <category term="æŠŠé¢˜ç›®éƒ½ç»™åˆ·å¹²å‡€" scheme="https://blog.musnow.top/categories/%E6%8A%8A%E9%A2%98%E7%9B%AE%E9%83%BD%E7%BB%99%E5%88%B7%E5%B9%B2%E5%87%80/"/>
    
    
    <category term="C++" scheme="https://blog.musnow.top/tags/C/"/>
    
    <category term="OJåˆ·é¢˜" scheme="https://blog.musnow.top/tags/OJ%E5%88%B7%E9%A2%98/"/>
    
    <category term="ç‰›å®¢ç½‘" scheme="https://blog.musnow.top/tags/%E7%89%9B%E5%AE%A2%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>ã€C++ã€‘æ—©ç»‘å®šã€ææ„ä¸å¤šæ€ | ä¸€é“å…³äºå¤šæ€çš„é€‰æ‹©é¢˜è®°å½•</title>
    <link href="https://blog.musnow.top/posts/2254346194/"/>
    <id>https://blog.musnow.top/posts/2254346194/</id>
    <published>2023-08-22T13:14:28.000Z</published>
    <updated>2023-08-22T13:14:28.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©åœ¨å’Œç¾¤å‹èŠå¤©çš„æ—¶å€™çœ‹åˆ°äº†ä¸€é“å¾ˆå‘çš„é¢˜ç›®ï¼Œåˆ†äº«ç»™å¤§å®¶</p><span id="more"></span><h1 id="1-çœ‹é¢˜ï¼"><a href="#1-çœ‹é¢˜ï¼" class="headerlink" title="1.çœ‹é¢˜ï¼"></a>1.çœ‹é¢˜ï¼</h1><p>å…ˆæ¥çœ‹çœ‹é¢˜ç›®</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Dad</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Dad</span>()&#123; <span class="built_in">echo</span>();&#125;</span><br><span class="line">    ~<span class="built_in">Dad</span>()&#123; <span class="built_in">echo</span>();&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">echo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;DAD &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Son</span>:Dad</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">echo</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;SON &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Son ss;</span><br></pre></td></tr></table></figure><p>è¯·é—®è¿™ä¸ªçš„è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">A  &quot;DAD DAD &quot;</span><br><span class="line">B  &quot;DAD SON &quot;</span><br><span class="line">C  &quot;SON DAD &quot;</span><br><span class="line">D  &quot;SON SON &quot;</span><br><span class="line">E  ç¼–è¯‘å‡ºé”™</span><br><span class="line">F  è¿è¡Œå‡ºé”™</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆæ˜¯Eï¼Œç¼–è¯‘å‡ºé”™ï¼</p></blockquote><h1 id="2-æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹"><a href="#2-æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹" class="headerlink" title="2.æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹"></a>2.æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹</h1><h2 id="2-1-çŸ¥è¯†ç‚¹"><a href="#2-1-çŸ¥è¯†ç‚¹" class="headerlink" title="2.1 çŸ¥è¯†ç‚¹"></a>2.1 çŸ¥è¯†ç‚¹</h2><p>å…ˆæ¥è¯´è¯´è¿™é“é¢˜ç›®é‡Œé¢æ¶‰åŠåˆ°äº†ä»€ä¹ˆçŸ¥è¯†ç‚¹</p><ul><li>å¤šæ€è°ƒç”¨ï¼›</li><li>å¤šæ€é‡å†™å‡½æ•°éœ€è¦æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ï¼›</li><li>ç±»å†…å‡½æ•°ååŠ <code>const</code>çš„ä½œç”¨ï¼›</li><li>ç±»å†…å‡½æ•°ååŠ <code>override</code>çš„ä½œç”¨ï¼›</li><li>ä»€ä¹ˆæ˜¯æ—©ç»‘å®šå’Œæ™šç»‘å®š</li></ul><p>ä¸€ä¸ªä¸€ä¸ªå¤ä¹ å§ï¼</p><ul><li>å¤šæ€è°ƒç”¨æ˜¯çˆ¶ç±»æŒ‡é’ˆ&#x2F;å¼•ç”¨æŒ‡å‘å­ç±»æ—¶ï¼Œè°ƒç”¨è™šå‡½æ•°ä¼šè°ƒç”¨å­ç±»é‡å†™åçš„ç‰ˆæœ¬</li><li>å¤šæ€é‡å†™å‡½æ•°çš„æ¡ä»¶ï¼šå‡½æ•°å&#x2F;å‚æ•°&#x2F;è¿”å›å€¼éƒ½å¿…é¡»ç›¸åŒï¼ˆæ³¨æ„è¿˜æœ‰åå˜ï¼‰</li><li>ç±»å†…å‡½æ•°ååŠ <code>const</code>ä¿®é¥°çš„æ˜¯è¿™ä¸ªå¯¹è±¡çš„<code>this</code>æŒ‡é’ˆï¼Œè¢«ä¿®é¥°çš„å‡½æ•°ä¸­æ— æ³•ä¿®æ”¹ç±»å†…æˆå‘˜å˜é‡</li><li>ç±»å†…å‡½æ•°ååŠ <code>override</code>æ˜¯è®©ç¼–è¯‘å™¨æ¥ä¸¥æ ¼æ£€æŸ¥æ˜¯å¦æ„æˆé‡è½½</li><li>æ—©ç»‘å®šï¼šé™æ€ç»‘å®šï¼›æ™šç»‘å®šï¼šåŠ¨æ€ç»‘å®šï¼ˆå…·ä½“è¯·çœ‹<a href="https://blog.musnow.top/posts/3933786088/">CPPå¤šæ€</a>çš„åšå®¢ï¼‰</li></ul><h2 id="2-2-åˆ†æé¢˜ç›®"><a href="#2-2-åˆ†æé¢˜ç›®" class="headerlink" title="2.2 åˆ†æé¢˜ç›®"></a>2.2 åˆ†æé¢˜ç›®</h2><p>æ³¨æ„çœ‹çˆ¶ç±»å’Œå­ç±»ä¸­è¿™ä¸¤ä¸ª<code>echo()</code>å‡½æ•°çš„åŒºåˆ«</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">echo</span><span class="params">()</span></span>&#123;&#125;<span class="comment">//çˆ¶ç±»</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">echo</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;&#125;<span class="comment">//å­ç±»</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œå­ç±»å‡½æ•°ä¸­<code>virtual</code>å…³é”®å­—æ˜¯å¯ä»¥çœç•¥çš„ï¼Œä½†å³ä¾¿çœç•¥äº†ï¼Œè¿™ä¸ªå‡½æ•°ä¾æ—§æ˜¯ä¸ªè™šå‡½æ•°ã€‚</p><p>è¿™é‡Œå­ç±»çš„å‡½æ•°ä¸­å¤šäº†<code>const</code>ä¿®é¥°ï¼Œè€Œè¿™ä¸ªconstä¿®é¥°çš„å°±æ˜¯å‡½æ•°ä¸­éšå«çš„<code>this</code>æŒ‡é’ˆï¼Œæ­¤æ—¶å­ç±»ä¸­<code>echo()</code>å‡½æ•°çš„å‚æ•°å°±å‘ç”Ÿäº†å˜åŒ–ï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">echo</span><span class="params">(Son* <span class="keyword">this</span>)</span> </span>&#123; &#125; <span class="comment">// ä¸åŠ const</span></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">echo</span><span class="params">(<span class="type">const</span> Son* <span class="keyword">this</span>)</span> </span>&#123; &#125; <span class="comment">// åŠ const</span></span><br></pre></td></tr></table></figure><p>æ­£æ˜¯å› ä¸ºè¿™é‡Œçš„thisæŒ‡é’ˆå‡ºç°äº†constçš„ä¿®é¥°ï¼Œæ‰€ä»¥å­ç±»çš„echoå’Œçˆ¶ç±»echoçš„å‚æ•°ç±»å‹ä¸åŒï¼Œä¸æ„æˆè™šå‡½æ•°é‡å†™ï¼å†åŠ ä¸Š<code>override</code>å…³é”®å­—çš„ä¸¥æ ¼æ£€æŸ¥ï¼Œä¼šç›´æ¥ç¼–è¯‘æŠ¥é”™ï¼</p><p>æ­£ç¡®çš„å†™æ³•æ˜¯åˆ é™¤å­ç±»echoä¸­çš„constæˆ–è€…ç»™çˆ¶ç±»echoå‡½æ•°åŠ ä¸Šconst</p><h1 id="3-å†æ¥çœ‹é¢˜"><a href="#3-å†æ¥çœ‹é¢˜" class="headerlink" title="3.å†æ¥çœ‹é¢˜"></a>3.å†æ¥çœ‹é¢˜</h1><p>å¥½äº†ï¼Œå‘äººçš„ç‚¹çœ‹å®Œäº†ï¼Œå†æ¥çœ‹ä¸ªã€Œå¸¸è§„ã€çš„ï¼Œå°±æ˜¯æŠŠä¸Šé¢çš„é¢˜å¹²æ”¹æˆèƒ½ç¼–è¯‘é€šè¿‡çš„ã€‚æ­¤æ—¶åˆåº”è¯¥é€‰è°å‘¢ï¼Ÿ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Dad</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Dad</span>()&#123; <span class="built_in">echo</span>();&#125;</span><br><span class="line">    ~<span class="built_in">Dad</span>()&#123; <span class="built_in">echo</span>();&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">echo</span><span class="params">()</span> <span class="type">const</span></span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;DAD &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Son</span>:Dad</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">echo</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;SON &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Son ss;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">A  &quot;DAD DAD &quot;</span><br><span class="line">B  &quot;DAD SON &quot;</span><br><span class="line">C  &quot;SON DAD &quot;</span><br><span class="line">D  &quot;SON SON &quot;</span><br></pre></td></tr></table></figure><p><img src="https://img.musnow.top/i/2023/08/e278c7b0a62e7383e4151067de284350.png" alt="image-20230822211806379"></p><p>ç¼–è¯‘è¿è¡Œï¼Œå¯ä»¥çœ‹åˆ°ï¼Œç»“æœæ˜¯<code>DAD DAD</code>ï¼Œåº”è¯¥é€‰A</p><h2 id="3-1-åˆ†æ"><a href="#3-1-åˆ†æ" class="headerlink" title="3.1 åˆ†æ"></a>3.1 åˆ†æ</h2><p>åœ¨ç»™ <code>Son</code> ç±»å®šä¹‰æ„é€ å‡½æ•°å’Œææ„å‡½æ•°æ—¶ï¼Œæ²¡æœ‰æŒ‡å®šè°ƒç”¨çˆ¶ç±»çš„å¯¹åº”æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ã€‚å› æ­¤ï¼Œåœ¨åˆ›å»º <code>Son</code> å¯¹è±¡ <code>ss</code> æ—¶ï¼Œä¼šé»˜è®¤è°ƒç”¨ <code>Dad</code> ç±»çš„æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ã€‚</p><p>ç”±äº <code>Dad</code> ç±»ä¸­çš„æ„é€ å‡½æ•°å’Œææ„å‡½æ•°è°ƒç”¨äº†è™šå‡½æ•° <code>echo()</code>ï¼Œè€Œè¿™ä¸ªè™šå‡½æ•°åœ¨å­ç±» <code>Son</code> ä¸­è¢«é‡å†™ï¼Œæ‰€ä»¥ä¼šæ ¹æ®å¯¹è±¡ç±»å‹è°ƒç”¨ç›¸åº”çš„é‡å†™å‡½æ•°ã€‚ç„¶è€Œï¼Œåœ¨æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ä¸­ï¼Œè™šå‡½æ•°æœºåˆ¶ä¸ä¼šæŒ‰ç…§é¢„æœŸå·¥ä½œã€‚</p><p>æ„é€ å‡½æ•°ä¸­è°ƒç”¨è™šå‡½æ•°æ—¶ï¼Œä¼šå¿½ç•¥åŠ¨æ€ç»‘å®šæœºåˆ¶ï¼Œç›´æ¥è°ƒç”¨çˆ¶ç±»çš„å‡½æ•°ç‰ˆæœ¬ã€‚å› æ­¤ï¼Œåœ¨ <code>Dad</code> çš„æ„é€ å‡½æ•°ä¸­è°ƒç”¨ <code>echo()</code>ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯ <code>Dad</code> ç±»ä¸­çš„ <code>echo()</code> å‡½æ•°ï¼Œè€Œä¸æ˜¯ <code>Son</code> ç±»ä¸­çš„é‡å†™ç‰ˆæœ¬ã€‚</p><p>åŒæ ·åœ°ï¼Œææ„å‡½æ•°ä¸­ä¹Ÿä¼šå¿½ç•¥åŠ¨æ€ç»‘å®šæœºåˆ¶ï¼Œç›´æ¥è°ƒç”¨çˆ¶ç±»çš„å‡½æ•°ç‰ˆæœ¬ã€‚æ‰€ä»¥ï¼Œåœ¨ <code>Dad</code> çš„ææ„å‡½æ•°ä¸­è°ƒç”¨ <code>echo()</code>ï¼Œä¾ç„¶è°ƒç”¨çš„æ˜¯ <code>Dad</code> ç±»ä¸­çš„ <code>echo()</code> å‡½æ•°ã€‚</p><p>å› æ­¤ï¼Œå½“åˆ›å»º <code>Son</code> å¯¹è±¡ <code>ss</code> å¹¶æ‰“å°è¾“å‡ºæ—¶ï¼Œä¼šå…ˆè°ƒç”¨ <code>Dad</code> ç±»çš„æ„é€ å‡½æ•°å¹¶æ‰“å° <code>&quot;DAD &quot;</code>ï¼Œç„¶åè°ƒç”¨ <code>Dad</code> ç±»çš„ææ„å‡½æ•°å¹¶å†æ¬¡æ‰“å° <code>&quot;DAD &quot;</code>ã€‚</p><h2 id="3-2-ç»“è®º"><a href="#3-2-ç»“è®º" class="headerlink" title="3.2 ç»“è®º"></a>3.2 ç»“è®º</h2><p>åœ¨çˆ¶ç±»çš„æ„é€ å’Œææ„ä¸­ï¼Œå¯¹è±¡çš„ç‰ˆæœ¬éƒ½è¢«ç¡®å®šä¸ºçˆ¶ç±»çš„ç‰ˆæœ¬ï¼Œä¼šé‡‡ç”¨<strong>æ—©ç»‘å®š</strong>æ¥è°ƒç”¨çˆ¶ç±»è‡ªå·±çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯å­ç±»çš„é‡å†™åçš„å‡½æ•°ï¼›</p><p>ç®€å•è®°å¿†ï¼šçˆ¶ç±»çš„æ„é€ å’Œææ„ä¸­å¦‚æœå‡ºç°è™šå‡½æ•°ï¼Œåªä¼šè°ƒç”¨çˆ¶ç±»è‡ªå·±çš„å‡½æ•°ï¼</p><hr><p>è¿™æ˜¯å› ä¸ºç¼–è¯‘å™¨éœ€è¦ä¿è¯æ­£ç¡®çš„æ„é€ å’Œææ„é¡ºåºï¼Œ<strong>å¦‚æœçˆ¶ç±»ææ„é‡Œè°ƒç”¨å­ç±»çš„è™šå‡½æ•°</strong>ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸‹é¢çš„åœºæ™¯</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Dad</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Dad</span>()&#123; <span class="built_in">echo</span>();&#125;</span><br><span class="line">    ~<span class="built_in">Dad</span>()&#123; <span class="built_in">echo</span>();&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">echo</span><span class="params">()</span> <span class="type">const</span></span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;DAD &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Son</span>:Dad</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Son</span>() &#123;</span><br><span class="line">        _a = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">Son</span>() &#123;</span><br><span class="line">        <span class="keyword">delete</span> _a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">echo</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;SON &quot;</span>;</span><br><span class="line">        <span class="keyword">delete</span> _a;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _a;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Son ss;</span><br></pre></td></tr></table></figure><p>å¦‚æœçˆ¶ç±»ä¸­çš„ææ„<code>echo()</code>è°ƒç”¨å­ç±»é‡å†™çš„å‡½æ•°ï¼Œæ­¤æ—¶å°±ä¼šå‡ºç°å­ç±»å·²ç»è¢«é”€æ¯ï¼ˆå­ç±»çš„ææ„å‡½æ•°æ—©äºçˆ¶ç±»ææ„è°ƒç”¨ï¼‰çš„<code>_a</code>è¢«äºŒæ¬¡<code>delete</code>ï¼Œä¸¤æ¬¡<code>delete</code>åŒä¸€ç‰‡ç©ºé—´æ˜¯ä¼šæŠ¥é”™çš„ï¼</p><p>æ‰€ä»¥ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œçˆ¶ç±»çš„ææ„ä¸­é‡‡ç”¨æ—©ç»‘å®šï¼Œå­ç±»é‡å†™çš„è™šå‡½æ•°ä¸ä¼šç”Ÿæ•ˆï¼</p><p>è¿™ç§è¡Œä¸ºæ˜¯ä¸ºäº†ç¡®ä¿åœ¨å¯¹è±¡çš„æ„é€ å’Œææ„è¿‡ç¨‹ä¸­ï¼Œ<strong>æŒ‰ç…§æ­£ç¡®çš„é¡ºåºè°ƒç”¨å„ä¸ªç±»çš„æ„é€ å’Œææ„å‡½æ•°</strong>ï¼Œé¿å…åœ¨å¯¹è±¡å¤„äºæœªå®Œå…¨åˆå§‹åŒ–æˆ–å·²éƒ¨åˆ†é”€æ¯çŠ¶æ€æ—¶è°ƒç”¨å­ç±»çš„å‡½æ•°ã€‚</p><blockquote><p>åŒ…æ‹¬çˆ¶ç±»çš„æ„é€ ä¹Ÿå¯ä»¥è¿™ä¹ˆç†è§£ï¼Œå¦‚æœçˆ¶ç±»æ„é€ é‡Œé¢å¯ä»¥è°ƒç”¨å­ç±»çš„è™šå‡½æ•°ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸¤æ¬¡å¯¹ä¸€ä¸ªå­ç±»å¯¹è±¡è¿›è¡Œnewç©ºé—´ï¼Œä¼šäº§ç”Ÿå†…å­˜æ³„éœ²ï¼›</p><p>ä½†æ„é€ å‡½æ•°è¿˜å’Œè™šå‡½æ•°è¡¨çš„åˆå§‹åŒ–æœ‰å…³ç³»ï¼Œæ­¤æ—¶è™šå‡½æ•°è¡¨è¿˜æ²¡æœ‰å®Œå…¨åˆå§‹åŒ–ï¼Œ<strong>å­ç±»å¯¹è±¡å°šæœªæ„é€ å®Œæˆ</strong>ï¼Œæ²¡æœ‰å¤šæ€è°ƒç”¨çš„æ¡ä»¶ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½è°ƒç”¨åˆ°å­ç±»é‡å†™åçš„è™šå‡½æ•°ã€‚</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä»Šå¤©åœ¨å’Œç¾¤å‹èŠå¤©çš„æ—¶å€™çœ‹åˆ°äº†ä¸€é“å¾ˆå‘çš„é¢˜ç›®ï¼Œåˆ†äº«ç»™å¤§å®¶&lt;/p&gt;</summary>
    
    
    
    <category term="æŠŠé¢˜ç›®éƒ½ç»™åˆ·å¹²å‡€" scheme="https://blog.musnow.top/categories/%E6%8A%8A%E9%A2%98%E7%9B%AE%E9%83%BD%E7%BB%99%E5%88%B7%E5%B9%B2%E5%87%80/"/>
    
    
    <category term="C++" scheme="https://blog.musnow.top/tags/C/"/>
    
    <category term="OJåˆ·é¢˜" scheme="https://blog.musnow.top/tags/OJ%E5%88%B7%E9%A2%98/"/>
    
  </entry>
  
</feed>
