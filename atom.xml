<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æ…•é›ªçš„å¯’èˆ</title>
  
  <subtitle>é›ªä¸‹äº†ä¸€å¤œ</subtitle>
  <link href="https://blog.musnow.top/atom.xml" rel="self"/>
  
  <link href="https://blog.musnow.top/"/>
  <updated>2024-03-09T01:53:30.000Z</updated>
  <id>https://blog.musnow.top/</id>
  
  <author>
    <name>æ…•é›ªå¹´å</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ã€é¢è¯•ã€‘C++ä¸‰ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°1åˆ°100</title>
    <link href="https://blog.musnow.top/posts/235113945/"/>
    <id>https://blog.musnow.top/posts/235113945/</id>
    <published>2024-03-09T01:31:10.000Z</published>
    <updated>2024-03-09T01:53:30.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ˜¨å¤©é¢äº†ä¸ªå¤§å‚ï¼Œè‡ªå·±å¤ªå‚»é€¼äº†ï¼Œ<strong>è¿™ä¹ˆç®€å•çš„ä¸€é“é¢˜ç›®æ²¡å†™å‡ºæ¥</strong>ã€‚å› ä¸ºæˆ‘ä¸å¤ªç†Ÿæ‚‰æ¡ä»¶å˜é‡ï¼Œæ‹–äº†å¾ˆé•¿æ—¶é—´ï¼Œé¢è¯•å®˜ä¼°è®¡æœ‰ç‚¹å¤±æœ›ï¼Œåç»­çš„å…«è‚¡ä¹Ÿæ²¡é—®ä»€ä¹ˆï¼Œæ„æ–™ä¹‹ä¸­çš„æŒ‚äº†ğŸ˜­ã€‚</p><p>è¿˜æœ‰ä¸ªé¢˜ç›®æ˜¯LRUï¼Œè¿™ä¸ªå€’æ˜¯ä¸´æ—¶æŠ±ä½›è„šå¤ä¹ åˆ°äº†ï¼Œå†™å‡ºæ¥äº†ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/03/7421b5d3ff29ccbb72dfb3efd12d70fd.png"></p><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>é—®é¢˜ï¼šçº¿ç¨‹1æ‰“å°1ï¼Œçº¿ç¨‹2æ‰“å°2ï¼Œçº¿ç¨‹3æ‰“å°3ï¼Œçº¿ç¨‹1æ‰“å°4ï¼Œçº¿ç¨‹2æ‰“å°5ï¼Œçº¿ç¨‹3æ‰“å°6â€¦â€¦ä¸€ç›´æ‰“å°åˆ°100ã€‚</p><p>å…¶å®ä¸€ç‚¹éƒ½ä¸éš¾ï¼Œå°±æ˜¯æˆ‘è‡ªå·±å¹³æ—¶å‹æ ¹æ²¡åšè¿‡å¤šå°‘çº¿ç¨‹åŒæ­¥çš„ç»ƒä¹ ï¼Œå¯¹äºæ¡ä»¶å˜é‡ä¹‹ç±»çš„ç©æ„åŸºæœ¬åœç•™åœ¨ç†è®ºå’Œå­¦ä¹ æ—¶çš„ç®€å•demoå±‚é¢ï¼Œä¸€ä¸Šæˆ˜åœºåŠ ä¸Šç´§å¼ å°±æ¯›éƒ½ä¸ä¼šäº†ã€‚</p><h2 id="æ€è·¯1-ç›´æ¥ç”¨çº¿ç¨‹åºå·åšåˆ¤æ–­"><a href="#æ€è·¯1-ç›´æ¥ç”¨çº¿ç¨‹åºå·åšåˆ¤æ–­" class="headerlink" title="æ€è·¯1-ç›´æ¥ç”¨çº¿ç¨‹åºå·åšåˆ¤æ–­"></a>æ€è·¯1-ç›´æ¥ç”¨çº¿ç¨‹åºå·åšåˆ¤æ–­</h2><p>æœ€ç®€å•çš„ä¸€ä¸ªæ€è·¯ï¼Œå› ä¸ºåªæœ‰ä¸‰ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰“å°çš„æ•°å­—æ˜¯æœ‰è§„å¾‹çš„</p><ul><li>çº¿ç¨‹ä¸€æ‰“å°çš„æ•°å­—%3éƒ½ç­‰äº1</li><li>çº¿ç¨‹äºŒæ‰“å°çš„æ•°å­—%3éƒ½ç­‰äº2</li><li>çº¿ç¨‹ä¸‰æ‰“å°çš„æ•°å­—%3éƒ½ç­‰äº0</li></ul><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥å†™ä¸€ä¸ªå‡½æ•°ï¼Œæä¾›ä¸€ä¸ªçº¿ç¨‹ç¼–å·ï¼Œé€šè¿‡è®¡ç®—åˆ¤æ–­å½“å‰æ˜¯å¦æ˜¯è‡ªå·±éœ€è¦æ‰“å°çš„æ•°å­—ï¼Œä¸æ˜¯å°±ç¡è§‰ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯æœ€ç®€å•çš„ï¼Œåªéœ€è¦ä¸€ä¸ªå…¨å±€å˜é‡åŠ ä¸€ä¸ªé”å°±èƒ½å®ç°ã€‚</p><p>ä¸¤ä¸ªatomicå˜é‡ï¼Œä¸€ä¸ªç”¨äºä¸»çº¿ç¨‹é€šçŸ¥æ‰€æœ‰çº¿ç¨‹å½“å‰å·²ç»åˆå§‹åŒ–å®Œæ¯•ï¼Œå¦å¤–ä¸€ä¸ªç”¨äºçº¿ç¨‹é€šçŸ¥ä¸»çº¿ç¨‹å½“å‰å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atomic&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// çº¿ç¨‹1æ‰“å°1ï¼Œçº¿ç¨‹2æ‰“å°2ï¼Œçº¿ç¨‹3æ‰“å°3ï¼Œçº¿ç¨‹1æ‰“å°4ï¼Œçº¿ç¨‹2æ‰“å°5.... æ‰“å°åˆ°100</span></span><br><span class="line">std::atomic&lt;<span class="type">bool</span>&gt; isRun = <span class="literal">false</span>;</span><br><span class="line">std::atomic&lt;<span class="type">bool</span>&gt; isFinished = <span class="literal">false</span>;</span><br><span class="line">std::mutex gMtx;</span><br><span class="line"><span class="type">int</span> count = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PrintCountFun</span><span class="params">(<span class="type">int</span> no)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(!isRun)</span><br><span class="line">    &#123;</span><br><span class="line">        std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">microseconds</span>(<span class="number">10</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(!isFinished)</span><br><span class="line">    &#123;</span><br><span class="line">        gMtx.<span class="built_in">lock</span>();</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">100</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            isFinished = <span class="literal">true</span>;</span><br><span class="line">            gMtx.<span class="built_in">unlock</span>();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 1å·2å·çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">if</span>(no!=<span class="number">3</span> &amp;&amp; count % <span class="number">3</span> == no)</span><br><span class="line">        &#123;</span><br><span class="line">            std::cout &lt;&lt; no &lt;&lt; <span class="string">&quot; - &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; - c: &quot;</span> &lt;&lt; count &lt;&lt; std::endl;</span><br><span class="line">            count ++;</span><br><span class="line">            gMtx.<span class="built_in">unlock</span>();</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3å·çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">if</span>(no == <span class="number">3</span> &amp;&amp; count % <span class="number">3</span> == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            std::cout &lt;&lt; no &lt;&lt; <span class="string">&quot; - &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; - c: &quot;</span> &lt;&lt; count &lt;&lt; std::endl;</span><br><span class="line">            count ++;</span><br><span class="line">            gMtx.<span class="built_in">unlock</span>();</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        gMtx.<span class="built_in">unlock</span>();</span><br><span class="line">        std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">microseconds</span>(<span class="number">10</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">std::thread <span class="title">t1</span><span class="params">(PrintCountFun,<span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="function">std::thread <span class="title">t2</span><span class="params">(PrintCountFun,<span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="function">std::thread <span class="title">t3</span><span class="params">(PrintCountFun,<span class="number">3</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    t1.<span class="built_in">detach</span>();</span><br><span class="line">    t2.<span class="built_in">detach</span>();</span><br><span class="line">    t3.<span class="built_in">detach</span>();</span><br><span class="line"></span><br><span class="line">    isRun = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">while</span>(!isFinished)</span><br><span class="line">    &#123;</span><br><span class="line">        std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">microseconds</span>(<span class="number">100</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;finished\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><details><summary>æ–¹æ³•1ä»£ç è¿è¡Œç»“æœ</summary><p>åæ­£æ˜¯é€šè¿‡ç¼–å·åˆ¤æ–­çš„ï¼Œè‚¯å®šä¸ä¼šé”™ï¼Œåªä¸è¿‡è¿™æ ·æ•ˆç‡å…¶å®å¾ˆä½ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">1 - 140173660395072 - c: 1</span><br><span class="line">2 - 140173652002368 - c: 2</span><br><span class="line">3 - 140173643609664 - c: 3</span><br><span class="line">1 - 140173660395072 - c: 4</span><br><span class="line">2 - 140173652002368 - c: 5</span><br><span class="line">3 - 140173643609664 - c: 6</span><br><span class="line">1 - 140173660395072 - c: 7</span><br><span class="line">2 - 140173652002368 - c: 8</span><br><span class="line">3 - 140173643609664 - c: 9</span><br><span class="line">1 - 140173660395072 - c: 10</span><br><span class="line">2 - 140173652002368 - c: 11</span><br><span class="line">3 - 140173643609664 - c: 12</span><br><span class="line">1 - 140173660395072 - c: 13</span><br><span class="line">2 - 140173652002368 - c: 14</span><br><span class="line">3 - 140173643609664 - c: 15</span><br><span class="line">1 - 140173660395072 - c: 16</span><br><span class="line">2 - 140173652002368 - c: 17</span><br><span class="line">3 - 140173643609664 - c: 18</span><br><span class="line">1 - 140173660395072 - c: 19</span><br><span class="line">2 - 140173652002368 - c: 20</span><br><span class="line">3 - 140173643609664 - c: 21</span><br><span class="line">1 - 140173660395072 - c: 22</span><br><span class="line">2 - 140173652002368 - c: 23</span><br><span class="line">3 - 140173643609664 - c: 24</span><br><span class="line">1 - 140173660395072 - c: 25</span><br><span class="line">2 - 140173652002368 - c: 26</span><br><span class="line">3 - 140173643609664 - c: 27</span><br><span class="line">1 - 140173660395072 - c: 28</span><br><span class="line">2 - 140173652002368 - c: 29</span><br><span class="line">3 - 140173643609664 - c: 30</span><br><span class="line">1 - 140173660395072 - c: 31</span><br><span class="line">2 - 140173652002368 - c: 32</span><br><span class="line">3 - 140173643609664 - c: 33</span><br><span class="line">1 - 140173660395072 - c: 34</span><br><span class="line">2 - 140173652002368 - c: 35</span><br><span class="line">3 - 140173643609664 - c: 36</span><br><span class="line">1 - 140173660395072 - c: 37</span><br><span class="line">2 - 140173652002368 - c: 38</span><br><span class="line">3 - 140173643609664 - c: 39</span><br><span class="line">1 - 140173660395072 - c: 40</span><br><span class="line">2 - 140173652002368 - c: 41</span><br><span class="line">3 - 140173643609664 - c: 42</span><br><span class="line">1 - 140173660395072 - c: 43</span><br><span class="line">2 - 140173652002368 - c: 44</span><br><span class="line">3 - 140173643609664 - c: 45</span><br><span class="line">1 - 140173660395072 - c: 46</span><br><span class="line">2 - 140173652002368 - c: 47</span><br><span class="line">3 - 140173643609664 - c: 48</span><br><span class="line">1 - 140173660395072 - c: 49</span><br><span class="line">2 - 140173652002368 - c: 50</span><br><span class="line">3 - 140173643609664 - c: 51</span><br><span class="line">1 - 140173660395072 - c: 52</span><br><span class="line">2 - 140173652002368 - c: 53</span><br><span class="line">3 - 140173643609664 - c: 54</span><br><span class="line">1 - 140173660395072 - c: 55</span><br><span class="line">2 - 140173652002368 - c: 56</span><br><span class="line">3 - 140173643609664 - c: 57</span><br><span class="line">1 - 140173660395072 - c: 58</span><br><span class="line">2 - 140173652002368 - c: 59</span><br><span class="line">3 - 140173643609664 - c: 60</span><br><span class="line">1 - 140173660395072 - c: 61</span><br><span class="line">2 - 140173652002368 - c: 62</span><br><span class="line">3 - 140173643609664 - c: 63</span><br><span class="line">1 - 140173660395072 - c: 64</span><br><span class="line">2 - 140173652002368 - c: 65</span><br><span class="line">3 - 140173643609664 - c: 66</span><br><span class="line">1 - 140173660395072 - c: 67</span><br><span class="line">2 - 140173652002368 - c: 68</span><br><span class="line">3 - 140173643609664 - c: 69</span><br><span class="line">1 - 140173660395072 - c: 70</span><br><span class="line">2 - 140173652002368 - c: 71</span><br><span class="line">3 - 140173643609664 - c: 72</span><br><span class="line">1 - 140173660395072 - c: 73</span><br><span class="line">2 - 140173652002368 - c: 74</span><br><span class="line">3 - 140173643609664 - c: 75</span><br><span class="line">1 - 140173660395072 - c: 76</span><br><span class="line">2 - 140173652002368 - c: 77</span><br><span class="line">3 - 140173643609664 - c: 78</span><br><span class="line">1 - 140173660395072 - c: 79</span><br><span class="line">2 - 140173652002368 - c: 80</span><br><span class="line">3 - 140173643609664 - c: 81</span><br><span class="line">1 - 140173660395072 - c: 82</span><br><span class="line">2 - 140173652002368 - c: 83</span><br><span class="line">3 - 140173643609664 - c: 84</span><br><span class="line">1 - 140173660395072 - c: 85</span><br><span class="line">2 - 140173652002368 - c: 86</span><br><span class="line">3 - 140173643609664 - c: 87</span><br><span class="line">1 - 140173660395072 - c: 88</span><br><span class="line">2 - 140173652002368 - c: 89</span><br><span class="line">3 - 140173643609664 - c: 90</span><br><span class="line">1 - 140173660395072 - c: 91</span><br><span class="line">2 - 140173652002368 - c: 92</span><br><span class="line">3 - 140173643609664 - c: 93</span><br><span class="line">1 - 140173660395072 - c: 94</span><br><span class="line">2 - 140173652002368 - c: 95</span><br><span class="line">3 - 140173643609664 - c: 96</span><br><span class="line">1 - 140173660395072 - c: 97</span><br><span class="line">2 - 140173652002368 - c: 98</span><br><span class="line">3 - 140173643609664 - c: 99</span><br><span class="line">1 - 140173660395072 - c: 100</span><br><span class="line">finished</span><br></pre></td></tr></table></figure></details><p>æˆ‘åˆšå¼€å§‹çš„æ—¶å€™å°±æ˜¯æƒ³ç€ç”¨æ¡ä»¶å˜é‡ï¼Œæ¯”å¦‚ä¸‰ä¸ªæ¡ä»¶å˜é‡åˆ†åˆ«ç”¨äºé€šçŸ¥â€¦â€¦ä½†è¿™ä¸ªå®åœ¨æ˜¯å¤æ‚ä¸”æ²¡æœ‰å¿…è¦ï¼Œæ²¡åšè¿‡æ¡ä»¶å˜é‡ç»ƒä¹ ä¸€æ—¶åŠä¼šå®Œå…¨æ˜¯å†™ä¸å‡ºæ¥çš„ã€‚åæ¥å°±æ¢äº†è¿™ä¸ªæ€è·¯ï¼Œä½†æ—¶é—´å·²ç»æ¥ä¸åŠäº†ã€‚</p><p>è¯´æ¥æƒ­æ„§ï¼Œæˆ‘å†™å®Œä¸Šé¢ä»£ç çš„åŸºæœ¬æ¡†æ¶åç¼–è¯‘é”™è¯¯ï¼Œæ˜¾ç¤º<code>atomic&lt;bool&gt;</code>åˆå§‹åŒ–å¤±è´¥ï¼Œæˆ‘æ‰¾äº†å¥½ä¹…éƒ½æ²¡æœ‰å‘ç°æ˜¯è‡ªå·±<strong>æ²¡æœ‰å¼•ç”¨</strong><code>&lt;atomic&gt;</code>è¿™ä¸ªå¤´æ–‡ä»¶å¯¼è‡´çš„ï¼Œä¸€ç›´åœ¨çœ‹è‡ªå·±çš„è¯­æ³•æ˜¯ä¸æ˜¯å†™é”™äº†â€¦â€¦</p><p>è¿˜æ˜¯è‡ªå·±ç»ƒä¹ ä¸å¤Ÿï¼Œä¸ç„¶ä¹Ÿä¸ä¼šæ€€ç–‘è‡ªå·±è¯­æ³•æ˜¯å¦å†™é”™ğŸ˜£</p><h1 id="æ€è·¯2-æ¡ä»¶å˜é‡"><a href="#æ€è·¯2-æ¡ä»¶å˜é‡" class="headerlink" title="æ€è·¯2-æ¡ä»¶å˜é‡"></a>æ€è·¯2-æ¡ä»¶å˜é‡</h1><p>ä¸Šè¿°çš„è¿™ä¸ªå•é”åŠ éå†çš„æ€è·¯å…¶å®å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„ç­”æ¡ˆï¼ˆ<strong>ä½†æ€»æ¯”æ²¡å†™å‡ºæ¥çš„å¥½</strong>ï¼‰ï¼Œå› ä¸ºå®ƒå®Œå…¨æ²¡æœ‰æ¶‰åŠåˆ°çº¿ç¨‹åŒæ­¥çš„æœºåˆ¶ï¼Œ<strong>ä¸‰ä¸ªçº¿ç¨‹å…¶å®æ¯«æ— å…³ç³»</strong>ï¼Œåªæ˜¯åœ¨é€šè¿‡é”ç«äº‰å’Œåˆ¤æ–­æ¥ç¡®å®šè‡ªå·±æ˜¯å¦éœ€è¦æ‰“å°ã€‚é¢è¯•å®˜æƒ³è¦çš„ç­”æ¡ˆè‚¯å®šå¾—åŒ…å«æ¡ä»¶å˜é‡ã€‚</p><p>ä¸‹é¢è¿™ä¸ªè§£å†³æ–¹æ¡ˆçš„æ€è·¯åŒæ ·æ˜¯é€šè¿‡çº¿ç¨‹ç¼–å·åˆ¤æ–­ï¼ˆåªä¸è¿‡æ‹†åˆ†æˆäº†ä¸‰ä¸ªä¸åŒçš„å‡½æ•°ï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰“å°å®Œæ¯•è‡ªå·±çš„ï¼Œå°±æŠŠå¦å¤–ä¸¤ä¸ªçº¿ç¨‹å”¤é†’ï¼Œç„¶åè¢«å”¤é†’çš„ä¸¤ä¸ªçº¿ç¨‹ä¼šé€šè¿‡é”ç«äº‰å…ˆåè¿›å…¥è‡ªå·±çš„å‡½æ•°æ‰“å°åŒºåŸŸï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯è‡ªå·±éœ€è¦æ‰“å°çš„éƒ¨åˆ†ï¼Œå¦‚æœä¸æ˜¯å°±ç»§ç»­åœ¨æ¡ä»¶å˜é‡é‡Œé¢ç­‰å¾…ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;condition_variable&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::mutex gMtx;</span><br><span class="line">std::condition_variable cv;</span><br><span class="line"><span class="type">int</span> count = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lc</span><span class="params">(gMtx)</span></span>;</span><br><span class="line"><span class="keyword">while</span>(count &lt;= <span class="number">100</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span> (count % <span class="number">3</span> == <span class="number">0</span> &amp;&amp; count &lt;= <span class="number">100</span>)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; - c: &quot;</span> &lt;&lt; count &lt;&lt; std::endl;</span><br><span class="line">count++;</span><br><span class="line">cv.<span class="built_in">notify_all</span>();</span><br><span class="line">&#125;</span><br><span class="line">cv.<span class="built_in">wait</span>(lc);</span><br><span class="line">&#125;</span><br><span class="line">cv.<span class="built_in">notify_all</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lc</span><span class="params">(gMtx)</span></span>;</span><br><span class="line"><span class="keyword">while</span> (count &lt;= <span class="number">100</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span> (count % <span class="number">3</span> == <span class="number">1</span> &amp;&amp; count &lt;= <span class="number">100</span>)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; - c: &quot;</span> &lt;&lt; count &lt;&lt; std::endl;</span><br><span class="line">count++; </span><br><span class="line">cv.<span class="built_in">notify_all</span>();</span><br><span class="line">&#125;</span><br><span class="line">cv.<span class="built_in">wait</span>(lc);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func3</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lc</span><span class="params">(gMtx)</span></span>;</span><br><span class="line"><span class="keyword">while</span> (count &lt;= <span class="number">100</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span> (count % <span class="number">3</span> == <span class="number">2</span> &amp;&amp; count &lt;= <span class="number">100</span>)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; - c: &quot;</span> &lt;&lt; count &lt;&lt; std::endl;</span><br><span class="line">count++; </span><br><span class="line">cv.<span class="built_in">notify_all</span>();</span><br><span class="line">&#125;</span><br><span class="line">cv.<span class="built_in">wait</span>(lc);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">std::thread <span class="title">s1</span><span class="params">(func1)</span></span>;</span><br><span class="line"><span class="function">std::thread <span class="title">s2</span><span class="params">(func2)</span></span>;</span><br><span class="line"><span class="function">std::thread <span class="title">s3</span><span class="params">(func3)</span></span>;</span><br><span class="line"></span><br><span class="line">s1.<span class="built_in">join</span>();</span><br><span class="line">s2.<span class="built_in">join</span>();</span><br><span class="line">s3.<span class="built_in">join</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;finished\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><details><summary>æ–¹æ³•2ä»£ç è¿è¡Œç»“æœ</summary><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">140713900033600 - c: 1</span><br><span class="line">140713891640896 - c: 2</span><br><span class="line">140713908426304 - c: 3</span><br><span class="line">140713900033600 - c: 4</span><br><span class="line">140713891640896 - c: 5</span><br><span class="line">140713908426304 - c: 6</span><br><span class="line">140713900033600 - c: 7</span><br><span class="line">140713891640896 - c: 8</span><br><span class="line">140713908426304 - c: 9</span><br><span class="line">140713900033600 - c: 10</span><br><span class="line">140713891640896 - c: 11</span><br><span class="line">140713908426304 - c: 12</span><br><span class="line">140713900033600 - c: 13</span><br><span class="line">140713891640896 - c: 14</span><br><span class="line">140713908426304 - c: 15</span><br><span class="line">140713900033600 - c: 16</span><br><span class="line">140713891640896 - c: 17</span><br><span class="line">140713908426304 - c: 18</span><br><span class="line">140713900033600 - c: 19</span><br><span class="line">140713891640896 - c: 20</span><br><span class="line">140713908426304 - c: 21</span><br><span class="line">140713900033600 - c: 22</span><br><span class="line">140713891640896 - c: 23</span><br><span class="line">140713908426304 - c: 24</span><br><span class="line">140713900033600 - c: 25</span><br><span class="line">140713891640896 - c: 26</span><br><span class="line">140713908426304 - c: 27</span><br><span class="line">140713900033600 - c: 28</span><br><span class="line">140713891640896 - c: 29</span><br><span class="line">140713908426304 - c: 30</span><br><span class="line">140713900033600 - c: 31</span><br><span class="line">140713891640896 - c: 32</span><br><span class="line">140713908426304 - c: 33</span><br><span class="line">140713900033600 - c: 34</span><br><span class="line">140713891640896 - c: 35</span><br><span class="line">140713908426304 - c: 36</span><br><span class="line">140713900033600 - c: 37</span><br><span class="line">140713891640896 - c: 38</span><br><span class="line">140713908426304 - c: 39</span><br><span class="line">140713900033600 - c: 40</span><br><span class="line">140713891640896 - c: 41</span><br><span class="line">140713908426304 - c: 42</span><br><span class="line">140713900033600 - c: 43</span><br><span class="line">140713891640896 - c: 44</span><br><span class="line">140713908426304 - c: 45</span><br><span class="line">140713900033600 - c: 46</span><br><span class="line">140713891640896 - c: 47</span><br><span class="line">140713908426304 - c: 48</span><br><span class="line">140713900033600 - c: 49</span><br><span class="line">140713891640896 - c: 50</span><br><span class="line">140713908426304 - c: 51</span><br><span class="line">140713900033600 - c: 52</span><br><span class="line">140713891640896 - c: 53</span><br><span class="line">140713908426304 - c: 54</span><br><span class="line">140713900033600 - c: 55</span><br><span class="line">140713891640896 - c: 56</span><br><span class="line">140713908426304 - c: 57</span><br><span class="line">140713900033600 - c: 58</span><br><span class="line">140713891640896 - c: 59</span><br><span class="line">140713908426304 - c: 60</span><br><span class="line">140713900033600 - c: 61</span><br><span class="line">140713891640896 - c: 62</span><br><span class="line">140713908426304 - c: 63</span><br><span class="line">140713900033600 - c: 64</span><br><span class="line">140713891640896 - c: 65</span><br><span class="line">140713908426304 - c: 66</span><br><span class="line">140713900033600 - c: 67</span><br><span class="line">140713891640896 - c: 68</span><br><span class="line">140713908426304 - c: 69</span><br><span class="line">140713900033600 - c: 70</span><br><span class="line">140713891640896 - c: 71</span><br><span class="line">140713908426304 - c: 72</span><br><span class="line">140713900033600 - c: 73</span><br><span class="line">140713891640896 - c: 74</span><br><span class="line">140713908426304 - c: 75</span><br><span class="line">140713900033600 - c: 76</span><br><span class="line">140713891640896 - c: 77</span><br><span class="line">140713908426304 - c: 78</span><br><span class="line">140713900033600 - c: 79</span><br><span class="line">140713891640896 - c: 80</span><br><span class="line">140713908426304 - c: 81</span><br><span class="line">140713900033600 - c: 82</span><br><span class="line">140713891640896 - c: 83</span><br><span class="line">140713908426304 - c: 84</span><br><span class="line">140713900033600 - c: 85</span><br><span class="line">140713891640896 - c: 86</span><br><span class="line">140713908426304 - c: 87</span><br><span class="line">140713900033600 - c: 88</span><br><span class="line">140713891640896 - c: 89</span><br><span class="line">140713908426304 - c: 90</span><br><span class="line">140713900033600 - c: 91</span><br><span class="line">140713891640896 - c: 92</span><br><span class="line">140713908426304 - c: 93</span><br><span class="line">140713900033600 - c: 94</span><br><span class="line">140713891640896 - c: 95</span><br><span class="line">140713908426304 - c: 96</span><br><span class="line">140713900033600 - c: 97</span><br><span class="line">140713891640896 - c: 98</span><br><span class="line">140713908426304 - c: 99</span><br><span class="line">140713900033600 - c: 100</span><br><span class="line">finished</span><br></pre></td></tr></table></figure></details><h1 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h1><p>è‡ªå·±å¹³æ—¶ä¸å¤šç»ƒä¹ ï¼Œåªèƒ½å¤§æ„å¤±è†å·äº†â€¦â€¦</p>]]></content>
    
    
    <summary type="html">ä½¿ç”¨C++å®ç°ä¸‰ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°1åˆ°100</summary>
    
    
    
    <category term="æ±‚èŒè·¯ä¸Šä¸€å»ä¸å¤è¿”" scheme="https://blog.musnow.top/categories/%E6%B1%82%E8%81%8C%E8%B7%AF%E4%B8%8A%E4%B8%80%E5%8E%BB%E4%B8%8D%E5%A4%8D%E8%BF%94/"/>
    
    
    <category term="çº¿ç¨‹" scheme="https://blog.musnow.top/tags/%E7%BA%BF%E7%A8%8B/"/>
    
    <category term="Cpp" scheme="https://blog.musnow.top/tags/Cpp/"/>
    
  </entry>
  
  <entry>
    <title></title>
    <link href="https://blog.musnow.top/posts/0/"/>
    <id>https://blog.musnow.top/posts/0/</id>
    <published>2024-03-08T01:26:05.498Z</published>
    <updated>2024-03-08T01:33:58.282Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h1><p><a href="https://leetcode.cn/problems/lru-cache/description/?envType=study-plan-v2&envId=top-100-liked">146. LRU ç¼“å­˜ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></p><h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><p>æ“ä½œç³»ç»Ÿä¸­å­¦ä¹ è¿‡LRUçš„ç›¸å…³çŸ¥è¯†ï¼Œä¸­æ–‡æ˜¯<strong>æœ€é•¿æœ€ä¹…æœªä½¿ç”¨</strong>ï¼Œæ˜¯é¡µé¢ç½®æ¢ç®—æ³•çš„ä¸€éƒ¨åˆ†ã€‚å³é¡µè¡¨åœ¨ç½®æ¢ç®—æ³•çš„æ—¶å€™ï¼Œä»å½“å‰æ—¶åˆ»å¾€å‰æ‰¾ï¼Œæ‰¾åˆ°ä»¥è½½å…¥é¡µé¢ä¸­æœ€é•¿æ—¶é—´æ²¡æœ‰è¢«ä½¿ç”¨çš„å“ªä¸€ä¸ªï¼Œå°†å…¶ç½®æ¢å‡ºå»ã€‚</p><p>å¯¹äºä»£ç è€Œè¨€ï¼Œå¯ä»¥ç”¨list+å“ˆå¸Œè¡¨çš„ç»“æ„æ¥å®ç°ã€‚</p><ul><li>å“ˆå¸Œè¡¨å­˜æ”¾keyå’Œnodeçš„å…³ç³»</li><li>nodeä¸­å­˜æ”¾keyå’Œvalue</li></ul><p>æˆ‘ä»¬ä½¿ç”¨listæ¥ç»´æŠ¤èŠ‚ç‚¹è¢«ä½¿ç”¨çš„æ—¶é—´ï¼Œ<strong>ä¸€ä¸ªèŠ‚ç‚¹è¢«è®¿é—®å°±æ’å…¥åˆ°é“¾è¡¨å¤´</strong>ï¼Œè¿™æ ·å°±èƒ½ä¿è¯é“¾è¡¨å°¾éƒ¨çš„å°±æ˜¯é‚£ä¸ªæœ€ä¹…æ²¡æœ‰è¢«ä½¿ç”¨çš„èŠ‚ç‚¹ã€‚éœ€è¦åˆ é™¤çš„æ—¶å€™å°±å°†å°¾éƒ¨çš„èŠ‚ç‚¹åˆ é™¤å³å¯ã€‚</p><p>å¦‚æœä¸€ä¸ªkeyå·²ç»å­˜åœ¨ä¸listä¸­ï¼Œè®¿é—®çš„æ—¶å€™å°±éœ€è¦å°†å…¶å…ˆåˆ é™¤ï¼Œå†å¤´æ’ã€‚ä¸ºäº†æ»¡è¶³é¢˜ç›®ä¸­<code>O(1)</code>æ—¶é—´å¤æ‚åº¦çš„è¦æ±‚ï¼Œä½¿ç”¨é“¾è¡¨æ‰èƒ½ä¿è¯åˆ é™¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(1)</code>ã€‚</p><h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><p>åˆšå¼€å§‹ç”¨çš„å¤´åˆ +å°¾æ’çš„æ–¹å¼ï¼Œç»“æœå¼„äº†å¥½ä¹…éƒ½è¿˜æœ‰æ®µé”™è¯¯ï¼Œæ”¹æˆå¤´æ’+å°¾åˆ å¥½å¤„ç†ä¸€äº›ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> _val;</span><br><span class="line">    <span class="type">int</span> _key;</span><br><span class="line">    Node* _prev;</span><br><span class="line">    Node* _next;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Node</span>():_val(<span class="number">0</span>),_key(<span class="number">0</span>),_prev(<span class="literal">nullptr</span>),_next(<span class="literal">nullptr</span>)&#123;&#125;</span><br><span class="line">    <span class="built_in">Node</span>(<span class="type">int</span> key,<span class="type">int</span> val):_val(val),_key(key),_prev(<span class="literal">nullptr</span>),_next(<span class="literal">nullptr</span>)&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LRUCache</span> &#123;</span><br><span class="line">    Node* _head;</span><br><span class="line">    Node* _tail;</span><br><span class="line">    unordered_map&lt;<span class="type">int</span>,Node*&gt; _map;</span><br><span class="line">    <span class="type">int</span> _size = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> _capa = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">LRUCache</span>(<span class="type">int</span> capacity) &#123;</span><br><span class="line">        _head = <span class="keyword">new</span> <span class="built_in">Node</span>();</span><br><span class="line">        _tail = <span class="keyword">new</span> <span class="built_in">Node</span>();</span><br><span class="line">        _head-&gt;_next = _tail;</span><br><span class="line">        _tail-&gt;_prev = _head;</span><br><span class="line">        _capa = capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">addNodeToHead</span><span class="params">(Node* node)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        node-&gt;_prev = _head;</span><br><span class="line">        node-&gt;_next = _head-&gt;_next;</span><br><span class="line">        _head-&gt;_next-&gt;_prev = node;</span><br><span class="line">        _head-&gt;_next = node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">removeNode</span><span class="params">(Node* node)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        node-&gt;_prev-&gt;_next = node-&gt;_next;</span><br><span class="line">        node-&gt;_next-&gt;_prev = node-&gt;_prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">get</span><span class="params">(<span class="type">int</span> key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(_map.<span class="built_in">count</span>(key))</span><br><span class="line">        &#123;</span><br><span class="line">            Node* node = _map[key];</span><br><span class="line">            <span class="built_in">removeNode</span>(node);</span><br><span class="line">            <span class="built_in">addNodeToHead</span>(node);</span><br><span class="line">            <span class="keyword">return</span> node-&gt;_val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">put</span><span class="params">(<span class="type">int</span> key, <span class="type">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span>(_map.<span class="built_in">count</span>(key))</span><br><span class="line">        &#123;</span><br><span class="line">            Node* node = _map[key];</span><br><span class="line">            node-&gt;_val = value;</span><br><span class="line">            <span class="built_in">removeNode</span>(node);</span><br><span class="line">            <span class="built_in">addNodeToHead</span>(node);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// è¶…é•¿äº†</span></span><br><span class="line">            <span class="keyword">if</span>(_size == _capa)</span><br><span class="line">            &#123;</span><br><span class="line">                Node* remove = _tail-&gt;_prev;</span><br><span class="line">                _map.<span class="built_in">erase</span>(remove-&gt;_key);</span><br><span class="line">                <span class="built_in">removeNode</span>(remove);</span><br><span class="line">                _size--;</span><br><span class="line">                <span class="comment">// è¿™é‡Œå¯ä»¥ä¸freeèŠ‚ç‚¹ï¼Œå› ä¸ºOJä¸è€ƒè™‘å†…å­˜æ³„æ¼</span></span><br><span class="line">                <span class="keyword">delete</span> remove;</span><br><span class="line">            &#125;</span><br><span class="line">            Node* node = <span class="keyword">new</span> <span class="built_in">Node</span>(key,value);</span><br><span class="line">            <span class="built_in">addNodeToHead</span>(node);</span><br><span class="line">            _map[key] = node;</span><br><span class="line">            _size++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your LRUCache object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * LRUCache* obj = new LRUCache(capacity);</span></span><br><span class="line"><span class="comment"> * int param_1 = obj-&gt;get(key);</span></span><br><span class="line"><span class="comment"> * obj-&gt;put(key,value);</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/03/44f70ed77f48124bd2b0a1080122d732.png" alt="image.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;é¢˜ç›®&quot;&gt;&lt;a href=&quot;#é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;é¢˜ç›®&quot;&gt;&lt;/a&gt;é¢˜ç›®&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://leetcode.cn/problems/lru-cache/description/?envType=s</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ã€ç®—æ³•ã€‘KMPç®—æ³•</title>
    <link href="https://blog.musnow.top/posts/1835761968/"/>
    <id>https://blog.musnow.top/posts/1835761968/</id>
    <published>2024-02-29T08:31:48.000Z</published>
    <updated>2024-03-02T01:38:03.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‚è€ƒã€Šä»£ç éšæƒ³å½•ã€‹ã€‚</p><h1 id="1-ä»‹ç»"><a href="#1-ä»‹ç»" class="headerlink" title="1.ä»‹ç»"></a>1.ä»‹ç»</h1><p>KMPç®—æ³•æ˜¯è§£å†³å­—ç¬¦ä¸²é—®é¢˜æ—¶æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ä¸ªç®—æ³•ï¼Œå®ƒå¯ä»¥å°†æš´åŠ›ç ´è§£æ³•çš„æ—¶é—´å¤æ‚åº¦<code>O(N^2)</code>é™ä½åˆ°<code>O(M+N)</code>ï¼Œæ•ˆç‡æœ‰ä¸é”™çš„æå‡ã€‚</p><p>KMPç®—æ³•ç”±Knuthã€Morriså’ŒPrattä¸‰ä½å­¦è€…å‘æ˜ï¼Œä¹Ÿå› æ­¤å¾—åKMPã€‚</p><h2 id="1-1-next-å‰ç¼€è¡¨"><a href="#1-1-next-å‰ç¼€è¡¨" class="headerlink" title="1.1 next å‰ç¼€è¡¨"></a>1.1 next å‰ç¼€è¡¨</h2><p>KMPç®—æ³•çš„æ ¸å¿ƒæ˜¯nextæ•°ç»„ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ª<strong>å‰ç¼€è¡¨</strong>ï¼šè®°å½•ä¸‹æ ‡iï¼ˆåŒ…æ‹¬iï¼‰ä¹‹å‰çš„å­—ç¬¦ä¸²ä¸­æœ‰å¤šé•¿çš„ç›¸åŒå‰åç¼€ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®å‰ç¼€å’Œåç¼€çš„æ¦‚å¿µï¼šé™¤äº†æœ€åä¸€ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²å…¶ä½™éƒ¨åˆ†éƒ½å¯ç§°ä¹‹ä¸ºå‰ç¼€ï¼›é™¤äº†ç¬¬ä¸€ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²å…¶ä½™éƒ¨åˆ†éƒ½å¯ä»¥ç§°ä¹‹ä¸ºåç¼€ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">å­—ç¬¦ä¸²ï¼šabba</span><br><span class="line">æœ€é•¿å‰ç¼€ï¼šabb</span><br><span class="line">æœ€é•¿åç¼€ï¼šbba</span><br><span class="line"></span><br><span class="line">å­—ç¬¦ä¸²ï¼šaa</span><br><span class="line">æœ€é•¿å‰ç¼€ï¼ša</span><br><span class="line">æœ€é•¿åç¼€ï¼ša</span><br><span class="line"></span><br><span class="line">å­—ç¬¦ä¸²ï¼ša</span><br><span class="line">æ²¡æœ‰å‰ç¼€å’Œåç¼€</span><br></pre></td></tr></table></figure><p>ç›¸åŒå‰åç¼€å°±æ˜¯çœ‹å‰ç¼€å’Œåç¼€çš„ç›¸åŒéƒ¨åˆ†ï¼›æ¯”å¦‚å­—ç¬¦ä¸²<code>abba</code>ï¼Œå‰ç¼€å’Œåç¼€ä¸­åªæœ‰å­—ç¬¦ä¸²aæ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥è¿™ä¸ªå­—ç¬¦ä¸²çš„<strong>æœ€é•¿ç›¸åŒå‰åç¼€</strong>åªæœ‰1ã€‚</p><p>è€ŒKMPç®—æ³•ä¸­çš„nextæ•°ç»„ï¼Œå°±æ˜¯å­˜æ”¾è¿™ä¸ªæœ€é•¿ç›¸åŒå‰åç¼€æ•°é‡çš„ã€‚ä»¥å­—ç¬¦ä¸²<code>aabaaf</code>ä¸ºä¾‹</p><table><thead><tr><th>ä¸‹æ ‡</th><th>å­—ç¬¦ä¸²</th><th>æœ€å¤§ç›¸åŒå‰åç¼€</th></tr></thead><tbody><tr><td>0</td><td>a</td><td>0</td></tr><tr><td>1</td><td>aa</td><td>1</td></tr><tr><td>2</td><td>aab</td><td>0</td></tr><tr><td>3</td><td>aaba</td><td>1</td></tr><tr><td>4</td><td>aabaa</td><td>2</td></tr><tr><td>5</td><td>aabaaf</td><td>0</td></tr></tbody></table><p>å¯¹<code>aabaaf</code>å­—ç¬¦ä¸²è€Œè¨€ï¼Œæœ€ç»ˆå¾—åˆ°çš„KMPç®—æ³•nextæ•°ç»„å­˜æ”¾çš„å°±æ˜¯<code>&#123;0,1,0,1,2,0&#125;</code>ï¼Œè¿™ä¸ªæ•°ç»„å°±æ˜¯è¯¥å­—ç¬¦ä¸²çš„<strong>å‰ç¼€è¡¨</strong>ã€‚</p><h2 id="1-2-nextæ•°ç»„çš„ä½œç”¨"><a href="#1-2-nextæ•°ç»„çš„ä½œç”¨" class="headerlink" title="1.2 nextæ•°ç»„çš„ä½œç”¨"></a>1.2 nextæ•°ç»„çš„ä½œç”¨</h2><p>é‚£ä¹ˆè¿™ä¸ªnextæ•°ç»„æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿç»™å‡ºä¸€ä¸ªç¤ºä¾‹é¢˜ç›®ï¼šè®©ä½ åœ¨<code>aabaabaaf</code>ä¸­æŸ¥æ‰¾æ˜¯å¦åŒ…å«å­å­—ç¬¦ä¸²<code>aabaaf</code>ï¼›</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/89e406b57e7dc7d1cff721dee001bb7d.png" alt="image.png"></p><p>å‡è®¾æˆ‘ä»¬ä½¿ç”¨æš´åŠ›æ³•ï¼Œå½“åŒ¹é…åˆ°æœ€åä¸€ä¸ªå­—ç¬¦ä¸ç›¸åŒæ—¶ï¼Œä¼šå°†æºä¸²ä¸‹æ ‡+1ï¼Œç„¶åé‡æ–°åŒ¹é…å­ä¸²ã€‚</p><p>ä½†ä»”ç»†è§‚å¯Ÿä½ ä¼šå‘ç°ï¼Œè™½ç„¶è¿™é‡Œæºå­—ç¬¦ä¸²å’Œå­ä¸²çš„æœ€åä¸€ä¸ªå­—ç¬¦fä¸åŒ¹é…ï¼Œä½†å‰é¢ä¸‰ä¸ªaabæ˜¯å·²ç»åŒ¹é…ä¸Šçš„ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ä»è¿™ä¸ªå·²ç»åŒ¹é…ä¸Šçš„å­—ç¬¦ä¸²å¾€åæ‰¾ï¼Œä¼šå‘ç°æœ€ç»ˆå¯ä»¥æ‰¾åˆ°å­å­—ç¬¦ä¸²<code>aabaaf</code>ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/7d08ccd09b14e5e8a082473d6c3d4965.png" alt="image.png"></p><p>nextæ•°ç»„å°±æ˜¯ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚å½“å‘ç°ä¸åŒ¹é…æ—¶ï¼Œå›æº¯åˆ°å½“å‰ä½ç½®å‰ä¸€ä¸ªçš„nextæ•°ç»„ä¸­æ‰€å¯¹åº”å…ƒç´ çš„ä¸‹æ ‡ä½ç½®ã€‚ä¸‹å›¾ä¸­fæ˜¯<strong>ä¸‹æ ‡5</strong>ï¼Œé‚£ä¹ˆå°±éœ€è¦å›æº¯åˆ°<code>next[5-1]</code>çš„ä¸‹æ ‡å¤„ï¼Œå³å›æº¯åˆ°å­ä¸²ä¸­çš„<strong>ä¸‹æ ‡2</strong>ä½ç½®ï¼Œé‡æ–°å¼€å§‹åŒ¹é…ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/1759f4d6ba0630f323c5fd1a5898cc3d.png" alt="image.png"></p><p>æ­¤æ—¶ä¼šå‘ç°ä¸‹æ ‡2çš„ä½ç½®å’Œå½“å‰æºä¸²çš„å­—ç¬¦ç›¸åŒï¼Œç»§ç»­å¾€ååŒ¹é…å­ä¸²ï¼Œèƒ½æ‰¾åˆ°å®Œæ•´çš„å­ä¸²ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/e1655433e59d6d266480f4cdc5043b8d.png" alt="image.png"></p><p>é€šè¿‡nextæ•°ç»„ï¼ŒæŠŠåŸæœ¬éœ€è¦é‡æ–°éå†çš„æ–¹å¼æ”¹ä¸ºä»ä¸Šä¸€ä¸ªå¯ä»¥è¢«åŒ¹é…çš„ä½ç½®é‡æ–°å¼€å§‹åŒ¹é…ï¼Œå°±èŠ‚çœäº†æ—¶é—´ã€‚</p><h2 id="1-3-ä¸ºä»€ä¹ˆï¼Ÿ"><a href="#1-3-ä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.3 ä¸ºä»€ä¹ˆï¼Ÿ"></a>1.3 ä¸ºä»€ä¹ˆï¼Ÿ</h2><p>å› ä¸ºå‰ç¼€è¡¨è®°å½•äº†æœ€é•¿ç›¸åŒå‰åç¼€çš„ä¿¡æ¯ï¼Œå½“æˆ‘ä»¬åŒ¹é…ä¸ä¸Šçš„æ—¶å€™ï¼Œæ‰¾åˆ°å‰ä¸€ä¸ªä¸‹æ ‡å¯¹åº”å‰ç¼€è¡¨å†…çš„æ•°æ®ï¼Œå°±èƒ½å¾—åˆ°å½“å‰å­—ç¬¦ä»¥å‰çš„å­—ç¬¦ä¸²æ˜¯å¦æœ‰ç›¸åŒçš„å‰ç¼€ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä¸‹æ ‡æ•° 0 1 2 3 4 5</span><br><span class="line">å­—ç¬¦ä¸² a a b a a f</span><br><span class="line">å‰ç¼€è¡¨ 0 1 0 1 2 0</span><br></pre></td></tr></table></figure><p>å½“fåŒ¹é…ä¸ä¸Šçš„æ—¶å€™ï¼Œå‰ä¸€ä½åœ¨å‰ç¼€è¡¨ä¸­ä¸º2ï¼Œä»£è¡¨å¾€å‰ä¸€å…±æœ‰2ä¸ªå­—ç¬¦ï¼ˆåç¼€ï¼‰ï¼Œå’Œæ•´ä¸ªå­—ç¬¦ä¸²çš„<strong>å‰2ä½</strong>æ˜¯ç›¸åŒçš„ï¼ˆå³aabaaé‡Œé¢åç¼€çš„aaå’Œå‰ç¼€çš„aaç›¸åŒï¼Œè¿™é‡Œçš„å‰ç¼€aaä¹Ÿæ˜¯å­—ç¬¦ä¸²çš„èµ·å§‹ä¸¤ä¸ªå­—ç¬¦ï¼‰ã€‚</p><p>è¿™èƒ½å‘Šè¯‰æˆ‘ä»¬ï¼ŒåˆšåˆšåŒ¹é…çš„å­—ç¬¦ä¸²ä¸­ï¼Œåç¼€éƒ¨åˆ†åŒ¹é…æˆåŠŸäº†2ä¸ªï¼ˆä¸ç„¶ä¹Ÿèµ°ä¸åˆ°fè¿™é‡Œæ¥ï¼‰ï¼Œå¯ä»¥æŠŠè¿™ä¸ªåç¼€çš„2ä¸ªå½“ä½œå‰ç¼€çš„2ä¸ªæ¥å¤„ç†ï¼Œè€ŒæŒ‡é’ˆåªéœ€è¦å›æº¯åˆ°å‰ç¼€çš„<strong>ä¸‹ä¸€ä¸ªå­—ç¬¦</strong>é‡æ–°å¼€å§‹åŒ¹é…å³å¯ï¼Œå¯¹äºæ•°ç»„è€Œè¨€ï¼Œ<strong>ä¸‹ä¸€ä¸ªå­—ç¬¦çš„ä¸‹æ ‡å°±æ˜¯å‰ç¼€è¡¨ä¸­çš„æ•°å­—</strong>ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/7d08ccd09b14e5e8a082473d6c3d4965.png" alt="image.png"></p><h2 id="1-4-è·å–ä¸€ä¸ªå­—ç¬¦ä¸²çš„nextæ•°ç»„"><a href="#1-4-è·å–ä¸€ä¸ªå­—ç¬¦ä¸²çš„nextæ•°ç»„" class="headerlink" title="1.4 è·å–ä¸€ä¸ªå­—ç¬¦ä¸²çš„nextæ•°ç»„"></a>1.4 è·å–ä¸€ä¸ªå­—ç¬¦ä¸²çš„nextæ•°ç»„</h2><p>è·å–nextæ•°ç»„æœ‰å‡ ç§å®ç°æ–¹å¼</p><ul><li>å°†å‰ç¼€è¡¨ä¸­çš„æ•°æ®å…¨éƒ¨å‡ä¸€ï¼›</li><li>å°†å‰ç¼€è¡¨ä¸­çš„æ•°æ®æ•´ä½“å³ç§»ä¸€ä½ï¼›</li><li>ç›´æ¥ä½¿ç”¨å‰ç¼€è¡¨ï¼›</li></ul><p>ä¸ªäººæ›´åŠ å–œæ¬¢ç›´æ¥ä½¿ç”¨å‰ç¼€è¡¨çš„æ–¹å¼ï¼Œå› ä¸ºåŸç†å°±æ˜¯è¿™ä¹ˆå­¦çš„ï¼Œç›´æ¥ä½¿ç”¨å‰ç¼€è¡¨ä¹Ÿæ¯”è¾ƒå¥½åŠ¨æ‡‚ä¸€äº›ã€‚æ„é€ å‰ç¼€è¡¨çš„ä»£ç å¦‚ä¸‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">getNext</span><span class="params">(<span class="type">int</span>* next,<span class="type">const</span> std::string&amp; s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line">next[<span class="number">0</span>] = <span class="number">0</span>; <span class="comment">// åˆå§‹åŒ–nextæ•°ç»„ç¬¬ä¸€ä½ï¼ˆç¬¬ä¸€ä½æ˜¯ä¸å­˜åœ¨å‰ç¼€å’Œåç¼€ï¼Œè‚¯å®šä¸º0ï¼‰</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;s.<span class="built_in">size</span>();i++) <span class="comment">//éå†è¦ä»å­—ç¬¦ä¸²ç¬¬äºŒä½å¼€å§‹</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// åç»­éœ€è¦å–j-1ä½œä¸ºä¸‹æ ‡çš„æ“ä½œï¼Œæ‰€ä»¥jå¿…é¡»å¤§äº0</span></span><br><span class="line"><span class="comment">// å½“jå’Œiçš„å­—ç¬¦äºŒè€…ä¸åŒ¹é…çš„æ—¶å€™ï¼Œå°±éœ€è¦å¾€å‰å›æº¯</span></span><br><span class="line"><span class="keyword">while</span>(j&gt;<span class="number">0</span> &amp;&amp; s[i] != s[j])</span><br><span class="line">&#123;</span><br><span class="line">j = next[j<span class="number">-1</span>]; <span class="comment">// å›æº¯åˆ°å‰ä¸€ä½ä¸‹æ ‡åœ¨nextæ•°ç»„ä¸­çš„å…ƒç´ </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// äºŒè€…åŒ¹é…ï¼Œj+1</span></span><br><span class="line"><span class="keyword">if</span>(s[i] == s[j])</span><br><span class="line">&#123;</span><br><span class="line">j++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// èµ‹å€¼nextæ•°ç»„</span></span><br><span class="line">next[i] = j;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¸€ä¸‹ï¼ŒæˆåŠŸè·å¾—åˆšåˆšè®¡ç®—å‡ºæ¥çš„å‰ç¼€è¡¨</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">string test = <span class="string">&quot;aabaaf&quot;</span>;</span><br><span class="line"><span class="type">int</span> next[<span class="number">10</span>];</span><br><span class="line"><span class="built_in">getNext</span>(next, test);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; test.<span class="built_in">size</span>(); i++)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; next[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 1 0 1 2 0</span><br></pre></td></tr></table></figure><h1 id="2-leetcode-28-æ‰¾åˆ°å­ä¸²å¹¶è¿”å›èµ·å§‹ä¸‹æ ‡"><a href="#2-leetcode-28-æ‰¾åˆ°å­ä¸²å¹¶è¿”å›èµ·å§‹ä¸‹æ ‡" class="headerlink" title="2.leetcode-28-æ‰¾åˆ°å­ä¸²å¹¶è¿”å›èµ·å§‹ä¸‹æ ‡"></a>2.leetcode-28-æ‰¾åˆ°å­ä¸²å¹¶è¿”å›èµ·å§‹ä¸‹æ ‡</h1><p><a href="https://leetcode.cn/problems/find-the-index-of-the-first-occurrence-in-a-string/description/">28. æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡</a></p><p>é¢˜ç›®ï¼šç»™ä½ ä¸¤ä¸ªå­—ç¬¦ä¸² haystack å’Œ needle ï¼Œè¯·ä½ åœ¨ haystack å­—ç¬¦ä¸²ä¸­æ‰¾å‡º needle å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡ï¼ˆä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰ã€‚å¦‚æœ needle ä¸æ˜¯ haystack çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™è¿”å›  -1 ã€‚</p><p>è¿™é“é¢˜å°±æ˜¯å­¦ä¹ KMPç®—æ³•çš„ç»å…¸é¢˜ç›®ï¼Œæ€è·¯å‰æ–‡å·²ç»æè¿°è¿‡äº†ï¼Œè¿™é‡Œåªç»™å‡ºä»£ç ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">getNext</span><span class="params">(<span class="type">int</span>* next,<span class="type">const</span> std::string&amp; s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line">        next[<span class="number">0</span>] = <span class="number">0</span>; <span class="comment">// åˆå§‹åŒ–nextæ•°ç»„ç¬¬ä¸€ä½ï¼ˆç¬¬ä¸€ä½æ˜¯ä¸å­˜åœ¨å‰ç¼€å’Œåç¼€ï¼Œè‚¯å®šä¸º0ï¼‰</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;s.<span class="built_in">size</span>();i++) <span class="comment">//éå†è¦ä»å­—ç¬¦ä¸²ç¬¬äºŒä½å¼€å§‹</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// åç»­éœ€è¦å–j-1ä½œä¸ºä¸‹æ ‡çš„æ“ä½œï¼Œæ‰€ä»¥jå¿…é¡»å¤§äº0</span></span><br><span class="line">            <span class="comment">// å½“jå’Œiçš„å­—ç¬¦äºŒè€…ä¸åŒ¹é…çš„æ—¶å€™ï¼Œå°±éœ€è¦å¾€å‰å›æº¯</span></span><br><span class="line">            <span class="keyword">while</span>(j&gt;<span class="number">0</span> &amp;&amp; s[i] != s[j])</span><br><span class="line">            &#123;</span><br><span class="line">                j = next[j<span class="number">-1</span>]; <span class="comment">// å›æº¯åˆ°å‰ä¸€ä½ä¸‹æ ‡åœ¨nextæ•°ç»„ä¸­çš„å…ƒç´ </span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// äºŒè€…åŒ¹é…ï¼Œj+1</span></span><br><span class="line">            <span class="keyword">if</span>(s[i] == s[j])</span><br><span class="line">            &#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// èµ‹å€¼nextæ•°ç»„</span></span><br><span class="line">            next[i] = j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">strStr</span><span class="params">(string haystack, string needle)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å­ä¸²ä¸ºç©ºè‚¯å®šæ‰¾ä¸åˆ°</span></span><br><span class="line">        <span class="keyword">if</span>(needle.<span class="built_in">size</span>() == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> next[needle.<span class="built_in">size</span>()];</span><br><span class="line">        <span class="built_in">getNext</span>(next,needle);</span><br><span class="line">        <span class="type">int</span> j=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;haystack.<span class="built_in">size</span>();i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">while</span>(j&gt;<span class="number">0</span> &amp;&amp; haystack[i] != needle[j])</span><br><span class="line">            &#123;</span><br><span class="line">                j = next[j<span class="number">-1</span>]; <span class="comment">// å¾€å‰å›æº¯ä¸€ä½</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(haystack[i] == needle[j])&#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// jå·²ç»è¶…å‡ºå¤§å°ï¼Œè¯´æ˜å­ä¸²å®Œå…¨åŒ¹é…ï¼ŒæˆåŠŸã€‚</span></span><br><span class="line">            <span class="keyword">if</span>(j&gt;=needle.<span class="built_in">size</span>())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> (i - needle.<span class="built_in">size</span>() + <span class="number">1</span>); <span class="comment">// è¿”å›å­ä¸²çš„èµ·å§‹ä¸‹æ ‡</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;<span class="comment">//æ²¡æ‰¾åˆ°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>é¢˜è§£é€šè¿‡</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/52720e7926e1e664422d129534951804.png" alt="image.png"></p><h1 id="3-leetcode-459-é‡å¤çš„å­å­—ç¬¦ä¸²"><a href="#3-leetcode-459-é‡å¤çš„å­å­—ç¬¦ä¸²" class="headerlink" title="3.leetcode-459-é‡å¤çš„å­å­—ç¬¦ä¸²"></a>3.leetcode-459-é‡å¤çš„å­å­—ç¬¦ä¸²</h1><h2 id="3-1-é¢˜ç›®"><a href="#3-1-é¢˜ç›®" class="headerlink" title="3.1 é¢˜ç›®"></a>3.1 é¢˜ç›®</h2><p><a href="https://leetcode.cn/problems/repeated-substring-pattern/description/">459. é‡å¤çš„å­å­—ç¬¦ä¸²</a></p><p>ç»™å®šä¸€ä¸ªéç©ºçš„å­—ç¬¦ä¸² s ï¼Œæ£€æŸ¥æ˜¯å¦å¯ä»¥é€šè¿‡ç”±å®ƒçš„ä¸€ä¸ªå­ä¸²é‡å¤å¤šæ¬¡æ„æˆã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1:</span><br><span class="line">è¾“å…¥: s = &quot;abab&quot;</span><br><span class="line">è¾“å‡º: true</span><br><span class="line">è§£é‡Š: å¯ç”±å­ä¸² &quot;ab&quot; é‡å¤ä¸¤æ¬¡æ„æˆã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2:</span><br><span class="line">è¾“å…¥: s = &quot;aba&quot;</span><br><span class="line">è¾“å‡º: false</span><br></pre></td></tr></table></figure><h2 id="3-2-è§£é‡Š"><a href="#3-2-è§£é‡Š" class="headerlink" title="3.2 è§£é‡Š"></a>3.2 è§£é‡Š</h2><p>è¿™é“é¢˜åŒæ ·å¯ä»¥ç”¨KMPç®—æ³•æ¥è§£å†³ï¼Œå› ä¸ºå‰ç¼€è¡¨é—´æ¥åŒ…å«äº†å½“å‰å­—ç¬¦ä¸²æ˜¯å¦èƒ½é€šè¿‡æŸä¸ªå­ä¸²é‡å¤æ„æˆçš„åŠŸèƒ½ã€‚</p><p>å‡è®¾ç›®æ ‡å­—ç¬¦ä¸²é•¿åº¦ä¸ºlenï¼Œå‰ç¼€è¡¨ä¸ºnextæ•°ç»„ï¼Œé‚£ä¹ˆ<code>next[len-1]</code>æ˜¯å‰ç¼€è¡¨çš„æœ€åä¸€ä½ï¼Œä¿å­˜äº†å®Œæ•´å­—ç¬¦ä¸²çš„æœ€é•¿ç›¸åŒå‰åç¼€çš„é•¿åº¦ã€‚</p><p>$$<br>len % (len - next[len-1])&#x3D;0<br>$$</p><p>å¦‚æœå­—ç¬¦ä¸²çš„é•¿åº¦èƒ½ æ•´é™¤ å­—ç¬¦ä¸²çš„é•¿åº¦å‡å»<code>next[len-1]</code>ï¼Œåˆ™ä»£è¡¨å­—ç¬¦ä¸²èƒ½è¢«é‡å¤çš„å­ä¸²å¾ªç¯æ„æˆï¼</p><p>è§‚å¯Ÿä¸‹é¢è¿™ä¸ªå­—ç¬¦ä¸²å’Œå®ƒçš„å‰ç¼€è¡¨ï¼Œæœ€åä¸€ä½çš„æ•°æ®æ˜¯6ï¼Œæ•´ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦æ˜¯9ï¼Œè¿™ä»£è¡¨ï¼Œæ•´ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œæœ€é•¿ç›¸åŒå‰ç¼€å’Œåç¼€æœ‰3ä¸ªå­—ç¬¦æ˜¯é‡åˆçš„éƒ¨åˆ†ï¼Œä¸”å­—ç¬¦ä¸²çš„å‰ç¼€3ä¸ªå­—ç¬¦å’Œåç¼€3ä¸ªå­—ç¬¦éƒ½å’Œä¸­é—´è¿™ä¸ªé‡å¤çš„ä¸‰ä¸ªå­—ç¬¦ç›¸åŒï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å­—ç¬¦ä¸² abcabcabc</span><br><span class="line">å‰ç¼€è¡¨ 000123456</span><br><span class="line"></span><br><span class="line">æºä¸² abcabcabc</span><br><span class="line">å‰ç¼€ abcabc</span><br><span class="line">åç¼€    abcabc</span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸­é—´ä¸‰ä¸ªå­—ç¬¦abcæ˜¯åœ¨å‰åç¼€ä¸­é‡åˆçš„ï¼Œè€Œå‰ç¼€ç¬¬ä¸€ä¸ªabcåˆèƒ½å’Œåç¼€çš„å‰ä¸€ä¸ªabcåŒ¹é…ä¸Šï¼Œåç¼€çš„æœ«å°¾abcåˆèƒ½å’Œä¸­é—´é‡å¤çš„éƒ¨åˆ†åŒ¹é…ä¸Šï¼Œåˆ™ä»£è¡¨æ•´ä¸ªå­—ç¬¦ä¸²å°±æ˜¯ç”±abcå¾ªç¯æ„æˆçš„ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/ab8928003a833abad85bb828bc8f0075.png" alt="image.png"></p><p>è€Œä¾æ®ä¸Šè¿°çš„å…¬å¼è®¡ç®—ï¼Œ<code>9/(9-6) = 3</code>ï¼Œå¯ä»¥è¢«æ•´é™¤ï¼Œå³ç¬¦åˆå¾ªç¯æ„æˆçš„æ¡ä»¶ï¼</p><p>æè¿°çš„å¯èƒ½æœ‰ç‚¹æŠ½è±¡ï¼Œä¼°è®¡è¿‡å‡ å¤©å›å¤´çœ‹æˆ‘è‡ªå·±ä¹Ÿçœ‹ä¸æ‡‚äº†â€¦â€¦ğŸ¤£</p><h2 id="3-3-ä»£ç "><a href="#3-3-ä»£ç " class="headerlink" title="3.3 ä»£ç "></a>3.3 ä»£ç </h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">getNext</span><span class="params">(<span class="type">int</span>* next,<span class="type">const</span> std::string&amp; s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line">        next[<span class="number">0</span>] = <span class="number">0</span>; <span class="comment">// åˆå§‹åŒ–nextæ•°ç»„ç¬¬ä¸€ä½ï¼ˆç¬¬ä¸€ä½æ˜¯ä¸å­˜åœ¨å‰ç¼€å’Œåç¼€ï¼Œè‚¯å®šä¸º0ï¼‰</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;s.<span class="built_in">size</span>();i++) <span class="comment">//éå†è¦ä»å­—ç¬¦ä¸²ç¬¬äºŒä½å¼€å§‹</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// åç»­éœ€è¦å–j-1ä½œä¸ºä¸‹æ ‡çš„æ“ä½œï¼Œæ‰€ä»¥jå¿…é¡»å¤§äº0</span></span><br><span class="line">            <span class="comment">// å½“jå’Œiçš„å­—ç¬¦äºŒè€…ä¸åŒ¹é…çš„æ—¶å€™ï¼Œå°±éœ€è¦å¾€å‰å›æº¯</span></span><br><span class="line">            <span class="keyword">while</span>(j&gt;<span class="number">0</span> &amp;&amp; s[i] != s[j])</span><br><span class="line">            &#123;</span><br><span class="line">                j = next[j<span class="number">-1</span>]; <span class="comment">// å›æº¯åˆ°å‰ä¸€ä½ä¸‹æ ‡åœ¨nextæ•°ç»„ä¸­çš„å…ƒç´ </span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// äºŒè€…åŒ¹é…ï¼Œj+1</span></span><br><span class="line">            <span class="keyword">if</span>(s[i] == s[j])</span><br><span class="line">            &#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// èµ‹å€¼nextæ•°ç»„</span></span><br><span class="line">            next[i] = j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">repeatedSubstringPattern</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> next[s.<span class="built_in">size</span>()];</span><br><span class="line">        <span class="built_in">getNext</span>(next,s);</span><br><span class="line">        <span class="type">size_t</span> len = s.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span>(next[len<span class="number">-1</span>] != <span class="number">0</span> &amp;&amp; (len%(len-next[len<span class="number">-1</span>])) == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/66abe22355e25713fb484e3fdb3bcb5c.png" alt="image.png"></p><h1 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h1><p>KMPç®—æ³•æœ‰ç‚¹ä¸å¥½ç†è§£ï¼ŒæŠŠnextæ•°ç»„çš„æ„å»ºèƒŒä¸‹æ¥å°±å·®ä¸å¤šå¾—äº†â€¦â€¦</p>]]></content>
    
    
    <summary type="html">ç®€å•å­¦ä¹ ä¸€ä¸‹KMPç®—æ³•</summary>
    
    
    
    <category term="ç¼–ç¨‹å­¦ä¹ " scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="æŠŠé¢˜ç›®éƒ½ç»™åˆ·å¹²å‡€" scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E6%8A%8A%E9%A2%98%E7%9B%AE%E9%83%BD%E7%BB%99%E5%88%B7%E5%B9%B2%E5%87%80/"/>
    
    
    <category term="ç®—æ³•" scheme="https://blog.musnow.top/tags/%E7%AE%97%E6%B3%95/"/>
    
    <category term="Cpp" scheme="https://blog.musnow.top/tags/Cpp/"/>
    
    <category term="KMP" scheme="https://blog.musnow.top/tags/KMP/"/>
    
  </entry>
  
  <entry>
    <title>ã€Linuxã€‘Linux64ä½ç¯å¢ƒä¸‹ç¼–è¯‘32ä½æŠ¥é”™çš„è§£å†³åŠæ³•</title>
    <link href="https://blog.musnow.top/posts/3573352712/"/>
    <id>https://blog.musnow.top/posts/3573352712/</id>
    <published>2024-02-24T03:04:53.000Z</published>
    <updated>2024-02-24T03:09:52.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>å¦‚é¢˜ï¼Œå½“æˆ‘å°è¯•åœ¨wsl2çš„ubuntuä¸­ä½¿ç”¨<code>-m32</code>é€‰é¡¹ç¼–è¯‘32ä½ç¨‹åºçš„æ—¶å€™ï¼Œå‡ºç°äº†ä¸‹é¢çš„ä¸¤ç§æŠ¥é”™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â¯ g++ -m32 test.cpp -o test1 &amp;&amp; ./test1</span><br><span class="line">In file included from test.cpp:1:</span><br><span class="line">/usr/include/stdio.h:27:10: fatal error: bits/libc-header-start.h: No such file or directory</span><br><span class="line">   27 | #include &lt;bits/libc-header-start.h&gt;</span><br><span class="line">      |          ^~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">compilation terminated.</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â¯ g++ -m32 test.cpp -o test1 &amp;&amp; ./test1</span><br><span class="line">/usr/bin/ld: skipping incompatible /usr/lib/gcc/x86_64-linux-gnu/11/libstdc++.so when searching for -lstdc++</span><br><span class="line">/usr/bin/ld: skipping incompatible /usr/lib/gcc/x86_64-linux-gnu/11/libstdc++.a when searching for -lstdc++</span><br><span class="line">/usr/bin/ld: cannot find -lstdc++: No such file or directory</span><br><span class="line">/usr/bin/ld: skipping incompatible /usr/lib/gcc/x86_64-linux-gnu/11/libstdc++.so when searching for -lstdc++</span><br><span class="line">collect2: error: ld returned 1 exit status</span><br></pre></td></tr></table></figure><h2 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h2><p>åŸå› æ˜¯å½“å‰ç¼ºå°‘32ä½çš„å¼€å‘åº“ï¼Œéœ€è¦å®‰è£…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install gcc-multilib g++-multilib libc6-dev-i386 -y</span><br></pre></td></tr></table></figure><p>å®‰è£…åé‡è¯•ï¼Œç¼–è¯‘æˆåŠŸã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â¯ g++ -m32  test.cpp -o test1 &amp;&amp; ./test1</span><br><span class="line">4</span><br></pre></td></tr></table></figure><p>ä»£ç å¾ˆç®€å•ï¼Œæ˜¯ä¸€ä¸ªæ‰“å°æŒ‡é’ˆå¤§å°çš„ä»£ç ï¼Œåœ¨32ä½ä¸‹æŒ‡é’ˆå¤§å°æ˜¯4ï¼Œ64ä½ä¸‹æŒ‡é’ˆå¤§å°æ˜¯8ï¼›</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">void</span> * ptr= <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">sizeof</span>(ptr));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ›´å¤šè¯´æ˜"><a href="#æ›´å¤šè¯´æ˜" class="headerlink" title="æ›´å¤šè¯´æ˜"></a>æ›´å¤šè¯´æ˜</h2><p>åœ¨linuxä¸‹å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ä½ çš„ç³»ç»Ÿä½æ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â¯ getconf LONG_BIT</span><br><span class="line">64</span><br></pre></td></tr></table></figure><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://stackoverflow.com/questions/60553541/usr-bin-ld-skipping-incompatible-usr-lib-gcc-x86-64-linux-gnu-9-libstdc-a-w">assembly - &#x2F;usr&#x2F;bin&#x2F;ld: skipping incompatible &#x2F;usr&#x2F;lib&#x2F;gcc&#x2F;x86_64-linux-gnu&#x2F;9&#x2F;libstdc++.a when searching for -lstdc++ &#x2F;usr&#x2F;bin&#x2F;ld: cannot find -lstdc++ - Stack Overflow</a></p>]]></content>
    
    
    <summary type="html">64ä½linuä¸‹ç¼–è¯‘32ä½ç¨‹åºå‡ºé”™ï¼Œæç¤ºskipping incompatible</summary>
    
    
    
    <category term="ç¼–ç¨‹å­¦ä¹ " scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="Linux" scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/Linux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="wsl" scheme="https://blog.musnow.top/tags/wsl/"/>
    
    <category term="ubuntu" scheme="https://blog.musnow.top/tags/ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>ã€é¡¹ç›®ã€‘é«˜å¹¶å‘å†…å­˜æ± é¡¹ç›®çš„å­¦ä¹ </title>
    <link href="https://blog.musnow.top/posts/4231483511/"/>
    <id>https://blog.musnow.top/posts/4231483511/</id>
    <published>2024-02-20T13:32:14.000Z</published>
    <updated>2024-03-03T06:03:25.000Z</updated>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ ä¸€ä¸‹ç±»ä¼¼äºè°·æ­Œtcmallocçš„é«˜å¹¶å‘å†…å­˜æ± ã€‚</p><p>é¡¹ç›®ä»£ç éƒ½åœ¨<a href="https://github.com/musnows/MemoryPool">GitHub</a>ä¸Šäº†ï¼Œæœ¬æ–‡æ˜¯å¯¹é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­çš„è®¾è®¡å­¦ä¹ ä»¥åŠé‡åˆ°é—®é¢˜çš„è§£å†³æ–¹æ³•ã€‚</p><p>å¤‡æ³¨ï¼šå½“å‰é¡¹ç›®åœ¨Linuxä¸Šè¿è¡Œæœ‰äº›é—®é¢˜ï¼ˆmmapåœ°å€å¯¹é½æ²¡æœ‰è§£å†³ï¼‰ï¼Œæ‰€ä»¥æš‚æ—¶åªèƒ½åœ¨win32ä¸Šå¼€å‘ï¼</p><h1 id="1-ä»€ä¹ˆæ˜¯å†…å­˜æ± "><a href="#1-ä»€ä¹ˆæ˜¯å†…å­˜æ± " class="headerlink" title="1.ä»€ä¹ˆæ˜¯å†…å­˜æ± "></a>1.ä»€ä¹ˆæ˜¯å†…å­˜æ± </h1><p>æ ¸å¿ƒæ€æƒ³ï¼šå†…å­˜æ± é¢„å…ˆç”³è¯·å¤§å—å†…å­˜ï¼Œå½“å…¶ä»–ä»£ç éœ€è¦ç”³è¯·å †åŒºå†…å­˜æ—¶ï¼Œä¸è°ƒç”¨malloc&#x2F;newï¼Œè€Œæ˜¯è°ƒç”¨æˆ‘ä»¬è‡ªå·±å®ç°çš„å†…å­˜æ± çš„æ¥å£æ¥ç”³è¯·å†…å­˜ã€‚</p><p>å› ä¸ºå†…å­˜æ± é‡Œé¢å·²ç»é¢„å…ˆç”³è¯·äº†å¾ˆå¤šå†…å­˜ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç›´æ¥åˆ†é…ç»™å…¶ä»–æ¨¡å—ã€‚è€Œåˆ†é…å·²ç»ç”³è¯·çš„å†…å­˜ä¼šæ¯”ä½¿ç”¨malloc&#x2F;newå‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜å¿«éå¸¸å¤šï¼</p><blockquote><p>è¿™å°±å¥½æ¯”åœ¨å®¶é‡Œå±¯ä¸€ç‚¹çº¸å·¾ï¼Œå½“çº¸å·¾æ²¡äº†ï¼Œç›´æ¥ç”¨å®¶é‡Œçš„çº¸å·¾ï¼Œä¸ç”¨å»å°å–éƒ¨é‡æ–°ä¹°äº†ï¼Œè‡ªç„¶ä¼šå¿«ä¸€äº›ã€‚</p></blockquote><p>è€Œmalloc&#x2F;newè¿™äº›èƒ½é€‚é…æ‰€æœ‰åœºæ™¯çš„å†…å­˜ç”³è¯·å‡½æ•°ï¼Œè‡ªç„¶ä¼šæœ‰é¢å¤–çš„æ€§èƒ½æŸå¤±ï¼Œå½“ä¸€ä¸ªç³»ç»Ÿå¯¹æ€§èƒ½è¦æ±‚å¾ˆé«˜çš„æ—¶å€™ï¼Œä½¿ç”¨å†…å­˜æ± æ¥é¢„å…ˆç”³è¯·+åˆ†é…å†…å­˜ï¼Œå°±å¯ä»¥èŠ‚çœä¸å°‘çš„æ—¶é—´ï¼Œæé«˜ç³»ç»Ÿè¿è¡Œæ•ˆç‡ã€‚</p><p>å› ä¸ºæˆ‘ä»¬æ˜¯è‡ªå·±å®ç°äº†ä¸€ä¸ªå†…å­˜æ± ï¼Œç›¸å½“äºæ›¿ä»£äº†malloc&#x2F;newçš„å·¥ä½œï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨åº•å±‚çš„ç³»ç»Ÿè°ƒç”¨æ¥å£æ¥ç›´æ¥å‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜ï¼ˆmalloc&#x2F;newä¼šæœ‰é¢å¤–å°è£…ï¼‰</p><ul><li>windows: VirtualAlloc</li><li>Linux: BRKæˆ–MMAP</li></ul><p>åˆ†é…å†…å­˜åï¼Œå¦‚æœæ˜¯C++çš„å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡<code>å®šä½new</code>æ¥è°ƒç”¨ç±»çš„æ„é€ å‡½æ•°ã€‚</p><h2 id="1-1-ä»€ä¹ˆæ˜¯é«˜å¹¶å‘å†…å­˜æ± "><a href="#1-1-ä»€ä¹ˆæ˜¯é«˜å¹¶å‘å†…å­˜æ± " class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯é«˜å¹¶å‘å†…å­˜æ± "></a>1.1 ä»€ä¹ˆæ˜¯é«˜å¹¶å‘å†…å­˜æ± </h2><p>è¿™ä¸ªé¡¹ç›®æƒ³å®ç°çš„é«˜å¹¶å‘å†…å­˜æ± ï¼Œå°±æ˜¯åœ¨å®ç°ä¸€ä¸ªå†…å­˜æ± çš„åŸºç¡€ä¸Šï¼Œè¦æ»¡è¶³å¤šçº¿ç¨‹é«˜å¹¶å‘è¯·æ±‚ç©ºé—´ç”³è¯·æ—¶çš„æ€§èƒ½å’Œä¸å‡ºé”™ã€‚</p><p>è¿™å°±æ¶‰åŠåˆ°å¤šçº¿ç¨‹ç«äº‰ä»¥åŠåŠ é”æœºåˆ¶äº†ï¼Œåæ–‡ä¼šè¡¥å…¨ã€‚</p><h2 id="1-2-å†…ç¢ç‰‡å’Œå¤–ç¢ç‰‡"><a href="#1-2-å†…ç¢ç‰‡å’Œå¤–ç¢ç‰‡" class="headerlink" title="1.2 å†…ç¢ç‰‡å’Œå¤–ç¢ç‰‡"></a>1.2 å†…ç¢ç‰‡å’Œå¤–ç¢ç‰‡</h2><ul><li>å†…ç¢ç‰‡ï¼šçº¿ç¨‹æ± å†…éƒ¨åˆ†é…äº†å´æ²¡æœ‰ä½¿ç”¨çš„å†…å­˜</li><li>å¤–ç¢ç‰‡ï¼šè¿›ç¨‹åœ°å€ç©ºé—´ä¸­ï¼Œåˆ†é…äº†å¤šå—å†…å­˜ï¼Œæ²¡æœ‰å…¨éƒ¨å›æ”¶ï¼Œå¯¼è‡´å‰©ä½™çš„å†…å­˜è™½ç„¶æœ‰è¶³å¤Ÿå¤§å°ï¼Œä½†ä¸è¿ç»­ï¼Œæ— æ³•å®ç°å¤§å†…å­˜åˆ†é…ã€‚</li></ul><p>å†…ç¢ç‰‡å’Œå¤–ç¢ç‰‡çš„åœºæ™¯å¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/deb006a52f219b90261c67e6e6b9b35f.png" alt="image-20240224103722887"></p><p>å‡è®¾ä¸€ä¸ªè¿›ç¨‹ç”³è¯·äº†512KBçš„å†…å­˜ï¼Œå´å§‹ç»ˆåªä½¿ç”¨äº†400KBï¼Œè¿™é‡Œå°±å‡ºç°äº†112KBçš„<strong>å†…ç¢ç‰‡</strong>ï¼ˆç”³è¯·äº†ä½†æ²¡æœ‰å®Œå…¨ä½¿ç”¨ï¼‰ï¼›</p><p>å¤–ç¢ç‰‡å°±çœ‹å›¾å§ï¼Œæ–‡å­—æè¿°ä¸æ¸…æ¥šã€‚</p><h1 id="2-å®šé•¿å†…å­˜æ± çš„å®ç°"><a href="#2-å®šé•¿å†…å­˜æ± çš„å®ç°" class="headerlink" title="2.å®šé•¿å†…å­˜æ± çš„å®ç°"></a>2.å®šé•¿å†…å­˜æ± çš„å®ç°</h1><h2 id="2-1-æ€è·¯"><a href="#2-1-æ€è·¯" class="headerlink" title="2.1 æ€è·¯"></a>2.1 æ€è·¯</h2><p>å¯¹äºå®šé•¿å†…å­˜æ± è€Œè¨€ï¼Œå®ç°æ¯”è¾ƒç®€å•</p><ul><li>ç”³è¯·å¤§å—ç©ºé—´ï¼›</li><li>ä½¿ç”¨é“¾è¡¨çš„æ–¹å¼æ¥é“¾æ¥è¿™äº›ç©ºé—´ï¼›</li><li>å½“ç”³è¯·çš„æ—¶å€™ï¼Œé‡Šæ”¾é“¾è¡¨å¤´éƒ¨çš„ç©ºé—´ï¼›</li><li>å½“é”€æ¯çš„æ—¶å€™ï¼Œä½¿ç”¨é“¾è¡¨å¤´æ’å°†ç©ºé—´å¤åŸåˆ°é“¾è¡¨ä¸­ï¼›</li><li>å½“ç©ºé—´ä¸å¤Ÿç”¨çš„æ—¶å€™ï¼ˆé“¾è¡¨ä¸ºç©ºï¼‰é‡æ–°ç”³è¯·å¤§å—ç©ºé—´ï¼›</li></ul><p>ä¸ºäº†å®ç°é“¾è¡¨çš„ç»“æ„ï¼Œå®šé•¿å†…å­˜æ± çš„å•ä¸ªç©ºé—´åˆ†ç‰‡çš„å¤§å°åº”è¯¥å¤§äºå¹³å°ä¸­ä¸€ä¸ªæŒ‡é’ˆçš„å¤§å°ï¼ˆä¸ç„¶æ²¡æœ‰åŠæ³•å®ç°æŒ‡å‘ä¸‹ä¸€å—ç©ºé—´çš„åœ°å€ï¼‰</p><p>å› ä¸ºå†…å­˜æ± ä¸­çš„å†…å­˜å·²ç»è¢«åˆ†é…å‡ºå»äº†ï¼ˆä¼šæœ‰ç¢ç‰‡ï¼‰æ‰€ä»¥å†…å­˜æ± ç”³è¯·çš„å†…å­˜æ˜¯ä¸èƒ½è¢«é‡Šæ”¾çš„ã€‚å¦‚æœä¸€ç›´æ²¡æœ‰æ¨¡å—ä»å†…å­˜æ± ä¸­ç”³è¯·å†…å­˜ï¼Œå°±å¯èƒ½ä¼šäº§ç”Ÿå†…å­˜çš„æµªè´¹ã€‚ä½†è¿™å’Œå†…å­˜æ± çš„åŠŸèƒ½<strong>ç›¸æ‚–</strong>ï¼šå¦‚æœç³»ç»Ÿç”³è¯·å†…å­˜çš„é¢‘ç‡å¾ˆä½ï¼Œé‚£è¯´æ˜ä¸éœ€è¦å†…å­˜æ± çš„ä»‹å…¥ã€‚</p><p>åªè¦æœ€ç»ˆå†…å­˜æ± çš„è¿›ç¨‹æ˜¯æ­£å¸¸ç»“æŸçš„ï¼Œè¿™äº›è¢«ç”³è¯·çš„å†…å­˜éƒ½ä¼šè¢«æ“ä½œç³»ç»Ÿæ‰˜ç®¡å’Œé‡Šæ”¾ã€‚</p><h2 id="2-2-å›¾è§£"><a href="#2-2-å›¾è§£" class="headerlink" title="2.2 å›¾è§£"></a>2.2 å›¾è§£</h2><p>åˆå§‹åŒ–çº¿ç¨‹æ± æ—¶ï¼Œä¼šå…ˆç”³è¯·å¤§å—å†…å­˜ï¼Œå¹¶ç”¨æŒ‡é’ˆæŒ‡å‘å†…å­˜å¼€å¤´ã€‚</p><p>å½“æœ‰æ¨¡å—ç”³è¯·å†…å­˜æ—¶ï¼Œå°†å†…å­˜å¼€å¤´çš„éƒ¨åˆ†åˆ†é…å‡ºå»ï¼Œå¹¶å‘åç§»åŠ¨æŒ‡é’ˆï¼ˆåŒæ—¶è¿˜éœ€å°†å†…å­˜å¤§å°è®¡æ•°å™¨ç»™å‡å°ï¼‰</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/5ee43b02da15875217fe4be4eb44b42f.png" alt="image-20240223130822219"></p><p>å½“å›æ”¶å†…å­˜æ—¶ï¼Œå°†å¦å¤–ä¸€ä¸ªæŒ‡é’ˆFREELISTæŒ‡å‘è¢«å›æ”¶å†…å­˜çš„å¼€å¤´ï¼Œå¹¶å°†è¢«å›æ”¶å†…å­˜çš„å‰4&#x2F;8ä¸ªå­—èŠ‚æŒ‡å‘NULLPTRæˆ–è€…å¦å¤–ä¸€ä¸ªè¢«å›æ”¶çš„å†…å­˜åˆ†ç‰‡ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/55ba510435b21c825e098dfa5ff0e195.png" alt="image-20240223131544965"></p><p>å½“FREELISTä¸ºç©ºï¼Œä¸”ç”¨äºæ ‡ç¤ºé¢„å…ˆç”³è¯·çš„å¤§å—å†…å­˜å‰©ä½™å®¹é‡çš„sizeä¸º0çš„æ—¶å€™ï¼Œå°±éœ€è¦é‡æ–°ç”³è¯·å†…å­˜äº†ï¼ˆä»£è¡¨å½“å‰çº¿ç¨‹æ± å·²ç»æ²¡æœ‰å¯åˆ†é…çš„å†…å­˜ï¼‰</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/7224a6c2f4a743dd0098d0fe83f108c8.png" alt="image-20240223132634407"></p><p>å®šé•¿å†…å­˜æ± çš„æ€è·¯è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚</p><h2 id="2-3-ä»£ç å®ç°"><a href="#2-3-ä»£ç å®ç°" class="headerlink" title="2.3 ä»£ç å®ç°"></a>2.3 ä»£ç å®ç°</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FixMemoryPool</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function">T* <span class="title">New</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">T* obj = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼˜å…ˆæŠŠè¿˜å›æ¥å†…å­˜å—å¯¹è±¡ï¼Œå†æ¬¡é‡å¤åˆ©ç”¨</span></span><br><span class="line"><span class="keyword">if</span> (_freeList)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">void</span>* next = *((<span class="type">void</span>**)_freeList);</span><br><span class="line">obj = (T*)_freeList;</span><br><span class="line">_freeList = next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// å‰©ä½™å†…å­˜ä¸å¤Ÿä¸€ä¸ªå¯¹è±¡å¤§å°æ—¶ï¼Œåˆ™é‡æ–°å¼€å¤§å—ç©ºé—´</span></span><br><span class="line"><span class="keyword">if</span> (_remainBytes &lt; <span class="built_in">sizeof</span>(T))</span><br><span class="line">&#123;</span><br><span class="line">_remainBytes = <span class="number">128</span> * <span class="number">1024</span>;</span><br><span class="line">_memory = (<span class="type">char</span>*)<span class="built_in">malloc</span>(_remainBytes);</span><br><span class="line"><span class="keyword">if</span> (_memory == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">throw</span> std::<span class="built_in">bad_alloc</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj = (T*)_memory;</span><br><span class="line"><span class="type">size_t</span> objSize = <span class="built_in">sizeof</span>(T) &lt; <span class="built_in">sizeof</span>(<span class="type">void</span>*) ? <span class="built_in">sizeof</span>(<span class="type">void</span>*) : <span class="built_in">sizeof</span>(T);</span><br><span class="line">_memory += objSize;</span><br><span class="line">_remainBytes -= objSize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä½newï¼Œæ˜¾ç¤ºè°ƒç”¨Tçš„æ„é€ å‡½æ•°åˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">new</span>(obj)T; <span class="comment">// å³ä¾¿æ˜¯PODç±»å‹ä¹Ÿæ˜¯æœ‰ä¸ªæ„é€ å‡½æ•°çš„</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Delete</span><span class="params">(T* obj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// æ˜¾ç¤ºè°ƒç”¨ææ„å‡½æ•°</span></span><br><span class="line">obj-&gt;~<span class="built_in">T</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤´æ’ï¼Œä½¿ç”¨void*å¼ºè½¬èƒ½ä¿è¯è½¬æ¢åçš„ç©ºé—´ä¸€å®šæ˜¯ä¸ªæŒ‡é’ˆçš„å¤§å°</span></span><br><span class="line">*(<span class="type">void</span>*)obj = _freeList; <span class="comment">// æŒ‡å‘åŸæœ¬çš„freelistå¼€å¤´çš„åœ°å€</span></span><br><span class="line">_freeList = obj; <span class="comment">// æ›´æ–°å¤´èŠ‚ç‚¹</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">char</span>* _memory = <span class="literal">nullptr</span>; <span class="comment">// æŒ‡å‘å¤§å—å†…å­˜çš„æŒ‡é’ˆ</span></span><br><span class="line"><span class="type">size_t</span> _remainBytes = <span class="number">0</span>; <span class="comment">// å¤§å—å†…å­˜åœ¨åˆ‡åˆ†è¿‡ç¨‹ä¸­å‰©ä½™å­—èŠ‚æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span>* _freeList = <span class="literal">nullptr</span>; <span class="comment">// è¿˜å›æ¥è¿‡ç¨‹ä¸­é“¾æ¥çš„è‡ªç”±é“¾è¡¨çš„å¤´æŒ‡é’ˆ</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2-4-æ€§èƒ½æµ‹è¯•"><a href="#2-4-æ€§èƒ½æµ‹è¯•" class="headerlink" title="2.4 æ€§èƒ½æµ‹è¯•"></a>2.4 æ€§èƒ½æµ‹è¯•</h2><p>ä¸‹é¢ç”¨å¾ªç¯ç”³è¯·å†…å­˜çš„æ–¹å¼æ¥æµ‹è¯•ä¸€ä¸‹è¿™ä¸ªå®šé•¿å†…å­˜æ± çš„æ•ˆæœã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TreeNode</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> _val;</span><br><span class="line">TreeNode* _left;</span><br><span class="line">TreeNode* _right;</span><br><span class="line"></span><br><span class="line"><span class="built_in">TreeNode</span>()</span><br><span class="line">:_val(<span class="number">0</span>)</span><br><span class="line">, _left(<span class="literal">nullptr</span>)</span><br><span class="line">, _right(<span class="literal">nullptr</span>)</span><br><span class="line">&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">const</span> <span class="type">size_t</span> Rounds = <span class="number">5</span>; <span class="comment">// ç”³è¯·é‡Šæ”¾çš„è½®æ¬¡</span></span><br><span class="line"><span class="type">const</span> <span class="type">size_t</span> N = <span class="number">100000</span>; <span class="comment">// æ¯è½®ç”³è¯·é‡Šæ”¾å¤šå°‘æ¬¡</span></span><br><span class="line"></span><br><span class="line">std::vector&lt;TreeNode*&gt; v1;</span><br><span class="line">v1.<span class="built_in">reserve</span>(N);</span><br><span class="line"><span class="comment">// newçš„è€—æ—¶æµ‹è¯•</span></span><br><span class="line"><span class="type">size_t</span> begin1 = <span class="built_in">clock</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> j = <span class="number">0</span>; j &lt; Rounds; ++j)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">&#123;</span><br><span class="line">v1.<span class="built_in">push_back</span>(<span class="keyword">new</span> TreeNode);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">delete</span> v1[i];</span><br><span class="line">&#125;</span><br><span class="line">v1.<span class="built_in">clear</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">size_t</span> end1 = <span class="built_in">clock</span>();</span><br><span class="line"></span><br><span class="line">std::vector&lt;TreeNode*&gt; v2;</span><br><span class="line">v2.<span class="built_in">reserve</span>(N);</span><br><span class="line"><span class="comment">// å®šé•¿å†…å­˜æ± çš„è€—æ—¶æµ‹è¯•</span></span><br><span class="line">FixMemoryPool&lt;TreeNode&gt; TNPool;</span><br><span class="line"><span class="type">size_t</span> begin2 = <span class="built_in">clock</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> j = <span class="number">0</span>; j &lt; Rounds; ++j)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">&#123;</span><br><span class="line">v2.<span class="built_in">push_back</span>(TNPool.<span class="built_in">New</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">&#123;</span><br><span class="line">TNPool.<span class="built_in">Delete</span>(v2[i]);</span><br><span class="line">&#125;</span><br><span class="line">v2.<span class="built_in">clear</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">size_t</span> end2 = <span class="built_in">clock</span>();</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;new cost time:&quot;</span> &lt;&lt; end1 - begin1 &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;memory pool cost time:&quot;</span> &lt;&lt; end2 - begin2 &lt;&lt; endl;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨vs2019çš„x86-debugæ¨¡å¼ä¸‹è¿è¡Œï¼ŒäºŒè€…çš„æ—¶é—´æ¶ˆè€—å·²ç»å¯¹æ¯”æ˜æ˜¾</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">new cost time:195</span><br><span class="line">memory pool cost time:100</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨x86-releaseçš„æ¨¡å¼è¿è¡Œï¼Œæ—¶é—´æ¶ˆè€—å·®è·å°±æ›´å¤§äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">new cost time:21</span><br><span class="line">memory pool cost time:1</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯çº¿ç¨‹æ± å­˜åœ¨çš„æ„ä¹‰ã€‚</p><h1 id="3-æ•´ä½“æ¡†æ¶è®¾è®¡"><a href="#3-æ•´ä½“æ¡†æ¶è®¾è®¡" class="headerlink" title="3.æ•´ä½“æ¡†æ¶è®¾è®¡"></a>3.æ•´ä½“æ¡†æ¶è®¾è®¡</h1><p>ç®€å•å®ç°äº†ä¸€ä¸ªå®šé•¿çš„å†…å­˜æ± ï¼Œä¸‹é¢å°±è¦å­¦ä¹ ä¸€ä¸‹å¦‚ä½•å®ç°ä¸€ä¸ªé«˜å¹¶å‘çš„å†…å­˜æ± ã€‚è°·æ­Œçš„tcmallocåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šæœ‰æ›´å¥½çš„æ€§èƒ½ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿè®¾è®¡æ—¶ä¹Ÿéœ€è¦è€ƒè™‘ç›¸å…³çš„é—®é¢˜ï¼š</p><ul><li>æ€§èƒ½åº”è¯¥ä¼˜äºmalloc&#x2F;newï¼›</li><li>å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ç«äº‰å’Œé”ç”³è¯·é—®é¢˜ï¼›</li><li>å†…å­˜ç¢ç‰‡é—®é¢˜ï¼›</li></ul><p>æœ€ç»ˆçš„è®¾è®¡ä¸»è¦ç”±ä¸‹é¢ä¸‰ä¸ªéƒ¨åˆ†æ„æˆ</p><ol><li>ThreadCacheï¼šä¾›æ¯ä¸ªçº¿ç¨‹ç‹¬æœ‰ï¼Œç”¨äºå°äº<code>256KB</code>çš„å†…å­˜åˆ†é…ï¼Œå› ä¸ºæ¯ä¸ªçº¿ç¨‹ç‹¬æœ‰ä¸€ä¸ªThreadCacheï¼Œçº¿ç¨‹ä»è¿™é‡Œç”³è¯·å†…å­˜æ—¶ä¸éœ€è¦åŠ é”ï¼Œæ•ˆç‡é«˜ï¼›</li><li>CentralCacheï¼šä¸­å¿ƒç¼“å­˜ä¾›æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼ŒThreadCacheæŒ‰éœ€ä»CentralCacheä¸­è·å–å†…å­˜ã€‚CentralCacheåœ¨åˆé€‚çš„æ—¶å€™å›æ”¶åˆ†é…ç»™çº¿ç¨‹çš„ThreadCacheï¼Œé¿å…æŸä¸ªçº¿ç¨‹å ç”¨å¤ªå¤šæœªä½¿ç”¨çš„å†…å­˜ï¼Œè¾¾åˆ°å¤šä¸ªçº¿ç¨‹å‡è¡¡è°ƒåº¦çš„ç›®çš„ã€‚CentralCacheå­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œéœ€è¦åŠ é”ï¼›</li><li>PageCacheï¼šä»¥é¡µä¸ºå•ä½å‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜ã€‚å½“CentralCacheæ²¡æœ‰å†…å­˜å¯åˆ†é…æ—¶ä¼šå‘PageCacheç”³è¯·ï¼ŒPageCacheä¼šå‘æ“ä½œç³»ç»Ÿç”³è¯·ä¸€å®šçš„Pageçš„å†…å­˜æ”¾å…¥<code>span</code>å¯¹è±¡ï¼Œè¿™ä¸ªå¤§å—å†…å­˜ä¼šåœ¨<code>span</code>å†…éƒ¨åˆ‡å‰²æˆå¤šä¸ªå®šé•¿å¤§å°çš„å°å—å†…å­˜ï¼Œæœ€ç»ˆç»™CentralCacheçš„æ˜¯<code>span</code>å¯¹è±¡ã€‚å½“ä¸€ä¸ª<code>span</code>çš„å†…éƒ¨å°å—å†…å­˜éƒ½è¢«å›æ”¶åï¼ŒPageCacheä¼šå›æ”¶CentralCacheä¸­æ»¡è¶³æ¡ä»¶çš„å†…å­˜<code>span</code>å¯¹è±¡ï¼Œå¹¶åˆå¹¶ç›¸é‚»çš„é¡µï¼Œç»„æˆæ›´å¤§çš„é¡µï¼Œç¼“è§£å†…å­˜ç¢ç‰‡é—®é¢˜ï¼›</li></ol><p>ä¸‹å›¾æ˜¯è¿™ä¸ªæ¡†æ¶çš„ç¤ºæ„</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/c03c4843d4f6b153fc536709b8864c05.png" alt="image-20240223160514186"></p><p>ä¸‰å±‚è®¾è®¡åï¼Œæ¯ä¸€å±‚çš„å·¥ä½œéƒ½ä¸ä¸€æ ·äº†</p><ul><li>ThreadCacheï¼šä¸ºçº¿ç¨‹åˆ†é…ç©ºé—´ï¼›</li><li>CentralCacheï¼šä¸ºThreadCacheåˆ†é…ç©ºé—´å¹¶å›æ”¶éƒ¨åˆ†ç©ºé—´ï¼›</li><li>PageCacheï¼šåˆ†é¡µç®¡ç†å’Œå‘æ“ä½œç³»ç»Ÿè·å–ç©ºé—´ï¼›</li></ul><p>å…¶ä¸­ï¼Œåªæœ‰å¤šä¸ªThreadCacheåŒæ—¶æ²¡å†…å­˜éœ€è¦å‘CentralCacheç”³è¯·çš„æ—¶å€™ï¼Œæ‰ä¼šå‡ºç°<strong>åŠ é”</strong>çš„é—®é¢˜ã€‚è¿™ç§æƒ…å†µå…¶å®æ˜¯ä¸å¤šçš„ï¼Œæ‰€ä»¥CentralCacheå¹¶ä¸ä¼šæœ‰ç‰¹åˆ«å¤§çš„é”ç«äº‰é—®é¢˜ã€‚</p><p>è€Œä¸”ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ç”³è¯·å†…å­˜å¤§å°éƒ½ä¸ä¼šå¤§äº256KBï¼Œæ‰€ä»¥ThreadCacheæ˜¯åŸºæœ¬èƒ½æ»¡è¶³çº¿ç¨‹ç”³è¯·ç©ºé—´çš„éœ€æ±‚çš„ã€‚ä¸Šè¿°äºŒè€…ç»“åˆï¼Œå°±æé«˜äº†å¤šçº¿ç¨‹å¹¶å‘çš„æ•ˆç‡ã€‚</p><h1 id="4-ThreadCacheè®¾è®¡"><a href="#4-ThreadCacheè®¾è®¡" class="headerlink" title="4.ThreadCacheè®¾è®¡"></a>4.ThreadCacheè®¾è®¡</h1><p>ThreadCacheåªå¯¹ä¸€ä¸ªçº¿ç¨‹æœåŠ¡ï¼Œå®ƒçš„è®¾è®¡æ€è·¯å’Œå®šé•¿å†…å­˜æ± å…¶å®æ˜¯éå¸¸ç›¸ä¼¼çš„ã€‚ä¸è¿‡ThreadCacheéœ€è¦æ”¯æŒä¸å®šé•¿å†…å­˜çš„åˆ†é…ï¼Œéœ€è¦å¯¹å›æ”¶å†…å­˜çš„FreeListåšè®¾è®¡ä¸Šçš„æ›´æ­£ã€‚</p><h2 id="4-1-å“ˆå¸Œæ¡¶"><a href="#4-1-å“ˆå¸Œæ¡¶" class="headerlink" title="4.1 å“ˆå¸Œæ¡¶"></a>4.1 å“ˆå¸Œæ¡¶</h2><p>ä¸ºäº†æ›´åŠ æ–¹ä¾¿çš„ç®¡ç†ä¸åŒå¤§å°çš„å†…å­˜ç©ºé—´ç”³è¯·ï¼ŒThreadCacheé‡‡ç”¨äº†å“ˆå¸Œæ¡¶çš„æ–¹å¼ï¼Œä»¥ä¸€å®šç©ºé—´ä¸ºåˆ†å‰²ï¼Œé“¾æ¥ä¸åŒå¤§å°çš„å›æ”¶å†…å­˜ï¼Œç±»ä¼¼å¤šä¸ªä¸åŒå¤§å°çš„å®šé•¿è‡ªç”±é“¾è¡¨ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/5a0502f4b16d03e0f207c0c4971da9bd.png" alt="image-20240224104548066"></p><p>å½“çº¿ç¨‹éœ€è¦8å­—èŠ‚ä»¥ä¸‹ç©ºé—´æ—¶ï¼Œå°±ä»8å­—èŠ‚çš„æ¡¶é‡Œé¢åˆ†é…ç»™å®ƒï¼›å½“è¿›ç¨‹éœ€è¦8åˆ°16å­—èŠ‚ç©ºé—´æ—¶ï¼Œå°±ä»16å­—èŠ‚çš„æ¡¶é‡Œé¢åˆ†é…ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><p>å¾ˆæ˜æ˜¾ï¼Œè¿™ç§æ–¹å¼ä¼šäº§ç”Ÿ<strong>å†…ç¢ç‰‡</strong>ï¼Œæ¯”å¦‚ç”³è¯·5å­—èŠ‚ç©ºé—´ï¼ŒThreadCacheè¿˜æ˜¯ä¼šä»8å­—èŠ‚çš„æ¡¶ä¸­åˆ†é…ç»™å®ƒï¼Œå‡ºç°äº†3å­—èŠ‚çš„ç©ºé—´æµªè´¹ã€‚</p><p>ä½†è¿™ä¸ªç©ºé—´æµªè´¹æ˜¯å¿…é¡»æ¥å—çš„ï¼Œå¦åˆ™å°±éœ€è¦ç”¨æ›´åŠ å¤æ‚çš„æ–¹å¼æ¥ç®¡ç†å›æ”¶çš„ç©ºé—´ï¼ˆæ¯”å¦‚åœ¨å†…å­˜ä¸­è®°å½•è‡ªå·±çš„å¤§å°ï¼‰ï¼Œåˆ†é…çš„æ—¶å€™è¿˜éœ€è¦éå†æ‰¾åˆ°åˆé€‚å¤§å°çš„å†…å­˜æ¥åˆ†é…ï¼Œæ•ˆç‡åè€Œä¼šé™ä½ã€‚</p><h2 id="4-2-åˆ†é…æ˜ å°„è§„åˆ™"><a href="#4-2-åˆ†é…æ˜ å°„è§„åˆ™" class="headerlink" title="4.2 åˆ†é…æ˜ å°„è§„åˆ™"></a>4.2 åˆ†é…æ˜ å°„è§„åˆ™</h2><p>ä½†æ˜¯ï¼Œå¦‚æœæ•´ä¸ªå“ˆå¸Œæ¡¶éƒ½ç”¨8å­—èŠ‚æ¥åšåˆ†å‰²ï¼Œæœ€ç»ˆæ•´ä¸ªå“ˆå¸Œæ¡¶çš„æ•°ç»„éƒ¨åˆ†å°±ä¼šéå¸¸éå¸¸é•¿ã€‚<br>$$<br>256KB&#x2F;8B &#x3D; 32768<br>$$<br>æ‰€ä»¥ï¼Œæœ€ç»ˆéœ€è¦é‡‡ç”¨ä¸€ä¸ªè®©å†…ç¢ç‰‡å°½é‡ä¿æŒåœ¨10%å·¦å³çš„å“ˆå¸Œæ˜ å°„ç®—æ³•ã€‚</p><table><thead><tr><th>å­—èŠ‚åŒºé—´</th><th>å¯¹é½æ–¹å¼</th><th>å“ˆå¸Œæ¡¶ä¸‹æ ‡åŒºé—´</th></tr></thead><tbody><tr><td>[1, 128]</td><td>8B</td><td>[0,16)</td></tr><tr><td>[128+1, 1024]</td><td>16B</td><td>[16,72)</td></tr><tr><td>[1024+1, 8*1024]</td><td>128B</td><td>[72,128)</td></tr><tr><td>[8*1024+1, 64*1024]</td><td>1024B</td><td>[128,184)</td></tr><tr><td>[64*1024+1,256*1024]</td><td>8*1024B</td><td>[184,208)</td></tr></tbody></table><p>è¿™ä¸ªè¡¨çš„å«ä¹‰æ˜¯ï¼Œå½“å­—èŠ‚èŒƒå›´åœ¨1åˆ°128ä¹‹é—´æ—¶ï¼Œå“ˆå¸Œæ¡¶çš„æ¯ä¸ªä¸‹æ ‡å¯¹åº”çš„freelistå†…å­˜å¤§å°ç›¸å·®<strong>8å­—èŠ‚</strong>ï¼›å½“å­—èŠ‚èŒƒå›´åœ¨129åˆ°1024å­—ä¹‹é—´æ—¶ï¼Œå“ˆå¸Œæ¡¶æ¯ä¸ªä¸‹æ ‡å¯¹åº”çš„freelistå†…å­˜å¤§å°ç›¸å·®<strong>16å­—èŠ‚</strong>â€¦â€¦</p><p>è¿™æ ·å°±å¯ä»¥æ§åˆ¶å†…ç¢ç‰‡åœ¨10%å·¦å³ï¼Œä»¥129å­—èŠ‚åˆ°1024å­—èŠ‚ä¸ºä¾‹ï¼Œæœ€ç»ˆæ˜ å°„çš„å“ˆå¸Œæ¡¶å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/afba0bd136dbd8bed517f978195b3955.png" alt="image-20240226093850295"></p><p>å½“ç”³è¯·129åˆ°144å­—èŠ‚ä¹‹é—´çš„ç©ºé—´æ—¶ï¼Œä¼šåˆ†é…144å­—èŠ‚çš„å†…å­˜å—ç»™çº¿ç¨‹ã€‚æ­¤æ—¶æœ€å¤§çš„ç©ºé—´æµªè´¹å°±æ˜¯è¿™<strong>144å­—èŠ‚ä¸­åªä½¿ç”¨äº†129å­—èŠ‚</strong>ã€‚æµªè´¹ç‡å¤§æ¦‚æ˜¯<code>10.5%</code>ï¼›å…¶ä»–åŒºé—´çš„å†…ç¢ç‰‡æµªè´¹ç‡ä¹Ÿæ˜¯ç”¨è¿™ä¸ªæ–¹å¼è®¡ç®—ã€‚</p><p>æ³¨æ„ï¼šå½“æˆ‘ä»¬è€ƒè™‘å†…ç¢ç‰‡æ—¶ï¼Œåªè€ƒè™‘çº¿ç¨‹æ± è®¾è®¡ä¼šé€ æˆçš„å†…ç¢ç‰‡é—®é¢˜ï¼Œè€Œä¸è€ƒè™‘çº¿ç¨‹æœ¬èº«ç”³è¯·äº†å´ä¸ç”¨é€ æˆçš„ç©ºé—´æµªè´¹ï¼ˆè¿™æ˜¯ä¸å¯é¢„æœŸçš„ï¼Œä¸”å’Œå†…å­˜æ± çš„è®¾è®¡æ²¡æœ‰å…³ç³»ï¼‰ã€‚</p><h2 id="4-3-ä»£ç -åˆ†é…å†…å­˜å¤§å°"><a href="#4-3-ä»£ç -åˆ†é…å†…å­˜å¤§å°" class="headerlink" title="4.3 ä»£ç -åˆ†é…å†…å­˜å¤§å°"></a>4.3 ä»£ç -åˆ†é…å†…å­˜å¤§å°</h2><p>ä¸‹é¢æ˜¯<strong>æŸä¸ªå¯¹é½åŒºé—´å†…</strong>ï¼Œè®¡ç®—éœ€è¦åˆ†é…çš„ç©ºé—´å¤§å°çš„å‡½æ•°</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// size: ç”³è¯·çš„å—å¤§å°</span></span><br><span class="line"><span class="comment">// align: å½“å‰å¯¹é½å¤§å°</span></span><br><span class="line"><span class="type">size_t</span> _RoundUp(<span class="type">size_t</span> size, <span class="type">size_t</span> align)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">size_t</span> returnSize;</span><br><span class="line">    <span class="keyword">if</span>(size % align == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        returnSize = size; <span class="comment">// èƒ½ç›´æ¥æ¨¡ä»£è¡¨å°±æ˜¯éœ€è¦çš„æœ€å¤§å€¼</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// å…¶ä»–ï¼Œè®¡ç®—å¯¹é½åŒºé—´å†…çš„æœ€å¤§å€¼</span></span><br><span class="line">        returnSize = (size/align + <span class="number">1</span>) * align;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> returnSize;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è¿™ä¸ªå‡½æ•°çš„é€»è¾‘è®¡ç®—ï¼Œå½“æˆ‘ä»¬éœ€è¦ç”³è¯·130å­—èŠ‚ç©ºé—´æ—¶ï¼ˆå¯¹é½å¤§å°æ˜¯16å­—èŠ‚ï¼Œåº”è¯¥è¿”å›144å­—èŠ‚ï¼‰ï¼Œè¿™ä¸ªå‡½æ•°è®¡ç®—å‡ºæ¥çš„ç»“æœä¹Ÿæ˜¯144ã€‚<br>$$<br>returnSize &#x3D; (130&#x2F;16 +1) * 16 &#x3D; 144<br>$$<br>è¿™ä¸ªç®—æ³•è¿˜æœ‰ä¸ªæ›´å–å·§çš„å†™æ³•ï¼Œç”¨åˆ°äº†ä½è¿ç®—ï¼Œä¸å¥½æƒ³ä¸å‡ºæ¥ã€‚ä½è¿ç®—çš„æ•ˆç‡ä¼šç•¥é«˜äºä¹˜é™¤æ³•ï¼Œæ‰€ä»¥é‡‡ç”¨è¿™ç§è®¾è®¡èƒ½æé«˜ä¸€å®šçš„æ•ˆç‡ï¼ˆå·²ç»æ˜¯å¾ˆæ·±å±‚çš„é—®é¢˜äº†ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">size_t</span> _RoundUp(<span class="type">size_t</span> size, <span class="type">size_t</span> align)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> ((size + align - <span class="number">1</span>) &amp; (~(align - <span class="number">1</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç®—æ³•æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿä»¥åŒºé—´9åˆ°16ä¸ºä¾‹ï¼ˆéƒ½éœ€è¦åˆ†é…16å­—èŠ‚çš„ç©ºé—´ï¼‰ï¼Œå‡è®¾éœ€è¦åˆ†é…10å­—èŠ‚ç©ºé—´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">10 + 8 - 1 = 17</span><br><span class="line">align - 1 = 8-1 = 7</span><br><span class="line"></span><br><span class="line">7çš„äºŒè¿›åˆ¶å¦‚ä¸‹</span><br><span class="line">0000 0111</span><br><span class="line">7çš„äºŒè¿›åˆ¶å–åå</span><br><span class="line">1111 1000</span><br><span class="line">17çš„äºŒè¿›åˆ¶</span><br><span class="line">0001 0001</span><br><span class="line"></span><br><span class="line">äºŒè€…ç›¸ä¸ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯16</span><br><span class="line">1111 1000</span><br><span class="line">0001 0001</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">0001 0000</span><br></pre></td></tr></table></figure><p>è¿™ç§ç‰›é€¼çš„ä½è¿ç®—æ–¹æ³•æˆ‘å¯æƒ³ä¸å‡ºæ¥â€¦â€¦ğŸ˜£</p><p>æœ‰äº†å•ä¸ªå¯¹é½åŒºé—´å†…è®¡ç®—å¤§å°çš„å‡½æ•°ï¼Œå‰©ä¸‹è¦åšçš„å°±æ˜¯æŠŠæ¯ä¸ªåŒºé—´å’Œå¯¹åº”çš„å¯¹é½å¤§å°ç»™ä¼ å‚è¿›å…¥è¿™ä¸ªå‡½æ•°å°±è¡Œäº†</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">size_t</span> <span class="title">RoundUp</span><span class="params">(<span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(size &lt;= <span class="number">128</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> _RoundUp(size,<span class="number">8</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(size&lt;=<span class="number">1024</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> _RoundUp(size,<span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(size &lt;= (<span class="number">8</span>*<span class="number">1024</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> _RoundUp(size,<span class="number">128</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(size &lt;= (<span class="number">64</span>*<span class="number">1024</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> _RoundUp(size,<span class="number">1024</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(size &lt;= (<span class="number">256</span>*<span class="number">1024</span>))</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">return</span> _RoundUp(size,<span class="number">8</span>*<span class="number">1024</span>);  </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// ä¸æ˜¯threadCacheè´Ÿè´£çš„èŒƒå›´äº†</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-4-ä»£ç -è®¡ç®—å“ˆå¸Œä¸‹æ ‡"><a href="#4-4-ä»£ç -è®¡ç®—å“ˆå¸Œä¸‹æ ‡" class="headerlink" title="4.4 ä»£ç -è®¡ç®—å“ˆå¸Œä¸‹æ ‡"></a>4.4 ä»£ç -è®¡ç®—å“ˆå¸Œä¸‹æ ‡</h2><p>é™¤äº†è®¡ç®—éœ€è¦åˆ†é…çš„å†…å­˜å¤§å°ï¼Œè¿˜éœ€è¦è®¡ç®—è¿™ä¸ªå†…å­˜åº”è¯¥é“¾æ¥åœ¨å“ˆå¸Œæ¡¶çš„å“ªä¸€ä¸ªä¸‹æ ‡ã€‚</p><ul><li>æŒ‡å®šä¸‹æ ‡çš„freelistæœ‰å‰©ä½™ç©ºé—´æ—¶ç›´æ¥åˆ†é…ï¼›</li><li>å¦‚æœæ²¡æœ‰ï¼Œåˆ™ä»é¢„å…ˆç”³è¯·çš„å¤§å—å†…å­˜ä¸­ç”³è¯·ï¼›</li></ul><p>å•ä¸ªåŒºé—´å†…è®¡ç®—ä¸‹æ ‡åç§»é‡çš„æ–¹å¼å¦‚ä¸‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// size: ç”³è¯·çš„å—å¤§å°</span></span><br><span class="line"><span class="comment">// align: å½“å‰å¯¹é½å¤§å°</span></span><br><span class="line"><span class="type">size_t</span> _Index(<span class="type">size_t</span> size, <span class="type">size_t</span> align)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (size % align == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> size / align - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> size / align;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä½è¿ç®—æ—¶å¯ä»¥é‡‡ç”¨å¦å¤–ä¸€ä¸ªå·§å¦™çš„è®¾è®¡æ–¹å¼ã€‚å°†1å·¦ç§»<code>align_shift</code>ä½ç›¸å½“äºè®¡ç®—2çš„<code>align_shift</code>æ¬¡æ–¹ï¼›</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// align_shiftæ˜¯å½“å‰å¯¹é½å¤§å°æ˜¯2çš„å‡ æ¬¡æ–¹ï¼Œå¦‚æœå¯¹é½å¤§å°æ˜¯8ï¼Œåˆ™ä¼ å‚3</span></span><br><span class="line"><span class="type">size_t</span> _Index(<span class="type">size_t</span> size, <span class="type">size_t</span> align_shift)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> ((size + (<span class="number">1</span> &lt;&lt; align_shift) - <span class="number">1</span>) &gt;&gt; align_shift) - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä½è¿ç®—çš„å‡½æ•°ï¼Œæœ€ç»ˆçš„è®¡ç®—ä»£ç å¦‚ä¸‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">size_t</span> <span class="title">Index</span><span class="params">(<span class="type">size_t</span> bytes)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">assert</span>(bytes &lt;= <span class="number">256</span>*<span class="number">1024</span>); <span class="comment">// ä¸èƒ½è¶…å‡ºThreadCacheçš„æœ€å¤§æœåŠ¡èŒƒå›´</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨æ•°ç»„è¡¨ç¤ºæ¯ä¸ªåŒºé—´æœ‰å¤šå°‘ä¸ªé“¾</span></span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> group_array[<span class="number">4</span>] = &#123; <span class="number">16</span>, <span class="number">56</span>, <span class="number">56</span>, <span class="number">56</span> &#125;;</span><br><span class="line">    <span class="keyword">if</span> (bytes &lt;= <span class="number">128</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> _Index(bytes, <span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (bytes &lt;= <span class="number">1024</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> _Index(bytes - <span class="number">128</span>, <span class="number">4</span>) + group_array[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (bytes &lt;= <span class="number">8</span> * <span class="number">1024</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> _Index(bytes - <span class="number">1024</span>, <span class="number">7</span>) + group_array[<span class="number">1</span>] + group_array[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (bytes &lt;= <span class="number">64</span> * <span class="number">1024</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> _Index(bytes - <span class="number">8</span> * <span class="number">1024</span>, <span class="number">10</span>) + group_array[<span class="number">2</span>] + group_array[<span class="number">1</span>] + group_array[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (bytes &lt;= <span class="number">256</span> * <span class="number">1024</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> _Index(bytes - <span class="number">64</span> * <span class="number">1024</span>, <span class="number">13</span>) + group_array[<span class="number">3</span>] + group_array[<span class="number">2</span>] + group_array[<span class="number">1</span>] + group_array[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;<span class="comment">// ä¸æ˜¯threadCacheè´Ÿè´£çš„èŒƒå›´äº†</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-5-ThreadCacheåˆ†é…-x2F-å›æ”¶å†…å­˜"><a href="#4-5-ThreadCacheåˆ†é…-x2F-å›æ”¶å†…å­˜" class="headerlink" title="4.5 ThreadCacheåˆ†é…&#x2F;å›æ”¶å†…å­˜"></a>4.5 ThreadCacheåˆ†é…&#x2F;å›æ”¶å†…å­˜</h2><p>è¿™éƒ¨åˆ†æ¯”è¾ƒç®€ç­”ï¼Œå“ˆå¸Œæ¡¶å¯¹åº”çš„FreeListé‡Œé¢æœ‰å°±ç›´æ¥åˆ†é…ï¼Œæ²¡æœ‰å°±å»æ‰¾CentralCacheè¦ã€‚</p><p>è¿™é‡Œä½¿ç”¨assertè¿›è¡Œç”³è¯·å¤§å°çš„åˆ¤æ–­ï¼Œæ˜¯å› ä¸ºThreadCacheä¸åº”è¯¥æ¥å—è¶…è¿‡256KBçš„è¯·æ±‚ï¼ˆå¦‚æœå‡ºç°äº†è¯´æ˜å¤–éƒ¨è°ƒç”¨çš„ä»£ç çš„å¤„ç†æœ‰é—®é¢˜ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">size_t</span> MAX_BYTES = <span class="number">256</span> * <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">ThreadCache::Allocate</span><span class="params">(<span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">assert</span>(size &lt;= MAX_BYTES);</span><br><span class="line"><span class="type">size_t</span> alignSize = <span class="built_in">RoundUp</span>(size); <span class="comment">// è®¡ç®—å¤§å°</span></span><br><span class="line"><span class="type">size_t</span> index = <span class="built_in">Index</span>(size); <span class="comment">// è®¡ç®—ä¸‹æ ‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!_freeLists[index].<span class="built_in">Empty</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _freeLists[index].<span class="built_in">Pop</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;<span class="comment">// å‘centralcacheç”³è¯·å†…å­˜</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">FetchFromCentralCache</span>(index, alignSize);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ThreadCache::Deallocate</span><span class="params">(<span class="type">void</span>* ptr, <span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">assert</span>(ptr);</span><br><span class="line"><span class="built_in">assert</span>(size &lt;= MAX_BYTES);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰¾å¯¹æ˜ å°„çš„è‡ªç”±é“¾è¡¨æ¡¶ï¼Œæ’å…¥å†…å­˜</span></span><br><span class="line"><span class="type">size_t</span> index = <span class="built_in">Index</span>(size); <span class="comment">// è®¡ç®—ä¸‹æ ‡</span></span><br><span class="line">_freeLists[index].<span class="built_in">Push</span>(ptr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-6-TLS-çº¿ç¨‹å±€éƒ¨å˜é‡"><a href="#4-6-TLS-çº¿ç¨‹å±€éƒ¨å˜é‡" class="headerlink" title="4.6 TLS-çº¿ç¨‹å±€éƒ¨å˜é‡"></a>4.6 TLS-çº¿ç¨‹å±€éƒ¨å˜é‡</h2><h3 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h3><p>TLSçš„å…¨ç§°æ˜¯Thread Local Storageï¼Œä½¿ç”¨ç‰¹æ®Šçš„å…³é”®å­—æ¥ä¿®é¥°ä¸€ä¸ªå˜é‡ï¼Œå¯ä»¥è®©è¿™ä¸ªå˜é‡å˜æˆä¸€ä¸ªåªæœ‰æŸä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®çš„ç‹¬ç«‹æˆå‘˜ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è®¿é—®ã€‚</p><p>æ¯”å¦‚æˆ‘æœ‰ä¸ªå˜é‡Aï¼Œé‚£ä¹ˆå¤šä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªè‡ªå·±çš„å˜é‡Aï¼Œä»–ä»¬éƒ½å¯ä»¥è®¿é—®è¿™ä¸ªAï¼Œä½†è®¿é—®çš„å¹¶ä¸æ˜¯åŒä¸€ä¸ªï¼Œä¹Ÿå°±ä¸æ¶‰åŠåˆ°åŠ é”é—®é¢˜ã€‚</p><p>å¯¹äºçº¿ç¨‹ç‹¬æœ‰çš„ThreadCacheè€Œè¨€ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªç‰¹æ€§æ¥è®©æ¯ä¸ªçº¿ç¨‹ç‹¬æœ‰ä¸€ä¸ªå˜é‡ï¼Œé¿å…æ„å»ºThreadCacheçš„æ—¶å€™è¿˜éœ€è¦è¾¨åˆ«å½“å‰çº¿ç¨‹å·æˆ–åŠ é”æ“ä½œã€‚</p><h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> _declspec(thread) ThreadCache* TLSThreadCache = <span class="literal">nullptr</span>;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨<code>_declspec(thread)</code>å°±æ˜¯windowså¹³å°ä¸‹å£°æ˜TLSå˜é‡çš„æ–¹å¼ï¼ŒåŠ ä¸Šstaticæ˜¯ä¸ºäº†é¿å…åœ¨åŒ…å«å¤´æ–‡ä»¶çš„æ—¶å€™è¯¥å…¨å±€å˜é‡å£°æ˜è¢«å¤åˆ¶å¤šæ¬¡å¯¼è‡´é‡å¤ã€‚</p><blockquote><p>å¾®è½¯å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://learn.microsoft.com/en-us/cpp/c-language/thread-local-storage?view=msvc-170&redirectedfrom=MSDN">https://learn.microsoft.com/en-us/cpp/c-language/thread-local-storage?view=msvc-170&amp;redirectedfrom=MSDN</a></p></blockquote><p>ç”¨ä¸‹é¢çš„ä»£ç å¯¹TLSå˜é‡åšä¸€ä¸ªç®€å•çš„æµ‹è¯•</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line">_declspec(thread) <span class="type">int</span>* TLStest = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">auto</span> test_func = []() &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;before:%p\n&quot;</span>, TLStest);</span><br><span class="line"><span class="keyword">if</span> (TLStest == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">TLStest = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;after:%p\n&quot;</span>, TLStest);</span><br><span class="line">         <span class="keyword">delete</span> TLStest;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">std::thread <span class="title">t1</span><span class="params">(test_func)</span></span>;</span><br><span class="line"><span class="function">std::thread <span class="title">t2</span><span class="params">(test_func)</span></span>;</span><br><span class="line">t1.<span class="built_in">detach</span>();</span><br><span class="line">t2.<span class="built_in">join</span>();</span><br><span class="line">std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">seconds</span>(<span class="number">1</span>));</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨VS2019æ‰§è¡Œï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼Œä¸¤ä¸ªçº¿ç¨‹è°ƒç”¨å‡½æ•°ä¸­çš„æ‰“å°å’Œåˆå§‹åŒ–ï¼Œèƒ½å‘ç°æœ€ç»ˆåˆå§‹åŒ–å‡ºæ¥çš„åœ°å€æ˜¯ä¸åŒçš„ï¼Œè€Œä¸”<code>&amp;TLStest</code>çš„åœ°å€ä¹Ÿä¸ä¸€æ ·ï¼Œè¯´æ˜TLStestå˜é‡è¢«æ¯ä¸ªçº¿ç¨‹ç‹¬æœ‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[before] TLStest:00000000  &amp;TLStest:00ACCEBC</span><br><span class="line">[after] TLStest:00ACE0E0  &amp;TLStest:00ACCEBC</span><br><span class="line">[before] TLStest:00000000  &amp;TLStest:00ACCDE4</span><br><span class="line">[after] TLStest:00ACE1D0  &amp;TLStest:00ACCDE4</span><br></pre></td></tr></table></figure><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><p>åœ¨Linuxä¸‹çš„çº¿ç¨‹æœ¬åœ°å­˜å‚¨å¯ä»¥ç”¨<code>__thread</code>å…³é”®å­—å£°æ˜ã€‚ä½†éœ€è¦æ³¨æ„ï¼Œè¿™ä¸ªå…³é”®å­—åªèƒ½å£°æ˜PODï¼ˆå†…ç½®ç±»å‹ï¼‰ï¼Œä¸èƒ½å£°æ˜è‡ªå®šä¹‰çš„classå¯¹è±¡ã€‚å½“ç„¶ï¼Œè‡ªå®šä¹‰classçš„æŒ‡é’ˆç±»å‹ä¸åœ¨æ­¤åˆ—ï¼Œå› ä¸º<code>myclass*</code>è¿™ç±»æŒ‡é’ˆç±»å‹å§‹ç»ˆæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå±äºC&#x2F;C++çš„å†…ç½®ç±»å‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__thread <span class="type">int</span>* TLStest = <span class="literal">nullptr</span>;</span><br></pre></td></tr></table></figure><p>Linuxä¸‹ä¸Šè¿°ä»£ç çš„æµ‹è¯•ç»“æœï¼Œå’Œwindowsä¸‹çš„æ•ˆæœç±»ä¼¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â¯ g++ test.cpp  -o test1 &amp;&amp; ./test1</span><br><span class="line">[before] TLStest:(nil)  &amp;TLStest:0x7f63315cd638</span><br><span class="line">[after] TLStest:0x7f632c000f80  &amp;TLStest:0x7f63315cd638</span><br><span class="line">[before] TLStest:(nil)  &amp;TLStest:0x7f6330dcc638</span><br><span class="line">[after] TLStest:0x7f632c000f80  &amp;TLStest:0x7f6330dcc638</span><br></pre></td></tr></table></figure><h3 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="headerlink" title="å¤‡æ³¨"></a>å¤‡æ³¨</h3><p>windowså’Œlinuxä¸‹çº¿ç¨‹å±€éƒ¨å˜é‡ä¼šæœ‰è‡ªå·±çš„å­˜æ”¾ä½ç½®å’Œå­˜æ”¾çš„åœ°å€ï¼Œä½†æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œè¿™äº›<strong>çº¿ç¨‹å±€éƒ¨å˜é‡çš„åœ°å€</strong>æ˜¯å…¨è¿›ç¨‹å…±äº«çš„ã€‚</p><p>å‡è®¾çº¿ç¨‹AçŸ¥é“äº†çº¿ç¨‹Bçš„å±€éƒ¨å˜é‡çš„åœ°å€ï¼Œé‚£ä¹ˆçº¿ç¨‹Aå°±å¯ä»¥è®¿é—®å¹¶ä¿®æ”¹å®ƒï¼å› ä¸ºè¿™ä¸ªåœ°å€æ˜¯åœ¨è¿›ç¨‹åœ°å€ç©ºé—´ä¸­çš„ï¼Œæ•´ä¸ªè¿›ç¨‹å…±äº«ï¼</p><h1 id="5-CentralCacheè®¾è®¡"><a href="#5-CentralCacheè®¾è®¡" class="headerlink" title="5.CentralCacheè®¾è®¡"></a>5.CentralCacheè®¾è®¡</h1><h2 id="5-1-spanè·¨åº¦é¡µ"><a href="#5-1-spanè·¨åº¦é¡µ" class="headerlink" title="5.1 spanè·¨åº¦é¡µ"></a>5.1 spanè·¨åº¦é¡µ</h2><p>CentralCacheçš„ä¸»ä½“ä¹Ÿé‡‡ç”¨äº†å’ŒThreadCacheç±»ä¼¼çš„å“ˆå¸Œæ¡¶çš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯CentralCacheçš„å“ˆå¸Œæ¡¶ä¸‹é¢é“¾æ¥çš„ä¸æ˜¯å†…å­˜ç¢ç‰‡ï¼Œè€Œæ˜¯åŒ…å«ä¸€ä¸ªå¤§å—å†…å­˜çš„spanå¯¹è±¡ï¼ˆè·¨åº¦é¡µï¼‰ã€‚</p><p>åœ¨CentralCacheçš„å“ˆå¸Œæ¡¶ä¸­ï¼Œ8å­—èŠ‚çš„æ¡¶é“¾æ¥çš„æ˜¯<strong>å†…éƒ¨å†…å­˜è¢«æ‹†åˆ†æˆ8å­—èŠ‚å°å—</strong>çš„Spanå¯¹è±¡ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/cecdd3677b008340b43ad7cdd1c05647.png" alt="image-20240228092725430"></p><p>Spanå¯¹è±¡çš„åŸºæœ¬æˆå‘˜å¦‚ä¸‹æ‰€ç¤ºï¼Œåœ¨win32ç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªSpanå¯¹è±¡æ˜¯32å­—èŠ‚ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _WIN64</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> PAGE_ID;</span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> _WIN32</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">size_t</span> PAGE_ID;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Span</span>&#123;</span><br><span class="line">    PAGE_ID _pageId; <span class="comment">//é¡µå·</span></span><br><span class="line">    <span class="type">size_t</span> _n; <span class="comment">//é¡µçš„æ•°é‡</span></span><br><span class="line">    </span><br><span class="line">    Span* _next = <span class="literal">nullptr</span>;</span><br><span class="line">    Span* _prev = <span class="literal">nullptr</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">void</span>* _list = <span class="literal">nullptr</span>; <span class="comment">// é“¾æ¥spanæ‹†åˆ†çš„å°å—å†…å­˜</span></span><br><span class="line">    <span class="type">size_t</span> _useCount = <span class="number">0</span>; <span class="comment">// ä½¿ç”¨æ•°é‡ï¼Œä¸º0ä»£è¡¨æ²¡æœ‰è¢«ä½¿ç”¨</span></span><br><span class="line">    </span><br><span class="line">    <span class="type">size_t</span> _objSize; <span class="comment">// æ‹†åˆ†çš„å°å—å†…å­˜çš„å¤§å°</span></span><br><span class="line">    </span><br><span class="line">    <span class="type">bool</span> _isUse = <span class="literal">false</span>; <span class="comment">// æ˜¯å¦åœ¨å ç”¨</span></span><br><span class="line">    <span class="comment">// å½“Spanè¢«åˆ†é…ç»™CentralCacheåè®¾ç½®ä¸ºtrue</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹è¿™ä¸ªå¯¹è±¡åšä¸€å®šè¯´æ˜</p><ul><li>å‡è®¾æˆ‘ä»¬ç»™å®šä¸€ä¸ªSpanåŒ…å«512KBçš„å†…å­˜ï¼ˆå†…å­˜æ˜¯ç”±PageCacheç”³è¯·çš„ï¼‰ï¼›</li><li>é‚£ä¹ˆ8Bçš„Spanå°±æ˜¯å°†è¿™ä¸ª512KBæ‹†åˆ†æˆ8Bé“¾æ¥åœ¨Spanå¯¹è±¡å†…éƒ¨çš„listä¸­</li><li>256KBçš„Spanå°±æ˜¯å°†512KBæ‹†åˆ†æˆä¸¤ä¸ª256KBé“¾æ¥åœ¨Spanå¯¹è±¡å†…éƒ¨çš„listä¸­</li><li>å½“ThreadCacheç”³è¯·å†…å­˜æ—¶ï¼Œä¼šä»å¯¹åº”å“ˆå¸Œæ¡¶ä¸‹æ ‡ä½ç½®çš„ç¬¬ä¸€ä¸ªSpanå¯¹è±¡ä¸­åˆ†é…å†…å­˜ç»™å®ƒï¼Œå¦‚æœç¬¬ä¸€ä¸ªSpanå¯¹è±¡æ²¡æœ‰å‰©ä½™å†…å­˜äº†ï¼Œå°±å¾€åæ‰¾ç¬¬äºŒä¸ªSpanå¯¹è±¡ç”³è¯·å†…å­˜æ¥åˆ†é…ç»™ThreadCacheï¼›</li><li>å½“ä¸€ä¸ªSpançš„useCountä¸º0æ—¶ï¼Œè¯´æ˜è¿™ä¸ªSpanå†…éƒ¨çš„å†…å­˜éƒ½æ˜¯æ²¡æœ‰è¢«ä½¿ç”¨çš„ï¼Œå®ƒå¯ä»¥è¢«PageCacheå›æ”¶ï¼›</li><li>PageCacheæ ¹æ®Spanä¸­çš„pageIDæ¥ç¡®å®šå®ƒçš„<strong>é¡µå·</strong>ï¼Œå¯ä»¥å’Œç›¸é‚»é¡µå·çš„Spanå†…å­˜åˆå¹¶æˆæ›´å¤§çš„å†…å­˜ï¼Œæš‚ä¸ºç®¡ç†æˆ–é‡Šæ”¾ç»™æ“ä½œç³»ç»Ÿï¼Œä¸€å®šç¨‹åº¦ä¸Šç¼“è§£å†…å­˜ç¢ç‰‡é—®é¢˜ã€‚</li></ul><p>ä½ å¯èƒ½ä¼šæœ‰ä¸€ä¸ªç–‘é—®ï¼ŒSpanå¯¹è±¡ä¸­ä¼¼ä¹æ²¡æœ‰ç”¨äºå­˜æ”¾å¤§å—å†…å­˜çš„æŒ‡é’ˆï¼ˆå†…éƒ¨çš„listå¹¶ä¸æ˜¯ç”¨æ¥å­˜å¤§å—å†…å­˜èµ·å§‹åœ°å€çš„ï¼Œè€Œéœ€è¦CentralCacheæ¥åˆ¶ä½œ<strong>å†…å­˜é“¾è¡¨</strong>ï¼‰ï¼Œå½“PageCacheåˆ†é…ç»™CentralCacheçš„æ—¶å€™ï¼ŒCentralCacheè¦æ€ä¹ˆçŸ¥é“è¿™ä¸ªSpançš„èµ·å§‹åœ°å€å‘¢ï¼Ÿ</p><ul><li><strong>é¡µå·</strong>æ˜¯ç›´æ¥ç”¨å†…å­˜åœ°å€å¼ºè½¬æˆæ•´å½¢ï¼Œé™¤ä»¥8KBæ¥è®¡ç®—çš„ï¼›</li><li>åªéœ€è¦å°†é¡µå·ä¹˜ä»¥8KBï¼ˆå³<code>8*1024</code>ï¼‰ï¼Œå°±èƒ½å¾—åˆ°è¿™ä¸ªSpanæ‰€å¯¹åº”çš„å†…å­˜èµ·å§‹åœ°å€ï¼›</li><li><strong>é¡µå·+é¡µçš„æ•°é‡</strong>å³å¯å¾—åˆ°å†…å­˜æœ€åä¸€é¡µçš„èµ·å§‹åœ°å€ï¼Œå†åŠ ä¸Š8KBå³ä¸ºå¤§å—å†…å­˜çš„æœ«å°¾ï¼›</li></ul><p>ç”¨è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å°±èŠ‚çœäº†ä¸€ä¸ªå¤šä½™çš„æŒ‡é’ˆã€‚é¡µå·+é¡µçš„æ•°é‡ä¹Ÿæ˜¯åç»­PageCacheå›æ”¶å†…å­˜æ—¶è¾¨åˆ«ä¸¤ä¸ªSpanå¯¹è±¡æ‰€ä¿å­˜çš„é¡µæ˜¯å¦ç›¸é‚»çš„é‡è¦åˆ¤æ®ã€‚</p><h2 id="5-2-æ¡¶é”"><a href="#5-2-æ¡¶é”" class="headerlink" title="5.2 æ¡¶é”"></a>5.2 æ¡¶é”</h2><p>ä¸ºäº†è¿›ä¸€æ­¥ç»†åŒ–é”çš„ç²’åº¦ï¼ŒCentralCacheé‡‡ç”¨æ¡¶é”çš„è®¾è®¡ï¼Œå³æ¯ä¸ªä¸åŒå¤§å°çš„å“ˆå¸Œæ¡¶ä¸‹æ ‡éƒ½ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„é”</p><ul><li>çº¿ç¨‹Aå‘CentralCacheç”³è¯·16Bå†…å­˜ï¼Œçº¿ç¨‹Bå‘CentralCacheç”³è¯·128KBå†…å­˜ï¼ŒäºŒè€…ä¸åœ¨åŒä¸€ä¸ªå“ˆå¸Œæ¡¶ä¸‹æ ‡ä½ç½®ï¼Œæ‰€ä»¥ä¸å­˜åœ¨ç«äº‰ä¹Ÿä¸éœ€è¦åŠ é”ï¼›</li><li>çº¿ç¨‹Aå’Œçº¿ç¨‹Béƒ½å‘CentralCacheç”³è¯·16Bå†…å­˜ï¼Œæ­¤æ—¶éœ€è¦åŠ é”ï¼›</li></ul><p>å®šä¹‰æ¡¶é”æ¯”è¾ƒç®€å•ï¼Œå› ä¸ºSpanéœ€è¦ä¸€ä¸ªå•ç‹¬çš„Listæ¥ç®¡ç†ï¼ˆä¸èƒ½ä½¿ç”¨åŸæœ¬å®šé•¿å†…å­˜æ± é‡Œé¢çš„freelistå¯¹è±¡äº†ï¼‰ï¼Œæˆ‘ä»¬åœ¨å•ç‹¬å®ç°çš„SpanListé‡Œé¢åŠ ä¸€ä¸ªmutexï¼ŒPOPå’ŒPUSHçš„æ—¶å€™åŠ é”&#x2F;è§£é”å°±å¯ä»¥äº†ã€‚</p><h2 id="5-3-å‘PageCacheç”³è¯·-x2F-é‡Šæ”¾å†…å­˜"><a href="#5-3-å‘PageCacheç”³è¯·-x2F-é‡Šæ”¾å†…å­˜" class="headerlink" title="5.3 å‘PageCacheç”³è¯·&#x2F;é‡Šæ”¾å†…å­˜"></a>5.3 å‘PageCacheç”³è¯·&#x2F;é‡Šæ”¾å†…å­˜</h2><p>å½“CentralCacheä¸­çš„æ¡¶æ²¡æœ‰æŒ‡å®šå¤§å°Spançš„æ—¶å€™ï¼Œå°±éœ€è¦å»PageCacheä¸­ç”³è¯·å†…å­˜ã€‚ç”³è¯·æ—¶éœ€è¦ç»™å®šç”³è¯·çš„å¤§å°ï¼ŒéšåPageCacheä¼šå°†åŒ…å«å¯¹åº”å¤§å°å†…å­˜çš„Spanå¯¹è±¡è¿”è¿˜ç»™CentralCacheï¼Œç”±CentralCacheæ¥è´Ÿè´£å°†è¿™å—å†…å­˜åˆ‡æˆå°å—å¹¶é“¾æ¥Spanå†…éƒ¨çš„listã€‚</p><p>å½“æŸä¸ªSpanå¯¹è±¡ä¸‹useCountä¸º0çš„æ—¶å€™ï¼ŒCentralCacheå°±å¯ä»¥å°†å…¶å½’è¿˜ç»™PageCacheã€‚</p><h2 id="5-4-ç”³è¯·å†…å­˜çš„æ•°é‡é™åˆ¶"><a href="#5-4-ç”³è¯·å†…å­˜çš„æ•°é‡é™åˆ¶" class="headerlink" title="5.4 ç”³è¯·å†…å­˜çš„æ•°é‡é™åˆ¶"></a>5.4 ç”³è¯·å†…å­˜çš„æ•°é‡é™åˆ¶</h2><p>ThreadCacheç”³è¯·å†…å­˜çš„æ—¶å€™ä¼šæœ‰ä¸€ä¸ªâ€œæ…¢å¼€å§‹â€çš„è°ƒèŠ‚ç®—æ³•ã€‚å³ç”³è¯·çš„æ—¶å€™ï¼Œä¼šç•¥å¾®ç”³è¯·å¤šä¸€äº›ï¼Œä½†ä¹Ÿä¸èƒ½ä¸€æ¬¡æ€§ç”³è¯·å¤ªå¤šï¼Œå¦åˆ™å¾ˆæœ‰å¯èƒ½ç”¨ä¸å®Œã€‚</p><ul><li>å½“ç”³è¯·å†…å­˜çš„sizeå¤§çš„æ—¶å€™ï¼Œä¸€æ¬¡å‘CentralCacheç”³è¯·çš„å†…å­˜æ•°é‡å°±è¶Šå°‘ï¼ˆå¤šå°‘ä¸ªsizeçš„å†…å­˜ï¼‰</li><li>å½“ç”³è¯·å†…å­˜çš„sizeå°çš„æ—¶å€™ï¼Œä¸€æ¬¡å‘CentralCacheç”³è¯·çš„å†…å­˜æ•°é‡å°±ä¼šå¤šä¸€äº›</li></ul><p>æ¯ç”³è¯·ä¸€æ¬¡å†…å­˜ï¼Œå°±å°†å¯¹åº”FreeListçš„<strong>é˜ˆå€¼</strong>è°ƒé«˜ä¸€äº›ï¼Œè¿™æ ·å†…å­˜æ± åˆšå¯åŠ¨çš„æ—¶å€™ï¼Œç”³è¯·çš„å†…å­˜å°±ä¼šå°‘ä¸€äº›ï¼Œè¿è¡Œä¸€æ®µæ—¶é—´åï¼Œè®¤ä¸ºç³»ç»Ÿå¯¹å†…å­˜çš„éœ€æ±‚ä¼šæ›´åŠ é¢‘ç¹ï¼Œä¸€æ¬¡è¦çš„å†…å­˜å°±ä¼šå¤šä¸€äº›ã€‚</p><h2 id="5-5-å›æ”¶ThreadCacheä¸­çš„å†…å­˜"><a href="#5-5-å›æ”¶ThreadCacheä¸­çš„å†…å­˜" class="headerlink" title="5.5 å›æ”¶ThreadCacheä¸­çš„å†…å­˜"></a>5.5 å›æ”¶ThreadCacheä¸­çš„å†…å­˜</h2><p>å› ä¸ºThreadCacheæ˜¯ç”¨freelistæ¥ç®¡ç†å†…å­˜çš„ï¼Œæ‰€ä»¥CentralCacheçš„å›æ”¶æ¥å£ä¹Ÿæ˜¯ä»¥ä¸€ä¸ªé“¾è¡¨çš„åŒºé—´æ¥å›æ”¶ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ReleaseListToSpans</span><span class="params">(<span class="type">void</span>* start, <span class="type">size_t</span> size)</span></span>;</span><br></pre></td></tr></table></figure><p>å½“ThreadCacheæ£€æµ‹åˆ°å½“å‰æŸä¸ªå“ˆå¸Œæ¡¶å¯¹åº”çš„freelisté•¿åº¦å·²ç»å¤§äºä¸€æ¬¡æ€§ä¼šç”³è¯·çš„å†…å­˜é•¿åº¦ï¼ˆä¸Šæ–‡æåˆ°çš„FreeList<strong>é˜ˆå€¼</strong>ï¼‰æ—¶ï¼Œå°±ä¼šé‡Šæ”¾ä¸€éƒ¨åˆ†å†…å­˜ç»™CentralCacheã€‚è¿™ç§æƒ…å†µè¯´æ˜ThreadCacheä¿å­˜çš„å†…å­˜å·²ç»æœ‰ç‚¹å¤šäº†ï¼Œå¯èƒ½ä¼šç”¨ä¸å®Œã€‚</p><h1 id="6-PageCacheè®¾è®¡"><a href="#6-PageCacheè®¾è®¡" class="headerlink" title="6.PageCacheè®¾è®¡"></a>6.PageCacheè®¾è®¡</h1><h2 id="6-1-åŸºæœ¬æ¶æ„"><a href="#6-1-åŸºæœ¬æ¶æ„" class="headerlink" title="6.1 åŸºæœ¬æ¶æ„"></a>6.1 åŸºæœ¬æ¶æ„</h2><p>PageCacheçš„å“ˆå¸Œæ¡¶å’ŒCentralCacheåŸºæœ¬ä¸€è‡´ï¼Œéƒ½æ˜¯é“¾æ¥çš„Spanå¯¹è±¡ï¼Œåªä¸è¿‡PageCacheä¸­æ˜¯é€šè¿‡é¡µé¢æ•°é‡ä½œä¸ºå“ˆå¸Œä¸‹æ ‡çš„é€‰å€çš„ã€‚</p><p>æ¯”å¦‚ä¸€ä¸ªSpanä¸­æœ‰2é¡µï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè¢«æ˜ å°„åˆ°ä¸‹æ ‡ä¸º2çš„å“ˆå¸Œæ¡¶ä¸­ï¼ˆåªä¸è¿‡è¿™æ ·ä¼šå¯¼è‡´ä¸‹æ ‡ä¸º0çš„å“ˆå¸Œæ¡¶ç©ºç½®ï¼Œä¹Ÿå¯ä»¥åœ¨å“ˆå¸Œå‡½æ•°é‡Œé¢å°†é¡µé¢æ•°é‡å‡ä¸€æ¥é¿å…è¿™ä¸ªæµªè´¹ï¼‰</p><p>é™¤äº†å“ˆå¸Œæ¡¶å¤–ï¼ŒPageCacheä¸­è¿˜æœ‰ä¸€ä¸ª<code>unordered_map</code>ç”¨äºæ˜ å°„é¡µå·å’ŒSpanå¯¹è±¡åœ°å€ï¼Œè¿™æ ·èƒ½è®©åç»­PageCacheå›æ”¶Spançš„æ—¶å€™ï¼Œæ›´å¿«åœ°æ‰¾åˆ°è¿™ä¸ªSpan<strong>é¡µå·ç›¸é‚»</strong>çš„å…¶ä»–Spanå¯¹è±¡çš„åœ°å€ã€‚</p><p>æ³¨æ„ï¼Œè¿™ä¸ª<code>unordered_map</code>ä¸­éœ€è¦æ˜ å°„<strong>ä¸€ä¸ªSpanå¯¹åº”çš„æ‰€æœ‰é¡µå·</strong>å’ŒSpanåœ°å€çš„å¯¹åº”å…³ç³»ï¼Œä¸èƒ½åªä¿å­˜èµ·å§‹é¡µå·å’ŒSpanåœ°å€çš„å…³ç³»ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/9bab99b19e081adbb08dbbdc4e2fd414.png" alt="image-20240229104149463"></p><h2 id="6-2-ç”³è¯·å†…å­˜"><a href="#6-2-ç”³è¯·å†…å­˜" class="headerlink" title="6.2 ç”³è¯·å†…å­˜"></a>6.2 ç”³è¯·å†…å­˜</h2><p>å½“PageCacheçš„å“ˆå¸Œæ¡¶ä¸­æ²¡æœ‰å‰©ä½™Spanæ—¶ï¼Œå°±ä¼šå‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜ã€‚</p><p>PageCacheå°†ä»¥8KBä¸ºä¸€ä¸ªé¡µï¼Œå»å‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜ã€‚ä¸”ä¸ºäº†æé«˜ç”³è¯·å†…å­˜çš„æ•ˆç‡ï¼Œä¼šç›´æ¥ä½¿ç”¨ç³»ç»Ÿåº•å±‚æ¥å£æ¥è·å–å†…å­˜ï¼ˆWindowsä¸‹VirutalAllocï¼ŒLinuxä¸‹btkå’Œmmapï¼‰</p><p>ç”³è¯·å†…å­˜åï¼ŒPageCacheä¼šnewä¸€ä¸ªSpanå¯¹è±¡ï¼Œå¹¶è®¾ç½®å¯¹åº”çš„é¡µå·å’Œé¡µçš„èµ·å§‹åœ°å€ã€‚éšåæ˜¯è®¾ç½®IDå’ŒSpanå¯¹è±¡åœ°å€çš„å…³ç³»ï¼Œå¹¶å°†Spanè¿”å›ç»™CentralCacheã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// kæ˜¯é¡µçš„ä¸ªæ•°</span></span><br><span class="line"><span class="type">void</span>* ptr = <span class="built_in">SystemAlloc</span>(k); <span class="comment">// å‘ç³»ç»Ÿç”³è¯·å†…å­˜</span></span><br><span class="line">Span* span = <span class="keyword">new</span> Span;      <span class="comment">// è·å–ä¸€ä¸ªSpanå¯¹è±¡</span></span><br><span class="line">span-&gt;_pageId = (PAGE_ID)ptr &gt;&gt; <span class="number">13</span>; <span class="comment">// ç›¸å½“äºé™¤ä»¥8KBï¼Œå¾—åˆ°é¡µå·</span></span><br><span class="line">span-&gt;_n = k; <span class="comment">//è®¾ç½®é¡µçš„ä¸ªæ•°</span></span><br></pre></td></tr></table></figure><h3 id="ä¼˜åŒ–æ–¹å¼"><a href="#ä¼˜åŒ–æ–¹å¼" class="headerlink" title="ä¼˜åŒ–æ–¹å¼"></a>ä¼˜åŒ–æ–¹å¼</h3><p>å½“ç„¶ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªä¸å¤ªåˆé€‚çš„åœ°æ–¹ã€‚å¯¹äºä¸€ä¸ªé«˜å¹¶å‘çš„å†…å­˜æ± è€Œè¨€ï¼Œæˆ‘ä»¬é¢„æœŸåº”è¯¥æ˜¯ä¼š<strong>æœ‰å¾ˆå¤šä¸ªSpanå¯¹è±¡çš„æ„å»º</strong>çš„ï¼ˆå³ä¾¿æˆ‘ä»¬æœ€ç»ˆçš„æµ‹è¯•ç¯å¢ƒå¯èƒ½è¾¾ä¸åˆ°è¿™ä¸ªå¹¶å‘é‡ï¼‰ï¼Œæ‰€ä»¥è¿™é‡Œåº”è¯¥å°†<code>new Span</code>æ”¹æˆä½¿ç”¨ä¸Šæ–‡æåˆ°çš„<strong>å®šé•¿å†…å­˜æ± </strong>æ¥å¤„ç†ï¼Œå¯ä»¥åœ¨PageCacheåˆå§‹åŒ–çš„æ—¶å€™å°±ç”³è¯·ä¸€éƒ¨åˆ†å†…å­˜ï¼Œä¾›æœªæ¥æ–°å»ºSpanå¯¹è±¡çš„æ—¶å€™ä½¿ç”¨ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Span* span = _spanPool.<span class="built_in">New</span>();<span class="comment">// ä½¿ç”¨å®šé•¿å†…å­˜æ± æ¥åˆ†é…å†…å­˜</span></span><br></pre></td></tr></table></figure><p>åªéœ€è¦åœ¨PageCacheä¸­åŒ…æ‹¬ä¸€ä¸ª<strong>å®šé•¿å†…å­˜æ± </strong>çš„å¯¹è±¡å³å¯ã€‚</p><h2 id="6-3-åˆ†é…å†…å­˜"><a href="#6-3-åˆ†é…å†…å­˜" class="headerlink" title="6.3 åˆ†é…å†…å­˜"></a>6.3 åˆ†é…å†…å­˜</h2><p>åˆ†é…å†…å­˜çš„æµç¨‹å¦‚ä¸‹</p><ol><li>åˆ¤æ–­å“ˆå¸Œæ¡¶ä¸­å¯¹åº”é¡µé¢å¤§å°çš„Spanæ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨ç›´æ¥åˆ†é…ï¼›</li><li>ä¸å­˜åœ¨åˆ™å‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜ï¼Œè€Œä¸”æ¯æ¬¡éƒ½ä¼šæŒ‰<strong>æœ€å¤§é¡µé¢</strong>æ¥ç”³è¯·ï¼ˆæœ€å¤§é¡µ128ï¼‰ï¼›</li><li>ç”³è¯·å¤§å—å†…å­˜åï¼Œå°†å…¶æ‹†åˆ†æˆä¸€ä¸ªCentralCacheéœ€è¦çš„Spanå’Œå¦å¤–ä¸€ä¸ªå‰©ä½™çš„Spanï¼›</li><li>å°†å‰©ä½™çš„Spanæ”¾å…¥å“ˆå¸Œè¡¨ï¼ŒCentralCacheéœ€è¦çš„Spanè¿”å›ï¼›</li></ol><p>ä¸Šè¿°æ­¥éª¤ä¸­çš„ç¬¬ä¸‰æ­¥å°±æ˜¯<strong>æ‹†åˆ†å¤§Spanå¯¹è±¡</strong>çš„æƒ…å†µï¼Œæ¯”å¦‚å½“10é¡µçš„Spanæ²¡æœ‰æ—¶ï¼Œå°†ä¸€ä¸ª128é¡µçš„Spanæ‹†åˆ†æˆ10é¡µå’Œ118é¡µçš„ã€‚è¿™æ—¶å€™ï¼Œä¸€ä¸ªçº¿ç¨‹å¯èƒ½ä¼šè®¿é—®PageCacheä¸­å“ˆå¸Œæ¡¶<strong>å¤šä¸ªä¸‹æ ‡ä½ç½®</strong>çš„å…ƒç´ ï¼Œæ‰€ä»¥PageCacheä¸èƒ½é‡‡ç”¨æ¡¶é”ï¼Œè€Œé‡‡ç”¨<strong>å…¨å±€é”</strong>ï¼ˆè®¿é—®PageCacheçš„æ—¶å€™åŠ é”ï¼Œè®¿é—®ç»“æŸè§£é”ï¼‰ã€‚</p><p>å¦å¤–ï¼Œ<strong>æ‹†åˆ†Spanå¯¹è±¡</strong>æ˜¯ä¸€ä¸ªé¢‘ç‡æ¯”è¾ƒé«˜çš„åŠ¨ä½œï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆPageCacheä¸­ä¼šå‡ºç°å¤šä¸ªå¯ä»¥è¿›è¡Œåˆå¹¶çš„ç›¸é‚»é¡µé¢çš„Spanå¯¹è±¡ã€‚</p><p>å¦‚æœPageCacheä¸­ä¸æ˜¯ä¸€æ¬¡æ€§ç”³è¯·æœ€å¤§é¡µé¢çš„å†…å­˜ï¼Œè€Œæ˜¯æŒ‰éœ€ç”³è¯·ï¼Œæ­¤æ—¶æ“ä½œç³»ç»Ÿç»™å®šçš„å†…å­˜å¾ˆå¤§æ¦‚ç‡å’Œä¹‹å‰çš„<strong>å¹¶ä¸æ˜¯ç›¸é‚»</strong>çš„ï¼Œé‚£PageCacheè‡ªç„¶å°±æ²¡æœ‰åŠæ³•â€œåˆå¹¶ç›¸é‚»é¡µé¢â€ï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´æ“ä½œç³»ç»Ÿä¸­å†…å­˜å¤–ç¢ç‰‡è¾ƒå¤šï¼Œä¸”éš¾ä»¥å¤„ç†ã€‚</p><h2 id="6-4-å›æ”¶å’Œåˆå¹¶"><a href="#6-4-å›æ”¶å’Œåˆå¹¶" class="headerlink" title="6.4 å›æ”¶å’Œåˆå¹¶"></a>6.4 å›æ”¶å’Œåˆå¹¶</h2><p>å›æ”¶æ˜¯CentralCacheåœ¨Spanä¸­useCountä¸º0çš„æ—¶å€™è§¦å‘çš„ï¼Œä¼šå°†è¿™ä¸ªSpanå½’è¿˜ç»™PageCacheã€‚</p><p>PageCacheæ”¶åˆ°ä¸€ä¸ªSpanåï¼Œéœ€è¦è¿›è¡Œåˆå¹¶æ“ä½œ</p><ul><li>ä»<code>unordered_map</code>ä¸­æŸ¥æ‰¾å‰ä¸€é¡µçš„Spanï¼ˆå½“å‰é¡µå·å‡ä¸€ï¼‰ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ¤æ–­æ˜¯å¦å¯ä»¥è¿›è¡Œåˆå¹¶ï¼›</li><li>æŸ¥æ‰¾åç»­çš„Spanï¼ˆå½“å‰é¡µå·åŠ ä¸Šé¡µé¢æ•°é‡å†åŠ ä¸€ï¼‰ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ¤æ–­æ˜¯å¦å¯ä»¥è¿›è¡Œåˆå¹¶ï¼›</li></ul><p>å› ä¸ºè¿™ä¸ª<code>unordered_map</code>åªåœ¨åˆå¹¶çš„æ—¶å€™éœ€è¦ä½¿ç”¨ï¼Œä¸”æ¯æ¬¡åˆå¹¶æ—¶çš„æŸ¥è¯¢æ“ä½œéƒ½æ˜¯å½“å‰spançš„é¡µå·å‡ä¸€ï¼Œå’Œå½“å‰spanæœ«å°¾é¡µå·+1ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ç»™<code>unoreder_map</code>ä¸­è®¾ç½®<strong>å½“å‰é¡µå·ä»¥åŠæœ«å°¾é¡µå·</strong>å¯¹åº”çš„spanå¯¹è±¡åœ°å€å°±è¡Œäº†ï¼èŠ‚çœç©ºé—´ã€‚</p><blockquote><p>ä¸ºäº†ä¿é™©èµ·è§å’Œæ–¹ä¾¿ç†è§£ï¼Œé¡¹ç›®ä¸­æˆ‘è¿˜æ˜¯é‡‡ç”¨äº†<strong>éå†é¡µå·èŒƒå›´è®¾ç½®å…¨éƒ¨</strong>çš„æ–¹å¼ï¼Œè¿™æ ·èƒ½é¿å…å‡ºç°é—®é¢˜ğŸ˜‚ä½†ä¼šæœ‰ç©ºé—´æµªè´¹å’Œæ•ˆç‡æŸå¤±ã€‚</p></blockquote><p>åˆå¹¶Spanéœ€è¦æ»¡è¶³ä¸‹é¢å‡ ä¸ªæ¡ä»¶ï¼š</p><ul><li>Spançš„isUseä¸ºfalseï¼Œå³è¿™ä¸ªSpanæ˜¯å¤„äºPageCacheä¸­æš‚æœªåˆ†é…çš„</li><li>Spançš„é¡µé¢æ•°é‡åŠ ä¸Šå½“å‰Spançš„é¡µé¢æ•°é‡ä¸è¶…è¿‡128ï¼ˆè¶…è¿‡åä¼šè¶…å‡ºå“ˆå¸Œæ¡¶çš„ä¸‹æ ‡ï¼Œæ— æ³•ç®¡ç†ï¼Œè‡ªç„¶ä¸èƒ½åˆå¹¶ï¼‰</li></ul><p>åˆå¹¶æ“ä½œæ¯”è¾ƒç®€å•</p><ul><li>å¦‚æœæ˜¯åˆå¹¶å‰ä¸€ä¸ªSpanï¼Œå°†å‰ä¸€ä¸ªSpançš„é¡µé¢æ•°é‡åŠ ä¸Šå½“å‰Spançš„é¡µé¢æ•°é‡å³å¯ï¼›</li><li>å¦‚æœæ˜¯åˆå¹¶åä¸€ä¸ªSpanï¼Œå°†å½“å‰Spançš„é¡µé¢æ•°é‡åŠ ä¸Šåä¸€ä¸ªSpançš„é¡µé¢æ•°é‡å³å¯ï¼›</li><li>åˆå¹¶åè¦å°†<strong>è¢«åˆå¹¶çš„Spanå¯¹è±¡</strong>é‡Šæ”¾ï¼Œå¹¶å°†åˆå¹¶åçš„Spanå¯¹è±¡çš„isUseè®¾ç½®ä¸ºfalseï¼›</li><li>å°†åˆå¹¶åçš„Spanå¯¹è±¡æ›´æ¢æ­£ç¡®çš„å“ˆå¸Œæ¡¶ä¸‹æ ‡ä½ç½®é“¾æ¥ï¼ˆå› ä¸ºåŒ…å«çš„é¡µé¢æ•°é‡æ”¹å˜äº†ï¼‰ï¼›</li><li>ä¿®æ”¹<code>unodered_map</code>ä¸­çš„é¡µå·å’ŒSpanå¯¹è±¡åœ°å€çš„æ˜ å°„è¡¨ï¼›</li></ul><h2 id="6-5-è¶…å‡º256KBçš„å†…å­˜ç”³è¯·"><a href="#6-5-è¶…å‡º256KBçš„å†…å­˜ç”³è¯·" class="headerlink" title="6.5 è¶…å‡º256KBçš„å†…å­˜ç”³è¯·"></a>6.5 è¶…å‡º256KBçš„å†…å­˜ç”³è¯·</h2><p>å› ä¸ºä½äº256KBçš„å†…å­˜éƒ½èƒ½è¢«ThreadCacheæ¥å¤„ç†ï¼Œæ‰€ä»¥256KBä¹Ÿç®—æ˜¯ä¸ªåˆ†æ°´å²­ã€‚è€ŒPageCacheä¸­å“ˆå¸Œæ¡¶æœ€å¤§çš„ä¸‹æ ‡æ˜¯128ï¼Œå³æœ€å¤§èƒ½æ‰˜ç®¡çš„Spanæ˜¯1MBçš„å†…å­˜ï¼Œè¶…å‡º1MBçš„å†…å­˜å°±å¾—ç›´æ¥å‘æ“ä½œç³»ç»Ÿç”³è¯·äº†ã€‚</p><p>æ­¤æ—¶å‘å†…å­˜æ± ç”³è¯·å†…å­˜çš„æµç¨‹ä¼šå˜æˆä¸‹é¢è¿™æ ·ï¼š</p><ul><li>ç”³è¯·ä½äº256KBçš„è°ƒç”¨ThreadCacheçš„æ¥å£ï¼ˆåŒ…æ‹¬åˆ†é…å’Œå›æ”¶ï¼‰ï¼›</li><li>å¤§äº256KBçš„è°ƒç”¨PageCacheçš„æ¥å£ï¼ˆåŒ…æ‹¬åˆ†é…å’Œå›æ”¶ï¼‰ï¼›</li><li>å½“PageCacheæ£€æµ‹åˆ°ç”³è¯·çš„å†…å­˜å¤§äº128Pageçš„æ—¶å€™ï¼Œç›´æ¥å‘ç³»ç»Ÿç”³è¯·å†…å­˜å¹¶è¿”å›ï¼›</li><li>å½“PageCacheæ£€æµ‹åˆ°å›æ”¶çš„å†…å­˜å¤§äº128Pageçš„æ—¶å€™ï¼Œç›´æ¥é‡Šæ”¾ç»™æ“ä½œç³»ç»Ÿï¼›</li></ul><p>åˆ°è¿™é‡Œï¼Œå†…å­˜æ± çš„ä¸»é¢˜æ¡†æ¶å°±å…¨éƒ¨æˆå‹äº†ï¼Œåç»­è¦åšçš„å°±æ˜¯æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–äº†ã€‚</p><h2 id="6-6-SpanListå’Œå­ç±»"><a href="#6-6-SpanListå’Œå­ç±»" class="headerlink" title="6.6 SpanListå’Œå­ç±»"></a>6.6 SpanListå’Œå­ç±»</h2><p>å› ä¸ºåªæœ‰CentralCacheéœ€è¦ç”¨åˆ°æ¡¶é”ï¼Œè€ŒPageCacheåŒæ„éœ€è¦ä½¿ç”¨SpanListï¼Œ<strong>ä¸ºäº†èŠ‚çœä¸€å®šç©ºé—´</strong>ï¼ˆPageCacheçš„SpanListä¸­çš„é”æ˜¯æ²¡ç”¨çš„ï¼‰ï¼ŒCentralCacheæˆ‘ä½¿ç”¨äº†ç»§æ‰¿è‡ªçˆ¶ç±»SpanListçš„å¦å¤–ä¸€ä¸ªç±»å‹ï¼Œåœ¨é‡Œé¢æ·»åŠ äº†ä¸€ä¸ªmutexé”ã€‚</p><p>åœ¨32ä½windowsç¯å¢ƒä¸‹ï¼Œmutexç±»çš„å¤§å°æ˜¯48å­—èŠ‚ï¼Œ128ä¸ªSpanListï¼Œè¿˜æ˜¯èƒ½èŠ‚çœä¸€å®šç©ºé—´çš„ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">std::mutex mtx;</span><br><span class="line">cout &lt;&lt; <span class="built_in">sizeof</span>(mtx) &lt;&lt; endl; <span class="comment">// 32ä½ä¸‹æ˜¯48å­—èŠ‚</span></span><br></pre></td></tr></table></figure><h1 id="7-æµ‹è¯•"><a href="#7-æµ‹è¯•" class="headerlink" title="7.æµ‹è¯•"></a>7.æµ‹è¯•</h1><h2 id="7-1-ç”³è¯·å’Œé‡Šæ”¾å‡½æ•°"><a href="#7-1-ç”³è¯·å’Œé‡Šæ”¾å‡½æ•°" class="headerlink" title="7.1 ç”³è¯·å’Œé‡Šæ”¾å‡½æ•°"></a>7.1 ç”³è¯·å’Œé‡Šæ”¾å‡½æ•°</h2><p>è™½ç„¶å†™äº†ä¸‰æˆçš„è®¾è®¡ï¼Œä½†æ˜¯ç”³è¯·å’Œé‡Šæ”¾å‡½æ•°å¹¶ä¸èƒ½ç›´æ¥è°ƒç”¨ThreadCacheçš„å‡½æ•°ï¼Œè¿˜éœ€è¦å¦å¤–ä¸€ä¸ªå‡½æ•°æ¥è¿›è¡ŒThreadCacheçš„æ„é€ ï¼Œä»¥åŠå¤§äº256KBå†…å­˜çš„å¤„ç†ã€‚</p><p>è¿™é‡Œæœ‰ä¸ªå¤ç”¨è®¾è®¡ï¼Œå³å°†PageCacheä¸­çš„é¡µå·å¯¹åº”Spanå¯¹è±¡æŒ‡é’ˆçš„æ˜ å°„çš„<code>unordered_map</code>æ¥ç¡®å®šå½“å‰ç”³è¯·çš„å†…å­˜çš„<strong>å¤§å°</strong>ï¼Œè¿™æ ·å°±ä¸éœ€è¦ç”¨æˆ·ä¸»åŠ¨ä¼ å…¥å‚æ•°äº†ï¼ˆä¸»åŠ¨ä¼ å…¥å®¹æ˜“å‡ºç°å†…å­˜æ³„æ¼å’Œå¤„ç†é—®é¢˜ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span>* <span class="title">ConcurrentAlloc</span><span class="params">(<span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (size &gt; MAX_SIZE)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">size_t</span> alignSize = SizeClass::<span class="built_in">RoundUp</span>(size);</span><br><span class="line">        <span class="type">size_t</span> kpage = alignSize &gt;&gt; PAGE_SHIFT;</span><br><span class="line"></span><br><span class="line">        PageCache::<span class="built_in">GetInstance</span>()-&gt;<span class="built_in">Lock</span>();</span><br><span class="line">        Span* span = PageCache::<span class="built_in">GetInstance</span>()-&gt;<span class="built_in">NewSpan</span>(kpage);</span><br><span class="line">        span-&gt;_objSize = size; <span class="comment">// ç”³è¯·å¤§å†…å­˜æ²¡æœ‰æ‹†åˆ†</span></span><br><span class="line">        PageCache::<span class="built_in">GetInstance</span>()-&gt;<span class="built_in">Unlock</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">void</span>* ptr = (<span class="type">void</span>*)(span-&gt;_pageId &lt;&lt; PAGE_SHIFT);</span><br><span class="line">        <span class="keyword">return</span> ptr;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// å› ä¸ºæ˜¯çº¿ç¨‹å±€éƒ¨å˜é‡ï¼Œæ‰€ä»¥ä¸éœ€è¦åŠ é”</span></span><br><span class="line">        <span class="keyword">if</span> (TLSThreadCache == <span class="literal">nullptr</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// è¿™é‡Œçš„staticå˜é‡æ˜¯å…¨å±€å¯è§çš„</span></span><br><span class="line">            <span class="type">static</span> FixedMemoryPool&lt;ThreadCache&gt; tcPool; </span><br><span class="line">            TLSThreadCache = tcPool.<span class="built_in">New</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> TLSThreadCache-&gt;<span class="built_in">Allocate</span>(size);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">ConcurrentFree</span><span class="params">(<span class="type">void</span>* ptr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Span* span = PageCache::<span class="built_in">GetInstance</span>()-&gt;<span class="built_in">MapObjectToSpan</span>(ptr);</span><br><span class="line">    <span class="type">size_t</span> size = span-&gt;_objSize;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (size &gt; MAX_SIZE)</span><br><span class="line">    &#123;</span><br><span class="line">        PageCache::<span class="built_in">GetInstance</span>()-&gt;<span class="built_in">Lock</span>();</span><br><span class="line">        PageCache::<span class="built_in">GetInstance</span>()-&gt;<span class="built_in">ReleaseSpanToPageCache</span>(span);</span><br><span class="line">        PageCache::<span class="built_in">GetInstance</span>()-&gt;<span class="built_in">Unlock</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">assert</span>(TLSThreadCache);</span><br><span class="line">        TLSThreadCache-&gt;<span class="built_in">Deallocate</span>(ptr, size);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7-2-å•çº¿ç¨‹ç”³è¯·"><a href="#7-2-å•çº¿ç¨‹ç”³è¯·" class="headerlink" title="7.2 å•çº¿ç¨‹ç”³è¯·"></a>7.2 å•çº¿ç¨‹ç”³è¯·</h2><p>ç”¨ä¸‹é¢çš„ä»£ç æµ‹è¯•ï¼Œç¯å¢ƒæ˜¯windows x64ï¼›</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">TestNormalAlloc</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">void</span>* p1 = <span class="built_in">ConcurrentAlloc</span>(<span class="number">6</span>);</span><br><span class="line"><span class="type">void</span>* p2 = <span class="built_in">ConcurrentAlloc</span>(<span class="number">8</span>);</span><br><span class="line"><span class="type">void</span>* p3 = <span class="built_in">ConcurrentAlloc</span>(<span class="number">12</span>);</span><br><span class="line"><span class="type">void</span>* p4 = <span class="built_in">ConcurrentAlloc</span>(<span class="number">7000</span>);</span><br><span class="line"><span class="type">void</span>* p5 = <span class="built_in">ConcurrentAlloc</span>(<span class="number">10</span>);</span><br><span class="line"><span class="type">void</span>* p6 = <span class="built_in">ConcurrentAlloc</span>(<span class="number">800</span>);</span><br><span class="line"><span class="type">void</span>* p7 = <span class="built_in">ConcurrentAlloc</span>(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; p1 &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; p2 &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; p3 &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; p4 &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; p5 &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; p6 &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; p7 &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="built_in">ConcurrentFree</span>(p1);</span><br><span class="line"><span class="built_in">ConcurrentFree</span>(p2);</span><br><span class="line"><span class="built_in">ConcurrentFree</span>(p3);</span><br><span class="line"><span class="built_in">ConcurrentFree</span>(p4);</span><br><span class="line"><span class="built_in">ConcurrentFree</span>(p5);</span><br><span class="line"><span class="built_in">ConcurrentFree</span>(p6);</span><br><span class="line"><span class="built_in">ConcurrentFree</span>(p7);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼Œé‡Šæ”¾å’Œç”³è¯·éƒ½æ²¡æœ‰é—®é¢˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">000001A864B20000</span><br><span class="line">000001A864B20008</span><br><span class="line">000001A864B22000</span><br><span class="line">000001A864B24000</span><br><span class="line">000001A864B22010</span><br><span class="line">000001A864B62000</span><br><span class="line">000001A864BA0000</span><br></pre></td></tr></table></figure><h2 id="7-3-å¤šçº¿ç¨‹ç”³è¯·"><a href="#7-3-å¤šçº¿ç¨‹ç”³è¯·" class="headerlink" title="7.3 å¤šçº¿ç¨‹ç”³è¯·"></a>7.3 å¤šçº¿ç¨‹ç”³è¯·</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MultiThreadAlloc1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">std::vector&lt;<span class="type">void</span>*&gt; v;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">void</span>* ptr = <span class="built_in">ConcurrentAlloc</span>(<span class="number">6</span>);</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;1 - &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; - &quot;</span> &lt;&lt; ptr &lt;&lt; endl;</span><br><span class="line">v.<span class="built_in">push_back</span>(ptr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> e : v)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">ConcurrentFree</span>(e);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">catch</span> (...)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;error in MultiThreadAlloc1\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MultiThreadAlloc2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">std::vector&lt;<span class="type">void</span>*&gt; v;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">void</span>* ptr = <span class="built_in">ConcurrentAlloc</span>(<span class="number">20</span>);</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;2 - &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; - &quot;</span> &lt;&lt; ptr &lt;&lt; endl;</span><br><span class="line">v.<span class="built_in">push_back</span>(ptr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> e : v)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">ConcurrentFree</span>(e);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">catch</span> (...)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;error in MultiThreadAlloc2\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•å¤šçº¿ç¨‹å¤„ç†æ˜¯å¦æœ‰é—®é¢˜</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TestMultiThread</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">std::thread <span class="title">t1</span><span class="params">(MultiThreadAlloc1)</span></span>;</span><br><span class="line"><span class="function">std::thread <span class="title">t2</span><span class="params">(MultiThreadAlloc2)</span></span>;</span><br><span class="line"></span><br><span class="line">t1.<span class="built_in">detach</span>();</span><br><span class="line">t2.<span class="built_in">join</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿæ²¡å•¥é—®é¢˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1 - 34788 - 0000019E47920000</span><br><span class="line">2 - 14252 - 0000019E47922000</span><br><span class="line">1 - 34788 - 0000019E47920008</span><br><span class="line">1 - 34788 - 0000019E47920010</span><br><span class="line">2 - 14252 - 0000019E47922018</span><br><span class="line">1 - 34788 - 0000019E47920018</span><br><span class="line">2 - 14252 - 0000019E47922030</span><br><span class="line">1 - 34788 - 0000019E47920020</span><br><span class="line">1 - 34788 - 0000019E47920028</span><br><span class="line">1 - 34788 - 0000019E47920030</span><br><span class="line">1 - 34788 - 0000019E47920038</span><br><span class="line">1 - 34788 - 0000019E47920040</span><br><span class="line">1 - 34788 - 0000019E47920048</span><br><span class="line">2 - 14252 - 0000019E47922048</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œè¿›è¡Œå¤šçº¿ç¨‹æµ‹è¯•çš„æ—¶å€™ï¼Œä¸€å®šè¦ä¿è¯ä¸»çº¿ç¨‹é€€å‡ºæ—¶é—´<strong>æ™šäºå­çº¿ç¨‹</strong>ï¼ˆæ¯”å¦‚åœ¨<code>thread.join()</code>ä¹‹ååŠ sleep)ï¼Œé¿å…å‡ºç°ä¸»çº¿ç¨‹æå‰é€€å‡ºçš„æƒ…å†µï¼Œè¿™ä¼šå¯¼è‡´å­çº¿ç¨‹é‡Œé¢çš„<strong>æ‰“å°ä¸è¾“å‡º</strong>ï¼Œæˆ–è€…å…¶ä»–çš„ä¸€äº›é”™è¯¯ã€‚</p><h2 id="7-4-å®šé•¿å†…å­˜æ± æ®µé”™è¯¯è§£å†³"><a href="#7-4-å®šé•¿å†…å­˜æ± æ®µé”™è¯¯è§£å†³" class="headerlink" title="7.4 å®šé•¿å†…å­˜æ± æ®µé”™è¯¯è§£å†³"></a>7.4 å®šé•¿å†…å­˜æ± æ®µé”™è¯¯è§£å†³</h2><p>åˆšå¼€å§‹è¿è¡Œçš„æ—¶å€™ï¼Œ<strong>å¤šçº¿ç¨‹ç»å¸¸é‡åˆ°æ®µé”™è¯¯é—®é¢˜</strong>ï¼Œè€Œä¸”ä¸æ˜¯æ¯æ¬¡éƒ½ä¼šå‡ºç°ã€‚</p><blockquote><p>ä¸€èˆ¬é‡åˆ°è¿™ç§ä¸æ˜¯æ¯æ¬¡éƒ½ä¼šå‡ºç°çš„æ®µé”™è¯¯ï¼Œå°±å¯ä»¥è€ƒè™‘æ˜¯å¦ä¸º<strong>å¤šçº¿ç¨‹å¹¶å‘é—®é¢˜</strong>äº†ã€‚</p></blockquote><p>åæ¥å®¡æŸ¥äº†ä¸€ä¸‹ï¼Œå‘ç°é—®é¢˜æ‰€åœ¨æ˜¯ç”³è¯·å†…å­˜å‡½æ•°ä¸­çš„ThreadCacheåˆå§‹åŒ–éƒ¨åˆ†</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡TLS æ¯ä¸ªçº¿ç¨‹æ— é”çš„è·å–è‡ªå·±çš„ä¸“å±çš„ThreadCacheå¯¹è±¡</span></span><br><span class="line"><span class="keyword">if</span> (TLSThreadCache == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">static</span> FixedMemoryPool&lt;ThreadCache&gt; tcPool; <span class="comment">// è¿™é‡Œçš„staticå˜é‡æ˜¯å…¨å±€å¯è§çš„</span></span><br><span class="line">    TLSThreadCache = tcPool.<span class="built_in">New</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨åˆå§‹åŒ–éƒ¨åˆ†è¿™é‡Œï¼Œè®¾ç½®äº†ä¸€ä¸ªstaticçš„å®šé•¿å†…å­˜æ± ï¼Œå¯¹äºæ‰€æœ‰çº¿ç¨‹éƒ½æ˜¯å¯è§çš„ã€‚è¿™æ—¶å€™å°±ä¼šå‡ºç°å¤šçº¿ç¨‹å¹¶å‘çš„é—®é¢˜ï¼ˆä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªå®šé•¿å†…å­˜æ± ï¼‰ã€‚</p><p>åœ¨PageCacheä¸­çš„Spanå®šé•¿å†…å­˜æ± ï¼Œ<strong>å› ä¸ºè®¿é—®PageCacheçš„æ—¶å€™å·²ç»åŠ è¿‡é”äº†</strong>ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°å¹¶å‘é—®é¢˜ï¼Œä½†æ˜¯è¿™é‡Œçš„ThreadCacheåˆå§‹åŒ–æ—¶å¹¶æ²¡æœ‰åŠ é”ï¼Œå°±ä¼šå‡ºç°å¤šçº¿ç¨‹è®¿é—®é—®é¢˜ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>åœ¨å®šé•¿å†…å­˜æ± ä¸­åŠ ä¸Šä¸€ä¸ªmutexæˆå‘˜ï¼Œå¹¶è¿›è¡ŒåŠ é”è§£é”æ“ä½œï¼›</li><li>åœ¨ç”³è¯·å†…å­˜åˆå§‹åŒ–ThreadCacheçš„éƒ¨åˆ†æ·»åŠ ä¸€ä¸ªé”ï¼Œå¹¶è¿›è¡ŒåŠ é”è§£é”æ“ä½œï¼›</li></ol><p>é‡‡ç”¨ç¬¬ä¸€ç§æ–¹å¼è®¾ç½®å®Œæ¯•åï¼Œè¿ç»­è¿è¡Œäº†åå‡ æ¬¡ï¼Œéƒ½æ²¡æœ‰å†å‡ºç°æ®µé”™è¯¯é—®é¢˜äº†ã€‚</p><p>åç»­ä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œæˆ‘æ”¹ä¸ºäº†ç¬¬äºŒç§æ–¹å¼ã€‚å› ä¸ºPageCacheä¸­è®¿é—®Spanå¯¹è±¡çš„å®šé•¿å†…å­˜æ± çš„åŠ é”æ˜¯æ— æ„ä¹‰çš„ï¼Œä¼šæœ‰é¢å¤–æ€§èƒ½æŸå¤±ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡TLS æ¯ä¸ªçº¿ç¨‹æ— é”çš„è·å–è‡ªå·±çš„ä¸“å±çš„ThreadCacheå¯¹è±¡</span></span><br><span class="line"><span class="keyword">if</span> (TLSThreadCache == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// C++11åstaticå˜é‡åˆå§‹åŒ–æ—¶çº¿ç¨‹å®‰å…¨</span></span><br><span class="line">    <span class="type">static</span> FixedMemoryPool&lt;ThreadCache&gt; tcPool; <span class="comment">// è¿™é‡Œçš„staticå˜é‡æ˜¯å…¨å±€å¯è§çš„</span></span><br><span class="line">    <span class="comment">// åœ¨newä¹‹å‰åŠ é”å°±å¯ä»¥äº†</span></span><br><span class="line">    <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lockGuard</span><span class="params">(TLSThreadCacheMtx)</span></span>;</span><br><span class="line">    TLSThreadCache = tcPool.<span class="built_in">New</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="8-Linuxä¸‹æ¥å£è¡¥å…¨"><a href="#8-Linuxä¸‹æ¥å£è¡¥å…¨" class="headerlink" title="8.Linuxä¸‹æ¥å£è¡¥å…¨"></a>8.Linuxä¸‹æ¥å£è¡¥å…¨</h1><p>å‰æ–‡æ‰€è¿°çš„æ¥å£éƒ½æ˜¯åœ¨Windowsä¸‹ä½¿ç”¨çš„ï¼Œä¸‹é¢è¦å¯¹Linuxä¸­ä¸Windowsä¸ä¸€è‡´çš„åœ°æ–¹è¿›è¡Œè¡¥å…¨ã€‚</p><h2 id="8-1-PageIDçš„typedef"><a href="#8-1-PageIDçš„typedef" class="headerlink" title="8.1 PageIDçš„typedef"></a>8.1 PageIDçš„typedef</h2><p>ä¹‹å‰åœ¨Windowsä¸‹æ˜¯ç”¨<code>_WIN32</code>å’Œ<code>_WIN64</code>è¿™ä¸¤ä¸ªå®æ¥ç¡®å®šå¹³å°æ˜¯32ä½è¿˜æ˜¯64ä½çš„ï¼Œä½†æ˜¯Linuxä¸‹æ²¡æœ‰ç±»ä¼¼çš„å®ã€‚æœ€ç»ˆé‡‡ç”¨å¦‚ä¸‹æ–¹å¼æ¥ç¡®è®¤Linuxä¸‹å¹³å°çš„ä½æ•°</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å› ä¸º64ä½å’Œ32ä½ä¸­å†…å­˜åœ°å€çš„é•¿åº¦ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å¯¹åº”ç±»å‹ä¹Ÿå¾—ä¸ä¸€æ ·</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _WIN64 <span class="comment">// 64ä½çš„winæ‰ä¼šæœ‰è¿™ä¸ªå®</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> PageID;</span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> _WIN32 <span class="comment">// 32å’Œ64ä½çš„winéƒ½ä¼šæœ‰è¿™ä¸ªå®</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">size_t</span> PageID;</span><br><span class="line"><span class="comment">// åç»­è¿˜éœ€è¦æ’å…¥ä¸€äº›Linuxçš„å®</span></span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> __linux__</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> __WORDSIZE == 64 <span class="comment">// 64ä½çš„Linux</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> PageID;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span> <span class="comment">// 32ä½çš„Linux</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">size_t</span> PageID;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨äº†<code>__WORDSIZE</code>è¿™ä¸ªå®ï¼Œå®ƒå…¶å®æ¯”è¾ƒé€šç”¨ï¼Œå«ä¹‰æ˜¯å½“å‰å¹³å°ä¸‹æŒ‡é’ˆçš„å¤§å°ï¼ˆå•ä½æ˜¯æ¯”ç‰¹ï¼‰ï¼Œ32ä½å¹³å°ä¸‹æŒ‡é’ˆæ˜¯32æ¯”ç‰¹4å­—èŠ‚ï¼Œ64ä½å¹³å°ä¸‹æŒ‡é’ˆæ˜¯64æ¯”ç‰¹8å­—èŠ‚ã€‚</p><h2 id="8-2-mmapç”³è¯·å’Œé‡Šæ”¾å†…å­˜"><a href="#8-2-mmapç”³è¯·å’Œé‡Šæ”¾å†…å­˜" class="headerlink" title="8.2 mmapç”³è¯·å’Œé‡Šæ”¾å†…å­˜"></a>8.2 mmapç”³è¯·å’Œé‡Šæ”¾å†…å­˜</h2><p>åœ¨Linuxä¸‹ä½¿ç”¨mmapå’Œmunmapä¸¤ä¸ªæ¥å£æ¥ç”³è¯·å’Œé‡Šæ”¾å†…å­˜ï¼Œå…·ä½“ä½¿ç”¨æ–¹å¼å‚è€ƒmanæ‰‹å†Œã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"> <span class="type">void</span> *<span class="title function_">mmap</span><span class="params">(<span class="type">void</span> *addr, <span class="type">size_t</span> length, <span class="type">int</span> prot, <span class="type">int</span> flags,</span></span><br><span class="line"><span class="params">            <span class="type">int</span> fd, <span class="type">off_t</span> offset)</span>;</span><br><span class="line"> <span class="type">int</span> <span class="title function_">munmap</span><span class="params">(<span class="type">void</span> *addr, <span class="type">size_t</span> length)</span>;</span><br></pre></td></tr></table></figure><p>mmapçš„å‚æ•°è¯´æ˜ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°addr: æŒ‡å®šéœ€è¦ç”³è¯·çš„å†…å­˜åœ¨æ“ä½œç³»ç»Ÿä¸­çš„åç§»é‡ï¼Œè®¾ç½®ä¸ºNULLè®©æ“ä½œç³»ç»Ÿè‡ªè¡Œé€‰æ‹©ï¼›</li><li>ç¬¬äºŒä¸ªå‚æ•°length: æŒ‡å®šç”³è¯·å†…å­˜çš„æ¯”ç‰¹æ•°</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°prot: æŒ‡å®šç”³è¯·å†…å­˜çš„æƒé™ï¼ˆè¯»å†™ï¼‰</li><li>ç¬¬å››ä¸ªå‚æ•°flags: æŒ‡å®šç”³è¯·å†…å­˜çš„æ–¹å¼</li><li>ç¬¬äº”ä¸ªå‚æ•°fd: ç”³è¯·çš„å†…å­˜æ˜¯å¦éœ€è¦å’ŒæŸä¸ªæ–‡ä»¶æè¿°ç¬¦ç»‘å®šï¼Œ<code>-1</code>ä»£è¡¨ä¸ç»‘å®šï¼›</li><li>ç¬¬å…­ä¸ªå‚æ•°offsetï¼šæŒ‡å®šåç§»ï¼Œå¯¹äºåŒ¿åæ˜ å°„é€šå¸¸è®¾ç½®ä¸º0ï¼›</li></ul><p>é‡Šæ”¾å†…å­˜çš„munmapæ¥å£å°±æ¯”è¾ƒç®€å•äº†ï¼Œä¼ å…¥å†…å­˜çš„æŒ‡é’ˆå’Œé•¿åº¦å°±å¯ä»¥äº†ã€‚</p><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">size_t</span> bytes = <span class="number">1000</span>;</span><br><span class="line"><span class="comment">// PROT_READ | PROT_WRITE æŒ‡å®šè¯»å†™æƒé™</span></span><br><span class="line"><span class="comment">// MAP_PRIVATE | MAP_ANONYMOUS ç§æœ‰å’ŒåŒ¿åæ˜ å°„</span></span><br><span class="line"><span class="type">void</span> *ptr = <span class="built_in">mmap</span>(<span class="literal">NULL</span>, bytes, PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// é‡Šæ”¾</span></span><br><span class="line"><span class="built_in">munmap</span>(ptr, bytes);</span><br></pre></td></tr></table></figure><p>å› ä¸ºwindowsä¸‹çš„VirtualFreeå¹¶ä¸éœ€è¦ä¼ å…¥é•¿åº¦ï¼Œæ‰€ä»¥åœ¨Linuxä¸­æ”¹é€ å†…å­˜æ± çš„æ—¶å€™ï¼Œè¿˜éœ€è¦ä¸€ä¸ªmapæ¥å­˜æ”¾æŒ‡é’ˆå…¶å®åœ°å€å’Œé•¿åº¦çš„å…³ç³»ï¼Œä¿è¯é‡Šæ”¾çš„æ—¶å€™èƒ½æŒ‰æ­£ç¡®çš„å†…å­˜é•¿åº¦è¿›è¡Œé‡Šæ”¾ã€‚</p><h2 id="8-3-TLSå˜é‡"><a href="#8-3-TLSå˜é‡" class="headerlink" title="8.3 TLSå˜é‡"></a>8.3 TLSå˜é‡</h2><p>è¿™ä¸€ç‚¹å‰æ–‡å·²ç»æåˆ°è¿‡åŒºåˆ«ï¼ŒLinuxä¸‹å’ŒWindowsçš„ä»£ç æœ‰ä¸€å®šå·®å¼‚ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _WIN32</span></span><br><span class="line"><span class="type">static</span> _declspec(thread) ThreadCache *TLSThreadCache = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> __linux__</span></span><br><span class="line"><span class="type">static</span> __thread ThreadCache *TLSThreadCache = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h2 id="8-4-ç³»ç»Ÿå†…å­˜åˆ†é…å’Œé‡Šæ”¾åœ°å€ä¸ä¸€è‡´é—®é¢˜ï¼ˆæœªè§£å†³ï¼‰"><a href="#8-4-ç³»ç»Ÿå†…å­˜åˆ†é…å’Œé‡Šæ”¾åœ°å€ä¸ä¸€è‡´é—®é¢˜ï¼ˆæœªè§£å†³ï¼‰" class="headerlink" title="8.4 ç³»ç»Ÿå†…å­˜åˆ†é…å’Œé‡Šæ”¾åœ°å€ä¸ä¸€è‡´é—®é¢˜ï¼ˆæœªè§£å†³ï¼‰"></a>8.4 ç³»ç»Ÿå†…å­˜åˆ†é…å’Œé‡Šæ”¾åœ°å€ä¸ä¸€è‡´é—®é¢˜ï¼ˆæœªè§£å†³ï¼‰</h2><p>å½“ç›´æ¥ç”³è¯·å¤§å—å†…å­˜ï¼ˆæ¯”å¦‚2000KBï¼‰çš„æ—¶å€™ï¼ŒPageCacheä¼šè°ƒç”¨SystemAllocå‡½æ•°ï¼Œä¸ä½¿ç”¨malloc&#x2F;newè€Œç›´æ¥è°ƒç”¨ç³»ç»Ÿæ¥å£æ¥ç”³è¯·å¤§å—å†…å­˜ã€‚</p><p>è¿™é‡Œå°±å‡ºç°äº†é—®é¢˜ï¼Œç”³è¯·å†…å­˜çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿè¿”å›çš„å†…å­˜å¹¶ä¸æ˜¯ä¸¥æ ¼æŒ‰æˆ‘ä»¬é¢„å®šçš„8KBé¡µæ¥èµ·å§‹çš„ï¼Œæ¯”å¦‚ä¸‹é¢çš„<code>0xf7617000</code>è¿™ä¸ªåœ°å€ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alloc ptr: 0xf7617000 - 2048000</span><br><span class="line">2000KB: 0xf7616000</span><br><span class="line">free ptr: 0xf7616000</span><br></pre></td></tr></table></figure><p>å°†<code>0xf7617000</code>é™¤ä»¥8KBå†ä¹˜ä»¥8KBï¼Œå¾—åˆ°çš„ç»“æœæ˜¯<code>0xf7616000</code>ï¼Œå’ŒåŸæœ¬åˆ†é…çš„å†…å­˜ä¸ä¸€è‡´ï¼å› ä¸ºPageCacheä¸­ç”³è¯·å†…å­˜çš„æ—¶å€™ä¼šå°†å…¶<strong>æŒ‰é¡µå·</strong>æ¥ä¿å­˜åœ¨Spanå¯¹è±¡é‡Œé¢ï¼Œä½†æ“ä½œç³»ç»Ÿè¿”å›çš„å†…å­˜<strong>å¹¶ä¸ä¸€å®šæ˜¯æŸä¸ªé¡µçš„èµ·å§‹åœ°å€</strong>ï¼</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/03/0dcaaceac0ccd22bad9f571d1edfe42c.png" alt="image-20240304130129640"></p><p>è€Œä¸”ä¼šå‘ç°æœ€ç»ˆè°ƒç”¨æ–¹å¾—åˆ°çš„å†…å­˜æ˜¯<code>0xf7616000</code>ï¼Œè¿™ä¸ªåœ°å€å°äºæ“ä½œç³»ç»Ÿåˆ†é…ç»™æˆ‘ä»¬çš„<code>0xf7617000</code>ï¼Œå¦‚æœç›´æ¥è®¿é—®ï¼Œä¼šè®¿é—®åˆ°å¹¶ä¸å±äºå½“å‰å·²åˆ†é…å†…å­˜çš„éƒ¨åˆ†ï¼Œç›´æ¥æ®µé”™è¯¯ï¼</p><p>è¿™ä¸ªé—®é¢˜å¤§æ¦‚ç‡æ˜¯ç”±Windowså’ŒLinuxä¸‹ç³»ç»Ÿè°ƒç”¨æ¥å£çš„ä¸åŒè®¾è®¡å¯¼è‡´çš„ï¼Œå› ä¸ºwindowsä¸‹ä¸ç®¡æ˜¯ç”¨x86å’Œx64éƒ½æ²¡æœ‰å¤ç°å‡ºè¿™ä¸ªé—®é¢˜ï¼ˆåœ¨Linuxä¸‹ä¼šæœ‰60%çš„å‡ ç‡å‡ºç°è¯¥é—®é¢˜ï¼‰</p><p>è€Œä¸”è¯¥é—®é¢˜å½±å“çš„ä¸åªæ˜¯è¶…è¿‡1MBçš„å¤§å†…å­˜ç”³è¯·ï¼ŒPageCacheç”³è¯·å†…å­˜çš„æ—¶å€™ä¹Ÿæœ‰å¯èƒ½ä¼šé‡åˆ°ç³»ç»Ÿè°ƒç”¨æ¥å£è¿”å›çš„å†…å­˜å¹¶éæŒ‰8KBå¯¹é½çš„æƒ…å†µï¼Œæœ€ç»ˆå¯¼è‡´æ®µé”™è¯¯ã€‚</p><p>ç”±äºè¿™ä¸æ˜¯çº¿ç¨‹æ± è®¾è®¡ä¸­çš„é‡ç‚¹ï¼Œä¹Ÿå’Œçº¿ç¨‹æ± æœ¬èº«çš„æ€è·¯æ²¡æœ‰å…³ç³»ï¼Œæ‰€ä»¥æš‚æ—¶æŒ‚èµ·ä¸å»æ·±ç©¶ï¼Œ<strong>ç»§ç»­åœ¨Windowsä¸Šä»¥32ä½å¯¹çº¿ç¨‹æ± è¿›è¡Œä¼˜åŒ–</strong>ã€‚</p><h1 id="9-æ€§èƒ½é—®é¢˜"><a href="#9-æ€§èƒ½é—®é¢˜" class="headerlink" title="9.æ€§èƒ½é—®é¢˜"></a>9.æ€§èƒ½é—®é¢˜</h1><h2 id="9-1-ç®€å•æµ‹è¯•"><a href="#9-1-ç®€å•æµ‹è¯•" class="headerlink" title="9.1 ç®€å•æµ‹è¯•"></a>9.1 ç®€å•æµ‹è¯•</h2><p>ä½¿ç”¨ä¸‹é¢çš„ä»£ç ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹åˆ†åˆ«æµ‹è¯•çº¿ç¨‹æ± ç”³è¯·å’Œmallocç”³è¯·å†…å­˜çš„è€—æ—¶</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MultiThreadAlloc2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">std::vector&lt;<span class="type">void</span>*&gt; v1;</span><br><span class="line">std::vector&lt;<span class="type">void</span>*&gt; v2;</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> begin1 = <span class="built_in">clock</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">void</span>* ptr = <span class="built_in">ConcurrentAlloc</span>(<span class="number">30</span>);</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;21 - &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; - &quot;</span> &lt;&lt; ptr &lt;&lt; endl;</span><br><span class="line">v1.<span class="built_in">push_back</span>(ptr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> e : v1)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">ConcurrentFree</span>(e);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">size_t</span> end1 = <span class="built_in">clock</span>();</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> begin2 = <span class="built_in">clock</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">void</span>* ptr = <span class="built_in">malloc</span>(<span class="number">30</span>);</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;22 - &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; - &quot;</span> &lt;&lt; ptr &lt;&lt; endl;</span><br><span class="line">v2.<span class="built_in">push_back</span>(ptr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> e : v2)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">free</span>(e);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">size_t</span> end2 = <span class="built_in">clock</span>();</span><br><span class="line"></span><br><span class="line">std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">seconds</span>(<span class="number">2</span>));</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;2 memory pool cost time:&quot;</span> &lt;&lt; end1 - begin1 &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;2 malloc cost time:&quot;</span> &lt;&lt; end2 - begin2 &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">catch</span> (...)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;error in MultiThreadAlloc2\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨vs2019çš„debug-x86æ¨¡å¼ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2 memory pool cost time:98</span><br><span class="line">2 malloc cost time:91</span><br><span class="line">1 memory pool cost time:44</span><br><span class="line">1 malloc cost time:95</span><br></pre></td></tr></table></figure><p>ä¼šå‘ç°çº¿ç¨‹2çš„mallocç”³è¯·æ—¶é—´å°äºçº¿ç¨‹æ± ï¼Œè€Œçº¿ç¨‹1çš„çº¿ç¨‹æ± æ•ˆç‡æ›´é«˜ã€‚å†æµ‹è¯•ä¸€æ¬¡ï¼Œåˆä¼šå‘ç°ä¸¤ä¸ªçº¿ç¨‹mallocçš„æ•ˆç‡éƒ½æ›´é«˜äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2 memory pool cost time:80</span><br><span class="line">2 malloc cost time:77</span><br><span class="line">1 memory pool cost time:69</span><br><span class="line">1 malloc cost time:61</span><br></pre></td></tr></table></figure><p>è¿™æ˜æ˜¾ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œå¦‚æœä¸€ä¸ªå†…å­˜æ± çš„æ•ˆç‡ä½äºmallocï¼Œå®ƒå­˜åœ¨çš„æ„ä¹‰å°±ä¸æ˜¯å¾ˆå¤§äº†ã€‚æ‰€ä»¥éœ€è¦é’ˆå¯¹å½“å‰çº¿ç¨‹æ± ä¸­çš„æ€§èƒ½ç“¶é¢ˆè¿›è¡Œä¸€å®šåˆ†æå’Œä¼˜åŒ–ã€‚</p><h2 id="9-2-VS2019æ€§èƒ½æŸ¥çœ‹å™¨"><a href="#9-2-VS2019æ€§èƒ½æŸ¥çœ‹å™¨" class="headerlink" title="9.2 VS2019æ€§èƒ½æŸ¥çœ‹å™¨"></a>9.2 VS2019æ€§èƒ½æŸ¥çœ‹å™¨</h2><p>VS2019çš„è°ƒè¯•é€‰é¡¹ä¸­æœ‰ä¸€ä¸ªæ€§èƒ½æ¢æŸ¥å™¨ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç¡®å®šå½“å‰é¡¹ç›®ä¸­å“ªä¸€ä¸ªéƒ¨åˆ†æœ€è€—æ—¶ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/03/e5741918e40f4f3f998be52e652048d1.png" alt="image-20240306090902495"></p><p>è°ƒæ•´åˆ°DEBUGæ¨¡å¼ä¸‹ï¼Œé€‰æ‹©æ£€æµ‹ï¼Œç‚¹å‡»å¼€å§‹</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/03/e26975b85eb27872042507ca14a725e8.png" alt="image-20240306091010082"></p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/03/0138862a8de2f1ed9c6c46a5936b5751.png" alt="image-20240306091438569"></p><p>æœ€ç»ˆé€‰æ‹©å½“å‰é¡¹ç›®å¹¶ç­‰å¾…è¿è¡Œåï¼Œä¼šå¾—åˆ°ä¸€ä¸ªä¸‹é¢è¿™æ ·çš„æŠ¥å‘Šã€‚æ³¨æ„ä½¿ç”¨æ€§èƒ½ç›‘çœ‹å™¨çš„æ—¶å€™åº”è¯¥æŠŠå¤šçº¿ç¨‹ä»£ç å†…éƒ¨çš„æ‰“å°å’Œsleepç»™å»æ‰ï¼ˆå¦åˆ™ä¼šæ˜¾ç¤ºæ‰“å°å’Œsleepçš„è€—æ—¶å¾ˆé•¿ï¼‰</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/03/c898dca7428fcf06364e3dccb76439bf.png" alt="image-20240306091039084"></p><p>ä¸Šå›¾æ˜¯åªæœ‰ä¸¤ä¸ªçº¿ç¨‹æ—¶çš„æŠ¥å‘Šï¼Œä¸‹å›¾æ˜¯4ä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œæ—¶çš„æŠ¥å‘Š</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/03/5632ea109f2e97504928900d47e5e208.png" alt="image-20240306141404925"></p><p>è¿™é‡Œå°±èƒ½çœ‹åˆ°ï¼ŒConcurrentFreeå‡½æ•°å ç”¨äº†å¾ˆå¤§çš„CPUæ—¶é—´</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/03/1d0da72d2acb63ba4235cca495d9667c.png" alt="image-20240306091851440"></p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/03/9c47bb8bb270db12ab4b121d404b1522.png" alt="image-20240306091802354"></p><p>åœ¨ConcurrentFreeå‡½æ•°ä¸­ï¼Œ<code>MapObjectToSpan</code>å‡½æ•°å’Œ<code>ThreadCache::Deallocate</code>å‡½æ•°å ç”¨çš„æ—¶é—´æ¯”è¾ƒé•¿ã€‚</p><p>è¿›ä¸€æ­¥æŸ¥çœ‹ï¼Œåœ¨<code>ThreadCache::Deallocate</code>å‡½æ•°ä¸­ï¼Œè€—æ—¶çš„ä¹Ÿæ˜¯MapObjectToSpanè¿™ä¸ªHashMapçš„æŸ¥è¯¢æ“ä½œã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/03/e8611fceb986f9a88665d6546bd3a2e3.png" alt="image-20240306092056267"></p><p>MapObjectToSpanå‡½æ•°ä¸­ï¼Œ<strong>å ç”¨æ—¶é—´é•¿çš„æ˜¯åŠ é”å’Œfindçš„æ“ä½œ</strong>ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/03/3b85e480b784725724674b6d707717e9.png" alt="image-20240306092009240"></p><p>å¦‚æœèƒ½çœå»è¿™é‡Œçš„åŠ é”ï¼Œ<strong>é‚£ä¹ˆå†…å­˜æ± é‡Šæ”¾å†…å­˜çš„æ•ˆç‡å°±ä¼šå¤§å¤§æé«˜</strong>ã€‚</p><p>è¿™æ—¶å€™å°±éœ€è¦å¼•å…¥å¦å¤–ä¸€ç§æ•°æ®ç»“æ„äº†ï¼šåŸºæ•°æ ‘ radix_treeã€‚</p><h2 id="9-3-åŸºæ•°æ ‘"><a href="#9-3-åŸºæ•°æ ‘" class="headerlink" title="9.3 åŸºæ•°æ ‘"></a>9.3 åŸºæ•°æ ‘</h2><h3 id="æ•°æ®ç»“æ„è¯´æ˜"><a href="#æ•°æ®ç»“æ„è¯´æ˜" class="headerlink" title="æ•°æ®ç»“æ„è¯´æ˜"></a>æ•°æ®ç»“æ„è¯´æ˜</h3><p>åœ¨PageCacheä¸­çš„<code>unordered_map</code>æ˜¯ç”¨äºæ˜ å°„é¡µå·å’Œå¯¹åº”Spanå¯¹è±¡æŒ‡é’ˆçš„ï¼Œè¿™ä¸¤ä¸ªæœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€ä¸ªæ•´å½¢ã€‚åŸºæ•°æ ‘å°±æ¯”è¾ƒé€‚åˆè¿™æ ·çš„åœºæ™¯ã€‚</p><ul><li>å•å±‚åŸºæ•°æ ‘å…¶å®å°±æ˜¯ä¸€ä¸ªâ€œç›´æ¥å®šå€æ³•â€çš„å“ˆå¸Œæ•°ç»„ï¼Œç”¨é¡µé¢æ•°é‡ä½œä¸ºæ•°ç»„é•¿åº¦ï¼Œæ¯ä¸ªæ•°ç»„çš„å…ƒç´ éƒ½æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼›</li></ul><p>åœ¨32ä½ç³»ç»Ÿä¸‹ï¼Œè¿™ä¸ªæ•°ç»„çš„é•¿åº¦æ˜¯<code>32-PAGE_SHIFT</code>ï¼Œå¯¹äºå½“å‰é¡¹ç›®è€Œè¨€<code>PAGE_SHIFT</code>æ˜¯13ï¼Œåˆ™æœ€ç»ˆæ•°ç»„çš„é•¿åº¦æ˜¯<code>2^19</code>ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ª4å­—èŠ‚çš„æŒ‡é’ˆç±»å‹ï¼Œæ•°ç»„çš„å¤§å°å°±æ˜¯2048KBï¼Œå³2MBã€‚è¿™ä¸ªå¤§å°å¹¶ä¸ç®—å¤§ï¼Œå¯ä»¥æ¥å—ã€‚</p><p>å¾ˆæ˜æ˜¾ï¼Œä½¿ç”¨å•å±‚åŸºæ•°æ ‘ï¼Œæ—¶é—´å¤æ‚åº¦å°±ç›´æ¥è¢«å‹ç¼©åˆ°äº†æ•°ç»„ä¸‹æ ‡ç›´æ¥è®¿é—®çš„<code>O(1)</code>ï¼Œæ¯”<code>unordered_map</code>æä¾›çš„å“ˆå¸Œè¡¨æ•ˆç‡æ›´é«˜ï¼ˆå› ä¸ºå•å±‚åŸºæ•°æ ‘å®Œå…¨æ²¡æœ‰å“ˆå¸Œç¢°æ’å’Œæ‰©å®¹é—®é¢˜ï¼‰ã€‚</p><ul><li>å¤šå±‚åŸºæ•°æ ‘åˆ©ç”¨é¡µå·çš„æ¯”ç‰¹ä½æ¥åˆ†å±‚</li></ul><p>å¦‚ä¸‹æ‰€ç¤ºï¼Œåœ¨32ä½ä¸‹ï¼Œé¡µå·åªæœ‰ä½19ä½æ˜¯æœ‰æ„ä¹‰çš„ã€‚å› ä¸ºé¡µå·æ˜¯ç”±32ä½åœ°å€å³ç§»13ä½å¾—æ¥çš„ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/03/77a3771140158154ec2f2d3b4abe7c44.png" alt="image-20240306145039892"></p><p>å°†ä½çš„åä¹ä½è¿›ä¸€æ­¥åˆ†ä¸ºé«˜5ä½ï¼Œä½13ä½ï¼›è¿™é‡Œçš„é«˜5ä½å°±ä½œä¸ºç¬¬ä¸€å±‚çš„æ˜ å°„ï¼Œä½13ä½ä½œä¸ºç¬¬äºŒå±‚çš„æ˜ å°„</p><ul><li>ç¬¬ä¸€å±‚çš„é•¿åº¦ä¸º2çš„5æ¬¡æ–¹ï¼›</li><li>ç¬¬äºŒå±‚çš„é•¿åº¦ä¸º2çš„13æ¬¡æ–¹ï¼›</li></ul><p>æœ€ç»ˆåŸºæ•°æ ‘çš„æ•°ç»„é•¿åº¦æ˜¯<code>2^5 * 2^13 = 262,144</code>ï¼Œå ç”¨ç©ºé—´å¤§å°æ˜¯1024KBï¼Œå³1MBã€‚åˆ†å±‚ä¸ä»…èŠ‚çœäº†ç©ºé—´ï¼Œè€Œä¸”è¿˜é¿å…äº†ä¸€æ¬¡æ€§ç”³è¯·å¤§å—å†…å­˜ï¼ˆå¦‚æœæ˜¯å•å±‚åŸºæ•°æ ‘éœ€è¦ä¸€æ¬¡æ€§æŠŠæ•°ç»„çš„ç©ºé—´ç”³è¯·å‡ºæ¥ï¼‰ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/03/abdc5fcc1f253aad8f44941127644868.png" alt="image-20240306150859855"></p><p>æ›´å¤šå±‚çš„åŸºæ•°æ ‘éƒ½æ˜¯æŒ‰ä¸Šè¿°æ€è·¯å¾€ä¸‹æ‰©å±•ï¼Œå¦‚æœæ˜¯å…­åå››ä½çš„ç³»ç»Ÿå°±éœ€è¦ç”¨æ›´å¤šå±‚çš„åŸºæ•°æ ‘ã€‚</p><p>åŸºæ•°æ ‘å› ä¸ºæ¯ä¸€ä¸ªé¡µå·éƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„å­˜å‚¨ç©ºé—´ï¼Œåœ¨ä¿®æ”¹çš„æ—¶å€™åªä¼šä¿®æ”¹å±€éƒ¨ï¼Œå¹¶ä¸å½±å“æ•´ä½“ã€‚è€Œä¸”å’Œçº¢é»‘æ ‘è¿™ç§æ•°æ®ç»“æ„æœ‰ä¸€ç‚¹ä¸åŒï¼Œçº¢é»‘æ ‘ä¸ºäº†ä¿è¯keyçš„æœ‰åºï¼Œåœ¨æ’å…¥çš„æ—¶å€™å¯èƒ½éœ€è¦è¿›è¡Œæ ‘ç»“æ„çš„æ—‹è½¬ï¼Œå‡è®¾æŸ¥è¯¢çš„æ—¶å€™é‡åˆ°è¿™ç§æ—‹è½¬ï¼Œæ•ˆç‡å°±ä¼šå˜ä½ç”šè‡³å‡ºç°é”™è¯¯ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä½¿ç”¨<code>map</code>çš„æ—¶å€™éœ€è¦<strong>åŠ é”</strong>ã€‚<code>unoredered_map</code>ä¹Ÿæ˜¯åŒç†ï¼Œé‡åˆ°å“ˆå¸Œç¢°æ’å’Œç©ºé—´ä¸è¶³çš„æ—¶å€™ï¼Œéƒ½ä¼šä¿®æ”¹åŸæœ¬æ•°æ®çš„å­˜æ”¾ç»“æ„ï¼Œä¸ºäº†é¿å…å¤šçº¿ç¨‹é—®é¢˜ï¼Œå°±éœ€è¦åŠ é”æ‰èƒ½è¿›è¡ŒæŸ¥è¯¢ã€‚</p><p>è€ŒåŸºæ•°æ ‘ä¸ç®¡æ˜¯æ’å…¥è¿˜æ˜¯åˆ é™¤æ“ä½œéƒ½<strong>ä¸ä¼šå½±å“æ•´ä¸ªæ ‘çš„ç»“æ„</strong>ï¼Œä½ å¯ä»¥ç†è§£ä¸ºåŸºæ•°æ ‘åˆ›å»ºå®Œæ¯•ä¹‹åæ•´ä¸ªæ ‘çš„ç»“æ„å°±ä¸ä¼šåŠ¨äº†ï¼Œè¿™ä¸€ç‚¹å°±è®©å®ƒåœ¨ä¸€å®šç¨‹åº¦ä¸Šæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚åªè¦å¤šçº¿ç¨‹<strong>ä¸ä¼šåŒæ—¶è¯»å†™ç›¸åŒé¡µå·çš„æ•°æ®</strong>ï¼Œå°±ä¸ä¼šå‡ºç°å¹¶å‘é—®é¢˜ã€‚</p><h3 id="å›åˆ°é¡¹ç›®"><a href="#å›åˆ°é¡¹ç›®" class="headerlink" title="å›åˆ°é¡¹ç›®"></a>å›åˆ°é¡¹ç›®</h3><p>å†æ¥çœ‹çœ‹é¡¹ç›®ä¸­ä»€ä¹ˆæ—¶å€™éœ€è¦è®¾ç½®æ˜ å°„ï¼Œä»€ä¹ˆæ—¶å€™ä¼šæŸ¥è¯¢æ˜ å°„ï¼Ÿ</p><p>è®¾ç½®é¡µå·å’ŒSpanå¯¹è±¡çš„æŒ‡é’ˆå‡½æ•°ä¸º<code>SetMapObjectToSpan</code>ï¼Œåªåœ¨PageCacheçš„NewSpanå’ŒReleaseSpanToPageCacheå‡½æ•°ä¸­è¢«è°ƒç”¨ã€‚è€Œè®¿é—®PageCacheçš„æ—¶å€™éƒ½ä¼šåŠ é”ï¼Œè¿™é‡Œå¯¹æ˜ å°„çš„<strong>å†™æ“ä½œ</strong>ä¸å­˜åœ¨å¤šçº¿ç¨‹é—®é¢˜ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/03/5bfcc0a0a5b6a8c682c446851f8c05b0.png" alt="image-20240306152054722"></p><p>æŸ¥è¯¢æ“ä½œéƒ½æ˜¯åœ¨<code>ConcurrentFree</code>å’Œ<code>CentralCache::ReleaseListToSpans</code>è¿™ä¸¤ä¸ªå†…å­˜é‡Šæ”¾å‡½æ•°ä¸­ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/03/f1306727d9c65e996b18a83f5b0b8514.png" alt="image-20240306153145300"></p><p>PageCacheä¸­ä»€ä¹ˆæ—¶å€™ä¼šä¿®æ”¹æ˜ å°„ï¼š</p><ul><li>å°†å¯¹åº”å¤§å°Spanåˆ†é…ç»™CentralCacheæ—¶ï¼›</li><li>å°†å¤§Spanæ‹†æˆå°Spanï¼Œå¹¶åˆ†é…ç»™CentralCacheæ—¶ï¼›</li><li>å›æ”¶æ—¶å°†å°Spanä¸ç›¸é‚»Spanåˆå¹¶æ—¶ï¼›</li></ul><p>è€ŒæŸ¥è¯¢æ“ä½œéƒ½æ˜¯åœ¨å›æ”¶å†…å­˜çš„æ—¶å€™å‡ºç°çš„ï¼Œè¢«å›æ”¶çš„å†…å­˜ä¸€å®š<strong>ä¸ä¼šæ˜¯åˆšåˆšå‡†å¤‡è¢«åˆ†é…çš„Spanå¯¹è±¡</strong>ï¼Œå› ä¸ºåˆ†é…å†…å­˜åçš„Spanå¯¹è±¡å°±ä¼šä»PageCacheçš„SpanListä¸­åˆ é™¤ï¼ŒPageCacheä¸ç®¡æ˜¯å›æ”¶åˆå¹¶æ“ä½œè¿˜æ˜¯æ‹†åˆ†æ“ä½œéƒ½ä¸ä¼šé‡åˆ°è¿™ä¸ªä¸å­˜åœ¨äºSpanListä¸­çš„Spanå¯¹è±¡ã€‚æ¢è€Œè¨€ä¹‹ï¼Œå½“å‰æ˜ å°„çš„å†™æ“ä½œå’Œè¯»æ“ä½œ<strong>ä¸ä¼šåŒæ—¶è®¿é—®ç›¸åŒé¡µå·çš„ä½ç½®</strong>ï¼è€ŒåŸºæ•°æ ‘çš„ç‰¹æ€§è®©è¿™ç§è¯»å†™ä¸åŒä¸‹æ ‡ä½ç½®çš„æ“ä½œæ— éœ€åŠ é”ï¼</p><p>å»æ‰äº†é”ç«äº‰ï¼Œæ•ˆç‡å°±æé«˜äº†ï¼</p><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><p>å•å±‚åŸºæ•°æ ‘ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç»™å®šä¸€ä¸ªGetå’Œä¸€ä¸ªSetï¼Œå°±å¯ä»¥äº†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å•å±‚åŸºæ•°æ ‘ï¼Œåˆ©ç”¨æ¨¡æ¿å˜é‡æ¥è·å–é•¿åº¦</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="type">size_t</span> BITS&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PageMap1</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">size_t</span> LENGTH = <span class="number">1</span> &lt;&lt; BITS; <span class="comment">// ç”¨äºç¡®å®šåŸºæ•°æ ‘çš„é•¿åº¦</span></span><br><span class="line"><span class="type">void</span>** _array; <span class="comment">// ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„å†…çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªvoid*æŒ‡é’ˆ</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">PageMap1</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">size_t</span> size = <span class="built_in">sizeof</span>(<span class="type">void</span>*) * LENGTH; <span class="comment">// æ•´ä¸ªæ•°ç»„çš„é•¿åº¦</span></span><br><span class="line"><span class="type">size_t</span> alignSize = SizeClass::<span class="built_in">RoundUp</span>(size); <span class="comment">// è°ƒç”¨SystemAllocç”³è¯·å†…å­˜çš„æ—¶å€™éœ€è¦æŒ‰é¡µå¯¹é½</span></span><br><span class="line">_array = (<span class="type">void</span>**)<span class="built_in">SystemAlloc</span>(alignSize &gt;&gt; PAGE_SHIFT); <span class="comment">// ä¸ºäº†å¯ç§»æ¤æ€§ï¼Œä½¿ç”¨Cè¯­è¨€çš„å¼ºåˆ¶è½¬æ¢</span></span><br><span class="line"><span class="built_in">memset</span>(_array, <span class="number">0</span>, size); <span class="comment">// æ¸…é›¶</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿™é‡Œé‡‡ç”¨uintptr_tï¼Œä¿è¯å¯ä»¥è¦†ç›–å½“å‰å¹³å°ä¸Šçš„æŒ‡é’ˆæ•°é‡</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">uintptr_t</span> Number;</span><br><span class="line"></span><br><span class="line"><span class="comment">// setçš„æ—¶å€™éœ€è¦ä¿è¯keyæœ‰æ•ˆ</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Set</span><span class="params">(Number key, <span class="type">void</span>* value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">_array[key] = value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">Get</span><span class="params">(Number key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// è¶…è¿‡å½“å‰çš„å…è®¸èŒƒå›´äº†</span></span><br><span class="line"><span class="keyword">if</span> ((key &gt;&gt; BITS) &gt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> _array[key];</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="9-4-å†æ¬¡æ€§èƒ½æµ‹è¯•"><a href="#9-4-å†æ¬¡æ€§èƒ½æµ‹è¯•" class="headerlink" title="9.4 å†æ¬¡æ€§èƒ½æµ‹è¯•"></a>9.4 å†æ¬¡æ€§èƒ½æµ‹è¯•</h2><p>å°†PageCacheä¸­çš„<code>unordered_map</code>æ”¹ä¸ºå•å±‚åŸºæ•°æ ‘ï¼Œç„¶åå†è¿›è¡Œæµ‹è¯•ã€‚è¿™æ¬¡ä½¿ç”¨æ›´å¥½çš„è‡ªåŠ¨åˆ›å»ºçº¿ç¨‹æ¥å¹¶å‘ç”³è¯·çš„æ–¹å¼è¿›è¡Œæµ‹è¯•ï¼Œæ–¹ä¾¿ä¿®æ”¹æµ‹è¯•å˜é‡ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mallocå¤šçº¿ç¨‹æµ‹è¯•</span></span><br><span class="line"><span class="comment">// ntimes ä¸€è½®ç”³è¯·å’Œé‡Šæ”¾å†…å­˜çš„æ¬¡æ•°</span></span><br><span class="line"><span class="comment">// nworks çº¿ç¨‹æ•°é‡</span></span><br><span class="line"><span class="comment">// rounds è½®æ¬¡</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BenchmarkMalloc</span><span class="params">(<span class="type">size_t</span> ntimes, <span class="type">size_t</span> nworks, <span class="type">size_t</span> rounds)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">std::vector&lt;std::thread&gt; <span class="title">vthread</span><span class="params">(nworks)</span></span>;</span><br><span class="line">std::atomic&lt;<span class="type">size_t</span>&gt; malloc_costtime = <span class="number">0</span>;</span><br><span class="line">std::atomic&lt;<span class="type">size_t</span>&gt; free_costtime = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> k = <span class="number">0</span>; k &lt; nworks; ++k)</span><br><span class="line">&#123;</span><br><span class="line">vthread[k] = std::<span class="built_in">thread</span>([&amp;, k]() &#123;</span><br><span class="line">std::vector&lt;<span class="type">void</span>*&gt; v;</span><br><span class="line">v.<span class="built_in">reserve</span>(ntimes);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> j = <span class="number">0</span>; j &lt; rounds; ++j)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">size_t</span> begin1 = <span class="built_in">clock</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; ntimes; i++)</span><br><span class="line">&#123;</span><br><span class="line">v.<span class="built_in">push_back</span>(<span class="built_in">malloc</span>(<span class="number">35</span>));</span><br><span class="line"><span class="comment">//v.push_back(malloc((35 + i) % 8192 + 1));</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">size_t</span> end1 = <span class="built_in">clock</span>();</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> begin2 = <span class="built_in">clock</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; ntimes; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">free</span>(v[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">size_t</span> end2 = <span class="built_in">clock</span>();</span><br><span class="line">v.<span class="built_in">clear</span>();</span><br><span class="line"></span><br><span class="line">malloc_costtime += (end1 - begin1);</span><br><span class="line">free_costtime += (end2 - begin2);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; t : vthread)</span><br><span class="line">&#123;</span><br><span class="line">t.<span class="built_in">join</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%u ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ %u è½®æ¬¡ï¼Œæ¯è½® malloc %u æ¬¡ï¼Œè€—æ—¶ï¼š%u ms\n&quot;</span>,</span><br><span class="line">nworks, rounds, ntimes, malloc_costtime.<span class="built_in">load</span>());</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%u ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ %u è½®æ¬¡ï¼Œæ¯è½® free %u æ¬¡ï¼Œè€—æ—¶ï¼š%u ms\n&quot;</span>,</span><br><span class="line">nworks, rounds, ntimes, free_costtime.<span class="built_in">load</span>());</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%u ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œmalloc/free %u æ¬¡ï¼Œæ€»è®¡è€—æ—¶ï¼š%u ms\n&quot;</span>,</span><br><span class="line">nworks, nworks * rounds * ntimes, malloc_costtime.<span class="built_in">load</span>() + free_costtime.<span class="built_in">load</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å†…å­˜æ± å¤šçº¿ç¨‹æµ‹è¯•</span></span><br><span class="line"><span class="comment">// ntimes ä¸€è½®ç”³è¯·å’Œé‡Šæ”¾å†…å­˜çš„æ¬¡æ•°</span></span><br><span class="line"><span class="comment">// nworks çº¿ç¨‹æ•°é‡</span></span><br><span class="line"><span class="comment">// rounds è½®æ¬¡</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BenchmarkConcurrentMalloc</span><span class="params">(<span class="type">size_t</span> ntimes, <span class="type">size_t</span> nworks, <span class="type">size_t</span> rounds)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">std::vector&lt;std::thread&gt; <span class="title">vthread</span><span class="params">(nworks)</span></span>;</span><br><span class="line">std::atomic&lt;<span class="type">size_t</span>&gt; malloc_costtime = <span class="number">0</span>;</span><br><span class="line">std::atomic&lt;<span class="type">size_t</span>&gt; free_costtime = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> k = <span class="number">0</span>; k &lt; nworks; ++k)</span><br><span class="line">&#123;</span><br><span class="line">vthread[k] = std::<span class="built_in">thread</span>([&amp;]() &#123;</span><br><span class="line">std::vector&lt;<span class="type">void</span>*&gt; v;</span><br><span class="line">v.<span class="built_in">reserve</span>(ntimes);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> j = <span class="number">0</span>; j &lt; rounds; ++j)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">size_t</span> begin1 = <span class="built_in">clock</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; ntimes; i++)</span><br><span class="line">&#123;</span><br><span class="line">v.<span class="built_in">push_back</span>(<span class="built_in">ConcurrentAlloc</span>(<span class="number">35</span>));</span><br><span class="line"><span class="comment">//v.push_back(ConcurrentAlloc((35 + i) % 8192 + 1));</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">size_t</span> end1 = <span class="built_in">clock</span>();</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> begin2 = <span class="built_in">clock</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; ntimes; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">ConcurrentFree</span>(v[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">size_t</span> end2 = <span class="built_in">clock</span>();</span><br><span class="line">v.<span class="built_in">clear</span>();</span><br><span class="line"></span><br><span class="line">malloc_costtime += (end1 - begin1);</span><br><span class="line">free_costtime += (end2 - begin2);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; t : vthread)</span><br><span class="line">&#123;</span><br><span class="line">t.<span class="built_in">join</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%u ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ %u è½®æ¬¡ï¼Œæ¯è½®å†…å­˜æ± ç”³è¯· %u æ¬¡ï¼Œè€—æ—¶ï¼š%u ms\n&quot;</span>,</span><br><span class="line">nworks, rounds, ntimes, malloc_costtime.<span class="built_in">load</span>());</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%u ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ %u è½®æ¬¡ï¼Œæ¯è½®å†…å­˜æ± é‡Šæ”¾ %u æ¬¡ï¼Œè€—æ—¶ï¼š%u ms\n&quot;</span>,</span><br><span class="line">nworks, rounds, ntimes, free_costtime.<span class="built_in">load</span>());</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%u ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œå†…å­˜æ± ç”³è¯·å’Œé‡Šæ”¾ %u æ¬¡ï¼Œæ€»è®¡è€—æ—¶ï¼š%u ms\n&quot;</span>,</span><br><span class="line">nworks, nworks * rounds * ntimes, malloc_costtime.<span class="built_in">load</span>() + free_costtime.<span class="built_in">load</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BenchMark</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">size_t</span> n = <span class="number">10000</span>;</span><br><span class="line"><span class="built_in">BenchmarkConcurrentMalloc</span>(n, <span class="number">4</span>, <span class="number">10</span>);</span><br><span class="line">cout &lt;&lt; endl &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="built_in">BenchmarkMalloc</span>(n, <span class="number">4</span>, <span class="number">10</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨<code>uordered_map</code>çš„æµ‹è¯•ç»“æœï¼ˆDEBUG-X86ï¼‰ï¼Œæ€§èƒ½è¿œä½äºmalloc&#x2F;freeã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ 10 è½®æ¬¡ï¼Œæ¯è½®å†…å­˜æ± ç”³è¯· 100000 æ¬¡ï¼Œè€—æ—¶ï¼š4756 ms</span><br><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ 10 è½®æ¬¡ï¼Œæ¯è½®å†…å­˜æ± é‡Šæ”¾ 100000 æ¬¡ï¼Œè€—æ—¶ï¼š25577 ms</span><br><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œå†…å­˜æ± ç”³è¯·å’Œé‡Šæ”¾ 4000000 æ¬¡ï¼Œæ€»è®¡è€—æ—¶ï¼š30333 ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ 10 è½®æ¬¡ï¼Œæ¯è½® malloc 100000 æ¬¡ï¼Œè€—æ—¶ï¼š6064 ms</span><br><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ 10 è½®æ¬¡ï¼Œæ¯è½® free 100000 æ¬¡ï¼Œè€—æ—¶ï¼š1797 ms</span><br><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œmalloc/free 4000000 æ¬¡ï¼Œæ€»è®¡è€—æ—¶ï¼š7861 ms</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨<strong>å•å±‚åŸºæ•°æ ‘</strong>çš„æµ‹è¯•ç»“æœï¼ˆDEBUG-X86ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶æˆ‘ä»¬çš„å†…å­˜æ± æ•ˆç‡å°±å®Œç¾ä½“ç°å‡ºæ¥äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ 10 è½®æ¬¡ï¼Œæ¯è½®å†…å­˜æ± ç”³è¯· 10000 æ¬¡ï¼Œè€—æ—¶ï¼š177 ms</span><br><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ 10 è½®æ¬¡ï¼Œæ¯è½®å†…å­˜æ± é‡Šæ”¾ 10000 æ¬¡ï¼Œè€—æ—¶ï¼š72 ms</span><br><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œå†…å­˜æ± ç”³è¯·å’Œé‡Šæ”¾ 400000 æ¬¡ï¼Œæ€»è®¡è€—æ—¶ï¼š249 ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ 10 è½®æ¬¡ï¼Œæ¯è½® malloc 10000 æ¬¡ï¼Œè€—æ—¶ï¼š644 ms</span><br><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ 10 è½®æ¬¡ï¼Œæ¯è½® free 10000 æ¬¡ï¼Œè€—æ—¶ï¼š181 ms</span><br><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œmalloc/free 400000 æ¬¡ï¼Œæ€»è®¡è€—æ—¶ï¼š825 ms</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ 10 è½®æ¬¡ï¼Œæ¯è½®å†…å­˜æ± ç”³è¯· 100000 æ¬¡ï¼Œè€—æ—¶ï¼š1899 ms</span><br><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ 10 è½®æ¬¡ï¼Œæ¯è½®å†…å­˜æ± é‡Šæ”¾ 100000 æ¬¡ï¼Œè€—æ—¶ï¼š796 ms</span><br><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œå†…å­˜æ± ç”³è¯·å’Œé‡Šæ”¾ 4000000 æ¬¡ï¼Œæ€»è®¡è€—æ—¶ï¼š2695 ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ 10 è½®æ¬¡ï¼Œæ¯è½® malloc 100000 æ¬¡ï¼Œè€—æ—¶ï¼š5947 ms</span><br><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ 10 è½®æ¬¡ï¼Œæ¯è½® free 100000 æ¬¡ï¼Œè€—æ—¶ï¼š2298 ms</span><br><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œmalloc/free 4000000 æ¬¡ï¼Œæ€»è®¡è€—æ—¶ï¼š8245 ms</span><br></pre></td></tr></table></figure><p>æ”¹æˆReleaseæ¨¡å¼é‡æ–°æµ‹è¯•ä¸€ä¸‹ï¼Œå¯è§Releaseæ¨¡å¼å¯¹mallocæ“ä½œæœ‰ä¸€å®šä¼˜åŒ–ï¼ŒäºŒè€…å·®è·æ²¡æœ‰é‚£ä¹ˆé«˜ï¼Œä¸è¿‡å·²ç»èƒ½ä½“ç°å½“å‰å†…å­˜æ± çš„æ€§èƒ½è¿˜ä¸é”™äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ 10 è½®æ¬¡ï¼Œæ¯è½®å†…å­˜æ± ç”³è¯· 100000 æ¬¡ï¼Œè€—æ—¶ï¼š169 ms</span><br><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ 10 è½®æ¬¡ï¼Œæ¯è½®å†…å­˜æ± é‡Šæ”¾ 100000 æ¬¡ï¼Œè€—æ—¶ï¼š118 ms</span><br><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œå†…å­˜æ± ç”³è¯·å’Œé‡Šæ”¾ 4000000 æ¬¡ï¼Œæ€»è®¡è€—æ—¶ï¼š287 ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ 10 è½®æ¬¡ï¼Œæ¯è½® malloc 100000 æ¬¡ï¼Œè€—æ—¶ï¼š165 ms</span><br><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ 10 è½®æ¬¡ï¼Œæ¯è½® free 100000 æ¬¡ï¼Œè€—æ—¶ï¼š189 ms</span><br><span class="line">4 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œmalloc/free 4000000 æ¬¡ï¼Œæ€»è®¡è€—æ—¶ï¼š354 ms</span><br></pre></td></tr></table></figure><p>å†ç”¨æ€§èƒ½ç›‘è§†å™¨æŸ¥çœ‹ï¼Œå‘ç°æ€§èƒ½æ¶ˆè€—æœ€å¤§çš„å·²ç»æ˜¯vectorçš„pushæ“ä½œäº†ï¼ŒåŸå…ˆè€—æ—¶çš„MapæŸ¥è¯¢æ“ä½œç°åœ¨å æ¯”å·²ç»ä¸é«˜äº†ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/03/3a3ced1ce9cbe0818832ab752fd58f17.png" alt="image-20240306214130138"></p><h1 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h1><p>å†…å­˜æ± çš„åŸºæœ¬å­¦ä¹ å’Œé¡¹ç›®çš„å®ç°å†…å®¹åˆ°è¿™é‡Œå°±OVERå•¦ï¼</p>]]></content>
    
    
    <summary type="html">é«˜å¹¶å‘å†…å­˜æ± é¡¹ç›®çš„å­¦ä¹ </summary>
    
    
    
    <category term="ç¼–ç¨‹å­¦ä¹ " scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="é¡¹ç›®å¼€å‘è®°å½•" scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="Cpp" scheme="https://blog.musnow.top/tags/Cpp/"/>
    
  </entry>
  
  <entry>
    <title>ã€Redisã€‘04.å˜é‡ç±»å‹ï¼ˆæœªå®Œæˆï¼‰</title>
    <link href="https://blog.musnow.top/posts/2729830801/"/>
    <id>https://blog.musnow.top/posts/2729830801/</id>
    <published>2024-02-14T12:37:08.000Z</published>
    <updated>2024-03-07T12:42:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡æ˜¯å¯¹Redisçš„å˜é‡ç±»å‹ä»¥åŠå’Œç‰¹å®šæ•°æ®ç±»å‹ç›¸å…³å‘½ä»¤çš„ä»‹ç»ã€‚</p><h1 id="1-string"><a href="#1-string" class="headerlink" title="1 string"></a>1 string</h1><p><a href="https://redis.io/docs/data-types/strings/">Redis Strings | Redis</a></p><h2 id="1-1-ä»‹ç»"><a href="#1-1-ä»‹ç»" class="headerlink" title="1.1 ä»‹ç»"></a>1.1 ä»‹ç»</h2><p>Redisä¸­ï¼Œæ‰€æœ‰keyéƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œä½œä¸ºvalueçš„å­—ç¬¦ä¸²æœ‰å‡ ä¸ªç‰¹æ€§</p><ul><li>æ— ç¼–ç è½¬æ¢ï¼ˆå­˜çš„æ˜¯ä»€ä¹ˆå–å‡ºæ¥å°±æ˜¯ä»€ä¹ˆï¼‰ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç”¨stringæ¥å­˜æ”¾äºŒè¿›åˆ¶æ–‡ä»¶ï¼›</li><li>é™åˆ¶å¤§å°ä¸º512MBï¼ˆé¿å…è¿‡é•¿çš„stringæ“ä½œè€—æ—¶ï¼‰ï¼›</li></ul><p>åœ¨MySQLä¸­é»˜è®¤çš„å­—ç¬¦é›†æ˜¯æ‹‰ä¸æ–‡ï¼Œæ­¤æ—¶æ’å…¥ä¸­æ–‡å†…å®¹ä¼šç›´æ¥æŠ¥é”™ç¼–ç æ— æ³•è¯†åˆ«è€Œå¤±è´¥ï¼Œéœ€è¦ä¿®æ”¹MySQLæ•°æ®åº“çš„å­—ç¬¦é›†ã€‚è€Œåœ¨Redisä¸­ï¼ˆä¸é…ç½®çš„æƒ…å†µä¸‹ï¼‰æ’å…¥ä¸­æ–‡ï¼Œå¯ä»¥æ­£å¸¸å­˜æ”¾ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set key1 ä½ å¥½</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get key1</span><br><span class="line">&quot;\xe4\xbd\xa0\xe5\xa5\xbd&quot;</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒgetæŸ¥çœ‹çš„æ—¶å€™æ˜¾ç¤ºçš„æ˜¯ä¸­æ–‡ç¼–ç ã€‚æ­¤æ—¶Rediså®¢æˆ·ç«¯æ²¡æœ‰é…ç½®å­—ç¬¦é›†è½¬ç ï¼Œæ‰€ä»¥æ²¡èƒ½æ˜¾ç¤ºä¸­æ–‡ï¼Œä½†å®é™…ä¸Šä¸­æ–‡å°±æ˜¯è¿™ä¹ˆå­˜æ”¾çš„ï¼ˆè¿™å°±å¥½æ¯”è‹±æ–‡å­˜æ”¾çš„æ˜¯å¯¹åº”ASCIIç ä¸€æ ·ï¼‰ã€‚</p><p>å› ä¸ºRedisæœåŠ¡ç«¯æ²¡æœ‰å¯¹ç¼–ç è¿›è¡Œè½¬æ¢ï¼Œæ‰€ä»¥å®ƒé‡åˆ°ä¹±ç é—®é¢˜ï¼ˆæ¯”å¦‚çƒ«çƒ«çƒ«ï¼‰çš„æ¦‚ç‡æ›´å°ã€‚ä½†ä¾æ—§ä¸å»ºè®®ä½¿ç”¨<code>éè‹±æ–‡+æ•°å­—</code>çš„ç»„åˆæ¥åšRedisçš„keyã€‚</p><p>å¦‚æœæƒ³è®©redis-cliçš„ç»ˆç«¯ä¸­<strong>æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡</strong>ï¼Œå¯ä»¥åœ¨å¯åŠ¨çš„æ—¶å€™æ·»åŠ <code>--raw</code>é€‰é¡¹ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œæ·»åŠ äº†è¯¥é€‰é¡¹åï¼Œæ­£å¸¸æ˜¾ç¤ºå‡ºäº†valueçš„ä¸­æ–‡å€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â¯ sudo redis-cli --raw</span><br><span class="line">127.0.0.1:6379&gt; get key1</span><br><span class="line">ä½ å¥½</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šä½¿ç”¨è¯¥é€‰é¡¹ä¼šå¯¼è‡´Redisä¸­æ˜¾ç¤ºçš„<code>(nil)</code>å˜æˆç©ºå­—ç¬¦ä¸²ï¼Œææ˜“äº§ç”Ÿè¯¯å¯¼ï¼å¦‚æœä¸æ˜¯ç¡¬æ€§éœ€è¦åœ¨æ§åˆ¶å°ä¸­æ˜¾ç¤ºä¸­æ–‡ï¼Œè¯·ä¸è¦ä½¿ç”¨è¯¥é€‰é¡¹ï¼</p></blockquote><p>å¦å¤–ï¼Œåœ¨<a href="https://blog.musnow.top/posts/3677820204">RedisåŸºç¡€å‘½ä»¤åšå®¢</a>ä¸­æåˆ°ï¼ŒRedisä¼šå¯¹ä¸åŒçš„stringé‡‡å–ä¸åŒçš„å­˜å‚¨æ–¹å¼ï¼Œå…¶ä¸­å¯¹äºçº¯æ•´æ•°çš„stringé‡‡ç”¨çš„æ˜¯intæ¥å­˜æ”¾ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set key1 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; object encoding key1</span><br><span class="line">int</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥åœ¨Redisä¸­å¦‚æœå­˜æ”¾ä¸€ä¸ª<strong>æ•´æ•°æ•°å­—</strong>ï¼ˆåŒ…æ‹¬è´Ÿæ•°ï¼‰ï¼Œè™½ç„¶å¯¹åº”å˜é‡ç±»å‹æ˜¯stringï¼Œä½†å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªintæ•°å­—æ¥å­˜æ”¾çš„ï¼ŒRedisè¿˜æä¾›äº†ä¸€ç³»åˆ—åŸå­æ€§å‘½ä»¤æ¥å¯¹æ•´æ•°è¿›è¡ŒåŠ å‡æ“ä½œï¼</p><h2 id="1-2-ç›¸å…³å‘½ä»¤"><a href="#1-2-ç›¸å…³å‘½ä»¤" class="headerlink" title="1.2 ç›¸å…³å‘½ä»¤"></a>1.2 ç›¸å…³å‘½ä»¤</h2><p>set&#x2F;getä»¥åŠmset&#x2F;mgetå‘½ä»¤å·²ç»åœ¨<a href="https://blog.musnow.top/posts/3677820204">RedisåŸºç¡€å‘½ä»¤åšå®¢</a>ä¸­è®²è§£äº†ï¼Œè¿™é‡Œä¸å†é‡å¤ã€‚</p><h3 id="1-2-1-setnx-x2F-msetnx"><a href="#1-2-1-setnx-x2F-msetnx" class="headerlink" title="1.2.1 setnx&#x2F;msetnx"></a>1.2.1 setnx&#x2F;msetnx</h3><p>setnxç­‰ä»·äºsetä¸­æ·»åŠ nxé€‰é¡¹ï¼Œåªæœ‰åœ¨keyä¸å­˜åœ¨çš„æ—¶å€™æ‰èƒ½æ­£å¸¸è®¾ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setnx key value</span><br></pre></td></tr></table></figure><ul><li>å½“keyå€¼å·²ç»å­˜åœ¨çš„æ—¶å€™ï¼Œsetnxä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œï¼Œè¿”å›0ï¼›</li><li>å½“keyå€¼ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œsetnxç­‰ä»·äºsetï¼Œè¿”å›1ï¼›</li></ul><p>å¦‚ä¸‹æ‰€ç¤ºï¼Œkey1å­˜åœ¨ï¼Œè®¾ç½®å¤±è´¥è¿”å›0ï¼›key2ä¸å­˜åœ¨ï¼Œè®¾ç½®æˆåŠŸè¿”å›1ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; setnx key1 value2</span><br><span class="line">0</span><br><span class="line">127.0.0.1:6379&gt; setnx key2 value2</span><br><span class="line">1</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ä¸ªå‘½ä»¤æ˜¯msetnxï¼ˆå’Œmsetä¸€æ ·ï¼‰ï¼Œå¯ä»¥åŸå­æ€§åœ°åŒæ—¶setnxå¤šä¸ªkeyã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mset key value [key value ...]</span><br></pre></td></tr></table></figure><ul><li>åªè¦ç»™å®šçš„å¤šä¸ªkeyä¸­æœ‰ä¸€ä¸ªkeyå­˜åœ¨ï¼Œmsetnxå°±ä¼šå¤±è´¥ä¸”ä»€ä¹ˆéƒ½ä¸åšï¼Œè¿”å›0ï¼›</li><li>åªæœ‰ç»™å®šçš„å¤šä¸ªkeyå…¨éƒ¨éƒ½ä¸å­˜åœ¨ï¼Œmsetnxæ‰ä¼šæˆåŠŸï¼Œè¿”å›1ï¼›</li></ul><p>å¦‚ä¸‹æ‰€ç¤ºï¼Œæ­¤æ—¶key1å’Œkey2å·²ç»å­˜åœ¨ï¼Œè®¾ç½®å¤±è´¥è¿”å›0ï¼›key3å’Œkey4éƒ½ä¸å­˜åœ¨ï¼Œ è®¾ç½®æˆåŠŸè¿”å›1ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; msetnx key1 value1 key2 value2 key3 value3</span><br><span class="line">0</span><br><span class="line">127.0.0.1:6379&gt; msetnx key3 value3 key4 value4</span><br><span class="line">1</span><br></pre></td></tr></table></figure><h3 id="1-2-2-setex-x2F-psetex"><a href="#1-2-2-setex-x2F-psetex" class="headerlink" title="1.2.2 setex&#x2F;psetex"></a>1.2.2 setex&#x2F;psetex</h3><p>setex&#x2F;psetexæ˜¯åœ¨è®¾ç½®keyçš„æ—¶å€™æŒ‡å®šè¿‡æœŸæ—¶é—´ï¼Œåªæ˜¯æ—¶é—´å•ä½ä¸ä¸€æ ·ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setex key value second</span><br><span class="line">psetex key value milisecond</span><br></pre></td></tr></table></figure><p>è™½ç„¶setå‘½ä»¤æœ¬èº«å·²ç»æä¾›äº†å…³äºè¿™äº›åŠŸèƒ½çš„é€‰é¡¹ï¼Œä½†ç›´æ¥ä½¿ç”¨<strong>ç‰¹å®šå‘½ä»¤</strong>æ¥è®¾ç½®è€Œä¸æ˜¯ç”¨å‘½ä»¤çš„å‚æ•°ä¼šæ›´åŠ æ–¹ä¾¿ä¸”ç¬¦åˆäººçš„ç›´è§‰ï¼Œä½¿ç”¨é—¨æ§›ä¹Ÿæ›´ä½ï¼</p><blockquote><p>å¯¹äºå­¦ä¹ è¿‡Linuxç³»ç»Ÿä½¿ç”¨çš„å¼€å‘äººå‘˜è€Œè¨€ï¼Œå‘½ä»¤å‚æ•°å·²ç»è§æ€ªä¸æ€ªäº†ã€‚ä½†å¯¹äºåˆæ¬¡å­¦ä¹ Redisä½¿ç”¨è€Œæ²¡æœ‰æ¥è§¦è¿‡Linuxç³»ç»Ÿçš„èŒæ–°è€Œè¨€ï¼Œä½¿ç”¨ä¸€ä¸ªç®€å•çš„å‘½ä»¤æ¥ä¼ é€’å•ä¸ªå‚æ•°ï¼Œä¼šæ¯”åœ¨setåé¢æ·»åŠ ä¸€å¤§å †é€‰é¡¹æ›´åŠ ç®€å•ä¸”ä¸å®¹æ˜“çŠ¯é”™ã€‚</p></blockquote><h3 id="1-2-3-æ•°å­—åŠ å‡å‘½ä»¤"><a href="#1-2-3-æ•°å­—åŠ å‡å‘½ä»¤" class="headerlink" title="1.2.3 æ•°å­—åŠ å‡å‘½ä»¤"></a>1.2.3 æ•°å­—åŠ å‡å‘½ä»¤</h3><p>å› ä¸ºRedisä¸­çš„æ•´æ•°æ˜¯ç”¨intæ¥å­˜æ”¾çš„ï¼Œæ‰€ä»¥å®ƒæä¾›äº†ä¸€äº›å‘½ä»¤æ¥<strong>åŸå­æ€§</strong>çš„æ“ä½œæ•°å­—ã€‚è¿™äº›å‘½ä»¤ä¸­å¦‚æœç»™å®šçš„keyä¸å­˜åœ¨ï¼Œåˆ™ä¼šå°†å…¶è§†ä½œ0ï¼Œæ–°å»ºä¸€ä¸ªkeyå†åŠ ä¸Šç›®æ ‡å€¼ã€‚</p><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>incr key</td><td>value + 1</td><td>valueå¿…é¡»æ˜¯æ•´æ•°</td></tr><tr><td>incrby key n</td><td>value + n</td><td>valueå¿…é¡»æ˜¯æ•´æ•°ï¼Œç»™å®šçš„nå¯ä»¥æ˜¯è´Ÿæ•°</td></tr><tr><td>decr key</td><td>value - 1</td><td>valueå¿…é¡»æ˜¯æ•´æ•°</td></tr><tr><td>decrby key n</td><td>value - n</td><td>valueå¿…é¡»æ˜¯æ•´æ•°ï¼Œç»™å®šçš„nå¯ä»¥æ˜¯è´Ÿæ•°</td></tr><tr><td>incrbyfloat key n</td><td>value +&#x2F;- å°æ•°</td><td>ç»™å®šçš„nå¯ä»¥æ˜¯è´Ÿæ•°æ¥å®ç°å‡æ³•</td></tr></tbody></table><p>æ³¨æ„ï¼š<code>decrbyfloat</code>å‘½ä»¤æ˜¯ä¸å­˜åœ¨çš„ï¼</p><p>å‰å››ä¸ªå‘½ä»¤çš„æ“ä½œæ•°valueå¿…é¡»æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œå¦åˆ™ä¼šå¤±è´¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get key1</span><br><span class="line">119.3</span><br><span class="line">127.0.0.1:6379&gt; incr key1</span><br><span class="line">ERR value is not an integer or out of range</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; decr key1</span><br><span class="line">ERR value is not an integer or out of range</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨incrbyfloatå‘½ä»¤æ“ä½œä¸€ä¸ªæ•´æ•°åï¼Œå®ƒçš„å­˜æ”¾æ–¹å¼å°±ä¸å†æ˜¯intï¼Œè€Œå˜æˆembsträº†ã€‚æ­¤æ—¶æˆ‘ä»¬ä¾æ—§å¯ä»¥ç”¨incrbyfloatå‘½ä»¤æ¥ç»§ç»­æ·»åŠ å°æ•°ï¼ˆåŒ…æ‹¬å‡å»å°æ•°ï¼‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set key1 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; object encoding key1</span><br><span class="line">int</span><br><span class="line">127.0.0.1:6379&gt; incrbyfloat key1 19.3</span><br><span class="line">119.3</span><br><span class="line">127.0.0.1:6379&gt; get key1</span><br><span class="line">119.3</span><br><span class="line">127.0.0.1:6379&gt; object encoding key1</span><br><span class="line">embstr</span><br><span class="line">127.0.0.1:6379&gt; incrbyfloat key1 0.7</span><br><span class="line">120</span><br><span class="line">127.0.0.1:6379&gt; object encoding key1</span><br><span class="line">embstr</span><br><span class="line">127.0.0.1:6379&gt; incrbyfloat key1 -0.7</span><br><span class="line">119.3</span><br></pre></td></tr></table></figure><h3 id="1-2-4-append"><a href="#1-2-4-append" class="headerlink" title="1.2.4 append"></a>1.2.4 append</h3><p>appendå‘½ä»¤ç”¨äºåœ¨å­—ç¬¦ä¸²ä¹‹åè¿½åŠ å­—ç¬¦ä¸²ã€‚å¦‚æœç»™å®škeyä¸å­˜åœ¨ï¼Œåˆ™å’Œsetå‘½ä»¤ç­‰ä»·ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">append key value</span><br></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(1)</code>ï¼Œè¿”å›å€¼æ˜¯è¿½åŠ åçš„å­—ç¬¦ä¸²é•¿åº¦ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set k 123</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; append k 45</span><br><span class="line">5</span><br><span class="line">127.0.0.1:6379&gt; get k</span><br><span class="line">12345</span><br></pre></td></tr></table></figure><p>å¦‚æœå°è¯•ç»™kè¿½åŠ ä¸€ä¸ªä¸­æ–‡ï¼Œå­—ç¬¦ä¸²é•¿åº¦ä¼šæ˜¯å¤šå°‘å‘¢ï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; append k ä½ å¥½</span><br><span class="line">11</span><br><span class="line">127.0.0.1:6379&gt; get k</span><br><span class="line">12345ä½ å¥½</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ€ç»ˆé•¿åº¦æ˜¯11ï¼Œå› ä¸ºRedisä¸ä¼šå¯¹å­—ç¬¦ä¸²è¿›è¡Œè½¬ç ï¼Œä¸­æ–‡åœ¨UTF8ç¯å¢ƒä¸‹æ˜¯ç”¨ä¸‰ä¸ªå­—èŠ‚å­˜æ”¾çš„ï¼Œæ‰€ä»¥ä¸¤ä¸ªä¸­æ–‡å°±æ˜¯6å­—èŠ‚ï¼ŒåŠ ä¸ŠåŸæœ¬çš„5ä¸ªå­—èŠ‚ï¼Œæœ€ç»ˆé•¿åº¦å°±æ˜¯11å­—èŠ‚ã€‚</p><p>ä¸ä½¿ç”¨<code>--raw</code>å¯åŠ¨redis-cliï¼Œå°±èƒ½çœ‹åˆ°è¿™ä¸¤ä¸ªä¸­æ–‡çš„åŸå§‹ç¼–ç å€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get k</span><br><span class="line">&quot;12345\xe4\xbd\xa0\xe5\xa5\xbd&quot;</span><br></pre></td></tr></table></figure><h3 id="1-2-5-getrange"><a href="#1-2-5-getrange" class="headerlink" title="1.2.5 getrange"></a>1.2.5 getrange</h3><p>è¿™ä¸ªå‘½ä»¤ç”¨äºè·å–å­—ç¬¦ä¸²çš„å­ä¸²ï¼Œstart&#x2F;endæŒ‡å®šä¸€ä¸ªåŒºé—´ï¼ˆé‡‡ç”¨ä¸‹æ ‡æ–¹å¼ä¸”ä¸ºé—­åŒºé—´ï¼‰ã€‚è¯¥å‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(N)</code>ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getrange key start end</span><br></pre></td></tr></table></figure><p>æµ‹è¯•å¦‚ä¸‹ï¼Œ2ä»£è¡¨ä»ç¬¬ä¸‰ä¸ªå­—ç¬¦å¼€å§‹ï¼Œ4ä»£è¡¨ç¬¬äº”ä¸ªå­—ç¬¦ç»“æŸã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set key 123456789</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; getrange key 2 4</span><br><span class="line">&quot;345&quot;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„start&#x2F;endè¿˜å¯ä»¥ç»™è´Ÿæ•°ã€‚å½“endä¸ºè´Ÿæ•°æ—¶ï¼Œä»£è¡¨ç›´æ¥å–åˆ°æœ«å°¾ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; getrange key -1 4</span><br><span class="line">&quot;&quot;</span><br><span class="line">127.0.0.1:6379&gt; getrange key 2 -1</span><br><span class="line">&quot;3456789&quot;</span><br></pre></td></tr></table></figure><p>å½“startå°äºendæ—¶ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; getrange key 2 0</span><br><span class="line">&quot;&quot;</span><br><span class="line">127.0.0.1:6379&gt; getrange key 2 1</span><br><span class="line">&quot;&quot;</span><br><span class="line">127.0.0.1:6379&gt; getrange key 2 2</span><br><span class="line">&quot;3&quot;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œgetrangeçš„åˆ‡åˆ†æ˜¯ä¸¥æ ¼æŒ‰ç…§å­—èŠ‚åˆ‡åˆ†çš„ï¼Œå¦‚æœæ˜¯ä¸­æ–‡ï¼Œåˆ™éš¾ä»¥æ‹†åˆ†å‡ºä¸€ä¸ªæ­£å¸¸çš„ä¸­æ–‡å­—ç¬¦ï¼ˆè¦æŒ‰3ä¸ªå­—èŠ‚çš„é—´éš™æ‰èƒ½æ‹†å‡ºä¸€ä¸ªæ­£å¸¸çš„ä¸­æ–‡å­—ç¬¦ï¼‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">â¯ sudo redis-cli</span><br><span class="line">127.0.0.1:6379&gt; get k</span><br><span class="line">&quot;12345\xe4\xbd\xa0\xe5\xa5\xbd&quot;</span><br><span class="line">127.0.0.1:6379&gt; getrange k 5 -1</span><br><span class="line">&quot;\xe4\xbd\xa0\xe5\xa5\xbd&quot;</span><br><span class="line">127.0.0.1:6379&gt; getrange k 5 6</span><br><span class="line">&quot;\xe4\xbd&quot;</span><br><span class="line"></span><br><span class="line">â¯ sudo redis-cli --raw</span><br><span class="line">127.0.0.1:6379&gt; get k</span><br><span class="line">12345ä½ å¥½</span><br><span class="line">127.0.0.1:6379&gt; getrange k 5 6</span><br><span class="line">ï¿½</span><br><span class="line">127.0.0.1:6379&gt; getrange k 5 7</span><br><span class="line">ä½ </span><br></pre></td></tr></table></figure><h3 id="1-2-6-setrange"><a href="#1-2-6-setrange" class="headerlink" title="1.2.6 setrange"></a>1.2.6 setrange</h3><p>ä»æŒ‡å®šä¸‹æ ‡å¼€å§‹æ›¿æ¢å­—ç¬¦ä¸²ï¼Œè¿”å›å€¼æ˜¯æ›¿æ¢åå­—ç¬¦ä¸²çš„é•¿åº¦ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setrange key offset value</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get key</span><br><span class="line">123456789</span><br><span class="line">127.0.0.1:6379&gt; setrange key 3 hhhh</span><br><span class="line">9</span><br><span class="line">127.0.0.1:6379&gt; get key</span><br><span class="line">123hhhh89</span><br></pre></td></tr></table></figure><h3 id="1-2-7-strlen"><a href="#1-2-7-strlen" class="headerlink" title="1.2.7 strlen"></a>1.2.7 strlen</h3><p>è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå•ä½æ˜¯å­—èŠ‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strlen key</span><br></pre></td></tr></table></figure><h2 id="1-3-ç¼–ç ä»‹ç»"><a href="#1-3-ç¼–ç ä»‹ç»" class="headerlink" title="1.3 ç¼–ç ä»‹ç»"></a>1.3 ç¼–ç ä»‹ç»</h2><p>stringæœ‰ä¸‰ç§ç¼–ç æ–¹å¼</p><ul><li>embstrï¼šä¸ºçŸ­å­—ç¬¦ä¸²ä¼˜åŒ–ï¼›</li><li>intï¼šä¸ºéè´Ÿæ•´æ•°ä¼˜åŒ–ï¼›</li><li>rawï¼šåŸå§‹å­—ç¬¦ä¸²ï¼›</li></ul><p>æ³¨æ„ï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆç¼–ç æ–¹å¼ï¼Œéƒ½ä¸ä¼šå½±å“å¯¹stringçš„æ•°å­—åŠ å‡å‘½ä»¤çš„ä½¿ç”¨ï¼ˆåªè¦valueæ˜¯ä¸€ä¸ªæ•°å­—å°±è¡Œï¼Œå³ä¾¿å°æ•°çš„ç¼–ç æ–¹å¼æ˜¯embstrï¼Œä¹Ÿä¾æ—§å¯ä»¥ä½¿ç”¨æ•°å­—åŠ å‡å‘½ä»¤ï¼‰</p><h2 id="1-4-åº”ç”¨åœºæ™¯"><a href="#1-4-åº”ç”¨åœºæ™¯" class="headerlink" title="1.4 åº”ç”¨åœºæ™¯"></a>1.4 åº”ç”¨åœºæ™¯</h2><h3 id="1-4-1-ç”¨æˆ·ä¿¡æ¯ç¼“å­˜"><a href="#1-4-1-ç”¨æˆ·ä¿¡æ¯ç¼“å­˜" class="headerlink" title="1.4.1 ç”¨æˆ·ä¿¡æ¯ç¼“å­˜"></a>1.4.1 ç”¨æˆ·ä¿¡æ¯ç¼“å­˜</h3><p>ç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦è·å–çš„ä¿¡æ¯éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„ã€‚æ¯”å¦‚ç”¨æˆ·ä¸ªäººä¿¡æ¯çš„JSONå­—ç¬¦ä¸²ã€‚</p><p>æ­¤æ—¶å¯ä»¥åœ¨Redisä¸­ç”¨<code>user:å¹³å°:ç”¨æˆ·ID</code>çš„æ–¹å¼åškeyï¼Œæ¥ä¿å­˜ç”¨æˆ·åŸºæœ¬ä¸ªäººä¿¡æ¯çš„JSONå­—ç¬¦ä¸²ã€‚å¦‚æœä½¿ç”¨Redis+MySQLçš„ç»„åˆçš„è¯ï¼Œæ•´ä¸ªç”¨æˆ·ä¿¡æ¯çš„è¯·æ±‚æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>ç”¨æˆ·æµè§ˆå™¨&#x2F;APPä¸­ç‚¹å‡»ä¸ªäººä¿¡æ¯é¡µé¢ï¼Œå®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼Œå‡è®¾ç”¨æˆ·IDä¸º100ï¼›</li><li>åº”ç”¨æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œå…ˆå»è¯·æ±‚RedisæœåŠ¡å™¨ï¼š<code>get user:å¹³å°:100</code>ï¼›</li><li>Redisä¸­æˆåŠŸæŸ¥è¯¢åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå°†Jsonå­—ç¬¦ä¸²è¿”å›ç»™ç”¨æˆ·ï¼›</li><li>æ²¡æœ‰åœ¨Redisä¸­æŸ¥è¯¢åˆ°ï¼Œä½¿ç”¨SQLè¯·æ±‚MySQLæœåŠ¡å™¨<code>select ç”¨æˆ·ä¸ªäººä¿¡æ¯å­—æ®µ from user where user_id = &#39;100&#39;;</code></li><li>å°†MySQLè¿”å›çš„ç›¸å…³é”®å€¼æŒ‰é¢„å®šæ ¼å¼åˆ¶ä½œæˆJSONå­—ç¬¦ä¸²ï¼Œè¿”å›ç»™ç”¨æˆ·ï¼›</li><li>å°†è¯¥JSONå­—ç¬¦ä¸²å†™å…¥RedisæœåŠ¡å™¨ï¼š<code>set user:å¹³å°:100 JSONå­—ç¬¦ä¸²</code>ï¼›</li></ul><p>åœ¨setçš„æ—¶å€™è¿˜å¯ä»¥è®¾å®šä¸€å®šçš„è¿‡æœŸæ—¶é—´ï¼Œåœ¨ä¿è¯ç¼“å­˜çš„å®æ—¶æ€§çš„åŸºç¡€ä¸Šï¼Œé¿å…Redisä¸­çš„æ•°æ®å§‹ç»ˆå¢é•¿è€Œå¯¼è‡´å†…å­˜çˆ†æ»¡ã€‚ï¼ˆå½“ç„¶ï¼Œå†…å­˜å¿«æ»¡çš„æ—¶å€™Redisæœ‰æ·˜æ±°ç­–ç•¥å¯ä¾›é€‰æ‹©ï¼Œé‚£æ˜¯åé¢è¦å­¦ä¹ çš„å†…å®¹äº†ï¼‰ã€‚</p><h3 id="1-4-2-è§†é¢‘æ’­æ”¾é‡è®¡æ•°"><a href="#1-4-2-è§†é¢‘æ’­æ”¾é‡è®¡æ•°" class="headerlink" title="1.4.2 è§†é¢‘æ’­æ”¾é‡è®¡æ•°"></a>1.4.2 è§†é¢‘æ’­æ”¾é‡è®¡æ•°</h3><p>å¯¹äºè§†é¢‘ç‚¹èµã€æ’­æ”¾é‡è¿™ç§ç»å¸¸å˜åŠ¨çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨Redisæ¥åšè®¡æ•°ã€‚æ¯”å¦‚ä½¿ç”¨<code>vedio:hit:è§†é¢‘ID</code>ä½œä¸ºkeyï¼Œä»£è¡¨è§†é¢‘çš„æ’­æ”¾é‡ã€‚</p><p>å½“ç”¨æˆ·ç‚¹å‡»ä¸€ä¸ªè§†é¢‘çš„æ—¶å€™ï¼Œå‘èµ·è¯·æ±‚ç»™åº”ç”¨æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨åœ¨è¿”å›è§†é¢‘ç›¸å…³ä¿¡æ¯çš„åŒæ—¶ï¼Œå°†æ’­æ”¾é‡åŠ ä¸€çš„ä¿¡æ¯ï¼Œä½¿ç”¨incrå‘½ä»¤ä¼ é€’ç»™RedisæœåŠ¡å™¨ã€‚</p><p>ä½†åªç”¨Redisè‚¯å®šæ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜ä¼šæœ‰ä¸€ä¸ªMySQLæ•°æ®è¡¨æ¥å­˜æ”¾è§†é¢‘å¯¹åº”çš„ç‚¹èµã€æ’­æ”¾ã€æ”¶è—ç­‰å…¨é‡ä¿¡æ¯ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä»¤èµ·ä¸€ä¸ªæœåŠ¡ï¼Œ<strong>å¼‚æ­¥</strong>åœ°åŒæ­¥è§†é¢‘æ’­æ”¾é‡ã€ç‚¹èµç­‰ç›¸å…³ä¿¡æ¯åˆ°MySQLè¡¨ä¸­ã€‚</p><blockquote><p><strong>å¼‚æ­¥</strong>åŒæ­¥ï¼šå¹¶éæ¥ä¸€ä¸ªè§†é¢‘è¯·æ±‚å°±åŒæ­¥åˆ°MySQLä¸€æ¬¡ï¼Œè€Œæ˜¯ä»¥ä¸€å®šé¢‘ç‡ï¼ˆæ—¶é—´é—´éš”ï¼‰å°†Redisä¸­çš„æ•°æ®åŒæ­¥åˆ°MySQLè¡¨ä¸­ã€‚è¿™æ ·èƒ½ä¿è¯Redisä¸­çš„æ•°æ®èƒ½æœ‰å¤‡ä»½ã€‚</p></blockquote><p>å®é™…åœºæ™¯ä¸­ï¼Œè¦æƒ³å¼€å‘ä¸€ä¸ªç¨³å®šçš„çœŸå®è®¡æ•°ç³»ç»Ÿï¼Œè¿˜éœ€è¦è€ƒè™‘é˜²ä½œå¼Šã€ä¸åŒç»´åº¦è®¡æ•°ã€é¿å…å•ç‚¹é—®é¢˜ä»¥åŠæ•°æ®æŒä¹…åŒ–ç­‰ç­‰æ–¹é¢ã€‚è¿™äº›éƒ½éœ€è¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡é€»è¾‘æ¥ç‰¹æ®Šå¤„ç†ã€‚</p><h3 id="1-4-3-cookie-seesion"><a href="#1-4-3-cookie-seesion" class="headerlink" title="1.4.3 cookie+seesion"></a>1.4.3 cookie+seesion</h3><p>åœ¨HTTPç½‘ç»œæœåŠ¡ä¸­ï¼Œcookieæ˜¯æœ€å¸¸ç”¨çš„ç”¨äºæ ‡å®šå®¢æˆ·ç«¯ä¿¡æ¯çš„æ–¹å¼ã€‚æœ‰äº›ç½‘ç«™å¹¶éæ¯æ¬¡æ‰“å¡éƒ½éœ€è¦ç™»å½•ï¼Œè€Œæ˜¯ç™»å½•äº†ä¹‹åèƒ½ç»´æŒä¸€æ®µæ—¶é—´ä¸éœ€è¦ç”¨æˆ·æ¯æ¬¡éƒ½é‡æ–°ç™»å½•ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå°±æ˜¯é€šè¿‡æµè§ˆå™¨ç«¯çš„cookieå’ŒæœåŠ¡å™¨ç«¯çš„sessionæ¥å®ç°çš„ã€‚</p><ul><li>cookieï¼šå­˜æ”¾åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸­ï¼Œå…¶å€¼æ˜¯é€šè¿‡HTTPçš„<code>Set-Cookie</code>å“åº”å¤´ç”±æœåŠ¡å™¨å‘ŠçŸ¥ç”¨æˆ·æµè§ˆå™¨çš„ï¼›</li><li>sessionï¼šå­˜æ”¾åœ¨æœåŠ¡å™¨ç«¯ï¼ˆå®é™…ä¸ŠæœåŠ¡å™¨ç«¯åº”è¯¥å­˜æ”¾çš„æ˜¯cookie-sessionçš„é”®å€¼å¯¹ï¼‰ï¼Œç”¨äºæ ‡å®šç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼›</li></ul><p>å½“ç”¨æˆ·ç™»å½•åï¼ŒæœåŠ¡å™¨ä¼šç”Ÿæˆä¸€ä¸ª<code>session_id</code>ï¼Œå°†å…¶å’Œç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ç»‘å®šï¼ˆé”®å€¼å¯¹ï¼‰ï¼Œå¹¶å‘é€åŒ…å«<code>Set-Cookie</code>å¤´çš„HTTPæŠ¥æ–‡ç»™å®¢æˆ·ç«¯ï¼Œå°†<code>session_id</code>å‘ŠçŸ¥ç”¨æˆ·ã€‚æµè§ˆå™¨åœ¨æ£€æµ‹åˆ°è¿™ä¸ªå“åº”å¤´åï¼Œä¼šå°†å®ƒå¯¹åº”çš„å€¼ä¿å­˜åœ¨æœ¬åœ°ï¼Œä¸‹ä¸€æ¬¡å‘è¿™ä¸ªç½‘ç«™å‘èµ·HTTPè¯·æ±‚çš„æ—¶å€™å°±ä¼šå¸¦ä¸Šè¿™ä¸ªè®¾ç½®çš„cookieå€¼é‡Œé¢çš„<code>session_id</code>ã€‚</p><p>æœåŠ¡å™¨æ”¶åˆ°HTTPè¯·æ±‚åï¼Œæ£€æŸ¥è¯·æ±‚å¤´ä¸­çš„<code>Cookie</code>å­—æ®µï¼Œå¹¶ä¸æœåŠ¡å™¨ä¸­å­˜æ”¾çš„<code>session_id</code>é”®å€¼å¯¹è¿›è¡Œå¯¹æ¯”ï¼Œå¾—åˆ°å¯¹åº”çš„ç”¨æˆ·ï¼Œåˆ™è¿”å›ç”¨æˆ·ç›¸å…³ä¿¡æ¯ï¼Œå³å½“å‰ç”¨æˆ·å·²ç™»å½•ã€‚</p><p>å®ç°ç½‘é¡µç™»å½•åœ¨ä¸€å®šæ—¶é—´åè¿‡æœŸçš„åŠŸèƒ½ï¼Œåªéœ€è¦åœ¨Redisä¸­ç»™è¿™ä¸ªé”®å€¼å¯¹è®¾ç½®ä¸€ä¸ª<strong>è¿‡æœŸæ—¶é—´</strong>å°±è¡Œäº†ã€‚</p><p>ä½¿ç”¨cookie+sessionçš„æ–¹å¼ä¹Ÿæ›´åŠ æ–¹ä¾¿å¤šä¸ªåº”ç”¨æœåŠ¡å™¨ä¹‹é—´çš„æ¶ˆæ¯å…±äº«ã€‚å› ä¸º<strong>è´Ÿè½½å‡è¡¡</strong>çš„å­˜åœ¨ï¼Œç”¨æˆ·çš„è¯·æ±‚å¯èƒ½ä¼šè¢«å‘é€åˆ°ä¸åŒçš„åº”ç”¨æœåŠ¡å™¨ã€‚åªè¦è¿™äº›åº”ç”¨æœåŠ¡å™¨<strong>ä½¿ç”¨ç›¸åŒçš„Redis</strong>ï¼Œå®ƒä»¬å°±éƒ½èƒ½æ£€ç´¢åˆ°ç”¨æˆ·çš„cookieå¯¹åº”çš„sessionä¿¡æ¯ï¼Œä¹Ÿå°±çŸ¥é“äº†å½“å‰ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ï¼Œå¯ä»¥æ­£å¸¸è¿›è¡ŒæœåŠ¡ï¼ˆå…¶å®å°±æ˜¯ä¿¡æ¯åœ¨å¤šä¸ªåº”ç”¨æœåŠ¡å™¨ä¹‹ä¸­è¿›è¡Œå…±äº«ï¼‰ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ç”¨æˆ·å®Œå…¨ä¸ä¼šå‘ç°è‡ªå·±çš„è¯·æ±‚å¹¶éæ˜¯åŒä¸€ä¸ªæœåŠ¡å™¨æ¥å¤„ç†çš„ã€‚</p><h3 id="1-4-4-éªŒè¯ç "><a href="#1-4-4-éªŒè¯ç " class="headerlink" title="1.4.4 éªŒè¯ç "></a>1.4.4 éªŒè¯ç </h3><p>è¿™ä¸ªåœºæ™¯å°±å¾ˆå¸¸è§äº†ï¼Œæ‰‹æœºéªŒè¯ç &#x2F;é‚®ç®±éªŒè¯ç éƒ½æ˜¯å¦‚æ­¤ï¼Œåœ¨Redisä¸­è®¾ç½®ä¸€ä¸ªéªŒè¯ç çš„keyï¼Œvalueæ˜¯å¯¹åº”ç”¨æˆ·çš„idï¼Œ<strong>å¹¶ç»™è¿™ä¸ªkeyè®¾ç½®ä¸€å®šçš„è¿‡æœŸæ—¶é—´</strong>ï¼Œå°±èƒ½å®ç°éªŒè¯ç çš„åŠŸèƒ½ã€‚</p><p>å½“ç”¨æˆ·è¾“å…¥éªŒè¯ç åï¼Œæ£€æŸ¥Redisä¸­çš„keyï¼Œå½“valueä¸­çš„idå’Œç”¨æˆ·çš„idç›¸åŒï¼Œåˆ™ä»£è¡¨éªŒè¯æˆåŠŸã€‚ç”¨æˆ·idä¸åŒæˆ–éªŒè¯ç çš„keyä¸å­˜åœ¨ï¼Œåˆ™éªŒè¯å¤±è´¥ã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹ä¸­å¯èƒ½è¿˜ä¼šæ¶‰åŠåˆ°é—´éš”60sç§’æ‰èƒ½å‘é€ä¸€æ¬¡éªŒè¯ç ï¼ˆè¿™ç§é™åˆ¶å¤§æ¦‚ç‡æ˜¯å‰ç«¯åšçš„å¤„ç†ï¼‰åç«¯è‡ªç„¶ä¹Ÿå¯ä»¥é€šè¿‡ä¸€äº›ç¼“å­˜çš„æ—¶é—´å€¼æ¥åšæ£€æŸ¥ï¼Œé¿å…ç»™åŒä¸€ä¸ªç”¨æˆ·åœ¨è¾ƒçŸ­æ—¶é—´å†…å‘é€å¤šä¸ªéªŒè¯ç ï¼ˆä¼šå½±å“æ€§èƒ½ï¼‰ã€‚</p><h1 id="2-Hash"><a href="#2-Hash" class="headerlink" title="2 Hash"></a>2 Hash</h1><h2 id="2-1-ä»‹ç»"><a href="#2-1-ä»‹ç»" class="headerlink" title="2.1 ä»‹ç»"></a>2.1 ä»‹ç»</h2><p>å“ˆå¸Œæ˜¯æ¯”è¾ƒå¸¸è§çš„ä¸€ç§æ•°æ®ç»“æ„ï¼ŒRedisæœ¬èº«çš„key-valueç»“æ„å…¶å®å°±æ˜¯é€šè¿‡å“ˆå¸Œæ¥å®ç°çš„ã€‚åŒæ—¶ï¼ŒRedisä¹Ÿæä¾›äº†hashä½œä¸ºvalueçš„æ•°æ®ç±»å‹ï¼Œä¸ºäº†å’ŒRedisæœ¬èº«çš„kvè¿›è¡ŒåŒºåˆ†ï¼Œhashç±»å‹å†…çš„é”®å€¼å¯¹è¢«ç§°ä¸º<code>field-value</code>ã€‚</p><p>æ¯”å¦‚å­˜æ”¾ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯ï¼ŒåŸæœ¬æˆ‘ä»¬å¯ä»¥é‡‡ç”¨å¦‚ä¸‹æ–¹å¼ï¼Œåœ¨keyä¸­ç”¨å†’å·ä½œä¸ºåˆ†éš”æ¥ä¿å­˜ä¸ªäººä¿¡æ¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user:1:name æå››</span><br><span class="line">user:1:age  20</span><br><span class="line">user:1:sex  ç”·</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥ç›´æ¥å°†valueè®¾ç½®ä¸ºhashç±»å‹ï¼Œç„¶ååœ¨å…¶ä¸­å†è®¾ç½®å¯¹åº”çš„fieldå’Œvalueï¼Œçœ‹ä¸Šå»å°±æ›´åŠ æ˜äº†ã€‚</p><table><thead><tr><th>key</th><th>field</th><th>value</th></tr></thead><tbody><tr><td>user:1</td><td>name</td><td>æå››</td></tr><tr><td>user:1</td><td>ag</td><td>20</td></tr><tr><td>user:1</td><td>sex</td><td>ç”·</td></tr></tbody></table><h2 id="2-2-ç›¸å…³å‘½ä»¤"><a href="#2-2-ç›¸å…³å‘½ä»¤" class="headerlink" title="2.2 ç›¸å…³å‘½ä»¤"></a>2.2 ç›¸å…³å‘½ä»¤</h2><h3 id="2-2-1-HSET-x2F-HGET-x2F-HGETALL"><a href="#2-2-1-HSET-x2F-HGET-x2F-HGETALL" class="headerlink" title="2.2.1 HSET&#x2F;HGET&#x2F;HGETALL"></a>2.2.1 HSET&#x2F;HGET&#x2F;HGETALL</h3><p><a href="https://redis.io/commands/hget/">https://redis.io/commands/hget/</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HSET key field value [field value ...]</span><br><span class="line">HGET key field</span><br></pre></td></tr></table></figure><p>ç»è¿‡ä¹‹å‰çš„å‘½ä»¤å­¦ä¹ ï¼Œç°åœ¨è¿™é‡Œçš„å‘½ä»¤å°±å¾ˆå¥½ç†è§£äº†ã€‚</p><ul><li>HSETç”¨äºè®¾ç½®hashç±»å‹å†…éƒ¨çš„fieldï¼Œå¯ä»¥åŒæ—¶è®¾ç½®å¤šä¸ªfieldï¼›</li><li>HGETç”¨äºè·å–hashç±»å‹å†…éƒ¨çš„fieldã€‚</li></ul><p>HSETå‘½ä»¤çš„è¿”å›å€¼æ˜¯è®¾ç½®æˆåŠŸçš„fieldçš„ä¸ªæ•°ã€‚å½“HGETå‘½ä»¤æŒ‡å®šçš„keyæˆ–è€…fieldä¸å­˜åœ¨æ—¶ï¼Œä¼šè¿”å›<code>nil</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; HSET user:1 name æå›› age 20 sex ç”·</span><br><span class="line">3</span><br><span class="line">127.0.0.1:6379&gt; HGET user:1 name</span><br><span class="line">&quot;\xe6\x9d\x8e\xe5\x9b\x9b&quot;</span><br><span class="line">127.0.0.1:6379&gt; HGET user:1 age</span><br><span class="line">20</span><br><span class="line">127.0.0.1:6379&gt; HGET user:1 info</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; HGET user:2 test</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure><p>ä¸æ­¤ç›¸å…³çš„è¿˜æœ‰HSETNXå’ŒHGETALLä¸¤ä¸ªå‘½ä»¤</p><ul><li>HSETNXï¼šå½“hashä¸­çš„fieldä¸å­˜åœ¨æ—¶æ‰ä¼šè®¾ç½®æˆåŠŸï¼ˆè¿”å›å€¼ä¸º1ï¼‰ï¼Œå¦‚æœfieldå·²ç»å­˜åœ¨åˆ™ä¸ä¼šåšä»»ä½•æ“ä½œï¼ˆè¿”å›å€¼ä¸º0ï¼‰ï¼›</li><li>HGETALLï¼šè¿”å›hashä¸­çš„æ‰€æœ‰field-valueå€¼</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; HGETALL user:1</span><br><span class="line">1) &quot;name&quot;</span><br><span class="line">2) &quot;\xe6\x9d\x8e\xe5\x9b\x9b&quot;</span><br><span class="line">3) &quot;age&quot;</span><br><span class="line">4) &quot;20&quot;</span><br><span class="line">5) &quot;sex&quot;</span><br><span class="line">6) &quot;\xe7\x94\xb7&quot;</span><br><span class="line">127.0.0.1:6379&gt; HGETALL user:2</span><br><span class="line">(empty array)</span><br></pre></td></tr></table></figure><h3 id="2-2-2-HEXISTS"><a href="#2-2-2-HEXISTS" class="headerlink" title="2.2.2 HEXISTS"></a>2.2.2 HEXISTS</h3><p>è¯¥å‘½ä»¤ç”¨äºæŸ¥è¯¢hashä¸­çš„æŸä¸ªfieldæ˜¯å¦å­˜åœ¨ã€‚å­˜åœ¨è¿”å›1ï¼Œkeyæˆ–è€…fieldä¸å­˜åœ¨è¿”å›0ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HEXISTS key field</span><br></pre></td></tr></table></figure><p>æµ‹è¯•å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; HEXISTS user:1 name</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; HEXISTS user:1 info</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; HEXISTS user:2 info</span><br><span class="line">(integer) 0</span><br></pre></td></tr></table></figure><h3 id="2-2-3-HDEL"><a href="#2-2-3-HDEL" class="headerlink" title="2.2.3 HDEL"></a>2.2.3 HDEL</h3><p>åˆ é™¤hashä¸­æŒ‡å®šçš„fieldï¼Œå¯ä»¥ä¸€æ¬¡æ€§ç»™å®šå¤šä¸ªfieldæ¥åˆ é™¤ã€‚è¿”å›å€¼æ˜¯æœ¬æ¬¡æˆåŠŸåˆ é™¤çš„fieldä¸ªæ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HDEL key field [field ...]</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼Œinfoå­—æ®µæ˜¯ä¸å­˜åœ¨çš„ï¼Œå®é™…ä¸ŠåªæˆåŠŸåˆ é™¤äº†nameå­—æ®µï¼Œæ‰€ä»¥è¿”å›å€¼ä¸º1ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; HDEL user:1 name info</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ éœ€è¦åˆ é™¤æ•´ä¸ªhashï¼Œç›´æ¥ä½¿ç”¨Redisçš„delå‘½ä»¤å°†keyç»™åˆ é™¤å°±è¡Œäº†ã€‚æ¯”å¦‚<code>del user:1</code>;</p><h3 id="2-2-4-HKEYS"><a href="#2-2-4-HKEYS" class="headerlink" title="2.2.4 HKEYS"></a>2.2.4 HKEYS</h3><p>è·å–å“ˆå¸Œä¸­çš„æ‰€æœ‰fieldï¼ˆä»…è·å–å­—æ®µï¼‰ï¼›è¯¥å‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(N)</code>ï¼ŒNæ˜¯hashä¸­çš„fieldä¸ªæ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKEYS key</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤å’ŒHGETALLå‘½ä»¤æœ‰æ‰€ä¸åŒï¼ŒHGETALLå‘½ä»¤ä¼šè·å–fieldå’Œvalueï¼Œä½†HKEYSåªä¼šè·å–fieldã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; HGETALL user:1</span><br><span class="line">1) &quot;age&quot;</span><br><span class="line">2) &quot;20&quot;</span><br><span class="line">3) &quot;sex&quot;</span><br><span class="line">4) &quot;\xe7\x94\xb7&quot;</span><br><span class="line">127.0.0.1:6379&gt; HKEYS user:1</span><br><span class="line">1) &quot;age&quot;</span><br><span class="line">2) &quot;sex&quot;</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œè¿™ä¸ªå‘½ä»¤å’ŒHGETALLå‘½ä»¤éƒ½éœ€è¦<strong>è°¨æ…ä½¿ç”¨</strong>ï¼Œå®ƒä»¬å°±å’Œ<code>keys *</code>ä¸€æ ·ï¼Œéœ€è¦éå†æ•´ä¸ªhashå¯¹è±¡ï¼Œè€Œæˆ‘ä»¬åœ¨æ‰§è¡Œå‘½ä»¤ä¹‹å‰å¹¶ä¸çŸ¥é“ä¸€ä¸ªhashé‡Œé¢åˆ°åº•æœ‰å¤šå°‘ä¸ªfieldã€‚å¦‚æœæŸ¥è¯¢çš„hashä¸­fieldè¿‡å¤šï¼Œé‚£å°±ä¼šé˜»å¡Redisã€‚</p><h3 id="2-2-5-HVALS"><a href="#2-2-5-HVALS" class="headerlink" title="2.2.5 HVALS"></a>2.2.5 HVALS</h3><p>è·å–hashä¸­çš„æ‰€æœ‰valueï¼Œå’ŒHKEYSçš„åŠŸèƒ½å¯¹åº”ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HVALS key</span><br></pre></td></tr></table></figure><p>æµ‹è¯•å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; HVALS user:1</span><br><span class="line">1) &quot;20&quot;</span><br><span class="line">2) &quot;\xe7\x94\xb7&quot;</span><br></pre></td></tr></table></figure><h3 id="2-2-6-HMGET"><a href="#2-2-6-HMGET" class="headerlink" title="2.2.6 HMGET"></a>2.2.6 HMGET</h3><p>ä¸€æ¬¡æ€§è·å–hashä¸­çš„å¤šä¸ªfieldï¼ˆä¸€æ¡å‘½ä»¤æŸ¥è¯¢ä¼˜äºå¤šæ¡å‘½ä»¤æŸ¥è¯¢ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HMGET key field [field ...]</span><br></pre></td></tr></table></figure><p>æµ‹è¯•å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; HMGET user:1 age sex</span><br><span class="line">1) &quot;20&quot;</span><br><span class="line">2) &quot;\xe7\x94\xb7&quot;</span><br></pre></td></tr></table></figure><h3 id="2-2-7-HSCANï¼ˆä»…ä½œä»‹ç»ï¼‰"><a href="#2-2-7-HSCANï¼ˆä»…ä½œä»‹ç»ï¼‰" class="headerlink" title="2.2.7 HSCANï¼ˆä»…ä½œä»‹ç»ï¼‰"></a>2.2.7 HSCANï¼ˆä»…ä½œä»‹ç»ï¼‰</h3><p>å’ŒHGETALL&#x2F;HKEYS&#x2F;HVALSè¿™äº›ä¸€æ¬¡æ€§éå†å®Œæ¯•æ‰€æœ‰hashå†…å…ƒç´ çš„å‘½ä»¤ä¸åŒï¼ŒHSCANå‘½ä»¤æ˜¯â€œæ¸è¿›å¼éå†â€ï¼ˆå°±å¥½æ¯”è¿‡ç¨‹åŒ–SQLå’Œç¼–ç¨‹ä¸­å¸¸ç”¨çš„forå¾ªç¯ï¼‰ã€‚</p><p>æ‰€è°“æ¸è¿›å¼éå†ï¼Œå°±æ˜¯æ•²ä¸€æ¬¡å‘½ä»¤éå†ä¸€æ¬¡ï¼Œè¿™æ ·éå†çš„è¿‡ç¨‹å’Œé€Ÿåº¦éƒ½æ˜¯å¯æ§çš„ï¼Œä¸ä¼šé˜»å¡Redisã€‚å½“ä½ éœ€è¦è·å–ä¸€ä¸ªhashä¸­çš„æ‰€æœ‰field&#x2F;valueï¼Œä½¿ç”¨HSCANä¼šæ›´åŠ å®‰å…¨ã€‚</p><p>å®˜ç½‘æ–‡æ¡£ï¼š<a href="https://redis.io/commands/hscan/">https://redis.io/commands/hscan/</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HSCAN key cursor [MATCH pattern] [COUNT count]</span><br></pre></td></tr></table></figure><h3 id="2-2-8-HLEN"><a href="#2-2-8-HLEN" class="headerlink" title="2.2.8 HLEN"></a>2.2.8 HLEN</h3><p>è·å–ä¸€ä¸ªhashä¸­é”®å€¼å¯¹çš„ä¸ªæ•°ï¼Œè¯¥å‘½ä»¤æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(1)</code>ï¼Œå› ä¸ºRedisæœ‰ä½¿ç”¨é¢å¤–å˜é‡æ¥å­˜æ”¾hashä¸­å…ƒç´ çš„ä¸ªæ•°ï¼Œæ— éœ€éå†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HLEN key</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è¯¥å‘½ä»¤éå†ä¸€ä¸ªä¸å­˜åœ¨çš„keyæ—¶ï¼Œè¿”å›å€¼ä¸º0</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; HLEN user:1</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; HLEN user:2</span><br><span class="line">(integer) 0</span><br></pre></td></tr></table></figure><h3 id="2-2-9-HINCRBY-x2F-HINCRYBYFLOAT"><a href="#2-2-9-HINCRBY-x2F-HINCRYBYFLOAT" class="headerlink" title="2.2.9 HINCRBY&#x2F;HINCRYBYFLOAT"></a>2.2.9 HINCRBY&#x2F;HINCRYBYFLOAT</h3><p>è¿™äº›å‘½ä»¤å’Œstringä¸­çš„æ•°å­—æ“ä½œå‘½ä»¤ä¸€è‡´ï¼Œå› ä¸ºhashä¸­çš„valueä¹Ÿæ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿèƒ½å½“ä½œæ•°å­—æ¥å¤„ç†ã€‚å‚æ•°å¯ä»¥æ˜¯è´Ÿæ•°æ¥å·¦å‡æ³•ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HINCRBY key field num</span><br><span class="line">HINCRBYFLOAT key field float</span><br></pre></td></tr></table></figure><p>æµ‹è¯•å¦‚ä¸‹ï¼Œä¸¤ä¸ªå‘½ä»¤çš„è¿”å›å€¼éƒ½æ˜¯æ“ä½œä¹‹åçš„å˜é‡å€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hincrby user:1 age 10</span><br><span class="line">(integer) 30</span><br><span class="line">127.0.0.1:6379&gt; hincrbyfloat user:1 age 10.13</span><br><span class="line">&quot;40.13&quot;</span><br><span class="line">127.0.0.1:6379&gt; hincrbyfloat user:1 age -11.13</span><br><span class="line">&quot;29&quot;</span><br></pre></td></tr></table></figure><h3 id="2-2-10-HSTRLEN"><a href="#2-2-10-HSTRLEN" class="headerlink" title="2.2.10 HSTRLEN"></a>2.2.10 HSTRLEN</h3><p>è®¡ç®—hashä¸­valueçš„å­—ç¬¦ä¸²é•¿åº¦</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HSTRLEN key field</span><br></pre></td></tr></table></figure><p>æµ‹è¯•å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hget user:1 age</span><br><span class="line">&quot;29&quot;</span><br><span class="line">127.0.0.1:6379&gt; hstrlen user:1 age</span><br><span class="line">(integer) 2</span><br></pre></td></tr></table></figure><h2 id="2-3-ç¼–ç ä»‹ç»"><a href="#2-3-ç¼–ç ä»‹ç»" class="headerlink" title="2.3 ç¼–ç ä»‹ç»"></a>2.3 ç¼–ç ä»‹ç»</h2><p>ä¹‹å‰åœ¨RedisåŸºç¡€å‘½ä»¤åšå®¢çš„<code>object encoding</code>ä¸­æåˆ°ï¼Œhashæœ‰ä¸¤ç§ç¼–ç æ–¹å¼ï¼Œä¸€ä¸ªæ˜¯ziplistï¼Œä¸€ä¸ªæ˜¯hashtableã€‚</p><p>å…¶ä¸­ziplistæ˜¯åœ¨hashä¸­å…ƒç´ è¾ƒå°‘çš„æƒ…å†µä¸‹ä½¿ç”¨çš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œåˆšå¼€å§‹hashä¸­çš„f1åªæœ‰3ä¸ªå­—èŠ‚çš„å­—ç¬¦ä¸²é•¿åº¦ï¼Œä½¿ç”¨çš„æ˜¯ziplistæ¥å­˜æ”¾ï¼›å½“æˆ‘ä¹°å°è¯•è®¾ç½®ä¸€ä¸ªéå¸¸é•¿çš„å­—ç¬¦ä¸²f2ï¼Œå°±ä¼šåˆ‡æ¢æˆhashtableæ¥å­˜æ”¾ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hset key f1 111</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; object encoding key</span><br><span class="line">&quot;ziplist&quot;</span><br><span class="line">127.0.0.1:6379&gt; hset key f2 235xczbjlkq3e5jl123j5ljlbsjlk32j6l5k1hasldg82357989789787124nlahbkasdlj3215897avsalkjl32k51432097zvlmq32j5</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; object encoding key</span><br><span class="line">&quot;hashtable&quot;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ äº†è§£hashtableçš„æ•°æ®ç»“æ„ï¼Œä»¥æ‹‰é“¾æ³•ä¸ºä¾‹ï¼Œå®ƒä¼šæœ‰ä¸€ä¸ªæ•°ç»„ï¼Œå†…éƒ¨å­˜æ”¾é“¾è¡¨æŒ‡é’ˆã€‚å­˜æ”¾æ•°æ®æ—¶ï¼Œé€šè¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—å‡ºkeyæ‰€åœ¨ä¸‹æ ‡ä½ç½®ï¼Œå°†valueé“¾æ¥åˆ°æ•°ç»„ä¸‹æ ‡ä½ç½®çš„å¯¹åº”æŒ‡é’ˆä¸Šï¼Œå³ä¸ºå­˜æ”¾å®Œæ¯•ã€‚å½“hashè¡¨ä¸­çš„å…ƒç´ è¾ƒå°‘æ—¶ï¼Œæ•°ç»„å¯èƒ½ä¼šç©ºå‡ºå‡ ä¸ªä¸‹æ ‡çš„ä½ç½®æ²¡æœ‰valueé“¾æ¥ï¼Œè¿™å‡ ä¸ªä¸‹æ ‡çš„ç©ºé—´å°±ç®—æ˜¯æµªè´¹äº†ã€‚</p><p>è€Œä½¿ç”¨ziplistå°±å¯ä»¥èŠ‚çœè¿™éƒ¨åˆ†ç©ºé—´çš„æµªè´¹ï¼Œå¯¹åº”çš„ä»£ä»·æ˜¯ziplistçš„è¯»å†™é€Ÿåº¦ä¼šæ…¢äºåŸç”Ÿhashtableã€‚</p><p>åœ¨Redisä¸­å¯ä»¥é€šè¿‡ä¸‹é¢ä¸¤ä¸ªé…ç½®é¡¹æ¥è®¾ç½®hashä»€ä¹ˆæ—¶å€™ä½¿ç”¨ziplistï¼Œå†™å…¥<code>/etc/redis/redis.conf</code>å³å¯ã€‚</p><table><thead><tr><th>é…ç½®</th><th>åŠŸèƒ½</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>hash-max-ziplist-entries</td><td>è®¾ç½®fieldä¸ªæ•°ä¸ºå¤šå°‘ä»¥ä¸‹æ—¶ä½¿ç”¨ziplist</td><td>é»˜è®¤512ä¸ª</td></tr><tr><td>hash-max-ziplist-value</td><td>è®¾ç½®hashä¸­valueå­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦</td><td>é»˜è®¤ä¸º64å­—èŠ‚</td></tr></tbody></table><h2 id="2-4-åº”ç”¨åœºæ™¯"><a href="#2-4-åº”ç”¨åœºæ™¯" class="headerlink" title="2.4 åº”ç”¨åœºæ™¯"></a>2.4 åº”ç”¨åœºæ™¯</h2><h3 id="2-4-1-å…³ç³»æ•°æ®åº“ç¼“å­˜"><a href="#2-4-1-å…³ç³»æ•°æ®åº“ç¼“å­˜" class="headerlink" title="2.4.1 å…³ç³»æ•°æ®åº“ç¼“å­˜"></a>2.4.1 å…³ç³»æ•°æ®åº“ç¼“å­˜</h3><p>æ­£å¦‚ä»‹ç»é˜¶æ®µæ—¶æåˆ°çš„ï¼Œhashéå¸¸é€‚åˆç”¨äºå­˜æ”¾ä¸€äº›ç»“æ„åŒ–çš„æ•°æ®ã€‚ä»¥ç”¨æˆ·æ•°æ®ä¸ºä¾‹ï¼Œå¯ä»¥ç”¨uidä½œä¸ºkeyçš„æ ‡è¯†ï¼Œå†…éƒ¨å­˜æ”¾å¯¹åº”çš„ä¸ªäººä¿¡æ¯ã€‚æœ‰çš„æ—¶å€™ä¸ºäº†æ–¹ä¾¿ï¼Œè¿˜ä¼šåœ¨hashä¸­å†å­˜æ”¾ä¸€æ¬¡uidã€‚</p><table><thead><tr><th>key</th><th>field</th><th>value</th></tr></thead><tbody><tr><td>user:1</td><td>uid</td><td>1</td></tr><tr><td></td><td>name</td><td>æå››</td></tr><tr><td></td><td>ag</td><td>20</td></tr><tr><td></td><td>sex</td><td>ç”·</td></tr><tr><td>user:2</td><td>uid</td><td>2</td></tr><tr><td></td><td>name</td><td>ç‹äº”</td></tr><tr><td></td><td>age</td><td>23</td></tr><tr><td></td><td>sex</td><td>ç”·</td></tr></tbody></table><p>è¿™æ ·å…¶å®å°±å¥½æ¯”ä¸€ä¸ªMySQLæ•°æ®åº“ä¸­çš„è¡¨</p><table><thead><tr><th>uid</th><th>name</th><th>age</th><th>sex</th></tr></thead><tbody><tr><td>1</td><td>æå››</td><td>20</td><td>ç”·</td></tr><tr><td>2</td><td>ç‹äº”</td><td>23</td><td>ç”·</td></tr></tbody></table><p>ç”¨è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†MySQLä¸­çš„è¡¨ç›´æ¥ç¼“å­˜åœ¨Redisä¸­ï¼Œæä¾›æ›´åŠ å¿«é€Ÿçš„æŸ¥è¯¢ã€‚éœ€è¦ä¿®æ”¹æ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨å…ˆä¿®æ”¹Redisä¸­çš„æ•°æ®ï¼Œå†å¼‚æ­¥åŒæ­¥åˆ°MySQLä¸­çš„æ–¹å¼æ¥æé«˜æ•ˆç‡ã€‚</p><p>å½“ç„¶ï¼Œä½¿ç”¨string+jsonçš„æ–¹å¼ä¹Ÿå¯ä»¥å­˜æ”¾ç»“æ„åŒ–æ•°æ®ï¼Œä½†åœ¨ä½¿ç”¨çš„æ—¶å€™å°±æ¶‰åŠåˆ°äº†<strong>jsonçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–</strong>ï¼Œæ•ˆç‡ä¼šä½äºç›´æ¥ä½¿ç”¨Redisé‡Œé¢çš„hashæ¥å­˜æ”¾ï¼Œä¸è¿‡ä½¿ç”¨hashä¼šæœ‰æ›´å¤§çš„ç©ºé—´æ¶ˆè€—ã€‚</p><p>è¿™é‡Œè¿˜æ¶‰åŠåˆ°äº†é«˜å†…èš&#x2F;ä½å†…èšçš„æ¦‚å¿µï¼š</p><ul><li>é«˜å†…èšï¼šæŠŠæœ‰å…³è”çš„æ•°æ®å­˜æ”¾åœ¨ä¸€èµ·ï¼›</li><li>ä½å†…èšï¼šæœ‰å…³è”çš„ä¸œè¥¿æ•£å¼€å­˜æ”¾äº†ï¼›</li></ul><p>ä½¿ç”¨hashæ¥å­˜æ”¾ç”¨æˆ·æ•°æ®ï¼Œå°±å±äºé«˜å†…èšã€‚å¦‚æœä½¿ç”¨<code>user:1:name</code>ã€<code>user:1:age</code>çš„key&#x2F;valueæ¥å­˜æ”¾ç”¨æˆ·æ•°æ®ï¼Œå°±æ˜¯ä½å†…èšï¼Œå› ä¸ºç”¨æˆ·ä¿¡æ¯è¢«æ‹†å¼€å­˜æ”¾åœ¨äº†ä¸åŒçš„keyä¸­ã€‚</p><p>åŒç†ï¼Œä¸Šæ–‡stringä¸­æåˆ°çš„è§†é¢‘æ’­æ”¾é‡ä¿¡æ¯ç»Ÿè®¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨hashæ¥å­˜æ”¾ä¸€ä¸ªè§†é¢‘çš„ç‚¹å‡»é‡&#x2F;ç‚¹èµé‡ï¼Œå°†ä¸€ä¸ªè§†é¢‘çš„æ•°æ®å­˜æ”¾åœ¨ä¸€ä¸ªhashä¸­ï¼Œè€Œä¸ç”¨stringæ¥å­˜æ”¾ã€‚</p><p>æˆ‘ä»¬åœ¨è®¾è®¡çš„æ—¶å€™éƒ½å¼ºè°ƒ<strong>é«˜å†…èšã€ä½è€¦åˆ</strong>ï¼Œå°±æ˜¯ä¸ºäº†æ•´ä¸ªç³»ç»Ÿèƒ½æœ‰æ›´å¥½çš„æ•´æ´åº¦ï¼Œç»´æŠ¤æ›´åŠ æ–¹ä¾¿ã€‚</p><h3 id="2-4-2-hashå’Œå…³ç³»æ•°æ®åº“çš„åŒºåˆ«"><a href="#2-4-2-hashå’Œå…³ç³»æ•°æ®åº“çš„åŒºåˆ«" class="headerlink" title="2.4.2 hashå’Œå…³ç³»æ•°æ®åº“çš„åŒºåˆ«"></a>2.4.2 hashå’Œå…³ç³»æ•°æ®åº“çš„åŒºåˆ«</h3><ul><li>å“ˆå¸Œç±»å‹æ˜¯ç¨€ç–çš„ï¼Œå…³ç³»æ•°æ®åº“æ˜¯ç»“æ„åŒ–çš„ã€‚æ¯”å¦‚ä¸åŒçš„hashé‡Œé¢çš„fieldå®Œå…¨æ²¡æœ‰å…³ç³»ï¼Œå¯ä»¥éšæ„è®¾ç½®ï¼Œä½†MySQLä¸­ä¸€ä¸ªè¡¨æƒ³æ’å…¥ä¸€ä¸ªæ•°æ®ï¼Œå°±å¿…é¡»ä¾ç…§è¡¨çš„è¦æ±‚è®¾ç½®æ‰€æœ‰æ•°æ®ï¼›</li><li>å…³ç³»æ•°æ®åº“å¯ä»¥è¿›è¡Œå¤æ‚çš„å…³ç³»æŸ¥è¯¢ï¼ˆæ¯”å¦‚å¤šè¡¨æŸ¥è¯¢ï¼‰ï¼Œè€ŒRediså¾ˆéš¾æ¨¡æ‹Ÿå…³ç³»æŸ¥è¯¢ï¼Œç»´æŠ¤çš„å¤æ‚åº¦å¾ˆé«˜ä¸”æ²¡æœ‰å¿…è¦ã€‚</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/d37409c171aed0f980fdea3322e6a54d.png" alt="image-20240219143844313"></p><h1 id="3-List"><a href="#3-List" class="headerlink" title="3 List"></a>3 List</h1><h2 id="3-1-ä»‹ç»"><a href="#3-1-ä»‹ç»" class="headerlink" title="3.1 ä»‹ç»"></a>3.1 ä»‹ç»</h2><p>Redisä¸­çš„liståˆ—è¡¨ç±»å‹æä¾›äº†å¤´æ’å¤´åˆ &#x2F;å°¾æ’å°¾åˆ çš„å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒå½“ä½œé¡ºåºè¡¨ã€æ ˆã€é˜Ÿåˆ—æ¥ä½¿ç”¨ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/e9f8229179473cd0d3ed2afb034c539d.png" alt="image-20240219144352348"></p><p>åˆ—è¡¨ä¸­çš„å…ƒç´ æ˜¯æŒ‰åºå­˜æ”¾çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹æ ‡æ¥è®¿é—®åˆ—è¡¨ä¸­çš„å…ƒç´ æˆ–è·å–ä¸€ä¸ªèŒƒå›´ä¸­çš„å…ƒç´ ã€‚åˆ—è¡¨ä¸­çš„å…ƒç´ <strong>å…è®¸é‡å¤</strong>ã€‚</p><h2 id="3-2-ç›¸å…³å‘½ä»¤"><a href="#3-2-ç›¸å…³å‘½ä»¤" class="headerlink" title="3.2 ç›¸å…³å‘½ä»¤"></a>3.2 ç›¸å…³å‘½ä»¤</h2><h3 id="3-2-1-LINDEX"><a href="#3-2-1-LINDEX" class="headerlink" title="3.2.1 LINDEX"></a>3.2.1 LINDEX</h3><p>æ ¹æ®ä¸‹æ ‡æŸ¥çœ‹listä¸­çš„æ•°æ®ï¼Œå½“ä¸‹æ ‡è¶…å‡ºèŒƒå›´æ—¶è¿”å›<code>nil</code>ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LINDEX key index</span><br></pre></td></tr></table></figure><p>indexæ”¯æŒè´Ÿæ•°ä¸‹æ ‡ï¼Œä»åå¾€å‰æ•°ã€‚æ¯”å¦‚<code>-1</code>ä»£è¡¨ä»åå¾€å‰ç¬¬ä¸€ä¸ªæ•°æ®ï¼ˆå³listæœ«å°¾æ•°æ®ï¼‰ã€‚</p><p>æ³¨æ„ï¼Œè¯¥å‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(N)</code>ï¼Œå› ä¸ºRedisä¸­çš„listå¹¶éæ—¶åˆ»é‡‡ç”¨é¡ºåºè¡¨æ¥å®ç°ï¼ˆä¼šæœ‰ä¸åŒç¼–ç æ–¹å¼ï¼‰ï¼Œä¸èƒ½ä¿è¯é¡ºåºè¡¨ä¸‹æ ‡è®¿é—®é‚£æ ·çš„å¿«é€Ÿï¼</p><h3 id="3-2-2-LPUSH-x2F-RPUSH"><a href="#3-2-2-LPUSH-x2F-RPUSH" class="headerlink" title="3.2.2 LPUSH&#x2F;RPUSH"></a>3.2.2 LPUSH&#x2F;RPUSH</h3><p>å¤´æ’å‘½ä»¤ï¼Œæ”¯æŒä¸€æ¬¡æ’å…¥å¤šä¸ªæ•°æ®ã€‚å¦‚æœæŒ‡å®šçš„keyä¸æ˜¯listç±»å‹åˆ™æŠ¥é”™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LPUSH key element [element ...]</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œå½“ä¸€æ¬¡æ’å…¥å¤šä¸ªæ•°æ®æ—¶ï¼Œæœ€åä¸€ä¸ªæ•°æ®ä¼šåœ¨listçš„å¤´éƒ¨ï¼ˆæŒ‰å‘½ä»¤ä¸­å‡ºç°çš„é¡ºåºï¼Œä»å·¦å¾€å³æ’å…¥ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; clear</span><br><span class="line">127.0.0.1:6379&gt; lpush key 1 2 3 4</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; lindex key 0</span><br><span class="line">&quot;4&quot;</span><br></pre></td></tr></table></figure><p>å°¾æ’ä¹Ÿæ˜¯ç›¸åŒçš„æ•ˆæœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RPUSH key element [element ...]</span><br></pre></td></tr></table></figure><p>ä¸€æ¬¡æ€§æ’å…¥å¤šä¸ªæ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯æœ€åä¸€ä¸ªæ•°æ®åœ¨listçš„æœ«å°¾ã€‚å¯ä»¥ç”¨lindexå‘½ä»¤æŒ‡å®š<code>-1</code>ä¸‹æ ‡æ¥è·å–æœ«å°¾çš„æ•°æ®ï¼ˆä»åå¾€å‰æ•°ç¬¬ä¸€ä¸ªå€¼ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; rpush key 5 6 7 8</span><br><span class="line">(integer) 8</span><br><span class="line">127.0.0.1:6379&gt; lindex key -1</span><br><span class="line">&quot;8&quot;</span><br></pre></td></tr></table></figure><h3 id="3-2-3-LPOP-x2F-RPOP"><a href="#3-2-3-LPOP-x2F-RPOP" class="headerlink" title="3.2.3 LPOP&#x2F;RPOP"></a>3.2.3 LPOP&#x2F;RPOP</h3><p>ä»listçš„å¤´éƒ¨æˆ–è€…å°¾éƒ¨å»é™¤æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LPOP key [count]</span><br><span class="line">RPOP key [count]</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œé«˜ç‰ˆæœ¬Redisæ‰æœ‰å¯é€‰çš„counté€‰é¡¹ï¼Œå½“å‰æˆ‘ä½¿ç”¨çš„Redisä»…å¯ä¸€æ¬¡popä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›å€¼æ˜¯è¢«åˆ é™¤çš„å…ƒç´ ã€‚</p><blockquote><p>Starting with Redis version 6.2.0: Added the <code>count</code> argument.</p></blockquote><p>æµ‹è¯•å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lpop key</span><br><span class="line">&quot;4&quot;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯é«˜ç‰ˆæœ¬ï¼ŒæŒ‡å®šcountå‚æ•°åï¼Œä¼šè¿”å›ä¸€ä¸ªè¢«åˆ é™¤å…ƒç´ çš„arrayï¼Œæ•ˆæœå‚è€ƒä¸‹é¢è¿™ä¸ªå®˜ç½‘ç»™å‡ºçš„examplesã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">redis&gt; RPUSH mylist &quot;one&quot; &quot;two&quot; &quot;three&quot; &quot;four&quot; &quot;five&quot;</span><br><span class="line">(integer) 5</span><br><span class="line">redis&gt; LPOP mylist</span><br><span class="line">&quot;one&quot;</span><br><span class="line">redis&gt; LPOP mylist 2</span><br><span class="line">1) &quot;two&quot;</span><br><span class="line">2) &quot;three&quot;</span><br><span class="line">redis&gt; LRANGE mylist 0 -1</span><br><span class="line">1) &quot;four&quot;</span><br><span class="line">2) &quot;five&quot;</span><br><span class="line">redis&gt; </span><br></pre></td></tr></table></figure><p>å¦‚æœå°è¯•æ“ä½œä¸€ä¸ªç©ºçš„listæˆ–è€…ä¸å­˜åœ¨çš„keyï¼Œè¿”å›å€¼æ˜¯<code>nil</code>ï¼›å¦‚ä¸‹æ‰€ç¤ºï¼Œkey1çš„listä¸­åªæœ‰1ä¸ªå…ƒç´ ï¼Œç¬¬ä¸€æ¬¡æˆåŠŸåˆ é™¤å…ƒç´ ï¼Œä½†æ˜¯ç¬¬äºŒæ¬¡æ“ä½œçš„æ—¶å€™key1æ˜¯ä¸€ä¸ªç©ºlistï¼Œæ“ä½œå¤±è´¥è¿”å›<code>nil</code>ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lpush key1 1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; lpop key1</span><br><span class="line">&quot;1&quot;</span><br><span class="line">127.0.0.1:6379&gt; lpop key1</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure><p>å½“ä¸€ä¸ªlistä¸­ä¸å­˜åœ¨å…ƒç´ çš„æ—¶å€™ï¼ŒRedisä¼šè‡ªåŠ¨å°†è¯¥listçš„keyåˆ é™¤ï¼å¦‚ä¸‹æ‰€ç¤ºï¼Œå½“æˆ‘ä»¬æŠŠtesté”®å€¼ä¸­çš„å…ƒç´ å…¨éƒ¨åˆ é™¤æ—¶ï¼Œè¿™ä¸ªtesté”®å€¼å°±ç›´æ¥ä¸å­˜åœ¨äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">(empty array)</span><br><span class="line">127.0.0.1:6379&gt; lpush key 1 2</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; lpush test 1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;key&quot;</span><br><span class="line">2) &quot;test&quot;</span><br><span class="line">127.0.0.1:6379&gt; lpop test</span><br><span class="line">&quot;1&quot;</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;key&quot;</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure><h3 id="3-2-4-LRANGE"><a href="#3-2-4-LRANGE" class="headerlink" title="3.2.4 LRANGE"></a>3.2.4 LRANGE</h3><p>æŸ¥çœ‹listä¸­æŒ‡å®šèŒƒå›´çš„å…ƒç´ ï¼Œè¿™é‡Œçš„åŒºé—´æ˜¯é—­åŒºé—´ï¼ˆæœ€ç»ˆç»“æœåŒ…å«startå’Œstopä¸‹æ ‡çš„æ•°æ®ï¼‰ï¼Œå½“startå°äºstopæ—¶è¿”å›<code>empty array</code>ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LRANGE key start stop</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹å¦‚ä¸‹ï¼ŒæŒ‡å®šäº†<code>0</code>å’Œ<code>-1</code>ç­‰åŒäºè·å–listä¸­çš„å…¨éƒ¨å…ƒç´ ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lrange key 0 -1</span><br><span class="line">1) &quot;4&quot;</span><br><span class="line">2) &quot;3&quot;</span><br><span class="line">3) &quot;2&quot;</span><br><span class="line">4) &quot;1&quot;</span><br><span class="line">5) &quot;5&quot;</span><br><span class="line">6) &quot;6&quot;</span><br><span class="line">7) &quot;7&quot;</span><br><span class="line">8) &quot;8&quot;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œæ­¤å¤„Redisæ˜¯ç”¨arrayè¿”å›çš„ä¸€ä¸ªç»“æœé›†ï¼Œåºå·æ˜¯ä»1å¼€å§‹çš„ï¼ˆå’Œlistä¸­çš„ä¸‹æ ‡ä¸ä¸€æ ·ä¸”æ— å…³ï¼‰</p><h4 id="3-2-4-1-è¶…å‡ºä¸‹æ ‡èŒƒå›´"><a href="#3-2-4-1-è¶…å‡ºä¸‹æ ‡èŒƒå›´" class="headerlink" title="3.2.4.1 è¶…å‡ºä¸‹æ ‡èŒƒå›´"></a>3.2.4.1 è¶…å‡ºä¸‹æ ‡èŒƒå›´</h4><p>å¦å¤–ï¼Œä½¿ç”¨lrangeå‘½ä»¤æŒ‡å®šä¸‹æ ‡çš„æ—¶å€™ï¼Œå¦‚æœä¸‹æ ‡è¶…å‡ºèŒƒå›´ï¼Œä¹Ÿä¼šå¾—åˆ°å°½å¯èƒ½ç¬¦åˆä¸‹æ ‡ç»“æœçš„æ•°æ®ï¼Œè¿™ç‚¹å’Œlindexä¸åŒï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lrange key 3 10</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;5&quot;</span><br><span class="line">3) &quot;6&quot;</span><br><span class="line">4) &quot;7&quot;</span><br><span class="line">5) &quot;8&quot;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œæˆ‘å°è¯•è®¿é—®3åˆ°10çš„æ•°æ®ï¼Œä½†å®é™…ä¸Šlistä¸­çš„æ•°æ®ä¸‹æ ‡åˆ°7å°±ç»“æŸäº†ï¼ˆä¸€å…±å…«ä¸ªå…ƒç´ ï¼‰ï¼Œä½†Rediså¹¶æ²¡æœ‰æŠ¥é”™æˆ–è¿”å›<code>empty array</code>ï¼Œè€Œæ˜¯è·å–äº†ä»ä¸‹æ ‡3å¼€å§‹ä¸€ç›´åˆ°listæœ«å°¾çš„æ•°æ®ã€‚</p><p>åŒç†ï¼Œå½“ä½ è®¿é—®è¶…å‡ºèŒƒå›´çš„è´Ÿæ•°ä¸‹æ ‡ï¼Œä¹Ÿèƒ½å¾—åˆ°ç±»ä¼¼çš„ç»“æœã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lrange key -10 -1</span><br><span class="line">1) &quot;4&quot;</span><br><span class="line">2) &quot;3&quot;</span><br><span class="line">3) &quot;2&quot;</span><br><span class="line">4) &quot;1&quot;</span><br><span class="line">5) &quot;5&quot;</span><br><span class="line">6) &quot;6&quot;</span><br><span class="line">7) &quot;7&quot;</span><br><span class="line">8) &quot;8&quot;</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œå®é™…ä¸šåŠ¡æ—¶æ­£ç¡®ä½¿ç”¨åˆæ³•è‚¯å®šæ˜¯æ›´å¥½çš„ï¼</p><h3 id="3-2-5-LPUSHX-x2F-RPUSHX"><a href="#3-2-5-LPUSHX-x2F-RPUSHX" class="headerlink" title="3.2.5 LPUSHX&#x2F;RPUSHX"></a>3.2.5 LPUSHX&#x2F;RPUSHX</h3><p>å’ŒLPUSH&#x2F;RPUSHä½œç”¨ç›¸åŒï¼Œå¤šäº†ä¸€ä¸ªå¯¹keyæ˜¯å¦å­˜åœ¨çš„æ£€æµ‹ï¼Œåªæœ‰keyå­˜åœ¨æ—¶æ‰èƒ½æ’å…¥æˆåŠŸã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LPUSHX key element [element ...]</span><br><span class="line">RPUSHX key element [element ...]</span><br></pre></td></tr></table></figure><p>è¿”å›å€¼æ˜¯æ’å…¥æˆåŠŸçš„å…ƒç´ ä¸ªæ•°ï¼Œå¦‚æœkeyä¸å­˜åœ¨åˆ™è¿”å›0ï¼›</p><h3 id="3-2-6-LINSERT"><a href="#3-2-6-LINSERT" class="headerlink" title="3.2.6 LINSERT"></a>3.2.6 LINSERT</h3><p>è¿™ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯åœ¨æŒ‡å®špivotå…ƒç´ ä½ç½®æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œå¯ä»¥é€šè¿‡å‚æ•°é€‰æ‹©æ˜¯åœ¨æŒ‡å®špivotå…ƒç´ ä¹‹å‰æ’å…¥ï¼Œè¿˜æ˜¯åœ¨æŒ‡å®špivotå…ƒç´ ä¹‹åæ’å…¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LINSERT key &lt;BEFORE | AFTER&gt; pivot element</span><br></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(N)</code>ï¼ŒNæ˜¯pivotå…ƒç´ å’Œlistå¼€å¤´çš„è·ç¦»ï¼Œè¿”å›å€¼å¦‚ä¸‹ï¼š</p><ul><li>æˆåŠŸæ—¶è¿”å›æ’å…¥å…ƒç´ ålistçš„å…ƒç´ ä¸ªæ•°ï¼›</li><li>keyä¸å­˜åœ¨æ—¶è¿”å›0ï¼›</li><li>pivotå…ƒç´ ä¸å­˜åœ¨æ—¶è¿”å›-1ï¼Œä¸”ä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿï¼›</li></ul><p>æµ‹è¯•å¦‚ä¸‹ï¼Œè¿™é‡Œé€‰æ‹©çš„å·²æœ‰å…ƒç´ æ˜¯4ï¼Œbeforeä¼šåœ¨4ä¹‹å‰æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œafterä¼šåœ¨4ä¹‹åæ’å…¥ä¸€ä¸ªå…ƒç´ ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lpush key 1 2 3 4 5 6</span><br><span class="line">(integer) 6</span><br><span class="line">127.0.0.1:6379&gt; linsert key before 4 10</span><br><span class="line">(integer) 7</span><br><span class="line">127.0.0.1:6379&gt; lrange key 0 -1</span><br><span class="line">1) &quot;6&quot;</span><br><span class="line">2) &quot;5&quot;</span><br><span class="line">3) &quot;10&quot;</span><br><span class="line">4) &quot;4&quot;</span><br><span class="line">5) &quot;3&quot;</span><br><span class="line">6) &quot;2&quot;</span><br><span class="line">7) &quot;1&quot;</span><br><span class="line">127.0.0.1:6379&gt; linsert key after 4 11</span><br><span class="line">(integer) 8</span><br><span class="line">127.0.0.1:6379&gt; lrange key 0 -1</span><br><span class="line">1) &quot;6&quot;</span><br><span class="line">2) &quot;5&quot;</span><br><span class="line">3) &quot;10&quot;</span><br><span class="line">4) &quot;4&quot;</span><br><span class="line">5) &quot;11&quot;</span><br><span class="line">6) &quot;3&quot;</span><br><span class="line">7) &quot;2&quot;</span><br><span class="line">8) &quot;1&quot;</span><br></pre></td></tr></table></figure><p>æ¸…ç©ºkeyåé‡æ–°æµ‹è¯•ï¼Œå¦‚æœlistä¸­æœ‰å¤šä¸ªç›¸åŒçš„pivotå…ƒç´ ï¼Œä¼šåœ¨å“ªé‡Œæ“ä½œå‘¢ï¼Ÿå¯ä»¥çœ‹åˆ°å®ƒä¼šåœ¨ç¬¬ä¸€ä¸ª5çš„ä½ç½®æ“ä½œï¼Œå³pivotä¼šé‡‡ç”¨ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„å…ƒç´ ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lpush key 1 2 5 3 4 5 6</span><br><span class="line">(integer) 7</span><br><span class="line">127.0.0.1:6379&gt; linsert key before 5 10</span><br><span class="line">(integer) 8</span><br><span class="line">127.0.0.1:6379&gt; lrange key 0 -1</span><br><span class="line">1) &quot;6&quot;</span><br><span class="line">2) &quot;10&quot;</span><br><span class="line">3) &quot;5&quot;</span><br><span class="line">4) &quot;4&quot;</span><br><span class="line">5) &quot;3&quot;</span><br><span class="line">6) &quot;5&quot;</span><br><span class="line">7) &quot;2&quot;</span><br><span class="line">8) &quot;1&quot;</span><br></pre></td></tr></table></figure><h3 id="3-2-7-LLEN"><a href="#3-2-7-LLEN" class="headerlink" title="3.2.7 LLEN"></a>3.2.7 LLEN</h3><p>è·å–listçš„é•¿åº¦ï¼Œå¦‚æœkeyä¸å­˜åœ¨è¿”å›0ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LLEN key</span><br></pre></td></tr></table></figure><h3 id="3-2-8-LREM"><a href="#3-2-8-LREM" class="headerlink" title="3.2.8 LREM"></a>3.2.8 LREM</h3><p>åˆ é™¤listä¸­æŒ‡å®šçš„å€¼ï¼Œè¿”å›å€¼æ˜¯è¢«åˆ é™¤å…ƒç´ çš„ä¸ªæ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LREM key count element</span><br></pre></td></tr></table></figure><p>countå‚æ•°çš„å¯é€‰é¡¹å¦‚ä¸‹</p><ul><li>countå¤§äº0ï¼šä»å‰å¾€ååˆ é™¤countä¸ªç­‰äºelementçš„å…ƒç´ ï¼›</li><li>countå°äº0ï¼šä»åå¾€å‰åˆ é™¤<code>|count|</code>ä¸ªç­‰äºelementçš„å…ƒç´ ï¼›</li><li>countç­‰äº0ï¼šåˆ é™¤æ‰€æœ‰ç­‰äºelementçš„å…ƒç´ ï¼›</li></ul><p>æµ‹è¯•ä¸€ä¸‹ï¼Œä½¿ç”¨rpushå¯ä»¥è®©listå’Œæˆ‘ä»¬è¾“å…¥çš„é¡ºåºä¸€è‡´ã€‚è¿™é‡ŒæŒ‡å®šçš„countå¤§äº0ï¼Œåˆ é™¤çš„å…ƒç´ æ˜¯1ï¼Œæœ€ç»ˆåˆ é™¤äº†ä»å‰å¾€åæ•°çš„ä¸¤ä¸ª1ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; rpush key 1 2 3 4 1 2 3 4 1 2 3 4</span><br><span class="line">(integer) 12</span><br><span class="line">127.0.0.1:6379&gt; lrem key 2 1</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; lrange key 0 -1</span><br><span class="line"> 1) &quot;2&quot;</span><br><span class="line"> 2) &quot;3&quot;</span><br><span class="line"> 3) &quot;4&quot;</span><br><span class="line"> 4) &quot;2&quot;</span><br><span class="line"> 5) &quot;3&quot;</span><br><span class="line"> 6) &quot;4&quot;</span><br><span class="line"> 7) &quot;1&quot;</span><br><span class="line"> 8) &quot;2&quot;</span><br><span class="line"> 9) &quot;3&quot;</span><br><span class="line">10) &quot;4&quot;</span><br></pre></td></tr></table></figure><p>å†æŒ‡å®šcountä¸º-1ï¼Œåˆ é™¤å…ƒç´ æ˜¯3ï¼Œä¼šåˆ é™¤ä»åå¾€å‰æ•°çš„ç¬¬ä¸€ä¸ª3ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lrem key -1 3</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; lrange key 0 -1</span><br><span class="line">1) &quot;2&quot;</span><br><span class="line">2) &quot;3&quot;</span><br><span class="line">3) &quot;4&quot;</span><br><span class="line">4) &quot;2&quot;</span><br><span class="line">5) &quot;3&quot;</span><br><span class="line">6) &quot;4&quot;</span><br><span class="line">7) &quot;1&quot;</span><br><span class="line">8) &quot;2&quot;</span><br><span class="line">9) &quot;4&quot;</span><br></pre></td></tr></table></figure><p>æŒ‡å®šcountä¸º0ï¼Œåˆ é™¤å…ƒç´ æ˜¯4ï¼Œlistä¸­çš„æ‰€æœ‰4éƒ½ä¼šè¢«åˆ é™¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lrem key 0 4</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; lrange key 0 -1</span><br><span class="line">1) &quot;2&quot;</span><br><span class="line">2) &quot;3&quot;</span><br><span class="line">3) &quot;2&quot;</span><br><span class="line">4) &quot;3&quot;</span><br><span class="line">5) &quot;1&quot;</span><br><span class="line">6) &quot;2&quot;</span><br></pre></td></tr></table></figure><h3 id="3-2-9-LTRIM"><a href="#3-2-9-LTRIM" class="headerlink" title="3.2.9 LTRIM"></a>3.2.9 LTRIM</h3><p>åˆ é™¤listä¸­æŒ‡å®šåŒºé—´<strong>å¤–</strong>çš„å…ƒç´ ï¼ˆå³ä¿ç•™æŒ‡å®šçš„é—­åŒºé—´ï¼Œå…¶ä»–éƒ½åˆ é™¤ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LTRIM key start stop</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; rpush key 1 2 3 4 5 6</span><br><span class="line">(integer) 6</span><br><span class="line">127.0.0.1:6379&gt; ltrim key 2 3</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; lrange key 0 -1</span><br><span class="line">1) &quot;3&quot;</span><br><span class="line">2) &quot;4&quot;</span><br></pre></td></tr></table></figure><h3 id="3-2-10-LSET"><a href="#3-2-10-LSET" class="headerlink" title="3.2.10 LSET"></a>3.2.10 LSET</h3><p>è¯¥å‘½ä»¤å¯ä»¥è®¾ç½®æŸä¸ªä¸‹æ ‡çš„å…ƒç´ ï¼ˆæ›¿æ¢ï¼‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LSET key index element</span><br></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(N)</code>ï¼Œè¿™å°±å’ŒLINDEXçš„åŸå› ä¸€æ ·ï¼Œå› ä¸ºRedisä¸æ€»æ˜¯ç”¨é¡ºåºè¡¨æ¥å­˜æ”¾listçš„æ•°æ®ï¼Œæ‰€ä»¥æ— æ³•ä¿è¯<code>O(1)</code>ä¸‹æ ‡è®¿é—®ä¸€æ ·çš„æ—¶é—´å¤æ‚åº¦ã€‚</p><h3 id="3-2-11-BLPOP-x2F-BRPOPï¼ˆé˜»å¡ç‰ˆæœ¬ï¼‰"><a href="#3-2-11-BLPOP-x2F-BRPOPï¼ˆé˜»å¡ç‰ˆæœ¬ï¼‰" class="headerlink" title="3.2.11 BLPOP&#x2F;BRPOPï¼ˆé˜»å¡ç‰ˆæœ¬ï¼‰"></a>3.2.11 BLPOP&#x2F;BRPOPï¼ˆé˜»å¡ç‰ˆæœ¬ï¼‰</h3><h4 id="3-2-11-1-é˜»å¡å‘½ä»¤è¯´æ˜"><a href="#3-2-11-1-é˜»å¡å‘½ä»¤è¯´æ˜" class="headerlink" title="3.2.11.1 é˜»å¡å‘½ä»¤è¯´æ˜"></a>3.2.11.1 é˜»å¡å‘½ä»¤è¯´æ˜</h4><p>BLPOPå’ŒBRPOPæ˜¯LPOP&#x2F;RPOPçš„é˜»å¡ç‰ˆæœ¬ï¼Œå‘½ä»¤é‡Œé¢çš„Bå°±æ˜¯blocké˜»å¡çš„ç¼©å†™ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡æ¥è§¦Redisé‡Œé¢çš„â€œé˜»å¡å‘½ä»¤â€ã€‚</p><p>ä½¿ç”¨è¿™ä¸¤ä¸ªå‘½ä»¤çš„æ—¶å€™ï¼Œlistå°±å¯ä»¥å½“ä½œä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ï¼ˆå’ŒLinuxçš„ç®¡é“ä¹Ÿæœ‰ç‚¹ç›¸ä¼¼ï¼‰äº†ï¼š</p><ul><li>å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œå°è¯•å‡ºé˜Ÿåˆ—æ—¶ä¼šé˜»å¡;</li><li>å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œå°è¯•å…¥é˜Ÿåˆ—æ—¶ä¼šé˜»å¡;</li></ul><p>å¯¹äºRedisè€Œè¨€ï¼Œlistä¸€èˆ¬ä¸å­˜åœ¨â€œæ»¡â€çš„æƒ…å†µï¼Œæˆ‘ä»¬å¤§å¤šè€ƒè™‘é˜Ÿåˆ—ä¸ºç©ºçš„æƒ…å†µã€‚è€ŒRedisçš„å•çº¿ç¨‹æ¨¡å‹ä¹Ÿä¿è¯äº†è¿™ä¸ªâ€œé˜»å¡é˜Ÿåˆ—â€æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><p>å¦å¤–ï¼ŒRedisæä¾›çš„é˜»å¡å‘½ä»¤<strong>å¹¶ä¸ä¼šæŠŠè‡ªå·±ç»™é˜»å¡</strong>ï¼Œè€Œç±»ä¼¼äºé˜»å¡äº†å®¢æˆ·ç«¯ï¼Œä½¿ç”¨BLPOP&#x2F;BRPOPçš„æ—¶å€™éœ€è¦ç»™å®šä¸€ä¸ªtimeoutå‚æ•°ï¼Œåœ¨é˜»å¡ç­‰å¾…çš„æœŸé—´ï¼Œ<strong>Rediså¯ä»¥æ­£å¸¸å“åº”å…¶ä»–çš„å‘½ä»¤å’Œè¯·æ±‚</strong>ã€‚</p><p>è€Œè¢«é˜»å¡çš„å®¢æˆ·ç«¯å®é™…ä¸Šæ˜¯åœ¨ç­‰å¾…å…¶ä»–å®¢æˆ·ç«¯å¾€å¯¹åº”listä¸­æ’å…¥æ–°å…ƒç´ ã€‚</p><h4 id="3-2-11-2-å‘½ä»¤å‚æ•°"><a href="#3-2-11-2-å‘½ä»¤å‚æ•°" class="headerlink" title="3.2.11.2 å‘½ä»¤å‚æ•°"></a>3.2.11.2 å‘½ä»¤å‚æ•°</h4><p><a href="https://redis.io/commands/blpop/">https://redis.io/commands/blpop/</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BLPOP key [key ...] timeout</span><br><span class="line">BRPOP key [key ...] timeout</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼štimeoutå•ä½ä¸ºç§’ï¼ŒRedis 6ä¸­å¯ä»¥è®¾ç½®ä¸ºå°æ•°ï¼Œè®¾ç½®ä¸º0æ—¶ä»£è¡¨æ°¸ä¹…é˜»å¡ã€‚</p><p>è¿™ä¸¤ä¸ªå‘½ä»¤éƒ½å¯ä»¥æŒ‡å®šå¤šä¸ªkeyï¼Œå½“æŒ‡å®šå¤šä¸ªkeyçš„æ—¶å€™ï¼ŒRedisä¼šè¿›è¡Œä»å·¦å¾€å³çš„éå†ï¼Œåªè¦å…¶ä¸­ä¸€ä¸ªkeyå¯¹åº”çš„listæœ‰å…ƒç´ ï¼Œå°±ä¼šç«‹åˆ»è¿”å›ã€‚ç›¸å½“äºä¸€æ¬¡ç­‰å¤šä¸ªlistã€‚</p><blockquote><p>å¦‚æœæœ‰å¤šä¸ªå®¢æˆ·ç«¯éƒ½éœ€è¦ä½¿ç”¨è¿™ä¸¤ä¸ªå‘½ä»¤æ¥ç­‰å¾…<strong>åŒä¸€ä¸ªkey</strong>ï¼Œé‚£ä¹ˆå…ˆæ‰§è¡Œå‘½ä»¤çš„å®¢æˆ·ç«¯ä¼šå¾—åˆ°å¼¹å‡ºçš„å…ƒç´ ã€‚</p></blockquote><p>å› ä¸ºblpop&#x2F;brlpopéƒ½æ”¯æŒå¤šä¸ªkeyå€¼ç­‰å¾…ï¼Œä¸ºäº†æ ‡å®šå¼¹å‡ºçš„é”®å±äºå“ªä¸€ä¸ªkeyï¼Œè¿™ä¸¤ä¸ªå‘½ä»¤åœ¨è¿”å›çš„æ—¶å€™ä¼šè¿”å›arrayç±»å‹çš„key+valueï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; blpop key 0</span><br><span class="line">1) &quot;key&quot;</span><br><span class="line">2) &quot;4&quot;</span><br></pre></td></tr></table></figure><p>å½“è¶…æ—¶æ—¶é—´ç»“æŸæ—¶ï¼Œç»™å®šçš„å‡ ä¸ªkeyçš„listè¿˜æ˜¯ä¸ºç©ºï¼Œåˆ™ä¼šè¿”å›nilï¼›</p><h4 id="3-2-11-3-å‘½ä»¤é¢„æœŸè¡Œä¸º"><a href="#3-2-11-3-å‘½ä»¤é¢„æœŸè¡Œä¸º" class="headerlink" title="3.2.11.3 å‘½ä»¤é¢„æœŸè¡Œä¸º"></a>3.2.11.3 å‘½ä»¤é¢„æœŸè¡Œä¸º</h4><p>å½“listä¸ä¸ºç©ºæ—¶ï¼Œlpopå’Œblpopçš„å‘½ä»¤è¡Œä¸ºå®Œå…¨ä¸€è‡´ã€‚</p><p>å½“listä¸ºç©ºï¼Œä¸”blpopæŒ‡å®šçš„timeoutæ—¶é—´ä¸­æ²¡æœ‰æ–°å…ƒç´ æ’å…¥listæ—¶ï¼š</p><ul><li>lpopä¼šç«‹é©¬å¾—åˆ°nilï¼›</li><li>blpopä¼šåœ¨ç­‰å¾…timeoutæ—¶é—´åå¾—åˆ°nilï¼›</li><li>æ­¤æ—¶lpopå’Œbrlpopçš„å‘½ä»¤è¡Œä¸ºå°±ä¸ä¸€è‡´äº†ã€‚</li></ul><p>å½“listä¸ºç©ºï¼Œä¸”timeoutæ—¶é—´å†…æœ‰æ–°å…ƒç´ æ’å…¥</p><ul><li>å› ä¸ºåŸæœ¬listæ˜¯ä¸ºç©ºçš„ï¼Œæ‰€ä»¥lpopè¿˜æ˜¯ä¼šç«‹é©¬å¾—åˆ°nilï¼›</li><li>blpopä¼šåœ¨æ–°å…ƒç´ æ’å…¥åè¿”å›keyå’Œæ–°å…ƒç´ ï¼›</li></ul><h4 id="3-2-11-4-é˜»å¡æµ‹è¯•"><a href="#3-2-11-4-é˜»å¡æµ‹è¯•" class="headerlink" title="3.2.11.4 é˜»å¡æµ‹è¯•"></a>3.2.11.4 é˜»å¡æµ‹è¯•</h4><p>ä¸‹é¢æ˜¯ä¸€ä¸ªé˜»å¡æ—¶çš„æµ‹è¯•ï¼Œä½¿ç”¨0æ¥æŒ‡å®šæ°¸ä¹…é˜»å¡ï¼Œå½“å³ä¾§ç»ˆç«¯å›è½¦æäº¤æ’å…¥æ“ä½œæ—¶ï¼Œå·¦ä¾§çš„é˜»å¡ä¼šç«‹é©¬è¿”å›æ•°æ®ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/2a28441785171abc8b20a27af768dfd9.png" alt="image-20240221211633743"></p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/a466d5f993d3a24be07a7dd93037a8c1.png" alt="image-20240221211639797"></p><p>å°è¯•ç­‰å¾…å¤šä¸ªkeyï¼Œåªè¦æœ‰ä¸€ä¸ªkeyè¿”å›äº†æ•°æ®ï¼Œé˜»å¡çš„ç»ˆç«¯å°±ä¼šç«‹é©¬è¿”å›ã€‚è™½ç„¶è¯´è¿™ä¸ªç­‰å¾…æ—¶éå†çš„é¡ºåºæ˜¯ä»å·¦å¾€å³çš„ï¼Œä½†ç”±äºRedisæ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œä¸ä¼šå‡ºç°ä¸¤ä¸ªkeyåŒæ—¶æ–°å¢æ•°æ®çš„æƒ…å†µï¼Œ<strong>æ€»ä¼šæœ‰ä¸ªå…ˆåé¡ºåº</strong>ï¼Œæ‰€ä»¥æœ€ç»ˆè¿˜æ˜¯ç­‰å¾…åˆ—è¡¨ä¸­ï¼Œ<strong>å“ªä¸€ä¸ªkeyå…ˆæœ‰æ•°æ®æ’å…¥</strong>ï¼Œå“ªä¸€ä¸ªkeyå°±ä¼šè¢«blpopè¿”å›ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/8156e009dcd7a8ac02ade9b5df20bbed.png" alt="image-20240221212327656"></p><p>å¦‚æœå¼€å§‹éå†çš„æ—¶å€™ï¼Œkeyæ²¡æœ‰æ•°æ®ï¼Œkey1å’Œkey2æœ‰æ•°æ®ï¼Œé‚£ä¹ˆRediså°±ä¼šæŒ‰ä»å·¦å¾€å³çš„åŸåˆ™ï¼Œè¿”å›key1çš„æ•°æ®ã€‚</p><h2 id="3-3-ç¼–ç æ–¹å¼"><a href="#3-3-ç¼–ç æ–¹å¼" class="headerlink" title="3.3 ç¼–ç æ–¹å¼"></a>3.3 ç¼–ç æ–¹å¼</h2><p>æ—§ç‰ˆæœ¬Redisä¸­listçš„ç¼–ç æ–¹å¼æœ‰ä¸¤ä¸ª</p><ul><li>ziplistï¼šä¸ºçŸ­listä¼˜åŒ–</li><li>linklistï¼šæ­£å¸¸çš„åŒå‘é“¾è¡¨</li></ul><p>ä½†åœ¨æ–°ç‰ˆæœ¬ï¼ˆRedis 3.2ä»¥åï¼‰å¯¹listçš„æ•°æ®ç»“æ„è¿›è¡Œäº†æ”¹é€ ï¼Œä½¿ç”¨quicklistæ›¿ä»£äº†ziplist&#x2F;linklistï¼Œæ›´å¤šä¿¡æ¯å¯ä»¥å‚è€ƒï¼š<a href="https://www.cnblogs.com/hunternet/p/12624691.html">redisæ•°æ®ç»“æ„-å¿«é€Ÿåˆ—è¡¨</a>ï¼›</p><h2 id="3-4-åº”ç”¨åœºæ™¯"><a href="#3-4-åº”ç”¨åœºæ™¯" class="headerlink" title="3.4 åº”ç”¨åœºæ™¯"></a>3.4 åº”ç”¨åœºæ™¯</h2><h3 id="3-4-1-æ ˆå’Œé˜Ÿåˆ—"><a href="#3-4-1-æ ˆå’Œé˜Ÿåˆ—" class="headerlink" title="3.4.1 æ ˆå’Œé˜Ÿåˆ—"></a>3.4.1 æ ˆå’Œé˜Ÿåˆ—</h3><p>ä½¿ç”¨listæ¥æ¨¡æ‹Ÿæ ˆæˆ–è€…é˜Ÿåˆ—çš„åŠŸèƒ½</p><ul><li>é˜Ÿåˆ—ï¼šåªä½¿ç”¨rpushå’Œlpopå‘½ä»¤</li><li>æ ˆï¼šåªä½¿ç”¨lpushå’Œlpopå‘½ä»¤</li></ul><h3 id="3-4-2-ç­çº§ä¸­æœ‰é‚£äº›å­¦ç”Ÿ-x2F-éƒ¨é—¨ä¸­æœ‰é‚£äº›å‘˜å·¥"><a href="#3-4-2-ç­çº§ä¸­æœ‰é‚£äº›å­¦ç”Ÿ-x2F-éƒ¨é—¨ä¸­æœ‰é‚£äº›å‘˜å·¥" class="headerlink" title="3.4.2 ç­çº§ä¸­æœ‰é‚£äº›å­¦ç”Ÿ&#x2F;éƒ¨é—¨ä¸­æœ‰é‚£äº›å‘˜å·¥"></a>3.4.2 ç­çº§ä¸­æœ‰é‚£äº›å­¦ç”Ÿ&#x2F;éƒ¨é—¨ä¸­æœ‰é‚£äº›å‘˜å·¥</h3><p>å¯ä»¥ä½¿ç”¨listå°†ä¸€ä¸ªç­çº§idä½œä¸ºkeyï¼Œå­¦ç”Ÿidä½œä¸ºlisté‡Œé¢çš„å…ƒç´ ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class:1  [1,3,4]</span><br><span class="line">class:2  [2,5,6]</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡listæ¥å¾—çŸ¥æ¯ä¸ªç­çº§å¯¹åº”çš„å­¦ç”Ÿidç¼–å·ã€‚éƒ¨é—¨å’Œå‘˜å·¥çš„å…³ç³»ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼›</p><h3 id="3-4-3-æ¶ˆæ¯é˜Ÿåˆ—"><a href="#3-4-3-æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="3.4.3 æ¶ˆæ¯é˜Ÿåˆ—"></a>3.4.3 æ¶ˆæ¯é˜Ÿåˆ—</h3><p>ä½¿ç”¨BLPOP&#x2F;BRPOPè¿™ä¸¤ä¸ªå‘½ä»¤å°±å¯ä»¥è®©listä½œä¸ºä¸€ä¸ªç®€å•çš„æ¶ˆæ¯é˜Ÿåˆ—æ¥ä½¿ç”¨ã€‚</p><p>ä»¥â€œç”Ÿäº§-æ¶ˆè´¹è€…æ¨¡å‹â€ä¸ºä¾‹ï¼Œç”Ÿäº§è€…å¾€listä¸­æ’å…¥æ•°æ®ï¼Œæ¶ˆè´¹è€…ä½¿ç”¨BLPOPç­‰å¾…æ–°æ•°æ®çš„æ’å…¥å¹¶è¿›è¡Œæ¶ˆè´¹ã€‚æ­¤æ—¶å¯ä»¥æœ‰å¤šä¸ªç”Ÿäº§è€…è¿›è¡Œpushï¼Œä¹Ÿå¯ä»¥æœ‰å¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶ä½¿ç”¨BLPOPå‘½ä»¤ç­‰å¾…listä¸­çš„æ–°æ•°æ®æ’å…¥ã€‚</p><p>å› ä¸ºRedisä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰çš„é—®é¢˜ï¼Œæ‰€ä»¥æ–°æ•°æ®æ’å…¥ååªä¼šæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…èƒ½æ‹¿åˆ°æ•°æ®è¿›è¡Œæ¶ˆè´¹ã€‚å¹¶ä¸”å¤šä¸ªæ¶ˆè´¹è€…æ‰§è¡ŒBLPOPå‘½ä»¤æ—¶ä¹Ÿå­˜åœ¨ä¸€ä¸ªå…ˆåé¡ºåºï¼ŒæŒ‰123çš„é¡ºåºæ¥è¯´çš„è¯ï¼Œè¿™ä¸€æ¬¡æ¶ˆè´¹è€…1æ‹¿åˆ°äº†æ•°æ®ï¼Œä¸‹ä¸€æ¬¡å°±æ˜¯æ¶ˆè´¹è€…2ï¼Œå†ä¸‹ä¸€æ¬¡å°±æ˜¯æ¶ˆè´¹è€…3ï¼Œä¸ä¼šå‡ºç°æŸä¸ªæ¶ˆè´¹è€…<strong>é¥¥é¥¿</strong>çš„æƒ…å†µã€‚</p><h3 id="3-4-4-è§†é¢‘ä¿¡æ¯ä¼ é€’"><a href="#3-4-4-è§†é¢‘ä¿¡æ¯ä¼ é€’" class="headerlink" title="3.4.4 è§†é¢‘ä¿¡æ¯ä¼ é€’"></a>3.4.4 è§†é¢‘ä¿¡æ¯ä¼ é€’</h3><p>ä»¥ä¸€ä¸ªè§†é¢‘ç½‘ç«™ä¸ºä¾‹ï¼Œä½¿ç”¨listä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—æ—¶ï¼Œå¯ä»¥é‡‡ç”¨ä¸€ä¸ªè§†é¢‘å¯¹åº”å¤šä¸ªkeyçš„æ–¹å¼æ¥å¤„ç†</p><ul><li>è§†é¢‘æ•°æ®</li><li>è§†é¢‘è¯„è®º</li><li>è§†é¢‘æ–°å¼¹å¹•</li><li>â€¦</li></ul><p>å¯¹åº”çš„æ¶ˆè´¹è€…å¯ä»¥é€šè¿‡BLPOPå‘½ä»¤ä¸€æ¬¡æ€§ç­‰å¾…å¤šä¸ªkeyï¼Œè¿™æ ·ä¸ç®¡æ˜¯æ–°çš„è¯„è®ºæ¥äº†ï¼Œè¿˜æ˜¯æ–°çš„å¼¹å¹•æ¥äº†ï¼Œéƒ½èƒ½åœ¨ç¬¬ä¸€æ—¶é—´è¢«å¤„ç†ã€‚</p><h3 id="3-4-5-ç”¨æˆ·çš„timeline"><a href="#3-4-5-ç”¨æˆ·çš„timeline" class="headerlink" title="3.4.5 ç”¨æˆ·çš„timeline"></a>3.4.5 ç”¨æˆ·çš„timeline</h3><p>å› ä¸ºlisté‡Œé¢çš„å…ƒç´ æ˜¯æœ‰åºçš„ï¼Œå…ˆæ’å…¥çš„å§‹ç»ˆæ˜¯åœ¨listçš„å¤´éƒ¨ã€‚æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡listæ¥å®ç°ä¸€ä¸ªæ—¶é—´è½´çš„åŠŸèƒ½ã€‚</p><p>å½“ç”¨æˆ·æ–°å»ºä¸€ä¸ªå¾®åšçš„æ—¶å€™ï¼Œå°±å°†è¿™ä¸ªå¾®åšçš„idæ’å…¥ç”¨æˆ·ç›¸å…³çš„listï¼Œè¿™æ ·ç”¨æˆ·å’Œä»–ä¸Šä¼ çš„å¾®åšå°±æœ‰äº†ä¸€ä¸ªæ—¶é—´çš„å…³ç³»ï¼Œè¿˜å¯ä»¥ç”¨lrangeå‘½ä»¤å¾ˆæ–¹ä¾¿çš„è·å–åˆ°ç”¨æˆ·çš„å‰nä¸ªå¾®åšï¼Œæˆ–æŸä¸ªåŒºé—´çš„å¾®åšã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªåˆ†é¡µè·å–ç”¨æˆ·å¾®åšçš„ä¼ªä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…ˆè·å–ç”¨æˆ·å‰10ä¸ªå¾®åš</span></span><br><span class="line">key_list = <span class="string">&quot;LRANGE user:1:blog 0 9&quot;</span></span><br><span class="line"><span class="comment"># éå†æ¯ä¸ªkeyè·å–åˆ°å¾®åšçš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> key_list: </span><br><span class="line">blog_info = <span class="string">&quot;HGETALL key&quot;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå‡è®¾å°†å•ä¸ªåˆ†é¡µéœ€è¦æ˜¾ç¤ºçš„æ•°æ®è®¾ç½®ä¸º100ï¼Œé‚£ä¹ˆæ¯æ¬¡å¾ªç¯ä¸­å°±ä¼šå¤šæ¬¡è°ƒç”¨hashç±»å‹çš„HGETALLå‘½ä»¤ï¼Œå¯¼è‡´Rediså¯èƒ½è¢«é˜»å¡ã€‚</p><blockquote><p>è¿™ä¸ªé—®é¢˜å¯ä»¥ä½¿ç”¨pipelineæ¥è§£å†³ï¼Œç›¸å½“äºå°†å¤šä¸ªRediså‘½ä»¤åˆå¹¶æˆä¸€ä¸ªç½‘ç»œè¯·æ±‚æ¥æ‰§è¡Œï¼Œå¯ä»¥å‡å°‘ç½‘ç»œä¼ è¾“å¤šæ¬¡å¯¼è‡´çš„å»¶è¿Ÿã€‚åç»­å°†å­¦ä¹ ç›¸å…³å†…å®¹ã€‚</p></blockquote><p>å¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œlrangeé’ˆå¯¹listä¸¤å¤´çš„æŸ¥è¯¢æ•ˆç‡è¿˜ä¸é”™ï¼ˆå› ä¸ºå¯ä»¥ç›´æ¥ä»å¤´æˆ–ä»å°¾éƒ¨å¼€å§‹éå†ï¼‰ä½†å¯¹ä¸­é—´çš„åˆ†é¡µè·å–çš„æ•ˆç‡å°±æœ‰ç‚¹ä½äº†ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡listæ¥è§£å†³ï¼ˆæœ‰ç‚¹ç±»ä¼¼åˆ†åº“åˆ†è¡¨ï¼‰ã€‚</p><h1 id="4-Set"><a href="#4-Set" class="headerlink" title="4 Set"></a>4 Set</h1><p>setæ˜¯ä¸€ä¸ªé›†åˆï¼Œé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯stringç±»å‹ã€‚å®ƒå’Œlistçš„åŒºåˆ«ä¸»è¦åœ¨äºï¼š</p><ul><li>setçš„å…ƒç´ ä¸å¯ä»¥é‡å¤ï¼›</li><li>setçš„å…ƒç´ æ˜¯æ— åºçš„ï¼›</li></ul><p>æ‰€è°“æ— éœ€ï¼Œæ˜¯ç›¸å¯¹äºlistçš„æœ‰åºè€Œè¨€çš„ï¼ˆæ³¨æ„ï¼Œlistçš„æœ‰åºæŒ‡çš„æ˜¯é¡ºåºè¡¨ä¸­å…ƒç´ çš„é¡ºåºï¼Œå¹¶ä¸æ˜¯è¯´listä¼šæŒ‰å¤§å°æ’åºï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[1,2,3] å’Œ [1,3,2] æ˜¯ä¸¤ä¸ªä¸åŒçš„list</span><br><span class="line">[1,2,3] å’Œ [1,3,2] å’Œ [2,3,1] éƒ½æ˜¯ç›¸åŒçš„set</span><br></pre></td></tr></table></figure><h2 id="4-1-ç›¸å…³å‘½ä»¤"><a href="#4-1-ç›¸å…³å‘½ä»¤" class="headerlink" title="4.1 ç›¸å…³å‘½ä»¤"></a>4.1 ç›¸å…³å‘½ä»¤</h2><h3 id="4-1-1-SADD"><a href="#4-1-1-SADD" class="headerlink" title="4.1.1 SADD"></a>4.1.1 SADD</h3><p>SADDå‘½ä»¤ç”¨äºç»™setä¸­æ·»åŠ å…ƒç´ ï¼Œä¸ºäº†å’Œlistä¸­çš„å…ƒç´ ä½œåŒºåˆ†ï¼Œsetä¸­çš„å…ƒç´ è¢«ç§°ä¸ºmemberã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SADD key member [member ...]</span><br></pre></td></tr></table></figure><p>è¿”å›å€¼è¡¨ç¤ºæœ¬æ¬¡æ“ä½œæ·»åŠ æˆåŠŸäº†å‡ ä¸ªå…ƒç´ ï¼Œé‡å¤çš„å…ƒç´ åªä¼šè¢«æ·»åŠ ä¸€æ¬¡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sadd key 1 2 3 4</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; sadd key1 1 2 3 4 5 4</span><br><span class="line">(integer) 5</span><br></pre></td></tr></table></figure><h3 id="4-1-2-SMEMBERS"><a href="#4-1-2-SMEMBERS" class="headerlink" title="4.1.2 SMEMBERS"></a>4.1.2 SMEMBERS</h3><p>æŸ¥çœ‹setçš„æ‰€æœ‰æˆå‘˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SMEMBERS key</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; smembers key</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">3) &quot;3&quot;</span><br><span class="line">4) &quot;4&quot;</span><br></pre></td></tr></table></figure><h3 id="4-1-3-SISMEMBER"><a href="#4-1-3-SISMEMBER" class="headerlink" title="4.1.3 SISMEMBER"></a>4.1.3 SISMEMBER</h3><p>æŸ¥çœ‹æŸä¸ªå…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SISMEMBER key member</span><br></pre></td></tr></table></figure><p>è¿”å›å€¼ä¸º1ä»£è¡¨å­˜åœ¨ï¼Œè¿”å›å€¼ä¸º0ä»£è¡¨ä¸å­˜åœ¨ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sismember key 1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; sismember key 120</span><br><span class="line">(integer) 0</span><br></pre></td></tr></table></figure><h3 id="4-1-4-SPOP"><a href="#4-1-4-SPOP" class="headerlink" title="4.1.4 SPOP"></a>4.1.4 SPOP</h3><p>è¯¥å‘½ä»¤å¯ä»¥å¼¹å‡ºsetä¸­çš„å…ƒç´ ã€‚ä½†å› ä¸ºsetæ˜¯æ— åºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½æŒ‡å®šåˆ é™¤å…ƒç´ çš„ä¸ªæ•°ï¼ŒRedisä¼š<strong>éšæœºåˆ é™¤ï¼ˆå¼¹å‡ºï¼‰</strong>setä¸­çš„å…ƒç´ ï¼Œè¿™ä¸€ç‚¹åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æœ‰è¯´æ˜ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SPOP key [count]</span><br></pre></td></tr></table></figure><p>è¿”å›å€¼æ˜¯è¢«åˆ é™¤çš„å…ƒç´ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; spop key 2</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;4&quot;</span><br><span class="line">127.0.0.1:6379&gt; spop key</span><br><span class="line">&quot;2&quot;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤ä¹Ÿèƒ½ä½“ç°å‡ºsetä¸­å…ƒç´ æ— åºçš„æ¦‚å¿µã€‚æˆ‘ä»¬æŒ‰1234æ„æ¶ä¸¤ä¸ªsetï¼Œå°è¯•è¿›è¡Œspopï¼Œèƒ½å‘ç°æ¯æ¬¡åˆ é™¤çš„å…ƒç´ çš„é¡ºåºæ˜¯ä¸ä¸€æ ·çš„ï¼Œå®Œå…¨éšæœºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sadd key1 1 2 3 4</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; sadd key2 1 2 3 4</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; spop key1</span><br><span class="line">&quot;1&quot;</span><br><span class="line">127.0.0.1:6379&gt; spop key1</span><br><span class="line">&quot;2&quot;</span><br><span class="line">127.0.0.1:6379&gt; spop key1</span><br><span class="line">&quot;4&quot;</span><br><span class="line">127.0.0.1:6379&gt; spop key1</span><br><span class="line">&quot;3&quot;</span><br><span class="line">127.0.0.1:6379&gt; spop key2</span><br><span class="line">&quot;2&quot;</span><br><span class="line">127.0.0.1:6379&gt; spop key2</span><br><span class="line">&quot;3&quot;</span><br><span class="line">127.0.0.1:6379&gt; spop key2</span><br><span class="line">&quot;4&quot;</span><br><span class="line">127.0.0.1:6379&gt; spop key2</span><br><span class="line">&quot;1&quot;</span><br></pre></td></tr></table></figure><h3 id="4-1-5-SRANDMEMBER"><a href="#4-1-5-SRANDMEMBER" class="headerlink" title="4.1.5 SRANDMEMBER"></a>4.1.5 SRANDMEMBER</h3><p>è¿™ä¸ªå‘½ä»¤å’ŒSPOPåŠŸèƒ½ç±»ä¼¼ï¼Œè¿”å›setä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªéšæœºæ•°æ®ï¼Œä½†ä¸ä¼šåˆ é™¤è¯¥æ•°æ®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SRANDMEMBER key [count]</span><br></pre></td></tr></table></figure><h3 id="4-1-6-SMOVE"><a href="#4-1-6-SMOVE" class="headerlink" title="4.1.6 SMOVE"></a>4.1.6 SMOVE</h3><p>å°†æŸä¸ªå…ƒç´ ä»set1ç§»åŠ¨åˆ°set2ï¼Œæˆ–è€…è¯´æ˜¯ä»sourceä¸­åˆ é™¤ï¼Œåœ¨destinationä¸­æ–°å¢ã€‚</p><p>å¦‚æœdestinationä¸­å·²ç»å­˜åœ¨è¯¥å…ƒç´ ï¼Œåˆ™åªä¼šåˆ é™¤sourceä¸­çš„å…ƒç´ ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SMOVE source destination member</span><br></pre></td></tr></table></figure><p>æµ‹è¯•å¦‚ä¸‹ï¼Œè¯¥å‘½ä»¤æˆåŠŸæ—¶è¿”å›1ï¼Œä¸æˆåŠŸè¿”å›0ï¼ˆsourceä¸­ä¸å­˜åœ¨è¯¥å…ƒç´ æ—¶å¤±è´¥ï¼‰ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sadd key1 1 2 3</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; sadd key2 5 6</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; smove key1 key2 3</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; smembers key2</span><br><span class="line">1) &quot;3&quot;</span><br><span class="line">2) &quot;5&quot;</span><br><span class="line">3) &quot;6&quot;</span><br><span class="line">127.0.0.1:6379&gt; smove key1 key2 33</span><br><span class="line">(integer) 0</span><br></pre></td></tr></table></figure><h3 id="4-1-7-SREM"><a href="#4-1-7-SREM" class="headerlink" title="4.1.7 SREM"></a>4.1.7 SREM</h3><p>åˆ é™¤setä¸­çš„æŒ‡å®šå…ƒç´ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SREM key member [member ...]</span><br></pre></td></tr></table></figure><h3 id="4-1-8-SINTER-x2F-SINTERSTORE"><a href="#4-1-8-SINTER-x2F-SINTERSTORE" class="headerlink" title="4.1.8 SINTER&#x2F;SINTERSTORE"></a>4.1.8 SINTER&#x2F;SINTERSTORE</h3><p>æ±‚ä¸¤ä¸ªé›†åˆçš„äº¤é›†ï¼Œå³è·å–åŒæ—¶å‡ºç°åœ¨ä¸¤ä¸ªsetä¸­çš„å…ƒç´ ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SINTER key [key ...]</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(M*N)</code>ï¼Œå…¶ä¸­Mæ˜¯æœ€å°çš„é›†åˆå…ƒç´ ä¸ªæ•°ï¼ŒNæ˜¯æœ€å¤§çš„é›†åˆå…ƒç´ ä¸ªæ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sadd key1 1 2 3 4</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; sadd key2 3 4 5 6</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; sinter key1 key2</span><br><span class="line">1) &quot;3&quot;</span><br><span class="line">2) &quot;4&quot;</span><br></pre></td></tr></table></figure><p>å¦å¤–ä¸€ä¸ªå‘½ä»¤æ˜¯SINTERSTOREï¼Œå®ƒå¤šäº†ä¸€ä¸ªå­˜å‚¨åŠŸèƒ½ï¼Œæ±‚äº†äº¤é›†åï¼Œå­˜å‚¨åˆ°destinationä¸­ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SINTERSTORE destination key [key ...]</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤çš„è¿”å›å€¼æ˜¯æœ€ç»ˆäº¤é›†çš„å…ƒç´ ä¸ªæ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sinterstore key3 key1 key2</span><br><span class="line">(integer) 2</span><br></pre></td></tr></table></figure><h3 id="4-1-9-SUNION-x2F-SUNIONSTORE"><a href="#4-1-9-SUNION-x2F-SUNIONSTORE" class="headerlink" title="4.1.9 SUNION&#x2F;SUNIONSTORE"></a>4.1.9 SUNION&#x2F;SUNIONSTORE</h3><p>æ±‚ä¸¤ä¸ªé›†åˆçš„å¹¶é›†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SUNION key [key ...]</span><br><span class="line">SUNIONSTROE destination key [key ...]</span><br></pre></td></tr></table></figure><p>åŠŸèƒ½å’Œä¸Šé¢çš„å‘½ä»¤ç±»ä¼¼ï¼Œè¿™é‡Œå°±ä¸åšæ¼”ç¤ºäº†</p><h3 id="4-1-10-SDIFF-x2F-SDIFFSTORE"><a href="#4-1-10-SDIFF-x2F-SDIFFSTORE" class="headerlink" title="4.1.10 SDIFF&#x2F;SDIFFSTORE"></a>4.1.10 SDIFF&#x2F;SDIFFSTORE</h3><p>æ±‚é›†åˆçš„å·®é›†ï¼Œå³å­˜åœ¨äºç¬¬ä¸€ä¸ªkeyï¼Œä½†æ˜¯ä¸åœ¨ç¬¬äºŒä¸ªkeyä¸­çš„å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SDIFF key [key ...]</span><br><span class="line">SDIFFSTROE destination key [key ...]</span><br></pre></td></tr></table></figure><p>å®æµ‹å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sadd key1 1 2 3 4</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; sadd key2 3 4 5 6</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; sdiff key1 key2</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">127.0.0.1:6379&gt; sdiff key2 key1</span><br><span class="line">1) &quot;5&quot;</span><br><span class="line">2) &quot;6&quot;</span><br></pre></td></tr></table></figure><p>å¦‚æœkeyçš„æ•°é‡ä¸æ­¢ä¸¤ä¸ªï¼Œä½ å¯ä»¥ç†è§£ä¸ºRedisä¼šè¿›è¡Œä¾æ¬¡è®¡ç®—ã€‚å³å…ˆè®¡ç®—key1å’Œkey2çš„å·®é›†ï¼Œå†å°†ç»“æœå’Œkey3è¿›è¡Œè®¡ç®—ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œkey1å’Œkey2çš„å·®é›†åŒ…å«1å’Œ2ï¼Œä½†æ˜¯key3ä¸­æœ‰1ï¼Œæ‰€ä»¥æœ€ç»ˆçš„å·®é›†ç»“æœå°±åªæœ‰2äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sadd key3 1 3 7 8</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; sdiff key1 key2 key3</span><br><span class="line">1) &quot;2&quot;</span><br></pre></td></tr></table></figure><h3 id="4-1-11-SCARD"><a href="#4-1-11-SCARD" class="headerlink" title="4.1.11 SCARD"></a>4.1.11 SCARD</h3><p>è·å–setä¸­å…ƒç´ çš„ä¸ªæ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SCARD key</span><br></pre></td></tr></table></figure><p>æµ‹è¯•å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sadd key1 1 2 3 4</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; scard key1</span><br><span class="line">(integer) 4</span><br></pre></td></tr></table></figure><h2 id="4-2-ç¼–ç æ–¹å¼"><a href="#4-2-ç¼–ç æ–¹å¼" class="headerlink" title="4.2 ç¼–ç æ–¹å¼"></a>4.2 ç¼–ç æ–¹å¼</h2><p>setæœ‰ä¸¤ç§ç¼–ç æ–¹å¼</p><ul><li>intsetï¼šå¦‚æœsetä¸­å…¨éƒ½æ˜¯æ•´æ•°ï¼Œé‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡<code>set-max-intset-entries</code>æ¥é…ç½®å…ƒç´ ä¸ªæ•°ï¼Œè¶…è¿‡è¿™ä¸ªæ•°é‡çš„ä¼šé‡‡ç”¨hashtableã€‚</li><li>hashtableï¼šå½“setä¸­æœ‰å…¶ä»–éæ•°å­—ç±»å‹æ—¶ï¼Œé‡‡ç”¨è¿™ç§æ–¹å¼ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sadd key 1 2 3 4</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; object encoding key</span><br><span class="line">&quot;intset&quot;</span><br><span class="line">127.0.0.1:6379&gt; sadd key 1afb</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; object encoding key</span><br><span class="line">&quot;hashtable&quot;</span><br></pre></td></tr></table></figure><h2 id="4-3-åº”ç”¨åœºæ™¯"><a href="#4-3-åº”ç”¨åœºæ™¯" class="headerlink" title="4.3 åº”ç”¨åœºæ™¯"></a>4.3 åº”ç”¨åœºæ™¯</h2><h3 id="4-3-1-ä¿å­˜æ ‡ç­¾"><a href="#4-3-1-ä¿å­˜æ ‡ç­¾" class="headerlink" title="4.3.1 ä¿å­˜æ ‡ç­¾"></a>4.3.1 ä¿å­˜æ ‡ç­¾</h3><p>ä¸€ä¸ªè§†é¢‘ä¼šæœ‰ç›¸å…³æ ‡ç­¾ï¼Œä¸€ä¸ªç”¨æˆ·ä¹Ÿä¼šæœ‰ç›¸å…³æ ‡ç­¾ï¼Œsetç±»å‹æœ‰å…ƒç´ ä¸èƒ½é‡å¤çš„ç‰¹æ€§ï¼Œæ¯”è¾ƒé€‚åˆç”¨äºä¿å­˜æŸä¸ªå¯¹è±¡çš„æ ‡ç­¾ã€‚</p><p>æ¯”å¦‚æŸä¸ªç”¨æˆ·çš„å…´è¶£çˆ±å¥½ï¼Œè¿™äº›çˆ±å¥½èƒ½å¸®åŠ©åˆ»ç”»ä¸€ä¸ªç”¨æˆ·ç”»åƒï¼Œä»¥ä¾¿æ›´åŠ ç²¾ç¡®çš„æ¨é€ç”¨æˆ·å–œæ¬¢çš„ä¸œè¥¿ï¼ˆæˆ–åˆ™å¹¿å‘Šï¼‰</p><h3 id="4-3-2-å…¬å…±å¥½å‹"><a href="#4-3-2-å…¬å…±å¥½å‹" class="headerlink" title="4.3.2 å…¬å…±å¥½å‹"></a>4.3.2 å…¬å…±å¥½å‹</h3><p>é€šè¿‡é›†åˆæ±‚äº¤é›†ï¼Œèƒ½å¾ˆå®¹æ˜“å¾—åˆ°ä¸¤ä¸ªç”¨æˆ·çš„å…¬å…±å¥½å‹ï¼Œæˆ–è€…å…±åŒå…³æ³¨äº†xxxã€‚</p><h3 id="4-3-3-è®°å½•ç«™ç‚¹PV-x2F-UV"><a href="#4-3-3-è®°å½•ç«™ç‚¹PV-x2F-UV" class="headerlink" title="4.3.3 è®°å½•ç«™ç‚¹PV&#x2F;UV"></a>4.3.3 è®°å½•ç«™ç‚¹PV&#x2F;UV</h3><p>ç«™ç‚¹PVï¼ˆPage Viewï¼‰æŒ‡çš„æ˜¯ç«™ç‚¹çš„è®¿é—®é‡ï¼Œæ¯æ¬¡ç‚¹å‡»ä¸€ä¸ªé¡µé¢ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªPVã€‚</p><p>ç«™ç‚¹UVï¼ˆUser Viewï¼‰æŒ‡çš„æ˜¯ç«™ç‚¹çš„ç”¨æˆ·è®¿é—®é‡ï¼Œæ¯ä¸ªç”¨æˆ·åªä¼šè®°å½•ä¸€æ¬¡ã€‚</p><p>å› ä¸ºPVå’ŒUVçš„è®°å½•å†…å®¹ä¸åŒï¼Œåœ¨è®°å½•çš„æ—¶å€™éœ€è¦è¿›è¡Œä¸€å®šçš„å»é‡ã€‚æ¯”å¦‚UVéœ€è¦æŒ‰ç”¨æˆ·å»é‡ï¼Œä¸€ä¸ªç”¨æˆ·åªèƒ½è®°å½•ä¸€æ¬¡ã€‚è¿™æ—¶å€™ç”¨setæ¥å»é‡å°±æ¯”è¾ƒæ–¹ä¾¿äº†ï¼Œå½“æœ‰æ–°ç”¨æˆ·è®¿é—®é¡µé¢çš„æ—¶å€™ï¼Œå°±å°†è¿™ä¸ªç”¨æˆ·çš„idæ’å…¥åˆ°å¯¹åº”keyçš„setä¸­ï¼Œæœ€ç»ˆè®°å½•UVå°±è·å–è¿™ä¸ªsetçš„é•¿åº¦å°±è¡Œã€‚</p><h1 id="5-Zset"><a href="#5-Zset" class="headerlink" title="5.Zset"></a>5.Zset</h1><p>Zsetæ˜¯æœ‰åºçš„é›†åˆï¼Œåœ¨é›†åˆçš„åŸºç¡€ä¸Šï¼Œå¯¹å†…å®¹ä¼šè¿›è¡Œå‡åºæ’åºã€‚</p><p>Zsetä¸­çš„memberåŒæ—¶å¼•å…¥äº†ä¸€ä¸ª<code>score</code>åˆ†æ•°çš„å±æ€§ï¼Œæ¯ä¸ªmemberéƒ½ä¼šæœ‰ä¸€ä¸ªè‡ªå·±çš„åˆ†æ•°ï¼Œæ’åºçš„æ—¶å€™å°±æ˜¯æŒ‰åˆ†æ•°çš„å¤§å°æ¥è¿›è¡Œ<strong>å‡åºæ’åº</strong>çš„ã€‚Zsetä¸­çš„memberå¿…é¡»å”¯ä¸€ï¼Œä½†scoreåˆ†æ•°å¯ä»¥é‡å¤ã€‚</p><p>æ³¨æ„ï¼Œmember&#x2F;scoreä¹‹é—´çš„å…³ç³»å¹¶éé”®å€¼å¯¹ï¼Œscoreåªæ˜¯memberçš„ä¸€ä¸ªç”¨äºæ’åºçš„å±æ€§å€¼ï¼åœ¨Zsetä¸­æ—¢å¯ä»¥é€šè¿‡memberæŸ¥è¯¢scoreï¼Œä¹Ÿå¯ä»¥é€šè¿‡scoreæ¥æŸ¥è¯¢memberã€‚</p><p>Zsetä¸­çš„åˆ†æ•°å¯ä»¥æ˜¯å°æ•°ã€‚å¦‚æœå¤šä¸ªå…ƒç´ æœ‰ç›¸åŒçš„åˆ†æ•°ï¼Œåˆ™æŒ‰å…ƒç´ çš„å­—å…¸åºæ’åºã€‚</p><h2 id="5-1-ç›¸å…³å‘½ä»¤"><a href="#5-1-ç›¸å…³å‘½ä»¤" class="headerlink" title="5.1 ç›¸å…³å‘½ä»¤"></a>5.1 ç›¸å…³å‘½ä»¤</h2><h3 id="5-1-1-ZADD"><a href="#5-1-1-ZADD" class="headerlink" title="5.1.1 ZADD"></a>5.1.1 ZADD</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ZADD key [NX | XX] [GT | LT] [CH] [INCR] score member [score member</span><br><span class="line">  ...]</span><br></pre></td></tr></table></figure><p>ZADDå‘½ä»¤æœ‰å¾ˆå¤šé€‰é¡¹ï¼Œå…¶ä¸­ä¸€äº›é€‰é¡¹ä¹‹å‰å·²ç»è§è¿‡äº†</p><ul><li>XXï¼šåªæœ‰memberå­˜åœ¨çš„æ—¶å€™ï¼Œæ‰ä¼šæ›´æ–°åˆ†æ•°ï¼›</li><li>NXï¼šæ’å…¥æ–°çš„memberï¼Œå¦‚æœå·²å­˜åœ¨åˆ™ä¸åšä»»ä½•å¤„ç†ï¼›</li><li>LTï¼šåªæœ‰æ–°çš„score<strong>å°äº</strong>å½“å‰scoreæ—¶æ‰ä¼šæ›´æ–°ï¼Œ ä¸ä¼šé˜»æ­¢æ·»åŠ æ–°å…ƒç´ ï¼ˆä¸å­˜åœ¨çš„memberæ­£å¸¸æ·»åŠ ï¼‰</li><li>GTï¼šåŒä¸Šï¼Œä½†åªæœ‰æ–°çš„score<strong>å¤§äº</strong>å½“å‰scoreæ—¶æ‰ä¼šæ›´æ–°ï¼›</li><li>CHï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒZADDè¿”å›æ–°å…ƒç´ è¢«æ·»åŠ çš„ä¸ªæ•°ã€‚æ·»åŠ CHé€‰é¡¹åï¼Œä¼šè¿”å›æ–°å…ƒç´ è¢«æ·»åŠ çš„ä¸ªæ•°+è¢«ä¿®æ”¹scoreçš„å…ƒç´ ä¸ªæ•°ã€‚</li><li>INCRï¼šå½“æŒ‡å®šæ­¤é€‰é¡¹æ—¶ï¼ŒZADDçš„ä½œç”¨ç±»ä¼¼äºZINCRBYã€‚åœ¨æ­¤æ¨¡å¼ä¸‹åªèƒ½æŒ‡å®šä¸€ä¸ªscore-elementå¯¹ã€‚</li></ul><p>è¿™ä¸ªå‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦<code>O(log(N))</code>ï¼Œ<strong>Næ˜¯Zsetä¸­å…ƒç´ çš„ä¸ªæ•°</strong>ã€‚å› ä¸ºzsetä½œä¸ºæœ‰åºçš„ç»“æ„ï¼Œéœ€è¦å°†æ–°æ’å…¥çš„å…ƒç´ æ”¾åˆ°æ­£ç¡®çš„ä½ç½®ä¸Šï¼Œè¿™ä¸ªæ“ä½œä¼šæœ‰è€—æ—¶ã€‚</p><p>æ’å…¥æ•°æ®åæŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ°æ•°æ®æ˜¯æŒ‰æˆ‘ä»¬é¢„å…ˆè®¾ç½®æ˜¯åˆ†æ•°è¿›è¡Œå‡åºæ’åºçš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd key 98 lisi 97 zhangsan 99 wangwu</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; zrange key 0 -1</span><br><span class="line">1) &quot;zhangsan&quot;</span><br><span class="line">2) &quot;lisi&quot;</span><br><span class="line">3) &quot;wangwu&quot;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•NX&#x2F;XXé€‰é¡¹ï¼Œå¦‚æœä¸å¸¦ä»»ä½•é€‰é¡¹ï¼Œåˆ™ä¼šæ›´æ–°å·²æœ‰memberçš„åˆ†æ•°ï¼ˆåŸæœ¬lisiçš„åˆ†æ•°æ˜¯98ï¼‰ï¼Œå¸¦äº†NXé€‰é¡¹åï¼Œlisiçš„åˆ†æ•°æ²¡æœ‰è¢«ä¿®æ”¹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd key 99 lisi</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt;  zrange key 0 -1 withscores</span><br><span class="line">1) &quot;zhangsan&quot;</span><br><span class="line">2) &quot;97&quot;</span><br><span class="line">3) &quot;lisi&quot;</span><br><span class="line">4) &quot;99&quot;</span><br><span class="line">5) &quot;wangwu&quot;</span><br><span class="line">6) &quot;99&quot;</span><br><span class="line">127.0.0.1:6379&gt; zadd key nx 100 lisi</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt;  zrange key 0 -1 withscores</span><br><span class="line">1) &quot;zhangsan&quot;</span><br><span class="line">2) &quot;97&quot;</span><br><span class="line">3) &quot;lisi&quot;</span><br><span class="line">4) &quot;99&quot;</span><br><span class="line">5) &quot;wangwu&quot;</span><br><span class="line">6) &quot;99&quot;</span><br></pre></td></tr></table></figure><p>å¸¦xxé€‰é¡¹ï¼Œlisiçš„åˆ†æ•°è¢«ä¿®æ”¹æˆåŠŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd key xx 100 lisi</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; zrange key 0 -1 withscores</span><br><span class="line">1) &quot;zhangsan&quot;</span><br><span class="line">2) &quot;97&quot;</span><br><span class="line">3) &quot;wangwu&quot;</span><br><span class="line">4) &quot;99&quot;</span><br><span class="line">5) &quot;lisi&quot;</span><br><span class="line">6) &quot;100&quot;</span><br></pre></td></tr></table></figure><p>å¸¦xxé€‰é¡¹æ“ä½œä¸€ä¸ªä¸å­˜åœ¨çš„memberï¼Œæ²¡æœ‰è¢«æ–°å¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd key xx 100 kk</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt;  zrange key 0 -1 withscores</span><br><span class="line">1) &quot;zhangsan&quot;</span><br><span class="line">2) &quot;97&quot;</span><br><span class="line">3) &quot;wangwu&quot;</span><br><span class="line">4) &quot;99&quot;</span><br><span class="line">5) &quot;lisi&quot;</span><br><span class="line">6) &quot;100&quot;</span><br></pre></td></tr></table></figure><p>chä¼šåœ¨è¿”å›å€¼ä¸­å¸¦ä¸Šè¢«ä¿®æ”¹åˆ†æ•°çš„ä¸ªæ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œkkå·²ç»å­˜åœ¨ï¼Œå°†åˆ†æ•°ä¿®æ”¹ä¸º110ï¼Œå¸¦ché€‰é¡¹ï¼Œè¿”å›å€¼ä¸º1ï¼›å†æ¬¡ä¿®æ”¹kkçš„åˆ†æ•°ï¼Œä¸å¸¦ché€‰é¡¹ï¼Œè¿”å›å€¼ä¸º0ï¼Œä½†kkçš„åˆ†æ•°å·²ç»è¢«ä¿®æ”¹ä¸º112äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd key xx ch 110 kk</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd key xx 112 kk</span><br><span class="line">(integer) 0</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> 9) &quot;kk&quot;</span><br><span class="line">10) &quot;112&quot;</span><br></pre></td></tr></table></figure><h3 id="5-1-2-ZRANGE"><a href="#5-1-2-ZRANGE" class="headerlink" title="5.1.2 ZRANGE"></a>5.1.2 ZRANGE</h3><p>ZRANGEç±»ä¼¼äºLRANGEï¼Œå¯ä»¥ç”¨ä¸‹æ ‡çš„æ–¹å¼æ¥æŸ¥çœ‹Zsetä¸­çš„å…ƒç´ ä¸ªæ•°ã€‚å› ä¸ºZsetä¸­çš„å…ƒç´ æœ‰åºï¼Œæ‰€ä»¥å®ƒå­˜åœ¨â€œä¸‹æ ‡â€çš„æ¦‚å¿µã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ZRANGE key start stop [BYSCORE | BYLEX] [REV] [LIMIT offset count]</span><br><span class="line">  [WITHSCORES]</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(log(N)+M)</code>ï¼Œå…¶ä¸­Næ˜¯ZSETä¸­çš„å…ƒç´ ä¸ªæ•°ï¼ŒMæ˜¯éœ€è¦è¿”å›çš„å…ƒç´ ä¸ªæ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd key 98 lisi 97 zhangsan 99 wangwu</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; zrange key 0 -1</span><br><span class="line">1) &quot;zhangsan&quot;</span><br><span class="line">2) &quot;lisi&quot;</span><br><span class="line">3) &quot;wangwu&quot;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨WITHSCORESé€‰é¡¹ï¼Œå¯ä»¥è®©å…ƒç´ å’Œåˆ†æ•°ä¸€èµ·è¿”å›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zrange key 0 -1 withscores</span><br><span class="line">1) &quot;zhangsan&quot;</span><br><span class="line">2) &quot;97&quot;</span><br><span class="line">3) &quot;lisi&quot;</span><br><span class="line">4) &quot;98&quot;</span><br><span class="line">5) &quot;wangwu&quot;</span><br><span class="line">6) &quot;99&quot;</span><br></pre></td></tr></table></figure><h3 id="5-1-3-ZCARD"><a href="#5-1-3-ZCARD" class="headerlink" title="5.1.3 ZCARD"></a>5.1.3 ZCARD</h3><p>è·å–Zsetä¸­å…ƒç´ çš„ä¸ªæ•°ï¼ˆè¢«ç§°ä¸ºzsetçš„åŸºæ•°ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZCARD key</span><br></pre></td></tr></table></figure><p>æµ‹è¯•å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;  zrange key 0 -1</span><br><span class="line">1) &quot;zhangsan&quot;</span><br><span class="line">2) &quot;wangwu&quot;</span><br><span class="line">3) &quot;kk1&quot;</span><br><span class="line">4) &quot;lisi&quot;</span><br><span class="line">5) &quot;kk&quot;</span><br><span class="line">127.0.0.1:6379&gt; zcard key</span><br><span class="line">(integer) 5</span><br></pre></td></tr></table></figure><h3 id="5-1-4-ZCOUNT"><a href="#5-1-4-ZCOUNT" class="headerlink" title="5.1.4 ZCOUNT"></a>5.1.4 ZCOUNT</h3><p>è¿”å›åˆ†æ•°åœ¨min&#x2F;maxä¹‹é—´çš„å…ƒç´ ä¸ªæ•°ï¼Œé»˜è®¤æ˜¯é—­åŒºé—´ï¼ŒåŒ…å«minå’Œmaxçš„å€¼ã€‚è¯¥å‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(log(N))</code>ï¼ŒNæ˜¯Zsetä¸­å…ƒç´ ä¸ªæ•°ã€‚</p><p>zsetåœ¨å­˜æ”¾ä¸€ä¸ªmemberçš„æ—¶å€™ä¼šä¿å­˜å®ƒçš„æ¬¡åºï¼ˆå¯ä»¥ç®€å•ç†è§£ä¸ºä¸‹æ ‡ï¼‰æ‰€ä»¥è¿™ä¸ªå‘½ä»¤ä¸æ˜¯é€šè¿‡minåˆ°maxçš„éå†æ¥è·å–å…ƒç´ çš„ï¼Œè€Œæ˜¯å…ˆæ‰¾åˆ°minå’Œmaxè¿™ä¸¤ä¸ªè¾¹ç•Œå€¼çš„memberï¼Œå†è·å–åˆ°å®ƒä»¬çš„å…ƒç´ æ¬¡åºï¼Œ<strong>æœ€ç»ˆå°†æ¬¡åºç›¸å‡ï¼Œå°±å¾—åˆ°äº†å…ƒç´ ä¸ªæ•°</strong>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZCOUNT key min max</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨æ‹¬å·æ¥è¡¨ç¤ºå¼€åŒºé—´ï¼Œæ³¨æ„æ‹¬å·éƒ½æ˜¯åŠ åœ¨å‰é¢çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZCOUNT key (min (max</span><br></pre></td></tr></table></figure><p>æµ‹è¯•å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zrange key 0 -1 withscores</span><br><span class="line"> 1) &quot;zhangsan&quot;</span><br><span class="line"> 2) &quot;97&quot;</span><br><span class="line"> 3) &quot;wangwu&quot;</span><br><span class="line"> 4) &quot;99&quot;</span><br><span class="line"> 5) &quot;kk1&quot;</span><br><span class="line"> 6) &quot;100&quot;</span><br><span class="line"> 7) &quot;lisi&quot;</span><br><span class="line"> 8) &quot;100&quot;</span><br><span class="line"> 9) &quot;kk&quot;</span><br><span class="line">10) &quot;112&quot;</span><br><span class="line">127.0.0.1:6379&gt; zcount key 97 100</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; zcount key 97 (100</span><br><span class="line">(integer) 2</span><br></pre></td></tr></table></figure><p>å› ä¸ºzsetä¸­çš„scoreå¯ä»¥ä½¿ç”¨æµ®ç‚¹æ•°ï¼Œåœ¨Redisä¸­æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„æµ®ç‚¹æ•°ï¼Œç”¨äºè¡¨ç¤ºæ­£æ— ç©·å¤§<code>inf</code>å’Œè´Ÿæ— ç©·å¤§<code>-inf</code>ï¼Œæ‰€ä»¥åœ¨ZCOUNTçš„min&#x2F;maxä¸­ä¹Ÿå¯ä»¥ç”¨è¿™ä¸¤ä¸ªç‰¹æ®Šçš„æµ®ç‚¹æ•°æ¥ç­›é€‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zcount key -inf 100</span><br><span class="line">(integer) 4</span><br></pre></td></tr></table></figure><h3 id="5-1-5-ZREVRANCE"><a href="#5-1-5-ZREVRANCE" class="headerlink" title="5.1.5 ZREVRANCE"></a>5.1.5 ZREVRANCE</h3><p>è¿™ä¸ªå‘½ä»¤çš„ä½œç”¨å’ŒZRANGEç±»ä¼¼ï¼Œä½†è¿”å›çš„æ•°æ®æ˜¯é™åºçš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZREVRANGE key start stop [WITHSCORES]</span><br></pre></td></tr></table></figure><p>æµ‹è¯•å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ZREVRANGE key 0 -1 WITHSCORES</span><br><span class="line"> 1) &quot;kk&quot;</span><br><span class="line"> 2) &quot;112&quot;</span><br><span class="line"> 3) &quot;lisi&quot;</span><br><span class="line"> 4) &quot;100&quot;</span><br><span class="line"> 5) &quot;kk1&quot;</span><br><span class="line"> 6) &quot;100&quot;</span><br><span class="line"> 7) &quot;wangwu&quot;</span><br><span class="line"> 8) &quot;99&quot;</span><br><span class="line"> 9) &quot;zhangsan&quot;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œè¯¥å‘½ä»¤åœ¨Redis6.2ä¸­å·²ç»**å¼ƒç”¨(deprecated)**ï¼Œåœ¨ZRANGEä¸­ä½¿ç”¨REVé€‰é¡¹èƒ½å®ç°å®ƒçš„åŠŸèƒ½ã€‚</p><blockquote><p>As of Redis version 6.2.0, this command is regarded as deprecated.</p><p>It can be replaced by <a href="https://redis.io/commands/zrange"><code>ZRANGE</code></a> with the <code>REV</code> argument when migrating or writing new code.</p></blockquote><h3 id="5-1-6-ZPOPMAX-x2F-ZPOPMIN"><a href="#5-1-6-ZPOPMAX-x2F-ZPOPMIN" class="headerlink" title="5.1.6 ZPOPMAX&#x2F;ZPOPMIN"></a>5.1.6 ZPOPMAX&#x2F;ZPOPMIN</h3><p>åˆ é™¤å¹¶è¿”å›Zsetä¸­åˆ†æ•°æœ€é«˜çš„countä¸ªå…ƒç´ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ZPOPMAX key [count]</span><br><span class="line">ZPOPMIN key [count]</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤å¯ä»¥ç”¨æ¥è§£å†³TopKé—®é¢˜ï¼Œå‡è®¾æœ‰ä¸ª10å…ƒç´ çš„zsetï¼Œæƒ³è·å¾—scoreåœ¨å‰3çš„å…ƒç´ çš„ä¸€ä¸ªsetï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹å¼</p><ul><li>ZPOPMAXå°†é«˜ä¸‰ä½å¼¹å‡ºå¹¶å­˜æ”¾åˆ°å¦å¤–ä¸€ä¸ªzsetä¸­ï¼›</li><li>ZPOPMINå°†ä½ä¸ƒä½å¼¹å‡ºï¼Œæ­¤æ—¶å‰©ä¸‹çš„å°±æ˜¯é«˜ä¸‰ä½ï¼›</li></ul><p>æµ‹è¯•å¦‚ä¸‹ï¼Œpopçš„æ—¶å€™ä¼šå°†memberå’Œscoreä¸€èµ·å¼¹å‡ºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zpopmax key 2</span><br><span class="line">1) &quot;kk&quot;</span><br><span class="line">2) &quot;112&quot;</span><br><span class="line">3) &quot;lisi&quot;</span><br><span class="line">4) &quot;100&quot;</span><br></pre></td></tr></table></figure><h3 id="5-1-7-BZPOPMAX"><a href="#5-1-7-BZPOPMAX" class="headerlink" title="5.1.7 BZPOPMAX"></a>5.1.7 BZPOPMAX</h3><p>è¿™ä¸ªå‘½ä»¤æ˜¯ZPOPMAXçš„é˜»å¡ç‰ˆæœ¬ï¼Œå½“keyä¸­æ²¡æœ‰å…ƒç´ æ—¶ä¼šé˜»å¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BZPOPMAX key [key ...] timeout</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå’ŒBLPOP&#x2F;BRPOPçš„æ•ˆæœä¸€æ ·ï¼Œä¸åšæ¼”ç¤ºäº†ã€‚</p><h3 id="5-1-8-ZRANK"><a href="#5-1-8-ZRANK" class="headerlink" title="5.1.8 ZRANK"></a>5.1.8 ZRANK</h3><p>è·å–ä¸€ä¸ªZsetä¸­æŸä¸ªæˆå‘˜çš„æ’åï¼ˆè¿”å›çš„æ˜¯æ’ååºå·ï¼Œä»¥0å¼€å§‹ï¼‰æ—¶é—´å¤æ‚åº¦<code>O(log(N))</code>ï¼ŒNæ˜¯Zsetä¸­å…ƒç´ ä¸ªæ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZRANK key member [WITHSCORE]</span><br></pre></td></tr></table></figure><p>æµ‹è¯•å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zrange key 0 -1</span><br><span class="line">1) &quot;zhangsan&quot;</span><br><span class="line">2) &quot;wangwu&quot;</span><br><span class="line">3) &quot;kk1&quot;</span><br><span class="line">127.0.0.1:6379&gt; zrank key wangwu</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure><p>redis7.2åï¼Œæ·»åŠ withscoreé€‰é¡¹ï¼Œä¼šåŒæ—¶è¿”å›è¿™ä¸ªæˆå‘˜çš„åˆ†æ•°</p><h3 id="5-1-9-ZREVRANK"><a href="#5-1-9-ZREVRANK" class="headerlink" title="5.1.9 ZREVRANK"></a>5.1.9 ZREVRANK</h3><p>è¿”å›æŸä¸ªæˆå‘˜çš„æ’åï¼Œé™åºæ’åºã€‚æ—¶é—´å¤æ‚åº¦<code>O(log(N))</code>ï¼ŒNæ˜¯Zsetä¸­å…ƒç´ ä¸ªæ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZREVRANK key member [WITHSCORE]</span><br></pre></td></tr></table></figure><p>redis7.2åï¼Œæ·»åŠ withscoreé€‰é¡¹ï¼Œä¼šåŒæ—¶è¿”å›è¿™ä¸ªæˆå‘˜çš„åˆ†æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zrange key 0 -1</span><br><span class="line">1) &quot;zhangsan&quot;</span><br><span class="line">2) &quot;wangwu&quot;</span><br><span class="line">3) &quot;kk1&quot;</span><br><span class="line">127.0.0.1:6379&gt; zrevrank key wangwu</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zrevrank key kk1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; zrevrank key zhangsan</span><br><span class="line">(integer) 2</span><br></pre></td></tr></table></figure><h3 id="5-1-10-ZSCORE"><a href="#5-1-10-ZSCORE" class="headerlink" title="5.1.10 ZSCORE"></a>5.1.10 ZSCORE</h3><p>è¿”å›zsetä¸­æŸä¸ªæˆå‘˜çš„åˆ†æ•°ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º<code>O(1)</code>ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZSCORE key member</span><br></pre></td></tr></table></figure><p>æµ‹è¯•å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zrange key 0 -1 withscores</span><br><span class="line">1) &quot;zhangsan&quot;</span><br><span class="line">2) &quot;97&quot;</span><br><span class="line">3) &quot;wangwu&quot;</span><br><span class="line">4) &quot;99&quot;</span><br><span class="line">5) &quot;kk1&quot;</span><br><span class="line">6) &quot;100&quot;</span><br><span class="line">127.0.0.1:6379&gt; zscore key kk1</span><br><span class="line">&quot;100&quot;</span><br></pre></td></tr></table></figure><h3 id="5-1-11-ZREM"><a href="#5-1-11-ZREM" class="headerlink" title="5.1.11 ZREM"></a>5.1.11 ZREM</h3><p>åˆ é™¤æŸä¸ªzsetä¸­çš„memberï¼Œå¯ä»¥ä¸€æ¬¡æ€§ä¼ å…¥å¤šä¸ªã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZREM key member [member ...]</span><br></pre></td></tr></table></figure><p>æ—¶é—´å¤æ‚åº¦<code>O(M*log(N))</code>ï¼ŒNæ˜¯zsetä¸­å…ƒç´ ä¸ªæ•°ï¼ŒMæ˜¯éœ€è¦åˆ é™¤çš„å…ƒç´ ä¸ªæ•°ã€‚</p><h3 id="5-1-12-ZREMRANGEBYRANK"><a href="#5-1-12-ZREMRANGEBYRANK" class="headerlink" title="5.1.12 ZREMRANGEBYRANK"></a>5.1.12 ZREMRANGEBYRANK</h3><p>åˆ é™¤æŸä¸ªåŒºé—´çš„å…ƒç´ ï¼Œå’ŒZRANGEçš„start&#x2F;stopç›¸åŒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZREMRANGEBYRANK key start stop</span><br></pre></td></tr></table></figure><p>æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(log(N)+M) </code>ï¼ŒNæ˜¯zsetä¸­å…ƒç´ ä¸ªæ•°ï¼ŒMæ˜¯åŒºé—´å†…çš„å…ƒç´ ä¸ªæ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd key 1 one 2 two 3 three</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; ZREMRANGEBYRANK key 0 1</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt;  zrange key 0 -1</span><br><span class="line">1) &quot;three&quot;</span><br></pre></td></tr></table></figure><h3 id="5-1-13-ZREMRANGEBYSCORE"><a href="#5-1-13-ZREMRANGEBYSCORE" class="headerlink" title="5.1.13 ZREMRANGEBYSCORE"></a>5.1.13 ZREMRANGEBYSCORE</h3><p>åˆ é™¤æŸä¸ªåŒºé—´çš„å…ƒç´ ï¼Œä½¿ç”¨çš„æ˜¯min&#x2F;maxåˆ†æ•°åŒºé—´ï¼Œé»˜è®¤é—­åŒºé—´ï¼Œä¹Ÿå¯ä»¥ç”¨å·¦æ‹¬å·è¡¨ç¤ºå¼€åŒºé—´ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ZREMRANGEBYSCORE key min max</span><br><span class="line">ZREMRANGEBYSCORE key (min (max</span><br></pre></td></tr></table></figure><p>æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(log(N)+M) </code>ï¼ŒNæ˜¯zsetä¸­å…ƒç´ ä¸ªæ•°ï¼ŒMæ˜¯åŒºé—´å†…çš„å…ƒç´ ä¸ªæ•°ã€‚ </p><h3 id="5-1-14-ZINCRBY"><a href="#5-1-14-ZINCRBY" class="headerlink" title="5.1.14 ZINCRBY"></a>5.1.14 ZINCRBY</h3><p>ç»™æŸä¸ªzsetä¸­çš„å…ƒç´ <strong>å¢åŠ åˆ†æ•°</strong>ï¼Œå¦‚æœå…ƒç´ ä¸å­˜åœ¨ï¼Œåˆ™å’Œzaddçš„ä½œç”¨ç›¸åŒã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZINCRBY key increment member</span><br></pre></td></tr></table></figure><p>æ—¶é—´å¤æ‚åº¦<code>O(log(N))</code>ï¼ŒNä¸ºzsetä¸­å…ƒç´ ä¸ªæ•°ã€‚</p><h3 id="5-1-15-ZINTERSTORE"><a href="#5-1-15-ZINTERSTORE" class="headerlink" title="5.1.15 ZINTERSTORE"></a>5.1.15 ZINTERSTORE</h3><h3 id="5-1-16-ZUNIONSTORE"><a href="#5-1-16-ZUNIONSTORE" class="headerlink" title="5.1.16 ZUNIONSTORE"></a>5.1.16 ZUNIONSTORE</h3>]]></content>
    
    
    <summary type="html">Redisçš„å˜é‡ç±»å‹ä»¥åŠæ•°æ®ç±»å‹ç›¸å…³å‘½ä»¤çš„ä»‹ç»</summary>
    
    
    
    <category term="ç¼–ç¨‹å­¦ä¹ " scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="Redis" scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/Redis/"/>
    
    
    <category term="Redis" scheme="https://blog.musnow.top/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>ã€Redisã€‘03.åŸºæœ¬å‘½ä»¤å­¦ä¹ </title>
    <link href="https://blog.musnow.top/posts/3677820204/"/>
    <id>https://blog.musnow.top/posts/3677820204/</id>
    <published>2024-02-10T08:33:30.000Z</published>
    <updated>2024-02-20T02:22:28.000Z</updated>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ Redisçš„å‘½ä»¤å¯ä»¥å‚è€ƒå®˜ç½‘æ–‡æ¡£ï¼š<a href="https://redis.io/commands">Commands | Redis</a>ã€‚æˆ‘è¿˜å‘ç°å®˜ç½‘çš„examplesé‡Œé¢æ˜¯å¯ä»¥æ•²Rediså‘½ä»¤çš„ï¼Œå¦‚æœä½ æ²¡æœ‰é…ç½®Redisç¯å¢ƒï¼Œåº”è¯¥å¯ä»¥ç™½å«–è¿™é‡Œçš„Redisåšä¸ªä¸´æ—¶çš„ç»ƒä¹ ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/ada4c2c766f7d1faabd2a1a7a5a32287.png" alt="image.png"></p><p>æœ¬æ–‡ä½¿ç”¨Redisç‰ˆæœ¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">â¯ sudo redis-server --version</span><br><span class="line">Redis server v=6.0.16 sha=00000000:0 malloc=jemalloc-5.2.1 bits=64 build=a3fdef44459b3ad6</span><br><span class="line">â¯ sudo redis-cli --version</span><br><span class="line">redis-cli 6.0.16</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œæœ¬æ–‡å¹¶éRediså‘½ä»¤å¤§å…¨ï¼Œåªæ˜¯å¯¹æœ€å¸¸ç”¨çš„å‘½ä»¤åšçš„è®°å½•ã€‚</p><h1 id="1-setå’Œget"><a href="#1-setå’Œget" class="headerlink" title="1.setå’Œget"></a>1.setå’Œget</h1><h2 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h2><p>åœ¨Redisä¸­ï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯è¿™ä¸¤ä¸ªå‘½ä»¤ã€‚é¡¾åæ€ä¹‰ï¼Œsetæ˜¯ç”¨æ¥è®¾ç½®keyå€¼çš„ï¼Œgetæ˜¯ç”¨æ¥è·å–æŸä¸ªkeyå€¼çš„ã€‚</p><p>æ³¨æ„set&#x2F;getå‘½ä»¤<strong>åªèƒ½ç”¨äºè®¾ç½®å­—ç¬¦ä¸²stringå˜é‡</strong>ï¼Œå…¶ä»–ç±»å‹æœ‰å¯¹åº”çš„è®¾ç½®å‘½ä»¤ï¼Œç”¨getè·å–ä¸€ä¸ªéstringçš„keyä¼šå¤±è´¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set key value</span><br><span class="line">get key</span><br></pre></td></tr></table></figure><p>åœ¨redisä¸­ä¸åŒºåˆ†å‘½ä»¤çš„å¤§å°å†™ï¼ˆä½†æ˜¯åŒºåˆ†keyå’Œvalueçš„å¤§å°å†™ï¼‰ï¼Œå­—ç¬¦ä¸²ä¹Ÿä¸éœ€è¦åŠ å¼•å·ï¼ˆå¦‚æœæœ‰<strong>ç©ºæ ¼</strong>å°±éœ€è¦åŠ ï¼‰ï¼ŒsetæˆåŠŸä¼šè¿”å›<code>OK</code>ï¼Œå¤±è´¥ä¼šè¿”å›<code>nil</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set key1 value1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set key2 value2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get key2</span><br><span class="line">&quot;value2&quot;</span><br><span class="line">127.0.0.1:6379&gt; get key3</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; get KEY2</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; set k &quot;100 01&quot;</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get k</span><br><span class="line">100 01</span><br></pre></td></tr></table></figure><p>æœ€åçš„key3æ˜¯ä¸€ä¸ªä¸å­˜åœ¨çš„é”®å€¼ï¼ŒRedisè¿”å›äº†<code>(nil)</code>ï¼Œæ„æ€å’ŒNULLå…¶å®ä¸€æ ·ï¼Œå°±æ˜¯æ²¡æœ‰å€¼ã€‚åŒæ—¶å¤§å†™çš„KEY2ä¹Ÿæ²¡æœ‰å€¼ï¼Œå› ä¸ºRedisä¸­çš„keyéœ€è¦åŒºåˆ†å¤§å°å†™ã€‚</p><p>å¦‚æœå°è¯•setä¸€ä¸ªå·²ç»å­˜åœ¨çš„keyï¼Œä¼šè‡ªåŠ¨è¦†ç›–æ—§æ•°æ®ã€‚è¦†ç›–çš„æ—¶å€™å¯èƒ½ä¼šä¿®æ”¹keyå¯¹åº”valueçš„æ•°æ®ç±»å‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get key1</span><br><span class="line">&quot;value1&quot;</span><br><span class="line">127.0.0.1:6379&gt; set key1 value11</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get key1</span><br><span class="line">&quot;value11&quot;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ éœ€è¦è®¾ç½®çš„å­—ç¬¦ä¸²ä¸­æœ‰å¼•å·ï¼Œå¯ä»¥ç”¨<code>\</code>è¿›è¡Œè½¬ä¹‰ï¼Œä½†è¿˜å¿…é¡»åœ¨å¤–éƒ¨å†å¥—ä¸€ä¸ªå¼•å·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set k &quot;10&quot;</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get k</span><br><span class="line">10</span><br><span class="line">127.0.0.1:6379&gt; set k \&quot;10\&quot;</span><br><span class="line">Invalid argument(s)</span><br><span class="line">127.0.0.1:6379&gt; set k &quot;\&quot;10\&quot;&quot;</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get k</span><br><span class="line">&quot;10&quot;</span><br><span class="line">127.0.0.1:6379&gt; object encoding k</span><br><span class="line">embstr</span><br></pre></td></tr></table></figure><h2 id="è¿›é˜¶é€‰é¡¹"><a href="#è¿›é˜¶é€‰é¡¹" class="headerlink" title="è¿›é˜¶é€‰é¡¹"></a>è¿›é˜¶é€‰é¡¹</h2><p>setå‘½ä»¤è¿˜æœ‰ä¸€äº›é¢å¤–çš„é€‰é¡¹å¯ä¾›é€‰æ‹©ï¼Œå…·ä½“å‚è€ƒå®˜ç½‘æ–‡æ¡£ <a href="https://redis.io/commands/set/">SET | Redis</a>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SET key value [NX | XX] [GET] [EX seconds | PX milliseconds |</span><br><span class="line">  EXAT unix-time-seconds | PXAT unix-time-milliseconds | KEEPTTL]</span><br></pre></td></tr></table></figure><p>åœ¨Rediså®˜ç½‘ä¸Šï¼Œ<code>[]</code>ä»£è¡¨å¯é€‰å‘½ä»¤å‚æ•°ï¼Œ<code>|</code>å¯ä»¥ç†è§£ä¸ºâ€œæˆ–â€ï¼Œä»£è¡¨æ¯ä¸ªå¯é€‰å‘½ä»¤å‚æ•°ä¸­çš„ä¸åŒè®¾ç½®å€¼ï¼›æ¯ä¸ª<code>[]</code>ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œå¯ä»¥åŒæ—¶å­˜åœ¨ã€‚å¦‚ä¸‹æ˜¯å¯¹setå‘½ä»¤é€‰é¡¹çš„è¯´æ˜ï¼š</p><ul><li>NXï¼šåªæœ‰keyä¸å­˜åœ¨çš„æ—¶å€™æ‰èƒ½setæˆåŠŸ;</li><li>XXï¼šåªæœ‰keyå­˜åœ¨çš„æ—¶å€™æ‰èƒ½setæˆåŠŸ;</li><li>GETï¼šå¦‚æœkeyå·²å­˜åœ¨ï¼Œè¿”å›æ—§å€¼ï¼›å¦‚æœkeyä¸å­˜åœ¨è¿”å›nilï¼ˆç©ºï¼‰ï¼›å¦‚æœkeyå­˜åœ¨ä½†æ˜¯valueä¸æ˜¯stringï¼Œåˆ™æœ¬æ¬¡setæ“ä½œä¼šè¿”å›é”™è¯¯å¹¶ç»ˆæ­¢ï¼›</li><li>EX&#x2F;PXï¼šsetçš„æ—¶å€™æŒ‡å®šå½“å‰keyçš„è¿‡æœŸæ—¶é—´ï¼Œè¿‡æœŸæ—¶é—´åˆ°äº†ä¼šè‡ªåŠ¨è¢«åˆ é™¤ï¼ŒEXçš„å•ä½æ˜¯ç§’ï¼ŒPXçš„å•ä½æ˜¯æ¯«ç§’ï¼ˆç±»ä¼¼<code>sleep_for</code>ï¼‰ï¼›</li><li>EXAT&#x2F;PXATï¼šæŒ‡å®šè¿‡æœŸæ—¶é—´æˆ³ï¼Œå³å½“å‰æ—¶é—´åˆ°<strong>æŒ‡å®šæ—¶é—´æˆ³</strong>åkeyå€¼è¿‡æœŸã€‚EXATæ˜¯ç§’çº§æ—¶é—´æˆ³ï¼ŒPXATæ˜¯æ¯«ç§’çº§æ—¶é—´æˆ³ï¼ˆç±»ä¼¼<code>sleep_until</code>ï¼‰ï¼›</li><li>KEEPTTLï¼šå¦‚æœkeyå€¼å·²å­˜åœ¨ä¸”æœ‰è¿‡æœŸæ—¶é—´ï¼Œä½¿ç”¨KEEPTTLæ›´æ–°å½“å‰keyçš„æ—¶å€™ä¼šé‡ç½®è¿‡æœŸæ—¶é—´è®¡æ•°å™¨ã€‚ä¸¾ä¾‹ï¼šAçš„è¿‡æœŸæ—¶é—´æ˜¯100ç§’ï¼Œæˆ‘åœ¨Aè®¾ç½®å60ç§’åˆæ›´æ–°äº†Aï¼Œæ­¤æ—¶æ–°çš„Açš„è¿‡æœŸè®¡æ—¶å™¨ä¼šç»§æ‰¿åŸæœ‰æ—¶é—´ï¼Œå³ä¸º40ç§’åè¿‡æœŸã€‚å¦‚æœä¸æŒ‡å®šKEEPTTLé€‰é¡¹ï¼Œåˆ™ä¼šè¢«é‡ç½®ä¸ºRedisçš„é»˜è®¤TTLï¼ˆå¦‚æœæ²¡æœ‰é…ç½®ï¼Œé»˜è®¤æ˜¯æ°¸ä¸è¿‡æœŸï¼‰ã€‚</li></ul><p>æ³¨æ„ï¼Œä¸€äº›é€‰é¡¹æ˜¯é«˜ç‰ˆæœ¬ä¸­æ‰è¢«æ”¯æŒçš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Starting with Redis version 2.6.12: Added the EX, PX, NX and XX options.</span><br><span class="line">Starting with Redis version 6.0.0: Added the KEEPTTL option.</span><br><span class="line">Starting with Redis version 6.2.0: Added the GET, EXAT and PXAT option.</span><br><span class="line">Starting with Redis version 7.0.0: Allowed the NX and GET options to be used together.</span><br></pre></td></tr></table></figure><h3 id="NXå’ŒXX"><a href="#NXå’ŒXX" class="headerlink" title="NXå’ŒXX"></a>NXå’ŒXX</h3><p>NXæ˜¯keyå€¼ä¸å­˜åœ¨æ‰èƒ½æ­£å¸¸è¢«è®¾ç½®ï¼ŒXXæ˜¯keyå€¼å­˜åœ¨æ‰èƒ½è¢«æ­£å¸¸è®¾ç½®ã€‚å¦‚æœæ²¡æœ‰è¢«setæˆåŠŸï¼Œåˆ™ä¼šè¿”å›<code>nil</code>ï¼ŒsetæˆåŠŸè¿”å›çš„æ˜¯OKã€‚</p><p>å¦‚ä¸‹æ‰€ç¤ºï¼Œaé”®å€¼ä¸å­˜åœ¨æ—¶ï¼Œnxè®¾ç½®aæˆåŠŸè¿”å›OKã€‚å†æ¬¡ç”¨nxå°è¯•è®¾ç½®ï¼Œå› ä¸ºæ­¤æ—¶aå·²ç»å­˜åœ¨ï¼Œä¸ç¬¦åˆnxçš„ç­–ç•¥ï¼Œè®¾ç½®å¤±è´¥ï¼Œè¿”å›<code>nil</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set a test1 nx</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set a test1 nx</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨xxæµ‹è¯•ï¼Œå› ä¸ºaå­˜åœ¨ï¼Œæ‰€ä»¥è®¾ç½®æˆåŠŸã€‚è€Œbä¸å­˜åœ¨ï¼Œè®¾ç½®å¤±è´¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set a test2 xx</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set b test1 xx</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure><h3 id="KEEPTTL"><a href="#KEEPTTL" class="headerlink" title="KEEPTTL"></a>KEEPTTL</h3><p>å¯¹KEEPTTLæ¥åšä¸ªæµ‹è¯•ï¼Œä¸ºäº†æ›´å¥½çš„å±•ç¤ºæ•ˆæœï¼ŒæŠŠä¸€ä¸ªå§‹ç»ˆæ‘†åœ¨ç»ˆç«¯æ—è¾¹ã€‚</p><p>æˆ‘åœ¨19ç§’çš„æ—¶å€™æ‰§è¡Œäº†å‘½ä»¤<code>set a test ex 20</code>ï¼Œå³é”®å€¼aä¼šåœ¨20ç§’åè¿‡æœŸã€‚å¦‚åŒé¢„æœŸï¼Œåœ¨39ç§’å·¦å³ï¼Œaçš„é”®å€¼æ— æ³•è¢«getäº†ï¼ˆæˆªå›¾è½åäº†ä¸€äº›ï¼‰</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/00c937e7e04b4440fea45f4dd7a2a638.png" alt="image.png"></p><p>å°è¯•åœ¨è¿™20ç§’ä¸­é‡æ–°ç»™aè®¾ç½®ä¸€ä¸ªæ–°çš„å€¼ï¼ŒåŒæ—¶ä¸æºå¸¦KEEPTTLé€‰é¡¹ã€‚ä¼šå‘ç°é‡æ–°è®¾ç½®åçš„keyæ²¡æœ‰ç»§æ‰¿åŸæœ‰çš„è¿‡æœŸæ—¶é—´ï¼Œè€Œæ˜¯<strong>ä¸è¿‡æœŸ</strong>äº†ï¼ˆRedisçš„é»˜è®¤ç­–ç•¥å°±æ˜¯æ°¸ä¸è¿‡æœŸï¼‰</p><p>å¦‚æœæºå¸¦äº†KEEPTTLé€‰é¡¹ï¼Œåˆ™aè¿˜æ˜¯ä¼šåœ¨20ç§’åè¿‡æœŸã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/eb367ae0e3b2730146a4ef800c92274a.png" alt="image.png"></p><p>ä½¿ç”¨TTLå‘½ä»¤å¯ä»¥çœ‹çš„æ›´ç›´è§‚ä¸€ç‚¹ï¼ˆå…³äºTTLå‘½ä»¤çš„ä»‹ç»å‚è€ƒåæ–‡ï¼‰ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨KEEPTTLè®¾ç½®äº†aåï¼Œå®ƒçš„è¿‡æœŸæ—¶é—´è¿˜æ˜¯ç»§æ‰¿äº†åŸæœ¬çš„10ç§’ï¼Œéšåè¢«è¿‡æœŸåˆ é™¤ï¼ŒTTLæ˜¾ç¤º<code>-2</code>ä»£è¡¨é”®å€¼ä¸å­˜åœ¨ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set a t1 ex 10</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; ttl a</span><br><span class="line">(integer) 8</span><br><span class="line">127.0.0.1:6379&gt; set a t2 keepttl</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; ttl a</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; get a</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; ttl a</span><br><span class="line">(integer) -2</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸ä½¿ç”¨KEEPTTLé€‰é¡¹ï¼Œåˆ™è¿‡æœŸæ—¶é—´ä¼šå˜æˆ<code>-1</code>ä»£è¡¨æ°¸ä¸è¿‡æœŸã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set a t1 ex 10</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get a</span><br><span class="line">&quot;t1&quot;</span><br><span class="line">127.0.0.1:6379&gt; ttl a</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; set a t2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get a</span><br><span class="line">&quot;t2&quot;</span><br><span class="line">127.0.0.1:6379&gt; ttl a</span><br><span class="line">(integer) -1</span><br></pre></td></tr></table></figure><h2 id="msetå’Œmget"><a href="#msetå’Œmget" class="headerlink" title="msetå’Œmget"></a>msetå’Œmget</h2><p>è¿™ä¸¤ä¸ªå‘½ä»¤æ˜¯set&#x2F;getçš„å˜ä½“ï¼Œå¯ä»¥ç”¨äºåŒæ—¶è®¾ç½®&#x2F;è·å–å¤šä¸ªé”®å€¼çš„æ•°æ®ã€‚è¿™ä¸¤ä¸ªå‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯<code>O(N)</code>ï¼Œå…¶ä¸­Næ˜¯å‘½ä»¤åè·Ÿéšçš„keyçš„ä¸ªæ•°ã€‚</p><p>msetåªèƒ½å•çº¯çš„è®¾ç½®keyå’Œvalueï¼Œæ²¡æœ‰setçš„é¢å¤–çš„å‚æ•°é€‰é¡¹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MSET key value [key value ...]</span><br><span class="line">MGET key [key ...]</span><br></pre></td></tr></table></figure><p>æµ‹è¯•å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; mset key1 t1 key2 t2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; mget key1 key2</span><br><span class="line">t1</span><br><span class="line">t2</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆè¦æä¾›ä¸€ä¸ªè¿™æ ·çš„å‘½ä»¤å‘¢ï¼Ÿè¿˜æ˜¯å…³äºç½‘ç»œè¯·æ±‚æ–¹é¢çš„æ€§èƒ½èŠ‚çœã€‚å¦‚æœæˆ‘çŸ¥é“æˆ‘éœ€è¦ä¸€æ¬¡æ€§è®¾ç½®&#x2F;è·å–å¤§é‡é”®å€¼ï¼Œé‚£å¯ä»¥ä¸€æ¡å‘½ä»¤å†™å®Œçš„ç»å¯¹å¥½è¿‡å¤šæ¬¡è¯·æ±‚RedisæœåŠ¡å™¨ï¼ŒèŠ‚çœäº†å¤šæ¬¡é€šä¿¡çš„ç½‘ç»œå»¶è¿Ÿã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/a31a19e2b651a86213df25325e42d1d9.png" alt="image.png"></p><p>Redisä¼šä¿è¯msetçš„æ‰§è¡Œæ˜¯<strong>åŸå­çš„</strong>ï¼Œä¸ä¼šå‡ºç°msetä¸­çš„å¤šä¸ªé”®å€¼åªè§‚å¯Ÿåˆ°å…¶ä¸­ä¸€ä¸ªè¢«ä¿®æ”¹çš„æƒ…å†µã€‚å®˜ç½‘åŸè¯ï¼šMSET is atomic, so all given keys are set at once. It is not possible for clients to see that some of the keys were updated while others are unchanged.</p><blockquote><p>æ¯”å¦‚æˆ‘msetäº†key1å’Œkey2ï¼Œå®¢æˆ·ç«¯å¯ä»¥è§‚å¯Ÿåˆ°key1å’Œkey2éƒ½è¢«ä¿®æ”¹ï¼Œä¸ä¼šè§‚å¯Ÿåˆ°åªæœ‰key1æˆ–åªæœ‰key2è¢«ä¿®æ”¹äº†çš„æƒ…å†µã€‚</p></blockquote><p>è¿™ä¹Ÿæ˜¯å¾—ç›ŠäºRedisé‡‡ç”¨çš„å•çº¿ç¨‹æ¨¡å‹ï¼Œå®ƒå¿…é¡»å¤„ç†å®Œæ¯•msetçš„æ‰€æœ‰keyåæ‰ä¼šå»å“åº”å…¶ä»–å‘½ä»¤è¯·æ±‚ï¼Œé‚£å®¢æˆ·ç«¯è‡ªç„¶å°±ä¸å¯èƒ½ä¸­æ–­è®¾ç½®å¤šä¸ªkeyçš„è¿‡ç¨‹ï¼Œä¹Ÿè§‚å¯Ÿä¸åˆ°åªæœ‰ä¸€éƒ¨åˆ†keyè¢«ä¿®æ”¹äº†çš„æƒ…å†µã€‚</p><p>ä½†è¿™ä¹Ÿè­¦ç¤ºæˆ‘ä»¬ï¼šå¦‚æœå°è¯•ç”¨msetè®¾ç½®ç‰¹åˆ«å¤§é‡çš„keyï¼Œå¯èƒ½ä¼šé˜»å¡RedisæœåŠ¡å™¨å¯¼è‡´å…¶æ— æ³•å“åº”å…¶ä»–è¯·æ±‚ã€‚</p><h1 id="2-keys"><a href="#2-keys" class="headerlink" title="2.keys"></a>2.keys</h1><p>keyså‘½ä»¤ç”¨äºæŸ¥è¯¢å½“å‰Redisä¸­çš„keyå€¼æœ‰å“ªäº›ï¼Œå¦‚æœåŒ¹é…ä¸ä¸Šåˆ™è¿”å›<code>empty array</code>ã€‚</p><p>å‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼Œ<a href="https://redis.io/commands/keys/">KEYS | Redis</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keys [pattern]</span><br></pre></td></tr></table></figure><p>å…¶ä¸­å‚æ•°patternæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç±»ä¼¼äºæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨æ¥åŒ¹é…Redisä¸­å·²æœ‰çš„keyçš„åç§°ã€‚</p><p>ä¸¾ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œ<code>key*</code>ä»£è¡¨åŒ¹é…ä»¥keyå¼€å¤´çš„æ‰€æœ‰é”®å€¼ï¼Œå¯ä»¥çœ‹åˆ°å½“å‰æˆ‘çš„Redisæœ‰ä¸Šæ–‡setçš„ä¸¤ä¸ªkeyã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; keys key*</span><br><span class="line">1) &quot;key1&quot;</span><br><span class="line">2) &quot;key2&quot;</span><br></pre></td></tr></table></figure><p>patternæ”¯æŒçš„æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">h?llo     matches hello, hallo and hxllo</span><br><span class="line">é—®å·åªåŒ¹é…ä¸€ä¸ªå­—ç¬¦</span><br><span class="line"></span><br><span class="line">h*llo     matches hllo and heeeello</span><br><span class="line">æ˜Ÿå·ä»£è¡¨åŒ¹é…0ä¸ªæˆ–è€…æ— æ•°ä¸ªå­—ç¬¦</span><br><span class="line"></span><br><span class="line">h[ae]llo  matches hello and hallo, but not hillo</span><br><span class="line">åŒ¹é…aæˆ–è€…eè¿™ä¸¤ä¸ªå­—ç¬¦</span><br><span class="line"></span><br><span class="line">h[^e]llo  matches hallo, hbllo, ... but not hello</span><br><span class="line">åŒ¹é…é™¤äº†eä»¥å¤–çš„å…¶ä»–å•ä¸ªå­—ç¬¦</span><br><span class="line"></span><br><span class="line">h[a-b]llo matches hallo and hbllo</span><br><span class="line">åŒ¹é…aåˆ°bè¿™ä¸ªåŒºé—´ä¸­çš„å•ä¸ªå­—ç¬¦</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ éœ€è¦åŒ¹é…çš„å­—ç¬¦ä¸²ä¸­åŒ…å« <code>[</code>ã€<code>]</code>ã€<code>*</code>ã€<code>?</code> è¿™äº›ç‰¹æ®Šå­—ç¬¦ï¼Œå¯ä»¥ç”¨<code>\</code>æ¥è½¬ä¹‰å®ƒä»¬ã€‚</p><p>æ³¨æ„ï¼škeysçš„æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(N)</code>ï¼ˆå…¶é‡‡ç”¨éå†æ–¹å¼æ¥è·å–ç»“æœï¼‰ï¼Œæ‰€ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒçš„å¤§æ•°æ®åº“ä¸­ä¸€èˆ¬éƒ½ç¦æ­¢ä½¿ç”¨keyså‘½ä»¤ï¼Œç‰¹åˆ«æ˜¯<code>keys *</code>å…¨éƒ¨æŸ¥è¯¢ã€‚å› ä¸ºRedisæ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œå¦‚æœç”¨keysçš„æŸ¥è¯¢æŠŠRedisç»™å¼„é˜»å¡äº†ï¼Œå°±æ²¡æœ‰åŠæ³•æä¾›æœåŠ¡ç»™å…¶ä»–é“¾æ¥äº†ã€‚</p><p>åœ¨Redis+MySQLçš„æ¡†æ¶ä¸­ï¼Œå¦‚æœä½¿ç”¨keyså‘½ä»¤å¯¼è‡´Redisé˜»å¡äº†ï¼Œè¯·æ±‚å°±ä¼šç›´æ¥å›æºåˆ°MySQLä¸Šï¼Œå¯¼è‡´MySQLæœåŠ¡å™¨é­å—äº†æ„æ–™ä¹‹å¤–çš„å¤§æ‰¹é‡è¯·æ±‚ï¼Œå®ƒä¹Ÿå®¹æ˜“æŒ‚æ‰ã€‚å¦‚æœRediså’ŒMySQLéƒ½æŒ‚äº†ï¼Œä¸šåŠ¡å°±å®Œè›‹äº†ğŸ¤£ã€‚ </p><h1 id="3-exists"><a href="#3-exists" class="headerlink" title="3.exists"></a>3.exists</h1><h2 id="å‘½ä»¤ä»‹ç»"><a href="#å‘½ä»¤ä»‹ç»" class="headerlink" title="å‘½ä»¤ä»‹ç»"></a>å‘½ä»¤ä»‹ç»</h2><p>åˆ¤æ–­æŸä¸ªkeyæ˜¯å¦å­˜åœ¨ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°å­—ï¼šè¿”å›å‘½ä»¤ä¸­ç»™å‡ºçš„keyä¸­ï¼Œå®é™…å­˜åœ¨çš„keyçš„ä¸ªæ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exists key [key1 key2 ...]</span><br></pre></td></tr></table></figure><p>ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æˆ‘ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ã€‚é‚£ä¹ˆè¿”å›å€¼å°±æ˜¯è¿™ä¸‰ä¸ªkeyä¸­æœ‰å‡ ä¸ªkeyæ˜¯å­˜åœ¨çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exists key1 key2 key3</span><br></pre></td></tr></table></figure><p>existså‘½ä»¤<strong>æ£€æŸ¥ä¸€ä¸ªkey</strong>çš„æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(1)</code>ï¼Œå› ä¸ºRedisåº•å±‚æ˜¯ç”¨å“ˆå¸Œè¡¨æ¥ç®¡ç†keyçš„ã€‚</p><blockquote><p>Time complexity: O(N) where N is the number of keys to check.</p></blockquote><p>Redisçš„å®˜æ–¹æ–‡æ¡£è¯´existså‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(N)</code>ï¼Œä¸è¦è¯¯è§£ï¼Œè¿™é‡Œçš„Næ˜¯å‘½ä»¤ä¸­ç»™å‡ºkeyçš„ä¸ªæ•°ã€‚ç›¸å½“äºæˆ‘ä»¬éœ€è¦æ£€æŸ¥Nä¸ªkeyï¼Œæ¯ä¸ªkeyéƒ½æ˜¯<code>O(1)</code>ï¼Œæœ€ç»ˆçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯<code>O(N)</code>äº†ã€‚</p><blockquote><p>åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œå¦‚æœéœ€è¦æŸ¥è¯¢å¤šä¸ªkeyæ˜¯å¦å­˜åœ¨ï¼Œä¸€æ¡å‘½ä»¤å†™å®Œè‚¯å®šæ¯”å¤šæ¬¡æŸ¥è¯¢æ›´å¥½ã€‚å› ä¸ºæ¯ä¸€æ¬¡æŸ¥è¯¢éƒ½æ¶‰åŠåˆ°äº†<strong>ä¸€æ¬¡ç½‘ç»œè¯·æ±‚å’Œå“åº”</strong>ï¼Œä¸€æ¡å‘½ä»¤æŠŠéœ€è¦æŸ¥è¯¢çš„å¤šä¸ªkeyéƒ½å‘Šè¯‰Redisï¼Œå¾—åˆ°ä¸€ä¸ªè¿”å›ç»“æœæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚è¿™å°±å’ŒMySQLä¸­çš„è¯·æ±‚ä¸€æ ·ï¼Œä¸€æ¡SQLèƒ½è§£å†³çš„äº‹æƒ…åˆ†æˆä¸¤ä¸ªSQLå°±ä¼šå› ä¸ºç½‘ç»œé€šä¿¡è€Œå¢åŠ å»¶è¿Ÿï¼</p><p>Redisä¸­çš„å¤§éƒ¨åˆ†å‘½ä»¤éƒ½æ”¯æŒä¸€æ¬¡æ€§ç»™å®šå¤šä¸ªkeyï¼Œå°±æ˜¯ä¸ºäº†å‡å°‘ç½‘ç»œé€šä¿¡å¸¦æ¥çš„å½±å“ã€‚</p></blockquote><p>å½“ç„¶ï¼Œexistså‘½ä»¤çš„è¿”å›ç»“æœå¹¶æ²¡æœ‰åŠæ³•è®©æˆ‘ä»¬çŸ¥é“ç»™å‡ºçš„keyä¸­åˆ°åº•æ˜¯å“ªä¸€ä¸ªä¸å­˜åœ¨ï¼Œè¿™æ˜¯è¦çœ‹å…·ä½“ä¸šåŠ¡æ¥ç¡®å®šçš„ã€‚</p><h2 id="å‘½ä»¤æµ‹è¯•"><a href="#å‘½ä»¤æµ‹è¯•" class="headerlink" title="å‘½ä»¤æµ‹è¯•"></a>å‘½ä»¤æµ‹è¯•</h2><p>å®é™…æµ‹è¯•å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; exists key1 key2</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; exists key1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; exists key</span><br><span class="line">(integer) 0</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œexistsåœ¨æ£€æŸ¥æŸä¸ªkeyæ˜¯å¦å­˜åœ¨çš„æ—¶å€™å¹¶ä¸ä¼šè¿›è¡Œå»é‡æ“ä½œï¼Œå¦‚æœä½ å°è¯•æ£€æŸ¥ä¸¤ä¸ªç›¸åŒçš„keyï¼Œè¿”å›ç»“æœä¹Ÿæ˜¯2ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; exists key1 key1</span><br><span class="line">(integer) 2</span><br></pre></td></tr></table></figure><h1 id="4-del"><a href="#4-del" class="headerlink" title="4.del"></a>4.del</h1><p>ç”¨äºåˆ é™¤æŒ‡å®škeyï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œç»™å®škeyä¸­è¢«æˆåŠŸåˆ é™¤çš„ä¸ªæ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">del key [key1 key2 ...]</span><br></pre></td></tr></table></figure><p>åˆ é™¤å•ä¸ªkeyçš„æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(1)</code>ï¼Œå¤šä¸ªæ˜¯<code>O(N)</code>ï¼›</p><h1 id="5-expire-x2F-pexpire"><a href="#5-expire-x2F-pexpire" class="headerlink" title="5.expire&#x2F;pexpire"></a>5.expire&#x2F;pexpire</h1><p>ç”¨äºç»™æŸä¸ªkeyè®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆæ—¶é—´åˆ°äº†ä¹‹åè‡ªåŠ¨è¢«åˆ é™¤ï¼‰å…¶ä¸­expireçš„å•ä½æ˜¯ç§’ï¼Œpexpireçš„å•ä½æ˜¯æ¯«ç§’ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">expire key second</span><br><span class="line">pexpire key millisecond</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªåŠŸèƒ½éå¸¸æœ‰ç”¨ï¼Œåœ¨å¾ˆå¤šå¹³å°ä¸Šæˆ‘ä»¬éƒ½ä½¿ç”¨è¿‡éªŒè¯ç ï¼Œä¸ºäº†ä¿è¯ä¸€å®šçš„å®‰å…¨æ€§ï¼ŒéªŒè¯ç éƒ½è¢«è®¾è®¡ä¸ºæœ‰è¿‡æœŸæ—¶é—´çš„ã€‚è¿™æ ·ç³»ç»Ÿç”Ÿæˆä¸€ä¸ªéªŒè¯ç åï¼Œå¯ä»¥å°†å…¶setè¿›å…¥Redisï¼Œç„¶åä½¿ç”¨expireå‘½ä»¤ç»™éªŒè¯ç è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆå…¶å®setå‘½ä»¤é‡Œé¢å°±æœ‰é€‰é¡¹å¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´äº†ï¼Œè¿™é‡Œåªæ˜¯ä¸¾ä¸ªä¾‹å­ï¼‰ã€‚è¿˜æœ‰é™æ—¶ä¼˜æƒ åˆ¸ã€é™æ—¶VIPä½“éªŒåˆ¸ç­‰ç­‰â€¦â€¦</p><p>å¦‚æœä¸ä½¿ç”¨Redisçš„expireåŠŸèƒ½ï¼Œå°±éœ€è¦åœ¨åº”ç”¨å±‚ç”šè‡³æ•°æ®åº“ä¸­è®¾è®¡è¿‡æœŸæ“ä½œï¼Œç›¸å¯¹æ¥è¯´å°±æœ‰äº›éº»çƒ¦äº†ã€‚</p><p>è¿˜æœ‰å¦å¤–ä¸€ä¸ªåœºæ™¯ï¼Œæ˜¯åŸºäºRediså®ç°åˆ†å¸ƒå¼é”ï¼šå³åœ¨åˆ†å¸ƒå¼é›†ç¾¤ä¸­å®ç°é”ï¼Œä»¥å®ç°åŒæ­¥&#x2F;äº’æ–¥åŠŸèƒ½ã€‚</p><ul><li>åŠ é”ï¼šè®¾ç½®ä¸€ä¸ªç‰¹æ®Šçš„keyï¼Œå¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼›</li><li>è§£é”ï¼šåˆ é™¤è¯¥keyï¼›</li><li>åˆ¤æ–­æ˜¯å¦æœ‰äººå ç”¨ï¼šexistsåˆ¤æ–­keyå­˜åœ¨åˆ™ä»£è¡¨æœ‰äººå·²ç»ç”³è¯·äº†é”ï¼Œéœ€è¦ç­‰å¾…åˆ°keyä¸å­˜åœ¨çš„æ—¶å€™ï¼Œåˆ™ä»£è¡¨é”å·²ç»è¢«é‡Šæ”¾ã€‚</li><li>å¯ä»¥åœ¨setçš„æ—¶å€™ä½¿ç”¨NXé€‰é¡¹ï¼Œä¿è¯åªæœ‰keyå€¼ä¸å­˜åœ¨çš„æ—¶å€™æ‰èƒ½è®¾ç½®ä¸Škeyï¼ˆå³åªæœ‰é”æ²¡æœ‰è¢«è·å–çš„æ—¶å€™æ‰èƒ½åŠ é”ï¼‰ï¼›</li><li>å› ä¸ºRedisæ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œæ‰€ä»¥setä»¥åŠexistsçš„æ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œä¸ä¼šå‡ºç°å¹¶å‘è®¿é—®çš„é—®é¢˜ã€‚</li></ul><p>æ­¤æ—¶ä¸ºäº†<strong>é¿å…ç”³è¯·é”çš„åº”ç”¨æœåŠ¡å™¨æ— æ³•æ­£å¸¸è§£é”</strong>ï¼ˆæ¯”å¦‚ç”³è¯·äº†é”çš„æœåŠ¡å™¨çªç„¶æŒ‚æ‰äº†ï¼‰ï¼Œéƒ½ä¼šç»™é”ä¸Šä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œé¿å…æ•´ä¸ªç³»ç»Ÿé™·å…¥æ­»é”çŠ¶æ€ã€‚è¿™ä¸ªè¿‡æœŸæ—¶é—´åº”è¯¥ç•¥å¤§äºå½“å‰æœåŠ¡å™¨éœ€è¦è®¿é—®ä¸´ç•Œèµ„æºçš„æ—¶é—´ï¼ˆé¿å…è¿˜æ²¡æœ‰è®¿é—®å®Œæ¯•å°±å› ä¸ºè¶…æ—¶è‡ªåŠ¨è§£é”äº†ï¼‰ã€‚</p><h1 id="6-ttl-x2F-pttl"><a href="#6-ttl-x2F-pttl" class="headerlink" title="6.ttl&#x2F;pttl"></a>6.ttl&#x2F;pttl</h1><p>è¿™ä¸¤ä¸ªå‘½ä»¤å’Œexpire&#x2F;pexpireå¯¹åº”ï¼Œç”¨äºå‘½ä»¤æ˜¾ç¤ºæŸä¸ªé”®å€¼çš„è¿‡æœŸæ—¶é—´è¿˜å‰©ä¸‹å¤šå°‘ï¼Œttlè¿”å›çš„å•ä½æ˜¯ç§’ï¼Œpttlè¿”å›çš„å•ä½æ˜¯æ¯«ç§’ã€‚è¯¥å‘½ä»¤æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(1)</code>ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ttl key</span><br><span class="line">pttl key</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªå‘½ä»¤éƒ½æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„è¿”å›å€¼</p><ul><li><code>-1</code> ä»£è¡¨å½“å‰é”®å€¼æ°¸ä¸è¿‡æœŸï¼›</li><li><code>-2</code> ä»£è¡¨å½“å‰é”®å€¼ä¸å­˜åœ¨ï¼›</li></ul><blockquote><p>Starting with Redis version 2.8.0: Added the -2 reply.</p></blockquote><h2 id="Redisçš„è¿‡æœŸç­–ç•¥"><a href="#Redisçš„è¿‡æœŸç­–ç•¥" class="headerlink" title="Redisçš„è¿‡æœŸç­–ç•¥"></a>Redisçš„è¿‡æœŸç­–ç•¥</h2><p>Redisæ˜¯æ€ä¹ˆçŸ¥é“ä¸€ä¸ªkeyæ˜¯å¦è¿‡æœŸéœ€è¦è¢«åˆ é™¤å‘¢ï¼Ÿ</p><p>ç›´æ¥éå†è‚¯å®šä¸è¡Œï¼Œå½“åº“å¾ˆå¤§çš„æ—¶å€™ï¼Œéå†ä¸€æ¬¡çš„æ—¶é—´éƒ½å¤Ÿå–ä¸€å£¶äº†ï¼Œå®Œå…¨è¾¾ä¸åˆ°è¿‡æœŸæ—¶é—´çš„è¦æ±‚ã€‚</p><p>Redisé‡‡ç”¨äº†å®šæ—¶åˆ é™¤+æƒ°æ€§åˆ é™¤ç­–ç•¥çš„ç»“åˆï¼š</p><ul><li>å®šæ—¶åˆ é™¤ï¼šRediså®šæ—¶ï¼ˆé»˜è®¤100msæ£€æŸ¥ä¸€æ¬¡ï¼‰<strong>æŠ½å–ä¸€éƒ¨åˆ†</strong>keyæ£€æŸ¥TTLè¿‡æœŸæ—¶é—´ï¼Œå¹¶å°†è¿‡æœŸçš„keyåˆ é™¤ã€‚å› ä¸ºåªæŠ½å–ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥æ£€æŸ¥çš„è€—æ—¶çŸ­ï¼›</li><li>æƒ°æ€§åˆ é™¤ï¼šç”¨æˆ·è¯·æ±‚æŸä¸ªkeyçš„æ—¶å€™æ£€æŸ¥TTLè¿‡æœŸæ—¶é—´ï¼Œè¿‡æœŸçš„keyè¢«åˆ é™¤ï¼Œä¸ä¼šè¿”å›ç»™ç”¨æˆ·ï¼›</li></ul><p>è¿™ä¸¤ä¸ªæ“ä½œè™½ç„¶ç»´æŒäº†æ€§èƒ½ï¼Œä½†å¹¶ä¸èƒ½ä¿è¯è¿‡æœŸé”®ä¸€å®šèƒ½è¢«æ¸…ç†æ‰ã€‚å¦‚æœæŸä¸ªé”®å€¼å¾ˆä¹…æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œä¸”æ²¡æœ‰è¢«Redisçš„å®šæœŸåˆ é™¤ç­–ç•¥æŠ½å–åˆ°ï¼Œå®ƒå°±ä¼šç•™å­˜åœ¨é‚£é‡Œã€‚è¦æƒ³ä¿è¯Redisä¸­ä¸å­˜åœ¨è¿‡æœŸé”®ï¼Œè¿˜éœ€ä½¿ç”¨ä¸€äº›è¾…åŠ©ç­–ç•¥æ¥å¤„ç†ã€‚</p><h2 id="å®šæ—¶å™¨æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ"><a href="#å®šæ—¶å™¨æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="å®šæ—¶å™¨æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ"></a>å®šæ—¶å™¨æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ</h2><blockquote><p>è¿™é‡Œè®°å½•çš„æ˜¯å®ç°ä¸€ä¸ªå®šæ—¶å™¨å¯ä»¥é‡‡å–çš„æ–¹å¼ï¼Œå’ŒRedisé‡‡ç”¨çš„ç­–ç•¥æ— å…³ã€‚</p></blockquote><h3 id="æ–°å»ºçº¿ç¨‹æ¥å®šæ—¶åˆ é™¤"><a href="#æ–°å»ºçº¿ç¨‹æ¥å®šæ—¶åˆ é™¤" class="headerlink" title="æ–°å»ºçº¿ç¨‹æ¥å®šæ—¶åˆ é™¤"></a>æ–°å»ºçº¿ç¨‹æ¥å®šæ—¶åˆ é™¤</h3><p><strong>æ–¹å¼1</strong>ï¼šä½¿ç”¨çº¿ç¨‹æ¥å®ç°å®šæ—¶å™¨ã€‚å½“éœ€è¦å®šæ—¶åˆ é™¤çš„æ—¶å€™ï¼Œå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œä¼‘çœ æŒ‡å®šæ—¶é—´ï¼Œä¼‘çœ ç»“æŸåæ‰§è¡Œåˆ é™¤æ“ä½œã€‚ä½†è¿™ä¼šå¤§å¤§å¢åŠ çº¿ç¨‹æ•°é‡å’Œç³»ç»Ÿè´Ÿè½½ï¼Œæ•ˆç‡ä½ã€‚</p><h3 id="åŸºäºè¿‡æœŸæ—¶é—´çš„ä¼˜å…ˆçº§é˜Ÿåˆ—"><a href="#åŸºäºè¿‡æœŸæ—¶é—´çš„ä¼˜å…ˆçº§é˜Ÿåˆ—" class="headerlink" title="åŸºäºè¿‡æœŸæ—¶é—´çš„ä¼˜å…ˆçº§é˜Ÿåˆ—"></a>åŸºäºè¿‡æœŸæ—¶é—´çš„ä¼˜å…ˆçº§é˜Ÿåˆ—</h3><p><strong>æ–¹å¼2</strong>ï¼šä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ˆä»¥TTLå‰©ä½™æ—¶é—´ä¸ºkeyå€¼ï¼Œå°çš„åœ¨å‰é¢ï¼‰ï¼Œæœ‰è®¾ç½®è¿‡æœŸæ—¶é—´çš„é”®å€¼å°±è¢«æ’å…¥è¯¥é˜Ÿåˆ—ï¼Œé˜Ÿé¦–å…ƒç´ å°±æ˜¯æœ€å¿«è¿‡æœŸçš„é”®å€¼ã€‚é…ç½®äº†ä¼˜å…ˆçº§é˜Ÿåˆ—åï¼Œåªéœ€è¦ä¸€ä¸ªçº¿ç¨‹å»è½®è¯¢æ£€æŸ¥é˜Ÿé¦–æ¥å¤„ç†è¿‡æœŸé”®å€¼å°±è¡Œäº†ã€‚ä½†æ˜¯é¢‘ç¹çš„æ‰«æä¼šå¤§å¤§å¢åŠ CPUè´Ÿæ‹…ã€‚</p><p><strong>æ–¹å¼3</strong>ï¼šåœ¨æ–¹å¼2çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ ä¼‘çœ æœºåˆ¶ï¼Œè®©çº¿ç¨‹æ ¹æ®é˜Ÿé¦–é”®å€¼çš„è¿‡æœŸæ—¶é—´è¿›è¡Œä¼‘çœ ã€‚ä¼‘çœ ç»“æŸååˆ é™¤é˜Ÿé¦–å…ƒç´ ã€‚å¦‚æœæœ‰æ–°çš„é”®å€¼æ’å…¥ï¼Œåˆ™å”¤é†’è¯¥çº¿ç¨‹ï¼Œé‡æ–°æ ¹æ®é˜Ÿé¦–é”®å€¼çš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¼‘çœ æ—¶é—´ã€‚è¿™å¯ä»¥é€šè¿‡æ¡ä»¶å˜é‡çš„<code>wait_for</code>æ¥å£åŠ ä¸Š<code>notify</code>æ¥å£æ¥å®ç°ã€‚</p><h3 id="æ—¶é—´è½®æ–¹æ¡ˆ"><a href="#æ—¶é—´è½®æ–¹æ¡ˆ" class="headerlink" title="æ—¶é—´è½®æ–¹æ¡ˆ"></a>æ—¶é—´è½®æ–¹æ¡ˆ</h3><p><strong>æ–¹å¼4</strong>ï¼šä½¿ç”¨æ—¶é—´è½®æ–¹æ¡ˆï¼Œ<strong>å¦‚ä¸‹è¡¨æ‰€ç¤º</strong>ã€‚å·¦ä¾§ä»£è¡¨ä¸€ä¸ªåŸºäºç°åœ¨çš„æ—¶é—´åç§»é‡ï¼Œæ¯ä¸€ä¸ªæ ¼å­å¯¹åº”çš„100msæ—¶é—´åç§»ï¼Œå³ä¾§æ˜¯ä¸€ä¸ªé“¾è¡¨ã€‚ä»æ•°æ®ç»“æ„æ¥çœ‹å¯ä»¥æ˜¯ä¸€ä¸ªé¡ºåºè¡¨+é“¾è¡¨ã€‚</p><p>æˆ‘ä»¬åªéœ€è¦å°†ttlæ ¹æ®èŒƒå›´æ’å…¥å¯¹åº”çš„æ—¶é—´åç§»é‡éœ€è¦åˆ é™¤çš„keyä¸­ï¼Œçº¿ç¨‹æ¯æ¬¡ä¼‘çœ 100msï¼Œä¼‘çœ ç»“æŸåå°±ä»é“¾è¡¨é‡Œé¢å–èµ°è¿‡æœŸçš„é”®å€¼è¿›è¡Œåˆ é™¤ã€‚</p><table><thead><tr><th>æ—¶é—´åç§»é‡</th><th>éœ€è¦åˆ é™¤çš„keyï¼ˆé“¾è¡¨ï¼‰</th></tr></thead><tbody><tr><td>100ms</td><td>ttlåœ¨<code>[0,100]</code>ä¹‹é—´çš„</td></tr><tr><td>200ms</td><td>ttlåœ¨<code>[101,200]</code>ä¹‹é—´çš„</td></tr><tr><td>300ms</td><td>â€¦</td></tr></tbody></table><p>ä¸¾ä¸ªä¾‹å­ï¼Œç°åœ¨æ˜¯0ç§’ï¼Œ<strong>è¿‡æœŸå¤„ç†çº¿ç¨‹ç”²</strong>å¼€å§‹ä¼‘çœ 100msã€‚æ­¤æ—¶æ¥äº†å‡ ä¸ªæœ‰è¿‡æœŸç­–ç•¥çš„keyï¼Œåˆ†åˆ«æ˜¯50msè¿‡æœŸkey1ã€150msè¿‡æœŸkey2ã€190msè¿‡æœŸkey3ã€210ç§’è¿‡æœŸkey4ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è·å¾—ä¸‹é¢è¿™å¼ é¡ºåºè¡¨+é“¾è¡¨ã€‚</p><table><thead><tr><th>æ—¶é—´åç§»é‡</th><th>éœ€è¦åˆ é™¤çš„keyï¼ˆé“¾è¡¨ï¼‰</th></tr></thead><tbody><tr><td>100ms</td><td>key1</td></tr><tr><td>200ms</td><td>key2,key3</td></tr><tr><td>300ms</td><td>key4</td></tr></tbody></table><p>çº¿ç¨‹ç”²ä¼‘çœ 100msåï¼Œkey1çš„è¿‡æœŸæ—¶é—´å°±å·²ç»åˆ°äº†ï¼ˆæ­¤æ—¶æ—©å·²è¿‡å»äº†50msï¼‰çº¿ç¨‹ç”²å¯ä»¥å°†å…¶åˆ é™¤ï¼Œç„¶åå†ä¼‘çœ 100msåå¤„ç†key2å’Œkey3ï¼Œå†ä¼‘çœ 100mså¤„ç†key4ã€‚</p><p>å½“ç„¶ï¼Œå½“key1è¢«åˆ é™¤åï¼ˆç¬¬ä¸€ä¸ª100mså·²ç»ä¼‘çœ è¿‡äº†ï¼‰ï¼Œè¡¨ä¼šå‡ºç°ä¸‹é¢çš„åç§»ã€‚æ–°æ¥çš„é”®å€¼éƒ½éœ€è¦æ ¹æ®è·ç¦»å½“å‰æ—¶é—´çš„åç§»é‡æ’å…¥åˆ°å¯¹åº”çš„ä½ç½®ã€‚</p><table><thead><tr><th>æ—¶é—´åç§»é‡</th><th>éœ€è¦åˆ é™¤çš„keyï¼ˆé“¾è¡¨ï¼‰</th></tr></thead><tbody><tr><td>100ms</td><td>key2,key3</td></tr><tr><td>200ms</td><td>key4</td></tr></tbody></table><p>å®é™…åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä¸å¯èƒ½è®©è¿™ä¸ªè¡¨æ ¼çš„é•¿åº¦ä¸€ç›´å¢é•¿ä¸‹å»ï¼Œå¦åˆ™æ¥ä¸ª30000ms(30s)æ‰è¿‡æœŸçš„keyï¼Œ<strong>å°±éœ€è¦300ä¸ªè¡¨æ ¼ï¼ˆå·¦ä¾§é¡ºåºè¡¨ï¼‰çš„ç©ºé—´æ‰èƒ½å­˜ä¸‹è¿™ä¸ªéœ€è¦30sæ‰è¿‡æœŸçš„é”®å€¼</strong>ï¼Œè€Œè¿™ä¹‹ä¸­å¯èƒ½æœ‰å¾ˆå¤šè¡¨æ ¼é¡¹æ˜¯ç©ºçš„ï¼ˆæ²¡æœ‰å¯¹åº”çš„è¿‡æœŸé”®å€¼ï¼‰ï¼Œå­˜åœ¨ç©ºé—´æµªè´¹ã€‚</p><p>ä¸ºäº†èŠ‚çœè¿™éƒ¨åˆ†ç©ºé—´ï¼Œè¦é‡‡ç”¨ç±»ä¼¼å“ˆå¸Œæ˜ å°„çš„æ€æƒ³ï¼Œæ¯”å¦‚1050msè¿‡æœŸçš„keyä¹Ÿä¼šè¢«æ’å…¥åˆ°æ—¶é—´åç§»é‡ä¸º100msçš„é“¾è¡¨ä¸­ï¼Œå½“çº¿ç¨‹ä¼‘çœ ç»“æŸåéœ€è¦æ£€æŸ¥é“¾è¡¨ä¸­çš„å€¼çš„è¿‡æœŸæ—¶é—´æ˜¯å¦çœŸçš„åˆ°äº†ï¼Œåˆ°äº†æ‰æ‰§è¡Œåˆ é™¤æ“ä½œã€‚</p><p>å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦æ ¹æ®å…·ä½“ä¼‘çœ æ—¶é—´é—´éš”æ¥ç¡®å®šæ¯æ¬¡åº”è¯¥ä¼‘çœ å¤šä¹…ã€‚å‡è®¾æˆ‘ä»¬çš„keyéƒ½æ˜¯5msåˆ°20mså°±è¿‡æœŸäº†ï¼Œæ­¤æ—¶è®¾ç½®ä¼‘çœ é—´éš”ä¸º100mså°±ä¸å¤ªåˆç†äº†ã€‚</p><h1 id="7-type"><a href="#7-type" class="headerlink" title="7.type"></a>7.type</h1><p>è¯¥å‘½ä»¤è¿”å›keyå¯¹åº”valueçš„ç±»å‹ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º<code>O(1)</code>ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type key</span><br></pre></td></tr></table></figure><p>è¿”å›å€¼å¯ä»¥æ˜¯ string, list, set, zset, hash and stream. å¦‚æœkeyä¸å­˜åœ¨åˆ™è¿”å›noneï¼ˆæ³¨æ„è¿”å›çš„ä¸æ˜¯nilï¼‰ã€‚</p><p>åœ¨Rediså®˜ç½‘æ–‡æ¡£ä¸­å¯ä»¥çœ‹åˆ°æ¯ä¸ªæ•°æ®ç±»å‹å¯¹åº”çš„æ•°æ®ç»“æ„ï¼š<a href="https://redis.io/docs/data-types/#core">Understand Redis data types | Redis</a>ï¼Œå…¶ä¸­å½“redisä½œä¸º<strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>æ—¶ç±»å‹ä¸ºstreamã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; type key1</span><br><span class="line">string</span><br><span class="line">127.0.0.1:6379&gt; lpush mylist 1 2</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; type mylist</span><br><span class="line">list</span><br></pre></td></tr></table></figure><h1 id="8-object-encoding-å˜é‡ç¼–ç ç±»å‹"><a href="#8-object-encoding-å˜é‡ç¼–ç ç±»å‹" class="headerlink" title="8.object encoding å˜é‡ç¼–ç ç±»å‹"></a>8.object encoding å˜é‡ç¼–ç ç±»å‹</h1><p>Redisæä¾›äº†å¤šç§æ•°æ®ç±»å‹ï¼š<a href="https://redis.io/docs/data-types/">Understand Redis data types | Redis</a></p><p>è¿™äº›ç±»å‹å’Œæˆ‘ä»¬å¸¸è§çš„ç¼–ç¨‹è¯­è¨€ä¸­çš„æ•°æ®ç±»å‹åŸºæœ¬ç±»ä¼¼ï¼Œ<strong>ä½†åº•å±‚å®ç°å°±ä¸ä¸€æ ·äº†</strong>ã€‚</p><p>Redisä¿è¯æä¾›çš„æ•°æ®ç±»å‹ç¬¦åˆè¿™ä¸ªæ•°æ®ç±»å‹åº”è¯¥æœ‰çš„é¢„æœŸï¼Œæ¯”å¦‚hashç±»å‹çš„æ’å…¥å’ŒæŸ¥è¯¢çš„æ•ˆç‡åº”è¯¥æ˜¯<code>O(1)</code>ï¼Œä½†åº•å±‚å¹¶ä¸ä¸€å®šä¸¥æ ¼ä½¿ç”¨å“ˆå¸Œè¡¨æ¥å®ç°ã€‚</p><p>Redisä¼šæ ¹æ®å®é™…åœºæ™¯åŠ¨æ€é€‰æ‹©æ›´åŠ åˆé€‚çš„åº•å±‚æ•°æ®ç»“æ„å®ç°ï¼Œ<strong>æ¥ä¸€å®šç¨‹åº¦çš„æé«˜æ•ˆç‡</strong>ã€‚ä¸€ä¸ªçº¯æ•´æ•°æ•°å­—çš„stringï¼Œç›´æ¥ç”¨æ•°å­—ç±»å‹æ¥å­˜æ”¾ä¼šæ¯”ä½¿ç”¨å­—ç¬¦ä¸²æ¥å­˜æ”¾å ç”¨æ›´å°‘çš„å­˜å‚¨ç©ºé—´ï¼ˆ1å­—èŠ‚å¯ä»¥å­˜æ”¾æ— ç¬¦å·æ•°0åˆ°255ï¼Œä½†255ç”¨å­—ç¬¦ä¸²æ¥å­˜æ”¾éœ€è¦3ä¸ªå­—èŠ‚ï¼‰ã€‚</p><table><thead><tr><th>æ•°æ®ç»“æ„</th><th>å†…éƒ¨ç¼–ç </th></tr></thead><tbody><tr><td>string</td><td>raw(åŸå§‹å­—ç¬¦ä¸²)&#x2F;int&#x2F;embstr(ä¸ºçŸ­å­—ç¬¦ä¸²ä¼˜åŒ–)</td></tr><tr><td>hash</td><td>hashtable(å“ˆå¸Œè¡¨)&#x2F;ziplist(å‹ç¼©åˆ—è¡¨,èŠ‚çœç©ºé—´)</td></tr><tr><td>list</td><td>linkedlist(é“¾è¡¨)&#x2F;ziplist&#x2F;quicklist</td></tr><tr><td>set</td><td>hashtable&#x2F;intset(æ•´å½¢é›†åˆ)</td></tr><tr><td>zset</td><td>skiplist(è·³è¡¨)&#x2F;ziplist</td></tr></tbody></table><p>ziplistæ˜¯ç”¨æ¥å­˜æ”¾å°åˆ—è¡¨çš„ç¼–ç æ–¹å¼ï¼Œä½¿ç”¨å®ƒç›¸æ¯”ç›´æ¥ä½¿ç”¨é“¾è¡¨æˆ–å“ˆå¸Œè¡¨èƒ½èŠ‚çœç©ºé—´å ç”¨ã€‚å½“Redisä¸­æœ‰å¾ˆå¤šä¸ªå¾ˆå°çš„listå’Œhashçš„æ—¶å€™ï¼Œziplistå°±èƒ½è¾…åŠ©èŠ‚çœå¾ˆå¯è§‚çš„å†…å­˜ç©ºé—´äº†ã€‚å…·ä½“å¯ä»¥å‚è€ƒï¼š<a href="https://blog.csdn.net/qq_31387317/article/details/94578370">Redis ziplist(å‹ç¼©åˆ—è¡¨) CSDNåšå®¢</a></p><p>åœ¨Redisä¸­å¯ä»¥ä½¿ç”¨object encodingå‘½ä»¤æ¥æŸ¥çœ‹ä¸€ä¸ªé”®å€¼åº•å±‚å®é™…çš„ç¼–ç æ–¹å¼æ˜¯ä»€ä¹ˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">object encoding key</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæ¯”è¾ƒçŸ­çš„å­—ç¬¦ä¸²æ˜¯embstrï¼Œlistç±»å‹æ˜¯quicketlistï¼Œå…¨æ•°å­—çš„å­—ç¬¦ä¸²æ˜¯intï¼ˆåŒ…æ‹¬è´Ÿæ•´æ•°ä¹Ÿæ˜¯ç”¨intå­˜æ”¾çš„ï¼‰ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; object encoding key1</span><br><span class="line">&quot;embstr&quot;</span><br><span class="line">127.0.0.1:6379&gt; object encoding mylist</span><br><span class="line">&quot;quicklist&quot;</span><br><span class="line">127.0.0.1:6379&gt; set key3 12345</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; object encoding key3</span><br><span class="line">&quot;int&quot;</span><br><span class="line">127.0.0.1:6379&gt; get a </span><br><span class="line">-1</span><br><span class="line">127.0.0.1:6379&gt; object encoding a</span><br><span class="line">int</span><br></pre></td></tr></table></figure><p>Redisä¼šåœ¨é”®å€¼ä¸­æ•°æ®å¢åŠ åˆ°ä¸€å®šé‡çº§åè‡ªåŠ¨åˆ‡æ¢ç¼–ç æ–¹å¼ï¼Œå¯¹äºç”¨æˆ·æ¥è¯´æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦çŸ¥é“è¿™ä¸ªæ€æƒ³å°±è¡Œäº†ã€‚</p><h1 id="9-flushall-åˆ åº“è·‘è·¯"><a href="#9-flushall-åˆ åº“è·‘è·¯" class="headerlink" title="9.flushall åˆ åº“è·‘è·¯"></a>9.flushall åˆ åº“è·‘è·¯</h1><p>MySQLå¯ä»¥åˆ åº“è·‘è·¯ï¼ŒRedisè‡ªç„¶ä¹Ÿå¯ä»¥ã€‚è¿™ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯æ¸…é™¤Redisä¸­çš„<strong>æ‰€æœ‰é”®å€¼</strong>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flushall</span><br></pre></td></tr></table></figure><p>å¦‚æœé‡‡ç”¨Redisä½œä¸ºç¼“å­˜ï¼Œæ¸…ç©ºäº†é—®é¢˜ç›¸å¯¹æ¥è¯´è¿˜æ²¡é‚£ä¹ˆå¤§ï¼Œä½†å¦‚æœæ˜¯ä½œä¸ºæ•°æ®åº“ï¼Œé‚£å°±ç¥ä½ å¥½è¿å§â€¦â€¦</p><p>è¯·ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨è¿™ä¸ªå‘½ä»¤å“¦ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; flushall</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure><h1 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h1><p>ä»¥ä¸Šä¾¿æ˜¯Redisçš„å…¨å±€å‘½ä»¤äº†ï¼ˆæœ€å¸¸ç”¨çš„å‘½ä»¤ï¼‰ï¼Œå…³äºå…¶ä»–æ•°æ®ç±»å‹çš„å‘½ä»¤ä¼šå•ç‹¬èµ·æ–‡è®²è§£ã€‚</p>]]></content>
    
    
    <summary type="html">RedisåŸºæœ¬å‘½ä»¤å­¦ä¹ </summary>
    
    
    
    <category term="ç¼–ç¨‹å­¦ä¹ " scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="Redis" scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/Redis/"/>
    
    
    <category term="Redis" scheme="https://blog.musnow.top/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>ã€Redisã€‘02.Ubuntu22.04å®‰è£…Redis</title>
    <link href="https://blog.musnow.top/posts/269089114/"/>
    <id>https://blog.musnow.top/posts/269089114/</id>
    <published>2024-02-10T06:54:05.000Z</published>
    <updated>2024-02-19T04:42:17.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å®‰è£…å’Œå¯åŠ¨"><a href="#å®‰è£…å’Œå¯åŠ¨" class="headerlink" title="å®‰è£…å’Œå¯åŠ¨"></a>å®‰è£…å’Œå¯åŠ¨</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y redis</span><br></pre></td></tr></table></figure><p>å®‰è£…äº†ä¹‹åä½¿ç”¨å¦‚ä¸‹æ–¹å¼å¯åŠ¨redis</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start redis</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹6379ç«¯å£å·æ˜¯å¦æœ‰è¿›ç¨‹åœ¨ç›‘å¬ï¼Œæœ‰ä»£è¡¨å¯åŠ¨æˆåŠŸäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root:/etc/redis]# systemctl status redis</span><br><span class="line">â— redis-server.service - Advanced key-value store</span><br><span class="line">     Loaded: loaded (/lib/systemd/system/redis-server.service; enabled; vendor preset: enabled)</span><br><span class="line">     Active: active (running) since Sat 2024-02-10 14:45:11 CST; 4min 56s ago</span><br><span class="line">       Docs: http://redis.io/documentation,</span><br><span class="line">             man:redis-server(1)</span><br><span class="line">   Main PID: 1350 (redis-server)</span><br><span class="line">     Status: &quot;Ready to accept connections&quot;</span><br><span class="line">      Tasks: 5 (limit: 9527)</span><br><span class="line">     Memory: 7.5M</span><br><span class="line">     CGroup: /system.slice/redis-server.service</span><br><span class="line">             â””â”€1350 &quot;/usr/bin/redis-server 127.0.0.1:6379&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &gt;</span><br><span class="line"></span><br><span class="line">Feb 10 14:45:11 wsl-ubuntu systemd[1]: Starting Advanced key-value store...</span><br><span class="line">Feb 10 14:45:11 wsl-ubuntu systemd[1]: Started Advanced key-value store.</span><br><span class="line">[root:/etc/redis]# netstat -nltp | grep 6379</span><br><span class="line">tcp        0      0 127.0.0.1:6379          0.0.0.0:*               LISTEN      1350/redis-server 1</span><br><span class="line">tcp6       0      0 ::1:6379                :::*                    LISTEN      1350/redis-server 1</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œå¦‚æœä½ å°è¯•åœ¨å­ç”¨æˆ·é‡Œç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹redisæ˜¯å¦ç»‘å®šæˆåŠŸç«¯å£ï¼Œå¯èƒ½æŸ¥è¯¢ä¸åˆ°ç»“æœã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -nltp | grep redis</span><br></pre></td></tr></table></figure><p>å› ä¸ºåœ¨å­ç”¨æˆ·ä¸­ï¼Œæˆ‘ä»¬çœ‹ä¸åˆ°å½“å‰å ç”¨6379ç«¯å£çš„è¿›ç¨‹åå­—ã€‚åªæœ‰rootç”¨æˆ·èƒ½çœ‹åˆ°ã€‚</p><h1 id="å…è®¸è¿œç¨‹è®¿é—®"><a href="#å…è®¸è¿œç¨‹è®¿é—®" class="headerlink" title="å…è®¸è¿œç¨‹è®¿é—®"></a>å…è®¸è¿œç¨‹è®¿é—®</h1><p>é»˜è®¤æƒ…å†µä¸‹redisç»‘å®šçš„ipæ˜¯127.0.0.1ï¼Œè¿™ä¸ªipåœ°å€åªå…è®¸æœ¬æœºè®¿é—®ï¼Œå³ä½ åªèƒ½åœ¨è¿™å°linuxä¸»æœºä¸Šè®¿é—®è¿™ä¸ªredisã€‚</p><p>å¦‚æœæƒ³å®ç°è¿œç¨‹è®¿é—®ï¼Œæˆ‘ä»¬éœ€è¦å°†ç»‘å®šçš„ipæ”¹æˆ0.0.0.0ï¼Œå¹¶ä¸”å…³é—­è¿œç¨‹è®¿é—®çš„ä¿æŠ¤</p><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆ‡æ¢åˆ°rootç”¨æˆ·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo su - </span><br></pre></td></tr></table></figure><p>è¿›å…¥redisçš„é…ç½®æ–‡ä»¶è·¯å¾„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/redis</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€ä¸ª<code>redis.conf</code>é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹çš„æ˜¯ä¸‹é¢çš„æ¡ç›®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bind 127.0.0.1 ::1</span><br><span class="line">protected-mode yes</span><br></pre></td></tr></table></figure><p>å°†å®ƒä»¬ä¿®æ”¹ä¸ºå¦‚ä¸‹æ‰€ç¤ºï¼Œå³å¯ç”¨äº†rediså…è®¸è¿œç¨‹è®¿é—®çš„æ¨¡å¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bind 0.0.0.0 ::1</span><br><span class="line">protected-mode no</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å®Œæ¯•é…ç½®æ–‡ä»¶åï¼Œé‡å¯æœåŠ¡å™¨å³å¯ç”Ÿæ•ˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart redis</span><br></pre></td></tr></table></figure><h1 id="è¿æ¥redis"><a href="#è¿æ¥redis" class="headerlink" title="è¿æ¥redis"></a>è¿æ¥redis</h1><p>å’ŒMySQLä¸€æ ·ï¼ŒRedisä¹Ÿæ˜¯å®¢æˆ·-æœåŠ¡ç«¯æ¶æ„çš„è½¯ä»¶ã€‚åœ¨Linuxä¸­ï¼Œä½¿ç”¨<code>redis-cli</code>å‘½ä»¤å³å¯ç›´æ¥è¿åˆ°å½“å‰ä¸»æœºçš„redisæœåŠ¡å™¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root:/etc/redis]# redis-cli</span><br><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">PONG</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦é“¾æ¥éæœ¬æœºçš„redisæœåŠ¡å™¨ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h IPåœ°å€ -p ç«¯å£</span><br></pre></td></tr></table></figure><p>å¦‚æœæƒ³è®©redis-cliä¸­å¯ä»¥æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡ï¼Œå¯ä»¥æ·»åŠ <code>--raw</code>é€‰é¡¹ã€‚æ³¨æ„ï¼šä½¿ç”¨è¯¥é€‰é¡¹ä¼šå¯¼è‡´Redisä¸­æ˜¾ç¤ºçš„<code>(nil)</code>å˜æˆç©ºå­—ç¬¦ä¸²ï¼Œææ˜“äº§ç”Ÿè¯¯å¯¼ï¼å¦‚æœä¸æ˜¯ç¡¬æ€§éœ€è¦åœ¨æ§åˆ¶å°ä¸­æ˜¾ç¤ºä¸­æ–‡ï¼Œè¯·ä¸è¦ä½¿ç”¨è¯¥é€‰é¡¹ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --raw</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åƒMySQLä¸€æ ·ä½¿ç”¨Cè¯­è¨€çš„å¼€å‘åŒ…æ¥é“¾æ¥redisï¼Œé‚£æ˜¯åè¯äº†ã€‚</p><h1 id="å‘½ä»¤å­¦ä¹ "><a href="#å‘½ä»¤å­¦ä¹ " class="headerlink" title="å‘½ä»¤å­¦ä¹ "></a>å‘½ä»¤å­¦ä¹ </h1><p>redisçš„å‘½ä»¤å­¦ä¹ å¯ä»¥å‚è€ƒå®˜ç½‘ <a href="https://redis.io/commands/">Commands | Redis</a></p><p>è™½ç„¶æ˜¯è‹±æ–‡æ–‡æ¡£ï¼Œä½†æ˜¯ç…§ç€ç¿»è¯‘è¯»è¯»å·®ä¸å¤šéƒ½èƒ½çœ‹æ˜ç™½æ˜¯æ€ä¹ˆç”¨çš„ã€‚</p>]]></content>
    
    
    <summary type="html">ubuntu22.04ä¸‹å®‰è£…redis</summary>
    
    
    
    <category term="ç¼–ç¨‹å­¦ä¹ " scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="Redis" scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/Redis/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="Redis" scheme="https://blog.musnow.top/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>ã€vscodeã€‘è¿œç¨‹ä¸»æœºå¯èƒ½ä¸ç¬¦åˆglibcå’Œlibstdc++ vscodeæœåŠ¡å™¨çš„å…ˆå†³æ¡ä»¶</title>
    <link href="https://blog.musnow.top/posts/1712214675/"/>
    <id>https://blog.musnow.top/posts/1712214675/</id>
    <published>2024-02-09T01:54:24.000Z</published>
    <updated>2024-02-09T02:37:35.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h1><p>å¦‚å›¾ï¼ŒVSCODE 1.86ç‰ˆæœ¬çªç„¶ä¸æ”¯æŒæˆ‘çš„centos7.6æœåŠ¡å™¨äº†ï¼Œè¿™å¯å’‹åŠ?</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/803920d76095f770c24324cfed769f89.png" alt="image.png"></p><p>ç™¾åº¦äº†ä¸€ä¸‹ï¼Œå®˜ç½‘ä¸Šè¯´æ˜¯centos7ç¼ºå°‘ä¾èµ–é¡¹ï¼Œå·²ç»æ— æ³•è¢«æ”¯æŒã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/c28bde6edd23e6a5285d42485f810f1a.png" alt="image.png"></p><h1 id="å›é€€ç‰ˆæœ¬"><a href="#å›é€€ç‰ˆæœ¬" class="headerlink" title="å›é€€ç‰ˆæœ¬"></a>å›é€€ç‰ˆæœ¬</h1><p>ä¸è¿‡å¹¶ä¸æ˜¯æ²¡æœ‰åŠæ³•è§£å†³ï¼Œå›é€€åˆ°1.85ç‰ˆæœ¬å°±è¡Œäº†ã€‚</p><blockquote><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/Xuuuuuuuuuuu/article/details/135991844">vscodeçš„sshå¿½ç„¶è¿ä¸ä¸ŠæœåŠ¡å™¨ï¼šè¿œç¨‹ä¸»æœºå¯èƒ½ä¸ç¬¦åˆglibcå’Œlibstdc++ VS CodeæœåŠ¡å™¨çš„å…ˆå†³æ¡ä»¶-CSDNåšå®¢</a></p></blockquote><h2 id="å…³é—­è‡ªåŠ¨æ›´æ–°"><a href="#å…³é—­è‡ªåŠ¨æ›´æ–°" class="headerlink" title="å…³é—­è‡ªåŠ¨æ›´æ–°"></a>å…³é—­è‡ªåŠ¨æ›´æ–°</h2><p>å›é€€ä¹‹å‰ï¼Œä½ å…ˆè¦æŠŠvscodeçš„è‡ªåŠ¨æ›´æ–°å…³æ‰ï¼Œä¸ç„¶ä½ å®‰è£…äº†1.85åä¸ç”¨è¿‡10ç§’å°±ä¼šè‡ªåŠ¨æ›´æ–°â€¦â€¦</p><p>åœ¨vscodeçš„è®¾ç½®é‡Œé¢æœç´¢æ›´æ–°ï¼Œç‚¹å‡»å·¦ä¾§çš„<code>åº”ç”¨ç¨‹åº-æ›´æ–°</code>ï¼Œæ‰¾åˆ°æ›´æ–°æ¨¡å¼ï¼Œè®¾ç½®ä¸ºNoneå³å–æ¶ˆè‡ªåŠ¨æ›´æ–°ï¼Œç„¶åå†å»æ‰åå°ä¸‹è½½æ–°ç‰ˆæœ¬çš„å‹¾ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/1169a49b1d503846a31bdedcbc6c02a9.png" alt="image.png"></p><p>ç„¶åå»å¾®è½¯å®˜ç½‘ä¸‹è½½1.85æ—§ç‰ˆæœ¬ï¼Œä½ç½®æ˜¯vscodeå®˜ç½‘çš„updateæ¨¡å—ï¼Œåœ¨æ›´æ–°æ—¥å¿—<code>November 2023 (version 1.85)</code>é‡Œé¢èƒ½æ‰¾åˆ°æ—§ç‰ˆæœ¬ã€‚</p><p><a href="https://code.visualstudio.com/updates/v1_85">Visual Studio Code November 2023</a></p><p>windowsä¸»æœºç‚¹å‡»è¿™ä¸ªx64ä¸‹è½½å°±è¡Œäº†ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/9e57878ba739716326425a3c87c80999.png" alt="image.png"></p><h2 id="å›é€€æ’ä»¶ç‰ˆæœ¬"><a href="#å›é€€æ’ä»¶ç‰ˆæœ¬" class="headerlink" title="å›é€€æ’ä»¶ç‰ˆæœ¬"></a>å›é€€æ’ä»¶ç‰ˆæœ¬</h2><p>å®‰è£…1.85åremote-sshå’Œwslæ’ä»¶éƒ½ä¼šæ˜¾ç¤ºä¸å¯ç”¨ï¼Œä¼šæ˜¯ç°è‰²çŠ¶æ€å¸¦ä¸€ä¸ªçº¢è‰²æ„Ÿå¹å·ã€‚</p><p>ç‚¹å‡»æ’ä»¶æ—è¾¹çš„é½¿è½®ï¼Œé€‰æ‹©å®‰è£…å¦å¤–ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®‰è£…4ä¸ªæœˆå‰çš„ç‰ˆæœ¬å°±è¡Œäº†ã€‚</p><ul><li>wslæ’ä»¶ï¼š0.81.8</li><li>remote-sshæ’ä»¶ï¼š0.107.0</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/4f8240bb5ab45cddbfecca7473b5a10e.png" alt="image.png"></p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/114aa6786aa0fe8fac26cd5ec48e92d4.png" alt="image.png"></p><h1 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h1><p>å®‰è£…å®Œæ¯•è¿™ä¸¤ä¸ªæ—§ç‰ˆæœ¬æ’ä»¶åï¼Œå°±èƒ½è¿ä¸Šcentos7.6çš„æœåŠ¡å™¨äº†ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/2945ac9e10cbee3fcfd0a2e2f398c048.png" alt="image.png"></p>]]></content>
    
    
    <summary type="html">è¿œç¨‹ä¸»æœºå¯èƒ½ä¸ç¬¦åˆglibcå’Œlibstdc++ vscodeæœåŠ¡å™¨çš„å…ˆå†³æ¡ä»¶çš„è§£å†³åŠæ³•</summary>
    
    
    
    <category term="å·®ç”Ÿæ–‡å…·å¤š" scheme="https://blog.musnow.top/categories/%E5%B7%AE%E7%94%9F%E6%96%87%E5%85%B7%E5%A4%9A/"/>
    
    <category term="ç¼–ç¨‹å·¥å…·" scheme="https://blog.musnow.top/categories/%E5%B7%AE%E7%94%9F%E6%96%87%E5%85%B7%E5%A4%9A/%E7%BC%96%E7%A8%8B%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="vscode" scheme="https://blog.musnow.top/tags/vscode/"/>
    
  </entry>
  
  <entry>
    <title>ã€Redisã€‘01.åˆæ­¥è®¤è¯†Rediså’Œåˆ†å¸ƒå¼ç³»ç»Ÿ</title>
    <link href="https://blog.musnow.top/posts/996575798/"/>
    <id>https://blog.musnow.top/posts/996575798/</id>
    <published>2024-02-08T05:02:41.000Z</published>
    <updated>2024-02-14T11:21:14.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-ä»€ä¹ˆæ˜¯Redis"><a href="#1-ä»€ä¹ˆæ˜¯Redis" class="headerlink" title="1.ä»€ä¹ˆæ˜¯Redis"></a>1.ä»€ä¹ˆæ˜¯Redis</h1><h2 id="1-1-ç®€ä»‹"><a href="#1-1-ç®€ä»‹" class="headerlink" title="1.1 ç®€ä»‹"></a>1.1 ç®€ä»‹</h2><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/903cf874bef24f120d4a6f89d6f08868.png" alt="image.png"></p><p>Redisæ˜¯ä¸€ä¸ªå¼€æºçš„ï¼ŒåŸºäºé”®å€¼å¯¹key-valueçš„NoSQLæ•°æ®åº“ã€‚Rediså†…éƒ¨å­˜æ”¾çš„å€¼å¯ä»¥æ˜¯stringã€hashã€listã€setã€zsetã€bitmapsã€GEOç­‰å¤šç§æ•°æ®ç»“æ„æˆ–ç®—æ³•ï¼›é™¤äº†æ•°æ®å­˜æ”¾ï¼ŒRedisè¿˜æä¾›äº†é”®å€¼è¿‡æœŸã€è®¢é˜…å‘å¸ƒã€äº‹åŠ¡ã€æµæ°´çº¿ã€Luaè„šæœ¬ç­‰é™„åŠ åŠŸèƒ½ï¼Œå› æ­¤Redisèƒ½æ»¡è¶³å¾ˆå¤šåº”ç”¨åœºæ™¯ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/a26a91dc01fb2d631e4199609132f374.png" alt="image.png"></p><p>Redisä¼šå°†æ•°æ®å­˜æ”¾åœ¨<strong>å†…å­˜</strong>ä¸­ï¼Œæ‰€ä»¥Redisçš„æ£€ç´¢é€Ÿç‡éå¸¸å¿«ï¼ˆæˆ–è€…è¯´IOååé«˜ï¼‰ã€‚åŒæ—¶ï¼Œä¸ºäº†ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼ŒRedisä¼šå°†å†…å­˜ä¸­çš„æ•°æ®ç”¨å¿«ç…§æˆ–è€…æ—¥å¿—çš„æ–¹å¼å­˜åœ¨ç¡¬ç›˜ä¸Šï¼Œå®ç°ä¸€å®šç¨‹åº¦ä¸Šçš„æ•°æ®æŒä¹…åŒ–ã€‚</p><h2 id="1-2-ä»€ä¹ˆæ—¶å€™ç”¨Redisï¼Ÿ"><a href="#1-2-ä»€ä¹ˆæ—¶å€™ç”¨Redisï¼Ÿ" class="headerlink" title="1.2 ä»€ä¹ˆæ—¶å€™ç”¨Redisï¼Ÿ"></a>1.2 ä»€ä¹ˆæ—¶å€™ç”¨Redisï¼Ÿ</h2><p>åœ¨ç¼–ç¨‹è¯­è¨€ä¸­å®šä¹‰å˜é‡ï¼Œä¹Ÿæ˜¯å°†æ•°æ®å­˜æ”¾åœ¨å†…å­˜ä¸­ã€‚Redisçš„ä¼˜åŠ¿æ˜¯åœ¨åˆ†å¸ƒå¼é›†ç¾¤ç³»ç»Ÿä¸­ï¼Œè€Œå•æœºï¼ˆå•è¿›ç¨‹ï¼‰ç¨‹åºé‡Œé¢ï¼Œç›´æ¥åœ¨ç¼–ç¨‹è¯­è¨€ä¸­å®šä¹‰å˜é‡&#x2F;æ•°æ®ç»“æ„æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼ˆRedisçš„å¿«åªæ˜¯ç›¸å¯¹äºMySQLè¿™ç±»æ•°æ®åº“è€Œè¨€çš„ï¼‰ã€‚</p><ul><li>å¦‚æœæœªæ¥éœ€è¦å¼•å…¥åˆ†å¸ƒå¼æ¶æ„ï¼Œä½¿ç”¨Redisæ˜¯ä¸€ä¸ªå¥½é€‰æ‹©ã€‚å¦åˆ™æ²¡æœ‰å¿…è¦ã€‚</li></ul><p>å¦‚æœä¸€ä¸ªç³»ç»Ÿéœ€è¦æ¶‰åŠåˆ°å¤šä¸ªå˜é‡ã€å¤šå°ä¸»æœºæ—¶ï¼ŒRediså°±èƒ½èµ·ä½œç”¨äº†ã€‚å®ƒåŸºäºTCPï¼Œå¯ä»¥å°†è‡ªå·±å†…å­˜ä¸­çš„å˜é‡åˆ†äº«ç»™å¤šä¸ªè¿›ç¨‹ã€å¤šä¸ªä¸»æœºæ¥è®¿é—®ï¼Œè¿™æ ·åˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´å°±èƒ½è¿›è¡Œ<strong>æ•°æ®åŒæ­¥</strong>äº†ã€‚</p><p>åˆå› ä¸ºRedisæ˜¯åœ¨å†…å­˜ä¸­å­˜æ”¾ï¼Œæ‰€ä»¥å®ƒçš„æ£€ç´¢é€Ÿåº¦ç›¸æ¯”MySQLä¼šæœ‰æ›´å¿«çš„æŸ¥è¯¢é€Ÿåº¦ã€‚åœ¨äº’è”ç½‘åº”ç”¨ä¸­å¯¹æ•°æ®åº“çš„æŸ¥è¯¢æ€§èƒ½è¦æ±‚è¾ƒé«˜ï¼Œæ‰€ä»¥Rediså°±æ¯”MySQLæ›´åŠ é€‚åˆè¿™ç§åœºæ™¯ã€‚</p><blockquote><p>æ¯”å¦‚å­˜å‚¨æµè§ˆå™¨ä¸­çš„ç”¨æˆ·Cookieå’ŒSessionçš„å¯¹åº”å…³ç³»ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯sessionå¹¶ä¸æ˜¯å¿…é¡»è¦æ°¸ä¹…ä¿å­˜çš„æ•°æ®ï¼Œæˆ‘ä»¬èƒ½å…è®¸ä¸€å®šçš„æ•°æ®ä¸¢å¤±ï¼Œåæœæ— éæ˜¯ç”¨æˆ·éœ€è¦é‡æ–°ç™»å½•ç½‘é¡µè€Œå·²ã€‚</p></blockquote><p>å½“ç„¶ï¼Œç°åœ¨æ›´å¤šçš„é€‰æ‹©æ˜¯å°†Rediså’ŒMySQLç­‰æ•°æ®åº“ç»“åˆï¼Œå°†çƒ­ç‚¹æ•°æ®ï¼ˆæœ€å¸¸è®¿é—®çš„æ•°æ®ï¼‰æ”¾å…¥Redisï¼Œå…¨é‡æ•°æ®åœ¨MySQLä¸­ã€‚æ­¤æ—¶Rediså°±å¥½æ¯”ä¸€ä¸ªæ•°æ®çš„ç¼“å­˜äº†ã€‚</p><ul><li>ä¿è¯çƒ­ç‚¹æ•°æ®çš„æŸ¥è¯¢æ€§èƒ½ï¼›</li><li>ä¿è¯å…¨é‡æ•°æ®çš„æ­£ç¡®ä¿å­˜ï¼›</li><li>ä½†æ˜¯ä¼šå‡ºç°Rediså’ŒMySQLä¸­å¢åˆ æ”¹çš„æ•°æ®åŒæ­¥é—®é¢˜ï¼›</li><li>ä½¿ç”¨Redis+MySQLä¼šå¤§å¤§å¢åŠ ç³»ç»Ÿå¤æ‚æ€§ã€‚</li></ul><h2 id="1-3-Redisä¸èƒ½åšçš„äº‹æƒ…ï¼Ÿ"><a href="#1-3-Redisä¸èƒ½åšçš„äº‹æƒ…ï¼Ÿ" class="headerlink" title="1.3 Redisä¸èƒ½åšçš„äº‹æƒ…ï¼Ÿ"></a>1.3 Redisä¸èƒ½åšçš„äº‹æƒ…ï¼Ÿ</h2><p>å› ä¸ºRedisæ˜¯å†…å­˜å­˜å‚¨ï¼Œæ‰€ä»¥å®ƒä¸é€‚åˆå­˜å‚¨å¤§è§„æ¨¡æ•°æ®ã€‚</p><h1 id="2-åˆ†å¸ƒå¼"><a href="#2-åˆ†å¸ƒå¼" class="headerlink" title="2.åˆ†å¸ƒå¼"></a>2.åˆ†å¸ƒå¼</h1><p>å‰é¢æåˆ°ï¼ŒRedisçš„çœŸæ­£é€‚ç”¨åœºæ™¯æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿå‘¢ï¼Ÿ</p><h2 id="2-1-å•æœºæ¶æ„"><a href="#2-1-å•æœºæ¶æ„" class="headerlink" title="2.1 å•æœºæ¶æ„"></a>2.1 å•æœºæ¶æ„</h2><p>æ‰€è°“å•æœºæ¶æ„ï¼Œå°±æ˜¯ä¸€ä¸ªç³»ç»Ÿçš„æ‰€æœ‰æœåŠ¡éƒ½åœ¨ä¸€å°æœåŠ¡å™¨ä¸­è¿è¡Œã€‚</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå‡è®¾è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ç”µå•†ç³»ç»Ÿï¼Œå®ƒçš„æ•°æ®åº“å’Œåº”ç”¨ç¨‹åºéƒ½åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šã€‚ç”¨æˆ·è®¿é—®è¿™ä¸ªæœåŠ¡å™¨æ¥è·å–ç”µå•†æœåŠ¡ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/4b3ddd75cab10fc351e38737b5c18ad7.png" alt="image.png"></p><p>ä¹‹å‰æˆ‘å†™çš„å°é¡¹ç›®<a href="https://blog.musnow.top/posts/4231483510">è§†é¢‘ç‚¹æ’­ç³»ç»Ÿ</a>ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå•æœºæ¶æ„ã€‚é‡‡ç”¨MySQLä½œä¸ºæ•°æ®åº“ï¼ŒC++æ¥æä¾›åº”ç”¨æœåŠ¡ã€‚</p><p>å¦‚æœä¸€å°ä¸»æœºçš„æ€§èƒ½èƒ½è¶³å¤Ÿæ»¡è¶³æˆ‘ä»¬çš„ç”¨æˆ·æœåŠ¡éœ€æ±‚äº†ï¼Œå•æœºæ¶æ„å°±æ˜¯å¾ˆä¸é”™çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒçš„ç»´æŠ¤å¤æ‚åº¦ä¸é«˜ï¼Œä¸”éƒ¨ç½²æˆæœ¬ä¹Ÿè¾ƒä½ã€‚</p><h2 id="2-2-åˆ†å¸ƒå¼"><a href="#2-2-åˆ†å¸ƒå¼" class="headerlink" title="2.2 åˆ†å¸ƒå¼"></a>2.2 åˆ†å¸ƒå¼</h2><p>ä¸»æœºçš„æ€§èƒ½æŒ‡æ ‡åŒ…æ‹¬IOæ€§èƒ½ï¼ˆå†…å­˜å’Œç¡¬ç›˜ï¼‰ã€ç½‘ç»œååã€CPUè®¡ç®—æ€§èƒ½ç­‰ï¼Œè¿™äº›æ€§èƒ½éƒ½ä¼šåœ¨ç”¨æˆ·é‡å¢é•¿åˆ°æŸä¸€ä¸ªé‡çº§æ—¶é¡¶ä¸ä½ï¼Œå¯¼è‡´æœåŠ¡çš„è¯·æ±‚è€—æ—¶è¾ƒé•¿ç”šè‡³å‡ºç°å¤„ç†é”™è¯¯ï¼Œç”¨æˆ·ä½“éªŒå·®ã€‚</p><p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥é‡‡å–ä¸¤ä¸ªæªæ–½ï¼Œå¼€æºèŠ‚æµï¼š</p><ul><li>å¼€æºï¼šç»™ä¸»æœºå‡çº§ç¡¬ä»¶</li><li>èŠ‚æµï¼šé€šè¿‡è½¯ä»¶debugæ‰¾åˆ°å½±å“ç³»ç»Ÿæ€§èƒ½çš„éƒ¨åˆ†ï¼Œé’ˆå¯¹æ€§è¿›è¡Œè½¯ä»¶ä¼˜åŒ–ï¼›</li></ul><p>ä½†æ˜¯ï¼Œä¸€å°ä¸»æœºçš„æ€§èƒ½ï¼Œä¸ç®¡å†æ€ä¹ˆå‡çº§ç¡¬ä»¶ï¼Œæ€»å½’æ˜¯æœ‰ä¸Šé™çš„ã€‚å¦‚æœä¸€ä¸ªä¸»æœºéƒ½è¢«å‡çº§åˆ°é¡¶å¤©äº†è¿˜æ²¡æœ‰åŠæ³•æœåŠ¡æˆ‘ä»¬çš„æ€§èƒ½ï¼Œæ­¤æ—¶å°±éœ€è¦<strong>å¤šå°ä¸»æœº</strong>æ¥å¸®å¿™äº†ã€‚è¿™ä¾¿æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºç¡€ã€‚</p><ul><li>å¼•å…¥åˆ†å¸ƒå¼å…¶å®æ˜¯ä¸ªä¸‡ä¸å¾—å·²çš„æ“ä½œï¼›</li><li>ä¼šå¯¼è‡´ç³»ç»Ÿå¤æ‚åº¦å¤§å¤§æé«˜ï¼›</li><li>ç³»ç»Ÿå‡ºç°BUGçš„å¯èƒ½æ€§è¶Šæ¥è¶Šé«˜ï¼›</li><li>ç¨‹åºå‘˜è¢«â€œå¼€çŒ¿èŠ‚æµâ€çš„å¯èƒ½æ€§è¶Šæ¥è¶Šé«˜â€¦â€¦</li></ul><p>2023å¹´å¹´æœ«ï¼Œå„å¤§äº’è”ç½‘å‚å®¶ï¼ˆé˜¿é‡Œã€æ»´æ»´ï¼‰æ——ä¸‹çš„æœåŠ¡æŒ¨ä¸ªboomï¼Œæ­£æ˜¯è¯´æ˜äº†è¿™ä¸€ç‚¹â€¦â€¦</p><p>å…ˆæ¥çœ‹çœ‹ä¸€ä¸ªæœ€ç®€å•çš„åˆ†å¸ƒå¼ç³»ç»Ÿå§ï¼Œå³å°†åº”ç”¨æœåŠ¡å’Œæ•°æ®åº“æœåŠ¡åˆ†ç¦»ã€‚</p><ul><li>åº”ç”¨æœåŠ¡å™¨ï¼šCPUå’Œå†…å­˜æ€§èƒ½ï¼Œæé«˜å¤„ç†é€Ÿåº¦ï¼›</li><li>å­˜å‚¨æœåŠ¡å™¨ï¼šæ›´å¤§æ›´å¿«çš„ç¡¬ç›˜ï¼Œå¢åŠ IOååé‡ï¼›</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/7420a71996b1c3c0a848e644d0419b13.png" alt="image.png"></p><h2 id="2-3-è´Ÿè½½å‡è¡¡"><a href="#2-3-è´Ÿè½½å‡è¡¡" class="headerlink" title="2.3 è´Ÿè½½å‡è¡¡"></a>2.3 è´Ÿè½½å‡è¡¡</h2><p>è¿›ä¸€æ­¥æ‰©å±•ï¼Œå°±éœ€è¦æ›´å¤šçš„ä¸»æœºï¼Œä»¥åŠè´Ÿè½½å‡è¡¡æªæ–½äº†ã€‚</p><ul><li>ä¸€ä¸ªè´Ÿè½½å‡è¡¡æœåŠ¡å™¨å’Œä¸¤ä¸ªç‹¬ç«‹çš„åº”ç”¨æœåŠ¡å™¨ï¼›</li><li>ç”¨æˆ·è¯·æ±‚è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼›</li><li>è´Ÿè½½å‡è¡¡æœåŠ¡å™¨æ ¹æ®ä¸¤ä¸ªåº”ç”¨æœåŠ¡å™¨å½“å‰çš„è´Ÿè½½ï¼Œé€‰æ‹©è¾ƒä½çš„æœåŠ¡å™¨æ¥å¤„ç†è¯·æ±‚ï¼ˆè¿™é‡Œæ¶‰åŠåˆ°è´Ÿè½½å‡è¡¡çš„ç®—æ³•ï¼‰ï¼›</li></ul><p>æ­¤æ—¶ä¸¤ä¸ªåº”ç”¨æœåŠ¡å™¨åœ¨ä¸€å®šç¨‹åº¦ä¸Šéƒ½å¹²äº†ç›¸åŒçš„æ´»ï¼Œå°±èƒ½å‡å°‘å•ä¸ªæœºå™¨çš„å‹åŠ›ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/fef48f23eed772c5c53a99c5b89f26e2.png" alt="image.png"></p><p>æ³¨æ„ï¼Œè™½ç„¶è´Ÿè½½å‡è¡¡æœåŠ¡å™¨çœ‹ä¸Šå»ä¼šæ¥å—æ‰€æœ‰ç”¨æˆ·çš„è¯·æ±‚ï¼Œä½†å®ƒçš„è¯·æ±‚æ‰¿æ‹…èƒ½åŠ›æ˜¯è¿œè¿œå¤§äºåº”ç”¨æœåŠ¡å™¨çš„ã€‚å› ä¸ºå®ƒçš„å·¥ä½œå¾ˆç®€å•ï¼Œåªæ˜¯ä¸€ä¸ªç®€å•çš„è¯†åˆ«å’Œåˆ†é…å·¥ä½œï¼Œå¹¶ä¸æ¶‰åŠåˆ°å…·ä½“çš„åŠŸèƒ½ã€‚</p><p>å¦‚æœè¯·æ±‚é‡å¤§åˆ°è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ä¹Ÿé¡¶ä¸ä½äº†ï¼Œé‚£å¯ä»¥æ·»åŠ å¤šä¸ªè´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼ˆå¯ä»¥é‡‡ç”¨å¤šåœ°èŠ‚ç‚¹çš„æ–¹å¼ï¼‰ã€‚</p><p>æ·»åŠ ä¸Šè´Ÿè½½å‡è¡¡æªæ–½åï¼Œå°±æœ‰äº†æœåŠ¡é›†ç¾¤ï¼Œè¿™ä¸ªé›†ç¾¤ä¸­æŸä¸ªæœåŠ¡å™¨æŒ‚æ‰å¯¹æ•´ä¸ªæœåŠ¡å™¨çš„å½±å“ä¸é«˜ï¼ˆå®ƒçš„è¯·æ±‚å¯ä»¥ç”±å…¶ä»–æ­£å¸¸è¿è¡Œçš„æœåŠ¡å™¨æ‰¿æ‹…ï¼‰ä¸€å®šç¨‹åº¦ä¸Šæé«˜äº†å¯ç”¨æ€§ã€‚</p><p>å¦å¤–ï¼Œè´Ÿè½½å‡è¡¡æœåŠ¡å™¨ä¹Ÿéœ€è¦ä½¿ç”¨ä¸€äº›ç®—æ³•ï¼Œæ¯”å¦‚æƒ³åŠæ³•è®©åŒä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚å§‹ç»ˆèµ°åˆ°åŒä¸€ä¸ªåº”ç”¨æœåŠ¡å™¨ä¸Šï¼Œé¿å…åœ¨ä¸åŒåº”ç”¨æœåŠ¡å™¨ä¸­è¿›è¡Œæ•°æ®äº¤æ¢ã€‚</p><h2 id="2-4-æ•°æ®åº“è¯»å†™åˆ†ç¦»"><a href="#2-4-æ•°æ®åº“è¯»å†™åˆ†ç¦»" class="headerlink" title="2.4 æ•°æ®åº“è¯»å†™åˆ†ç¦»"></a>2.4 æ•°æ®åº“è¯»å†™åˆ†ç¦»</h2><p>å‰é¢æåˆ°çš„æªæ–½éƒ½æ˜¯åœ¨ä¼˜åŒ–åº”ç”¨æœåŠ¡å™¨çš„è´Ÿè½½ï¼Œé‚£ä¹ˆæ•°æ®åº“æœåŠ¡å™¨çš„è´Ÿè½½åº”è¯¥å¦‚ä½•é™ä½å‘¢ï¼Ÿ</p><p>æ¯”è¾ƒç®€å•çš„ä¸€ç§åŠæ³•å°±æ˜¯æ•°æ®åº“çš„<code>è¯»å†™åˆ†ç¦»</code>ã€‚å³è¯»æ•°æ®åº“çš„æ“ä½œå’Œå†™æ•°æ®åº“çš„æ“ä½œç”±ä¸åŒçš„æœåŠ¡å™¨æ¥æ‰¿æ‹…ã€‚</p><ul><li>åº”ç”¨ç¨‹åºéœ€è¦å†™å…¥ï¼Œè¯·æ±‚AæœåŠ¡å™¨</li><li>AæœåŠ¡å™¨å¤„ç†å†™å…¥åï¼Œå®šæœŸåŒæ­¥åˆ°BæœåŠ¡å™¨</li><li>åº”ç”¨ç¨‹åºéœ€è¦è¯»å–æ—¶è¯·æ±‚BæœåŠ¡å™¨</li></ul><p>è€ƒè™‘åˆ°å®é™…åœºæ™¯ä¸­ï¼Œ<strong>è¯»å–çš„é¢‘ç‡ä¼šè¿œè¿œé«˜äºå†™å…¥</strong>ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯»å–æœåŠ¡å™¨Bå¤§éƒ¨åˆ†æƒ…å†µä¸‹åªéœ€è¦å¤„ç†è¯»è¯·æ±‚ï¼Œå‹åŠ›ä¼šé™ä½ã€‚è€Œä¸”æˆ‘ä»¬å¯ä»¥æä¾›å¤šä¸ªå’ŒBä¸€æ ·çš„è¯»æœåŠ¡å™¨ï¼ŒåŠ ä¸Šè´Ÿè½½å‡è¡¡ï¼Œè¿›ä¸€æ­¥å‡å°‘è¯»æœåŠ¡å™¨çš„å‹åŠ›ã€‚</p><p>ä¸ºä»€ä¹ˆè¯´è¯»çš„é¢‘ç‡è¿œè¿œé«˜äºå†™å…¥ï¼Ÿä»¥èŠå¤©è½¯ä»¶ä¸ºä¾‹ï¼š</p><ul><li>å½“ç”¨æˆ·æ‰“å¼€èŠå¤©è½¯ä»¶çš„ä¸»ç•Œé¢æ—¶ï¼Œè½¯ä»¶éœ€è¦å¯¹å½“å‰èŠå¤©æ¡†é‡Œçš„æ‰€æœ‰è”ç³»äºº&#x2F;ç¾¤ç»„é‡Œé¢çš„æ¶ˆæ¯è¿›è¡Œä¸€æ¬¡æŸ¥è¯¢ï¼›</li><li>å½“ç”¨æˆ·æ‰“å¼€è‡ªå·±çš„ä¸ªäººä¿¡æ¯æ—¶ï¼Œè½¯ä»¶éœ€è¦æŸ¥è¯¢ä¸ªäººä¿¡æ¯ï¼ˆå½“ç„¶è¿™ä¸ªä¿¡æ¯å¯èƒ½æ˜¯æœ¬åœ°æ—©å°±ç¼“å­˜å¥½äº†çš„ï¼‰ï¼›</li><li>å½“ç”¨æˆ·æ‰“å¼€æœ‹å‹åœˆçš„æ—¶å€™ï¼Œéœ€è¦æŸ¥è¯¢å¥½å‹çš„æœ‹å‹åœˆï¼Œå¹¶æŠŠæœ€æ–°çš„è¯´è¯´æ¨é€ç»™å½“å‰ç”¨æˆ·</li><li>â€¦â€¦</li></ul><p>ä¸Šè¿°çš„è¿™ä¸€ç³»åˆ—æ“ä½œéƒ½æ˜¯è¯»æŸ¥è¯¢ï¼Œå®Œå…¨æ²¡æœ‰æ¶‰åŠåˆ°å†™ã€‚å½“ç”¨æˆ·ä½¿ç”¨èŠå¤©è½¯ä»¶ï¼Œæ²¡æœ‰å‘å‡ºæ¶ˆæ¯æ—¶ï¼ŒèŠå¤©è½¯ä»¶ä¸€ç›´åœ¨åšçš„éƒ½æ˜¯è¯»æ“ä½œï¼ä»¥æ­¤ç±»æ¨ï¼Œå¤§éƒ¨åˆ†è½¯ä»¶åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œéƒ½æ˜¯è¯»æ“ä½œå±…å¤šï¼Œå†™æ“ä½œç›¸å¯¹è¾ƒå°‘ã€‚</p><h2 id="2-5-çƒ­ç‚¹ç¼“å­˜"><a href="#2-5-çƒ­ç‚¹ç¼“å­˜" class="headerlink" title="2.5 çƒ­ç‚¹ç¼“å­˜"></a>2.5 çƒ­ç‚¹ç¼“å­˜</h2><p>æœ‰ä¸€ä¸ªç»å…¸çš„äºŒå…«åŸåˆ™ï¼Œåœ¨æ•°æ®åº“åœºæ™¯ä¹Ÿèƒ½é€‚ç”¨ï¼š20%çš„æ•°æ®èƒ½æ”¯æ’‘80%çš„è®¿é—®ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¼•å…¥é’ˆå¯¹è¿™20%çš„çƒ­ç‚¹æ•°æ®çš„<strong>ç¼“å­˜</strong>ï¼Œä¿è¯è¿™äº›çƒ­ç‚¹æ•°æ®èƒ½æ›´å¿«çš„è¢«æŸ¥è¯¢ï¼ˆè¯»ï¼‰ã€‚Rediså¯ä»¥è¯´å°±æ˜¯ç”¨æ¥åšç¼“å­˜çš„ã€‚</p><p>ç¼“å­˜éœ€è¦æ›´å¿«çš„æŸ¥è¯¢é€Ÿåº¦ï¼Œä»£ä»·å°±æ˜¯å®ƒå­˜æ”¾ä¸äº†å¤ªå¤šçš„æ•°æ®ã€‚æ¯”å¦‚Rediséœ€è¦å°†æ•°æ®å­˜å…¥å†…å­˜ä¸­ï¼Œå†…å­˜çš„å®¹é‡è¿œè¿œå°äºç£ç›˜ï¼Œå­˜ä¸äº†å¾ˆå¤šæ•°æ®ã€‚æ‰€ä»¥ç¼“å­˜ä¸€å®šè¦ä½¿ç”¨é€‚åˆåœºæ™¯çš„ç®—æ³•ï¼Œä¿è¯ç¼“å­˜ä¸­çš„æ•°æ®æœ‰å°½å¯èƒ½é«˜çš„å‘½ä¸­ç‡ã€‚</p><p>å½“ç„¶ï¼Œè¿™æ ·ä¼šå¯¼è‡´ç¼“å­˜æœåŠ¡å™¨ä¼šæ‰¿å—è¾ƒå¤§çš„æŸ¥è¯¢å‹åŠ›ã€‚ä¸è¿‡å®Œæ•´æ•°æ®åº“çš„æŸ¥è¯¢å‹åŠ›åˆè¢«è¿›ä¸€æ­¥å‡å°‘äº†ã€‚</p><h2 id="2-6-åˆ†åº“åˆ†è¡¨"><a href="#2-6-åˆ†åº“åˆ†è¡¨" class="headerlink" title="2.6 åˆ†åº“åˆ†è¡¨"></a>2.6 åˆ†åº“åˆ†è¡¨</h2><p>å½“ä¸€ä¸ªæœåŠ¡å™¨å­˜å‚¨ä¸ä¸‹å½“å‰ç³»ç»Ÿçš„<strong>å…¨é‡æ•°æ®</strong>æ—¶ï¼Œå°±éœ€è¦è¿›è¡Œåˆ†åº“åˆ†è¡¨äº†ã€‚å³å°†æ•°æ®åº“è¿›è¡Œä¸€å®šçš„æ‹†åˆ†ï¼Œå­˜æ”¾åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸­ã€‚</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå°†åŸæœ¬ä¸€ä¸ªæ•°æ®åº“çš„ä¸åŒè¡¨ï¼Œæ”¾åœ¨ä¸åŒæœåŠ¡å™¨ä¸­ã€‚è¿™æ ·ä¸€ä¸ªæœåŠ¡å™¨ä¸Šå°±åªç”¨å­˜æ”¾ä¸€éƒ¨åˆ†æ•°æ®ï¼Œå‡å°‘äº†å­˜å‚¨å®¹é‡çš„åŒæ—¶ï¼Œä¹Ÿå‡å°‘äº†å•ä¸ªæœåŠ¡å™¨åœ¨æŸ¥è¯¢æ–¹é¢çš„å‹åŠ›ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæŸä¸ªè¡¨å»ºç«‹ä¸€ä¸ªå­˜å‚¨çš„é›†ç¾¤ï¼Œè¿™ä¹Ÿæ˜¯ä¾ç…§è´Ÿè½½å‡è¡¡çš„åŸºæœ¬æ€è·¯æ¥æ‰©å±•ä¸»ä»ã€‚</p><p>å¦‚æœä¸€ä¸ªè¡¨è¿‡å¤§ï¼Œæ²¡æœ‰åŠæ³•æ”¾å…¥ä¸€å°ä¸»æœºï¼Œä¹Ÿå¯ä»¥æ ¹æ®è¡¨çš„<strong>ä¸»é”®</strong>æ¥å°†è¯¥è¡¨æ‹†åˆ†æ”¾å…¥ä¸åŒçš„æœåŠ¡å™¨ã€‚æ¯”å¦‚æœåŠ¡å™¨Aæ”¾å…¥ä¸»é”®1åˆ°10ä¸‡ï¼ŒæœåŠ¡å™¨Bæ”¾å…¥10ä¸‡é›¶1åˆ°20ä¸‡ç­‰ç­‰â€¦â€¦</p><p>è¿™ä¸ªæ‹†åˆ†å¯ä»¥ä¸€ç›´æŒç»­ä¸‹å»ï¼Œç›´åˆ°æ€§èƒ½æ»¡è¶³äº†ä¸šåŠ¡çš„éœ€è¦ã€‚å…·ä½“çš„æ‹†åˆ†æ–¹å¼ä¹Ÿæ˜¯æ ¹æ®å…·ä½“ä¸šåŠ¡æ¥è¿›è¡Œå¤„ç†çš„ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/313e9c3894bd95766643b2d6150946b3.png" alt="image.png"></p><p>åˆ†å¸ƒå¼çš„å¤„ç†å…¶å®éƒ½æ˜¯åŸºäºå…·ä½“ä¸šåŠ¡çš„éœ€è¦æ¥åˆ†æçš„ã€‚ä¸šåŠ¡å†³å®šäº†æˆ‘ä»¬åº”è¯¥é€‰å–çš„æŠ€æœ¯è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="2-7-å¾®æœåŠ¡æ¶æ„"><a href="#2-7-å¾®æœåŠ¡æ¶æ„" class="headerlink" title="2.7 å¾®æœåŠ¡æ¶æ„"></a>2.7 å¾®æœåŠ¡æ¶æ„</h2><p>å‰é¢æåˆ°çš„å¤„ç†éƒ½æ˜¯åœ¨æœåŠ¡å™¨æ‹†åˆ†ã€æ•°æ®åº“æ‹†åˆ†ä¸Šå¤„ç†çš„ã€‚æˆ‘ä»¬çš„åº”ç”¨æœåŠ¡å™¨ä¾æ—§æ˜¯ä¸€ä¸ªæœåŠ¡å™¨èƒ½å®Œæˆè¿™ä¸ªä¸šåŠ¡çš„æ‰€æœ‰ä»»åŠ¡ã€‚è¿™æ ·ä¼šå¯¼è‡´è¯¥åº”ç”¨æœåŠ¡å™¨çš„ä»£ç éå¸¸åºå¤§ï¼Œä¸”éš¾ä»¥è¿›è¡Œç»´æŠ¤ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å°†æ•´ä¸ªç³»ç»Ÿæ ¹æ®åŠŸèƒ½è¿›è¡Œæ‹†åˆ†ï¼Œç”¨æˆ·ç®¡ç†æ˜¯ä¸€ä¸ªåº”ç”¨æœåŠ¡å™¨ã€å•†å“äº¤æ˜“æ˜¯ä¸€ä¸ªåº”ç”¨æœåŠ¡å™¨ã€äº¤æ˜“å¤„ç†ä¹Ÿæ˜¯ä¸€ä¸ªåº”ç”¨æœåŠ¡å™¨ï¼Œåœ¨ä¸åŒçš„æœåŠ¡å™¨ä¹‹é—´å¯ä»¥é€šè¿‡æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹ç±»çš„æ–¹å¼è¿›è¡Œæ•°æ®é€šä¿¡ã€‚</p><p>è€Œè¯¸å¦‚å®‰å…¨å¤„ç†ç­‰å¤§å®¶éƒ½ç”¨å¾—ä¸Šçš„å…¬å…±æœåŠ¡ï¼Œå¯ä»¥å•å¼€ä¸€ä¸ªè¿›è¡Œå¤„ç†ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/e46480d91db2ab3edce15e0946c0a14c.png" alt="image.png"></p><p>å®é™…ä¸Šï¼Œå¾®æœåŠ¡æ˜¯åœ¨è§£å†³å›¢é˜Ÿåä½œçš„é—®é¢˜ã€‚å•ä¸€åº”ç”¨æœåŠ¡å™¨åœ¨è§„æ¨¡å¤§äº†ä¹‹åä¼šéå¸¸éå¸¸å¤æ‚ï¼Œè€Œä½¿ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œ<strong>å¯ä»¥å°†å›¢é˜ŸæŒ‰ç…§ä¸šåŠ¡æ‹†åˆ†æˆä¸åŒçš„å°ç»„</strong>ï¼Œæ¯ä¸ªå°ç»„åªéœ€è¦ç»´æŠ¤äº§å“ä¸­çš„ä¸€éƒ¨åˆ†æœåŠ¡ï¼Œè¿™æ ·ç»´æŠ¤å•ä¸ªæœåŠ¡çš„éš¾åº¦å°±é™ä½äº†ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œä¼ä¸šçš„ç»„ç»‡æ¶æ„çš„åˆ†é…å˜å¾—æ›´åŠ æ–¹ä¾¿ã€‚</p><h3 id="å¾®æœåŠ¡çš„ä¼˜åŠ¿"><a href="#å¾®æœåŠ¡çš„ä¼˜åŠ¿" class="headerlink" title="å¾®æœåŠ¡çš„ä¼˜åŠ¿"></a>å¾®æœåŠ¡çš„ä¼˜åŠ¿</h3><p>å¾®æœåŠ¡çš„ä¼˜åŠ¿ï¼š</p><ul><li>è§£å†³äº†å›¢é˜Ÿç»„ç»‡æ¶æ„åˆ†é…çš„é—®é¢˜</li><li>æ–¹ä¾¿ä»£ç åŠŸèƒ½çš„å¤ç”¨ï¼ˆæ¯”å¦‚ä¸åŒæœåŠ¡å®ƒçš„ç”¨æˆ·ç®¡ç†æ¨¡å—çš„ä»£ç å…¶å®æ˜¯å·®åˆ«ä¸å¤§çš„ï¼Œæ–¹ä¾¿è¿›è¡Œå¤ç”¨ï¼‰</li><li>ä¸åŒçš„æœåŠ¡ï¼Œå¯ä»¥è¿›è¡Œé’ˆå¯¹æ€§çš„éƒ¨ç½²ï¼ˆæ¯”å¦‚æŸäº›æœåŠ¡çš„æ€§èƒ½éœ€æ±‚ä¸é«˜ï¼Œå°±å¯ä»¥éƒ¨ç½²åœ¨é…ç½®ç›¸å¯¹è¾ƒå·®çš„æœåŠ¡å™¨ä¸Šï¼‰</li></ul><h3 id="å¾®æœåŠ¡çš„ç¼ºç‚¹"><a href="#å¾®æœåŠ¡çš„ç¼ºç‚¹" class="headerlink" title="å¾®æœåŠ¡çš„ç¼ºç‚¹"></a>å¾®æœåŠ¡çš„ç¼ºç‚¹</h3><p>å¾®æœåŠ¡æ¶æ„å¯¹åº”ç”¨æœåŠ¡çš„æ‹†åˆ†ä¼šè¿›ä¸€æ­¥æ‰©å¤§æ•´ä¸ªç³»ç»Ÿçš„å¤æ‚æ€§ï¼Œåæ­£å°±æ˜¯è¶Šæ‹†è¶Šå¤æ‚ã€‚ç¼ºç‚¹å¦‚ä¸‹ï¼š</p><ul><li>ç³»ç»Ÿå“åº”é€Ÿåº¦é™ä½ï¼šå› ä¸ºä¸åŒçš„æ¨¡å—æ˜¯åœ¨ä¸åŒçš„æœåŠ¡é›†ç¾¤ä¸Šå¤„ç†ï¼Œå®ƒä»¬ä¹‹é—´éœ€è¦ä½¿ç”¨ç½‘ç»œè¿›è¡Œé€šä¿¡ï¼Œç›¸æ¯”äºå•ä¸ªå®Œæ•´çš„åº”ç”¨æœåŠ¡å™¨ï¼Œæ•´ä¸ªç³»ç»Ÿçš„å“åº”é€Ÿåº¦é™ä½äº†ã€‚è¦æƒ³ä¿è¯ç³»ç»Ÿå“åº”é€Ÿåº¦é™ä½å¹…åº¦å°ï¼Œå°±å¾—å¼•å…¥æ›´å¤šçš„ç¡¬ä»¶èµ„æºæ¥å¤„ç†ï¼ˆæ›´å¿«çš„ç½‘å¡ï¼‰</li><li>ç³»ç»Ÿå‡ºç°é—®é¢˜æ¦‚ç‡æé«˜ï¼šå› ä¸ºå¾®æœåŠ¡ä¼šå¼•å…¥æ›´å¤šçš„æœºå™¨ï¼Œå¯¼è‡´å‡ºç°é—®é¢˜çš„æ¦‚ç‡è¢«æé«˜ã€‚éœ€è¦æ›´å¤šæ›´è¯¦ç»†çš„ç›‘æ§å’Œå‘Šè­¦æ–¹å¼æ¥ä¿è¯å¤šå°äº‘æœåŠ¡å™¨çš„å¯ç”¨æ€§ã€‚</li></ul><h1 id="3-åˆ†å¸ƒå¼ä¸­æ¶‰åŠåˆ°çš„ç›¸å…³æ¦‚å¿µ"><a href="#3-åˆ†å¸ƒå¼ä¸­æ¶‰åŠåˆ°çš„ç›¸å…³æ¦‚å¿µ" class="headerlink" title="3.åˆ†å¸ƒå¼ä¸­æ¶‰åŠåˆ°çš„ç›¸å…³æ¦‚å¿µ"></a>3.åˆ†å¸ƒå¼ä¸­æ¶‰åŠåˆ°çš„ç›¸å…³æ¦‚å¿µ</h1><h2 id="3-1-åº”ç”¨Application-x2F-ç³»ç»ŸSystem"><a href="#3-1-åº”ç”¨Application-x2F-ç³»ç»ŸSystem" class="headerlink" title="3.1 åº”ç”¨Application&#x2F;ç³»ç»ŸSystem"></a>3.1 åº”ç”¨Application&#x2F;ç³»ç»ŸSystem</h2><p>ä¸€ä¸ªåº”ç”¨ï¼ˆç³»ç»Ÿï¼‰å°±æ˜¯ä¸€ä¸ªæˆ–è€…ä¸€ç»„æœåŠ¡å™¨ç¨‹åº</p><h2 id="3-2-æ¨¡å—Module-x2F-ç»„ä»¶Componet"><a href="#3-2-æ¨¡å—Module-x2F-ç»„ä»¶Componet" class="headerlink" title="3.2 æ¨¡å—Module&#x2F;ç»„ä»¶Componet"></a>3.2 æ¨¡å—Module&#x2F;ç»„ä»¶Componet</h2><p>åº”ç”¨ä¸­çš„ä¸åŒåŠŸèƒ½è¢«æ‹†åˆ†æˆä¸åŒçš„æ¨¡å—ï¼Œå…±åŒç»„æˆæœ€ç»ˆçš„åº”ç”¨ç¨‹åº</p><h2 id="3-3-åˆ†å¸ƒå¼Distributed"><a href="#3-3-åˆ†å¸ƒå¼Distributed" class="headerlink" title="3.3 åˆ†å¸ƒå¼Distributed"></a>3.3 åˆ†å¸ƒå¼Distributed</h2><p>å¼•å…¥å¤šä¸ªæœåŠ¡å™¨&#x2F;ä¸»æœºï¼ŒååŒé…åˆå®Œæˆä¸€ç³»åˆ—å·¥ä½œï¼ˆç‰©ç†ä¸Šçš„å¤šä¸ªä¸»æœºï¼‰</p><h2 id="3-4-é›†ç¾¤Cluster"><a href="#3-4-é›†ç¾¤Cluster" class="headerlink" title="3.4 é›†ç¾¤Cluster"></a>3.4 é›†ç¾¤Cluster</h2><p>å¼•å…¥å¤šä¸ªæœåŠ¡å™¨&#x2F;ä¸»æœºï¼ŒååŒé…åˆå®Œæˆä¸€ç³»åˆ—å·¥ä½œï¼ˆé€»è¾‘ä¸Šçš„å¤šä¸ªä¸»æœºï¼‰</p><h2 id="3-5-ä¸»Master-x2F-ä»Slave"><a href="#3-5-ä¸»Master-x2F-ä»Slave" class="headerlink" title="3.5 ä¸»Master&#x2F;ä»Slave"></a>3.5 ä¸»Master&#x2F;ä»Slave</h2><p>å¤šä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ä¸­ï¼Œä¸€ä¸ªæ˜¯ä¸»èŠ‚ç‚¹ï¼Œå…¶ä»–æ˜¯ä»èŠ‚ç‚¹ã€‚<code>ä»èŠ‚ç‚¹</code>éœ€è¦ä»<code>ä¸»èŠ‚ç‚¹</code>ä¸­åŒæ­¥æ•°æ®ã€‚</p><h2 id="3-6-ä¸­é—´ä»¶Middleware"><a href="#3-6-ä¸­é—´ä»¶Middleware" class="headerlink" title="3.6 ä¸­é—´ä»¶Middleware"></a>3.6 ä¸­é—´ä»¶Middleware</h2><p>å’Œå…·ä½“ä¸šåŠ¡æ— å…³ï¼Œä½†åœ¨ç³»ç»Ÿä¸­éœ€è¦ä½¿ç”¨çš„æœåŠ¡ã€‚æ¯”å¦‚æ•°æ®åº“ã€ç¼“å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ã€‚</p><h2 id="3-7-å¯ç”¨æ€§Availability"><a href="#3-7-å¯ç”¨æ€§Availability" class="headerlink" title="3.7 å¯ç”¨æ€§Availability"></a>3.7 å¯ç”¨æ€§Availability</h2><p>ç³»ç»Ÿæ•´ä½“å¯ç”¨æ—¶é—´&#x2F;æ€»æ—¶é—´</p><blockquote><p>ä¸‰ä¸ª9ä»£è¡¨å¯ç”¨æ€§æ˜¯<code>99.999%</code>ï¼›</p></blockquote><h2 id="3-8-å“åº”æ—¶é—´Response-Time-RT"><a href="#3-8-å“åº”æ—¶é—´Response-Time-RT" class="headerlink" title="3.8 å“åº”æ—¶é—´Response Time RT"></a>3.8 å“åº”æ—¶é—´Response Time RT</h2><p>ç”¨äºè¡¡é‡æœåŠ¡å™¨çš„æ€§èƒ½ï¼Œå“åº”æ—¶é—´è¶Šå¿«è¶Šå¥½</p><h2 id="3-9-ååThroughputå’Œå¹¶å‘Concurrent"><a href="#3-9-ååThroughputå’Œå¹¶å‘Concurrent" class="headerlink" title="3.9 ååThroughputå’Œå¹¶å‘Concurrent"></a>3.9 ååThroughputå’Œå¹¶å‘Concurrent</h2><p>è¡¡é‡ç³»ç»Ÿå¤„ç†è¯·æ±‚çš„èƒ½åŠ›ï¼Œä¹Ÿæ˜¯è¡¡é‡æ€§èƒ½çš„æ–¹å¼ä¹‹ä¸€ã€‚</p><h1 id="4-Redisçš„ç‰¹æ€§"><a href="#4-Redisçš„ç‰¹æ€§" class="headerlink" title="4.Redisçš„ç‰¹æ€§"></a>4.Redisçš„ç‰¹æ€§</h1><p>æˆ‘ä»¬å¯ä»¥åœ¨redisçš„å®˜ç½‘ä¸Šçœ‹åˆ°redisçš„ç‰¹æ€§ï¼Œä¸€ä¸ªä¸€ä¸ªæ¥è®¤è¯†ä¸€ä¸‹å§</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/9aec7a8ebddb4dd911e41981cea8d11a.png" alt="image-20240210135822201"></p><h2 id="4-1-In-memory-data-structures"><a href="#4-1-In-memory-data-structures" class="headerlink" title="4.1 In-memory data structures"></a>4.1 In-memory data structures</h2><p>å‰é¢å·²ç»æåˆ°è¿‡ï¼ŒRedisæ˜¯ä¸€ä¸ªKVæ–¹å¼çš„å†…å­˜çº§æ•°æ®åº“ï¼Œå®ƒçš„Keyéƒ½æ˜¯stringï¼Œvalueå¯ä»¥æ˜¯stringã€hashã€listã€setã€zsetã€bitmapsã€GEOç­‰å„ç§æ•°æ®ç»“æ„ã€‚</p><p>ä½¿ç”¨Key-Valueæ–¹å¼æ¥å­˜æ”¾æ•°æ®çš„æ•°æ®åº“ï¼Œè¢«ç§°ä¸º<code>éå…³ç³»æ•°æ®åº“</code>ï¼ŒNoSQLä¹Ÿæ˜¯ç±»ä¼¼çš„å«ä¹‰ã€‚</p><h2 id="4-2-Progarmmability"><a href="#4-2-Progarmmability" class="headerlink" title="4.2 Progarmmability"></a>4.2 Progarmmability</h2><p>é’ˆå¯¹Redisçš„æ“ä½œï¼Œå¯ä»¥é€šè¿‡ç®€å•çš„äº¤äº’å¼å‘½ä»¤æ¥å­˜æ”¾æ•°æ®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è„šæœ¬æ¥æ‰¹é‡æ‰§è¡Œä¸€äº›æ“ä½œã€‚</p><h2 id="4-3-Extentsibility"><a href="#4-3-Extentsibility" class="headerlink" title="4.3 Extentsibility"></a>4.3 Extentsibility</h2><p>Redisæä¾›äº†ä¸€ç³»åˆ—APIï¼Œå¯ä»¥åœ¨RedisåŸæœ‰åŠŸèƒ½çš„åŸºç¡€ä¸Šé…ç½®æ‰©å±•ï¼Œæ¯”å¦‚è®©Redisæ”¯æŒæ›´å¤šæ•°æ®ç»“æ„ã€‚æ”¯æŒC&#x2F;C++&#x2F;Rustè¯­è¨€ã€‚</p><h2 id="4-4-Persistence"><a href="#4-4-Persistence" class="headerlink" title="4.4 Persistence"></a>4.4 Persistence</h2><p>Redisæ˜¯å°†æ•°æ®å­˜æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œä½†ä¹Ÿæä¾›äº†<strong>æŒä¹…åŒ–</strong>æ–¹å¼æ¥ä¿è¯ç³»ç»Ÿé‡å¯æ—¶æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚</p><h2 id="4-5-Clustering"><a href="#4-5-Clustering" class="headerlink" title="4.5 Clustering"></a>4.5 Clustering</h2><p>Redisä½œä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸­é—´ä»¶ï¼ŒåŸç”Ÿæ”¯æŒé›†ç¾¤éƒ¨ç½²ã€‚</p><p>Horizontal scalability æŒ‡çš„æ˜¯ç³»ç»Ÿçš„æ°´å¹³æ‰©å±•èƒ½åŠ›ï¼Œç±»ä¼¼äºâ€œåˆ†åº“åˆ†è¡¨â€ã€‚</p><h2 id="4-6-High-availability"><a href="#4-6-High-availability" class="headerlink" title="4.6 High availability"></a>4.6 High availability</h2><p>RedisåŸç”Ÿæ”¯æŒä¸»ä»ç»“æ„ï¼Œä»èŠ‚ç‚¹ç›¸å½“äºä¸»èŠ‚ç‚¹çš„å¤‡ä»½ï¼Œä¸»èŠ‚ç‚¹å¤±æ•ˆæ—¶ä»èŠ‚ç‚¹èƒ½ç«‹é©¬é¡¶ä¸Šå»ï¼ˆæ›¿è¡¥ï¼‰ã€‚</p><h2 id="4-7-å¤©ä¸‹æ­¦åŠŸå”¯å¿«ä¸ç ´"><a href="#4-7-å¤©ä¸‹æ­¦åŠŸå”¯å¿«ä¸ç ´" class="headerlink" title="4.7 å¤©ä¸‹æ­¦åŠŸå”¯å¿«ä¸ç ´"></a>4.7 å¤©ä¸‹æ­¦åŠŸå”¯å¿«ä¸ç ´</h2><p>Redisèƒ½è¢«å¹¿æ³›çš„ä½¿ç”¨ï¼Œæœ€å¤§çš„åŸå› è¿˜æ˜¯å› ä¸ºå®ƒå¾ˆå¿«ï¼</p><ol><li>Redisæ•°æ®åœ¨å†…å­˜ä¸­ï¼Œæ¯”è®¿é—®ç¡¬ç›˜çš„æ•°æ®åº“å¿«çš„å¤šï¼›</li><li>Redisçš„æ ¸å¿ƒåŠŸèƒ½é€»è¾‘è¾ƒä¸ºç®€å•ï¼Œåªæ˜¯æ“ä½œå†…å­˜ä¸­çš„æ•°æ®ç»“æ„ï¼›</li><li>Redisä½¿ç”¨äº†IOå¤šè·¯å¤ç”¨(epoll)æ¥å¤„ç†ç½‘ç»œè¯·æ±‚ï¼›</li><li>Redisä½¿ç”¨çš„å•çº¿ç¨‹æ¨¡å‹ï¼ˆé«˜ç‰ˆæœ¬Rediså¼•å…¥äº†å¤šçº¿ç¨‹ï¼‰ï¼Œå‡å°‘äº†çº¿ç¨‹ç«äº‰çš„ä¸å¿…è¦çš„å¼€é”€ã€‚</li></ol><p>è¿™é‡Œè¦è¡¥å……ä¸€ç‚¹ï¼Œå¤šçº¿ç¨‹æé«˜æ•ˆç‡çš„å‰ææ˜¯æ‰§è¡Œçš„æ˜¯CPUå¯†é›†å‹çš„æ“ä½œï¼Œå¤šçº¿ç¨‹æ‰èƒ½å……åˆ†åˆ©ç”¨CPUçš„å¤šæ ¸å¿ƒèµ„æºã€‚è€ŒRedisçš„æ ¸å¿ƒåŠŸèƒ½åªæ˜¯æ“ä½œå†…å­˜ä¸­çš„æ•°æ®ï¼Œå¯¹CPUçš„è´Ÿè½½å¹¶ä¸é«˜ã€‚</p><p>ç›¸æ¯”MySQLåœ¨å¢åˆ æ”¹æ•°æ®çš„æ—¶å€™éœ€è¦å…³æ³¨æ•°æ®åº“ä¸­çš„å„ç§çº¦æŸï¼Œè¿™äº›æ£€æŸ¥å°±å¢åŠ äº†è´Ÿæ‹…ï¼Œè€—æ—¶ä¹Ÿä¼šè¢«Redisçš„ç®€å•ä¿®æ”¹æ›´é•¿ã€‚</p><p>å¦å¤–ï¼ŒIOå¤šè·¯å¤ç”¨æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼Œå®ƒæ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„æ¥å£ï¼ˆæ¯”å¦‚Linuxæä¾›çš„Cè¯­è¨€æ¥å£ï¼Œè€ŒRedisæ­£å¥½å°±æ˜¯Cè¯­è¨€ç¼–å†™çš„ï¼‰è®©ä¸€ä¸ªçº¿ç¨‹æœ‰åŠæ³•åŒæ—¶å¤„ç†å¤šä¸ªç½‘ç»œè¯·æ±‚ã€‚å¦‚æœæ²¡æœ‰å¤šè·¯å¤ç”¨ï¼Œä¸€ä¸ªçº¿ç¨‹å°±åªèƒ½ç»™ä¸€ä¸ªè¯·æ±‚æœåŠ¡ï¼ŒRedisçš„å•çº¿ç¨‹è®¾è®¡å°±ä¸å¥½ç”¨äº†ã€‚å…·ä½“å¯ä»¥ç‚¹å‡»é“¾æ¥æŸ¥çœ‹æœ¬ç«™çš„åšå®¢ã€‚<a href="https://blog.musnow.top/posts/3390191280">ã€Linuxã€‘é«˜çº§IOå’Œå¤šè·¯è½¬æ¥ | select&#x2F;poll&#x2F;epoll | æ…•é›ªçš„å¯’èˆ</a></p><h1 id="5-Redisçš„å•çº¿ç¨‹æ¨¡å‹"><a href="#5-Redisçš„å•çº¿ç¨‹æ¨¡å‹" class="headerlink" title="5.Redisçš„å•çº¿ç¨‹æ¨¡å‹"></a>5.Redisçš„å•çº¿ç¨‹æ¨¡å‹</h1><p>ä¸Šæ–‡æåˆ°ï¼ŒRedisæ˜¯é‡‡ç”¨å•çº¿ç¨‹æ¨¡å‹è¿›è¡Œè®¾è®¡çš„ï¼Œè™½ç„¶é«˜ç‰ˆæœ¬Rediså¼•å…¥äº†å¤šçº¿ç¨‹ï¼Œä½†åªé™äºç½‘ç»œIOéƒ¨åˆ†ï¼ˆå¤šçº¿ç¨‹æ¥å¤„ç†ç½‘ç»œè¯·æ±‚ï¼‰å®é™…çš„å­˜å‚¨æ“ä½œè¿˜æ˜¯ä½¿ç”¨å•çº¿ç¨‹æ¥å¤„ç†çš„ã€‚</p><p>å¤ä¹ ä¸€ä¸‹å¤šçº¿ç¨‹å¹¶å‘å¯èƒ½å¯¼è‡´çš„é—®é¢˜å§ï¼šå‡è®¾ä¸¤ä¸ªRediså®¢æˆ·ç«¯é“¾æ¥äº†æœåŠ¡å™¨ï¼Œéƒ½å¸Œæœ›å¯¹åŒä¸€ä¸ªkeyè¿›è¡Œsetæ“ä½œï¼Œå®¢æˆ·ç«¯Aå¸Œæœ›å°†keyåŠ ä¸€ï¼Œå®¢æˆ·ç«¯Bä¹Ÿå¸Œæœ›å°†keyåŠ ä¸€ï¼Œè¿™ä¸¤ä¸ªè¯·æ±‚å‡ ä¹åŒæ—¶å‘é€ç»™Redisçš„æœåŠ¡å™¨ï¼Œå‡è®¾RedisæœåŠ¡å™¨é‡‡ç”¨å¤šçº¿ç¨‹æ¥å¤„ç†ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½å‡ºç°</p><ul><li>Açš„è¯·æ±‚è¯»å–äº†keyçš„å½“å‰å€¼ï¼Œå‡†å¤‡è¿›è¡ŒåŠ ä¸€æ“ä½œï¼›</li><li>Bçš„è¯·æ±‚è¯»å–äº†keyçš„å½“å‰å€¼ï¼Œä¹Ÿå‡†å¤‡è¿›è¡ŒåŠ ä¸€æ“ä½œï¼›</li><li>ç”±äºä¸¤ä¸ªè¯»å–å‡ ä¹æ˜¯åŒæ—¶å‘ç”Ÿçš„ï¼ŒAå’ŒBçš„å¤„ç†çº¿ç¨‹è¯»å–åˆ°çš„keyçš„å€¼ä¸€è‡´ï¼›</li><li>æœ€ç»ˆå¯¼è‡´keyåªè¢«åŠ ä¸€äº†ï¼ˆå®é™…éœ€è¦åŠ äºŒï¼‰ï¼›</li></ul><p>è€Œå®é™…ä¸Šï¼ŒRedisé‡‡ç”¨å•çº¿ç¨‹æ¨¡å‹ï¼ŒAå’ŒBçš„è¯·æ±‚è‚¯å®šä¼šæœ‰ä¸ªå…ˆåé¡ºåºï¼Œæœ€ç»ˆå¤„ç†æ˜¯<strong>ä¸²è¡Œ</strong>ï¼ˆä¾æ¬¡æ‰§è¡Œï¼‰çš„ï¼Œè¦ä¹ˆæ˜¯å…ˆå¤„ç†Açš„åŠ ä¸€ï¼Œå†å¤„ç†Bçš„åŠ ä¸€ï¼Œæœ€ç»ˆè‚¯å®šèƒ½å¾—åˆ°åŠ äºŒçš„æ­£ç¡®ç»“æœã€‚</p><p>Redisåœ¨ç½‘ç»œIOä¸Šå¼•å…¥å¤šçº¿ç¨‹ï¼Œä½†åœ¨æ ¸å¿ƒå¤„ç†ä¿æŒå•çº¿ç¨‹ï¼Œå¯ä»¥åœ¨æé«˜ç½‘ç»œIOå¤„ç†æ•ˆç‡çš„åŸºç¡€ä¸Šï¼Œä¿è¯å¯¹æ•°æ®çš„æ“ä½œä¸€å®šæ˜¯ä¸²è¡Œçš„ã€‚</p><blockquote><p>è¿™å°±å¥½æ¯”ä¸€ä¸ªé£Ÿå ‚åªæœ‰ä¸€ä¸ªæ‰“é¥­çª—å£ï¼Œä¸­åˆä¸‹è¯¾äº†ä¸€å †äººå»é£Ÿå ‚ï¼ˆç½‘ç»œIOå¤šçº¿ç¨‹ï¼‰ï¼Œä½†è¿›äº†é£Ÿå ‚ä¹‹åè¿˜æ˜¯å¾—æ’é˜Ÿæ‰“é¥­ï¼ˆä¸²è¡Œï¼‰ã€‚</p></blockquote><p>å› ä¸ºRedisçš„æ ¸å¿ƒæ“ä½œå¯¹CPUçš„è´Ÿè½½å¹¶ä¸é«˜ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰å¿…è¦ä½¿ç”¨å¤šçº¿ç¨‹æ¥æé«˜æ•°æ®å¤„ç†æ–¹é¢çš„æ•ˆç‡ï¼ˆå› ä¸ºä½¿ç”¨å¤šçº¿ç¨‹å°±åŠ¡å¿…éœ€è¦åŠ é”&#x2F;è§£é”ä»¥åŠèµ„æºç«äº‰ï¼Œæœ¬æ¥å¼€é—¨å–ä¸œè¥¿åªéœ€è¦ä¸€ä¸‹å­å°±æå®šäº†ï¼Œç°åœ¨è¿˜å¤šäº†è§£é”&#x2F;å…³é—¨ä¸Šé”çš„æ­¥éª¤ï¼Œæ•ˆç‡å¯èƒ½ä¸å¢åé™ï¼‰ã€‚</p><h1 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h1>]]></content>
    
    
    <summary type="html">ä»€ä¹ˆæ˜¯Redisï¼Ÿä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Ÿ</summary>
    
    
    
    <category term="ç¼–ç¨‹å­¦ä¹ " scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="Redis" scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/Redis/"/>
    
    
    <category term="Redis" scheme="https://blog.musnow.top/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>ã€Dockerã€‘giteaçš„sshå®¹å™¨ç›´é€š</title>
    <link href="https://blog.musnow.top/posts/1063684344/"/>
    <id>https://blog.musnow.top/posts/1063684344/</id>
    <published>2024-02-07T07:01:43.000Z</published>
    <updated>2024-02-24T03:01:58.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-è·Ÿç€æ–‡æ¡£èµ°"><a href="#1-è·Ÿç€æ–‡æ¡£èµ°" class="headerlink" title="1.è·Ÿç€æ–‡æ¡£èµ°"></a>1.è·Ÿç€æ–‡æ¡£èµ°</h1><p>giteaçš„å®‰è£…æ¯”è¾ƒç®€å•ï¼Œç›´æ¥ä½¿ç”¨å®˜æ–¹æ–‡æ¡£ä¸­çš„docker-composeæ–‡ä»¶å³å¯ã€‚å¦‚æœæƒ³å®ç°sshå®¹å™¨ç›´é€šï¼Œéœ€è¦å¯¹è¿™ä¸ªdocker-composeæ–‡ä»¶åšä¸€å®šä¿®æ”¹ã€‚</p><blockquote><p>å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£…dockerï¼Œå‚è€ƒæœ¬ç«™æ•™ç¨‹ <a href="https://blog.musnow.top/posts/2069190154">linuxå®‰è£…docker</a>ï¼›</p></blockquote><p>giteaçš„å®˜æ–¹æ–‡æ¡£ä¸Šæœ‰å…³äºdockerå®¹å™¨sshç›´é€šçš„æ•™ç¨‹ï¼Œä½†æ˜¯å†™çš„ä¸å¤Ÿæ¸…æ™°ï¼Œæœ‰äº›é—®é¢˜æˆ‘æ²¡æœ‰ææ‡‚ã€‚æœ¬æ–‡åŸºäºæˆ‘çš„æŠ˜è…¾è®°å½•å’Œdockerå®‰è£…çš„gitea 1.21.4æ–‡æ¡£</p><p><a href="https://docs.gitea.com/zh-cn/next/installation/install-with-docker#ssh-%E5%AE%B9%E5%99%A8%E7%9B%B4%E9%80%9A">ä½¿ç”¨ Docker å®‰è£… | Gitea Documentation</a></p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/4a6a40b4f39a75d32fc7fc45919316ba.png" alt="image.png"></p><p>é¦–å…ˆæ˜¯è·Ÿç€æ–‡ç« é‡Œé¢çš„æ­¥éª¤åšï¼Œå…ˆåˆ›å»ºä¸€ä¸ªgitå­ç”¨æˆ·ã€‚wslä¸­åˆ›å»ºå­ç”¨æˆ·çš„å‘½ä»¤å‚è€ƒæœ¬ç«™åšå®¢ï¼ˆä½¿ç”¨adduserå‘½ä»¤ï¼‰ï¼Œæ³¨æ„åˆ›å»ºçš„gitç”¨æˆ·çš„uidå’Œgidæ˜¯1001ï¼Œdocker-composeä¸­çš„ç¯å¢ƒå˜é‡éœ€è¦å¯¹åº”ä¿®æ”¹ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">environment:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">USER_UID=1001</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">USER_GID=1001</span></span><br></pre></td></tr></table></figure><p>è¿˜éœ€è¦æ–°å¢ä¸€ä¸ªè·¯å¾„æ˜ å°„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- /home/git/.ssh/:/data/git/.ssh</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šä¸ºäº†é¿å…æ–‡ä»¶è¯»å†™æƒé™é—®é¢˜ï¼Œæˆ‘å»ºè®®åœ¨åˆ›å»ºgitå­ç”¨æˆ·åï¼Œåœ¨è¯¥å­ç”¨æˆ·ä¸­æ“ä½œdocker-composeå’Œæ–°å»ºgiteaçš„æ˜ å°„æ–‡ä»¶å¤¹ï¼Œè¿™æ ·èƒ½ä¿è¯1001ç”¨æˆ·å’Œgiteaå®¹å™¨ä¸€å®šèƒ½è®¿é—®åˆ°æ–‡ä»¶å¤¹ä¸”å…·æœ‰æƒé™ã€‚</p></blockquote><p>åœ¨gitç”¨æˆ·ä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ã€‚å‡ºç°çš„æç¤ºæ¡†å…¨éƒ¨å›è½¦å³å¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u git ssh-keygen -t rsa -b 4096 -C <span class="string">&quot;Gitea Host Key&quot;</span></span><br></pre></td></tr></table></figure><p>éšåæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå³æŠŠ<code>/home/git/.ssh/id_rsa.pub</code>å†™å…¥<code>/home/git/.ssh/authorized_keys</code>æ–‡ä»¶ã€‚æ‰§è¡Œå®Œæ¯•åè¯·ä¸è¦å†æ‰‹åŠ¨ä¿®æ”¹authorized_keysæ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(cat /home/git/.ssh/id_rsa.pub)</span>&quot;</span> &gt;&gt; /home/git/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><p>è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªè„šæœ¬æ¥æ‰§è¡Œsshä¿¡æ¯è½¬å‘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /usr/local/bin/gitea</span><br></pre></td></tr></table></figure><p>å†™å…¥å¦‚ä¸‹å†…å®¹ï¼Œå¯ä»¥é€šè¿‡<code>CTRL+SHIFT+V</code>ç›´æ¥ç²˜è´´ã€‚è¿™é‡Œå‡è®¾ä½ å°†giteaå®¹å™¨çš„22ç«¯å£è½¬å‘åˆ°å®¿ä¸»æœºçš„2222ç«¯å£ï¼ˆå¦‚æœä½ çš„å®¿ä¸»æœºæ˜ å°„ç«¯å£ä¸åŒï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬ä¸­çš„ç«¯å£å·ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -p 2222 -o StrictHostKeyChecking=no git@127.0.0.1 &quot;SSH_ORIGINAL_COMMAND=\&quot;$SSH_ORIGINAL_COMMAND\&quot; $0 $@&quot;</span><br></pre></td></tr></table></figure><p>å› ä¸ºsshå®¹å™¨ç›´é€šéƒ½æ˜¯æœ¬æœºå¤„ç†çš„æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨docker-composeä¸­ç«¯å£æ˜ å°„çš„æ—¶å€™é™åˆ¶æ¥æºIPåœ°å€ä¸ºæœ¬åœ°å›ç¯åœ°å€ï¼Œè¿™æ ·å°±èƒ½ä¿è¯åªæœ‰å®¿ä¸»æœºä¸­èƒ½è®¿é—®2222ç«¯å£åˆ°giteaä¸­ï¼Œè€Œ2222ç«¯å£æ— æ³•ç›´æ¥è¢«å¤–ç•Œè®¿é—®ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ports:</span></span><br><span class="line">  <span class="comment"># [...]</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;127.0.0.1:2222:22&quot;</span></span><br></pre></td></tr></table></figure><h2 id="sshç›´é€šæµç¨‹"><a href="#sshç›´é€šæµç¨‹" class="headerlink" title="sshç›´é€šæµç¨‹"></a>sshç›´é€šæµç¨‹</h2><p>é…ç½®å®Œæ¯•sshç›´é€šåï¼Œgitæ“ä½œæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>ç”¨æˆ·ä½¿ç”¨<code>git@IPåœ°å€</code>è®¿é—®ä¸»æœºï¼Œé»˜è®¤è®¿é—®22ç«¯å£ï¼›</li><li>ä¸»æœºéªŒè¯gitç”¨æˆ·ä¸‹<code>.ssh/authorized_keys</code>çš„<code>command</code>å¼€å¤´çš„å…¬é’¥ä¸­ï¼Œå‘ç°ç”¨æˆ·å…¬é’¥ï¼›</li><li>ä¸»æœºæ‰§è¡ŒcommandæŒ‡å®šçš„è„šæœ¬ï¼Œå°†æ­¤æ¬¡è¯·æ±‚çš„ä¿¡æ¯è½¬å‘ç»™giteaå®¹å™¨çš„sshç«¯å£ï¼›</li><li>giteaå®¹å™¨æ‰§è¡Œsshè¯·æ±‚å¤„ç†ï¼›</li></ol><p>å¦‚æœä¸ä½¿ç”¨å®¹å™¨ç›´é€šï¼Œä½ å¯ä»¥é€‰æ‹©ç”¨httpsæ¥è¿›è¡Œgitæ“ä½œï¼Œæˆ–è€…åœ¨sshä½¿ç”¨æ—¶æ·»åŠ ç«¯å£å·ã€‚äºŒè€…éƒ½ä¼šæ¯”ç›´æ¥ä½¿ç”¨sshéº»çƒ¦ä¸€äº›ã€‚</p><h1 id="2-å®‰è£…sshæœåŠ¡"><a href="#2-å®‰è£…sshæœåŠ¡" class="headerlink" title="2.å®‰è£…sshæœåŠ¡"></a>2.å®‰è£…sshæœåŠ¡</h1><p>å¦å¤–ï¼Œé»˜è®¤æƒ…å†µä¸‹wslä¸­æ˜¯æ²¡æœ‰sshæœåŠ¡çš„ï¼Œä½ ä¼šå‘ç°22ç«¯å£æ— äººä½¿ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root:~]# netstat -nltp | grep 22</span><br><span class="line">tcp        0      0 127.0.0.1:2222          0.0.0.0:*               LISTEN      2816/docker-proxy</span><br></pre></td></tr></table></figure><p>éœ€è¦å®‰è£…ä¸€ä¸‹sshæœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y openssh-server</span><br><span class="line">sudo systemctl start sshd</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æœåŠ¡çŠ¶æ€ä»¥åŠæ˜¯å¦å¯ç”¨äº†å¼€æœºè‡ªå¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root:~]# systemsystemctl status sshd</span><br><span class="line">â— ssh.service - OpenBSD Secure Shell server</span><br><span class="line">     Loaded: loaded (/lib/systemd/system/ssh.service; enabled; vendor preset: enabled)</span><br><span class="line">     Active: active (running) since Wed 2024-02-07 14:59:06 CST; 9min ago</span><br><span class="line">       Docs: man:sshd(8)</span><br><span class="line">             man:sshd_config(5)</span><br><span class="line">   Main PID: 5202 (sshd)</span><br><span class="line">      Tasks: 1 (limit: 9527)</span><br><span class="line">     Memory: 1.7M</span><br><span class="line">     CGroup: /system.slice/ssh.service</span><br><span class="line">             â””â”€5202 &quot;sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startups&quot;</span><br><span class="line"></span><br><span class="line">Feb 07 14:59:06 wsl-ubuntu systemd[1]: Starting OpenBSD Secure Shell server...</span><br><span class="line">Feb 07 14:59:06 wsl-ubuntu sshd[5202]: Server listening on 0.0.0.0 port 22.</span><br><span class="line">Feb 07 14:59:06 wsl-ubuntu sshd[5202]: Server listening on :: port 22.</span><br><span class="line">Feb 07 14:59:06 wsl-ubuntu systemd[1]: Started OpenBSD Secure Shell server.</span><br><span class="line">[root:~]# sudo systemctl is-enabled sshd</span><br><span class="line">alias</span><br><span class="line">[root:~]# sudo systemctl is-enabled ssh</span><br><span class="line">enabled</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å†çœ‹çœ‹22ç«¯å£ï¼Œå°±æœ‰äººå¹²æ´»äº†ï¼ŒsshdæœåŠ¡å¯åŠ¨æˆåŠŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root:~]# netstat -nltp | grep 22</span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      5202/sshd: /usr/sbi</span><br><span class="line">tcp        0      0 127.0.0.1:2222          0.0.0.0:*               LISTEN      2816/docker-proxy</span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      5202/sshd: /usr/sbi</span><br></pre></td></tr></table></figure><h1 id="3-webç•Œé¢æ·»åŠ ç”¨æˆ·sshå…¬é’¥"><a href="#3-webç•Œé¢æ·»åŠ ç”¨æˆ·sshå…¬é’¥" class="headerlink" title="3.webç•Œé¢æ·»åŠ ç”¨æˆ·sshå…¬é’¥"></a>3.webç•Œé¢æ·»åŠ ç”¨æˆ·sshå…¬é’¥</h1><p>éšåå°±æ˜¯å’Œgithubä¸€æ ·çš„æ“ä½œï¼Œ åœ¨giteaçš„webé¡µé¢æ·»åŠ ç”¨æˆ·çš„å…¬é’¥ã€‚</p><p><a href="https://blog.musnow.top/posts/3625274788/">ã€Linuxã€‘å¦‚ä½•ä½¿ç”¨ ssh å¯†é’¥é…ç½® git</a></p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/4e28dd20b29a4e7ebaabcce3c09ac579.png" alt="image.png"></p><p>æ·»åŠ å®Œæ¯•åï¼Œæ£€æŸ¥ä¸€ä¸‹gitç”¨æˆ·é‡Œé¢çš„<code>/home/git/.ssh/authorized_keys</code>æ–‡ä»¶æ˜¯å¦æœ‰å˜åŠ¨ï¼Œæ–‡ä»¶åº”è¯¥å¦‚ä¸‹æ ¼å¼ï¼Œä¼šæœ‰ä¸€ä¸ª<code>command=</code>å­˜æ”¾äº†ä½ åˆšåˆšåœ¨gitea webé¡µé¢æ·»åŠ çš„ç”¨æˆ·å…¬é’¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh-rsa &lt;Gitea Host Key&gt;</span><br><span class="line"></span><br><span class="line"># other keys from users</span><br><span class="line">command=&quot;/usr/local/bin/gitea --config=/data/gitea/conf/app.ini serv key-1&quot;,no-port-forwarding,no-X11-forwarding,no-agent-forwarding,no-pty &lt;user pubkey&gt;</span><br></pre></td></tr></table></figure><p>æ–‡æ¡£ä¸­å…³äºè¿™ä¸€å—çš„æè¿°ä¸å¤Ÿæ¸…æ¥šï¼ˆæˆ‘æ„Ÿè§‰æ˜¯æœºç¿»çš„é—®é¢˜ï¼‰</p><blockquote><p>åŸæ–‡ï¼šé‡è¦æç¤ºï¼šæ¥è‡ª git ç”¨æˆ·çš„å…¬é’¥éœ€è¦â€œæŒ‰åŸæ ·â€æ·»åŠ ï¼Œè€Œé€šè¿‡ Gitea ç½‘ç»œç•Œé¢æ·»åŠ çš„æ‰€æœ‰å…¶ä»–å…¬é’¥å°†ä»¥ <code>command=&quot;/app [...]</code> ä½œä¸ºå‰ç¼€ã€‚</p></blockquote><p>å…¶å®è¿™ä¸ªè¯´æ˜çš„æ„æ€æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹çš„<code>authorized_keys</code>æ–‡ä»¶ä¸­åº”è¯¥åªæœ‰ä¸‹é¢çš„å†…å®¹ï¼ˆå³â€œæŒ‰åŸæ ·â€æ·»åŠ ï¼‰ï¼Œè€Œgitea webé¡µé¢æ·»åŠ çš„å…¶ä»–å…¬é’¥åº”è¯¥éƒ½æ˜¯ä»¥<code>command=&quot;</code> ä½œä¸ºå‰ç¼€ï¼Œ<strong>è‡ªåŠ¨</strong>æ·»åŠ åˆ°<code>authorized_keys</code>æ–‡ä»¶ä¹‹åçš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-rsa &lt;Gitea Host Key&gt;</span><br></pre></td></tr></table></figure><p>è¯´ç™½äº†å°±æ˜¯ï¼Œåœ¨æ‰§è¡Œå®Œæ¯•ä¸Šæ–‡æåˆ°çš„å°†<code>id_rsa.pub</code>æ–‡ä»¶çš„å†…å®¹å†™å…¥<code>authorized_keys</code>çš„æ“ä½œåï¼Œ<strong>æˆ‘ä»¬å°±ä¸è¦æ‰‹åŠ¨ä¿®æ”¹authorized_keysè¿™ä¸ªæ–‡ä»¶äº†</strong>ï¼å¦‚æœå‡ºç°é—®é¢˜ï¼Œå†ä¾ç…§æ–‡æ¡£ä¸­çš„è¿™ä¸ªæç¤ºæ£€æŸ¥è¯¥æ–‡ä»¶ä¸­çš„å…¬é’¥æ ¼å¼æ˜¯å¦æ­£ç¡®ã€‚</p><p>å®˜ç½‘æ–‡æ¡£ä¸­è¿˜æåˆ°äº†ä¸‹é¢å‡ ä¸ªæ³¨æ„äº‹é¡¹ï¼Œæˆ‘ä»¬å…¨éƒ½ä¸ç”¨ç®¡ï¼åªè¦ä½ æ²¡æœ‰ä¿®æ”¹è¿‡é…ç½®æ–‡ä»¶å’Œgiteaå®¹å™¨ä¸­çš„ç¯å¢ƒï¼Œè¿™äº›é…ç½®é¡¹éƒ½æ˜¯é»˜è®¤æƒ…å†µä¸‹å°±OKäº†çš„ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/4a3b6349ff4e3db039e87550910597d8.png" alt="image.png"></p><h1 id="4-éªŒè¯æ˜¯å¦ç›´é€šæˆåŠŸ"><a href="#4-éªŒè¯æ˜¯å¦ç›´é€šæˆåŠŸ" class="headerlink" title="4.éªŒè¯æ˜¯å¦ç›´é€šæˆåŠŸ"></a>4.éªŒè¯æ˜¯å¦ç›´é€šæˆåŠŸ</h1><p>å°è¯•éªŒè¯sshæ˜¯å¦æˆåŠŸï¼Œè¿™é‡Œçš„ipæ˜¯wslçš„æœ¬æœºipï¼Œå¯ä»¥åœ¨wslä¸­é€šè¿‡ifconfigå‘½ä»¤æŸ¥çœ‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@172.26.39.91</span><br></pre></td></tr></table></figure><p>å¦‚æœå‡ºç°ä¸‹é¢çš„æƒ…å†µï¼Œè¯´æ˜22ç«¯å£æ²¡æœ‰è¢«æˆåŠŸå¼€æ”¾ï¼Œè¯·æ£€æŸ¥:</p><ul><li>å®¿ä¸»æœºä¸­çš„22ç«¯å£æ˜¯å¦å·²ç»é…ç½®äº†sshdæœåŠ¡ï¼Œå¹¶æ­£å¸¸ç›‘å¬22ç«¯å£ï¼›</li><li>åœ¨webé¡µé¢æ·»åŠ çš„ç”¨æˆ·å…¬é’¥æ˜¯å¦æ·»åŠ åˆ°äº†<code>/home/git/.ssh/authorized_keys</code>æ–‡ä»¶ä¸­ï¼›</li><li><code>/usr/local/bin/gitea</code>è„šæœ¬ä¸­çš„å‘½ä»¤æ— è¯¯ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PS D:\test-git&gt; git clone git@172.26.39.91:musnows/test-action.git</span><br><span class="line">Cloning into &#x27;test-action&#x27;...</span><br><span class="line">ssh: connect to host 172.26.39.91 port 22: Connection refused</span><br><span class="line">fatal: Could not read from remote repository.</span><br><span class="line"></span><br><span class="line">Please make sure you have the correct access rights</span><br><span class="line">and the repository exists.</span><br></pre></td></tr></table></figure><p>å¦‚æœçœ‹åˆ°äº†ä¸‹é¢çš„å†…å®¹ï¼Œå¯ä»¥è¯´æ˜æˆ‘ä»¬wslä¸­çš„çš„sshæœåŠ¡å·²ç»æˆåŠŸå¯åŠ¨äº†ï¼Œä½†æ˜¯æ²¡æœ‰æˆåŠŸé€šè¿‡è„šæœ¬éªŒè¯gitç”¨æˆ·ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PS D:\test-git&gt; ssh -T git@172.26.39.91</span><br><span class="line">The authenticity of host &#x27;172.26.39.91 (172.26.39.91)&#x27; can&#x27;t be established.</span><br><span class="line">ED25519 key fingerprint is SHA256:xRPtWVSIsHrqmP3VaBD+ZR24nE6SWmgjWUYENN0IfB8.</span><br><span class="line">This key is not known by any other names</span><br><span class="line">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="line">Warning: Permanently added &#x27;172.26.39.91&#x27; (ED25519) to the list of known hosts.</span><br><span class="line">bash: line 1: /usr/local/bin/gitea: Permission denied</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºæˆ‘ä»¬çš„gitç”¨æˆ·æ²¡æœ‰åŠæ³•æ‰§è¡Œ<code>/usr/local/bin/gitea</code>è„šæœ¬ï¼Œè¿˜è®°å¾—å—ï¼Œè¿™ä¸ªè„šæœ¬æ˜¯é€šè¿‡sudoåˆ›å»ºçš„ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œä¸”åªæœ‰rootç”¨æˆ·æœ‰æƒé™è®¿é—®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root:~]# ll /usr/local/bin/gitea</span><br><span class="line">-rw-r--r-- 1 root root 109 Feb  7 14:47 /usr/local/bin/gitea</span><br></pre></td></tr></table></figure><p>è§£å†³åŠæ³•å¾ˆç®€å•ï¼Œå°†å…¶æƒé™æ”¹æˆ777å³å¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root:~]# chmod 777 /usr/local/bin/gitea</span><br><span class="line">[root:~]# ll /usr/local/bin/gitea</span><br><span class="line">-rwxrwxrwx 1 root root 109 Feb  7 14:47 /usr/local/bin/gitea*</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å†æ¬¡æµ‹è¯•ï¼Œå‘ç°æˆåŠŸç›´é€šgiteaå®¹å™¨å†…sshï¼è¿™é‡Œä¼šæ˜¾ç¤ºä½ åœ¨webé¡µé¢ä¸­æ·»åŠ çš„sshå¯†é’¥çš„åå­—<code>user from windows</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PS D:\test-git&gt; ssh -T git@172.26.39.91</span><br><span class="line">Warning: Permanently added &#x27;[127.0.0.1]:2222&#x27; (ED25519) to the list of known hosts.</span><br><span class="line">Hi there, musnows! You&#x27;ve successfully authenticated with the key named user from windows, but Gitea does not provide shell access.</span><br><span class="line">If this is unexpected, please log in with password and setup Gitea under another user.</span><br></pre></td></tr></table></figure><p>å†è¯•è¯•èƒ½ä¸èƒ½é€šè¿‡sshå…‹éš†ä»“åº“ï¼Œæå®šï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PS D:\test-git&gt; git clone git@172.26.39.91:musnows/test-action.git</span><br><span class="line">Cloning into &#x27;test-action&#x27;...</span><br><span class="line">remote: Enumerating objects: 80, done.</span><br><span class="line">remote: Counting objects: 100% (80/80), done.</span><br><span class="line">remote: Compressing objects: 100% (58/58), done.</span><br><span class="line">remote: Total 80 (delta 22), reused 0 (delta 0), pack-reused 0</span><br><span class="line">Receiving objects: 100% (80/80), 56.15 KiB | 9.36 MiB/s, done.</span><br><span class="line">Resolving deltas: 100% (22/22), done.</span><br></pre></td></tr></table></figure><h1 id="5-docker-composeæ–‡ä»¶"><a href="#5-docker-composeæ–‡ä»¶" class="headerlink" title="5.docker-composeæ–‡ä»¶"></a>5.docker-composeæ–‡ä»¶</h1><p>ä¸‹é¢ç»™å‡ºæœ¬æ–‡æ‰€ç”¨çš„giteaå®¹å™¨docker-composeæ–‡ä»¶ï¼Œåªåœ¨å®˜æ–¹æ–‡æ¡£æ‰€æä¾›çš„ç‰ˆæœ¬ä¸Šåšäº†å°‘é‡ä¿®æ”¹ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">gitea:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">gitea/gitea:1.21.4</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">gitea</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">USER_UID=1001</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">USER_GID=1001</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">gitea</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/git/data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/git/.ssh/:/data/git/.ssh</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/timezone:/etc/timezone:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime:ro</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;30000:3000&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;127.0.0.1:2222:22&quot;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œåœ¨åˆå§‹åŒ–giteaçš„æ—¶å€™ä¸è¦ä¿®æ”¹webç•Œé¢å’Œsshçš„ç›‘å¬ç«¯å£ï¼ˆå¯¹åº”çš„æ˜¯å®¹å™¨å†…çš„ç«¯å£ï¼‰ï¼Œå¦åˆ™ä¸Šæ–‡çš„sshç›´é€šå¯èƒ½ä¼šå¤±è´¥ï¼</p><h1 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h1><p>å¦‚æœæœ‰ç–‘é—®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµã€‚</p><p>ç›¸å…³å‚è€ƒï¼š<a href="https://moqiaoduo.cn/310.html">å¦‚ä½•é€šè¿‡Dockeræ­å»ºGiteaå¹¶é…ç½®SSLå’ŒSSHç›´é€š - è«ä¹”å¤šåšå®¢</a></p>]]></content>
    
    
    <summary type="html">dockerå®‰è£…çš„giteaåœ¨wsl2ä¸Šé…ç½®sshå®¹å™¨ç›´é€š</summary>
    
    
    
    <category term="ç¼–ç¨‹å­¦ä¹ " scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="DockerçœŸå¥½ç©" scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/Docker%E7%9C%9F%E5%A5%BD%E7%8E%A9/"/>
    
    
    <category term="Docker" scheme="https://blog.musnow.top/tags/Docker/"/>
    
    <category term="è™šæ‹Ÿæœº" scheme="https://blog.musnow.top/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/"/>
    
    <category term="wsl" scheme="https://blog.musnow.top/tags/wsl/"/>
    
    <category term="gitea" scheme="https://blog.musnow.top/tags/gitea/"/>
    
  </entry>
  
  <entry>
    <title>ã€WSLã€‘wslä¸­ubuntuæ— æ³•é€šè¿‡useraddæ·»åŠ ç”¨æˆ·</title>
    <link href="https://blog.musnow.top/posts/803882566/"/>
    <id>https://blog.musnow.top/posts/803882566/</id>
    <published>2024-02-07T06:59:43.000Z</published>
    <updated>2024-02-16T00:58:23.000Z</updated>
    
    <content type="html"><![CDATA[<p>é€‚ç”¨äºhexo-butterflyä¸»é¢˜çš„front-matteræ¨¡æ¿ã€‚</p><h1 id="æƒ…å†µè¯´æ˜"><a href="#æƒ…å†µè¯´æ˜" class="headerlink" title="æƒ…å†µè¯´æ˜"></a>æƒ…å†µè¯´æ˜</h1><p>åœ¨wsl2ä¸­çš„ubuntu22.04æ— æ³•ä½¿ç”¨useraddæ·»åŠ ç”¨æˆ·ï¼Œè¡¨ç°ä¸ºæ‰§è¡Œå‘½ä»¤åï¼Œåªå‡ºç°è¯¥ç”¨æˆ·å’Œç”¨æˆ·ç»„ï¼Œä½†<code>/home</code>ç›®å½•ä¸‹æ²¡æœ‰å‡ºç°è¯¥ç”¨æˆ·çš„å®¶ç›®å½•æ–‡ä»¶å¤¹ï¼Œä¸”æ— æ³•ä½¿ç”¨<code>su - ç”¨æˆ·å</code>æˆåŠŸåˆ‡æ¢åˆ°è¯¥ç”¨æˆ·ä¸Šã€‚</p><p>å¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘å…ˆä»wslå­ç”¨æˆ·åˆ‡æ¢åˆ°rootç”¨æˆ·ï¼Œç„¶åæ‰§è¡Œuseraddå‘½ä»¤ï¼Œå‘ç°ç”¨æˆ·åˆ›å»ºæ²¡æœ‰å®Œå…¨æˆåŠŸã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">wsl:~$ sudo su - </span><br><span class="line"></span><br><span class="line">root:~# useradd git</span><br><span class="line">root:~# ls /home</span><br><span class="line">wsl</span><br><span class="line">root:~# sudo adduser git</span><br><span class="line">adduser: The user `git&#x27; already exists.</span><br><span class="line">root:~# userdel -r git</span><br><span class="line">userdel: git mail spool (/var/mail/git) not found</span><br><span class="line">userdel: git home directory (/home/git) not found</span><br><span class="line">root:~# userdel -r git</span><br><span class="line">userdel: user &#x27;git&#x27; does not exist</span><br></pre></td></tr></table></figure><h1 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h1><p><del>è¿™æ˜¯å› ä¸ºwsl2å’Œä¼ ç»Ÿçš„VMwareç±»å‹è™šæ‹Ÿæœºæœ‰ä¸€å®šåŒºåˆ«ï¼Œå…¶ä¸æ”¯æŒä½¿ç”¨useraddç›´æ¥æ·»åŠ ç”¨æˆ·</del>ï¼Œè€Œæ˜¯æä¾›äº†adduserå‘½ä»¤æ¥å¤„ç†ã€‚å‡†ç¡®æ¥è¯´æ˜¯Ubuntu22.04ä¸æ”¯æŒuseraddï¼Œè€Œæ˜¯éœ€è¦ä½¿ç”¨adduserã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo adduser &lt;æ–°çš„ç”¨æˆ·å&gt;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è¿™ä¸ªå‘½ä»¤åˆ™å¯ä»¥æ­£å¸¸åˆ›å»ºç”¨æˆ·ï¼Œå¦‚ä¸‹æ‰€ç¤ºæˆ‘åˆ›å»ºäº†ä¸€ä¸ªç”¨æˆ·åä¸ºgitçš„ç”¨æˆ·ã€‚éœ€è¦å¡«å†™ç”¨æˆ·ä¿¡æ¯çš„éƒ¨åˆ†ç›´æ¥å›è½¦è·³è¿‡å³å¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root:~# sudo adduser git</span><br><span class="line">Adding user `git&#x27; ...</span><br><span class="line">Adding new group `git&#x27; (1001) ...</span><br><span class="line">Adding new user `git&#x27; (1001) with group `git&#x27; ...</span><br><span class="line">Creating home directory `/home/git&#x27; ...</span><br><span class="line">Copying files from `/etc/skel&#x27; ...</span><br><span class="line">New password:</span><br><span class="line">Retype new password:</span><br><span class="line">passwd: password updated successfully</span><br><span class="line">Changing the user information for git</span><br><span class="line">Enter the new value, or press ENTER for the default</span><br><span class="line">        Full Name []:</span><br><span class="line">        Room Number []:</span><br><span class="line">        Work Phone []:</span><br><span class="line">        Home Phone []:</span><br><span class="line">        Other []:</span><br><span class="line">Is the information correct? [Y/n] y</span><br><span class="line">root:~# ls /home</span><br><span class="line">git  wsl</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨idå‘½ä»¤å¯ä»¥æŸ¥çœ‹æ–°ç”¨æˆ·çš„ç”¨æˆ·ç»„ä»¥åŠuidç­‰ç›¸å…³ä¿¡æ¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root:~# id git</span><br><span class="line">uid=1001(git) gid=1001(git) groups=1001(git)</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œè¯¥æ–°ç”¨æˆ·ä¸åœ¨<code>/etc/sudoers</code>æ–‡ä»¶ä¸­ï¼Œæ— æ³•ä½¿ç”¨sudoå‘½ä»¤ã€‚éœ€è¦ä¿®æ”¹è¯¥æ–‡ä»¶ï¼Œåœ¨å¦‚ä¸‹ä½ç½®ä¹‹åæ·»åŠ ä¸€è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root ALL=(ALL:ALL) ALL</span><br><span class="line"># æ–°å¢æ­¤è¡Œ</span><br><span class="line">ç”¨æˆ·å ALL=(ALL:ALL) ALL</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">wslä¸­ubuntuæ— æ³•é€šè¿‡useraddæ·»åŠ ç”¨æˆ·,åº”è¯¥ä½¿ç”¨adduserå‘½ä»¤</summary>
    
    
    
    <category term="ç¼–ç¨‹å­¦ä¹ " scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="Linux" scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/Linux/"/>
    
    
    <category term="è™šæ‹Ÿæœº" scheme="https://blog.musnow.top/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/"/>
    
    <category term="wsl" scheme="https://blog.musnow.top/tags/wsl/"/>
    
  </entry>
  
  <entry>
    <title>ã€sqlite3ã€‘MySQL8è½¬sqlite3éœ€è¦å¯¹sqlåšçš„ä¸€äº›å¤„ç†</title>
    <link href="https://blog.musnow.top/posts/2778694447/"/>
    <id>https://blog.musnow.top/posts/2778694447/</id>
    <published>2024-02-06T03:19:37.000Z</published>
    <updated>2024-02-06T04:07:58.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é—®é¢˜æ¥æº"><a href="#é—®é¢˜æ¥æº" class="headerlink" title="é—®é¢˜æ¥æº"></a>é—®é¢˜æ¥æº</h1><p>æœ€è¿‘ç¼–å†™æˆ‘çš„kookæœºå™¨äººçš„æ—¶å€™ï¼Œå‘ç°MySQLå¯¹äºè¿™ç§ä½è®¿é—®é¢‘æ¬¡çš„åº”ç”¨å¹¶ä¸å‹å¥½ï¼Œç»å¸¸å‡ºç°æ–­è¿çš„é—®é¢˜ï¼Œå…·ä½“åˆ°pythonä¸­çš„æŠ¥é”™å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pymysql.err.InterfaceError: (0, &#x27;&#x27;)</span><br></pre></td></tr></table></figure><p>å‡ºç°è¿™ç§æŠ¥é”™ï¼Œå°±å¯ä»¥è®¤ä¸ºæ˜¯MySQLé‚£ç«¯å› ä¸ºè‡ªèº«ç­–ç•¥ä¸­æ–­äº†å’Œä½ çš„åº”ç”¨çš„é“¾æ¥ã€‚å› ä¸ºæˆ‘çš„æœºå™¨äººå’ŒMySQLæ˜¯åœ¨åŒä¸€å°ä¸»æœºä¸Šï¼Œè‚¯å®šä¸æ˜¯ç½‘ç»œæœ¬èº«é—®é¢˜å¯¼è‡´çš„ã€‚</p><p>æ‰€ä»¥æˆ‘éœ€è¦å°†MySQLæ•°æ®åº“æ¢æˆsqlite3æ•°æ®åº“ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/701727d98b31f035e72bef4e76b341a1.png"></p><h1 id="MySQLè½¬sqlite3"><a href="#MySQLè½¬sqlite3" class="headerlink" title="MySQLè½¬sqlite3"></a>MySQLè½¬sqlite3</h1><h2 id="å¯¼å‡ºMySQLä¸­çš„æ•°æ®"><a href="#å¯¼å‡ºMySQLä¸­çš„æ•°æ®" class="headerlink" title="å¯¼å‡ºMySQLä¸­çš„æ•°æ®"></a>å¯¼å‡ºMySQLä¸­çš„æ•°æ®</h2><p>å¥½åœ¨æˆ‘çš„æœºå™¨äººä½¿ç”¨çš„æ˜¯pythonçš„peeweeè¿™ä¸ªORMåº“ï¼Œåªéœ€è¦ä¿®æ”¹åº•å±‚çš„DBå¼•æ“å°±èƒ½å¿«é€Ÿåœ¨MySQLå’Œsqlite3ä¹‹é—´åˆ‡æ¢ã€‚æˆ‘ä»¬è¦è§£å†³çš„åªæ˜¯æ€ä¹ˆæŠŠMySQL8.0.30çš„æ•°æ®å¯¼å…¥åˆ°sqlite3ä¸­ã€‚</p><blockquote><p>æœ¬æ–‡æµ‹è¯•ä½¿ç”¨çš„ç‰ˆæœ¬ä¸ºï¼š<code>MySQL 8.0.30</code> å’Œ <code>sqlite3 3.44.0</code></p></blockquote><p>é¦–å…ˆæ˜¯ä»MySQLå°†æ•°æ®åº“é‡Œé¢çš„æ‰€æœ‰æ•°æ®å¯¼å‡ºä¸ºsqlæ–‡ä»¶ï¼Œå› ä¸ºæˆ‘å®‰è£…äº†1panelæœåŠ¡å™¨é¢æ¿ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨é¢æ¿çš„å¤‡ä»½åŠŸèƒ½ï¼Œå†æŠŠå¤‡ä»½å¥½çš„tarä¸‹è½½ä¸‹æ¥ï¼ˆé‡Œé¢å°±æ˜¯sqlæ–‡ä»¶ï¼‰</p><p>è¿™é‡Œç»™å‡ºç”¨å‘½ä»¤è¡Œæ¥å¤„ç†çš„æ–¹å¼ï¼Œä¸€èˆ¬ä½¿ç”¨çš„å·¥å…·ä¸ºmysqldumpï¼Œåœ¨å®‰è£…MySQLçš„æ—¶å€™è¿™ä¸ªå·¥å…·åº”è¯¥å°±ä¼šè¿å¸¦å®‰è£…ã€‚æˆ‘çš„MySQLæ˜¯ç”¨dockerå®‰è£…çš„ï¼Œdockerå®¹å™¨å†…çš„ç»ˆç«¯ä¹Ÿæœ‰è¿™ä¸ªå‘½ä»¤å·¥å…·ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@RainYun-8aNbbsmA:~/docker]# docker exec -it mysql /bin/bash</span><br><span class="line">bash-4.4# mysqldump</span><br><span class="line">Usage: mysqldump [OPTIONS] database [tables]</span><br><span class="line">OR     mysqldump [OPTIONS] --databases [OPTIONS] DB1 [DB2 DB3...]</span><br><span class="line">OR     mysqldump [OPTIONS] --all-databases [OPTIONS]</span><br><span class="line">For more options, use mysqldump --help</span><br><span class="line">bash-4.4# </span><br></pre></td></tr></table></figure><p>å¯¼å‡ºæ•´ä¸ªæ•°æ®åº“çš„æ•°æ®åˆ°sqlçš„å‘½ä»¤å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u username -ppassword dbname &gt; dbname.sqlï¼›</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚æˆ‘æœ‰ä¸ªtestdbæ•°æ®åº“ï¼Œå°†å…¶å¯¼å…¥testdb.sqlçš„å‘½ä»¤å¦‚ä¸‹ï¼Œè¿™é‡Œæˆ‘ç›´æ¥ä½¿ç”¨äº†rootç”¨æˆ·æ¥å¤„ç†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -p123456 testdb &gt; testdb.sql</span><br></pre></td></tr></table></figure><p>å› ä¸ºåœ¨å‘½ä»¤è¡Œä½¿ç”¨å¯†ç è¢«è®¤ä¸ºæ˜¯ä¸å®‰å…¨çš„ï¼Œæ‰€ä»¥é”®å…¥å¦‚ä¸Šå‘½ä»¤çš„æ—¶å€™ä¼šæœ‰ä¸€ä¸ªè­¦å‘Šï¼Œå¯ä»¥å¿½ç•¥å®ƒã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump: [Warning] Using a password on the command line interface can be insecure.</span><br></pre></td></tr></table></figure><p>lsæŸ¥çœ‹ä¸€ä¸‹ï¼Œå½“å‰è·¯å¾„ä¸Šå·²ç»æœ‰æˆ‘ä»¬éœ€è¦çš„sqlæ•°æ®æ–‡ä»¶äº†ã€‚</p><h2 id="dockerå†…æ–‡ä»¶æ‹·è´åˆ°å®¿ä¸»æœº"><a href="#dockerå†…æ–‡ä»¶æ‹·è´åˆ°å®¿ä¸»æœº" class="headerlink" title="dockerå†…æ–‡ä»¶æ‹·è´åˆ°å®¿ä¸»æœº"></a>dockerå†…æ–‡ä»¶æ‹·è´åˆ°å®¿ä¸»æœº</h2><p>å› ä¸ºæˆ‘ç°åœ¨çš„è¿™ä¸ªæ“ä½œæ˜¯åœ¨ä¸€ä¸ªdockerå®¹å™¨é‡Œé¢ï¼Œæˆ‘è¿˜éœ€è¦å°†å…¶ä»dockerä¸­æ‹·è´å‡ºæ¥ï¼Œæ–¹æ³•æœ‰ä¸¤ä¸ª</p><ol><li>å°†sqlæ–‡ä»¶æ‹·è´åˆ°dockerçš„æŒä¹…åŒ–ç›®å½•ä¸­ï¼ˆå³æ˜ å°„åˆ°äº†å®¿ä¸»æœºçš„ç›®å½•ä¸­ï¼‰ï¼›</li><li>ä½¿ç”¨docker copyå‘½ä»¤ï¼›</li></ol><p>å¯¹äº1panelå®‰è£…çš„MySQLå®¹å™¨è€Œè¨€ï¼Œä½ å¯ä»¥åœ¨å®¹å™¨çš„è¯¦ç»†è®¾ç½®é‡Œé¢çœ‹åˆ°æ˜ å°„è·¯å¾„çš„å…³ç³»ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/83b63cefa278acce4ddaf80fcbe5fe56.png" alt="image.png"></p><p>å¦‚æœä½¿ç”¨docker cpå‘½ä»¤ï¼Œæ ¼å¼å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">cp</span> å®¹å™¨ID:å®¹å™¨å†…è·¯å¾„ å®¿ä¸»æœºè·¯å¾„</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„å®¹å™¨IDå¯ä»¥æ˜¯å®¹å™¨çš„åå­—ï¼Œä¹Ÿå¯ä»¥æ˜¯docker pså‘½ä»¤æŸ¥çœ‹åˆ°çš„å®¹å™¨<code>CONTAINER ID</code>ï¼›mysqldumpå‘½ä»¤å¼„å‡ºæ¥çš„sqlæ–‡ä»¶æ˜¯åœ¨å®¹å™¨å†…çš„æ ¹ç›®å½•ä¸Šã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker cp mysql:/testdb.sql ~/testdb.sql</span></span><br><span class="line">Successfully copied 9.85MB to /root/testdb.sql</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹sqlæ–‡ä»¶"><a href="#ä¿®æ”¹sqlæ–‡ä»¶" class="headerlink" title="ä¿®æ”¹sqlæ–‡ä»¶"></a>ä¿®æ”¹sqlæ–‡ä»¶</h2><p>MySQLå¯¼å‡ºçš„sqlæ–‡ä»¶ä¸èƒ½ç›´æ¥è¢«sqlite3è¯†åˆ«ï¼Œåœ¨æˆ‘çš„æœºå™¨äººæ•°æ®åº“ä¸­é‡åˆ°å¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼Œéœ€è¦ä¿®æ”¹sqlæ–‡ä»¶ã€‚</p><ul><li>ç”¨peeweeåˆ›å»ºsqliteæ•°æ®åº“æ—¶ç”Ÿæˆçš„create tableè¯­å¥æ›¿æ¢MySQLå¯¼å‡ºçš„sqlæ–‡ä»¶å†…éƒ¨å·²æœ‰çš„å»ºè¡¨è¯­å¥ï¼›</li><li>åˆ é™¤sqlæ–‡ä»¶ä¸­çš„<code>LOCK TABLES </code>å’Œ<code>UNLOCK TABLES;</code>ï¼Œå› ä¸ºsqliteä¸æ”¯æŒï¼›</li><li>sqlæ–‡ä»¶ä¸­çš„è½¬ä¹‰å­—ç¬¦<code>\&quot;</code>æ›¿æ¢æˆ<code>&quot;</code>ã€‚å› ä¸ºåœ¨sqlite3ä¸­ä¸éœ€è¦è¿›è¡Œæ­¤è½¬ä¹‰ã€‚å¦‚æœä¸ä¿®æ”¹ï¼Œé‚£ä¹ˆåœ¨sqlite3ä¸­listçš„jsonå­—ç¬¦ä¸²ä¸­å°±ä¼šç•™æœ‰<code>\&quot;</code>å¯¼è‡´æ— æ³•è¢«<code>json.loads</code>ï¼ˆçŒœæµ‹sqlite3ä¸­<code>&#39;</code>çš„ä¼˜å…ˆçº§é«˜äº<code>&quot;</code>ï¼‰</li></ul><p>é¦–å…ˆæ˜¯æŠŠpythonä¸­peeweeä½¿ç”¨çš„æ•°æ®åº“æ¨¡å‹æ”¹æˆsqliteï¼Œç„¶åå¯åŠ¨ä¸€ä¸‹è¿™ä¸ªæœºå™¨äººï¼Œæ­¤æ—¶peeweeå°±ä¼šåˆ›å»ºä¸€ä¸ªdbæ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlite3 æ•°æ®åº“æ–‡ä»¶å.db</span><br></pre></td></tr></table></figure><p>è¿›å…¥è¯¥dbæ–‡ä»¶åæ‰§è¡Œå¦‚ä¸‹æŸ¥è¯¢å‘½ä»¤ï¼Œèƒ½çœ‹åˆ°sqlite3çš„å»ºè¡¨è¯­å¥ï¼Œå°†å…¶æ›¿æ¢æ‰MySQLä¸­å¯¼å‡ºsqlé‡Œé¢çš„å»ºè¡¨å‘½ä»¤ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT sql FROM sqlite_master WHERE type=&#x27;table&#x27;;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ç”¨çš„ä¸æ˜¯peeweeè¿™ç§ORMåº“ï¼Œåˆ™è¿˜éœ€è¦è‡ªè¡Œä¿®æ”¹å»ºè¡¨å‘½ä»¤ä¸ºsqlite3çš„å‘½ä»¤ï¼ˆå¯ä»¥é—®é—®gptè®©ä»–å¸®ä½ æ”¹ä¸€ä¸‹ï¼Œæˆ–è€…è‡ªå·±é‡å†™ä¸€ä¸ªï¼‰ã€‚æ¯”å¦‚åœ¨sqlite3ä¸­å°±ä¸æ”¯æŒè¡¨åè·Ÿéšçš„<code>AUTO_INCREMENT=4728</code>è¯­å¥ã€‚</p><h2 id="æ–‡ä»¶å¯¼å…¥åˆ°sqlite3"><a href="#æ–‡ä»¶å¯¼å…¥åˆ°sqlite3" class="headerlink" title="æ–‡ä»¶å¯¼å…¥åˆ°sqlite3"></a>æ–‡ä»¶å¯¼å…¥åˆ°sqlite3</h2><p>sqlite3çš„å¯¼å…¥å‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼Œå·¦ä¾§æ˜¯æ•°æ®åº“æ–‡ä»¶åå­—ï¼Œå³ä¾§æ˜¯éœ€è¦å¯¼å…¥çš„æºsqlæ–‡ä»¶ã€‚ä¸ºäº†é¿å…æ–‡ä»¶åç¼–ç é—®é¢˜ï¼Œå»ºè®®ä½¿ç”¨å…¨è‹±æ–‡åå­—ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlite3 æ•°æ®åº“åå­—.db &lt; éœ€è¦å¯¼å…¥çš„æ–‡ä»¶.sql</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤æˆåŠŸçš„æ—¶å€™ä¸ä¼šæœ‰ä»»ä½•è¾“å‡ºï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›å…¥å¯¼å…¥åç”Ÿæˆçš„dbæ–‡ä»¶ä¸­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlite3 æ•°æ®åº“åå­—.db</span><br></pre></td></tr></table></figure><p>ä¸å‡ºæ„å¤–çš„è¯ï¼Œæ‰€æœ‰æ•°æ®å°±å·²ç»å¯¼å…¥åˆ°è¿™ä¸ªæ–°çš„æ•°æ®åº“æ–‡ä»¶ä¸­äº†ï¼Œæ£€æŸ¥ä¸€ä¸‹å’ŒMySQLä¸­çš„æ•°æ®åº“æœ‰æ²¡æœ‰ä¸ä¸€æ ·çš„åœ°æ–¹å§ï¼</p><h1 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h1><p>æœ‰æ›´å¤šé—®é¢˜ï¼Œæ¬¢è¿è¯„è®ºç•™è¨€è®¨è®ºã€‚</p>]]></content>
    
    
    <summary type="html">MySQL8è½¬sqlite3éœ€è¦å¯¹sqlåšçš„ä¸€äº›å¤„ç†</summary>
    
    
    
    <category term="ç¼–ç¨‹å­¦ä¹ " scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="æ•°æ®åº“SQL" scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E6%95%B0%E6%8D%AE%E5%BA%93SQL/"/>
    
    
    <category term="mysql" scheme="https://blog.musnow.top/tags/mysql/"/>
    
    <category term="sqlite3" scheme="https://blog.musnow.top/tags/sqlite3/"/>
    
  </entry>
  
  <entry>
    <title>ã€winã€‘ä½¿ç”¨åˆ†åŒºåŠ©æ‰‹æ‰©å®¹Cç›˜</title>
    <link href="https://blog.musnow.top/posts/3746722946/"/>
    <id>https://blog.musnow.top/posts/3746722946/</id>
    <published>2024-02-02T01:15:20.000Z</published>
    <updated>2024-02-02T02:33:44.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜è¯´æ˜"><a href="#é—®é¢˜è¯´æ˜" class="headerlink" title="é—®é¢˜è¯´æ˜"></a>é—®é¢˜è¯´æ˜</h2><p>å¦‚æœä½ åƒæˆ‘ä¸€æ ·ï¼Œç”¨çš„æ˜¯è”æƒ³çš„ç¬”è®°æœ¬ï¼Œè¿™3å¹´å†…çš„è”æƒ³ç¬”è®°æœ¬éƒ½ä¼šå‡ºå‚åˆ†ç›˜ï¼ˆæ®æˆ‘æ‰€çŸ¥æ˜¯è¿™æ ·çš„ï¼‰ï¼ŒCç›˜é›·æ‰“ä¸åŠ¨çš„200GBï¼ŒDç›˜ä¸­ä¼šå­˜æ”¾ä¸€ä¸ªåŸå‚çš„é©±åŠ¨æ–‡ä»¶å¤¹ï¼ŒåŒ…æ‹¬ä½ è¿™å°ç”µè„‘çš„æ‰€æœ‰é©±åŠ¨ã€‚</p><p>ä½†æ˜¯ï¼Œ200GBå¾ˆå¿«å°±ä¼šè¢«æŸäº›å¥‡å¥‡æ€ªæ€ªçš„è½¯ä»¶ç¼“å­˜ç»™æ’‘æ»¡ï¼Œå³ä¾¿æˆ‘æŠŠå¾®ä¿¡å’ŒQQä¸¤ä¸ªè½¯ä»¶çš„èµ„æ–™æ–‡ä»¶å¤¹ç»™è½¬ç§»åˆ°Dç›˜äº†ï¼ŒCç›˜åœ¨ç”¨äº†å‡ ä¸ªæœˆåå°±è«åå…¶å¦™çš„åªå‰©ä¸‹50Gç”šè‡³æ›´å°‘äº†ï¼Œçœ‹ç€è®©äººå¾ˆæ˜¯ç„¦ç»¿ï¼Œè¿˜æ˜¯ç»™å®ƒæ‰©å®¹ä¸€ä¸‹å§ã€‚</p><h2 id="åˆ†åŒºåŠ©æ‰‹"><a href="#åˆ†åŒºåŠ©æ‰‹" class="headerlink" title="åˆ†åŒºåŠ©æ‰‹"></a>åˆ†åŒºåŠ©æ‰‹</h2><p>windowsæ˜¯è‡ªå¸¦ç£ç›˜åˆ†åŒºç®¡ç†çš„ï¼Œ<code>å³é”®æˆ‘çš„ç”µè„‘-å±æ€§-å­˜å‚¨-ç£ç›˜ç®¡ç†</code>ï¼Œè¿™é‡Œèƒ½åˆ°ä½ çš„ç³»ç»Ÿé‡Œé¢çš„æ‰€æœ‰ç‰©ç†ç¡¬ç›˜ï¼Œå’Œæ¯ä¸ªç¡¬ç›˜çš„åˆ†åŒºæƒ…å†µï¼Œå¯ä»¥åœ¨è¿™é‡Œå¯¹åˆ†åŒºè¿›è¡Œä¸€å®šçš„è°ƒæ•´ã€‚</p><p>ä½†å¾ˆé—æ†¾çš„æ˜¯ï¼Œåœ¨è¿™é‡Œå¹¶ä¸èƒ½å¯¹Cç›˜è¿›è¡Œæ‰©å®¹æ“ä½œï¼Œå½“ä½ ç»™Dç›˜<code>å‹ç¼©å·</code>åå†å³é”®Cç›˜ï¼Œä¼šå‘ç°<code>æ‰©å±•å·</code>æŒ‰é’®æ˜¯ç°è‰²çš„ï¼Œæ— æ³•è¢«ç‚¹å‡»ï¼Œä¹Ÿå°±æ— æ³•æ‰©å®¹ã€‚</p><p>è¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·æ¥æ“ä½œäº†ï¼š<a href="https://www.disktool.cn/">å‚²æ¢…åˆ†åŒºåŠ©æ‰‹ã€è½»æ¾å¤‡ä»½ã€æ•°æ®æ¢å¤(æ¢å¤ä¹‹æ˜Ÿ)ã€è¿œç¨‹æ§åˆ¶ï¼ˆAnyViewerï¼‰ç­‰è½¯ä»¶å…è´¹ä¸‹è½½å®˜ç½‘</a></p><blockquote><p>æ³¨æ„ï¼šä¹‹å‰åœ¨Bç«™çœ‹è¿‡ç›¸å…³è§†é¢‘ï¼Œæœ‰ä¸å°‘äººè¯„è®ºè¯´ä½¿ç”¨è¯¥å·¥å…·å¯¼è‡´ç³»ç»Ÿç›˜å†…èµ„æ–™ä¸¢å¤±çš„ï¼ˆè™½ç„¶åœ¨æˆ‘çš„å‡ æ¬¡ææœºä½¿ç”¨ä½“éªŒä¸­å¹¶æ²¡æœ‰é‡åˆ°ï¼‰ã€‚ä¸ºäº†ä¿é™©èµ·è§ï¼Œè¯·å…ˆå¤‡ä»½ä½ çš„<strong>Cç›˜æ‰€åœ¨ç‰©ç†ç›˜</strong>å†…çš„æ‰€æœ‰æ–‡ä»¶åå†è¿›è¡Œæ“ä½œï¼æ•°æ®æ— ä»·ï¼<strong>å¤‡ä»½ï¼Œå¤‡ä»½ï¼Œå¤‡ä»½</strong>ï¼ï¼</p></blockquote><p>ä¸‹è½½è½¯ä»¶åå®‰è£…ï¼Œå®‰è£…å®Œæ¯•åæ‰“å¼€è½¯ä»¶ä¼šè®©ä½ è¾“å…¥ä¸€ä¸ªå…è´¹ä½¿ç”¨å¯†ç ï¼Œè¿™ä¸ªå¯†ç ä¸€ç›´æ˜¯1122ï¼ˆè‡³å°‘ä¸€å¹´æ²¡å˜è¿‡äº†ï¼Œå¦‚æœä¸è¡Œå°±å»å®ƒä»¬çš„å…¬ä¼—å·è·å–ä¸€ä¸‹æœ€æ–°å¯†ç å§ï¼‰</p><p>æœ¬æ¬¡æµ‹è¯•ä½¿ç”¨çš„æ˜¯æ–°ç‰ˆ10.2ç‰ˆæœ¬ã€‚</p><p>è¿›å…¥è½¯ä»¶åçœ‹åˆ°çš„ç•Œé¢å’Œwindowsè‡ªå¸¦çš„ç£ç›˜ç®¡ç†ç±»ä¼¼ï¼Œè¿™é‡Œèƒ½çœ‹åˆ°åŸè£…1TBçš„å›ºæ€åˆ†äº†ä¸€ä¸ªCç›˜å’Œä¸€ä¸ªDç›˜ï¼ˆä¸‹å›¾ä¸­å·²ç»æ˜¯æˆ‘æ“ä½œåçš„ç»“æœäº†ï¼Œæ‰€ä»¥Cç›˜æ˜¯300GBï¼‰</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/9247b21d9bbd6d8997a14dc33c912316.png" alt="image.png"></p><p>å¦‚æœä½ æƒ³æ‰©å®¹Cç›˜ï¼Œå³é”®çº¢è‰²æ¡†æ¡†åŒºåŸŸçš„Cç›˜ï¼Œé€‰æ‹©<code>è°ƒæ•´/ç§»åŠ¨åˆ†åŒº</code>ï¼Œä¼šæ‰“å¼€å¦‚ä¸‹ç•Œé¢ã€‚å‹¾é€‰<code>ä»(*)åˆ†åŒºä¸­åˆ’åˆ†ç©ºé—´ç»™(C)</code>ï¼Œæ­¤æ—¶å³ä¾§ä¼šå‡ºç°ä¸€ä¸ªä¸‹æ‹‰èœå•ï¼Œå‹¾é€‰Dç›˜ï¼ˆä¸€å®šä¸è¦å‹¾é€‰é‚£ä¸¤ä¸ª<code>*</code>å¼€å¤´çš„ä¿ç•™åˆ†åŒºï¼‰ï¼Œæ­¤æ—¶å°±å¯ä»¥è¾“å…¥ä½ æƒ³ç»™Cç›˜æ‰©å®¹åçš„å®¹é‡äº†ï¼Œæ¯”å¦‚æƒ³æŠŠCç›˜æ‰©å®¹åˆ°300GBå°±è¾“å…¥300å³å¯ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/c89b075a1e132a8adaca64af27a4b18c.png" alt="image.png"></p><p>å†æ¬¡æé†’ï¼šè¿›è¡Œä¸‹ä¸€æ­¥ä¹‹å‰ï¼Œè¯·å…ˆå¤‡ä»½Cç›˜æ‰€åœ¨æ–‡ä»¶å¤¹çš„èµ„æ–™æ–‡ä»¶ï¼ï¼ï¼</p><p>ä½œä¸ºç¤ºä¾‹ï¼Œè¿™é‡Œæˆ‘è¾“å…¥Cç›˜æ‰©å®¹åˆ°350GB</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/72abda5f856a99013ca91cee16406a4b.png" alt="image.png"></p><p>ç‚¹å‡»ç¡®å®šï¼Œä¼šå‘ç°ä¸‹æ–¹åˆ†åŒºå¤§å°å·²ç»å˜åŒ–äº†ï¼Œä½†å®é™…ä¸Šæˆ‘ä»¬çš„æ“ä½œè¿˜æ²¡æäº¤ï¼Œå³ä¸Šè§’å¯ä»¥çœ‹åˆ°æäº¤æŒ‰é’®äº®èµ·ï¼Œæœ‰ä¸‰ä¸ªæ“ä½œéœ€è¦è¿›è¡Œ</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/d0076d1aa4c517a429d324713be9b0d7.png" alt="image.png"></p><p>è¿™ä¸‰ä¸ªæ“ä½œåˆ†åˆ«æ˜¯ç¼©å®¹Dç›˜ï¼Œç§»åŠ¨åˆ†åŒºï¼Œæ‰©å®¹Cç›˜ã€‚è¿™é‡Œæ˜¾ç¤ºçš„é¢„æœŸæ—¶é—´å¾ˆå¤¸å¼ ï¼Œä½†å®é™…ä¸Š15åˆ†é’Ÿå·¦å³å°±èƒ½å®Œæˆã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/2ad8be24ca47afcb336e76c97e9e9220.png" alt="image.png"></p><p>æ­¤æ—¶ç‚¹å‡»æ‰§è¡Œï¼Œä¼šè®©ä½ é€‰æ‹©åœ¨ä»€ä¹ˆæ¨¡å¼ä¸‹æ“ä½œï¼Œä¸€èˆ¬æƒ…å†µé€‰æ‹©Windows PEæ¨¡å¼å³å¯ã€‚é€‰æ‹©åç‚¹å‡»ç¡®å®šï¼Œåˆ†åŒºåŠ©æ‰‹å°±ä¼šé‡å¯ç”µè„‘å¹¶å¼€å§‹æ‰©å®¹æ“ä½œã€‚</p><p>å†æ¬¡æé†’ï¼šè¿™ä¸€æ­¥çš„ç¡®å®šåå°±æ²¡æœ‰å›å¤´è·¯äº†ï¼ï¼ï¼ä¸€å®šè¦å¤‡ä»½å“¦ï¼</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/19bc8602625ff5e20b5d57c7ed8294c3.png" alt="image.png"></p><p>ä¼šå…ˆåœ¨è½¯ä»¶å†…èµ°ä¸ªè¿›åº¦æ¡ï¼Œéšåé‡å¯ç”µè„‘è¿›å…¥PEæ¨¡å¼æ“ä½œï¼ŒPEç•Œé¢é•¿ä¸‹é¢è¿™æ ·ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/a70195203766f4672afd546e10a34eea.png" alt="image.png"></p><p>è€å¿ƒç­‰å¾…ä»–å®Œæˆå³å¯ï¼Œåˆ†åŒºåŠ©æ‰‹ä¼šè‡ªåŠ¨é‡å¯ç”µè„‘å›åˆ°windowsã€‚</p><h1 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h1><p>ç„¶åå°±æå®šäº†ï¼æˆåŠŸå°†Cç›˜ä»200GBæ‰©å®¹åˆ°300GBï¼Œä¸”ä¸¤ä¸ªç›˜çš„èµ„æ–™éƒ½åœ¨ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/be620570e1124c946d5b6c531992ae58.png" alt="image.png"></p><p>æœ€åè¿˜æ˜¯å¾—ä¸Šä¸ªæé†’ï¼Œè™½ç„¶æˆ‘è¿™è¾¹å®æµ‹èƒ½æˆåŠŸï¼Œä½†ä¸ä»£è¡¨ä½ é‚£è¾¹ä¸€å®šèƒ½ä¿ç•™èµ„æ–™ï¼å¤‡ä»½å‡†æ²¡é”™å“¦ã€‚</p>]]></content>
    
    
    <summary type="html">ä½¿ç”¨åˆ†åŒºåŠ©æ‰‹æ‰©å®¹windowsçš„Cç›˜</summary>
    
    
    
    <category term="å·®ç”Ÿæ–‡å…·å¤š" scheme="https://blog.musnow.top/categories/%E5%B7%AE%E7%94%9F%E6%96%87%E5%85%B7%E5%A4%9A/"/>
    
    <category term="ç”µè„‘ä½¿ç”¨å°è´´å£«" scheme="https://blog.musnow.top/categories/%E5%B7%AE%E7%94%9F%E6%96%87%E5%85%B7%E5%A4%9A/%E7%94%B5%E8%84%91%E4%BD%BF%E7%94%A8%E5%B0%8F%E8%B4%B4%E5%A3%AB/"/>
    
    
    <category term="windows" scheme="https://blog.musnow.top/tags/windows/"/>
    
  </entry>
  
  <entry>
    <title>ã€Artalkã€‘å¯ä¿¡åŸŸåæœªé…ç½®å¯¼è‡´çš„è·¨åŸŸè®¿é—®é—®é¢˜</title>
    <link href="https://blog.musnow.top/posts/1277415323/"/>
    <id>https://blog.musnow.top/posts/1277415323/</id>
    <published>2024-01-31T03:40:00.000Z</published>
    <updated>2024-01-31T13:11:33.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æŠ˜è…¾haloçš„æ—¶å€™ï¼Œå‘ç°artalkå‡ºç°è·¨åŸŸè®¿é—®æŠ¥é”™ï¼Œå†…å®¹å¦‚ä¸‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Access to fetch at &#x27;https://artk.musnow.top/api/stat&#x27; from origin &#x27;https://halo.musnow.top&#x27; has been blocked by CORS policy: The &#x27;Access-Control-Allow-Origin&#x27; header contains multiple values &#x27;, https://halo.musnow.top&#x27;, but only one is allowed. </span><br><span class="line">Have the server send the header with a valid value, or, if an opaque response serves your needs, set the request&#x27;s mode to &#x27;no-cors&#x27; to fetch the resource with CORS disabled.</span><br></pre></td></tr></table></figure><p>å°è¯•åœ¨nginxé‡Œé¢åŠ äº†ä¸€ä¸ªè·¨åŸŸè®¿é—®å¤´ï¼Œä¾æ—§æ²¡æœ‰è§£å†³è¿™ä¸ªé—®é¢˜</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">add_header</span> Access-Control-Allow-Origin <span class="string">&#x27;https://halo.musnow.top&#x27;</span> always;</span><br></pre></td></tr></table></figure><p>åæ¥å’¨è¯¢å…¶ä»–è€å“¥æ‰çŸ¥é“ï¼Œè¿™æ˜¯artalkå†…éƒ¨å¯ä¿¡åŸŸåé…ç½®çš„é—®é¢˜ï¼Œä¸éœ€è¦ä¿®æ”¹nginxé…ç½®æ–‡ä»¶ã€‚(è®°å¾—æŠŠä¸Šæ–¹çš„nginxé…ç½®åˆ æ‰)</p><p>æˆ‘åªæ·»åŠ äº†ç«™ç‚¹çš„å¯ä¿¡åŸŸåï¼Œartalkç³»ç»Ÿè®¾ç½®é‡Œé¢è¿˜æœ‰ä¸€ä¸ªå¯ä¿¡åŸŸåé…ç½®</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/01/6d160c66af4d1c70cfb05cce383131f8.png" alt="image.png"></p><p>è®¾ç½®äº†ä¹‹åéœ€è¦é‡å¯artalkå®¹å™¨ï¼Œæ‰èƒ½è®©ä¿®æ”¹ç”Ÿæ•ˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart artalk-go</span><br></pre></td></tr></table></figure><p>ç°åœ¨å°±OKäº†</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/01/8ca3eab60bfb00557e0284d19b668de8.png" alt="image.png"></p>]]></content>
    
    
    <summary type="html">artalkåå°å¯ä¿¡åŸŸåæœªé…ç½®å¯¼è‡´çš„è·¨åŸŸè®¿é—®é—®é¢˜</summary>
    
    
    
    <category term="ç¼–ç¨‹å­¦ä¹ " scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="DockerçœŸå¥½ç©" scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/Docker%E7%9C%9F%E5%A5%BD%E7%8E%A9/"/>
    
    
    <category term="åšå®¢" scheme="https://blog.musnow.top/tags/%E5%8D%9A%E5%AE%A2/"/>
    
    <category term="Docker" scheme="https://blog.musnow.top/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>ã€MySQLã€‘å†…ç½®å‡½æ•°</title>
    <link href="https://blog.musnow.top/posts/4252514363/"/>
    <id>https://blog.musnow.top/posts/4252514363/</id>
    <published>2024-01-30T07:45:00.000Z</published>
    <updated>2024-02-15T07:00:03.000Z</updated>
    
    <content type="html"><![CDATA[<p>åƒç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼ŒMySQLåŒæ ·ä¹Ÿæä¾›äº†ä¸€éƒ¨åˆ†å†…ç½®å‡½æ•°ä¾›ç”¨æˆ·åœ¨SQLä¸­è¿›è¡Œè°ƒç”¨ã€‚è¿™äº›å†…ç½®å‡½æ•°èƒ½ç®€å•å¤„ç†ä¸€éƒ¨åˆ†æ•°æ®ï¼Œé¿å…æˆ‘ä»¬åœ¨ä¸åŒçš„ç”¨æˆ·å±‚è¯­è¨€ä¸­è¿›è¡Œé€»è¾‘ç¼–å†™ã€‚</p><h1 id="1-æ—¥æœŸå‡½æ•°"><a href="#1-æ—¥æœŸå‡½æ•°" class="headerlink" title="1.æ—¥æœŸå‡½æ•°"></a>1.æ—¥æœŸå‡½æ•°</h1><table><thead><tr><th>å‡½æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>current_date()</td><td>å½“å‰æ—¥æœŸ</td></tr><tr><td>current_time()</td><td>å½“å‰æ—¶é—´</td></tr><tr><td>current_timestamp()</td><td>å½“å‰æ—¥æœŸå’Œæ—¶é—´</td></tr><tr><td>now()</td><td>å½“å‰æ—¥æœŸå’Œæ—¶é—´ï¼ˆåŒä¸Šï¼‰</td></tr><tr><td>unix_timestamp()</td><td>å½“å‰æ—¶é—´æˆ³æ•°å­—</td></tr><tr><td>date(datetime)</td><td>è¿”å›datetimeå‚æ•°ä¸­çš„æ—¥æœŸéƒ¨åˆ†</td></tr><tr><td>date_add(date,interval d_value_type)</td><td>åœ¨dateä¸­æ·»åŠ æ—¥æœŸæˆ–æ—¶é—´ï¼Œintervalåçš„å‚æ•°å¯ä»¥æ˜¯<code>year/month/day/hour/mintue/second</code></td></tr><tr><td>date_sub(date,interval d_value_type)</td><td>åœ¨dateä¸­å‡å»æ—¥æœŸæˆ–æ—¶é—´ï¼Œintervalåçš„å‚æ•°å¯ä»¥æ˜¯<code>year/month/day/hour/mintue/second</code></td></tr><tr><td>datediff(date1,date2)</td><td>è®¡ç®—ä¸¤ä¸ªæ—¥æœŸçš„æ—¶é—´å·®ï¼Œå•ä½ä¸ºå¤©</td></tr><tr><td>date_format(date,format_string)</td><td>æ ¹æ®format_stringå­—ç¬¦ä¸²æ¥æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º</td></tr><tr><td>year(date)</td><td>è·å–æ—¥æœŸä¸­çš„å¹´ä»½</td></tr><tr><td>month(date)</td><td>è·å–æ—¥æœŸä¸­çš„æœˆä»½</td></tr><tr><td>day(date)</td><td>è·å–æ—¥æœŸä¸­çš„å¤©</td></tr><tr><td>str_to_date(string,format_string)</td><td>å­—ç¬¦ä¸²è½¬æ—¶é—´</td></tr></tbody></table><p>ä¸‹é¢æŒ¨ä¸ªåšä¸ªæ¼”ç¤º</p><h2 id="1-1-è·å–æ—¥æœŸå’Œæ—¶é—´"><a href="#1-1-è·å–æ—¥æœŸå’Œæ—¶é—´" class="headerlink" title="1.1 è·å–æ—¥æœŸå’Œæ—¶é—´"></a>1.1 è·å–æ—¥æœŸå’Œæ—¶é—´</h2><p>è·å–æ—¶é—´åˆ†ä¸ºè·å–å½“å‰æ—¥æœŸï¼Œè·å–å½“å‰æ—¶é—´ï¼Œå’Œè·å–å½“å‰æ—¥æœŸ+æ—¶é—´ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select current_time();</span><br><span class="line">+----------------+</span><br><span class="line">| current_time() |</span><br><span class="line">+----------------+</span><br><span class="line">| 14:27:49       |</span><br><span class="line">+----------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select now();</span><br><span class="line">+---------------------+</span><br><span class="line">| now()               |</span><br><span class="line">+---------------------+</span><br><span class="line">| 2024-01-30 14:27:53 |</span><br><span class="line">+---------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select current_date();</span><br><span class="line">+----------------+</span><br><span class="line">| current_date() |</span><br><span class="line">+----------------+</span><br><span class="line">| 2024-01-30     |</span><br><span class="line">+----------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select current_timestamp();</span><br><span class="line">+---------------------+</span><br><span class="line">| current_timestamp() |</span><br><span class="line">+---------------------+</span><br><span class="line">| 2024-01-30 14:30:39 |</span><br><span class="line">+---------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><p>ç»è¿‡æµ‹è¯•å¯ä»¥å‘ç°ï¼Œåœ¨MySQLä¸­ï¼Œ<code>current_timestamp()</code>å‡½æ•°å’Œ<code>now()</code>å‡½æ•°çš„æ•ˆæœç­‰æ•ˆã€‚</p><p>åªæœ‰<code>UNIX_TIMESTAMP()</code>å‡½æ•°è¿”å›çš„æ‰æ˜¯æ—¶é—´æˆ³çš„æ•°å­—</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; SELECT UNIX_TIMESTAMP();</span><br><span class="line">+------------------+</span><br><span class="line">| UNIX_TIMESTAMP() |</span><br><span class="line">+------------------+</span><br><span class="line">|       1706596346 |</span><br><span class="line">+------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/01/f6e691162d0c2360f990ab378809588b.png" alt="image-20240130143435696"></p><h2 id="1-2-è·å–æ—¶é—´çš„éƒ¨åˆ†å€¼"><a href="#1-2-è·å–æ—¶é—´çš„éƒ¨åˆ†å€¼" class="headerlink" title="1.2 è·å–æ—¶é—´çš„éƒ¨åˆ†å€¼"></a>1.2 è·å–æ—¶é—´çš„éƒ¨åˆ†å€¼</h2><p>ä½¿ç”¨YEAR\MONTH\DAYå‡½æ•°ä»ä¸€ä¸ªæ—¶é—´ä¸­æå–æ—¥æœŸçš„éƒ¨åˆ†ä¿¡æ¯</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">YEAR</span>(NOW()) <span class="keyword">AS</span> current_year;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MONTH</span>(NOW()) <span class="keyword">AS</span> current_month;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DAY</span>(NOW()) <span class="keyword">AS</span> current_day;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæ•ˆæœå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; SELECT YEAR(NOW()) AS current_year;</span><br><span class="line">+--------------+</span><br><span class="line">| current_year |</span><br><span class="line">+--------------+</span><br><span class="line">|         2024 |</span><br><span class="line">+--------------+</span><br><span class="line">1 row in set (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; SELECT MONTH(NOW()) AS current_month;</span><br><span class="line">+---------------+</span><br><span class="line">| current_month |</span><br><span class="line">+---------------+</span><br><span class="line">|             1 |</span><br><span class="line">+---------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; SELECT DAY(NOW()) AS current_day;</span><br><span class="line">+-------------+</span><br><span class="line">| current_day |</span><br><span class="line">+-------------+</span><br><span class="line">|          30 |</span><br><span class="line">+-------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><h2 id="1-3-æ—¶é—´è¿ç®—"><a href="#1-3-æ—¶é—´è¿ç®—" class="headerlink" title="1.3 æ—¶é—´è¿ç®—"></a>1.3 æ—¶é—´è¿ç®—</h2><p>MySQLä¸­æ—¶é—´å¯ä»¥ç›´æ¥ç”¨åŠ å‡è¿›è¡Œè¿ç®—ï¼Œæ—¶é—´åˆ—å’Œæ—¶é—´å‡½æ•°è¿”å›çš„æ—¶é—´ä¹‹é—´å¯ä»¥é€šè¿‡å¤§äºå°äºæ¥æ¯”è¾ƒå¤§å°ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; SELECT NOW() + INTERVAL 1 DAY;</span><br><span class="line">+------------------------+</span><br><span class="line">| NOW() + INTERVAL 1 DAY |</span><br><span class="line">+------------------------+</span><br><span class="line">| 2024-01-31 14:49:57    |</span><br><span class="line">+------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><p>åœ¨å¤§å­¦æ•°æ®åº“çš„è€ƒè¯•ä¸­ä¸€èˆ¬ä¼šç»™å‡ºä¸€å¼ è¡¨ï¼Œå­˜äº†å­¦ç”Ÿçš„å‡ºç”Ÿæ—¥æœŸï¼Œè®©ä½ ç­›é€‰å‡ºå¹´é¾„å°äº20å²çš„å­¦ç”Ÿï¼Œæ­¤æ—¶å°±éœ€è¦è¿›è¡Œå¹´ä»½çš„æå–å’Œæ—¶é—´è®¡ç®—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å‡è®¾å­¦ç”Ÿè¡¨ä¸­æ˜¯id,name,birthä¸‰ä¸ªå­—æ®µ</span></span><br><span class="line"><span class="keyword">select</span> id,name <span class="keyword">from</span> student</span><br><span class="line"><span class="keyword">where</span> (<span class="keyword">year</span>(now()) <span class="operator">-</span> <span class="keyword">year</span>(birth)) <span class="operator">&lt;</span> <span class="number">20</span>;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ¼”ç¤ºè¡¨æ ¼ä¸­æåˆ°çš„<code>date_add/date_sub</code>è¿ç®—å‡½æ•°çš„ç”¨æ³•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åœ¨æ—¥æœŸçš„åŸºç¡€ä¸ŠåŠ ä¸Šæ—¶é—´</span></span><br><span class="line"><span class="keyword">select</span> date_add(<span class="string">&#x27;2024-1-1&#x27;</span>,<span class="type">interval</span> <span class="number">2</span> <span class="keyword">month</span>);</span><br><span class="line"><span class="comment">-- åœ¨æ—¥æœŸçš„åŸºç¡€ä¸Šå‡å»æ—¶é—´</span></span><br><span class="line"><span class="keyword">select</span> date_sub(<span class="string">&#x27;2023-10-1&#x27;</span>, <span class="type">interval</span> <span class="number">2</span> <span class="keyword">day</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç¬¬äºŒä¸ªå‚æ•°å¯é€‰çš„æ—¶é—´é—´éš”</span></span><br><span class="line"><span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">YEAR</span></span><br><span class="line"><span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">MONTH</span></span><br><span class="line"><span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span></span><br><span class="line"><span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">HOUR</span></span><br><span class="line"><span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">MINUTE</span></span><br><span class="line"><span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">SECOND</span></span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select date_sub(&#x27;2023-10-1&#x27;, interval 2 day);</span><br><span class="line">+---------------------------------------+</span><br><span class="line">| date_sub(&#x27;2023-10-1&#x27;, interval 2 day) |</span><br><span class="line">+---------------------------------------+</span><br><span class="line">| 2023-09-29                            |</span><br><span class="line">+---------------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select date_add(&#x27;2024-1-1&#x27;,interval 2 month);</span><br><span class="line">+---------------------------------------+</span><br><span class="line">| date_add(&#x27;2024-1-1&#x27;,interval 2 month) |</span><br><span class="line">+---------------------------------------+</span><br><span class="line">| 2024-03-01                            |</span><br><span class="line">+---------------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼ŒMySQLä¸­æ˜¯å…è®¸æ—¥æœŸä¸­å‡ºç°å‰å¯¼0çš„ï¼Œä¾æ—§å¯ä»¥è¢«æ­£å¸¸è¯†åˆ«</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select date_sub(&#x27;2023-01-01&#x27;, interval 2 day);</span><br><span class="line">+----------------------------------------+</span><br><span class="line">| date_sub(&#x27;2023-01-01&#x27;, interval 2 day) |</span><br><span class="line">+----------------------------------------+</span><br><span class="line">| 2022-12-30                             |</span><br><span class="line">+----------------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨datediffå‡½æ•°è®¡ç®—ä¸¤ä¸ªæ—¥æœŸçš„å·®å€¼ï¼ˆæ—¥æœŸè¦ç”¨å•å¼•å·ä¼ å…¥ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; SELECT DATEDIFF(&#x27;2022-01-30&#x27;, &#x27;2022-01-15&#x27;);</span><br><span class="line">+--------------------------------------+</span><br><span class="line">| DATEDIFF(&#x27;2022-01-30&#x27;, &#x27;2022-01-15&#x27;) |</span><br><span class="line">+--------------------------------------+</span><br><span class="line">|                                   15 |</span><br><span class="line">+--------------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><p>å…·ä½“ä¾‹å­ï¼šåœ¨msgè¡¨ä¸­æŸ¥è¯¢ä¸¤åˆ†é’Ÿå†…å‘å¸ƒçš„æ¶ˆæ¯ï¼Œå¯ä»¥ç”¨<code>date_add</code>å‡½æ•°æ¥å®ç°ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> msg </span><br><span class="line"><span class="keyword">where</span> date_add(sendtime, <span class="type">interval</span> <span class="number">2</span> <span class="keyword">minute</span>) <span class="operator">&gt;</span> now();</span><br></pre></td></tr></table></figure><h2 id="1-4-æ—¥æœŸæ ¼å¼åŒ–"><a href="#1-4-æ—¥æœŸæ ¼å¼åŒ–" class="headerlink" title="1.4 æ—¥æœŸæ ¼å¼åŒ–"></a>1.4 æ—¥æœŸæ ¼å¼åŒ–</h2><p>ä½¿ç”¨date_formatå‡½æ•°å°†æ—¶é—´æ ¼å¼åŒ–è¾“å‡º</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> DATE_FORMAT(now(),<span class="string">&#x27;%Y-%m-%d %H:%i:%s&#x27;</span>);</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­ï¼Œä½ å¯ä»¥æŠŠä¸€äº›å€¼ç»™å†™æ­»ï¼Œæ¯”å¦‚å°†åˆ†é’Ÿå’Œç§’å†™æ­»ä¸º0ç‚¹0åˆ†ï¼›</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> DATE_FORMAT(now(),<span class="string">&#x27;%Y-%m-%d %H:00:00&#x27;</span>);</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆæ•ˆæœå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select DATE_FORMAT(now(),&#x27;%Y-%m-%d %H:%i:%s&#x27;);</span><br><span class="line">+----------------------------------------+</span><br><span class="line">| DATE_FORMAT(now(),&#x27;%Y-%m-%d %H:%i:%s&#x27;) |</span><br><span class="line">+----------------------------------------+</span><br><span class="line">| 2024-01-30 14:59:33                    |</span><br><span class="line">+----------------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select DATE_FORMAT(now(),&#x27;%Y-%m-%d %H:00:00&#x27;);</span><br><span class="line">+----------------------------------------+</span><br><span class="line">| DATE_FORMAT(now(),&#x27;%Y-%m-%d %H:00:00&#x27;) |</span><br><span class="line">+----------------------------------------+</span><br><span class="line">| 2024-01-30 14:00:00                    |</span><br><span class="line">+----------------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><p>å¹´ä»½Yå¯ä»¥ä¸ºå°yï¼Œæ­¤æ—¶åªæ˜¾ç¤ºå¹´ä»½çš„åäºŒä½</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select DATE_FORMAT(now(),&#x27;%y-%m-%d %H:%i:%s&#x27;);</span><br><span class="line">+----------------------------------------+</span><br><span class="line">| DATE_FORMAT(now(),&#x27;%y-%m-%d %H:%i:%s&#x27;) |</span><br><span class="line">+----------------------------------------+</span><br><span class="line">| 24-01-30 15:00:23                      |</span><br><span class="line">+----------------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><h2 id="1-5-å­—ç¬¦ä¸²è½¬æ—¶é—´"><a href="#1-5-å­—ç¬¦ä¸²è½¬æ—¶é—´" class="headerlink" title="1.5 å­—ç¬¦ä¸²è½¬æ—¶é—´"></a>1.5 å­—ç¬¦ä¸²è½¬æ—¶é—´</h2><p><code>str_to_date</code>å‡½æ•°å¯ä»¥å°†ç»™å®šçš„æ—¶é—´å­—ç¬¦ä¸²å’Œç»™å®šçš„å­—ç¬¦ä¸²æ—¶é—´æ ¼å¼ï¼Œè½¬æ¢ä¸ºä¸€ä¸ªdatetimeç±»å‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> str_to_date(<span class="string">&#x27;2024-01-02 20:37:14&#x27;</span>, <span class="string">&#x27;%Y-%m-%d %H:%i:%s&#x27;</span>);</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select str_to_date(&#x27;2024-01-02 20:37:14&#x27;, &#x27;%Y-%m-%d %H:%i:%s&#x27;);</span><br><span class="line">+---------------------------------------------------------+</span><br><span class="line">| str_to_date(&#x27;2024-01-02 20:37:14&#x27;, &#x27;%Y-%m-%d %H:%i:%s&#x27;) |</span><br><span class="line">+---------------------------------------------------------+</span><br><span class="line">| 2024-01-02 20:37:14                                     |</span><br><span class="line">+---------------------------------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ç»™å®šçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²å’Œæ—¶é—´å­—ç¬¦ä¸²ä¸ç¬¦åˆï¼Œåˆ™æ— æ³•æˆåŠŸè½¬æ¢ï¼Œç»“æœä¸ºNULL</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select str_to_date(&#x27;2024-01-02 20:37:14&#x27;, &#x27;%y-%m-%d %H:%i:%s&#x27;);</span><br><span class="line">+---------------------------------------------------------+</span><br><span class="line">| str_to_date(&#x27;2024-01-02 20:37:14&#x27;, &#x27;%y-%m-%d %H:%i:%s&#x27;) |</span><br><span class="line">+---------------------------------------------------------+</span><br><span class="line">| NULL                                                    |</span><br><span class="line">+---------------------------------------------------------+</span><br><span class="line">1 row in set, 1 warning (0.000 sec)</span><br></pre></td></tr></table></figure><h2 id="1-6-å…¶ä»–å‚è€ƒå‡½æ•°"><a href="#1-6-å…¶ä»–å‚è€ƒå‡½æ•°" class="headerlink" title="1.6 å…¶ä»–å‚è€ƒå‡½æ•°"></a>1.6 å…¶ä»–å‚è€ƒå‡½æ•°</h2><p>ä»¥ä¸‹æ˜¯æ¯”è¾ƒå…¨çš„MySQLæ—¥æœŸå‡½æ•°ï¼Œå¯ä¾›å‚è€ƒ</p><details><summary>ç‚¹æˆ‘æŸ¥çœ‹</summary><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/qinshijangshan/article/details/72874667">MySQLä¹‹æ—¥æœŸæ—¶é—´å¤„ç†å‡½æ•°</a></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- MySQLæ—¥æœŸæ—¶é—´å¤„ç†å‡½æ•°</span></span><br><span class="line"><span class="comment">-- å½“å‰æ—¥æœŸï¼š2017-05-12ï¼ˆçªç„¶å‘ç°ä»Šå¤©512ï¼Œæ˜¯ä¸æ˜¯ä¼šæ‹‰é˜²ç©ºè­¦æŠ¥ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> NOW() <span class="keyword">FROM</span> DUAL;<span class="comment">-- å½“å‰æ—¥æœŸæ—¶é—´ï¼š2017-05-12 11:41:47</span></span><br><span class="line"><span class="comment">-- åœ¨MySQLé‡Œä¹Ÿå­˜åœ¨å’ŒOracleé‡Œç±»ä¼¼çš„dualè™šæ‹Ÿè¡¨ï¼šå®˜æ–¹å£°æ˜çº¯ç²¹æ˜¯ä¸ºäº†æ»¡è¶³select ... from...è¿™ä¸€ä¹ æƒ¯é—®é¢˜ï¼Œmysqlä¼šå¿½ç•¥å¯¹è¯¥è¡¨çš„å¼•ç”¨ã€‚</span></span><br><span class="line"><span class="comment">-- é‚£ä¹ˆMySQLä¸­å°±ä¸ç”¨DUALäº†å§ã€‚</span></span><br><span class="line"><span class="keyword">SELECT</span> NOW();<span class="comment">-- å½“å‰æ—¥æœŸæ—¶é—´ï¼š2017-05-12 11:41:55</span></span><br><span class="line"><span class="comment">-- é™¤äº† now() å‡½æ•°èƒ½è·å¾—å½“å‰çš„æ—¥æœŸæ—¶é—´å¤–ï¼ŒMySQL ä¸­è¿˜æœ‰ä¸‹é¢çš„å‡½æ•°ï¼š</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CURRENT_TIMESTAMP</span>();<span class="comment">-- 2017-05-15 10:19:31</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CURRENT_TIMESTAMP</span>;<span class="comment">-- 2017-05-15 10:19:51</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">LOCALTIME</span>();<span class="comment">-- 2017-05-15 10:20:00</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">LOCALTIME</span>;<span class="comment">-- 2017-05-15 10:20:10</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">LOCALTIMESTAMP</span>();<span class="comment">-- 2017-05-15 10:20:21(v4.0.6)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">LOCALTIMESTAMP</span>;<span class="comment">-- 2017-05-15 10:20:30(v4.0.6)</span></span><br><span class="line"><span class="comment">-- è¿™äº›æ—¥æœŸæ—¶é—´å‡½æ•°ï¼Œéƒ½ç­‰åŒäº now()ã€‚é‰´äº now() å‡½æ•°ç®€çŸ­æ˜“è®°ï¼Œå»ºè®®æ€»æ˜¯ä½¿ç”¨ now()æ¥æ›¿ä»£ä¸Šé¢åˆ—å‡ºçš„å‡½æ•°ã€‚</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">SELECT</span> SYSDATE();<span class="comment">-- å½“å‰æ—¥æœŸæ—¶é—´ï¼š2017-05-12 11:42:03</span></span><br><span class="line"><span class="comment">-- sysdate() æ—¥æœŸæ—¶é—´å‡½æ•°è·Ÿ now() ç±»ä¼¼ï¼Œ</span></span><br><span class="line"><span class="comment">-- ä¸åŒä¹‹å¤„åœ¨äºï¼šnow() åœ¨æ‰§è¡Œå¼€å§‹æ—¶å€¼å°±å¾—åˆ°äº†;sysdate() åœ¨å‡½æ•°æ‰§è¡Œæ—¶åŠ¨æ€å¾—åˆ°å€¼ã€‚</span></span><br><span class="line"><span class="comment">-- çœ‹ä¸‹é¢çš„ä¾‹å­å°±æ˜ç™½äº†ï¼š</span></span><br><span class="line"><span class="keyword">SELECT</span> NOW(), SLEEP(<span class="number">3</span>), NOW();</span><br><span class="line"><span class="keyword">SELECT</span> SYSDATE(), SLEEP(<span class="number">3</span>), SYSDATE();</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">SELECT</span> CURDATE();<span class="comment">-- å½“å‰æ—¥æœŸï¼š2017-05-12</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CURRENT_DATE</span>();<span class="comment">-- å½“å‰æ—¥æœŸï¼šç­‰åŒäº CURDATE()</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CURRENT_DATE</span>;<span class="comment">-- å½“å‰æ—¥æœŸï¼šç­‰åŒäº CURDATE()</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">SELECT</span> CURTIME();<span class="comment">-- å½“å‰æ—¶é—´ï¼š11:42:47</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CURRENT_TIME</span>();<span class="comment">-- å½“å‰æ—¶é—´ï¼šç­‰åŒäº CURTIME()</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CURRENT_TIME</span>;<span class="comment">-- å½“å‰æ—¶é—´ï¼šç­‰åŒäº CURTIME()</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">-- è·å¾—å½“å‰ UTC æ—¥æœŸæ—¶é—´å‡½æ•°</span></span><br><span class="line"><span class="keyword">SELECT</span> UTC_TIMESTAMP(), UTC_DATE(), UTC_TIME()</span><br><span class="line"><span class="comment">-- MySQL è·å¾—å½“å‰æ—¶é—´æˆ³å‡½æ•°ï¼šcurrent_timestamp, current_timestamp()</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="built_in">CURRENT_TIMESTAMP</span>();<span class="comment">-- 2017-05-15 10:32:21 | 2017-05-15 10:32:21</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">-- MySQL æ—¥æœŸæ—¶é—´ Extractï¼ˆé€‰å–ï¼‰ å‡½æ•°</span></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@dt</span> <span class="operator">=</span> <span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="type">DATE</span>(<span class="variable">@dt</span>);<span class="comment">-- è·å–æ—¥æœŸï¼š2017-05-15</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="type">TIME</span>(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- è·å–æ—¶é—´ï¼š10:37:14.123456</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">YEAR</span>(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- è·å–å¹´ä»½</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MONTH</span>(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- è·å–æœˆä»½</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DAY</span>(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- è·å–æ—¥</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">HOUR</span>(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- è·å–æ—¶</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MINUTE</span>(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- è·å–åˆ†</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SECOND</span>(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- è·å–ç§’</span></span><br><span class="line"><span class="keyword">SELECT</span> MICROSECOND(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- è·å–æ¯«ç§’</span></span><br><span class="line"><span class="keyword">SELECT</span> QUARTER(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- è·å–å­£åº¦</span></span><br><span class="line"><span class="keyword">SELECT</span> WEEK(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- 20 (è·å–å‘¨)</span></span><br><span class="line"><span class="keyword">SELECT</span> WEEK(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>, <span class="number">7</span>);<span class="comment">-- ****** æµ‹è¯•æ­¤å‡½æ•°åœ¨MySQL5.6ä¸‹æ— æ•ˆ</span></span><br><span class="line"><span class="keyword">SELECT</span> WEEKOFYEAR(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- åŒweek()</span></span><br><span class="line"><span class="keyword">SELECT</span> DAYOFYEAR(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- 135 (æ—¥æœŸåœ¨å¹´åº¦ä¸­ç¬¬å‡ å¤©)</span></span><br><span class="line"><span class="keyword">SELECT</span> DAYOFMONTH(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- 5 (æ—¥æœŸåœ¨æœˆåº¦ä¸­ç¬¬å‡ å¤©)</span></span><br><span class="line"><span class="keyword">SELECT</span> DAYOFWEEK(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- 2 (æ—¥æœŸåœ¨å‘¨ä¸­ç¬¬å‡ å¤©ï¼›å‘¨æ—¥ä¸ºç¬¬ä¸€å¤©)</span></span><br><span class="line"><span class="keyword">SELECT</span> WEEKDAY(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- 0</span></span><br><span class="line"><span class="keyword">SELECT</span> WEEKDAY(<span class="string">&#x27;2017-05-21 10:37:14.123456&#x27;</span>);<span class="comment">-- 6(ä¸dayofweek()éƒ½è¡¨ç¤ºæ—¥æœŸåœ¨å‘¨çš„ç¬¬å‡ å¤©ï¼Œåªæ˜¯å‚è€ƒæ ‡å‡†ä¸åŒï¼Œweekday()å‘¨ä¸€ä¸ºç¬¬0å¤©ï¼Œå‘¨æ—¥ä¸ºç¬¬6å¤©)</span></span><br><span class="line"><span class="keyword">SELECT</span> YEARWEEK(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- 201720(å¹´å’Œå‘¨)</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXTRACT</span>(<span class="keyword">YEAR</span> <span class="keyword">FROM</span> <span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXTRACT</span>(<span class="keyword">MONTH</span> <span class="keyword">FROM</span> <span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXTRACT</span>(<span class="keyword">DAY</span> <span class="keyword">FROM</span> <span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXTRACT</span>(<span class="keyword">HOUR</span> <span class="keyword">FROM</span> <span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXTRACT</span>(<span class="keyword">MINUTE</span> <span class="keyword">FROM</span> <span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXTRACT</span>(<span class="keyword">SECOND</span> <span class="keyword">FROM</span> <span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXTRACT</span>(MICROSECOND <span class="keyword">FROM</span> <span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXTRACT</span>(QUARTER <span class="keyword">FROM</span> <span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXTRACT</span>(WEEK <span class="keyword">FROM</span> <span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXTRACT</span>(YEAR_MONTH <span class="keyword">FROM</span> <span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXTRACT</span>(DAY_HOUR <span class="keyword">FROM</span> <span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXTRACT</span>(DAY_MINUTE <span class="keyword">FROM</span> <span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- 151037(æ—¥æ—¶åˆ†)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXTRACT</span>(DAY_SECOND <span class="keyword">FROM</span> <span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- 15103714(æ—¥æ—¶åˆ†ç§’)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXTRACT</span>(DAY_MICROSECOND <span class="keyword">FROM</span> <span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- 15103714123456(æ—¥æ—¶åˆ†ç§’æ¯«ç§’)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXTRACT</span>(HOUR_MINUTE <span class="keyword">FROM</span> <span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- 1037(æ—¶åˆ†)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXTRACT</span>(HOUR_SECOND <span class="keyword">FROM</span> <span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- 103714(æ—¶åˆ†ç§’)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXTRACT</span>(HOUR_MICROSECOND <span class="keyword">FROM</span> <span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- 103714123456(æ—¥æ—¶åˆ†ç§’æ¯«ç§’)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXTRACT</span>(MINUTE_SECOND <span class="keyword">FROM</span> <span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- 3714(åˆ†ç§’)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXTRACT</span>(MINUTE_MICROSECOND <span class="keyword">FROM</span> <span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- 3714123456(åˆ†ç§’æ¯«ç§’)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXTRACT</span>(SECOND_MICROSECOND <span class="keyword">FROM</span> <span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- 14123456(ç§’æ¯«ç§’)</span></span><br><span class="line"><span class="comment">-- MySQL Extract() å‡½æ•°é™¤äº†æ²¡æœ‰date(),time() çš„åŠŸèƒ½å¤–ï¼Œå…¶ä»–åŠŸèƒ½ä¸€åº”å…·å…¨ã€‚</span></span><br><span class="line"><span class="comment">-- å¹¶ä¸”è¿˜å…·æœ‰é€‰å–â€˜day_microsecond&#x27; ç­‰åŠŸèƒ½ã€‚</span></span><br><span class="line"><span class="comment">-- æ³¨æ„è¿™é‡Œä¸æ˜¯åªé€‰å– day å’Œ microsecondï¼Œè€Œæ˜¯ä»æ—¥æœŸçš„ day éƒ¨åˆ†ä¸€ç›´é€‰å–åˆ° microsecond éƒ¨åˆ†ã€‚</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">SELECT</span> DAYNAME(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- Monday(è¿”å›è‹±æ–‡æ˜ŸæœŸ)</span></span><br><span class="line"><span class="keyword">SELECT</span> MONTHNAME(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>);<span class="comment">-- May(è¿”å›è‹±æ–‡æœˆä»½)</span></span><br><span class="line"><span class="keyword">SELECT</span> LAST_DAY(<span class="string">&#x27;2016-02-01&#x27;</span>);<span class="comment">-- 2016-02-29 (è¿”å›æœˆä»½ä¸­æœ€åä¸€å¤©)</span></span><br><span class="line"><span class="keyword">SELECT</span> LAST_DAY(<span class="string">&#x27;2016-05-01&#x27;</span>);<span class="comment">-- 2016-05-31</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">-- DATE_ADD(date,INTERVAL expr type) ä»æ—¥æœŸåŠ ä¸ŠæŒ‡å®šçš„æ—¶é—´é—´éš”</span></span><br><span class="line"><span class="comment">-- typeå‚æ•°å¯å‚è€ƒï¼šhttp://www.w3school.com.cn/sql/func_date_sub.asp</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">YEAR</span>);<span class="comment">-- è¡¨ç¤ºï¼š2018-05-15 10:37:14.123456</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">1</span> QUARTER);<span class="comment">-- è¡¨ç¤ºï¼š2017-08-15 10:37:14.123456</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">MONTH</span>);<span class="comment">-- è¡¨ç¤ºï¼š2017-06-15 10:37:14.123456</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">1</span> WEEK);<span class="comment">-- è¡¨ç¤ºï¼š2017-05-22 10:37:14.123456</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span>);<span class="comment">-- è¡¨ç¤ºï¼š2017-05-16 10:37:14.123456</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">HOUR</span>);<span class="comment">-- è¡¨ç¤ºï¼š2017-05-15 11:37:14.123456</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">MINUTE</span>);<span class="comment">-- è¡¨ç¤ºï¼š2017-05-15 10:38:14.123456</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">SECOND</span>);<span class="comment">-- è¡¨ç¤ºï¼š2017-05-15 10:37:15.123456</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">1</span> MICROSECOND);<span class="comment">-- è¡¨ç¤ºï¼š2017-05-15 10:37:14.123457</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">-- DATE_SUB(date,INTERVAL expr type) ä»æ—¥æœŸå‡å»æŒ‡å®šçš„æ—¶é—´é—´éš”</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_SUB(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">YEAR</span>);<span class="comment">-- è¡¨ç¤ºï¼š2016-05-15 10:37:14.123456</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_SUB(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">1</span> QUARTER);<span class="comment">-- è¡¨ç¤ºï¼š2017-02-15 10:37:14.123456</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_SUB(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">MONTH</span>);<span class="comment">-- è¡¨ç¤ºï¼š2017-04-15 10:37:14.123456</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_SUB(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">1</span> WEEK);<span class="comment">-- è¡¨ç¤ºï¼š2017-05-08 10:37:14.123456</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_SUB(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span>);<span class="comment">-- è¡¨ç¤ºï¼š2017-05-14 10:37:14.123456</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_SUB(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">HOUR</span>);<span class="comment">-- è¡¨ç¤ºï¼š2017-05-15 09:37:14.123456</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_SUB(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">MINUTE</span>);<span class="comment">-- è¡¨ç¤ºï¼š2017-05-15 10:36:14.123456</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_SUB(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">SECOND</span>);<span class="comment">-- è¡¨ç¤ºï¼š2017-05-15 10:37:13.123456</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_SUB(<span class="string">&#x27;2017-05-15 10:37:14.123456&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">1</span> MICROSECOND);<span class="comment">-- è¡¨ç¤ºï¼š2017-05-15 10:37:14.123455</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">-- ç»ç‰¹æ®Šæ—¥æœŸæµ‹è¯•ï¼ŒDATE_SUB(date,INTERVAL expr type)å¯æ”¾å¿ƒä½¿ç”¨</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_SUB(CURDATE(),<span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span>);<span class="comment">-- å‰ä¸€å¤©ï¼š2017-05-11</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_SUB(CURDATE(),<span class="type">INTERVAL</span> <span class="number">-1</span> <span class="keyword">DAY</span>);<span class="comment">-- åä¸€å¤©ï¼š2017-05-13</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_SUB(CURDATE(),<span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">MONTH</span>);<span class="comment">-- ä¸€ä¸ªæœˆå‰æ—¥æœŸï¼š2017-04-12</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_SUB(CURDATE(),<span class="type">INTERVAL</span> <span class="number">-1</span> <span class="keyword">MONTH</span>);<span class="comment">-- ä¸€ä¸ªæœˆåæ—¥æœŸï¼š2017-06-12</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_SUB(CURDATE(),<span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">YEAR</span>);<span class="comment">-- ä¸€å¹´å‰æ—¥æœŸï¼š2016-05-12</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_SUB(CURDATE(),<span class="type">INTERVAL</span> <span class="number">-1</span> <span class="keyword">YEAR</span>);<span class="comment">-- ä¸€å¹´åæ—¥æœŸï¼š20178-06-12</span></span><br><span class="line"><span class="comment">-- MySQL date_sub() æ—¥æœŸæ—¶é—´å‡½æ•° å’Œ date_add() ç”¨æ³•ä¸€è‡´ï¼Œå¹¶ä¸”å¯ä»¥ç”¨INTERNAL -1 xxxçš„å½¢å¼äº’æ¢ä½¿ç”¨ï¼›</span></span><br><span class="line"><span class="comment">-- å¦å¤–ï¼ŒMySQL ä¸­è¿˜æœ‰ä¸¤ä¸ªå‡½æ•° subdate(), subtime()ï¼Œå»ºè®®ï¼Œç”¨ date_sub() æ¥æ›¿ä»£ã€‚</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">-- MySQL å¦ç±»æ—¥æœŸå‡½æ•°ï¼šperiod_add(P,N), period_diff(P1,P2)</span></span><br><span class="line"><span class="comment">-- å‡½æ•°å‚æ•°â€œPâ€ çš„æ ¼å¼ä¸ºâ€œYYYYMMâ€ æˆ–è€… â€œYYMMâ€ï¼Œç¬¬äºŒä¸ªå‚æ•°â€œNâ€ è¡¨ç¤ºå¢åŠ æˆ–å‡å» N monthï¼ˆæœˆï¼‰ã€‚</span></span><br><span class="line"><span class="comment">-- MySQL period_add(P,N)ï¼šæ—¥æœŸåŠ /å‡å»Næœˆã€‚</span></span><br><span class="line"><span class="keyword">SELECT</span> PERIOD_ADD(<span class="number">201705</span>,<span class="number">2</span>), PERIOD_ADD(<span class="number">201705</span>,<span class="number">-2</span>);<span class="comment">-- 201707  20170503</span></span><br><span class="line"><span class="comment">-- period_diff(P1,P2)ï¼šæ—¥æœŸ P1-P2ï¼Œè¿”å› N ä¸ªæœˆã€‚</span></span><br><span class="line"><span class="keyword">SELECT</span> PERIOD_DIFF(<span class="number">201706</span>, <span class="number">201703</span>);<span class="comment">-- </span></span><br><span class="line"><span class="comment">-- datediff(date1,date2)ï¼šä¸¤ä¸ªæ—¥æœŸç›¸å‡ date1 - date2ï¼Œè¿”å›å¤©æ•°</span></span><br><span class="line"><span class="keyword">SELECT</span> DATEDIFF(<span class="string">&#x27;2017-06-05&#x27;</span>,<span class="string">&#x27;2017-05-29&#x27;</span>);<span class="comment">-- 7</span></span><br><span class="line"><span class="comment">-- TIMEDIFF(time1,time2)ï¼šä¸¤ä¸ªæ—¥æœŸç›¸å‡ time1 - time2ï¼Œè¿”å› TIME å·®å€¼</span></span><br><span class="line"><span class="keyword">SELECT</span> TIMEDIFF(<span class="string">&#x27;2017-06-05 19:28:37&#x27;</span>, <span class="string">&#x27;2017-06-05 17:00:00&#x27;</span>);<span class="comment">-- 02:28:37</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">-- MySQLæ—¥æœŸè½¬æ¢å‡½æ•°</span></span><br><span class="line"><span class="keyword">SELECT</span> TIME_TO_SEC(<span class="string">&#x27;01:00:05&#x27;</span>); <span class="comment">-- 3605</span></span><br><span class="line"><span class="keyword">SELECT</span> SEC_TO_TIME(<span class="number">3605</span>);<span class="comment">-- 01:00:05</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">-- MySQL ï¼ˆæ—¥æœŸã€å¤©æ•°ï¼‰è½¬æ¢å‡½æ•°ï¼što_days(date), from_days(days)</span></span><br><span class="line"><span class="keyword">SELECT</span> TO_DAYS(<span class="string">&#x27;0000-00-00&#x27;</span>); <span class="comment">-- NULL </span></span><br><span class="line"><span class="keyword">SELECT</span> TO_DAYS(<span class="string">&#x27;2017-06-05&#x27;</span>); <span class="comment">-- 736850</span></span><br><span class="line"><span class="keyword">SELECT</span> FROM_DAYS(<span class="number">0</span>);           <span class="comment">-- &#x27;0000-00-00&#x27; </span></span><br><span class="line"><span class="keyword">SELECT</span> FROM_DAYS(<span class="number">736850</span>);      <span class="comment">-- &#x27;2017-06-05&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">-- MySQL Str to Date ï¼ˆå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ—¥æœŸï¼‰å‡½æ•°ï¼šstr_to_date(str, format)</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">SELECT</span> STR_TO_DATE(<span class="string">&#x27;06.05.2017 19:40:30&#x27;</span>, <span class="string">&#x27;%m.%d.%Y %H:%i:%s&#x27;</span>);<span class="comment">-- 2017-06-05 19:40:30</span></span><br><span class="line"><span class="keyword">SELECT</span> STR_TO_DATE(<span class="string">&#x27;06/05/2017&#x27;</span>, <span class="string">&#x27;%m/%d/%Y&#x27;</span>);                  <span class="comment">-- 2017-06-05</span></span><br><span class="line"><span class="keyword">SELECT</span> STR_TO_DATE(<span class="string">&#x27;2017/12/3&#x27;</span>,<span class="string">&#x27;%Y/%m/%d&#x27;</span>)       <span class="comment">-- 2017-12-03</span></span><br><span class="line"><span class="keyword">SELECT</span> STR_TO_DATE(<span class="string">&#x27;20:09:30&#x27;</span>, <span class="string">&#x27;%h:%i:%s&#x27;</span>)       <span class="comment">-- NULL(è¶…è¿‡12æ—¶çš„å°æ—¶ç”¨å°å†™hï¼Œå¾—åˆ°çš„ç»“æœä¸ºNULL)</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">-- æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(<span class="string">&#x27;2017-05-12 17:03:51&#x27;</span>, <span class="string">&#x27;%Yå¹´%mæœˆ%dæ—¥ %Hæ—¶%iåˆ†%sç§’&#x27;</span>);<span class="comment">-- 2017å¹´05æœˆ12æ—¥ 17æ—¶03åˆ†51ç§’(å…·ä½“éœ€è¦ä»€ä¹ˆæ ¼å¼çš„æ•°æ®æ ¹æ®å®é™…æƒ…å†µæ¥;å°å†™hä¸º12å°æ—¶åˆ¶;)</span></span><br><span class="line"><span class="keyword">SELECT</span> TIME_FORMAT(<span class="string">&#x27;2017-05-12 17:03:51&#x27;</span>, <span class="string">&#x27;%Yå¹´%mæœˆ%dæ—¥ %Hæ—¶%iåˆ†%sç§’&#x27;</span>);<span class="comment">-- 0000å¹´00æœˆ00æ—¥ 17æ—¶03åˆ†51ç§’(time_format()åªèƒ½ç”¨äºæ—¶é—´çš„æ ¼å¼åŒ–)</span></span><br><span class="line"><span class="comment">-- STR_TO_DATE()å’ŒDATE_FORMATE()ä¸ºäº’é€†æ“ä½œ</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">-- MySQL è·å¾—å›½å®¶åœ°åŒºæ—¶é—´æ ¼å¼å‡½æ•°ï¼šget_format()</span></span><br><span class="line"><span class="comment">-- MySQL get_format() è¯­æ³•ï¼šget_format(date|time|datetime, &#x27;eur&#x27;|&#x27;usa&#x27;|&#x27;jis&#x27;|&#x27;iso&#x27;|&#x27;internal&#x27;</span></span><br><span class="line"><span class="comment">-- MySQL get_format() ç”¨æ³•çš„å…¨éƒ¨ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="keyword">SELECT</span> GET_FORMAT(<span class="type">DATE</span>,<span class="string">&#x27;usa&#x27;</span>);   <span class="comment">-- &#x27;%m.%d.%Y&#x27; </span></span><br><span class="line"><span class="keyword">SELECT</span> GET_FORMAT(<span class="type">DATE</span>,<span class="string">&#x27;jis&#x27;</span>);   <span class="comment">-- &#x27;%Y-%m-%d&#x27; </span></span><br><span class="line"><span class="keyword">SELECT</span> GET_FORMAT(<span class="type">DATE</span>,<span class="string">&#x27;iso&#x27;</span>);   <span class="comment">-- &#x27;%Y-%m-%d&#x27; </span></span><br><span class="line"><span class="keyword">SELECT</span> GET_FORMAT(<span class="type">DATE</span>,<span class="string">&#x27;eur&#x27;</span>);   <span class="comment">-- &#x27;%d.%m.%Y&#x27; </span></span><br><span class="line"><span class="keyword">SELECT</span> GET_FORMAT(<span class="type">DATE</span>,<span class="string">&#x27;internal&#x27;</span>);   <span class="comment">-- &#x27;%Y%m%d&#x27; </span></span><br><span class="line"><span class="keyword">SELECT</span> GET_FORMAT(DATETIME,<span class="string">&#x27;usa&#x27;</span>);   <span class="comment">-- &#x27;%Y-%m-%d %H.%i.%s&#x27; </span></span><br><span class="line"><span class="keyword">SELECT</span> GET_FORMAT(DATETIME,<span class="string">&#x27;jis&#x27;</span>);   <span class="comment">-- &#x27;%Y-%m-%d %H:%i:%s&#x27; </span></span><br><span class="line"><span class="keyword">SELECT</span> GET_FORMAT(DATETIME,<span class="string">&#x27;iso&#x27;</span>);   <span class="comment">-- &#x27;%Y-%m-%d %H:%i:%s&#x27; </span></span><br><span class="line"><span class="keyword">SELECT</span> GET_FORMAT(DATETIME,<span class="string">&#x27;eur&#x27;</span>);   <span class="comment">-- &#x27;%Y-%m-%d %H.%i.%s&#x27; </span></span><br><span class="line"><span class="keyword">SELECT</span> GET_FORMAT(DATETIME,<span class="string">&#x27;internal&#x27;</span>); <span class="comment">-- &#x27;%Y%m%d%H%i%s&#x27; </span></span><br><span class="line"><span class="keyword">SELECT</span> GET_FORMAT(<span class="type">TIME</span>,<span class="string">&#x27;usa&#x27;</span>);   <span class="comment">-- &#x27;%h:%i:%s %p&#x27; </span></span><br><span class="line"><span class="keyword">SELECT</span> GET_FORMAT(<span class="type">TIME</span>,<span class="string">&#x27;jis&#x27;</span>);   <span class="comment">-- &#x27;%H:%i:%s&#x27; </span></span><br><span class="line"><span class="keyword">SELECT</span> GET_FORMAT(<span class="type">TIME</span>,<span class="string">&#x27;iso&#x27;</span>);   <span class="comment">-- &#x27;%H:%i:%s&#x27; </span></span><br><span class="line"><span class="keyword">SELECT</span> GET_FORMAT(<span class="type">TIME</span>,<span class="string">&#x27;eur&#x27;</span>);   <span class="comment">-- &#x27;%H.%i.%s&#x27; </span></span><br><span class="line"><span class="keyword">SELECT</span> GET_FORMAT(<span class="type">TIME</span>,<span class="string">&#x27;internal&#x27;</span>);     <span class="comment">-- &#x27;%H%i%s&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">-- MySQL æ‹¼å‡‘æ—¥æœŸã€æ—¶é—´å‡½æ•°ï¼šmakdedate(year,dayofyear), maketime(hour,minute,second)</span></span><br><span class="line"><span class="keyword">SELECT</span> MAKEDATE(<span class="number">2017</span>,<span class="number">31</span>);   <span class="comment">-- &#x27;2017-01-31&#x27; </span></span><br><span class="line"><span class="keyword">SELECT</span> MAKEDATE(<span class="number">2017</span>,<span class="number">32</span>);   <span class="comment">-- &#x27;2017-02-01&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> MAKETIME(<span class="number">19</span>,<span class="number">52</span>,<span class="number">35</span>);  <span class="comment">-- &#x27;19:52:35&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">-- MySQL æ—¶åŒºï¼ˆtimezoneï¼‰è½¬æ¢å‡½æ•°ï¼šconvert_tz(dt,from_tz,to_tz)</span></span><br><span class="line"><span class="keyword">SELECT</span> CONVERT_TZ(<span class="string">&#x27;2017-06-05 19:54:12&#x27;</span>, <span class="string">&#x27;+08:00&#x27;</span>, <span class="string">&#x27;+00:00&#x27;</span>); <span class="comment">-- 2017-06-05 11:54:12</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">-- MySQL ï¼ˆUnix æ—¶é—´æˆ³ã€æ—¥æœŸï¼‰è½¬æ¢å‡½æ•°</span></span><br><span class="line"><span class="comment">-- unix_timestamp(), unix_timestamp(date), from_unixtime(unix_timestamp), from_unixtime(unix_timestamp,format)</span></span><br><span class="line"><span class="comment">-- å°†å…·ä½“æ—¶é—´æ—¶é—´è½¬ä¸ºtimestamp</span></span><br><span class="line"><span class="keyword">SELECT</span> UNIX_TIMESTAMP();<span class="comment">-- å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³ï¼š1494815779</span></span><br><span class="line"><span class="keyword">SELECT</span> UNIX_TIMESTAMP(<span class="string">&#x27;2017-05-15&#x27;</span>);<span class="comment">-- æŒ‡å®šæ—¥æœŸçš„æ—¶é—´æˆ³ï¼š1494777600</span></span><br><span class="line"><span class="keyword">SELECT</span> UNIX_TIMESTAMP(<span class="string">&#x27;2017-05-15 10:37:14&#x27;</span>);<span class="comment">-- æŒ‡å®šæ—¥æœŸæ—¶é—´çš„æ—¶é—´æˆ³ï¼š1494815834</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">-- å°†æ—¶é—´æˆ³è½¬ä¸ºå…·ä½“æ—¶é—´</span></span><br><span class="line"><span class="keyword">SELECT</span> FROM_UNIXTIME(<span class="number">1494815834</span>);<span class="comment">-- 2017-05-15 10:37:14</span></span><br><span class="line"><span class="keyword">SELECT</span> FROM_UNIXTIME(<span class="number">1494815834</span>, <span class="string">&#x27;%Yå¹´%mæœˆ%dæ—¥ %hæ—¶%åˆ†:%sç§’&#x27;</span>);<span class="comment">-- è·å–æ—¶é—´æˆ³å¯¹åº”çš„æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">-- MySQL æ—¶é—´æˆ³ï¼ˆtimestampï¼‰è½¬æ¢ã€å¢ã€å‡å‡½æ•°</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="type">TIMESTAMP</span>(<span class="string">&#x27;2017-05-15&#x27;</span>);<span class="comment">-- 2017-05-15 00:00:00</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="type">TIMESTAMP</span>(<span class="string">&#x27;2017-05-15 08:12:25&#x27;</span>, <span class="string">&#x27;01:01:01&#x27;</span>);<span class="comment">-- 2017-05-15 09:13:26</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(<span class="string">&#x27;2017-05-15 08:12:25&#x27;</span>, <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span>);<span class="comment">-- 2017-05-16 08:12:25</span></span><br><span class="line"><span class="keyword">SELECT</span> TIMESTAMPADD(<span class="keyword">DAY</span>, <span class="number">1</span>, <span class="string">&#x27;2017-05-15 08:12:25&#x27;</span>);<span class="comment">-- 2017-05-16 08:12:25; MySQL timestampadd() å‡½æ•°ç±»ä¼¼äº date_add()ã€‚</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">SELECT</span> TIMESTAMPDIFF(<span class="keyword">YEAR</span>, <span class="string">&#x27;2017-06-01&#x27;</span>, <span class="string">&#x27;2016-05-15&#x27;</span>);<span class="comment">-- -1</span></span><br><span class="line"><span class="keyword">SELECT</span> TIMESTAMPDIFF(<span class="keyword">MONTH</span>, <span class="string">&#x27;2017-06-01&#x27;</span>, <span class="string">&#x27;2016-06-15&#x27;</span>);<span class="comment">-- -11</span></span><br><span class="line"><span class="keyword">SELECT</span> TIMESTAMPDIFF(<span class="keyword">DAY</span>, <span class="string">&#x27;2017-06-01&#x27;</span>, <span class="string">&#x27;2016-06-15&#x27;</span>);<span class="comment">-- -351</span></span><br><span class="line"><span class="keyword">SELECT</span> TIMESTAMPDIFF(<span class="keyword">HOUR</span>, <span class="string">&#x27;2017-06-01 08:12:25&#x27;</span>, <span class="string">&#x27;2016-06-15 00:00:00&#x27;</span>);<span class="comment">-- -8432</span></span><br><span class="line"><span class="keyword">SELECT</span> TIMESTAMPDIFF(<span class="keyword">MINUTE</span>, <span class="string">&#x27;2017-06-01 08:12:25&#x27;</span>, <span class="string">&#x27;2016-06-15 00:00:00&#x27;</span>);<span class="comment">-- -505932</span></span><br><span class="line"><span class="keyword">SELECT</span> TIMESTAMPDIFF(<span class="keyword">SECOND</span>, <span class="string">&#x27;2017-06-01 08:12:25&#x27;</span>, <span class="string">&#x27;2016-06-15 00:00:00&#x27;</span>);<span class="comment">-- -30355945</span></span><br></pre></td></tr></table></figure></details><h2 id="1-7-è‡ªåŠ¨èµ‹å€¼æ—¶é—´æˆ³"><a href="#1-7-è‡ªåŠ¨èµ‹å€¼æ—¶é—´æˆ³" class="headerlink" title="1.7 è‡ªåŠ¨èµ‹å€¼æ—¶é—´æˆ³"></a>1.7 è‡ªåŠ¨èµ‹å€¼æ—¶é—´æˆ³</h2><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://dev.mysql.com/doc/refman/8.0/en/timestamp-initialization.html">https://dev.mysql.com/doc/refman/8.0/en/timestamp-initialization.html</a></p><p>MySQLæœ‰æ—¶é—´å‡½æ•°ï¼Œä¹Ÿå¯ä»¥åœ¨æ’å…¥å’Œæ“ä½œæ•°æ®çš„æ—¶å€™è‡ªåŠ¨å¸®æˆ‘ä»¬æ›´æ–°æ—¶é—´ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹è¯­å¥ï¼Œåœ¨TIMESTAMPå’ŒDATETIMEç±»å‹ä¸­éƒ½å¯ä»¥è¿™ä¹ˆä½¿ç”¨ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1 (</span><br><span class="line">  ts <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  dt DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><code>ON UPDATE</code>è¯­å¥çš„å«ä¹‰ä¸ºå½“è¡Œè¢«æ›´æ–°çš„æ—¶å€™ï¼Œå°±è‡ªåŠ¨æ›´æ–°ä¸ºå½“å‰æ—¶é—´ï¼ˆå³æ›´æ–°æ—¶é—´ï¼‰</p><p>ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ï¼šç”¨æˆ·è¡¨ä¸­ï¼Œæˆ‘ä»¬çš„ä¸€æ¡è®°å½•å¯ä»¥æœ‰ä¸¤ä¸ªæ—¶é—´å­—æ®µï¼Œä¸€ä¸ªæ˜¯æ›´æ–°æ—¶é—´ï¼Œå³ç”¨æˆ·ä¿¡æ¯è¢«ç”¨æˆ·ä¿®æ”¹åçš„æ—¶é—´ï¼ˆè¿™ä¸ªæ—¶é—´å¯ä»¥ç”¨æ¥é™åˆ¶ç”¨æˆ·å¤šä¹…æ‰èƒ½ä¿®æ”¹ä¸€æ¬¡ä¸ªäººä¿¡æ¯ç­‰æ“ä½œï¼‰ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯æ’å…¥æ—¶é—´ï¼Œå³ç”¨æˆ·æ³¨å†Œçš„æ—¶é—´ã€‚</p><p>æ­¤æ—¶å¯ä»¥è®©MySQLæ¥è‡ªåŠ¨å¸®æˆ‘ä»¬ç»´æŠ¤æ’å…¥æ—¶é—´å’Œæ›´æ–°æ—¶é—´ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> your_table (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  data <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  created_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  updated_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><h1 id="2-å­—ç¬¦ä¸²å‡½æ•°"><a href="#2-å­—ç¬¦ä¸²å‡½æ•°" class="headerlink" title="2.å­—ç¬¦ä¸²å‡½æ•°"></a>2.å­—ç¬¦ä¸²å‡½æ•°</h1><table><thead><tr><th>å‡½æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>charset(str)</td><td>è¿”å›å­—ç¬¦ä¸²çš„å­—ç¬¦é›†</td></tr><tr><td>concat(str1,str2[,â€¦])</td><td>æ‹¼æ¥å¤šä¸ªå­—ç¬¦ä¸²</td></tr><tr><td>instr(str,substr)</td><td>è¿”å›substråœ¨strä¸­å‡ºç°çš„ä½ç½®ï¼Œä¸å­˜åœ¨åˆ™è¿”å›0</td></tr><tr><td>ucase(string)</td><td>å­—ç¬¦ä¸²è½¬å¤§å†™</td></tr><tr><td>lcase(string)</td><td>å­—ç¬¦ä¸²è½¬å°å†™</td></tr><tr><td>left(string,length)&#x2F;right(string,length)</td><td>ä»stringçš„å·¦è¾¹&#x2F;å³è¾¹èµ·å–lengthä¸ªå­—ç¬¦</td></tr><tr><td>length(string)</td><td>å­—ç¬¦ä¸²é•¿åº¦</td></tr><tr><td>replace(str,search_str,replace_str)</td><td>å°†strä¸­çš„replace_stréƒ¨åˆ†æ›¿æ¢ä¸ºsearch_str</td></tr><tr><td>strcmp(str1,str2)</td><td>é€å­—ç¬¦æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²çš„å¤§å°</td></tr><tr><td>substring(str,position [,length])</td><td>ä»strçš„positionå¼€å§‹å–lengthä¸ªå­—ç¬¦</td></tr><tr><td>ltrim(strin)&#x2F;rtrim(str)&#x2F;trim(str)</td><td>å»é™¤å­—ç¬¦ä¸²ä¸­çš„å‰ç©ºæ ¼æˆ–è€…åç©ºæ ¼</td></tr></tbody></table><p>ç®€å•æµ‹è¯•ä¸€ä¸‹è¿™äº›å‡½æ•°çš„ä½¿ç”¨å§</p><h2 id="2-1-æŸ¥çœ‹å­—ç¬¦ä¸²å­—ç¬¦é›†"><a href="#2-1-æŸ¥çœ‹å­—ç¬¦ä¸²å­—ç¬¦é›†" class="headerlink" title="2.1 æŸ¥çœ‹å­—ç¬¦ä¸²å­—ç¬¦é›†"></a>2.1 æŸ¥çœ‹å­—ç¬¦ä¸²å­—ç¬¦é›†</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [stu_test]&gt; select charset(&quot;ä½ å¥½&quot;);</span><br><span class="line">+-------------------+</span><br><span class="line">| charset(&quot;ä½ å¥½&quot;)   |</span><br><span class="line">+-------------------+</span><br><span class="line">| utf8mb3           |</span><br><span class="line">+-------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; select charset(&quot;125412446&quot;);</span><br><span class="line">+----------------------+</span><br><span class="line">| charset(&quot;125412446&quot;) |</span><br><span class="line">+----------------------+</span><br><span class="line">| utf8mb3              |</span><br><span class="line">+----------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; select charset(name) from student;</span><br><span class="line">+---------------+</span><br><span class="line">| charset(name) |</span><br><span class="line">+---------------+</span><br><span class="line">| utf8mb4       |</span><br><span class="line">| utf8mb4       |</span><br><span class="line">| utf8mb4       |</span><br><span class="line">| utf8mb4       |</span><br><span class="line">| utf8mb4       |</span><br><span class="line">+---------------+</span><br><span class="line">5 rows in set (0.000 sec)</span><br></pre></td></tr></table></figure><h2 id="2-2-å­—ç¬¦ä¸²æ‹¼æ¥"><a href="#2-2-å­—ç¬¦ä¸²æ‹¼æ¥" class="headerlink" title="2.2 å­—ç¬¦ä¸²æ‹¼æ¥"></a>2.2 å­—ç¬¦ä¸²æ‹¼æ¥</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [stu_test]&gt; select concat(&#x27;ä½ å¥½&#x27;,&#x27;ï¼Œ&#x27;,&#x27;ä»Šå¤©å¤©æ°”ä¸é”™&#x27;);</span><br><span class="line">+---------------------------------------------+</span><br><span class="line">| concat(&#x27;ä½ å¥½&#x27;,&#x27;ï¼Œ&#x27;,&#x27;ä»Šå¤©å¤©æ°”ä¸é”™&#x27;)          |</span><br><span class="line">+---------------------------------------------+</span><br><span class="line">| ä½ å¥½ï¼Œä»Šå¤©å¤©æ°”ä¸é”™                          |</span><br><span class="line">+---------------------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><h2 id="2-3-å­å­—ç¬¦ä¸²æŸ¥è¯¢"><a href="#2-3-å­å­—ç¬¦ä¸²æŸ¥è¯¢" class="headerlink" title="2.3 å­å­—ç¬¦ä¸²æŸ¥è¯¢"></a>2.3 å­å­—ç¬¦ä¸²æŸ¥è¯¢</h2><p>ä½¿ç”¨instræŸ¥è¯¢ï¼Œåœ¨ç¬¬ä¸€ä¸ªå‚æ•°ä¸­æŸ¥è¯¢ç¬¬äºŒä¸ªå‚æ•°çš„å­—ç¬¦ä¸²ã€‚æ‰¾åˆ°äº†å­ä¸²åï¼Œè¿”å›èµ·å§‹ä½ç½®çš„åç§»é‡ï¼ˆå¹¶éä¸‹æ ‡ï¼‰ï¼Œæ²¡æœ‰æ‰¾åˆ°è¿”å›0ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [stu_test]&gt; select instr(&#x27;abcdef&#x27;,&#x27;bc&#x27;);</span><br><span class="line">+----------------------+</span><br><span class="line">| instr(&#x27;abcdef&#x27;,&#x27;bc&#x27;) |</span><br><span class="line">+----------------------+</span><br><span class="line">|                    2 |</span><br><span class="line">+----------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; select instr(&#x27;abcdef&#x27;,&#x27;asdfa&#x27;);</span><br><span class="line">+-------------------------+</span><br><span class="line">| instr(&#x27;abcdef&#x27;,&#x27;asdfa&#x27;) |</span><br><span class="line">+-------------------------+</span><br><span class="line">|                       0 |</span><br><span class="line">+-------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><h2 id="2-4-å­—ç¬¦ä¸²æ¯”è¾ƒ"><a href="#2-4-å­—ç¬¦ä¸²æ¯”è¾ƒ" class="headerlink" title="2.4 å­—ç¬¦ä¸²æ¯”è¾ƒ"></a>2.4 å­—ç¬¦ä¸²æ¯”è¾ƒ</h2><p>å’ŒCè¯­è¨€ä¸­ç”¨çš„æ˜¯åŒä¸€ä¸ªå‡½æ•°åstrcmpï¼›</p><ul><li>ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²æ›´å¤§è¿”å›<code>1</code>ï¼›</li><li>ç¬¬äºŒä¸ªå­—ç¬¦ä¸²æ›´å¤§è¿”å›<code>-1</code>ï¼›</li><li>ä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸åŒè¿”å›<code>0</code>ï¼ˆå¿½ç•¥å¤§å°å†™ï¼‰ï¼›</li></ul><p>æ³¨æ„å®ƒçš„æ¯”è¾ƒæ˜¯æ ¹æ®å­—ç¬¦çš„ASCIIç æ¥é€å­—ç¬¦æ¯”è¾ƒçš„ï¼Œæ¯”å¦‚å°å†™å­—æ¯çš„ASCIIç å°±æ›´å¤§ï¼Œæ‰€ä»¥ABå’Œadæ¯”è¾ƒçš„ç»“æœæ˜¯è´Ÿä¸€ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [stu_test]&gt; select strcmp(&#x27;AB&#x27;,&#x27;AB&#x27;);</span><br><span class="line">+-------------------+</span><br><span class="line">| strcmp(&#x27;AB&#x27;,&#x27;AB&#x27;) |</span><br><span class="line">+-------------------+</span><br><span class="line">|                 0 |</span><br><span class="line">+-------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; select strcmp(&#x27;AB&#x27;,&#x27;aB&#x27;);</span><br><span class="line">+-------------------+</span><br><span class="line">| strcmp(&#x27;AB&#x27;,&#x27;aB&#x27;) |</span><br><span class="line">+-------------------+</span><br><span class="line">|                 0 |</span><br><span class="line">+-------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; select strcmp(&#x27;AB&#x27;,&#x27;ad&#x27;);</span><br><span class="line">+-------------------+</span><br><span class="line">| strcmp(&#x27;AB&#x27;,&#x27;ad&#x27;) |</span><br><span class="line">+-------------------+</span><br><span class="line">|                -1 |</span><br><span class="line">+-------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; select strcmp(&#x27;AB&#x27;,&#x27;ABC&#x27;);</span><br><span class="line">+--------------------+</span><br><span class="line">| strcmp(&#x27;AB&#x27;,&#x27;ABC&#x27;) |</span><br><span class="line">+--------------------+</span><br><span class="line">|                 -1 |</span><br><span class="line">+--------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; select strcmp(&#x27;ABcd&#x27;,&#x27;ABC&#x27;);</span><br><span class="line">+----------------------+</span><br><span class="line">| strcmp(&#x27;ABcd&#x27;,&#x27;ABC&#x27;) |</span><br><span class="line">+----------------------+</span><br><span class="line">|                    1 |</span><br><span class="line">+----------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸­æ–‡æ¯”è¾ƒåº”è¯¥ä¹Ÿæ˜¯ç±»ä¼¼çš„é€»è¾‘ï¼Œåªä¸è¿‡ä¸­æ–‡ç¼–ç è¿™æ–¹é¢æˆ‘ä¸å¤ªæ‡‚ï¼Œå°±ä¸æ·±å…¥æ¢ç©¶äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [stu_test]&gt; select strcmp(&#x27;ä½ å¥½&#x27;,&#x27;ä½ å¥½å—&#x27;);</span><br><span class="line">+------------------------------+</span><br><span class="line">| strcmp(&#x27;ä½ å¥½&#x27;,&#x27;ä½ å¥½å—&#x27;)      |</span><br><span class="line">+------------------------------+</span><br><span class="line">|                           -1 |</span><br><span class="line">+------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; select strcmp(&#x27;ä½ å¥½&#x27;,&#x27;ä½ &#x27;);</span><br><span class="line">+------------------------+</span><br><span class="line">| strcmp(&#x27;ä½ å¥½&#x27;,&#x27;ä½ &#x27;)    |</span><br><span class="line">+------------------------+</span><br><span class="line">|                      1 |</span><br><span class="line">+------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; select strcmp(&#x27;ä½ å¥½&#x27;,&#x27;ä½ å¥½&#x27;);</span><br><span class="line">+---------------------------+</span><br><span class="line">| strcmp(&#x27;ä½ å¥½&#x27;,&#x27;ä½ å¥½&#x27;)     |</span><br><span class="line">+---------------------------+</span><br><span class="line">|                         0 |</span><br><span class="line">+---------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; select strcmp(&#x27;ä½ å¥½&#x27;,&#x27;åœ¨å—&#x27;);</span><br><span class="line">+---------------------------+</span><br><span class="line">| strcmp(&#x27;ä½ å¥½&#x27;,&#x27;åœ¨å—&#x27;)     |</span><br><span class="line">+---------------------------+</span><br><span class="line">|                        -1 |</span><br><span class="line">+---------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><h2 id="2-5-å¤§å°å†™è½¬æ¢"><a href="#2-5-å¤§å°å†™è½¬æ¢" class="headerlink" title="2.5 å¤§å°å†™è½¬æ¢"></a>2.5 å¤§å°å†™è½¬æ¢</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [stu_test]&gt; select ucase(&#x27;adfasbasdf324r&#x27;);</span><br><span class="line">+-------------------------+</span><br><span class="line">| ucase(&#x27;adfasbasdf324r&#x27;) |</span><br><span class="line">+-------------------------+</span><br><span class="line">| ADFASBASDF324R          |</span><br><span class="line">+-------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; select lcase(&#x27;ADSB3QRdsadsfweq2&#x27;);</span><br><span class="line">+----------------------------+</span><br><span class="line">| lcase(&#x27;ADSB3QRdsadsfweq2&#x27;) |</span><br><span class="line">+----------------------------+</span><br><span class="line">| adsb3qrdsadsfweq2          |</span><br><span class="line">+----------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><h2 id="2-6-æˆªå–å­—ç¬¦ä¸²"><a href="#2-6-æˆªå–å­—ç¬¦ä¸²" class="headerlink" title="2.6 æˆªå–å­—ç¬¦ä¸²"></a>2.6 æˆªå–å­—ç¬¦ä¸²</h2><p>leftå’Œrightç”¨äºä»å­—ç¬¦ä¸²çš„å·¦è¾¹æˆ–å³è¾¹å¼€å§‹æˆªå–ç»™å®šé•¿åº¦çš„ä¸²</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [stu_test]&gt; select left(&#x27;123456&#x27;,2);</span><br><span class="line">+------------------+</span><br><span class="line">| left(&#x27;123456&#x27;,2) |</span><br><span class="line">+------------------+</span><br><span class="line">| 12               |</span><br><span class="line">+------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; select right(&#x27;123456&#x27;,2);</span><br><span class="line">+-------------------+</span><br><span class="line">| right(&#x27;123456&#x27;,2) |</span><br><span class="line">+-------------------+</span><br><span class="line">| 56                |</span><br><span class="line">+-------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><p>å¯¹äºä¸­æ–‡è€Œè¨€ä¹Ÿæ˜¯æˆªå–ä¸¤ä¸ªæ±‰å­—</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [stu_test]&gt; select right(&#x27;è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•&#x27;,2);</span><br><span class="line">+-------------------------------+</span><br><span class="line">| right(&#x27;è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•&#x27;,2)       |</span><br><span class="line">+-------------------------------+</span><br><span class="line">| æµ‹è¯•                          |</span><br><span class="line">+-------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; select left(&#x27;è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•&#x27;,2);</span><br><span class="line">+------------------------------+</span><br><span class="line">| left(&#x27;è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•&#x27;,2)       |</span><br><span class="line">+------------------------------+</span><br><span class="line">| è¿™æ˜¯                         |</span><br><span class="line">+------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><p>ç„¶åè¿˜æœ‰substringå‡½æ•°ï¼Œå¯ä»¥ä»ç»™å®šä½ç½®æˆªå–å­—ç¬¦ä¸²</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [stu_test]&gt; select substring(&#x27;123456&#x27;,2,2);</span><br><span class="line">+-------------------------+</span><br><span class="line">| substring(&#x27;123456&#x27;,2,2) |</span><br><span class="line">+-------------------------+</span><br><span class="line">| 23                      |</span><br><span class="line">+-------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><h2 id="2-7-å»é™¤ç©ºæ ¼"><a href="#2-7-å»é™¤ç©ºæ ¼" class="headerlink" title="2.7 å»é™¤ç©ºæ ¼"></a>2.7 å»é™¤ç©ºæ ¼</h2><p>ltrimå’Œrtrimç”¨äºå»é™¤å­—ç¬¦ä¸²å·¦ä¾§æˆ–è€…å³ä¾§çš„ç©ºæ ¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [stu_test]&gt; select ltrim(&#x27; æµ‹è¯•&#x27;);</span><br><span class="line">+------------------+</span><br><span class="line">| ltrim(&#x27; æµ‹è¯•&#x27;)   |</span><br><span class="line">+------------------+</span><br><span class="line">| æµ‹è¯•             |</span><br><span class="line">+------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; select rtrim(&#x27;å³è¾¹ç©ºæ ¼æµ‹è¯•              &#x27;);</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">| rtrim(&#x27;å³è¾¹ç©ºæ ¼æµ‹è¯•              &#x27;)       |</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">| å³è¾¹ç©ºæ ¼æµ‹è¯•                              |</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><p>trimæ˜¯åŒæ—¶å»é™¤å­—ç¬¦ä¸²å·¦ä¾§å’Œå³ä¾§çš„ç©ºæ ¼ï¼Œä¸ä¼šå¯¹å­—ç¬¦ä¸²å†…éƒ¨çš„ç©ºæ ¼åšæ“ä½œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [stu_test]&gt; select trim(&#x27; ç©º æ ¼ å»é™¤æµ‹è¯• &#x27;);</span><br><span class="line">+--------------------------------+</span><br><span class="line">| trim( &#x27;ç©º æ ¼ å»é™¤æµ‹è¯• &#x27;)       |</span><br><span class="line">+--------------------------------+</span><br><span class="line">| ç©º æ ¼ å»é™¤æµ‹è¯•                 |</span><br><span class="line">+--------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; select trim(&#x27;ç©º æ ¼ å»é™¤æµ‹è¯•&#x27;);</span><br><span class="line">+------------------------------+</span><br><span class="line">| trim(&#x27;ç©º æ ¼ å»é™¤æµ‹è¯•&#x27;)       |</span><br><span class="line">+------------------------------+</span><br><span class="line">| ç©º æ ¼ å»é™¤æµ‹è¯•               |</span><br><span class="line">+------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><h2 id="2-8-å­—ç¬¦ä¸²é•¿åº¦"><a href="#2-8-å­—ç¬¦ä¸²é•¿åº¦" class="headerlink" title="2.8 å­—ç¬¦ä¸²é•¿åº¦"></a>2.8 å­—ç¬¦ä¸²é•¿åº¦</h2><p>æ³¨æ„ï¼Œå½“å‰ä¸ºäº†æ”¯æŒä¸­æ–‡ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†utf8ä½œä¸ºMySQLçš„å­—ç¬¦é›†ï¼Œåœ¨utf8ä¸­ä¸­æ–‡æ˜¯3å­—èŠ‚å­˜å‚¨çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [stu_test]&gt; select *,length(name) from stu;</span><br><span class="line">+------+--------+--------------+</span><br><span class="line">| id   | name   | length(name) |</span><br><span class="line">+------+--------+--------------+</span><br><span class="line">|    1 | jack   |            4 |</span><br><span class="line">|    2 | tom    |            3 |</span><br><span class="line">|    3 | kity   |            4 |</span><br><span class="line">|    4 | nono   |            4 |</span><br><span class="line">|    5 | å°æ˜   |            6 |</span><br><span class="line">+------+--------+--------------+</span><br><span class="line">5 rows in set (0.000 sec)</span><br></pre></td></tr></table></figure><h1 id="3-æ•°å­¦å‡½æ•°"><a href="#3-æ•°å­¦å‡½æ•°" class="headerlink" title="3.æ•°å­¦å‡½æ•°"></a>3.æ•°å­¦å‡½æ•°</h1><table><thead><tr><th>å‡½æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>abs(num)</td><td>ç»å¯¹å€¼</td></tr><tr><td>bin(decimal_num)</td><td>åè¿›åˆ¶è½¬äºŒè¿›åˆ¶</td></tr><tr><td>hex(decimal_num)</td><td>åè¿›åˆ¶è½¬åå…­è¿›åˆ¶</td></tr><tr><td>conv(num,from_base,to_base)</td><td>è¿›åˆ¶è½¬æ¢</td></tr><tr><td>ceiling(num)</td><td>å‘ä¸Šå–æ•´</td></tr><tr><td>floor(num)</td><td>å‘ä¸‹å–æ•´</td></tr><tr><td>rand()</td><td>è¿”å›éšæœºæµ®ç‚¹æ•°ï¼ŒèŒƒå›´<code>[0.0, 1.0)</code></td></tr><tr><td>mod(num,denominator)</td><td>å–æ¨¡ï¼Œæ±‚ä½™</td></tr><tr><td>format(num,dnum)</td><td>ä¿ç•™numçš„dnumä½å°æ•°</td></tr></tbody></table><h2 id="3-1-ç»å¯¹å€¼"><a href="#3-1-ç»å¯¹å€¼" class="headerlink" title="3.1 ç»å¯¹å€¼"></a>3.1 ç»å¯¹å€¼</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [stu_test]&gt; select abs(-1241.12431);</span><br><span class="line">+------------------+</span><br><span class="line">| abs(-1241.12431) |</span><br><span class="line">+------------------+</span><br><span class="line">|       1241.12431 |</span><br><span class="line">+------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><h2 id="3-2-è¿›åˆ¶è½¬æ¢"><a href="#3-2-è¿›åˆ¶è½¬æ¢" class="headerlink" title="3.2 è¿›åˆ¶è½¬æ¢"></a>3.2 è¿›åˆ¶è½¬æ¢</h2><p>åè¿›åˆ¶è½¬äºŒè¿›åˆ¶å’Œåå…­è¿›åˆ¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [stu_test]&gt; select bin(100);</span><br><span class="line">+----------+</span><br><span class="line">| bin(100) |</span><br><span class="line">+----------+</span><br><span class="line">| 1100100  |</span><br><span class="line">+----------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; select hex(100);</span><br><span class="line">+----------+</span><br><span class="line">| hex(100) |</span><br><span class="line">+----------+</span><br><span class="line">| 64       |</span><br><span class="line">+----------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><p>åœ¨ä»»æ„è¿›åˆ¶ä¸­è½¬æ¢ï¼Œæºè¿›åˆ¶å’Œç›®æ ‡è¿›åˆ¶éƒ½æ˜¯é€šè¿‡æ•°å­—ä¼ å…¥ï¼Œæ¯”å¦‚<code>2/8/10/16</code>ï¼›</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conv(ç›®æ ‡æ•°å­—,æºè¿›åˆ¶,ç›®æ ‡è¿›åˆ¶);</span><br></pre></td></tr></table></figure><p>æµ‹è¯•å¦‚ä¸‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [stu_test]<span class="operator">&gt;</span> <span class="keyword">select</span> conv(<span class="number">100</span>,<span class="number">2</span>,<span class="number">16</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+</span></span><br><span class="line"><span class="operator">|</span> conv(<span class="number">100</span>,<span class="number">2</span>,<span class="number">16</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4</span>              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.000</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]<span class="operator">&gt;</span> <span class="keyword">select</span> conv(<span class="number">100</span>,<span class="number">16</span>,<span class="number">10</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+</span></span><br><span class="line"><span class="operator">|</span> conv(<span class="number">100</span>,<span class="number">16</span>,<span class="number">10</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">256</span>             <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.000</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]<span class="operator">&gt;</span> <span class="keyword">select</span> conv(<span class="number">100</span>,<span class="number">2</span>,<span class="number">10</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+</span></span><br><span class="line"><span class="operator">|</span> conv(<span class="number">100</span>,<span class="number">2</span>,<span class="number">10</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4</span>              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.000</span> sec)</span><br></pre></td></tr></table></figure><h2 id="3-3-å‘ä¸‹å’Œå‘ä¸Šå–æ•´"><a href="#3-3-å‘ä¸‹å’Œå‘ä¸Šå–æ•´" class="headerlink" title="3.3 å‘ä¸‹å’Œå‘ä¸Šå–æ•´"></a>3.3 å‘ä¸‹å’Œå‘ä¸Šå–æ•´</h2><p>å‘ä¸‹å–æ•´å’Œå‘ä¸Šå–æ•´æ˜¯åŸºäºå°æ•°çš„</p><ul><li>å‘ä¸‹å–æ•´ï¼šä¸ç®¡å°æ•°æœ‰å‡ ä½ï¼Œéƒ½å»é™¤å°æ•°ï¼Œæ•´æ•°éƒ¨åˆ†ä¸å˜ï¼›</li><li>å‘ä¸Šå–æ•´ï¼šä¸ç®¡å°æ•°æœ‰å‡ ä½ï¼Œéƒ½å»é™¤å°æ•°ï¼Œå¹¶æŠŠæ•´æ•°éƒ¨åˆ†åŠ ä¸€ï¼›</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [stu_test]&gt; select ceiling(99);</span><br><span class="line">+-------------+</span><br><span class="line">| ceiling(99) |</span><br><span class="line">+-------------+</span><br><span class="line">|          99 |</span><br><span class="line">+-------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; select floor(99.1);</span><br><span class="line">+-------------+</span><br><span class="line">| floor(99.1) |</span><br><span class="line">+-------------+</span><br><span class="line">|          99 |</span><br><span class="line">+-------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; select ceiling(99.2);</span><br><span class="line">+---------------+</span><br><span class="line">| ceiling(99.2) |</span><br><span class="line">+---------------+</span><br><span class="line">|           100 |</span><br><span class="line">+---------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><h2 id="3-4-æ¨¡è¿ç®—"><a href="#3-4-æ¨¡è¿ç®—" class="headerlink" title="3.4 æ¨¡è¿ç®—"></a>3.4 æ¨¡è¿ç®—</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mod</span>(a,b); <span class="comment">-- ç­‰ä»·äº a/b çš„ä½™æ•°</span></span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [stu_test]&gt; SELECT MOD(17, 5);</span><br><span class="line">+------------+</span><br><span class="line">| MOD(17, 5) |</span><br><span class="line">+------------+</span><br><span class="line">|          2 |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; SELECT MOD(15, 5);</span><br><span class="line">+------------+</span><br><span class="line">| MOD(15, 5) |</span><br><span class="line">+------------+</span><br><span class="line">|          0 |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; SELECT MOD(13, 5);</span><br><span class="line">+------------+</span><br><span class="line">| MOD(13, 5) |</span><br><span class="line">+------------+</span><br><span class="line">|          3 |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><h2 id="3-5-å°æ•°æ ¼å¼åŒ–"><a href="#3-5-å°æ•°æ ¼å¼åŒ–" class="headerlink" title="3.5 å°æ•°æ ¼å¼åŒ–"></a>3.5 å°æ•°æ ¼å¼åŒ–</h2><p>ä½¿ç”¨formatå‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šä¿ç•™å‡ ä½å°æ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [stu_test]&gt; select format(3.1415,2);</span><br><span class="line">+------------------+</span><br><span class="line">| format(3.1415,2) |</span><br><span class="line">+------------------+</span><br><span class="line">| 3.14             |</span><br><span class="line">+------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><h2 id="3-6-è·å–éšæœºæ•°"><a href="#3-6-è·å–éšæœºæ•°" class="headerlink" title="3.6 è·å–éšæœºæ•°"></a>3.6 è·å–éšæœºæ•°</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [stu_test]&gt; select rand();</span><br><span class="line">+--------------------+</span><br><span class="line">| rand()             |</span><br><span class="line">+--------------------+</span><br><span class="line">| 0.5338426274562652 |</span><br><span class="line">+--------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; select rand();</span><br><span class="line">+--------------------+</span><br><span class="line">| rand()             |</span><br><span class="line">+--------------------+</span><br><span class="line">| 0.7618099523352552 |</span><br><span class="line">+--------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><h1 id="4-å…¶ä»–å‡½æ•°"><a href="#4-å…¶ä»–å‡½æ•°" class="headerlink" title="4.å…¶ä»–å‡½æ•°"></a>4.å…¶ä»–å‡½æ•°</h1><table><thead><tr><th>å‡½æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>user()</td><td>æŸ¥è¯¢å½“å‰ç”¨æˆ·</td></tr><tr><td>database()</td><td>æŸ¥è¯¢å½“å‰æ‰€åœ¨æ•°æ®åº“</td></tr><tr><td>password(str)</td><td>å¯¹å¯†ç è¿›è¡ŒåŠ å¯†</td></tr><tr><td>md5(str)</td><td>è®¡ç®—å­—ç¬¦ä¸²çš„md5</td></tr><tr><td>ifnull(val1,val2)</td><td>å¦‚æœval1ä¸ºnullï¼Œè¿”å›val2ï¼Œå¦åˆ™è¿”å›val1</td></tr></tbody></table><p>è¿™é‡Œåªå¯¹ifnullå‡½æ•°åšä¸ªæµ‹è¯•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [stu_test]&gt; select ifnull(null,&#x27;124&#x27;);</span><br><span class="line">+--------------------+</span><br><span class="line">| ifnull(null,&#x27;124&#x27;) |</span><br><span class="line">+--------------------+</span><br><span class="line">| 124                |</span><br><span class="line">+--------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; select ifnull(&#x27;aba&#x27;,&#x27;124&#x27;);</span><br><span class="line">+---------------------+</span><br><span class="line">| ifnull(&#x27;aba&#x27;,&#x27;124&#x27;) |</span><br><span class="line">+---------------------+</span><br><span class="line">| aba                 |</span><br><span class="line">+---------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; select ifnull(&#x27;&#x27;,&#x27;124&#x27;);</span><br><span class="line">+------------------+</span><br><span class="line">| ifnull(&#x27;&#x27;,&#x27;124&#x27;) |</span><br><span class="line">+------------------+</span><br><span class="line">|                  |</span><br><span class="line">+------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><h1 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h1><p>å…³äºMySQLå†…ç½®å‡½æ•°çš„ç« èŠ‚å°±è¿™äº›äº†ï¼Œå¦‚æœåç»­é‡åˆ°æœ¬æ–‡æ²¡æœ‰è®°å½•çš„å‡½æ•°ï¼Œä¼šæ›´æ–°æœ¬æ–‡ï¼</p>]]></content>
    
    
    <summary type="html">å¯¹äºMySQLå†…ç½®å‡½æ•°çš„ç›¸å…³ä»‹ç»</summary>
    
    
    
    <category term="ç¼–ç¨‹å­¦ä¹ " scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="æ•°æ®åº“SQL" scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E6%95%B0%E6%8D%AE%E5%BA%93SQL/"/>
    
    
    <category term="mysql" scheme="https://blog.musnow.top/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>ã€MySQLã€‘ç”¨æˆ·ç®¡ç†</title>
    <link href="https://blog.musnow.top/posts/1572064315/"/>
    <id>https://blog.musnow.top/posts/1572064315/</id>
    <published>2024-01-30T01:40:00.000Z</published>
    <updated>2024-01-30T03:20:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç”¨æˆ·ç®¡ç†æ˜¯mysqlæƒé™æ§åˆ¶çš„é‡è¦ä¸€ç¯ã€‚</p><h1 id="1-MySQLçš„ç”¨æˆ·è¡¨"><a href="#1-MySQLçš„ç”¨æˆ·è¡¨" class="headerlink" title="1.MySQLçš„ç”¨æˆ·è¡¨"></a>1.MySQLçš„ç”¨æˆ·è¡¨</h1><p>åœ¨MySQLæ•°æ®åº“ä¸­ï¼Œæ‰€æœ‰çš„ç”¨æˆ·éƒ½å­˜åœ¨ç³»ç»Ÿæ•°æ®åº“mysqlçš„userè¡¨å†…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; use mysql;</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">MariaDB [mysql]&gt; select host,user,authentication_string from user;</span><br><span class="line">+-----------+-------------+-----------------------+</span><br><span class="line">| Host      | User        | authentication_string |</span><br><span class="line">+-----------+-------------+-----------------------+</span><br><span class="line">| localhost | mariadb.sys |                       |</span><br><span class="line">| localhost | root        | invalid               |</span><br><span class="line">| localhost | mysql       | invalid               |</span><br><span class="line">+-----------+-------------+-----------------------+</span><br><span class="line">3 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘è¿™æ˜¯ä¸€ä¸ªåˆšåˆšåˆå§‹åŒ–çš„æ•°æ®åº“ï¼Œå†…éƒ¨åªæœ‰ç³»ç»Ÿè‡ªå¸¦çš„å‡ ä¸ªç”¨æˆ·ã€‚å½“æˆ‘ä»¬ä½¿ç”¨<code>mysql -uroot</code>é“¾æ¥æ•°æ®åº“æ—¶ï¼Œå…¶å®å°±æ˜¯ä½¿ç”¨äº†rootç”¨æˆ·ã€‚é»˜è®¤æƒ…å†µä¸‹rootç”¨æˆ·æ²¡æœ‰å¯†ç ï¼Œæ‰€ä»¥<code>authentication_string</code>å­—æ®µæ˜¾ç¤ºinvalidï¼›</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">desc</span> <span class="keyword">user</span>; <span class="comment">-- æŸ¥çœ‹è¡¨çš„ç»“æ„</span></span><br></pre></td></tr></table></figure><p>å¯¹è¿™å¼ è¡¨é‡Œçš„å­—æ®µåšä¸€ä¸ªç®€å•çš„è§£é‡Š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hostï¼šç”¨æˆ·å¯ä»¥ä»ä»€ä¹ˆä¸»æœºä¸Šé“¾æ¥æ•°æ®åº“ï¼Œlocalhostä»£è¡¨åªå…è®¸æœ¬åœ°é“¾æ¥</span><br><span class="line">userï¼šç”¨æˆ·å</span><br><span class="line">passwordï¼šæ—§ç‰ˆæœ¬ä½¿ç”¨çš„å¯†ç å­—æ®µ</span><br><span class="line">authentication_stringï¼šæ–°ç‰ˆæœ¬ä½¿ç”¨çš„å¯†ç å­—æ®µï¼Œç”¨æˆ·å¯†ç ç”¨passwordå‡½æ•°åŠ å¯†åçš„å­—ç¬¦ä¸²ï¼›</span><br><span class="line">å¾ˆå¤šå¾ˆå¤šä»¥_privç»“å°¾çš„å­—æ®µï¼šç”¨æˆ·æƒé™è®°å½•</span><br></pre></td></tr></table></figure><p>ç”¨æˆ·å’Œæƒé™ç®¡ç†çš„å­˜åœ¨ï¼Œè®©æˆ‘ä»¬å¯ä»¥å¯¹MySQLä¸­ä¸åŒçš„è¡¨è¿›è¡Œä¸€å®šçš„æƒé™é£æ§ï¼Œé¿å…æŸä¸ªç”¨æˆ·çš„è¯¯æ“ä½œè®©æ•´ä¸ªæ•°æ®åº“äº§ç”Ÿä¸å¯é€†çš„æŸå¤±ã€‚</p><h1 id="2-ç”¨æˆ·ç®¡ç†"><a href="#2-ç”¨æˆ·ç®¡ç†" class="headerlink" title="2.ç”¨æˆ·ç®¡ç†"></a>2.ç”¨æˆ·ç®¡ç†</h1><h2 id="2-1-åˆ›å»ºç”¨æˆ·"><a href="#2-1-åˆ›å»ºç”¨æˆ·" class="headerlink" title="2.1 åˆ›å»ºç”¨æˆ·"></a>2.1 åˆ›å»ºç”¨æˆ·</h2><p>åœ¨MySQLä¸­åˆ›å»ºç”¨æˆ·çš„è¯­æ³•å¦‚ä¸‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="string">&#x27;ç™»é™†ä¸»æœºæˆ–IP&#x27;</span></span><br><span class="line">identified <span class="keyword">by</span> <span class="string">&#x27;å¯†ç &#x27;</span>;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; create user &#x27;mu&#x27;@&#x27;%&#x27; identified by &#x27;123456&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.006 sec)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä½¿ç”¨äº†<code>%</code>ä½œä¸ºç™»å½•ä¸»æœºï¼Œå…¶ç­‰ä»·äºIPå±‚é¢ç†è§£çš„<code>0.0.0.0</code>ï¼Œå³è¯¥ç”¨æˆ·å…è®¸ä»»ä½•æ¥æºåœ°çš„é“¾æ¥ã€‚</p><p>å†æ¬¡æŸ¥è¯¢ç”¨æˆ·è¡¨ï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶muç”¨æˆ·æ˜¯æœ‰<code>authentication_string</code>å­—æ®µçš„ï¼Œå…¶å€¼æ˜¯é€šè¿‡passwordå‡½æ•°åŠ å¯†åçš„123456ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [mysql]&gt; select host,user,authentication_string from user;</span><br><span class="line">+-----------+-------------+-------------------------------------------+</span><br><span class="line">| Host      | User        | authentication_string                     |</span><br><span class="line">+-----------+-------------+-------------------------------------------+</span><br><span class="line">| localhost | mariadb.sys |                                           |</span><br><span class="line">| localhost | root        | invalid                                   |</span><br><span class="line">| localhost | mysql       | invalid                                   |</span><br><span class="line">| %         | mu          | *6BB4837EB74329105EE4568DDA7DC67ED2CA2AD9 |</span><br><span class="line">+-----------+-------------+-------------------------------------------+</span><br><span class="line">4 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªè¡Œè°ƒç”¨passwordå‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°è¾“å‡ºå€¼å’Œä¸Šè¡¨ä¸­çš„å€¼ä¸€è‡´ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [mysql]&gt; select password(&#x27;123456&#x27;);</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">| password(&#x27;123456&#x27;)                        |</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">| *6BB4837EB74329105EE4568DDA7DC67ED2CA2AD9 |</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æƒ³ç”¨è¿™ä¸ªæ–°ç”¨æˆ·è¿›è¡Œç™»å½•ï¼Œåœ¨linuxçš„å‘½ä»¤è¡Œä¸­è¾“å…¥å¦‚ä¸‹å‘½ä»¤è¿›è¡Œç™»å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uç”¨æˆ·å -på¯†ç </span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœä½ ç°åœ¨å¤„äºLinuxçš„å­ç”¨æˆ·ï¼Œç™»å½•MySQLçš„rootç”¨æˆ·éœ€è¦sudoæƒé™ï¼Œä½†ç™»å½•æ–°åˆ›å»ºçš„MySQLç”¨æˆ·æ˜¯ä¸éœ€è¦sudoçš„ã€‚</p></blockquote><p>ç¤ºä¾‹å¦‚ä¸‹ï¼Œç™»å½•MySQLåå¯ä»¥ç”¨<code>select user();</code>è¯­å¥æŸ¥çœ‹å½“å‰ç™»å½•çš„ç”¨æˆ·æ˜¯è°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">â¯ mysql -umu -p123456</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 35</span><br><span class="line">Server version: 10.6.16-MariaDB-0ubuntu0.22.04.1 Ubuntu 22.04</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.    </span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select user();</span><br><span class="line">+--------------+</span><br><span class="line">| user()       |</span><br><span class="line">+--------------+</span><br><span class="line">| mu@localhost |</span><br><span class="line">+--------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><h2 id="2-2-åˆ é™¤ç”¨æˆ·"><a href="#2-2-åˆ é™¤ç”¨æˆ·" class="headerlink" title="2.2 åˆ é™¤ç”¨æˆ·"></a>2.2 åˆ é™¤ç”¨æˆ·</h2><p>åªæœ‰é«˜æƒé™ç”¨æˆ·æˆ–è€…rootç”¨æˆ·æ‰èƒ½åˆ é™¤å…¶ä»–ç”¨æˆ·ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="string">&#x27;ä¸»æœºå&#x27;</span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœåœ¨ä¼ å…¥ç”¨æˆ·åæ—¶ä¸æä¾›ä¸»æœºåï¼Œåˆ™ä¸»æœºåé»˜è®¤ä¸º<code>%</code>ï¼›</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>;</span><br><span class="line"><span class="comment">-- ç­‰ä»·äº</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [mysql]&gt; drop user &#x27;mu&#x27;@&#x27;192.168.1.30&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.006 sec)</span><br></pre></td></tr></table></figure><h3 id="ä¸ºä»€ä¹ˆåœ¨åˆ é™¤ç”¨æˆ·çš„æ—¶å€™éœ€è¦æŒ‡å®šä¸»æœºåï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆåœ¨åˆ é™¤ç”¨æˆ·çš„æ—¶å€™éœ€è¦æŒ‡å®šä¸»æœºåï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆåœ¨åˆ é™¤ç”¨æˆ·çš„æ—¶å€™éœ€è¦æŒ‡å®šä¸»æœºåï¼Ÿ"></a>ä¸ºä»€ä¹ˆåœ¨åˆ é™¤ç”¨æˆ·çš„æ—¶å€™éœ€è¦æŒ‡å®šä¸»æœºåï¼Ÿ</h3><p>ä¸ºä»€ä¹ˆåœ¨åˆ é™¤ç”¨æˆ·çš„æ—¶å€™éœ€è¦æŒ‡å®šä¸»æœºåï¼Ÿå› ä¸ºåŒä¸€ä¸ªç”¨æˆ·åï¼Œä¸åŒä¸»æœºåæ˜¯å¯ä»¥åˆ›å»ºå¤šä¸ªçš„ï¼ŒMySQLå¹¶æ²¡æœ‰é™åˆ¶ä¸€ä¸ªç”¨æˆ·ååªèƒ½åˆ›å»ºä¸€æ¡è®°å½•ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬å¯ä»¥å…è®¸<strong>å¼ ä¸‰</strong>åœ¨IP1å’ŒIP2ç™»å½•ï¼Œè¿™æ ·å°±èƒ½åˆ›å»ºä¸¤æ¡ç”¨æˆ·è®°å½•ï¼Œè¿™ä¸¤æ¡ç”¨æˆ·è®°å½•çš„ç”¨æˆ·åéƒ½æ˜¯å¼ ä¸‰ï¼Œä½†å¯ä»¥æœ‰ä¸åŒçš„ç™»å½•æ¥æºhostå’Œä¸åŒçš„å¯†ç ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥æ§åˆ¶å•ä¸ªç”¨æˆ·åœ¨ä¸åŒä¸»æœºä¸Šçš„ä¸åŒæƒé™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [mysql]&gt; create user &#x27;mu&#x27;@&#x27;192.168.1.30&#x27; identified by &#x27;123456&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.006 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [mysql]&gt; select host,user,authentication_string from user;</span><br><span class="line">+--------------+-------------+-------------------------------------------+        </span><br><span class="line">| Host         | User        | authentication_string                     |        </span><br><span class="line">+--------------+-------------+-------------------------------------------+        </span><br><span class="line">| localhost    | mariadb.sys |                                           |        </span><br><span class="line">| localhost    | root        | invalid                                   |        </span><br><span class="line">| localhost    | mysql       | invalid                                   |        </span><br><span class="line">| %            | mu          | *6BB4837EB74329105EE4568DDA7DC67ED2CA2AD9 |        </span><br><span class="line">| 192.168.1.30 | mu          | *6BB4837EB74329105EE4568DDA7DC67ED2CA2AD9 |        </span><br><span class="line">+--------------+-------------+-------------------------------------------+        </span><br><span class="line">5 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure><h2 id="2-3-è®¾ç½®ç”¨æˆ·å¯†ç "><a href="#2-3-è®¾ç½®ç”¨æˆ·å¯†ç " class="headerlink" title="2.3 è®¾ç½®ç”¨æˆ·å¯†ç "></a>2.3 è®¾ç½®ç”¨æˆ·å¯†ç </h2><p>è®¾ç½®å½“å‰ç”¨æˆ·çš„å¯†ç </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> password<span class="operator">=</span>password(<span class="string">&#x27;æ–°å¯†ç &#x27;</span>);</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ç‰¹å®šç”¨æˆ·çš„å¯†ç </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> password <span class="keyword">for</span> <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="string">&#x27;ä¸»æœºå&#x27;</span><span class="operator">=</span>password(<span class="string">&#x27;æ–°å¯†ç &#x27;</span>);</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [mysql]&gt; set password for &#x27;mu&#x27;@&#x27;%&#x27;=password(&#x27;654321&#x27;);</span><br><span class="line">Query OK, 0 rows affected (0.006 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [mysql]&gt; select host,user,authentication_string from user;</span><br><span class="line">+-----------+-------------+-------------------------------------------+</span><br><span class="line">| Host      | User        | authentication_string                     |</span><br><span class="line">+-----------+-------------+-------------------------------------------+</span><br><span class="line">| localhost | mariadb.sys |                                           |</span><br><span class="line">| localhost | root        | invalid                                   |</span><br><span class="line">| localhost | mysql       | invalid                                   |</span><br><span class="line">| %         | mu          | *2A032F7C5BA932872F0F045E0CF6B53CF702F2C5 |</span><br><span class="line">+-----------+-------------+-------------------------------------------+</span><br><span class="line">4 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure><h2 id="2-4-å‘½ä»¤æ±‡æ€»å°ç»“"><a href="#2-4-å‘½ä»¤æ±‡æ€»å°ç»“" class="headerlink" title="2.4 å‘½ä»¤æ±‡æ€»å°ç»“"></a>2.4 å‘½ä»¤æ±‡æ€»å°ç»“</h2><p>åœ¨æˆ‘çš„å®é™…ä½¿ç”¨ä¸­ï¼Œæœ€å¸¸ç”¨çš„ç”¨æˆ·ç®¡ç†å°±æ˜¯åœ¨é…ç½®éœ€è¦ä½¿ç”¨MySQLæ•°æ®åº“çš„dockeræ—¶çš„æ“ä½œäº†ã€‚éœ€è¦ç»™ä¸€ä¸ªæ–°çš„dockerè®¾ç½®æ–°çš„æ•°æ®åº“ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªç”¨æˆ·ç»™è¿™ä¸ªdockeræ¥æ“ä½œã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¦‚æœæ˜¯dockerå®‰è£…çš„MySQL</span></span><br><span class="line"><span class="comment">-- éœ€è¦å…ˆåœ¨Linuxç³»ç»Ÿä¸­è¿›å…¥MySQLå®¹å™¨çš„ç»ˆç«¯é‡Œé¢</span></span><br><span class="line">docker <span class="keyword">exec</span> <span class="operator">-</span>it å®¹å™¨å <span class="operator">/</span>bin<span class="operator">/</span>sh</span><br><span class="line"><span class="comment">-- åœ¨ç»ˆç«¯å‘½ä»¤è¡Œä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</span></span><br><span class="line">mysql <span class="operator">-</span>uroot <span class="operator">-</span>på¯†ç </span><br><span class="line"><span class="comment">-- è¿›å…¥MySQLå‘½ä»¤è¡Œåï¼Œåˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·</span></span><br><span class="line"><span class="keyword">create</span> database æ•°æ®åº“åå­—;</span><br><span class="line"><span class="comment">-- æ•°æ®åº“åå­—è¦å’Œä¸Šé¢åˆ›å»ºçš„è¿™ä¸ªæ•°æ®åº“å¯¹åº”</span></span><br><span class="line"><span class="comment">-- ç»™å®šæ–°è¡¨çš„æ‰€æœ‰æƒé™åˆ°æ–°ç”¨æˆ·ä¸Š</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;ç”¨æˆ·çš„å¯†ç &#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">ON</span> æ•°æ®åº“åå­—.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure><h1 id="3-æƒé™ç®¡ç†"><a href="#3-æƒé™ç®¡ç†" class="headerlink" title="3.æƒé™ç®¡ç†"></a>3.æƒé™ç®¡ç†</h1><h2 id="3-1-æƒé™åˆ—è¡¨"><a href="#3-1-æƒé™åˆ—è¡¨" class="headerlink" title="3.1 æƒé™åˆ—è¡¨"></a>3.1 æƒé™åˆ—è¡¨</h2><p>MySQLæ•°æ®åº“æä¾›çš„æƒé™éå¸¸ç»†è‡´ï¼Œåˆ—è¡¨å¦‚ä¸‹</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/01/bc621d3a1fada1faa98c2c0303df0890.png" alt="image-20240130103510001"></p><h2 id="3-2-ç»™ç”¨æˆ·æˆæƒ"><a href="#3-2-ç»™ç”¨æˆ·æˆæƒ" class="headerlink" title="3.2 ç»™ç”¨æˆ·æˆæƒ"></a>3.2 ç»™ç”¨æˆ·æˆæƒ</h2><p>æˆæƒçš„è¯­æ³•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> æƒé™åˆ—è¡¨ <span class="keyword">on</span> æ•°æ®åº“.å¯¹è±¡å </span><br><span class="line"><span class="keyword">to</span> <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="string">&#x27;ä¸»æœº&#x27;</span> [identified <span class="keyword">by</span> <span class="string">&#x27;å¯†ç &#x27;</span>]</span><br></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦æˆäºˆå¤šä¸ªæƒé™ï¼Œç”¨é€—å·åˆ†éš”ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span>,<span class="keyword">delete</span> <span class="keyword">on</span> æ•°æ®åº“.å¯¹è±¡å </span><br><span class="line"><span class="keyword">to</span> <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="string">&#x27;ä¸»æœº&#x27;</span> [identified <span class="keyword">by</span> <span class="string">&#x27;å¯†ç &#x27;</span>]</span><br></pre></td></tr></table></figure><p>å¦‚æœæƒ³æˆäºˆæ‰€æœ‰æƒé™ï¼Œå¯ä»¥ä½¿ç”¨<code>all</code>ï¼Œæˆ–è€…<code>all privileges</code>ï¼ŒäºŒè€…éƒ½ä»£è¡¨æ‰€æœ‰æƒé™ï¼Œæ²¡æœ‰åŒºåˆ«ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> [privileges] <span class="keyword">on</span> ... </span><br></pre></td></tr></table></figure><p>å‡ ç‚¹è¯´æ˜</p><ul><li>å‘½ä»¤ä¸­çš„<code>[identified by &#39;å¯†ç &#39;]</code>æ˜¯å¯é€‰é¡¹ï¼Œå¦‚æœç”¨æˆ·å­˜åœ¨ï¼Œåˆ™ä¿®æ”¹å…¶å¯†ç ã€‚å¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œåˆ™ä»¥è¯¥å¯†ç åˆ›å»ºç”¨æˆ·ã€‚</li><li><code>æ•°æ®åº“.å¯¹è±¡å</code>å¯ä½¿ç”¨<code>*.*</code> ï¼Œä»£è¡¨å½“å‰MySQLä¸­çš„æ‰€æœ‰æ•°æ®å¯¹è±¡ï¼›</li><li><code>æ•°æ®åº“.*</code>ä»£è¡¨æŸä¸ªæ•°æ®åº“ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼›</li></ul><h3 id="æˆæƒç¤ºä¾‹"><a href="#æˆæƒç¤ºä¾‹" class="headerlink" title="æˆæƒç¤ºä¾‹"></a>æˆæƒç¤ºä¾‹</h3><p>åˆšåˆ›å»ºçš„ç”¨æˆ·æ˜¯æ²¡æœ‰ä»»ä½•æƒé™çš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘åˆšåˆšåˆ›å»ºçš„muç”¨æˆ·å¹¶æ²¡æœ‰çœ‹åˆ°åŸæœ¬å·²æœ‰çš„<code>stu_test</code>æ•°æ®åº“ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">+--------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select user();</span><br><span class="line">+--------------+</span><br><span class="line">| user()       |</span><br><span class="line">+--------------+</span><br><span class="line">| mu@localhost |</span><br><span class="line">+--------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç»™ç”¨æˆ·æˆæƒ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span> <span class="keyword">on</span> stu_test.student <span class="keyword">to</span> <span class="string">&#x27;mu&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æˆæƒä¹‹åï¼Œmuç”¨æˆ·å°±èƒ½çœ‹åˆ°è¿™ä¸ªè¡¨äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| stu_test           |</span><br><span class="line">+--------------------+</span><br><span class="line">2 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure><p>muç”¨æˆ·å¯ä»¥è¿›è¡ŒæŸ¥è¯¢æ“ä½œï¼Œä½†æ˜¯ä¸èƒ½åˆ æ”¹studentè¡¨ï¼Œæ“ä½œä¼šè¢«æ•°æ®åº“æ‹’ç»ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; use stu_test;</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">MariaDB [stu_test]&gt; select * from student;</span><br><span class="line">+------+--------+</span><br><span class="line">| id   | name   |</span><br><span class="line">+------+--------+</span><br><span class="line">|    1 | å¼ ä¸‰   |</span><br><span class="line">|    2 | æå››   |</span><br><span class="line">|    3 | ç‹äº”   |</span><br><span class="line">|    4 | èµµå…­   |</span><br><span class="line">|    5 | åˆ˜ä¸ƒ   |</span><br><span class="line">+------+--------+</span><br><span class="line">5 rows in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; insert into student values (6,&#x27;ç‹ç’&#x27;);</span><br><span class="line">ERROR 1142 (42000): INSERT command denied to user &#x27;mu&#x27;@&#x27;localhost&#x27; for table `stu_test`.`student`</span><br></pre></td></tr></table></figure><p>å†æ¬¡ç»™äºˆæ›´æ–°å’Œåˆ é™¤çš„æƒé™</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span>,<span class="keyword">update</span>,<span class="keyword">delete</span>,<span class="keyword">insert</span> <span class="keyword">on</span> stu_test.student <span class="keyword">to</span> <span class="string">&#x27;mu&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶muç”¨æˆ·å°±èƒ½è¿›è¡Œæ’å…¥å’Œåˆ é™¤ç­‰æ“ä½œäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [stu_test]&gt; insert into student values (6,&#x27;ç‹ç’&#x27;);</span><br><span class="line">Query OK, 1 row affected (0.006 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [stu_test]&gt; delete from student where id = 5;</span><br><span class="line">Query OK, 1 row affected (0.007 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="åˆ·æ–°æƒé™"><a href="#åˆ·æ–°æƒé™" class="headerlink" title="åˆ·æ–°æƒé™"></a>åˆ·æ–°æƒé™</h3><p>å¦‚æœå‘ç°èµ‹äºˆæƒé™åç”¨æˆ·è¿˜æ˜¯ä¸èƒ½æ‰§è¡ŒæŸäº›æ“ä½œï¼Œå¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤åˆ·æ–°æƒé™</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><h2 id="3-3-å›æ”¶æƒé™"><a href="#3-3-å›æ”¶æƒé™" class="headerlink" title="3.3 å›æ”¶æƒé™"></a>3.3 å›æ”¶æƒé™</h2><p>è¯­æ³•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">revoke</span> æƒé™åˆ—è¡¨ <span class="keyword">on</span> æ•°æ®åº“.å¯¹è±¡å <span class="keyword">from</span> <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="string">&#x27;ä¸»æœº&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚å›æ”¶muç”¨æˆ·å¯¹äºstudentè¡¨çš„æ’å…¥æƒé™</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">revoke</span> <span class="keyword">insert</span> <span class="keyword">on</span> stu_test.student <span class="keyword">from</span> <span class="string">&#x27;mu&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶muç”¨æˆ·åˆä¸èƒ½è¿›è¡Œæ’å…¥æ“ä½œäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [stu_test]&gt; insert into student values (7,&#x27;ä½ å¥½&#x27;);</span><br><span class="line">ERROR 1142 (42000): INSERT command denied to user &#x27;mu&#x27;@&#x27;localhost&#x27; for table `stu_test`.`student`</span><br></pre></td></tr></table></figure><h1 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h1><p>MySQLä¸­ç”¨æˆ·ç®¡ç†çš„åŸºæœ¬æ“ä½œå°±æ˜¯è¿™äº›äº†ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œç”¨æˆ·ç®¡ç†æ˜¯æ•°æ®åº“å®‰å…¨æ€§çš„é‡è¦ä¸€ç¯ï¼Œå¾—å¤šåŠ æ³¨æ„ã€‚</p>]]></content>
    
    
    <summary type="html">mysqlå’Œmariadbä¸­ç”¨æˆ·ç®¡ç†çš„ç›¸å…³å†…å®¹</summary>
    
    
    
    <category term="ç¼–ç¨‹å­¦ä¹ " scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="æ•°æ®åº“SQL" scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E6%95%B0%E6%8D%AE%E5%BA%93SQL/"/>
    
    
    <category term="mysql" scheme="https://blog.musnow.top/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>ã€è§£å†³ã€‘WSL2ä¸­å®‰è£…Cudaé‡åˆ°/usr/lib/wsl/lib/libcuda.so.1 is not a symbolic link</title>
    <link href="https://blog.musnow.top/posts/2859840121/"/>
    <id>https://blog.musnow.top/posts/2859840121/</id>
    <published>2024-01-29T10:00:00.000Z</published>
    <updated>2024-02-01T07:54:22.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é—®é¢˜è¯´æ˜"><a href="#é—®é¢˜è¯´æ˜" class="headerlink" title="é—®é¢˜è¯´æ˜"></a>é—®é¢˜è¯´æ˜</h1><p>æ…•é›ªé‡åˆ°çš„æƒ…å†µæ˜¯wsl2å®‰è£…çš„ubuntu22.04åœ¨aptå®‰è£…è½¯ä»¶çš„æ—¶å€™å°±ä¼šå‡ºç°è¿™ä¸ªæŠ¥é”™ï¼Œæ— è®ºå®‰è£…ä»€ä¹ˆè½¯ä»¶éƒ½ä¼šæœ‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/sbin/ldconfig.real: /usr/lib/wsl/lib/libcuda.so.1 is not a symbolic link</span><br></pre></td></tr></table></figure><h1 id="åšå®¢å‚è€ƒ"><a href="#åšå®¢å‚è€ƒ" class="headerlink" title="åšå®¢å‚è€ƒ"></a>åšå®¢å‚è€ƒ</h1><p>ç½‘ä¸ŠåŸæœ‰çš„è§£å†³æ–¹æ³•æ˜¯ï¼š<br>å°†<code>/usr/lib/wsl/lib</code>ä¸­çš„æ–‡ä»¶è½¯è¿æ¥åˆ°<code>/usr/lib/wsl/lib2</code>ä¸­ã€‚</p><p>è¯¥æ–¹æ³•ä¼šå¯¼è‡´åç»­å‡ºç°</p><ul><li>é—®é¢˜1ï¼šNVIDIA-SMI couldnâ€™t find libnvidia-ml.so library in your system.</li><li>é—®é¢˜2ï¼šerror code is libcuda.so: cannot open shared object file: No such file or directory</li></ul><p>æˆ‘çš„è§£å†³æ–¹æ³•æ˜¯ï¼šåˆ é™¤æˆ–å¤‡ä»½<code>/usr/lib/wsl/lib</code>ä¸­çš„<code>libcuda.so</code>ä¸<code>libcuda.so.1</code>ï¼Œç„¶åå»ºç«‹å¯¹<code>libcuda.so.1.1</code>çš„è½¯è¿æ¥ã€‚</p><p>æ³¨æ„ï¼Œcpå¤‡ä»½åŸæœ¬çš„æ—¶å€™ä¸èƒ½ç›´æ¥å¤‡ä»½åˆ°<code>/usr/lib/wsl/lib/</code>ç›®å½•ä¸­ï¼Œå› ä¸ºä¸‹ä¸€æ¬¡å¯åŠ¨æ—¶è¿™ä¸ªç›®å½•ä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨å¤„ç†ï¼Œå†…éƒ¨çš„<code>.bak</code>æ–‡ä»¶ä¼šè¢«åˆ é™¤ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¤‡ä»½åŸæœ¬çš„</span></span><br><span class="line">sudo <span class="built_in">cp</span> /usr/lib/wsl/lib/libcuda.so  ~/libcuda.so.bak</span><br><span class="line">sudo <span class="built_in">cp</span> /usr/lib/wsl/lib/libcuda.so.1 ~/libcuda.so.1.bak</span><br><span class="line"><span class="comment"># åˆ é™¤åŸæœ¬çš„</span></span><br><span class="line">sudo <span class="built_in">rm</span> -f /usr/lib/wsl/lib/libcuda.so </span><br><span class="line">sudo <span class="built_in">rm</span> -f /usr/lib/wsl/lib/libcuda.so.1</span><br><span class="line"><span class="comment"># è¿›è¡Œè½¯è¿æ¥</span></span><br><span class="line">sudo <span class="built_in">ln</span> -s /usr/lib/wsl/lib/libcuda.so.1.1 /usr/lib/wsl/lib/libcuda.so.1</span><br><span class="line">sudo <span class="built_in">ln</span> -s /usr/lib/wsl/lib/libcuda.so.1 /usr/lib/wsl/lib/libcuda.so</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹åçš„æ•ˆæœå¦‚ä¸‹ï¼Œ<code>libcuda.so</code>å’Œ<code>libcuda.so.1</code>å®é™…ä¸Šéƒ½æŒ‡å‘<code>libcuda.so.1.1</code>ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â¯ ll</span><br><span class="line">total 216M</span><br><span class="line">-r-xr-xr-x 1 root root  11M Jan 13 06:30 libcudadebugger.so.1</span><br><span class="line">lrwxrwxrwx 1 root root   29 Feb  1 15:52 libcuda.so -&gt; /usr/lib/wsl/lib/libcuda.so.1</span><br><span class="line">lrwxrwxrwx 1 root root   31 Feb  1 15:52 libcuda.so.1 -&gt; /usr/lib/wsl/lib/libcuda.so.1.1</span><br><span class="line">-r-xr-xr-x 1 root root 155K Jan 13 06:30 libcuda.so.1.1</span><br></pre></td></tr></table></figure><h1 id="åŸæ–‡ç‰ˆæƒè¯´æ˜"><a href="#åŸæ–‡ç‰ˆæƒè¯´æ˜" class="headerlink" title="åŸæ–‡ç‰ˆæƒè¯´æ˜"></a>åŸæ–‡ç‰ˆæƒè¯´æ˜</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œéµå¾ª CC 4.0 BY-SA ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥å’Œæœ¬å£°æ˜ã€‚</span><br><span class="line">æœ¬æ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/pl23k/article/details/131336220</span><br></pre></td></tr></table></figure><p>åŒæ—¶å¯ä»¥å‚è€ƒï¼š<a href="https://kira-96.github.io/posts/wsl-libcuda.so.1-is-not-a-symbolic-link-%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/">WSL libcuda.so.1 is not a symbolic link çš„è§£å†³æ–¹æ³• | âœ¨kiraã®åšå®¢</a></p>]]></content>
    
    
    <summary type="html">WSL2ä¸­å®‰è£…Cudaé‡åˆ°/usr/lib/wsl/lib/libcuda.so.1 is not a symbolic linké”™è¯¯</summary>
    
    
    
    <category term="ç¼–ç¨‹å­¦ä¹ " scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="Linux" scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/Linux/"/>
    
    
    <category term="è™šæ‹Ÿæœº" scheme="https://blog.musnow.top/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/"/>
    
    <category term="wsl" scheme="https://blog.musnow.top/tags/wsl/"/>
    
  </entry>
  
  <entry>
    <title>ã€SQLã€‘è¿‡ç¨‹åŒ–SQL</title>
    <link href="https://blog.musnow.top/posts/3614589784/"/>
    <id>https://blog.musnow.top/posts/3614589784/</id>
    <published>2024-01-29T08:45:00.000Z</published>
    <updated>2024-01-29T08:45:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>è¯¾ç¨‹åŸºäº <strong>é«˜ç­‰æ•™è‚²å‡ºç‰ˆç¤¾ã€Šæ•°æ®åº“ç³»ç»Ÿæ¦‚è®ºï¼ˆç¬¬6ç‰ˆï¼‰ã€‹ç‹çŠã€æœå°å‹‡ã€é™ˆçº¢</strong></p><h2 id="è¿‡ç¨‹åŒ–SQL"><a href="#è¿‡ç¨‹åŒ–SQL" class="headerlink" title="è¿‡ç¨‹åŒ–SQL"></a>è¿‡ç¨‹åŒ–SQL</h2><blockquote><p>ç›¸å…³å†…å®¹åœ¨ä¹¦æœ¬çš„ P250</p></blockquote><p>è¿‡ç¨‹åŒ–SQLæ˜¯å¯¹åŸºæœ¬SQLçš„æ‰©å±•ï¼Œåœ¨å…¶åŸºç¡€ä¸Šæ·»åŠ äº†ä¸€äº›æ§åˆ¶è¿‡ç¨‹çš„è¯­å¥ã€‚</p><p>è¿‡ç¨‹åŒ–SQLçš„<strong>åŸºæœ¬ç»“æ„æ˜¯å—</strong>ï¼Œæ¯ä¸ªå—å¯ä»¥åŒ…å«å®šä¹‰éƒ¨åˆ†å’Œæ‰§è¡Œéƒ¨åˆ†ï¼Œå—ä¸å—ä¹‹é—´å¯ä»¥ç›¸äº’åµŒå¥—ï¼›</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å®šä¹‰éƒ¨åˆ†</span></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">å˜é‡ã€å¸¸é‡ã€æ¸¸æ ‡ã€å¼‚å¸¸ç­‰</span><br><span class="line"><span class="comment">-- æ‰§è¡Œéƒ¨åˆ†</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="comment">-- SQLè¯­å¥ã€è¿‡ç¨‹åŒ–SQLæ§åˆ¶è¯­å¥</span></span><br><span class="line">EXCEPTION <span class="comment">-- é‡åˆ°ä¸èƒ½ç»§ç»­æ‰§è¡Œæƒ…å†µç§°ä¸ºå¼‚å¸¸</span></span><br><span class="line"><span class="comment">-- å¼‚å¸¸å¤„ç†éƒ¨åˆ†</span></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure><h3 id="å˜é‡å®šä¹‰"><a href="#å˜é‡å®šä¹‰" class="headerlink" title="å˜é‡å®šä¹‰"></a>å˜é‡å®šä¹‰</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å˜é‡å®šä¹‰</span></span><br><span class="line">å˜é‡å æ•°æ®ç±»å‹ [[<span class="keyword">NOT</span> <span class="keyword">NULL</span>]:<span class="operator">=</span>åˆå€¼è¡¨è¾¾å¼]</span><br><span class="line">å˜é‡å æ•°æ®ç±»å‹ [[<span class="keyword">NOT</span> <span class="keyword">NULL</span>] åˆå€¼è¡¨è¾¾å¼]</span><br><span class="line"><span class="comment">-- å˜é‡èµ‹å€¼</span></span><br><span class="line">å˜é‡å:<span class="operator">=</span>è¡¨è¾¾å¼</span><br><span class="line"><span class="comment">-- å¸¸é‡å®šä¹‰</span></span><br><span class="line">å¸¸é‡å æ•°æ®ç±»å‹ CONSTANT:<span class="operator">=</span>å¸¸é‡è¡¨è¾¾å¼ <span class="comment">-- å¸¸é‡å¿…é¡»è¦åœ¨å®šä¹‰çš„æ—¶å€™èµ‹å€¼ï¼Œä¸”åç»­ä¸å¯ä»¥ä¿®æ”¹</span></span><br></pre></td></tr></table></figure><h2 id="æµç¨‹æ§åˆ¶"><a href="#æµç¨‹æ§åˆ¶" class="headerlink" title="æµç¨‹æ§åˆ¶"></a>æµç¨‹æ§åˆ¶</h2><h3 id="æ¡ä»¶åˆ¤æ–­"><a href="#æ¡ä»¶åˆ¤æ–­" class="headerlink" title="æ¡ä»¶åˆ¤æ–­"></a>æ¡ä»¶åˆ¤æ–­</h3><p>IFè¯­å¥å¯ä»¥åµŒå¥—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">IF æ¡ä»¶ <span class="keyword">THEN</span></span><br><span class="line"><span class="comment">-- æ¡ä»¶ä¸ºçœŸæ—¶æ‰§è¡Œçš„æ“ä½œ</span></span><br><span class="line"><span class="keyword">END</span> IF;</span><br><span class="line"></span><br><span class="line">IF æ¡ä»¶ <span class="keyword">THEN</span></span><br><span class="line"><span class="comment">-- æ¡ä»¶ä¸ºçœŸæ—¶æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">ELSE</span></span><br><span class="line"><span class="comment">-- æ¡ä»¶ä¸ºå‡æ—¶æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">END</span> IF;</span><br></pre></td></tr></table></figure><h3 id="å¾ªç¯æ§åˆ¶è¯­å¥"><a href="#å¾ªç¯æ§åˆ¶è¯­å¥" class="headerlink" title="å¾ªç¯æ§åˆ¶è¯­å¥"></a>å¾ªç¯æ§åˆ¶è¯­å¥</h3><h4 id="æ­»å¾ªç¯"><a href="#æ­»å¾ªç¯" class="headerlink" title="æ­»å¾ªç¯"></a>æ­»å¾ªç¯</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LOOP</span><br><span class="line"><span class="comment">-- å¾ªç¯ä½“</span></span><br><span class="line"><span class="keyword">END</span> LOOP;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå¾ªç¯ä½“æ²¡æœ‰ç±»ä¼¼<code>while(æ¡ä»¶)</code>â€‹ä¸€æ ·çš„å¾ªç¯ç»ˆæ­¢ï¼Œè€Œæ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œä¸€èˆ¬çš„å…³ç³»å‹æ•°æ®åº“éƒ½ä¼šæä¾›EXIT\BREAK\LEAVEç­‰è¯­å¥æ¥é€€å‡ºè¿™ä¸ªå¾ªç¯</p><h4 id="WHILEå¾ªç¯"><a href="#WHILEå¾ªç¯" class="headerlink" title="WHILEå¾ªç¯"></a>WHILEå¾ªç¯</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WHILE æ¡ä»¶ LOOP</span><br><span class="line"><span class="comment">-- å¾ªç¯ä½“</span></span><br><span class="line"><span class="keyword">END</span> LOOP;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬ç¼–ç¨‹è¯­è¨€ä¸­å¸¸ç”¨çš„WHILEå¾ªç¯äº†ï¼Œæ²¡å•¥å¥½è¯´çš„ã€‚è€Œä¸”åŒæ ·æ”¯æŒæå‰é€€å‡ºçš„è¯­å¥ã€‚</p><h4 id="FOR-LOOP"><a href="#FOR-LOOP" class="headerlink" title="FOR-LOOP"></a>FOR-LOOP</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FOR</span> count <span class="keyword">IN</span> [REVERSE] bound1 .. bound2 LOOP</span><br><span class="line"><span class="comment">-- å¾ªç¯ä½“</span></span><br><span class="line"><span class="keyword">END</span> LOOP;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå¾ªç¯ä½“çš„åŸºæœ¬æ­¥éª¤ï¼šå°†countå˜é‡è®¾ç½®ä¸ºå¾ªç¯ä¸‹ç•Œbound1ï¼Œæ£€æŸ¥ä»–æ˜¯å¦å°äºä¸Šç•Œbound2ï¼Œæ¯æ¬¡å¾ªç¯count+1ï¼›</p><p>å½“æŒ‡å®šREVERSEçš„æ—¶å€™ï¼Œå°†countè®¾ç½®ä¸ºbound2ï¼Œåˆ¤æ–­å®ƒæ˜¯å¦å¤§äºä¸‹ç•Œbound1ï¼ˆåå‘è¿­ä»£ï¼‰ï¼Œæ¯æ¬¡å¾ªç¯count-1ï¼›</p><hr><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œéå†PCè¡¨ä¸­çš„priceå­—æ®µï¼Œå¹¶å°†å…¶speedå¤§äºpspeedéƒ¨åˆ†æ±‚å’Œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FOR</span> getprice <span class="keyword">IN</span> (<span class="keyword">select</span> price <span class="keyword">from</span> PC <span class="keyword">where</span> speed<span class="operator">&gt;</span>pspeed) LOOP</span><br><span class="line">   mCount:<span class="operator">=</span> mCount <span class="operator">+</span><span class="number">1</span>;</span><br><span class="line">   total:<span class="operator">=</span> total<span class="operator">+</span> getprice; </span><br><span class="line"><span class="keyword">END</span> LOOP;</span><br></pre></td></tr></table></figure><h2 id="æ¸¸æ ‡çš„æ¦‚å¿µå’Œä½¿ç”¨è¿‡ç¨‹"><a href="#æ¸¸æ ‡çš„æ¦‚å¿µå’Œä½¿ç”¨è¿‡ç¨‹" class="headerlink" title="æ¸¸æ ‡çš„æ¦‚å¿µå’Œä½¿ç”¨è¿‡ç¨‹"></a>æ¸¸æ ‡çš„æ¦‚å¿µå’Œä½¿ç”¨è¿‡ç¨‹</h2><blockquote><p>æ¸¸æ ‡çš„æ¦‚å¿µ ã€ä½¿ç”¨è¿‡ç¨‹   p253</p></blockquote><p>åœ¨è¿‡ç¨‹åŒ–SQLä¸­ï¼Œå¦‚æœSELECTè¯­å¥åªè¿”å›ä¸€æ¡è®°å½•ï¼Œå¯ä»¥å°†è¯¥ç»“æœå­˜æ”¾åˆ°å˜é‡ä¸­ï¼Œå½“æŸ¥è¯¢è¿”å›å¤šæ¡è®°å½•çš„æ—¶å€™ï¼Œå°±è¦ä½¿ç”¨ç”¨è¡¨å¯¹ç»“æœé›†è¿›è¡Œå¤„ç†ã€‚</p><p>ä¸€ä¸ªæ¸¸æ ‡å’Œä¸€ä¸ªSQLè¯­å¥ç›¸å…³è”ã€‚</p><h3 id="ä½¿ç”¨æ¸¸æ ‡çš„æ­¥éª¤"><a href="#ä½¿ç”¨æ¸¸æ ‡çš„æ­¥éª¤" class="headerlink" title="ä½¿ç”¨æ¸¸æ ‡çš„æ­¥éª¤"></a>ä½¿ç”¨æ¸¸æ ‡çš„æ­¥éª¤</h3><h4 id="1-å£°æ˜-x2F-å®šä¹‰æ¸¸æ ‡"><a href="#1-å£°æ˜-x2F-å®šä¹‰æ¸¸æ ‡" class="headerlink" title="1.å£°æ˜&#x2F;å®šä¹‰æ¸¸æ ‡"></a>1.å£°æ˜&#x2F;å®šä¹‰æ¸¸æ ‡</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> æ¸¸æ ‡å [(å‚æ•°<span class="number">1</span> æ•°æ®ç±»å‹,å‚æ•°<span class="number">2</span> æ•°æ®ç±»å‹,...)]</span><br><span class="line"><span class="keyword">CURSOR</span> <span class="keyword">FOR</span> </span><br><span class="line"><span class="keyword">SELECT</span> è¯­å¥;</span><br></pre></td></tr></table></figure><p>å®šä¹‰æ¸¸æ ‡ä»…ä»…æ˜¯ä¸€æ¡è¯´æ˜æ€§è¯­å¥ï¼Œè¿™é‡Œçš„SELECTè¯­å¥å¹¶æ²¡æœ‰è¢«ç«‹åˆ»æ‰§è¡Œ</p><h4 id="2-æ‰“å¼€æ¸¸æ ‡"><a href="#2-æ‰“å¼€æ¸¸æ ‡" class="headerlink" title="2.æ‰“å¼€æ¸¸æ ‡"></a>2.æ‰“å¼€æ¸¸æ ‡</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">OPEN</span> æ¸¸æ ‡å [(å‚æ•°<span class="number">1</span> æ•°æ®ç±»å‹,å‚æ•°<span class="number">2</span> æ•°æ®ç±»å‹,...)];</span><br></pre></td></tr></table></figure><p>æ‰“å¼€æ¸¸æ ‡çš„æ—¶å€™ä¼šæ‰§è¡Œå¯¹åº”çš„SELECTè¯­å¥ï¼Œå¹¶æŠŠæŸ¥è¯¢ç»“æœå–åˆ°ç¼“å†²åŒºä¸­ã€‚æ­¤æ—¶æ¸¸æ ‡å¤„äºæ´»åŠ¨çŠ¶æ€ï¼ŒæŒ‡é’ˆæŒ‡å‘æŸ¥è¯¢ç»“æœé›†ä¸­çš„ç¬¬ä¸€æ¡è®°å½•ã€‚</p><h4 id="3-ä½¿ç”¨æ¸¸æ ‡"><a href="#3-ä½¿ç”¨æ¸¸æ ‡" class="headerlink" title="3.ä½¿ç”¨æ¸¸æ ‡"></a>3.ä½¿ç”¨æ¸¸æ ‡</h4><p>æ¨è¿›æ¸¸æ ‡å¹¶è¯»å–å½“å‰è®°å½•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FETCH</span> æ¸¸æ ‡å <span class="keyword">INTO</span> å˜é‡<span class="number">1</span>[,å˜é‡<span class="number">2</span>,....];</span><br></pre></td></tr></table></figure><p>å…¶ä¸­å˜é‡å¿…é¡»å’ŒSELECTè¯­å¥ä¸­çš„ç›®æ ‡åˆ—è¡¨è¾¾å¼å…·æœ‰ä¸€ä¸€å¯¹åº”å…³ç³»</p><p>ç”¨FETCHè¯­å¥å°†æ¸¸æ ‡æŒ‡é’ˆå‘å‰æ¨è¿›ä¸€æ¡è®°å½•ï¼ŒåŒæ—¶å°†ç¼“å†²åŒºä¸­çš„è®°å½•å–å‡ºé€è‡³å˜é‡ä¾›è¿‡ç¨‹åŒ–SQLè¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚é€šè¿‡å†…ç¯æŒ‡å‘FETCHè¯­å¥é€æ¡å–èµ°ç»“æœé›†ä¸­çš„è¡Œè¿›è¡Œå¤„ç†ã€‚</p><h4 id="4-å…³é—­æ¸¸æ ‡"><a href="#4-å…³é—­æ¸¸æ ‡" class="headerlink" title="4.å…³é—­æ¸¸æ ‡"></a>4.å…³é—­æ¸¸æ ‡</h4><p>é‡Šæ”¾ç»“æœé›†å ç”¨çš„ç¼“å†²åŒºå’Œå…¶ä»–èµ„æº</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CLOSE</span> æ¸¸æ ‡å;</span><br></pre></td></tr></table></figure><p>è¢«å…³é—­çš„æ¸¸æ ‡å¯ä»¥è¢«å†æ¬¡æ‰“å¼€ï¼Œæ­¤æ—¶ä¼šé‡æ–°å†æ¬¡æ‰§è¡Œä¸€æ¬¡SELECTè¯­å¥ï¼Œä¸¤æ¬¡çš„ç»“æœå¹¶ä¸ä¸€å®šç›¸åŒã€‚</p><h2 id="å­˜å‚¨è¿‡ç¨‹ï¼ˆè‡ªå®šä¹‰å‡½æ•°ï¼‰"><a href="#å­˜å‚¨è¿‡ç¨‹ï¼ˆè‡ªå®šä¹‰å‡½æ•°ï¼‰" class="headerlink" title="å­˜å‚¨è¿‡ç¨‹ï¼ˆè‡ªå®šä¹‰å‡½æ•°ï¼‰"></a>å­˜å‚¨è¿‡ç¨‹ï¼ˆè‡ªå®šä¹‰å‡½æ•°ï¼‰</h2><h3 id="åˆ›å»ºå­˜å‚¨è¿‡ç¨‹"><a href="#åˆ›å»ºå­˜å‚¨è¿‡ç¨‹" class="headerlink" title="åˆ›å»ºå­˜å‚¨è¿‡ç¨‹"></a>åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">PROCEDURE</span> è¿‡ç¨‹å([</span><br><span class="line">[<span class="keyword">IN</span><span class="operator">|</span><span class="keyword">OUT</span><span class="operator">|</span><span class="keyword">INOUT</span>] å‚æ•°<span class="number">1</span> æ•°æ®ç±»å‹,</span><br><span class="line">[<span class="keyword">IN</span><span class="operator">|</span><span class="keyword">OUT</span><span class="operator">|</span><span class="keyword">INOUT</span>] å‚æ•°<span class="number">2</span> æ•°æ®ç±»å‹,</span><br><span class="line">...</span><br><span class="line">])</span><br><span class="line"><span class="keyword">AS</span> </span><br><span class="line"><span class="operator">&lt;</span>è¿‡ç¨‹å—<span class="keyword">SQL</span><span class="operator">&gt;</span>; <span class="comment">-- è¿™é‡Œçš„è¿‡ç¨‹å—SQLå°±æ˜¯ä¸Šé¢æåˆ°çš„è¿‡ç¨‹åŒ–SQLçš„ä¸€ä¸ªå—</span></span><br></pre></td></tr></table></figure><p>å­˜å‚¨è¿‡ç¨‹æä¾›äº†IN,OUT,INOUTä¸‰ç§å‚æ•°æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯å…¥å‚ã€è¾“å‡ºå‚æ•°ã€è¾“å…¥è¾“å‡ºå‚æ•°ã€‚ä¸å£°æ˜å‚æ•°ç±»å‹çš„æ—¶å€™é»˜è®¤æ˜¯INç±»å‹ã€‚</p><ul><li>è¾“å…¥å‚æ•°éœ€è¦æ‰‹åŠ¨ä¼ å…¥</li><li>è¾“å‡ºå‚æ•°ä¸éœ€è¦æ‰‹åŠ¨ä¼ å…¥ï¼Œè€Œæ˜¯ä»¥è¿”å›å€¼è¿”å›</li><li>è¾“å…¥è¾“å‡ºå‚æ•°è°ƒç”¨çš„æ—¶å€™éœ€è¦ä¼ å…¥åˆå€¼ï¼Œè¿˜ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å€¼</li></ul><p>å¦‚æœæ˜¯è¾“å‡ºå‚æ•°ï¼Œåˆ™éœ€è¦ä¸€ä¸ªå˜é‡æ¥å­˜æ”¾è¾“å‡ºåçš„å€¼ã€‚</p><h4 id="ç¤ºä¾‹-å®éªŒ2ä¸­çš„é¢˜ç›®"><a href="#ç¤ºä¾‹-å®éªŒ2ä¸­çš„é¢˜ç›®" class="headerlink" title="ç¤ºä¾‹-å®éªŒ2ä¸­çš„é¢˜ç›®"></a>ç¤ºä¾‹-å®éªŒ2ä¸­çš„é¢˜ç›®</h4><p>åœ¨PCè¡¨ä¸­ï¼Œå°†æŸä¸€é€Ÿåº¦ï¼ˆæ•´å‹ï¼‰ä½œä¸ºè¾“å…¥å‚æ•°ï¼Œæ±‚å¤§äºè¯¥é€Ÿåº¦çš„PCæœºçš„å¹³å‡ä»·æ ¼ã€‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- realæ˜¯æµ®ç‚¹å‹</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR REPLACE</span> <span class="keyword">FUNCTION</span> Meanprice (<span class="keyword">in</span> pspeed <span class="type">int</span>, <span class="keyword">out</span> mean <span class="type">real</span>) </span><br><span class="line"><span class="keyword">AS</span> $$<span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql"><span class="keyword">DECLARE</span> getprice <span class="type">INT</span>; mCount <span class="type">INT</span>; total <span class="type">INT</span>;</span></span><br><span class="line"><span class="language-pgsql"><span class="keyword">BEGIN</span></span></span><br><span class="line"><span class="language-pgsql">mean:=<span class="number">0</span>; mCount:=<span class="number">0</span>;total:=<span class="number">0</span>; </span></span><br><span class="line"><span class="language-pgsql"><span class="keyword">FOR</span> getprice <span class="keyword">IN</span> <span class="keyword">select</span> price <span class="keyword">from</span> PC </span></span><br><span class="line"><span class="language-pgsql"><span class="keyword">where</span> speed&gt;pspeed</span></span><br><span class="line"><span class="language-pgsql"><span class="keyword">LOOP</span></span></span><br><span class="line"><span class="language-pgsql">   mCount:= mCount +<span class="number">1</span>;</span></span><br><span class="line"><span class="language-pgsql">   total:= total+ getprice; </span></span><br><span class="line"><span class="language-pgsql"><span class="keyword">END</span> <span class="keyword">LOOP</span>;</span></span><br><span class="line"><span class="language-pgsql">mean:= total/ mCount; </span></span><br><span class="line"><span class="language-pgsql"><span class="keyword">END</span>;</span></span><br><span class="line"><span class="language-pgsql">$$</span> <span class="keyword">LANGUAGE</span> plpgsql;</span><br></pre></td></tr></table></figure><h3 id="è°ƒç”¨å­˜å‚¨è¿‡ç¨‹"><a href="#è°ƒç”¨å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="è°ƒç”¨å­˜å‚¨è¿‡ç¨‹"></a>è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CALL</span> [<span class="keyword">PROCEDURE</span>] è¿‡ç¨‹å([å‚æ•°<span class="number">1</span>,å‚æ•°<span class="number">2</span>,....]);</span><br><span class="line">PERFROM [<span class="keyword">PROCEDURE</span>] è¿‡ç¨‹å([å‚æ•°<span class="number">1</span>,å‚æ•°<span class="number">2</span>,....]); <span class="comment">-- ç­‰ä»·</span></span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹"><a href="#ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹"></a>ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹</h3><p>å­˜å‚¨è¿‡ç¨‹å¯ä»¥é‡å‘½å</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">PROCEDURE</span> è¿‡ç¨‹å <span class="keyword">RENAME</span> <span class="keyword">TO</span> æ–°åå­—;</span><br></pre></td></tr></table></figure><p>å¯ä»¥é‡æ–°ç¼–è¯‘ä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">PROCEDURE</span> è¿‡ç¨‹å COMPLIE;</span><br></pre></td></tr></table></figure><p>åˆ é™¤å­˜å‚¨è¿‡ç¨‹</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">PROCEDURE</span> è¿‡ç¨‹å;</span><br></pre></td></tr></table></figure><h3 id="å­˜å‚¨è¿‡ç¨‹çš„å¥½å¤„"><a href="#å­˜å‚¨è¿‡ç¨‹çš„å¥½å¤„" class="headerlink" title="å­˜å‚¨è¿‡ç¨‹çš„å¥½å¤„"></a>å­˜å‚¨è¿‡ç¨‹çš„å¥½å¤„</h3><p>å­˜å‚¨è¿‡ç¨‹åœ¨å®šä¹‰çš„æ—¶å€™å°±è¿›è¡Œäº†SQLçš„è¯­æ³•åˆ†æï¼Œè€Œæ™®é€šæ‰§è¡ŒSQLæ¯æ¬¡éƒ½ä¼šé‡æ–°è¿›è¡Œè¯­æ³•åˆ†æ</p><p>å­˜å‚¨è¿‡ç¨‹é™ä½äº†å®¢æˆ·æœºå’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡é‡ï¼Œå› ä¸ºå­˜å‚¨è¿‡ç¨‹ä¸­å¯èƒ½åŒ…å«å¤šæ¡SQLï¼Œå®¢æˆ·æœºä¸å†éœ€è¦å°†è¿™å¤šæ¡SQLé‡å¤å‘é€ã€‚</p><p>æ–¹ä¾¿ç»´æŠ¤ï¼šå½“æŸä¸ªæ–¹æ³•éœ€è¦æ”¹å˜çš„æ—¶å€™ï¼Œåªéœ€è¦æ”¹å˜å¯¹åº”çš„å­˜å‚¨è¿‡ç¨‹ï¼Œå¹¶ä¸éœ€è¦æ”¹å˜å®¢æˆ·ç«¯ç¨‹åºã€‚</p>]]></content>
    
    
    <summary type="html">è¿™æ˜¯å¤§ä¸‰å­¦çš„æ•°æ®åº“ç³»ç»ŸåŸç†ä¸­çš„é¢å¤–å†…å®¹</summary>
    
    
    
    <category term="ç¼–ç¨‹å­¦ä¹ " scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="æ•°æ®åº“SQL" scheme="https://blog.musnow.top/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E6%95%B0%E6%8D%AE%E5%BA%93SQL/"/>
    
    
    <category term="mysql" scheme="https://blog.musnow.top/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>ã€winã€‘edgeæ›´æ¢chromeæµè§ˆå™¨</title>
    <link href="https://blog.musnow.top/posts/1864371357/"/>
    <id>https://blog.musnow.top/posts/1864371357/</id>
    <published>2024-01-28T03:30:00.000Z</published>
    <updated>2024-02-15T07:36:30.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-edgeçš„é—®é¢˜"><a href="#1-edgeçš„é—®é¢˜" class="headerlink" title="1.edgeçš„é—®é¢˜"></a>1.edgeçš„é—®é¢˜</h1><p>ç”±äºedgeæ–°ç‰ˆæœ¬åœ¨æˆ‘çš„ç”µè„‘ä¸Šå‡ºç°äº†è«åå…¶å¦™ä¸”æ²¡æ‰¾åˆ°è§£å†³åŠæ³•çš„æ¸²æŸ“é—®é¢˜ï¼Œå†³å®šæ›´æ¢æµè§ˆå™¨ä¸ºchromeï¼›</p><p>æˆ‘å·²ç»æ£€æŸ¥è¿‡äº†ï¼Œedgeåœ¨æ‰€æœ‰æ’ä»¶éƒ½å…³é—­çš„æƒ…å†µä¸‹ä¾æ—§ä¼šæ¸²æŸ“é”™è¯¯ï¼Œä¸”å’Œedgeçš„<code>æ–°å¤–è§‚</code>æ²¡æœ‰å…³ç³»ã€‚ç›®å‰æš‚æ—¶æ²¡æœ‰æ‰¾åˆ°å‡ºç°è¿™ä¸ªæ¸²æŸ“é”™è¯¯çš„åŸå› ï¼Œå›é€€æ—§ç‰ˆæœ¬ä¹Ÿæ²¡æˆåŠŸï¼Œå¹²è„†æ¢chromeå®Œäº‹ã€‚</p><p>è¿™ä¸ªé—®é¢˜åœ¨æˆ‘è‡ªå·±çš„ç”µè„‘edgeè‡ªåŠ¨æ›´æ–°åå‡ºç°ï¼Œä¸”åœ¨æˆ‘å®ä¹ å•ä½çš„ç”µè„‘ä¸Šä¹Ÿæœ‰æ¸²æŸ“é”™ä½é—®é¢˜ï¼Œè¯´æ˜ä¸æ˜¯ä¸ªä¾‹ã€‚åªèƒ½éª‚éª‚å¾®è½¯äº†ï¼Œä»€ä¹ˆæ—¶å€™æ”¹å¥½è¿™ä¸ªbugæˆ‘ä»€ä¹ˆæ—¶å€™æ¢å›å»ã€‚</p><blockquote><p>æˆ‘çš„ç”µè„‘çš„edgeç‰ˆæœ¬ï¼šç‰ˆæœ¬ 121.0.2277.83 (æ­£å¼ç‰ˆæœ¬) (64 ä½)</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/01/e9d3ac5e1f6cfd268d9072989586f536.png" alt="image.png"></p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/01/1ac7a87a688b39359bef12edc58977fc.png" alt="image.png"></p><p>ä¸åªæ˜¯bç«™çš„æ¸²æŸ“æœ‰é—®é¢˜ï¼Œè¿˜æœ‰å¾ˆå¤šç½‘é¡µä¼šå‡ºç°ç±»ä¼¼çš„æ¨ªç€çš„ä¸œè¥¿å˜æˆç«–ç€çš„ï¼Œåœ¨ä¸è¯¥æœ‰çš„ä½ç½®è«åå…¶å¦™å‡ºç°ä¸€ä¸ªæ»šåŠ¨æ¡ç­‰ç­‰</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/01/4105dd031e08a43ee74c9523aafbb9e9.png" alt="image.png"></p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/01/78cd94fe96c19fdf04bb313dad8705b5.png" alt="image.png"></p><h1 id="2-edgeæ— æŸè½¬chrome"><a href="#2-edgeæ— æŸè½¬chrome" class="headerlink" title="2.edgeæ— æŸè½¬chrome"></a>2.edgeæ— æŸè½¬chrome</h1><p>å¯¹äºæµè§ˆå™¨æ¥è¯´å…¶å®åªæœ‰ä¸¤ä¸ªé‡è¦æ•°æ®ï¼Œä¸€ä¸ªæ˜¯æ”¶è—å¤¹ï¼Œä¸€ä¸ªæ˜¯ä¿å­˜çš„å¯†ç ã€‚</p><h2 id="æ”¶è—å¤¹"><a href="#æ”¶è—å¤¹" class="headerlink" title="æ”¶è—å¤¹"></a>æ”¶è—å¤¹</h2><p>edgeæ”¶è—å¤¹å¯¼å‡ºï¼šå³ä¸Šè§’ä¸‰ä¸ªç‚¹-æ”¶è—å¤¹-å¼¹å‡ºæ¡†çš„å³ä¸Šè§’ä¸‰ä¸ªç‚¹-å¯¼å‡ºæ”¶è—å¤¹</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/01/f685ebdd3fe425ca3458b32d8858a6c9.png" alt="image.png"></p><p>è¿™ä¸ªé€‰é¡¹ä¼šå°†æ”¶è—å¤¹å¯¼å‡ºä¸ºhtmlæ–‡ä»¶ï¼Œåœ¨chomeçš„ä¹¦ç­¾ä¸­ï¼Œé€‰åˆ™å¯¼å…¥ä¹¦ç­¾å’Œè®¾ç½®</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/01/24ece2c8a3131922d0f2d5b2415d2d80.png" alt="image.png"></p><p>é€‰æ‹©ä»¥å‰å¯¼å‡ºçš„ä¹¦ç­¾ï¼ˆHTMLæ–‡ä»¶ï¼‰ï¼Œç„¶åæŠŠåˆšåˆšå¯¼å‡ºçš„edgeä¹¦ç­¾htmlæ–‡ä»¶é€‰æ‹©ä¸Šå°±èƒ½æ­£å¸¸å¯¼å…¥äº†ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/01/a995083136a6d3df8488dd39aa6e78d2.png" alt="image.png"></p><h2 id="å¯†ç "><a href="#å¯†ç " class="headerlink" title="å¯†ç "></a>å¯†ç </h2><p>edgeå¯†ç å¯¼å‡ºï¼šå³ä¸Šè§’ä¸‰ä¸ªç‚¹-è®¾ç½®-ä¸ªäººèµ„æ–™-å¯†ç -å¯¼å‡ºå¯†ç ï¼›</p><p>æ–°ç‰ˆæœ¬è¿™é‡Œå«ç”µå­é’±åŒ…ï¼Œæ—§ç‰ˆæœ¬åº”è¯¥åªæ˜¯ä¸ªå¯†ç é¡µé¢ã€‚åœ¨å¯†ç é¡µé¢å³ä¸Šè§’ä¸‰ä¸ªç‚¹é€‰æ‹©å¯¼å‡ºå¯†ç å³å¯ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/01/9015fad0ad60ebdc2da0f2f8c82eb2ce.png" alt="image.png"></p><p>æ³¨æ„ï¼Œå¯¼å‡ºå¯†ç ä¹‹å‰åº”è¯¥ç¡®è®¤ä½ çš„ç”µè„‘ä¸Šæ²¡æœ‰ç—…æ¯’æˆ–æ¶æ„è½¯ä»¶ï¼Œå› ä¸ºå¯¼å‡ºåæ˜¯csvæ˜æ–‡æ–‡ä»¶ï¼Œä»»ä½•è½¯ä»¶éƒ½èƒ½ç›´æ¥è¯»å–ï¼</p><p>å¯¼å‡ºcsvåï¼Œåœ¨chromeæµè§ˆå™¨ä¸­è¿›å…¥å¯†ç ç®¡ç†å·¥å…·ï¼Œåœ¨<strong>å¯†ç ç®¡ç†å·¥å…·çš„è®¾ç½®</strong>ä¸­æœ‰å¯¼å…¥å¯†ç é€‰é¡¹ï¼Œé€‰æ‹©csvæ–‡ä»¶å³å¯å¯¼å…¥å¯†ç ã€‚å¯¼å…¥å¯†ç åå»ºè®®ç«‹é©¬å°†csvæ–‡ä»¶åˆ é™¤ã€‚</p><h1 id="3-å…³é—­edgeé»˜è®¤æµè§ˆå™¨é˜²æŠ¤"><a href="#3-å…³é—­edgeé»˜è®¤æµè§ˆå™¨é˜²æŠ¤" class="headerlink" title="3.å…³é—­edgeé»˜è®¤æµè§ˆå™¨é˜²æŠ¤"></a>3.å…³é—­edgeé»˜è®¤æµè§ˆå™¨é˜²æŠ¤</h1><p>è®°å¾—å…³é—­edgeçš„é»˜è®¤æµè§ˆå™¨è®¾ç½®ï¼šåœ¨edgeçš„è®¾ç½®-é»˜è®¤æµè§ˆå™¨ä¸­ï¼Œå…³é—­<code>ä¿æŠ¤é»˜è®¤æµè§ˆå™¨è®¾ç½®</code>é¦–é€‰é¡¹ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/01/b54c663800d8688fadbed0cb61d1b825.png" alt="image.png"></p><p>åœ¨windows11çš„ç³»ç»Ÿè®¾ç½®-åº”ç”¨-é»˜è®¤åº”ç”¨ä¸­æœç´¢chromeï¼Œå¯ä»¥åœ¨è¿™é‡Œè®¾ç½®chromeä¸ºé»˜è®¤æµè§ˆå™¨ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/01/3bceefb979209938e0b40b96aafec55f.png" alt="image.png"></p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/01/85e37feba749ebde96742b852f30edd6.png" alt="image.png"></p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/01/d77bca81b7237dfe4a763a0bbc11de00.png" alt="image.png"></p><h1 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h1><p>edgeç›®å‰å¯¹æ¯”chromeæ¥è¯´æœ€å¤§çš„å¥½å¤„è¿˜æ˜¯å¯ä»¥ç›´è¿çš„åŒæ­¥åŠŸèƒ½ã€‚ä½†ç°åœ¨windowsç«¯è¿é¡µé¢æ¸²æŸ“éƒ½æœ‰é—®é¢˜ï¼Œé‚£æˆ‘è‚¯å®šæ²¡åŠæ³•ï¼Œåªèƒ½è·‘è·¯chromeäº†ã€‚</p><h1 id="Hold-on"><a href="#Hold-on" class="headerlink" title="Hold on"></a>Hold on</h1><p>ä¸ºä»€ä¹ˆchromeçš„ç‰›å®¢ç½‘ä¹Ÿæœ‰è¿™ä¸ªæ¸²æŸ“é”™è¯¯çš„é—®é¢˜ï¼Ÿï¼Ÿï¼Ÿæ— è¯­äº†â€¦â€¦å¼ºè¿«ç—‡çœ‹çš„å¾ˆéš¾å—å•Šï¼ï¼ï¼</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/01/d3321003553cc37d4e9c4727f0fb6453.png" alt="image.png"></p><p>æˆ‘æ‰¾åˆ°é—®é¢˜äº†ï¼šæˆ‘æŠŠchromeå’Œedgeçš„æœ€å°å­—å·éƒ½è®¾ç½®æˆäº†15ï¼Œå¯¼è‡´å­—ä½“æ”¾ä¸ä¸‹â€¦â€¦</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2024/02/f139a67eca7a8bb5d69f6402e84d782e.png" alt="image.png"></p><p>è¿™ä¸ªé€‰é¡¹é»˜è®¤åº”è¯¥æ˜¯13ï¼ˆæˆ‘å¿˜è®°é»˜è®¤æ˜¯å¤šå°‘äº†ï¼Œåæ­£æ”¹æˆ13å°±è¡Œäº†ï¼‰</p>]]></content>
    
    
    <summary type="html">edgeæ›´æ¢chromeæµè§ˆå™¨</summary>
    
    
    
    <category term="å·®ç”Ÿæ–‡å…·å¤š" scheme="https://blog.musnow.top/categories/%E5%B7%AE%E7%94%9F%E6%96%87%E5%85%B7%E5%A4%9A/"/>
    
    <category term="ç¼–ç¨‹å·¥å…·" scheme="https://blog.musnow.top/categories/%E5%B7%AE%E7%94%9F%E6%96%87%E5%85%B7%E5%A4%9A/%E7%BC%96%E7%A8%8B%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="windows" scheme="https://blog.musnow.top/tags/windows/"/>
    
  </entry>
  
</feed>
