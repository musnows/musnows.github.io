<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æ…•é›ªçš„å¯’èˆ</title>
  
  <subtitle>é›ªä¸‹äº†ä¸€å¤œ</subtitle>
  <link href="https://blog.musnow.top/atom.xml" rel="self"/>
  
  <link href="https://blog.musnow.top/"/>
  <updated>2023-02-20T13:11:32.900Z</updated>
  <id>https://blog.musnow.top/</id>
  
  <author>
    <name>muxue</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ã€C++ã€‘C++11ä¸­å±€éƒ¨staticå˜é‡çš„çº¿ç¨‹å®‰å…¨é—®é¢˜</title>
    <link href="https://blog.musnow.top/2023/02/20/note_cpp/29C++11%E5%B1%80%E9%83%A8%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F%E5%88%9D%E5%A7%8B%E5%8C%96%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/"/>
    <id>https://blog.musnow.top/2023/02/20/note_cpp/29C++11%E5%B1%80%E9%83%A8%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F%E5%88%9D%E5%A7%8B%E5%8C%96%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/</id>
    <published>2023-02-20T13:13:46.000Z</published>
    <updated>2023-02-20T13:11:32.900Z</updated>
    
    <content type="html"><![CDATA[<p>C++11ä¸­å±€éƒ¨staticå˜é‡çš„çº¿ç¨‹å®‰å…¨é—®é¢˜</p><span id="more"></span><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å¤§å®¶éƒ½çŸ¥é“ï¼Œåœ¨C++11æ ‡å‡†ä¸­ï¼Œè¦æ±‚å±€éƒ¨é™æ€å˜é‡åˆå§‹åŒ–å…·æœ‰<a class="link"   href="https://so.csdn.net/so/search?q=%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8&spm=1001.2101.3001.7020" >çº¿ç¨‹å®‰å…¨<i class="fas fa-external-link-alt"></i></a>æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“å®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å•ä¾‹ç±»ï¼š</p><pre><code>class Foo&#123;public:    static Foo *getInstance()    &#123;        static Foo s_instance;        return &amp;s_instance;    &#125;private:    Foo() &#123;&#125;&#125;;</code></pre><p>åœ¨C++æ ‡å‡†ä¸­ï¼Œæ˜¯è¿™æ ·æè¿°çš„ï¼ˆåœ¨<a class="link"   href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3337.pdf" >æ ‡å‡†è‰æ¡ˆ<i class="fas fa-external-link-alt"></i></a>çš„6.7èŠ‚ä¸­ï¼‰ï¼š</p><blockquote><p>such a variable is initialized the first time control passes through its declaration; such a variable is considered initialized upon the completion of its initialization. If the initialization exits by throwing an exception, the initialization is not complete, so it will be tried again the next time control enters the declaration. If control enters the declaration concurrently while the variable is being initialized, the concurrent execution shall wait for completion of the initialization. If control re-enters the declaration recursively while the variable is being initialized, the behavior is undefined.</p></blockquote><h1 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h1><p>æ ‡å‡†å…³äºå±€éƒ¨é™æ€å˜é‡åˆå§‹åŒ–ï¼Œæœ‰è¿™ä¹ˆå‡ ç‚¹è¦æ±‚ï¼š</p><ol><li>å˜é‡åœ¨ä»£ç ç¬¬ä¸€æ¬¡æ‰§è¡Œåˆ°å˜é‡å£°æ˜çš„åœ°æ–¹æ—¶åˆå§‹åŒ–ã€‚</li><li>åˆå§‹åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸çš„è¯è§†ä¸ºæœªå®Œæˆåˆå§‹åŒ–ï¼Œæœªå®Œæˆåˆå§‹åŒ–çš„è¯ï¼Œéœ€è¦ä¸‹æ¬¡æœ‰ä»£ç æ‰§è¡Œåˆ°ç›¸åŒä½ç½®æ—¶å†æ¬¡åˆå§‹åŒ–ã€‚</li><li>åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œåˆ°éœ€è¦åˆå§‹åŒ–å˜é‡çš„åœ°æ–¹æ—¶ï¼Œå¦‚æœæœ‰å…¶ä»–çº¿ç¨‹æ­£åœ¨åˆå§‹åŒ–è¯¥å˜é‡ï¼Œåˆ™é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°åˆå§‹åŒ–å®Œæˆä¸ºæ­¢ã€‚</li><li>å¦‚æœåˆå§‹åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¯¹åˆå§‹åŒ–çš„é€’å½’è°ƒç”¨ï¼Œåˆ™è§†ä¸ºæœªå®šä¹‰è¡Œä¸ºã€‚</li></ol><p>å…³äºç¬¬4ç‚¹ï¼Œå¦‚æœä¸æ˜ç™½ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹ä»£ç ï¼š</p><pre><code>class Bar&#123;public:    static Bar *getInstance()    &#123;        static Bar s_instance;        return &amp;s_instance;    &#125;private:    Bar()    &#123;        getInstance();    &#125;&#125;;</code></pre><h1 id="GCCçš„å®ç°"><a href="#GCCçš„å®ç°" class="headerlink" title="GCCçš„å®ç°"></a>GCCçš„å®ç°</h1><p>ä»¥GCC 7.3.0ç‰ˆæœ¬ä¸ºä¾‹ï¼Œæˆ‘ä»¬æ¥åˆ†æGCCæ˜¯å¦‚ä½•å®ç°æ ‡å‡†çš„ã€‚</p><h2 id="Foo-getInstance"><a href="#Foo-getInstance" class="headerlink" title="Foo::getInstance()"></a>Foo::getInstance()</h2><p>ä½¿ç”¨GCCç¼–è¯‘åï¼Œæˆ‘ä»¬ä½¿ç”¨gdbå°†æ–‡ç« å¼€å¤´çš„<code>Foo::getInstance()</code>åæ±‡ç¼–ï¼š</p><pre><code>Dump of assembler code for function Foo::getInstance():   0x00005555555546ea &lt;+0&gt;:     push   %rbp   0x00005555555546eb &lt;+1&gt;:     mov    %rsp,%rbp=&gt; 0x00005555555546ee &lt;+4&gt;:     movzbl 0x20092b(%rip),%eax        # 0x555555755020 &lt;_ZGVZN3Foo11getInstanceEvE10s_instance&gt;   0x00005555555546f5 &lt;+11&gt;:    test   %al,%al   0x00005555555546f7 &lt;+13&gt;:    sete   %al   0x00005555555546fa &lt;+16&gt;:    test   %al,%al   0x00005555555546fc &lt;+18&gt;:    je     0x55555555472b &lt;Foo::getInstance()+65&gt;   0x00005555555546fe &lt;+20&gt;:    lea    0x20091b(%rip),%rdi        # 0x555555755020 &lt;_ZGVZN3Foo11getInstanceEvE10s_instance&gt;   0x0000555555554705 &lt;+27&gt;:    callq  0x5555555545b0 &lt;__cxa_guard_acquire@plt&gt;   0x000055555555470a &lt;+32&gt;:    test   %eax,%eax   0x000055555555470c &lt;+34&gt;:    setne  %al   0x000055555555470f &lt;+37&gt;:    test   %al,%al   0x0000555555554711 &lt;+39&gt;:    je     0x55555555472b &lt;Foo::getInstance()+65&gt;   0x0000555555554713 &lt;+41&gt;:    lea    0x2008fe(%rip),%rdi        # 0x555555755018 &lt;_ZZN3Foo11getInstanceEvE10s_instance&gt;   0x000055555555471a &lt;+48&gt;:    callq  0x555555554734 &lt;Foo::Foo()&gt;   0x000055555555471f &lt;+53&gt;:    lea    0x2008fa(%rip),%rdi        # 0x555555755020 &lt;_ZGVZN3Foo11getInstanceEvE10s_instance&gt;   0x0000555555554726 &lt;+60&gt;:    callq  0x5555555545a0 &lt;__cxa_guard_release@plt&gt;   0x000055555555472b &lt;+65&gt;:    lea    0x2008e6(%rip),%rax        # 0x555555755018 &lt;_ZZN3Foo11getInstanceEvE10s_instance&gt;   0x0000555555554732 &lt;+72&gt;:    pop    %rbp   0x0000555555554733 &lt;+73&gt;:    retq   End of assembler dump.</code></pre><p>åœ¨<code>+4</code>ã€<code>+20</code>ã€<code>+53</code>å‡ºç°çš„<code>_ZGVZN3Foo11getInstanceEvE10s_instance</code>ä½¿ç”¨<code>c++filt</code>åˆ†æä¸º<code>guard variable for Foo::getInstance()::s_instance</code>ï¼Œè€Œ<code>+41</code>ã€<code>+65</code>ä½ç½®å‡ºç°çš„<code>_ZZN3Foo11getInstanceEvE10s_instance</code>åˆ™ä¸º<code>Foo::getInstance()::s_instance</code>ã€‚åè€…æ˜¯<code>s_instance</code>è¿™ä¸ªå±€éƒ¨é™æ€å˜é‡ï¼Œå‰è€…ä»åå­—çœ‹å°±çŸ¥é“æ˜¯ä¸ª<code>guard</code>æ ‡å¿—å˜é‡ï¼Œç”¨æ¥æŒ‡ç¤ºå±€éƒ¨é™æ€å˜é‡çš„åˆå§‹åŒ–çŠ¶æ€ã€‚</p><h3 id="4-18"><a href="#4-18" class="headerlink" title="+4 ~ +18"></a>+4 ~ +18</h3><p>æµ‹è¯•<code>guard</code>å˜é‡çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œå¦‚æœä¸º<code>0</code>ï¼Œä»£è¡¨<code>s_instance</code>æœªåˆå§‹åŒ–ï¼Œè¿›å…¥<code>+27</code>ï¼›å¦åˆ™ä»£è¡¨<code>s_instance</code>å·²åˆå§‹åŒ–ï¼Œè¿›å…¥<code>+65</code>ã€‚</p><h3 id="20-ï½-27"><a href="#20-ï½-27" class="headerlink" title="+20 ï½ +27"></a>+20 ï½ +27</h3><p>ä»¥<code>guard</code>å˜é‡åœ°å€ä½œä¸ºå‚æ•°ï¼Œæ‰§è¡Œ<code>__cxa_guard_acquire</code>å‡½æ•°ã€‚</p><h3 id="32-ï½-39"><a href="#32-ï½-39" class="headerlink" title="+32 ï½ +39"></a>+32 ï½ +39</h3><p>æµ‹è¯•è¿”å›å€¼ï¼Œå¦‚æœä¸º<code>0</code>ï¼Œä»£è¡¨<code>s_instance</code>å·²åˆå§‹åŒ–ï¼Œè¿›å…¥<code>+65</code>ï¼›å¦åˆ™ä»£è¡¨<code>s_instance</code>æœªåˆå§‹åŒ–ï¼Œè¿›å…¥<code>+41</code>ã€‚</p><h3 id="41-ï½-48"><a href="#41-ï½-48" class="headerlink" title="+41 ï½ +48"></a>+41 ï½ +48</h3><p>åˆå§‹åŒ–<code>s_instance</code></p><h3 id="53-ï½-60"><a href="#53-ï½-60" class="headerlink" title="+53 ï½ +60"></a>+53 ï½ +60</h3><p>ä»¥<code>guard</code>å˜é‡åœ°å€ä½œä¸ºå‚æ•°ï¼Œæ‰§è¡Œ<code>__cxa_guard_release</code>å‡½æ•°ã€‚</p><h3 id="65-ï½-73"><a href="#65-ï½-73" class="headerlink" title="+65 ï½ +73"></a>+65 ï½ +73</h3><p>è¿”å›<code>s_instance</code>åœ°å€</p><h2 id="cxa-guard-acquire"><a href="#cxa-guard-acquire" class="headerlink" title="__cxa_guard_acquire"></a>__cxa_guard_acquire</h2><p>æˆ‘ä»¬æ¥çœ‹çœ‹<code>__cxa_guard_acquire</code>è¿™ä¸ªå‡½æ•°å…·ä½“åšäº†ä»€ä¹ˆï¼Œè¯¥å‡½æ•°ä»£ç ä½äº<code>gcc-7-7.3.0/gcc-7.3.0/libstdc++-v3/libsupc++/guard.cc</code>ã€‚ç”±äºè¿™ä¸ªå‡½æ•°é’ˆå¯¹ä¸åŒå¹³å°åšäº†ä¸åŒçš„å®ç°ï¼Œæœ‰äº›æˆ‘ä»¬ä¸éœ€è¦çš„ä»£ç ï¼Œä»¥æˆ‘æœºå™¨çš„è®¾ç½®ï¼Œæ”¯æŒçº¿ç¨‹å’Œfutexç³»ç»Ÿè°ƒç”¨ï¼Œæ‰€ä»¥åˆ é™¤äº†ä¸€äº›ä¸ç›¸å…³çš„ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cxa_guard_acquire (__guard *g)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// If the target can reorder loads, we need to insert a read memory</span></span><br><span class="line">    <span class="comment">// barrier so that accesses to the guarded variable happen after the</span></span><br><span class="line">    <span class="comment">// guard test.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1</span></span><br><span class="line">    <span class="keyword">if</span> (_GLIBCXX_GUARD_TEST_AND_ACQUIRE (g))</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If __atomic_* and futex syscall are supported, don&#x27;t use any global</span></span><br><span class="line">    <span class="comment">// mutex.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2</span></span><br><span class="line">    <span class="keyword">if</span> (__gthread_active_p ())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> *gi = (<span class="type">int</span> *) (<span class="type">void</span> *) g;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3</span></span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> guard_bit = _GLIBCXX_GUARD_BIT;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> pending_bit = _GLIBCXX_GUARD_PENDING_BIT;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> waiting_bit = _GLIBCXX_GUARD_WAITING_BIT;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 4</span></span><br><span class="line">            <span class="function"><span class="type">int</span> <span class="title">expected</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">            <span class="keyword">if</span> (__atomic_compare_exchange_n(gi, &amp;expected, pending_bit, <span class="literal">false</span>,</span><br><span class="line">                                            __ATOMIC_ACQ_REL,</span><br><span class="line">                                            __ATOMIC_ACQUIRE))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// This thread should do the initialization.</span></span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 5</span></span><br><span class="line">            <span class="keyword">if</span> (expected == guard_bit)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// Already initialized.</span></span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 6</span></span><br><span class="line">            <span class="keyword">if</span> (expected == pending_bit)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// Use acquire here.</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 7</span></span><br><span class="line">                <span class="type">int</span> newv = expected | waiting_bit;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 8</span></span><br><span class="line">                <span class="keyword">if</span> (!__atomic_compare_exchange_n(gi, &amp;expected, newv, <span class="literal">false</span>,</span><br><span class="line">                                                 __ATOMIC_ACQ_REL,</span><br><span class="line">                                                 __ATOMIC_ACQUIRE))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 9</span></span><br><span class="line">                    <span class="keyword">if</span> (expected == guard_bit)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// Make a thread that failed to set the</span></span><br><span class="line">                        <span class="comment">// waiting bit exit the function earlier,</span></span><br><span class="line">                        <span class="comment">// if it detects that another thread has</span></span><br><span class="line">                        <span class="comment">// successfully finished initialising.</span></span><br><span class="line">                        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 10</span></span><br><span class="line">                    <span class="keyword">if</span> (expected == <span class="number">0</span>)</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 11</span></span><br><span class="line">                expected = newv;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 12</span></span><br><span class="line">            <span class="built_in">syscall</span> (SYS_futex, gi, _GLIBCXX_FUTEX_WAIT, expected, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">acquire</span> (g);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>é¦–å…ˆæ£€æµ‹<code>guard</code>å˜é‡ï¼Œ<code>guard</code>å˜é‡ç­‰äº<code>1</code>çš„è¯ï¼Œç›´æ¥è¿”å›<code>0</code>ï¼Œä»£è¡¨<code>s_instance</code>å·²åˆå§‹åŒ–ï¼Œä¸éœ€è¦å†æ¬¡åˆå§‹åŒ–ã€‚</li><li>æ£€æµ‹æ˜¯å¦ä¸ºå¤šçº¿ç¨‹ç¯å¢ƒï¼Œå¦‚æœæ²¡æœ‰å¤šçº¿ç¨‹çš„è¯ï¼Œä¹Ÿå°±æ²¡æœ‰å¿…è¦å»åšé¢å¤–å·¥ä½œæ¥ä¿è¯çº¿ç¨‹å®‰å…¨äº†ã€‚</li><li><code>guard_bit</code>è¡¨ç¤º<code>s_instance</code>å·²ç»åˆå§‹åŒ–æˆåŠŸï¼›<code>pending_bit</code>è¡¨ç¤º<code>s_instance</code>æ­£åœ¨åˆå§‹åŒ–ï¼›<code>waiting_bit</code>è¡¨ç¤ºæœ‰å…¶ä»–çº¿ç¨‹æ­£åœ¨ç­‰å¾…<code>s_instance</code>çš„åˆå§‹åŒ–ã€‚</li><li>ä½¿ç”¨ä¸€ä¸ªåŸå­æ“ä½œæ¥æ£€æµ‹<code>guard</code>å˜é‡æ˜¯å¦ä¸º<code>0</code>ï¼Œå¦‚æœä¸º<code>0</code>ï¼Œåˆ™ç”±å½“å‰çº¿ç¨‹åˆå§‹åŒ–<code>s_instance</code>ï¼ŒæŠŠ<code>pending_bit</code>å†™å…¥guardå˜é‡ï¼Œè¿”å›<code>1</code>ã€‚å¦‚æœä¸ä¸º<code>0</code>ï¼Œåˆ™å°†guardå½“å‰å€¼å†™å…¥<code>expected</code>ã€‚</li><li>æ£€æµ‹<code>expected</code>å€¼æ˜¯å¦ä¸º<code>guard_bit</code>ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™<code>s_instance</code>å·²åˆå§‹åŒ–å®Œæˆï¼Œä¸å†éœ€è¦åˆå§‹åŒ–ï¼Œè¿”å›<code>0</code>ã€‚</li><li>æ£€æµ‹<code>expected</code>å€¼æ˜¯å¦ä¸º<code>pending_bit</code>ï¼Œå¦‚æœæ˜¯ï¼Œè¯´æ˜<code>s_instance</code>æ­£åœ¨åˆå§‹åŒ–ï¼Œä¸”æ²¡æœ‰å…¶ä»–çº¿ç¨‹ç­‰å¾…åˆå§‹åŒ–ã€‚</li><li>å°†<code>newv</code>å˜é‡è®¾ç½®ä¸º<code>pending_bit | waiting_bit</code>ï¼Œè¡¨ç¤º<code>s_instance</code>æ­£åœ¨åˆå§‹åŒ–ä¸”æœ‰çº¿ç¨‹æ­£åœ¨ç­‰å¾…åˆå§‹åŒ–ã€‚</li><li>ä½¿ç”¨ä¸€ä¸ªåŸå­æ“ä½œæ¥æ£€æµ‹<code>guard</code>å˜é‡æ˜¯å¦ä¸º<code>pending_bit</code>ï¼Œå¦‚æœä¸æ˜¯ï¼Œè¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†<code>guard</code>å˜é‡ï¼Œéœ€è¦åšè¿›ä¸€æ­¥æ£€æµ‹ï¼›å¦‚æœæ˜¯ï¼Œè¯´æ˜æ²¡æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹<code>guard</code>å˜é‡ï¼Œåˆ™å°†<code>pending_bit | waiting_bit</code>å†™å…¥<code>guard</code>å˜é‡ã€‚</li><li>å¦‚æœ<code>expected</code>ç­‰äº<code>guard_bit</code>ï¼Œè¯´æ˜<code>s_instance</code>è¢«åˆå§‹åŒ–æˆåŠŸï¼Œä¸éœ€è¦å†åˆå§‹åŒ–ï¼Œè¿”å›<code>0</code>ã€‚</li><li>å¦‚æœ<code>expected</code>ç­‰äº<code>0</code>ï¼Œè¯´æ˜<code>s_instance</code>åˆå§‹åŒ–å¤±è´¥ï¼Œå›åˆ°<code>4</code>é‡æ–°å¼€å§‹æ£€æµ‹ã€‚</li><li>å¦‚æœåœ¨<code>8</code>ä¸­æ²¡æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡<code>guard</code>å˜é‡ï¼Œå°†<code>expected</code>è®¾ç½®ä¸º<code>pending_bit | waiting_bit</code>ï¼Œè¡¨ç¤º<code>s_instance</code>æ­£åœ¨åˆå§‹åŒ–ä¸”æœ‰çº¿ç¨‹ï¼ˆä¹Ÿå°±æ˜¯å½“å‰çº¿ç¨‹ï¼‰æ­£åœ¨ç­‰å¾…åˆå§‹åŒ–ã€‚</li><li>å¦‚æœåœ¨<code>6</code>å¤„æ²¡æœ‰è¿›å…¥ifåˆ†æ”¯ï¼Œè¯´æ˜<code>expected</code>ç­‰äº<code>pending_bit | waiting_bit</code>ï¼Œå¦‚æœè¿›å…¥äº†ifåˆ†æ”¯ï¼Œç”±<code>11</code>å¯å¾—ï¼Œæ­¤æ—¶<code>expected</code>ä¹Ÿè¢«ä¿®æ”¹ä¸ºäº†<code>pending_bit | waiting_bit</code>ã€‚æ€»ä¹‹ï¼Œæ­¤æ—¶<code>s_instance</code>æ­£åœ¨åˆå§‹åŒ–ä¸”æœ‰çº¿ç¨‹æ­£åœ¨ç­‰å¾…åˆå§‹åŒ–ã€‚åˆ©ç”¨<code>futex</code>ç³»ç»Ÿè°ƒç”¨ï¼Œå†æ¬¡æ£€æµ‹<code>guard</code>å˜é‡æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼Œå¦‚æœå‘ç”Ÿäº†å˜åŒ–ï¼Œå›åˆ°<code>4</code>é‡æ–°å¼€å§‹æ£€æµ‹ï¼›å¦‚æœæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä»ç„¶ç­‰äº<code>pending_bit | waiting_bit</code>ï¼Œåˆ™æŒ‚èµ·å½“å‰çº¿ç¨‹ã€‚</li></ol><p>æ€»ä¹‹ï¼Œ<code>__cxa_guard_acquire</code>è¦ä¹ˆè¿”å›<code>0</code>è¦ä¹ˆè¿”å›<code>1</code>ï¼Œç”¨æ¥æŒ‡ç¤º<code>s_instance</code>å·²åˆå§‹åŒ–æˆ–æœªåˆå§‹åŒ–ã€‚<code>__cxa_guard_acquire</code>å¯èƒ½ä¼šå¯¼è‡´å½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œè¿™å‘ç”Ÿåœ¨<code>s_instance</code>æ­£åœ¨åˆå§‹åŒ–çš„æ—¶å€™ã€‚</p><h2 id="cxa-guard-release"><a href="#cxa-guard-release" class="headerlink" title="__cxa_guard_release"></a>__cxa_guard_release</h2><p>ç”±äº<code>__cxa_guard_acquire</code>å¯èƒ½å¯¼è‡´å½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œå› æ­¤éœ€è¦åœ¨<code>s_instance</code>åˆå§‹åŒ–å®Œæˆåä½¿ç”¨å°†<code>__cxa_guard_release</code>çº¿ç¨‹å”¤é†’ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cxa_guard_release (__guard *g) <span class="keyword">throw</span> ()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// If __atomic_* and futex syscall are supported, don&#x27;t use any global</span></span><br><span class="line">    <span class="comment">// mutex.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1</span></span><br><span class="line">    <span class="keyword">if</span> (__gthread_active_p ())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> *gi = (<span class="type">int</span> *) (<span class="type">void</span> *) g;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> guard_bit = _GLIBCXX_GUARD_BIT;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> waiting_bit = _GLIBCXX_GUARD_WAITING_BIT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2</span></span><br><span class="line">        <span class="type">int</span> old = __atomic_exchange_n (gi, guard_bit, __ATOMIC_ACQ_REL);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3</span></span><br><span class="line">        <span class="keyword">if</span> ((old &amp; waiting_bit) != <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">syscall</span> (SYS_futex, gi, _GLIBCXX_FUTEX_WAKE, INT_MAX);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">set_init_in_progress_flag</span>(g, <span class="number">0</span>);</span><br><span class="line">    _GLIBCXX_GUARD_SET_AND_RELEASE (g);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>æ£€æµ‹æ˜¯å¦ä¸ºå¤šçº¿ç¨‹ç¯å¢ƒ</li><li>ä½¿ç”¨åŸå­æ“ä½œå°†<code>guard</code>å˜é‡ç½®ä¸º<code>guard_bit</code>ï¼ŒåŒæ—¶è·å–<code>guard</code>å˜é‡åŸå§‹å€¼ã€‚</li><li>å¦‚æœ<code>guard</code>å˜é‡åŸå§‹å€¼åŒ…å«<code>waiting_bit</code>ï¼Œè¯´æ˜æœ‰çº¿ç¨‹æŒ‚èµ·ï¼ˆæˆ–å°†è¦è°ƒç”¨<code>futex</code>æ¬²ä½¿çº¿ç¨‹æŒ‚èµ·ï¼‰ï¼Œè°ƒç”¨<code>futex</code>å”¤é†’æŒ‚èµ·çš„è¿›ç¨‹ã€‚</li></ol><h2 id="cxa-guard-abort"><a href="#cxa-guard-abort" class="headerlink" title="__cxa_guard_abort"></a>__cxa_guard_abort</h2><p>ç”±äº<code>s_instance</code>å¯èƒ½åˆå§‹åŒ–å¤±è´¥ï¼ˆæœ¬ä¾‹ä¸­å¹¶æœªä½“ç°ï¼‰ï¼Œå› æ­¤è¿˜æœ‰ä¸€ä¸ª<code>__cxa_guard_abort</code>å‡½æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cxa_guard_abort (__guard *g) <span class="keyword">throw</span> ()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// If __atomic_* and futex syscall are supported, don&#x27;t use any global</span></span><br><span class="line">    <span class="comment">// mutex.</span></span><br><span class="line">    <span class="keyword">if</span> (__gthread_active_p ())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> *gi = (<span class="type">int</span> *) (<span class="type">void</span> *) g;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> waiting_bit = _GLIBCXX_GUARD_WAITING_BIT;</span><br><span class="line">        <span class="type">int</span> old = __atomic_exchange_n (gi, <span class="number">0</span>, __ATOMIC_ACQ_REL);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((old &amp; waiting_bit) != <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">syscall</span> (SYS_futex, gi, _GLIBCXX_FUTEX_WAKE, INT_MAX);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">set_init_in_progress_flag</span>(g, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸<code>__cxa_guard_release</code>åŸºæœ¬ä¸€è‡´ï¼Œä¸åŒçš„åœ°æ–¹åœ¨äºä¼šå°†<code>guard</code>å˜é‡ç½®<code>0</code>ã€‚</p><h2 id="é€’å½’åˆå§‹åŒ–è°ƒç”¨"><a href="#é€’å½’åˆå§‹åŒ–è°ƒç”¨" class="headerlink" title="é€’å½’åˆå§‹åŒ–è°ƒç”¨"></a>é€’å½’åˆå§‹åŒ–è°ƒç”¨</h2><p>ç”±äºåœ¨C++11æ ‡å‡†ä¸­ï¼Œåˆå§‹åŒ–å¦‚æœå‘ç”Ÿäº†é€’å½’æ˜¯æœªå®šä¹‰è¡Œä¸ºï¼Œæ‰€ä»¥GCC 7.3.0é’ˆå¯¹æ˜¯å¦ä¸º<a class="link"   href="https://so.csdn.net/so/search?q=%E5%A4%9A%E7%BA%BF%E7%A8%8B&spm=1001.2101.3001.7020" >å¤šçº¿ç¨‹<i class="fas fa-external-link-alt"></i></a>ç¯å¢ƒåšäº†ä¸åŒçš„å¤„ç†ã€‚å¦‚æœæ˜¯å¤šçº¿ç¨‹ç¯å¢ƒï¼Œä¸è¿›è¡Œé¢å¤–å¤„ç†ï¼Œä¼šå‘ç”Ÿæ­»é”ï¼›å¦‚æœæ˜¯å•çº¿ç¨‹ç¯å¢ƒï¼Œåˆ™ä¼šæŠ›å¼‚å¸¸ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// acquire() is a helper function used to acquire guard if thread support is</span></span><br><span class="line"><span class="comment">// not compiled in or is compiled in but not enabled at run-time.</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span></span></span><br><span class="line"><span class="function"><span class="title">acquire</span><span class="params">(__guard *g)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Quit if the object is already initialized.</span></span><br><span class="line">    <span class="keyword">if</span> (_GLIBCXX_GUARD_TEST(g))</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">init_in_progress_flag</span>(g))</span><br><span class="line">        <span class="built_in">throw_recursive_init_exception</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">set_init_in_progress_flag</span>(g, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>çœ‹åˆ°äº†GCCå¦‚æ­¤å¤æ‚çš„å®ç°ï¼Œæˆ‘çš„ä¸ªäººæ„Ÿæƒ³æ˜¯è¿˜æ˜¯ä¸è¦è‡ªå·±é€ è½®å­æ¥ä¿è¯å•ä¾‹ç±»çš„çº¿ç¨‹å®‰å…¨äº†ï¼Œæƒ³è¦åšåˆ°å’ŒGCCä¸€æ ·çš„é«˜æ•ˆè¿˜æ˜¯æ¯”è¾ƒéš¾çš„ï¼Œåˆ©ç”¨C++11æ ‡å‡†çš„å¸¦æ¥çš„ä¾¿åˆ©å°±æŒºå¥½ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åŸæ–‡ä½œè€…ï¼šimred</span><br><span class="line">åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/imred/article/details/89069750</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;C++11ä¸­å±€éƒ¨staticå˜é‡çš„çº¿ç¨‹å®‰å…¨é—®é¢˜&lt;/p&gt;</summary>
    
    
    
    <category term="é‡è§C++" scheme="https://blog.musnow.top/categories/%E9%81%87%E8%A7%81C/"/>
    
    
    <category term="C++" scheme="https://blog.musnow.top/tags/C/"/>
    
    <category term="C++11" scheme="https://blog.musnow.top/tags/C-11/"/>
    
  </entry>
  
  <entry>
    <title>ã€Curlã€‘é€šè¿‡curlæ¨¡æ‹Ÿrefererè·å–åˆ°æœ‰é˜²ç›—é“¾çš„å›¾ç‰‡</title>
    <link href="https://blog.musnow.top/2023/02/20/tools/15curl%E6%A8%A1%E6%8B%9Freferer%E8%8E%B7%E5%8F%96%E8%B5%84%E6%BA%90/"/>
    <id>https://blog.musnow.top/2023/02/20/tools/15curl%E6%A8%A1%E6%8B%9Freferer%E8%8E%B7%E5%8F%96%E8%B5%84%E6%BA%90/</id>
    <published>2023-02-20T04:20:31.000Z</published>
    <updated>2023-02-20T04:54:15.895Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡æ‰€æè¿°æ“ä½œä»…ä¾›å­¦ä¹ curlå‘½ä»¤ï¼Œè¯·å‹¿ç”¨äºç›—åˆ·ä»–äººå›¾åºŠç­‰è¿è§„æ“ä½œï¼ğŸ™…â€â™€ï¸</p><span id="more"></span><h1 id="1-è¯´æ˜"><a href="#1-è¯´æ˜" class="headerlink" title="1.è¯´æ˜"></a>1.è¯´æ˜</h1><p>å½“æˆ‘æƒ³æŠŠ51laæ·»åŠ åˆ°æˆ‘çš„å¯¼èˆªç«™ç‚¹ï¼Œå´å‘ç°å®ƒçš„iconå›¾æ ‡æœ‰é˜²ç›—é“¾ï¼Œç¦æ­¢ç©ºrefererè®¿é—®çš„ï¼›</p><p>è¿™ç‚¹å®Œå…¨å¯ä»¥ç†è§£ï¼Œä¸ºäº†é˜²æ­¢ä»–äººç›—åˆ·æœ¬ç«™çš„å›¾ç‰‡ï¼Œé€šå¸¸æˆ‘ä»¬éƒ½éœ€è¦ç»™å›¾ç‰‡åœ°å€åŠ ä¸Šé˜²ç›—é“¾ã€‚</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f2fa1399fff.png"                      alt="image-20230220124149093"                ></p><p>å…¶å®51laæä¾›äº†è‡ªå·±çš„iconï¼Œä½†è¿™é‡Œæä¾›çš„iconåƒç´ ç‰¹åˆ«ä½ï¼Œåªæœ‰16*16ï¼Œåœ¨æˆ‘çš„å¯¼èˆªç«™ç‚¹ä¸Šçš„æ˜¾ç¤ºå°±æ²¡æœ‰é‚£ä¹ˆå‹å¥½äº†</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f2fb32ccc10.png"                      alt="image-20230220124643681"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f2fb5f7cf73.png"                      alt="image-20230220124728488"                ></p><p>æ‰€ä»¥æˆ‘æ‰æƒ³æŠŠç¨å¾®æ¸…æ™°ä¸€ç‚¹çš„iconå›¾æ ‡ä¸‹è½½ä¸‹æ¥</p><h1 id="2-curlä½¿ç”¨"><a href="#2-curlä½¿ç”¨" class="headerlink" title="2.curlä½¿ç”¨"></a>2.curlä½¿ç”¨</h1><blockquote><p>å‚è€ƒ <a class="link"   href="https://www.ruanyifeng.com/blog/2019/09/curl-reference.html" >https://www.ruanyifeng.com/blog/2019/09/curl-reference.html<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>è¦é¿å¼€è¿™ä¸ª403è®¿é—®ï¼Œéœ€è¦åšçš„å°±æ˜¯ç»™è¯·æ±‚å¤´ç»™å®šä¸€ä¸ªrefererå­—æ®µï¼Œå‘Šè¯‰51laçš„æœåŠ¡å™¨ï¼Œæˆ‘æ˜¯é€šè¿‡ä»–è‡ªå·±çš„åŸŸåè®¿é—®å›¾æ ‡æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl \</span><br><span class="line">-H &#x27;Referer: https://v6.51.la/&#x27; \</span><br><span class="line">https://v6-static.51.la/v6-static/202302161047/favicon.ico \</span><br><span class="line">-o favicon.ico</span><br></pre></td></tr></table></figure><p>å¯¹ä¸Šé¢æåˆ°çš„å‡ ä¸ªå‚æ•°åšä¸€å®šè§£é‡Š</p><ul><li>-Hè®¾å®šè¯·æ±‚å¤´ï¼Œéœ€è¦ç¬¦å·httpåè®®çš„æ ‡å‡†<code>key: value</code></li><li>-oå°†è·å–åˆ°çš„å†…å®¹ä¿å­˜ä¸ºæ–‡ä»¶ï¼Œåœ¨åé¢æŒ‡å®šæ–‡ä»¶åï¼ˆè¿™é‡Œæˆ‘æŒ‡å®šä¸ºäº†<code>favicon.ico</code>ï¼‰</li></ul><p>åœ¨linuxä¸‹ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œå°±èƒ½æˆåŠŸæ‹‰å–åˆ°51laçš„ç«™ç‚¹å›¾ç‰‡</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f2fb9421523.png"                      alt="image-20230220124820822"                ></p><p>å¦‚æœä¸åŠ refererå­—æ®µï¼Œåˆ™è¿˜æ˜¯ä¼šè¿”å›403</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ curl https://v6-static.51.la/v6-static/202302161047/favicon.ico </span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt;&lt;/center&gt;</span><br><span class="line">&lt;hr&gt;&lt;center&gt;openresty&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ¬æ–‡æ‰€æè¿°æ“ä½œä»…ä¾›å­¦ä¹ curlå‘½ä»¤ï¼Œè¯·å‹¿ç”¨äºç›—åˆ·ä»–äººå›¾åºŠç­‰è¿è§„æ“ä½œï¼ğŸ™…â€â™€ï¸&lt;/p&gt;</summary>
    
    
    
    <category term="å·®ç”Ÿæ–‡å…·å¤š" scheme="https://blog.musnow.top/categories/%E5%B7%AE%E7%94%9F%E6%96%87%E5%85%B7%E5%A4%9A/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="curl" scheme="https://blog.musnow.top/tags/curl/"/>
    
  </entry>
  
  <entry>
    <title>ã€C++ã€‘thread|mutex|atomic|condition_variable</title>
    <link href="https://blog.musnow.top/2023/02/19/note_cpp/28C++%E7%BA%BF%E7%A8%8B/"/>
    <id>https://blog.musnow.top/2023/02/19/note_cpp/28C++%E7%BA%BF%E7%A8%8B/</id>
    <published>2023-02-19T15:30:46.000Z</published>
    <updated>2023-02-21T09:23:48.957Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ï¼Œè®©æˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹C++ä¸­çš„çº¿ç¨‹æ“ä½œ</p><span id="more"></span><blockquote><p>æ‰€ç”¨ç¼–è¯‘å™¨ï¼švs2019</p><p>é˜…è¯»æœ¬æ–‡å‰ï¼Œå»ºè®®å…ˆäº†è§£çº¿ç¨‹çš„æ¦‚å¿µ ğŸ‘‰ <a href="https://blog.musnow.top/2022/12/23/note_linux/19%E7%BA%BF%E7%A8%8B%E4%BA%92%E6%96%A5/">çº¿ç¨‹æ¦‚å¿µ</a></p></blockquote><h1 id="1-åŸºæœ¬ä»‹ç»"><a href="#1-åŸºæœ¬ä»‹ç»" class="headerlink" title="1.åŸºæœ¬ä»‹ç»"></a>1.åŸºæœ¬ä»‹ç»</h1><p>åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œwindowsã€linuxã€macä¸Šï¼Œéƒ½ä¼šå¯¹å¤šçº¿ç¨‹æ“ä½œæä¾›è‡ªå·±çš„ç³»ç»Ÿè°ƒç”¨æ¥å£</p><p>ä¸ºä»€ä¹ˆC++éœ€è¦å°è£…ä¸€ä¸ªçº¿ç¨‹ï¼Ÿç›´æ¥ç”¨ç³»ç»Ÿçš„æ¥å£ä¸å¥½å—ï¼Ÿ</p><p>åœ¨<a href="https://blog.musnow.top/2022/11/01/note_linux/14%E6%96%87%E4%BB%B6io/#1-%E4%BB%80%E4%B9%88%E6%98%AF%E6%96%87%E4%BB%B6%EF%BC%9F">Linuxæ–‡ä»¶åšå®¢</a>ä¸­ï¼Œå·²ç»è°ˆè¿‡äº†è¿™ä¸€ç‚¹ï¼šå¯¹äºC++ã€pythonã€javaè¿™äº›<strong>è·¨å¹³å°</strong>çš„è¯­è¨€æ¥è¯´ï¼Œå¦‚æœç›´æ¥ç”¨ç³»ç»Ÿçš„æ¥å£ï¼Œæ˜¯å¯ä»¥å®ç°å¯¹åº”æ“ä½œçš„ã€‚ä½†æ˜¯ï¼Œè¿™æ ·ä¼šå¯¼è‡´ä»£ç <strong>åªèƒ½åœ¨æŸä¸€ä¸ªç‰¹å®šå¹³å°</strong>ï¼Œç”šè‡³æ˜¯æŸä¸€ä¸ªç‰ˆæœ¬çš„ç‰¹å®šæ“ä½œç³»ç»Ÿä¸Šæ‰èƒ½æ­£å¸¸è¿è¡Œï¼Œç›´æ¥ä¸è·¨å¹³å°çš„ç‰¹æ€§ç›¸è¿èƒŒã€‚</p><p>è§£å†³çš„åŠæ³•å‘¢ï¼Œå°±æ˜¯å¯¹ç³»ç»Ÿçš„æ¥å£å¥—ä¸€ä¸ªè¯­è¨€çº§åˆ«çš„è½¯ä»¶å±‚ï¼Œ<strong>å°è£…ç³»ç»Ÿçš„æ¥å£</strong>ã€‚å¹¶ç”¨<code>æ¡ä»¶ç¼–è¯‘</code>çš„æ–¹å¼æ¥è¯†åˆ«ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œå·²è°ƒç”¨ä¸åŒæ“ä½œç³»ç»Ÿçš„ç³»ç»Ÿæ¥å£ï¼Œä»¥å®ç°è·¨å¹³å°æ€§</p><h1 id="2-threadç±»"><a href="#2-threadç±»" class="headerlink" title="2.threadç±»"></a>2.threadç±»</h1><blockquote><p><a class="link"   href="https://legacy.cplusplus.com/reference/thread/thread/thread/" >https://legacy.cplusplus.com/reference/thread/thread/thread/<i class="fas fa-external-link-alt"></i></a></p></blockquote><h2 id="2-1-æ„é€ -x2F-èµ‹å€¼"><a href="#2-1-æ„é€ -x2F-èµ‹å€¼" class="headerlink" title="2.1 æ„é€ &#x2F;èµ‹å€¼"></a>2.1 æ„é€ &#x2F;èµ‹å€¼</h2><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f20f5b7be4e.png"                      alt="image-20230219195214155"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f20f5f8605c.png"                      alt="image-20230219200034593"                ></p><p>çº¿ç¨‹æ˜¯ä¸å…è®¸æ‹·è´æ„é€ å’Œèµ‹å€¼é‡è½½çš„ï¼Œä½†æ˜¯å…¶æ”¯æŒ<strong>å³å€¼å¼•ç”¨</strong>çš„é‡è½½ï¼ˆä¸»è¦æ˜¯ä¸ºäº†åŒ¿åå¯¹è±¡æ„é€ ï¼‰ä¹Ÿæ”¯æŒç©ºæ„é€ </p><blockquote><p>å³å€¼ï¼šæ— æ³•è¿›è¡Œå–åœ°å€çš„å˜é‡</p></blockquote><h2 id="2-2-get-id"><a href="#2-2-get-id" class="headerlink" title="2.2 get_id"></a>2.2 get_id</h2><p>å¯¹äºçº¿ç¨‹è€Œè¨€ï¼Œæ¯”è¾ƒé‡è¦çš„å°±æ˜¯è¿™ä¸ªidå·äº†ï¼Œå…¶ç”¨äºæ ‡è¯†çº¿ç¨‹çš„å”¯ä¸€æ€§</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f22efb3c6f0.png"                      alt="image-20230219221526489"                ></p><h2 id="2-3-join-x2F-detach"><a href="#2-3-join-x2F-detach" class="headerlink" title="2.3 join&#x2F;detach"></a>2.3 join&#x2F;detach</h2><p>åˆ›å»ºå¥½äº†ä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œjoinç­‰å¾…æˆ–è€…detachåˆ†ç¦»</p><ul><li>å¦‚æœä¸»çº¿ç¨‹ä¸éœ€è¦è·å–å­è¿›ç¨‹æ‰§è¡Œçš„ç»“æœï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œdetach</li><li>å¦‚æœéœ€è¦ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œï¼Œåˆ™æ‰§è¡Œjoin</li></ul><p>ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè¿™ä¸¤ä¸ªåˆ†æ­§å‘¢ï¼Ÿæ˜¯å› ä¸ºjoinç­‰å¾…æ˜¯æœ‰ä¸€å®šæ¶ˆè€—çš„ã€‚å¦‚æœæˆ‘ä»¬ä¸å…³å¿ƒçº¿ç¨‹æ‰§è¡Œçš„è¿”å›å€¼ï¼Œåº”è¯¥é‡‡ç”¨detachå°½é‡å‡å°æ¶ˆè€—</p><h2 id="2-4-ä½¿ç”¨ç¤ºä¾‹"><a href="#2-4-ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="2.4 ä½¿ç”¨ç¤ºä¾‹"></a>2.4 ä½¿ç”¨ç¤ºä¾‹</h2><p>ç›¸æ¯”äºLinuxç³»ç»Ÿæä¾›çš„pthreadæ¥å£ï¼ŒC++çš„ä½¿ç”¨æ–¹æ³•æ›´åŠ ç›´æ¥</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; a + b &lt;&lt; endl;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">thread <span class="title">t1</span><span class="params">(Add, <span class="number">10</span>, <span class="number">20</span>)</span></span>;</span><br><span class="line"><span class="function">thread <span class="title">t2</span><span class="params">(Add, <span class="number">10</span>, <span class="number">30</span>)</span></span>;</span><br><span class="line">t1.<span class="built_in">join</span>();</span><br><span class="line">t2.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f220e7cf62b.png"                      alt="image-20230219211523002"                ></p><h2 id="2-5-ç©ºæ„é€ å’Œç§»åŠ¨èµ‹å€¼"><a href="#2-5-ç©ºæ„é€ å’Œç§»åŠ¨èµ‹å€¼" class="headerlink" title="2.5 ç©ºæ„é€ å’Œç§»åŠ¨èµ‹å€¼"></a>2.5 ç©ºæ„é€ å’Œç§»åŠ¨èµ‹å€¼</h2><p>å¦‚æœæˆ‘ä»¬åªæ˜¯å®šä¹‰äº†ä¸€ä¸ªt1ï¼Œæ²¡æœ‰ç›´æ¥è°ƒç”¨æ„é€ å‡½æ•°æŒ‡å®šå…¶è¦è¿è¡Œçš„å‡½æ•°ï¼ˆå…¶å®æ˜¯è°ƒç”¨äº†ç©ºæ„é€ ï¼‰é‚£ä¹ˆè¦æ€ä¹ˆç»™è¿™ä¸ªçº¿ç¨‹æŒ‡å®šå‡½æ•°å‘¢ï¼Ÿ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thread t3;<span class="comment">//è°ƒç”¨äº†ç©ºæ„é€ </span></span><br></pre></td></tr></table></figure><p>åˆ«å¿˜äº†ï¼Œè™½ç„¶çº¿ç¨‹ä¸æ”¯æŒæ‹·è´æ„é€ ï¼Œä½†ä»–æœ‰ç§»åŠ¨èµ‹å€¼ï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thread&amp; <span class="keyword">operator</span>= (thread&amp;&amp; rhs) <span class="keyword">noexcept</span>;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦åšçš„ï¼Œå°±æ˜¯é‡‡ç”¨åŒ¿åå¯¹è±¡çš„æ–¹å¼ï¼Œèµ‹å€¼ç»™t3</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">thread t3;</span><br><span class="line">t3 = <span class="built_in">thread</span>(Add, <span class="number">20</span>, <span class="number">30</span>);</span><br><span class="line">t3.<span class="built_in">join</span>();</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f22a162f785.png"                      alt="image-20230219215433403"                ></p><h2 id="2-6-joinable"><a href="#2-6-joinable" class="headerlink" title="2.6 joinable"></a>2.6 joinable</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">joinable</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span></span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯æ ‡è¯†ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦è¿˜èƒ½è¿›è¡Œjoinï¼›ä¸‹é¢å‡ ç§æƒ…å†µï¼Œçº¿ç¨‹ä¸èƒ½è¢«join</p><ul><li>åªè°ƒç”¨äº†ç©ºæ„é€ ï¼ˆéƒ½æ²¡æœ‰æŒ‡å®šéœ€è¦è¿è¡Œçš„å‡½æ•°æ€ä¹ˆjoinç­‰å¾…ï¼Ÿï¼‰</li><li>è¢«moveäº†ï¼ˆmoveä¼šå°†å¯¹è±¡å˜æˆå°†äº¡å€¼ï¼Œä¹Ÿå°±æ˜¯å³å€¼ï¼‰</li><li>è¯¥å¯¹è±¡å·²ç»è°ƒç”¨è¿‡joinæˆ–è€…detach</li></ul><p>å¦‚æœæ˜¯åœ¨å¤šå±‚å‡½æ•°ä¸­è°ƒç”¨çš„çº¿ç¨‹ï¼Œé‚£å¯èƒ½joinä¹‹å‰å°±å¯ä»¥åˆ¤æ–­ä¸€ä¸‹å½“å‰å¯¹è±¡æ˜¯å¦è¿˜èƒ½join</p><h2 id="2-7-swap-x2F-move"><a href="#2-7-swap-x2F-move" class="headerlink" title="2.7 swap&#x2F;move"></a>2.7 swap&#x2F;move</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span> <span class="params">(thread&amp; x)</span> <span class="keyword">noexcept</span></span>;</span><br></pre></td></tr></table></figure><p>è¯¥æˆå‘˜å‡½æ•°çš„ä½œç”¨æ˜¯å°†å¦å¤–ä¸€ä¸ªçº¿ç¨‹åˆ‡æ¢ç»™å½“å‰çº¿ç¨‹</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f23b7a0ba31.png"                      alt="image-20230219230844481"                ></p><p>å…¶æœ¬è´¨å°±æ˜¯ä¸€ä¸ªmoveç§»åŠ¨èµ‹å€¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f23c727a61c.png"                      alt="image-20230219231249899"                ></p><p>è¢«ç§»åŠ¨åçš„çº¿ç¨‹t3ä¸å†<code>joinable</code>ï¼Œä¸ä¼šè¿è¡Œï¼Œä¹Ÿä¸èƒ½è¢«joinæˆ–detach</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f23bc928163.png"                      alt="image-20230219231000662"                ></p><p>å¼ºè¡Œjoinä¼šæŠ¥é”™</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f23bf8def67.png"                      alt="image-20230219231048460"                ></p><h2 id="2-8-linuxä¸‹ç¼–è¯‘"><a href="#2-8-linuxä¸‹ç¼–è¯‘" class="headerlink" title="2.8 linuxä¸‹ç¼–è¯‘"></a>2.8 linuxä¸‹ç¼–è¯‘</h2><p>ç”±äºstdæ˜¯å¯¹ç³»ç»Ÿæ¥å£è¿›è¡Œçš„å°è£…\</p><p>æ‰€ä»¥åœ¨linuxä¸‹ç¼–è¯‘å¸¦c++çº¿ç¨‹åº“çš„ä»£ç æ—¶ï¼Œéœ€è¦å¸¦ä¸Špthreadåº“çš„é€‰é¡¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ test.cpp -o test -std=c++11 -lpthread</span><br></pre></td></tr></table></figure><h1 id="3-std-ref"><a href="#3-std-ref" class="headerlink" title="3.std::ref"></a>3.std::ref</h1><p>è¿™é‡Œæœ‰ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°refï¼Œè¦æƒ³çŸ¥é“å…¶ä½œç”¨ï¼Œæˆ‘ä»¬éœ€è¦å…ˆçœ‹ä¸‹é¢è¿™ä¸ªåœºæ™¯</p><h2 id="3-1-å¼•ç”¨ä¼ å‚"><a href="#3-1-å¼•ç”¨ä¼ å‚" class="headerlink" title="3.1 å¼•ç”¨ä¼ å‚"></a>3.1 å¼•ç”¨ä¼ å‚</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS 1</span></span><br><span class="line"><span class="comment">//#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Print</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span>&amp; a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt;  a++ &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="function">thread <span class="title">t1</span><span class="params">(Print,<span class="number">10</span>, count)</span></span>;</span><br><span class="line"><span class="function">thread <span class="title">t2</span><span class="params">(Print,<span class="number">10</span>, count)</span></span>;</span><br><span class="line">t1.<span class="built_in">join</span>();</span><br><span class="line">t2.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;main: &quot;</span> &lt;&lt; count &lt;&lt; endl;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæˆ‘æƒ³è¾¾åˆ°çš„ç›®æ ‡æ˜¯è®©t1å’Œt2ä¸¤ä¸ªçº¿ç¨‹å¸®æˆ‘ä»¬å¯¹countè¿›è¡Œ++ï¼Œæœ€ç»ˆåœ¨mainé‡Œé¢æ‰“å°ç»“æœï¼›å¯ç¼–è¯‘ä¼šå‘ç°æŠ¥é”™ï¼Œä¸ç»™æˆ‘ä»¬è¿™æ ·å†™</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f1fbf492ae1.png"                      alt="image-20230219183743136"                ></p><p>ç›¸åŒçš„ä»£ç åœ¨linuxä¸‹ä¹Ÿå‡ºç°äº†ç¼–è¯‘é”™è¯¯ï¼Œæ‰€ç”¨g++ç‰ˆæœ¬å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ (GCC) 11.2.1 20220127 (Red Hat 11.2.1-9)</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f1e519b4676.png"                      alt="image-20230219170012180"                ></p><p>ä¸ºäº†ç¡®è®¤å…·ä½“çš„æŠ¥é”™ä½ç½®ï¼Œæˆ‘ä»¬å…ˆæŠŠ<code>int&amp; a</code>çš„å¼•ç”¨å»æ‰ï¼Œå†çœ‹çœ‹æƒ…å†µ</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f19d78e1d62.png"                      alt="image-20230219115434795"                ></p><p>èƒ½çœ‹åˆ°ï¼Œåœ¨æ²¡æœ‰é‡‡ç”¨<strong>å¼•ç”¨ä¼ å‚</strong>çš„æƒ…å†µä¸‹ï¼Œå‡½æ•°ä¸­å¯¹countè¿›è¡Œçš„æ“ä½œå¹¶ä¸ä¼šåé¦ˆåˆ°mainä¸­ï¼Œå› ä¸ºé‡‡ç”¨çš„æ˜¯<strong>ä¼ å€¼</strong>ï¼Œä¼šè¿›è¡Œæ‹·è´ã€‚</p><h2 id="3-2-threadæ„é€ å‡½æ•°"><a href="#3-2-threadæ„é€ å‡½æ•°" class="headerlink" title="3.2 threadæ„é€ å‡½æ•°"></a>3.2 threadæ„é€ å‡½æ•°</h2><p>é‚£ä¸ºä»€ä¹ˆåŠ ä¸Šå¼•ç”¨ä¹‹åï¼Œä¼šæŠ¥é”™å‘¢ï¼Ÿè¿™å°±å’Œthreadçš„æ„é€ å‡½æ•°æœ‰å…³ç³»äº†</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Fn</span>, <span class="keyword">class</span>... Args&gt;</span><br><span class="line"><span class="function"><span class="keyword">explicit</span> <span class="title">thread</span> <span class="params">(Fn&amp;&amp; fn, Args&amp;&amp;... args)</span></span>;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šï¼Œå½“æˆ‘ä»¬æ„é€ ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡çš„æ—¶å€™ï¼Œé‡‡ç”¨çš„æ˜¯<a href="https://blog.musnow.top/2022/09/28/note_cpp/20c++11%E7%89%B9%E6%80%A7/#7-%E5%8F%AF%E5%8F%98%E6%A8%A1%E6%9D%BF%E5%8F%82%E6%95%B0">å¯å˜æ¨¡æ¿å‚æ•°</a>ï¼›åœ¨æˆ‘çš„åšå®¢ä¸­å†™åˆ°è¿‡ï¼Œå¯å˜æ¨¡æ¿å‚æ•°éœ€è¦é‡‡ç”¨<code>é€’å½’</code>æ¥è¿›è¡Œå‚æ•°ç±»å‹çš„æ¨æµ‹ã€‚</p><p>ç”±äºåº•å±‚å®ç°çš„é—®é¢˜ï¼ˆä¹Ÿåªèƒ½æ˜¯è¿™ä¸ªåŸå› äº†ï¼‰åœ¨è¿›è¡Œæ„é€ çš„å®Œç¾è½¬å‘æ—¶ï¼Œæ‰€æœ‰çš„å‚æ•°éƒ½é‡‡ç”¨äº†<code>æ‹·è´</code>è€Œä¸æ˜¯å¼•ç”¨ä¼ å‚ã€‚</p><p>è¿™ä¹Ÿå°±å¯¼è‡´æˆ‘ä»¬æ²¡æœ‰åŠæ³•å°†ä¸€ä¸ªå‚æ•°é€šè¿‡<strong>å¼•ç”¨</strong>ä¼ å…¥çº¿ç¨‹éœ€è¦æ‰§è¡Œçš„å‡½æ•°ï¼</p><blockquote><p>ç”¨æŒ‡é’ˆè‚¯å®šæ˜¯å¯ä»¥çš„ï¼Œå¯C++æå‡ºå¼•ç”¨è¿™ä¸ªä¸œè¥¿ï¼Œå°±æ˜¯ä¸ºäº†é¿å…ä½¿ç”¨æŒ‡é’ˆ</p></blockquote><h2 id="3-3-refå‡ºåœº"><a href="#3-3-refå‡ºåœº" class="headerlink" title="3.3 refå‡ºåœº"></a>3.3 refå‡ºåœº</h2><blockquote><p><a class="link"   href="https://legacy.cplusplus.com/reference/functional/ref/?kw=ref" >https://legacy.cplusplus.com/reference/functional/ref/?kw=ref<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>äºæ˜¯ä¹ï¼Œstdåº“ä¸­å°±æ–°å¢äº†ä¸€ä¸ªåº“å‡½æ•°<code>ref</code>ï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// refçš„ç”¨æ³•</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function">reference_wrapper&lt;T&gt; <span class="title">ref</span> <span class="params">(T&amp; elem)</span> <span class="keyword">noexcept</span></span>;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function">reference_wrapper&lt;T&gt; <span class="title">ref</span> <span class="params">(reference_wrapper&lt;T&gt;&amp; x)</span> <span class="keyword">noexcept</span></span>;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="type">void</span> <span class="title">ref</span> <span class="params">(<span class="type">const</span> T&amp;&amp;)</span> </span>= <span class="keyword">delete</span>;</span><br></pre></td></tr></table></figure><blockquote><p>Constructs an object of the appropriate <a class="link"   href="https://legacy.cplusplus.com/reference_wrapper" >reference_wrapper<i class="fas fa-external-link-alt"></i></a> type to hold a reference to elem.</p><p>If the argument is itself a <a class="link"   href="https://legacy.cplusplus.com/reference_wrapper" >reference_wrapper<i class="fas fa-external-link-alt"></i></a> <em>(2)</em>, it creates a copy of x instead.</p><p>The function calls the proper <a class="link"   href="https://legacy.cplusplus.com/reference_wrapper" >reference_wrapper<i class="fas fa-external-link-alt"></i></a> constructor.</p></blockquote><p>è¿™ä¸ªå‡½æ•°ä¼šæ„é€ ä¸€ä¸ªåˆé€‚çš„<code>reference_wrapper</code>å¯¹è±¡ï¼Œæ¥ç®¡ç†ä¸€ä¸ªå˜é‡çš„<strong>å¼•ç”¨</strong>ã€‚å¦‚æœå‚æ•°æœ¬èº«å°±æ˜¯<code>reference_wrapper</code>ç±»å‹ï¼Œåˆ™ä¼šè°ƒç”¨<code>reference_wrapper</code>çš„æ‹·è´æ„é€ ã€‚</p><p>è€Œrefå‡½æ•°ä¸èƒ½ä¼ é€’å³å€¼ï¼Œå…¶å³å€¼å¼•ç”¨çš„é‡è½½æ˜¯è¢«<code>delete</code>çš„</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f1e6be2fd55.png"                      alt="image-20230219170711744"                ></p><h2 id="3-4-refä½¿ç”¨"><a href="#3-4-refä½¿ç”¨" class="headerlink" title="3.4 refä½¿ç”¨"></a>3.4 refä½¿ç”¨</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">thread <span class="title">t1</span><span class="params">(Print,<span class="number">10</span>, ref(count))</span></span>;</span><br><span class="line"><span class="function">thread <span class="title">t2</span><span class="params">(Print,<span class="number">10</span>, ref(count))</span></span>;</span><br><span class="line">t1.<span class="built_in">join</span>();</span><br><span class="line">t2.<span class="built_in">join</span>();</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨äº†è¯¥åº“å‡½æ•°ä¹‹åï¼Œç¼–è¯‘ä¸å†æŠ¥é”™ï¼Œmainä¸­çš„å€¼ä¹ŸæˆåŠŸè¢«ä¿®æ”¹</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f1e573a7d52.png"                      alt="image-20230219170142211"                ></p><p>é€šè¿‡refä¼ é€’çš„å‚æ•°ï¼Œä¹Ÿä¼šéµå®ˆå‡½æ•°æœ¬èº«çš„å˜é‡è§„åˆ™ã€‚å¦‚æœå‡½æ•°æœ¬èº«æ²¡æœ‰é‡‡ç”¨å¼•ç”¨ä¼ å‚ï¼Œåˆ™è¿˜æ˜¯è°ƒç”¨ä¼ å€¼å‚æ•°ï¼Œä¼šè¿›è¡Œæ‹·è´ï¼›</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f1e703647b4.png"                      alt="image-20230219170821981"                ></p><p>ä¸ºäº†é¿å…åç»­å‡ºç°è¿™ç§é—®é¢˜ï¼Œå¯ä»¥ç»™æ‰€æœ‰å¯¹çº¿ç¨‹çš„å·¦å€¼ä¼ å‚éƒ½å¸¦ä¸ŠrefğŸ˜æ¯”å¦‚ç»™ä¸¤ä¸ªçº¿ç¨‹å‡½æ•°ä¼ å…¥åŒä¸€æŠŠé”çš„æ—¶å€™ï¼Œå°±éœ€è¦é‡‡ç”¨<code>ref</code>è¿›è¡Œå¼•ç”¨ä¼ å‚</p><h1 id="4-æŒ‡ä»¤é‡æ’"><a href="#4-æŒ‡ä»¤é‡æ’" class="headerlink" title="4.æŒ‡ä»¤é‡æ’"></a>4.æŒ‡ä»¤é‡æ’</h1><blockquote><p><a class="link"   href="https://zhuanlan.zhihu.com/p/271701839" >è°ˆè°ˆæŒ‡ä»¤é‡æ’ - çŸ¥ä¹<i class="fas fa-external-link-alt"></i></a></p><p><a class="link"   href="https://developer.aliyun.com/article/1155673#:~:text=%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92%E7%9A%84%E6%96%B9%E5%BC%8F%201%20%E7%BC%96%E8%AF%91%E5%99%A8%E4%BC%98%E5%8C%96%20%E9%87%8D%E6%96%B0%E5%AE%89%E6%8E%92%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F%202,%E6%8C%87%E4%BB%A4%E5%B9%B6%E8%A1%8C%E9%87%8D%E6%8E%92%20%E5%88%A9%E7%94%A8%E6%8C%87%E4%BB%A4%E7%BA%A7%E5%B9%B6%E8%A1%8C%E6%8A%80%E6%9C%AF%E5%B0%86%E5%A4%9A%E4%B8%AA%E6%8C%87%E4%BB%A4%E5%B9%B6%E8%A1%8C%E6%89%A7%E8%A1%8C%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%8C%87%E4%BB%A4%E4%B9%8B%E5%89%8D%E6%B2%A1%E6%9C%89%E6%95%B0%E6%8D%AE%E4%BE%9D%E8%B5%96%EF%BC%8C%E5%A4%84%E7%90%86%E5%99%A8%E5%8F%AF%E4%BB%A5%E6%94%B9%E5%8F%98%E5%AF%B9%E5%BA%94%E6%9C%BA%E5%99%A8%E6%8C%87%E4%BB%A4%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F%203%20%E5%86%85%E5%AD%98%E7%B3%BB%E7%BB%9F%E9%87%8D%E6%8E%92%20%E7%94%B1%E4%BA%8E%E5%A4%84%E7%90%86%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98%E5%92%8C%E8%AF%BB%E5%86%99%E7%BC%93%E5%86%B2%E5%8C%BA%EF%BC%8C%E6%89%80%E4%BB%A5%E5%AE%83%E4%BB%AC%E6%98%AF%E4%B9%B1%E5%BA%8F%E7%9A%84" >é¢è¯•å®˜: æœ‰äº†è§£è¿‡æŒ‡ä»¤é‡æ’å—ï¼Œä»€ä¹ˆæ˜¯happens-before<i class="fas fa-external-link-alt"></i></a></p></blockquote><h2 id="4-1-ä»€ä¹ˆæ˜¯é‡æ’åº"><a href="#4-1-ä»€ä¹ˆæ˜¯é‡æ’åº" class="headerlink" title="4.1 ä»€ä¹ˆæ˜¯é‡æ’åº"></a>4.1 ä»€ä¹ˆæ˜¯é‡æ’åº</h2><p>é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯é‡æ’åºâ“è®¡ç®—æœºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œä¼šå¯¹ç¼–è¯‘å™¨å’Œç¼–è¯‘å™¨åš<code>æŒ‡ä»¤é‡æ’</code>ã€‚</p><p>è¿™ä¹ˆåšä¸ºå•¥å¯ä»¥æé«˜æ€§èƒ½å‘¢â“</p><p>æˆ‘ä»¬çŸ¥é“è®¡ç®—æœºåœ¨æ‰§è¡Œçš„æ—¶å€™éƒ½æ˜¯ä¸€ä¸ªä¸ªæŒ‡ä»¤å»æ‰§è¡Œï¼Œä¸åŒçš„æŒ‡ä»¤å¯èƒ½æ“ä½œçš„ç¡¬ä»¶ä¸ä¸€æ ·ï¼Œåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šäº§ç”Ÿ<code>ä¸­æ–­</code>ã€‚</p><p>æ‰“ä¸ªæ¯”æ–¹ï¼Œä¸¤ä¸ªæŒ‡ä»¤aå’Œbä»–ä»¬æ“ä½œçš„ä¸œè¥¿å„ä¸ç›¸åŒï¼Œå¦‚æœåŠ è½½açš„æ—¶å€™åœé¡¿äº†ï¼Œbå°±åŠ è½½ä¸åˆ°ï¼Œä½†æ˜¯å®é™…ä¸Šå®ƒä»¬äº’è¡¥å½±å“ï¼Œæˆ‘ä¹Ÿå¯ä»¥å…ˆåŠ è½½båœ¨åŠ è½½aï¼Œæ‰€ä»¥<code>æŒ‡ä»¤é‡æ’</code>æ˜¯å‡å°‘åœé¡¿çš„ä¸€ç§æ–¹æ³•ï¼Œè¿™æ ·å¤§å¤§æé«˜äº†æ•ˆç‡ã€‚</p><h3 id="4-1-1-æŒ‡ä»¤é‡æ’çš„æ–¹å¼"><a href="#4-1-1-æŒ‡ä»¤é‡æ’çš„æ–¹å¼" class="headerlink" title="4.1.1 æŒ‡ä»¤é‡æ’çš„æ–¹å¼"></a>4.1.1 æŒ‡ä»¤é‡æ’çš„æ–¹å¼</h3><p>æŒ‡ä»¤é‡æ’ä¸€èˆ¬åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§</p><ul><li><code>ç¼–è¯‘å™¨ä¼˜åŒ–</code> é‡æ–°å®‰æ’è¯­å¥çš„æ‰§è¡Œé¡ºåº</li><li><code>æŒ‡ä»¤å¹¶è¡Œé‡æ’</code> åˆ©ç”¨æŒ‡ä»¤çº§å¹¶è¡ŒæŠ€æœ¯å°†å¤šä¸ªæŒ‡ä»¤å¹¶è¡Œæ‰§è¡Œï¼Œå¦‚æœæŒ‡ä»¤ä¹‹å‰æ²¡æœ‰æ•°æ®ä¾èµ–ï¼Œå¤„ç†å™¨å¯ä»¥æ”¹å˜å¯¹åº”æœºå™¨æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåº</li><li><code>å†…å­˜ç³»ç»Ÿé‡æ’</code> ç”±äºå¤„ç†ä½¿ç”¨ç¼“å­˜å’Œè¯»å†™ç¼“å†²åŒºï¼Œæ‰€ä»¥å®ƒä»¬æ˜¯ä¹±åºçš„</li></ul><p>æŒ‡ä»¤é‡æ’å¯ä»¥ä¿è¯<code>ä¸²è¡Œè¯­ä¹‰</code>ä¸€è‡´ï¼Œä½†æ˜¯æ²¡æœ‰ä¹‰åŠ¡ä¿è¯<code>å¤šçº¿ç¨‹é—´çš„è¯­ä¹‰</code>ä¹Ÿä¸€è‡´**ã€‚æ‰€ä»¥åœ¨å¤šçº¿ç¨‹ä¸‹ï¼ŒæŒ‡ä»¤é‡æ’åºå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜</p><h2 id="4-2-å®é™…åœºæ™¯"><a href="#4-2-å®é™…åœºæ™¯" class="headerlink" title="4.2 å®é™…åœºæ™¯"></a>4.2 å®é™…åœºæ™¯</h2><p>ä»¥æ‡’æ±‰çš„å•ä¾‹æ¨¡å¼ä¸ºä¾‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–å•ä¾‹å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="type">static</span> InfoMgr* <span class="title">GetInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (_sp == <span class="literal">nullptr</span>)<span class="comment">//ç¬¬ä¸€æ¬¡æ£€æµ‹ä¿è¯å•ä¾‹</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">unique_lock&lt;mutex&gt; <span class="title">lock</span><span class="params">(_mtx)</span></span>;</span><br><span class="line">        <span class="keyword">if</span> (_sp == <span class="literal">nullptr</span>)<span class="comment">//ç¬¬äºŒæ¬¡æ£€æµ‹ä¿è¯çº¿ç¨‹å®‰å…¨</span></span><br><span class="line">        &#123;</span><br><span class="line">            _sp = <span class="keyword">new</span> InfoMgr;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _sp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ<code>new</code>ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œæ‰§è¡Œçš„é¡ºåºåº”è¯¥æ˜¯è¿™æ ·çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">operator new</span><br><span class="line">æ„é€ å¯¹è±¡</span><br><span class="line">èµ‹å€¼ç»™_sp</span><br></pre></td></tr></table></figure><p>ä½†ç¼–è¯‘å™¨å¦‚æœè¿›è¡Œäº†æŒ‡ä»¤é‡æ’ï¼Œå¯èƒ½å°±ä¼šå˜æˆè¿™æ ·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">operator new</span><br><span class="line">èµ‹å€¼ç»™_sp</span><br><span class="line">æ„é€ å¯¹è±¡</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°ç¬¬äºŒæ­¥<code>èµ‹å€¼ç»™_sp</code>çš„æ—¶å€™ï¼Œå› ä¸ºæ—¶é—´ç‰‡åˆ°äº†è¢«åˆ‡æ¢èµ°äº†ï¼›å…¶ä»–çº¿ç¨‹æ¥è·å–å•ä¾‹ï¼Œå°±ä¼šå¯¼è‡´<code>_sp</code>å˜é‡æ˜¯ä¸€ä¸ªå·²ç»è¢«èµ‹å€¼äº†ï¼Œä½†æ˜¯å…¶æŒ‡å‘çš„æ˜¯<strong>æ²¡æœ‰åˆå§‹åŒ–çš„ç©ºå¯¹è±¡</strong>ï¼Œè¿™æ˜¯é”™è¯¯çš„ï¼</p><h2 id="4-3-å¯è¡Œçš„è§£å†³åŠæ³•ï¼šå†…å­˜æ …æ "><a href="#4-3-å¯è¡Œçš„è§£å†³åŠæ³•ï¼šå†…å­˜æ …æ " class="headerlink" title="4.3 å¯è¡Œçš„è§£å†³åŠæ³•ï¼šå†…å­˜æ …æ "></a>4.3 å¯è¡Œçš„è§£å†³åŠæ³•ï¼šå†…å­˜æ …æ </h2><p>æ‰€è°“å†…å­˜æ …æ ï¼Œæ˜¯ç³»ç»Ÿæä¾›çš„çš„æ¥å£ï¼Œç”¨äºç¦æ­¢cpuå¯¹æŒ‡ä»¤çš„ä¼˜åŒ–ï¼›</p><blockquote><p><a class="link"   href="https://blog.csdn.net/qq_16498553/article/details/128030833" >https://blog.csdn.net/qq_16498553/article/details/128030833<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>ä½†å†…å­˜æ ˆæ æ˜¯ç³»ç»Ÿæ¥å£ï¼Œæ²¡æœ‰è·¨å¹³å°æ€§ï¼›è¿™é‡Œåªåšäº†è§£ï¼ŒçŸ¥é“æœ‰è¿™ä¸ªé—®é¢˜å³å¯ï¼</p><hr><p>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‹…å¿ƒ<code>4.2</code>ä¸­æåˆ°çš„é—®é¢˜ï¼Œå› ä¸ºæŒ‡ä»¤ä¼˜åŒ–æ˜¯æœ‰ä¸¥æ ¼è§„åˆ™çš„ï¼Œä¸ä¼šå¯¹èµ‹å€¼å’Œæ„é€ è¿™ç±»æŒ‡ä»¤è¿›è¡Œèƒ¡ä¹±ä¼˜åŒ–ï¼ˆå› ä¸ºè¿™æ ·ä¼˜åŒ–å¹¶ä¸ä¼šæœ‰æ•ˆç‡æå‡å•Šï¼‰</p><p>ä½†è¿™ä¹Ÿéœ€è¦çœ‹å…·ä½“å¹³å°çš„åº•å±‚å®ç°äº†ï¼</p><h1 id="5-è·å–çº¿ç¨‹è¿”å›å€¼"><a href="#5-è·å–çº¿ç¨‹è¿”å›å€¼" class="headerlink" title="5.è·å–çº¿ç¨‹è¿”å›å€¼"></a>5.è·å–çº¿ç¨‹è¿”å›å€¼</h1><h2 id="5-1-è¾“å‡ºå‹å‚æ•°"><a href="#5-1-è¾“å‡ºå‹å‚æ•°" class="headerlink" title="5.1 è¾“å‡ºå‹å‚æ•°"></a>5.1 è¾“å‡ºå‹å‚æ•°</h2><p>åœ¨Cè¯­è¨€ä¸­ï¼Œæƒ³è·å–çº¿ç¨‹è¿”å›å€¼ï¼Œéœ€è¦ä½¿ç”¨è¾“å‡ºå‹å‚æ•°ï¼ˆC++å¯ä»¥ç”¨å¼•ç”¨ä¼ å€¼ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b,<span class="type">int</span>&amp; out)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">out = a + b;</span><br><span class="line"><span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line"><span class="function">thread <span class="title">t2</span><span class="params">(Add, <span class="number">10</span>, <span class="number">39</span>, ref(ret))</span></span>;</span><br><span class="line">t2.<span class="built_in">join</span>();</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;main: &quot;</span> &lt;&lt; ret &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f21f423ea1b.png"                      alt="image-20230219210821383"                ></p><h2 id="5-2-lambda"><a href="#5-2-lambda" class="headerlink" title="5.2 lambda"></a>5.2 lambda</h2><p>åœ¨C++ä¸­ï¼Œè¿˜å¯ä»¥ä½¿ç”¨lambdaè¡¨è¾¾å¼ï¼Œæ¥åœ¨<code>main</code>ä¸­è·å–çº¿ç¨‹çš„è¿”å›å€¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line"><span class="function">thread <span class="title">t1</span><span class="params">([&amp;ret]() &#123; ret = Add(<span class="number">10</span>, <span class="number">29</span>); &#125;)</span></span>;</span><br><span class="line">t1.<span class="built_in">join</span>();</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;main: &quot;</span> &lt;&lt; ret &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f219625e81a.png"                      alt="image-20230219204317460"                ></p><h1 id="6-å‡½æ•°é‡è½½é—®é¢˜"><a href="#6-å‡½æ•°é‡è½½é—®é¢˜" class="headerlink" title="6.å‡½æ•°é‡è½½é—®é¢˜"></a>6.å‡½æ•°é‡è½½é—®é¢˜</h1><p>åœ¨æˆ‘æµ‹è¯•çš„æ—¶å€™å‘ç°ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°å…·æœ‰é‡è½½ï¼Œçº¿ç¨‹æ˜¯ä¸æ”¯æŒçš„ï¼›</p><p>å…·ä½“çš„åŸå› å˜›ï¼Œæˆ‘çŒœå’Œçº¿ç¨‹æ„é€ çš„å¯å˜æ¨¡æ¿å‚æ•°æœ‰å…³ç³»ã€‚</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f22aa4c21de.png"                      alt="img"                ></p><p>ç™¾åº¦äº†ä¸€ä¸‹ï¼Œè§£å†³åŠæ³•ï¼Œæ˜¯ç»™ç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ä¸€ä¸ª<strong>å‡½æ•°æŒ‡é’ˆ</strong>æˆ–è€…fuctionalå¯¹è±¡ï¼Œæ‰‹åŠ¨æŒ‡å®šä½¿ç”¨çš„æ˜¯å“ªä¸€ä¸ªå‡½æ•°ã€‚</p><p>å½“ç„¶ï¼Œè¿˜æœ‰ä¸€ä¸ªè§£å†³åŠæ³•ï¼šçº¿ç¨‹è°ƒç”¨çš„å‡½æ•°ä¸è¦æœ‰é‡è½½ğŸ˜‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b,<span class="type">int</span>&amp; out)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">out = a + b;</span><br><span class="line"><span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> tmp = a + b;</span><br><span class="line">cout &lt;&lt; tmp &lt;&lt; endl;;</span><br><span class="line"><span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// ä½¿ç”¨å‡½æ•°æŒ‡é’ˆæŒ‡å®šå¯¹åº”çš„å‡½æ•°</span></span><br><span class="line"><span class="function">thread <span class="title">t2</span><span class="params">(<span class="keyword">static_cast</span>&lt;<span class="type">int</span>(*)(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span>&amp; out)&gt;(Add), <span class="number">10</span>, <span class="number">39</span>, ref(ret))</span></span>;</span><br><span class="line">t2.<span class="built_in">join</span>();</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;main: &quot;</span> &lt;&lt; ret &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f22bfb930fa.png"                      alt="image-20230219220238736"                ></p><h1 id="7-this-thread"><a href="#7-this-thread" class="headerlink" title="7.this_thread"></a>7.this_thread</h1><p>stdåº“ä¸­è¿˜ç”¨å‘½åç©ºé—´å¯¹çº¿ç¨‹çš„ä¸€äº›æ“ä½œè¿›è¡Œäº†å°è£…</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f3137e63079.png"                      alt="image-20230220143023521"                ></p><ul><li>get_id è·å–çº¿ç¨‹idå·ï¼ˆå…¶å®çº¿ç¨‹ç±»é‡Œé¢å·²ç»æœ‰è¿™ä¸ªä¸œä¸œäº†ï¼Œä½†æ˜¯ä¸ºäº†æ–¹ä¾¿å‡½æ•°ä¸­ç›´æ¥è°ƒç”¨ï¼Œåˆå¤šå¼€äº†ä¸€ä¸ªå‡½æ•°ï¼‰</li><li>yield æ”¾å¼ƒè‡ªå·±çš„æ—¶é—´ç‰‡</li><li>sleep_until ä¼‘çœ åˆ°ä¸€ä¸ªæ—¶é—´ç‚¹ï¼ˆæ¯”å¦‚ç¡åˆ°æ˜å¤©æ—©å…«ï¼‰</li><li>sleep_for ä¼‘çœ ä¸€å®šæ—¶é—´ï¼ˆç¡2åˆ†é’Ÿï¼‰</li></ul><p>ä¸‹é¢æ¥å¯¹åé¢ä¸‰ä¸ªå‡½æ•°åšä¸€ç‚¹è§£é‡Šï¼ˆç¬¬ä¸€ä¸ªå°±ä¸è§£é‡Šäº†å“ˆï¼‰</p><h2 id="7-1-yield"><a href="#7-1-yield" class="headerlink" title="7.1 yield"></a>7.1 yield</h2><p>yieldçš„ä½œç”¨æ˜¯è®©å‡ºå½“å‰çº¿ç¨‹çš„æ—¶é—´ç‰‡ï¼›</p><p>æˆ‘ä»¬çŸ¥é“æ¯ä¸€ä¸ªçº¿ç¨‹è¿è¡Œæ—¶éƒ½ä¼šæœ‰ä¸€ä¸ªè‡ªå·±çš„æ—¶é—´ç‰‡ï¼Œæ—¶é—´ç‰‡åˆ°äº†ï¼Œå°±ä¼šè¿›è¡Œçº¿ç¨‹çš„åˆ‡æ¢ï¼›</p><p>ä»¥ä¸‹é¢çš„åœºæ™¯ä¸ºä¾‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">volatile</span> <span class="type">bool</span> ready = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">count1m</span><span class="params">(<span class="type">int</span> id)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// å¦‚æœmainæ²¡æœ‰è®¾ç½®readyä¿¡å·ï¼Œçº¿ç¨‹ä¼šä¸€ç›´è®©å‡ºè‡ªå·±çš„æ—¶é—´ç‰‡ï¼Œä¸ä¼šè¿è¡Œ</span></span><br><span class="line"><span class="keyword">while</span> (!ready) </span><br><span class="line">&#123;            </span><br><span class="line">this_thread::<span class="built_in">yield</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¼€å§‹è¿è¡Œï¼Œ++æ•°æ®</span></span><br><span class="line"><span class="keyword">volatile</span> <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; <span class="number">10000000</span>; i++) </span><br><span class="line">&#123; </span><br><span class="line">; <span class="comment">// å¾ªç¯ä½“å•¥éƒ½ä¸å¹²</span></span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test4</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">thread threads[<span class="number">10</span>];</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;åˆ›å»º10ä¸ªçº¿ç¨‹ è®¡æ•°\n&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) </span><br><span class="line">&#123;</span><br><span class="line">threads[i] = <span class="built_in">thread</span>(count1m, i);</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;åˆ›å»º10ä¸ªçº¿ç¨‹ å®Œæ¯•\n&quot;</span>;</span><br><span class="line">ready = <span class="literal">true</span>;<span class="comment">//è®¾ç½®çŠ¶æ€ï¼Œè®©çº¿ç¨‹å¼€å§‹è¿è¡Œ</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;main set ture: &quot;</span> &lt;&lt; ready &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; th : threads) </span><br><span class="line">&#123;</span><br><span class="line">th.<span class="built_in">join</span>();</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;\nmain join æˆåŠŸ&quot;</span> &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»º10ä¸ªçº¿ç¨‹ è®¡æ•°</span><br><span class="line">åˆ›å»º10ä¸ªçº¿ç¨‹ å®Œæ¯•</span><br><span class="line">main set ture: 1</span><br><span class="line">3746089215</span><br><span class="line">main join æˆåŠŸ</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹è¢«è®¾ç½®äº†taskåï¼Œéƒ½ä¼šå…ˆè¿›å…¥ä¸€ä¸ªwhileå¾ªç¯ï¼Œç­‰å¾…ä¸»çº¿ç¨‹è¿›è¡Œreadyçš„è®¾ç½®</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (!ready) </span><br><span class="line">&#123;            </span><br><span class="line">;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥åœ¨whileå¾ªç¯ä¸­è¿›è¡Œyieldè®©çº¿ç¨‹<strong>è®©å‡ºè‡ªå·±</strong>çš„æ—¶é—´ç‰‡ã€‚å¦åˆ™è¿™ä¸ªçº¿ç¨‹ä¼šä¸€ç›´ç–¯ç‹‚è®¿é—®readyï¼Œå¯¼è‡´cpuå ç”¨æé«˜ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœmainæ²¡æœ‰è®¾ç½®readyä¿¡å·ï¼Œçº¿ç¨‹ä¼šä¸€ç›´è®©å‡ºè‡ªå·±çš„æ—¶é—´ç‰‡ï¼Œä¸ä¼šè¿è¡Œ</span></span><br><span class="line"><span class="keyword">while</span> (!ready) </span><br><span class="line">&#123;            </span><br><span class="line">this_thread::<span class="built_in">yield</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ç§<strong>è½®è¯¢æ£€æµ‹</strong>çš„åœºæ™¯ä¸‹ï¼Œä½¿ç”¨yieldèƒ½é¿å…æŸä¸€ä¸ªçº¿ç¨‹é•¿æ—¶é—´å ç”¨æ‰§è¡Œæµï¼Œè§£å†³äº†å…¶ä»–çº¿ç¨‹çš„é¥¥é¥¿é—®é¢˜ã€‚</p><h2 id="7-2-sleep-until"><a href="#7-2-sleep-until" class="headerlink" title="7.2 sleep_until"></a>7.2 sleep_until</h2><p>ç”¨<a class="link"   href="https://legacy.cplusplus.com/reference/thread/this_thread/sleep_until/" >cplusplus<i class="fas fa-external-link-alt"></i></a>çš„ç¤ºä¾‹ä»£ç æ¥å­¦ä¹ ä½¿ç”¨æ–¹æ³•ï¼Œè¿™é‡Œæ¶‰åŠåˆ°äº†å¤šä¸ªåº“å‡½æ•°ï¼Œè¯¦è§æ³¨é‡Š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span>  <span class="comment">//std::chrono</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span> <span class="comment">//std::put_time</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span>   <span class="comment">//std::time_t, std::tm, std::localtime, std::mktime</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›´æ¥æŠŠmainå½“ä½œä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test5</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">time_t</span> tt = chrono::system_clock::<span class="built_in">to_time_t</span>(chrono::system_clock::<span class="built_in">now</span>()); <span class="comment">// è·å–å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">tm</span>* ptm = <span class="built_in">localtime</span>(&amp;tt); <span class="comment">// è®¾ç½®ä¸€ä¸ªtmç»“æ„ä½“ï¼Œä»å½“å‰æ—¶é—´æˆ³åˆ›å»º</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Current time: &quot;</span> &lt;&lt; <span class="built_in">put_time</span>(ptm, <span class="string">&quot;%X&quot;</span>) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; <span class="comment">// æ‰“å°å½“å‰æ—¶é—´</span></span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Waiting for the next minute to begin...\n&quot;</span>;</span><br><span class="line">(ptm-&gt;tm_min)++; <span class="comment">// è®¾ç½®ptmçš„minä¸ºä¸‹ä¸€åˆ†é’Ÿ</span></span><br><span class="line">ptm-&gt;tm_sec = <span class="number">0</span>; <span class="comment">// ä¸‹ä¸€åˆ†é’Ÿçš„ç¬¬0s</span></span><br><span class="line">this_thread::<span class="built_in">sleep_until</span>(chrono::system_clock::<span class="built_in">from_time_t</span>(<span class="built_in">mktime</span>(ptm))); <span class="comment">// ç­‰å¾…ä¸‹ä¸€åˆ†é’Ÿå¼€å§‹è¿è¡Œ</span></span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="built_in">put_time</span>(ptm, <span class="string">&quot;%X&quot;</span>) &lt;&lt; <span class="string">&quot; reached!\n&quot;</span>; <span class="comment">// å†æ¬¡æ‰“å°å½“å‰æ—¶é—´</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼Œä¼šç­‰åˆ°ä¸‹ä¸€åˆ†é’Ÿçš„ç¬¬0sç»§ç»­æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Current time: 15:13:40</span><br><span class="line">Waiting for the next minute to begin...</span><br><span class="line">15:14:00 reached!</span><br></pre></td></tr></table></figure><h2 id="7-3-sleep-for"><a href="#7-3-sleep-for" class="headerlink" title="7.3 sleep_for"></a>7.3 sleep_for</h2><p>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨å’Œwindowsã€linuxä¸‹éƒ½æœ‰çš„sleepå‡½æ•°ä¸€æ ·ï¼Œæ˜¯ç¡æŒ‡å®šçš„æ—¶é—´</p><p>éœ€è¦ç”¨stdä¸­çš„<code>chrono</code>æ¨¡å—æ¥æŒ‡å®šè¿è¡Œçš„æ—¶é—´ï¼Œæ”¯æŒä»å°æ—¶ä¸€ç›´åˆ°çº³ç§’</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f341a573324.png"                      alt="image-20230220174718938"                ></p><p>ç¤ºä¾‹å¦‚ä¸‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test6</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">time_t</span> now;</span><br><span class="line"><span class="built_in">time</span>(&amp;now);<span class="comment">//è·å–å½“å‰æ—¶é—´æˆ³</span></span><br><span class="line">cout &lt;&lt; now &lt;&lt; endl;</span><br><span class="line">this_thread::<span class="built_in">sleep_for</span>(chrono::<span class="built_in">seconds</span>(<span class="number">30</span>));<span class="comment">//ç¡30s</span></span><br><span class="line"><span class="built_in">time</span>(&amp;now);<span class="comment">//è·å–å½“å‰æ—¶é—´æˆ³</span></span><br><span class="line">cout &lt;&lt; now &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿›ç¨‹ç¡®å®ä¼‘çœ äº†30s</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f31fbf07392.png"                      alt="image-20230220152240203"                ></p><h1 id="8-mutex"><a href="#8-mutex" class="headerlink" title="8.mutex"></a>8.mutex</h1><p>æœ‰äº†çº¿ç¨‹ï¼Œé‚£è‚¯å®šç¦»ä¸å¼€é”ï¼›å…³äºçº¿ç¨‹åŠ é”çš„é—®é¢˜ï¼Œè¯¦è§<a href="https://blog.musnow.top/2022/12/23/note_linux/19%E7%BA%BF%E7%A8%8B%E4%BA%92%E6%96%A5/#4-3-%E7%BA%BF%E7%A8%8B%E5%8A%A0%E9%94%81">æˆ‘çš„linuxåšå®¢</a></p><p>è¿™é‡Œåªå¯¹C++ä¸­é”çš„åªç”¨æ–¹æ³•åšä¸€å®šæ¼”ç¤º</p><h2 id="8-1-æ„é€ "><a href="#8-1-æ„é€ " class="headerlink" title="8.1 æ„é€ "></a>8.1 æ„é€ </h2><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f3482920bbf.png"                      alt="image-20230220181505745"                ></p><p>é”çš„æ„é€ ç›¸å¯¹è¾ƒç®€å•ï¼Œåªæœ‰ä¸€ä¸ªæ— å‚çš„æ„é€ ï¼Œå…¶ä¸æ”¯æŒæ‹·è´æ„é€ ï¼ˆæ¯”å¦‚å‡½æ•°ä¼ å‚ä¸­ï¼Œä¸€ä¸ªé”è¢«æ‹·è´äº†ï¼Œå°±å¤±å»äº†æ„ä¹‰ï¼‰</p><h2 id="8-2-æˆå‘˜å‡½æ•°"><a href="#8-2-æˆå‘˜å‡½æ•°" class="headerlink" title="8.2 æˆå‘˜å‡½æ•°"></a>8.2 æˆå‘˜å‡½æ•°</h2><p>å…¶ä½™æˆå‘˜å°±æ˜¯ä¸€ä¸ªé”çš„åŸºæœ¬æ¥å£ï¼Œå¯¹åº”çš„ä¹Ÿæ˜¯<code>pthread_mutex</code>ä¸­çš„å‡ ä¸ªæ¥å£</p><ul><li>lock åŠ é”ï¼Œä¸èƒ½ç”³è¯·é”åˆ™é˜»å¡ç­‰å¾…</li><li>try_lock æµ‹è¯•æ˜¯å¦èƒ½ç”³è¯·é”ï¼Œä¸èƒ½ç”³è¯·åˆ™return</li><li>unlock è§£é”</li></ul><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f3486d109dd.png"                      alt="image-20230220181614701"                ></p><h2 id="8-3-åœºæ™¯"><a href="#8-3-åœºæ™¯" class="headerlink" title="8.3 åœºæ™¯"></a>8.3 åœºæ™¯</h2><p>æ‰€è°“åŠ é”ï¼Œä¿æŠ¤çš„å°±æ˜¯ä¸´ç•Œèµ„æºï¼›æ¯”å¦‚åœ¨ä¸‹é¢çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œå…¨å±€å˜é‡<code>count1</code>å°±æ˜¯ä¸€ä¸ªä¸´ç•Œèµ„æºï¼Œå…¶èƒ½å¤Ÿè¢«å¤šä¸ªæ‰§è¡Œæµè®¿é—®ã€‚</p><p><font color=Red>æ³¨æ„ï¼š</font>å¦‚æœä½ å±•å¼€äº†stdå‘½åç©ºé—´ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª<code>count</code>å‡½æ•°ï¼Œä¼šå’Œä½ è‡ªå·±å®šä¹‰çš„å…¨å±€<code>count</code>å˜é‡å†²çªã€‚åˆšå¼€å§‹æˆ‘å°±å®šä¹‰äº†countï¼Œå‘ç°æŠ¥é”™å˜é‡ä¸æ˜ç¡®ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> TOP 100</span></span><br><span class="line"><span class="keyword">volatile</span> <span class="type">int</span> count1 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (count1 == TOP)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; : &quot;</span> &lt;&lt; count1++ &lt;&lt; endl;</span><br><span class="line">this_thread::<span class="built_in">sleep_for</span>(chrono::<span class="built_in">milliseconds</span>(<span class="number">10</span>));</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; : &quot;</span> &lt;&lt; count1 &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test7</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">thread threading[<span class="number">10</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">threading[i] = <span class="built_in">thread</span>(func);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">threading[i].<span class="built_in">join</span>();</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;main: &quot;</span> &lt;&lt; count1 &lt;&lt; endl;</span><br><span class="line">this_thread::<span class="built_in">sleep_for</span>(chrono::<span class="built_in">seconds</span>(<span class="number">2</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•çš„æ—¶å€™ï¼Œå°±èƒ½çœ‹åˆ°ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„å†²çªç»“æœã€‚31752çº¿ç¨‹å·²ç»++åˆ°100äº†ï¼Œç»“æœå®ƒåŠªåŠ›çš„ç»“æœè¢«å…¶ä»–ä¸¤ä¸ªçº¿ç¨‹ç›´æ¥å¤å†™ï¼›</p><p>å½“ç„¶ï¼Œè¿™é‡Œä¹Ÿæœ‰å¯èƒ½æ˜¯æ˜¾ç¤ºå™¨ä¹±åºæ‰“å°çš„ç»“æœã€‚è¦çŸ¥é“ï¼Œæ˜¾ç¤ºå™¨ä¹Ÿæ˜¯ä¸€ä¸ªä¸´ç•Œèµ„æº</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f34965d82fb.png"                      alt="image-20230220182023292"                ></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mutex mtx;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (count1 == TOP)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åŠ é”çš„ç²’åº¦è¦ä½</span></span><br><span class="line">mtx.<span class="built_in">lock</span>();</span><br><span class="line">cout &lt;&lt; this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; : &quot;</span> &lt;&lt; count1++ &lt;&lt; endl;</span><br><span class="line">mtx.<span class="built_in">unlock</span>();</span><br><span class="line">this_thread::<span class="built_in">sleep_for</span>(chrono::<span class="built_in">milliseconds</span>(<span class="number">10</span>));</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; : &quot;</span> &lt;&lt; count1 &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»™è®¿é—®countçš„å‡½æ•°æ·»åŠ ä¸Šé”ï¼Œå°±èƒ½é¿å…æ‰ä¸Šé¢å‡ºç°çš„é—®é¢˜</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f34a2934127.png"                      alt="image-20230220182338849"                ></p><h1 id="9-CASåŸå­æ“ä½œ"><a href="#9-CASåŸå­æ“ä½œ" class="headerlink" title="9.CASåŸå­æ“ä½œ"></a>9.CASåŸå­æ“ä½œ</h1><p>åœ¨ç³»ç»Ÿä¸­ï¼Œæä¾›äº†ä¸€äº›æŒ‡ä»¤ï¼Œæ¥å®ç°åŸå­æ“ä½œï¼</p><h2 id="9-1-åŸç†"><a href="#9-1-åŸç†" class="headerlink" title="9.1 åŸç†"></a>9.1 åŸç†</h2><p>Compare And Setï¼ˆæˆ–Compare And Swapï¼‰ï¼Œç®€ç§°CASã€‚å…¶æ˜¯è§£å†³å¤šçº¿ç¨‹<strong>å¹¶è¡Œ</strong>æƒ…å†µä¸‹ä½¿ç”¨é”é€ æˆæ€§èƒ½æŸè€—çš„ä¸€ç§æœºåˆ¶ï¼Œé‡‡ç”¨è¿™ç§<strong>æ— é”çš„åŸå­æ“ä½œ</strong>å¯ä»¥å®ç°çº¿ç¨‹å®‰å…¨ï¼Œé¿å…åŠ é”çš„ç¬¨é‡æ€§ã€‚</p><p>CASæ“ä½œåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°ï¼šå†…å­˜ä½ç½®ï¼ˆVï¼‰ã€é¢„æœŸåŸå€¼ï¼ˆAï¼‰ã€æ–°å€¼(B)</p><p>å…·ä½“æ“ä½œæµç¨‹è¯·çœ‹ä¸‹å›¾ï¼š</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f362c326f23.png"                      alt="image-20230220200715839"                ></p><p>å¦‚æœä¸Šé¢çš„å›¾çœ‹ä¸æ‡‚ï¼Œè¿˜å¯ä»¥çœ‹ä¸‹é¢è¿™ä¸ªå›¾</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f363eb304d7.png"                      alt="image-20230220201332945"                ></p><p>æ–‡å­—æè¿°å¦‚ä¸‹ï¼š</p><ul><li>å¦‚æœå†…å­˜ä½ç½®çš„å€¼ï¼ˆVï¼‰ä¸é¢„æœŸåŸå€¼ï¼ˆAï¼‰ç›¸åŒï¼Œå¤„ç†å™¨ä¼šå°†è¯¥ä½ç½®çš„å€¼<strong>æ›´æ–°</strong>ä¸ºæ–°å€¼ï¼ˆBï¼‰ CAS æ“ä½œæˆåŠŸï¼</li><li>å¦åˆ™ï¼Œå¤„ç†å™¨ä¸åšä»»ä½•æ›´æ”¹ï¼Œåªéœ€è¦å°†<strong>å½“å‰ä½ç½®çš„å€¼è¿›è¡Œè¿”å›</strong>å³å¯</li></ul><p>CASæ˜¯å®ç°<strong>è‡ªæ—‹é”</strong>çš„åŸºç¡€ï¼ŒCAS åˆ©ç”¨CPUæŒ‡ä»¤ä¿è¯äº†æ“ä½œçš„åŸå­æ€§ï¼Œä»¥è¾¾åˆ°é”çš„æ•ˆæœï¼Œå¾ªç¯è¿™ä¸ªæŒ‡ä»¤ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚</p><h2 id="9-2-é—®é¢˜"><a href="#9-2-é—®é¢˜" class="headerlink" title="9.2 é—®é¢˜"></a>9.2 é—®é¢˜</h2><p>CASä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå…¶åœ¨å¦‚ä¸‹åœºæ™¯ä¸‹å¯èƒ½ä¼šå‡ºç°é—®é¢˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.æœ‰çº¿ç¨‹aå’Œb</span><br><span class="line">2.æœ‰å…¨å±€å˜é‡ï¼Œåˆå§‹å€¼ä¸º1</span><br><span class="line">3.çº¿ç¨‹aå…ˆæ¥è®¿é—®ï¼Œæ‹¿èµ°äº†åˆå§‹å€¼1</span><br><span class="line">4.å‘ç”Ÿçº¿ç¨‹åˆ‡æ¢ï¼Œçº¿ç¨‹bæ¥è®¿é—®ï¼Œæ‹¿èµ°åˆå§‹å€¼1ï¼Œæ›´æ–°ä¸º2ï¼Œåˆä¿®æ”¹å›1</span><br><span class="line">5.å‘ç”Ÿçº¿ç¨‹åˆ‡æ¢ï¼Œçº¿ç¨‹aç»§ç»­è®¿é—®ï¼Œæ­¤æ—¶å€¼ä¾æ—§æ˜¯1ï¼Œçº¿ç¨‹aä¼šè®¤ä¸ºæ²¡æœ‰é—®é¢˜ï¼Œå†™å…¥</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä¸Šé¢çš„åœºæ™¯ä¸­ï¼Œæœ‰ä¸€ä¸ªçº¿ç¨‹æŠŠå…¨å±€å˜é‡ä¿®æ”¹äº†ä¹‹ååˆæ”¹äº†å›å»ï¼Œè¿™æ—¶å€™å°±æ²¡æœ‰åŠæ³•ä»<strong>å–å€¼</strong>åˆ¤æ–­å˜é‡æ˜¯å¦è¿˜æ˜¯â€œåŸæ¥çš„é‚£ä¸ªâ€äº†</p><blockquote><p>é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œjavaå¹¶å‘åŒ…ä¸­æä¾›äº†ä¸€ä¸ªå¸¦æœ‰æ ‡è®°çš„åŸå­å¼•ç”¨ç±»â€AtomicStampedReferenceâ€ï¼Œå®ƒå¯ä»¥é€šè¿‡æ§åˆ¶å˜é‡å€¼çš„ç‰ˆæœ¬æ¥ä¿è¯CASçš„æ­£ç¡®æ€§ã€‚</p></blockquote><p>C&#x2F;C++ä¸­æœ‰æ²¡æœ‰åŠæ³•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæˆ‘æ²¡ç™¾åº¦åˆ°ğŸ˜‚</p><h1 id="10-lock-guard"><a href="#10-lock-guard" class="headerlink" title="10.lock_guard"></a>10.lock_guard</h1><p>äººå¦‚å…¶åï¼Œè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªå®ˆæŠ¤é”ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Mutex</span>&gt; <span class="keyword">class</span> <span class="title class_">lock_guard</span>;</span><br></pre></td></tr></table></figure><p>å…¶è¿ç”¨äº†RAIIçš„æ€è·¯ï¼Œèƒ½åœ¨æ„é€ çš„æ—¶å€™åŠ é”ï¼Œææ„çš„æ—¶å€™è§£é”ã€‚æˆ‘ä»¬å°±ä¸éœ€è¦è‡ªå·±æ“ä½œäº†ã€‚</p><p>æ¯•ç«Ÿï¼Œä»£ç ä¸€é•¿èµ·æ¥ï¼Œä¸€ä¸ªé”æœ‰æ²¡æœ‰è¢«è§£å¼€ï¼Œæ˜¯çœŸçš„æä¸æ¸…æ¥šğŸ˜¥</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">mutex mtx;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test7</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> n = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> m = <span class="number">1000000</span>;</span><br><span class="line">cin &gt;&gt; n;</span><br><span class="line"><span class="function">vector&lt;thread&gt; <span class="title">threading</span><span class="params">(n)</span></span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">&#123;</span><br><span class="line">threading[i] = <span class="built_in">thread</span>([&amp;]() &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">&#123;</span><br><span class="line">lock_guard&lt;mutex&gt; <span class="built_in">t</span>(mtx);<span class="comment">//è‡ªåŠ¨åŠ é”è§£é”</span></span><br><span class="line">x++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">&#123;</span><br><span class="line">threading[i].<span class="built_in">join</span>();</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;main: &quot;</span> &lt;&lt; x &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f366f3c1b90.png"                      alt="image-20230220202628663"                ></p><p>å¦‚æœforå¾ªç¯ä¸­éœ€è¦æ‰§è¡Œçš„ä»£ç å¾ˆå¤šï¼Œè€Œåªæœ‰xæ˜¯ä¸´ç•Œèµ„æºçš„è¯ï¼Œé‚£å°±éœ€è¦æˆ‘ä»¬<code>æ‰‹åŠ¨æ§åˆ¶</code>ä¸€ä¸‹ä½œç”¨åŸŸ<code>&#123;&#125;</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">&#123;</span><br><span class="line">             <span class="comment">//å…¶ä»–ä»£ç </span></span><br><span class="line">             &#123;</span><br><span class="line">                 <span class="function">lock_guard&lt;mutex&gt; <span class="title">t</span><span class="params">(mtx)</span></span>;<span class="comment">//è‡ªåŠ¨åŠ é”è§£é”</span></span><br><span class="line">   x++;</span><br><span class="line">             &#125;</span><br><span class="line">             <span class="comment">//å…¶ä»–ä»£ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="11-unique-lock"><a href="#11-unique-lock" class="headerlink" title="11.unique_lock"></a>11.unique_lock</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Mutex</span>&gt; <span class="keyword">class</span> <span class="title class_">unique_lock</span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ å­¦ä¹ è¿‡æ™ºèƒ½æŒ‡é’ˆï¼Œé‚£è‚¯å®šå°±çŸ¥é“è¿™ä¸ªå‘½åçš„å«ä¹‰ï¼›</p><p><code>unique_lock</code>æ˜¯<code>lock_graud</code>çš„å¢å¼ºç‰ˆæœ¬ï¼Œå…¶åœ¨æ”¯æŒè‡ªåŠ¨åŠ é”è§£é”çš„å‰æä¸‹ï¼Œè¿˜æ”¯æŒæ‰‹åŠ¨åŠ é”è§£é”ï¼›</p><h2 id="11-1-ä½¿ç”¨ç¤ºä¾‹"><a href="#11-1-ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="11.1 ä½¿ç”¨ç¤ºä¾‹"></a>11.1 ä½¿ç”¨ç¤ºä¾‹</h2><p>ä¸‹é¢å°±æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ä½¿ç”¨åœºæ™¯</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">threading[i] = <span class="built_in">thread</span>([&amp;]() &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">&#123;</span><br><span class="line">unique_lock&lt;mutex&gt; <span class="built_in">t</span>(mtx);<span class="comment">//è‡ªåŠ¨åŠ é”</span></span><br><span class="line">x++;</span><br><span class="line">t.<span class="built_in">unlock</span>(); <span class="comment">//æ‰‹åŠ¨è§£é”</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿå…¶ä»–å·¥ä½œ</span></span><br><span class="line">this_thread::<span class="built_in">sleep_for</span>(chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆéœ€è¦è®¿é—®ä¸´ç•Œèµ„æº</span></span><br><span class="line">t.<span class="built_in">lock</span>();<span class="comment">// æ‰‹åŠ¨è§£é”</span></span><br><span class="line">x++;</span><br><span class="line">&#125;<span class="comment">// å‡ºä½œç”¨åŸŸï¼Œè‡ªåŠ¨è§£é”</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="11-2-try-lock"><a href="#11-2-try-lock" class="headerlink" title="11.2 try_lock"></a>11.2 try_lock</h2><p>é™¤äº†æœ€åŸºç¡€çš„try_lockä¹‹å¤–ï¼Œè¿™ä¸ªç±»è¿˜æ”¯æŒforå’Œuntilï¼Œå’Œ<code>this_thread</code>ä¸­çš„sleepæ˜¯ä¸€æ ·çš„å«ä¹‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">try_lock</span><br><span class="line">Lock mutex if not locked (public member function )</span><br><span class="line"></span><br><span class="line">try_lock_for</span><br><span class="line">Try to lock mutex during time span (public member function )</span><br><span class="line">åŠ é”ä¸€ç›´åˆ°æŒ‡å®šæ—¶é—´è§£é”ï¼ˆåŠ é”åˆ°æ˜å¤©æ—©å…«ï¼‰</span><br><span class="line"></span><br><span class="line">try_lock_until</span><br><span class="line">Try to lock mutex until time point (public member function )</span><br><span class="line">åŠ é”xxæ—¶é—´ï¼ˆåŠ é”100ç§’ï¼Œæ—¶é—´åˆ°äº†è‡ªåŠ¨è§£é”ï¼‰</span><br></pre></td></tr></table></figure><p>æ—¶é—´åˆ°äº†ä¹‹åï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¿›è¡Œè§£é”ã€‚å¦‚æœç”¨æˆ·åœ¨è¿™ä¹‹å‰å·²ç»æ‰‹åŠ¨è§£é”äº†ï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸ä¼šåš</p><h2 id="11-3-release"><a href="#11-3-release" class="headerlink" title="11.3 release"></a>11.3 release</h2><p>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨å°±å¾ˆç‹¬ç‰¹äº†ï¼Œå…¶å°†è‡ªå·±ç®¡ç†çš„é”é‡Šæ”¾æ‰ï¼Œä¸å†ç®¡ç†è¿™ä¸ªé”</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">mutex_type* <span class="title">release</span><span class="params">()</span> <span class="keyword">noexcept</span></span>;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨è¿™ä¸ªå‡½æ•°ä¼šè¿”å›æ‰˜ç®¡äº’æ–¥å¯¹è±¡çš„<strong>æŒ‡é’ˆ</strong>ï¼Œé‡Šæ”¾å…¶æ‰€æœ‰æƒã€‚è°ƒç”¨åï¼Œunique_lockå¯¹è±¡ä¸å†ç®¡ç†ä»»ä½•äº’æ–¥å¯¹è±¡ï¼ˆå³ï¼Œå®ƒå¤„äºä¸ifé»˜è®¤æ„é€ ç›¸åŒçš„çŠ¶æ€ï¼‰ã€‚</p><p> æ³¨æ„ï¼Œæ­¤å‡½æ•°ä¸ä¼š<strong>é”å®šæˆ–è§£é”</strong>è¿”å›çš„äº’æ–¥å¯¹è±¡ã€‚</p><p>è¯´äººè¯å°±æ˜¯ï¼Œä¸éœ€è¦ä½ RALLæ¥ç®¡ç†è¿™ä¸ªé”äº†ï¼Œäº¤ç»™ç”¨æˆ·è‡ªå·±ç®¡ç†ï¼</p><h1 id="12-share-ptr"><a href="#12-share-ptr" class="headerlink" title="12.share_ptr"></a>12.share_ptr</h1><blockquote><p><code>share_ptr</code>çš„å®Œæ•´ä»£ç è¯·çœ‹æˆ‘çš„ <a class="link"   href="https://gitee.com/musnow/learn_cpp_code/tree/master/Cpp/23-02-19%20thread" >Gitee<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>åœ¨æ™ºèƒ½æŒ‡é’ˆä¸­ï¼Œ<code>share_ptr</code>é‡‡ç”¨å¼•ç”¨è®¡æ•°æ¥åˆ¤æ–­æœ‰å¤šå°‘æ¬¡æ‹·è´ï¼ˆæ‹·è´æ„é€ ã€èµ‹å€¼é‡è½½ï¼‰ï¼Œåªæœ‰æ‹·è´è®¡æ•°å™¨ä¸º1çš„æ—¶å€™ï¼Œææ„æ‰éœ€è¦é‡Šæ”¾èµ„æºã€‚</p><p>åœ¨<code>share_ptr</code>å†…éƒ¨æœ‰ä¸€ä¸ªå˜é‡è¿›è¡Œè®¡æ•°ã€‚æ—¢ç„¶æœ‰ä¸€ä¸ªè®¡æ•°å˜é‡ï¼Œé‚£å°±éœ€è¦ä¿è¯å¤šçº¿ç¨‹æ‰§è¡Œæ—¶çš„åŸå­æ€§ï¼</p><h2 id="12-1-å¼•ç”¨è®¡æ•°åŠ é”"><a href="#12-1-å¼•ç”¨è®¡æ•°åŠ é”" class="headerlink" title="12.1 å¼•ç”¨è®¡æ•°åŠ é”"></a>12.1 å¼•ç”¨è®¡æ•°åŠ é”</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">AddRef</span><span class="params">()</span><span class="comment">//æ–°å¢å¼•ç”¨</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">_pMutex-&gt;<span class="built_in">lock</span>();</span><br><span class="line"></span><br><span class="line">++(*_pRefCount);</span><br><span class="line"></span><br><span class="line">_pMutex-&gt;<span class="built_in">unlock</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="12-2-é‡Šæ”¾"><a href="#12-2-é‡Šæ”¾" class="headerlink" title="12.2 é‡Šæ”¾"></a>12.2 é‡Šæ”¾</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Release</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">bool</span> flag = <span class="literal">false</span>;<span class="comment">//åˆ¤æ–­é”æ˜¯å¦éœ€è¦è¢«é‡Šæ”¾</span></span><br><span class="line"></span><br><span class="line">_pMutex-&gt;<span class="built_in">lock</span>();</span><br><span class="line"><span class="keyword">if</span> (--(*_pRefCount) == <span class="number">0</span> &amp;&amp; _ptr)</span><br><span class="line">&#123;</span><br><span class="line">               <span class="comment">//è¿›å…¥äº†è¿™ä¸ªå‡½æ•°ï¼Œä»£è¡¨å¼•ç”¨è®¡æ•°ä¸º0</span></span><br><span class="line"><span class="keyword">delete</span> _ptr;</span><br><span class="line"><span class="keyword">delete</span> _pRefCount;</span><br><span class="line"><span class="comment">//æ ‡è¯†éœ€è¦é‡Šæ”¾é”</span></span><br><span class="line">flag = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">_pMutex-&gt;<span class="built_in">unlock</span>();<span class="comment">//è§£é”</span></span><br><span class="line"><span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line"><span class="keyword">if</span> (flag)&#123;</span><br><span class="line"><span class="keyword">delete</span> _pMutex;</span><br><span class="line">           &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="12-3-æ³¨æ„äº‹é¡¹"><a href="#12-3-æ³¨æ„äº‹é¡¹" class="headerlink" title="12.3 æ³¨æ„äº‹é¡¹"></a>12.3 æ³¨æ„äº‹é¡¹</h2><p><code>share_ptr</code>çš„åŠ é”åªé™äºè¿™ä¸ªç±»å¯¹è±¡æœ¬èº«çš„å®‰å…¨æ€§ï¼Œè¿™ä¸ªé”å¹¶<strong>ä¸æ˜¯</strong>ç”¨æ¥ä¿æŠ¤<code>share_ptr</code>æ‰€æŒ‡å‘çš„èµ„æºçš„ï¼</p><h1 id="13-atomic"><a href="#13-atomic" class="headerlink" title="13.atomic"></a>13.atomic</h1><p>åœ¨å…¨å±€å˜é‡ä¸­ï¼Œè®¡æ•°å™¨æ˜¯å¾ˆå¸¸ç”¨çš„ç±»å‹ã€‚æ‰€ä»¥C++ä¸­è¿˜æä¾›äº†ä¸€ä¸ªå¯ä»¥è¿›è¡ŒåŸå­æ“ä½œçš„ç±»ï¼Œå¯¹è¿™ä¸ªå˜é‡è¿›è¡Œçš„æ“ä½œæ˜¯å…·æœ‰åŸå­æ€§çš„ï¼Œä¸éœ€è¦æˆ‘ä»¬è¿›è¡ŒåŠ é”è§£é”</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="keyword">struct</span> <span class="title class_">atomic</span>;</span><br></pre></td></tr></table></figure><h2 id="13-1-åŸºæœ¬ä½¿ç”¨"><a href="#13-1-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="13.1 åŸºæœ¬ä½¿ç”¨"></a>13.1 åŸºæœ¬ä½¿ç”¨</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">atomic&lt;<span class="type">int</span>&gt; val=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test8</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; val &lt;&lt; endl;</span><br><span class="line">val++;</span><br><span class="line">cout &lt;&lt; val &lt;&lt; endl;</span><br><span class="line">val = <span class="number">20</span>;</span><br><span class="line">cout &lt;&lt; val &lt;&lt; endl;</span><br><span class="line">val--;</span><br><span class="line">cout &lt;&lt; val &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯intç±»å‹ï¼ŒåŸå­å˜é‡å’Œæ™®é€šçš„intå˜é‡çš„ä½¿ç”¨æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f4830c02ad0.png"                      alt="image-20230221163836363"                ></p><p>å¯ä»¥çœ‹åˆ°ï¼Œé‡è½½äº†ä»¥åï¼ŒåŸå­å˜é‡æ”¯æŒ<code>++  --</code>ï¼Œä¹Ÿæ”¯æŒç›´æ¥èµ‹å€¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f48604478a8.png"                      alt="image-20230221165116759"                ></p><p>ä¸è¿‡ï¼Œè¿™äº›æ–¹æ³•æ ‡æ˜äº†ï¼Œåªæœ‰æ•´å½¢å®¶æ—å’ŒæŒ‡é’ˆç±»å‹å¯ä»¥ä½¿ç”¨ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f4862eea490.png"                      alt="image-20230221165159400"                ></p><h2 id="13-2-operator-x3D"><a href="#13-2-operator-x3D" class="headerlink" title="13.2 operator &#x3D;"></a>13.2 operator &#x3D;</h2><p>åŸå­å˜é‡å¯ä»¥ç›´æ¥èµ‹å€¼ï¼Œæ˜¯å› ä¸ºå…¶é‡è½½äº† <code>operator =</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//set value (1)</span></span><br><span class="line">T <span class="keyword">operator</span>= (T val) <span class="keyword">noexcept</span>;</span><br><span class="line">T <span class="keyword">operator</span>= (T val) <span class="keyword">volatile</span> <span class="keyword">noexcept</span>;</span><br><span class="line"><span class="comment">//copy [deleted] (2)</span></span><br><span class="line">atomic&amp; <span class="keyword">operator</span>= (<span class="type">const</span> atomic&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">atomic&amp; <span class="keyword">operator</span>= (<span class="type">const</span> atomic&amp;) <span class="keyword">volatile</span> = <span class="keyword">delete</span>;</span><br></pre></td></tr></table></figure><h2 id="13-3-operator-T-x2F-load"><a href="#13-3-operator-T-x2F-load" class="headerlink" title="13.3 operator T&#x2F;load"></a>13.3 operator T&#x2F;load</h2><p><code>operator T </code>çš„ä½œç”¨ï¼Œæ˜¯æ”¯æŒ<strong>éšå¼ç±»å‹</strong>è½¬æ¢ï¼Œè¿™æ ·åŸå­å˜é‡åœ¨è¿›è¡Œifæ¯”è¾ƒçš„æ—¶å€™ï¼Œä¼šè½¬æ¢æˆé‡è½½åçš„ç±»å‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">operator</span> <span class="title">T</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">volatile</span> <span class="keyword">noexcept</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">operator</span> <span class="title">T</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span></span>;</span><br></pre></td></tr></table></figure><p>åœ¨vs2019é‡Œé¢è·³è½¬æºç ï¼Œèƒ½çœ‹åˆ°é‡è½½åçš„è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œå…¶å®æ˜¯è°ƒç”¨äº†loadæ–¹æ³•</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Ty</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">atomic</span> : _Choose_atomic_base_t&lt;_Ty&gt;&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line"><span class="keyword">operator</span> _Ty() <span class="type">const</span> <span class="keyword">volatile</span> <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="built_in">static_assert</span>(_Deprecate_non_lock_free_volatile&lt;_Ty&gt;, <span class="string">&quot;Never fails&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;<span class="built_in">load</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">operator</span> _Ty() <span class="type">const</span> <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;<span class="built_in">load</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f4844ba3f8a.png"                      alt="image-20230221164356074"                ></p><p>æŸ¥çœ‹cplusplusçš„è§£é‡Šï¼Œloadæ–¹æ³•å°±æ˜¯è¿”å›äº†å…¶å†…éƒ¨æ‰€åŒ…å«çš„å€¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">T <span class="title">load</span> <span class="params">(memory_order sync = memory_order_seq_cst)</span> <span class="type">const</span> <span class="keyword">volatile</span> <span class="keyword">noexcept</span></span>;</span><br><span class="line"><span class="function">T <span class="title">load</span> <span class="params">(memory_order sync = memory_order_seq_cst)</span> <span class="type">const</span> <span class="keyword">noexcept</span></span>;</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f484917ab03.png"                      alt="image-20230221164506017"                ></p><p>è¿™é‡Œè¿˜ç‰¹æ„æ ‡æ³¨äº†ï¼Œloadæ–¹æ³•çš„ä½¿ç”¨æ˜¯åŸå­æ€§çš„</p><h2 id="13-4-exchange"><a href="#13-4-exchange" class="headerlink" title="13.4 exchange"></a>13.4 exchange</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">T <span class="title">exchange</span> <span class="params">(T val, memory_order sync = memory_order_seq_cst)</span> <span class="keyword">volatile</span> <span class="keyword">noexcept</span></span>;</span><br><span class="line"><span class="function">T <span class="title">exchange</span> <span class="params">(T val, memory_order sync = memory_order_seq_cst)</span> <span class="keyword">noexcept</span></span>;</span><br></pre></td></tr></table></figure><p><code>exchange</code>å‡½æ•°çš„ä½œç”¨æ˜¯ä¿®æ”¹åŸå­å˜é‡ç®¡ç†çš„å€¼ï¼Œå…¶è¿”å›å€¼æ˜¯<strong>ä¿®æ”¹ä¹‹å‰</strong>çš„å˜é‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Return value</span><br><span class="line">The contained value before the call.</span><br><span class="line">T is atomic&#x27;s template parameter (the type of the contained value).</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹é¢çš„ä»£ç ä¸ºä¾‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">atomic&lt;<span class="type">int</span>&gt; val=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test8</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; val &lt;&lt; endl;</span><br><span class="line"><span class="type">int</span> tmp = val.<span class="built_in">exchange</span>(<span class="number">450</span>);</span><br><span class="line">cout &lt;&lt; val &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; tmp &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°tmpæ¥æ”¶åˆ°çš„ç»“æœæ˜¯valçš„åˆå§‹å€¼0ï¼Œvalæœ¬èº«è¢«ä¿®æ”¹ä¸º450</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f48556ad15c.png"                      alt="image-20230221164823139"                ></p><h2 id="13-5-store"><a href="#13-5-store" class="headerlink" title="13.5 store"></a>13.5 store</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">store</span> <span class="params">(T val, memory_order sync = memory_order_seq_cst)</span> <span class="keyword">volatile</span> <span class="keyword">noexcept</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">store</span> <span class="params">(T val, memory_order sync = memory_order_seq_cst)</span> <span class="keyword">noexcept</span></span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ¯”exchangeç®€å•ï¼Œå…¶åªä¿®æ”¹å­˜å‚¨çš„å˜é‡ï¼Œæ²¡æœ‰è¿”å›å€¼</p><hr><p>å…³äºåŸå­å˜é‡çš„ä»‹ç»å°±è¿™ä¹ˆå¤šï¼Œä¸‹é¢æ¥åº·åº·C++ä¸­çš„æ¡ä»¶å˜é‡</p><h1 id="14-condition-variable"><a href="#14-condition-variable" class="headerlink" title="14.condition_variable"></a>14.condition_variable</h1><blockquote><p>æ¡ä»¶å˜é‡çš„æ¦‚å¿µï¼Œå‚è€ƒ <a href="https://blog.musnow.top/2022/12/30/note_linux/20%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5/">linux çº¿ç¨‹åŒæ­¥</a></p></blockquote><h2 id="14-1-æ„é€ å’Œwait"><a href="#14-1-æ„é€ å’Œwait" class="headerlink" title="14.1 æ„é€ å’Œwait"></a>14.1 æ„é€ å’Œwait</h2><p>æ¡ä»¶å˜é‡ï¼Œæ˜¯ç”¨äºçº¿ç¨‹åŒæ­¥æ“ä½œçš„ä¸€ä¸ªæ¥å£ã€‚åœ¨C++ä¸­ï¼Œæ¡ä»¶å˜é‡åªæœ‰ä¸€ä¸ªç©ºæ„é€ </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//default (1)</span></span><br><span class="line"><span class="built_in">condition_variable</span>();</span><br><span class="line"><span class="comment">//copy [deleted] (2)</span></span><br><span class="line"><span class="built_in">condition_variable</span> (<span class="type">const</span> condition_variable&amp;) = <span class="keyword">delete</span>;</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬è¿›è¡Œwaitç­‰å¾…çš„æ—¶å€™ï¼Œéœ€è¦å¾€æ¡ä»¶å˜é‡å†…ä¼ å…¥ä¸€ä¸ªé”ï¼›è¿›å…¥waitå‡½æ•°ï¼Œå¼€å§‹ç­‰å¾…å‰ä¼šå…ˆè§£é”ï¼Œé€€å‡ºå‡½æ•°å‰ä¼šåŠ é”ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//unconditional (1)</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">wait</span> <span class="params">(unique_lock&lt;mutex&gt;&amp; lck)</span></span>;</span><br><span class="line"><span class="comment">//predicate (2)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Predicate</span>&gt;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">wait</span> <span class="params">(unique_lock&lt;mutex&gt;&amp; lck, Predicate pred)</span></span>;</span><br></pre></td></tr></table></figure><p>waitå‡½æ•°é™¤äº†ä¼ å…¥é”ï¼Œè¿˜å¯ä»¥ä¼ å…¥ä¸€ä¸ª<code>Predicate pred</code>å¯æ‰§è¡Œå‡½æ•°ä½“ï¼Œæ¥åˆ¤æ–­æ¡ä»¶å˜é‡æ˜¯å¦æ»¡è¶³ï¼›</p><p>å¦‚æœæŒ‡å®šäº†predï¼Œåˆ™åªæœ‰å½“predè¿”å›falseæ—¶ï¼Œè¯¥å‡½æ•°æ‰ä¼šé˜»å¡ï¼›å¹¶ä¸”åªæœ‰å½“å®ƒå˜ä¸ºtrueæ—¶ï¼Œé€šçŸ¥æ‰èƒ½è§£é™¤é˜»å¡çº¿ç¨‹ï¼ˆè¿™å¯¹äºæ£€æŸ¥<strong>è™šå‡å”¤é†’</strong>ç‰¹åˆ«æœ‰ç”¨ï¼‰</p><ul><li>è™šå‡å”¤é†’ï¼ŒæŒ‡çš„æ˜¯ä¸€äº›ä»£ç é”™è¯¯çš„æƒ…å†µä¸‹ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹åœ¨æ¡ä»¶å°šæœªçœŸæ­£å°±ç»ªçš„æ—¶å€™å°±å”¤é†’äº†è¯¥çº¿ç¨‹</li><li>æ·»åŠ ä¸Šåˆ¤æ–­æ¡ä»¶ï¼Œ<strong>èƒ½åœ¨waitä¸­åˆ¤æ–­æ¡ä»¶æ˜¯å¦å·²ç»çœŸæ­£æ»¡è¶³</strong>ï¼Œä»è€Œé¿å…è™šå‡å”¤é†’</li></ul><p>waitå†…éƒ¨å¯¹predçš„æ£€æµ‹æ˜¯ä¸‹é¢è¿™æ ·</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (!<span class="built_in">pred</span>()) <span class="built_in">wait</span>(lck);</span><br></pre></td></tr></table></figure><p>åªæœ‰predè¿”å›çœŸçš„æ—¶å€™ï¼Œæ‰ä¼šè·³å‡ºwhileå¾ªç¯ï¼Œå”¤é†’çº¿ç¨‹ã€‚</p><p>é™¤äº†æ£€æµ‹è™šå‡å”¤é†’ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨è¯¥æ‰§è¡Œä½“ï¼Œå¯¹ä¸åŒçš„çº¿ç¨‹<strong>æŒ‡å®šä¸åŒçš„å”¤é†’æ¡ä»¶</strong>ï¼</p><h2 id="14-2-å…¶ä»–æ¥å£"><a href="#14-2-å…¶ä»–æ¥å£" class="headerlink" title="14.2 å…¶ä»–æ¥å£"></a>14.2 å…¶ä»–æ¥å£</h2><p>å…¶ä»–æ¥å£çš„ä½¿ç”¨ä¹Ÿå¾ˆç›´æ¥ï¼Œå…¶ä¸­wait_forå’Œuntilå‰é¢å·²ç»ä»‹ç»è¿‡äº†</p><ul><li>waitï¼šåœ¨æ¡ä»¶å˜é‡ä¸­é˜»å¡ç­‰å¾…ï¼Œç­‰å¾…è¢«å”¤é†’</li><li>notify_oneï¼šå”¤é†’åœ¨è¯¥æ¡ä»¶å˜é‡ç­‰å¾…ä¸‹çš„ä¸€ä¸ªçº¿ç¨‹</li><li>notify_allï¼šå”¤é†’åœ¨è¯¥æ¡ä»¶å˜é‡ä¸‹ç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹</li></ul><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f48806d52a4.png"                      alt="image-20230221165951372"                ></p><h2 id="14-3-å®é™…ç”¨ä¾‹"><a href="#14-3-å®é™…ç”¨ä¾‹" class="headerlink" title="14.3 å®é™…ç”¨ä¾‹"></a>14.3 å®é™…ç”¨ä¾‹</h2><p>å½“ä¸‹æˆ‘ä»¬æœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è®©t1å’Œt2çº¿ç¨‹å…±åŒç®¡ç†ä¸€ä¸ªå˜é‡iï¼Œå¯¹å…¶è¿›è¡Œ++ï¼Œå¹¶å®ç°t1æ‰“å°å¥‡æ•°ï¼Œt2æ‰“å°å¶æ•°çš„åŠŸèƒ½ï¼ˆäºŒè€…äº¤é”™æ‰“å°ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test9</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// ç›®æ ‡ï¼št1æ‰“å°å¥‡æ•°ï¼Œt2æ‰“å°å¶æ•°ï¼ŒäºŒè€…äº¤é”™æ‰“å°</span></span><br><span class="line">    <span class="type">bool</span> ready = <span class="literal">true</span>;</span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> n = <span class="number">100</span>;</span><br><span class="line">mutex mtx;</span><br><span class="line">condition_variable cv;</span><br><span class="line"></span><br><span class="line"><span class="comment">// t1æ‰“å°å¥‡æ•°</span></span><br><span class="line"><span class="function">thread <span class="title">t1</span><span class="params">([&amp;]()&#123;</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="keyword">while</span> (i &lt; n)</span></span></span><br><span class="line"><span class="params"><span class="function">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">            unique_lock&lt;mutex&gt; lock(mtx);</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">            cout &lt;&lt; <span class="string">&quot;t1 : &quot;</span> &lt;&lt; this_thread::get_id() &lt;&lt; <span class="string">&quot; : &quot;</span> &lt;&lt; i &lt;&lt; endl;</span></span></span><br><span class="line"><span class="params"><span class="function">            i++;</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// t2æ‰“å°å¶æ•°</span></span><br><span class="line"><span class="function">thread <span class="title">t2</span><span class="params">([&amp;]() &#123;</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="keyword">while</span> (i &lt; n)</span></span></span><br><span class="line"><span class="params"><span class="function">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">unique_lock&lt;mutex&gt; lock(mtx);</span></span></span><br><span class="line"><span class="params"><span class="function">cout &lt;&lt;<span class="string">&quot;t2 : &quot;</span>&lt;&lt;this_thread::get_id() &lt;&lt; <span class="string">&quot; : &quot;</span> &lt;&lt; i &lt;&lt; endl;</span></span></span><br><span class="line"><span class="params"><span class="function">i++;</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;)</span></span>;</span><br><span class="line"></span><br><span class="line">this_thread::<span class="built_in">sleep_for</span>(chrono::<span class="built_in">seconds</span>(<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;t1:&quot;</span> &lt;&lt; t1.<span class="built_in">get_id</span>() &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;t2:&quot;</span> &lt;&lt; t2.<span class="built_in">get_id</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">t1.<span class="built_in">join</span>();</span><br><span class="line">t2.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ä¸‹å·²ç»å®ç°å‡ºäº†äºŒè€…çš„åŸºæœ¬æ“ä½œï¼Œä½†ç›´æ¥è¿è¡Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œt1éƒ½å·²ç»æ‰“å°åˆ°99äº†ï¼Œt2æ‰å¼€å§‹æ‰§è¡Œï¼Œå®Œå…¨ä¸ç¬¦åˆäº¤é”™æ‰“å°çš„éœ€æ±‚</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f487e871e3c.png"                      alt="image-20230221165920681"                ></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">thread <span class="title">t1</span><span class="params">([&amp;]()&#123;</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="keyword">while</span> (i &lt; n)</span></span></span><br><span class="line"><span class="params"><span class="function">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">unique_lock&lt;mutex&gt; lock(mtx);</span></span></span><br><span class="line"><span class="params"><span class="function">cout &lt;&lt; <span class="string">&quot;t1 : &quot;</span> &lt;&lt; this_thread::get_id() &lt;&lt; <span class="string">&quot; : &quot;</span> &lt;&lt; i &lt;&lt; endl;</span></span></span><br><span class="line"><span class="params"><span class="function">i++;</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">this_thread::sleep_for(chrono::microseconds(<span class="number">100</span>));</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;)</span></span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœåœ¨t1çš„whileå¾ªç¯ä¸­åŠ ä¸Šä¸€ä¸ªä¼‘çœ ï¼Œt2çš„å‡½æ•°ä½“ä¿æŒä¸å˜ï¼Œåˆ™ä¼šå‘ç°æ˜¯t2ç›´æ¥åŠ åˆ°äº†99ï¼Œæ‰è®©å¯æ€œå·´å·´çš„t1è®¿é—®äº†ä¸´ç•Œèµ„æºï¼ˆé¥¥é¥¿é—®é¢˜ï¼‰</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f48a571b2b9.png"                      alt="image-20230221170943659"                ></p><p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ¡ä»¶å˜é‡æ¥å®ç°çº¿ç¨‹ç›¸äº’å”¤é†’å’Œäº¤é”™æ‰“å°ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¡ä»¶å˜é‡æµ‹è¯•</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test9</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// ç›®æ ‡ï¼št1æ‰“å°å¥‡æ•°ï¼Œt2æ‰“å°å¶æ•°ï¼ŒäºŒè€…äº¤é”™æ‰“å°</span></span><br><span class="line"><span class="type">bool</span> ready = <span class="literal">true</span>;</span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> n = <span class="number">100</span>;</span><br><span class="line">mutex mtx;</span><br><span class="line">condition_variable cv;</span><br><span class="line"></span><br><span class="line"><span class="comment">// t1æ‰“å°å¥‡æ•°</span></span><br><span class="line"><span class="function">thread <span class="title">t1</span><span class="params">([&amp;]()&#123;</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="keyword">while</span> (i &lt; n)</span></span></span><br><span class="line"><span class="params"><span class="function">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">            unique_lock&lt;mutex&gt; lock(mtx);</span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="comment">//readyä¸ºå‡çš„æ—¶å€™ï¼Œå”¤é†’t1</span></span></span></span><br><span class="line"><span class="params"><span class="function">            cv.wait(lock, [&amp;ready]()&#123;<span class="keyword">return</span> !ready; &#125;);</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">            cout &lt;&lt; <span class="string">&quot;t1 : &quot;</span> &lt;&lt; this_thread::get_id() &lt;&lt; <span class="string">&quot; : &quot;</span> &lt;&lt; i &lt;&lt; endl;</span></span></span><br><span class="line"><span class="params"><span class="function">            i++;</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">            ready = <span class="literal">true</span>;</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">            cv.notify_one();</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// t2æ‰“å°å¶æ•°</span></span><br><span class="line"><span class="function">thread <span class="title">t2</span><span class="params">([&amp;]() &#123;</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="keyword">while</span> (i &lt; n)</span></span></span><br><span class="line"><span class="params"><span class="function">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">unique_lock&lt;mutex&gt; lock(mtx);</span></span></span><br><span class="line"><span class="params"><span class="function">             <span class="comment">//readyä¸ºçœŸçš„æ—¶å€™ï¼Œå”¤é†’t2</span></span></span></span><br><span class="line"><span class="params"><span class="function">cv.wait(lock, [&amp;ready]()&#123;<span class="keyword">return</span> ready; &#125;);</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">cout &lt;&lt;<span class="string">&quot;t2 : &quot;</span>&lt;&lt;this_thread::get_id() &lt;&lt; <span class="string">&quot; : &quot;</span> &lt;&lt; i &lt;&lt; endl;</span></span></span><br><span class="line"><span class="params"><span class="function">i++;</span></span></span><br><span class="line"><span class="params"><span class="function">ready = <span class="literal">false</span>;</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">cv.notify_one();</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;)</span></span>;</span><br><span class="line"></span><br><span class="line">this_thread::<span class="built_in">sleep_for</span>(chrono::<span class="built_in">seconds</span>(<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;t1:&quot;</span> &lt;&lt; t1.<span class="built_in">get_id</span>() &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;t2:&quot;</span> &lt;&lt; t2.<span class="built_in">get_id</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">t1.<span class="built_in">join</span>();</span><br><span class="line">t2.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆåŠŸé€šè¿‡æ¡ä»¶å˜é‡ï¼Œä½¿è¿™ä¸¤ä¸ªçº¿ç¨‹äº¤é”™æ‰“å°å¥‡å¶æ•°ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">t2 : 23208 : 0</span><br><span class="line">t1 : 24896 : 1</span><br><span class="line">t2 : 23208 : 2</span><br><span class="line">t1 : 24896 : 3</span><br><span class="line">t2 : 23208 : 4</span><br><span class="line">t1 : 24896 : 5</span><br><span class="line">t2 : 23208 : 6</span><br><span class="line">t1 : 24896 : 7</span><br><span class="line">t2 : 23208 : 8</span><br><span class="line">t1 : 24896 : 9</span><br><span class="line">t2 : 23208 : 10</span><br><span class="line">t1 : 24896 : 11</span><br><span class="line">//....</span><br><span class="line">t2 : 23208 : 90</span><br><span class="line">t1 : 24896 : 91</span><br><span class="line">t2 : 23208 : 92</span><br><span class="line">t1 : 24896 : 93</span><br><span class="line">t2 : 23208 : 94</span><br><span class="line">t1 : 24896 : 95</span><br><span class="line">t2 : 23208 : 96</span><br><span class="line">t1 : 24896 : 97</span><br><span class="line">t2 : 23208 : 98</span><br><span class="line">t1 : 24896 : 99</span><br><span class="line">t2 : 23208 : 100</span><br></pre></td></tr></table></figure><p>å³ä¾¿åœ¨t1ä¸­é¢å¤–åŠ ä¸Šä¼‘çœ ï¼Œä¹Ÿä¸ä¼šå½±å“è¾“å‡ºç»“æœçš„å‡†ç¡®æ€§ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63f48c6d2f8ff.png"                      alt="image-20230221171837565"                ></p><p>è¿™ä¾¿æ˜¯æ¡ä»¶å˜é‡å¯¹äºçº¿ç¨‹åŒæ­¥æ§åˆ¶çš„ç”¨æ³•</p><h1 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h1><p>åœ¨å­¦ä¹ è¿‡linuxçš„çº¿ç¨‹åŸºç¡€å’Œç³»ç»Ÿæ¥å£åï¼Œç†è§£C++è¿™é‡Œçš„å¤šçº¿ç¨‹æ“ä½œè¿˜ç®—è½»æ¾ï¼</p><p>C++è¯­æ³•å­¦ä¹ çš„æœ€åä¸€å—æ‹¼å›¾ä¹Ÿè¢«è¡¥ä¸Šäº†ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/202211021535708.jpg"                      alt="QQå›¾ç‰‡20220424132540"                ></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ¬ç¯‡åšå®¢ï¼Œè®©æˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹C++ä¸­çš„çº¿ç¨‹æ“ä½œ&lt;/p&gt;</summary>
    
    
    
    <category term="é‡è§C++" scheme="https://blog.musnow.top/categories/%E9%81%87%E8%A7%81C/"/>
    
    
    <category term="C++" scheme="https://blog.musnow.top/tags/C/"/>
    
    <category term="C++11" scheme="https://blog.musnow.top/tags/C-11/"/>
    
  </entry>
  
  <entry>
    <title>ã€Nasã€‘tmmåˆ®å‰Šå™¨æ— æ³•è¿æ¥tmdbçš„è§£å†³åŠæ³•ï¼ˆæ”¹hostï¼‰</title>
    <link href="https://blog.musnow.top/2023/02/15/nas/9tmm%E5%88%AE%E5%89%8A%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/"/>
    <id>https://blog.musnow.top/2023/02/15/nas/9tmm%E5%88%AE%E5%89%8A%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/</id>
    <published>2023-02-15T13:25:57.000Z</published>
    <updated>2023-02-15T13:34:29.469Z</updated>
    
    <content type="html"><![CDATA[<p>tmmåˆ®å‰Šå™¨æ— æ³•è¿æ¥tmdbçš„è§£å†³åŠæ³•ï¼ˆæ”¹hostï¼‰</p><span id="more"></span><p>å¦‚é¢˜ï¼Œæœ€è¿‘å‘ç°è‡ªå·±windowsç”µè„‘ä¸Šçš„tmmåˆæ— æ³•åˆ®å‰Šäº†ï¼Œæ‰“å¼€ç³»ç»Ÿhostç›®ä¸€çœ‹ï¼Œå‘ç°æ–‡ä»¶è¢«æ¸…ç©ºäº†ï¼Œå¾—è‡ªå·±é‡æ–°å†æä¸€é</p><h1 id="1-æ€è·¯"><a href="#1-æ€è·¯" class="headerlink" title="1.æ€è·¯"></a>1.æ€è·¯</h1><p>æ€è·¯å¾ˆç®€å•ï¼Œå°±æ˜¯æˆ‘ä»¬å½“å‰è®¿é—® <code>api.themoviedb.org</code>çš„åŸŸåï¼Œæ²¡æœ‰åŠæ³•æ‰¾åˆ°ä¸€ä¸ªå›½å†…èƒ½æˆåŠŸè®¿é—®çš„ipã€‚æ‰€ä»¥å°±ä¼šæŠ¥é”™ <code>timeout</code></p><p>ä¿®æ”¹hostçš„ä½œç”¨ï¼Œå°±æ˜¯å‘Šè¯‰ç³»ç»Ÿï¼Œè®¿é—®<code>api.themoviedb.org</code>çš„æ—¶å€™ï¼Œå…ˆåœ¨æœ¬åœ°hostsæ–‡ä»¶é‡Œé¢æœ‰çš„è¿™äº›ä¸»æœºè¯•ä¸€è¯•ï¼Œèƒ½æˆåŠŸå°±ä¸éœ€è¦å»ä¸»åŠ¨æ‰¾hostæœåŠ¡å™¨äº†</p><p>æ‰€ä»¥æˆ‘ä»¬åªè¦å°†å›½å†…èƒ½è®¿é—®çš„ipå†™å…¥hostå°±å¯ä»¥äº†</p><h1 id="2-æ‰¾å¯»å¯ç”¨host"><a href="#2-æ‰¾å¯»å¯ç”¨host" class="headerlink" title="2.æ‰¾å¯»å¯ç”¨host"></a>2.æ‰¾å¯»å¯ç”¨host</h1><p>æœ‰äº†ä¸Šé¢çš„æ€è·¯ï¼Œä¸‹é¢è¦åšçš„å°±æ˜¯çœ‹çœ‹é‚£äº›hostå¯ä»¥è®¿é—®</p><p>é€šè¿‡ <a class="link"   href="https://www.itdog.cn/ping/api.themoviedb.org" >ITDOGç½‘ç«™<i class="fas fa-external-link-alt"></i></a>ï¼Œåœ¨çº¿ping <code>api.themoviedb.org</code>ç«™ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°å¤§éƒ¨åˆ†åœ°åŒºçš„è®¿é—®éƒ½æ˜¯è¶…æ—¶çš„</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ecde92b026b.png"                      alt="image-20230215213018481"                ></p><p>æˆ‘ä»¬è¦åšçš„å°±æ˜¯æ‰¾åˆ°æ²¡æœ‰è¶…æ—¶çš„è¿™äº›ipï¼Œè®°å½•ä¸‹æ¥ã€‚ç‰¹åˆ«æ˜¯é¦™æ¸¯å’Œå°æ¹¾çš„</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ecdee791f45.png"                      alt="image-20230215213225991"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ecdef38a4ed.png"                      alt="image-20230215213238033"                ></p><p>è¦æƒ³çŸ¥é“è¿™äº›ipåœ¨ä½ è¿™ä¸ªåœ°æ–¹èƒ½ä¸èƒ½è®¿é—®ï¼Œé‚£å°±é‡‡ç”¨windowså‘½ä»¤è¡Œè¿›è¡Œpingï¼Œèƒ½è·å–åˆ°ä¿¡æ¯å°±æ˜¯okçš„</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ecdf3e94acd.png"                      alt="image-20230215213353171"                ></p><h1 id="3-æ”¹host"><a href="#3-æ”¹host" class="headerlink" title="3.æ”¹host"></a>3.æ”¹host</h1><p>windowsä¸‹çš„æ–‡ä»¶è·¯å¾„æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\drivers\etc\hosts</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æä¾›å¯ç”¨çš„hostï¼Œå»ºè®®é‡‡ç”¨ä¸Šé¢çš„åŠæ³•è‡ªå·±æ‰¾ä¸€ä¸‹ï¼Œå› ä¸ºipæ˜¯ä¼šå˜åŠ¨çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">13.224.161.52 api.themoviedb.org</span><br><span class="line">99.84.192.81 api.themoviedb.org</span><br><span class="line">13.33.33.60 api.themoviedb.org</span><br><span class="line">13.224.167.74 api.themoviedb.org</span><br><span class="line">13.35.166.20 api.themoviedb.org</span><br><span class="line">202.182.98.125 api.themoviedb.org</span><br><span class="line">13.224.205.59 api.themoviedb.org</span><br><span class="line">54.230.184.46 api.themoviedb.org</span><br><span class="line">31.13.67.19 api.themoviedb.org</span><br><span class="line">99.84.224.92 api.themoviedb.org</span><br><span class="line">99.84.224.149 api.themoviedb.org</span><br><span class="line">99.86.149.118 api.themoviedb.org</span><br><span class="line">65.9.83.54 api.themoviedb.org</span><br><span class="line">99.86.149.118 api.themoviedb.org</span><br><span class="line">13.224.163.98 api.themoviedb.org</span><br></pre></td></tr></table></figure><p>æ·»åŠ å®Œæ¯•åï¼Œä»¥ç®¡ç†å‘˜èº«ä»½ä¿å­˜æ–‡ä»¶ï¼ˆå¦åˆ™æƒé™ä¸è¶³æ— æ³•å†™å…¥ï¼‰</p><p>ç°åœ¨åº”è¯¥å°±å¯ä»¥äº†</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;tmmåˆ®å‰Šå™¨æ— æ³•è¿æ¥tmdbçš„è§£å†³åŠæ³•ï¼ˆæ”¹hostï¼‰&lt;/p&gt;</summary>
    
    
    
    <category term="æ£é¼“æŠ˜è…¾nas" scheme="https://blog.musnow.top/categories/%E6%8D%A3%E9%BC%93%E6%8A%98%E8%85%BEnas/"/>
    
    
    <category term="nas" scheme="https://blog.musnow.top/tags/nas/"/>
    
  </entry>
  
  <entry>
    <title>ã€ç½‘ç»œã€‘http(s)åè®® | content-lengthè¯¦è§£</title>
    <link href="https://blog.musnow.top/2023/02/15/note_Linux/35http%E4%B8%ADcontent-length/"/>
    <id>https://blog.musnow.top/2023/02/15/note_Linux/35http%E4%B8%ADcontent-length/</id>
    <published>2023-02-15T04:30:55.000Z</published>
    <updated>2023-02-15T11:28:13.686Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡é€šè¿‡ä¸€ä¸ªçº¿ä¸Šå®ä¾‹ï¼Œè¯¦ç»†ä»‹ç»httpåè®®ä¸­çš„content-lengthå­—æ®µã€‚</p><span id="more"></span><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>httpåè®®æ˜¯äº’è”ç½‘ä¸­æœ€é‡è¦çš„åè®®ä¹‹ä¸€ï¼Œè™½ç„¶çœ‹ä¸Šå»å¾ˆç®€å•ï¼Œä½†æ˜¯å®é™…ä¸­ç»å¸¸é‡åˆ°é—®é¢˜ï¼Œæˆ‘ä»¬å°±å·²ç»é‡åˆ°å¥½å‡ æ¬¡äº†ã€‚æœ‰é•¿è¿æ¥ç›¸å…³çš„ï¼Œæœ‰æŠ¥æ–‡è§£æç›¸å…³çš„ã€‚å¯¹httpåè®®ä¸èƒ½ä¸€çŸ¥åŠè§£ï¼Œå¿…é¡»é€å½»ç†è§£æ‰è¡Œã€‚</p><p>æœ¬æ–‡é€šè¿‡ä¸€ä¸ªçº¿ä¸Šå®ä¾‹ï¼Œè¯¦ç»†ä»‹ç»httpåè®®ä¸­çš„content-lengthå­—æ®µã€‚</p><h1 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h1><p>æˆ‘ä»¬çš„æ‰‹æœºAppåœ¨åšæ›´æ–°æ—¶ä¼šä»æœåŠ¡å™¨ä¸Šä¸‹è½½çš„ä¸€äº›èµ„æºï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸€äº›å°æ–‡ä»¶ï¼Œæ›´æ–°çš„ä»£ç å·®ä¸å¤šæ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://172.16.59.129:8000/update/test.so&quot;</span>);</span><br><span class="line">    <span class="type">HttpURLConnection</span> <span class="variable">conn</span> <span class="operator">=</span> (HttpURLConnection) url.openConnection();</span><br><span class="line">    <span class="keyword">if</span>(conn.getResponseCode() == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">totalLength</span> <span class="operator">=</span> conn.getContentLength();</span><br><span class="line"><span class="type">BufferedInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(conn.getInputStream());</span><br><span class="line"><span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">512</span>];</span><br><span class="line"><span class="type">int</span> <span class="variable">readLength</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>((length=in.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">readLength += length;</span><br><span class="line"><span class="comment">//è¿›åº¦æ¡</span></span><br><span class="line">System.out.println(((<span class="type">float</span>)readLength) /((<span class="type">float</span>)(totalLength)));</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ä¸Šé¢çš„ä»£ç æ›´æ–°ä¸€ä¸ªsoæ–‡ä»¶ï¼Œå…ˆé€šè¿‡content-lengthè·å–æ–‡ä»¶çš„æ€»å¤§å°ï¼Œç„¶åè¯»Streamï¼Œæ¯è¯»ä¸€æ®µï¼Œå°±è®¡ç®—å‡ºå½“å‰è¯»çš„æ€»å¤§å°ï¼Œé™¤ä»¥content-lengthï¼Œç”¨æ¥æ˜¾ç¤ºè¿›åº¦æ¡ã€‚</p><p>ç»“æœweblogicä»10å‡çº§åˆ°12åï¼Œcontent-lengthä¸€ç›´è¿”å›-1ï¼Œè¿™æ ·å°±ä¸èƒ½æ˜¾ç¤ºè¿›åº¦æ¡äº†ï¼Œä½†æ˜¯æ–‡ä»¶æµè¿˜èƒ½æ­£å¸¸è¯»ã€‚æŠŠweblogicé‡å¯äº†ï¼Œä¸€å¼€å§‹è¿˜èƒ½è¿”å›content-lengthï¼Œä¸€ä¼šåˆæ˜¯-1äº†ã€‚</p><h1 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h1><p>Httpåè®®çš„è¯·æ±‚æŠ¥æ–‡å’Œå›å¤æŠ¥æ–‡éƒ½æœ‰headerå’Œbodyï¼Œbodyå°±æ˜¯ä½ è¦è·å–çš„èµ„æºï¼Œä¾‹å¦‚ä¸€ä¸ªhtmlé¡µé¢ï¼Œä¸€ä¸ªjpegå›¾ç‰‡ï¼Œè€Œheaderæ˜¯ç”¨æ¥åšæŸäº›çº¦å®šçš„ã€‚ä¾‹å¦‚å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å•†å®šä¸€äº›ä¼ è¾“æ ¼å¼ï¼Œå®¢æˆ·ç«¯å…ˆè·å–å¤´éƒ¨ï¼Œå¾—çŸ¥ä¸€äº›æ ¼å¼ä¿¡æ¯ï¼Œç„¶åæ‰å¼€å§‹è¯»å–bodyã€‚</p><blockquote><p>å®¢æˆ·ç«¯ï¼š Accept-Encoding:gzip ï¼ˆç»™æˆ‘å‹ç¼©ä¸€ä¸‹ï¼Œæˆ‘ç”¨çš„æ˜¯æµé‡ï¼Œå…ˆä¸‹è½½ä¸‹æ¥æˆ‘å†æ…¢æ…¢è§£å‹å§ï¼‰</p><p>æœåŠ¡ç«¯1ï¼šContent-Encoding:null(æ²¡æœ‰Content-Encodingå¤´ã€‚ æˆ‘ä¸ç»™å‹ç¼©ï¼ŒCPUæ²¡ç©ºï¼Œä½ çˆ±è¦ä¸è¦ï¼‰</p><p>æœåŠ¡ç«¯2ï¼šContent-Encoding:gzip (ç»™ä½ èŠ‚çœæµé‡ï¼Œå‹ç¼©ä¸€ä¸‹ï¼‰</p></blockquote><blockquote><p>å®¢æˆ·ç«¯ï¼šConnection: keep-alive (å¤§å“¥ï¼Œå’±å¥½ä¸å®¹æ˜“å»ºäº†ä¸ªTCPè¿æ¥ï¼Œä¸‹æ¬¡æ¥ç€ç”¨ï¼‰</p><p>æœåŠ¡ç«¯1: Connection: keep-alive ï¼ˆéƒ½ä¸å®¹æ˜“ï¼Œæ¥ç€ç”¨ï¼‰</p><p>æœåŠ¡ç«¯2: Connection: close (è°è·Ÿä½ æ¥ç€ç”¨ï¼Œæˆ‘ä»¬è¿™ä¸ªTCPæ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä¸‹æ¬¡å†æ‰¾æˆ‘è¿˜å¾—é‡æ–°è¿)</p></blockquote><p>httpåè®®æ²¡æœ‰ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¸€èˆ¬å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯è¯·æ±‚èµ„æºæ—¶ï¼Œä»¥æœåŠ¡ç«¯ä¸ºå‡†ã€‚è¿˜æœ‰ä¸€äº›headerå¹¶æ²¡æœ‰åå•†çš„è¿‡ç¨‹ï¼Œè€Œæ˜¯æœåŠ¡ç«¯ç›´æ¥å‘Šè¯‰å®¢æˆ·ç«¯æŒ‰ä»€ä¹ˆæ¥ã€‚ä¾‹å¦‚ä¸Šè¿°çš„Content-Lengthï¼Œæ˜¯æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯bodyçš„å¤§å°æœ‰å¤šå¤§ã€‚ä½†æ˜¯ï¼æœåŠ¡ç«¯å¹¶ä¸ä¸€å®šèƒ½å‡†ç¡®çš„æå‰å‘Šè¯‰ä½ bodyæœ‰å¤šå¤§ã€‚æœåŠ¡ç«¯è¦å…ˆå†™headerï¼Œå†å†™bodyï¼Œå¦‚æœè¦åœ¨headeré‡ŒæŠŠbodyå¤§å°å†™è¿›å»ï¼Œå°±å¾—æå‰çŸ¥é“bodyå¤§å°ã€‚å¦‚æœè¿™ä¸ªbodyæ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼ŒæœåŠ¡ç«¯å…ˆç”Ÿæˆå®Œï¼Œå†å¼€å§‹å†™headerï¼Œè¿™æ ·éœ€è¦å¾ˆå¤šé¢å¤–çš„å¼€é”€ï¼Œæ‰€ä»¥headeré‡Œä¸ä¸€å®šæœ‰content-lengthã€‚</p><p>é‚£å®¢æˆ·ç«¯æ€ä¹ˆçŸ¥é“bodyçš„å¤§å°å‘¢ï¼ŸæœåŠ¡å™¨æœ‰ä¸‰ç§æ–¹å¼å‘Šè¯‰ä½ ã€‚</p><p>1.æœåŠ¡å™¨å·²ç»çŸ¥é“èµ„æºå¤§å°ï¼Œé€šè¿‡content-lengthè¿™ä¸ªheaderå‘Šè¯‰ä½ ã€‚</p><pre><code>Content-Length:1076(bodyçš„å¤§å°æ˜¯1076Bï¼Œä½ è¯»å–1076Bå°±å¯ä»¥å®Œæˆä»»åŠ¡äº†ï¼‰Transfer-Encoding: null</code></pre><p>2.æœåŠ¡å™¨æ²¡æ³•æå‰çŸ¥é“èµ„æºçš„å¤§å°ï¼Œæˆ–è€…ä¸æ„¿æ„èŠ±è´¹èµ„æºæå‰è®¡ç®—èµ„æºå¤§å°ï¼Œå°±ä¼šæŠŠhttpå›å¤æŠ¥æ–‡ä¸­åŠ ä¸€ä¸ªheaderå«Transfer-Encoding:chunkedï¼Œå°±æ˜¯åˆ†å—ä¼ è¾“çš„æ„æ€ã€‚æ¯ä¸€å—éƒ½ä½¿ç”¨å›ºå®šçš„æ ¼å¼ï¼Œå‰è¾¹æ˜¯å—çš„å¤§å°ï¼Œåé¢æ˜¯æ•°æ®ï¼Œç„¶åæœ€åä¸€å—å¤§å°æ˜¯0ã€‚è¿™æ ·å®¢æˆ·ç«¯è§£æçš„æ—¶å€™å°±éœ€è¦æ³¨æ„å»æ‰ä¸€äº›æ— ç”¨çš„å­—æ®µã€‚</p><pre><code>Content-Length:nullTransfer-Encoding:chunked (æ¥ä¸‹æ¥çš„bodyæˆ‘è¦ä¸€å—ä¸€å—çš„ä¼ ï¼Œæ¯ä¸€å—å¼€å§‹æ˜¯è¿™ä¸€å—çš„å¤§å°ï¼Œç­‰æˆ‘ä¼ åˆ°å¤§å°ä¸º0çš„å—æ—¶ï¼Œå°±æ²¡äº†ï¼‰</code></pre><p>3.æœåŠ¡å™¨ä¸çŸ¥é“èµ„æºçš„å¤§å°ï¼ŒåŒæ—¶ä¹Ÿä¸æ”¯æŒchunkedçš„ä¼ è¾“æ¨¡å¼ï¼Œé‚£ä¹ˆå°±æ—¢æ²¡æœ‰content-lengthå¤´ï¼Œä¹Ÿæ²¡æœ‰transfer-encodingå¤´ï¼Œè¿™ç§æƒ…å†µä¸‹å¿…é¡»ä½¿ç”¨çŸ­è¿æ¥ï¼Œä»¥è¿æ¥ç»“æŸæ¥æ ‡ç¤ºæ•°æ®ä¼ è¾“ç»“æŸï¼Œä¼ è¾“ç»“æŸå°±èƒ½çŸ¥é“å¤§å°äº†ã€‚è¿™æ—¶å€™æœåŠ¡å™¨è¿”å›çš„headeré‡ŒConnectionä¸€å®šæ˜¯closeã€‚</p><pre><code>Content-Length:null Transfer-Encoding:null Connection:close(æˆ‘ä¸çŸ¥é“å¤§å°ï¼Œæˆ‘ä¹Ÿç”¨ä¸äº†chunkedï¼Œå•¥æ—¶å€™æˆ‘å…³äº†tcpè¿æ¥ï¼Œå°±è¯´æ˜ä¼ è¾“ç»“æŸäº†ï¼‰</code></pre><h1 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h1><p>æˆ‘é€šè¿‡nginxåœ¨è™šæ‹Ÿæœºé‡Œåšå®éªŒï¼Œé»˜è®¤nginxæ˜¯æ”¯æŒchunkedæ¨¡å¼çš„ï¼Œå¯ä»¥å…³æ‰ã€‚</p><p>ä½¿ç”¨çš„ä»£ç å¦‚ä¸‹ï¼Œå¯èƒ½ä¼šè°ƒæ•´å‚æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://172.16.59.129:8000/update/test.so&quot;</span>);</span><br><span class="line">    <span class="type">HttpURLConnection</span> <span class="variable">conn</span> <span class="operator">=</span> (HttpURLConnection) url.openConnection();</span><br><span class="line">    <span class="comment">//conn.setRequestProperty(&quot;Accept-Encoding&quot;, &quot;gzip&quot;);</span></span><br><span class="line">    <span class="comment">//conn.setRequestProperty(&quot;Connection&quot;, &quot;keep-alive&quot;);</span></span><br><span class="line">    conn.connect();</span><br><span class="line">    <span class="keyword">if</span>(conn.getResponseCode() == <span class="number">200</span>) &#123;</span><br><span class="line">        System.out.println(conn.getHeaderFields().keySet());</span><br><span class="line">        System.out.println(conn.getHeaderField(<span class="string">&quot;transfer-encoding&quot;</span>));</span><br><span class="line">        System.out.println(conn.getHeaderField(<span class="string">&quot;Content-Length&quot;</span>));</span><br><span class="line">        System.out.println(conn.getHeaderField(<span class="string">&quot;Content-Encoding&quot;</span>));</span><br><span class="line">        System.out.println(conn.getHeaderField(<span class="string">&quot;Connection&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1-nginxåœ¨å¼€å¯chunked-transfer-encodingçš„æ—¶å€™"><a href="#1-nginxåœ¨å¼€å¯chunked-transfer-encodingçš„æ—¶å€™" class="headerlink" title="1.nginxåœ¨å¼€å¯chunked_transfer_encodingçš„æ—¶å€™"></a>1.nginxåœ¨å¼€å¯chunked_transfer_encodingçš„æ—¶å€™</h2><p>(1) åœ¨reqeust headeré‡Œä¸ä½¿ç”¨gzipï¼Œä¹Ÿå°±æ˜¯ä¸åŠ <code>accept-encoding: gzip</code></p><table><thead><tr><th>test.soæ–‡ä»¶å¤§å°</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>100B</td><td>èƒ½æ­£å¸¸è¿”å›content-length,æ²¡æœ‰transfer-encodingå¤´</td></tr><tr><td>69M</td><td>èƒ½æ­£å¸¸è¿”å›content-length,æ²¡æœ‰transfer-encodingå¤´</td></tr><tr><td>3072M</td><td>èƒ½æ­£å¸¸è¿”å›content-length,æ²¡æœ‰transfer-encodingå¤´</td></tr></tbody></table><p>å¯ä»¥å‘ç°nginxä¸ç®¡èµ„æºå¤šå¤§ï¼Œå¦‚æœå®¢æˆ·ç«¯ä¸æ¥å—gzipçš„å‹ç¼©æ ¼å¼ï¼Œå°±ä¸ä¼šä½¿ç”¨chunkedæ¨¡å¼ï¼Œè€Œä¸”è·Ÿæ˜¯å¦ä½¿ç”¨çŸ­è¿æ¥æ²¡å…³ç³»ã€‚</p><p>(2)åœ¨request headeré‡ŒåŠ å…¥gzipï¼Œ<code>accepting-encoding: gzip</code></p><table><thead><tr><th>test.soæ–‡ä»¶å¤§å°</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>100B</td><td>æ²¡æœ‰content-length,transfer-encoding&#x3D;trunked</td></tr><tr><td>69M</td><td>æ²¡æœ‰content-length,transfer-encoding&#x3D;trunked</td></tr><tr><td>3072M</td><td>æ²¡æœ‰content-length,transfer-encoding&#x3D;trunked</td></tr></tbody></table><p>å¯ä»¥çœ‹åˆ°nginxåœ¨å¼€å¯<code>chunked_transfer_encoding</code>ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯æ¥å—gzipçš„æ—¶å€™ï¼Œä¼šä½¿ç”¨chunkedæ¨¡å¼ï¼Œnginxå¼€å¯gzipåä¸ä¼šè®¡ç®—èµ„æºçš„å¤§å°ï¼Œç›´æ¥ç”¨chunkedæ¨¡å¼ã€‚</p><h2 id="2-nginxå…³é—­chunked-transfer-encoding"><a href="#2-nginxå…³é—­chunked-transfer-encoding" class="headerlink" title="2.nginxå…³é—­chunked_transfer_encoding"></a>2.nginxå…³é—­chunked_transfer_encoding</h2><p>(1) åœ¨reqeust headeré‡Œä¸ä½¿ç”¨gzipï¼Œä¹Ÿå°±æ˜¯ä¸åŠ <code>accept-encoding:gzip</code></p><table><thead><tr><th>test.soæ–‡ä»¶å¤§å°</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>100B</td><td>èƒ½æ­£å¸¸è¿”å›content-length,æ²¡æœ‰transfer-encodingå¤´</td></tr><tr><td>69M</td><td>èƒ½æ­£å¸¸è¿”å›content-length,æ²¡æœ‰transfer-encodingå¤´</td></tr><tr><td>3072M</td><td>èƒ½æ­£å¸¸è¿”å›content-length,æ²¡æœ‰transfer-encodingå¤´</td></tr></tbody></table><p>å› ä¸ºèƒ½å¾ˆå®¹æ˜“çš„çŸ¥é“æ–‡ä»¶å¤§å°ï¼Œæ‰€ä»¥nginxè¿˜æ˜¯èƒ½è¿”å›content-lengthã€‚</p><p>(2)åœ¨request headeré‡ŒåŠ å…¥gzipï¼Œ<code>accepting-encoding:gzip</code></p><table><thead><tr><th>test.soæ–‡ä»¶å¤§å°</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>100B</td><td>æ²¡æœ‰content-lengthå’Œtransfer-encodingå¤´ï¼Œä¸è®ºå®¢æˆ·ç«¯connectionä¸ºkeep-aliveè¿˜æ˜¯closeï¼ŒæœåŠ¡ç«¯è¿”å›çš„connectionå¤´éƒ½æ˜¯close</td></tr><tr><td>69M</td><td>æ²¡æœ‰content-lengthå’Œtransfer-encodingå¤´ï¼Œä¸è®ºå®¢æˆ·ç«¯connectionä¸ºkeep-aliveè¿˜æ˜¯closeï¼ŒæœåŠ¡ç«¯è¿”å›çš„connectionå¤´éƒ½æ˜¯close</td></tr><tr><td>3072M</td><td>æ²¡æœ‰content-lengthå’Œtransfer-encodingå¤´ï¼Œä¸è®ºå®¢æˆ·ç«¯connectionä¸ºkeep-aliveè¿˜æ˜¯closeï¼ŒæœåŠ¡ç«¯è¿”å›çš„connectionå¤´éƒ½æ˜¯close</td></tr></tbody></table><p>è¿™å°±æ˜¯ä¸Šé¢è¯´çš„ç¬¬ä¸‰ç§æƒ…å†µï¼Œä¸çŸ¥é“å¤§å°ï¼Œä¹Ÿä¸æ”¯æŒtrunkedï¼Œé‚£å°±å¿…é¡»ä½¿ç”¨çŸ­è¿æ¥æ¥æ ‡ç¤ºç»“æŸã€‚</p><h1 id="é—®é¢˜è§£å†³æ–¹æ¡ˆ"><a href="#é—®é¢˜è§£å†³æ–¹æ¡ˆ" class="headerlink" title="é—®é¢˜è§£å†³æ–¹æ¡ˆ"></a>é—®é¢˜è§£å†³æ–¹æ¡ˆ</h1><p>å’¨è¯¢äº†ä¸­é—´ä»¶ç»„çš„åŒäº‹ï¼Œä»¥å‰ä¹Ÿé‡åˆ°ç±»ä¼¼çš„é—®é¢˜ï¼Œå› ä¸ºå‡çº§äº†Weblogicå¯¼è‡´å®¢æˆ·ç«¯è§£æXMLå‡ºé”™ï¼Œå› ä¸ºä½¿ç”¨äº†chunkedæ¨¡å¼ï¼Œä¸­é—´æœ‰ä¸€äº›æ ¼å¼åŒ–çš„å­—ç¬¦ï¼Œè€Œå®¢æˆ·ç«¯è§£æçš„ä»£ç å¹¶æ²¡æœ‰è€ƒè™‘chunkedæ¨¡å¼çš„è§£æï¼Œå¯¼è‡´è§£æå‡ºé”™ã€‚</p><p>å› ä¸ºæˆ‘ä»¬å®¢æˆ·ç«¯å¿…é¡»ç”¨content-lengthå±•ç¤ºè¿›åº¦ï¼Œå› æ­¤ä¸èƒ½ç”¨chunkedæ¨¡å¼ï¼ŒWeblogicå¯ä»¥æŠŠchunkedæ¨¡å¼å…³é—­ã€‚ç”¨ä¸‹é¢çš„æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!java weblogic.WLST </span><br><span class="line"><span class="title function_">connect</span><span class="params">(<span class="string">&#x27;usernameâ€™,&#x27;</span>password<span class="string">&#x27;, &#x27;</span>t3://localhost:<span class="number">7001</span><span class="string">&#x27;)</span></span></span><br><span class="line"><span class="string"><span class="params">edit()</span></span></span><br><span class="line"><span class="string"><span class="params">startEdit()</span></span></span><br><span class="line"><span class="string"><span class="params">cd(&quot;Servers/AdminServer/WebServer/AdminServer&quot;)</span></span></span><br><span class="line"><span class="string"><span class="params">cmo.setChunkedTransferDisabled(true)</span></span></span><br><span class="line"><span class="string"><span class="params">save()</span></span></span><br><span class="line"><span class="string"><span class="params">activate()</span></span></span><br><span class="line"><span class="string"><span class="params">exit()</span></span></span><br></pre></td></tr></table></figure><p>æ”¹äº†ä¹‹åï¼Œç¡®å®ä¸è¿”å›chunkedäº†ï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰content-lengthï¼Œå› ä¸ºWeblogicå°±æ˜¯ä¸æå‰è·å–æ–‡ä»¶å¤§å°ï¼Œè€Œæ˜¯å¼ºåˆ¶åŠ äº†<code>connection:close</code>ï¼Œä¹Ÿå°±æ˜¯å‰è¾¹è¯´çš„ç¬¬ä¸‰ç§ï¼Œé€šè¿‡è¿æ¥ç»“æŸæ ‡è¯†æ•°æ®ç»“æŸã€‚æœ€ååªèƒ½æŠŠè¿™äº›èµ„æºæ”¾å€’apacheé‡Œäº†ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä¸€ä¸ªå¥½çš„httpå®¢æˆ·ç«¯ï¼Œå¿…é¡»å……åˆ†å®ç°åè®®ï¼Œä¸ç„¶å°±å¯èƒ½å‡ºé—®é¢˜ï¼Œæµè§ˆå™¨å¯¹äºæœåŠ¡ç«¯å¯èƒ½äº§ç”Ÿçš„å„ç§æƒ…å†µéƒ½å¾ˆå¥½çš„åšäº†å¤„ç†ï¼Œä½†æ˜¯è‡ªå·±å®ç°httpåè®®çš„è§£ææ—¶ä¸€å®šå¾—æ³¨æ„è€ƒè™‘å¤šç§æƒ…å†µã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ–‡ç« ä½œè€…ï¼šç‰›ç«‹æ–°</span><br><span class="line">åŸæ–‡é“¾æ¥ï¼šhttps://www.cnblogs.com/nxlhero/p/11670942.html</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ¬æ–‡é€šè¿‡ä¸€ä¸ªçº¿ä¸Šå®ä¾‹ï¼Œè¯¦ç»†ä»‹ç»httpåè®®ä¸­çš„content-lengthå­—æ®µã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="ç½‘ç»œ" scheme="https://blog.musnow.top/tags/%E7%BD%91%E7%BB%9C/"/>
    
    <category term="http" scheme="https://blog.musnow.top/tags/http/"/>
    
    <category term="nginx" scheme="https://blog.musnow.top/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>ã€ç½‘ç»œã€‘http(s)åè®® | ä»‹ç»</title>
    <link href="https://blog.musnow.top/2023/02/15/note_Linux/34http%E5%8D%8F%E8%AE%AE/"/>
    <id>https://blog.musnow.top/2023/02/15/note_Linux/34http%E5%8D%8F%E8%AE%AE/</id>
    <published>2023-02-15T03:30:55.000Z</published>
    <updated>2023-02-16T14:40:34.003Z</updated>
    
    <content type="html"><![CDATA[<p>å·²ç»å­¦ä¹ è¿‡è‡ªå·±å®šåˆ¶ä¸€ä¸ªåè®®äº†ï¼Œç°åœ¨å°±æ¥çœ‹çœ‹å½“ä¸‹å¹¿æ³›ä½¿ç”¨çš„httpåè®®å§</p><span id="more"></span><h1 id="1-ä»‹ç»"><a href="#1-ä»‹ç»" class="headerlink" title="1.ä»‹ç»"></a>1.ä»‹ç»</h1><blockquote><p>è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHyper Text Transfer Protocolï¼ŒHTTPï¼‰æ˜¯ä¸€ä¸ªç®€å•çš„è¯·æ±‚-å“åº”åè®®ï¼Œå®ƒé€šå¸¸è¿è¡Œåœ¨TCPä¹‹ä¸Šã€‚å®ƒæŒ‡å®šäº†å®¢æˆ·ç«¯å¯èƒ½å‘é€ç»™æœåŠ¡å™¨ä»€ä¹ˆæ ·çš„æ¶ˆæ¯ä»¥åŠå¾—åˆ°ä»€ä¹ˆæ ·çš„å“åº”ã€‚</p></blockquote><p>httpå’Œhttpsæ˜¯å½“ä¸‹æœ€é€šç”¨çš„åè®®ä¹‹ä¸€ï¼Œæˆ‘ä»¬è®¿é—®çš„å¤§éƒ¨åˆ†ç½‘é¡µç”¨çš„éƒ½æ˜¯è¿™ä¸ªåè®®ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.bilibili.com/</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªåè®®ä¸»è¦çš„å·®åˆ«ï¼Œé‚£å°±æ˜¯httpæ˜¯ç”¨æ˜æ–‡ä¼ è¾“æ•°æ®çš„ï¼Œæˆ‘ä»¬çš„æ•°æ®åœ¨äº’è”ç½‘è£¸å¥”ï¼Œå¯èƒ½æœ‰å®‰å…¨é—®é¢˜ï¼›ç›¸æ¯”ä¹‹ä¸‹ï¼Œhttpsä¼ è¾“æ•°æ®çš„è¿‡ç¨‹ä¼šå¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œä½†è¿™ä¹Ÿä¸ä»£è¡¨httpsæ˜¯å®Œå…¨å®‰å…¨çš„ã€‚</p><h2 id="1-1-url"><a href="#1-1-url" class="headerlink" title="1.1 url"></a>1.1 url</h2><p>è¦è®¤è¯†è¿™ä¸¤ä¸ªåè®®ï¼Œæˆ‘ä»¬è¦ä»urlçš„è®¤è¯†å¼€å§‹ï¼›</p><p><code>HTTP(S)</code> ä¸å…è®¸ä½¿ç”¨ç”¨æˆ·åæˆ–å¯†ç ï¼Œä¸€ä¸ªåˆæ³•çš„ <code>HTTP(S)</code> URL æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http(s)://&lt;host&gt;:&lt;port&gt;/&lt;path&gt;?&lt;query&gt;#&lt;frag&gt;</span><br></pre></td></tr></table></figure><ul><li>å¼€å¤´ä¸ºåè®®åï¼šhttp æˆ– https åè®®ï¼› </li><li><code>&lt;host&gt;</code>ï¼šä¸»æœºåã€‚ä¸€ä¸ª URL ä¸­ï¼Œæ—¢å¯ä»¥ä½¿ç”¨åŸŸåä¹Ÿå¯ä»¥ä½¿ç”¨ IP è¡¨ç¤ºä¸»æœºåœ°å€</li><li><code>&lt;port&gt;</code>ï¼šç«¯å£ã€‚ä¸»æœºåå’Œç«¯å£ä¹‹é—´ä½¿ç”¨å†’å·åˆ†éš”ã€‚ç«¯å£æ˜¯å¯é€‰çš„ï¼Œå¦‚æœçœç•¥å°†é‡‡ç”¨é»˜è®¤ç«¯å£ï¼Œhttp é»˜è®¤ç«¯å£æ˜¯ 80ï¼Œhttps é»˜è®¤ç«¯å£ 443ï¼›</li><li><code>&lt;path&gt;</code>ï¼šèµ„æºè·¯å¾„ã€‚èµ„æºåœ¨ç½‘ç»œä¸»æœºä¸Šçš„è·¯å¾„ï¼Œè·¯å¾„ä¹Ÿæ˜¯å¯é€‰çš„ï¼Œç¼ºçœè®¿é—®é»˜è®¤èµ„æºï¼› </li><li><code>&lt;query&gt;</code>ï¼šæŸ¥è¯¢å‚æ•°ã€‚æ ¼å¼ä¸º key&#x3D;valueï¼Œå¤šä¸ªå‚æ•°ä½¿ç”¨ &amp; åˆ†éš”ï¼›å‚æ•°ä¹Ÿæ˜¯å¯é€‰çš„ï¼› </li><li><code>&lt;frag&gt;</code>ï¼šç‰‡æ®µã€‚ä» # å¼€å§‹åˆ°æœ€åï¼Œä¸€èˆ¬ç”¨äºå®šä½åˆ°èµ„æºå†…çš„ä¸€ä¸ªç‰‡æ®µï¼Œæ¯”å¦‚æ–‡æ¡£çš„ä¸€ä¸ªç« èŠ‚ï¼›ç‰‡æ®µä¹Ÿæ˜¯å¯é€‰çš„ã€‚</li></ul><h3 id="1-1-1-æ —å­-â‘ "><a href="#1-1-1-æ —å­-â‘ " class="headerlink" title="1.1.1 æ —å­ â‘ "></a>1.1.1 æ —å­ â‘ </h3><p>æ¥ä¸‹æ¥ä¸¾ä¸€ä¸ªå…·ä½“çš„ä¾‹å­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.musnow.top/2022/08/07/note_linux/6gdb_g++_make_vim/#4-make-x2F-makefile</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šæ˜¯æˆ‘çš„ä¸ªäººåšå®¢ä¸­çš„ä¸€ç¯‡æ–‡ç« </p><ul><li>åè®®æ˜¯https</li><li>åŸŸåæ˜¯<code>blog.musnow.top</code>ï¼Œå¯¹åº”çš„å°±æ˜¯<code>&lt;host&gt;:&lt;port&gt;</code>ï¼›è¿™é‡Œéšè—äº†ç«¯å£ï¼Œä¼šåœ¨ä¸‹é¢è¯´æ˜ã€‚</li><li><code>/2022/08/07/note_linux/6gdb_g++_make_vim/</code>è¿™ä¸€é•¿ä¸²éƒ½æ˜¯æ–‡ä»¶çš„è·¯å¾„ï¼Œå…¶æ ‡ç¤ºäº†æ–‡ä»¶åœ¨æœåŠ¡å™¨ä¸Šå­˜æ”¾çš„ä½ç½®</li><li>è¿™ä¸ªurlå†…æ²¡æœ‰å¸¦<code>&lt;query&gt;</code>å‚æ•°</li><li><code>#4-make-x2F-makefile</code>å¯¹åº”çš„æ˜¯<code>&lt;frag&gt;</code>ç‰‡æ®µï¼Œæ ‡è¯†äº†æˆ‘å½“å‰æµè§ˆçš„ä½ç½®</li></ul><p>å½“ä½ æŠŠè¿™ä¸ªurlç²˜è´´é“æµè§ˆå™¨ï¼Œå…¶ä¼šç›´æ¥è·³è½¬åˆ°å¯¹åº”çš„æ ‡é¢˜ä½ç½®ï¼Œè€Œä¸æ˜¯è¿™ç¯‡æ–‡ç« çš„é¡µé¦–ï¼›è¿™å°±æ˜¯<code>&lt;frag&gt;</code>ç‰‡æ®µçš„ä½œç”¨</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ec475e3c6a2.png"                      alt="image-20230215104544655"                ></p><h3 id="1-1-2-æ —å­-â‘¡"><a href="#1-1-2-æ —å­-â‘¡" class="headerlink" title="1.1.2 æ —å­ â‘¡"></a>1.1.2 æ —å­ â‘¡</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.baidu.com/s?tn=68018901_39_oem_dg&amp;ie=utf-8&amp;word=test</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬åœ¨ç™¾åº¦æœç´¢å•è¯<code>test</code>çš„æ—¶å€™ï¼Œç™¾åº¦çš„urlä¸­å°±ä¼šå‡ºç°<code>&lt;query&gt;</code>å‚æ•°ï¼›</p><p>å…¶ä¸­<code>?</code>æ˜¯å‚æ•°çš„å¼€å¤´ï¼Œåç»­çš„ä¸€ä¸²ä»¥<code>&amp;</code>åˆ†éš”çš„kvé”®å€¼å¯¹ï¼Œå°±æ˜¯å‚æ•°çš„å†…å®¹ã€‚åœ¨è¿™é‡Œé¢æˆ‘ä»¬èƒ½çœ‹åˆ°<code>word=test</code>ï¼Œæˆ‘ä»¬æŸ¥è¯¢çš„å•è¯testå°±åœ¨è¿™ä¸ªå‚æ•°åï¼›</p><p>æˆ‘ä»¬çš„æœç´¢è®¿é—®ï¼Œå°±æ˜¯å°†è¿™äº›å‚æ•°ä¼ é€ç»™æœåŠ¡å™¨ï¼Œå†ç”±ç™¾åº¦çš„æœåŠ¡å™¨è¿”å›æœç´ ç»“æœçš„ã€‚</p><h2 id="1-2-åŸŸåå’Œç«¯å£éšè—"><a href="#1-2-åŸŸåå’Œç«¯å£éšè—" class="headerlink" title="1.2 åŸŸåå’Œç«¯å£éšè—"></a>1.2 åŸŸåå’Œç«¯å£éšè—</h2><p>ä½†æˆ‘ä»¬æ—¥å¸¸è®¿é—®çš„ç½‘é¡µä¸­ï¼Œå¾ˆå°‘è§åˆ°è¿‡<code>ip:ç«¯å£</code>çš„å½¢å¼ï¼Œè€Œå¤§å¤šæ˜¯ç”¨åŸŸåä¸ºæˆ‘ä»¬æä¾›æœåŠ¡çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.bilibili.com/</span><br></pre></td></tr></table></figure><p>è¿™å¹¶ä¸ä»£è¡¨å…¶èƒŒåä¸éœ€è¦ç«¯å£å·ã€‚è€Œæ˜¯å› ä¸ºå¦‚æœæˆ‘ä»¬çš„è®¿é—®<strong>ä¸æŒ‡å®šç«¯å£</strong>çš„æ—¶å€™ï¼Œhttp(s)åè®®ä¼šé‡‡ç”¨é»˜è®¤ç«¯å£å·80æˆ–443ï¼Œä»è€Œå®ç°éšè—ç«¯å£å·æä¾›æœåŠ¡</p><blockquote><p>http é»˜è®¤ç«¯å£æ˜¯ 80ï¼Œhttps é»˜è®¤ç«¯å£ 443</p></blockquote><p>æ¯•ç«Ÿå¯¹äºç”¨æˆ·è€Œè¨€ï¼Œè®°ä½ä¸€ä¸ªåŸŸåå·²ç»ä¸å®¹æ˜“äº†ï¼Œè¿˜è¦è®°ä½ä½ çš„æœåŠ¡æ˜¯åœ¨å“ªä¸€ä¸ªç«¯å£ï¼Œé‚£å°±æ›´éš¾äº†ï¼›</p><p>è€ŒåŸŸåä¹Ÿä¸æ˜¯å‡­ç©ºç»™æˆ‘ä»¬æä¾›æœåŠ¡çš„ï¼Œæ¯ä¸€ä¸ªåŸŸåéƒ½éœ€è¦ç»‘å®šä¸€ä¸ªå…·ä½“çš„å…¬ç½‘ipï¼ˆåŸŸåè§£æï¼‰ï¼Œæ‰èƒ½ä¸ºç”¨æˆ·æä¾›æœåŠ¡ã€‚åœ¨åŸŸåçš„èƒŒåï¼Œéƒ½æ˜¯ä¸€ä¸ªipï¼Œæ¯ä¸€ä¸ªipä¹Ÿå°±æ˜¯ä¸€å°æœåŠ¡å™¨ã€‚</p><p>åŸŸåçš„ä½œç”¨ï¼Œå°±æ˜¯æ¥éšè—æ‰ipè¿™ä¸ªæ— è§„å¾‹çš„é•¿æ•°å­—ï¼Œæ–¹ä¾¿ç”¨æˆ·è®¿é—®ï¼›</p><blockquote><p>ä½ è§‰å¾—æ˜¯è®°ä½<code>baidu.com</code>å®¹æ˜“ï¼Œè¿˜æ˜¯è®°ä½<code>114.514.77.58</code>å®¹æ˜“å‘¢ï¼Ÿ</p></blockquote><p>åœ¨å‘½ä»¤è¡Œä½¿ç”¨pingå·¥å…·ï¼Œæˆ‘ä»¬èƒ½çŸ¥é“ä¸€ä¸ªç½‘ç«™æœåŠ¡å™¨çš„ipæ˜¯ä»€ä¹ˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping www.bilibili.com</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚æˆ‘ä»¬pingä¸€ä¸‹bç«™çš„åŸŸåï¼Œå¯ä»¥çœ‹åˆ°å…¶å…¬ç½‘ipæ˜¯<code>183.131.147.29</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">æ­£åœ¨ Ping a.w.bilicdn1.com [183.131.147.29] å…·æœ‰ 32 å­—èŠ‚çš„æ•°æ®:</span><br><span class="line">æ¥è‡ª 183.131.147.29 çš„å›å¤: å­—èŠ‚=32 æ—¶é—´=10ms TTL=55</span><br><span class="line">æ¥è‡ª 183.131.147.29 çš„å›å¤: å­—èŠ‚=32 æ—¶é—´=12ms TTL=55</span><br><span class="line">æ¥è‡ª 183.131.147.29 çš„å›å¤: å­—èŠ‚=32 æ—¶é—´=12ms TTL=55</span><br><span class="line">æ¥è‡ª 183.131.147.29 çš„å›å¤: å­—èŠ‚=32 æ—¶é—´=12ms TTL=55</span><br><span class="line"></span><br><span class="line">183.131.147.29 çš„ Ping ç»Ÿè®¡ä¿¡æ¯:</span><br><span class="line">    æ•°æ®åŒ…: å·²å‘é€ = 4ï¼Œå·²æ¥æ”¶ = 4ï¼Œä¸¢å¤± = 0 (0% ä¸¢å¤±)ï¼Œ</span><br><span class="line">å¾€è¿”è¡Œç¨‹çš„ä¼°è®¡æ—¶é—´(ä»¥æ¯«ç§’ä¸ºå•ä½):</span><br><span class="line">    æœ€çŸ­ = 10msï¼Œæœ€é•¿ = 12msï¼Œå¹³å‡ = 11ms</span><br></pre></td></tr></table></figure><h2 id="1-3-ip-ç«¯å£"><a href="#1-3-ip-ç«¯å£" class="headerlink" title="1.3 ip:ç«¯å£"></a>1.3 ip:ç«¯å£</h2><p>æˆ‘ä»¬å¯ä»¥ç”¨<code>ip:ç«¯å£</code>æ¥è®¿é—®è‡ªå·±çš„æœåŠ¡ï¼ˆä»¥ä¸‹ipçº¯å±è™šæ„ï¼Œå¦‚æœ‰æ’è½¦ï¼Œçº¯å±å·§åˆï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">114.514.77.58:8080</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬æŠŠè¿™ä¸ªç²˜è´´é“æµè§ˆå™¨ï¼Œå†å¤åˆ¶ç²˜è´´å‡ºæ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå‘ç°å‰é¢å¤šäº†ä¸€ä¸ªhttp</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://114.514.77.58:8080</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºå½“æˆ‘ä»¬ä½¿ç”¨ipè®¿é—®ä¸€ä¸ªæœåŠ¡çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šé»˜è®¤é‡‡ç”¨httpçš„åè®®å»è®¿é—®ï¼Œæ‰€ä»¥åœ¨å‰é¢åŠ äº†ä¸€ä¸ªæˆ‘ä»¬çœ‹ä¸åˆ°çš„<code>http://</code></p><h2 id="1-4-åè®®ä½œç”¨"><a href="#1-4-åè®®ä½œç”¨" class="headerlink" title="1.4 åè®®ä½œç”¨"></a>1.4 åè®®ä½œç”¨</h2><p>httpåè®®çš„ä½œç”¨ï¼Œå°±æ˜¯å‘<strong>æœåŠ¡å™¨</strong>ç”³è¯·ç‰¹å®šçš„èµ„æºï¼Œå†å°†èµ„æºæ‹‰å–åˆ°æœ¬åœ°è¿›è¡Œå±•ç¤ºorä½¿ç”¨ã€‚</p><p>èµ„æºéƒ½æ˜¯å­˜åœ¨æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸Šçš„ï¼Œå½“ç”¨æˆ·è¯·æ±‚çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨å¿…é¡»è¦çŸ¥é“èµ„æºçš„è·¯å¾„ï¼Œå°†å…¶<code>read</code>æ‰“å¼€è¯»å–ï¼Œå†<code>write</code>å†™ç»™æˆ‘ä»¬çš„å®¢æˆ·ç«¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/2022/08/07/note_linux/6gdb_g++_make_vim/</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥httpçš„è¯·æ±‚ä¸­æ‰ä¼šå¸¦ä¸Šèµ„æºçš„è·¯å¾„ï¼Œè¿™æ˜¯æ–¹ä¾¿æœåŠ¡å™¨è¿›è¡Œèµ„æºæ–‡ä»¶çš„è¯»å–ï¼›åŒæ—¶ï¼Œæ–‡ä»¶çš„è·¯å¾„ä¹Ÿæ˜¯å¯¹ä¸€ä¸ªæ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†ï¼Œåœ¨å‘Šè¯‰æœåŠ¡å™¨æ–‡ä»¶è·¯å¾„çš„åŒæ—¶ï¼Œä¹Ÿä¿è¯äº†æˆ‘ä»¬è¯·æ±‚çš„æ–‡ä»¶çš„å”¯ä¸€æ€§ï¼Œä¸ä¼šå‡ºç°äºŒä¹‰æ€§ï¼›</p><hr><p>è¿™æ—¶å€™åˆä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå½“æˆ‘ä»¬è®¿é—®ç½‘ç«™çš„æ ¹ç›®å½•çš„æ—¶å€™ï¼Œæ²¡æœ‰æä¾›æ–‡ä»¶çš„è·¯å¾„å‘€ï¼Œé‚£è¿™æ—¶å€™ï¼Œè®¿é—®çš„ä»€ä¹ˆæ–‡ä»¶å‘¢ï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.baidu.com/</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬è®¿é—®çš„æ˜¯æœåŠ¡å™¨æ ¹ç›®å½•çš„<code>index.html</code>æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://www.baidu.com/</span><br><span class="line">https://www.baidu.com/index.html</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥è¯•ç€æ‰“å¼€è¿™ä¸¤ä¸ªé“¾æ¥ï¼Œå…¶å‡ºç°çš„é¡µé¢æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼›</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ec4cb9820b6.png"                      alt="image-20230215110843400"                ></p><p>ç±»ä¼¼äºç«¯å£å·éšè—ï¼Œhttpåè®®ä¹Ÿç¡®å®šäº†å½“ä¸‹ä½¿ç”¨çš„ç½‘é¡µæ–‡ä»¶çš„å‘½åä¸º<code>index.html</code>ï¼Œå½“æˆ‘ä»¬è®¿é—®ä¸€ä¸ªç½‘ç«™çš„æ—¶å€™ï¼Œå°±ä¼šé»˜è®¤è®¿é—®æ ¹ç›®å½•ä¸‹çš„<code>index.html</code>æ–‡ä»¶ï¼ˆæ—¢ç„¶æ˜¯é»˜è®¤çš„ï¼Œé‚£å°±å¯ä»¥ç›´æ¥éšè—ï¼‰å¦‚æœè¿™ä¸ªæ–‡ä»¶ä¸å­˜åœ¨ï¼Œé‚£å°±ä¸ä¼šæ¸²æŸ“å‡ºæˆ‘ä»¬çœ‹åˆ°çš„ç½‘é¡µï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.htmlæ˜¯ç”¨å‰ç«¯è¯­è¨€ç¼–å†™çš„ç½‘é¡µä»£ç </span><br></pre></td></tr></table></figure><p>åŒç†ï¼Œå½“æˆ‘ä»¬è®¿é—®åšå®¢çš„æ—¶å€™ï¼Œè¯»å–é“çš„ä¹Ÿä¸æ˜¯ç›®å½•ï¼Œè€Œæ˜¯ç›®å½•ä¸‹çš„<code>index.html</code>æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.musnow.top/2022/08/07/note_linux/6gdb_g++_make_vim/</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ec4d38428a8.png"                      alt="image-20230215111050026"                ></p><p>æˆ‘çš„åšå®¢ä½¿ç”¨çš„æ˜¯hexoæ¡†æ¶ï¼Œå…¶ç½‘é¡µçš„æºè·¯å¾„åœ¨githubä¸Šå¼€æºäº†ï¼Œå¯ä»¥å¸®åŠ©ä½ ç†è§£urlä¸­çš„æ–‡ä»¶è·¯å¾„ã€‚</p><p>å½“å‰ä½ çœ‹åˆ°çš„æ–‡ä»¶ç›®å½•ï¼Œå°±æ˜¯åšå®¢æœåŠ¡çš„æ ¹ç›®å½•ã€‚è®¿é—®çš„åšå®¢é¦–é¡µï¼Œå°±æ˜¯æ ¹ç›®å½•ä¸‹çš„<code>index.html</code></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ec4d71b69ed.png"                      alt="image-20230215111147560"                ></p><p>ç”¨ä½œç¤ºä¾‹çš„<a href="https://blog.musnow.top/2022/08/07/note_linux/6gdb_g++_make_vim/index.html">linuxå·¥å…·ä½¿ç”¨</a>åšå®¢ï¼Œä¹Ÿå¯ä»¥æ ¹æ®å®ƒçš„è·¯å¾„ï¼Œæ‰¾åˆ°<code>index.html</code>æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/2022/08/07/note_linux/6gdb_g++_make_vim/</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ec4e066de99.png"                      alt="image-20230215111416443"                ></p><p>è¿™ä¾¿æ˜¯httpåè®®urlä¸­æ–‡ä»¶è·¯å¾„çš„ä½œç”¨ï¼</p><p>è¿™é‡Œçš„<code>/</code>æ ¹ç›®å½•æ˜¯<strong>æœåŠ¡ç«¯è®¾ç½®</strong>çš„ï¼Œå¹¶ä¸ä¸€å®šæ˜¯ï¼ˆå¤§æ¦‚ç‡ä¸æ˜¯ï¼‰æœåŠ¡ç«¯linuxæœåŠ¡å™¨çš„æ ¹ç›®å½•</p><h2 id="1-5-ç¼–ç è§£ç "><a href="#1-5-ç¼–ç è§£ç " class="headerlink" title="1.5 ç¼–ç è§£ç "></a>1.5 ç¼–ç è§£ç </h2><p>åœ¨urlä¸­ï¼Œè¿˜ä¼šå¯¹ä¸€äº›ç‰¹æ®Šå­—ç¬¦è¿›è¡Œç¼–è§£ç ï¼Œæ¯”å¦‚ä¸­æ–‡ï¼Œå’Œä¸€äº›ç‰¹æ®Šçš„ç¬¦å·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.musnow.top/2022/08/07/note_linux/6gdb_g++_make_vim/#4-make-x2F-makefile</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚åœ¨ä½œä¸ºç¤ºä¾‹çš„urlä¸­ï¼Œè¿™é‡Œå‡ºç°äº†<code>x2F</code>ï¼Œè€ŒåŸæ–‡ä¸­æ˜¯<code>4.make/makefile</code>;è¿™é‡Œçš„ç¼–ç å°±æ˜¯ä¸ºäº†é¿å…<code>make/makefile</code>è¢«è¯†åˆ«æˆè·¯å¾„çš„æ ‡è¯†ç¬¦ï¼Œä»è€Œå‡ºç°é”™è¯¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.baidu.com/s?tn=68018901_39_oem_dg&amp;ie=utf-8&amp;word=%E4%BD%A0%E5%A5%BD</span><br></pre></td></tr></table></figure><p>å½“urlè·¯å¾„ä¸­æœ‰ä¸­æ–‡çš„æ—¶å€™ï¼Œä¹Ÿä¼šè¢«è½¬ç æˆç‰¹å®šçš„æ ¼å¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ec503e1f0d6.png"                      alt="image-20230215112344227"                ></p><p>æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸Šçœ‹åˆ°çš„ä¾æ—§æ˜¯ä¸­æ–‡ï¼Œè¿™æ˜¯å› ä¸ºæµè§ˆå™¨è¿™æ®µå¸®æˆ‘ä»¬è¿›è¡Œäº†è§£ç </p><blockquote><p>å°†éœ€è¦è½¬ç çš„å­—ç¬¦è½¬ä¸º16è¿›åˆ¶ï¼Œç„¶åä»å³åˆ°å·¦ï¼Œå–4ä½(ä¸è¶³4ä½ç›´æ¥å¤„ç†)ï¼Œæ¯2ä½åšä¸€ä½ï¼Œå‰é¢åŠ ä¸Š%ï¼Œç¼–ç æˆ<code>%XY</code>æ ¼å¼</p></blockquote><h1 id="2-httpåè®®è¯·æ±‚æ ¼å¼"><a href="#2-httpåè®®è¯·æ±‚æ ¼å¼" class="headerlink" title="2.httpåè®®è¯·æ±‚æ ¼å¼"></a>2.httpåè®®è¯·æ±‚æ ¼å¼</h1><p>äº†è§£äº†httpåè®®ä¸­çš„urlç½‘å€ï¼Œç°åœ¨å°±å¯ä»¥è¿›ä¸€æ­¥äº†è§£httpåè®®çš„æŠ¥å¤´å’ŒæŠ¥æ–‡äº†;</p><p>ä¸€ä¸ª<code>http request/response</code>çš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ec536219bf8.png"                      alt="image-20230215113707995"                ></p><p>åœ¨è¯·æ±‚ä¸­ï¼Œå®¢æˆ·ç«¯ä¼šæä¾›è‡ªå·±çš„è¯·æ±‚æ–¹æ³•ï¼ˆGET&#x2F;POST&#x2F;PUTç­‰ç­‰ï¼‰ï¼Œå¹¶æä¾›urlæ¥æ ‡è¯†è‡ªå·±éœ€è¦çš„æ–‡ä»¶è·¯å¾„ï¼›è¿™ä¸ªurlå¯èƒ½æ˜¯çŸ­é“¾æ¥ï¼ˆæˆªå–æ ¹ç›®å½•ä¹‹åçš„éƒ¨åˆ†ï¼‰ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å®Œæ•´çš„é“¾æ¥ã€‚</p><p>éšåï¼Œå°±ä¼šè·Ÿä¸Šä¸€å¤§å †çš„è¯·æ±‚å‚æ•°ï¼Œæ³¨æ„ï¼Œè¿™é‡Œçš„è¯·æ±‚å‚æ•°å¹¶ä¸æ˜¯urlä¸­çš„<code>&lt;query&gt;</code>å‚æ•°ï¼Œè€Œæ˜¯httpåè®®è‡ªèº«çš„è¯·æ±‚å‚æ•°ã€‚æ¯ä¸€ä¸ªè¯·æ±‚å‚æ•°éƒ½ç”¨äº†<code>\r\n</code>ä½œä¸ºåˆ†éš”ï¼Œè¿™å’Œæˆ‘ä»¬å†™çš„<a href="https://blog.musnow.top/2023/02/11/note_linux/32tcp%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8D%8F%E8%AE%AE/#3-1-%E5%8D%8F%E8%AE%AE%E5%AE%9A%E5%88%B6">è‡ªå®šä¹‰åè®®</a>ä¸­é‡‡ç”¨<code>\t</code>è¿›è¡Œåˆ†å‰²æ˜¯ç›¸åŒçš„åŸç†ï¼</p><p>è¿™å‡ ä¸ªéƒ¨åˆ†ä¸­ï¼Œè¯·æ±‚çš„æ­£æ–‡å¯ä»¥ä¸å¸¦ï¼ˆä¸ºç©ºï¼‰</p><h2 id="2-1-è¯»å–å¤šé•¿ï¼Ÿ"><a href="#2-1-è¯»å–å¤šé•¿ï¼Ÿ" class="headerlink" title="2.1 è¯»å–å¤šé•¿ï¼Ÿ"></a>2.1 è¯»å–å¤šé•¿ï¼Ÿ</h2><p>ä¸ºäº†è®©åè®®è¯»å–çš„æ—¶å€™ï¼Œèƒ½å¤ŸçŸ¥é“ä»€ä¹ˆæ—¶å€™è¯»å–å®Œæ¯•äº†æŠ¥å¤´ï¼Œhttpåè®®æä¾›äº†ä¸€ä¸ª<code>\r\n</code>çš„ç©ºè¡Œï¼Œè¯»å–é“è¿™ä¸ªç©ºè¡Œï¼Œå°±ä»£è¡¨æŠ¥å¤´è¯»å–å®Œæ¯•äº†ï¼Œå‰©ä¸‹çš„å†…å®¹éƒ½æ˜¯æŠ¥æ–‡ã€‚</p><p>è€Œä¸ºäº†æ ‡è¯†æŠ¥æ–‡çš„é•¿åº¦ï¼Œhttpåè®®ä¼šåœ¨å‘é€çš„æ—¶å€™æä¾›ä¸€ä¸ªå‚æ•°<code>content-length</code>ï¼Œç”¨äºæ ‡è¯†æŠ¥æ–‡çš„é•¿åº¦ã€‚åœ¨è¯»å–å®Œæ¯•æŠ¥å¤´åï¼Œè‚¯å®šæ˜¯è¯»å–åˆ°äº†è¿™ä¸ª<code>content-length</code>å‚æ•°çš„ï¼Œä¹Ÿå°±çŸ¥é“åç»­åº”è¯¥ç»§ç»­è¯»å–å¤šé•¿ï¼Œæ‰èƒ½è¯»å®Œæ•´ä¸ªåè®®å­—æ®µï¼</p><p>å…³äºè¿™éƒ¨åˆ†çš„ä»‹ç»ï¼Œå¯ä»¥æŸ¥çœ‹å¦å¤–ä¸€ç¯‡åšå®¢ <a href="https://blog.musnow.top/2023/02/15/note_Linux/35http%E4%B8%ADcontent-length/">httpåè®®content-lengthè¯¦è§£</a></p><h2 id="2-2-å“åº”çš„çŠ¶æ€ç "><a href="#2-2-å“åº”çš„çŠ¶æ€ç " class="headerlink" title="2.2 å“åº”çš„çŠ¶æ€ç "></a>2.2 å“åº”çš„çŠ¶æ€ç </h2><p>å’Œæˆ‘ä»¬è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ä¸€æ ·ï¼Œhttpä¹Ÿè¡¨æ˜äº†ä¸€éƒ¨åˆ†å“åº”çš„çŠ¶æ€ç ï¼Œå…¶ä¸­æˆ‘ä»¬æ—¥å¸¸æœ€å¸¸è§åˆ°çš„ï¼Œæ˜¯<code>404/403</code>è¿™ä¸¤ä¸ªçŠ¶æ€ç </p><blockquote><p><a class="link"   href="https://baike.baidu.com/item/HTTP%E7%8A%B6%E6%80%81%E7%A0%81/5053660" >httpçŠ¶æ€ç -ç™¾åº¦ç™¾ç§‘<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>çŠ¶æ€ç å°±æ˜¯æ ‡è¯†æœåŠ¡å™¨æä¾›çš„æœåŠ¡çŠ¶æ€ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯å®ƒçš„è¯·æ±‚æ˜¯å¦æˆåŠŸäº†ã€‚å¦‚æœçŠ¶æ€ç æ˜¯200ï¼Œä»£è¡¨è¯·æ±‚æ˜¯æˆåŠŸçš„ã€‚å…¶ä½™çŠ¶æ€ç ä¼šæœ‰å„è‡ªçš„ä½¿ç”¨åœºæ™¯ï¼Œæ¯”å¦‚404çŠ¶æ€ç ï¼Œä»£è¡¨è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨ï¼Œæ‰€ä»¥æ‰å« <code>404 not found!</code></p><h1 id="3-å®ä¾‹"><a href="#3-å®ä¾‹" class="headerlink" title="3.å®ä¾‹"></a>3.å®ä¾‹</h1><p>å®Œæ•´ä»£ç è¯¦è§ <a class="link"   href="https://gitee.com/musnow/raspberry-practice/tree/master/code" >Gitee<i class="fas fa-external-link-alt"></i></a></p><h2 id="3-1-å‰ç«¯é¡µé¢"><a href="#3-1-å‰ç«¯é¡µé¢" class="headerlink" title="3.1 å‰ç«¯é¡µé¢"></a>3.1 å‰ç«¯é¡µé¢</h2><p>ç”±äºæœ¬äººå¹¶æ²¡æœ‰å­¦ä¹ è¿‡å‰ç«¯è¯­æ³•ï¼Œè¿™é‡Œé‡‡ç”¨ <a class="link"   href="https://www.runoob.com/html/html-tutorial.html" >èœé¸Ÿæ•™ç¨‹<i class="fas fa-external-link-alt"></i></a> æä¾›çš„å‰ç«¯ç¤ºä¾‹ä»£ç æ¥æ¼”ç¤º</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>èœé¸Ÿæ•™ç¨‹(runoob.com)<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>æˆ‘çš„ç¬¬ä¸€ä¸ªæ ‡é¢˜<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘çš„ç¬¬ä¸€ä¸ªæ®µè½ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ—¥å¸¸æ‰€è®¿é—®çš„ç½‘é¡µéƒ½æ˜¯è¿™æ ·çš„ä»£ç ï¼Œç»ç”±æµè§ˆå™¨è¿›è¡Œæ¸²æŸ“ï¼Œå†å±•ç¤ºå‡ºæ¥</p><h2 id="3-2-æœåŠ¡ç«¯ä»£ç "><a href="#3-2-æœåŠ¡ç«¯ä»£ç " class="headerlink" title="3.2 æœåŠ¡ç«¯ä»£ç "></a>3.2 æœåŠ¡ç«¯ä»£ç </h2><p>ç”±äºhttpæ˜¯åŸºäºtcpçš„ï¼Œè¿™é‡Œç›´æ¥æŠŠä¹‹å‰å†™çš„tcpServeræ¬è¿‡æ¥å°±èƒ½ç”¨ï¼å…·ä½“çš„ä»£ç è§£æè¯·çœ‹æ³¨é‡Šï¼Œæƒ³å¿…è¯´çš„æ˜¯å¾ˆæ¸…æ¥šçš„</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> CRLF <span class="string">&quot;\r\n&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CRLF_LEN strlen(CRLF)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPACE <span class="string">&quot; &quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPACE_LEN strlen(SPACE)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HOME_PAGE <span class="string">&quot;index.html&quot;</span> <span class="comment">// é¦–é¡µæ–‡ä»¶</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ROOT_PATH <span class="string">&quot;web&quot;</span> <span class="comment">// ç½‘å€æ ¹ç›®å½•åœ°å€</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–httpè¯·æ±‚ä¸­çš„è·¯å¾„</span></span><br><span class="line"><span class="function">string <span class="title">getPath</span><span class="params">(string http_request)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">size_t</span> pos = http_request.<span class="built_in">find</span>(CRLF);<span class="comment">//æ‰¾åˆ°ç¬¬ä¸€è¡Œçš„åˆ†éš”ç¬¦</span></span><br><span class="line">    <span class="keyword">if</span>(pos == string::npos) </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    string request_line = http_request.<span class="built_in">substr</span>(<span class="number">0</span>, pos);<span class="comment">//å–å‡ºç¬¬ä¸€è¡Œ</span></span><br><span class="line">    <span class="comment">//è¯·æ±‚çš„ç¬¬ä¸€è¡Œï¼šGET /a/b/c http/1.0</span></span><br><span class="line">    <span class="type">size_t</span> first = request_line.<span class="built_in">find</span>(SPACE);<span class="comment">// æ‰¾åˆ°ç¬¬ä¸€ä¸ªç©ºæ ¼</span></span><br><span class="line">    <span class="keyword">if</span>(pos == string::npos) </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="type">size_t</span> second = request_line.<span class="built_in">rfind</span>(SPACE); <span class="comment">// ä»åå¾€å‰æ‰¾ç©ºæ ¼</span></span><br><span class="line">    <span class="keyword">if</span>(pos == string::npos) </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">// æ‰¾åˆ°ä¸¤ä¸ªç©ºæ ¼äº†ï¼Œä¸¤ä¸ªç©ºæ ¼ä¹‹é—´çš„å°±æ˜¯è¯·æ±‚çš„è·¯å¾„</span></span><br><span class="line">    string path = request_line.<span class="built_in">substr</span>(first+SPACE_LEN, second - (first+SPACE_LEN));</span><br><span class="line">    <span class="keyword">if</span>(path.<span class="built_in">size</span>() == <span class="number">1</span> &amp;&amp; path[<span class="number">0</span>] == <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">        path += HOME_PAGE; <span class="comment">//å†åŠ ä¸Šè¢«éšè—çš„index.htmlæ–‡ä»¶å</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> path;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¯»å–æ–‡ä»¶</span></span><br><span class="line"><span class="function">string <span class="title">readFile</span><span class="params">(<span class="type">const</span> string &amp;recource)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">ifstream <span class="title">in</span><span class="params">(recource, ios::binary)</span></span>;</span><br><span class="line">    <span class="keyword">if</span>(!in.<span class="built_in">is_open</span>()) <span class="comment">//æ–‡ä»¶æ‰“å¼€å¤±è´¥</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;404&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å†…å®¹</span></span><br><span class="line">    string content;</span><br><span class="line">    string line;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">getline</span>(in, line))</span><br><span class="line">    &#123;</span><br><span class="line">        content += line;</span><br><span class="line">    &#125;</span><br><span class="line">    in.<span class="built_in">close</span>();</span><br><span class="line">    <span class="keyword">return</span> content;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">handlerHttpRequest</span><span class="params">(<span class="type">int</span> sock)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;###########start#############&quot;</span> &lt;&lt; endl;<span class="comment">//æ‰“å°ä¸€ä¸ªåˆ†éš”çº¿</span></span><br><span class="line">    <span class="type">char</span> buffer[<span class="number">10240</span>];</span><br><span class="line">    <span class="type">ssize_t</span> s = <span class="built_in">read</span>(sock, buffer, <span class="built_in">sizeof</span>(buffer));</span><br><span class="line">    <span class="keyword">if</span>(s &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        cout &lt;&lt; buffer &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;###########end############&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    string path = <span class="built_in">getPath</span>(buffer);</span><br><span class="line">    <span class="comment">// å‡è®¾ç”¨æˆ·è¯·æ±‚çš„æ˜¯ /a/b è·¯å¾„</span></span><br><span class="line">    <span class="comment">// é‚£ä¹ˆæœåŠ¡ç«¯å¤„ç†çš„æ—¶å€™ï¼Œå°±éœ€è¦æ·»åŠ æ ¹ç›®å½•ä½ç½®å’Œé»˜è®¤çš„æ–‡ä»¶å</span></span><br><span class="line">    <span class="comment">// &lt;root&gt;/a/b/index.html</span></span><br><span class="line">    <span class="comment">// åœ¨æœ¬æ¬¡ç”¨ä¾‹ä¸­ï¼Œæ ¹ç›®å½•ä¸º ./webæ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥å®Œæ•´çš„æ–‡ä»¶è·¯å¾„åº”è¯¥æ˜¯</span></span><br><span class="line">    <span class="comment">// ./web/a/b/index.html</span></span><br><span class="line"></span><br><span class="line">    string resources = ROOT_PATH; <span class="comment">// æ ¹ç›®å½•è·¯å¾„</span></span><br><span class="line">    resources += path; <span class="comment">// æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">    <span class="built_in">logging</span>(DEBUG,<span class="string">&quot;[sockfd: %d] filePath: %s&quot;</span>,sock,resources.<span class="built_in">c_str</span>()); <span class="comment">// æ‰“å°ç”¨ä½œdebug</span></span><br><span class="line"></span><br><span class="line">    string html = <span class="built_in">readFile</span>(resources);<span class="comment">// æ‰“å¼€æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€å§‹å“åº”</span></span><br><span class="line">    string response = <span class="string">&quot;HTTP/1.0 200 OK\r\n&quot;</span>;</span><br><span class="line">    <span class="comment">//å¦‚æœreadFileè¿”å›çš„æ˜¯404ï¼Œä»£è¡¨æ–‡ä»¶è·¯å¾„ä¸å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">strcmp</span>(html.<span class="built_in">c_str</span>(),<span class="string">&quot;404&quot;</span>)==<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        response = <span class="string">&quot;HTTP/1.0 404 NOT FOUND\r\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿½åŠ åç»­å­—æ®µ</span></span><br><span class="line">    response += <span class="string">&quot;Content-Type: text/html\r\n&quot;</span>;</span><br><span class="line">    response += (<span class="string">&quot;Content-Length: &quot;</span> + <span class="built_in">to_string</span>(html.<span class="built_in">size</span>()) + <span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">    response += <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">    response += html;</span><br><span class="line">    <span class="comment">// å‘é€ç»™ç”¨æˆ·</span></span><br><span class="line">    <span class="built_in">send</span>(sock, response.<span class="built_in">c_str</span>(), response.<span class="built_in">size</span>(), <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-3-æµ‹è¯•"><a href="#3-3-æµ‹è¯•" class="headerlink" title="3.3 æµ‹è¯•"></a>3.3 æµ‹è¯•</h2><p>å¯åŠ¨æœåŠ¡å™¨ä¹‹å‰ï¼Œè¯·å…ˆæ‰“å¼€ä½ çš„äº‘æœåŠ¡å™¨é˜²ç«å¢™ä¸­çš„å¯¹åº”ç«¯å£ï¼›è¿™é‡Œæˆ‘ç»‘å®šçš„æ˜¯ç«¯å£10000ï¼Œåœ¨æµè§ˆå™¨ä¸­ç”¨<code>ip:ç«¯å£</code>çš„æ–¹å¼å¯ä»¥æ­£å¸¸è®¿é—®ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ec6f01b93dd.png"                      alt="image-20230215133459929"                ></p><p>è¿™é‡Œæ ‡è¯†çš„<code>ä¸å®‰å…¨</code>æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰é‡‡ç”¨å¸¦åŠ å¯†çš„httpsåè®®ï¼Œè¿™ä¸æ˜¯å½“ä¸‹éœ€è¦è€ƒè™‘çš„é—®é¢˜ã€‚ä¸ç®¡ä»–å°±å¯ä»¥äº†ã€‚</p><p>æŒ‰F12æ‰“å¼€å¼€å‘è€…é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹æ–¹å‡ºç°äº†å®Œæ•´çš„htmlä»£ç ï¼Œæˆ‘ä»¬æˆåŠŸæä¾›äº†æœåŠ¡ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ec720503cdc.png"                      alt="image-20230215134751216"                ></p><h2 id="3-4-åç«¯æ‰“å°çš„æŠ¥æ–‡"><a href="#3-4-åç«¯æ‰“å°çš„æŠ¥æ–‡" class="headerlink" title="3.4 åç«¯æ‰“å°çš„æŠ¥æ–‡"></a>3.4 åç«¯æ‰“å°çš„æŠ¥æ–‡</h2><p>åœ¨æœåŠ¡å™¨åç«¯ï¼Œæˆ‘ä»¬çœ‹åˆ°å…¶æ‰“å°å‡ºæ¥äº†ä¸€ä¸ªåŸºæœ¬çš„httpè¯·æ±‚ï¼Œå’Œä¸Šé¢è¯´æ˜çš„æ ¼å¼æ˜¯ä¸€æ ·çš„ã€‚è¿™é‡Œç®€å•çš„è¿›è¡Œä¸€éƒ¨åˆ†è¯´æ˜ï¼š</p><ul><li>GETï¼šè¯·æ±‚æ–¹å¼ä¸ºè·å–æ•°æ®</li><li><code>/</code>ï¼šè¯·æ±‚çš„æ˜¯æ ¹è·¯å¾„</li><li><code>HTTP/1.1</code>ï¼šä½¿ç”¨çš„httpåè®®ç‰ˆæœ¬</li><li><code>Connetion</code>ï¼šä»£è¡¨æˆ‘ä»¬å’ŒæœåŠ¡å™¨çš„é“¾æ¥æ–¹å¼ï¼Œkeep-aliveä»£è¡¨ä¿æŒè¿æ¥</li><li><code>User-Agent</code>ï¼šå®¢æˆ·ç«¯ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯windowsç³»ç»Ÿã€Chromeå†…æ ¸çš„æµè§ˆå™¨ï¼ˆæˆ‘æ˜¯ç”¨çš„æ˜¯edgeæµè§ˆå™¨ï¼‰</li><li>Accept: æ”¯æŒæ¥æ”¶çš„ä¿¡æ¯ç±»å‹</li><li><code>Aceept-Encoding</code>: å¯¹ä¿¡æ¯è¿›è¡Œå‹ç¼©</li><li><code>Accept-Language</code>ï¼šæ”¯æŒçš„è¯­è¨€</li><li><code>Cookie</code>ï¼šèº«ä»½ä¿¡æ¯ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»</li></ul><p>å…¶ä¸­å‡ºç°äº†ä¸€ä¸ªç©ºè¡Œï¼Œä»£è¡¨æŠ¥æ–‡ç»“æŸï¼›</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ec78b4c5cf2.png"                      alt="image-20230215141623151"                ></p><p>å¾€ä¸‹æ»‘ï¼Œä¼šå‘ç°æµè§ˆå™¨è¿˜å‘å‡ºäº†ç¬¬äºŒä¸ªè¯·æ±‚ï¼Œè·¯å¾„æ˜¯<code>/favicon.ico</code>ï¼Œè¿™æ˜¯é»˜è®¤çš„ç«™ç‚¹å¤´åƒæ–‡ä»¶çš„å‘½åã€‚å› ä¸ºæˆ‘ä»¬çš„htmlæ–‡ä»¶ä¸­æ²¡æœ‰å†™æ˜ç«™ç‚¹å¤´åƒçš„è·¯å¾„ï¼Œæ‰€ä»¥æµè§ˆå™¨å°±å°è¯•è¯·æ±‚é»˜è®¤çš„å¤´åƒæ–‡ä»¶</p><p>ä½†æ˜¯ï¼Œå½“å‰æˆ‘ä»¬çš„ç«™ç‚¹æ ¹ç›®å½•webä¸‹å¹¶æ²¡æœ‰è¯¥æ–‡ä»¶ï¼Œåº”è¯¥è¿”å›ä¸€ä¸ª404çŠ¶æ€ç ã€‚</p><ul><li>è¯·æ±‚ä¸­å‡ºç°äº†ä¸€ä¸ªæ–°çš„å‚æ•°<code>Referer</code>ï¼Œä»£è¡¨æ˜¯ä»å½“å‰ç½‘é¡µè¯·æ±‚å¤´åƒçš„ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œè¯·æ±‚ç½‘é¡µçš„æŠ¥æ–‡ä¸­æ²¡æœ‰<code>Referer</code>å‚æ•°</li></ul><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ec8b10b0daf.png"                      alt="image-20230215153442298"                ></p><p>æ­¤æ—¶å¯ä»¥éšä¾¿æ‰¾ä¸ªå›¾ç‰‡åšå¤´åƒï¼Œçœ‹çœ‹èƒ½ä¸èƒ½åŠ è½½å‡ºæ¥ï¼›ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘éšä¾¿æ‰¾äº†ä¸€å¼ çº¯ç»¿è‰²çš„å›¾ç‰‡ï¼Œå¹¶å°†å…¶<a class="link"   href="http://www.ico51.cn/" >åœ¨çº¿è½¬æ¢ä¸ºico<i class="fas fa-external-link-alt"></i></a>ï¼Œæ”¾å…¥äº†ç«™ç‚¹çš„æ ¹ç›®å½•ã€‚</p><p>é‡å¯æœåŠ¡å™¨è¿›ç¨‹ï¼Œåˆ·æ–°æµè§ˆå™¨å†æ¬¡è¯·æ±‚ï¼Œå¯ä»¥çœ‹åˆ°æˆåŠŸå‡ºç°äº†ç«™ç‚¹çš„å¤´åƒï¼›</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ec7575b082e.png"                      alt="image-20230215140232033"                ></p><h2 id="3-5-å¸¸è§å‚æ•°è¡¨"><a href="#3-5-å¸¸è§å‚æ•°è¡¨" class="headerlink" title="3.5 å¸¸è§å‚æ•°è¡¨"></a>3.5 å¸¸è§å‚æ•°è¡¨</h2><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ec8de7299b2.png"                      alt="img"                ></p><h1 id="4-è¯·æ±‚æ–¹æ³•"><a href="#4-è¯·æ±‚æ–¹æ³•" class="headerlink" title="4.è¯·æ±‚æ–¹æ³•"></a>4.è¯·æ±‚æ–¹æ³•</h1><p>ä¸€èˆ¬æˆ‘ä»¬è·å–ä¸€ä¸ªç½‘é¡µï¼Œç”¨çš„éƒ½æ˜¯GETæ–¹æ³•ã€‚æ¥ä¸‹æ¥ç”¨ä¸€ä¸ªå¸¦æŒ‰é’®çš„è¡¨å•åˆ›å»ºè¯·æ±‚ï¼Œå°è¯•å‘æœåŠ¡ç«¯å‘é€<code>&lt;query&gt;</code>å‚æ•°</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>èœé¸Ÿæ•™ç¨‹(runoob.com)<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>æˆ‘çš„ç¬¬ä¸€ä¸ªæ ‡é¢˜<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘çš„ç¬¬ä¸€ä¸ªæ®µè½ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/a/index.html&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">    Username: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    Password: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;passwd&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="4-1-GET"><a href="#4-1-GET" class="headerlink" title="4.1 GET"></a>4.1 GET</h2><p>åœ¨methodé‡Œé¢ï¼Œæˆ‘ä»¬æŒ‡å®šäº†getæ–¹æ³•ï¼Œæ­¤æ—¶</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/a/index.html&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">    Username: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    Password: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;passwd&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶é¡µé¢ä¸­å‡ºç°äº†ä¸¤ä¸ªè¾“å…¥æ¡†ï¼Œä¾›æˆ‘ä»¬è¾“å…¥å¯†ç ï¼Œä¸”å¯†ç ä¼šæ˜¾ç¤ºä¸º<code>****</code>è€Œä¸æ˜¯æ˜æ–‡</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ec89644d733.png"                      alt="image-20230215152726050"                ></p><p>ç‚¹å‡»æŒ‰é’®ï¼Œä¼šè·³è½¬åˆ°ä¸€ä¸ª404é¡µé¢ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬çš„<code>a/index.html</code>è·¯å¾„å¹¶ä¸æ”¯æŒå‚æ•°è¯·æ±‚ï¼Œæ‰€ä»¥å‘é€äº†404é”™è¯¯ç </p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ec89a063d20.png"                      alt="image-20230215152834203"                ></p><p>ä¸è¿‡è¿™ä¸é‡è¦ï¼Œæˆ‘ä»¬çœ‹çœ‹åç«¯æ‰“å°çš„å†…å®¹ã€‚å…¶ä¸­å‚æ•°æ˜¯è¿½åŠ åˆ°urlä¸­ï¼Œä»¥æ˜æ–‡ä¼ è¾“è¿‡æ¥çš„ï¼›æ­£æ–‡éƒ¨åˆ†ä¸ºç©ºï¼Œå¹¶æ²¡æœ‰æºå¸¦å‚æ•°</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ec8b5dd10c0.png"                      alt="image-20230215153559515"                ></p><h2 id="4-2-POST"><a href="#4-2-POST" class="headerlink" title="4.2 POST"></a>4.2 POST</h2><p>å°†è¯·æ±‚æ–¹æ³•æ”¹æˆpostï¼Œå†æ¬¡å°è¯•</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/a/index.html&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    Username: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    Password: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;passwd&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™èƒ½æ­£å¸¸æ˜¾ç¤ºå‡º<code>a/index.html</code>é¡µé¢ï¼Œurlä¸­ä¸å†å¸¦æœ‰å‚æ•°</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ec8beb1e0c5.png"                      alt="image-20230215153820898"                ></p><p>æ­¤æ—¶æŸ¥çœ‹åç«¯ä¸­çš„ä¿¡æ¯ï¼Œèƒ½çœ‹åˆ°è¯·æ±‚æ–¹æ³•å˜ä¸ºPOSTï¼Œå‚æ•°å‡ºç°åœ¨äº†æ­£æ–‡éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯urlä¸­</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ec8c2e7faa5.png"                      alt="image-20230215153928118"                ></p><h2 id="4-3-GET-x2F-POSTåŒºåˆ«"><a href="#4-3-GET-x2F-POSTåŒºåˆ«" class="headerlink" title="4.3 GET&#x2F;POSTåŒºåˆ«"></a>4.3 GET&#x2F;POSTåŒºåˆ«</h2><p>è¿™ä¹Ÿæ˜¯GETå’ŒPOSTæ–¹æ³•çš„åŒºåˆ«ä¹‹ä¸€ï¼š</p><ul><li>GETæ–¹æ³•é€šè¿‡urlä¼ å‚</li><li>POSTæ–¹æ³•ä¼šå°†urlå‚æ•°æå–å‡ºæ¥ï¼Œæ‹¼æ¥åˆ°æ­£æ–‡éƒ¨åˆ†</li></ul><p>ç”±æ­¤èƒ½æ¨å‡ºäºŒè€…çš„å®‰å…¨æ€§åŒºåˆ«</p><ul><li>GETæ–¹æ³•ç›¸å¯¹ä¸å®‰å…¨ï¼Œå› ä¸ºå‚æ•°ç›´æ¥ä»¥æ˜æ–‡è´´åœ¨äº†urlä¸Š</li><li>POSTæ–¹æ³•ä»¥æ­£æ–‡ä¼ å‚ï¼Œä½¿ç”¨httpsåè®®çš„æ—¶å€™èƒ½è¿›è¡ŒåŠ å¯†ï¼Œç›¸å¯¹è¾ƒå®‰å…¨</li></ul><h2 id="4-4-æ›´å¤šæ–¹æ³•"><a href="#4-4-æ›´å¤šæ–¹æ³•" class="headerlink" title="4.4 æ›´å¤šæ–¹æ³•"></a>4.4 æ›´å¤šæ–¹æ³•</h2><p>httpè¯·æ±‚è¿˜æ”¯æŒæ›´å¤šæ–¹æ³•ï¼Œå¦‚ä¸‹</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ec8daba6e19.png"                      alt="img"                ></p><h1 id="5-çŠ¶æ€ç "><a href="#5-çŠ¶æ€ç " class="headerlink" title="5.çŠ¶æ€ç "></a>5.çŠ¶æ€ç </h1><h2 id="5-1-çŠ¶æ€ç è¡¨"><a href="#5-1-çŠ¶æ€ç è¡¨" class="headerlink" title="5.1 çŠ¶æ€ç è¡¨"></a>5.1 çŠ¶æ€ç è¡¨</h2><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå“åº”çŠ¶æ€ç çš„æ€»è¡¨</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ec8ef551dec.png"                      alt="image-20230215155118813"                ></p><h2 id="5-2-404-x2F-403çŠ¶æ€ç "><a href="#5-2-404-x2F-403çŠ¶æ€ç " class="headerlink" title="5.2 404&#x2F;403çŠ¶æ€ç "></a>5.2 404&#x2F;403çŠ¶æ€ç </h2><p>æˆ‘ä»¬èƒ½çœ‹åˆ°404å’Œ403éƒ½æ˜¯å®¢æˆ·ç«¯çŠ¶æ€ç ï¼Œä¸ºä»€ä¹ˆè¯´æ˜¯å®¢æˆ·ç«¯é”™è¯¯å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºä½ å‘æœåŠ¡å™¨è¯·æ±‚äº†ä¸€ä¸ªæœåŠ¡å™¨æ²¡æœ‰çš„èµ„æºï¼Œ<strong>è¿™ä¸ªé—®é¢˜ä¸åº”è¯¥æ˜¯æœåŠ¡å™¨çš„é—®é¢˜</strong>ã€‚</p><p>è¿™å°±å¥½æ¯”ä½ å»è¥¿ç“œæ‘Šä¹°è‚‰ï¼Œäººå®¶å‹æ ¹ä¸å–è‚‰ã€‚é—®é¢˜å‡ºåœ¨ä½ èº«ä¸Šï¼Œä½ ä¸åº”è¯¥æ‰¾è¥¿ç“œæ‘Šè€æ¿ä¹°è‚‰ã€‚æ‰€ä»¥404çŠ¶æ€ç ï¼Œåº”è¯¥æ˜¯å®¢æˆ·ç«¯çš„é—®é¢˜ï¼</p><p>è€Œ403çŠ¶æ€ç çš„å«ä¹‰æ˜¯<code>403 forbidden</code>ï¼ŒæœåŠ¡å™¨æ‹’ç»äº†ä½ çš„è¯·æ±‚ï¼ˆä½ æ²¡æœ‰æƒé™è®¿é—®ï¼‰è¿™ä¹Ÿæ˜¯å®¢æˆ·ç«¯çš„é—®é¢˜ã€‚ä½ ä¸èƒ½å»è¶…å¸‚ä¹°ä¸œè¥¿ï¼Œç„¶åé—®è€æ¿èƒ½ä¸èƒ½è®©ä½ çœ‹çœ‹è€æ¿çš„é’±ç½å­ã€‚è€æ¿è‚¯å®šä¸ç»™ä½ çœ‹å•Šï¼æ‰€ä»¥æ‰ä¼šå‘Šè¯‰ä½ 403ï¼Œä¸ç»™ä½ è®¿é—®ã€‚</p><h2 id="5-3-5xxçŠ¶æ€ç "><a href="#5-3-5xxçŠ¶æ€ç " class="headerlink" title="5.3 5xxçŠ¶æ€ç "></a>5.3 5xxçŠ¶æ€ç </h2><p>ä»€ä¹ˆæ—¶å€™ä¼šå‡ºç°æœåŠ¡å™¨é”™è¯¯çš„5xxçŠ¶æ€ç å‘¢ï¼Ÿ</p><p>å½“ä½ è¯·æ±‚ä¸€ä¸ªæœåŠ¡ï¼ŒæœåŠ¡ç«¯éœ€è¦å¤„ç†ä¹‹åç»™ä½ è¿”å›ç»“æœã€‚æ­¤æ—¶æœåŠ¡å™¨åœ¨å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½å› ä¸ºç¨‹åºæœ‰bugæå‰é€€å‡ºï¼Œè¿™æ—¶å€™å°±åº”è¯¥ç»™å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª<code>5xx</code>çŠ¶æ€ç ï¼Œæ ‡è¯†æœåŠ¡å™¨åœ¨å¤„ç†ä½ çš„è¯·æ±‚çš„è¿‡ç¨‹ä¸­ï¼Œå‡ºç°äº†é”™è¯¯ï¼Œæ— æ³•è¿”å›ç»“æœã€‚</p><h2 id="5-4-301-x2F-302é‡å®šå‘"><a href="#5-4-301-x2F-302é‡å®šå‘" class="headerlink" title="5.4 301&#x2F;302é‡å®šå‘"></a>5.4 301&#x2F;302é‡å®šå‘</h2><p>å…³äº3å¼€å¤´çš„çŠ¶æ€ç ï¼Œä¸»è¦è°ˆè°ˆä¸‹é¢è¿™ä¸¤ä¸ª</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">301 æ°¸ä¹…é‡å®šå‘</span><br><span class="line">302 ä¸´æ—¶é‡å®šå‘</span><br></pre></td></tr></table></figure><p>ä¸ºä½•ä¸€ä¸ªæ˜¯æ°¸ä¹…ï¼Œä¸€ä¸ªæ˜¯ä¸´æ—¶å‘¢ï¼Ÿ</p><p>åœ¨httpè¿›è¡Œå“åº”çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯å¯ä»¥å‘é€ä¸€ä¸ª<code>location</code>å‚æ•°ï¼Œå‘é€ä¸€ä¸ªæ–°çš„urlç»™å®¢æˆ·ç«¯ï¼›æˆ‘ä»¬çš„æµè§ˆå™¨åœ¨æ”¶åˆ°è¿™ä¸ªå‚æ•°åï¼Œä¼šè‡ªåŠ¨æ‰“å¼€å¯¹åº”çš„é¡µé¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Location: https://www.baidu.com/</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸Šé¢çš„ä»£ç æ¥æµ‹è¯•ä¸€ä¸‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°è¯•è¿›è¡Œ302é‡å®šå‘</span></span><br><span class="line">string response = <span class="string">&quot;HTTP/1.1 302 Temporarily moved\r\n&quot;</span>;</span><br><span class="line">response+= <span class="string">&quot;Location: https://www.baidu.com/\r\n&quot;</span>;</span><br><span class="line">response+= <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘é€ç»™ç”¨æˆ·</span></span><br><span class="line"><span class="built_in">send</span>(sock, response.<span class="built_in">c_str</span>(), response.<span class="built_in">size</span>(), <span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶è®¿é—®æˆ‘ä»¬è‡ªå·±çš„<code>IP:ç«¯å£</code>ï¼Œä¼šè·³è½¬åˆ°ç™¾åº¦çš„é¡µé¢ã€‚è¿™å°±æ˜¯é‡å®šå‘çš„ä½œç”¨</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ec9497019d5.png"                      alt="image-20230215161520817"                ></p><ul><li>é‚£ä¸´æ—¶é‡å®šå‘å’Œæ°¸ä¹…é‡å®šå‘æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢?</li></ul><p>å‡å¦‚æˆ‘è®¾ç«‹äº†ä¸€ä¸ªå…¬å¼€ç«™ç‚¹ï¼ŒåŸŸåæ˜¯<code>test.com</code>ï¼Œè¿™å‡ å¹´ä¸€ç›´æä¾›æœåŠ¡ï¼Œç§¯ç´¯äº†ä¸€éƒ¨åˆ†çš„ç”¨æˆ·ã€‚è¿‡äº†ä¸€ä¼šï¼Œæˆ‘ä¸æƒ³è¦è¿™ä¸ªåŸŸåäº†ï¼Œæƒ³æ¢ä¸€ä¸ª<code>test.cn</code>ï¼›å¯ç”¨æˆ·å·²ç»æœ‰é‚£ä¹ˆå¤šï¼Œå¤§å®¶éƒ½åªè®°å¾—ä½ çš„<code>test.com</code>ï¼Œå¦‚æœç›´æ¥æ›´æ¢åŸŸåï¼Œå°±ä¼šå¯¼è‡´ç”¨æˆ·æ— æ³•è®¿é—®<code>test.com</code>ï¼Œä»¥ä¸ºä½ è·‘è·¯äº†ï¼Œå°±æ”¾å¼ƒä½¿ç”¨ä½ çš„ç½‘é¡µã€‚</p><p>è¿™æ ·çš„ç»“æœæ˜¾è€Œæ˜“è§ï¼šä¸¥é‡çš„å®¢æˆ·æµå¤±ï¼</p><p>æ‰€ä»¥ï¼Œä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å¯ä»¥å…ˆå°†æœåŠ¡è¿ç§»åˆ°<code>test.cn</code>æ–°åŸŸåï¼Œåœ¨æ—§åŸŸå<code>test.com</code>ä¸­è®¾ç½®ä¸€ä¸ª301é‡å®šå‘åˆ°<code>test.cn</code>ï¼Œå‘Šè¯‰ç”¨æˆ·æˆ‘æ¢æ–°åŸŸåäº†ã€‚è¿™æ ·æŒç»­ä¸€æ®µæ—¶é—´åï¼Œç­‰åˆ°<code>test.com</code>çš„ä½¿ç”¨è€…ä¸å¤šäº†ï¼Œå°±å¯ä»¥è€ƒè™‘å½»åº•å–æ¶ˆ<code>test.com</code>çš„è§£æï¼Œå…³åœæ­¤åŸŸåäº†ã€‚</p><p>åœ¨ä¸Šé¢çš„åœºæ™¯ä¸­ï¼Œæˆ‘æ˜¯éœ€è¦æ›´æ¢åŸŸåï¼Œæ˜¯æ°¸ä¹…æ›´æ¢ã€‚æˆ‘ä»¬å°±åº”è¯¥æŠŠçŠ¶æ€ç è®¾ç½®ä¸º301ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯è¿™ä¸ªåŸŸåå°†è¢«æ°¸ä¹…é‡å®šå‘åˆ°å¦å¤–ä¸€ä¸ªåŸŸåä¸Š</p><hr><p>å¦å¤–çš„æƒ…å†µæ˜¯ï¼Œæˆ‘æœ‰ä¸€ä¸ª<code>example.com</code>åŸŸåï¼Œæˆ‘çš„æœåŠ¡éœ€è¦è¿›è¡Œç»´æŠ¤ï¼›æ­¤æ—¶å°±å°†<code>example.com</code>é‡å®šå‘åˆ°å¦å¤–ä¸€ä¸ªåŸŸå<code>example.cn</code>ï¼ŒæŒ‡å‘å¦å¤–ä¸€ä¸ªæœåŠ¡å™¨ï¼Œè®©è¿™ä¸ªæœåŠ¡å™¨ä¸´æ—¶æä¾›æœåŠ¡ã€‚</p><p>æœåŠ¡ç»´æŠ¤å®Œæ¯•åï¼Œå°±å°†é‡å®šå‘å–æ¶ˆï¼Œç»§ç»­ä½¿ç”¨å½“å‰çš„æœåŠ¡å™¨ã€‚</p><p>è¿™ä¸ªåœºæ™¯ä¸­ï¼Œé‡å®šå‘åªæ˜¯ç»´æŠ¤æœŸé—´çš„ä¸€ä¸ªä¸´æ—¶ç­–ç•¥ï¼Œæ‰€ä»¥çŠ¶æ€ç è®¾ç½®æˆ302ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯æˆ‘åªæ˜¯ä¸´æ—¶è¿›è¡Œé‡å®šå‘ï¼Œæˆ‘è¿˜ä¼šå›æ¥çš„ã€‚</p><h1 id="6-cookie-x2F-session"><a href="#6-cookie-x2F-session" class="headerlink" title="6.cookie&#x2F;session"></a>6.cookie&#x2F;session</h1><p>æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œå½“æˆ‘ä»¬åœ¨ä¸€ä¸ªwebé¡µé¢ä¸­ç™»å½•äº†ï¼ˆå¦‚github&#x2F;gitee&#x2F;csdnï¼‰è¿™ä¸ªç½‘é¡µåœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…éƒ½ä¼šä¿æŒç™»å½•ï¼Œç›´åˆ°è¶…æ—¶äº¦æˆ–è€…æ˜¯å‡ºç°äº†å¼‚åœ°è®¿é—®ã€‚</p><p>å‡å¦‚ä½ ç°åœ¨æœ‰ä¸ªç½‘é¡µï¼Œä½†æ˜¯æ¯æ¬¡ç”¨æˆ·è®¿é—®çš„æ—¶å€™ï¼Œéƒ½éœ€è¦é‡æ–°è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œåˆšåˆšè¾“å…¥è¿‡äº†ï¼Œæ¢ä¸€ä¸ªé¡µé¢åˆä¸è¡Œäº†ã€‚è¿™æ ·ä¸€æ¥ï¼Œç”¨æˆ·è¿˜ä¼šæƒ³ç”¨ä½ è¿™ä¸ªæœåŠ¡å—ï¼Ÿ</p><p>ä¸ºäº†é¿å…æ­¤ç±»é—®é¢˜ï¼Œhttpåè®®å°±éœ€è¦å¼•å…¥å…¶ä»–çš„å‚æ•°ï¼Œæ¥ç»´æŒç”¨æˆ·çš„ç™»å½•ä¼šè¯ã€‚cookie&#x2F;sessionä¾¿æ˜¯å› æ­¤è€Œæ¥çš„ã€‚</p><h2 id="6-1-set-cookie"><a href="#6-1-set-cookie" class="headerlink" title="6.1 set cookie"></a>6.1 set cookie</h2><p>æœåŠ¡ç«¯å¯ä»¥åœ¨å“åº”å¤´ä¸­å¸¦ä¸Š<code>Set-Cookie</code>å­—æ®µï¼Œç»™å®¢æˆ·ç«¯è®¾ç½®ä¸Šcookie</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response += <span class="string">&quot;Set-Cookie: This is my cookie test\r\n&quot;</span>;</span><br></pre></td></tr></table></figure><p>æ‰“å¼€f12å¼€å‘è€…ç•Œé¢ï¼Œèƒ½åœ¨å…¶ä¸­çœ‹åˆ°æˆ‘ä»¬è®¾ç½®çš„cookie</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63eca303c2533.png"                      alt="image-20230215171652910"                ></p><p>å†æ¬¡åˆ·æ–°ç½‘é¡µï¼Œå¯ä»¥çœ‹åˆ°åœ¨ä¹‹åçš„è¯·æ±‚ä¸­ï¼Œæµè§ˆå™¨éƒ½ä¼šå‘é€ä¸€æ¬¡æœåŠ¡å™¨è®¾ç½®çš„cookieã€‚è¿™æ ·æœåŠ¡ç«¯åœ¨æ”¶åˆ°cookieåï¼Œå°±èƒ½è§£æåˆ°è‡ªå·±è®¾ç½®çš„cookieï¼Œç¡®å®šäº†æŒ‡å®šçš„ç”¨æˆ·</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63eca34befdf0.png"                      alt="image-20230215171805924"                ></p><p>åœ¨æœåŠ¡å™¨ç«¯ä¹Ÿèƒ½çœ‹åˆ°è¿™ä¸ªå­—æ®µ</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63eca54f23dfe.png"                      alt="image-20230215172640992"                ></p><h2 id="6-2-ä»€ä¹ˆæ˜¯cookie"><a href="#6-2-ä»€ä¹ˆæ˜¯cookie" class="headerlink" title="6.2 ä»€ä¹ˆæ˜¯cookie"></a>6.2 ä»€ä¹ˆæ˜¯cookie</h2><p>æ‰€è°“cookieï¼Œå…¶å®å°±æ˜¯æµè§ˆå™¨å¸®æˆ‘ä»¬å­˜å–äº†ä¸€å®šçš„èº«ä»½ä¿¡æ¯åœ¨æœ¬åœ°ï¼ˆå†…å­˜orç£ç›˜ï¼‰</p><p>ä¸‹ä¸€æ¬¡æ‰“å¼€ç‰¹å®šçš„ç½‘é¡µçš„æ—¶å€™ï¼Œå°±èƒ½æ˜¾ç¤ºå¯¹åº”çš„èº«ä»½ä¿¡æ¯ï¼ˆä¸ä¸€å®šæ˜¯ä½ çš„è´¦æˆ·å¯†ç ï¼‰ï¼Œå¹¶å‘Šè¯‰æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å°±è¯†åˆ«åˆ°äº†ä½ å½“å‰çš„ç”¨æˆ·ï¼Œå¹¶ä¸ºä½ ä¿æŒç™»é™†çŠ¶æ€ã€‚</p><p>æ—¢ç„¶æ˜¯ä¿å­˜åœ¨ç”¨æˆ·æœ¬åœ°çš„ï¼Œé‚£å°±æœ‰å¯èƒ½è¢«çªƒå–ã€‚ä¸€äº›æ¶æ„è½¯ä»¶å°±ä¼šå»æ‰«æä½ æµè§ˆå™¨æœ¬åœ°ç¼“å­˜ä¸­çš„cookieä¿¡æ¯ï¼Œå¯¹äºä¸€äº›å®‰å…¨æ€§ä¸é«˜çš„ç½‘ç«™è€Œè¨€ï¼Œæœ‰äº†è¿™ä¸ªcookieï¼Œå°±ç›¸å½“äºä»–æœ‰äº†ä½ çš„è´¦æˆ·ï¼Œå¯ä»¥ç›´æ¥ç™»å½•ä½ çš„è´¦æˆ·è¿›è¡Œæ“ä½œã€‚</p><p>å› æ­¤ï¼Œå¼•å…¥äº†å¦å¤–ä¸€ç§èº«ä»½è®¤è¯çš„æ–¹å¼ <code>cookie+session</code></p><h2 id="6-3-cookie-session"><a href="#6-3-cookie-session" class="headerlink" title="6.3 cookie+session"></a>6.3 cookie+session</h2><p>æ¯”èµ·å°†èº«ä»½ä¿¡æ¯å­˜åˆ°å®¢æˆ·ç«¯ï¼Œå­˜è‡³æœåŠ¡ç«¯æ›´ä¸ºå®‰å…¨ï¼ˆæ”»å‡»ä¼ä¸šæœåŠ¡å™¨çš„æˆæœ¬ï¼Œæ¯”åœ¨ç”¨æˆ·ç«¯æ¤å…¥æœ¨é©¬ç¨‹åºçš„æˆæœ¬æ›´é«˜ï¼‰</p><ul><li>ç”¨æˆ·ä½¿ç”¨è´¦æˆ·å¯†ç è¯·æ±‚ç™»å½•ï¼ŒæœåŠ¡å™¨æ”¶åˆ°ç™»å½•è¯·æ±‚ï¼ŒéªŒè¯æˆåŠŸåï¼Œç»™å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ª<code>å”¯ä¸€å­—ç¬¦ä¸²session_id</code>æ¥æ ‡è¯†ç”¨æˆ·</li><li>å®¢æˆ·ç«¯ä¸‹ä¸€æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œå¸¦ä¸Šäº†è¿™ä¸ªå”¯ä¸€å­—ç¬¦ä¸²</li><li>æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œåœ¨æœ¬åœ°çš„<code>session_id</code>åº“ä¸­æŸ¥æ‰¾è¿™ä¸ªidï¼Œæ‰¾åˆ°åï¼Œå°±å°†ç”¨æˆ·ä¿¡æ¯åŒ¹é…ç»™å®¢æˆ·ç«¯ï¼Œç›¸å½“äºå®¢æˆ·ç«¯ç™»å½•æˆåŠŸäº†</li></ul><p>è¿™æ ·ï¼Œå°±å°†åŸæœ¬å­˜åœ¨ç”¨æˆ·æœ¬åœ°çš„èº«ä»½è®¤è¯ä¿¡æ¯ï¼Œ<strong>å­˜åˆ°äº†æœåŠ¡ç«¯ä¸­</strong>ã€‚å®¢æˆ·ç«¯å°±åªå‰©ä¸‹ä¸€ä¸ªå­¤é›¶é›¶çš„å­—ç¬¦ä¸²idï¼Œä¸ä¼šæœ‰ç”¨æˆ·çš„ç§å¯†ä¿¡æ¯ã€‚å³ä¾¿ä¸¢å¤±ï¼Œä¹Ÿä¸ä¼šå½±å“ç”¨æˆ·çš„éšç§ã€‚</p><ul><li>ä½ å¯èƒ½ä¼šè¯´ï¼Œé‚£æˆ‘å·èµ°è¿™ä¸ªidä¸ä¹Ÿæ˜¯ä¸€æ ·çš„æ•ˆæœï¼Ÿ</li></ul><p>å…¶å®æ²¡æœ‰é‚£ä¹ˆç®€å•ï¼ŒæœåŠ¡ç«¯å¯ä»¥å°†<code>session_id</code>å’Œç”¨æˆ·çš„ipæˆ–è€…ç»ˆç«¯User-Agentç»‘å®šï¼Œè¿™æ ·åªè¦ç”¨æˆ·<strong>åˆ‡æ¢è®¾å¤‡</strong>æˆ–è€…<strong>æ¢äº†ç™»å½•çš„åœ°ç‚¹</strong>ï¼ˆæ¯”å¦‚ä»ä¸‰äºšè·‘åˆ°äº†å“ˆå°”æ»¨ï¼‰å°±ç›´æ¥è®©<code>session_id</code>å¤±æ•ˆï¼Œè¦æ±‚ç”¨æˆ·é‡æ–°ç™»å½•ã€‚</p><h1 id="7-é•¿çŸ­é“¾æ¥"><a href="#7-é•¿çŸ­é“¾æ¥" class="headerlink" title="7.é•¿çŸ­é“¾æ¥"></a>7.é•¿çŸ­é“¾æ¥</h1><p>åœ¨æ—©æœŸçš„httpåè®®ä¸­ï¼Œé‡‡ç”¨çš„éƒ½æ˜¯çŸ­é“¾æ¥ï¼Œä¸€æ¬¡è¿æ¥åªèƒ½å¤„ç†1æ¬¡httpè¯·æ±‚ã€‚å½“æ—¶çš„ç½‘é¡µå¤§å¤šä»¥æ–‡å­—ä¸ºä¸»ï¼Œæ•°æ®é‡å¾ˆå°ï¼Œä¸€èµ·è¯·æ±‚ä¹Ÿèƒ½å¤Ÿæ»¡è¶³éœ€æ±‚ã€‚</p><p>ä½†ç°åœ¨æ—¶ä»£å·²ç»å˜äº†ï¼Œä¸€ä¸ªç½‘é¡µé‡Œé¢æœ‰å›¾ç‰‡ï¼Œæ–‡å­—ï¼ŒéŸ³é¢‘ï¼Œè§†é¢‘ã€‚è¿™äº›æ–‡ä»¶çš„ä½“ç§¯æ‰“èµ·æ¥ä¹‹åï¼ŒçŸ­é“¾æ¥çš„æ–¹å¼å°±ä¸é€‚ç”¨äº†ã€‚æ­¤æ—¶å°±å‡ºç°äº†é•¿é“¾æ¥ï¼Œä¸€æ¬¡tcpé“¾æ¥ï¼Œå¯ä»¥æŒç»­ä¼ è¾“æ•°æ®ã€‚</p><p>ç›¸æ¯”çŸ­é“¾æ¥ï¼Œé•¿é“¾æ¥è¿ä¸Šä¹‹åï¼Œèƒ½æŒç»­ä¼ è¾“æ•°æ®ï¼Œ<strong>é¿å…äº†tcp3æ¬¡æ¡æ‰‹çš„æ¶ˆè€—</strong>ï¼Œæé«˜äº†æ•°æ®ä¼ è¾“çš„æ•ˆç‡ï¼</p><h2 id="7-1-Connetion"><a href="#7-1-Connetion" class="headerlink" title="7.1 Connetion"></a>7.1 Connetion</h2><p>åœ¨æœ¬æ–‡çš„<code>3.4</code>ä¸­ï¼Œä¾¿å‡ºç°äº†è¿™ä¸ªå‚æ•°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¼šæœ‰ä¸‹é¢ä¸¤ç§æƒ…å†µ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Connetion: keep-alive</span><br><span class="line">Connetion: closed</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>keep-alive</code>å°±æ˜¯é•¿é“¾æ¥ï¼Œ<code>closed</code>ä»£è¡¨å½“å‰ç«¯å£åªæ”¯æŒçŸ­é“¾æ¥ã€‚</p><p>å½“å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚å¤´ä¸­åŒ…å«<code>Connetion: keep-alive</code>å­—æ®µï¼Œå¦‚æœæœåŠ¡å™¨æ”¯æŒé•¿é“¾æ¥ï¼Œå°±éœ€è¦åœ¨å“åº”å¤´ä¸­ä¹Ÿå¸¦ä¸Š<code>Connetion: keep-alive</code>ï¼Œè¿™æ ·åŒæ–¹åå•†æˆåŠŸï¼Œå¤§å®¶éƒ½å¯ä»¥ä½¿ç”¨é•¿é“¾æ¥ã€‚</p><p>å¦‚æœæœåŠ¡å™¨çš„å“åº”å¤´ä¸­æ²¡æœ‰å¸¦<code>Connetion: keep-alive</code>ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å°±ä¼šè®¤ä¸ºæœåŠ¡å™¨ä¸æ”¯æŒé•¿é“¾æ¥ï¼Œä¸‹æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œä¼šé‡æ–°å‘æœåŠ¡å™¨é“¾æ¥ï¼Œå†è·å–èµ„æºã€‚</p><p>å¦‚æœå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä»»æ„ä¸€æ–¹çš„å“åº”å¤´ä¸­åŒ…å«<code>Connetion: closed</code>ï¼Œé‚£ä¹ˆå°±ä¼šè®¤ä¸ºå½“å‰çš„ä¼šè¯åªæ”¯æŒçŸ­é“¾æ¥ï¼Œä¸‹æ¬¡è¯·æ±‚ä¼šé‡æ–°å»ºç«‹é“¾æ¥ã€‚</p><h2 id="7-2-httpå’Œtcpçš„å…³ç³»"><a href="#7-2-httpå’Œtcpçš„å…³ç³»" class="headerlink" title="7.2 httpå’Œtcpçš„å…³ç³»"></a>7.2 httpå’Œtcpçš„å…³ç³»</h2><p>httpè™½ç„¶æ˜¯åŸºäºtcpçš„ï¼Œä½†httpæœ¬èº«æ˜¯æ— é“¾æ¥çš„ã€‚</p><blockquote><p>ä¸¾ä¸ªæœ€æ˜æ˜¾çš„æ —å­ï¼Œåœ¨ä½ æ‰“å¼€ä¸€ä¸ªç½‘é¡µä¹‹åï¼Œä½ å…³é—­æ‰è‡ªå·±çš„wifiï¼Œä½ çš„ç½‘é¡µå¹¶ä¸ä¼šå› æ­¤æ¶ˆå¤±ã€‚åªæ˜¯æ— æ³•è¿›è¡Œåç»­æ“ä½œè€Œå·²ã€‚</p></blockquote><p>httpæ˜¯ä¸€ä¸ªæ— é“¾æ¥çš„åº”ç”¨å±‚åè®®ï¼Œå…¶å€ŸåŠ©tcpè¿›è¡Œæ•°æ®çš„æµå¼ä¼ è¾“ï¼Œä½†ä¸ä¸€å®šéœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¿æŒè¿æ¥ã€‚</p><p>æ‰€ä»¥ï¼Œhttpå°±å¯ä»¥å€ŸåŠ©å•ä¸ªtcpå¥—æ¥å­—<strong>æŒç»­çš„ä¼ è¾“æ•°æ®</strong>ï¼Œä¹Ÿå°±å¤©ç„¶åœ°æ”¯æŒäº†é•¿é“¾æ¥é€šä¿¡ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œhttpåªæ˜¯å€Ÿç”¨äº†tcpçš„èƒ½åŠ›ï¼Œå…¶æ— è¿æ¥çš„ç‰¹æ€§å’Œtcpæ²¡æœ‰å…³ç³»ï¼</p><h2 id="7-3-pipeline"><a href="#7-3-pipeline" class="headerlink" title="7.3 pipeline"></a>7.3 pipeline</h2><p>è¿™å…¶ä¸­ä¼šç‰µæ‰¯åˆ°ä¸€ä¸ª<code>pipeline</code>ï¼Œå…¶ç»´æŠ¤äº†httpé•¿é“¾æ¥è¯·æ±‚æ—¶çš„<strong>å“åº”é¡ºåº</strong>ã€‚</p><p>æ¯”å¦‚äººå®¶éœ€è¦åŠ è½½ä¸€ä¸ªç½‘é¡µï¼ŒæœåŠ¡ç«¯åº”è¯¥å…ˆæŠŠç½‘é¡µçš„æ•´ä½“æ¡†æ¶ç»™ç”¨æˆ·åŠ è½½å‡ºæ¥ï¼Œå†ç»™ç”¨æˆ·åŠ è½½å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ç­‰èµ„æºã€‚ä¸‹å›¾Bç«™çš„åŠ è½½å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ —å­ã€‚</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ee31578364a.png"                      alt="image-20230216213625496"                ></p><p>å¦åˆ™ä¹±åºäº†ï¼Œæ¯”å¦‚åªå‡ºç°äº†ä¸€ä¸ªå­¤é›¶é›¶çš„å›¾ç‰‡ï¼Œå°±ä¼šè®©äººæ„Ÿè§‰éå¸¸å¥‡æ€ªã€‚</p><h1 id="8-https"><a href="#8-https" class="headerlink" title="8.https"></a>8.https</h1><p>å› ä¸ºhttpçš„æ•°æ®æ˜¯æ— åŠ å¯†æ˜æ–‡å‘é€çš„ï¼Œç›¸å¯¹æ¥è¯´å¹¶ä¸æ˜¯éå¸¸çš„å®‰å…¨ï¼›ä¸ºäº†å®ç°æ•°æ®åŠ å¯†ï¼Œhttpsåœ¨httpçš„ä¸‹å±‚æ·»åŠ äº†ä¸€ä¸ª<code>SSL/TLS</code>è½¯ä»¶å±‚ï¼Œæ¥è¿›è¡Œæ•°æ®åŠ è§£å¯†å·¥ä½œ</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ecc49657516.png"                      alt="image-20230215193931213"                ></p><h2 id="8-1-ä¸ºå•¥è¦åŠ å¯†ï¼Ÿ"><a href="#8-1-ä¸ºå•¥è¦åŠ å¯†ï¼Ÿ" class="headerlink" title="8.1 ä¸ºå•¥è¦åŠ å¯†ï¼Ÿ"></a>8.1 ä¸ºå•¥è¦åŠ å¯†ï¼Ÿ</h2><p>è¦çŸ¥é“ï¼Œæ‰€æœ‰çš„åŠ å¯†å·¥ä½œï¼Œéƒ½æ˜¯ä¸ºäº†é˜²æ­¢æ•°æ®åœ¨ä¸­é—´ä¼ è¾“çš„è¿‡ç¨‹ï¼Œè¢«çªƒå–æˆ–ä¿®æ”¹ã€‚å¦‚æœæˆ‘ä»¬è¯·æ±‚ä¸€ä¸ªç½‘ç«™ç™»å½•çš„æ—¶å€™ï¼Œæ•°æ®åŒ…ä¸­å°±ä¼šåŒ…å«æˆ‘ä»¬çš„è´¦æˆ·å¯†ç ã€‚å¦‚æœè¢«çªƒå–ï¼Œæˆ‘ä»¬çš„éšç§å°±æ³„éœ²äº†ã€‚è¿™æ˜¯å¾ˆéš¾å—çš„ä¸€ä»¶äº‹ï¼</p><blockquote><p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆï¼Œæˆ‘ä»¬ç»å¸¸èƒ½å¬åˆ°<code>å…è´¹å…¬å…±wifiä¸å®‰å…¨</code>è¿™ä¸€è¯´æ³•ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨è¿™ä¸ªwifiä¸Šè¿›è¡Œçš„æ‰€æœ‰æ•°æ®äº¤æ¢ï¼Œéƒ½ä¼šèµ°è¿™ä¸ªwifiçš„è·¯ç”±å™¨ï¼Œå¾ˆå®¹æ˜“è¢«<code>ä¸­é—´äºº</code>çªƒå–å¹¶è·å–åˆ°æˆ‘ä»¬çš„æ•°æ®åŒ…ã€‚</p><p>è¿™ç§æƒ…å†µä¸‹ï¼Œhttpsçš„åŠ å¯†å°±æ›´æœ‰å¿…è¦äº†ï¼</p></blockquote><p>ä½†æ˜¯ï¼ŒåŠ å¯†è§£å¯†æ˜¯éœ€è¦æ—¶é—´çš„ï¼Œæ‰€ä»¥httpså“åº”çš„é€Ÿåº¦ä¼šç¨æ…¢äºhttpã€‚ä¸è¿‡å½“ä¸‹cpuçš„æ‰§è¡Œé€Ÿåº¦å·²ç»éå¸¸å¿«ï¼Œè¿™ç‚¹æ—¶é—´å·®è·å¾ˆå°ï¼Œä¸ä¼šç‰¹åˆ«å½±å“æˆ‘ä»¬çš„æ—¥å¸¸ä½¿ç”¨ï¼</p><p>ä¸è¿‡ï¼ŒåŠ å¯†å¹¶ä¸æ˜¯ä¸€ä¸ªä¸‡é‡‘æ²¹ï¼Œå¹¶ä¸æ˜¯è¯´åŠ å¯†äº†ä¹‹åçš„æ•°æ®å°±ä¸€å®šèƒ½é¿å…è¢«çªƒå–ã€‚ä½†åŠ å¯†å¯ä»¥å¤§å¤§æé«˜çªƒå–ç ´è§£çš„æˆæœ¬ï¼Œæ— å½¢ä¸­é™ä½äº†æ•°æ®è¢«çªƒå–çš„æ¦‚ç‡ï¼Œä¿è¯äº†ä¸€å®šçš„æ•°æ®å®‰å…¨ã€‚</p><h2 id="8-2-å¸¸è§åŠ å¯†æ–¹å¼"><a href="#8-2-å¸¸è§åŠ å¯†æ–¹å¼" class="headerlink" title="8.2 å¸¸è§åŠ å¯†æ–¹å¼"></a>8.2 å¸¸è§åŠ å¯†æ–¹å¼</h2><h3 id="8-2-1-å¯¹ç§°åŠ å¯†"><a href="#8-2-1-å¯¹ç§°åŠ å¯†" class="headerlink" title="8.2.1 å¯¹ç§°åŠ å¯†"></a>8.2.1 å¯¹ç§°åŠ å¯†</h3><p>æ‰€è°“å¯¹ç§°åŠ å¯†ï¼Œå¥½æ¯”æœ‰ä¸€ä¸ªå¸¦é”çš„ç›’å­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æœ‰ä¸€æŠŠé’¥åŒ™ã€‚å®¢æˆ·ç«¯å…ˆæŠŠä¿¡æ¯ä¸¢è¿›ç›’å­é‡Œï¼Œå†ç”¨ğŸ”‘é”ä¸Šç›’å­ï¼Œå‘é€ç»™æœåŠ¡ç«¯ã€‚æœåŠ¡ç«¯ç”¨ğŸ”‘æ‰“å¼€ç›’å­ï¼Œå–å‡ºæ•°æ®ã€‚</p><p>å› ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æŒæœ‰çš„é’¥åŒ™æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œæ‰€ä»¥è¢«ç§°ä¸ºå¯¹ç§°åŠ å¯†ã€‚åœ¨åŠ å¯†çš„åœºæ™¯ä¸‹ï¼Œé’¥åŒ™ä¸€èˆ¬è¢«ç§°ä¸º<code>å¯†é’¥</code></p><p>åœ¨ç½‘ç»œåœºæ™¯é‡Œï¼Œ<strong>å¯¹ç§°åŠ å¯†æ˜¯ä¸å¯å–çš„</strong>ã€‚åªè¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¼ è¾“å¯†é’¥çš„æ—¶å€™è¢«çªƒå–ï¼Œé‚£ä¹ˆåŒæ–¹çš„åŠ å¯†å°±å¤±æ•ˆäº†ã€‚å› ä¸ºæ˜¯ç”¨åŒä¸€ä¸ªå¯†é’¥æ¥åŠ å¯†è§£å¯†ï¼Œæˆ‘æ‹¿èµ°äº†ä½ çš„é’¥åŒ™ï¼Œè‡ªç„¶å°±èƒ½æ‰“å¼€ä½ è¿™æŠŠé”ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<font color=orange>å¯†é’¥çš„ä¼ è¾“ä¹Ÿéœ€è¦åŠ å¯†</font>ã€‚ä½†æ˜¯è¿™åˆå¼•å‡ºä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘éƒ½æ²¡æœ‰ä½ çš„å¯†é’¥ï¼Œæˆ‘æ€ä¹ˆè§£å¯†ä½ å‘è¿‡æ¥çš„å¯†é’¥ä¿¡æ¯ï¼Ÿè¿™æ˜¯ä¸€ä¸ª<code>å…ˆæœ‰è›‹è¿˜æ˜¯å…ˆæœ‰é¸¡</code>çš„æ­»å¾ªç¯ï¼</p><h3 id="8-2-2-éå¯¹ç§°åŠ å¯†"><a href="#8-2-2-éå¯¹ç§°åŠ å¯†" class="headerlink" title="8.2.2 éå¯¹ç§°åŠ å¯†"></a>8.2.2 éå¯¹ç§°åŠ å¯†</h3><p>éå¯¹ç§°åŠ å¯†åœºæ™¯ä¸‹ï¼Œä¼šæœ‰ä¸€ä¸ªå…¬é’¥å’Œç§é’¥</p><ul><li>ç§é’¥å¯¹æ•°æ®åŠ å¯†ï¼Œå˜æˆå¯†æ–‡</li><li>å…¬é’¥å¯¹æ•°æ®è§£å¯†ï¼Œå˜æˆæ˜æ–‡</li></ul><p>äºŒè€…ä¹Ÿå¯ä»¥åè¿‡æ¥</p><ul><li>ç§é’¥å¯¹æ•°æ®è§£å¯†</li><li>å…¬é’¥å¯¹æ•°æ®åŠ å¯†</li></ul><p>å…¶ä¸­æœ€å¸¸ç”¨çš„éå¯¹ç§°åŠ å¯†ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨<a href="https://blog.musnow.top/2022/05/09/note_linux/1%E4%BD%BF%E7%94%A8ssh%E8%BF%9E%E6%8E%A5git/">gitçš„sshæ“ä½œ</a>ä¸­ä½¿ç”¨è¿‡çš„<code>rsa</code>å¯†é’¥ï¼Œå…¶ä¸­å°±æœ‰ä¸€ä¸ª<code>.pem</code>å…¬é’¥å’Œä¸€ä¸ªç§é’¥ã€‚æˆ‘ä»¬å°†å…¬é’¥æä¾›ç»™githubï¼Œç§é’¥ä¿å­˜åˆ°æœ¬åœ°ï¼Œå°±èƒ½å®ç°æ— å¯†ç ä¸Šä¼ æ•°æ®åˆ°gitä»“åº“ã€‚</p><hr><p>ä½†æ˜¯éå¯¹ç§°åŠ å¯†è¿˜æ˜¯ä¼šå­˜åœ¨ä¸­é—´äººæ”»å‡»çš„é—®é¢˜ã€‚å…ˆçœ‹å¦‚ä¸‹å›¾ï¼Œä½ åº”è¯¥èƒ½å‘ç°ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªé‡è¦çš„ç¯èŠ‚ï¼Œ<strong>å°±æ˜¯æœåŠ¡ç«¯è¦æŠŠå…¬é’¥å‘é€ç»™å®¢æˆ·ç«¯</strong></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ee25050db71.png"                      alt="image-20230216204344555"                ></p><p>åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œå…¬é’¥æ˜¯å…¬å¼€ä¼ è¾“ç»™å®¢æˆ·ç«¯çš„ï¼Œä¹Ÿå°±æ˜¯åç»­æœåŠ¡å™¨å‘é€ç»™å®¢æˆ·ç«¯çš„æ‰€æœ‰ä¿¡æ¯ï¼Œéƒ½å¯ä»¥è¢«å…¶ä»–äººç”¨è¿™ä¸ªå…¬é’¥è§£æå‡ºæ¥ï¼›</p><p>æ•´ä¸ªç¯èŠ‚ä¸­ï¼Œåªåšåˆ°äº†å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨çš„ä¿¡æ¯å®‰å…¨ï¼Œå› ä¸ºåªæœ‰æœåŠ¡å™¨æ‹¥æœ‰ç§é’¥ï¼Œèƒ½è§£å¯†å‡ºæ•°æ®ã€‚</p><h3 id="8-2-3-åŒéå¯¹ç§°"><a href="#8-2-3-åŒéå¯¹ç§°" class="headerlink" title="8.2.3 åŒéå¯¹ç§°"></a>8.2.3 åŒéå¯¹ç§°</h3><p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨åŒéå¯¹ç§°å¯†é’¥åŠ å¯†çš„æ–¹å¼ï¼æ—¢ç„¶éå¯¹ç§°åªèƒ½ä¿è¯å•æ–¹çš„æ•°æ®å®‰å…¨ï¼Œé‚£ä½¿ç”¨ä¸¤ä¸ªéå¯¹ç§°ï¼Œä¸å°±èƒ½ä¿è¯åŒæ–¹æ•°æ®å®‰å…¨äº†å˜›ï¼</p><ul><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯äº¤æ¢å…¬é’¥<code>a&#39; å’Œ b&#39;</code></li><li>å®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯å‘ä¿¡æ¯ï¼šå…ˆç”¨<code>a&#39;</code>å¯¹æ•°æ®åŠ å¯†ï¼Œå†å‘é€ï¼›åªèƒ½ç”±æœåŠ¡å™¨è§£å¯†ï¼Œå› ä¸ºåªæœ‰æœåŠ¡å™¨æœ‰ç§é’¥a</li><li>æœåŠ¡ç«¯ç»™å®¢æˆ·ç«¯å‘ä¿¡æ¯ï¼šå…ˆç”¨<code>b&#39;</code>å¯¹æ•°æ®åŠ å¯†ï¼Œå†å‘é€ï¼›åªèƒ½ç”±å®¢æˆ·ç«¯è§£å¯†ï¼Œå› ä¸ºåªæœ‰å®¢æˆ·ç«¯æœ‰ç§é’¥b</li></ul><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ee2acb5bf6c.png"                      alt="image-20230216210830169"                ></p><p>å› ä¸ºä¸¤ä»½ç§é’¥éƒ½åªæœ‰å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è‡ªå·±æ‹¥æœ‰ï¼Œæ‰€ä»¥é»‘å®¢æ²¡æœ‰åŠæ³•è¿›è¡Œæ•°æ®çš„çªƒå–ï¼Œä¹Ÿå°±ä¿è¯äº†æ•°æ®çš„å®‰å…¨ã€‚</p><p>å³ä¾¿ä¸­é—´äºº<strong>æ›¿æ¢äº†äº¤æ¢çš„å…¬é’¥</strong>ï¼Œä¹Ÿä¼šå› ä¸ºåç»­çš„é€šä¿¡ï¼Œå®¢æˆ·ç«¯oræœåŠ¡ç«¯<strong>æœ¬åœ°çš„ç§é’¥</strong>æ— æ³•æ­£å¸¸è§£å¯†ï¼Œè€Œå‘ç°æ•°æ®è¢«çªƒå–ï¼</p><p>ä½†æ˜¯ä½†æ˜¯ï¼Œè¿™æ ·å·¦è¿˜ç®—æœ‰å¾ˆå¤§çš„<strong>ç¼ºç‚¹</strong></p><ul><li>æ•ˆç‡å¤ªä½ï¼ˆéå¯¹ç§°åŠ å¯†è§£å¯†è´Ÿè½½å¤ªé«˜ï¼Œæ•ˆç‡ä½ä¸‹ï¼Œç‰¹å®šåœºæ™¯ä¸‹æ— æ³•æ»¡è¶³è¦æ±‚ï¼‰</li><li>ä¾æ—§å¯èƒ½å­˜åœ¨å®‰å…¨é—®é¢˜</li></ul><h3 id="8-2-4-éå¯¹ç§°-å¯¹ç§°"><a href="#8-2-4-éå¯¹ç§°-å¯¹ç§°" class="headerlink" title="8.2.4 éå¯¹ç§°+å¯¹ç§°"></a>8.2.4 éå¯¹ç§°+å¯¹ç§°</h3><ul><li>æœåŠ¡ç«¯å…·æœ‰éå¯¹ç§°å…¬é’¥Så’Œç§é’¥Sâ€™</li><li>å®¢â¼¾ç«¯å‘èµ·è¯·æ±‚ï¼Œè·å–æœåŠ¡ç«¯å…¬é’¥S</li><li>å®¢â¼¾ç«¯åœ¨æœ¬åœ°ç”Ÿæˆå¯¹ç§°å¯†é’¥C, é€šè¿‡å…¬é’¥SåŠ å¯†, å‘é€ç»™æœåŠ¡å™¨.</li><li>ç”±äºä¸­é—´äººæ²¡æœ‰ç§é’¥ï¼Œå³ä½¿æˆªè·äº†æ•°æ®ï¼Œä¹Ÿæ— æ³•è¿˜åŸå‡ºå†…éƒ¨çš„åŸæ–‡ï¼Œä¹Ÿå°±æ— æ³•è·å–åˆ°å¯¹ç§°å¯†é’¥</li><li>æœåŠ¡å™¨é€šè¿‡ç§é’¥<code>S&#39;</code>è§£å¯†ï¼Œè¿˜åŸå‡ºå®¢æˆ·ç«¯å‘é€çš„å¯¹ç§°å¯†é’¥Cï¼Œå¹¶ä¸”ä½¿ç”¨è¿™ä¸ªå¯¹ç§°å¯†é’¥åŠ å¯†ç»™å®¢æˆ·ç«¯å‘é€çš„å“åº”æ•°æ®</li><li>åç»­å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½é‡‡ç”¨å¯†é’¥Cæ¥è¿›è¡Œå¯¹ç§°åŠ å¯†é€šä¿¡</li></ul><p>å› ä¸ºå¯¹ç§°<strong>å¯†é’¥Cåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯åŠ å¯†</strong>çš„ï¼Œåªæœ‰å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çŸ¥é“å¯†é’¥æ˜¯ä»€ä¹ˆï¼Œä¹Ÿå°±å®ç°äº†æ•°æ®çš„å®‰å…¨é€šä¿¡ï¼</p><h2 id="8-3-æ•°æ®æ‘˜è¦ï¼ˆæŒ‡çº¹ï¼‰"><a href="#8-3-æ•°æ®æ‘˜è¦ï¼ˆæŒ‡çº¹ï¼‰" class="headerlink" title="8.3 æ•°æ®æ‘˜è¦ï¼ˆæŒ‡çº¹ï¼‰"></a>8.3 æ•°æ®æ‘˜è¦ï¼ˆæŒ‡çº¹ï¼‰</h2><p>æ•°å­—æŒ‡çº¹(æ•°æ®æ‘˜è¦)ï¼Œ å…¶åŸºæœ¬åŸç†æ˜¯åˆ©â½¤å•å‘æ•£åˆ—å‡½æ•°(<code>Hashå‡½æ•°</code>)å¯¹ä¿¡æ¯è¿›è¡Œè¿ç®—ï¼Œç”Ÿæˆâ¼€ä¸²<strong>å›ºå®šé•¿åº¦</strong>çš„æ•°å­—æ‘˜è¦ã€‚</p><p>å¸¸è§çš„æ‘˜è¦ç®—æ³•æœ‰<code>MD5/SHA1/SHA256/SHA512</code>ç­‰ï¼›</p><p>æ•°å­—æŒ‡çº¹å¹¶ä¸æ˜¯â¼€ç§åŠ å¯†æœºåˆ¶ï¼Œä½†å¯ä»¥ç”¨æ¥åˆ¤æ–­<strong>æ•°æ®æœ‰æ²¡æœ‰è¢«çªœæ”¹</strong>ï¼Œäº¦æˆ–è€…æ˜¯ä¸‹è½½çš„æ•°æ®åŒ…æœ‰æ²¡æœ‰å‡ºç°æŸåã€‚</p><ul><li>åŒä¸€ä¸ªæ•°æ®æ–‡ä»¶ï¼Œç”¨åŒä¸€ä¸ªæ–¹æ³•ç”Ÿæˆçš„æ•°æ®æ‘˜è¦æ˜¯ä¸€è‡´çš„</li><li>ä¸åŒæ–‡ä»¶ç”Ÿæˆçš„æ•°æ®æ‘˜è¦å¯èƒ½ä¼šæ’è½¦ï¼Œä½†å‡ ç‡æä½ï¼Œå¯ä»¥è®¤ä¸ºå…·æœ‰å”¯ä¸€æ€§ï¼</li><li>æˆ‘ä»¬æ— æ³•ç”¨æ•°æ®æ‘˜è¦åæ¨å‡ºæ•°æ®å†…å®¹ï¼ˆæ€ä¹ˆå¯èƒ½ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²æ¨æµ‹å‡ºåŸæœ¬çš„å†…å®¹å‘¢ï¼Ÿé‚£æ ·è¿˜å­˜æ”¾æºæ–‡ä»¶å¹²å“ˆï¼ŸğŸ˜‚ï¼‰</li></ul><p>æ•°æ®æ‘˜è¦åœ¨ç½‘ç›˜äº§å“ä¸­ä¹Ÿæœ‰ä½¿ç”¨ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨<strong>ç™¾åº¦äº‘ç›˜ã€é˜¿é‡Œäº‘ç›˜</strong>çš„æ—¶å€™ï¼Œä¼šé‡åˆ°ä¸€ä¸ªå¤§çš„èµ„æºæ–‡ä»¶åªç”¨äº†<strong>çŸ­çŸ­å‡ ç§’</strong>å°±æˆåŠŸä¸Šä¼ åˆ°æœåŠ¡å™¨çš„æƒ…å†µã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯çœŸçš„ç”¨å‡ ç§’å°±æŠŠæ•°æ®ä¼ è¾“ä¸Šå»äº†ï¼Œè€Œæ˜¯ç»å†äº†ä»¥ä¸‹é˜¶æ®µ</p><ul><li>ç½‘ç›˜å®¢æˆ·ç«¯å¯¹æœ¬åœ°æ–‡ä»¶ç”Ÿæˆæ•°æ®æ‘˜è¦</li><li>ç”Ÿæˆåï¼Œåˆ¤æ–­æœåŠ¡å™¨ç«¯<strong>å·²æœ‰æ–‡ä»¶</strong>ä¸­ï¼Œæ˜¯å¦æœ‰åŒè¯¥æ•°æ®æ‘˜è¦ç›¸åŒçš„æ–‡ä»¶</li><li>å¦‚æœæœ‰ï¼Œä»£è¡¨è¯¥æ–‡ä»¶å·²ç»å­˜åœ¨äº†äº‘ç›˜ä¸­</li><li>æœåŠ¡å™¨å°†è¯¥æ–‡ä»¶ç»™ä½ çš„è´¦æˆ·å»ºç«‹ä¸€ä¸ªè½¯é“¾æ¥&#x2F;ç¡¬é“¾æ¥ï¼Œå°±å®ç°äº†<code>&quot;å¦™ä¼ &quot;</code></li><li>å¦‚æœæ²¡æœ‰ï¼Œåˆ™è€è€å®å®çš„ä»æœ¬åœ°ä¸Šä¼ æ–‡ä»¶åˆ°äº‘ç›˜</li></ul><p>äº‘ç›˜å‚å®¶è¿™ä¹ˆåšçš„åŸå› å¾ˆç®€å•ï¼šé¿å…åŒä¸€ä»½æ–‡ä»¶è¢«å¤šæ¬¡å­˜å‚¨ã€‚å½“ä¸‹ç½‘ç›˜ç»™ç”¨æˆ·çš„å…è´¹ç©ºé—´åŠ¨åˆ™ä¸ŠTï¼Œå¦‚æœæ‰€æœ‰æ–‡ä»¶éƒ½é‡å¤ä¿å­˜ï¼Œé‚£å¯¹äºäº‘æœåŠ¡å™¨å‚å®¶æ¥è¯´ï¼Œèµ„æºæ¶ˆè€—å¤ªå¤§äº†ã€‚</p><p>è¿™ä¸ªåšæ³•å¹¶ä¸ä¼šäº§ç”Ÿæ•°æ®éšç§é—®é¢˜ï¼Œä¸€èˆ¬åªæœ‰ç”µå½±ç­‰èµ„æºæ–‡ä»¶æ‰æœ‰å¯èƒ½å¦™ä¼ æˆåŠŸã€‚ä½ å¯ä»¥ä½¿ç”¨ä¸€äº›â€œå…¶ä»–æ‰‹æ®µâ€ï¼Œæ¯”å¦‚æŠŠèµ„æºæ‰“ä¸ªå‹ç¼©åŒ…ï¼Œå¹¶åœ¨å‹ç¼©åŒ…ä¸­éšä¾¿ä¸¢å¦å¤–ä¸€ä¸ªæ–‡ä»¶ï¼Œè®©æ–‡ä»¶çš„æ•°æ®æŒ‡çº¹å’Œå·²æœ‰èµ„æºä¸ç›¸åŒï¼Œå°±ä¸ä¼šè¿›è¡Œ<code>å¦™ä¼ </code>äº†ã€‚</p><h2 id="8-4-æ•°å­—ç­¾å"><a href="#8-4-æ•°å­—ç­¾å" class="headerlink" title="8.4 æ•°å­—ç­¾å"></a>8.4 æ•°å­—ç­¾å</h2><p>å¯¹æ•°æ®æ‘˜è¦è¿›è¡ŒåŠ å¯†ï¼Œç”Ÿæˆçš„å†…å®¹è¢«ç§°ä¸º<strong>æ•°å­—ç­¾å</strong></p><h2 id="8-5-ä¸­é—´äººæ”»å‡»"><a href="#8-5-ä¸­é—´äººæ”»å‡»" class="headerlink" title="8.5 ä¸­é—´äººæ”»å‡»"></a>8.5 ä¸­é—´äººæ”»å‡»</h2><p>ä¸­é—´äººæ”»å‡»ï¼ˆMan-in-the-MiddleAttackï¼‰ï¼Œç®€ç§°â€œ<code>MITMæ”»å‡»</code>â€ï¼›</p><p>ä»¥<code>8.2.2</code>çš„å•éå¯¹ç§°åŠ å¯†ä¸ºä¾‹ï¼Œä¸­é—´äººå¯ä»¥åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­è¿›è¡Œ<strong>å·æ¢æ¢æŸ±</strong>ï¼Œçªƒå–åŒæ–¹çš„ä¿¡æ¯</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ee26a502a69.png"                      alt="image-20230216205047679"                ></p><p>é€è¿‡è¿™ä¸ªæ —å­ğŸŒ°ï¼Œå®é™…ä¸Šï¼Œå¦‚æœä¸­é—´äººåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯<strong>å¼€å§‹é€šä¿¡ä¹‹å‰</strong>å°±æ¥çªƒå¬å¹¶<strong>å‡†å¤‡æ¢æŸ±</strong>äº†ï¼Œä»–å°±æœ‰å¯èƒ½æ›¿æ¢åŒæ–¹å¯†é’¥ï¼Œä»è€Œè§£å¯†åŒæ–¹å‘é€çš„ä¿¡æ¯ï¼</p><p>æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œæ˜¯å®¢æˆ·ç«¯oræœåŠ¡ç«¯<strong>éƒ½æ²¡æœ‰åŠæ³•è¯æ˜</strong>ï¼Œå½“å‰çš„å…¬é’¥æ˜¯ç›´æ¥ä»æœåŠ¡ç«¯orå®¢æˆ·ç«¯å‘æ¥çš„ï¼Œå®ƒä»¬æ²¡æœ‰åŠæ³•æ£€éªŒå…¬é’¥çš„æƒå¨æ€§ï¼Œåªèƒ½è¢«åŠ¨æ¥å—ã€‚ç”±æ­¤ç»™ä¸­é—´äºº<code>å·æ¢æ¢æŸ±</code>æä¾›äº†å¯èƒ½ã€‚</p><h2 id="8-6-CAè¯ä¹¦"><a href="#8-6-CAè¯ä¹¦" class="headerlink" title="8.6 CAè¯ä¹¦"></a>8.6 CAè¯ä¹¦</h2><p>æ‰€è°“CAè¯ä¹¦ï¼Œæ˜¯ç”±<strong>CAæœºæ„</strong>é¢å‘çš„æƒå¨è¯ä¹¦ã€‚CAæœºæ„åœ¨é¢å‘è¯ä¹¦æ—¶ï¼Œä¼šåœ¨è¯ä¹¦ä¸­é™„å¸¦ä¸Šè¯¥ç«™ç‚¹çš„åŸŸåï¼Œä»¥åŠç”³è¯·äººï¼ˆä¼ä¸šï¼‰çš„ç›¸å…³ä¿¡æ¯</p><ul><li>CAæœºæ„ä¼šæœ‰ä¸€ä¸ªè‡ªå·±çš„ç§é’¥å’Œå…¬é’¥ï¼Œå…¶å…¬é’¥å‘<strong>æ‰€æœ‰äºº</strong>å…¬å¼€</li><li>CAæœºæ„çš„ç§é’¥ç”±å…¶è‡ªå·±ä¿å­˜ï¼ˆç§é’¥ä¸€å®šä¸èƒ½æ³„éœ²ï¼‰</li><li>å½“ä¸‹çš„æµè§ˆå™¨ã€æ“ä½œç³»ç»Ÿéƒ½ä¼šå†…ç½®è®¤å¯çš„CAï¼›åªæœ‰è¢«è®¤å¯çš„CAï¼Œæ‰èƒ½ä¸ºç«™ç‚¹æä¾›sslè¯ä¹¦æœåŠ¡</li></ul><p>åœ¨æˆ‘ä»¬windowsæœ¬åœ°å°±èƒ½çœ‹åˆ°å½“å‰æ“ä½œç³»ç»Ÿè®¤å¯çš„CAæœºæ„å…¶å…¬é’¥ï¼›åœ¨edgeæµè§ˆå™¨ä¸­ï¼Œç‚¹å‡»å³ä¸Šè§’é€‰æ‹©ï¼Œè¿›å…¥è®¾ç½®ï¼Œåœ¨é€‰æ‹©éšç§é¡µé¢ï¼Œæ‰¾åˆ°<code>ç®¡ç†è¯ä¹¦</code></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ee3dd712d42.png"                      alt="image-20230216222946008"                ></p><p>ç‚¹å‡»å®ƒï¼Œå°±èƒ½çœ‹åˆ°å½“å‰æœ¬åœ°è®¤å¯çš„CA</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ee3e40b1733.png"                      alt="image-20230216223131725"                ></p><h3 id="8-6-1-sslè¯ä¹¦åŠ å¯†åŸç†"><a href="#8-6-1-sslè¯ä¹¦åŠ å¯†åŸç†" class="headerlink" title="8.6.1 sslè¯ä¹¦åŠ å¯†åŸç†"></a>8.6.1 sslè¯ä¹¦åŠ å¯†åŸç†</h3><p>å½“ä¸€ä¸ªç«™ç‚¹è·å–äº†sslè¯ä¹¦åï¼Œåœ¨å‘ç”¨æˆ·å‘é€sslè¯ä¹¦ä¸­åŒ…å«çš„å…¬é’¥çš„åŒæ—¶ï¼Œè¿˜ä¼šå‘é€ä¸€ä¸ª<strong>ç”±CAæœºæ„</strong>å¯¹sslè¯ä¹¦å…¬é’¥åšçš„<strong>æ•°å­—ç­¾å</strong></p><ul><li>sslè¯ä¹¦å…¬é’¥çš„æ•°å­—ç­¾åAï¼Œé€šè¿‡CAæœºæ„çš„<strong>ç§é’¥</strong>è¿›è¡ŒåŠ å¯†</li><li>sslè¯ä¹¦çš„å…¬é’¥B</li></ul><p>å½“å®¢æˆ·ç«¯æ”¶åˆ°è¿™ä»½ä¿¡æ¯ä¹‹åï¼Œä¼šé‡‡ç”¨hashå‡½æ•°å¯¹æ”¶åˆ°çš„sslè¯ä¹¦å…¬é’¥è¿›è¡Œæ•°å­—ç­¾åï¼Œå¾—åˆ°ä¸€ä¸ª<strong>æœ¬åœ°ç”Ÿæˆçš„æ•°å­—ç­¾åC</strong></p><p>å†ç”¨CAæœºæ„çš„å…¬é’¥å¯¹ä¼ è¾“è¿‡æ¥çš„æ•°å­—ç­¾åAè¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°æ•°å­—ç­¾åAçš„æ˜æ–‡ï¼›åˆ¤æ–­ç”±CAæœºæ„ç”Ÿæˆçš„sslå…¬é’¥æ•°å­—ç­¾åAæ˜¯å¦å’Œæœ¬åœ°ç”Ÿæˆçš„æ•°å­—ç­¾åCç›¸åŒï¼›</p><ul><li>å¦‚æœç›¸åŒï¼Œåˆ™ä»£è¡¨è¯ä¹¦æ­£ç¡®ï¼</li><li>ä¸ç›¸åŒï¼Œä»£è¡¨è¯ä¹¦å‡ºç°é”™è¯¯ï¼</li></ul><p>ç”»ä¸ªå›¾ï¼Œå¤§æ¦‚å°±æ˜¯ä¸‹é¢è¿™æ ·</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ee3aa8d2aa1.png"                      alt="image-20230216221611664"                ></p><p>ç”±äºå½“ä¸‹å‘é€çš„æ•°æ®åŒ…ä¸­ï¼ŒåŒæ—¶å­˜åœ¨sslå…¬é’¥çš„æ˜æ–‡+ç”±CAæœºæ„åŠ å¯†åçš„æ•°å­—ç­¾åï¼Œä¸­é—´äººæ— æ³•è¿›è¡Œä»»ä½•æ”»å‡»ä¿®æ”¹ï¼</p><ul><li>è‹¥ä¿®æ”¹sslå…¬é’¥ï¼Œç”±äºä¸­é—´äººæ²¡æœ‰CAæœºæ„çš„ç§é’¥ï¼Œæ— æ³•å¯¹ä¿®æ”¹åçš„sslå…¬é’¥ç”Ÿæˆå¯¹åº”çš„åŠ å¯†åæ•°å­—ç­¾å</li><li>è‹¥ä½¿ç”¨CAå…¬é’¥è§£å¯†æ•°å­—ç­¾ååä¿®æ”¹â€¦â€¦ä¾æ—§ä¼šå› ä¸ºæ²¡æœ‰CAæœºæ„ç§é’¥ï¼Œæ— æ³•æŠŠä¿®æ”¹åçš„ç­¾ååŠ å¯†å›å»</li><li>å¦‚æœä¸­é—´äººç”¨è‡ªå·±çš„ç§é’¥ç”Ÿæˆä¸€ä¸ªæ•°å­—ç­¾åï¼Œä½†æˆ‘ä¸è®¤è¯†ä½ è¿™ä¸ªCAï¼Œä¹Ÿä¸çŸ¥é“ä½ çš„å…¬é’¥æ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆè§£å¯†ä½ çš„ä¿¡æ¯å‘¢ï¼Ÿ</li></ul><p>ç»¼ä¸Šï¼Œä¸­é—´äººè¦æƒ³å·æ¢æ¢æŸ±ï¼Œåªæœ‰ä¸€ä¸ªåŠæ³•äº†ï¼Œé‚£å°±æ˜¯æ‹¿ä¸€ä¸ª<strong>çœŸçš„è¯ä¹¦</strong>æ•´ä½“æ›¿æ¢æ‰è¿™ä¸ªæ•°æ®åŒ…ã€‚</p><p>å¯sslè¯ä¹¦ä¸­è¿˜åŒ…å«äº†åŸŸåã€ç«™ç‚¹ä¸»ä½“ç­‰å„ç±»ä¿¡æ¯ï¼Œæˆ‘å½“ä¸‹è®¿é—®çš„æ˜¯<code>baidu.com</code>ï¼Œç»“æœæ”¶åˆ°çš„è¯ä¹¦æ˜¯<code>qq.com</code>çš„ï¼Œé‚£è‚¯å®šæœ‰é—®é¢˜å•Šï¼æµè§ˆå™¨ä¼šç›´æ¥æ‹’ç»è®¿é—®ï¼ğŸ˜‚</p><p>å½“æˆ‘ä»¬è®¿é—®ä¸€äº›ç½‘ç«™ï¼Œ<strong>æµè§ˆå™¨æŠ¥sslè¯ä¹¦è¿‡æœŸ</strong>ï¼Œä¹Ÿæ˜¯ä¼šå‡ºç°ä¸€å®šçš„å®‰å…¨é—®é¢˜çš„ï¼</p><h3 id="8-6-2-sslè¯ä¹¦-éå¯¹ç§°-å¯¹ç§°"><a href="#8-6-2-sslè¯ä¹¦-éå¯¹ç§°-å¯¹ç§°" class="headerlink" title="8.6.2 sslè¯ä¹¦+éå¯¹ç§°+å¯¹ç§°"></a>8.6.2 sslè¯ä¹¦+éå¯¹ç§°+å¯¹ç§°</h3><p>æœ‰äº†ä¸Šé¢è¿™ä¸ªä¸èƒ½è¢«ç¯¡æ”¹çš„sslè¯ä¹¦å…¬é’¥ï¼Œä¸‹é¢æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨<code>éå¯¹ç§°+å¯¹ç§°åŠ å¯†</code>çš„æ–¹å¼è¿›è¡Œé€šä¿¡äº†</p><ul><li>å®¢æˆ·ç«¯æ”¶åˆ°sslè¯ä¹¦ï¼Œå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªæœ¬åœ°ç”Ÿæˆçš„å¯†é’¥Dï¼ˆä½¿ç”¨sslè¯ä¹¦å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼‰</li><li>æœåŠ¡ç«¯æ”¶åˆ°å¯†é’¥Dçš„åŠ å¯†ä¿¡æ¯ï¼Œä½¿ç”¨sslè¯ä¹¦çš„ç§é’¥è¿›è¡Œè§£å¯†ï¼Œè·å–åˆ°å¯†é’¥D</li><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä½¿ç”¨å¯†é’¥Dè¿›è¡Œå¯¹ç§°åŠ å¯†é€šä¿¡</li></ul><p>è¿™æ ·å³è§£å†³äº†å®‰å…¨é—®é¢˜ï¼Œåˆè§„é¿äº†éå¯¹ç§°åŠ å¯†çš„æ•ˆç‡é—®é¢˜ï¼Œä¸€ä¸¾å¤šå¾—ï¼</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;å·²ç»å­¦ä¹ è¿‡è‡ªå·±å®šåˆ¶ä¸€ä¸ªåè®®äº†ï¼Œç°åœ¨å°±æ¥çœ‹çœ‹å½“ä¸‹å¹¿æ³›ä½¿ç”¨çš„httpåè®®å§&lt;/p&gt;</summary>
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="ç½‘ç»œ" scheme="https://blog.musnow.top/tags/%E7%BD%91%E7%BB%9C/"/>
    
    <category term="http" scheme="https://blog.musnow.top/tags/http/"/>
    
  </entry>
  
  <entry>
    <title>ã€ç½‘ç»œã€‘è‡ªå®šä¹‰åè®® | åºåˆ—åŒ–å’Œååºåˆ—åŒ– | Jsoncpp</title>
    <link href="https://blog.musnow.top/2023/02/12/note_Linux/33jsoncpp%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <id>https://blog.musnow.top/2023/02/12/note_Linux/33jsoncpp%E5%BA%8F%E5%88%97%E5%8C%96/</id>
    <published>2023-02-12T04:30:55.000Z</published>
    <updated>2023-02-15T03:55:37.798Z</updated>
    
    <content type="html"><![CDATA[<p>ä»¥tcpServerçš„<strong>è®¡ç®—å™¨</strong>æœåŠ¡ä¸ºä¾‹ï¼Œå®ç°ç”¨jsoncppæ¥è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–</p><span id="more"></span><blockquote><p>é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œè¯·å…ˆé˜…è¯» <a href="https://blog.musnow.top/2023/02/11/note_linux/32tcp%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8D%8F%E8%AE%AE/">è‡ªå®šä¹‰åè®® | åºåˆ—åŒ–å’Œååºåˆ—åŒ– | ä»¥tcpServerä¸ºä¾‹</a></p></blockquote><h1 id="1-å®‰è£…åŒ…"><a href="#1-å®‰è£…åŒ…" class="headerlink" title="1.å®‰è£…åŒ…"></a>1.å®‰è£…åŒ…</h1><p>æˆ‘æ‰€ç”¨çš„ç³»ç»Ÿæ˜¯<code>centos7.6</code>ï¼Œå…ˆç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥æ‰¾ç›¸å…³çš„åŒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum list | grep jsoncpp-devel</span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºå‡ºæ¥çš„åŒ…å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Repository epel is listed more than once in the configuration</span><br><span class="line">jsoncpp-devel.x86_64                0.10.5-2.el7           @epel </span><br></pre></td></tr></table></figure><p>éšåå®‰è£…è¿™ä¸ªåŒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install jsoncpp</span><br></pre></td></tr></table></figure><p>ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œå®‰è£…<code>jsoncpp-devel.x86_64</code>æ˜¾ç¤ºæ‰¾ä¸åˆ°ç›¸å…³åŒ…</p><h2 id="1-1-ä»€ä¹ˆæ˜¯jsonï¼Ÿ"><a href="#1-1-ä»€ä¹ˆæ˜¯jsonï¼Ÿ" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯jsonï¼Ÿ"></a>1.1 ä»€ä¹ˆæ˜¯jsonï¼Ÿ</h2><p>jsonæ˜¯ä¸€ä¸ªkvé”®å€¼å¯¹çš„åºåˆ—åŒ–æ–¹å¼ï¼Œæ¯ä¸€ä¸ªkeyéƒ½å¯¹åº”äº†ä¸€ä¸ªvalue</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;value&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™å°±æœ‰ç‚¹ç±»ä¼¼c++ä¸­çš„mapï¼Œä¸è¿‡jsonèƒ½åšçš„æ›´å¤š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;data1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;value&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;data2&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;key1&quot;</span><span class="punctuation">:</span><span class="string">&quot;value1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;key2&quot;</span><span class="punctuation">:</span><span class="string">&quot;value2&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;key3&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;key4&quot;</span><span class="punctuation">:</span><span class="keyword">true</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>jsonå¯ä»¥åœ¨é‡Œé¢åµŒå¥—æ·»åŠ æ›´å¤šçš„å†…å®¹ï¼Œä¸ç®¡æ˜¯å­—ç¬¦ä¸²è¿˜æ˜¯æ•´å½¢ï¼Œè¿˜èƒ½æ˜¯boolç±»å‹çš„<code>true/false</code>ï¼›</p><p>å› ä¸ºjsonå¯¹ååºåˆ—åŒ–åºåˆ—åŒ–çš„æ§åˆ¶å¾ˆæ˜¯ä¸é”™ï¼Œå¯è¯»æ€§ä¹Ÿå¾ˆå¥½ï¼Œæ‰€ä»¥è¢«å¹¿æ³›ä½¿ç”¨ï¼</p><p>ç›¸æ¯”äºè‡ªå·±å†™ä¸€ä¸ªåºåˆ—åŒ–æ–¹å¼ï¼Œç›´æ¥ç”¨åˆ«äººçš„è½®å­ï¼Œä¹Ÿä¸é”™ğŸ‘»</p><p>ç±»ä¼¼çš„åºåˆ—åŒ–æ¡†æ¶è¿˜æœ‰<code>xml</code></p><h1 id="2-ä»£ç ç¤ºä¾‹"><a href="#2-ä»£ç ç¤ºä¾‹" class="headerlink" title="2.ä»£ç ç¤ºä¾‹"></a>2.ä»£ç ç¤ºä¾‹</h1><h2 id="2-1-åºåˆ—åŒ–"><a href="#2-1-åºåˆ—åŒ–" class="headerlink" title="2.1 åºåˆ—åŒ–"></a>2.1 åºåˆ—åŒ–</h2><p>ç›¸æ¯”æˆ‘ä»¬è‡ªå·±å†™çš„åºåˆ—åŒ–æ–¹å¼ï¼Œjsonçš„ä½¿ç”¨ç®€å•å¤šäº†</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">serialize</span><span class="params">(std::string&amp; out)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     <span class="comment">//ä½¿ç”¨jsoncppçš„ä»£ç </span></span><br><span class="line">    Json::Value root;</span><br><span class="line">    root[<span class="string">&quot;x&quot;</span>] = _x;</span><br><span class="line">    root[<span class="string">&quot;y&quot;</span>] = _y;</span><br><span class="line">    root[<span class="string">&quot;op&quot;</span>] = _ops;</span><br><span class="line"></span><br><span class="line">    Json::FastWriter fw; <span class="comment">// è¿™ä¸ªæ˜¯å†™æˆä¸€è¡Œï¼Œå¯¹äºè®¡ç®—æœºæ¥è¯´å¤„ç†çš„è´Ÿæ‹…å°</span></span><br><span class="line">    <span class="comment">// Json::StyledWriter fw; // è¿™ä¸ªä¼šè¿›è¡Œæ ¼å¼åŒ–ï¼Œæ›´å¥½çœ‹ï¼ˆä½†æ˜¯å†…å®¹æ²¡å·®è·ï¼‰</span></span><br><span class="line">    out = fw.<span class="built_in">write</span>(root);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äº<code>fw.write(root)</code>ï¼Œå…¶è¿”å›å€¼æ˜¯ä¸€ä¸ªstringï¼Œä¹Ÿæ–¹ä¾¿æˆ‘ä»¬æ¥æ”¶</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e87f6032516.png"                      alt="image-20230212135543386"                ></p><p>å…¶ä¸­<code>FastWriter</code>å’Œ<code>StyledWriter</code>æœ‰ä¸€ç‚¹åŒºåˆ«ï¼Œå¦‚ä¸‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//FastWriter</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;value&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">//StyledWriter</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;value&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç®€å•æ¥è¯´ï¼Œ<code>StyledWriter</code>ä¼šå¯¹æˆ‘ä»¬çš„kvé”®å€¼å¯¹è¿›è¡Œæ ¼å¼åŒ–ï¼Œæ›´æ–¹ä¾¿äººç±»çš„é˜…è¯»ã€‚è€Œ<code>FastWriter</code>æ˜¯ç›´æ¥å†™æˆä¸€æ•´è¡Œï¼Œåœ¨ä¼ è¾“çš„æ—¶å€™ä¼šæ–¹ä¾¿ä¸€ç‚¹ï¼ˆå› ä¸ºä¸éœ€è¦<code>\n</code>ï¼‰</p><h2 id="2-2-ååºåˆ—åŒ–"><a href="#2-2-ååºåˆ—åŒ–" class="headerlink" title="2.2 ååºåˆ—åŒ–"></a>2.2 ååºåˆ—åŒ–</h2><p>ååºåˆ—åŒ–éœ€è¦ä¸€ä¸ªReaderæ¥è¯»å–å­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶å†…å®¹æ ¹æ®é”®å€¼éšå°„ç»™æˆå‘˜å˜é‡</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">deserialize</span><span class="params">(<span class="type">const</span> std::string &amp;in)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//json</span></span><br><span class="line">    Json::Value root;</span><br><span class="line">    Json::Reader rd;</span><br><span class="line">    rd.<span class="built_in">parse</span>(in, root);</span><br><span class="line">    _x = root[<span class="string">&quot;x&quot;</span>].<span class="built_in">asInt</span>();</span><br><span class="line">    _y = root[<span class="string">&quot;y&quot;</span>].<span class="built_in">asInt</span>();</span><br><span class="line">    _ops = root[<span class="string">&quot;op&quot;</span>].<span class="built_in">asInt</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3-æµ‹è¯•"><a href="#3-æµ‹è¯•" class="headerlink" title="3.æµ‹è¯•"></a>3.æµ‹è¯•</h1><p>å› ä¸ºjsoncppæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œæˆ‘ä»¬é“¾æ¥çš„æ—¶å€™éœ€è¦åŠ ä¸Šå‘½ä»¤<code>-ljsoncpp</code></p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">tcpServer:tcpServer.cpp</span></span><br><span class="line">g++ -o <span class="variable">$@</span> <span class="variable">$^</span> -std=c++11 -lpthread -ljsoncpp</span><br></pre></td></tr></table></figure><p>å‘é€æ¶ˆæ¯åï¼Œå¯ä»¥çœ‹åˆ°ï¼Œjsonå¸®æˆ‘ä»¬æ ¼å¼åŒ–ä¸ºå¦‚ä¸‹å½¢å¼çš„å­—ç¬¦ä¸²</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;op&quot;</span><span class="punctuation">:</span><span class="number">43</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;op&quot;</span><span class="punctuation">:</span><span class="number">43</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">333</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">234</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e8829420bc4.png"                      alt="image-20230212140924067"                ></p><h1 id="4-gccç»™äºˆå®å®šä¹‰"><a href="#4-gccç»™äºˆå®å®šä¹‰" class="headerlink" title="4.gccç»™äºˆå®å®šä¹‰"></a>4.gccç»™äºˆå®å®šä¹‰</h1><p>ä¸ºäº†æ–¹ä¾¿å¯¹åºåˆ—åŒ–é‡‡ç”¨çš„æ–¹å¼è¿›è¡Œæ§åˆ¶ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨äº†é¢„å¤„ç†æŒ‡ä»¤<code>ifdef/endif</code>æ¥è¿›è¡Œåˆ¤æ–­ï¼Œåªè¦æˆ‘ä»¬åœ¨æ–‡ä»¶å¤´å®šä¹‰äº†<code>MYPROTOCOL</code>ï¼Œè¿™é‡Œå°±ä¼šé‡‡ç”¨æˆ‘ä»¬è‡ªå·±çš„å†™çš„åºåˆ—åŒ–æ–¹å¼ï¼Œå¦åˆ™é‡‡ç”¨json</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MYPROTOCOL 1  <span class="comment">//å¦‚æœdefineäº†è¿™ä¸ªï¼Œé‚£å°±ä½¿ç”¨è‡ªå·±çš„ä»£ç </span></span></span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e8bdcb448d6.png"                      alt="image-20230212182113854"                ></p><h2 id="4-1-å‘½ä»¤è¡Œ"><a href="#4-1-å‘½ä»¤è¡Œ" class="headerlink" title="4.1 å‘½ä»¤è¡Œ"></a>4.1 å‘½ä»¤è¡Œ</h2><p>ä½†æ˜¯åœ¨æ–‡ä»¶é‡Œé¢ä¿®æ”¹defineè¿˜æ˜¯ä¸å¤ªæ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é‡‡ç”¨gccçš„å‘½ä»¤è¡Œå‚æ•°çš„æ–¹å¼ï¼Œè¿›è¡Œdefineçš„æ’å…¥ï¼ˆè¿™ä¹ˆåšä¹‹å‰ï¼Œè¦å…ˆåˆ é™¤æ–‡ä»¶ä¸­å¯¹<code>MYPROTOCOL</code>çš„defineï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g++ -DMYPROTOCOL tcpServer.cpp -o tcpServer -lpthread -ljsoncpp</span><br><span class="line">g++ -DMYPROTOCOL tcpClient.cpp -o tcpClient -lpthread -ljsoncpp</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸åŠ ç¼–è¯‘æŒ‡ä»¤ç¼–è¯‘å‡ºæ¥çš„æœåŠ¡å™¨ï¼Œé‡‡ç”¨çš„æ˜¯jsonçš„æ–¹å¼æ¥åºåˆ—åŒ–</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e8bed2edae3.png"                      alt="image-20230212182627766"                ></p><p>æ·»åŠ äº†ä¹‹åï¼Œå°±æ˜¯ç”¨æˆ‘ä»¬è‡ªå·±å†™çš„åºåˆ—åŒ–æ–¹å¼æ¥åºåˆ—åŒ–äº†</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e8bf7e58fae.png"                      alt="image-20230212182919150"                ></p><h2 id="4-2-makefile"><a href="#4-2-makefile" class="headerlink" title="4.2 makefile"></a>4.2 makefile</h2><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹makefileæ¥å®ç°è¿™ä¸€ç‚¹</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><span class="keyword">.PHONY</span>:all</span></span><br><span class="line"><span class="section">all:tcpClient tcpServer</span></span><br><span class="line">MYSELF=-DMYPROTOCOL</span><br><span class="line"></span><br><span class="line"><span class="section">tcpClient: tcpClient.cpp</span></span><br><span class="line">g++ <span class="variable">$(MYSELF)</span> -o <span class="variable">$@</span> <span class="variable">$^</span> -std=c++11 -lpthread -ljsoncpp</span><br><span class="line"><span class="section">tcpServer:tcpServer.cpp</span></span><br><span class="line">g++ <span class="variable">$(MYSELF)</span> -o <span class="variable">$@</span> <span class="variable">$^</span> -std=c++11 -lpthread -ljsoncpp</span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>:clean</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">rm -f tcpClient tcpServer</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬éœ€è¦ç”¨è‡ªå·±åè®®çš„æ—¶å€™ï¼Œå°±åœ¨æœ€å‰é¢åŠ ä¸Š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MYSELF=-DMYPROTOCOL</span><br></pre></td></tr></table></figure><p>å¦åˆ™ç›´æ¥<strong>åˆ é™¤</strong>è¿™ä¸ªå®šä¹‰ï¼Œæˆ–è€…æ³¨é‡Šæ‰åé¢çš„å†…å®¹ï¼Œå°±èƒ½é‡‡ç”¨jsoncpp</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MYSELF=<span class="comment">#-DMYPROTOCOL</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±æ–¹ä¾¿ä¸€äº›äº†</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e8c0cf35f88.png"                      alt="image-20230212183456024"                ></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä»¥tcpServerçš„&lt;strong&gt;è®¡ç®—å™¨&lt;/strong&gt;æœåŠ¡ä¸ºä¾‹ï¼Œå®ç°ç”¨jsoncppæ¥è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–&lt;/p&gt;</summary>
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="ç½‘ç»œ" scheme="https://blog.musnow.top/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>ã€ç½‘ç»œã€‘è‡ªå®šä¹‰åè®® | åºåˆ—åŒ–å’Œååºåˆ—åŒ– | ä»¥tcpServerä¸ºä¾‹</title>
    <link href="https://blog.musnow.top/2023/02/11/note_Linux/32tcp%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8D%8F%E8%AE%AE/"/>
    <id>https://blog.musnow.top/2023/02/11/note_Linux/32tcp%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8D%8F%E8%AE%AE/</id>
    <published>2023-02-11T04:30:55.000Z</published>
    <updated>2023-02-15T03:55:44.139Z</updated>
    
    <content type="html"><![CDATA[<p>ä»¥tcpServerçš„<strong>è®¡ç®—å™¨</strong>æœåŠ¡ä¸ºä¾‹ï¼Œå®ç°ä¸€ä¸ªè‡ªå®šä¹‰åè®®</p><span id="more"></span><blockquote><p>é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œè¯·å…ˆé˜…è¯» <a href="https://blog.musnow.top/2023/02/05/note_linux/29tcp%E4%BB%A3%E7%A0%81/">tcpServer</a></p><p>æœ¬æ–‡å®Œæ•´ä»£ç è¯¦è§ <a class="link"   href="https://gitee.com/musnow/raspberry-practice/tree/master/code" >Gitee<i class="fas fa-external-link-alt"></i></a></p></blockquote><h1 id="1-é‡è°ˆtcp"><a href="#1-é‡è°ˆtcp" class="headerlink" title="1.é‡è°ˆtcp"></a>1.é‡è°ˆtcp</h1><p>æ³¨æ„ï¼Œå½“ä¸‹æ‰€å¯¹tcpçš„æè¿°éƒ½æ˜¯<strong>ä»¥ç®€å•ã€æ–¹ä¾¿ç†è§£</strong>èµ·è§ï¼Œåç»­ä¼šå¯¹tcpåè®®è¿›è¡Œæ·±å…¥è§£è¯»</p><h2 id="1-1-é“¾æ¥"><a href="#1-1-é“¾æ¥" class="headerlink" title="1.1 é“¾æ¥"></a>1.1 é“¾æ¥</h2><p>æˆ‘ä»¬çŸ¥é“ï¼Œtcpæ˜¯é¢å‘è¿æ¥çš„ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¦å…ˆå»ºç«‹é“¾æ¥ï¼Œæ‰èƒ½å¼€å§‹é€šä¿¡</p><ul><li>åœ¨é“¾æ¥è¿‡ç¨‹ä¸­ï¼Œtcpé‡‡ç”¨ä¸‰æ¬¡æ¡æ‰‹</li><li>åœ¨æ–­çº¿è¿‡ç¨‹ä¸­ï¼Œtcpé‡‡ç”¨å››æ¬¡æŒ¥æ‰‹</li></ul><p>ä¸¾ä¸ªæ—¥å¸¸ç”Ÿæ´»ä¸­çš„æ —å­ï¼Œå¸®åŠ©ç†è§£3æ¬¡æ¡æ‰‹å’Œ4æ¬¡æŒ¥æ‰‹</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e7000c46813.png"                      alt="image-20230211103933999"                ></p><h2 id="1-2-ä¿¡æ¯å‘é€"><a href="#1-2-ä¿¡æ¯å‘é€" class="headerlink" title="1.2 ä¿¡æ¯å‘é€"></a>1.2 ä¿¡æ¯å‘é€</h2><blockquote><p>å‡å¦‚æˆ‘ä»¬ç°åœ¨éœ€è¦å‘é€ç»“æ„åŒ–æ•°æ®ï¼Œé‚£åº”è¯¥æ€ä¹ˆåŠï¼Ÿ</p></blockquote><p>æˆ‘ä»¬çŸ¥é“ï¼Œtcpæ˜¯é¢å‘å­—èŠ‚æµçš„ï¼Œä¹Ÿå°±æ˜¯å…¶èƒ½å¤Ÿå‘é€ä»»æ„æ•°æ®ã€‚ä¹Ÿèƒ½å¤Ÿå‘é€<strong>Cè¯­è¨€ç»“æ„ä½“</strong>çš„äºŒè¿›åˆ¶æ•°æ®ï¼›</p><ul><li>ä½†èƒ½å‘é€ï¼Œå°±ä»£è¡¨æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå¹²å—ï¼Ÿ</li><li>ç­”æ¡ˆè‡ªç„¶æ˜¯<strong>ä¸è¡Œ</strong>ï¼</li></ul><p>ä¸åŒå¹³å°ï¼Œå¯¹<a href="https://blog.musnow.top/2022/01/28/note_c/40%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B%E8%AF%A6%E8%A7%A3/">ç»“æ„ä½“å¯¹é½</a>çš„é…ç½®ä¸åŒï¼Œå¤§å°ç«¯ä¸åŒï¼Œå…¶æœ€ç»ˆå¯¹æˆ‘ä»¬å­—èŠ‚æµçš„è§£æä¹Ÿå°±ä¸ä¸€æ ·ã€‚å¦‚æœé‡‡ç”¨ç›´æ¥å‘é€ç»“æ„ä½“æ•°æ®çš„æ–¹å¼æ¥é€šä¿¡ï¼Œé€‚é…æ€§æä½ï¼Œæˆ‘ä»¬çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½ä¼šè¢«é™åˆ¶åœ¨å½“å‰çš„ç³»ç»Ÿç¯å¢ƒä¸­è¿è¡Œï¼›</p><p>å¯æ˜¯ï¼Œå“ªæ€•æ˜¯åŒä¸€ä¸ªç³»ç»Ÿï¼Œå…¶å†…éƒ¨å¯¹å¤§å°ç«¯çš„é…ç½®ä¹Ÿæœ‰å¯èƒ½æ”¹å˜ï¼åˆ°æ—¶å€™æˆ‘ä»¬çš„ä»£ç ææ€•å°±æ— æ³•è¿è¡Œäº†ï¼</p><p>åŒç†ï¼Œåœ¨å½“åˆç¼–å†™<a class="link"   href="https://gitee.com/musnow/learn_c_code/tree/master/DAY_Code/DAY038%20%E9%80%9A%E8%AE%AF%E5%BD%95%E4%BB%A3%E7%A0%81" >Cè¯­è¨€é€šè®¯å½•<i class="fas fa-external-link-alt"></i></a>çš„ä»£ç çš„æ—¶å€™ï¼Œä¹Ÿä¸èƒ½é‡‡ç”¨ç›´æ¥å°†ç»“æ„ä½“æ•°æ®å†™å…¥æ–‡ä»¶çš„æ–¹å¼ã€‚åç»­ä»£ç å‡çº§ã€ç¯å¢ƒæ”¹å˜ï¼Œ<strong>éƒ½å¯èƒ½å¯¼è‡´æˆ‘ä»¬å­˜åœ¨æ–‡ä»¶ä¸­çš„æ•°æ®å¤±æ•ˆ</strong>ï¼Œè¿™è‚¯å®šæ˜¯æˆ‘ä»¬ä¸å¸Œæœ›çœ‹åˆ°çš„æƒ…å†µã€‚</p><p>æ‰€ä»¥ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±åº”è¯¥å°†æ•°æ®è¿›è¡Œ<code>åºåˆ—åŒ–</code>ä¹‹åå†å‘é€ï¼Œå®¢æˆ·ç«¯æ¥æ”¶åˆ°ä¿¡æ¯åï¼Œè¿›è¡Œ<code>ååºåˆ—åŒ–</code>è§£æå‡ºæ•°æ®ï¼</p><h1 id="2-åºåˆ—åŒ–å’Œååºåˆ—åŒ–"><a href="#2-åºåˆ—åŒ–å’Œååºåˆ—åŒ–" class="headerlink" title="2.åºåˆ—åŒ–å’Œååºåˆ—åŒ–"></a>2.åºåˆ—åŒ–å’Œååºåˆ—åŒ–</h1><h2 id="2-1-ç®€ä»‹"><a href="#2-1-ç®€ä»‹" class="headerlink" title="2.1 ç®€ä»‹"></a>2.1 ç®€ä»‹</h2><p>æ‰€è°“åºåˆ—åŒ–ï¼Œå°±æ˜¯å°†ç»“æ„åŒ–çš„æ•°æ®ï¼ˆå¯ä»¥æš‚æ—¶ç†è§£ä¸ºcçš„ç»“æ„ä½“ï¼‰è½¬æ¢æˆå­—ç¬¦ä¸²çš„æ–¹å¼ï¼Œå‘é€å‡ºå»</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">date</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">int</span> year;</span><br><span class="line">    <span class="type">int</span> month;</span><br><span class="line">    <span class="type">int</span> day;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ä¸Šé¢è¿™ä¸ªæ—¥æœŸç»“æ„ä½“ï¼Œæˆ‘ä»¬è¦æƒ³å°†å…¶åºåˆ—åŒ–ï¼Œå°±å¯ä»¥ç”¨ä¸€ä¸ªå¾ˆç®€å•çš„æ–¹å¼æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆåºåˆ—åŒ–ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">year-month-day</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯æ”¶åˆ°è¿™ä¸ªå­—ç¬¦ä¸²ä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡æŸ¥æ‰¾åˆ†éš”ç¬¦<code>-</code>çš„æ–¹å¼ï¼Œå–å‡ºä¸‰ä¸ªå˜é‡ï¼Œå°†å…¶è½¬æˆintåå­˜æ”¾å›ç»“æ„ä½“ï¼ˆååºåˆ—åŒ–ï¼‰</p><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±ç®—æ˜¯è§„å®šäº†ä¸€ä¸ªåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç®€å•çš„<strong>åè®®</strong>ï¼</p><hr><h2 id="2-2-ç¼–ç è§£ç "><a href="#2-2-ç¼–ç è§£ç " class="headerlink" title="2.2 ç¼–ç è§£ç "></a>2.2 ç¼–ç è§£ç </h2><p>è¿™é‡Œè¿˜ä¼šå‡ºç°å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘è¦æ€ä¹ˆçŸ¥é“æˆ‘å·²ç»<strong>è¯»å–å®Œæ¯•</strong>äº†ä¸€ä¸ªåºåˆ—åŒ–åçš„æ•°æ®å‘¢ï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2000-12-10</span><br><span class="line">10000-01-01</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šï¼Œå‡è®¾æœ‰ä¸€å¤©ï¼Œæˆ‘ä»¬çš„å¹´å˜æˆäº†äº”ä½æ•°ï¼›è¿™æ—¶å€™ï¼ŒæœåŠ¡ç«¯è¦æ€ä¹ˆçŸ¥é“è‡ªå·±æ˜¯å¦è¯»å–å®Œæ¯•äº†ä¸€ä¸ªå®Œæ•´çš„åºåˆ—åŒ–æ•°æ®å‘¢ï¼Ÿ</p><p>è¿™å°±éœ€è¦æˆ‘ä»¬åšå¥½è§„å®šï¼Œ<strong>å°†å‰nå­—èŠ‚ä½œä¸ºæ ‡è¯†é•¿åº¦çš„æ•°æ®</strong>ã€‚æ¥æ”¶åˆ°æ•°æ®åï¼Œå…ˆå–å‡ºå‰nä¸ªå­—èŠ‚ï¼Œè¯»å–é“æ­¤æ¬¡æ¶ˆæ¯çš„é•¿åº¦mï¼Œå†å¾€åè¯»å–mä¸ªå­—èŠ‚çš„æ•°æ®ï¼ŒæˆåŠŸå–å‡ºå®Œæ•´çš„å­—ç¬¦ä¸²;</p><ul><li>è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç§°ä½œ<strong>ç¼–ç å’Œè§£ç </strong>çš„è¿‡ç¨‹</li></ul><p>ä¸ºäº†åŒºåˆ†æ ‡è¯†é•¿åº¦çš„æ•°æ®å’Œå®é™…éœ€è¦çš„åºåˆ—åŒ–å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¹‹ä¸­åŠ ä¸Šåˆ†éš”ç¬¦<code>\t</code>ï¼›ä½†è¿™ä¹Ÿéœ€è¦æˆ‘ä»¬ç¡®è®¤ï¼Œä¼ è¾“çš„æ•°æ®æœ¬èº«ä¸èƒ½å¸¦ä¸Š<code>\t</code>ï¼Œå¦åˆ™ä¼šäº§ç”Ÿä¸€ç³»åˆ—çš„é—®é¢˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">10\t2000-12-10\t</span><br><span class="line">11\t10000-01-01\t</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šçš„è¿™ä¸€ç³»åˆ—å·¥ä½œï¼Œéƒ½æ˜¯<code>åè®®å®šåˆ¶</code>çš„ä¸€éƒ¨åˆ†ï¼æˆ‘ä»¬ç»™æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è§„å®šäº†ä¸€ä¸ªåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ–¹å¼ï¼Œè®©äºŒè€…é€šä¿¡è§„é¿æ‰äº†å¹³å°çš„é™åˆ¶ã€‚æ¯•ç«Ÿä»»ä½•å¹³å°å¯¹<strong>å­—ç¬¦ä¸²</strong>è§£ç å‡ºæ¥çš„æ•°æ®éƒ½ä¼šæ˜¯ç›¸åŒçš„ï¼</p><p>ä¸‹é¢å°±ç”¨ä¸€ä¸ª<strong>è®¡ç®—å™¨</strong>çš„æœåŠ¡ï¼Œæ¥æ¼”ç¤ºä¸€ä¸‹å§ğŸ˜</p><h1 id="3-è®¡ç®—å™¨æœåŠ¡"><a href="#3-è®¡ç®—å™¨æœåŠ¡" class="headerlink" title="3.è®¡ç®—å™¨æœåŠ¡"></a>3.è®¡ç®—å™¨æœåŠ¡</h1><p>å› ä¸ºæœ¬æ–‡çš„é‡å¿ƒæ˜¯å¯¹åè®®å®šåˆ¶çš„æ¼”ç¤ºï¼Œæ‰€ä»¥è¿™é‡Œçš„è®¡ç®—å™¨<em>ä¸è€ƒè™‘è¿ç»­æ“ä½œç¬¦</em>çš„æƒ…å†µï¼Œ</p><h2 id="3-1-åè®®å®šåˆ¶"><a href="#3-1-åè®®å®šåˆ¶" class="headerlink" title="3.1 åè®®å®šåˆ¶"></a>3.1 åè®®å®šåˆ¶</h2><p>è¦æƒ³å®ç°ä¸€ä¸ªè®¡ç®—å™¨ï¼Œæˆ‘ä»¬é¦–å…ˆè¦ææ˜ç™½è®¡ç®—å™¨æœ‰å‡ ä¸ªæˆå‘˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x+y</span><br><span class="line">x/y</span><br><span class="line">x*y</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªè®¡ç®—å™¨åªéœ€è¦3ä¸ªæˆå‘˜ï¼Œåˆ†åˆ«æ˜¯ä¸¤ä¸ªæ“ä½œæ•°å’Œä¸€ä¸ªè¿ç®—ç¬¦ï¼Œå°±èƒ½å¼€å§‹è®¡ç®—ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†è¿™é‡Œçš„ä¸‰ä¸ªå­—æ®µè®¾è®¡æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ç°åºåˆ—åŒ–ï¼›</p><p>æ¯”å¦‚æˆ‘ä»¬åº”è¯¥è§„å®šåºåˆ—åŒ–ä¹‹åçš„æ•°æ®åº”è¯¥æ˜¯å¦‚ä¸‹çš„ï¼Œä¸¤ä¸ªæ“ä½œæ•°å’Œæ“ä½œç¬¦ä¹‹é—´åº”è¯¥è¦æœ‰<strong>ç©ºæ ¼</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a + b</span><br></pre></td></tr></table></figure><p>å†åœ¨å¼€å¤´æ·»åŠ ä¸Šæ•°æ®é•¿åº¦çš„æ ‡è¯†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ•°æ®é•¿åº¦\tå…¬å¼\t</span><br><span class="line"></span><br><span class="line">7\t10 + 20\t</span><br><span class="line">8\t100 / 30\t</span><br><span class="line">9\t300 - 200\t</span><br></pre></td></tr></table></figure><p>å¯¹äºæœåŠ¡ç«¯ï¼Œæˆ‘ä»¬éœ€è¦è¿”å›ä¸¤ä¸ªå‚æ•°ï¼šçŠ¶æ€ç å’Œç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é€€å‡ºçŠ¶æ€ ç»“æœ</span><br></pre></td></tr></table></figure><p>å¦‚æœé€€å‡ºçŠ¶æ€ä¸ä¸º0ï¼Œåˆ™ä»£è¡¨å‡ºç°é”™è¯¯ï¼Œç»“æœæ— æ•ˆï¼›åªæœ‰é€€å‡ºç»“æœä¸º0ï¼Œç»“æœæ‰æ˜¯æœ‰æ•ˆçš„ã€‚</p><p>åŒæ ·çš„ï¼Œä¹Ÿéœ€è¦ç»™æœåŠ¡å™¨çš„åºåˆ—åŒ–å­—ç¬¦ä¸²æ·»åŠ ä¸Šæ•°æ®çš„é•¿åº¦</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ•°æ®é•¿åº¦\té€€å‡ºçŠ¶æ€ ç»“æœ\t</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±æå®šäº†ä¸€ä¸ªè®¡ç®—å™¨çš„è‡ªå®šä¹‰åè®®ï¼›</p><h2 id="3-2-æˆå‘˜"><a href="#3-2-æˆå‘˜" class="headerlink" title="3.2 æˆå‘˜"></a>3.2 æˆå‘˜</h2><p>ä¾ç…§å¦‚ä¸Šçš„åè®®ï¼Œå…ˆæŠŠè¯·æ±‚å’Œè¿”å›çš„æˆå‘˜å˜é‡å†™å¥½</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Request</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> _x;</span><br><span class="line">    <span class="type">int</span> _y;</span><br><span class="line">    <span class="type">char</span> _ops;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Response</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> _exitCode; <span class="comment">//è®¡ç®—æœåŠ¡çš„é€€å‡ºç </span></span><br><span class="line"><span class="type">int</span> _result;  <span class="comment">// ç»“æœ</span></span><br><span class="line">&#125;;  </span><br></pre></td></tr></table></figure><p>è¿™äº›æˆå‘˜å˜é‡éƒ½è®¾ç½®ä¸ºå…¬æœ‰ï¼Œæ–¹ä¾¿åœ¨taské‡Œé¢è¿›è¡Œå¤„ç†ï¼ˆå¦åˆ™å°±éœ€è¦å†™getå‡½æ•°ï¼Œå¾ˆéº»çƒ¦ï¼‰</p><p>åŒæ—¶ï¼Œæœ€å¥½è¿˜æ˜¯æŠŠåè®®ä¸­çš„åˆ†éš”ç¬¦ç»™å®šä¹‰å‡ºæ¥ï¼Œæ–¹ä¾¿åç»­ç»Ÿä¸€ä½¿ç”¨oræ›´æ”¹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> CRLF <span class="string">&quot;\t&quot;</span>   <span class="comment">//åˆ†éš”ç¬¦</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CRLF_LEN strlen(CRLF) <span class="comment">//åˆ†éš”ç¬¦é•¿åº¦</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPACE <span class="string">&quot; &quot;</span>   <span class="comment">//ç©ºæ ¼</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPACE_LEN strlen(SPACE) <span class="comment">//ç©ºæ ¼é•¿åº¦</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> OPS <span class="string">&quot;+-*/%&quot;</span> <span class="comment">//è¿ç®—ç¬¦</span></span></span><br></pre></td></tr></table></figure><h2 id="3-3-ç¼–ç è§£ç "><a href="#3-3-ç¼–ç è§£ç " class="headerlink" title="3.3 ç¼–ç è§£ç "></a>3.3 ç¼–ç è§£ç </h2><p>å¯¹äºè¯·æ±‚å’Œå›åº”æ¥è¯´ï¼Œç¼–è§£ç çš„æ“ä½œæ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å¾€å­—ç¬¦ä¸²çš„å¼€å¤´æ·»åŠ ä¸Šé•¿åº¦å’Œåˆ†éš”ç¬¦</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é•¿åº¦\tåºåˆ—åŒ–å­—ç¬¦ä¸²\t</span><br></pre></td></tr></table></figure><p>è§£ç å°±æ˜¯å°†é•¿åº¦å’Œåˆ†éš”ç¬¦å»æ‰ï¼Œåªè§£æå‡ºåºåˆ—åŒ–å­—ç¬¦ä¸²</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åºåˆ—åŒ–å­—ç¬¦ä¸²</span><br></pre></td></tr></table></figure><p>ç¼–ç è§£ç çš„æ•´ä¸ªè¿‡ç¨‹åœ¨æ³¨é‡Šé‡Œé¢éƒ½å†™æ˜äº†ğŸ˜ä¸ºäº†æ–¹ä¾¿è¯·æ±‚å’Œå›åº”å»ä½¿ç”¨ï¼Œç›´æ¥æ”¾åˆ°å¤–å¤´ï¼Œä¸åšç±»å†…å°è£…</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‚æ•°lenä¸ºinçš„é•¿åº¦ï¼Œæ˜¯ä¸€ä¸ªè¾“å‡ºå‹å‚æ•°ã€‚å¦‚æœä¸º0ä»£è¡¨err</span></span><br><span class="line"><span class="function">std::string <span class="title">decode</span><span class="params">(std::string&amp; in,<span class="type">size_t</span>*len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">assert</span>(len);<span class="comment">//å¦‚æœé•¿åº¦ä¸º0æ˜¯é”™è¯¯çš„</span></span><br><span class="line">    <span class="comment">// 1.ç¡®è®¤inçš„åºåˆ—åŒ–å­—ç¬¦ä¸²å®Œæ•´ï¼ˆåˆ†éš”ç¬¦ï¼‰</span></span><br><span class="line">    *len=<span class="number">0</span>;</span><br><span class="line">    <span class="type">size_t</span> pos = in.<span class="built_in">find</span>(CRLF);<span class="comment">//æŸ¥æ‰¾åˆ†éš”ç¬¦</span></span><br><span class="line">    <span class="comment">//æŸ¥æ‰¾ä¸åˆ°ï¼Œerr</span></span><br><span class="line">    <span class="keyword">if</span>(pos == std::string::npos)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;<span class="comment">//è¿”å›ç©ºä¸²</span></span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="comment">// 2.æœ‰åˆ†éš”ç¬¦ï¼Œåˆ¤æ–­é•¿åº¦æ˜¯å¦è¾¾æ ‡</span></span><br><span class="line">    <span class="comment">// æ­¤æ—¶posä¸‹æ ‡æ­£å¥½å°±æ˜¯æ ‡è¯†å¤§å°çš„å­—ç¬¦é•¿åº¦</span></span><br><span class="line">    std::string inLenStr = in.<span class="built_in">substr</span>(<span class="number">0</span>,pos);<span class="comment">//æå–å­—ç¬¦ä¸²é•¿åº¦</span></span><br><span class="line">    <span class="type">size_t</span> inLen = <span class="built_in">atoi</span>(inLenStr.<span class="built_in">c_str</span>());<span class="comment">//è½¬int</span></span><br><span class="line">    <span class="type">size_t</span> left = in.<span class="built_in">size</span>() - inLenStr.<span class="built_in">size</span>()- <span class="number">2</span>*CRLF_LEN;<span class="comment">//å‰©ä¸‹çš„å­—ç¬¦é•¿åº¦</span></span><br><span class="line">    <span class="keyword">if</span>(left&lt;inLen)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>; <span class="comment">//å‰©ä¸‹çš„é•¿åº¦æ²¡æœ‰è¾¾åˆ°æ ‡æ˜çš„é•¿åº¦</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.èµ°åˆ°æ­¤å¤„ï¼Œå­—ç¬¦ä¸²å®Œæ•´ï¼Œå¼€å§‹æå–åºåˆ—åŒ–å­—ç¬¦ä¸²</span></span><br><span class="line">    std::string ret = in.<span class="built_in">substr</span>(pos+CRLF_LEN,inLen);</span><br><span class="line">    *len = inLen;</span><br><span class="line">    <span class="comment">// 4.å› ä¸ºinä¸­å¯èƒ½è¿˜æœ‰å…¶ä»–çš„æŠ¥æ–‡ï¼ˆä¸‹ä¸€æ¡ï¼‰</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥éœ€è¦æŠŠå½“å‰çš„æŠ¥æ–‡ä»inä¸­åˆ é™¤ï¼Œæ–¹ä¾¿ä¸‹æ¬¡decodeï¼Œé¿å…äºŒæ¬¡è¯»å–</span></span><br><span class="line">    <span class="type">size_t</span> rmLen = inLenStr.<span class="built_in">size</span>() + ret.<span class="built_in">size</span>() + <span class="number">2</span>*CRLF_LEN;</span><br><span class="line">    in.<span class="built_in">erase</span>(<span class="number">0</span>,rmLen);</span><br><span class="line">    <span class="comment">// 5.è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼–ç ä¸éœ€è¦ä¿®æ”¹æºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥constã€‚å‚æ•°lenä¸ºinçš„é•¿åº¦</span></span><br><span class="line"><span class="function">std::string <span class="title">encode</span><span class="params">(<span class="type">const</span> std::string&amp; in,<span class="type">size_t</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::string ret = std::<span class="built_in">to_string</span>(len);<span class="comment">//å°†é•¿åº¦è½¬ä¸ºå­—ç¬¦ä¸²æ·»åŠ åœ¨æœ€å‰é¢ï¼Œä½œä¸ºæ ‡è¯†</span></span><br><span class="line">    ret+=CRLF;</span><br><span class="line">    ret+=in;</span><br><span class="line">    ret+=CRLF;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-4-request"><a href="#3-4-request" class="headerlink" title="3.4 request"></a>3.4 request</h2><p>ç¼–ç è§£ç å†™å¥½äº†ï¼Œå…ˆæ¥å¤„ç†æ¯”è¾ƒéº»çƒ¦çš„è¯·æ±‚éƒ¨åˆ†ï¼›è¯´éº»çƒ¦å§ï¼Œå…¶å®å¤§å¤šæ•°ä¹Ÿæ˜¯c++çš„stringæ“ä½œï¼Œè¦ç†Ÿç»ƒè¿ç”¨stringçš„å„ç±»æˆå‘˜å‡½æ•°ï¼Œæ‰èƒ½å¾ˆå¥½çš„å®ç°</p><h3 id="3-4-1-æ„é€ "><a href="#3-4-1-æ„é€ " class="headerlink" title="3.4.1 æ„é€ "></a>3.4.1 æ„é€ </h3><p>æ¯”è¾ƒé‡è¦çš„æ˜¯è¿™ä¸ªæ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦å°†ç”¨æˆ·çš„è¾“å…¥è½¬æˆå†…éƒ¨çš„ä¸‰ä¸ªæˆå‘˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ·å¯èƒ½è¾“å…¥x+yï¼Œx+ yï¼Œx +y,x + yç­‰ç­‰æ ¼å¼</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜éœ€è¦æ³¨æ„ï¼Œç”¨æˆ·çš„è¾“å…¥ä¸ä¸€å®šæ˜¯æ ‡å‡†çš„<code>X+Y</code>ï¼Œé‡Œé¢å¯èƒ½åœ¨ä¸åŒä½ç½®é‡Œé¢ä¼šæœ‰ç©ºæ ¼ã€‚ä¸ºäº†ç»Ÿä¸€æ–¹ä¾¿å¤„ç†ï¼Œåœ¨è§£æä¹‹å‰ï¼Œ<strong>æœ€å¥½å…ˆæŠŠç”¨æˆ·è¾“å…¥å†…çš„ç©ºæ ¼ç»™å»æ‰</strong>ï¼</p><p>å¯¹äºstringè€Œè¨€ï¼Œå»æ‰ç©ºæ ¼å°±å¾ˆç®€å•äº†ï¼Œç›´æ¥ä¸€ä¸ªéå†æå®š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ é™¤è¾“å…¥ä¸­çš„ç©ºæ ¼</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rmSpace</span><span class="params">(std::string&amp; in)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::string tmp;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> e:in)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(e!=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            tmp+=e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    in = tmp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæˆçš„æ„é€ å¦‚ä¸‹ï¼Œè¿™é‡Œæ¶‰åŠåˆ°Cè¯­è¨€çš„<a href="https://blog.musnow.top/2022/01/25/note_c/39%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0%E5%92%8C%E5%86%85%E5%AD%98%E5%87%BD%E6%95%B0/#1-7-strtok">å‡½æ•°strtok</a>ï¼Œè¦å¤ä¹ å¤ä¹ </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†ç”¨æˆ·çš„è¾“å…¥è½¬æˆå†…éƒ¨æˆå‘˜</span></span><br><span class="line"><span class="comment">// ç”¨æˆ·å¯èƒ½è¾“å…¥x+yï¼Œx+ yï¼Œx +y,x + yç­‰ç­‰æ ¼å¼</span></span><br><span class="line"><span class="comment">// æå‰ä¿®æ”¹ç”¨æˆ·è¾“å…¥ï¼ˆä¸»è¦è¿˜æ˜¯å»æ‰ç©ºæ ¼ï¼‰ï¼Œæå–å‡ºæˆå‘˜</span></span><br><span class="line"><span class="built_in">Request</span>(std::string in,<span class="type">bool</span>* status)</span><br><span class="line">    :_x(<span class="number">0</span>),_y(<span class="number">0</span>),_ops(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">rmSpace</span>(in);</span><br><span class="line">    <span class="comment">// è¿™é‡Œä½¿ç”¨cçš„å­—ç¬¦ä¸²ï¼Œå› ä¸ºæœ‰strtok</span></span><br><span class="line">    <span class="type">char</span> buf[<span class="number">1024</span>];</span><br><span class="line">    <span class="comment">// æ‰“å°nä¸ªå­—ç¬¦ï¼Œå¤šçš„ä¼šè¢«æˆªæ–­</span></span><br><span class="line">    <span class="built_in">snprintf</span>(buf,<span class="built_in">sizeof</span>(buf),<span class="string">&quot;%s&quot;</span>,in.<span class="built_in">c_str</span>());</span><br><span class="line">    <span class="type">char</span>* left = <span class="built_in">strtok</span>(buf,OPS);</span><br><span class="line">    <span class="keyword">if</span>(!left)&#123;<span class="comment">//æ‰¾ä¸åˆ°</span></span><br><span class="line">        *status = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">char</span>*right = <span class="built_in">strtok</span>(<span class="literal">nullptr</span>,OPS);</span><br><span class="line">    <span class="keyword">if</span>(!right)&#123;<span class="comment">//æ‰¾ä¸åˆ°</span></span><br><span class="line">        *status = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// x+y, strtokä¼šå°†+è®¾ç½®ä¸º\0</span></span><br><span class="line">    <span class="type">char</span> mid = in[<span class="built_in">strlen</span>(left)];<span class="comment">//æˆªå–å‡ºæ“ä½œç¬¦</span></span><br><span class="line">    <span class="comment">//è¿™æ˜¯åœ¨åŸå­—ç¬¦ä¸²é‡Œé¢å–å‡ºæ¥ï¼Œbufé‡Œé¢çš„è¿™ä¸ªä½ç½®è¢«æ”¹æˆ\0äº†</span></span><br><span class="line"></span><br><span class="line">    _x = <span class="built_in">atoi</span>(left);</span><br><span class="line">    _y = <span class="built_in">atoi</span>(right);</span><br><span class="line">    _ops = mid;</span><br><span class="line">    *status=<span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4-2-åºåˆ—åŒ–"><a href="#3-4-2-åºåˆ—åŒ–" class="headerlink" title="3.4.2 åºåˆ—åŒ–"></a>3.4.2 åºåˆ—åŒ–</h3><p>è§£æå‡ºæˆå‘˜ä»¥åï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯å¯¹æˆå‘˜è¿›è¡Œåºåˆ—åŒ–ï¼Œå°†å…¶æŒ‰æŒ‡å®šçš„ä½ç½®æ‘†æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚è¿™é‡Œé‡‡ç”¨äº†<strong>è¾“å‡ºå‹å‚æ•°</strong>çš„æ–¹å¼æ¥åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ”¹æˆç”¨è¿”å›å€¼çš„æ–¹å¼æ¥æ“ä½œã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ“ä½œç¬¦æœ¬èº«å°±æ˜¯<code>char</code>ä¸èƒ½ä½¿ç”¨<code>to_string</code>æ¥æ“ä½œï¼Œä¼šè¢«è½¬æˆ<code>ascii</code>ç ï¼Œä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åºåˆ—åŒ– ï¼ˆå…¥å‚åº”è¯¥æ˜¯ç©ºçš„ï¼‰</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">serialize</span><span class="params">(std::string&amp; out)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// x + y</span></span><br><span class="line">    out.<span class="built_in">clear</span>(); <span class="comment">// åºåˆ—åŒ–çš„å…¥å‚æ˜¯ç©ºçš„</span></span><br><span class="line">    out+= std::<span class="built_in">to_string</span>(_x);</span><br><span class="line">    out+= SPACE;</span><br><span class="line">    out+= _ops;<span class="comment">//æ“ä½œç¬¦ä¸èƒ½ç”¨tostringï¼Œä¼šè¢«è½¬æˆascii</span></span><br><span class="line">    out+= SPACE;</span><br><span class="line">    out+= std::<span class="built_in">to_string</span>(_y);</span><br><span class="line">    <span class="comment">// ä¸ç”¨æ·»åŠ åˆ†éš”ç¬¦ï¼ˆè¿™æ˜¯encodeè¦å¹²çš„äº‹æƒ…ï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4-3-ååºåˆ—åŒ–"><a href="#3-4-3-ååºåˆ—åŒ–" class="headerlink" title="3.4.3 ååºåˆ—åŒ–"></a>3.4.3 ååºåˆ—åŒ–</h3><p>æ³¨æ„ï¼Œæ€è·¯ä¸èƒ½æé”™äº†ã€‚åˆšå¼€å§‹æˆ‘è®¤ä¸º<code>request</code>çš„ååºåˆ—åŒ–åº”è¯¥é’ˆå¯¹çš„æ˜¯æœåŠ¡å™¨çš„è¿”å›å€¼ï¼Œ<strong>å®é™…å¹¶éå¦‚æ­¤</strong>ï¼</p><p>åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½éœ€è¦ä½¿ç”¨<code>request</code>ï¼Œå®¢æˆ·ç«¯è¿›è¡Œåºåˆ—åŒ–ï¼ŒæœåŠ¡ç«¯å¯¹æ¥æ”¶åˆ°çš„ç»“æœåˆ©ç”¨<code>request</code>è¿›è¡Œååºåˆ—åŒ–ã€‚requeståªå…³æ³¨äºå¯¹è¯·æ±‚çš„å¤„ç†ï¼Œè€Œä¸å¤„ç†æœåŠ¡å™¨çš„è¿”å›å€¼ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">deserialize</span><span class="params">(<span class="type">const</span> std::string &amp;in)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// x + y éœ€è¦å–å‡ºxï¼Œyå’Œæ“ä½œç¬¦</span></span><br><span class="line">    <span class="type">size_t</span> space1 = in.<span class="built_in">find</span>(SPACE); <span class="comment">//ç¬¬ä¸€ä¸ªç©ºæ ¼</span></span><br><span class="line">    <span class="keyword">if</span>(space1 == std::string::npos)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">size_t</span> space2 = in.<span class="built_in">rfind</span>(SPACE); <span class="comment">//ç¬¬äºŒä¸ªç©ºæ ¼</span></span><br><span class="line">    <span class="keyword">if</span>(space2 == std::string::npos)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸¤ä¸ªç©ºæ ¼éƒ½å­˜åœ¨ï¼Œå¼€å§‹å–æ•°æ®</span></span><br><span class="line">    std::string dataX = in.<span class="built_in">substr</span>(<span class="number">0</span>,space1);</span><br><span class="line">    std::string dataY = in.<span class="built_in">substr</span>(space2+SPACE_LEN);<span class="comment">//é»˜è®¤å–åˆ°ç»“å°¾</span></span><br><span class="line">    std::string op = in.<span class="built_in">substr</span>(space1+SPACE_LEN,space2 -(space1+SPACE_LEN));</span><br><span class="line">    <span class="keyword">if</span>(op.<span class="built_in">size</span>()!=<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;<span class="comment">//æ“ä½œç¬¦é•¿åº¦æœ‰é—®é¢˜</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ²¡é—®é¢˜äº†ï¼Œè½¬å†…éƒ¨æˆå‘˜</span></span><br><span class="line">    _x = <span class="built_in">atoi</span>(dataX.<span class="built_in">c_str</span>());</span><br><span class="line">    _y = <span class="built_in">atoi</span>(dataY.<span class="built_in">c_str</span>());</span><br><span class="line">    _ops = op[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-5-response"><a href="#3-5-response" class="headerlink" title="3.5 response"></a>3.5 response</h2><h3 id="3-5-1-æ„é€ "><a href="#3-5-1-æ„é€ " class="headerlink" title="3.5.1 æ„é€ "></a>3.5.1 æ„é€ </h3><p>è¿”å›å€¼çš„æ„é€ æ¯”è¾ƒç®€å•ï¼Œå› ä¸ºæ˜¯æœåŠ¡å™¨å¤„ç†ç»“æœä¹‹åçš„æ“ä½œï¼›è¿™äº›æˆå‘˜å˜é‡éƒ½è®¾ç½®ä¸ºäº†å…¬æœ‰ï¼Œæ–¹ä¾¿åç»­ä¿®æ”¹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Response</span>(<span class="type">int</span> code=<span class="number">0</span>,<span class="type">int</span> result=<span class="number">0</span>)</span><br><span class="line">    :_exitCode(code),_result(result)</span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="3-5-2-åºåˆ—åŒ–"><a href="#3-5-2-åºåˆ—åŒ–" class="headerlink" title="3.5.2 åºåˆ—åŒ–"></a>3.5.2 åºåˆ—åŒ–</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…¥å‚æ˜¯ç©ºçš„</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">serialize</span><span class="params">(std::string&amp; out)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// code ret</span></span><br><span class="line">    out.<span class="built_in">clear</span>();</span><br><span class="line">    out+= std::<span class="built_in">to_string</span>(_exitCode);</span><br><span class="line">    out+= SPACE;</span><br><span class="line">    out+= std::<span class="built_in">to_string</span>(_result);</span><br><span class="line">    out+= CRLF;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-5-3-ååºåˆ—åŒ–"><a href="#3-5-3-ååºåˆ—åŒ–" class="headerlink" title="3.5.3 ååºåˆ—åŒ–"></a>3.5.3 ååºåˆ—åŒ–</h3><p>å“åº”çš„ååºåˆ—åŒ–åªéœ€è¦å¤„ç†ä¸€ä¸ªç©ºæ ¼ï¼Œç›¸å¯¹æ¥è¯´è¾ƒä¸ºç®€å•</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">deserialize</span><span class="params">(<span class="type">const</span> std::string &amp;in)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// åªæœ‰ä¸€ä¸ªç©ºæ ¼</span></span><br><span class="line">    <span class="type">size_t</span> space = in.<span class="built_in">find</span>(SPACE);</span><br><span class="line">    <span class="keyword">if</span>(space == std::string::npos)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    std::string dataCode = in.<span class="built_in">substr</span>(<span class="number">0</span>,space);</span><br><span class="line">    std::string dataRes = in.<span class="built_in">substr</span>(space+SPACE_LEN);</span><br><span class="line">    _exitCode = <span class="built_in">atoi</span>(dataCode.<span class="built_in">c_str</span>());</span><br><span class="line">    _result = <span class="built_in">atoi</span>(dataRes.<span class="built_in">c_str</span>());</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-6-å®¢æˆ·ç«¯"><a href="#3-6-å®¢æˆ·ç«¯" class="headerlink" title="3.6 å®¢æˆ·ç«¯"></a>3.6 å®¢æˆ·ç«¯</h2><p>ä¹‹å‰å†™çš„å®¢æˆ·ç«¯ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œåºåˆ—åŒ–æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸Šåºåˆ—åŒ–æ“ä½œï¼Œå¹¶å¯¹æœåŠ¡å™¨çš„è¿”å›å€¼è¿›è¡Œååºåˆ—åŒ–ã€‚è¿™æœŸé—´éœ€è¦åŠ ä¸Šä¸€ç³»åˆ—åˆ¤æ–­ï¼›</p><p>ä¸ºäº†é™åˆ¶ç¯‡å¹…ï¼Œä¸‹é¢åªè´´å‡ºæ¥å®¢æˆ·ç«¯çš„å¾ªç¯æ“ä½œï¼›è¯¦æƒ…å‚è€ƒæ³¨é‡Šã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®¢æˆ·ç«¯å‘ç°çš„æ¶ˆæ¯</span></span><br><span class="line">string message;</span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    message.<span class="built_in">clear</span>();<span class="comment">//æ¯æ¬¡å¾ªç¯å¼€å§‹ï¼Œéƒ½æ¸…ç©ºä¸€ä¸‹msg</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;è¯·è¾“å…¥ä½ çš„æ¶ˆæ¯# &quot;</span>;</span><br><span class="line">    <span class="built_in">getline</span>(cin, message);<span class="comment">//è·å–è¾“å…¥</span></span><br><span class="line">    <span class="comment">// å¦‚æœå®¢æˆ·ç«¯è¾“å…¥äº†quitï¼Œåˆ™é€€å‡º</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strcasecmp</span>(message.<span class="built_in">c_str</span>(), <span class="string">&quot;quit&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">// å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºä¸€ä¸ªrequestï¼ˆåˆ†ç¦»å‚æ•°ï¼‰</span></span><br><span class="line">    <span class="type">bool</span> reqStatus = <span class="literal">true</span>;</span><br><span class="line">    <span class="function">Request <span class="title">req</span><span class="params">(message,&amp;reqStatus)</span></span>;</span><br><span class="line">    <span class="keyword">if</span>(!reqStatus)&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;make req err!&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.åºåˆ—åŒ–å’Œç¼–ç </span></span><br><span class="line">    string package;</span><br><span class="line">    req.<span class="built_in">serialize</span>(package);<span class="comment">//åºåˆ—åŒ–</span></span><br><span class="line">    package = <span class="built_in">encode</span>(package,package.<span class="built_in">size</span>());<span class="comment">//ç¼–ç </span></span><br><span class="line">    <span class="comment">// 3.å‘é€ç»™æœåŠ¡å™¨</span></span><br><span class="line">    <span class="type">ssize_t</span> s = <span class="built_in">write</span>(sock,package.<span class="built_in">c_str</span>(), package.<span class="built_in">size</span>());</span><br><span class="line">    <span class="keyword">if</span> (s &gt; <span class="number">0</span>) <span class="comment">// å†™å…¥æˆåŠŸ</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 4.è·å–æœåŠ¡å™¨çš„ç»“æœ</span></span><br><span class="line">        <span class="type">char</span> buff[BUFFER_SIZE];</span><br><span class="line">        <span class="type">size_t</span> s = <span class="built_in">read</span>(sock, buff, <span class="built_in">sizeof</span>(buff)<span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">if</span>(s &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            buff[s] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        std::string echoPackage = buff;</span><br><span class="line">        Response resp;</span><br><span class="line">        <span class="type">size_t</span> len = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 5.è§£ç å’Œååºåˆ—åŒ–</span></span><br><span class="line">        std::string tmp = <span class="built_in">decode</span>(echoPackage, &amp;len);</span><br><span class="line">        <span class="keyword">if</span>(len &gt; <span class="number">0</span>)<span class="comment">//è§£ç æˆåŠŸ</span></span><br><span class="line">        &#123;</span><br><span class="line">            echoPackage = tmp;</span><br><span class="line">            <span class="keyword">if</span>(resp.<span class="built_in">deserialize</span>(echoPackage))<span class="comment">//ååºåˆ—åŒ–å¹¶åˆ¤æ–­</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;ECHO [exitcode: %d] %d\n&quot;</span>, resp._exitCode, resp._result);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                cerr &lt;&lt; <span class="string">&quot;server echo deserialize err!&quot;</span> &lt;&lt; endl;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            cerr &lt;&lt; <span class="string">&quot;server echo decode err!&quot;</span> &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (s &lt;= <span class="number">0</span>) <span class="comment">// å†™å…¥å¤±è´¥</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-7-æœåŠ¡ç«¯"><a href="#3-7-æœåŠ¡ç«¯" class="headerlink" title="3.7 æœåŠ¡ç«¯"></a>3.7 æœåŠ¡ç«¯</h2><p>æœåŠ¡ç«¯æ— é¡»ä¿®æ”¹ä»£ç ï¼Œéœ€è¦ä¿®æ”¹çš„æ˜¯taskæ¶ˆæ¯é˜Ÿåˆ—ä¸­å¤„ç†çš„ä»»åŠ¡ï¼›è¿™å°±æ˜¯ä¹‹å‰åšå¥½å°è£…çš„å¥½å¤„ï¼Œå› ä¸ºåªéœ€è¦ä¿®æ”¹taské‡Œé¢ä¼ å…¥çš„å‡½æ•°æŒ‡é’ˆï¼Œå°±ç®—æ˜¯ä¿®æ”¹äº†æœåŠ¡å™¨æ‰€è¿›è¡Œçš„æœåŠ¡</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æä¾›æœåŠ¡ï¼ˆé€šè¿‡çº¿ç¨‹æ± ï¼‰</span></span><br><span class="line"><span class="function">Task <span class="title">t</span><span class="params">(conet,senderIP,senderPort,CaculateService)</span></span>;</span><br><span class="line">_tpool-&gt;<span class="built_in">push</span>(t);</span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹æ˜¯è®¡ç®—å™¨æœåŠ¡çš„ä»£ç </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CaculateService</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> std::string &amp;clientIP, <span class="type">uint16_t</span> clientPort)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">assert</span>(sockfd &gt;= <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">assert</span>(!clientIP.<span class="built_in">empty</span>());</span><br><span class="line">    <span class="built_in">assert</span>(clientPort &gt; <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    std::string inbuf;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        Request req;</span><br><span class="line">        <span class="type">char</span> buf[BUFFER_SIZE];</span><br><span class="line">        <span class="comment">// 1.è¯»å–å®¢æˆ·ç«¯å‘é€çš„ä¿¡æ¯</span></span><br><span class="line">        <span class="type">ssize_t</span> s = <span class="built_in">read</span>(sockfd, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (s == <span class="number">0</span>)</span><br><span class="line">        &#123;   <span class="comment">// s == 0ä»£è¡¨å¯¹æ–¹å‘é€äº†ç©ºæ¶ˆæ¯ï¼Œè§†ä½œå®¢æˆ·ç«¯ä¸»åŠ¨é€€å‡º</span></span><br><span class="line">            <span class="built_in">logging</span>(DEBUG, <span class="string">&quot;client quit: %s[%d]&quot;</span>, clientIP.<span class="built_in">c_str</span>(), clientPort);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(s&lt;<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// å‡ºç°äº†è¯»å–é”™è¯¯ï¼Œæ‰“å°æ—¥å¿—åæ–­å¼€è¿æ¥</span></span><br><span class="line">            <span class="built_in">logging</span>(DEBUG, <span class="string">&quot;read err: %s[%d] = %s&quot;</span>, clientIP.<span class="built_in">c_str</span>(), clientPort, <span class="built_in">strerror</span>(errno));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.è¯»å–æˆåŠŸ</span></span><br><span class="line">        buf[s] = <span class="string">&#x27;\0&#x27;</span>; <span class="comment">// æ‰‹åŠ¨æ·»åŠ å­—ç¬¦ä¸²ç»ˆæ­¢ç¬¦</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcasecmp</span>(buf, <span class="string">&quot;quit&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">        &#123; <span class="comment">// å®¢æˆ·ç«¯ä¸»åŠ¨é€€å‡º</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.å¼€å§‹æœåŠ¡</span></span><br><span class="line">        inbuf = buf;</span><br><span class="line">        <span class="type">size_t</span> packageLen = inbuf.<span class="built_in">size</span>();</span><br><span class="line">        <span class="comment">// 3.1.è§£ç å’Œååºåˆ—åŒ–å®¢æˆ·ç«¯ä¼ æ¥çš„æ¶ˆæ¯</span></span><br><span class="line">        std::string package = <span class="built_in">decode</span>(inbuf, &amp;packageLen);<span class="comment">//è§£ç </span></span><br><span class="line">        <span class="keyword">if</span>(packageLen==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="built_in">logging</span>(DEBUG, <span class="string">&quot;decode err: %s[%d] status: %d&quot;</span>, clientIP.<span class="built_in">c_str</span>(), clientPort, packageLen);</span><br><span class="line">            <span class="keyword">continue</span>;<span class="comment">//æŠ¥æ–‡ä¸å®Œæ•´æˆ–æœ‰è¯¯</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">logging</span>(DEBUG,<span class="string">&quot;package: %s[%d] = %s&quot;</span>,clientIP.<span class="built_in">c_str</span>(), clientPort,package.<span class="built_in">c_str</span>());</span><br><span class="line">        <span class="type">bool</span> deStatus = req.<span class="built_in">deserialize</span>(package); <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">        <span class="keyword">if</span>(deStatus) <span class="comment">// è·å–æ¶ˆæ¯ååºåˆ—åŒ–æˆåŠŸ</span></span><br><span class="line">        &#123;</span><br><span class="line">            req.<span class="built_in">debug</span>(); <span class="comment">// æ‰“å°ä¿¡æ¯</span></span><br><span class="line">            <span class="comment">// 3.2.è·å–ç»“æ„åŒ–çš„ç›¸åº”</span></span><br><span class="line">            Response resp = <span class="built_in">Caculater</span>(req);</span><br><span class="line">            <span class="comment">// 3.3.åºåˆ—åŒ–å’Œç¼–ç å“åº”</span></span><br><span class="line">            std::string echoStr;</span><br><span class="line">            resp.<span class="built_in">serialize</span>(echoStr);</span><br><span class="line">            echoStr = <span class="built_in">encode</span>(echoStr,echoStr.<span class="built_in">size</span>());</span><br><span class="line">            <span class="comment">// 3.4.å†™å…¥ï¼Œå‘é€è¿”å›å€¼ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">            <span class="built_in">write</span>(sockfd, echoStr.<span class="built_in">c_str</span>(), echoStr.<span class="built_in">size</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">// å®¢æˆ·ç«¯æ¶ˆæ¯ååºåˆ—åŒ–å¤±è´¥</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">logging</span>(DEBUG, <span class="string">&quot;deserialize err: %s[%d] status: %d&quot;</span>, clientIP.<span class="built_in">c_str</span>(), clientPort, deStatus);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(sockfd);</span><br><span class="line">    <span class="built_in">logging</span>(DEBUG, <span class="string">&quot;server quit: %s[%d] %d&quot;</span>,clientIP.<span class="built_in">c_str</span>(), clientPort, sockfd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­æœ‰ä¸€ä¸ªè®¡ç®—å‡½æ•°ï¼Œæ¯”è¾ƒç®€å•ï¼Œé€šè¿‡switch caseè¯­å¥ï¼Œè®¡ç®—ç»“æœï¼Œå¹¶åˆ¤æ–­æ“ä½œæ•°æ˜¯å¦æœ‰é—®é¢˜ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Response <span class="title">Caculater</span><span class="params">(<span class="type">const</span> Request&amp; req)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Response resp;<span class="comment">//æ„é€ å‡½æ•°ä¸­å·²ç»æŒ‡å®šäº†exitcodeä¸º0</span></span><br><span class="line">    <span class="keyword">switch</span> (req._ops)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">        resp._result = req._x + req._y;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">        resp._result = req._x - req._y;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">        resp._result = req._x * req._y;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;%&#x27;</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(req._y == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            resp._exitCode = <span class="number">-1</span>;<span class="comment">//å–æ¨¡é”™è¯¯</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        resp._result = req._x % req._y;<span class="comment">//å–æ¨¡æ˜¯å¯ä»¥æ“ä½œè´Ÿæ•°çš„</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(req._y == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            resp._exitCode = <span class="number">-2</span>;<span class="comment">//é™¤0é”™è¯¯</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        resp._result = req._x / req._y;<span class="comment">//å–æ¨¡æ˜¯å¯ä»¥æ“ä½œè´Ÿæ•°çš„</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        resp._exitCode = <span class="number">-3</span>;<span class="comment">//æ“ä½œç¬¦éæ³•</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> resp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬çš„åºåˆ—åŒ–å¤„ç†å°±æˆåŠŸäº†ï¼æµ‹è¯•ä¸€ä¸‹å§</p><h1 id="4-æµ‹è¯•"><a href="#4-æµ‹è¯•" class="headerlink" title="4.æµ‹è¯•"></a>4.æµ‹è¯•</h1><p>è¿è¡ŒæœåŠ¡å™¨ï¼Œå¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å™¨èƒ½æˆåŠŸå¤„ç†å®¢æˆ·ç«¯çš„è®¡ç®—ï¼Œå¹¶è¿”å›ç»“æœ</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e86fed80298.png"                      alt="image-20230212124940995"                ></p><p>è¾“å…¥quitï¼ŒæœåŠ¡å™¨ä¼šæ‰“å°ä¿¡æ¯ï¼Œå¹¶é€€å‡ºæœåŠ¡</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e87096915d4.png"                      alt="image-20230212125238473"                ></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä»¥tcpServerçš„&lt;strong&gt;è®¡ç®—å™¨&lt;/strong&gt;æœåŠ¡ä¸ºä¾‹ï¼Œå®ç°ä¸€ä¸ªè‡ªå®šä¹‰åè®®&lt;/p&gt;</summary>
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="ç½‘ç»œ" scheme="https://blog.musnow.top/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>ã€Gitã€‘å¦‚ä½•ä¿®æ”¹æœ¬åœ°ä»“åº“çš„ç”¨æˆ·åå’Œé‚®ç®±</title>
    <link href="https://blog.musnow.top/2023/02/11/tools/13%E4%BF%AE%E6%94%B9git%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E9%82%AE%E7%AE%B1/"/>
    <id>https://blog.musnow.top/2023/02/11/tools/13%E4%BF%AE%E6%94%B9git%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E9%82%AE%E7%AE%B1/</id>
    <published>2023-02-11T01:19:28.000Z</published>
    <updated>2023-02-11T01:18:56.643Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æˆ‘ä¿®æ”¹äº†æˆ‘giteeå’Œgithubçš„ç”¨æˆ·åè¿˜æœ‰é‚®ç®±ï¼Œæ‰€ä»¥éœ€è¦å¯¹æœ¬åœ°ä»“åº“é…ç½®çš„ç”¨æˆ·åå’Œé‚®ç®±è¿›è¡Œæ›´æ”¹</p><span id="more"></span><h1 id="1-å‘½ä»¤"><a href="#1-å‘½ä»¤" class="headerlink" title="1.å‘½ä»¤"></a>1.å‘½ä»¤</h1><p> åˆšå¼€å§‹æˆ‘ä½¿ç”¨çš„æ˜¯å¦‚ä¸‹å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.email &quot;é‚®ç®±&quot;</span><br><span class="line">git config --global user.name &quot;ç”¨æˆ·å&quot;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¾ˆä¸è¾›ï¼Œè¿™ä¸ªå‘½ä»¤æ²¡æœ‰ç”¨ï¼Œå› ä¸ºå®ƒæ˜¯ç”¨æ¥åˆå§‹åŒ–ä½ çš„gitç¯å¢ƒçš„ï¼Œå¯¹å·²æœ‰çš„gitä»“åº“ä¸èµ·ä½œç”¨</p><p>ä½†æ˜¯æˆ‘ä»¬åœ¨<code>linux</code>ä¸‹å¯ä»¥æ·»åŠ ä¸Šå¦å¤–ä¸€ä¸ªå‚æ•°æ¥å®ç°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global --replace-all user.email &quot;é‚®ç®±&quot; </span><br><span class="line">git config --global --replace-all user.name &quot;ç”¨æˆ·å&quot;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±ä¿®æ”¹æˆåŠŸäº†</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e6eaa589b3b.png"                      alt="image-20230211090846508"                ></p><blockquote><p>è¿™ä¸ªå‘½ä»¤åœ¨windowsä¸‹ä¼¼ä¹æ— æ³•è¯†åˆ«ï¼Œä¼šå¼¹å‡ºgitçš„å‘½ä»¤è¡Œå¸®åŠ©</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e6ec242c79e.png"                      alt="image-20230211091516456"                ></p></blockquote><p>ä½†æ˜¯ï¼Œä¿®æ”¹æˆåŠŸåçš„æäº¤ï¼Œåªå¯¹æœªæ¥çš„æäº¤æœ‰æ•ˆï¼›è¿™é‡Œå¿…é¡»å¾—åæ§½ä¸€ä¸‹giteeå’Œgithubç»Ÿè®¡æäº¤çš„ä¸åŒä¹‹å¤„</p><ul><li>giteeç»Ÿè®¡æäº¤ä¾æ®çš„æ˜¯ç”¨æˆ·å+é‚®ç®±ï¼Œåªè¦æœ‰ä¸€ä¸ªä¸å¯¹å°±æ— æ³•ç»Ÿè®¡</li><li>githubç»Ÿè®¡æäº¤åªä¾æ®é‚®ç®±ï¼Œåªè¦ä½ é‚®ç®±å¯¹äº†ï¼Œç”¨æˆ·åæ˜¯ä¸ç®¡ä½ çš„</li></ul><p>æ‰€ä»¥è¦æƒ³è®©giteeçš„ç»Ÿè®¡èƒ½ç”Ÿæ•ˆï¼Œé‚£å°±å¿…é¡»è¦ä¿®æ”¹ä¹‹å‰æ‰€æœ‰æäº¤ä¿¡æ¯ä¸­çš„ç”¨æˆ·åå’Œé‚®ç®±</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e6eba93dc9c.png"                      alt="image-20230211091313728"                ></p><h1 id="2-ä¿®æ”¹ä¹‹å‰æäº¤ä¸­çš„ç”¨æˆ·åå’Œé‚®ç®±"><a href="#2-ä¿®æ”¹ä¹‹å‰æäº¤ä¸­çš„ç”¨æˆ·åå’Œé‚®ç®±" class="headerlink" title="2.ä¿®æ”¹ä¹‹å‰æäº¤ä¸­çš„ç”¨æˆ·åå’Œé‚®ç®±"></a>2.ä¿®æ”¹ä¹‹å‰æäº¤ä¸­çš„ç”¨æˆ·åå’Œé‚®ç®±</h1><blockquote><p><a class="link"   href="https://cloud.tencent.com/developer/article/1946705#:~:text=%E5%A6%82%E6%9E%9C%E9%9C%80%E8%A6%81%E4%BF%AE%E6%94%B9%20git%20%E5%9C%A8%E6%9C%AC%E5%9C%B0%E7%9A%84%E5%85%A8%E5%B1%80%E9%82%AE%E7%AE%B1%E5%92%8C%E7%94%A8%E6%88%B7%E5%90%8D%EF%BC%8C%E6%89%A7%E8%A1%8C%E4%B8%8B%E9%9D%A2%E7%9A%84%E5%91%BD%E4%BB%A4%E3%80%82%20git%20config%20--global%20user.name%20%22%E8%BE%93%E5%85%A5%E4%BD%A0%E7%9A%84%E7%94%A8%E6%88%B7%E5%90%8D%22,%22%E8%BE%93%E5%85%A5%E4%BD%A0%E7%9A%84%E9%82%AE%E7%AE%B1%22%20%E7%8E%B0%E5%9C%A8%E6%88%91%E4%BB%AC%E5%B7%B2%E7%BB%8F%E8%AE%BE%E7%BD%AE%E5%A5%BD%E4%BA%86%E6%9C%AC%E5%9C%B0%20git%20%E7%9A%84%20user.name%20%E5%92%8C%20user.email%20%E4%BF%A1%E6%81%AF%E3%80%82" >å‚è€ƒåšå®¢<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>å¤åˆ¶å¦‚ä¸‹ä»£ç åˆ°ä¸€ä¸ªæœ¬æ–‡ç¼–è¾‘å™¨é‡Œé¢ï¼Œå°†å†…éƒ¨çš„é‚®ç®±å’Œç”¨æˆ·ä¿¡æ¯ä¿®æ”¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">git filter-branch -f --env-filter &#x27;</span><br><span class="line">OLD_EMAIL=&quot;åŸæ¥çš„é‚®ç®±&quot;</span><br><span class="line">CORRECT_NAME=&quot;ç°åœ¨çš„åå­—&quot;</span><br><span class="line">CORRECT_EMAIL=&quot;ç°åœ¨çš„é‚®ç®±&quot;</span><br><span class="line">if [ &quot;$GIT_COMMITTER_EMAIL&quot; = &quot;$OLD_EMAIL&quot; ]</span><br><span class="line">then</span><br><span class="line">    export GIT_COMMITTER_NAME=&quot;$CORRECT_NAME&quot;</span><br><span class="line">    export GIT_COMMITTER_EMAIL=&quot;$CORRECT_EMAIL&quot;</span><br><span class="line">fi</span><br><span class="line">if [ &quot;$GIT_AUTHOR_EMAIL&quot; = &quot;$OLD_EMAIL&quot; ]</span><br><span class="line">then</span><br><span class="line">    export GIT_AUTHOR_NAME=&quot;$CORRECT_NAME&quot;</span><br><span class="line">    export GIT_AUTHOR_EMAIL=&quot;$CORRECT_EMAIL&quot;</span><br><span class="line">fi</span><br><span class="line">&#x27; --tag-name-filter cat -- --branches --tags</span><br></pre></td></tr></table></figure><p>éšåå°†å…¶ç²˜è´´åˆ°gitå‘½ä»¤è¡Œä¸­ï¼Œå›è½¦æ‰§è¡Œ</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e6eb4885b41.png"                      alt="image-20230211091136866"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e6ec56eebd5.png"                      alt="image-20230211091607229"                ></p><p>æ‰§è¡Œå®Œæ¯•ï¼Œå°±èƒ½çœ‹åˆ°æ‰€æœ‰gitæäº¤çš„ç”¨æˆ·åå’Œé‚®ç®±éƒ½ä¿®æ”¹æˆåŠŸäº†ï¼æ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯å¼ºåˆ¶æäº¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -f</span><br></pre></td></tr></table></figure><p>å¼ºåˆ¶æäº¤äº†ä¹‹åï¼Œä¹‹å‰æ˜¾ç¤ºä¸å‡ºæ¥çš„ä¿¡æ¯å’Œå°ç»¿ç‚¹ï¼Œç°åœ¨ä¹Ÿèƒ½æ­£å¸¸æ˜¾ç¤ºäº†</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e6eb7339c69.png"                      alt="image-20230211091219547"                ></p><p>å¦‚æœç”¨ä¸Šé¢çš„å‘½ä»¤ä¿®æ”¹å¤±è´¥çš„è¯ï¼Œé‚£å°±å°è¯•æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git filter-branch -f --index-filter &#x27;git rm --cached --ignore-unmatch Rakefile&#x27; HEAD</span><br></pre></td></tr></table></figure><p>éšåå†é‡è¯•ä¸Šé¢çš„å‘½ä»¤ï¼Œåº”è¯¥å°±OKäº†</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ€è¿‘æˆ‘ä¿®æ”¹äº†æˆ‘giteeå’Œgithubçš„ç”¨æˆ·åè¿˜æœ‰é‚®ç®±ï¼Œæ‰€ä»¥éœ€è¦å¯¹æœ¬åœ°ä»“åº“é…ç½®çš„ç”¨æˆ·åå’Œé‚®ç®±è¿›è¡Œæ›´æ”¹&lt;/p&gt;</summary>
    
    
    
    <category term="å·®ç”Ÿæ–‡å…·å¤š" scheme="https://blog.musnow.top/categories/%E5%B7%AE%E7%94%9F%E6%96%87%E5%85%B7%E5%A4%9A/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="git" scheme="https://blog.musnow.top/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>ã€Pythonã€‘æ•™ä½ ç™½å«–replitéƒ¨ç½²kook-ticket-bot</title>
    <link href="https://blog.musnow.top/2023/02/09/note_Python/9%E7%99%BD%E5%AB%96replist%E9%83%A8%E7%BD%B2ticket%E6%9C%BA%E5%99%A8%E4%BA%BA/"/>
    <id>https://blog.musnow.top/2023/02/09/note_Python/9%E7%99%BD%E5%AB%96replist%E9%83%A8%E7%BD%B2ticket%E6%9C%BA%E5%99%A8%E4%BA%BA/</id>
    <published>2023-02-09T10:19:00.000Z</published>
    <updated>2023-02-10T03:54:48.991Z</updated>
    
    <content type="html"><![CDATA[<p>æ•™ä½ ç™½å«–replitéƒ¨ç½²kookçš„ticketæœºå™¨äºº</p><span id="more"></span><h1 id="1-å‰è¨€"><a href="#1-å‰è¨€" class="headerlink" title="1.å‰è¨€"></a>1.å‰è¨€</h1><p>æœ€è¿‘æœ‰ä¸å°‘è€å“¥æ¥æ‰¾æˆ‘å’¨è¯¢æœ‰å…³ticketæœºå™¨äººçš„äº‹æƒ…ï¼Œå½“å‰ticketæœºå™¨äººéœ€è¦äº‘æœåŠ¡å™¨æ‰èƒ½éƒ¨ç½²ï¼Œæœ‰äº›ä¸å¤ªå‹å¥½ï¼ˆè¦é’±å•Šï¼è€Œä¸”ä¹Ÿä¸æ˜¯äººäººéƒ½ä¼šå®‰è£…pythonç¯å¢ƒï¼‰</p><p>æ‰€ä»¥åœ¨è¿™é‡Œåˆ©ç”¨<a class="link"   href="https://replit.com/" >replit<i class="fas fa-external-link-alt"></i></a>å’Œ<a class="link"   href="https://uptimerobot.com/" >uptimerobot<i class="fas fa-external-link-alt"></i></a>ä¸¤ä¸ªå¹³å°ï¼Œç»™å¤§å®¶ä»‹ç»ä¸€ä¸ªç™½å«–çš„æ–¹æ³•ï¼Œå®ç°éƒ¨ç½²<a class="link"   href="https://gitee.com/musnow/Kook-Ticket-Bot/tree/main" >kook-ticket-bot<i class="fas fa-external-link-alt"></i></a></p><p><font color=Red>æ³¨æ„ï¼</font>replitä¸Šçš„å…è´¹ä»“åº“ï¼Œé»˜è®¤æ˜¯<strong>å…¬å¼€</strong>çš„ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰äººéƒ½èƒ½è®¿é—®åˆ°ä½ è¿™ä¸ªä»“åº“é‡Œé¢çš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬botçš„tokenå’Œæ—¥å¿—ä¿¡æ¯ï¼è‹¥æ‚¨çš„ticket-botå¯¹æ•°æ®ç§å¯†æ€§è¦æ±‚è¾ƒé«˜ï¼Œè¯·<strong>è‡ªè´­æœåŠ¡å™¨</strong>æˆ–æ‰¾å¼€å‘è€…ä»£ä¸ºéƒ¨ç½²ï¼</p><h1 id="2-å‡†å¤‡"><a href="#2-å‡†å¤‡" class="headerlink" title="2.å‡†å¤‡"></a>2.å‡†å¤‡</h1><h2 id="2-1-æ³¨å†Œè´¦æˆ·"><a href="#2-1-æ³¨å†Œè´¦æˆ·" class="headerlink" title="2.1 æ³¨å†Œè´¦æˆ·"></a>2.1 æ³¨å†Œè´¦æˆ·</h2><p>è¿™ä¸¤ä¸ªå¹³å°å›½å†…è®¿é—®ç¼“æ…¢ï¼Œå¦‚æœå®åœ¨è¿›ä¸å»ï¼Œå°±ä¸‹è½½ä¸€ä¸ª<code>steam++</code>(åˆç§°watt toolkit)</p><blockquote><p><a class="link"   href="https://gitee.com/rmbgame/SteamTools/releases/tag/2.8.6" >https://gitee.com/rmbgame/SteamTools/releases/tag/2.8.6<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>å¦‚å›¾ï¼Œä¸‹è½½exeå°±å¯ä»¥äº†</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4c97b28c87.png"                      alt="image-20230209182251919"                ></p><p>å®‰è£…æ‰“å¼€ä»¥åï¼ŒæŠŠè¿™ä¸€å †æ— å·®åˆ«å‹¾ä¸Šï¼Œç‚¹ä¸€é”®åŠ é€Ÿï¼Œåº”è¯¥å°±okäº†ï¼Œè®¿é—®ä¼šç¨å¾®å¿«ä¸€ç‚¹</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4c99abf86a.png"                      alt="image-20230209182323805"                ></p><p>éšåå°±æ˜¯æ³¨å†Œè¿™ä¸¤ä¸ªå¹³å°çš„è´¦æˆ·äº†ï¼Œåº”è¯¥ä¸éœ€è¦æ•™å§ï¼ˆdogeï¼‰</p><h2 id="2-2-æ‰“å¼€giteeä»“åº“"><a href="#2-2-æ‰“å¼€giteeä»“åº“" class="headerlink" title="2.2 æ‰“å¼€giteeä»“åº“"></a>2.2 æ‰“å¼€giteeä»“åº“</h2><blockquote><p><a class="link"   href="https://gitee.com/musnow/Kook-Ticket-Bot/tree/main/code" >https://gitee.com/musnow/Kook-Ticket-Bot/tree/main/code<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>ä¸ºäº†æ–¹ä¾¿è®¿é—®ï¼Œæˆ‘å°†ticket-botåœ¨giteeä¹Ÿä¼ äº†ä¸€ä»½ï¼Œå¤§å®¶æ‰“å¼€ä»“åº“çš„codeç›®å½•ï¼Œå‡†å¤‡æ‹·è´ä»£ç </p><h2 id="2-3-ç”³è¯·kookå¼€å‘è€…"><a href="#2-3-ç”³è¯·kookå¼€å‘è€…" class="headerlink" title="2.3 ç”³è¯·kookå¼€å‘è€…"></a>2.3 ç”³è¯·kookå¼€å‘è€…</h2><blockquote><p><a class="link"   href="https://developer.kookapp.cn/app/index" >https://developer.kookapp.cn/app/index<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>åˆ°kookçš„å¼€å‘è€…å¹³å°ï¼ŒåŠ å…¥å®˜æ–¹é¢‘é“ç”³è¯·æ‰¿ä¸ºå¼€å‘è€…ï¼Œè·å–åˆ›å»ºbotçš„æƒé™ï¼›æœ‰äº†æƒé™ä¹‹åï¼Œæ–°å»ºä¸€ä¸ªåº”ç”¨</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4cad5ec685.png"                      alt="image-20230209182839605"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4cba500721.png"                      alt="image-20230209183206514"                ></p><p>éšåè¿›å…¥æœºå™¨äººé¡µé¢ï¼Œå¤åˆ¶è¿™é‡Œçš„tokenï¼Œå…ˆä¿å­˜èµ·æ¥ï¼Œåé¢è¦ç”¨ï¼ˆä¸€ä¼šå†æ¥å¤åˆ¶ä¹Ÿè¡Œï¼‰</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4cbd3db568.png"                      alt="image-20230209183253285"                ></p><p>è¿›å…¥é‚€è¯·é¡µé¢ï¼Œç»™äºˆæœºå™¨äººç®¡ç†å‘˜æƒé™ï¼ˆè¿™æ ·æ˜¯ä¸ºäº†æ–¹ä¾¿ï¼Œä¸ç„¶å¾—é’©ä¸€å¤§å †ï¼‰</p><p>ç„¶åå¤åˆ¶ä¸Šé¢çš„é‚€è¯·é“¾æ¥åˆ°æµè§ˆå™¨ï¼Œé‚€è¯·æœºå™¨äººè¿›å…¥ä½ çš„æœåŠ¡å™¨</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4cc23379a8.png"                      alt="image-20230209183412507"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4cc59c0389.png"                      alt="image-20230209183507516"                ></p><h1 id="3-å¼€å§‹éƒ¨ç½²"><a href="#3-å¼€å§‹éƒ¨ç½²" class="headerlink" title="3.å¼€å§‹éƒ¨ç½²"></a>3.å¼€å§‹éƒ¨ç½²</h1><h2 id="3-1-åˆ›å»ºpython"><a href="#3-1-åˆ›å»ºpython" class="headerlink" title="3.1 åˆ›å»ºpython"></a>3.1 åˆ›å»ºpython</h2><p>æ¥åˆ°replitï¼Œåˆ›å»ºä»“åº“</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4cc934caf7.png"                      alt="image-20230209183604137"                ></p><p>é€‰æ‹©pythonï¼Œç„¶åç»™å®ƒå–ä¸ªåå­—</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4cca3b57b2.png"                      alt="image-20230209183621372"                ></p><p>åˆ›å»ºä¹‹åè¿›å…¥è¿™ä¸ªé¡¹ç›®</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4ccf8373da.png"                      alt="image-20230209183745982"                ></p><h2 id="3-2-æ·»åŠ ä»£ç æ–‡ä»¶"><a href="#3-2-æ·»åŠ ä»£ç æ–‡ä»¶" class="headerlink" title="3.2 æ·»åŠ ä»£ç æ–‡ä»¶"></a>3.2 æ·»åŠ ä»£ç æ–‡ä»¶</h2><p>è¿›æ¥ä¹‹åæ˜¯è¿™æ ·çš„é¡µé¢ï¼Œåªæœ‰ä¸€ä¸ª<code>main.py</code>ï¼Œå…¶ä»–ä»€ä¹ˆéƒ½æ— </p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4cd2483286.png"                      alt="image-20230209183829907"                ></p><p>ç‚¹å‡»å·¦ä¸Šè§’è¿™ä¸ªå°æŒ‰é’®ï¼Œåˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå‘½åä¸º<code>keepal.py</code></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4cd99c5447.png"                      alt="image-20230209184027580"                ></p><p>å¤åˆ¶å¦‚ä¸‹ä»£ç åˆ°<code>keepal.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="comment"># åˆå§‹åŒ–</span></span><br><span class="line">app = Flask(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"><span class="comment"># è®¾ç«‹æ ¹è·¯å¾„ä½œä¸ºapiè°ƒç”¨</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">  text = <span class="string">&quot;ticket bot online!&quot;</span></span><br><span class="line">  <span class="built_in">print</span>(text)</span><br><span class="line">  <span class="keyword">return</span> text</span><br><span class="line"><span class="comment"># å¼€å§‹è¿è¡Œï¼Œç»‘å®šipå’Œç«¯å£</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line">  app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port = <span class="number">8000</span>)</span><br><span class="line"><span class="comment"># é€šè¿‡çº¿ç¨‹è¿è¡Œ</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">keep_alive</span>():</span><br><span class="line">  t= Thread(target=run)</span><br><span class="line">  t.start()</span><br></pre></td></tr></table></figure><p>éšåï¼Œå°±å¼€å§‹æ ¹æ®æˆ‘ä»“åº“çš„ä»£ç ï¼Œåˆ›å»ºåŒåæ–‡ä»¶ï¼Œå¹¶å°†ä»£ç å¤åˆ¶è¿›å»</p><blockquote><p>githubçš„ä»£ç æ›´åŠ æ–°ï¼Œå¦‚æœèƒ½æ‰“å¼€githubï¼Œè¯·åœ¨githubå¤åˆ¶ä»£ç ï¼š<a class="link"   href="https://github.com/musnows/Kook-Ticket-Bot" >https://github.com/musnows/Kook-Ticket-Bot<i class="fas fa-external-link-alt"></i></a></p><p>å®åœ¨æ‰“ä¸å¼€ï¼Œå†æ¥giteeï¼š<a class="link"   href="https://gitee.com/musnow/Kook-Ticket-Bot/tree/main/code" >https://gitee.com/musnow/Kook-Ticket-Bot/tree/main/code<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>mainå°±ä¸ç”¨åˆ›å»ºäº†ï¼Œé»˜è®¤å·²ç»æœ‰äº†ï¼Œç›´æ¥æŠŠä»£ç å¤åˆ¶è¿›å»å°±è¡Œäº†ï¼›æ‰€æœ‰æ–‡ä»¶æ·»åŠ å®Œæ¯•ä¹‹åï¼Œåº”è¯¥æ˜¯ä¸‹é¢è¿™æ ·çš„</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d089ce45e.png"                      alt="image-20230209185259526"                ></p><p>è¿™æ ·ï¼Œä»£ç å°±æ·»åŠ å¥½äº†</p><h2 id="3-3-æ·»åŠ é…ç½®æ–‡ä»¶"><a href="#3-3-æ·»åŠ é…ç½®æ–‡ä»¶" class="headerlink" title="3.3 æ·»åŠ é…ç½®æ–‡ä»¶"></a>3.3 æ·»åŠ é…ç½®æ–‡ä»¶</h2><p>æ¥ä¸‹æ¥å°±æ˜¯æ›´å…·ä»“åº“çš„READMEæ·»åŠ å„ç±»é…ç½®æ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">config/config.json <span class="comment">#æœºå™¨äººtokené…ç½®</span></span><br><span class="line">config/TicketConf.json <span class="comment"># ticketé…ç½®</span></span><br><span class="line">log/TicketLog.json <span class="comment">#ticketæ—¥å¿—</span></span><br><span class="line">log/TicketMsgLog.json <span class="comment"># æ¶ˆæ¯è®°å½•</span></span><br><span class="line">log/ColorID.json <span class="comment"># è¡¨æƒ…å›åº”ä¸Šè§’è‰²</span></span><br></pre></td></tr></table></figure><p>å…ˆæŠŠå¦‚ä¸Šçš„å‡ ä¸ªæ–‡ä»¶å…¨éƒ¨å»ºç«‹å¥½ï¼Œç„¶åæ ¹æ®<a class="link"   href="https://gitee.com/musnow/Kook-Ticket-Bot/blob/main/README.md" >ä»“åº“çš„README<i class="fas fa-external-link-alt"></i></a>å¾€é‡Œé¢æ·»åŠ é”®å€¼ï¼Œè¿™é‡Œä¸é‡å¤READMEä¸­å·²æœ‰å†…å®¹</p><p>å¾ˆå¤šæ“ä½œéƒ½éœ€è¦å¤åˆ¶IDï¼Œå…ˆåœ¨è®¾ç½®é«˜çº§è®¾ç½®ä¸­å¼€å¯å¼€å‘è€…æ¨¡å¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d159b33fa.png"                      alt="image-20230209185627493"                ></p><p>ä¸‹é¢ç»™å‡ºä¸€ä¸ª<code>TicketConf.json</code>ä¸­éœ€è¦é…ç½®çš„å‡ é¡¹çš„æ ·ä¾‹</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d287f32c9.png"                      alt="image-20230209190129489"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d2e8b0e74.png"                      alt="image-20230209190306382"                ></p><p>åœ¨è¿™é‡Œé‡ç”³ï¼Œæ·»åŠ äº†è¿™ä¸¤ä¸ªè§’è‰²idä¹‹åï¼Œ<strong>å¿…é¡»è¦ç»™äºˆç”¨æˆ·å¯¹åº”çš„è§’è‰²</strong>ï¼ˆç‰¹åˆ«æ˜¯è…ç«¹ï¼‰æ‰èƒ½æ“ä½œbotçš„å‘½ä»¤ï¼Œå¦åˆ™æç¤ºæƒé™ä¸è¶³</p><p>é…ç½®ä¸ºæ–‡ä»¶æ·»åŠ å®Œæ¯•ä¹‹åï¼Œåº”è¯¥æ˜¯ä¸‹é¢è¿™æ ·çš„</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d7db5ccc3.png"                      alt="image-20230209192413122"                ></p><h2 id="3-4-å¼€å§‹è¿è¡Œ"><a href="#3-4-å¼€å§‹è¿è¡Œ" class="headerlink" title="3.4 å¼€å§‹è¿è¡Œ"></a>3.4 å¼€å§‹è¿è¡Œ</h2><p>å¼€å§‹è¿è¡Œå‰çš„æœ€åä¸€æ­¥ï¼Œè¿›å…¥<code>main.py</code>ï¼Œå–æ¶ˆå¯¹æœ€åä¸¤è¡Œä»£ç çš„æ³¨é‡Š</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d41360485.png"                      alt="image-20230209190805189"                ></p><p>è¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç‚¹å‡»é¡¶éƒ¨çš„runï¼Œå°è¯•è¿è¡Œbotäº†ï¼Œå˜æˆä¸‹é¢çš„æ ·å­é‚£å°±æ˜¯åœ¨è¿è¡Œäº†</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d358873d0.png"                      alt="image-20230209190458439"                ></p><p>åˆšå¼€å§‹æ‰“å°ä¼šæç¤ºè¿™ä¸ªï¼Œä»£è¡¨æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„åŒ…</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d367a7794.png"                      alt="image-20230209190513475"                ></p><p>å·¥å…·toolsé‡Œé¢é€‰æ‹©packgesï¼Œåœ¨é‡Œé¢æœç´¢khl.py</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d37809943.png"                      alt="image-20230209190529916"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d3d2dae7e.png"                      alt="image-20230209190601848"                ></p><p>å¦‚ä¸‹æç¤ºï¼Œå®‰è£…æˆåŠŸï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d3cfc2cc7.png"                      alt="image-20230209190657593"                ></p><p>åœ¨ç‚¹å‡»è¿è¡Œï¼Œå‡ºç°å¦‚å›¾æ‰€ç¤ºçš„é¡µé¢ï¼Œé‚£å°±æ˜¯è¿è¡ŒæˆåŠŸäº†ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d437ebe6e.png"                      alt="image-20230209190841115"                ></p><p>ç°åœ¨è¿›kooké‡Œé¢ï¼Œå…ˆæµ‹è¯•ä¸€ä¸‹æˆ‘ä»¬çš„botæ˜¯å¦åœ¨çº¿</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d45c3ee99.png"                      alt="image-20230209190918053"                ></p><p>æµ‹è¯•é€šè¿‡ï¼åå°ä¹Ÿæ‰“å°å‡ºäº†æ—¥å¿—</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d48dd932c.png"                      alt="image-20230209191007686"                ></p><h2 id="3-5-uptimeRobot"><a href="#3-5-uptimeRobot" class="headerlink" title="3.5 uptimeRobot"></a>3.5 uptimeRobot</h2><p>åˆ«æ€¥åˆ«æ€¥ï¼Œè™½ç„¶åˆ°è¿™é‡Œå·²ç»okäº†ï¼Œä½†æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªæ­¥éª¤è¦åš</p><p>è¿›å…¥uptimeRobotï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªç›‘æ§å®ä¾‹ï¼Œæ¥è°ƒç”¨æˆ‘ä»¬çš„<code>keepal</code>æ¨¡ç»„ä¸­çš„å‡½æ•°ï¼Œä¿è¯æˆ‘ä»¬çš„botä¸ä¼šå› ä¸ºreplitçš„ç­–ç•¥è€Œä¸‹çº¿</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d4c987b38.png"                      alt="image-20230209191107440"                ></p><p>ç‚¹å‡»<code>add new monitor</code>ï¼Œé€‰æ‹©http</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d4d329cad.png"                      alt="image-20230209191116969"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d4f293359.png"                      alt="image-20230209191148477"                ></p><p>æŒ‰å¦‚ä¸‹æ‰€ç¤ºå¡«å†™</p><ul><li>nameéšä¾¿å¡«ä¸ªè‹±æ–‡å</li><li>urlå¡«åœ¨replitå¤åˆ¶çš„é“¾æ¥</li><li>intervelæ˜¯å•æ¬¡ç›‘æ§çš„é—´éš”ï¼Œé€‰æ‹©1-5åˆ†é’Ÿéƒ½å¯ä»¥</li><li>timeouté»˜è®¤30sä¸éœ€è¦ä¿®æ”¹</li><li>ä¸¤ä¸ªsslå–æ¶ˆå‹¾é€‰</li></ul><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d55ecb6e0.png"                      alt="image-20230209191336353"                ></p><p>å»ºè®®å‹¾é€‰ä¸Šè¿™ä¸ªï¼Œåœ¨botä¸‹çº¿çš„æ—¶å€™ï¼Œä¼šå‘ä½ çš„é‚®ç®±å‘é€é€šçŸ¥</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d5ab3b849.png"                      alt="image-20230209191453032"                ></p><p>é…ç½®å®Œæ¯•ï¼Œç‚¹å‡»å³ä¸‹è§’çš„create</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d5d51fadc.png"                      alt="image-20230209191534999"                ></p><p>è¿™æ—¶å€™å°±ä¼šå¼€å§‹è¿è¡Œäº†ï¼ä¸‹æ–¹çš„<code>pause</code>å¯ä»¥æš‚åœè¿è¡Œã€‚</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d60795e56.png"                      alt="image-20230209191625292"                ></p><p>å¦‚æœä½ createå®Œæ¯•ï¼Œå‘ç°æ˜¯é»‘è‰²çš„ï¼Œé‚£å°±ç‚¹å‡»ä¸€ä¸‹<code>start</code>è®©ä»–å¼€å§‹è¿è¡Œ</p><h1 id="4-æ—¥å¿—æ–‡ä»¶"><a href="#4-æ—¥å¿—æ–‡ä»¶" class="headerlink" title="4.æ—¥å¿—æ–‡ä»¶"></a>4.æ—¥å¿—æ–‡ä»¶</h1><p>é»˜è®¤çš„æ‰€æœ‰æ‰“å°éƒ½ä¼šæ‰“å°åˆ°æ§åˆ¶å°é‡Œé¢ï¼Œè¿è¡Œæ—¶é—´ä¹…äº†ï¼Œreplitçš„æ§åˆ¶å°å¯èƒ½æ— æ³•è·å–åˆ°æ‰€æœ‰ä¿¡æ¯ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹è¾“å‡ºè¿›è¡Œé‡å®šå‘</p><p>å¦‚æœä½ éœ€è¦æ—¥å¿—æ–‡ä»¶ï¼ˆæˆ‘å»ºè®®ä¸€å®šè¦è¿™ä¹ˆåšï¼ï¼‰é‚£å°±éœ€åœ¨mainé‡Œé¢æ·»åŠ ä¸€éƒ¨åˆ†ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ ‡å‡†è¾“å‡ºé‡å®šå‘è‡³æ–‡ä»¶</span></span><br><span class="line">file =  <span class="built_in">open</span>(<span class="string">&#x27;./log/log.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">sys.stdout = file </span><br><span class="line">sys.stderr = file</span><br></pre></td></tr></table></figure><p>æ·»åŠ åˆ°å¼€å¤´<code>start_time</code>ä»¥åå³å¯</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4e3a4815e1.png"                      alt="image-20230209201430435"                ></p><p>ç°åœ¨æ›´æ–°äº†ä»£ç ä»¥åï¼Œåªéœ€è¦å–æ¶ˆå¼€å¤´è¿™é‡Œçš„æ³¨é‡Šå³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ ‡å‡†è¾“å‡ºé‡å®šå‘è‡³æ–‡ä»¶</span></span><br><span class="line">logDup(<span class="string">&#x27;./log/log.txt&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4e89784e2b.png"                      alt="image-20230209203537248"                ></p><p>è¿™æ ·åšè¿˜ä¸å¤Ÿï¼Œbotæœ‰ä¸€ä¸ªç‰¹æ®Šçš„killå‘½ä»¤ï¼Œæ‰§è¡Œæ­¤killå‘½ä»¤ï¼Œå¯ä»¥åˆ·æ–°ç¼“å†²åŒºï¼Œé¿å…å‡ºç°æ•°æ®åœ¨ç¼“å†²åŒºä¸­æ²¡æœ‰å†™å…¥åˆ°æ–‡ä»¶ï¼Œå¯¼è‡´ä¸¢å¤±æ—¥å¿—</p><p><strong>å¦‚æœä½ æƒ³é€€å‡ºbotï¼Œå»ºè®®ä½¿ç”¨killå‘½ä»¤æ¥æ“ä½œ</strong>ï¼</p><h1 id="å¤§åŠŸå‘Šæˆï¼"><a href="#å¤§åŠŸå‘Šæˆï¼" class="headerlink" title="å¤§åŠŸå‘Šæˆï¼"></a>å¤§åŠŸå‘Šæˆï¼</h1><p>ç°åœ¨ä½ å¯ä»¥æ ¹æ®helpå»æµ‹è¯•ä¸€ä¸‹å„ç±»å‘½ä»¤æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œå•¦</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d65f0d1ba.png"                      alt="image-20230209191752878"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d66ef26cc.png"                      alt="image-20230209191808588"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d88927a1e.png"                      alt="image-20230209192707010"                ></p><p>æ³¨æ„ï¼Œå…³é—­ticketä¹‹åå¯èƒ½ä¼šå‡ºç°è¿™ä¸ªæŠ¥é”™ï¼Œè¿™æ˜¯å› ä¸ºç”¨æˆ·ä»æ¥æ²¡æœ‰ç»™botå‘é€è¿‡ä¿¡æ¯ï¼Œå¯¼è‡´botæ— æ³•ç”¨æˆ·å‘é€ç§ä¿¡ï¼Œ<strong>å¿½ç•¥</strong>æ­¤æŠ¥é”™å³å¯ï¼ˆæ–°ç‰ˆæœ¬å·²ç»å–æ¶ˆäº†è¿™ä¸ªæŠ¥é”™ï¼‰</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4d688ea0df.png"                      alt="image-20230209191834582"                ></p><p>å› ä¸ºreplitæ˜¯å…è´¹çš„ï¼Œæ‰€ä»¥botçš„ååº”å¯èƒ½æœ‰äº›è¿Ÿé’ï¼Œæ­£å¸¸æƒ…å†µï¼</p><p><font color=Red>å†æ¬¡æé†’ï¼</font>replitä¸Šçš„å…è´¹ä»“åº“ï¼Œé»˜è®¤æ˜¯<strong>å…¬å¼€</strong>çš„ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰äººéƒ½èƒ½è®¿é—®åˆ°ä½ è¿™ä¸ªä»“åº“é‡Œé¢çš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬botçš„tokenå’Œæ—¥å¿—ä¿¡æ¯ï¼è‹¥æ‚¨çš„ticket-botå¯¹æ•°æ®ç§å¯†æ€§è¦æ±‚è¾ƒé«˜ï¼Œè¯·<strong>è‡ªè´­æœåŠ¡å™¨</strong>æˆ–æ‰¾å¼€å‘è€…ä»£ä¸ºéƒ¨ç½²ï¼</p><blockquote><p>ä½ å¯ä»¥<a class="link"   href="https://replit.com/@Aewait/ticket#keepal.py" >forkæˆ‘è¿™æ¬¡éƒ¨ç½²çš„bot<i class="fas fa-external-link-alt"></i></a>ï¼ˆ23-02-10ï¼‰ä½†æ˜¯åç»­çš„ä»£ç æ›´æ–°è¿˜æ˜¯éœ€è¦è‡ªå·±æ“ä½œå“¦ï¼</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ•™ä½ ç™½å«–replitéƒ¨ç½²kookçš„ticketæœºå™¨äºº&lt;/p&gt;</summary>
    
    
    
    <category term="é€Ÿé€šPython" scheme="https://blog.musnow.top/categories/%E9%80%9F%E9%80%9APython/"/>
    
    
    <category term="Python" scheme="https://blog.musnow.top/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>ã€Linuxã€‘å®ç°å®ˆæŠ¤è¿›ç¨‹ | ä»¥tcpServerä¸ºä¾‹</title>
    <link href="https://blog.musnow.top/2023/02/09/note_Linux/30%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B/"/>
    <id>https://blog.musnow.top/2023/02/09/note_Linux/30%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B/</id>
    <published>2023-02-09T06:08:30.000Z</published>
    <updated>2023-02-09T06:45:42.561Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡å°†ä»¥tcpæœåŠ¡å™¨ä»£ç ä¸ºåŸºæœ¬ï¼Œè®²è¿°å¦‚ä½•å°†è¿›ç¨‹å®ˆæŠ¤è¿›ç¨‹åŒ–ï¼Œåå°è¿è¡Œ</p><span id="more"></span><h1 id="1-å®ˆæŠ¤è¿›ç¨‹"><a href="#1-å®ˆæŠ¤è¿›ç¨‹" class="headerlink" title="1.å®ˆæŠ¤è¿›ç¨‹"></a>1.å®ˆæŠ¤è¿›ç¨‹</h1><p>æ‰€è°“å®ˆæŠ¤è¿›ç¨‹ï¼Œå°±æ˜¯å’Œå…¶ä»–è¿›ç¨‹æ²¡æœ‰å…³ç³»çš„è¿›ç¨‹ï¼›å…¶ç‹¬ç«‹è¿è¡Œäºç³»ç»Ÿåå°ï¼Œé™¤éè‡ªå·±é€€å‡ºæˆ–æ”¶åˆ°ä¿¡å·ç»ˆæ­¢ï¼Œå¦åˆ™ä¼šä¸€ç›´è¿è¡Œä¸‹å»</p><h2 id="1-1-è¿›ç¨‹ç»„"><a href="#1-1-è¿›ç¨‹ç»„" class="headerlink" title="1.1 è¿›ç¨‹ç»„"></a>1.1 è¿›ç¨‹ç»„</h2><p>åœ¨æˆ‘ä»¬ä½¿ç”¨çš„bashä¸­ï¼ŒåŒä¸€æ—¶åˆ»åªä¼šæœ‰ä¸€ä¸ª<strong>å‰å°è¿›ç¨‹ç»„</strong></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e457da7126b.png"                      alt="image-20230209101802180"                ></p><p>å¦‚å›¾ï¼Œå½“ä¸€ä¸ªå‰å°è¿›ç¨‹å¼€å§‹è¿è¡Œä¹‹åï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•åœ¨å½“å‰ç»ˆç«¯å¼€å¯<strong>ç¬¬äºŒä¸ªå‰å°è¿›ç¨‹</strong>ã€‚</p><p>åœ¨è¿è¡Œçš„å‘½ä»¤åé¢åŠ &amp;ï¼Œä¸´æ—¶è®©å½“å‰è¿›ç¨‹<strong>åœ¨åå°è¿è¡Œ</strong>ã€‚æ³¨æ„ï¼Œæ­¤æ—¶tcpè™½ç„¶åœ¨åå°è¿è¡Œäº†ï¼Œ ä½†å¯¹äºå®ƒè€Œè¨€ï¼Œ<code>stdin/stdout/stderr</code>çš„æ–‡ä»¶æè¿°ç¬¦ä¾æ—§æŒ‡å‘çš„æ˜¯å½“å‰bashçš„è¾“å…¥è¾“å‡ºï¼Œæ‰€ä»¥å®ƒçš„æ—¥å¿—ä¾æ—§ä¼šæ‰“å°åˆ°å½“å‰ç»ˆç«¯ä¸Šã€‚</p><p>ç”¨<code>ps</code>å‘½ä»¤æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„ä¿¡æ¯ï¼Œå…¶ä¸­<code>ppid</code>æ˜¯å½“å‰è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯å½“å‰bashï¼Œ<code>pid</code>æ˜¯è¿›ç¨‹ç¼–å·ï¼Œ<code>pgid</code>æ˜¯è¿›ç¨‹çš„ç»„ç¼–å·ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªç»„ç¼–å·å’Œgrepå‘½ä»¤çš„ç»„ç¼–å·æ˜¯ä¸åŒçš„ã€‚</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e45ba4133c4.png"                      alt="image-20230209103412568"                ></p><p>æˆ‘ä»¬ç”¨è¿™ä¸ªcè¯­è¨€çš„ä»£ç è°ƒç”¨ä¸¤æ¬¡forkï¼Œç›¸å½“äºåˆ›å»ºäº†3ä¸ªå­è¿›ç¨‹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    fork();</span><br><span class="line">    fork();</span><br><span class="line">    sleep(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å†æ¥æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯ï¼Œèƒ½çœ‹åˆ°è¿™4ä¸ªè¿›ç¨‹çš„è¿›ç¨‹ç»„pgidæ˜¯ç›¸åŒçš„ï¼Œè€Œä¸”å’Œ<strong>ç¬¬ä¸€ä¸ªtestçš„pidç›¸åŒ</strong>ï¼›è¿™è¯´æ˜ç¬¬ä¸€ä¸ªtestå°±æ˜¯<strong>çˆ¶è¿›ç¨‹</strong>ï¼Œåé¢çš„3ä¸ªéƒ½æ˜¯å­è¿›ç¨‹ã€‚</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e45da7770c3.png"                      alt="image-20230209104248061"                ></p><h2 id="1-2-è¿›ç¨‹ä¼šè¯"><a href="#1-2-è¿›ç¨‹ä¼šè¯" class="headerlink" title="1.2 è¿›ç¨‹ä¼šè¯"></a>1.2 è¿›ç¨‹ä¼šè¯</h2><p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæˆ‘ä»¬ä¹‹å‰æ²¡æœ‰å¤ªå¤šäº†è§£çš„ä¿¡æ¯ï¼Œè¿›ç¨‹çš„<strong>sid</strong>æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>è¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼Œåœ¨å›¾ä¸­èƒ½çœ‹åˆ°ï¼Œæˆ‘ä»¬æ‰§è¡Œçš„testå’Œgrepçš„sidéƒ½æ˜¯ç›¸åŒçš„ï¼Œè€Œä¸”éƒ½ç­‰äºç¬¬ä¸€ä¸ªtestè¿›ç¨‹çš„ppidï¼ˆbashçš„pidï¼‰</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e45da7770c3.png"                      alt="image-20230209104248061"                ></p><p>è¿™è¡¨æ˜å›¾ä¸­çš„5ä¸ªè¿›ç¨‹åŒå±äºä¸€ä¸ªè¿›ç¨‹ä¼šè¯ï¼Œ<strong>è¿™ä¸ªä¼šè¯å°±æ˜¯æˆ‘ä»¬å½“å‰æ‰“å¼€çš„bash</strong>ï¼Œå¹¶ç”¨sidæ¥è¡¨ç¤ºè¿›ç¨‹ä¼šè¯ï¼›</p><blockquote><p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ç™»å½•linuxçš„æ—¶å€™ä¸€å®šä¼šæœ‰ä¸€ä¸ªç»ˆç«¯ï¼Œlinuxç³»ç»Ÿå°±æ˜¯åˆ›å»ºä¼šè¯å¹¶åŠ è½½bashï¼Œæ¥ç»™ç”¨æˆ·æä¾›æœåŠ¡çš„ã€‚</p></blockquote><p>æ—¢ç„¶å­˜åœ¨ä¼šè¯ï¼Œé‚£å°±è‚¯å®šä¼šæœ‰ä¼šè¯çš„èµ„æºä¸Šé™ã€‚ä¸€æ—¦æ»¡äº†ï¼Œ<strong>å°±ä¼šå¼€å§‹æ€æ‰ä¸€äº›è¿›ç¨‹</strong>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./test &amp;</span><br></pre></td></tr></table></figure><p>å³ä¾¿æˆ‘ä»¬ç”¨&amp;è®©è¿›ç¨‹åœ¨åå°è¿è¡Œï¼Œå…¶ä¹Ÿæœ‰å¯èƒ½æ”¶åˆ°ä¼šè¯çš„<code>åˆ›å»º/å…³é—­</code>çš„å½±å“è€Œè¢«æ“ä½œç³»ç»Ÿå¹²æ‰ğŸ§æ¯”å¦‚æˆ‘ä»¬å°†<strong>å½“å‰æ­£åœ¨è¿è¡Œè¿›ç¨‹çš„bashå…³æ‰</strong>ï¼Œå…¶å‰å°è¿›ç¨‹ä¼šè¢«ç›´æ¥ç»ˆæ­¢ï¼Œåå°è¿›ç¨‹ä¹Ÿä¼šå—åˆ°å½±å“ï¼ˆæœ‰å¯èƒ½ç»ˆæ­¢æœ‰å¯èƒ½ä¸ç»ˆæ­¢ï¼Œå–å†³äºç³»ç»Ÿï¼‰</p><p>è¿™å’Œæˆ‘ä»¬å¯¹tcpæœåŠ¡å™¨çš„éœ€æ±‚ä¸ä¸€è‡´ï¼šæˆ‘ä»¬éœ€è¦çš„æ˜¯è®©tcpæœåŠ¡å™¨çš„è¿›ç¨‹èƒ½ä¸€ç›´ç¨³å®šçš„åœ¨åå°è¿è¡Œï¼Œ<strong>è®©æ“ä½œç³»ç»Ÿåˆ«å»ç®¡å®ƒ</strong>ï¼›é™¤éç³»ç»Ÿå†…å­˜æ»¡äº†ï¼Œè´Ÿè½½é‡åˆ°å®åœ¨æ²¡æœ‰åŠæ³•çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿæ‰èƒ½è¿‡æ¥æŠŠä»–åˆ€äº†ã€‚</p><p>ä¸ºäº†ä¸è®©å®ˆæŠ¤è¿›ç¨‹å—åˆ°è¿›ç¨‹ä¼šè¯çš„å½±å“ï¼Œæˆ‘ä»¬å°±å¿…é¡»è®©å…¶èƒ½å¤Ÿç‹¬ç«‹å‡ºæ¥ï¼Œ<strong>è‡ªæˆä¸€ä¸ªè¿›ç¨‹ç»„å’Œä¸€ä¸ªæ–°ä¼šè¯</strong></p><p>ğŸ‘†è¿™ç§ç‹¬ç«‹çš„è¿›ç¨‹ï¼Œå°±å¯ä»¥è¢«ç§°ä¸º<code>å®ˆæŠ¤è¿›ç¨‹/ç²¾çµè¿›ç¨‹</code></p><h1 id="2-å®ç°"><a href="#2-å®ç°" class="headerlink" title="2.å®ç°"></a>2.å®ç°</h1><h2 id="2-1-è‡ªå·±å†™"><a href="#2-1-è‡ªå·±å†™" class="headerlink" title="2.1 è‡ªå·±å†™"></a>2.1 è‡ªå·±å†™</h2><p>åˆ«ä»¥ä¸ºå†™è¿™ä¸ªå¾ˆéš¾å“¦ï¼Œå®é™…ç‰¹åˆ«ç®€å•ï¼</p><h3 id="2-1-1-setsid"><a href="#2-1-1-setsid" class="headerlink" title="2.1.1 setsid"></a>2.1.1 setsid</h3><p>è¿™é‡Œéœ€è¦ç”¨åˆ°çš„setsidæ¥å£ï¼Œå…¶ä½œç”¨å¦‚åå­—ä¸€èˆ¬ï¼Œæ˜¯è®¾ç½®å½“å‰è¿›ç¨‹çš„è¿›ç¨‹ä¼šè¯ç»„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">pid_t</span> <span class="title function_">setsid</span><span class="params">(<span class="type">void</span>)</span>;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è°ƒç”¨è¿™ä¸ªå‡½æ•°æœ‰ä¸€ä¸ªè¦æ±‚ï¼šè°ƒç”¨çš„è¿›ç¨‹ä¸èƒ½æ˜¯è¿›ç¨‹ç»„çš„ç»„é•¿ï¼</p><p>æ¯”å¦‚ä¸‹å›¾ä¸­ï¼Œç¬¬ä¸€ä¸ªtestå°±æ˜¯è¿›ç¨‹ç»„çš„ç»„é•¿ï¼Œå®ƒä¸èƒ½è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚ä¼šæŠ¥é”™</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e45da7770c3.png"                      alt="image-20230209104248061"                ></p><p>é‚£è¦æ€ä¹ˆè®©è‡ªå·±ä¸æˆä¸ºè¿›ç¨‹ç»„çš„ç»„é•¿å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹å°±okäº†ï¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (fork() &gt; <span class="number">0</span>)</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);<span class="comment">//çˆ¶è¿›ç¨‹ç›´æ¥é€€å‡º</span></span><br></pre></td></tr></table></figure><h3 id="2-1-2-é‡å®šå‘åˆ°dev-x2F-null"><a href="#2-1-2-é‡å®šå‘åˆ°dev-x2F-null" class="headerlink" title="2.1.2 é‡å®šå‘åˆ°dev&#x2F;null"></a>2.1.2 é‡å®šå‘åˆ°dev&#x2F;null</h3><blockquote><p>å¦‚æœä½ ä¸çŸ¥é“ä»€ä¹ˆæ˜¯<code>/dev/null</code>ï¼Œç®€è€Œè¨€ä¹‹ï¼Œè¿™æ˜¯ä¸€ä¸ªlinuxä¸‹çš„æ•°æ®åƒåœ¾æ¡¶ã€‚å’Œwindowsçš„å›æ”¶ç«™ä¼šå­˜æ”¾åˆ é™¤çš„èµ„æ–™ä¸åŒï¼Œè¿™ä¸ªåƒåœ¾æ¡¶æ˜¯ä¸ªé»‘æ´ï¼Œä¸¢è¿›å»çš„ä¸œè¥¿ä¸ä¼šè¢«å­˜æ”¾ï¼Œæ˜¯ç›´æ¥ä¸¢å¼ƒçš„ï¼</p></blockquote><p>å®ˆæŠ¤è¿›ç¨‹éœ€è¦æŠŠé»˜è®¤çš„<code>0.1.2</code>æ–‡ä»¶æè¿°ç¬¦éƒ½é‡å®šå‘åˆ°<code>dev/null</code>ï¼Œæ˜¯å› ä¸ºè®¾ç½®æˆç‹¬ç«‹çš„è¿›ç¨‹ç»„å’Œè¿›ç¨‹ä¼šè¯äº†ä¹‹åï¼Œå½“å‰è¿›ç¨‹æ˜¯æ²¡æœ‰å’Œbashå…³è”çš„ã€‚</p><p>æ­¤æ—¶ï¼Œé»˜è®¤è¿™ä¸ª<code>0 1 2</code>æ‰€æŒ‡å‘çš„bashæ˜¯<strong>æ— æ•ˆ</strong>çš„ï¼å¦‚æœä¸é‡å®šå‘ï¼Œä½¿ç”¨coutæ‰“å°çš„æ—¶å€™ï¼Œå°±ä¼šå¼•å‘å¼‚å¸¸ï¼ˆå¯ä»¥ç†è§£ä¸ºå¾€ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ä¸­å†™å†…å®¹ï¼‰ï¼ŒæœåŠ¡å™¨ç›´æ¥é€€å‡ºäº†ï¼Œæ— æ³•å®ç°å®ˆæŠ¤è¿›ç¨‹ã€‚</p><p>é‡å®šå‘äº†ä¹‹åï¼Œæ‰€æœ‰çš„æ‰“å°è¾“å‡ºéƒ½ä¼šè¢«ä¸¢åˆ°<code>/dev/null</code>è¿™ä¸ªæ–‡ä»¶åƒåœ¾æ¡¶ä¸­ï¼Œä¹Ÿå°±ä¸éœ€è¦æ‹…å¿ƒä¸Šè¿°çš„é—®é¢˜ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((fd = open(<span class="string">&quot;/dev/null&quot;</span>, O_RDWR)) != <span class="number">-1</span>) <span class="comment">// fd == 3</span></span><br><span class="line">&#123;</span><br><span class="line">    dup2(fd, STDIN_FILENO);</span><br><span class="line">    dup2(fd, STDOUT_FILENO);</span><br><span class="line">    dup2(fd, STDERR_FILENO);</span><br><span class="line">    <span class="comment">// 6. å…³é—­æ‰ä¸éœ€è¦çš„fd</span></span><br><span class="line">    <span class="comment">// å› ä¸ºfdåªæ˜¯ä¸´æ—¶ç”¨äºé‡å®šå‘ï¼Œæ“ä½œå®Œæ¯•äº†å°±å¯ä»¥å…³æ‰äº†</span></span><br><span class="line">    <span class="keyword">if</span>(fd &gt; STDERR_FILENO) </span><br><span class="line">        close(fd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼Œé‚£æ—¥å¿—ä¿¡æ¯ä¹Ÿè¢«ä¸¢åˆ°åƒåœ¾æ¡¶é‡Œé¢äº†ï¼Œæ€ä¹ˆåŠï¼Ÿ</p><p>å¾ˆç®€å•ï¼Œå› ä¸ºæˆ‘ä»¬æœåŠ¡å™¨çš„æ—¥å¿—éƒ½ç»Ÿä¸€ä½¿ç”¨äº†<code>log.hpp</code>é‡Œé¢çš„<code>logging</code>å‡½æ•°ï¼Œæ‰€ä»¥åªéœ€è¦å¯¹<code>logging</code>å‡½æ•°çš„è¾“å‡ºé‡å®šå‘åˆ°æ—¥å¿—æ–‡ä»¶é‡Œé¢ï¼Œå°±okäº†ï¼</p><h3 id="2-1-3-chdirï¼ˆé€‰åšï¼‰"><a href="#2-1-3-chdirï¼ˆé€‰åšï¼‰" class="headerlink" title="2.1.3 chdirï¼ˆé€‰åšï¼‰"></a>2.1.3 chdirï¼ˆé€‰åšï¼‰</h3><p>è¿™ä¸ªæ“ä½œçš„ç›®çš„æ˜¯ä¿®æ”¹å·¥ä½œè·¯å¾„ã€‚ä½œä¸ºæœåŠ¡å™¨è¿›ç¨‹ï¼Œå¾ˆå¤šæ—¥å¿—ä¿¡æ¯æ˜¯å­˜æ”¾åœ¨<code>/etc/</code>ç›®å½•è€Œä¸æ˜¯å½“å‰è·¯å¾„ä¸‹çš„ï¼Œä¸ºäº†å®‰å…¨ï¼Œä¹Ÿåº”è¯¥ä½¿ç”¨<code>ç»å¯¹è·¯å¾„</code>è€Œä¸ç”¨ç›¸å¯¹è·¯å¾„ï¼Œé¿å…å‡ºç°å·¥ä½œç›®å½•åˆ‡æ¢è€Œå¯¼è‡´çš„æ— æ³•è¯»å†™æ–‡ä»¶çš„é—®é¢˜</p><p>ä¸è¿‡ï¼Œå¦‚æœä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œå³ä¾¿æˆ‘ä»¬ä¸ä¿®æ”¹å·¥ä½œç›®å½•ï¼Œä¹Ÿæ˜¯èƒ½æ­£å¸¸è®¿é—®çš„ï¼›æ‰€ä»¥è¿™ä¸ªæ“ä½œæ˜¯é€‰åšçš„</p><h3 id="2-1-4-ä¿¡å·æ•æ‰"><a href="#2-1-4-ä¿¡å·æ•æ‰" class="headerlink" title="2.1.4 ä¿¡å·æ•æ‰"></a>2.1.4 ä¿¡å·æ•æ‰</h3><p>è‡ªå·±å†™è¿™ä¸ªå‡½æ•°æœ‰ä¸ªå¥½å¤„ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨é‡Œé¢è‡ªå®šä¹‰æ•æ‰ä¸€äº›ä¿¡å·ï¼Œç»™è¿™äº›ä¿¡å· åŠ ä¸Šè‡ªå·±çš„è‡ªå®šä¹‰æ–¹æ³•ï¼›</p><p>æ¯”å¦‚<code>SIGPIPE</code>å°±æ˜¯ç®¡é“çš„ä¿¡å·ï¼Œå½“ç®¡é“çš„è¯»ç«¯å…³é—­çš„æ—¶å€™ï¼Œå†™ç«¯ä¼šè¢«ç»ˆæ­¢ï¼›æ­¤æ—¶å†™ç«¯å°±ä¼šæ”¶åˆ°è¿™ä¸ªä¿¡å·ã€‚å¦‚æœä¸å¯¹è¿™ä¸ªä¿¡å·è¿›è¡Œ<code>SIG_IGN</code>å¿½ç•¥ï¼Œæˆ‘ä»¬çš„æœåŠ¡å™¨ä¼šç›´æ¥ç»ˆæ­¢ï¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">signal(SIGPIPE, SIG_IGN);</span><br></pre></td></tr></table></figure><p>é™¤äº†è¿™ä¸ªä¿¡å·ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹2å·æˆ–è€…3å·ä¿¡å·è¿›è¡Œè‡ªå®šä¹‰æ•æ‰ï¼Œè®¾å®šé€€å‡ºä¿¡å·ï¼Œè®©æœåŠ¡å™¨èƒ½å¤Ÿ<strong>å®‰å…¨é€€å‡º</strong>ï¼ˆä¿å­˜æ—¥å¿—ä¿¡æ¯åˆ°ç£ç›˜ï¼Œé‡Šæ”¾èµ„æºç­‰ï¼›è™½ç„¶è¿›ç¨‹é€€å‡ºä¹‹åæ“ä½œç³»ç»Ÿä¼šå¸®æˆ‘ä»¬å¹²è¿™äº›äº‹ï¼Œä½†æˆ‘ä»¬è¿™ä¹ˆå†™èƒ½è®©é¡¹ç›®æ›´è§„èŒƒï¼‰</p><h3 id="2-1-5-å®Œæ•´ä»£ç "><a href="#2-1-5-å®Œæ•´ä»£ç " class="headerlink" title="2.1.5 å®Œæ•´ä»£ç "></a>2.1.5 å®Œæ•´ä»£ç </h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span> <span class="comment">// O_RDWR éœ€è¦</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">daemonize</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> fd = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 1. å¿½ç•¥SIGPIPE (ç®¡é“è¯»å†™ï¼Œè¯»ç«¯å…³é—­ï¼Œå†™ç«¯ä¼šæ”¶åˆ°ä¿¡å·ç»ˆæ­¢)</span></span><br><span class="line">    signal(SIGPIPE, SIG_IGN);</span><br><span class="line">    <span class="comment">// 2. æ›´æ”¹è¿›ç¨‹çš„å·¥ä½œç›®å½•</span></span><br><span class="line">    <span class="comment">// chdir(); // å¯ä»¥æ”¹ï¼Œå¯ä»¥ä¸æ”¹</span></span><br><span class="line">    <span class="comment">// 3. è®©è‡ªå·±ä¸è¦æˆä¸ºè¿›ç¨‹ç»„ç»„é•¿</span></span><br><span class="line">    <span class="keyword">if</span> (fork() &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 4. è®¾ç½®è‡ªå·±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ä¼šè¯</span></span><br><span class="line">    setsid();</span><br><span class="line">    <span class="comment">// 5. é‡å®šå‘0,1,2</span></span><br><span class="line">    <span class="keyword">if</span> ((fd = open(<span class="string">&quot;/dev/null&quot;</span>, O_RDWR)) != <span class="number">-1</span>) <span class="comment">// fd == 3</span></span><br><span class="line">    &#123;</span><br><span class="line">        dup2(fd, STDIN_FILENO);</span><br><span class="line">        dup2(fd, STDOUT_FILENO);</span><br><span class="line">        dup2(fd, STDERR_FILENO);</span><br><span class="line">        <span class="comment">// 6. å…³é—­æ‰ä¸éœ€è¦çš„fd</span></span><br><span class="line">        <span class="comment">// å› ä¸ºfdåªæ˜¯ä¸´æ—¶ç”¨äºé‡å®šå‘ï¼Œæ“ä½œå®Œæ¯•äº†å°±å¯ä»¥å…³æ‰äº†</span></span><br><span class="line">        <span class="keyword">if</span>(fd &gt; STDERR_FILENO) </span><br><span class="line">            close(fd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿™é‡Œè¿˜æœ‰å¦å¤–ä¸€ç§æ“ä½œï¼Œå°±æ˜¯æŠŠstdin/stdout/stderrç»™closeäº†</span></span><br><span class="line">    <span class="comment">// ä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´åªè¦æœ‰æ‰“å°è¾“å‡ºçš„ä»£ç ï¼Œè¿›ç¨‹ä¼šå°±å¼‚å¸¸é€€å‡º</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ²¡é”™ï¼Œå°±è¿™ä¸€ç‚¹ç‚¹ä»£ç ï¼Œå°±èƒ½è®©æˆ‘ä»¬çš„tcpæœåŠ¡å™¨å˜æˆå®ˆæŠ¤è¿›ç¨‹ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e487fbb466e.png"                      alt="image-20230209134324709"                ></p><p>æ­¤æ—¶æˆ‘ä»¬çš„å®¢æˆ·ç«¯ä¾æ—§èƒ½æ­£å¸¸è¿æ¥æœåŠ¡ç«¯ï¼Œè·å–ç»“æœ</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e48818b281f.png"                      alt="image-20230209134353714"                ></p><h2 id="2-2-nohup"><a href="#2-2-nohup" class="headerlink" title="2.2 nohup"></a>2.2 nohup</h2><p>no hang upï¼ˆä¸æŒ‚èµ·ï¼‰ï¼Œç”¨äºåœ¨ç³»ç»Ÿåå°ä¸æŒ‚æ–­åœ°è¿è¡Œå‘½ä»¤ï¼Œé€€å‡ºç»ˆç«¯ä¸ä¼šå½±å“ç¨‹åºçš„è¿è¡Œã€‚ç”¨nohupå‘½ä»¤æ‰§è¡Œä¸€ä¸ªè¿›ç¨‹ï¼Œ<strong>å°±èƒ½è®©è¿™ä¸ªè¿›ç¨‹æˆä¸ºä¸å—ç»ˆç«¯é€€å‡ºå½±å“çš„è¿›ç¨‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup ./test &amp;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œnohupä¼šåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code>nohup.out</code>æ–‡ä»¶ï¼Œç”¨äºè®°å½•testè¿›ç¨‹çš„è¾“å‡ºä¿¡æ¯ï¼ˆå¦‚æœé€šè¿‡äº†<code>&gt;</code>æˆ–<code>&gt;&gt;</code>æ‰§è¡Œäº†é‡å®šå‘ï¼Œåˆ™ä¸ä¼šåˆ›å»ºï¼‰</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e463b45c460.png"                      alt="image-20230209110836838"                ></p><p>é€šè¿‡pså¯å·²çœ‹åˆ°ï¼Œå½“å‰testè¿›ç¨‹çš„<strong>è¿›ç¨‹ä¼šè¯</strong>è¿˜æ˜¯å’Œbashç›¸åŒï¼Œä½†æˆ‘ä»¬å…³é—­å½“å‰bashï¼Œè¿™ä¸ªtestè¿›ç¨‹ä¾æ—§èƒ½æ­£å¸¸è¿è¡Œï¼Œåªä¸è¿‡çˆ¶è¿›ç¨‹ä¼šå˜æˆæ“ä½œç³»ç»Ÿ<code>1</code>ï¼Œæˆ‘ä»¬çš„ç›®çš„ä¹Ÿç®—æ˜¯è¾¾åˆ°äº†</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e46502f3387.png"                      alt="image-20230209111411664"                ></p><h2 id="2-3-deamonæ¥å£"><a href="#2-3-deamonæ¥å£" class="headerlink" title="2.3 deamonæ¥å£"></a>2.3 deamonæ¥å£</h2><p>linuxç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªæ¥å£<code>daemon</code>ï¼Œå¯ä»¥å¸®æˆ‘ä»¬å®ç°å®ˆæŠ¤è¿›ç¨‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">daemon</span><span class="params">(<span class="type">int</span> nochdir, <span class="type">int</span> noclose)</span>;</span><br></pre></td></tr></table></figure><p>äº†è§£è¿‡å®ˆæŠ¤è¿›ç¨‹çš„å†™æ³•äº†ä¹‹åï¼Œè¿™ä¸¤ä¸ªå‚æ•°çš„ä½œç”¨å°±å¾ˆæ˜æ˜¾äº†</p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°nochdirè¡¨æ˜æ˜¯å¦éœ€è¦ä¿®æ”¹å·¥ä½œç›®å½•ï¼›å¦‚æœè®¾ç½®ä¸º0ï¼Œåˆ™åˆ‡æ¢å·¥ä½œç›®å½•åˆ°<code>/</code>ç³»ç»Ÿæ ¹ç›®å½•</li><li>ç¬¬äºŒä¸ªå‚æ•°nocloseè¡¨æ˜æ˜¯å¦éœ€è¦é‡å®šå‘åŸºç¡€ioåˆ°<code>/dev/null</code>ï¼›è®¾ç½®ä¸º0åˆ™é‡å®šå‘</li></ul><p>ä»¥ä¸‹æ˜¯manæ‰‹å†Œä¸­çš„è¯´æ˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">If nochdir is zero, daemon() changes the calling process&#x27;s current working directory to the root directory (&quot;/&quot;); otherwise, the  curâ€</span><br><span class="line">rent working directory is left unchanged.</span><br><span class="line"></span><br><span class="line">If noclose is zero, daemon() redirects standard input, standard output and standard error to /dev/null; otherwise, no changes are made</span><br><span class="line">to these file descriptors.</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç›´æ¥ç”¨ä¸€ä¸ªç®€å•ä»£ç æ¥æ¼”ç¤º</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//ä¸éœ€è¦ä¿®æ”¹å·¥ä½œç›®å½•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è®¾ä¸º1</span></span><br><span class="line">    <span class="comment">//å› ä¸ºæ²¡æœ‰è¿›è¡Œæ‰“å°ï¼Œé‡å®šå‘è®¾ç½®æˆ1ï¼Œä¸è¿›è¡Œé‡å®šå‘</span></span><br><span class="line">    <span class="type">int</span> ret = daemon(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    sleep(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¹‹åå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªè¿›ç¨‹çš„çˆ¶idæ˜¯æ“ä½œç³»ç»Ÿï¼Œå…¶è‡ªæˆä¸€ä¸ªè¿›ç¨‹ç»„å’Œè¿›ç¨‹ä¼šè¯ï¼›å’Œæˆ‘ä»¬è‡ªå·±å†™çš„å‡½æ•°ä½œç”¨ç›¸åŒ</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e482494ff4d.png"                      alt="image-20230209131905946"                ></p><h1 id="3-é‡å®šå‘log"><a href="#3-é‡å®šå‘log" class="headerlink" title="3.é‡å®šå‘log"></a>3.é‡å®šå‘log</h1><p>å› ä¸ºå®ˆæŠ¤è¿›ç¨‹æŠŠè¾“å…¥è¾“å‡ºä¸¢åˆ°äº†åƒåœ¾æ…é‡Œé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦é‡å®šå‘æ—¥å¿—çš„è¾“å‡º</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> LOG_PATH <span class="string">&quot;./log.txt&quot;</span> <span class="comment">//å·¥ä½œè·¯å¾„ä¸‹çš„log.txt</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™ä¸ªç±»åªç”¨äºé‡å®šå‘ï¼Œä¸éœ€è¦åœ¨é‡Œé¢åŠ å…¶ä»–ä¸œè¥¿</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Logdup</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Logdup</span>()</span><br><span class="line">        :_fdout(<span class="number">-1</span>),_fderr(<span class="number">-1</span>)</span><br><span class="line">    &#123;&#125;</span><br><span class="line">    <span class="built_in">Logdup</span>(<span class="type">const</span> <span class="type">char</span>* pout=LOG_PATH,<span class="type">const</span> <span class="type">char</span>* perr=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        :_fdout(<span class="number">-1</span>),_fderr(<span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœåªä¼ å…¥äº†ç¬¬ä¸€ä¸ªpoutï¼Œåˆ™ä»£è¡¨å°†perrå’Œpouté‡å®šå‘ä¸ºä¸€ä¸ªè·¯å¾„</span></span><br><span class="line">        <span class="built_in">umask</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="type">int</span> logfd = <span class="built_in">open</span>(pout, O_WRONLY | O_CREAT | O_APPEND, <span class="number">0666</span>);</span><br><span class="line">        <span class="built_in">assert</span>(logfd != <span class="number">-1</span>);</span><br><span class="line">        _fdout = _fderr = logfd;<span class="comment">//èµ‹å€¼å¯ä»¥è¿ç­‰</span></span><br><span class="line">        <span class="comment">//åˆ¤æ–­æ˜¯ä¸æ˜¯ç©ºä¸²</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">strcmp</span>(perr,<span class="string">&quot;&quot;</span>)!=<span class="number">0</span>)<span class="comment">//ä¸ç›¸åŒï¼Œä»£è¡¨å•ç‹¬è®¾ç½®äº†errçš„è·¯å¾„</span></span><br><span class="line">        &#123;</span><br><span class="line">            logfd = <span class="built_in">open</span>(perr, O_WRONLY | O_CREAT | O_APPEND, <span class="number">0666</span>);</span><br><span class="line">            <span class="built_in">assert</span>(logfd != <span class="number">-1</span>);</span><br><span class="line">            _fderr = logfd;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">dup2</span>(_fdout, <span class="number">1</span>);<span class="comment">//é‡å®šå‘stdout</span></span><br><span class="line">        <span class="built_in">dup2</span>(_fderr, <span class="number">2</span>);<span class="comment">//é‡å®šå‘stderr</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">Logdup</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(_fdout!= <span class="number">-1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">fsync</span>(_fdout);</span><br><span class="line">            <span class="built_in">fsync</span>(_fderr);</span><br><span class="line">            <span class="comment">// å…ˆå†™ç›˜å†å…³é—­</span></span><br><span class="line">            <span class="built_in">close</span>(_fdout);</span><br><span class="line">            <span class="built_in">close</span>(_fderr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _fdout;<span class="comment">//é‡å®šå‘çš„æ—¥å¿—æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">    <span class="type">int</span> _fderr;<span class="comment">//é‡å®šå‘çš„é”™è¯¯æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">&#125;;c</span><br></pre></td></tr></table></figure><p>åšå®Œè¿™ä¸€åˆ‡ä¹‹åï¼Œæˆ‘ä»¬è¿è¡ŒæœåŠ¡å™¨ï¼Œçš„ç¡®åˆ›å»ºäº†log.txtæ–‡ä»¶ï¼Œå¯é‡Œé¢ç©ºç©ºå¦‚ä¹Ÿ</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e493ab4ff59.png"                      alt="image-20230209143230108"                ></p><p>è¿™æ˜¯å› ä¸ºæˆ‘ä»¬çš„æ•°æ®å…¶å®éƒ½è¢«å†™é“äº†ç¼“å†²åŒºé‡Œé¢ï¼Œæˆ‘ä»¬éœ€è¦åœ¨loggingé‡Œé¢æ·»åŠ ä¸€ä¸ªåˆ·æ–°æœºåˆ¶ï¼Œæ‰èƒ½è®©æ•°æ®å°½å¿«å†™å…¥åˆ°ç¡¬ç›˜ä¸­ï¼Œé¿å…æ—¥å¿—ä¸¢å¤±</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fflush(out); <span class="comment">// å°†Cç¼“å†²åŒºä¸­çš„æ•°æ®åˆ·æ–°åˆ°OS</span></span><br><span class="line">fsync(fileno(out));<span class="comment">// å°†OSä¸­çš„æ•°æ®å†™å…¥ç¡¬ç›˜</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å†è¿è¡ŒæœåŠ¡å™¨ï¼Œå°±èƒ½çœ‹åˆ°æ—¥å¿—å¾ˆå¿«è¢«å†™å…¥æ–‡ä»¶é‡Œé¢äº†ã€‚</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4957c97194.png"                      alt="image-20230209144101425"                ></p><h1 id="over"><a href="#over" class="headerlink" title="over"></a>over</h1><p>æå®šå•¦ï¼</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ¬æ–‡å°†ä»¥tcpæœåŠ¡å™¨ä»£ç ä¸ºåŸºæœ¬ï¼Œè®²è¿°å¦‚ä½•å°†è¿›ç¨‹å®ˆæŠ¤è¿›ç¨‹åŒ–ï¼Œåå°è¿è¡Œ&lt;/p&gt;</summary>
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="ç½‘ç»œ" scheme="https://blog.musnow.top/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>ã€Linuxã€‘popen pcloseæ¥å£ä»‹ç»</title>
    <link href="https://blog.musnow.top/2023/02/09/note_Linux/31popen_pclose/"/>
    <id>https://blog.musnow.top/2023/02/09/note_Linux/31popen_pclose/</id>
    <published>2023-02-08T23:28:54.000Z</published>
    <updated>2023-02-11T02:23:02.198Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬ç¯‡æ–‡ç« ç®€å•è®²è¿°äº†cè¯­è¨€æ¥å£<code>popen/pclose</code>çš„ç”¨æ³•</p><span id="more"></span><h1 id="1-å‡½æ•°ä½œç”¨"><a href="#1-å‡½æ•°ä½œç”¨" class="headerlink" title="1.å‡½æ•°ä½œç”¨"></a>1.å‡½æ•°ä½œç”¨</h1><p>å‡½æ•°å®šä¹‰å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">FILE *<span class="title function_">popen</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *command, <span class="type">const</span> <span class="type">char</span> *type)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">pclose</span><span class="params">(FILE *stream)</span>;</span><br></pre></td></tr></table></figure><h2 id="1-1-popen"><a href="#1-1-popen" class="headerlink" title="1.1 popen"></a>1.1 popen</h2><p>popenå‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªç®¡é“ï¼Œforkåè°ƒç”¨shellæ¥æ‰“å¼€è¿›ç¨‹ã€‚ç”±äºç®¡é“çš„å®šä¹‰æ˜¯å•å‘çš„ï¼Œç¬¬äºŒä¸ªå‚æ•°typeåªèƒ½æŒ‡å®šè¯»æˆ–å†™ï¼Œä¸èƒ½åŒæ—¶æŒ‡å®šè¯»å’Œå†™ï¼›</p><p>æ‰€å¾—åˆ°çš„ç®¡é“ç›¸åº”åœ°æ˜¯åªè¯»æˆ–åªå†™çš„</p><pre><code>   The  popen()  function opens a process by creating a pipe, forking, and invoking the shell.  Since a pipe is by definition unidirectional, the type argument may specify only reading or writing, not both; the resulting stream is correspondingly read-only or write-only.</code></pre><p>ç®€å•è¯´æ¥ï¼Œpopenä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬forkåˆ›å»ºå­è¿›ç¨‹å’Œä¸€ä¸ªç®¡é“ï¼Œå°†æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°<code>command</code>åœ¨shellä¸­æ‰§è¡Œåï¼Œå°†è¿”å›å€¼ä»¥<strong>ç®¡é“æ–‡ä»¶</strong>çš„å½¢å¼å‘é€ç»™è°ƒç”¨æ–¹ã€‚</p><p>å¦‚æœè°ƒç”¨<code>forkæˆ–pipe</code>å¤±è´¥ï¼Œæˆ–è€…ä¸èƒ½åˆ†é…å†…å­˜ï¼Œå°†è¿”å›NULLï¼›å¦åˆ™è¿”å›æ ‡å‡†I&#x2F;Oæµã€‚<code>popen()</code>æ²¡æœ‰ä¸ºå†…å­˜åˆ†é…å¤±è´¥è®¾ç½®errnoå€¼ã€‚å¦‚æœè°ƒç”¨fork()æˆ–pipe()æ—¶å‡ºç°é”™è¯¯ï¼Œerrnoè¢«è®¾ä¸ºç›¸åº”çš„é”™è¯¯ç±»å‹ã€‚å¦‚æœtypeå‚æ•°ä¸åˆæ³•ï¼Œerrnoå°†è¿”å›<code>EINVAL</code></p><h2 id="1-2-pclose"><a href="#1-2-pclose" class="headerlink" title="1.2 pclose"></a>1.2 pclose</h2><blockquote><p>è¿™ä¸ªå‡½æ•°æ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„ï¼Œæ˜¯ç”¨æ¥å…³æ‰popenæ‰“å¼€çš„æ–‡ä»¶çš„ï¼ˆå³popençš„è¿”å›å€¼ï¼‰</p></blockquote><p>ä½†æ˜¯ï¼Œå®ƒçš„è¿”å›å€¼å¯æœ‰è¯´åˆ°äº†ï¼Œå…¶è¿”å›å€¼å°±æ˜¯æˆ‘ä»¬ç»ˆç«¯æ“ä½œçš„é€€å‡ºçŠ¶æ€ï¼Œä»¥æ ‡è¯†å‘½ä»¤æ˜¯å¦æˆåŠŸæ‰§è¡Œ</p><p>ä½†æ˜¯è¿™ä¸ªè¿”å›æ˜¯é€šè¿‡<code>wait4</code>å¾—åˆ°çš„ï¼Œå¦‚æœ<code>wait4</code>å‡ºç°é”™è¯¯ï¼Œå°±ä¼šè¿”å›-1å¹¶è®¾ç½®<code>errno</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The pclose() function returns -1 if wait4(2) returns an error, or some other error is detected.  In the event of an error, these functions set errnro to indicate the cause of the error.</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜å‡ºç°äº†ä¸€ä¸ªæ–°çš„é”™è¯¯ç <code>errnro</code>ï¼Œä½†æ˜¯ç»è¿‡æˆ‘çš„ä¸€ç•ªç™¾åº¦ï¼Œæ²¡æœ‰å‘ç°ä»»ä½•åœ°æ–¹æœ‰å¯¹errnroçš„è¯´æ˜ï¼Œmanæ‰‹å†Œä¸‹æ–¹åˆå˜æˆäº†errno</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">If pclose() cannot obtain the child status, errno is set to ECHILD.</span><br></pre></td></tr></table></figure><p>è€Œä¸”ç¼–è¯‘æ‰§è¡Œçš„æ—¶å€™ï¼Œ<code>errnro</code>æ˜¯ä¼šæŠ¥é”™çš„ï¼Œæ‰€ä»¥å§‘ä¸”è®¤ä¸ºè¿™é‡Œæ˜¯manæ‰‹å†Œå‡ºé”™äº†ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e439f90e1c6.png"                      alt="image-20230209081025661"                ></p><p><code>errno</code>æ‰æ˜¯æ­£ç¡®çš„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> ret = pclose(f);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;pclose: %d | %s\n&quot;</span>,ret,strerror(errno));</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e43a0fdac19.png"                      alt="image-20230209081056203"                ></p><h1 id="2-ä»£ç ç¤ºä¾‹"><a href="#2-ä»£ç ç¤ºä¾‹" class="headerlink" title="2.ä»£ç ç¤ºä¾‹"></a>2.ä»£ç ç¤ºä¾‹</h1><h2 id="2-1-popenè¯»"><a href="#2-1-popenè¯»" class="headerlink" title="2.1 popenè¯»"></a>2.1 popenè¯»</h2><p>ä»¥ä¸‹æ–¹æœ€ç®€å•çš„lså‘½ä»¤ä¸ºä¾‹ï¼Œæˆ‘ä»¬ä»¥è¯»æ–¹å¼æ‰“å¼€ï¼Œpopenå°±ä¼šå°†lsçš„æ‰§è¡Œç»“æœå†™åˆ°æ–‡ä»¶é‡Œé¢è¿”å›ç»™æˆ‘ä»¬</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    FILE *f;</span><br><span class="line">    <span class="type">char</span> readBuf[<span class="number">1024</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    f = popen(<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;r&quot;</span>);</span><br><span class="line">    fread(readBuf,<span class="number">1024</span>,<span class="number">1</span>,f);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,readBuf);</span><br><span class="line">    pclose(f);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘åæ‰§è¡Œç»“æœå¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">test</span><br><span class="line">test.cpp</span><br><span class="line">    </span><br></pre></td></tr></table></figure><h2 id="2-2-popenå†™"><a href="#2-2-popenå†™" class="headerlink" title="2.2 popenå†™"></a>2.2 popenå†™</h2><p>å’Œè¯»ä¸åŒï¼Œå¦‚æœç”¨å†™æ–¹å¼æ‰§è¡Œpopenï¼Œå‘½ä»¤çš„è¾“å‡ºç»“æœä¼šç›´æ¥æ‰“å°åˆ°å±å¹•ä¸Š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">test2</span><span class="params">(FILE* f)</span></span><br><span class="line">&#123;</span><br><span class="line">    f = popen(<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;w&quot;</span>);</span><br><span class="line">    <span class="type">int</span> ret = pclose(f);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;pclose: %d | %s\n&quot;</span>,ret,strerror(errno));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">makefile  test  test.cpp</span><br><span class="line">pclose: 0 | Success</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘è¿˜ä»¥ä¸ºåç»­å¯ä»¥æ¥ç€å¾€ç®¡é“é‡Œé¢å†™æ•°æ®ï¼Œè®©ä»–ç»§ç»­æ‰§è¡Œå‘½ä»¤</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">test2</span><span class="params">(FILE* f)</span></span><br><span class="line">&#123;</span><br><span class="line">    f = popen(<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;w&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¼“å†²åŒºä¸­å†™å…¥æ•°æ®</span></span><br><span class="line">    <span class="built_in">strcpy</span>(readBuf,<span class="string">&quot;ls -l&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;cmd: %s\n&quot;</span>,readBuf);</span><br><span class="line">    <span class="comment">// å†™é“ç®¡é“æ–‡ä»¶ä¸­</span></span><br><span class="line">    fwrite(readBuf,<span class="number">1024</span>,<span class="number">1</span>,f);</span><br><span class="line">    <span class="type">int</span> ret = pclose(f);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;pclose: %d | %s\n&quot;</span>,ret,strerror(errno));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯æµ‹è¯•çš„ç»“æœå‘Šè¯‰æˆ‘ï¼Œå¹¶ä¸è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cmd: ls -l</span><br><span class="line">makefile  test  test.cpp</span><br><span class="line">pclose: 0 | Success</span><br></pre></td></tr></table></figure><p>ç½‘ä¸Šçš„èµ„æ–™å¤§å¤šæ•°éƒ½æ˜¯åªæ¼”ç¤ºäº†<strong>r</strong>æ–¹æ³•ï¼Œæˆ‘ä¸ç¡®å®šè¿™é‡Œæ˜¯ä¸æ˜¯æˆ‘å†™çš„ä»£ç æœ‰é—®é¢˜ï¼Œè¿˜æ˜¯è¯´æœ¬æ¥å°±æ˜¯è¿™æ ·çš„ã€‚æš‚ä¸”åœç•™åœ¨è¿™é‡Œå§ï¼</p><h1 id="end"><a href="#end" class="headerlink" title="end"></a>end</h1><p>å…³äºpopenå’Œpcloseçš„ç®€å•ä»‹ç»åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œæ¬¢è¿è¯„è®ºåŒºäº¤æµ</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ¬ç¯‡æ–‡ç« ç®€å•è®²è¿°äº†cè¯­è¨€æ¥å£&lt;code&gt;popen/pclose&lt;/code&gt;çš„ç”¨æ³•&lt;/p&gt;</summary>
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="Cè¯­è¨€" scheme="https://blog.musnow.top/tags/C%E8%AF%AD%E8%A8%80/"/>
    
  </entry>
  
  <entry>
    <title>ã€C++ã€‘usingçš„ä¸‰ç§ç”¨æ³•</title>
    <link href="https://blog.musnow.top/2023/02/08/note_cpp/27using%E7%9A%84%E4%B8%89%E7%A7%8D%E7%94%A8%E6%B3%95/"/>
    <id>https://blog.musnow.top/2023/02/08/note_cpp/27using%E7%9A%84%E4%B8%89%E7%A7%8D%E7%94%A8%E6%B3%95/</id>
    <published>2023-02-08T11:30:46.000Z</published>
    <updated>2023-02-08T11:40:58.093Z</updated>
    
    <content type="html"><![CDATA[<p>C++ usingçš„ä¸‰ç§ç”¨æ³•ï¼Œè¿™ä¸ªä¹‹å‰è¿˜æ²¡æœ‰æ¥è§¦è¿‡</p><span id="more"></span><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClassOne</span> </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">int</span> w;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="type">int</span> a;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClassTwo</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="keyword">using</span> ModuleType = ClassOne;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ClassType&gt;<span class="keyword">class</span> <span class="title class_">ClassThree</span> : <span class="keyword">private</span> ClassType</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">typename</span> ClassType::ModuleType;</span><br><span class="line">ModuleType m;</span><br><span class="line"><span class="built_in">ClassThree</span>() = <span class="keyword">default</span>;</span><br><span class="line"><span class="keyword">virtual</span> ~<span class="built_in">ClassThree</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">ClassThree&lt;ClassTwo&gt;::ModuleType a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢ä»£ç ä¸­ï¼Œä¸€å…±æœ‰ä¸‰å¤„ä½¿ç”¨äº†<code>using</code>ï¼Œåˆ†åˆ«æ˜¯ç¬¬3,16,22è¡Œï¼Œå®ƒä»¬çš„ä½œç”¨ä¸ºï¼š</p><ul><li>å¼•å…¥å‘½åç©ºé—´</li><li>æŒ‡å®šåˆ«å</li><li>åœ¨å­ç±»ä¸­å¼•ç”¨åŸºç±»çš„æˆå‘˜</li></ul><h2 id="å¼•å…¥å‘½åç©ºé—´"><a href="#å¼•å…¥å‘½åç©ºé—´" class="headerlink" title="å¼•å…¥å‘½åç©ºé—´"></a>å¼•å…¥<a class="link"   href="https://so.csdn.net/so/search?q=%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4&spm=1001.2101.3001.7020" >å‘½åç©ºé—´<i class="fas fa-external-link-alt"></i></a></h2><p>æŒ‡å®šå‘½åç©ºé—´æ˜¯C++ <code>using namespace</code>ä¸­æœ€å¸¸è¢«ç”¨åˆ°çš„åœ°æ–¹ï¼Œåœ¨ç¬¬3è¡Œä¸­çš„ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br></pre></td></tr></table></figure><h2 id="æŒ‡å®šåˆ«å"><a href="#æŒ‡å®šåˆ«å" class="headerlink" title="æŒ‡å®šåˆ«å"></a>æŒ‡å®šåˆ«å</h2><p><code>using</code>çš„å¦ä¸€ä¸ªä½œç”¨æ˜¯æŒ‡å®šåˆ«åï¼Œä¸€èˆ¬éƒ½æ˜¯<code>using a = b;</code>è¿™æ ·çš„å½¢å¼å‡ºç°ï¼Œæ¯”å¦‚åœ¨13è¡Œä¸­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> ModuleType = ClassOne;</span><br></pre></td></tr></table></figure><p><code>ModuleType</code> æ˜¯<code>ClassOne</code>çš„ä¸€ä¸ªåˆ«åã€‚<br><code>using</code>è¿™ä¸ªä½œç”¨ä¹Ÿæ¯”è¾ƒå¸¸è§ï¼Œæ¯”å¦‚åœ¨vector.hä¸­å°±æœ‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">_Ty</span>,<span class="keyword">class</span> <span class="title class_">_Alloc</span> = allocator&lt;_Ty&gt;&gt;<span class="keyword">class</span> vector: <span class="keyword">public</span> _Vector_alloc&lt;_Vec_base_types&lt;_Ty, _Alloc&gt;&gt;</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="keyword">using</span> value_type = _Ty;</span><br><span class="line"><span class="keyword">using</span> allocator_type = _Alloc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å³<code>value_type</code> æ˜¯<code>_Ty</code>çš„ä¸€ä¸ªåˆ«åï¼Œ<code>value_type a;</code> å’Œ<code>_Ty a;</code>æ˜¯åŒæ ·çš„æ•ˆæœã€‚</p><blockquote><p>å¯ä»¥ç†è§£ä¸ºC++ä¸­çš„<code>typedef</code></p></blockquote><h2 id="åœ¨å­ç±»ä¸­å¼•ç”¨åŸºç±»çš„æˆå‘˜"><a href="#åœ¨å­ç±»ä¸­å¼•ç”¨åŸºç±»çš„æˆå‘˜" class="headerlink" title="åœ¨å­ç±»ä¸­å¼•ç”¨åŸºç±»çš„æˆå‘˜"></a>åœ¨å­ç±»ä¸­å¼•ç”¨<a class="link"   href="https://so.csdn.net/so/search?q=%E5%9F%BA%E7%B1%BB&spm=1001.2101.3001.7020" >åŸºç±»<i class="fas fa-external-link-alt"></i></a>çš„æˆå‘˜</h2><p><code>using</code>çš„ç¬¬ä¸‰ä¸ªä½œç”¨æ˜¯å­ç±»ä¸­å¼•ç”¨åŸºç±»çš„æˆå‘˜ï¼Œä¸€èˆ¬éƒ½æ˜¯<code>using CBase::a;</code>è¿™æ ·çš„å½¢å¼å‡ºç°ï¼Œæ¯”å¦‚åœ¨22è¡Œä¸­ï¼š</p><pre><code>using typename ClassType::ModuleType;</code></pre><p>å®ƒå’Œä¸€èˆ¬å½¢å¼æœ‰äº›åŒºåˆ«ï¼Œå°±æ˜¯å®ƒåŠ äº†ä¸ª<code>typename</code> ä¿®é¥°ï¼Œè¿™æ˜¯å› ä¸ºç±»<code>ClassThree</code>æœ¬èº«æ˜¯ä¸ªæ¨¡æ¿ç±»ï¼Œå®ƒçš„åŸºç±»<code>ClassType</code>æ˜¯ä¸ªæ¨¡æ¿ï¼Œè¿™ä¸ª<code>typename</code> å’Œ<code>using</code>å…¶å®æ²¡æœ‰ä»€ä¹ˆå…³ç³»ã€‚å¦‚æœ<code>ClassType</code>ä¸æ˜¯æ¨¡æ¿çš„è¯ï¼Œè¿™è¡Œä»£ç å°±å¯ä»¥å†™æˆï¼š</p><pre><code>using ClassType::ModuleType;</code></pre><p>å‰©ä¸‹çš„å°±æ˜¯usingçš„ä½œç”¨ï¼Œå®ƒå¼•ç”¨äº†åŸºç±»ä¸­çš„æˆå‘˜<code>ModuleType</code>ï¼Œ <code>ModuleType</code>åˆæ˜¯ç±»<code>ClassOne</code>çš„åˆ«åï¼Œæ‰€ä»¥åé¢<code>ModuleType m;</code>ç›¸å½“äºå®šä¹‰å¯¹è±¡mï¼Œå¯¹äºå­ç±»æˆå‘˜mæ¥è¯´ï¼Œè¿™æ ·çš„æ•ˆæœå’Œä¸‹é¢æ˜¯ç›¸åŒçš„ï¼š</p><pre><code>typename ClassType::ModuleType m;</code></pre><p>ä¸åŒä¹‹å¤„åœ¨äº<code>using</code>è¿˜ä¿®æ”¹äº†åŸºç±»æˆå‘˜çš„è®¿é—®æƒé™ï¼Œå­ç±»<code>ClassThree</code> ç§æœ‰ç»§æ‰¿<code>ClassType</code>ï¼Œæ‰€ä»¥<code>ClassType</code>ä¸­å…±æœ‰æˆå‘˜<code>ModuleType</code> åœ¨å­ç±»<code>ClassThree</code> æ˜¯ç§æœ‰çš„ï¼Œå®ƒä¸èƒ½è¢«å¤–éƒ¨è®¿é—®ã€‚ä½†æ˜¯ä½¿ç”¨<code>using</code>åï¼Œåœ¨<code>main()</code>å‡½æ•°ä¸­å¯ä»¥ä½¿ç”¨ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œéµå¾ª [CC 4.0 BY-SA] ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥å’Œæœ¬å£°æ˜ã€‚</span><br><span class="line">æœ¬æ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/chaipp0607/article/details/100128842</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;C++ usingçš„ä¸‰ç§ç”¨æ³•ï¼Œè¿™ä¸ªä¹‹å‰è¿˜æ²¡æœ‰æ¥è§¦è¿‡&lt;/p&gt;</summary>
    
    
    
    <category term="é‡è§C++" scheme="https://blog.musnow.top/categories/%E9%81%87%E8%A7%81C/"/>
    
    
    <category term="C++" scheme="https://blog.musnow.top/tags/C/"/>
    
    <category term="C++11" scheme="https://blog.musnow.top/tags/C-11/"/>
    
  </entry>
  
  <entry>
    <title>ã€Linuxã€‘æ¥å†™ä¸€ä¸ªtcpçš„æœåŠ¡ç«¯+å®¢æˆ·ç«¯</title>
    <link href="https://blog.musnow.top/2023/02/05/note_Linux/29tcp%E4%BB%A3%E7%A0%81/"/>
    <id>https://blog.musnow.top/2023/02/05/note_Linux/29tcp%E4%BB%A3%E7%A0%81/</id>
    <published>2023-02-05T04:30:55.000Z</published>
    <updated>2023-02-09T06:09:01.681Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©è®©æˆ‘ä»¬æ¥å†™ä¸€ä¸ªtcpçš„æœåŠ¡å™¨&#x2F;å®¢æˆ·ç«¯ä»£ç </p><span id="more"></span><blockquote><p>å®Œæ•´ä»£ç è§æˆ‘çš„gitee <a class="link"   href="https://gitee.com/musnow/raspberry-practice/tree/master/code" >è¿æ¥<i class="fas fa-external-link-alt"></i></a></p><p>é˜…è¯»æœ¬æ–‡å‰ï¼Œå»ºè®®å…ˆé˜…è¯»ğŸ‘‰ <a href="https://blog.musnow.top/2023/02/01/note_linux/27udp%E4%BB%A3%E7%A0%81/">udpæœåŠ¡å™¨</a></p></blockquote><h1 id="1-åŸºæœ¬æ¡†æ¶"><a href="#1-åŸºæœ¬æ¡†æ¶" class="headerlink" title="1.åŸºæœ¬æ¡†æ¶"></a>1.åŸºæœ¬æ¡†æ¶</h1><p>tcpçš„æœåŠ¡å™¨å’ŒudpæœåŠ¡å™¨åˆå§‹åŒ–æ¥å£æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼ŒåŒºåˆ«å°±åœ¨äºè¦é€‰æ‹©<code>å­—èŠ‚æµ</code>è¿›è¡Œåˆå§‹åŒ–</p><p>ä½†æ˜¯åˆ°è¿è¡ŒçŠ¶æ€å°±ä¸åŒäº†</p><ul><li>tcpæ˜¯éœ€è¦è¿æ¥çš„</li><li>udpä¸éœ€è¦è¿æ¥</li></ul><p>æ‰€ä»¥å°±ä¼šå‡ºç°åˆ†æ­§ï¼šudpå¯ä»¥ç”¨sendtoå’Œreceveæ¥å‘é€&#x2F;æ¥æ”¶ä¿¡æ¯ï¼ŒæœåŠ¡ç«¯åªéœ€è¦ç›‘å¬ç‰¹å®šç«¯å£æ”¶åˆ°äº†ä»€ä¹ˆä¿¡æ¯ï¼›</p><p>ä½†tcpå¹¶ä¸èƒ½è¿™ä¹ˆåšï¼Œåœ¨é€šä¿¡ä¹‹å‰ï¼ŒtcpæœåŠ¡å™¨å¿…é¡»è¦å’Œå®¢æˆ·ç«¯å»ºç«‹é“¾æ¥ã€‚</p><p>ä¸¾ä¸ªä¸æ°å½“çš„ä¾‹å­ï¼ŒudpæœåŠ¡å™¨å¥½æ¯”ä¸€ä¸ªæ°´ç›†ï¼Œç­‰å¾…æ°´çš„æ³¨å…¥ï¼›è€ŒtcpæœåŠ¡å™¨æ˜¯ä¸ªæ°´ç®¡ï¼Œå¿…é¡»è¦ä¸¤å¤´è¿é€šäº†ï¼Œæ‰èƒ½å¼€å§‹æ³¨æ°´</p><h2 id="1-1-ç±»æˆå‘˜"><a href="#1-1-ç±»æˆå‘˜" class="headerlink" title="1.1 ç±»æˆå‘˜"></a>1.1 ç±»æˆå‘˜</h2><p>ç±»çš„æˆå‘˜å˜é‡å’Œudpå¾ˆç›¸ä¼¼ï¼Œéƒ½æ˜¯éœ€è¦æœåŠ¡å™¨çš„ipã€ç«¯å£ã€sockfdè¿™äº›ä¿¡æ¯ã€‚ä¸ºäº†æ›´å®¹æ˜“åŒºåˆ†ï¼Œå°†tcpæœåŠ¡å™¨çš„<code>socket fd</code>æ”¹ä¸º<code>_listenSock</code>ï¼Œæ„ä¸ºç›‘å¬ç«¯å£</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TcpServer</span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// æœåŠ¡å™¨ç«¯å£å·</span></span><br><span class="line">    <span class="type">uint16_t</span> _port;</span><br><span class="line">    <span class="comment">// æœåŠ¡å™¨ipåœ°å€</span></span><br><span class="line">    string _ip;</span><br><span class="line">    <span class="comment">// æœåŠ¡å™¨socket fdä¿¡æ¯</span></span><br><span class="line">    <span class="type">int</span> _listenSock;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="1-2-å¤´æ–‡ä»¶"><a href="#1-2-å¤´æ–‡ä»¶" class="headerlink" title="1.2 å¤´æ–‡ä»¶"></a>1.2 å¤´æ–‡ä»¶</h2><p>è¿™é‡Œå¯¹å¤´æ–‡ä»¶è¿›è¡Œä¸€å®šçš„è¯´æ˜ï¼Œå› ä¸ºæœåŠ¡å™¨ä»£ç ä¸­çš„å¤´æ–‡ä»¶å®åœ¨å¤ªå¤šäº†</p><p>å½“ä½ éœ€è¦ä½¿ç”¨ä¸€ä¸ªæ¥å£çš„æ—¶å€™ï¼Œå¯ä»¥å»é‡‡ç”¨manæ‰‹å†Œæ¥è·å–è¯¥æ¥å£çš„å¤´æ–‡ä»¶ä¿¡æ¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="comment">// å¤´æ–‡ä»¶å¤ªå¤šäº†ï¼Œæ‰€ä»¥æ–°èµ·ä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctype.h&gt;</span><span class="comment">//åˆ¤æ–­å­—ç¬¦ä¸²å¤§å†™å°å†™æ¥å£éœ€è¦çš„åº“</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;strings.h&gt;</span><span class="comment">// å¿½ç•¥å¤§å°å†™æ¯”è¾ƒstrcasecmp</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span>  <span class="comment">//å¾ˆå¤šliunxç³»ç»Ÿæ¥å£éƒ½éœ€è¦è¿™ä¸ª</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span> <span class="comment">// ç½‘ç»œ</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span> <span class="comment">// ç½‘ç»œ</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span> <span class="comment">// ç½‘ç»œ</span></span></span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SOCKET_ERR 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BIND_ERR   2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LISTEN_ERR 3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> USAGE_ERR  4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONN_ERR   5</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUFFER_SIZE 1024</span></span><br></pre></td></tr></table></figure><h1 id="2-åˆå§‹åŒ–"><a href="#2-åˆå§‹åŒ–" class="headerlink" title="2.åˆå§‹åŒ–"></a>2.åˆå§‹åŒ–</h1><p>æ¥å£çš„ä»‹ç»å°±è·Ÿéšå®ç°ä¸€æ­¥ä¸€æ­¥æ¥å§</p><h2 id="2-1-æ„é€ sock"><a href="#2-1-æ„é€ sock" class="headerlink" title="2.1 æ„é€ sock"></a>2.1 æ„é€ sock</h2><p>è¿™é‡Œå‡ºç°äº†tcpå’Œudpç¬¬ä¸€ä¸ªä¸åŒä¹‹å¤„ï¼Œtcpæ˜¯é¢å‘å­—èŠ‚æµçš„ï¼Œudpé¢å‘çš„æ˜¯æ•°æ®æŠ¥</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">TcpServer</span>(<span class="type">uint16_t</span> port,<span class="type">const</span> string&amp; ip=<span class="string">&quot;&quot;</span>)</span><br><span class="line"> :_port(port), _ip(ip), _listenSock(<span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºsocketå¥—æ¥å­—,é‡‡ç”¨å­—èŠ‚æµï¼ˆå³tcpï¼‰</span></span><br><span class="line">    _listenSock = <span class="built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="number">0</span>); <span class="comment">//æœ¬è´¨æ˜¯æ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (_listenSock &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">logging</span>(FATAL, <span class="string">&quot;socket:%s:%d&quot;</span>, <span class="built_in">strerror</span>(errno), _listenSock);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">logging</span>(DEBUG, <span class="string">&quot;socket create success: %d&quot;</span>, _listenSock);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-2-åˆå§‹åŒ–sockaddr-in"><a href="#2-2-åˆå§‹åŒ–sockaddr-in" class="headerlink" title="2.2 åˆå§‹åŒ–sockaddr_in"></a>2.2 åˆå§‹åŒ–sockaddr_in</h2><p>ç»§ç»­ï¼Œåˆå§‹åŒ–sockaddr_inçš„æ“ä½œå’Œudpæ˜¯å®Œå…¨ä¸€è‡´çš„</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. ç»‘å®šç½‘ç»œä¿¡æ¯ï¼ŒæŒ‡æ˜ip+port</span></span><br><span class="line"><span class="comment">// 2.1 å…ˆå¡«å……åŸºæœ¬ä¿¡æ¯åˆ° struct sockaddr_in</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> local;</span><br><span class="line"><span class="built_in">memset</span>(&amp;local,<span class="number">0</span>,<span class="built_in">sizeof</span>(local));<span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">// åè®®å®¶æ—ï¼Œè®¾ç½®ä¸ºipv4</span></span><br><span class="line">local.sin_family = AF_INET; </span><br><span class="line"><span class="comment">// ç«¯å£ï¼Œéœ€è¦è¿›è¡Œ æœ¬åœ°-&gt;ç½‘ç»œè½¬æ¢</span></span><br><span class="line">local.sin_port = <span class="built_in">htons</span>(_port);</span><br><span class="line"><span class="comment">// é…ç½®ip</span></span><br><span class="line"><span class="comment">// å¦‚æœåˆå§‹åŒ–æ—¶å€™çš„ipä¸ºç©ºï¼Œåˆ™è°ƒç”¨INADDR_ANYä»£è¡¨ä»»æ„ipã€‚å¦åˆ™å¯¹ä¼ å…¥çš„ipè¿›è¡Œè½¬æ¢åèµ‹å€¼</span></span><br><span class="line">local.sin_addr.s_addr = _ip.<span class="built_in">empty</span>() ? <span class="built_in">htonl</span>(INADDR_ANY) : <span class="built_in">inet_addr</span>(_ip.<span class="built_in">c_str</span>());</span><br></pre></td></tr></table></figure><h2 id="2-3-bind"><a href="#2-3-bind" class="headerlink" title="2.3 bind"></a>2.3 bind</h2><p>ä¹Ÿæ˜¯ä¸€æ ·ï¼Œç»‘å®šæœåŠ¡å™¨çš„ipå’Œç«¯å£</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.2 ç»‘å®šipç«¯å£</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">bind</span>(_listenSock,(<span class="type">const</span> <span class="keyword">struct</span> sockaddr *)&amp;local, <span class="built_in">sizeof</span>(local)) == <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">logging</span>(FATAL, <span class="string">&quot;bind: %s:%d&quot;</span>, <span class="built_in">strerror</span>(errno), _listenSock);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">logging</span>(DEBUG,<span class="string">&quot;socket bind success: %d&quot;</span>, _listenSock);</span><br></pre></td></tr></table></figure><h2 id="2-4-ç›‘å¬listen"><a href="#2-4-ç›‘å¬listen" class="headerlink" title="2.4 ç›‘å¬listen"></a>2.4 ç›‘å¬listen</h2><p>å¯¹äºtcpæœåŠ¡å™¨æ¥è¯´ï¼Œæˆå‘˜å˜é‡çš„<code>_listenSock</code>æ˜¯ç”¨æ¥ç›‘å¬çš„ï¼Œå³æ‰¾ä¸ªè€å“¥ä¸€ç›´ç›¯ç€äº‘æœåŠ¡å™¨çš„è¿™ä¸ªç«¯å£ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰éœ€è¦è¿æ¥å®ƒçš„å®¢æˆ·ç«¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span>          <span class="comment">/* See NOTES */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">listen</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">int</span> backlog)</span>;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬çš„<code>_listenSock</code>ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç”¨äºé™åˆ¶åœ¨é˜»å¡ç­‰å¾…è¿æ¥çš„æ•°é‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The backlog argument defines the maximum length to which the queue of pending connections for sockfd may grow.   If  a connection  request arrives when the queue is full, the client may receive an error with an indication of ECONNREFUSED or, if the underlying protocol supports retransmission, the request may be ignored so that a later reattempt  at  conâ€nection succeeds.</span><br></pre></td></tr></table></figure><p>ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼Œ<code>backlog</code>å‚æ•°é™åˆ¶äº†èƒ½è¢«é˜»å¡ç­‰å¾…è¿æ¥çš„æ•°é‡ã€‚å¦‚æœè¶…è¿‡è¿™ä¸ªæ•°é‡ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ª<code>ECONNREFUSED</code>é”™è¯¯ã€‚äº¦æˆ–è€…å¦‚æœåè®®æ”¯æŒé‡ä¼ ï¼Œå¤šä½™çš„è¯·æ±‚ä¼šè¢«å¿½ç•¥ï¼Œåç»­å¯ä»¥é‡ä¼ </p><p>manæ‰‹å†Œä¸‹é¢çš„notesè¿˜æœ‰æ›´å¤šè§£é‡Š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The behavior of the backlog argument on TCP sockets changed with Linux 2.2.  Now it specifies  the  queue  length  for completely  established  sockets waiting to be accepted, instead of the number of incomplete connection requests.  The maximum length of the queue for incomplete sockets can be set using /proc/sys/net/ipv4/tcp_max_syn_backlog.  When synâ€cookies are enabled there is no logical maximum length and this setting is ignored.  See tcp(7) for more information.</span><br><span class="line"></span><br><span class="line"> If  the  backlog  argument is greater than the value in /proc/sys/net/core/somaxconn, then it is silently truncated to that value; the default value in this file is 128.  In kernels before 2.4.25, this  limit  was  a  hard  coded  value,SOMAXCONN, with the value 128.</span><br></pre></td></tr></table></figure><p>å¦‚æœ<code>backlog</code>å‚æ•°é«˜äº<code>/proc/sys/net/core/somaxconn</code>ä¸­çš„é»˜è®¤å€¼128ï¼Œåˆ™ä¼šè¢«æˆªæ–­ä¸º128</p><hr><p>åœ¨æˆ‘ä»¬è¿™é‡Œï¼Œå°†å…¶è®¾ç½®ä¸º5å³å¯ï¼Œåæ­£ä¹Ÿæ˜¯åšæµ‹è¯•å˜›ï¼Œé—®é¢˜ä¸å¤§</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3.ç›‘å¬</span></span><br><span class="line"><span class="comment">// tcpæœåŠ¡å™¨æ˜¯éœ€è¦è¿æ¥çš„ï¼Œè¿æ¥ä¹‹å‰è¦å…ˆç›‘å¬æœ‰æ²¡æœ‰äººæ¥è¿</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">listen</span>(_listenSock, <span class="number">5</span>) &lt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">logging</span>(FATAL, <span class="string">&quot;listen: %s&quot;</span>, <span class="built_in">strerror</span>(errno));</span><br><span class="line">    <span class="built_in">exit</span>(LISTEN_ERR);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">logging</span>(DEBUG, <span class="string">&quot;listen: %s, %d&quot;</span>, <span class="built_in">strerror</span>(errno), _listenSock);</span><br></pre></td></tr></table></figure><h1 id="3-è¿è¡Œ"><a href="#3-è¿è¡Œ" class="headerlink" title="3.è¿è¡Œ"></a>3.è¿è¡Œ</h1><p>åˆå§‹åŒ–åˆ°è¿™å°±å®Œæ¯•äº†ï¼Œä¸‹é¢å°±æ˜¯å¼€è·‘äº†</p><h2 id="3-1-accept"><a href="#3-1-accept" class="headerlink" title="3.1 accept"></a>3.1 accept</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span>          <span class="comment">/* See NOTES */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">accept</span><span class="params">(<span class="type">int</span> sockfd, <span class="keyword">struct</span> sockaddr *addr, <span class="type">socklen_t</span> *addrlen)</span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ¥å£çš„ä½œç”¨å°±ç›¸å½“äºtcpä¸­çš„<code>recevefrom</code>ï¼Œä¼ å‚æ˜¯å®Œå…¨ç›¸åŒçš„ï¼›ä¸ä¹‹ä¸åŒçš„æ˜¯ï¼Œè¯¥å‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå…¨æ–°çš„<code>sockfd</code></p><ul><li>tcpéœ€è¦å’Œå®¢æˆ·ç«¯å»ºç«‹é“¾æ¥</li><li>é“¾æ¥éœ€è¦ç”¨socket fd æ¥ç®¡ç†</li><li>æ‰€ä»¥acceptå¿…é¡»è¿”å›æ–°çš„socket fdï¼Œè®©æœåŠ¡ç«¯æœ‰åŠæ³•ç®¡ç†æ–°çš„é“¾æ¥å’Œå·²æœ‰é“¾æ¥</li><li>åŸæœ‰çš„socket fdä¸å—å½±å“</li><li>å¦‚æœæ²¡æœ‰å®¢æˆ·ç«¯æ¥è¿æ¥ï¼Œè¿›ç¨‹ä¼šåœ¨acceptå†…é˜»å¡ç­‰å¾…</li></ul><p>ä¸‹ä¸ºmanæ‰‹å†Œä¸­çš„æè¿°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The  accept()  system  call  is  used  with connection-based socket types (SOCK_STREAM, SOCK_SEQPACKET).  It extracts the first connection request on the queue of pending connections for the listening socket, sockfd, creates a new connected  socket,  and  returns  a  new  file descriptor referring to that socket.  The newly created socket is not in the listening state.  The original socket sockfd is unaffected by this call.</span><br></pre></td></tr></table></figure><p>ä¸¾ä¸ªä¾‹å­ï¼ŒtcpæœåŠ¡å™¨è‡ªèº«çš„socket fdåªä¼šç”¨æ¥ç›‘å¬ç«¯å£ä¸Šæœ‰æ²¡æœ‰æ¶ˆæ¯ï¼Œå½“ç›‘å¬åˆ°æœ‰æ¶ˆæ¯å¹¶é€šè¿‡<code>accept</code>å»ºç«‹è¿æ¥åï¼Œå°±ä¼šè®©å¦å¤–ä¸€ä½æœåŠ¡å‘˜æ¥å¯¹è¿™ä¸ªè¿æ¥æä¾›æœåŠ¡ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> peer;</span><br><span class="line">    <span class="type">socklen_t</span> len = <span class="built_in">sizeof</span>(peer);</span><br><span class="line">    <span class="comment">// è·å–è¿æ¥</span></span><br><span class="line">    <span class="type">int</span> conet = <span class="built_in">accept</span>(_listenSock,(<span class="keyword">struct</span> sockaddr*)&amp;peer,&amp;len);</span><br><span class="line">    <span class="keyword">if</span>(conet&lt;<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">logging</span>(FATAL, <span class="string">&quot;accept: %s&quot;</span>, <span class="built_in">strerror</span>(errno));</span><br><span class="line">        <span class="built_in">exit</span>(CONN_ERR);<span class="comment">//è¿æ¥é”™è¯¯</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ã€‚ã€‚ã€‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œlençš„å‚æ•°æ˜¯<code>socklen_t</code>ï¼Œå…¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´å½¢</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">__socklen_t</span> <span class="type">socklen_t</span>;</span><br><span class="line">__STD_TYPE __U32_TYPE <span class="type">__socklen_t</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __U32_TYPEunsigned int</span></span><br></pre></td></tr></table></figure><h2 id="3-2-è·å–è¿æ¥ä¿¡æ¯"><a href="#3-2-è·å–è¿æ¥ä¿¡æ¯" class="headerlink" title="3.2 è·å–è¿æ¥ä¿¡æ¯"></a>3.2 è·å–è¿æ¥ä¿¡æ¯</h2><p>è¿™éƒ¨åˆ†å’Œudpæ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œé€šè¿‡acceptè¿”å›çš„socket fdï¼Œè·å–ç”¨æˆ·çš„ipå’Œç«¯å£è€¨</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–è¿æ¥ä¿¡æ¯</span></span><br><span class="line">string senderIP = <span class="built_in">inet_ntoa</span>(peer.sin_addr);<span class="comment">// æ¥æºip</span></span><br><span class="line"><span class="type">uint16_t</span> senderPort = <span class="built_in">ntohs</span>(peer.sin_port); <span class="comment">// æ¥æºç«¯å£</span></span><br><span class="line"><span class="built_in">logging</span>(DEBUG, <span class="string">&quot;accept: %s | %s[%d], socket fd: %d&quot;</span>, <span class="built_in">strerror</span>(errno), senderIP.<span class="built_in">c_str</span>(), senderPort, conet);</span><br></pre></td></tr></table></figure><p>å…¶å®åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿è¡ŒæœåŠ¡å™¨è¿›è¡Œæµ‹è¯•äº†ã€‚å› ä¸ºtcpçš„ç‰¹æ€§ï¼Œæˆ‘ä»¬ä¸éœ€è¦å†™å®¢æˆ·ç«¯ï¼Œç›´æ¥ç”¨æµè§ˆå™¨å°±èƒ½è¿ä¸ŠæœåŠ¡ç«¯</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//å‚æ•°åªæœ‰ä¸¤ä¸ªï¼ˆç«¯å£/ipï¼‰æ‰€ä»¥å‚æ•°ä¸ªæ•°åº”è¯¥æ˜¯2-3</span></span><br><span class="line">    <span class="keyword">if</span>(argc!=<span class="number">2</span> &amp;&amp; argc!=<span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Usage: &quot;</span> &lt;&lt; argv[<span class="number">0</span>] &lt;&lt; <span class="string">&quot; port [ip]&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    string ip;</span><br><span class="line">    <span class="comment">// 3ä¸ªå‚æ•°ï¼Œæœ‰ip</span></span><br><span class="line">    <span class="keyword">if</span>(argc==<span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        ip = argv[<span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">TcpServer <span class="title">t</span><span class="params">(atoi(argv[<span class="number">1</span>]),ip)</span></span>;</span><br><span class="line">    t.<span class="built_in">start</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆç¼–è¯‘åæ‰§è¡Œä»£ç ï¼Œè®©tcpæœåŠ¡å™¨è¿è¡Œèµ·æ¥</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e198bcc215e.png"                      alt="image-20230207081805916"                ></p><p>éšååœ¨æµè§ˆå™¨çš„åœ°å€æ è¾“å…¥<code>å…¬ç½‘ip:ç«¯å£</code>ï¼ˆå…ˆè¦å¼€å¯é˜²ç«å¢™å†…çš„ç«¯å£ï¼‰</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e198b144512.png"                      alt="image-20230207081754768"                ></p><p>æ­¤æ—¶ä¼šå‘ç°ä»€ä¹ˆéƒ½åŠ è½½ä¸å‡ºæ¥ï¼Œè¿™æ˜¯å¯¹çš„ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶æ²¡æœ‰å†™å‰ç«¯ï¼Œä¹Ÿæ²¡æœ‰æä¾›ä»»ä½•æœåŠ¡ã€‚ä½†æ˜¯æ¥åˆ°åå°ï¼Œå¯ä»¥çœ‹åˆ°å‡ºç°äº†ä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œå¹¶æ˜¾ç¤ºå‡ºäº†ip+ç«¯å£</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e19990d9e97.png"                      alt="image-20230207082138291"                ></p><h2 id="3-3-æä¾›æœåŠ¡ï¼ˆçº¿ç¨‹ï¼‰"><a href="#3-3-æä¾›æœåŠ¡ï¼ˆçº¿ç¨‹ï¼‰" class="headerlink" title="3.3 æä¾›æœåŠ¡ï¼ˆçº¿ç¨‹ï¼‰"></a>3.3 æä¾›æœåŠ¡ï¼ˆçº¿ç¨‹ï¼‰</h2><p>æ¥ä¸‹æ¥è¦åšçš„ï¼Œå°±æ˜¯å†™ä¸€ä¸ªç®€å•çš„æœåŠ¡äº†ï¼Œè¿™é‡Œæˆ‘å†™çš„æ˜¯å­—ç¬¦ä¸²è½¬ASCIIç ï¼Œä¼šå°†å‘å‡ºå»çš„å­—ç¬¦ä¸²çš„asciiç åŠ åŠ èµ·æ¥åè¿”å›</p><h3 id="3-3-1-é—®é¢˜1-å¦‚ä½•é€šä¿¡"><a href="#3-3-1-é—®é¢˜1-å¦‚ä½•é€šä¿¡" class="headerlink" title="3.3.1 é—®é¢˜1 å¦‚ä½•é€šä¿¡"></a>3.3.1 é—®é¢˜1 å¦‚ä½•é€šä¿¡</h3><p>æ­¤æ—¶é—®é¢˜å°±æ¥äº†ï¼ŒtcpæœåŠ¡å™¨ä¸èƒ½ä½¿ç”¨recevefromå’Œsendtoï¼Œé‚£ä¹ˆè·å–åˆ°socketä¹‹åè¦æ€ä¹ˆè¿›è¡Œé€šä¿¡å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼š<strong>ç”¨linuxçš„æ–‡ä»¶è¯»å†™æ¥å£</strong>ï¼Œreadå’Œwriteã€‚åˆ«å¿˜äº†ï¼Œsocket fdæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªlinuxä¸‹çš„æ–‡ä»¶æè¿°ç¬¦ï¼</p><h3 id="3-3-2-é—®é¢˜2-å¤šå®¢æˆ·ç«¯"><a href="#3-3-2-é—®é¢˜2-å¤šå®¢æˆ·ç«¯" class="headerlink" title="3.3.2 é—®é¢˜2 å¤šå®¢æˆ·ç«¯"></a>3.3.2 é—®é¢˜2 å¤šå®¢æˆ·ç«¯</h3><p>tcpæœåŠ¡å™¨è¦æƒ³ç»™å¤šä¸ªå®¢æˆ·ç«¯æä¾›æœåŠ¡ï¼Œå°±å¿…é¡»é‡‡ç”¨å¤šçº¿ç¨‹&#x2F;å¤šè¿›ç¨‹çš„æ–¹å¼æ¥å®ç°æ“ä½œã€‚å¦åˆ™ä¼šå‡ºç°ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼ŒæœåŠ¡ç«¯å› ä¸ºæä¾›æœåŠ¡è€Œæ²¡æœ‰<code>accept</code>ï¼Œæ— æ³•é“¾æ¥ä¸Šä¸‹ä¸€ä¸ªå®¢æˆ·ç«¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//accept è·å–åˆ°é“¾æ¥ä¸Šçš„å®¢æˆ·ç«¯</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">         <span class="comment">//å¦‚æœåœ¨è¿™é‡Œæä¾›æœåŠ¡ï¼Œåˆ™ä¼šå…¶ä»–è¿æ¥ä¼šåœ¨listené‡Œé¢é˜»å¡</span></span><br><span class="line">    <span class="comment">//åªæœ‰å½“å‰æœåŠ¡ç»ˆæ­¢äº†ï¼Œå…¶ä»–å®¢æˆ·ç«¯çš„å…¶ä¸­ä¹‹ä¸€æ‰èƒ½è¿ä¸ŠæœåŠ¡å™¨</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3-3-é—®é¢˜3-çº¿ç¨‹ä¼ å‚"><a href="#3-3-3-é—®é¢˜3-çº¿ç¨‹ä¼ å‚" class="headerlink" title="3.3.3 é—®é¢˜3 çº¿ç¨‹ä¼ å‚"></a>3.3.3 é—®é¢˜3 çº¿ç¨‹ä¼ å‚</h3><p>æ—¢ç„¶éœ€è¦é‡‡ç”¨å¤šçº¿ç¨‹æœåŠ¡ï¼Œé‚£å°±éœ€è¦è®¾å®šå¥½ç»™çº¿ç¨‹ä¼ çš„å‚æ•°ã€‚ç†è®ºä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬åªéœ€è¦ä¼ å…¥acceptçš„è¿”å›å€¼<code>socket fd</code>å³å¯è¿›è¡Œ<code>read/write</code></p><p>ä½†å®é™…ä¸Šï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ‰“å°debugæ¶ˆæ¯ï¼Œè¦çŸ¥é“å½“å‰æ˜¯è°å‘ä½ å‘é€äº†è¿™æ¡æ¶ˆæ¯ï¼Œipå’Œç«¯å£æ˜¯ä»€ä¹ˆã€‚</p><p>ä¸ºäº†æ–¹ä¾¿æ“ä½œï¼Œè¿™é‡Œå°è£…ä¸€ä¸ªç»“æ„ä½“ï¼Œå°†socket fdï¼Œå®¢æˆ·ç«¯çš„ip+ç«¯å£å°è£…æˆä¸€ä¸ªå‚æ•°è¿›è¡Œä¼ å‚ï¼ˆ<strong>çº¿ç¨‹çš„å‡½æ•°åªèƒ½ä¼ å…¥ä¸€ä¸ªå‚æ•°</strong>ï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ClientData</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">int</span> _fd;</span><br><span class="line">    <span class="type">uint16_t</span> _port;</span><br><span class="line">    <span class="built_in">string</span> _ip;</span><br><span class="line">    TcpServer* _this;</span><br><span class="line"></span><br><span class="line">    ClientData(<span class="type">int</span> fd,<span class="type">uint16_t</span> port,<span class="type">const</span> <span class="built_in">string</span>&amp; ip,TcpServer* this1)</span><br><span class="line">        :_fd(fd),_port(port), _ip(ip),_this(this1)</span><br><span class="line">    &#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½ä¼šæƒ³åˆ°å¦å¤–ä¸€ä¸ªåŠæ³•ï¼Œé‚£å°±æ˜¯åœ¨tcpæœåŠ¡å™¨çš„classä¸­æ–°å¢ä¸€ä¸ªmapæˆå‘˜å˜é‡ï¼Œç”¨äºæ˜ å°„socket fdå’Œå®¢æˆ·ç«¯ä¿¡æ¯çš„é”®å€¼å¯¹ï¼Œä½†æ˜¯è¿™æ— æ³•å®ç°ã€‚</p><p>å› ä¸ºåœ¨ç±»ä¸­è®¾è®¡çš„å¤šçº¿ç¨‹å‡½æ•°ï¼Œä¸ºäº†å»æ‰é»˜è®¤ä¼ å…¥çš„<code>this</code>æŒ‡é’ˆï¼Œå¿…é¡»è¦è®¾ç½®æˆ<code>static</code>é™æ€çš„ï¼Œæ­¤æ—¶è¯¥é™æ€å‡½æ•°<strong>æ— æ³•è®¿é—®</strong>ç±»å†…æˆå‘˜ï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å› ä¸ºéœ€è¦å–æ¶ˆthisæŒ‡é’ˆï¼Œæ‰€ä»¥éœ€è¦è®¾ç½®æˆé™æ€çš„</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span>* <span class="title">threadRoutine</span><span class="params">(<span class="type">void</span>*args)</span></span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line">    <span class="built_in">pthread_detach</span>(<span class="built_in">pthread_self</span>()); <span class="comment">//è®¾ç½®çº¿ç¨‹åˆ†ç¦»</span></span><br><span class="line">    ClientData* data=(ClientData*)args;</span><br><span class="line">    <span class="comment">// é€šè¿‡é¢„å…ˆè®¾ç½®çš„thisæŒ‡é’ˆæ¥è®¿é—®ç±»å†…æˆå‘˜ï¼Œå¹¶è¿›è¡Œä¼ å‚</span></span><br><span class="line">    data-&gt;_this-&gt;<span class="built_in">transService</span>(data-&gt;_fd,data-&gt;_ip,data-&gt;_port);</span><br><span class="line">    <span class="keyword">delete</span> data;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3-4-æœåŠ¡ä»£ç "><a href="#3-3-4-æœåŠ¡ä»£ç " class="headerlink" title="3.3.4 æœåŠ¡ä»£ç "></a>3.3.4 æœåŠ¡ä»£ç </h3><p>è§£å†³äº†ä¸Šé¢çš„é—®é¢˜ï¼Œå°±å¯ä»¥ç»§ç»­å¾€ä¸‹çœ‹çœ‹æœåŠ¡ç«¯çš„ä»£ç äº†</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æä¾›æœåŠ¡</span></span><br><span class="line"><span class="type">pthread_t</span> service;</span><br><span class="line"><span class="comment">// å› ä¸ºè¿™ä¸ªæˆå‘˜ä½¿ç”¨èŒƒå›´æå°ï¼Œæ‰€ä»¥é‡‡ç”¨new/deleteï¼Œé¿å…å ç”¨å¤ªå¤šç©ºé—´</span></span><br><span class="line">ClientData* data = <span class="keyword">new</span> <span class="built_in">ClientData</span>(conet,senderPort,senderIP,<span class="keyword">this</span>);</span><br><span class="line"><span class="built_in">pthread_create</span>(&amp;service,<span class="literal">nullptr</span>,threadRoutine,(<span class="type">void</span>*)data);</span><br></pre></td></tr></table></figure><p>åœ¨acceptä¹‹åï¼Œé€šè¿‡çº¿ç¨‹æ“ä½œç”¨çº¿ç¨‹æ¥æä¾›æœåŠ¡</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span>* <span class="title">threadRoutine</span><span class="params">(<span class="type">void</span>*args)</span></span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line">    <span class="built_in">pthread_detach</span>(<span class="built_in">pthread_self</span>()); <span class="comment">//è®¾ç½®çº¿ç¨‹åˆ†ç¦»</span></span><br><span class="line">    ClientData* data=(ClientData*)args;</span><br><span class="line">    <span class="comment">// é€šè¿‡é¢„å…ˆè®¾ç½®çš„thisæŒ‡é’ˆæ¥è®¿é—®ç±»å†…æˆå‘˜ï¼Œå¹¶è¿›è¡Œä¼ å‚</span></span><br><span class="line">    data-&gt;_this-&gt;<span class="built_in">transService</span>(data-&gt;_fd,data-&gt;_ip,data-&gt;_port);</span><br><span class="line">    <span class="keyword">delete</span> data;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>threadRoutine</code>çš„ä½œç”¨å°±æ˜¯æŠŠçº¿ç¨‹çš„å•å‚æ•°è½¬ä¸ºå¤šå‚æ•°ï¼Œä¼ ç»™çœŸæ­£ç”¨æ¥æœåŠ¡çš„å‡½æ•°ã€‚å‡½æ•°çš„æ“ä½œå¾ˆç®€å•ï¼Œå°±æ˜¯Linuxä¸‹æ–‡ä»¶æ“ä½œçš„è¯»å†™ã€‚</p><p>è¯»å†™æˆåŠŸåï¼Œå°†å®¢æˆ·ç«¯å‘æ¥çš„ä¿¡æ¯è½¬æˆASCIIç çš„å’Œå‘å›ç»™å®¢æˆ·ç«¯</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">transService</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> string &amp;clientIp, <span class="type">uint16_t</span> clientPort)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">assert</span>(sockfd &gt;= <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">assert</span>(!clientIp.<span class="built_in">empty</span>());</span><br><span class="line">    <span class="built_in">assert</span>(clientPort&gt;<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// å¼€å§‹æœåŠ¡</span></span><br><span class="line">    <span class="type">char</span> buf[BUFFER_SIZE];</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// è¯»å–å®¢æˆ·ç«¯å‘æ¥çš„ä¿¡æ¯,sæ˜¯è¯»å–åˆ°çš„å­—èŠ‚æ•°</span></span><br><span class="line">        <span class="type">ssize_t</span> s = <span class="built_in">read</span>(sockfd, buf, <span class="built_in">sizeof</span>(buf)<span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">if</span>(s&gt;<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            buf[s]=<span class="string">&#x27;\0&#x27;</span>;<span class="comment">//æ‰‹åŠ¨æ·»åŠ å­—ç¬¦ä¸²ç»ˆæ­¢ç¬¦</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">strcasecmp</span>(buf,<span class="string">&quot;quit&quot;</span>)==<span class="number">0</span>)</span><br><span class="line">            &#123;<span class="comment">//å®¢æˆ·ç«¯ä¸»åŠ¨é€€å‡º</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æœåŠ¡</span></span><br><span class="line">            string tmp = buf;</span><br><span class="line">            <span class="type">int</span> ret = <span class="built_in">str2ascii</span>(tmp);<span class="comment">//è·å–å­—ç¬¦ä¸²çš„asciiæ€»å’Œ</span></span><br><span class="line">            cout &lt;&lt; ret &lt;&lt; endl;</span><br><span class="line">            string retS =  <span class="built_in">to_string</span>(ret);<span class="comment">//è½¬å­—ç¬¦ä¸²</span></span><br><span class="line">            cout &lt;&lt; retS &lt;&lt; endl;</span><br><span class="line">            <span class="built_in">write</span>(sockfd,retS.<span class="built_in">c_str</span>(),retS.<span class="built_in">size</span>());<span class="comment">//å†™å…¥</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s == <span class="number">0</span>)</span><br><span class="line">        &#123;<span class="comment">//s == 0ä»£è¡¨å¯¹æ–¹å…³é—­,å®¢æˆ·ç«¯é€€å‡º</span></span><br><span class="line">            <span class="built_in">logging</span>(DEBUG, <span class="string">&quot;client quit: %s[%d]&quot;</span>, clientIp.<span class="built_in">c_str</span>(), clientPort);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">logging</span>(DEBUG, <span class="string">&quot;read err: %s[%d] -  %s&quot;</span>, clientIp.<span class="built_in">c_str</span>(), clientPort, <span class="built_in">strerror</span>(errno));</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(sockfd);</span><br><span class="line">    <span class="built_in">logging</span>(DEBUG,<span class="string">&quot;server quit %d&quot;</span>,sockfd);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// æœåŠ¡å‡½æ•°å¯ä»¥ä¸æš´éœ²</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">str2ascii</span><span class="params">(<span class="type">const</span> string&amp; str)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> e:str)</span><br><span class="line">        &#123;</span><br><span class="line">            ret += e;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="3-4-æä¾›æœåŠ¡ï¼ˆå­è¿›ç¨‹ï¼‰"><a href="#3-4-æä¾›æœåŠ¡ï¼ˆå­è¿›ç¨‹ï¼‰" class="headerlink" title="3.4 æä¾›æœåŠ¡ï¼ˆå­è¿›ç¨‹ï¼‰"></a>3.4 æä¾›æœåŠ¡ï¼ˆå­è¿›ç¨‹ï¼‰</h2><p>ä¸Šé¢çš„ä»£ç é‡‡ç”¨çš„æ˜¯çº¿ç¨‹æ¥æä¾›æœåŠ¡ï¼Œé™¤äº†çº¿ç¨‹ï¼Œæˆ‘ä»¬è¿˜æœ‰çˆ¶å­è¿›ç¨‹çš„æ–¹å¼ï¼Œä¹Ÿèƒ½é¿å…é˜»å¡</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œçˆ¶å­è¿›ç¨‹éƒ½éœ€è¦å…³é—­æ‰å¯¹æ–¹ä½¿ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œé¿å…å‡ºç°æ–‡ä»¶æè¿°ç¬¦åœ¨æœåŠ¡ç»“æŸåè¿˜æ²¡æœ‰å…³é—­çš„æƒ…å†µ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">pid_t</span> id = fork();</span><br><span class="line"><span class="keyword">if</span>(id == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">close</span>(_listenSock);<span class="comment">//å› ä¸ºå­è¿›ç¨‹ä¸éœ€è¦ç›‘å¬ï¼Œæ‰€ä»¥å…³é—­æ‰ç›‘å¬socket</span></span><br><span class="line">    <span class="comment">//å­è¿›ç¨‹</span></span><br><span class="line">    <span class="built_in">transService</span>(conet, senderIP, senderPort);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);<span class="comment">// æœåŠ¡ç»“æŸåï¼Œé€€å‡ºï¼Œå­è¿›ç¨‹ä¼šè¿›å…¥åƒµå°¸çŠ¶æ€ç­‰å¾…çˆ¶è¿›ç¨‹å›æ”¶</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// çˆ¶è¿›ç¨‹</span></span><br><span class="line"><span class="built_in">close</span>(conet); <span class="comment">// å› ä¸ºæ­¤æ—¶æ˜¯å­è¿›ç¨‹æä¾›æœåŠ¡ï¼Œconetä¼šæœ‰æ‹·è´ï¼Œç›¸å½“äºæœ‰ä¸¤ä¸ªè¿›ç¨‹æ‰“å¼€äº†è¯¥æ–‡ä»¶</span></span><br><span class="line"><span class="comment">// å¦‚æœçˆ¶è¿›ç¨‹ä¸å…³é—­ï¼Œå³ä¾¿å­è¿›ç¨‹ç»“æŸæœåŠ¡äº†ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦ä¹Ÿä¼šä¿æŒå¼€å¯</span></span><br><span class="line"><span class="type">pid_t</span> ret = <span class="built_in">waitpid</span>(id, <span class="literal">nullptr</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>ç›´æ¥è¿™æ ·å†™æœ‰ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯çˆ¶è¿›ç¨‹æ²¡æœ‰åŠæ³•æ­£å¸¸é‡Šæ”¾å­è¿›ç¨‹çš„èµ„æº</p><ul><li>å¦‚æœè¿›è¡Œé˜»å¡ç­‰å¾…ï¼Œé‚£å°±è¿èƒŒäº†åˆè¡·ï¼Œå®Œå…¨æ²¡æœ‰æ„ä¹‰</li><li>å¦‚æœè¿›è¡Œéé˜»å¡ç­‰å¾…ï¼Œåœ¨<code>waitpid</code>ç»“æŸä¹‹åï¼Œçˆ¶è¿›ç¨‹ç›´æ¥å»å¹²å…¶ä»–äº‹äº†ï¼Œå®Œå…¨å¿˜è®°äº†è¿™é‡Œçš„è¿™ä¸ªå­è¿›ç¨‹</li></ul><p>æ‰€ä»¥æˆ‘ä»¬è¦åšçš„ï¼Œå°±æ˜¯åœ¨å­è¿›ç¨‹é€€å‡ºï¼Œå‘<strong>çˆ¶è¿›ç¨‹å‘é€ä¿¡å·</strong>çš„æ—¶å€™å›æ”¶å­è¿›ç¨‹</p><h3 id="3-4-1-ä¿¡å·å›æ”¶"><a href="#3-4-1-ä¿¡å·å›æ”¶" class="headerlink" title="3.4.1 ä¿¡å·å›æ”¶"></a>3.4.1 ä¿¡å·å›æ”¶</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">signal(SIGCHLD, FreeChild);<span class="comment">//è‡ªå®šä¹‰æ•æ‰</span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å›æ”¶å­è¿›ç¨‹</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FreeChild</span><span class="params">(<span class="type">int</span> signo)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">assert</span>(signo == SIGCHLD);</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœæ²¡æœ‰å­è¿›ç¨‹äº†ï¼Œwaitpidå°±ä¼šè°ƒç”¨å¤±è´¥</span></span><br><span class="line">        <span class="type">pid_t</span> id = <span class="built_in">waitpid</span>(<span class="number">-1</span>, <span class="literal">nullptr</span>, WNOHANG); <span class="comment">// éé˜»å¡ç­‰å¾…</span></span><br><span class="line">        <span class="keyword">if</span> (id &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;çˆ¶è¿›ç¨‹ç­‰å¾…æˆåŠŸ, child pid: &quot;</span> &lt;&lt; id &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(id == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//è¿˜æœ‰å­è¿›ç¨‹æ²¡æœ‰é€€å‡º</span></span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;å°šæœ‰æœªé€€å‡ºçš„å­è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹ç»§ç»­è¿è¡Œ&quot;</span> &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">break</span>;<span class="comment">//é€€å‡ºç­‰å¾…å­è¿›ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;çˆ¶è¿›ç¨‹ç­‰å¾…æ‰€æœ‰å­è¿›ç¨‹ç»“æŸ&quot;</span> &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤äº†è‡ªå®šä¹‰æ•æ‰ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½®æˆignoreä¸æ­ç†å­è¿›ç¨‹ï¼Œè¿™æ ·å­è¿›ç¨‹é€€å‡ºçš„æ—¶å€™å°±ä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨é‡Šæ”¾</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">signal(SIGCHLD, SIG_IGN);</span><br></pre></td></tr></table></figure><h3 id="3-4-2-çˆ·çˆ·è¿›ç¨‹"><a href="#3-4-2-çˆ·çˆ·è¿›ç¨‹" class="headerlink" title="3.4.2 çˆ·çˆ·è¿›ç¨‹"></a>3.4.2 çˆ·çˆ·è¿›ç¨‹</h3><p>è¿™é‡Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªéªšæ“ä½œï¼Œé‚£å°±æ˜¯åœ¨åˆ›å»ºå­è¿›ç¨‹ä¹‹åï¼Œå†åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æä¾›æœåŠ¡ï¼ˆå­™å­è¿›ç¨‹ï¼‰-2</span></span><br><span class="line"><span class="type">pid_t</span> id = fork();</span><br><span class="line"><span class="keyword">if</span>(id == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">close</span>(_listenSock);<span class="comment">//å› ä¸ºå­è¿›ç¨‹ä¸éœ€è¦ç›‘å¬ï¼Œæ‰€ä»¥å…³é—­æ‰ç›‘å¬socket</span></span><br><span class="line">    <span class="comment">//åˆåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¤§äº0ä»£è¡¨æ˜¯çˆ¶è¿›ç¨‹ï¼Œå³åˆ›å»ºå®Œå­è¿›ç¨‹åçˆ¶è¿›ç¨‹ç›´æ¥é€€å‡º</span></span><br><span class="line">    <span class="keyword">if</span>(fork()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å­™å­è¿›ç¨‹æ‰§è¡Œ</span></span><br><span class="line">    <span class="built_in">transService</span>(conet, senderIP, senderPort);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);<span class="comment">// æœåŠ¡ç»“æŸåï¼Œé€€å‡ºï¼Œå­è¿›ç¨‹ä¼šè¿›å…¥åƒµå°¸çŠ¶æ€ç­‰å¾…çˆ¶è¿›ç¨‹å›æ”¶</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// çˆ·çˆ·è¿›ç¨‹</span></span><br><span class="line"><span class="built_in">close</span>(conet); </span><br><span class="line"><span class="type">pid_t</span> ret = <span class="built_in">waitpid</span>(id, <span class="literal">nullptr</span>, <span class="number">0</span>); <span class="comment">//æ­¤æ—¶å°±å¯ä»¥ç›´æ¥ç”¨é˜»å¡å¼ç­‰å¾…äº†</span></span><br><span class="line"><span class="built_in">assert</span>(ret &gt; <span class="number">0</span>);<span class="comment">//retå¦‚æœä¸å¤§äº0ï¼Œåˆ™ä»£è¡¨ç­‰å¾…å‘ç”Ÿäº†é”™è¯¯</span></span><br></pre></td></tr></table></figure><p>é‡‡ç”¨è¿™ç§åŠæ³•ä»¥åï¼Œç”±äºçˆ¶è¿›ç¨‹é€€å‡ºäº†ï¼Œ<strong>å­™å­è¿›ç¨‹ä¼šç›´æ¥è¢«æ“ä½œç³»ç»Ÿæ¥ç®¡</strong>ã€‚ä¸‹å›¾ä¸­èƒ½çœ‹åˆ°è¿™äº›è¿›ç¨‹çš„çˆ¶è¿›ç¨‹éƒ½æ˜¯<strong>1</strong>ï¼Œå³æ“ä½œç³»ç»Ÿã€‚è¿™æ—¶å€™æˆ‘ä»¬ä¹Ÿä¸éœ€è¦æ‹…å¿ƒå­è¿›ç¨‹çš„é‡Šæ”¾é—®é¢˜äº†</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e1c184403cd.png"                      alt="image-20230207111205871"                ></p><h1 id="4-å®¢æˆ·ç«¯"><a href="#4-å®¢æˆ·ç«¯" class="headerlink" title="4.å®¢æˆ·ç«¯"></a>4.å®¢æˆ·ç«¯</h1><p>å®¢æˆ·ç«¯éƒ¨åˆ†çš„ä»£ç å’Œudpä¹Ÿå¾ˆç›¸ä¼¼ï¼Œåªä¸è¿‡å°†sendtoæ”¹æˆäº†write</p><p>ä¸‹æ–¹æä¾›äº†å®¢æˆ·ç«¯çš„ä»£ç ï¼Œéƒ½å†™äº†æ³¨é‡ŠğŸ˜</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;utils.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ./clientTcp serverIp serverPort</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">3</span>)<span class="comment">//å®¢æˆ·ç«¯å¿…é¡»è¦æœ‰3ä¸ªå‚æ•°</span></span><br><span class="line">    &#123;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;Usage:\n\t&quot;</span> &lt;&lt; argv[<span class="number">0</span>] &lt;&lt; <span class="string">&quot; serverIp serverPort&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;Example:\n\t&quot;</span> &lt;&lt; argv[<span class="number">0</span>] &lt;&lt; <span class="string">&quot; 127.0.0.1 8080\n&quot;</span></span><br><span class="line">                &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">exit</span>(USAGE_ERR);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è§£ææœåŠ¡ç«¯çš„ipå’Œç«¯å£</span></span><br><span class="line">    string serverIp = argv[<span class="number">1</span>];</span><br><span class="line">    <span class="type">uint16_t</span> serverPort = <span class="built_in">atoi</span>(argv[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. åˆ›å»ºtcpçš„socket SOCK_STREAM</span></span><br><span class="line">    <span class="type">int</span> sock = <span class="built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (sock &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;socket: &quot;</span> &lt;&lt; <span class="built_in">strerror</span>(errno) &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">exit</span>(SOCKET_ERR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. connectï¼Œå‘èµ·é“¾æ¥è¯·æ±‚ï¼Œä½ æƒ³è°å‘èµ·è¯·æ±‚å‘¢ï¼Ÿï¼Ÿå½“ç„¶æ˜¯å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚å–½</span></span><br><span class="line">    <span class="comment">// 2.1 å…ˆå¡«å……éœ€è¦è¿æ¥çš„è¿œç«¯ä¸»æœºçš„åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> server;</span><br><span class="line">    <span class="built_in">memset</span>(&amp;server, <span class="number">0</span>, <span class="built_in">sizeof</span>(server));</span><br><span class="line">    server.sin_family = AF_INET;</span><br><span class="line">    server.sin_port = <span class="built_in">htons</span>(serverPort);</span><br><span class="line">    <span class="built_in">inet_aton</span>(serverIp.<span class="built_in">c_str</span>(), &amp;server.sin_addr);</span><br><span class="line">    <span class="comment">// 2.2 å‘èµ·è¯·æ±‚ï¼Œconnect ä¼šè‡ªåŠ¨bind</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">connect</span>(sock, (<span class="type">const</span> <span class="keyword">struct</span> sockaddr *)&amp;server, <span class="built_in">sizeof</span>(server)) != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;connect: &quot;</span> &lt;&lt; <span class="built_in">strerror</span>(errno) &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">exit</span>(CONN_ERR);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;connect success: &quot;</span> &lt;&lt; sock &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®¢æˆ·ç«¯å‘ç°çš„æ¶ˆæ¯</span></span><br><span class="line">    string message;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        message.<span class="built_in">clear</span>();<span class="comment">//æ¯æ¬¡å¾ªç¯å¼€å§‹ï¼Œéƒ½æ¸…ç©ºä¸€ä¸‹msg</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;è¯·è¾“å…¥ä½ çš„æ¶ˆæ¯# &quot;</span>;</span><br><span class="line">        <span class="built_in">getline</span>(cin, message);<span class="comment">//è·å–è¾“å…¥</span></span><br><span class="line">        <span class="comment">// å¦‚æœå®¢æˆ·ç«¯è¾“å…¥äº†quitï¼Œåˆ™é€€å‡º</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcasecmp</span>(message.<span class="built_in">c_str</span>(), <span class="string">&quot;quit&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="comment">// å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">ssize_t</span> s = <span class="built_in">write</span>(sock, message.<span class="built_in">c_str</span>(), message.<span class="built_in">size</span>());</span><br><span class="line">        <span class="keyword">if</span> (s &gt; <span class="number">0</span>) <span class="comment">// å†™å…¥æˆåŠŸ</span></span><br><span class="line">        &#123;</span><br><span class="line">            message.<span class="built_in">clear</span>();<span class="comment">//æ¸…ç©ºè¾“å…¥çš„æ¶ˆæ¯</span></span><br><span class="line">            message.<span class="built_in">resize</span>(BUFFER_SIZE);</span><br><span class="line">            <span class="comment">// å› ä¸ºstringçš„c_stræœ¬è´¨ä¸Šæ˜¯è¿”å›åœ°å€ï¼Œæ‰€ä»¥å¼ºè½¬åæ˜¯å¯ä»¥å¾€é‡Œé¢å†™å…¥çš„</span></span><br><span class="line">            s = <span class="built_in">read</span>(sock, (<span class="type">char</span> *)(message.<span class="built_in">c_str</span>()), BUFFER_SIZE);<span class="comment">// è·å–æœåŠ¡ç«¯çš„ç»“æœ</span></span><br><span class="line">            <span class="keyword">if</span> (s &gt; <span class="number">0</span>)<span class="comment">// è¯»å–æˆåŠŸ</span></span><br><span class="line">            &#123;</span><br><span class="line">                message[s] = <span class="string">&#x27;\0&#x27;</span>;<span class="comment">//è¿½åŠ \0</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ‰“å°è¿”å›å€¼</span></span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;Server Echo# &quot;</span> &lt;&lt; message &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s &lt;= <span class="number">0</span>) <span class="comment">// å†™å…¥å¤±è´¥</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å…³é—­æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">    <span class="built_in">close</span>(sock);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-1-è¿è¡Œæµ‹è¯•"><a href="#4-1-è¿è¡Œæµ‹è¯•" class="headerlink" title="4.1 è¿è¡Œæµ‹è¯•"></a>4.1 è¿è¡Œæµ‹è¯•</h2><p>å…ˆè¿è¡ŒæœåŠ¡ç«¯ï¼Œå†è¿è¡Œå®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è¾“å…¥åï¼ŒæœåŠ¡çŸ­ä¼šè¿”å›å­—ç¬¦ä¸²çš„asciiç æ€»å’Œ</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e1aff8cb944.png"                      alt="image-20230207095713615"                ></p><p>è€Œå®¢æˆ·ç«¯è¾“å…¥quitåï¼Œåœ¨æœåŠ¡ç«¯å¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯é€€å‡ºï¼Œä½†æœåŠ¡ç«¯å¹¶æ²¡æœ‰æ¨å‡ºï¼Œæ­£åœ¨ç­‰å¾…ä¸‹ä¸€ä¸ªè¿æ¥</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e1b0576b69f.png"                      alt="image-20230207095848863"                ></p><h1 id="5-çº¿ç¨‹æ± "><a href="#5-çº¿ç¨‹æ± " class="headerlink" title="5.çº¿ç¨‹æ± "></a>5.çº¿ç¨‹æ± </h1><p>åœ¨ä¸Šé¢çš„æ“ä½œä¸­ï¼Œæ¯æ¬¡æä¾›æœåŠ¡éƒ½éœ€è¦å½“åœºæ–°å»ºä¸€ä¸ªçº¿ç¨‹ã€‚å¯¹äºtcpè¿™ç§è¦æ±‚é«˜æ€§èƒ½çš„ç½‘ç»œæœåŠ¡å™¨è€Œè¨€ï¼Œå…¶å®æ˜¯ä¸å¤ªåˆé€‚çš„ã€‚ç†è®ºä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›è¶Šæ—©ç»™å®¢æˆ·å»ºç«‹è”ç³»è¶Šå¥½ï¼Œè€Œä¸æ˜¯é£Ÿå®¢éƒ½æ¥äº†è€æ¿æ‰å»ä¹°èœã€‚</p><p>è¿™æ—¶å€™ï¼Œå°±å¯ä»¥æŠŠæˆ‘ä»¬å†™çš„<a href="https://blog.musnow.top/2023/01/19/note_linux/22%E7%BA%BF%E7%A8%8B%E6%B1%A0/">çº¿ç¨‹æ± </a>å’ŒtcpæœåŠ¡å™¨ç»™è”ç³»èµ·æ¥ï¼</p><blockquote><p>çº¿ç¨‹æ± çš„ä»£ç è§æˆ‘çš„<a class="link"   href="https://gitee.com/musnow/raspberry-practice/tree/master/code/" >gitee<i class="fas fa-external-link-alt"></i></a>ï¼Œæ­¤å¤„åªè¯´æ˜taskç±»çš„ç¼–å†™</p></blockquote><h2 id="5-1-task"><a href="#5-1-task" class="headerlink" title="5.1 task"></a>5.1 task</h2><p>å…ˆå‰ç¼–å†™çº¿ç¨‹æ± çš„æ—¶å€™ï¼Œå°†çº¿ç¨‹æ± è¦å¤„ç†çš„ä»»åŠ¡å†™æˆäº†ä¸€ä¸ªtaskç±»ï¼Œå¹¶è§„å®šæ‰€æœ‰taskç±»éƒ½éœ€è¦æä¾›ä¸€ä¸ª<code>()æ“ä½œç¬¦é‡è½½</code>ï¼Œå³ä»¿å‡½æ•°ã€‚è¿™æ ·çº¿ç¨‹æ± å°±å¯ä»¥ä¸€è§†åŒä»çš„å¤„ç†è¿™äº›å·¥ä½œï¼Œæˆ‘ä»¬åªéœ€è¦å°†æ–°å¢çš„å·¥ä½œæ·»åŠ åˆ°çº¿ç¨‹æ± çš„ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Task</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="type">callback_t</span> = std::function&lt;<span class="built_in">void</span> (<span class="type">int</span>, std::string, <span class="type">uint16_t</span>)&gt;;<span class="comment">//ç›¸å½“äºtypedef</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Task</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="comment">// å°†éœ€è¦è°ƒç”¨çš„å‡½æ•°ä¼ å…¥ï¼Œç›¸å½“äºé€šç”¨</span></span><br><span class="line">    <span class="built_in">Task</span>(<span class="type">int</span> sockfd, <span class="type">const</span> std::string &amp;clientIP, <span class="type">uint16_t</span> clientPort,<span class="type">callback_t</span> func)</span><br><span class="line">        : _sockfd(sockfd), _ip(clientIP), _port(clientPort),_func(func)</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä»¿å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">logging</span>(DEBUG, <span class="string">&quot;TID[%p] = %s:%d START&quot;</span>,\</span><br><span class="line">            <span class="built_in">pthread_self</span>(), _ip.<span class="built_in">c_str</span>(), _port);</span><br><span class="line"></span><br><span class="line">        _func(_sockfd, _ip, _port);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">logging</span>(DEBUG, <span class="string">&quot;TID[%p] = %s:%d END  &quot;</span>,\</span><br><span class="line">            <span class="built_in">pthread_self</span>(), _ip.<span class="built_in">c_str</span>(), _port);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _sockfd;</span><br><span class="line">    std::string _ip;</span><br><span class="line">    <span class="type">uint16_t</span> _port;</span><br><span class="line">    <span class="type">callback_t</span> _func;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œæˆ‘åˆå°†taské˜Ÿåˆ—ç»™å°è£…æˆäº†ä¸€ä¸ªå¯ä»¥æ¥æ”¶å‡½æ•°æŒ‡é’ˆçš„æ–¹å¼ã€‚è¿™æ ·ä¸€æ¥ï¼Œåªè¦æˆ‘ä»¬ä»»åŠ¡çš„å‡½æ•°å‚æ•°ä¸º<code>(SOCKET,IP,PROT)</code>ï¼Œå°±èƒ½ä¼ å…¥ç»™è¿™ä¸ªtaskç±»ï¼Œè®©çº¿ç¨‹æ± æ¥è¿è¡Œ</p><h2 id="5-2-tcpServerçš„å¤„ç†"><a href="#5-2-tcpServerçš„å¤„ç†" class="headerlink" title="5.2 tcpServerçš„å¤„ç†"></a>5.2 tcpServerçš„å¤„ç†</h2><p>å› ä¸ºéœ€è¦çº¿ç¨‹æ± ï¼Œæˆ‘ä»¬åœ¨tcpserverä¸­æ·»åŠ ä¸€ä¸ªçº¿ç¨‹æ± çš„æŒ‡é’ˆï¼Œé€šè¿‡çº¿ç¨‹æ± çš„ç±»åæ¥è·å–å•ä¾‹ï¼Œèµ‹å€¼ç»™æˆå‘˜å˜é‡ã€‚å¹¶è®©è·å–åˆ°çš„å•ä¾‹çº¿ç¨‹æ± å¼€å§‹è¿è¡Œ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4.è·å–çº¿ç¨‹æ±  å•ä¾‹</span></span><br><span class="line">_tpool = ThreadPool&lt;Task&gt;::<span class="built_in">getInstance</span>(<span class="number">4</span>);</span><br><span class="line">_tpool-&gt;<span class="built_in">start</span>();<span class="comment">//å¼€å§‹è¿è¡Œ</span></span><br></pre></td></tr></table></figure><p>åœ¨<code>start</code>å‡½æ•°ä¸­ï¼Œåˆ™å°†ä¹‹å‰çš„ä»»åŠ¡å‡½æ•°å®ä¾‹åŒ–ä¸ºä¸€ä¸ªtaskï¼Œå¹¶å°†å…¶pushåˆ°çº¿ç¨‹æ± çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æä¾›æœåŠ¡ï¼ˆé€šè¿‡çº¿ç¨‹æ± ï¼‰</span></span><br><span class="line"><span class="function">Task <span class="title">t</span><span class="params">(conet,senderIP,senderPort,transService)</span></span>;</span><br><span class="line">_tpool-&gt;<span class="built_in">push</span>(t);</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œå°±èƒ½é€šè¿‡çº¿ç¨‹æ± æ¥æä¾›æœåŠ¡äº†ï¼</p><h2 id="5-3-è¿è¡Œæµ‹è¯•"><a href="#5-3-è¿è¡Œæµ‹è¯•" class="headerlink" title="5.3 è¿è¡Œæµ‹è¯•"></a>5.3 è¿è¡Œæµ‹è¯•</h2><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„çº¿ç¨‹æ± æ­£ç¡®è¿è¡Œäº†ä»»åŠ¡ï¼Œç»™å®¢æˆ·ç«¯æä¾›äº†asciiè¿”å›å€¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e44fa8f139b.png"                      alt="image-20230209094304860"                ></p><p>ä½¿ç”¨<code>ps -aL</code>å‘½ä»¤æŸ¥çœ‹è½»é‡çº§è¿›ç¨‹ï¼Œå¯ä»¥çœ‹åˆ°æœ‰4ä¸ªçº¿ç¨‹åœ¨ä¸ºæˆ‘ä»¬æœåŠ¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> PID   LWP TTY          TIME CMD</span><br><span class="line">7288  7288 pts/8    00:00:00 tcpServer</span><br><span class="line">7288  7289 pts/8    00:00:00 handler</span><br><span class="line">7288  7290 pts/8    00:00:00 handler</span><br><span class="line">7288  7291 pts/8    00:00:00 handler</span><br><span class="line">7288  7292 pts/8    00:00:00 handler</span><br><span class="line">7441  7441 pts/9    00:00:00 tcpClient</span><br><span class="line">7632  7632 pts/7    00:00:00 ps</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œå³ä¾¿æˆ‘ä»¬å¤šå¼€å‡ ä¸ªç»ˆç«¯ï¼ŒtcpæœåŠ¡å™¨ä¹Ÿèƒ½æ­£å¸¸æä¾›æœåŠ¡</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e4507c8c76f.png"                      alt="image-20230209094632613"                ></p><p>ä½†æ˜¯ï¼å¦‚æœå‡ºç°äº†ä¸€ä¸ªå°´å°¬çš„æƒ…å†µï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹&lt;å½“å‰éœ€è¦è¿æ¥çš„å®¢æˆ·ç«¯æ•°é‡ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p><h2 id="5-4-taskç­‰å¾…é—®é¢˜"><a href="#5-4-taskç­‰å¾…é—®é¢˜" class="headerlink" title="5.4 taskç­‰å¾…é—®é¢˜"></a>5.4 taskç­‰å¾…é—®é¢˜</h2><p>ä¸ºäº†æµ‹è¯•ï¼Œæˆ‘ä»¬å°†çº¿ç¨‹æ± å•ä¾‹ä¸­çš„çº¿ç¨‹ä¸ªæ•°åˆå§‹åŒ–ä¸º2ä¸ª</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e450bd253f3.png"                      alt="image-20230209094741651"                ></p><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å‘ç°ç¬¬ä¸‰ä¸ªå®¢æˆ·ç«¯ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œä½†å®é™…ä¸Šå®ƒå·²ç»æˆåŠŸé“¾æ¥ä¸Šäº†æœåŠ¡å™¨ï¼Œtaskä¹Ÿè¢«æ’å…¥åˆ°äº†ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢ï¼Œ<strong>åªä¸è¿‡å½“å‰æ²¡æœ‰ç©ºé—²çš„çº¿ç¨‹æ¥è¿è¡Œå®ƒ</strong></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e451f2d5c8f.png"                      alt="image-20230209095249694"                ></p><p>å¦‚æœæˆ‘ä»¬æŠŠå·¦ä¾§å…¶ä¸­ä¸€ä¸ªå®¢æˆ·ç«¯é€€å‡ºï¼Œæœ€å³ä¾§çš„å®¢æˆ·ç«¯å°±èƒ½æ­£å¸¸æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„ç»“æœäº†</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e452570e754.png"                      alt="image-20230209095429982"                ></p><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦è®©çº¿ç¨‹æ± æœ‰èƒ½åŠ›åˆ¤æ–­æ˜¯å¦å‡ºç°äº†é˜»å¡é—®é¢˜ï¼Œå¹¶æ‰©å®¹çº¿ç¨‹æ¥è§£å†³é˜»å¡ã€‚</p><p>å¯æ˜¯è¿™åˆå¼•å‡ºäº†å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœç©ºé—²äº†å¾ˆä¹…éƒ½æ²¡æœ‰ä»»åŠ¡è¿‡æ¥ï¼Œå¤šå‡ºæ¥çš„çº¿ç¨‹ä¸å°±æ˜¯åœ¨ç™½ç™½æ¶ˆè€—èµ„æºå—ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œçº¿ç¨‹æ± é€‚åˆå¤„ç†çš„ï¼Œåº”è¯¥æ˜¯<strong>çŸ­å°çš„ä»»åŠ¡</strong>ï¼Œè€Œä¸æ˜¯ä¸€ä¸ª<code>while(1)</code>å¾ªç¯ï¼›</p><blockquote><p>ä½†æ˜¯æˆ‘è¿˜æ²¡æœ‰å­¦ä¹ åˆ°å¦‚ä½•å°†å…¶ä¿®æ”¹ä¸ºæœåŠ¡äºçŸ­å°ä»»åŠ¡çš„çº¿ç¨‹æ± ï¼Œä»å¾…åç»­çš„ç²¾è¿›</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä»Šå¤©è®©æˆ‘ä»¬æ¥å†™ä¸€ä¸ªtcpçš„æœåŠ¡å™¨&amp;#x2F;å®¢æˆ·ç«¯ä»£ç &lt;/p&gt;</summary>
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="çº¿ç¨‹" scheme="https://blog.musnow.top/tags/%E7%BA%BF%E7%A8%8B/"/>
    
    <category term="ç½‘ç»œ" scheme="https://blog.musnow.top/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>ã€Pythonã€‘è‡ªåŠ¨è§£æmarkdownä¸­çš„å›¾ç‰‡å¹¶ä¿å­˜</title>
    <link href="https://blog.musnow.top/2023/02/04/note_Python/8python%E8%87%AA%E5%8A%A8%E5%8C%96%E4%B8%8B%E8%BD%BDmd%E6%96%87%E4%BB%B6%E4%B8%AD%E5%9B%BE%E7%89%87/"/>
    <id>https://blog.musnow.top/2023/02/04/note_Python/8python%E8%87%AA%E5%8A%A8%E5%8C%96%E4%B8%8B%E8%BD%BDmd%E6%96%87%E4%BB%B6%E4%B8%AD%E5%9B%BE%E7%89%87/</id>
    <published>2023-02-04T00:19:00.000Z</published>
    <updated>2023-02-08T11:10:23.695Z</updated>
    
    <content type="html"><![CDATA[<p>pythonè‡ªåŠ¨åŒ–ä¸‹è½½&#x2F;ä¸Šä¼ mdä¸­å›¾ç‰‡å®åœ¨æ˜¯å¤ªæ–¹ä¾¿äº†</p><span id="more"></span><h1 id="1-èµ·å› "><a href="#1-èµ·å› " class="headerlink" title="1.èµ·å› "></a>1.èµ·å› </h1><p>ä¸ºä»€ä¹ˆéœ€è¦pythonæ¥ä¸‹è½½mdé‡Œé¢çš„å›¾ç‰‡ï¼ŸåŸå› å¾ˆç®€å•ï¼Œé‚£å°±æ˜¯éœ€è¦æŠŠå›¾ç‰‡ä¿å­˜ä¸‹æ¥ï¼Œä¸Šä¼ åˆ°ç¬¬äºŒä¸ªå›¾åºŠï¼ˆè¿ç§»ï¼‰</p><p>å¯¹äºé˜¿é‡Œäº‘OSSæ¥è¯´ï¼Œæœ‰ä¸¤ç§è¿ç§»åŠæ³•</p><ul><li>ä½¿ç”¨å®˜æ–¹çš„æ•°æ®å¯¼å‡ºåŠŸèƒ½</li><li>ä½¿ç”¨apiæ¥å£éå†ossç›®å½•ä¸‹è½½æ‰€æœ‰å›¾ç‰‡</li></ul><p>è¿™ä¸¤ç§åŠæ³•éƒ½ä¸æ˜¯é‚£ä¹ˆæ–¹ä¾¿ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©äº†ç¬¬ä¸‰ç§</p><ul><li>è§£ææœ¬åœ°mdæ–‡ä»¶ä¸­çš„img urlï¼Œä¸‹è½½å›¾ç‰‡å¹¶ä¿å­˜åˆ°æœ¬åœ°</li></ul><p>é‚£è¦æ€ä¹ˆåšå‘¢ï¼ŸğŸ‘‡</p><h1 id="2-æ•™ç¨‹"><a href="#2-æ•™ç¨‹" class="headerlink" title="2.æ•™ç¨‹"></a>2.æ•™ç¨‹</h1><p>æˆ‘åœ¨githubæ‰¾åˆ°äº†è¿™ä¸ªé¡¹ç›® ğŸ‘‰ <a class="link"   href="https://github.com/Deali-Axy/Markdown-Image-Parser" >Deali-Axy&#x2F;Markdown-Image-Parser<i class="fas fa-external-link-alt"></i></a></p><p>ä½œè€…çš„ä»£ç å†™çš„å¾ˆæ£’ï¼Œä½†æ˜¯READMEé‡Œé¢å´å°‘äº†ä¸€ä¸ªé‡è¦çš„å¯åŠ¨æ•™ç¨‹ï¼Œé‚£å°±æ˜¯ä½ éœ€è¦åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code>files</code>æ–‡ä»¶å¤¹ï¼ˆmdæ–‡ä»¶æ”¾åˆ°è¿™é‡Œé¢ï¼‰ï¼Œå¯¹åº”å¯åŠ¨é¡¹é‡Œé¢å¼€å¯çš„æ ¹ç›®å½•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    files_list = get_files_list(os.path.abspath(os.path.join(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;files&#x27;</span>)))</span><br></pre></td></tr></table></figure><p>éšåï¼Œæ‰§è¡Œ<code>python spider.py</code>ï¼Œå¼€å§‹è¿è¡Œï¼Œè„šæœ¬ä¼šè‡ªåŠ¨å°†mdè½¬æˆhtmlå¹¶ä¸‹è½½å›¾ç‰‡</p><p>æˆ‘å°†ä½œè€…çš„ä»£ç è¿›ä¸€æ­¥ç»†åŒ–ï¼Œå¹¶ä¿®æ”¹äº†ä¸€éƒ¨åˆ†bugğŸ‘‡å»ºè®®ä½¿ç”¨æˆ‘forkçš„ç‰ˆæœ¬</p><p><a class="link"   href="https://github.com/musnows/Markdown-Image-Parser" >https://github.com/musnows/Markdown-Image-Parser<i class="fas fa-external-link-alt"></i></a></p><h2 id="2-1-UnicodeDecodeError"><a href="#2-1-UnicodeDecodeError" class="headerlink" title="2.1 UnicodeDecodeError"></a>2.1 UnicodeDecodeError</h2><p>åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°è¿™ä¸ªæŠ¥é”™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UnicodeDecodeError: &#x27;utf-8&#x27; codec can&#x27;t decode byte 0xbc in position 2: invalid start byt</span><br></pre></td></tr></table></figure><p>è§£å†³åŠæ³•å‚è€ƒ ğŸ‘‰ <a class="link"   href="https://blog.csdn.net/sunflower_sara/article/details/103957385" >ç‚¹æˆ‘<i class="fas fa-external-link-alt"></i></a></p><p>è§£å†³åŠæ³•æ˜¯å°†æ‰“å¼€æ–‡ä»¶ç¼–ç çš„<code>utf-8</code> ä¿®æ”¹æˆ<code>ISO-8859-1</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(file, encoding=<span class="string">&#x27;ISO-8859-1&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">           md_content = f.read()</span><br></pre></td></tr></table></figure><h2 id="2-2-request-failed"><a href="#2-2-request-failed" class="headerlink" title="2.2 request failed"></a>2.2 request failed</h2><p>å› ä¸ºä½œè€…å¹¶æ²¡æœ‰å†™åˆ¤æ–­ï¼Œæ­¤æ—¶å°±ä¼šå‡ºç°ä¸€ä¸ªä¸¥é‡é—®é¢˜ï¼šæœ¬åœ°å›¾ç‰‡ä¹Ÿä¼šè¿›è¡Œ<code>requests</code>è¯·æ±‚</p><p>æ¯”å¦‚æˆ‘çš„mdé‡Œé¢å°±æœ‰ä¸€äº›å›¾ç‰‡æ˜¯æœ¬åœ°çš„<code>img/å›¾ç‰‡æ–‡ä»¶å</code>ï¼Œè¿™ä¸ªä»£ç ä¾æ—§å¯¹è¿™ä¸ªè·¯å¾„å½“åšç½‘ç»œè·¯å¾„è¿›è¡Œè¯·æ±‚ï¼Œäºæ˜¯å°±å‡ºç°äº†æŠ¥é”™</p><p>æ‰€ä»¥å°±éœ€è¦åœ¨<code>download_pics</code>å‡½æ•°ä¸­å¯¹urlè¿›è¡Œåˆ¤æ–­ï¼Œè¿™é‡Œå¯ä»¥å†™æˆä¸‹é¢çš„æ ¼å¼ï¼ˆå› ä¸ºæˆ‘çŸ¥é“æˆ‘çš„é˜¿é‡Œäº‘OSSé“¾æ¥é‡Œé¢ä¸åŒ…å«<code>img</code>æ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥<code>img/</code>çš„å›¾ç‰‡æ˜¯æœ¬åœ°æ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">download_pics</span>(<span class="params">url, file,MDfilename</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;img/&#x27;</span> <span class="keyword">in</span> url:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;ä¸å¤„ç†æœ¬åœ°å›¾ç‰‡: &#x27;</span>, url)</span><br><span class="line">        <span class="keyword">return</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·å…¶å®è¿˜æ˜¯æœ‰ç‚¹å‘†å‘†çš„ï¼Œæˆ‘ä»¬ç›´æ¥åˆ¤æ–­httpåœ¨ä¸åœ¨é‡Œé¢ä¸å°±çŸ¥é“æ˜¯ä¸æ˜¯ç½‘ç»œå›¾ç‰‡äº†ğŸ˜‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">download_pics</span>(<span class="params">url, file,MDfilename</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;http&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> url:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;ä¸å¤„ç†æœ¬åœ°å›¾ç‰‡: &#x27;</span>, url)</span><br><span class="line">        <span class="keyword">return</span></span><br></pre></td></tr></table></figure><h2 id="2-3-å›¾ç‰‡ä¿å­˜è·¯å¾„"><a href="#2-3-å›¾ç‰‡ä¿å­˜è·¯å¾„" class="headerlink" title="2.3 å›¾ç‰‡ä¿å­˜è·¯å¾„"></a>2.3 å›¾ç‰‡ä¿å­˜è·¯å¾„</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå›¾ç‰‡ä¼šä¿å­˜åˆ°å­æ–‡ä»¶å¤¹ä¸‹çš„markdownæ–‡ä»¶åç›®å½•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">targer_dir = os.path.join(dirname,assert_dir)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(targer_dir):</span><br><span class="line">     os.mkdir(targer_dir)</span><br></pre></td></tr></table></figure><p>è¿™æ ·å…¶å®éå¸¸éå¸¸ä¸æ–¹ä¾¿ç®¡ç†ï¼Œ<strong>æœ‰å‡ ä¸ªmdæ–‡æ¡£å°±æœ‰å‡ ä¸ªmdå›¾ç‰‡è·¯å¾„</strong>ï¼Œå¯å¤ªéš¾å—äº†</p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ³¨é‡Šæ‰è¿™éƒ¨åˆ†ä»£ç ï¼Œç›´æ¥é€‰æ‹©ä¸€ä¸ªæ ¹ç›®å½•è¿›è¡Œå›¾ç‰‡çš„ä¿å­˜</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">targer_dir =<span class="string">&#x27;./files/img/&#x27;</span> <span class="comment"># æ‰€æœ‰å›¾ç‰‡éƒ½ä¿å­˜åˆ° ./files/img/ æ–‡ä»¶å¤¹é‡Œé¢</span></span><br></pre></td></tr></table></figure><h2 id="2-4-try-x2F-except"><a href="#2-4-try-x2F-except" class="headerlink" title="2.4 try&#x2F;except"></a>2.4 try&#x2F;except</h2><p>ä½œè€…ä»£ç é‡Œé¢çš„æœ€æœ€æœ€å¤§æ¼æ´ï¼Œé‚£å°±æ˜¯æ²¡æœ‰å¯¹forå¾ªç¯é‡Œé¢çš„è¯·æ±‚è¿›è¡Œ<code>try/except</code></p><p>è¿™æ ·å°±ä¼šå¯¼è‡´ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå›¾ç‰‡è¯·æ±‚å¤±è´¥ï¼Œæ•´ä¸ª<strong>è¿›ç¨‹ä¼šç›´æ¥ç»ˆæ­¢</strong>ï¼</p><p>é‚£ä¹ˆé—®é¢˜å°±æ¥äº†ï¼Œå³ä¾¿è¿™ä¸ªç¨‹åºä¼šåœ¨éå†çš„æ—¶å€™æ‰“å°å½“å‰å¤„ç†çš„æ–‡ä»¶åå­—ï¼Œä½†è¿™éœ€è¦ç”¨æˆ·å»ç¿»å‘½ä»¤è¡Œè¾“å‡ºï¼Œå†æ‰¾åˆ°åˆ°åº•æ˜¯å“ªä¸€ä¸ªå›¾ç‰‡å‘ç”Ÿé”™è¯¯ï¼Œéå¸¸éå¸¸éå¸¸éš¾å—ï¼</p><p>å¦‚æœé‡æ–°æ‰§è¡Œï¼Œé‚£å°±ç›¸å½“ä¸æŠŠå·²ç»ä¸‹å¥½çš„å›¾ç‰‡åˆé‡ä¸‹ä¸€éï¼Œæµªè´¹OSSçš„æµé‡ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¿…é¡»è¦ç»™forå¾ªç¯å†…éƒ¨æ·»åŠ ä¸Šå¼‚å¸¸æ•è·ï¼Œå¦‚æœé‡åˆ°é”™è¯¯ï¼Œ<strong>å°±å°†è¿™ä¸ªå›¾ç‰‡çš„urlå­˜ä¸‹æ¥</strong>ï¼Œç»§ç»­å¾€åæ‰§è¡Œï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> files_list:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;æ­£åœ¨å¤„ç†ï¼š<span class="subst">&#123;file&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file, encoding=<span class="string">&#x27;ISO-8859-1&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        md_content = f.read()</span><br><span class="line"></span><br><span class="line">    pics_list = get_pics_list(md_content)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;å‘ç°å›¾ç‰‡ <span class="subst">&#123;<span class="built_in">len</span>(pics_list)&#125;</span> å¼ &#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> index, pic <span class="keyword">in</span> <span class="built_in">enumerate</span>(pics_list):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;æ­£åœ¨ä¸‹è½½ç¬¬ <span class="subst">&#123;index + <span class="number">1</span>&#125;</span> å¼ å›¾ç‰‡...&#x27;</span>)</span><br><span class="line">            MDfilename = os.path.basename(file) <span class="comment"># å½“å‰å¤„ç†çš„mdæ–‡ä»¶çš„åå­—</span></span><br><span class="line">            download_pics(pic, file,MDfilename)</span><br><span class="line">            time.sleep(<span class="number">0.5</span>) <span class="comment"># é¿å…ä¸‹è½½è¶…é€Ÿ</span></span><br><span class="line">        <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">            os.abort()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(traceback.format_exc())</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> MDfilename <span class="keyword">not</span> <span class="keyword">in</span> err_img:</span><br><span class="line">                err_img[MDfilename]=[]</span><br><span class="line">            <span class="comment"># æ·»åŠ å›¾ç‰‡</span></span><br><span class="line">            err_img[MDfilename].append(pic)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;å›¾ç‰‡è·å–é”™è¯¯ï¼š&quot;</span>,pic)</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;å¤„ç†å®Œæˆã€‚&#x27;</span>)</span><br><span class="line">write_file(<span class="string">&#x27;err.json&#x27;</span>,err_img)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;å†™å…¥errå®Œæˆ&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç è§æˆ‘çš„githubä»“åº“</p><h2 id="2-5-ä¸Šä¼ åˆ°lskyå›¾åºŠ"><a href="#2-5-ä¸Šä¼ åˆ°lskyå›¾åºŠ" class="headerlink" title="2.5 ä¸Šä¼ åˆ°lskyå›¾åºŠ"></a>2.5 ä¸Šä¼ åˆ°lskyå›¾åºŠ</h2><p>ç°åœ¨æˆ‘è¦è¿ç§»çš„å›¾åºŠæ˜¯lskyï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿ï¼Œå¯ä»¥åœ¨å°†å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°çš„åŒæ—¶ï¼Œå°†å›¾ç‰‡ä¸Šä¼ åˆ°lskyå›¾åºŠ</p><p>æ³¨æ„ï¼Œä¸Šä¼ ä¹‹å‰ï¼Œè¯·åœ¨<strong>ç”¨æˆ·ç»„</strong>å°†å›¾ç‰‡ä¸Šä¼ çš„æ ¼å¼æ”¹ä¸ºåŸå§‹æ–‡ä»¶å‘½åï¼Œå¦åˆ™é‡å‘½åäº†é‚£å°±ä»€ä¹ˆéƒ½æ²¡äº†ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/202302040839352.png"                      alt="image-20230204083922313"                ></p><blockquote><p>è¿˜å‘ç°äº†ä¸€ä¸ªç¦»è°±çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯ä¸€äº›å›¾ç‰‡ä¸Šä¼ äº†ä¹‹åï¼Œlskyè¿˜æ˜¯ä¼šç»™ä»–æ”¹åå­—ï¼ï¼ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/202302040840449.png"                      alt="image-20230204084005425"                ></p><p>æ¯”å¦‚è¿™ä¸ªgifï¼Œä»–çš„alté‡Œé¢æ˜¯åŸå§‹åå­—ï¼Œä½†æ˜¯urlå¹¶ä¸æ˜¯ï¼ï¼ï¼ä½ è¯´è¿™ç¦»è°±ä¸</p><p>è§£å†³æ–¹æ³•é‚£å°±æ˜¯æŠŠæœ¬åœ°çš„å›¾ç‰‡æ‰“ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œä¼ åˆ°äº‘æœåŠ¡å™¨åå°å­˜å‚¨è·¯å¾„ä¸­è¦†ç›–ä¸€éï¼ŒæŠŠæ²¡æœ‰çš„å›¾ç‰‡ç»™æ·»åŠ ä¸Š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip -o ~/docker/img.zip -d ~/docker/lsky/storage/app/uploads/23/02</span><br></pre></td></tr></table></figure></blockquote><p>ä¸Šä¼ ä¹‹å‰ï¼Œå…ˆè·å–token</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">lsky</span>():</span><br><span class="line">    url = <span class="string">&quot;æœåŠ¡å™¨åœ°å€/api/v1/tokens&quot;</span></span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&#x27;email&#x27;</span>:<span class="string">&#x27;è´¦æˆ·é‚®ç®±&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;å¯†ç &#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res = requests.post(url,  params=params)  <span class="comment"># è¯·æ±‚api</span></span><br><span class="line">    <span class="keyword">return</span> res.json()</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;status&#x27;: True, &#x27;message&#x27;: &#x27;success&#x27;, &#x27;data&#x27;: &#123;&#x27;token&#x27;: &#x27;è¿™é‡Œä¼šè¿”å›token&#x27;&#125;&#125;</span><br></pre></td></tr></table></figure><p>éšåæ˜¯ä¸Šä¼ çš„ä»£ç ï¼Œæ³¨æ„å…°ç©ºå¿…é¡»è¦ç”¨<code>open &#39;rb&#39;</code>é‡æ–°æ‰“å¼€ä¸€è¾¹å›¾ç‰‡ï¼Œæ‰€ä»¥å‚æ•°ç»™<code>img_path</code>ä¹Ÿå°±æ˜¯å›¾ç‰‡çš„è·¯å¾„å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…°ç©ºå›¾åºŠ</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lsky_upload</span>(<span class="params">img_path:<span class="built_in">str</span></span>):</span><br><span class="line">    url = <span class="string">&quot;ä½ çš„å…°ç©ºå›¾åºŠæœåŠ¡å™¨/api/v1/upload&quot;</span></span><br><span class="line">    header = &#123;</span><br><span class="line">        <span class="string">&quot;Authorization&quot;</span>: <span class="string">&quot;Bearer ä½ çš„å…°ç©ºtoken&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    img = <span class="built_in">open</span>(img_path, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">    params = &#123;<span class="string">&#x27;strategy_id&#x27;</span>: <span class="number">1</span>&#125;</span><br><span class="line">    myfiles = &#123;<span class="string">&#x27;file&#x27;</span>: img&#125;</span><br><span class="line">    res = requests.post(url, headers=header, params=params,</span><br><span class="line">                        files=myfiles)  <span class="comment"># è¯·æ±‚api</span></span><br><span class="line">    <span class="keyword">return</span> res.json()</span><br></pre></td></tr></table></figure><p>åœ¨<code>download_pics</code>çš„æœ«å°¾æ·»åŠ å¦‚ä¸‹ä»£ç ï¼Œå¹¶å¯¹å…°ç©ºå›¾åºŠçš„è¿”å›å€¼è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœä¸Šä¼ é”™è¯¯ï¼ŒåŒæ ·æ·»åŠ åˆ°é”™è¯¯å›¾ç‰‡ä¸­ï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸Šä¼ lsky</span></span><br><span class="line">res = lsky_upload(img_path=<span class="string">f&quot;<span class="subst">&#123;targer_dir&#125;</span>/<span class="subst">&#123;filename&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> res[<span class="string">&#x27;status&#x27;</span>]:</span><br><span class="line">    <span class="keyword">global</span> err_img</span><br><span class="line">    <span class="keyword">if</span> MDfilename <span class="keyword">not</span> <span class="keyword">in</span> err_img:</span><br><span class="line">        err_img[MDfilename]=[]</span><br><span class="line">     </span><br><span class="line">    err_img[MDfilename].append(url)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å…°ç©ºä¸Šä¼ é”™è¯¯ï¼&quot;</span>,url)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ æˆåŠŸçš„è¿”å›å€¼statusæ˜¯True</p><h1 id="3-å¼€å§‹è‡ªåŠ¨åŒ–ä¸Šä¼ "><a href="#3-å¼€å§‹è‡ªåŠ¨åŒ–ä¸Šä¼ " class="headerlink" title="3.å¼€å§‹è‡ªåŠ¨åŒ–ä¸Šä¼ "></a>3.å¼€å§‹è‡ªåŠ¨åŒ–ä¸Šä¼ </h1><p>å°†ä¸Šé¢çš„bugä¿®æ”¹å¥½äº†ä¹‹åï¼Œå°±å¯ä»¥æ­£å¼è¿è¡Œï¼Œåœ¨ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°çš„åŒæ—¶ï¼Œä¸Šä¼ åˆ°å…°ç©ºå›¾åºŠäº†ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/202302040801036.png"                      alt="image-20230204074327382"                ></p><p>å›¾ç‰‡ä¹Ÿéƒ½æˆåŠŸä¿å­˜åˆ°æœ¬åœ°äº†</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63e383010349e.png"                      alt="image-20230208190951728"                ></p><p>ä¸Šä¼ å®Œæ¯•ä¹‹åï¼Œä¹Ÿèƒ½åœ¨erré‡Œé¢çœ‹åˆ°é”™è¯¯çš„å›¾ç‰‡è·¯å¾„ï¼Œä»¥ä¾¿é‡æ–°å¤„ç†ã€‚</p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œé¢æœ‰ä¸€éƒ¨åˆ†æ˜¯giteeå’Œcsdnçš„é“¾æ¥ï¼Œè¿™äº›å›¾ç‰‡æœ‰<strong>é˜²ç›—é“¾</strong>ï¼Œè€Œä¸”å›¾ç‰‡å°¾éƒ¨æ·»åŠ äº†å…¶ä»–å­—æ®µï¼Œå¯¼è‡´lskyæ²¡æœ‰åŠæ³•å°†å…¶è¯†åˆ«ä¸ºå›¾ç‰‡ï¼ˆå´å°‘å›¾ç‰‡æ ¼å¼åç¼€ï¼‰</p><p>ä¸è¿‡æˆ‘çš„ç›®æ ‡æ˜¯å°†<strong>é˜¿é‡Œäº‘OSSçš„å›¾ç‰‡è½¬åˆ°lsky</strong>ï¼Œè¿™äº›æœ¬æ¥å°±ä¸æ˜¯é˜¿é‡Œäº‘OSSçš„å›¾ç‰‡å’Œæˆ‘çš„ç›®çš„æ— å…³ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/202302040801756.png"                      alt="image-20230204080115678"                ></p><p>åšå®Œè¿™ä¸€åˆ‡ï¼Œæœ€è®©æˆ‘æ„Ÿæ…¨çš„æ˜¯ï¼Œæˆ‘çš„é˜¿é‡Œäº‘ossé‡Œé¢æœ‰1gçš„å›¾ç‰‡ï¼Œå®é™…ç”¨çš„å´åªæœ‰ä¸‹é¢è¿™ä¸€ä¸¢ä¸¢ï¼›å…¶ä»–ä¼°è®¡éƒ½æ˜¯é‡å¤ä¸Šä¼ çš„</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/63ddaea630477.png"                      alt="image-20230204085611110"                ></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;pythonè‡ªåŠ¨åŒ–ä¸‹è½½&amp;#x2F;ä¸Šä¼ mdä¸­å›¾ç‰‡å®åœ¨æ˜¯å¤ªæ–¹ä¾¿äº†&lt;/p&gt;</summary>
    
    
    
    <category term="é€Ÿé€šPython" scheme="https://blog.musnow.top/categories/%E9%80%9F%E9%80%9APython/"/>
    
    
    <category term="å›¾åºŠ" scheme="https://blog.musnow.top/tags/%E5%9B%BE%E5%BA%8A/"/>
    
    <category term="Python" scheme="https://blog.musnow.top/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>ã€Dockerã€‘é…ç½®wiki js</title>
    <link href="https://blog.musnow.top/2023/02/02/docker/7docker%E9%83%A8%E7%BD%B2wikijs/"/>
    <id>https://blog.musnow.top/2023/02/02/docker/7docker%E9%83%A8%E7%BD%B2wikijs/</id>
    <published>2023-02-02T09:45:33.000Z</published>
    <updated>2023-02-05T08:15:19.819Z</updated>
    
    <content type="html"><![CDATA[<p>wikijsæ˜¯ä¸€ä¸ªåœ¨çº¿å¤šäººåä½œï¼ˆå¸¦gitç‰ˆæœ¬ç®¡ç†ï¼‰çš„wikiå¥—ä»¶</p><span id="more"></span><p>ç›¸æ¯”äºå…¶ä»–wikiçš„å±•ç¤ºåŠŸèƒ½ä¸ºä¸»ï¼Œwikijså°†æƒé™ç®¡ç†+å¤šäººåä½œä½œä¸ºäº†é¦–ä¸ªè¦ç´ ï¼Œå…¶æ”¯æŒå¯Œæ–‡æœ¬ç¼–è¾‘å™¨&#x2F;mardownç¼–è¾‘å™¨&#x2F;htmlæºç ç¼–è¾‘</p><h1 id="1-Docker-cliéƒ¨ç½²"><a href="#1-Docker-cliéƒ¨ç½²" class="headerlink" title="1.Docker-cliéƒ¨ç½²"></a>1.Docker-cliéƒ¨ç½²</h1><blockquote><p>åœ¨äº‘æœåŠ¡å™¨å®‰è£… <a class="link"   href="https://docs.requarks.io/install/ubuntu" >https://docs.requarks.io/install/ubuntu<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>å¯ä»¥è·Ÿç€å®˜æ–¹çš„æŒ‡ä»¤èµ°ï¼Œä¸‹é¢èŠ‚é€‰äº†æœ€ç»ˆ3ä¸ªåˆ›å»ºå®¹å™¨çš„å‘½ä»¤</p><hr><p>é…ç½®å¯†é’¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/wiki</span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate DB secret</span></span><br><span class="line">openssl rand -<span class="built_in">base64</span> 32 &gt; /etc/wiki/.db-secret</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create internal docker network</span></span><br><span class="line">docker network create wikinet</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create data volume for PostgreSQL</span></span><br><span class="line">docker volume create pgdata</span><br></pre></td></tr></table></figure><p>é…ç½®æ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker create \</span><br><span class="line">--name=db \</span><br><span class="line">-e POSTGRES_DB=wiki \</span><br><span class="line">-e POSTGRES_USER=wiki \</span><br><span class="line">-e POSTGRES_PASSWORD_FILE=/etc/wiki/.db-secret \</span><br><span class="line">-v /etc/wiki/.db-secret:/etc/wiki/.db-secret:ro \</span><br><span class="line">-v pgdata:/var/lib/postgresql/data \</span><br><span class="line">--restart=unless-stopped \</span><br><span class="line">-h db \</span><br><span class="line">--network=wikinet \</span><br><span class="line">postgres:11</span><br></pre></td></tr></table></figure><p>é…ç½®ä¸»å®¹å™¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker create --name=wiki \</span><br><span class="line">-e DB_TYPE=postgres \</span><br><span class="line">-e DB_HOST=db \</span><br><span class="line">-e DB_PORT=5432 \</span><br><span class="line">-e DB_PASS_FILE=/etc/wiki/.db-secret \</span><br><span class="line">-v /etc/wiki/.db-secret:/etc/wiki/.db-secret:ro \</span><br><span class="line">-e DB_USER=wiki \</span><br><span class="line">-e DB_NAME=wiki \</span><br><span class="line">-e UPGRADE_COMPANION=1 \</span><br><span class="line">--restart=unless-stopped \</span><br><span class="line">-h wiki \</span><br><span class="line">--network=wikinet \</span><br><span class="line">-p 3000:3000 -p 3443:3443 \</span><br><span class="line">ghcr.io/requarks/wiki:2</span><br></pre></td></tr></table></figure><p>å‡çº§ä¼´ä¾£</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker create \</span><br><span class="line">--name=wiki-update-companion \</span><br><span class="line">-v /var/run/docker.sock:/var/run/docker.sock:ro \</span><br><span class="line">--restart=unless-stopped \</span><br><span class="line">-h wiki-update-companion \</span><br><span class="line">--network=wikinet \</span><br><span class="line">ghcr.io/requarks/wiki-update-companion:latest</span><br></pre></td></tr></table></figure><p>é…ç½®é˜²ç«å¢™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow ssh</span><br><span class="line">sudo ufw allow http</span><br><span class="line">sudo ufw allow https</span><br><span class="line"></span><br><span class="line">sudo ufw --force enable</span><br></pre></td></tr></table></figure><p>è¿è¡Œå®¹å™¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker start db</span><br><span class="line">docker start wiki</span><br><span class="line">docker start wiki-update-companion</span><br></pre></td></tr></table></figure><p>åˆ°è¿™ä¸€æ­¥ï¼Œå°±å¯ä»¥ç”¨<code>3000</code>ç«¯å£è®¿é—®äº†</p><h1 id="2-docker-composeéƒ¨ç½²ï¼ˆæ¨èï¼‰"><a href="#2-docker-composeéƒ¨ç½²ï¼ˆæ¨èï¼‰" class="headerlink" title="2.docker-composeéƒ¨ç½²ï¼ˆæ¨èï¼‰"></a>2.docker-composeéƒ¨ç½²ï¼ˆæ¨èï¼‰</h1><p><a class="link"   href="https://docs.requarks.io/install/docker" >https://docs.requarks.io/install/docker<i class="fas fa-external-link-alt"></i></a></p><p>docker-composeæœ€å¥½çš„ä¸€ç‚¹å°±æ˜¯æ–¹ä¾¿ç®¡ç†ï¼Œä¸éœ€è¦å•ç‹¬ç®¡ç†ä¸Šé¢çš„3ä¸ªå®¹å™¨ï¼Œè€Œæ˜¯ç”¨ä¸€æ¡å‘½ä»¤å°±èƒ½åŒæ—¶å¯åœå®¹å™¨</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres:11-alpine</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">POSTGRES_DB:</span> <span class="string">wiki</span></span><br><span class="line">      <span class="attr">POSTGRES_PASSWORD:</span> <span class="string">wikijsrocks</span></span><br><span class="line">      <span class="attr">POSTGRES_USER:</span> <span class="string">wikijs</span></span><br><span class="line">    <span class="attr">logging:</span></span><br><span class="line">      <span class="attr">driver:</span> <span class="string">&quot;none&quot;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db-data:/var/lib/postgresql/data</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">wiki:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">ghcr.io/requarks/wiki:2</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">DB_TYPE:</span> <span class="string">postgres</span></span><br><span class="line">      <span class="attr">DB_HOST:</span> <span class="string">db</span></span><br><span class="line">      <span class="attr">DB_PORT:</span> <span class="number">5432</span></span><br><span class="line">      <span class="attr">DB_USER:</span> <span class="string">wikijs</span></span><br><span class="line">      <span class="attr">DB_PASS:</span> <span class="string">wikijsrocks</span></span><br><span class="line">      <span class="attr">DB_NAME:</span> <span class="string">wiki</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;80:3000&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">db-data:</span></span><br></pre></td></tr></table></figure><h1 id="3-é…ç½®è¯ä¹¦letâ€™s-encrpy"><a href="#3-é…ç½®è¯ä¹¦letâ€™s-encrpy" class="headerlink" title="3.é…ç½®è¯ä¹¦letâ€™s encrpy"></a>3.é…ç½®è¯ä¹¦letâ€™s encrpy</h1><p>é…ç½®è¯ä¹¦éœ€è¦å¤šæŒ‡å®šä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼Œåˆ†åˆ«æ˜¯ä½ çš„åŸŸåä»¥åŠç”¨äºç”³è¯·è¯ä¹¦çš„é‚®ç®±</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-e &quot;LETSENCRYPT_DOMAIN=wiki.example.com&quot; \</span><br><span class="line">-e &quot;LETSENCRYPT_EMAIL=admin@example.com&quot; \</span><br><span class="line">-p 443:3443</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸è¿™ä¹ˆåšï¼Œåˆ™éœ€è¦åœ¨nginxåå‘ä»£ç†ä¸Šé…ç½®è¯ä¹¦</p><h1 id="4-è¯„è®º"><a href="#4-è¯„è®º" class="headerlink" title="4.è¯„è®º"></a>4.è¯„è®º</h1><p>é»˜è®¤çš„è¯„è®ºè¿å›å¤éƒ½ä¸æ”¯æŒï¼Œä¹Ÿæ²¡æœ‰ä¸€ä¸ªç®¡ç†é¡µé¢å’Œé€šçŸ¥ï¼Œå¦‚æœè¦æŠŠwikiå±•ç¤ºå‡ºæ¥ï¼Œè¿™æ ·å°±éå¸¸ä¸æ–¹ä¾¿</p><p>å»ºè®®é…ç½®ä¸€ä¸‹artalkè¯„è®ºç³»ç»Ÿ <a href="https://blog.musnow.top/2023/01/05/docker/wikijs%E4%BD%BF%E7%94%A8artalk%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F/">æ•™ç¨‹</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;wikijsæ˜¯ä¸€ä¸ªåœ¨çº¿å¤šäººåä½œï¼ˆå¸¦gitç‰ˆæœ¬ç®¡ç†ï¼‰çš„wikiå¥—ä»¶&lt;/p&gt;</summary>
    
    
    
    <category term="å·®ç”Ÿæ–‡å…·å¤š" scheme="https://blog.musnow.top/categories/%E5%B7%AE%E7%94%9F%E6%96%87%E5%85%B7%E5%A4%9A/"/>
    
    
    <category term="wikijs" scheme="https://blog.musnow.top/tags/wikijs/"/>
    
    <category term="Docker" scheme="https://blog.musnow.top/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>ã€Cè¯­è¨€ã€‘å¯å˜å‚æ•°åˆ—è¡¨</title>
    <link href="https://blog.musnow.top/2023/02/01/note_c/46%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E5%88%97%E8%A1%A8/"/>
    <id>https://blog.musnow.top/2023/02/01/note_c/46%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E5%88%97%E8%A1%A8/</id>
    <published>2023-02-01T12:41:59.000Z</published>
    <updated>2023-02-11T02:52:09.412Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢è®©æˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹Cè¯­è¨€å­¦ä¹ è¿‡ç¨‹ä¸­å¾€å¾€è¢«å¿½ç•¥çš„<code>å¯å˜å‚æ•°åˆ—è¡¨</code></p><span id="more"></span><p>æ‰€è°“å¯å˜å‚æ•°ï¼Œå°±æ˜¯ä¸€ä¸ªä¸é™å®šå‚æ•°æ•°é‡çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å¾€é‡Œé¢ä¼ å…¥ä»»æ„ä¸ªæ•°çš„å‚æ•°ï¼Œä»¥è¾¾æˆæŸäº›ç›®çš„ã€‚</p><p>å…³è”ï¼š<a href="https://blog.musnow.top/2022/09/28/note_cpp/20c++11%E7%89%B9%E6%80%A7/#7-%E5%8F%AF%E5%8F%98%E6%A8%A1%E6%9D%BF%E5%8F%82%E6%95%B0">C++11å¯å˜æ¨¡æ¿å‚æ•°</a></p><h1 id="1-å‡½æ•°"><a href="#1-å‡½æ•°" class="headerlink" title="1.å‡½æ•°"></a>1.å‡½æ•°</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdarg.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">va_start</span><span class="params">(va_list ap, last)</span>;</span><br><span class="line">type <span class="title function_">va_arg</span><span class="params">(va_list ap, type)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">va_end</span><span class="params">(va_list ap)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">va_copy</span><span class="params">(va_list dest, va_list src)</span>;</span><br></pre></td></tr></table></figure><h2 id="1-1-va-start"><a href="#1-1-va-start" class="headerlink" title="1.1 va_start"></a>1.1 va_start</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">va_start</span><span class="params">(va_list ap, last_arg)</span>;</span><br></pre></td></tr></table></figure><ul><li><strong>ap</strong>: è¿™æ˜¯ä¸€ä¸ª <strong>va_list</strong> ç±»å‹çš„å¯¹è±¡ï¼Œå®ƒç”¨æ¥å­˜å‚¨é€šè¿‡ <strong>va_arg</strong> è·å–é¢å¤–å‚æ•°æ—¶æ‰€å¿…éœ€çš„ä¿¡æ¯</li><li>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯åˆå§‹åŒ– <code>ap</code> å˜é‡ï¼Œå®ƒä¸ <strong>va_arg</strong> å’Œ <strong>va_end</strong> å‡½æ•°ä¸€èµ·ä½¿ç”¨ã€‚</li></ul><ul><li><strong>last_arg</strong> æ˜¯æœ€åä¸€ä¸ªä¼ é€’ç»™å‡½æ•°çš„å·²çŸ¥çš„å›ºå®šå‚æ•°ï¼Œ<strong>å³çœç•¥å·ä¹‹å‰çš„å‚æ•°</strong>ã€‚</li></ul><p>è¦æƒ³è®¾ç½®ä¸€ä¸ªå¸¦å¯å˜å‚æ•°çš„å‡½æ•°ï¼Œå‡½æ•°å£°æ˜æ˜¯ä¸‹é¢è¿™æ ·çš„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">test</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b, ...)</span>;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå‡ºç°çš„çœç•¥å·å°±æ˜¯å¯å˜å‚æ•°çš„ç‰¹å¾ï¼Œè€Œå˜é‡bå°±æ˜¯va_startå‡½æ•°éœ€è¦çš„<code>last_arg</code></p><h2 id="1-2-va-arg"><a href="#1-2-va-arg" class="headerlink" title="1.2 va_arg"></a>1.2 va_arg</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type <span class="title function_">va_arg</span><span class="params">(va_list ap, type)</span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯æ¥æå–å¯å˜å‚æ•°åˆ—è¡¨ä¸­çš„å‚æ•°ã€‚æ³¨æ„ï¼Œæ¯æ¬¡æå–çš„å‚æ•°æ˜¯ç›´æ¥è¿”å›çš„ï¼Œå¹¶æ²¡æœ‰æ”¾åˆ°å˜é‡apä¸­ã€‚</p><p>æ¯æ¬¡å¯¹va_argçš„è°ƒç”¨éƒ½ä¼šä¿®æ”¹apï¼Œä»¥ä¾¿ä¸‹æ¬¡è°ƒç”¨æ—¶ï¼Œè¿”å›ä¸‹ä¸€ä¸ªå‚æ•°ï¼›æ¨æ–­å‚æ•°çš„æ—¶å€™éœ€è¦æŒ‡å®štypeï¼Œå¦‚æœå½“å‰å‚æ•°ç±»å‹å’Œtypeä¸ç»Ÿä¸€ï¼Œå°±ä¼šå‘ç”Ÿ<strong>ä¸å¯é¢„çŸ¥</strong>çš„é”™è¯¯ï¼ˆmanæ‰‹å†Œé‡Œé¢è¯´çš„ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">If ap is passed to a function that uses va_arg(ap,type) then the value of ap is undefined after the return of that function.</span><br></pre></td></tr></table></figure><p>å¦‚æœapè¢«ä¼ é€’ç»™<code>va_arg(ap,type)</code>ï¼Œåˆ™åœ¨è¯¥å‡½æ•°è¿”å›åï¼Œapçš„å€¼æœªå®šä¹‰ã€‚</p><h2 id="1-3-va-end"><a href="#1-3-va-end" class="headerlink" title="1.3 va_end"></a>1.3 va_end</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">va_end</span><span class="params">(va_list ap)</span>;</span><br></pre></td></tr></table></figure><p>æ¯ä¸€ä¸ª<code>va_start</code>éƒ½éœ€è¦æœ‰ä¸€ä¸ªé…å¥—çš„<code>va_end</code>ï¼Œå…¶ç”¨äºæ¸…ç©ºap</p><p>å¯ä»¥æŠŠä»–ä¿©çš„å…³ç³»ç†è§£ä¸º<code>malloc/free</code>ï¼Œè®°å¾—åŠ ä¸Šå°±è¡Œ</p><h2 id="1-4-va-copy"><a href="#1-4-va-copy" class="headerlink" title="1.4 va_copy"></a>1.4 va_copy</h2><p>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯å°†å¯å˜å‚æ•°åˆ—è¡¨ä»ç¬¬äºŒä¸ªå‚æ•°<code>src</code>æ‹·è´åˆ°ç¬¬ä¸€ä¸ªå‚æ•°<code>dest</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> va_copyï¼ˆva_list destï¼Œva_list srcï¼‰;</span><br></pre></td></tr></table></figure><p>å…¶ä¹Ÿèƒ½å¤Ÿ<strong>åˆå§‹åŒ–</strong><code>dest</code>ã€‚è°ƒç”¨äº†<code>va_copy</code>åï¼Œæ— é¡»è°ƒç”¨<code>va_start</code>åˆå§‹åŒ–<code>dest</code>ï¼Œä½†<code>va_end</code>è¿˜æ˜¯éœ€è¦çš„ã€‚</p><h1 id="2-ç®€å•ç¤ºä¾‹"><a href="#2-ç®€å•ç¤ºä¾‹" class="headerlink" title="2.ç®€å•ç¤ºä¾‹"></a>2.ç®€å•ç¤ºä¾‹</h1><h2 id="2-1-æ‰“å°å¤šä¸ªå‚æ•°"><a href="#2-1-æ‰“å°å¤šä¸ªå‚æ•°" class="headerlink" title="2.1 æ‰“å°å¤šä¸ªå‚æ•°"></a>2.1 æ‰“å°å¤šä¸ªå‚æ•°</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdarg.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">print</span><span class="params">(<span class="type">int</span> num_args,...)</span></span><br><span class="line">&#123;</span><br><span class="line">    va_list ap;</span><br><span class="line">    va_start(ap,num_args);<span class="comment">//åˆå§‹åŒ–å¯å˜å‚æ•°</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;num_args;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,va_arg(ap,<span class="type">int</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    va_end(ap);<span class="comment">//ç»“æŸå¯¹apçš„ä½¿ç”¨</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    print(<span class="number">5</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œè¯¥å‡½æ•°ï¼Œä¼šæ‰“å°å¦‚ä¸‹ç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">1 2 3 4 5 </span><br></pre></td></tr></table></figure><p>è¿™å°±è¡¨æ˜äº†ï¼Œ<code>...</code>çœç•¥å·ä¹‹å‰çš„å‚æ•°ï¼Œå’Œ<code>va_arg</code>è¿”å›å¯å˜å‚æ•°å…¶å®æ˜¯æ²¡æœ‰å…³ç³»çš„ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">print</span><span class="params">(<span class="type">int</span> num_args,...)</span></span><br><span class="line">&#123;</span><br><span class="line">    va_list ap;</span><br><span class="line">    va_start(ap,num_args);<span class="comment">//åˆå§‹åŒ–å¯å˜å‚æ•°</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,va_arg(ap,<span class="type">int</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    va_end(ap);<span class="comment">//ç»“æŸå¯¹apçš„ä½¿ç”¨</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    print(<span class="number">5</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å³ä¾¿åœ¨æœ€åéƒ½æ²¡æœ‰ä½¿ç”¨<code>num_args</code>ï¼Œä¹Ÿä¸ä¼šå½±å“ç»“æœçš„æ­£ç¡®æ€§ã€‚<code>va_start</code>éœ€è¦è¿™ä¸ªå‚æ•°ï¼Œå…¶å®æ˜¯ç”¨æ¥æ ‡è¯†å¯å˜å‚æ•°çš„èµ·ç‚¹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">1 2 3 4 5 6 7 8 </span><br></pre></td></tr></table></figure><h2 id="2-2-å¤šå‚æ•°æ±‚å’Œ"><a href="#2-2-å¤šå‚æ•°æ±‚å’Œ" class="headerlink" title="2.2 å¤šå‚æ•°æ±‚å’Œ"></a>2.2 å¤šå‚æ•°æ±‚å’Œ</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdarg.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="comment">// é‡‡ç”¨å¯å˜å‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ç”¨äºæ ‡è¯†å‚æ•°æ•°é‡</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">sum</span><span class="params">(<span class="type">int</span> num_args, ...)</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="type">int</span> val = <span class="number">0</span>;</span><br><span class="line">   va_list ap;</span><br><span class="line">   <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">   va_start(ap, num_args);</span><br><span class="line">   <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; num_args; i++)</span><br><span class="line">   &#123;</span><br><span class="line">      val += va_arg(ap, <span class="type">int</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   va_end(ap);</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">test1</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;10ã€20 å’Œ 30 çš„å’Œ = %d\n&quot;</span>,  sum(<span class="number">3</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>) );</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;4ã€20ã€25 å’Œ 30 çš„å’Œ = %d\n&quot;</span>,  sum(<span class="number">4</span>, <span class="number">4</span>, <span class="number">20</span>, <span class="number">25</span>, <span class="number">30</span>) );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">10ã€20 å’Œ 30 çš„å’Œ = 60</span><br><span class="line">4ã€20ã€25 å’Œ 30 çš„å’Œ = 79</span><br></pre></td></tr></table></figure><h1 id="3-åˆ©ç”¨å¯å˜å‚æ•°å®ç°logç±»"><a href="#3-åˆ©ç”¨å¯å˜å‚æ•°å®ç°logç±»" class="headerlink" title="3.åˆ©ç”¨å¯å˜å‚æ•°å®ç°logç±»"></a>3.åˆ©ç”¨å¯å˜å‚æ•°å®ç°logç±»</h1><p>ç°åœ¨æœ‰äº†å¯å˜å‚æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¥ç”¨è¿™ä¸ªå‚æ•°æ¥è¿›è¡Œæ—¥å¿—çš„æ‰“å°äº†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdarg&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cerrno&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEBUG 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NOTICE 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WARINING 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FATAL 3</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *log_level[]=&#123;<span class="string">&quot;DEBUG&quot;</span>, <span class="string">&quot;NOTICE&quot;</span>, <span class="string">&quot;WARINING&quot;</span>, <span class="string">&quot;FATAL&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡‡ç”¨å¯å˜å‚æ•°åˆ—è¡¨</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">logging</span><span class="params">(<span class="type">int</span> level, <span class="type">const</span> <span class="type">char</span> *format, ...)</span></span><br><span class="line">&#123;</span><br><span class="line">    assert(level &gt;= DEBUG || level &lt;= FATAL);</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> *name = getenv(<span class="string">&quot;USER&quot;</span>);<span class="comment">// è·å–ç¯å¢ƒå˜é‡ä¸­çš„ç”¨æˆ·ï¼ˆæ‰§è¡Œå‘½ä»¤çš„ç”¨æˆ·ï¼‰</span></span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> logInfo[<span class="number">1024</span>];</span><br><span class="line">    <span class="comment">// è·å–å¯å˜å‚æ•°åˆ—è¡¨</span></span><br><span class="line">    va_list ap; <span class="comment">// ap -&gt; char*</span></span><br><span class="line">    va_start(ap, format);</span><br><span class="line"></span><br><span class="line">    vsnprintf(logInfo, <span class="keyword">sizeof</span>(logInfo)<span class="number">-1</span>, format, ap);</span><br><span class="line"></span><br><span class="line">    va_end(ap); <span class="comment">// ap = NULL</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®æ—¥å¿—ç­‰çº§é€‰æ‹©æ‰“å°åˆ°stderr/stdout</span></span><br><span class="line">    FILE *out = (level == FATAL) ? <span class="built_in">stderr</span>:<span class="built_in">stdout</span>;</span><br><span class="line">    <span class="comment">// æ ¼å¼åŒ–æ‰“å°åˆ°æ–‡ä»¶ä¸­</span></span><br><span class="line">    <span class="built_in">fprintf</span>(out, <span class="string">&quot;%s | %u | %s | %s\n&quot;</span>, \</span><br><span class="line">        log_level[level], \</span><br><span class="line">        (<span class="type">unsigned</span> <span class="type">int</span>)time(nullptr),\</span><br><span class="line">        name == nullptr ? <span class="string">&quot;unknow&quot;</span>:name,\</span><br><span class="line">        logInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-1-vsnprint"><a href="#3-1-vsnprint" class="headerlink" title="3.1 vsnprint"></a>3.1 vsnprint</h2><p>ä½œç”¨ï¼šä½¿ç”¨<code>vsnprintf()</code>ç”¨äºå‘ä¸€ä¸ªå­—ç¬¦ä¸²ç¼“å†²åŒºæ‰“å°æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œä¸”å¯ä»¥é™å®šæ‰“å°çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦ã€‚</p><p>æ­¤å‡½æ•°éœ€è¦C99æˆ–è€…C++11åŠä»¥ä¸Šç‰ˆæœ¬æ‰èƒ½æ”¯æŒã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">vsnprintf</span><span class="params">(<span class="type">char</span>* sbuf, <span class="type">size_t</span> n, <span class="type">const</span> <span class="type">char</span>* format, va_list arg)</span>;</span><br></pre></td></tr></table></figure><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°ï¼šç›®æ ‡ç¼“å†²åŒºï¼ˆå­—ç¬¦æ•°ç»„ï¼‰</li><li>ç¬¬äºŒä¸ªå‚æ•°ï¼Œé™å®šæœ€å¤šæ‰“å°åˆ°ç¼“å†²åŒºçš„å­—ç¬¦æ•°é‡ä¸º<code>n-1</code>ä¸ªï¼ˆç•™ä½ç½®ç»™<code>\0</code>ï¼‰</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œæ‰“å°çš„æ ¼å¼ï¼ˆå¦‚<code>%d:%s</code>ï¼‰</li><li>ç¬¬å››ä¸ªå‚æ•°ï¼Œå¯å˜å‚æ•°argï¼Œéœ€è¦ç”¨<code>va_start</code>åˆå§‹åŒ–</li></ul><p><strong>è¿”å›</strong>ï¼šæˆåŠŸæ‰“å°åˆ°sbufä¸­çš„å­—ç¬¦çš„ä¸ªæ•°ï¼Œä¸åŒ…æ‹¬æœ«å°¾è¿½åŠ çš„\0ã€‚å¦‚æœæ ¼å¼åŒ–è§£æå¤±è´¥ï¼Œåˆ™è¿”å›è´Ÿæ•°ã€‚</p><p>ç”¨è¿™ä¸ªå‡½æ•°ï¼Œå°±èƒ½æŠŠæˆ‘ä»¬çš„æ¥æºå­—ç¬¦ä¸²ç»™è¾“å…¥åˆ°ç¼“å†²åŒº<code>char logInfo[1024];</code>ä¸­</p><h2 id="3-2-fprintf"><a href="#3-2-fprintf" class="headerlink" title="3.2 fprintf"></a>3.2 fprintf</h2><p>ä½¿ç”¨<code>fprintf</code>ï¼Œå°†printfçš„è¾“å‡ºæ‰“å°åˆ°æŒ‡å®šæ–‡ä»¶ä¸­ï¼›ç”¨æ³•å’Œ<code>printf</code>æ˜¯ä¸€æ ·çš„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">fprintf</span><span class="params">(FILE *stream, <span class="type">const</span> <span class="type">char</span> *format, ...)</span>;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æ˜¯ä¸ºäº†åŒºåˆ†<code>stderr/stdout</code>ã€‚åŒæ—¶æ·»åŠ ä¸Šæ‰§è¡Œå‘½ä»¤çš„ç”¨æˆ·ä¿¡æ¯ï¼Œä»¥åŠå½“å‰çš„æ—¶é—´æˆ³</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">fprintf</span>(out, <span class="string">&quot;%s | %u | %s | %s\n&quot;</span>, \</span><br><span class="line">    log_level[level], \</span><br><span class="line">    (<span class="type">unsigned</span> <span class="type">int</span>)time(nullptr),\</span><br><span class="line">    name == nullptr ? <span class="string">&quot;unknow&quot;</span>:name,\</span><br><span class="line">    logInfo);</span><br></pre></td></tr></table></figure><h2 id="3-3-è¿è¡Œç»“æœ"><a href="#3-3-è¿è¡Œç»“æœ" class="headerlink" title="3.3 è¿è¡Œç»“æœ"></a>3.3 è¿è¡Œç»“æœ</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    logging(DEBUG, <span class="string">&quot;socket create success: %d&quot;</span>, <span class="number">114514</span>);</span><br><span class="line">    logging(FATAL, <span class="string">&quot;socket:%s:%d&quot;</span>, strerror(errno), <span class="number">11234</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ./test</span><br><span class="line">DEBUG | 1675322313 | muxue | socket create success: 114514</span><br><span class="line">FATAL | 1675322313 | muxue | socket:Success:11234</span><br></pre></td></tr></table></figure><h1 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h1><p>å¯¹äºå¯å˜å‚æ•°çš„ç®€å•ä»‹ç»å°±åˆ°è¿™é‡Œï¼åŸºæœ¬çš„ä½¿ç”¨èƒ½çœ‹æ‡‚ä¹…OKå•¦ï¼</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ¬ç¯‡åšå®¢è®©æˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹Cè¯­è¨€å­¦ä¹ è¿‡ç¨‹ä¸­å¾€å¾€è¢«å¿½ç•¥çš„&lt;code&gt;å¯å˜å‚æ•°åˆ—è¡¨&lt;/code&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="åˆè¯†Cè¯­è¨€" scheme="https://blog.musnow.top/categories/%E5%88%9D%E8%AF%86C%E8%AF%AD%E8%A8%80/"/>
    
    
    <category term="Cè¯­è¨€" scheme="https://blog.musnow.top/tags/C%E8%AF%AD%E8%A8%80/"/>
    
  </entry>
  
  <entry>
    <title>ã€Linuxã€‘æ¥å†™ä¸€ä¸ªudpçš„æœåŠ¡ç«¯+å®¢æˆ·ç«¯</title>
    <link href="https://blog.musnow.top/2023/02/01/note_Linux/27udp%E4%BB%A3%E7%A0%81/"/>
    <id>https://blog.musnow.top/2023/02/01/note_Linux/27udp%E4%BB%A3%E7%A0%81/</id>
    <published>2023-02-01T07:30:54.000Z</published>
    <updated>2023-02-10T08:24:29.074Z</updated>
    
    <content type="html"><![CDATA[<p>æ¥å†™ä¸€ä¸ªudpçš„ä»£ç </p><span id="more"></span><h1 id="1-socketç¼–ç¨‹æ¥å£"><a href="#1-socketç¼–ç¨‹æ¥å£" class="headerlink" title="1.socketç¼–ç¨‹æ¥å£"></a>1.socketç¼–ç¨‹æ¥å£</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»º socket æ–‡ä»¶æè¿°ç¬¦ (TCP/UDP, å®¢æˆ·ç«¯ + æœåŠ¡å™¨)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">socket</span><span class="params">(<span class="type">int</span> domain, <span class="type">int</span> type, <span class="type">int</span> protocol)</span>;</span><br><span class="line"><span class="comment">// ç»‘å®šç«¯å£å· (TCP/UDP, æœåŠ¡å™¨)      </span></span><br><span class="line"><span class="type">int</span> <span class="title function_">bind</span><span class="params">(<span class="type">int</span> socket, <span class="type">const</span> <span class="keyword">struct</span> sockaddr *address,</span></span><br><span class="line"><span class="params">         <span class="type">socklen_t</span> address_len)</span>;</span><br><span class="line"><span class="comment">// å¼€å§‹ç›‘å¬socket (TCP, æœåŠ¡å™¨)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">listen</span><span class="params">(<span class="type">int</span> socket, <span class="type">int</span> backlog)</span>;</span><br><span class="line"><span class="comment">// æ¥æ”¶è¯·æ±‚ (TCP, æœåŠ¡å™¨)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">accept</span><span class="params">(<span class="type">int</span> socket, <span class="keyword">struct</span> sockaddr* address,</span></span><br><span class="line"><span class="params">         <span class="type">socklen_t</span>* address_len)</span>;</span><br><span class="line"><span class="comment">// å»ºç«‹è¿æ¥ (TCP, å®¢æˆ·ç«¯)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">connect</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> <span class="keyword">struct</span> sockaddr *addr,</span></span><br><span class="line"><span class="params">         <span class="type">socklen_t</span> addrlen)</span>;</span><br></pre></td></tr></table></figure><p>linuxä¸‹ä¸€åˆ‡çš†æ–‡ä»¶ï¼Œsocketæ¥å£ä¹Ÿä¸ä¾‹å¤–ã€‚å…¶è¿”å›å€¼æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªfdæ–‡ä»¶æè¿°ç¬¦ï¼Œè¿™æ ·æˆ‘ä»¬å¯¹ç½‘ç»œçš„å‘é€&#x2F;æ¥æ”¶æ“ä½œï¼Œå°±è½¬æ¢æˆäº†å¯¹æ–‡ä»¶çš„å†™å…¥&#x2F;è¯»å–æ“ä½œäº†</p><p>åœ¨è¿™é‡Œé¢æœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„ç»“æ„<code>sockaddr</code>éœ€è¦è¯´æ˜ä¸€ç•ª</p><h2 id="1-1-sockaddr"><a href="#1-1-sockaddr" class="headerlink" title="1.1 sockaddr"></a>1.1 sockaddr</h2><p>socketæ˜¯ä¸€å±‚æŠ½è±¡çš„ç½‘ç»œç¼–ç¨‹æ¥å£ï¼Œé€‚ç”¨äºå„ç§åº•å±‚ç½‘ç»œåè®®ï¼Œå¦‚IPv4&#x2F;IPv6ã€‚åŒæ—¶ï¼Œè¿™ä¸ªæ¥å£è¿˜å¯ä»¥ç”¨äºç³»ç»Ÿå†…éƒ¨çš„é€šä¿¡ã€‚è¿™å°±å®ç°äº†ç”¨ä¸€ä¸ªæ¥å£æ¥å¹²ä¸¤ä»¶äº‹ã€‚</p><p>ä¸ºæ­¤ï¼Œå°±å¿…é¡»è¦åœ¨ä¼ å€¼ä¸­è¿›è¡Œä¸€äº›ä¿®æ”¹ã€‚è¯¥æ¥å£æ–°å¢äº†ä¸€ä¸ª<code>sockaddr</code>ï¼Œç”¨æ¥æ¥æ”¶ç›®æ ‡ä¿¡æ¯ã€‚è¿™ä¸ªå€¼çš„å‚æ•°å¯ä»¥æ˜¯<code>sockaddr_in/scokaddr_un/sockadd_in6</code>ä¹‹ä¸­çš„ä»»æ„ä¸€ä¸ªï¼ˆéœ€è¦å¼ºè½¬æŒ‡é’ˆï¼‰</p><p><code>sockaddr</code>æœ¬èº«ä¸å­˜æ”¾ä»»ä½•ä¿¡æ¯ã€‚</p><p>è¿™ä¸ªå‚æ•°å¯æ¥æ”¶çš„ç»“æ„ä½“ä¸­ï¼Œå›ºå®šå‰16ä½å°±æ˜¯ç”¨äºæ ‡è¯†ç¬¦çš„ã€‚ä¼ åˆ°å¤„ç†å‡½æ•°ä¸­ï¼Œå°±ä¼šåˆ¤æ–­å‰16ä½ä¸­çš„æ ‡è¯†ç¬¦çš„ç±»å‹ï¼Œä»¥ç¡®å®šä¼ å…¥å‚æ•°çš„ç±»å‹ï¼Œå†æ‰§è¡Œä¸åŒçš„å®ç°</p><ul><li>æ¯”å¦‚ä¼ å…¥çš„<code>scokaddr_un</code>ï¼Œå‰16ä½æ˜¯<code>AF_UNIX</code>ï¼Œé‚£ä¹ˆå½“å‰ä½¿ç”¨çš„å°±æ˜¯<strong>æœ¬åœ°é€šä¿¡</strong></li><li><code>sockaddr_in</code>æ˜¯ipv4é€šä¿¡ï¼Œ<code>sockaddr_in6</code>æ˜¯ipv6é€šä¿¡</li></ul><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/20236d2a0690427f302e7a9895bbd40884c1.png"                      alt="image-20230201150711386"                ></p><p>ä½ å¯èƒ½ä¼šæœ‰ç–‘æƒ‘ï¼Œæ—¢ç„¶<code>sockaddr</code>ä¸å­˜æ”¾ä¿¡æ¯ï¼Œé‚£ä¸ºä½•ä¸æŠŠè¿™ä¸ªå‚æ•°è®¾ç½®ä¸ºä¸€ä¸ª<code>void*</code>çš„æŒ‡é’ˆï¼Ÿåæ­£æœ€åéƒ½æ˜¯è¿›äº†å‡½æ•°ä¹‹ååˆ¤æ–­å‚æ•°ç±»å‹ï¼Œ<code>void*</code>æŒ‡é’ˆä¹Ÿèƒ½è¾¾æˆç›®æ ‡å‘€ğŸ§</p><p>è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆå¾ˆç®€å•ï¼šå½“åˆè®¾è®¡è¿™å¥—æ¥å£çš„æ—¶å€™ï¼ŒCè¯­è¨€è¿˜ä¸æ”¯æŒ<code>void*</code>ğŸ˜‚</p><hr><h2 id="1-2-å­˜æ”¾ä½ç½®"><a href="#1-2-å­˜æ”¾ä½ç½®" class="headerlink" title="1.2 å­˜æ”¾ä½ç½®"></a>1.2 å­˜æ”¾ä½ç½®</h2><p>å› ä¸º<code>sockaddr_in</code>è¿™ç±»çš„ç»“æ„ä½“ï¼Œæœ€ç»ˆéƒ½éœ€è¦è¢«æ“ä½œç³»ç»Ÿè½½å…¥å¹¶å®ç°ç½‘ç»œæ“ä½œã€‚æ‰€ä»¥å®ƒä»¬è‚¯å®šæ˜¯éœ€è¦è½½å…¥å†…æ ¸ä¸­çš„</p><p>ä½†è¿™å¹¶ä¸æ„å‘³ç€è¿™ç±»ç»“æ„ä½“æ˜¯å­˜æ”¾åœ¨å†…æ ¸é‡Œé¢çš„ï¼Œè€Œæ˜¯å­˜æ”¾åœ¨<strong>ç”¨æˆ·æ ˆ</strong>ï¼Œç”¨æˆ·æ€å’Œå†…æ ¸æ€äº¤æ¢çš„æ—¶å€™ï¼Œé€šè¿‡æ¥å£ä¼ å€¼è½½å…¥åˆ°å†…æ ¸çš„ç©ºé—´è¿›è¡Œä½¿ç”¨</p><h1 id="2-server"><a href="#2-server" class="headerlink" title="2.server"></a>2.server</h1><p>äº†è§£äº†ä¸Šé¢çš„ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥ï¼Œè®¤è¯†ä¸€ä¸‹å¦‚æœæƒ³å»ºç«‹ä¸€ä¸ª<code>udp</code>serverï¼Œéœ€è¦æ€ä¹ˆæ“ä½œå§ï¼</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªserverçš„ç±»ï¼ŒåŒ…å«äº†ç«¯å£ã€ipã€socker fdä¸‰ä¸ªåŸºæœ¬ä¿¡æ¯</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UdpServer</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">UdpServer</span>(<span class="type">uint16_t</span> port,<span class="type">const</span> string&amp; ip=<span class="string">&quot;&quot;</span>)</span><br><span class="line">     : _port((<span class="type">uint16_t</span>)port), _ip(ip), _sockfd(<span class="number">-1</span>)</span><br><span class="line">    &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// æœåŠ¡å™¨ç«¯å£å·</span></span><br><span class="line">    <span class="type">uint16_t</span> _port;</span><br><span class="line">    <span class="comment">// æœåŠ¡å™¨ipåœ°å€</span></span><br><span class="line">    string _ip;</span><br><span class="line">    <span class="comment">// æœåŠ¡å™¨socket fdä¿¡æ¯</span></span><br><span class="line">    <span class="type">int</span> _sockfd;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2-1-åˆ›å»ºå¥—æ¥å­—"><a href="#2-1-åˆ›å»ºå¥—æ¥å­—" class="headerlink" title="2.1 åˆ›å»ºå¥—æ¥å­—"></a>2.1 åˆ›å»ºå¥—æ¥å­—</h2><p>è¿™é‡Œéœ€è¦ç”¨çš„æ˜¯ä¸‹é¢è¿™ä¸ªæ¥å£</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">socket</span><span class="params">(<span class="type">int</span> domain, <span class="type">int</span> type, <span class="type">int</span> protocol)</span>;</span><br></pre></td></tr></table></figure><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°domainæ ‡è¯†è¯¥sockerçš„ä½œç”¨åŸŸ</li></ul><p>å¯ä»¥è®¾ç½®ä¸ºæœ¬åœ°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸ºç½‘ç»œã€‚æ”¯æŒå¦‚ä¸‹å‚æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Name                Purpose                          Man page</span><br><span class="line">AF_UNIX, AF_LOCAL   Local communication              unix(7)</span><br><span class="line">AF_INET             IPv4 Internet protocols          ip(7)</span><br><span class="line">AF_INET6            IPv6 Internet protocols          ipv6(7)</span><br><span class="line">AF_IPX              IPX - Novell protocols</span><br><span class="line">AF_NETLINK          Kernel user interface device     netlink(7)</span><br><span class="line">AF_X25              ITU-T X.25 / ISO-8208 protocol   x25(7)</span><br><span class="line">AF_AX25             Amateur radio AX.25 protocol</span><br><span class="line">AF_ATMPVC           Access to raw ATM PVCs</span><br><span class="line">AF_APPLETALK        Appletalk                        ddp(7)</span><br><span class="line">AF_PACKET           Low level packet interface       packet(7)</span><br></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘ä»¬è¦åˆ›å»ºçš„æ˜¯ä¸€ä¸ªç½‘ç»œæœåŠ¡å™¨ï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®ä¸º<code>AF_INET</code>ï¼Œä¹Ÿå°±æ˜¯IPV4çš„æœåŠ¡</p><ul><li>ç¬¬äºŒä¸ªå‚æ•°typeæŒ‡ä»£å¥—æ¥å­—çš„ç±»å‹ï¼Œå†³å®šäº†é€šä¿¡æ—¶çš„æŠ¥æ–‡ç±»å‹</li></ul><p>è¿™é‡Œæ”¯æŒæµå¼ï¼ˆTCPï¼‰æˆ–è€…ç”¨æˆ·æ•°æ®æŠ¥ï¼ˆUDPï¼‰ï¼Œä»¥åŠRAWåŸå§‹æ ¼å¼ï¼ˆèƒ½å¤Ÿç›´æ¥è®¿é—®åè®®ï¼Œæ–¹ä¾¿debugï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SOCK_STREAM   Provides sequenced, reliable, two-way, connection-based byte streams. An out-of-band data  transmission  mechanism  may  be supported.</span><br><span class="line"></span><br><span class="line">SOCK_DGRAM    Supports datagrams (connectionless, unreliable messages of a fixed maximum length).</span><br><span class="line"></span><br><span class="line"> SOCK_RAW        Provides raw network protocol access.</span><br></pre></td></tr></table></figure><p>æ›´å¤šæ”¯æŒçš„å‚æ•°å‚è€ƒmanæ‰‹å†Œ</p><ul><li>ç¬¬ä¸‰ä¸ªå‚æ•°æŒ‡ä»£åè®®ï¼Œåœ¨ç½‘ç»œåº”ç”¨ä¸­ï¼Œè®¾ç½®ä¸º<strong>0</strong>å³å¯</li></ul><p>è¿”å›å€¼æ˜¯ä¸€ä¸ªlinuxç³»ç»Ÿçš„<strong>æ–‡ä»¶æè¿°ç¬¦</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RETURN VALUE</span><br><span class="line">       On success, a file descriptor for the new socket is returned.  On error, -1 is returned, and errno is set appropriately.</span><br></pre></td></tr></table></figure><hr><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½å†™å‡ºç¬¬ä¸€è¡Œä»£ç ï¼Œä»¥åŠå¯¹è¿™ä¸ªä»£ç çš„è¿”å›å€¼åˆ¤æ–­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">_sockfd = socket(AF_INET, SOCK_DGRAM, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (_sockfd &lt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    logging(FATAL, <span class="string">&quot;socket:%s:%d&quot;</span>, strerror(errno), _sockfd);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºsocketæ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œä¸ºäº†è§„èŒƒï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨ææ„å‡½æ•°é‡Œé¢è°ƒç”¨ä¸€ä¸‹<code>close</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~<span class="built_in">UdpServer</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">close</span>(_sockfd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-2-é…ç½®sockaddr-in"><a href="#2-2-é…ç½®sockaddr-in" class="headerlink" title="2.2 é…ç½®sockaddr_in"></a>2.2 é…ç½®sockaddr_in</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. ç»‘å®šç½‘ç»œä¿¡æ¯ï¼ŒæŒ‡æ˜ip+port</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">local</span>;</span></span><br><span class="line"><span class="built_in">memset</span>(&amp;local,<span class="number">0</span>,<span class="keyword">sizeof</span>(local));<span class="comment">//é…ç½®ä¸º 0</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºç”¨çš„æ˜¯<code>ipv4</code>çš„ç½‘ç»œé€šä¿¡ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦åˆå§‹åŒ–ä¸€ä¸ª<code>sockaddr_in</code>ç±»å‹</p><p>æ­¤æ—¶åœ¨vscodeçš„ä»£ç è¡¥å…¨ä¸­ï¼Œå¯ä»¥çœ‹åˆ°4ä¸ªæˆå‘˜ï¼Œéœ€è¦å¯¹å®ƒä»¬èµ‹å€¼ä»¥é…ç½®æœåŠ¡å™¨ä¿¡æ¯</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/202302021529616.png"                      alt="image-20230202152944512"                ></p><p>é¦–å…ˆæ˜¯æŠŠåè®®å®¶æ—è®¾ç½®ä¸º<code>IPV4</code>ï¼Œç«¯å£é…ç½®ä¸ºå‡½æ•°å‚æ•°ä¸­çš„ç«¯å£</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åè®®å®¶æ—ï¼Œè®¾ç½®ä¸ºipv4</span></span><br><span class="line">local.sin_family = AF_INET; </span><br><span class="line"><span class="comment">// ç«¯å£ï¼Œéœ€è¦è¿›è¡Œ æœ¬åœ°-&gt;ç½‘ç»œè½¬æ¢</span></span><br><span class="line">local.sin_port = htons(_port);</span><br></pre></td></tr></table></figure><p>éšåé…ç½®ip</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœåˆå§‹åŒ–æ—¶å€™çš„ipä¸ºç©ºï¼Œåˆ™è°ƒç”¨INADDR_ANYä»£è¡¨ä»»æ„ipã€‚å¦åˆ™å¯¹ä¼ å…¥çš„ipè¿›è¡Œè½¬æ¢åèµ‹å€¼</span></span><br><span class="line">local.sin_addr.s_addr = _ip.empty() ? htonl(INADDR_ANY) : inet_addr(ip_.c_str());</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé‡‡ç”¨äº†<code>?:</code>ä¸‰ç›®æ“ä½œç¬¦ï¼Œå¦‚æœç±»æ„é€ çš„æ—¶å€™ä¼ å…¥çš„ipæ˜¯ç©ºï¼ˆæ²¡æœ‰é…ç½®ipï¼‰é‚£å°±ç›´æ¥è®¾ç½®ä¸ºä»»æ„ipï¼Œå¦åˆ™ä¼ å…¥æˆå‘˜å˜é‡ï¼›</p><p>è¿™æ ·å¯¹<code>sockaddr_in</code>çš„é…ç½®å°±å®Œæˆäº†ã€‚</p><h3 id="2-2-1-inet-addr"><a href="#2-2-1-inet-addr" class="headerlink" title="2.2.1 inet_addr"></a>2.2.1 inet_addr</h3><p>è¿™é‡Œéœ€è¦ä½¿ç”¨<code>inet_addr</code>å‡½æ•°å¯¹ä¼ å…¥çš„å­—ç¬¦ä¸²ç±»å‹çš„ipï¼ˆå¦‚<code>192.168.0.1</code>ï¼‰è¿›è¡Œè½¬æ¢</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">in_addr_t</span> <span class="title function_">inet_addr</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *cp)</span>;<span class="comment">//å¯¹å­—ç¬¦ä¸²ipè¿›è¡Œè½¬æ¢</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºå¯¹äºç½‘ç»œæ¥è¯´ï¼Œå®ƒå¹¶ä¸è®¤è¯†å­—ç¬¦ä¸²ç±»å‹çš„ipï¼Œè€Œæ˜¯è¦ç”¨ç½‘ç»œå­—èŠ‚æµè§„å®šçš„ç±»å‹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Internet address.  */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">uint32_t</span> <span class="type">in_addr_t</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">in_addr</span></span></span><br><span class="line"><span class="class">  &#123;</span></span><br><span class="line">    <span class="type">in_addr_t</span> s_addr;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure><p>å¯¹äºè¯¥æ¥å£çš„åº•å±‚åšä¸€ä¸ªç®€å•çš„è¯´æ˜ï¼šå…¶å®å°±æ˜¯åˆ©ç”¨<code>ä½æ®µ</code>ï¼Œå°†æ•°æ®è½¬æ¢ä¸ºä¸€ä¸ªç‰¹æ®Šçš„ç±»å‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¤ºä¾‹ï¼Œéåº•å±‚å®ç°</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ip</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">uint32_t</span> part1:<span class="number">8</span>;</span><br><span class="line">    <span class="type">uint32_t</span> part2:<span class="number">8</span>;</span><br><span class="line">    <span class="type">uint32_t</span> part3:<span class="number">8</span>;</span><br><span class="line">    <span class="type">uint32_t</span> part4:<span class="number">8</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-2-inet-ntoa"><a href="#2-2-2-inet-ntoa" class="headerlink" title="2.2.2 inet_ntoa"></a>2.2.2 inet_ntoa</h3><p>åŒæ ·çš„ï¼Œå¦‚æœæˆ‘ä»¬ä½œä¸ºå®¢æˆ·ç«¯æ¥å—åˆ°äº†ç½‘ç»œè¯·æ±‚ä¸­çš„ipï¼Œå¯ä»¥ç”¨<code>inet_ntoa</code>å°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *<span class="title function_">inet_ntoa</span><span class="params">(<span class="keyword">struct</span> in_addr in)</span>;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±å¼•ç”³å‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼šè¿”å›å€¼çš„<code>char*</code>æ˜¯å­˜åœ¨å“ªé‡Œçš„ï¼Ÿæ˜¯é™æ€åŒºè¿˜æ˜¯<code>malloc</code>ï¼Ÿ</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/202302031015260.png"                      alt="image-20230203101540180"                ></p><p>æ‰‹å†Œå‘Šè¯‰æˆ‘ä»¬ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯ç»´æŠ¤äº†ä¸€ä¸ªstaticå˜é‡æ¥å­˜æ”¾è¿”å›çš„ipçš„ã€‚</p><p>å› æ­¤ï¼Œè¯¥å‡½æ•°å¹¶<strong>ä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨</strong>çš„å‡½æ•°ï¼Œåœ¨<code>APUE</code>ä¸­æ˜ç¡®æ ‡æ˜äº†è¿™ä¸€ç‚¹</p><hr><h2 id="2-3-bindç»‘å®šipç«¯å£"><a href="#2-3-bindç»‘å®šipç«¯å£" class="headerlink" title="2.3 bindç»‘å®šipç«¯å£"></a>2.3 bindç»‘å®šipç«¯å£</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span>          <span class="comment">/* See NOTES */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">bind</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> <span class="keyword">struct</span> sockaddr *addr,</span></span><br><span class="line"><span class="params">         <span class="type">socklen_t</span> addrlen)</span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ¥å£çš„ä½œç”¨å°±æ˜¯æŒ‡å®šsocketå’Œsockaddrè¿›è¡Œç»‘å®šã€‚ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯addrå…ƒç´ çš„å¤§å°ï¼ˆä¸æ˜¯æŒ‡é’ˆå¤§å°ï¼Œåˆ«æé”™äº†ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.2 ç»‘å®šipç«¯å£</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">bind</span>(_sockfd,(<span class="type">const</span> <span class="keyword">struct</span> sockaddr *)&amp;local, <span class="built_in">sizeof</span>(local)) == <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">logging</span>(FATAL, <span class="string">&quot;bind: %s:%d&quot;</span>, <span class="built_in">strerror</span>(errno), _sockfd);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">logging</span>(DEBUG,<span class="string">&quot;socket bind success: %d&quot;</span>, _sockfd);</span><br></pre></td></tr></table></figure><p>ç»‘å®šäº†ä¹‹åï¼Œæˆ‘ä»¬çš„æœåŠ¡å™¨å°±é…ç½®æˆåŠŸäº†</p><p>æµ‹è¯•ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°ç¼–è¯‘æ²¡æœ‰æŠ¥é”™ï¼Œä¹Ÿèƒ½æ­£å¸¸è¿è¡Œï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/23-02-01 udp]$ make udpServer</span><br><span class="line">g++ -o udpServer udpServer.cpp -std=c++11</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/23-02-01 udp]$ ./udpServer</span><br><span class="line">DEBUG | 1675326460 | muxue | socket create success: 3</span><br><span class="line">DEBUG | 1675326460 | muxue | socket bind success: 3</span><br></pre></td></tr></table></figure><h3 id="2-3-1-main"><a href="#2-3-1-main" class="headerlink" title="2.3.1 main"></a>2.3.1 main</h3><p>ç°åœ¨å…ˆæ¥ç®€å•å†™ä¸€ä¸‹mainå‡½æ•°ä¸­å¯åŠ¨æœåŠ¡çš„å‘½ä»¤è¡Œå‚æ•°å§</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//å‚æ•°åªæœ‰ä¸¤ä¸ªï¼ˆç«¯å£/ipï¼‰æ‰€ä»¥å‚æ•°ä¸ªæ•°åº”è¯¥æ˜¯2-3</span></span><br><span class="line">    <span class="keyword">if</span>(argc!=<span class="number">2</span> &amp;&amp; argc!=<span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Usage: &quot;</span> &lt;&lt; argv[<span class="number">0</span>] &lt;&lt; <span class="string">&quot; port [ip]&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="built_in">string</span> ip;</span><br><span class="line">    <span class="comment">// 3ä¸ªå‚æ•°ï¼Œæœ‰ip</span></span><br><span class="line">    <span class="keyword">if</span>(argc==<span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        ip = argv[<span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    UdpServer <span class="title function_">s</span><span class="params">(atoi(argv[<span class="number">1</span>]),ip)</span>;</span><br><span class="line">    s.start();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†æµ‹è¯•ï¼Œå…ˆæŠŠ<code>start()</code>å‡½æ•°è®¾ç½®ä¸ºä¸€ä¸ªæ­»å¾ªç¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">start</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;running &quot;</span> &lt;&lt; getpid() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘è¿è¡Œï¼Œå¯ä»¥çœ‹åˆ°é”™è¯¯æç¤ºæ˜¯å¯ä»¥ç”¨çš„ã€‚æ­£ç¡®æ·»åŠ å‚æ•°ä¹‹åï¼Œä¹Ÿèƒ½ç»‘å®šå¹¶å¼€å§‹è¿è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/23-02-01 udp]$ make udpServer</span><br><span class="line">g++ -o udpServer udpServer.cpp -std=c++11</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/23-02-01 udp]$ ./udpServer</span><br><span class="line">Usage: ./udpServer port [ip]</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/23-02-01 udp]$ ./udpServer 8080</span><br><span class="line">DEBUG | 1675327610 | muxue | socket create success: 3</span><br><span class="line">DEBUG | 1675327610 | muxue | socket bind success: 3</span><br><span class="line">running 4467</span><br><span class="line">running 4467</span><br><span class="line">running 4467</span><br><span class="line">^C</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<code>bind</code>è¿™ä¸ªå‡½æ•°æ˜¯<strong>ä¸å…è®¸ä½ ç»‘å®šäº‘æœåŠ¡å™¨çš„å…¬ç½‘ipçš„</strong>ã€‚å› ä¸ºäº‘æœåŠ¡å™¨å¹¶ä¸æ˜¯ç›´æ¥æš´éœ²åœ¨å…¬ç½‘ä¸Šçš„ï¼Œè€Œæ˜¯ç”±æä¾›å•†çš„å…¥å£æœåŠ¡å™¨è¿›å…¥å†…ç½‘ï¼Œåœ¨è¿›å…¥ä½ çš„æœåŠ¡å™¨ã€‚æ‰€ä»¥ä»–ä¸å…è®¸ä½ ç»‘å®šå…¬ç½‘ipï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ./udpServer 8080 äº‘æœåŠ¡å™¨å…¬ç½‘ip</span><br><span class="line">DEBUG | 1675327690 | muxue | socket create success: 3</span><br><span class="line">FATAL | 1675327690 | muxue | bind: Cannot assign requested address:3</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯ä»¥é€‰æ‹©ä¸ç»‘å®šipï¼Œæˆ–è€…ç»‘å®šæœ¬åœ°ç«¯å£<code>127.0.0.1</code></p><blockquote><p>å¦‚æœç»‘å®šäº†<code>127.0.0.1</code>ï¼Œé‚£ä¹ˆæœåŠ¡åªæœ‰æœ¬åœ°å¯ä»¥è®¿é—®ã€‚ä¸ç»‘å®šç«¯å£ï¼Œå°±ä¼šé»˜è®¤ç»‘å®šæˆ<code>0.0.0.0</code>ï¼Œå…è®¸æœ¬åœ°å’Œè¿œç¨‹ç«¯å£è¿æ¥</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ./udpServer 8080 127.0.0.1</span><br><span class="line">DEBUG | 1675327757 | muxue | socket create success: 3</span><br><span class="line">DEBUG | 1675327757 | muxue | socket bind success: 3</span><br><span class="line">running 5067</span><br><span class="line">running 5067</span><br></pre></td></tr></table></figure><h3 id="2-3-2-netstat"><a href="#2-3-2-netstat" class="headerlink" title="2.3.2 netstat"></a>2.3.2 netstat</h3><p>å¯ä»¥ç”¨<code>netstat -lnup</code>å‘½ä»¤æŸ¥çœ‹å½“å‰å¼€æ”¾çš„ç«¯å£ä¿¡æ¯</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/202302021651339.png"                      alt="image-20230202165149257"                ></p><p>å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€è¡Œå°±æ˜¯æˆ‘ä»¬çš„udpæœåŠ¡å™¨ï¼Œæœ¬åœ°ç«¯å£æ˜¯æˆ‘ä»¬ç»‘å®šçš„<code>127.0.0.1:8080</code>ï¼Œè¿œç¨‹ç«¯å£æ˜¯<code>0.0.0.0:*</code>ï¼Œä»£è¡¨å…è®¸ä»»ä½•è¿œç¨‹ipçš„ä»»ä½•ç«¯å£æ¥è®¿é—®</p><h2 id="2-4-å¼€å§‹è¿è¡Œ"><a href="#2-4-å¼€å§‹è¿è¡Œ" class="headerlink" title="2.4 å¼€å§‹è¿è¡Œ"></a>2.4 å¼€å§‹è¿è¡Œ</h2><p>ä¸Šé¢çš„æ“ä½œåªæ˜¯åˆå§‹åŒ–äº†è¿™ä¸ªudpæœåŠ¡å™¨çš„ä¿¡æ¯ï¼Œå¹¶æ²¡æœ‰è®©å®ƒçœŸæ­£çš„è¿è¡Œèµ·æ¥ï¼›</p><p>æ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯è®©æœåŠ¡å™¨å¼€å§‹æ¥æ”¶ä¿¡æ¯ï¼Œå¹¶åœ¨å±å¹•ä¸Šæ‰“å°å‡ºæ¥</p><h3 id="2-4-1-recvfrom"><a href="#2-4-1-recvfrom" class="headerlink" title="2.4.1 recvfrom"></a>2.4.1 recvfrom</h3><p>è¿™ä¸ªæ¥å£çš„ä½œç”¨æ˜¯æ¥æ¥æ”¶ä¿¡æ¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">recvfrom</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">void</span> *buf, <span class="type">size_t</span> len, <span class="type">int</span> flags,</span></span><br><span class="line"><span class="params">                 <span class="keyword">struct</span> sockaddr *src_addr, <span class="type">socklen_t</span> *addrlen)</span>;</span><br></pre></td></tr></table></figure><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å‰é¢åˆ›å»ºçš„å¥—æ¥å­—</li><li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯ç”¨æ¥æ¥æ”¶ä¿¡æ¯çš„ç¼“å†²åŒº</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ç¼“å†²åŒºçš„å¤§å°</li><li>ç¬¬å››ä¸ªå‚æ•°æ˜¯æ ‡è¯†ç¬¦ï¼Œè®¾ç½®ä¸º0ï¼Œä»£è¡¨<strong>é˜»å¡ç­‰å¾…</strong></li><li>ç¬¬äº”ä¸ªå‚æ•°ï¼Œè¾“å‡ºå‹å‚æ•°ï¼Œè·å–å‘é€æ–¹çš„ä¿¡æ¯</li><li>ç¬¬å…­ä¸ªå‚æ•°ï¼Œè¾“å…¥è¾“å‡ºå‹å‚æ•°ï¼Œéœ€è¦åˆå§‹åŒ–ä¸º<code>sizeof(src_addr)</code></li></ul><p>å‡½æ•°çš„è¿”å›å€¼æ˜¯æ¥æ”¶åˆ°çš„æ•°æ®çš„é•¿åº¦ï¼Œæ²¡æœ‰æ¥æ”¶åˆ°æˆ–è€…æ¥å—å¤±è´¥ï¼Œåˆ™ä¸º<code>-1</code></p><p>ç¤ºä¾‹å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> inBuf[BUF_SIZE];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">peer</span>;</span>      <span class="comment">//è¾“å‡ºå‹å‚æ•°</span></span><br><span class="line"><span class="type">socklen_t</span> len = <span class="keyword">sizeof</span>(peer); <span class="comment">//è¾“å…¥è¾“å‡ºå‹å‚æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// peerå’Œlenéƒ½æ˜¯è¾“å‡ºå‹å‚æ•°ï¼Œç”¨äºè·å–å‘é€æ–¹çš„ä¿¡æ¯</span></span><br><span class="line"><span class="comment">// lenæ˜¯è¾“å…¥è¾“å‡ºå‹å‚æ•°ï¼Œéœ€è¦ä»¥sizeof(peer)åˆå§‹åŒ–åä¼ å…¥</span></span><br><span class="line"><span class="comment">// ç¬¬ä¸‰ä¸ªå‚æ•°0ä¸ºé»˜è®¤ç­‰å¾…æ–¹å¼ï¼ˆé˜»å¡ç­‰å¾…ï¼‰</span></span><br><span class="line"><span class="type">ssize_t</span> s = recvfrom(_sockfd, inBuf, <span class="keyword">sizeof</span>(inBuf)<span class="number">-1</span>,<span class="number">0</span>,(<span class="keyword">struct</span> sockaddr *)&amp;peer, &amp;len);</span><br><span class="line"><span class="keyword">if</span> (s &gt; <span class="number">0</span>) <span class="comment">// sä»£è¡¨è·å–åˆ°çš„æ•°æ®é•¿åº¦ï¼Œä¸ä¸º0ä»£è¡¨æˆåŠŸè·å–</span></span><br><span class="line">&#123;</span><br><span class="line">    inBuf[s] = <span class="string">&#x27;\0&#x27;</span>; <span class="comment">//æœ«å°¾è¿½åŠ &#x27;\0&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (s == <span class="number">-1</span>) <span class="comment">// -1æ²¡æœ‰æ”¶åˆ°ä¿¡æ¯ï¼Œé”™è¯¯</span></span><br><span class="line">&#123;</span><br><span class="line">    logging(WARINING, <span class="string">&quot;recvfrom: %s:%d&quot;</span>, strerror(errno), _sockfd);</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±èƒ½åœ¨<code>inBuf</code>ä¸­ç›´æ¥è·å–åˆ°å‘é€ä¿¡æ¯çš„å†…å®¹</p><h2 id="2-5-æœåŠ¡ç«¯start"><a href="#2-5-æœåŠ¡ç«¯start" class="headerlink" title="2.5 æœåŠ¡ç«¯start"></a>2.5 æœåŠ¡ç«¯start</h2><p>ä»¥ä¸‹æ˜¯æœåŠ¡ç«¯è¿è¡Œçš„å®Œæ•´ä»£ç </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">start</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">char</span> inBuf[BUF_SIZE];<span class="comment">//æ¥æ”¶åˆ°ä¿¡æ¯çš„ç¼“å†²åŒº</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> peer;      <span class="comment">//è¾“å‡ºå‹å‚æ•°</span></span><br><span class="line">        <span class="type">socklen_t</span> len = <span class="built_in">sizeof</span>(peer); <span class="comment">//è¾“å…¥è¾“å‡ºå‹å‚æ•°</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// peerå’Œlenéƒ½æ˜¯è¾“å‡ºå‹å‚æ•°ï¼Œç”¨äºè·å–å‘é€æ–¹çš„ä¿¡æ¯</span></span><br><span class="line">        <span class="comment">// lenæ˜¯è¾“å…¥è¾“å‡ºå‹å‚æ•°ï¼Œéœ€è¦ä»¥sizeof(peer)åˆå§‹åŒ–åä¼ å…¥</span></span><br><span class="line">        <span class="comment">// ç¬¬ä¸‰ä¸ªå‚æ•°0ä¸ºé»˜è®¤ç­‰å¾…æ–¹å¼ï¼ˆé˜»å¡ç­‰å¾…ï¼‰</span></span><br><span class="line">        <span class="type">ssize_t</span> s = <span class="built_in">recvfrom</span>(_sockfd, inBuf, <span class="built_in">sizeof</span>(inBuf)<span class="number">-1</span>,<span class="number">0</span>,(<span class="keyword">struct</span> sockaddr *)&amp;peer, &amp;len);</span><br><span class="line">        <span class="keyword">if</span> (s &gt; <span class="number">0</span>) <span class="comment">// sä»£è¡¨è·å–åˆ°çš„æ•°æ®é•¿åº¦ï¼Œä¸ä¸º0ä»£è¡¨æˆåŠŸè·å–</span></span><br><span class="line">        &#123;</span><br><span class="line">            inBuf[s] = <span class="string">&#x27;\0&#x27;</span>; <span class="comment">//æœ«å°¾è¿½åŠ &#x27;\0&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s == <span class="number">-1</span>) <span class="comment">// -1æ²¡æœ‰æ”¶åˆ°ä¿¡æ¯ï¼Œé”™è¯¯</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">logging</span>(WARINING, <span class="string">&quot;recvfrom: %s:%d&quot;</span>, <span class="built_in">strerror</span>(errno), _sockfd);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        string senderIP = <span class="built_in">inet_ntoa</span>(peer.sin_addr);<span class="comment">// æ¥æºip</span></span><br><span class="line">        <span class="type">uint16_t</span> senderPort = <span class="built_in">ntohs</span>(peer.sin_port); <span class="comment">// æ¥æºç«¯å£</span></span><br><span class="line">        <span class="built_in">logging</span>(NOTICE, <span class="string">&quot;[%s:%d]# %s&quot;</span>, senderIP.<span class="built_in">c_str</span>(),senderPort, inBuf);<span class="comment">//æ‰“å°ä¿¡æ¯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ æƒ³è®©å¦å¤–ä¸€å°ä¸»æœºè®¿é—®è¿™ä¸ªæœåŠ¡ï¼Œåˆ™éœ€è¦åœ¨<strong>äº‘æœåŠ¡å™¨æ§åˆ¶å°å’Œlinuxç³»ç»Ÿ</strong>ä¸­åŒæ—¶å¼€æ”¾å¯¹åº”çš„udpç«¯å£</p><blockquote><p>å‚è€ƒ <a href="https://blog.musnow.top/2023/01/21/note_linux/24%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BC%80%E6%94%BE%E7%AB%AF%E5%8F%A3%E9%97%AE%E9%A2%98/">ã€Linuxã€‘è®¾ç½®ç³»ç»Ÿé˜²ç«å¢™</a></p></blockquote><h1 id="3-client"><a href="#3-client" class="headerlink" title="3.client"></a>3.client</h1><p>æœ‰äº†æœåŠ¡ç«¯ï¼Œä¹Ÿè¦æœ‰å¯¹åº”çš„å®¢æˆ·ç«¯æ¥å‘é€æ¶ˆæ¯ï¼›é™¤äº†å‘é€æ¶ˆæ¯çš„éƒ¨åˆ†ï¼Œå…¶ä½™æ“ä½œå’ŒæœåŠ¡ç«¯åŸºæœ¬ä¸€è‡´ã€‚</p><h2 id="3-1-sendto"><a href="#3-1-sendto" class="headerlink" title="3.1 sendto"></a>3.1 sendto</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">send</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> <span class="type">void</span> *buf, <span class="type">size_t</span> len, <span class="type">int</span> flags)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">sendto</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> <span class="type">void</span> *buf, <span class="type">size_t</span> len, <span class="type">int</span> flags,</span></span><br><span class="line"><span class="params">               <span class="type">const</span> <span class="keyword">struct</span> sockaddr *dest_addr, <span class="type">socklen_t</span> addrlen)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">sendmsg</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> <span class="keyword">struct</span> msghdr *msg, <span class="type">int</span> flags)</span>;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬è¦ç”¨çš„æ˜¯<code>sendto</code>æ¥å£</p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯socketå¥—æ¥å­—</li><li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯ç”¨äºè¾“å…¥çš„ç¼“å†²åŒº</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ç¼“å†²åŒºçš„ç±»å‹</li><li>ç¬¬å››ä¸ªå‚æ•°æ˜¯æ ‡è¯†ç¬¦ï¼Œä¹Ÿè®¾ç½®ä¸º0</li><li>ç¬¬äº”ä¸ªå‚æ•°å’Œç¬¬å…­ä¸ªå‚æ•°ä¸<code>recvfrom</code>ä¸€è‡´ï¼Œä¸ºç›®æ ‡æœåŠ¡å™¨çš„ä¿¡æ¯</li></ul><p>å…³äºflagå‚æ•°ï¼Œmanæ‰‹å†Œä¸­æœ‰æ›´å¤šé€‰é¡¹ï¼Œè¿™é‡Œæˆ‘ä»¬ä¾æ—§ä¼ å…¥0é‡‡ç”¨é»˜è®¤ç­–ç•¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The flags argument is the bitwise OR of zero or more of the following flags.</span><br></pre></td></tr></table></figure><h2 id="3-2-å®¢æˆ·ç«¯éœ€ä¸éœ€è¦æ‰‹åŠ¨bind"><a href="#3-2-å®¢æˆ·ç«¯éœ€ä¸éœ€è¦æ‰‹åŠ¨bind" class="headerlink" title="3.2 å®¢æˆ·ç«¯éœ€ä¸éœ€è¦æ‰‹åŠ¨bind?"></a>3.2 å®¢æˆ·ç«¯éœ€ä¸éœ€è¦æ‰‹åŠ¨bind?</h2><p>é¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®ä¸€ç‚¹ï¼Œbindå‡½æ•°å¹¶æ²¡æœ‰è§„å®šä¸€å®šè¦æ˜¯æœåŠ¡ç«¯æ‰èƒ½ä½¿ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦ä¸è¦ä½¿ç”¨bindæ˜¯ç¨‹åºçŒ¿è‡ªå·±çš„é€‰æ‹©ã€‚</p><p>ç­”æ¡ˆå…¶å®å¾ˆç®€å•ï¼šé‚£å°±æ˜¯ä¸éœ€è¦æ‰‹åŠ¨bind</p><p>é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ä¸€ç‚¹ï¼šå¦‚æœä¸€ä¸ªç½‘ç»œè¿›ç¨‹åœ¨å¯åŠ¨çš„æ—¶å€™æ²¡æœ‰æ‰‹åŠ¨bindç«¯å£ï¼Œç³»ç»Ÿæ˜¯ä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªæœªä½¿ç”¨çš„ç«¯å£ç»™å®ƒçš„</p><ul><li>å¯¹äºæœåŠ¡å™¨æ¥è¯´ï¼Œ<code>IP:ç«¯å£</code>å¿…é¡»å›ºå®šï¼Œå¦åˆ™æ²¡æœ‰åŠæ³•ç»™å®¢æˆ·ç«¯æä¾›ç¨³å®šçš„æœåŠ¡ã€‚å®¢æˆ·åˆä¸èƒ½æ‹†äº†ä½ çš„åº”ç”¨ç¨‹åºä¿®æ”¹æºç ä¸­çš„ç«¯å£ï¼</li><li>è€Œå¯¹äºå®¢æˆ·ç«¯æ¥è¯´ï¼Œç«¯å£åº”è¯¥è®©ç³»ç»Ÿè‡ªåŠ¨åˆ†é…ã€‚å› ä¸ºè¿™æ ·èƒ½é¿å…å†²çªé—®é¢˜ã€‚ä¸ç„¶å¦‚æœæœ‰å¦å¤–ä¸€ä¸ªåº”ç”¨å ç”¨äº†å®¢æˆ·ç«¯bindçš„ç«¯å£ï¼Œé‚£è¿™ä¸ªç¨‹åºå°±ä¼šå› ä¸º<strong>ç«¯å£å†²çª</strong>è€Œä¸€ç›´æ‰“ä¸å¼€ï¼</li></ul><p>æ‰€ä»¥ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦æˆ‘ä»¬è°ƒç”¨bindå‡½æ•°ï¼Œåªéœ€è¦é…ç½®å¥½æœåŠ¡ç«¯çš„ç›®æ ‡ipå’Œç›®æ ‡ç«¯å£å°±è¡Œäº†</p><h2 id="3-3-ä»£ç ç¤ºä¾‹"><a href="#3-3-ä»£ç ç¤ºä¾‹" class="headerlink" title="3.3 ä»£ç ç¤ºä¾‹"></a>3.3 ä»£ç ç¤ºä¾‹</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;strings.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">server</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ./udpClient server_ip server_port</span></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯è¦è¿æ¥serverï¼Œå¿…é¡»çŸ¥é“serverå¯¹åº”çš„ipå’Œport</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Usage:\n\t&quot;</span> &lt;&lt; argv[<span class="number">0</span>] &lt;&lt; <span class="string">&quot; server_ip server_port&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1. æ ¹æ®å‘½ä»¤è¡Œï¼Œè®¾ç½®è¦è®¿é—®çš„æœåŠ¡å™¨IP</span></span><br><span class="line">    <span class="built_in">string</span> server_ip = argv[<span class="number">1</span>];</span><br><span class="line">    <span class="type">uint16_t</span> server_port = atoi(argv[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. åˆ›å»ºå®¢æˆ·ç«¯</span></span><br><span class="line">    <span class="comment">// 2.1 åˆ›å»ºsocket</span></span><br><span class="line">    <span class="type">int</span> sockfd = socket(AF_INET, SOCK_DGRAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span>(sockfd&lt;<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;socket åˆ›å»ºå¤±è´¥&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    bzero(&amp;server, <span class="keyword">sizeof</span>(server));<span class="comment">//è¿™ä¸ªå‡½æ•°ç›¸å½“äºmemsetå…¨0</span></span><br><span class="line"></span><br><span class="line">    server.sin_family = AF_INET;<span class="comment">//ipv4</span></span><br><span class="line">    server.sin_port = htons(server_port);<span class="comment">//ç›®æ ‡æœåŠ¡å™¨ç«¯å£</span></span><br><span class="line">    server.sin_addr.s_addr = inet_addr(server_ip.c_str());<span class="comment">//ç›®æ ‡ip</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. é€šè®¯è¿‡ç¨‹</span></span><br><span class="line">    <span class="built_in">string</span> buffer;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;Please Enter# &quot;</span>;</span><br><span class="line">        getline(<span class="built_in">cin</span>, buffer);</span><br><span class="line">        <span class="comment">// å‘é€æ¶ˆæ¯ç»™server</span></span><br><span class="line">        sendto(sockfd, buffer.c_str(), buffer.size(), <span class="number">0</span>,</span><br><span class="line">               (<span class="type">const</span> <span class="keyword">struct</span> sockaddr *)&amp;server, <span class="keyword">sizeof</span>(server)); </span><br><span class="line">        <span class="comment">// é¦–æ¬¡è°ƒç”¨sendtoå‡½æ•°çš„æ—¶å€™ï¼Œclientä¼šè‡ªåŠ¨bindè‡ªå·±çš„ipå’Œport</span></span><br><span class="line">        <span class="comment">// å®¢æˆ·ç«¯ä¸åº”è¯¥è‡ªå·±ç»‘å®šç«¯å£ï¼Œå¦åˆ™ç«¯å£è¢«å ç”¨=å®¢æˆ·ç«¯ä¸èƒ½ç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    close(sockfd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-4-è¿è¡Œæµ‹è¯•"><a href="#3-4-è¿è¡Œæµ‹è¯•" class="headerlink" title="3.4 è¿è¡Œæµ‹è¯•"></a>3.4 è¿è¡Œæµ‹è¯•</h2><p>è¿™é‡Œæä¾›ä¸€ä¸ªmakefileï¼Œæ¥å¿«é€Ÿç¼–è¯‘æœåŠ¡ç«¯&#x2F;å®¢æˆ·ç«¯çš„æºç </p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><span class="keyword">.PHONY</span>:all</span></span><br><span class="line"><span class="section">all:udpClient udpServer</span></span><br><span class="line"></span><br><span class="line"><span class="section">udpClient: udpClient.cpp</span></span><br><span class="line">g++ -o <span class="variable">$@</span> <span class="variable">$^</span> -std=c++11 -lpthread</span><br><span class="line"><span class="section">udpServer:udpServer.cpp</span></span><br><span class="line">g++ -o <span class="variable">$@</span> <span class="variable">$^</span> -std=c++11</span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>:clean</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">rm -f udpClient udpServer</span><br></pre></td></tr></table></figure><p>è¿è¡ŒæœåŠ¡å™¨ï¼ŒæŒ‡å®š8080ç«¯å£å¯åŠ¨ã€‚å†è¿è¡Œå®¢æˆ·ç«¯ï¼ŒæŒ‡å®š<code>127.0.0.1</code>æœ¬åœ°ipå’Œ8080ç«¯å£</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/202302022129061.png"                      alt="image-20230202212859925"                ></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå³ä¾§æˆ‘ä»¬æ”¶åˆ°çš„ä¿¡æ¯ï¼Œéƒ½åœ¨å·¦ä¾§è¢«æ‰“å°äº†å‡ºæ¥ï¼ŒåŒæ—¶æ˜¾ç¤ºäº†æ¥æºipå’Œç«¯å£</p><h2 id="3-5-windowså®¢æˆ·ç«¯"><a href="#3-5-windowså®¢æˆ·ç«¯" class="headerlink" title="3.5 windowså®¢æˆ·ç«¯"></a>3.5 windowså®¢æˆ·ç«¯</h2><p>è®©æˆ‘æ²¡æƒ³åˆ°çš„æ˜¯ï¼Œwindowsä¸Šç½‘ç»œçš„æ¥å£å’Œlinuxå¾ˆç›¸ä¼¼ï¼›è¿™é‡Œæä¾›ä¸€ä¸ªwindowsä¸‹çš„udpå®¢æˆ·ç«¯ï¼Œå‘æˆ‘ä»¬çš„äº‘æœåŠ¡å™¨å‘é€ä¿¡æ¯</p><p>æ³¨ï¼šè¿›è¡Œæµ‹è¯•å‰ï¼Œä¸€å®šè¦åœ¨é˜²ç«å¢™é‡Œé¢å¼€æ”¾äº‘æœåŠ¡å™¨å¯¹åº”çš„udpç«¯å£</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _WINSOCK_DEPRECATED_NO_WARNINGS 1<span class="comment">//å±è”½æŠ¥é”™</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;winsock2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;ws2_32.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUFFER_SIZE  1024    <span class="comment">//ç¼“å†²åŒºå¤§å°</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    WSADATA WSAData;</span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">WSAStartup</span>(<span class="built_in">MAKEWORD</span>(<span class="number">2</span>, <span class="number">2</span>), &amp;WSAData) != <span class="number">0</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;åˆå§‹åŒ–å¤±è´¥!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="comment">//åˆ›å»ºå®¢æˆ·ç«¯ç”¨äºé€šä¿¡çš„Socket</span></span><br><span class="line">    SOCKET sock_Client = <span class="built_in">socket</span>(AF_INET, SOCK_DGRAM, IPPROTO_UDP);</span><br><span class="line">    <span class="comment">//æœåŠ¡å™¨çš„åœ°å€æ•°æ®ç»“æ„</span></span><br><span class="line">    SOCKADDR_IN addr_server;   </span><br><span class="line">    addr_server.sin_family = AF_INET;</span><br><span class="line">    addr_server.sin_port = <span class="built_in">htons</span>(<span class="number">10000</span>);<span class="comment">// ç›®æ ‡ç«¯å£</span></span><br><span class="line">    addr_server.sin_addr.S_un.S_addr = <span class="built_in">inet_addr</span>(<span class="string">&quot;127.0.0.1&quot;</span>); <span class="comment">//ç›®æ ‡å…¬ç½‘ip(éœ€è¦æ”¹æˆä½ è‡ªå·±çš„)</span></span><br><span class="line"></span><br><span class="line">    string sendBuf;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;è¯·è¾“å…¥è¦ä¼ é€çš„æ•°æ®: &quot;</span>;</span><br><span class="line">        <span class="built_in">getline</span>(cin,sendBuf);</span><br><span class="line">        <span class="built_in">sendto</span>(sock_Client, sendBuf.<span class="built_in">c_str</span>(),sendBuf.<span class="built_in">size</span>(), <span class="number">0</span>, (<span class="type">const</span> SOCKADDR*)&amp;addr_server, <span class="built_in">sizeof</span>(addr_server));</span><br><span class="line">        cout &lt;&lt; sendBuf.<span class="built_in">size</span>() &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; sendBuf &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">closesocket</span>(sock_Client);</span><br><span class="line">    <span class="built_in">WSACleanup</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°äº‘æœåŠ¡å™¨æˆåŠŸæ”¶åˆ°äº†ä¿¡æ¯ï¼Œä½†å› ä¸ºwindowså’Œlinuxçš„æ–‡å­—ç¼–ç é—®é¢˜ï¼Œæ²¡èƒ½æ­£ç¡®æ˜¾ç¤ºå‡ºä¸­æ–‡</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/202302022133966.png"                      alt="image-20230202213301914"                ></p><p>å‘é€è‹±æ–‡ä¿¡æ¯æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/202302022133864.png"                      alt="image-20230202213359805"                ></p><h1 id="4-æ›´è¿›ä¸€æ­¥"><a href="#4-æ›´è¿›ä¸€æ­¥" class="headerlink" title="4.æ›´è¿›ä¸€æ­¥"></a>4.æ›´è¿›ä¸€æ­¥</h1><h2 id="4-1-è®°å½•ç”¨æˆ·"><a href="#4-1-è®°å½•ç”¨æˆ·" class="headerlink" title="4.1 è®°å½•ç”¨æˆ·"></a>4.1 è®°å½•ç”¨æˆ·</h2><p>æœ‰ç”¨æˆ·ç»™ä½ å‘é€ä¿¡æ¯ï¼Œç†è®ºä¸Šæ¥è¯´ï¼ŒæœåŠ¡ç«¯åº”è¯¥è®°å½•ä¸‹ç”¨æˆ·ï¼Œä»¥å¤‡debug;</p><p>è¿™éƒ¨åˆ†å¹¶ä¸éš¾ï¼Œæˆ‘ä»¬è®°å½•ä¸‹ç”¨æˆ·çš„ipå’Œç«¯å£ï¼Œè¿˜æœ‰ç”¨æˆ·çš„peerç»“æ„ä½“ï¼Œåœ¨æœåŠ¡å™¨é‡Œé¢ç»´æŠ¤ä¸€ä¸ªmapæ¥å­˜æ”¾å°±å¯ä»¥äº†</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CheckUser</span><span class="params">(<span class="keyword">struct</span> sockaddr_in peer)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string tmp = <span class="built_in">inet_ntoa</span>(peer.sin_addr);<span class="comment">// æ¥æºip</span></span><br><span class="line">    tmp += <span class="string">&#x27;:&#x27;</span>;</span><br><span class="line">    tmp += <span class="built_in">to_string</span>(<span class="built_in">ntohs</span>(peer.sin_port));<span class="comment">// æ¥æºç«¯å£</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨mapä¸­ç”¨ipç«¯å£æ¥æ ‡è¯†ç”¨æˆ·</span></span><br><span class="line">    <span class="keyword">auto</span> it = _usrMap.<span class="built_in">find</span>(tmp);</span><br><span class="line">    <span class="keyword">if</span>(it == _usrMap.<span class="built_in">end</span>())<span class="comment">// æ²¡æ‰¾åˆ°</span></span><br><span class="line">    &#123;</span><br><span class="line">        _usrMap.<span class="built_in">insert</span>(&#123;tmp,peer&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-2-å®¢æˆ·ç«¯æ¥æ”¶å›ä¿¡"><a href="#4-2-å®¢æˆ·ç«¯æ¥æ”¶å›ä¿¡" class="headerlink" title="4.2 å®¢æˆ·ç«¯æ¥æ”¶å›ä¿¡"></a>4.2 å®¢æˆ·ç«¯æ¥æ”¶å›ä¿¡</h2><p>å®¢æˆ·ç«¯å‘é€ä¿¡æ¯ç»™æœåŠ¡å™¨åï¼Œå¯ä»¥æ¥æ¥æ”¶ä¸€ä¸‹æœåŠ¡å™¨çš„å›ä¿¡ã€‚æ¯”å¦‚åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬å‘é‚®ä»¶çš„æ—¶å€™ï¼Œéœ€è¦ç­‰å¾…å¯¹æ–¹å›ä¿¡ï¼Œè¿™æ‰è¡¨æ˜ä½ çš„ä¿¡å¯¹æ–¹ç¡®å®æ”¶åˆ°äº†ï¼Œè€Œä¸æ˜¯ä¸¢åœ¨åŠè·¯ä¸Šäº†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨å¤šçº¿ç¨‹æ“ä½œï¼Œæ¥è·å–æœåŠ¡å™¨ä¼ å›çš„ä¿¡æ¯</span></span><br><span class="line"><span class="type">pthread_t</span> t;</span><br><span class="line">pthread_create(&amp;t, nullptr, recverAndPrint, (<span class="type">void</span> *)&amp;sockfd);</span><br></pre></td></tr></table></figure><p>ä¸ºäº†æ–¹ä¾¿ï¼Œè¿™é‡Œé‡‡ç”¨å¤šçº¿ç¨‹çš„æ–¹å¼æ¥æ“ä½œï¼›å®¢æˆ·ç«¯åœ¨æ¥æ”¶åˆ°æœåŠ¡å™¨çš„å›ä¿¡åï¼Œä¼šæ‰“å°å‡ºæ¥</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> *<span class="title">recverAndPrint</span><span class="params">(<span class="type">void</span> *args)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> sockfd = *(<span class="type">int</span> *)args;</span><br><span class="line">        <span class="type">char</span> buffer[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> temp;</span><br><span class="line">        <span class="type">socklen_t</span> len = <span class="built_in">sizeof</span>(temp);</span><br><span class="line">        <span class="type">ssize_t</span> s = <span class="built_in">recvfrom</span>(sockfd, buffer, <span class="built_in">sizeof</span>(buffer), <span class="number">0</span>, (<span class="keyword">struct</span> sockaddr *)&amp;temp, &amp;len);</span><br><span class="line">        <span class="keyword">if</span> (s &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            buffer[s] = <span class="number">0</span>;<span class="comment">//å°†æ¥æ”¶åˆ°çš„ä¿¡æ¯æ‰“å°å‡ºæ¥ï¼ˆæœåŠ¡å™¨è¿”å›çš„ï¼‰</span></span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;server echo# &quot;</span> &lt;&lt; buffer &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-3-æ¶ˆæ¯è·¯ç”±"><a href="#4-3-æ¶ˆæ¯è·¯ç”±" class="headerlink" title="4.3 æ¶ˆæ¯è·¯ç”±"></a>4.3 æ¶ˆæ¯è·¯ç”±</h2><p>æ‰€è°“æ¶ˆæ¯è·¯ç”±ï¼Œå°±æ˜¯æŠŠæ¥æ”¶åˆ°çš„æ¶ˆæ¯å¹¿æ’­ç»™æ‰€æœ‰ç”¨æˆ·ã€‚å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªç®€å•çš„èŠå¤©å®¤ã€‚</p><p>ä¸Šé¢æˆ‘ä»¬å·²ç»è·å–å¹¶è®°å½•äº†ä¿¡æ¯ï¼Œä¸‹é¢è¦åšçš„å°±æ˜¯æŠŠä¿¡æ¯é‡æ–°å‘ç»™å…¶ä»–ç”¨æˆ·ï¼›æ“ä½œå’Œå®¢æˆ·ç«¯çš„å‘é€æ˜¯ä¸€æ ·çš„</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MsgRoute</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* inBuf,<span class="type">size_t</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> user;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> e:_usrMap)</span><br><span class="line">    &#123;</span><br><span class="line">        user.sin_family = AF_INET;<span class="comment">//ipv4</span></span><br><span class="line">        user.sin_port = e.second.sin_port;<span class="comment">//ç”¨æˆ·ç«¯å£</span></span><br><span class="line">        user.sin_addr.s_addr = e.second.sin_addr.s_addr;<span class="comment">//ç”¨æˆ·ip</span></span><br><span class="line">        <span class="comment">// å‘ç”¨æˆ·å‘é€ä¿¡æ¯</span></span><br><span class="line">        <span class="built_in">sendto</span>(_sockfd, inBuf, len, <span class="number">0</span>,</span><br><span class="line">               (<span class="type">const</span> <span class="keyword">struct</span> sockaddr *)&amp;user, <span class="built_in">sizeof</span>(user)); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡ç«¯æŠŠæ”¶åˆ°çš„æ¶ˆæ¯å‘é€ç»™äº†ç”¨æˆ·</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/202302031037760.png"                      alt="image-20230203103733686"                ></p><p>å†æ–°å¢ä¸€ä¸ªå®¢æˆ·ç«¯è¿›è¡Œæµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå®¢æˆ·éƒ½æ”¶åˆ°äº†æœåŠ¡å™¨çš„å›ä¿¡</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/202302031040599.png"                      alt="image-20230203104025510"                ></p><p>è¿™é‡Œå¯¹äºèŠå¤©å®¤æ¥è¯´è¿˜æœ‰ä¸€ä¸ªå°é—®é¢˜ï¼Œé‚£å°±æ˜¯èŠå¤©æ¡†é‡Œé¢å¹¶ä¸ä¼šäºŒæ¬¡å‡ºç°ä½ çš„æ¶ˆæ¯ã€‚ä¹Ÿå°±æ˜¯æœåŠ¡å™¨ä¸ä¼šæŠŠä½ å‘é€çš„æ¶ˆæ¯å†è½¬å‘ç»™ä½ ã€‚</p><p>æˆ‘ä»¬åœ¨æ¶ˆæ¯è·¯ç”±å‡½æ•°é‡Œé¢è¿›è¡Œåˆ¤æ–­å³å¯ï¼</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MsgRoute</span><span class="params">(<span class="keyword">struct</span> sockaddr_in peer,<span class="type">const</span> <span class="type">char</span>* inBuf,<span class="type">size_t</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> user;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> e:_usrMap)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœipå’Œç«¯å£éƒ½ç›¸ç­‰ï¼Œå°±ä»£è¡¨æ˜¯å‘é€æ¶ˆæ¯çš„ç”¨æˆ·</span></span><br><span class="line">        <span class="keyword">if</span>(e.second.sin_port != peer.sin_port || e.second.sin_addr.s_addr != peer.sin_addr.s_addr)</span><br><span class="line">        &#123;</span><br><span class="line">            user.sin_family = AF_INET;<span class="comment">//ipv4</span></span><br><span class="line">            user.sin_port = e.second.sin_port;<span class="comment">//ç”¨æˆ·ç«¯å£</span></span><br><span class="line">            user.sin_addr.s_addr = e.second.sin_addr.s_addr;<span class="comment">//ç”¨æˆ·ip</span></span><br><span class="line">            <span class="comment">// å‘ç”¨æˆ·å‘é€ä¿¡æ¯</span></span><br><span class="line">            <span class="built_in">sendto</span>(_sockfd, inBuf, len, <span class="number">0</span>,</span><br><span class="line">                   (<span class="type">const</span> <span class="keyword">struct</span> sockaddr *)&amp;user, <span class="built_in">sizeof</span>(user)); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºä¹±åºæ‰“å°çš„é—®é¢˜ï¼Œæ‰€ä»¥çœ‹çš„å¯èƒ½ä¸æ˜¯å¾ˆæ˜æ˜¾ã€‚ä½†æ˜¯æˆ‘ä»¬çš„ç›®çš„å·²ç»è¾¾åˆ°äº†ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/202302031045691.png"                      alt="image-20230203104506634"                ></p><p>è¿™æ ·æ‰“å°çœ‹çš„ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œå¯ä»¥ä½¿ç”¨ç®¡é“æ–‡ä»¶æ¥å®ç°è¾“å‡ºé‡å®šå‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkfifo</span> fifo <span class="comment">#åˆ›å»ºä¸€ä¸ªfifoç®¡é“æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œå®¢æˆ·ç«¯çš„æ—¶å€™ï¼ŒæŒ‡å®šè¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./udpClient 127.0.0.1 1000 &gt; fifo</span><br></pre></td></tr></table></figure><p>åœ¨å¦å¤–ä¸€ä¸ªbashé‡Œé¢ï¼Œç”¨catæ¥è·å–è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &lt; fifo</span><br></pre></td></tr></table></figure><p>è¿™å°±ä¸ä¼šå‡ºç°ä¹±åºæ‰“å°çš„é—®é¢˜äº†ã€‚</p><p><code>fifo</code>æ˜¯ä¸€ä¸ªç®¡é“æ–‡ä»¶ï¼Œéœ€è¦æ‰§è¡Œcatåï¼ˆè¯»ç«¯ï¼‰ï¼Œå®¢æˆ·ç«¯ï¼ˆå†™ç«¯ï¼‰æ‰èƒ½è¿è¡Œ</p><h1 id="5-moreâ€¦"><a href="#5-moreâ€¦" class="headerlink" title="5.moreâ€¦"></a>5.moreâ€¦</h1><p>å…³äºudpç¼–ç¨‹çš„æ“ä½œåˆ°è¿™é‡Œå°±Overå•¦ï¼Œç°åœ¨æˆ‘ä»¬è®¤è¯†äº†å¤§éƒ¨åˆ†çš„ç½‘ç»œæ¥å£ï¼Œä¸‹ä¸€æ­¥çš„ç›®æ ‡ï¼Œå°±æ˜¯å®ç°tcpæœåŠ¡å™¨å•¦ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/202211031202574.jpg"                      alt="QQå›¾ç‰‡20220416195218"                ></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ¥å†™ä¸€ä¸ªudpçš„ä»£ç &lt;/p&gt;</summary>
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="çº¿ç¨‹" scheme="https://blog.musnow.top/tags/%E7%BA%BF%E7%A8%8B/"/>
    
    <category term="ç½‘ç»œ" scheme="https://blog.musnow.top/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>ã€Linuxã€‘manä»€ä¹ˆéƒ½æœä¸äº†ï¼ŒNo manual entry for xxxçš„è§£å†³æ–¹æ¡ˆ</title>
    <link href="https://blog.musnow.top/2023/02/01/note_Linux/28man%E4%BB%80%E4%B9%88%E9%83%BD%E6%90%9C%E4%B8%8D%E4%BA%86%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <id>https://blog.musnow.top/2023/02/01/note_Linux/28man%E4%BB%80%E4%B9%88%E9%83%BD%E6%90%9C%E4%B8%8D%E4%BA%86%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</id>
    <published>2023-02-01T07:28:54.000Z</published>
    <updated>2023-02-06T05:33:14.184Z</updated>
    
    <content type="html"><![CDATA[<p>manä»€ä¹ˆéƒ½æœä¸äº†ï¼Œ<code>No manual entry for xxx</code>çš„è§£å†³æ–¹æ¡ˆ</p><span id="more"></span><blockquote><p>ç³»ç»Ÿ <code>CentOS 7.6</code></p></blockquote><h1 id="1-é—®é¢˜æè¿°"><a href="#1-é—®é¢˜æè¿°" class="headerlink" title="1.é—®é¢˜æè¿°"></a>1.é—®é¢˜æè¿°</h1><p>ä»Šå¤©æŸ¥æ‰‹å†Œçš„æ—¶å€™ï¼Œå‘ç°manä»€ä¹ˆéƒ½æŸ¥ä¸äº†ã€‚ä¸ç®¡æ˜¯ç³»ç»Ÿæ¥å£è¿˜æ˜¯å‡½æ•°ï¼Œéƒ½æ˜¾ç¤ºæ²¡æœ‰å…¥å£æ–‡æ¡£ï¼ˆNo manual entry forï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git]$ man pthread_create</span><br><span class="line">No manual entry for pthread_create</span><br><span class="line">[muxue@bt-7274:~/git]$ man bind</span><br><span class="line">No manual entry for bind</span><br><span class="line">[muxue@bt-7274:~/git]$ man man</span><br><span class="line">No manual entry for man</span><br><span class="line">[muxue@bt-7274:~/git]$ man ls</span><br><span class="line">No manual entry for ls</span><br></pre></td></tr></table></figure><p>è¿™å¯å¾—éš¾å—äº†ï¼Œè¦çŸ¥é“ï¼Œæˆ‘çš„åšå®¢é‡Œé¢å…³äºæ¥å£å®šä¹‰çš„è¯´æ˜ï¼Œå¾ˆå¤šéƒ½æ˜¯ä»manæ‰‹å†Œé‡Œé¢å¤åˆ¶å‡ºæ¥çš„ã€‚</p><p>åœ¨rootä¸‹å°è¯•äº†å®‰è£…ï¼Œå¹¶<code>yum update</code>æ›´æ–°ä¹‹åï¼Œè¿˜æ˜¯æ— æ³•ä½¿ç”¨</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/20234f1dfd4135534d9e10641d4cf6d78ad9.png"                      alt="image-20230201172842758"                ></p><p>äºæ˜¯æˆ‘å°±å»stackoverflowæäº†ä¸ªé—®é¢˜ ã€<a class="link"   href="https://stackoverflow.com/questions/75306427/centos7-6-no-manual-entry-for-any-command/75307997#75307997" >ç‚¹æˆ‘<i class="fas fa-external-link-alt"></i></a>ã€‘ ç„¶ååˆè‡ªå·±è§£å†³äº†è¿™ä¸ªé—®é¢˜ğŸ˜‚</p><h1 id="2-è§£å†³"><a href="#2-è§£å†³" class="headerlink" title="2.è§£å†³"></a>2.è§£å†³</h1><p>æ„Ÿè°¢kooké¢‘é“çš„å¤§ä½¬ï¼Œä¸€çœ¼å°±çœ‹å‡ºæ¥è¿™ä¸ªæ˜¯<strong>ç¯å¢ƒå˜é‡</strong>çš„é—®é¢˜</p><h2 id="2-1-é‡è£…man"><a href="#2-1-é‡è£…man" class="headerlink" title="2.1 é‡è£…man"></a>2.1 é‡è£…man</h2><p>å…ˆè¯•è¯•<code>reinstall</code>é‡è£…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum reinstall man-pages</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/20233fb444672228130fbb49fa9e30f094db.png"                      alt="image-20230201172950992"                ></p><h2 id="2-2-æŸ¥çœ‹ç¯å¢ƒå˜é‡"><a href="#2-2-æŸ¥çœ‹ç¯å¢ƒå˜é‡" class="headerlink" title="2.2 æŸ¥çœ‹ç¯å¢ƒå˜é‡"></a>2.2 æŸ¥çœ‹ç¯å¢ƒå˜é‡</h2><p>å®‰è£…å®Œæ¯•ï¼ŒæŸ¥çœ‹<code>MANPATH</code>çš„ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥çœ‹åˆ°å½“å‰æŒ‡å‘çš„æ˜¯<code>devtoolset-11</code>é‡Œé¢çš„man</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># echo $MANPATH</span><br><span class="line">/opt/rh/devtoolset-11/root/usr/share/man</span><br></pre></td></tr></table></figure><p>ç½ªé­ç¥¸é¦–å°±æ‰¾åˆ°äº†ï¼å‡ å¤©å‰ï¼Œæˆ‘å‡çº§äº†äº‘æœåŠ¡å™¨çš„gccç‰ˆæœ¬ã€<a href="https://blog.musnow.top/2023/01/31/note_linux/26%E5%8D%87%E7%BA%A7gcc/">æ•™ç¨‹</a>ã€‘å½“æ—¶å®‰è£…çš„å°±æ˜¯<code>devtoolset-11</code>ï¼›</p><p>æ‰€ä»¥ï¼Œæƒ…å†µå°±æ˜¯å‡çº§çš„è¿‡ç¨‹ä¸­ï¼Œmançš„ç¯å¢ƒå˜é‡è¢«ä¿®æ”¹äº†ï¼</p><p>æˆ‘ä»¬è¦åšçš„å°±æ˜¯ç»™ä»–æ”¹å›æ¥</p><h2 id="2-3-ä¿®æ”¹æˆæ­£ç¡®çš„ç¯å¢ƒå˜é‡"><a href="#2-3-ä¿®æ”¹æˆæ­£ç¡®çš„ç¯å¢ƒå˜é‡" class="headerlink" title="2.3 ä¿®æ”¹æˆæ­£ç¡®çš„ç¯å¢ƒå˜é‡"></a>2.3 ä¿®æ”¹æˆæ­£ç¡®çš„ç¯å¢ƒå˜é‡</h2><p>å…ˆç”¨<code>whereis man</code>æ‰¾ä¸€ä¸‹mançš„å®‰è£…è·¯å¾„ï¼Œä¸€èˆ¬éƒ½æ˜¯<code>/usr/share/man</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># whereis man</span><br><span class="line">man: /usr/bin/man /usr/share/man /usr/share/man/man7/man.7.gz /usr/share/man/man1/man.1.gz /usr/share/man/man1p/man.1p.gz</span><br></pre></td></tr></table></figure><p>å°†<code>/usr/share/man</code>å¯¼å…¥åˆ°ç¯å¢ƒå˜é‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export MANPATH=/usr/share/man</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å†manï¼Œå‘ç°å·²ç»æ´»è¿‡æ¥äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">man man</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/2023d40e2420e1cb2bcb833a7b26cc1fda3d.png"                      alt="image-20230201174145668"                ></p><h2 id="2-4-æ°¸ä¹…ç”Ÿæ•ˆ"><a href="#2-4-æ°¸ä¹…ç”Ÿæ•ˆ" class="headerlink" title="2.4 æ°¸ä¹…ç”Ÿæ•ˆ"></a>2.4 æ°¸ä¹…ç”Ÿæ•ˆ</h2><p><code>export MANPATH=/usr/share/man</code>åªæ˜¯æš‚æ—¶ä¿®æ”¹å½“å‰bashçš„ç¯å¢ƒå˜é‡ï¼Œè¦æƒ³å®Œå…¨ç”Ÿæ•ˆï¼Œéœ€è¦ä¿®æ”¹bashçš„é…ç½®æ–‡ä»¶</p><p>æ³¨æ„ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶ä¹‹å‰ï¼Œä¸€å®šè¦cpè¿›è¡Œå¤‡ä»½ï¼Œé¿å…ä¿®æ”¹boomï¼</p><ul><li>ç”¨æˆ·ç›®å½•ä¸‹çš„<code>.bashrc</code></li></ul><p>åœ¨é‡Œé¢æ·»åŠ å¦‚ä¸‹å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MANPATH=/usr/share/man</span><br></pre></td></tr></table></figure><p>ç„¶åå†<code>source</code>ä½¿å…¶ç”Ÿæ•ˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source .bashrc</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œå½“å‰ç”¨æˆ·çš„bashå°±èƒ½æ­£å¸¸ä½¿ç”¨manäº†ï¼Œä½†æ˜¯å…¶ä»–ç”¨æˆ·è¿˜æ˜¯ä¸è¡Œã€‚è¿™å°±éœ€è¦æˆ‘ä»¬ä¿®æ”¹ç³»ç»Ÿçš„é…ç½®æ–‡ä»¶</p><ul><li>ç³»ç»Ÿé…ç½®æ–‡ä»¶<code>/etc/bashrc</code></li></ul><p>æ³¨æ„ï¼Œç³»ç»Ÿçš„é…ç½®æ–‡ä»¶éœ€è¦è¾“å…¥çš„æ˜¯å‘½ä»¤ã€‚åœ¨æ–°å»ºbashçš„æ—¶å€™ä¼šæ‰§è¡Œã€‚å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export MANPATH=/usr/share/man</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼Œ<code>source</code>ä½¿å…¶ç”Ÿæ•ˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/bashrc</span><br></pre></td></tr></table></figure><p>ç°åœ¨å°±OKäº†ï¼æ­¤æ—¶å…¶ä»–ç”¨æˆ·ä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨manäº†</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/202381ed4687d2271277a05c57ee4ea3f8eb.png"                      alt="image-20230201174533765"                ></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;manä»€ä¹ˆéƒ½æœä¸äº†ï¼Œ&lt;code&gt;No manual entry for xxx&lt;/code&gt;çš„è§£å†³æ–¹æ¡ˆ&lt;/p&gt;</summary>
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ã€Linuxã€‘CentOS7.6 å‡çº§ gcc/g++</title>
    <link href="https://blog.musnow.top/2023/01/31/note_Linux/26%E5%8D%87%E7%BA%A7gcc/"/>
    <id>https://blog.musnow.top/2023/01/31/note_Linux/26%E5%8D%87%E7%BA%A7gcc/</id>
    <published>2023-01-31T06:53:33.000Z</published>
    <updated>2023-02-06T05:33:14.182Z</updated>
    
    <content type="html"><![CDATA[<p><code>CentOS 7.6</code> å‡çº§ gcc&#x2F;g++çš„æ–¹æ³•ï¼Œä¸ä¸€å®šé€‚ç”¨äºå…¶ä»–linuxç³»ç»Ÿ</p><span id="more"></span><h1 id="1-æŸ¥çœ‹ç‰ˆæœ¬"><a href="#1-æŸ¥çœ‹ç‰ˆæœ¬" class="headerlink" title="1.æŸ¥çœ‹ç‰ˆæœ¬"></a>1.æŸ¥çœ‹ç‰ˆæœ¬</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g++ -v</span><br><span class="line">gcc -v</span><br></pre></td></tr></table></figure><p>å½“å‰æŸ¥çœ‹ç‰ˆæœ¬ï¼Œå‘ç°æ˜¯<code>4.8.5</code>ï¼Œè¿™å·²ç»æ˜¯2015å¹´çš„æ—§ç‰ˆæœ¬äº†ï¼Œå¯¹<code>c++11</code>çš„æ”¯æŒä¸æ˜¯å¾ˆå®Œå–„ï¼Œä¸ºäº†æ–¹ä¾¿å­¦ä¹ å’Œç¼–å†™æ–°ç‰ˆæœ¬çš„ä»£ç ï¼Œå‡çº§ä¸€ä¸‹è¿˜æ˜¯å¯ä»¥çš„</p><p>å¦‚æœä½ çš„ç³»ç»Ÿä¸Šæ²¡æœ‰gcc&#x2F;g++ï¼Œåˆ™å°è¯•ç”¨ä¸‹é¢çš„æ–¹æ³•å®‰è£…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y gcc gcc-c++</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@bt-7274:~]# yum install -y gcc gcc-c++</span><br><span class="line">Loaded plugins: fastestmirror, langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line"></span><br><span class="line">This system is not registered with an entitlement server. You can use subscription-manager to register.</span><br><span class="line"></span><br><span class="line">Repository epel is listed more than once in the configuration</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * centos-sclo-rh: ftp.sjtu.edu.cn</span><br><span class="line"> * centos-sclo-sclo: ftp.sjtu.edu.cn</span><br><span class="line">Package gcc-4.8.5-44.el7.x86_64 already installed and latest version</span><br><span class="line">Package gcc-c++-4.8.5-44.el7.x86_64 already installed and latest version</span><br><span class="line">Nothing to do</span><br></pre></td></tr></table></figure><h1 id="2-å‡çº§"><a href="#2-å‡çº§" class="headerlink" title="2.å‡çº§"></a>2.å‡çº§</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum list dev\*gcc</span><br></pre></td></tr></table></figure><p>ç”¨è¿™ä¸ªå‘½ä»¤æŸ¥çœ‹å¯ä»¥å®‰è£…çš„ç‰ˆæœ¬æœ‰å“ªäº›</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/2023e2d07ed5ccb26478c7cdbeec0390128b.png"                      alt="image-20230131152231287"                ></p><p>å¯ä»¥çœ‹åˆ°æœ€æ–°ç‰ˆæœ¬å·²ç»æ˜¯11äº†ï¼Œé‚£æˆ‘ä»¬å°±ç›´æ¥å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„å§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install devtoolset-11-gcc devtoolset-11-gcc-c++</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Installed:</span><br><span class="line">  devtoolset-11-gcc.x86_64 0:11.2.1-9.1.el7                                                     devtoolset-11-gcc-c++.x86_64 0:11.2.1-9.1.el7                                                    </span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  devtoolset-11-binutils.x86_64 0:2.36.1-1.el7.2                 devtoolset-11-libstdc++-devel.x86_64 0:11.2.1-9.1.el7                 devtoolset-11-runtime.x86_64 0:11.1-2.el7                </span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°<code>complete</code>å°±ä»£è¡¨å®‰è£…overäº†</p><h1 id="3-ç”Ÿæ•ˆ"><a href="#3-ç”Ÿæ•ˆ" class="headerlink" title="3.ç”Ÿæ•ˆ"></a>3.ç”Ÿæ•ˆ</h1><p>ç°åœ¨è¦åšçš„å°±æ˜¯è®©æ–°å®‰è£…çš„ç‰ˆæœ¬ç”Ÿæ•ˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /opt/rh/devtoolset-11/enable</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/2023353e2912ec1b34749038460d695ec896.png"                      alt="image-20230131152404244"                ></p><p>ä¸è¿‡è¿™æ ·åšï¼Œåªèƒ½åœ¨å½“å‰bashç”Ÿæ•ˆï¼Œæ–°å»ºä¸€ä¸ªbashå°±ä¼šå‘ç°è¿˜æ˜¯<code>4.8.5</code>ã€‚è¦åšçš„å°±æ˜¯å§è¿™ä¸ªè¯­å¥å†™å…¥bashrcçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œè®©æ¯æ¬¡æ–°å»ºbashçš„æ—¶å€™è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡å°±OKäº†</p><p>è¦ä¿®æ”¹çš„æ˜¯<code>/etc/bashrc</code>ï¼Œå¼ºçƒˆå»ºè®®ä¿®æ”¹ä¹‹å‰å…ˆå¤‡ä»½ä¸€ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/bashrc ~/bashrc.bak</span><br></pre></td></tr></table></figure><p>éšåæ‰§è¡Œä¸‹é¢ä¿©å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;source /opt/rh/devtoolset-11/enable&quot; &gt;&gt; /etc/bashrc</span><br><span class="line">source /etc/bashrc</span><br></pre></td></tr></table></figure><p>ç°åœ¨å°±OKäº†ï¼Œæ–°å»ºä¸€ä¸ªbashï¼Œå†<code>gcc -v</code>ï¼Œå‘ç°å·²ç»æ˜¯æ–°ç‰ˆæœ¬äº†</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/23/02/2023e4a9daec01153873216cb998d3fafa39.png"                      alt="image-20230131152622618"                ></p><h1 id="4-å…³äºmanå¤±æ•ˆé—®é¢˜"><a href="#4-å…³äºmanå¤±æ•ˆé—®é¢˜" class="headerlink" title="4.å…³äºmanå¤±æ•ˆé—®é¢˜"></a>4.å…³äºmanå¤±æ•ˆé—®é¢˜</h1><p>å‡çº§äº†ç‰ˆæœ¬åï¼Œå¯èƒ½å¯¼è‡´manæ‰‹å†Œå¤±æ•ˆã€‚è¿™æ˜¯å› ä¸ºmançš„ç¯å¢ƒå˜é‡è¢«ä¿®æ”¹äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># echo $MANPATH</span><br><span class="line">/opt/rh/devtoolset-11/root/usr/share/man</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ éœ€è¦ä½¿ç”¨manå‘½ä»¤ï¼Œåˆ™è¿˜éœ€è¦é‡æ–°ä¿®æ”¹ä¸€ä¸‹<code>MANPATH</code>ç¯å¢ƒå˜é‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export MANPATH=/usr/share/man</span><br></pre></td></tr></table></figure><p>è§£å†³å‚è€ƒ <a href="https://blog.musnow.top/2023/02/01/note_linux/28man%E4%BB%80%E4%B9%88%E9%83%BD%E6%90%9C%E4%B8%8D%E4%BA%86%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">manä»€ä¹ˆéƒ½æœä¸äº†çš„è§£å†³æ–¹æ¡ˆ</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;code&gt;CentOS 7.6&lt;/code&gt; å‡çº§ gcc&amp;#x2F;g++çš„æ–¹æ³•ï¼Œä¸ä¸€å®šé€‚ç”¨äºå…¶ä»–linuxç³»ç»Ÿ&lt;/p&gt;</summary>
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
  </entry>
  
</feed>
