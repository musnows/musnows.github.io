<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æ…•é›ªçš„å¯’èˆ</title>
  
  <subtitle>é›ªä¸‹äº†ä¸€å¤œ</subtitle>
  <link href="https://blog.musnow.top/atom.xml" rel="self"/>
  
  <link href="https://blog.musnow.top/"/>
  <updated>2023-03-11T12:00:52.818Z</updated>
  <id>https://blog.musnow.top/</id>
  
  <author>
    <name>muxue</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ã€dockerã€‘é€šè¿‡é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹å·²æœ‰å®¹å™¨çš„ç«¯å£æ˜ å°„</title>
    <link href="https://blog.musnow.top/2023/03/11/docker/11%E4%BF%AE%E6%94%B9%E5%B7%B2%E6%9C%89%E5%AE%B9%E5%99%A8%E7%9A%84%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84/"/>
    <id>https://blog.musnow.top/2023/03/11/docker/11%E4%BF%AE%E6%94%B9%E5%B7%B2%E6%9C%89%E5%AE%B9%E5%99%A8%E7%9A%84%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84/</id>
    <published>2023-03-11T11:45:33.000Z</published>
    <updated>2023-03-11T12:00:52.818Z</updated>
    
    <content type="html"><![CDATA[<p>dockerä¿®æ”¹å·²æœ‰å®¹å™¨çš„ç«¯å£æ˜ å°„</p><span id="more"></span><blockquote><p>å‚è€ƒ <a class="link"   href="https://www.jb51.net/article/257510.htm" >https://www.jb51.net/article/257510.htm<i class="fas fa-external-link-alt"></i></a></p></blockquote><h1 id="1-éœ€æ±‚"><a href="#1-éœ€æ±‚" class="headerlink" title="1.éœ€æ±‚"></a>1.éœ€æ±‚</h1><p>ä¹‹å‰æˆ‘åœ¨æˆ‘çš„nasä¸Šéƒ¨ç½²äº†ä¸€ä¸ªcentoså®¹å™¨ï¼Œå½“æ—¶è„‘å­æŠ½äº†ï¼Œæ²¡æƒ³èµ·æ¥è¦å¤šæ˜ å°„å‡ ä¸ªç«¯å£ã€‚åªæ˜ å°„äº†å®¹å™¨çš„22ç«¯å£ï¼ˆsshï¼‰</p><p>å¯¹äºåº”ç”¨å¼€å‘è€Œè¨€ï¼Œæ²¡æœ‰èƒ½å¤Ÿç›´æ¥è®¿é—®çš„ç«¯å£å¯å¤ªè›‹ç–¼äº†ã€‚åœ¨centosé‡Œé¢å¼€frpç©¿é€å‡ºæ¥è®¿é—®å§ï¼Œåˆå¤ªéº»çƒ¦ã€‚</p><p>å¦‚æœåœ¨ç»¿è”çš„æ§åˆ¶å°é‡Œé¢ä¿®æ”¹ç«¯å£éšå°„ï¼Œ<strong>ä¼šç›´æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨</strong>ï¼ŒåŸæœ‰å®¹å™¨çš„ä¿¡æ¯ä¼šä¸¢å¤±ã€‚ç°åœ¨è¿™ä¸ªcentosç³»ç»Ÿå·²ç»ç”¨äº†ä¸€æ®µæ—¶é—´äº†ï¼Œå¼€å‘ç¯å¢ƒéƒ½é…ç½®å¥½äº†ã€‚åˆ›å»ºä¸€ä¸ªæ–°å®¹å™¨å°±æ˜¯å¾—é‡å¤´é…ç½®ï¼Œè™½ç„¶ä¸æ˜¯å•¥éš¾äº‹ï¼Œä½†æ˜¯å¤ªè€—æ—¶é—´äº†ï¼ï¼ï¼ğŸ˜¥</p><p>äºæ˜¯å°±æƒ³ç€ï¼Œèƒ½å¦é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼Œå®ç°ä¿®æ”¹å®¹å™¨çš„ç«¯å£æ˜ å°„ã€‚</p><h1 id="2-æ“ä½œ"><a href="#2-æ“ä½œ" class="headerlink" title="2.æ“ä½œ"></a>2.æ“ä½œ</h1><h2 id="2-1-å¼€å¯sshå¹¶å…³é—­dockeræœåŠ¡"><a href="#2-1-å¼€å¯sshå¹¶å…³é—­dockeræœåŠ¡" class="headerlink" title="2.1 å¼€å¯sshå¹¶å…³é—­dockeræœåŠ¡"></a>2.1 å¼€å¯sshå¹¶å…³é—­dockeræœåŠ¡</h2><p>ä¿®æ”¹ä¹‹å‰ï¼Œ<strong>éœ€è¦å¼€å¯ç»¿è”nasçš„sshæœåŠ¡</strong>ã€‚ç»¿è”naså¦‚ä½•å¼€å¯sshå‚è€ƒ <a class="link"   href="https://www.bilibili.com/video/BV1J84y1C7Zu/?spm_id_from=333.337.search-card.all.click" >è§†é¢‘<i class="fas fa-external-link-alt"></i></a></p><p>é“¾æ¥ä¸Šsshä¹‹åï¼Œå…ˆä½¿ç”¨<code>docker ps</code>ï¼ŒæŸ¥çœ‹éœ€è¦ä¿®æ”¹å®¹å™¨çš„idã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„idå¹¶ä¸æ˜¯å®Œæ•´çš„å®¹å™¨idï¼Œå…ˆè®°å½•ä¸‹æ¥ã€‚</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/03/4531c3a572e0afe317768fee05254943.png"                      alt="image-20230311193038037"                ></p><p>å›¾ä¸­ä¹Ÿèƒ½çœ‹åˆ°ï¼Œå½“å‰è¿™ä¸ªcentoså®¹å™¨åªæ˜ å°„äº†22ç«¯å£</p><hr><p>è¿›å…¥ç»¿è”çš„å®¢æˆ·ç«¯ï¼Œå…³é—­dockeræœåŠ¡</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/03/aa3879c8c27f9e13e4300376eec8176b.png"                      alt="image-20230311192756106"                ></p><p>å‘½ä»¤è¡Œé‡Œé¢å†æ¬¡æ‰§è¡Œ<code>docker ps</code>ï¼Œç¡®è®¤dockeræœåŠ¡ç¡®å®å·²ç»å…³é—­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps</span><br><span class="line">Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¾ç¤ºå¦‚ä¸Šï¼Œåˆ™ä»£è¡¨dockerå¹¶æ²¡æœ‰åœ¨è¿è¡Œã€‚</p><hr><h2 id="2-2-æ‰¾åˆ°dockerå®‰è£…è·¯å¾„"><a href="#2-2-æ‰¾åˆ°dockerå®‰è£…è·¯å¾„" class="headerlink" title="2.2 æ‰¾åˆ°dockerå®‰è£…è·¯å¾„"></a>2.2 æ‰¾åˆ°dockerå®‰è£…è·¯å¾„</h2><p>æ¥ä¸‹æ¥è¦åšçš„ï¼Œå°±æ˜¯æŸ¥çœ‹dockerå®‰è£…çš„ä½ç½®ã€‚å¯¹äºç¾¤æ™–ã€å¨è”é€šã€ç»¿è”è¿™ç§nasè€Œè¨€ï¼Œå…¶ç³»ç»Ÿå†…å¯¹dockerå®‰è£…æŒ‚è½½çš„ä½ç½®æ˜¯ä¸åŒçš„ã€‚æ¯”å¦‚ç»¿è”çš„nasè‡ªå¸¦äº†16gbçš„é—ªå­˜ï¼Œä½†dockerçš„å®‰è£…ä½ç½®å¹¶ä¸åœ¨è¿™é‡Œé¢ã€‚</p><p>ä¸€èˆ¬çš„centosç³»ç»Ÿï¼ˆä»¥æˆ‘çš„äº‘æœåŠ¡å™¨ä¸ºä¾‹ï¼‰ï¼Œdockerçš„å®‰è£…ä½ç½®åº”è¯¥æ˜¯å¦‚ä¸‹è·¯å¾„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/lib/docker</span><br></pre></td></tr></table></figure><p>lsæŸ¥çœ‹å†…éƒ¨æ–‡ä»¶ï¼Œå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ls /var/lib/docker</span><br><span class="line">containers  image  network  overlay2  plugins  swarm  tmp  trust  volumes</span><br></pre></td></tr></table></figure><p>è€Œç»¿è”çš„ç³»ç»Ÿå¹¶æ²¡æœ‰è¿™ä¸ªè·¯å¾„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">can&#x27;t open &#x27;/var/lib/docker&#x27;: No such file or directory</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹<code>/var/lib</code>ï¼Œå¹¶æ²¡æœ‰å‘ç°dockeræ–‡ä»¶å¤¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ls /var/lib/</span><br><span class="line">dbus   nginx  samba</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹<code>/var</code>ï¼Œå‘ç°äº†ä¸€ä¸ªdockerdï¼ŒçŒœæµ‹è¿™æ˜¯dockerç›¸å…³æ–‡ä»¶å­˜æ”¾çš„ä½ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ls /var</span><br><span class="line">all_aria2.txt    dockerd          factory   </span><br></pre></td></tr></table></figure><p>é‡Œé¢åªæœ‰ä¸€ä¸ªjsonæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ls /var/dockerd</span><br><span class="line">daemon.json</span><br></pre></td></tr></table></figure><p>catå‘½ä»¤æŸ¥çœ‹ï¼Œæœä¸å…¶ç„¶ï¼Œæ˜¯dockerçš„å®‰è£…è·¯å¾„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># cat /var/dockerd/daemon.json</span><br><span class="line">&#123;&quot;data-root&quot;:&quot;/mnt/media_rw/2550c297-7334-455f-9fce-e0a00aad40c8/.ugreen_nas/6&quot;,&quot;log-level&quot;:&quot;warn&quot;,&quot;iptables&quot;:true,&quot;api-cors-header&quot;:&quot;*&quot;,&quot;host375&quot;],&quot;registry-mirrors&quot;:[&quot;https://registry.docker-cn.com&quot;]&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯dockerçš„å®‰è£…ä½ç½®äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/mnt/media_rw/2550c297-7334-455f-9fce-e0a00aad40c8/.ugreen_nas/6</span><br></pre></td></tr></table></figure><p>lsæŸ¥çœ‹ï¼Œæ–‡ä»¶ç»“æ„å’Œäº‘æœåŠ¡å™¨çš„dockerå®‰è£…ä½ç½®åŸºæœ¬ä¸€æ ·ï¼Œè¿™ä»£è¡¨æˆ‘ä»¬æ‰¾å¯¹äº†ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># ls /mnt/media_rw/2550c297-7334-455f-9fce-e0a00aad40c8/.ugreen_nas/6</span><br><span class="line">buildkit    containerd  containers  image       network     overlay2    plugins     runtimes    swarm    </span><br><span class="line">tmp        trust       volumes</span><br></pre></td></tr></table></figure><h2 id="2-3-æ‰¾åˆ°å¯¹åº”å®¹å™¨çš„é…ç½®æ–‡ä»¶è·¯å¾„"><a href="#2-3-æ‰¾åˆ°å¯¹åº”å®¹å™¨çš„é…ç½®æ–‡ä»¶è·¯å¾„" class="headerlink" title="2.3 æ‰¾åˆ°å¯¹åº”å®¹å™¨çš„é…ç½®æ–‡ä»¶è·¯å¾„"></a>2.3 æ‰¾åˆ°å¯¹åº”å®¹å™¨çš„é…ç½®æ–‡ä»¶è·¯å¾„</h2><p>dockerè·¯å¾„ä¸‹çš„<code>containers</code>æ–‡ä»¶å¤¹ï¼ŒåŒ…å«äº†ä¸åŒå®¹å™¨çš„é…ç½®<strong>æ–‡ä»¶å¤¹</strong>ã€‚lsæŸ¥çœ‹ï¼Œå‘ç°éƒ½æ˜¯ä¸€äº›çœ‹ä¸æ‡‚çš„å­—ç¬¦ä¸²ã€‚å®é™…ä¸Šï¼Œè¿™é‡Œçš„å­—ç¬¦ä¸²å°±æ˜¯å®¹å™¨çš„id</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># ls /mnt/media_rw/2550c297-7334-455f-9fce-e0a00aad40c8/.ugreen_nas/6/containers</span><br><span class="line">2b8f29d7b4b0ad624fb02048cb91c569e6e52409fe246e1c741bdd13ed7242cf  9113e1ec4740726feb9623a897f81b9066bc1b63811bfc0a65875d8a2c46c603</span><br><span class="line">47aa763o2da18686c6301047ef57f24fb611a2ebea2066f0dbk68205a40777e3</span><br></pre></td></tr></table></figure><p>å‰é¢æåˆ°ï¼Œ<code>docker ps</code>æ˜¾ç¤ºçš„å®¹å™¨idå¹¶ä¸æ˜¯å®Œæ•´çš„ã€‚å› ä¸ºå®Œæ•´çš„å¾ˆé•¿å¾ˆé•¿ï¼Œä¸å¯èƒ½åœ¨pså‘½ä»¤é‡Œé¢å…¨æ˜¾ç¤ºå‡ºæ¥ã€‚</p><p>æˆ‘éœ€è¦ä¿®æ”¹çš„ç›®æ ‡å®¹å™¨ï¼Œç¼©çŸ­çš„idå¦‚ä¸‹ï¼Œå¯¹åº”çš„æ­£æ˜¯<code>containers</code>æ–‡ä»¶å¤¹é‡Œé¢çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶å¤¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2b8f29d7b4b0</span><br></pre></td></tr></table></figure><p>çœ‹çœ‹è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œé¢æœ‰å•¥ä¸œè¥¿</p><p><font color=Red>æ³¨æ„</font>ï¼šæ­¤æ—¶å‘½ä»¤å·²ç»å¾ˆé•¿å¾ˆé•¿ã€‚é¿å…å‡ºé”™ï¼Œå»ºè®®å¼€ä¸ªè®°äº‹æœ¬ï¼Œåœ¨é‡Œé¢æŠŠå‘½ä»¤å†™å¥½ï¼Œå†å¤åˆ¶åˆ°ç»ˆç«¯ä¸­æ‰§è¡Œï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l /mnt/media_rw/2550c297-7334-455f-9fce-e0a00aad40c8/.ugreen_nas/6/containers/2b8f29d7b4b0ad624fb02048cb91c569e6e52409fe246e1c741bdd13ed7242cf</span><br></pre></td></tr></table></figure><p>å¾—åˆ°çš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹çš„æ˜¯<code>config.v2.json</code>å’Œ<code>hostconfig.json</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-rw-r-----    1 root     root         87802 Mar 11 18:12 2b8f29d7b4b0ad624fb02048cb91c569e6e52409fe246e1c741bdd13ed7242cf-json.log</span><br><span class="line">drwx------    2 root     root          4096 Feb 23 18:42 checkpoints</span><br><span class="line">-rw-------    1 root     root          3300 Mar 11 18:12 config.v2.json</span><br><span class="line">-rw-r--r--    1 root     root          1925 Mar 11 18:12 hostconfig.json</span><br><span class="line">-rw-r--r--    1 root     root            13 Mar 11 18:12 hostname</span><br><span class="line">-rw-r--r--    1 root     root           174 Mar 11 18:12 hosts</span><br><span class="line">drwx--x---    2 root     root          4096 Feb 23 18:43 mounts</span><br><span class="line">-rw-r--r--    1 root     root            83 Mar 11 18:12 resolv.conf</span><br><span class="line">-rw-r--r--    1 root     root            71 Mar 11 18:12 resolv.conf.hash</span><br></pre></td></tr></table></figure><h2 id="2-4-å¤‡ä»½"><a href="#2-4-å¤‡ä»½" class="headerlink" title="2.4 å¤‡ä»½"></a>2.4 å¤‡ä»½</h2><p>åœ¨linuxçš„å‘½ä»¤è¡Œä¸­æ“ä½œï¼Œå¤‡ä»½æ˜¯å¿…ä¸å¯å°‘çš„ï¼ä½¿ç”¨cpå‘½ä»¤ï¼ŒæŠŠé…ç½®æ–‡ä»¶å¤åˆ¶ä¸€ä»½ï¼Œå¹¶åœ¨åå­—ä¸­æ·»åŠ ä¸Š<code>.bak</code>äºˆä»¥åŒºåˆ«</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp æºæ–‡ä»¶ ç›®æ ‡æ–‡ä»¶</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯cpå‘½ä»¤å¤‡ä»½<code>config.v2.json</code>æ–‡ä»¶çš„å‘½ä»¤ç¤ºä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /mnt/media_rw/2550c297-7334-455f-9fce-e0a00aad40c8/.ugreen_nas/6/containers/2b8f29d7b4b0ad624fb02048cb91c569e6e52409fe246e1c741bdd13ed7242cf/config.v2.json /mnt/media_rw/2550c297-7334-455f-9fce-e0a00aad40c8/.ugreen_nas/6/containers/2b8f29d7b4b0ad624fb02048cb91c569e6e52409fe246e1c741bdd13ed7242cf/config.v2.bak.json</span><br></pre></td></tr></table></figure><p>å¤‡ä»½äº†æˆ‘ä»¬éœ€è¦ä¿®æ”¹çš„ä¸¤ä¸ªæ–‡ä»¶åï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä¿®æ”¹é…ç½®æ–‡ä»¶äº†</p><h2 id="2-5-ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#2-5-ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="2.5 ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>2.5 ä¿®æ”¹é…ç½®æ–‡ä»¶</h2><h3 id="2-5-1-hostconfig-json"><a href="#2-5-1-hostconfig-json" class="headerlink" title="2.5.1  hostconfig.json"></a>2.5.1  hostconfig.json</h3><p>ä½¿ç”¨vimæ¥è¿›è¡Œç¼–è¾‘ï¼ˆç¼–è¾‘ä¹‹å‰ï¼Œå¯ä»¥ç”¨catå…ˆå¤åˆ¶å‡ºå†…å®¹ï¼Œæ”¾åˆ°vscç­‰ç¼–è¾‘å™¨ä¸­æ ¼å¼åŒ–ï¼Œæ–¹ä¾¿æ‰¾åˆ°å¯¹åº”çš„ä½ç½®ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /mnt/media_rw/2550c297-7334-455f-9fce-e0a00aad40c8/.ugreen_nas/6/containers/2b8f29d7b4b0ad624fb02048cb91c569e6e52409fe246e1c741bdd13ed7242cf/hostconfig.json</span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹ä¾¿æ˜¯è¦ä¿®æ”¹çš„å­—æ®µï¼Œå¯ä»¥çœ‹åˆ°é‡Œé¢åªæœ‰å¯¹22ç«¯å£çš„æ˜ å°„</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;PortBindings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;22/tcp&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;HostIp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;HostPort&quot;</span><span class="punctuation">:</span> <span class="string">&quot;22222&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;HostIp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;::&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;HostPort&quot;</span><span class="punctuation">:</span> <span class="string">&quot;22222&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç…§çŒ«ç”»è™ï¼Œç›´æ¥æ·»åŠ ä¸Šå¦å¤–ä¸¤ä¸ªç«¯å£çš„æ˜ å°„ã€‚</p><p>åœ¨è‹±æ–‡è¾“å…¥æ³•ä¸‹ï¼ŒæŒ‰<code>i</code>è¿›å…¥vimçš„ç¼–è¾‘æ¨¡å¼ï¼Œé€šè¿‡é”®ç›˜ç§»åŠ¨å…‰æ ‡åˆ°æŒ‡å®šä½ç½®ï¼Œä¿®æ”¹æ–‡ä»¶</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;PortBindings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;22/tcp&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;HostIp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;HostPort&quot;</span><span class="punctuation">:</span> <span class="string">&quot;22222&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;HostIp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;::&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;HostPort&quot;</span><span class="punctuation">:</span> <span class="string">&quot;22222&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;50000/tcp&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;HostIp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;HostPort&quot;</span><span class="punctuation">:</span> <span class="string">&quot;50000&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;HostIp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;::&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;HostPort&quot;</span><span class="punctuation">:</span> <span class="string">&quot;50000&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;50001/tcp&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;HostIp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;HostPort&quot;</span><span class="punctuation">:</span> <span class="string">&quot;50001&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;HostIp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;::&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;HostPort&quot;</span><span class="punctuation">:</span> <span class="string">&quot;50001&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç¼–è¾‘å¥½äº†ä¹‹åï¼ŒæŒ‰escé€€å‡ºç¼–è¾‘æ¨¡å¼ï¼Œ<code>:wq</code>ä¿å­˜å¹¶é€€å‡º</p><hr><h3 id="2-5-2-config-v2-json"><a href="#2-5-2-config-v2-json" class="headerlink" title="2.5.2 config.v2.json"></a>2.5.2 config.v2.json</h3><p>è¿™ä¸ªæ–‡ä»¶éœ€è¦ä¿®æ”¹çš„æ˜¯å¦‚ä¸‹å­—æ®µ</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;ExposedPorts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;22/tcp&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æ·»åŠ ä¸Šåˆšåˆšåœ¨<code>hostconfig.json</code>é‡Œé¢æ–°å¢çš„ç«¯å£</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;ExposedPorts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;22/tcp&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;50000/tcp&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;50001/tcp&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>åŒæ ·<code>:wq</code>ä¿å­˜å¹¶é€€å‡º</p><h2 id="2-6-ç°åœ¨å°±å·²ç»ä¿®æ”¹å¥½å•¦ï¼"><a href="#2-6-ç°åœ¨å°±å·²ç»ä¿®æ”¹å¥½å•¦ï¼" class="headerlink" title="2.6 ç°åœ¨å°±å·²ç»ä¿®æ”¹å¥½å•¦ï¼"></a>2.6 ç°åœ¨å°±å·²ç»ä¿®æ”¹å¥½å•¦ï¼</h2><p>ç›¸åŒçš„ä½ç½®è¿˜å¯ä»¥ä¿®æ”¹å®¹å™¨çš„hostnameã€‚</p><p>ç”¨dockerå®‰è£…çš„centosé•œåƒï¼Œæ˜¯ä¸èƒ½åœ¨centosç³»ç»Ÿä¸­ä¿®æ”¹å®¹å™¨hostnameçš„ï¼ˆä¿®æ”¹å¯ä»¥ï¼Œä½†æ˜¯ä¸ä¼šç”Ÿæ•ˆï¼‰</p><h1 id="3-é‡å¯dockerï¼ŒæŸ¥çœ‹æ˜¯å¦ä¿®æ”¹æˆåŠŸ"><a href="#3-é‡å¯dockerï¼ŒæŸ¥çœ‹æ˜¯å¦ä¿®æ”¹æˆåŠŸ" class="headerlink" title="3.é‡å¯dockerï¼ŒæŸ¥çœ‹æ˜¯å¦ä¿®æ”¹æˆåŠŸ"></a>3.é‡å¯dockerï¼ŒæŸ¥çœ‹æ˜¯å¦ä¿®æ”¹æˆåŠŸ</h1><p>åœ¨å®¢æˆ·ç«¯é‡Œé¢é‡å¯dockeræœåŠ¡ä¹‹åï¼Œä½¿ç”¨docker pså‘½ä»¤æŸ¥çœ‹ç«¯å£æ˜ å°„æ˜¯å¦ä¿®æ”¹æˆåŠŸ</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/03/04cbabad9ae0b3f2dbe29136281063b8.png"                      alt="image-20230311195511866"                ></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå¤šå‡ºäº†50000å’Œ50001ç«¯å£ï¼Œä¿®æ”¹æˆåŠŸï¼</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;dockerä¿®æ”¹å·²æœ‰å®¹å™¨çš„ç«¯å£æ˜ å°„&lt;/p&gt;</summary>
    
    
    
    <category term="dockerçœŸå¥½ç©" scheme="https://blog.musnow.top/categories/docker%E7%9C%9F%E5%A5%BD%E7%8E%A9/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="CentOS" scheme="https://blog.musnow.top/tags/CentOS/"/>
    
    <category term="Docker" scheme="https://blog.musnow.top/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>ã€jsã€‘ç”¨html+javascripté™æ€é¡µé¢å®ç°ä¼ªé‡å®šå‘</title>
    <link href="https://blog.musnow.top/2023/03/10/tools/16%E4%BD%BF%E7%94%A8js%E5%AE%9E%E7%8E%B0%E9%87%8D%E5%AE%9A%E5%90%91/"/>
    <id>https://blog.musnow.top/2023/03/10/tools/16%E4%BD%BF%E7%94%A8js%E5%AE%9E%E7%8E%B0%E9%87%8D%E5%AE%9A%E5%90%91/</id>
    <published>2023-03-10T11:50:31.000Z</published>
    <updated>2023-03-11T11:25:36.228Z</updated>
    
    <content type="html"><![CDATA[<p>javascriptä»£ç å®ç°ä¸€ä¸ªä¼ªé‡å®šå‘</p><span id="more"></span><h1 id="1-å‰è¨€"><a href="#1-å‰è¨€" class="headerlink" title="1.å‰è¨€"></a>1.å‰è¨€</h1><p>æœ¬ç«™çš„åŸŸåä¹‹å‰æœ‰ä¿®æ”¹è¿‡ï¼Œ<strong>ä½†ä¸€äº›æœ‹å‹çš„å‹é“¾ï¼Œå’Œå¼€å¾€é‡Œé¢çš„é“¾æ¥å°šæœªæ›´æ–°</strong>ã€‚æ—§çš„åŸŸååˆç±³æœ‰å¤‡æ¡ˆï¼Œä¸èƒ½è§£æåˆ°å›½å†…æœåŠ¡å™¨ä¸Šç”¨nginxè¿›è¡Œ30xè½¬å‘ã€‚</p><p>è¿™æ—¶å€™æˆ‘å°±æƒ³åˆ°äº†ä¸€æ‹›ï¼Œç”¨jsçš„ä»£ç æ¥å®ç°ä¸€ä¸ªurlçš„åˆ‡æ¢ï¼Œç›¸å½“äºä¸€ä¸ªä¼ªé‡å®šå‘ã€‚å› ä¸ºæ˜¯é™æ€æ–‡ä»¶ï¼Œèƒ½ç›´æ¥éƒ¨ç½²åˆ°netlifyç­‰å¹³å°ä¸Šã€‚</p><p>ç™¾åº¦äº†ä¸€ä¸‹jsæ˜¯å¦æ”¯æŒè¿™ç§è¯­æ³•ï¼Œå˜¿ï¼Œæ”¯æŒï¼</p><p>é‚£ä¸ç›´æ¥å¼€æ•´ï¼</p><h1 id="2-ä»£ç "><a href="#2-ä»£ç " class="headerlink" title="2.ä»£ç "></a>2.ä»£ç </h1><p>å…³äºhttpçš„30xçŠ¶æ€ç ï¼Œå…¶ä»£è¡¨ç«™ç‚¹åŸŸåæˆ–è·¯å¾„æ›´æ”¹</p><ul><li>301é‡å®šå‘ï¼šæ°¸ä¹…</li><li>302é‡å®šå‘ï¼šä¸´æ—¶</li></ul><p>htmlä»£ç éƒ¨åˆ†å¾ˆç®€å•ï¼Œè®¾ç½®bodyå’Œç«™ç‚¹æ ‡é¢˜éƒ½ä¸º301é‡å®šå‘ï¼Œå‘Šè¯‰è®¿é—®è€…ï¼Œç«™ç‚¹å·²ç»æ¢äº†æ–°çš„åŸŸå</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>301 Moved Permanently<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>301 Moved Permanently<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>script</code>éƒ¨åˆ†ï¼Œé€šè¿‡<code>window</code>è·å–å½“å‰çš„åŸŸåï¼Œåˆ¤æ–­åŸŸåæ˜¯å¦ä¸ºç›®æ ‡åŸŸåï¼ˆä¸‹æ–‡ä»£ç ä¸­çš„<code>æ—§åŸŸå</code>ï¼‰</p><p>å¦‚æœä¸æ˜¯ï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸åšã€‚å¦‚æœæ˜¯ï¼Œåˆ™è¦†ç›–urlåˆ°æ–°åŸŸåã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--æ”¾åœ¨headåï¼Œbodyå‰--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> path = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;current path:&quot;</span>,path)<span class="comment">//æ‰“å°åˆ°æ§åˆ¶å°</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// ç¡çœ å‡½æ•°</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">sleep</span> (time) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(resolve, time));</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// ç¡500ms,ä¹‹åæ‰§è¡Œä¸‹é¢çš„å†…å®¹</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">sleep</span>(<span class="number">500</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// å¦‚æœurlä¸æ˜¯é¢„å…ˆè®¾å®šå¥½çš„è¿™ä¸ªï¼Œåˆ™å•¥éƒ½ä¸åš</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (path!=<span class="string">&quot;æ—§åŸŸå1&quot;</span> &amp;&amp; path!=<span class="string">&quot;æ—§åŸŸå2&quot;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;url not match, do nothing&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">else</span>&#123;<span class="comment">// å¦åˆ™é‡å®šå‘</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">replace</span>(<span class="string">&quot;https://blog.musnow.top/&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘è¿˜ç”¨sleepå‡½æ•°ä¼‘çœ äº†500msï¼Œå¦åˆ™åˆ‡æ¢å¾ˆå¿«ï¼Œè®¿å®¢ä¸æ³¨æ„çš„è¯ï¼Œè¿˜ä¸ä¸€å®šèƒ½å‘ç°301é‡å®šå‘ã€‚</p><hr><p>å¦‚æœä½ ä¸éœ€è¦sleepï¼Œé‚£ä»£ç æ›´å°‘</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> path = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;current path:&quot;</span>,path)</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// å¦‚æœurlä¸æ˜¯é¢„å…ˆè®¾å®šå¥½çš„è¿™ä¸¤ä¸ªï¼Œåˆ™å•¥éƒ½ä¸åš</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (path!=<span class="string">&quot;æ—§åŸŸå&quot;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;url not match, do nothing&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">else</span>&#123;<span class="comment">// å¦åˆ™é‡å®šå‘</span></span></span><br><span class="line"><span class="language-javascript">       <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">replace</span>(<span class="string">&quot;https://blog.musnow.top/&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="3-netlifyéƒ¨ç½²"><a href="#3-netlifyéƒ¨ç½²" class="headerlink" title="3.netlifyéƒ¨ç½²"></a>3.netlifyéƒ¨ç½²</h1><p>å°†åˆšåˆšå†™å¥½çš„ä»£ç å†™å…¥ä¸€ä¸ª<code>index.html</code>æ–‡ä»¶ï¼Œå†æ”¾å…¥ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ˆnetlifyçš„ä¸Šä¼ åªèƒ½ä¸Šä¼ æ–‡ä»¶å¤¹ï¼‰</p><p>å¦‚æœä½ æƒ³ï¼Œè¿˜å¯ä»¥åœ¨æ–‡ä»¶å¤¹é‡Œé¢æ”¾ä¸€ä¸ª<code>favicon.ico</code>ä½œä¸ºä¸´æ—¶çš„ç«™ç‚¹logo</p><p>æ‰“å¼€netlifyï¼Œæ‰¾åˆ°Add new siteï¼Œé€‰æ‹©æ‰‹åŠ¨éƒ¨ç½²</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/03/640b1d697d4b2.png"                      alt="image-20230310200548549"                ></p><p>åœ¨è¿™é‡Œä¸Šä¼ æ–‡ä»¶å¤¹</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/03/640b1d7ed3638.png"                      alt="image-20230310200727885"                ></p><p>éƒ¨ç½²å¥½äº†ä¹‹åï¼Œå¯ä»¥åœ¨domain settingsé‡Œé¢é…ç½®åŸŸåä¸ºä½ çš„æ—§åŸŸå</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/03/640b1dfe2efe5.png"                      alt="image-20230310200935284"                ></p><h1 id="4-æµ‹è¯•"><a href="#4-æµ‹è¯•" class="headerlink" title="4.æµ‹è¯•"></a>4.æµ‹è¯•</h1><p>å…ˆè®¿é—®æ—§åŸŸåï¼Œæ˜¾ç¤º301é‡å®šå‘çš„ä¿¡æ¯</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/03/640b1e203e735.png"                      alt="image-20230310201009342"                ></p><p>ä¼‘çœ çš„æ—¶é—´åˆ°äº†ä¹‹åï¼Œå°±ä¼šè¢«é‡å®šå‘åˆ°å½“å‰çš„ç«™ç‚¹</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/03/640b1e6d4a595.png"                      alt="image-20230310201122790"                ></p><p>ç›®çš„è¾¾æˆï¼</p><h1 id="5-æ·»åŠ ä¸Šå°¾éšå‚æ•°"><a href="#5-æ·»åŠ ä¸Šå°¾éšå‚æ•°" class="headerlink" title="5.æ·»åŠ ä¸Šå°¾éšå‚æ•°"></a>5.æ·»åŠ ä¸Šå°¾éšå‚æ•°</h1><p>å¦‚æœä½ çš„ç«™ç‚¹æœ‰éƒ¨ç½²umamiæˆ–è€…ç™¾åº¦ç»Ÿè®¡ç­‰<strong>è®¿é—®ç»Ÿè®¡</strong>æœåŠ¡ï¼Œåˆ™å¯ä»¥åœ¨æºç ä¸­è·³è½¬çš„é“¾æ¥é‡Œé¢åŠ ä¸Šæ¥æº</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">replace</span>(<span class="string">&quot;https://blog.musnow.top/?utm_source=æ—§åŸŸå&quot;</span>);</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œåœ¨è®¿é—®ç»Ÿè®¡ä¸­ï¼Œå°±èƒ½å¾—çŸ¥æœ‰å¤šå°‘ç”¨æˆ·ç”¨äº†æ—§åŸŸåè®¿é—®äº†ä½ çš„ç«™ç‚¹</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/03/640b207623dc3.png"                      alt="image-20230310201912571"                ></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;javascriptä»£ç å®ç°ä¸€ä¸ªä¼ªé‡å®šå‘&lt;/p&gt;</summary>
    
    
    
    <category term="å·®ç”Ÿæ–‡å…·å¤š" scheme="https://blog.musnow.top/categories/%E5%B7%AE%E7%94%9F%E6%96%87%E5%85%B7%E5%A4%9A/"/>
    
    
    <category term="hexo" scheme="https://blog.musnow.top/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>ã€Pythonã€‘pipä¸‹è½½ä½¿ç”¨å›½å†…é•œåƒæº</title>
    <link href="https://blog.musnow.top/2023/03/10/Python/11pip%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8%E9%95%9C%E5%83%8F%E6%BA%90/"/>
    <id>https://blog.musnow.top/2023/03/10/Python/11pip%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8%E9%95%9C%E5%83%8F%E6%BA%90/</id>
    <published>2023-03-10T00:31:00.000Z</published>
    <updated>2023-03-10T03:58:33.195Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-å¦‚ä½•ä½¿ç”¨"><a href="#1-å¦‚ä½•ä½¿ç”¨" class="headerlink" title="1.å¦‚ä½•ä½¿ç”¨"></a>1.å¦‚ä½•ä½¿ç”¨</h2><p>åœ¨ç›´æ¥ç”¨pipå®‰è£…çš„æ—¶å€™ï¼Œæœ‰æ—¶å€™ä¼šéå¸¸éå¸¸æ…¢</p><p>å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œåœ¨å®‰è£…çš„æ—¶å€™ä½¿ç”¨æ¸…åçš„é•œåƒæº</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ä¸‹é¢çš„æ“ä½œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3.10 install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure><p>é€Ÿåº¦ç›´æ¥èµ·é£</p><h2 id="2-ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#2-ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="2.ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>2.ä¿®æ”¹é…ç½®æ–‡ä»¶</h2><p>åœ¨ç”¨æˆ·çš„å®¶ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code>.pip</code>æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨é‡Œé¢åˆ›å»ºä¸€ä¸ª<code>pip.conf</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">index-url = https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line">[install]</span><br><span class="line">trusted-host = https://pypi.tuna.tsinghua.edu.cn</span><br></pre></td></tr></table></figure><p>ä¿å­˜åï¼ŒæŸ¥çœ‹æ˜¯å¦é…ç½®æˆåŠŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ pip3.10 config list</span><br><span class="line">global.index-url=&#x27;https://pypi.tuna.tsinghua.edu.cn/simple&#x27;</span><br><span class="line">install.trusted-host=&#x27;https://pypi.tuna.tsinghua.edu.cn&#x27;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±é…ç½®å¥½äº†</p><hr><p>windowsä¸‹pipé…ç½®æ–‡ä»¶è·¯å¾„å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\ç”¨æˆ·å\pip\pip.ini</span><br></pre></td></tr></table></figure><p>è¾“å…¥å¦‚ä¸‹å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">index-url = https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line">[install]</span><br><span class="line">trusted-host = pypi.tuna.tsinghua.edu.cn</span><br></pre></td></tr></table></figure><h2 id="3-é•œåƒæºæ±‡æ€»"><a href="#3-é•œåƒæºæ±‡æ€»" class="headerlink" title="3.é•œåƒæºæ±‡æ€»"></a>3.é•œåƒæºæ±‡æ€»</h2><p>ç›®å‰æˆ‘æµ‹è¯•èƒ½ç›´æ¥è®¿é—®çš„é•œåƒæºæœ‰ä¸‹é¢å‡ ä¸ªã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æ¸…å https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line">è±†ç“£ https://pypi.doubanio.com/simple/</span><br><span class="line">ä¸­ç§‘å¤§ https://mirrors.bfsu.edu.cn/pypi/web/simple/</span><br><span class="line">é˜¿é‡Œäº‘ https://mirrors.aliyun.com/pypi/simple/</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-å¦‚ä½•ä½¿ç”¨&quot;&gt;&lt;a href=&quot;#1-å¦‚ä½•ä½¿ç”¨&quot; class=&quot;headerlink&quot; title=&quot;1.å¦‚ä½•ä½¿ç”¨&quot;&gt;&lt;/a&gt;1.å¦‚ä½•ä½¿ç”¨&lt;/h2&gt;&lt;p&gt;åœ¨ç›´æ¥ç”¨pipå®‰è£…çš„æ—¶å€™ï¼Œæœ‰æ—¶å€™ä¼šéå¸¸éå¸¸æ…¢&lt;/p&gt;
&lt;p&gt;å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œåœ¨å®‰è£…çš„æ—¶å€™ä½¿ç”¨æ¸…åçš„é•œåƒæº&lt;</summary>
      
    
    
    
    <category term="é€Ÿé€šPython" scheme="https://blog.musnow.top/categories/%E9%80%9F%E9%80%9APython/"/>
    
    
    <category term="Python" scheme="https://blog.musnow.top/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>ã€Linuxã€‘æµè§ˆå™¨å†™ä»£ç ï¼éƒ¨ç½²code-serverè¿œç¨‹vscodeç½‘é¡µ</title>
    <link href="https://blog.musnow.top/2023/03/09/docker/10code-server/"/>
    <id>https://blog.musnow.top/2023/03/09/docker/10code-server/</id>
    <published>2023-03-09T13:45:33.000Z</published>
    <updated>2023-03-11T11:25:36.263Z</updated>
    
    <content type="html"><![CDATA[<p>éƒ¨ç½²code-serverè¿œç¨‹vscodeç½‘é¡µï¼Œåœ¨æµè§ˆå™¨ä¸Šå†™ä»£ç ï¼</p><span id="more"></span><p>å‚è€ƒæ–‡æ¡£ <a class="link"   href="https://developer.aliyun.com/article/876967#slide-7" >https://developer.aliyun.com/article/876967#slide-7<i class="fas fa-external-link-alt"></i></a></p><h1 id="1-ä»€ä¹ˆæ˜¯code-serverï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯code-serverï¼Ÿ" class="headerlink" title="1.ä»€ä¹ˆæ˜¯code-serverï¼Ÿ"></a>1.ä»€ä¹ˆæ˜¯code-serverï¼Ÿ</h1><p>æ³¨æ„ï¼Œè¿™ä¸æ˜¯åœ¨linuxç³»ç»Ÿä¸Šå®‰è£…vscodeè½¯ä»¶ï¼ˆå’Œwindowsä¸€æ ·çš„vscodeå®¢æˆ·ç«¯ï¼‰</p><blockquote><p>å¼€æºä»“åº“ <a class="link"   href="https://github.com/coder/code-server" >https://github.com/coder/code-server<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>code-serveræ˜¯ä¸€ä¸ªç¤¾åŒºé¡¹ç›®ï¼ˆéå¾®è½¯å®˜æ–¹ï¼‰å…¶ä½œç”¨æ˜¯åœ¨ä½ çš„linuxä¸»æœºï¼ˆäº‘æœåŠ¡å™¨ï¼‰ä¸Šéƒ¨ç½²ä¸€ä¸ªå¯ä»¥åœ¨<strong>æµè§ˆå™¨</strong>ä¸Šè®¿é—®çš„vscodeé¡µé¢ï¼Œç±»ä¼¼å®˜æ–¹çš„<code>vscode.dev</code></p><blockquote><p>å¾®è½¯å®˜æ–¹æ¨å‡ºçš„vscodeç½‘é¡µç‰ˆ <a class="link"   href="https://vscode.dev/" >https://vscode.dev/<i class="fas fa-external-link-alt"></i></a> </p><p>å®ƒå¯ä»¥é€šè¿‡æµè§ˆå™¨çš„apiè®¿é—®ä½ <strong>ç”µè„‘ä¸Šçš„æœ¬åœ°æ–‡ä»¶</strong>ï¼Œæ­¤æ—¶æµè§ˆå™¨å°±æ˜¯ä¸€ä¸ªvscodeå®¢æˆ·ç«¯</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/03/6409e2f59a83a.png"                      alt="image-20230309214517648"                ></p></blockquote><p>code-serveråŒç†ï¼Œå…¶è®¿é—®çš„æ˜¯ä½ linuxæœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼Œä½œç”¨ç±»ä¼¼äºvscodeæ’ä»¶<code>remote ssh</code>ï¼Œè®©æˆ‘ä»¬å¯ä»¥ç”¨æµè§ˆå™¨ï¼Œåœ¨ä»»ä½•ç”µè„‘ã€<strong>å¹³æ¿</strong>ä¸Šè¿›è¡Œè¿œç¨‹å¼€å‘ï¼Œæ— é¡»ä¸‹è½½vscodeå®¢æˆ·ç«¯æˆ–è€…sshè½¯ä»¶ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/03/6409edd1712e7.png"                      alt="image-20230309223145036"                ></p><h2 id="1-1-å®˜æ–¹çš„vscode-server"><a href="#1-1-å®˜æ–¹çš„vscode-server" class="headerlink" title="1.1 å®˜æ–¹çš„vscode-server?"></a>1.1 å®˜æ–¹çš„vscode-server?</h2><p>å¾®è½¯å®˜æ–¹ç¡®å®æœ‰ä¸€ä¸ªvscode-serverï¼Œåœ¨å®˜ç½‘å¯ä»¥ä¸‹è½½ã€‚æˆ‘æµ‹è¯•äº†ä¹‹åï¼Œå‘ç°å®ƒæ˜¯æ‰“äº†ä¸€ä¸ªéš§é“ï¼Œé€šè¿‡<code>vscode.dev</code>çš„å­åŸŸåè®¿é—®ï¼Œä¼šè½¬å‘åˆ°ä½ çš„ä¸»æœºä¸Šã€‚</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/03/6409f5464d748.png"                      alt="image-20230309230334118"                ></p><p>åœ¨æˆ‘è¿™é‡Œçš„æµ‹è¯•ï¼Œ<strong>å‘ç°å‹æ ¹è¿ä¸ä¸Šå¾®è½¯çš„æœåŠ¡å™¨</strong>ã€‚æƒ³æƒ³å…¶å®ä¹Ÿå¾ˆæ­£å¸¸ï¼Œå› ä¸ºvscode-serverçš„æ–‡æ¡£é¡µé¢è¿ä¸­æ–‡éƒ½æ²¡æœ‰ï¼Œå†åŠ ä¸Šå¾®è½¯çš„æœåŠ¡å™¨ï¼Œå›½å†…ç”¨ä¸äº†ä¹Ÿæ˜¯æ„æ–™ä¹‹ä¸­</p><h1 id="2-å®‰è£…"><a href="#2-å®‰è£…" class="headerlink" title="2.å®‰è£…"></a>2.å®‰è£…</h1><h2 id="2-1-ä¸‹è½½å®‰è£…åŒ…"><a href="#2-1-ä¸‹è½½å®‰è£…åŒ…" class="headerlink" title="2.1 ä¸‹è½½å®‰è£…åŒ…"></a>2.1 ä¸‹è½½å®‰è£…åŒ…</h2><p>æˆªè‡³æœ¬æ–‡åˆ›ä½œæ—¶é—´<code>23-03-09</code>ï¼Œcode-serverçš„æœ€æ–°ç‰ˆæœ¬æ˜¯<code>4.10.1</code>ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤è·å–åˆ°linuxä¸‹çš„å®‰è£…åŒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/cdr/code-server/releases/download/v4.10.1/code-server-4.10.1-linux-amd64.tar.gz </span><br></pre></td></tr></table></figure><p>å¦‚æœä¸Šé¢è¿™ä¸ªå‘½ä»¤ä½ æ— æ³•è®¿é—®ï¼Œå¯ä»¥å»githubçš„releasesé‡Œé¢æ‰‹åŠ¨ä¸‹è½½å®‰è£…åŒ…</p><blockquote><p><a class="link"   href="https://github.com/coder/code-server/releases/" >https://github.com/coder/code-server/releases/<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>æˆ‘çš„ç³»ç»Ÿæ˜¯amd64ï¼Œå³x86æ¶æ„ã€‚åœ¨githubé‡Œé¢ä¹Ÿæ˜¯æ‰¾<code>linux amd64</code>çš„åŒ…è¿›è¡Œå®‰è£…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ uname -a</span><br><span class="line">Linux 1c2261732150 5.10.120 #0 SMP Fri Jan 6 08:05:47 2023 x86_64 x86_64 x86_64 GNU/Linux</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯æ ‘è“æ´¾ç­‰è®¾å¤‡ï¼Œè¯·ç”¨<code>uname -a</code>ç¡®è®¤ä½ çš„ç³»ç»Ÿæ¶æ„ï¼Œå¹¶ä¸‹è½½å¯¹åº”çš„åŒ…</p><hr><p>githubçš„releaseä¸‹è½½æ…¢ï¼Œå¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªç½‘ç«™åŠ é€Ÿï¼ˆç”¨è¿…é›·ä¸‹ï¼Œé€Ÿåº¦èµ·é£ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://doget.nocsdn.com/#/</span><br></pre></td></tr></table></figure><p>ä¸‹è½½å®Œæˆåï¼Œå°†å‹ç¼©åŒ…ç”¨xftpä¼ è¾“åˆ°æœåŠ¡å™¨ä¸Š</p><h2 id="2-2-è§£å‹"><a href="#2-2-è§£å‹" class="headerlink" title="2.2 è§£å‹"></a>2.2 è§£å‹</h2><p>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è§£å‹åˆšåˆšä¸‹è½½å¥½çš„å‹ç¼©åŒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf code-server-4.10.1-linux-amd64.tar.gz</span><br></pre></td></tr></table></figure><p>ç»™è§£å‹å‡ºæ¥çš„æ–‡ä»¶å¤¹æ”¹ä¸ªçŸ­åå­—vsc</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv code-server-4.10.1-linux-amd64 vsc</span><br></pre></td></tr></table></figure><p>cdè¿›å…¥è¿™ä¸ªæ–‡ä»¶å¤¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd vsc</span><br></pre></td></tr></table></figure><p><code>ls -l</code>ï¼ŒåŸºæœ¬æ–‡ä»¶å¦‚ä¸‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">total 792</span><br><span class="line">drwxr-xr-x   8 muxue muxue   4096 Mar  4 12:26 .</span><br><span class="line">drwx------   6 muxue muxue   4096 Mar  9 22:42 ..</span><br><span class="line">drwxr-xr-x   2 muxue muxue   4096 Mar  4 12:26 bin</span><br><span class="line">drwxr-xr-x   3 muxue muxue   4096 Mar  4 12:26 lib</span><br><span class="line">-rw-r--r--   1 muxue muxue   1084 Mar  3 17:13 LICENSE</span><br><span class="line">drwxr-xr-x 243 muxue muxue  12288 Mar  4 12:26 node_modules</span><br><span class="line">-rw-r--r--   1 muxue muxue 480100 Mar  4 12:26 npm-shrinkwrap.json</span><br><span class="line">drwxr-xr-x   5 muxue muxue   4096 Mar  3 17:13 out</span><br><span class="line">-rw-r--r--   1 muxue muxue   5235 Mar  4 12:24 package.json</span><br><span class="line">-rwxr-xr-x   1 muxue muxue   4877 Mar  3 17:13 postinstall.sh</span><br><span class="line">-rw-r--r--   1 muxue muxue   3056 Mar  3 17:13 README.md</span><br><span class="line">drwxr-xr-x   3 muxue muxue   4096 Mar  3 17:14 src</span><br><span class="line">-rw-r--r--   1 muxue muxue 180977 Mar  3 17:13 ThirdPartyNotices.txt</span><br><span class="line">drwxr-xr-x   2 muxue muxue   4096 Mar  3 17:14 typings</span><br><span class="line">-rw-r--r--   1 muxue muxue  76688 Mar  4 12:26 yarn.lock</span><br></pre></td></tr></table></figure><p>ç›´æ¥è¿›å…¥binæ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬éœ€è¦ç”¨çš„å¯æ‰§è¡Œæ–‡ä»¶å°±åœ¨é‡Œå¤´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ls</span><br><span class="line">code-server</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª<code>code-server</code>å°±æ˜¯æˆ‘ä»¬è¦çš„å¯æ‰§è¡Œæ–‡ä»¶</p><h2 id="2-3-å¯åŠ¨code-server"><a href="#2-3-å¯åŠ¨code-server" class="headerlink" title="2.3 å¯åŠ¨code-server"></a>2.3 å¯åŠ¨code-server</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export PASSWORD=&quot;é…ç½®ä¸€ä¸ªå¯†ç &quot;</span><br><span class="line">code-server --port 8888 --host 0.0.0.0 --auth password</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ä¸ªå‘½ä»¤ï¼Œå¯åŠ¨ä¹‹åï¼Œä¼šåˆ›å»ºä¸€ä¸ªç«¯å£ä¸º8888çš„webæœåŠ¡ï¼Œæ­¤æ—¶ä½¿ç”¨<code>ip:8888</code>çš„æ–¹å¼ï¼Œåº”è¯¥å°±å¯ä»¥è®¿é—®åˆ°ä½ çš„code-serveræœåŠ¡äº†ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[2023-03-09T14:52:07.081Z] info  Wrote default config file to ~/.config/code-server/config.yaml</span><br><span class="line">[2023-03-09T14:52:07.516Z] info  code-server 4.10.0 ac1fba8bde0c3f29bf6bc27d3d7d75cb2390a7c2</span><br><span class="line">[2023-03-09T14:52:07.517Z] info  Using user-data-dir ~/.local/share/code-server</span><br><span class="line">[2023-03-09T14:52:07.532Z] info  Using config file ~/.config/code-server/config.yaml</span><br><span class="line">[2023-03-09T14:52:07.532Z] info  HTTP server listening on http://0.0.0.0:8888/</span><br><span class="line">[2023-03-09T14:52:07.532Z] info    - Authentication is enabled</span><br><span class="line">[2023-03-09T14:52:07.532Z] info      - Using password from $PASSWORD</span><br><span class="line">[2023-03-09T14:52:07.532Z] info    - Not serving HTTPS</span><br></pre></td></tr></table></figure><p>å‡ºç°ä¸‹é¢çš„é¡µé¢ï¼Œé‚£å°±æ˜¯å®‰è£…æˆåŠŸäº†ï¼è¾“å…¥ä½ åˆšåˆšè®¾ç½®çš„å¯†ç ï¼Œå°±å¯ä»¥åƒä½¿ç”¨vscodeä¸€æ ·ä½¿ç”¨code-serveräº†ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/03/6409f2f7b9a46.png"                      alt="image-20230309225342649"                ></p><h2 id="2-4-é…ç½®æ–‡ä»¶"><a href="#2-4-é…ç½®æ–‡ä»¶" class="headerlink" title="2.4 é…ç½®æ–‡ä»¶"></a>2.4 é…ç½®æ–‡ä»¶</h2><p>é¦–æ¬¡å¯åŠ¨äº†ä¹‹åï¼Œä¼šåœ¨ä½ çš„ç”¨æˆ·è·¯å¾„ä¸‹ç”Ÿæˆä¸€ä¸ª<code>.config/code-server</code>æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰ä¸€ä¸ª<code>config.yaml</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ls .config/code-server</span><br><span class="line">config.yaml</span><br></pre></td></tr></table></figure><p>æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥åœ¨é‡Œé¢é…ç½®code-serverçš„å¯†ç ï¼Œä»¥åŠhttpsè®¿é—®ã€‚å…¶ä½™çš„é…ç½®é¡¹æˆ‘è¿˜æ²¡æœ‰å…³æ³¨è¿‡ï¼Œå¯ä»¥å»çœ‹çœ‹githubä¸Šçš„æ–‡æ¡£</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bind-addr: 127.0.0.1:8080</span><br><span class="line">auth: password</span><br><span class="line">password: 64f1881b805917a449d80874</span><br><span class="line">cert: false</span><br></pre></td></tr></table></figure><p>é»˜è®¤çš„å¯†ç å·¨é•¿ï¼Œæ”¹æˆä½ è‡ªå·±çš„å³å¯ã€‚åœ¨è¿™é‡Œè¿˜å¯ä»¥ä¿®æ”¹é»˜è®¤ç»‘å®šçš„ipå’Œç«¯å£ï¼Œåç»­å¯åŠ¨code-serverï¼Œå°±ä¸éœ€è¦æ‰‹åŠ¨æŒ‡å®šäº†ï¼Œç›´æ¥è¿è¡Œå³å¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./code-server</span><br></pre></td></tr></table></figure><h2 id="2-5-tmuxåå°è¿è¡Œ"><a href="#2-5-tmuxåå°è¿è¡Œ" class="headerlink" title="2.5 tmuxåå°è¿è¡Œ"></a>2.5 tmuxåå°è¿è¡Œ</h2><blockquote><p>nohupè¿è¡Œcode-serveræœ‰ä¸€ç‚¹é—®é¢˜ï¼Œæ‰€ä»¥è¦ç”¨tmux</p></blockquote><p>å¦‚æœæ²¡æœ‰è¿™ä¸ªè½¯ä»¶ï¼Œå…ˆå®‰è£…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install tmux</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªæ–°ä¼šè¯ï¼Œä½ å¯ä»¥ç†è§£ä¸ºè¿™æ˜¯ä¸€ä¸ªè„±ç¦»äºbashçš„ç‹¬ç«‹shellé¡µé¢ï¼Œå³ä¾¿å½“å‰bashé€€å‡ºäº†ï¼Œcode-serverä¹Ÿä¸ä¼šé€€å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmux new -s vscode_online</span><br></pre></td></tr></table></figure><p>å¼€å¯æ–°ä¼šè¯åï¼Œè¿›å…¥vscçš„binç›®å½•ï¼Œå¯åŠ¨code-serverï¼Œå‘½ä»¤æ˜¯ä¸å˜çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./code-server</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/03/640a78b909107.png"                      alt="image-20230310082417260"                ></p><p>éšåç›´æ¥å…³æ‰å½“å‰bashï¼Œæ­¤æ—¶å°±å·²ç»å®ç°äº†code-serverçš„åå°è¿è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¥å…¥ä¼šè¯</span></span><br><span class="line">tmux a -t vscode_online</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»“æŸä¼šè¯</span></span><br><span class="line">tmux kill-session -t vscode_online</span><br></pre></td></tr></table></figure><h1 id="3-ä¸€äº›é—®é¢˜"><a href="#3-ä¸€äº›é—®é¢˜" class="headerlink" title="3.ä¸€äº›é—®é¢˜"></a>3.ä¸€äº›é—®é¢˜</h1><h2 id="3-1-nginxè½¬å‘é‡åˆ°1006é”™è¯¯"><a href="#3-1-nginxè½¬å‘é‡åˆ°1006é”™è¯¯" class="headerlink" title="3.1 nginxè½¬å‘é‡åˆ°1006é”™è¯¯"></a>3.1 nginxè½¬å‘é‡åˆ°1006é”™è¯¯</h2><p>æˆ‘åœ¨é‡‡ç”¨nginxè½¬å‘çš„æ—¶å€™ï¼Œé‡åˆ°äº†è¿™ä¸ªé—®é¢˜</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/03/6409e922986ac.png"                      alt="image-20230309221146320"                ></p><p>ä¸ªäººçŒœæµ‹ï¼Œè¿™å¤§æ¦‚ç‡æ˜¯å› ä¸ºæˆ‘åœ¨<code>config.yaml</code>é‡Œé¢é…ç½®äº†<code>code-server</code>çš„httpså¯¼è‡´çš„</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cert:</span> <span class="literal">false</span> <span class="comment"># å…³é—­https</span></span><br></pre></td></tr></table></figure><p>å°†certä¿®æ”¹å›falseï¼Œå†æ¬¡æµ‹è¯•ï¼Œå‘ç°è¿˜æ˜¯æœ‰è¿™ä¸ªé—®é¢˜ï¼</p><blockquote><p>å®é™…ä¸Šï¼Œå¦‚æœä½ è¿›è¡Œäº†nginxè½¬å‘ï¼Œå¹¶ä¸éœ€è¦é…ç½®code-serverçš„https</p><p>ä¿æŒé»˜è®¤çš„httpå³å¯</p></blockquote><hr><p>åæ¥å‘ç°æ˜¯æˆ‘çš„nginxè½¬å‘è®¾ç½®æœ‰é—®é¢˜ï¼Œæ­£ç¡®çš„è½¬å‘é…ç½®å¦‚ä¸‹</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line"><span class="attribute">proxy_pass</span>   http://127.0.0.1:8888;</span><br><span class="line"><span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line"><span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line"><span class="attribute">proxy_set_header</span> Connection upgrade;</span><br><span class="line"><span class="attribute">proxy_set_header</span> Accept-Encoding gzip;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢ç»™å‡ºä¸€ä¸ªhttpsçš„å®Œæ•´æ–‡ä»¶ï¼</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">server_name</span>  code.musnow.top;  <span class="comment"># åŸŸå</span></span><br><span class="line">    <span class="comment"># æ³¨æ„æ–‡ä»¶ä½ç½®ï¼Œæ˜¯ä»/etc/nginx/ä¸‹å¼€å§‹ç®—èµ·çš„</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span> cert/musnow_top.crt; </span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> cert/musnow_top.key;</span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">5m</span>;</span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">client_max_body_size</span> <span class="number">1024m</span>;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">       <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection upgrade;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Accept-Encoding gzip;</span><br><span class="line">        <span class="comment"># å½“ä¸‹æ˜¯ç›´æ¥ç”¨yumå®‰è£…çš„nginxï¼Œå¯ä»¥ç›´æ¥ç”¨æœ¬åœ°ipè®¿é—®</span></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:8888;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># å¼ºåˆ¶é‡å®šå‘</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>; <span class="comment"># ç›‘å¬80ç«¯å£</span></span><br><span class="line">    <span class="attribute">server_name</span>  code.musnow.top;  <span class="comment"># åŸŸå</span></span><br><span class="line">    <span class="comment">#æŠŠhttpçš„åŸŸåè¯·æ±‚è½¬æˆhttps</span></span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-2-C-x2F-C-æ’ä»¶"><a href="#3-2-C-x2F-C-æ’ä»¶" class="headerlink" title="3.2 C&#x2F;C++æ’ä»¶"></a>3.2 C&#x2F;C++æ’ä»¶</h2><p>ç”±äºcode-serveræ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹é¡¹ç›®ï¼Œæ‰€ä»¥ä¸€äº›å®˜æ–¹çš„æ’ä»¶ï¼ˆå¦‚pylanceï¼‰ç›´æ¥åœ¨code-serverçš„æ’ä»¶å•†åº—é‡Œé¢æœæ˜¯æ²¡æœ‰çš„</p><p>æˆ‘ä»¬éœ€è¦å»å¾®è½¯çš„vscodeå®˜ç½‘ä¸Šä¸‹è½½æ’ä»¶çš„VSIXæ–‡ä»¶ï¼Œä½¿ç”¨æœ¬åœ°æ–‡ä»¶çš„æ–¹å¼è¿›è¡Œå®‰è£…</p><blockquote><p><a class="link"   href="https://marketplace.visualstudio.com/VSCode" >https://marketplace.visualstudio.com/VSCode<i class="fas fa-external-link-alt"></i></a></p></blockquote><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/03/6409f4d54a065.png"                      alt="image-20230309230141057"                ></p><p>ä¸è¿‡ï¼Œpylanceç”¨è¿™ä¸ªåŠæ³•ä¾æ—§æ— æ³•å®‰è£…ã€‚çœ‹æ¥æœ‰äº›æ’ä»¶åªæœ‰å®˜æ–¹çš„vscæ‰èƒ½å®‰è£…</p><h2 id="3-3-æœ¬åœ°æ–‡ä»¶"><a href="#3-3-æœ¬åœ°æ–‡ä»¶" class="headerlink" title="3.3 æœ¬åœ°æ–‡ä»¶"></a>3.3 æœ¬åœ°æ–‡ä»¶</h2><p>å¦‚æœä½ ç”¨è¿‡vscodeçš„<code>remote-ssh</code>æ’ä»¶è¿è¿‡ä½ è¿™ä¸ªæœåŠ¡å™¨ï¼Œç”¨æˆ·ç›®å½•ä¸‹é¢ä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.vsc</span><br><span class="line">.vscode-server</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹æ˜¯vscodeçš„æ’ä»¶<code>remote-ssh</code>ç”Ÿæˆçš„ï¼Œå’Œæœ¬æ–‡å®‰è£…çš„code-serveræ— å…³ï¼</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;éƒ¨ç½²code-serverè¿œç¨‹vscodeç½‘é¡µï¼Œåœ¨æµè§ˆå™¨ä¸Šå†™ä»£ç ï¼&lt;/p&gt;</summary>
    
    
    
    <category term="å·®ç”Ÿæ–‡å…·å¤š" scheme="https://blog.musnow.top/categories/%E5%B7%AE%E7%94%9F%E6%96%87%E5%85%B7%E5%A4%9A/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="vscode" scheme="https://blog.musnow.top/tags/vscode/"/>
    
    <category term="CentOS" scheme="https://blog.musnow.top/tags/CentOS/"/>
    
  </entry>
  
  <entry>
    <title>ã€Dockerã€‘é™åˆ¶å·²è¿è¡Œå®¹å™¨çš„Cpuå’Œå†…å­˜</title>
    <link href="https://blog.musnow.top/2023/03/06/docker/9docker%E9%99%90%E5%88%B6%E5%AE%B9%E5%99%A8Cpu%E5%86%85%E5%AD%98/"/>
    <id>https://blog.musnow.top/2023/03/06/docker/9docker%E9%99%90%E5%88%B6%E5%AE%B9%E5%99%A8Cpu%E5%86%85%E5%AD%98/</id>
    <published>2023-03-06T09:45:33.000Z</published>
    <updated>2023-03-11T11:25:36.258Z</updated>
    
    <content type="html"><![CDATA[<p>dockeré™åˆ¶å·²è¿è¡Œå®¹å™¨çš„Cpuå’Œå†…å­˜</p><span id="more"></span><h2 id="1-é—®é¢˜æè¿°"><a href="#1-é—®é¢˜æè¿°" class="headerlink" title="1.é—®é¢˜æè¿°"></a>1.é—®é¢˜æè¿°</h2><p>æœ€è¿‘äº‘æœåŠ¡å™¨çš„å†…å­˜ç»å¸¸ä¸å¤Ÿç”¨ï¼Œè€Œä¸”æ˜¯<strong>è«åå…¶å¦™</strong>çš„å¢å¤šï¼Œåœ¨è…¾è®¯äº‘çš„æ§åˆ¶å°é‡Œé¢çœ‹ï¼Œ4gçš„å†…å­˜å ç”¨äº†3.2gï¼Œå°±å¡åˆ°è¿sshéƒ½è¿ä¸ä¸Šäº†</p><blockquote><p>PS: å·²æ¢è¿‡ç½‘ç»œå’Œè®¾å¤‡ï¼Œç¡®è®¤ä¸æ˜¯ç½‘ç»œé—®é¢˜å¯¼è‡´æ— æ³•ssh</p></blockquote><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/03/6405c2f8c3a35.png"                      alt="img"                ></p><p>å®åœ¨æ²¡è¾™äº†ï¼Œåªèƒ½æŠŠæˆ‘çš„å‡ ä¸ªä¸çƒ­é—¨çš„kook-botç§»æ¤åˆ°replitç™½å«–ï¼Œå†é™åˆ¶ä¸€ä¸‹lskyå›¾åºŠdockeré•œåƒçš„å†…å­˜ç”¨é‡</p><blockquote><p>å…¶å®ä¸»è¦æ˜¯<code>nsfw-api</code>çš„å†…å­˜ç”¨é‡ï¼Œæˆ‘å‘ç°æœ‰äººæ•…æ„ç»™æˆ‘çš„å›¾åºŠä¸Šä¼ hå›¾ã€‚lskyåå°ç”±äºé‰´é»„ä¸é€šè¿‡ï¼Œä¸å…è®¸ä¸Šä¼ ï¼Œä¹Ÿçœ‹ä¸åˆ°æ˜¯è°å¹²çš„ã€‚éš”è¿™å‹åŠ›æµ‹è¯•å‘¢ï¼Ÿ</p><p>æˆ‘çš„å›¾åºŠåŸºæœ¬åªå¯¹è‡ªå·±çš„åšå®¢ä½¿ç”¨ã€‚å¼€æ”¾æ¸¸å®¢ä¸Šä¼ ï¼Œä¹Ÿåªæ˜¯æ–¹ä¾¿å¤§å®¶ä¸´æ—¶ä¸Šä¼ ä¸€äº›å›¾ç‰‡ï¼Œè¿˜è¯·å¤§å®¶æ‰‹ä¸‹ç•™æƒ…ï¼ï¼ï¼ğŸ˜¥</p></blockquote><p>è¿™ä¸ªæ“ä½œæˆ‘åšäº†å‡ æ¬¡ï¼Œä¹Ÿç®—æ˜¯ä¸€ä¸ªé«˜é¢‘æ“ä½œäº†ã€‚åœ¨æ­¤è®°å½•ä¸€ä¸‹å¦‚ä½•æ›´æ”¹ä¸€ä¸ªæ­£åœ¨è¿è¡Œä¸­å®¹å™¨çš„å†…å­˜é™åˆ¶</p><h2 id="2-ä¿®æ”¹å†…å­˜é™åˆ¶"><a href="#2-ä¿®æ”¹å†…å­˜é™åˆ¶" class="headerlink" title="2.ä¿®æ”¹å†…å­˜é™åˆ¶"></a>2.ä¿®æ”¹å†…å­˜é™åˆ¶</h2><p>å…ˆä½¿ç”¨pså‘½ä»¤æŸ¥çœ‹å½“å‰å®¹å™¨å’Œå¯¹åº”çš„id</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œlskyå›¾åºŠå’Œnsfwçš„é•œåƒåˆ†åˆ«æ˜¯ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ª</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/03/6405c3777d10c.png"                      alt="image-20230306184202020"                ></p><p>å†ç”¨statså‘½ä»¤æŸ¥çœ‹å½“å‰çš„çŠ¶æ€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stats</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/03/6405c43bed272.png"                      alt="image-20230306184518474"                ></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå›¾åºŠçš„å†…å­˜æ²¡æœ‰è¿›è¡Œé™åˆ¶ï¼Œnsfwçš„å†…å­˜å·²ç»è¢«é™åˆ¶åˆ°äº†618mbï¼Œå½“å‰å·²ç”¨565mbï¼ŒåŸºæœ¬è¦æ»¡äº†</p><p>é‡å¯ä¸€ä¸‹å®¹å™¨ï¼Œå‘ç°åˆå§‹åŒ–çš„æ—¶å€™åªéœ€è¦100mbå·¦å³çš„å†…å­˜ï¼Œåˆè®¡ç€ç°åœ¨å°±æœ‰äººåœ¨å¾€å›¾åºŠé‡Œé¢ä¸Šä¼ å›¾ç‰‡ï¼ŸğŸ¤£ğŸ¤£ğŸ¤£</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/03/6405c412e1f22.png"                      alt="image-20230306184437446"                ></p><p>è¿™æ€ä¹ˆè¡Œï¼Œç›´æ¥ç»™å®ƒå†…å­˜é™åˆ¶å¹²åˆ°512mbï¼Œèƒ½çœä¸€ç‚¹å†…å­˜æ˜¯ä¸€ç‚¹ï¼Œä¸èƒ½å› ä¸ºå›¾åºŠå¯¼è‡´æˆ‘æœåŠ¡å™¨å¡æ­»ã€‚</p><p>ä¿®æ”¹é™åˆ¶ï¼Œè¦ä½¿ç”¨çš„æ˜¯<code>container update</code>å‘½ä»¤</p><blockquote><p><a class="link"   href="https://www.yiibai.com/docker/container_update.html#:~:text=docker%20container,update%20%E5%91%BD%E4%BB%A4%E7%94%A8%E4%BA%8E%E6%9B%B4%E6%96%B0%E4%B8%80%E4%B8%AA%E6%88%96%E5%A4%9A%E4%B8%AA%E5%AE%B9%E5%99%A8%E7%9A%84%E9%85%8D%E7%BD%AE%E3%80%82" >å‚è€ƒæ–‡æ¡£<i class="fas fa-external-link-alt"></i></a></p><table><thead><tr><th>åç§°,ç®€å†™</th><th>é»˜è®¤å€¼</th><th>æè¿°</th></tr></thead><tbody><tr><td>â€“blkio-weight</td><td>0</td><td>é˜»å¡IO(ç›¸å¯¹æƒé‡)ï¼Œä»‹äº<code>10</code>å’Œ<code>1000</code>ä¹‹é—´ï¼Œæˆ–<code>0</code>ç¦ç”¨(é»˜è®¤ä¸º<code>0</code>)</td></tr><tr><td>â€“cpu-period</td><td>0</td><td>é™åˆ¶CPU CFS(å®Œå…¨å…¬å¹³çš„è°ƒåº¦ç¨‹åº)å‘¨æœŸ</td></tr><tr><td>â€“cpu-quota</td><td>0</td><td>é™åˆ¶CPU CFS(å®Œå…¨å…¬å¹³çš„è°ƒåº¦ç¨‹åº)é…é¢</td></tr><tr><td>â€“cpu-rt-period</td><td>0</td><td>é™åˆ¶CPUå®æ—¶å‘¨æœŸ(ä»¥å¾®ç§’ä¸ºå•ä½)</td></tr><tr><td>â€“cpu-rt-runtime</td><td>0</td><td>ä»¥å¾®ç§’ä¸ºå•ä½é™åˆ¶CPUå®æ—¶è¿è¡Œæ—¶é—´</td></tr><tr><td>â€“cpu-shares, -c</td><td>0</td><td>CPUä»½é¢(ç›¸å¯¹æƒé‡)</td></tr><tr><td>â€“cpuset-cpus</td><td></td><td>å…è®¸æ‰§è¡Œçš„CPU(0-3,0)</td></tr><tr><td>â€“cpuset-mems</td><td></td><td>å…è®¸æ‰§è¡Œçš„å†…å­˜ç‡(0-3,0.1)</td></tr><tr><td>â€“kernel-memory</td><td></td><td>å†…æ ¸å†…å­˜é™åˆ¶</td></tr><tr><td>â€“memory, -m</td><td></td><td>å†…å­˜é™åˆ¶</td></tr><tr><td>â€“memory-reservation</td><td></td><td>å†…å­˜è½¯é™åˆ¶</td></tr><tr><td>â€“memory-swap</td><td></td><td>äº¤æ¢é™åˆ¶ç­‰äºå†…å­˜åŠ äº¤æ¢ï¼š<code>-1</code>ä»¥å¯ç”¨æ— é™åˆ¶çš„äº¤æ¢</td></tr><tr><td>â€“restart</td><td></td><td>é‡æ–°å¯åŠ¨åœ¨å®¹å™¨é€€å‡ºæ—¶åº”ç”¨çš„ç­–ç•¥</td></tr><tr><td>æ¨¡æ¿å¦‚ä¸‹</td><td></td><td></td></tr></tbody></table></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container update å®¹å™¨å --memory=&quot;2g&quot;  --memory-swap=&quot;-1&quot;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„å‘½ä»¤ä¼šé™åˆ¶å®¹å™¨çš„å†…å­˜ä¸º2gbï¼Œäº¤æ¢å†…å­˜è®¾ç½®ä¸º<code>-1</code>ï¼ˆä»¥å¯ç”¨æ— é™åˆ¶çš„äº¤æ¢ï¼‰</p><p>æ¯”å¦‚æˆ‘ç°åœ¨æƒ³ä¿®æ”¹nsfwå®¹å™¨çš„å†…å­˜é™åˆ¶ï¼Œåº”è¯¥å¦‚ä¸‹æ“ä½œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container update nsfw-api --memory=&quot;0.5g&quot; </span><br></pre></td></tr></table></figure><p>ç„¶åå‘ç°æŠ¥é”™äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error response from daemon: Cannot update container 418fc2a79fa7ad2e637babe17424ee60e9027ef4a7fada3f279864e76bdaaa10: Memory limit should be smaller than already set memoryswap limit, update the memoryswap at the same time</span><br></pre></td></tr></table></figure><p>å¤§æ¦‚æ„æ€æ˜¯è®©æˆ‘ä»¬åŒæ—¶æ›´æ–°äº¤æ¢å†…å­˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container update nsfw-api --memory=&quot;0.5g&quot;  --memory-swap=&quot;-1&quot;</span><br></pre></td></tr></table></figure><p>ç°åœ¨å°±okäº†ï¼Œæ‰§è¡ŒæˆåŠŸä¼šæ˜¾ç¤ºé•œåƒçš„åå­—</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nsfw-api</span><br></pre></td></tr></table></figure><p>åœ¨<code>stats</code>çœ‹ä¸€ä¸‹ï¼Œå‘ç°å·²ç»ä¿®æ”¹æˆåŠŸäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stats</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/03/6405c73f35462.png"                      alt="image-20230306185809744"                ></p><p>ä¿®æ”¹å…¶ä»–å®¹å™¨çš„æ•ˆæœä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œç›®çš„å·²ç»è¾¾åˆ°å•¦ï¼</p><h2 id="3-ä¿®æ”¹cpué™åˆ¶"><a href="#3-ä¿®æ”¹cpué™åˆ¶" class="headerlink" title="3.ä¿®æ”¹cpué™åˆ¶"></a>3.ä¿®æ”¹cpué™åˆ¶</h2><p>ä¸‹é¢çš„å‘½ä»¤æ„æ€æ˜¯é™åˆ¶å®¹å™¨åªèƒ½ä½¿ç”¨ä¸»æœºä¸Šä¸¤ä¸ªcpu</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container update  å®¹å™¨å --cpus=2</span><br></pre></td></tr></table></figure><p>ä½†æˆ‘æ²¡æœ‰ç†è§£è¿™ä¸ª<code>ä¸¤ä¸ªcpu</code>æ˜¯ä»€ä¹ˆå«ä¹‰ã€‚è€ƒè™‘åˆ°å¤§éƒ¨åˆ†æ—¶æœŸï¼Œcpuè´Ÿè½½éƒ½ä¸ä¼šå¾ˆå¤§ï¼Œæš‚æ—¶å…ˆä¸è®¾ç½®è¿™ä¸ªäº†</p><blockquote><p><a class="link"   href="https://www.cnblogs.com/sparkdev/p/8052522.html" >https://www.cnblogs.com/sparkdev/p/8052522.html<i class="fas fa-external-link-alt"></i></a></p><p><a class="link"   href="https://zhuanlan.zhihu.com/p/388012843" >https://zhuanlan.zhihu.com/p/388012843<i class="fas fa-external-link-alt"></i></a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;dockeré™åˆ¶å·²è¿è¡Œå®¹å™¨çš„Cpuå’Œå†…å­˜&lt;/p&gt;</summary>
    
    
    
    <category term="dockerçœŸå¥½ç©" scheme="https://blog.musnow.top/categories/docker%E7%9C%9F%E5%A5%BD%E7%8E%A9/"/>
    
    
    <category term="Docker" scheme="https://blog.musnow.top/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>ã€Linuxã€‘ä¿®æ”¹linuxä¸‹çš„æ—¶åŒºå’Œç³»ç»Ÿæ—¶é—´</title>
    <link href="https://blog.musnow.top/2023/03/04/Linux/36linux%E4%BF%AE%E6%94%B9%E6%97%B6%E5%8C%BA/"/>
    <id>https://blog.musnow.top/2023/03/04/Linux/36linux%E4%BF%AE%E6%94%B9%E6%97%B6%E5%8C%BA/</id>
    <published>2023-03-04T01:30:55.000Z</published>
    <updated>2023-03-11T11:25:36.239Z</updated>
    
    <content type="html"><![CDATA[<p>ç”¨é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹linuxç³»ç»Ÿä¸‹çš„æ—¶åŒºï¼ˆæ‰€ç”¨ç³»ç»Ÿ CentOS8ï¼‰</p><span id="more"></span><h2 id="1-é—®é¢˜æ¥æº"><a href="#1-é—®é¢˜æ¥æº" class="headerlink" title="1.é—®é¢˜æ¥æº"></a>1.é—®é¢˜æ¥æº</h2><p>åœ¨linuxä¸Šä½¿ç”¨pythonçš„loggingæ¨¡å—çš„æ—¶å€™ï¼Œå‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯æ¨¡å—é‡Œé¢çš„<code>%(asctime)s</code>æ‰“å°çš„æ—¶é—´å¹¶éä¸œå…«åŒºçš„æ—¶é—´ï¼Œè€Œæ˜¯æ ¼æ—å°¼æ²»æ—¶é—´ï¼Œæ¯”ä¸œå…«åŒºçš„æ—¶é—´å°‘äº†8å°æ—¶</p><p>å¯¹äºæ—¥å¿—æ¥è¯´ï¼Œè¿™æ€ä¹ˆè¡Œï¼Ÿæ€»ä¸èƒ½æ¯æ¬¡çœ‹æ—¥å¿—çš„æ—¶å€™ï¼Œè‡ªå·±æ‰‹åŠ¨ç»™æ—¶é—´åŠ 8å°æ—¶å§ï¼</p><h2 id="2-è§£å†³"><a href="#2-è§£å†³" class="headerlink" title="2.è§£å†³"></a>2.è§£å†³</h2><p>ç™¾åº¦äº†ä¸€ä¸‹åï¼Œå‘ç°æ˜¯æˆ‘ç³»ç»Ÿçš„æ—¶åŒºé—®é¢˜ã€‚è¿™ä¸ªCentosç³»ç»Ÿæ˜¯ç”¨dockerå®‰è£…çš„ï¼Œå†…éƒ¨çš„æ—¶åŒºæ²¡æœ‰æ­£å¸¸è®¾ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date</span><br></pre></td></tr></table></figure><p>é€šè¿‡dateå‘½ä»¤å¯ä»¥æŸ¥çœ‹ç³»ç»Ÿå½“å‰çš„æ—¶é—´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Sat Mar  4 01:29:59 UTC 2023</span><br></pre></td></tr></table></figure><p>ä¼šå‘ç°æ˜¯3æœˆ4æ—¥çš„å‡Œæ™¨1ç‚¹ï¼Œä½†å®é™…ä¸Šæˆ‘æ˜¯åœ¨ä¸Šåˆ9ç‚¹å†™ä¸‹çš„è¿™ç¯‡åšå®¢</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/03/6402a0423fa7b.png"                      alt="image-20230304093451196"                ></p><p>è¿™å°±éœ€è¦æˆ‘ä»¬ä¿®æ”¹æ—¶åŒºäº†ï¼</p><hr><p>åˆšå¼€å§‹ï¼Œæˆ‘å°è¯•ç”¨<code>tzselect</code>å‘½ä»¤è¿›è¡Œæ—¶åŒºçš„é€‰æ‹©ï¼Œå†é€‰æ‹©äº†ä¸Šæµ·æ—¶åŒºåï¼Œç³»ç»Ÿçš„æ—¶é—´è¿˜æ˜¯æœ‰é—®é¢˜ã€‚ç„¶åå‘ç°ï¼Œéœ€è¦ä¿®æ”¹æ–‡ä»¶é…ç½®ï¼Œæ‰èƒ½è®©æ—¶é—´ç”Ÿæ•ˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/timezone <span class="comment"># æ—¶åŒºçš„é…ç½®</span></span><br><span class="line">/etc/localtime <span class="comment"># æ—¶é—´</span></span><br><span class="line">/usr/share/zoneinfo/Asia <span class="comment">#è¿™é‡Œè¾¹æ”¾ç€äºšæ´²ä¸»è¦åŸå¸‚çš„æ—¶é—´</span></span><br></pre></td></tr></table></figure><p>è€Œæˆ‘çš„ç³»ç»Ÿä¸­ï¼Œç¬¬ä¸€ä¸ªæ–‡ä»¶å‹æ ¹ä¸å­˜åœ¨ï¼</p><p>è¦ç”¨ä¸‹é¢çš„ä¸¤ä¸ªå‘½ä»¤æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆrootä¸‹æ‰§è¡Œï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;Asia/Shanghai&quot; &gt; /etc/timezone</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /etc/localtime</span><br><span class="line">ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å®Œæ¯•ï¼Œå†æ¬¡æ‰§è¡Œ<code>date</code>å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°æ—¶é—´å·²ç»æ­£å¸¸äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Sat Mar  4 09:31:33 CST 2023</span><br></pre></td></tr></table></figure><p>pythonçš„loggingæ¨¡å—ä¸­æ‰“å°çš„æ—¶é—´ä¹Ÿæ­£å¸¸äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[23-03-04 09:31:39] DEBUG:log.py:debug:9 | test in main</span><br><span class="line">[23-03-04 09:31:39] ERROR:log.py:exception:24 | Exception occurred</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/home/kook/code/py-test/log.py&quot;, line 32, in test</span><br><span class="line">    a = 10/0</span><br><span class="line">ZeroDivisionError: division by zero</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç”¨é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹linuxç³»ç»Ÿä¸‹çš„æ—¶åŒºï¼ˆæ‰€ç”¨ç³»ç»Ÿ CentOS8ï¼‰&lt;/p&gt;</summary>
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ã€Pythonã€‘è§£å†³SSL certificate problem unable to get local issuer certificate</title>
    <link href="https://blog.musnow.top/2023/02/24/Python/10ssl%E6%8A%A5%E9%94%99%E8%AF%81%E4%B9%A6%E9%94%99%E8%AF%AF%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/"/>
    <id>https://blog.musnow.top/2023/02/24/Python/10ssl%E6%8A%A5%E9%94%99%E8%AF%81%E4%B9%A6%E9%94%99%E8%AF%AF%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</id>
    <published>2023-02-24T01:19:00.000Z</published>
    <updated>2023-03-11T11:25:36.232Z</updated>
    
    <content type="html"><![CDATA[<p>CentOS8 å‡ºç° SSL certificate problem: unable to get local issuer certificate è§£å†³åŠæ³•</p><span id="more"></span><h1 id="1-é”™è¯¯æ¥æº"><a href="#1-é”™è¯¯æ¥æº" class="headerlink" title="1.é”™è¯¯æ¥æº"></a>1.é”™è¯¯æ¥æº</h1><p>æˆ‘åœ¨ä¸€ä¸ªdockerå®‰è£…çš„<code>Centos8.5</code>ç³»ç»Ÿä¸­å¯åŠ¨æˆ‘è‡ªå·±å†™çš„kookæœºå™¨äººæ—¶ï¼Œé‡åˆ°äº†ä¸‹é¢çš„bug</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f80f61bd112.png"                      alt="åŸå›¾"                ></p><p>å…¶å¤§æ¦‚æ„æ€æ˜¯æ²¡æœ‰åŠæ³•è·å–åˆ°æœ¬åœ°çš„<code>issuer certificate</code>ã€‚å¦‚æœä½ çŸ¥é“è¯ä¹¦å’ŒCAçš„å«ä¹‰ï¼Œé‚£ä¹ˆå¤§æ¦‚èƒ½çŒœåˆ°è¿™ä¸ªæŠ¥é”™æ˜¯ä»€ä¹ˆæ„æ€ã€‚</p><blockquote><p>æ‰€æœ‰ç«™ç‚¹çš„sslè¯ä¹¦ï¼Œéƒ½éœ€è¦ç»è¿‡CAæœºæ„çš„è®¤è¯å’Œé¢å‘ã€‚æ“ä½œç³»ç»Ÿä¼šé»˜è®¤<strong>å†…åµŒ</strong>å·²æœ‰CAæœºæ„çš„å…¬é’¥ï¼Œä»¥ç”¨äºè§£å¯†CAé¢å‘çš„è¯ä¹¦ä¸­çš„æ•°å­—ç­¾åã€‚</p></blockquote><p>å› ä¸ºCAæœºæ„æ˜¯å†…åµŒåœ¨æ“ä½œç³»ç»Ÿæœ¬åœ°çš„ï¼Œå¦‚æœä¸€ä¸ªè¯ä¹¦çš„é¢å‘æœºæ„ä¸åœ¨æœ¬åœ°å·²æœ‰CAä¸­ï¼Œè¯¥ç«™ç‚¹å°±ä¼šè¢«æŠ¥ä¸å®‰å…¨ã€‚</p><p>è€Œæ— æ³•è·å–æœ¬åœ°<code>issuer certificate</code>ï¼Œæˆ‘çŒœæµ‹æ„æ€å°±æ˜¯æ²¡æœ‰åŠæ³•è·å–é“æ“ä½œç³»ç»Ÿå†…åµŒçš„CA</p><h1 id="2-è§£å†³"><a href="#2-è§£å†³" class="headerlink" title="2.è§£å†³"></a>2.è§£å†³</h1><p>åˆšå¼€å§‹æˆ‘å°è¯•è¿‡é€šè¿‡pythonçš„sslæ¨¡ç»„å–æ¶ˆè¯ä¹¦éªŒè¯ã€æ›´æ–°æœ¬åœ°è¯ä¹¦å’Œopensslï¼Œéƒ½æ²¡æœ‰è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>åœ¨Kookå¹³å°<code>khl.py</code>æœåŠ¡å™¨çš„å¤§ä½¬å¸®åŠ©ä¸‹ï¼Œæœ€ç»ˆå®šä½å¹¶è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p><h2 id="2-1-æ›´æ–°æœ¬åœ°caåŒ…"><a href="#2-1-æ›´æ–°æœ¬åœ°caåŒ…" class="headerlink" title="2.1 æ›´æ–°æœ¬åœ°caåŒ…"></a>2.1 æ›´æ–°æœ¬åœ°caåŒ…</h2><p>å…ˆ <code>yum install ca-certificates</code>ï¼Œå·²ç»è£…è¿‡çš„è¯é‚£å°±æ˜¯ <code>yum update ca-certificates</code> å¦‚æœä¸è¡Œå† <code>pip3 install certifi</code></p><p>æ“ä½œå®Œæ¯•ä¸Šé¢çš„æ­¥éª¤ï¼Œå‘ç°æœ¬åœ°å·²ç»å®‰è£…äº†æœ€æ–°ç‰ˆæœ¬çš„<code>ca-certificates</code>ï¼Œpythonä¹Ÿæœ‰å®‰è£…<code>certifi</code>åŒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ yum update ca-certificates</span><br><span class="line">Repository extras is listed more than once in the configuration</span><br><span class="line">Warning: failed loading &#x27;/etc/yum.repos.d/epel.repo&#x27;, skipping.</span><br><span class="line">Last metadata expiration check: 8:42:37 ago on Thu 23 Feb 2023 03:09:14 PM UTC.</span><br><span class="line">Dependencies resolved.</span><br><span class="line">Nothing to do.</span><br><span class="line">Complete!</span><br><span class="line"></span><br><span class="line">$ pip3.10 install  certifi</span><br><span class="line">Defaulting to user installation because normal site-packages is not writeable</span><br><span class="line">Requirement already satisfied: certifi in ./.local/lib/python3.10/site-packages (2022.12.7)</span><br><span class="line"></span><br><span class="line">$ pip3.10 install  certifi -U</span><br><span class="line">Defaulting to user installation because normal site-packages is not writeable</span><br><span class="line">Requirement already satisfied: certifi in ./.local/lib/python3.10/site-packages (2022.12.7)</span><br></pre></td></tr></table></figure><h2 id="2-2-æŸ¥çœ‹æœ¬åœ°ä¸»æœºçš„é“¾æ¥"><a href="#2-2-æŸ¥çœ‹æœ¬åœ°ä¸»æœºçš„é“¾æ¥" class="headerlink" title="2.2 æŸ¥çœ‹æœ¬åœ°ä¸»æœºçš„é“¾æ¥"></a>2.2 æŸ¥çœ‹æœ¬åœ°ä¸»æœºçš„é“¾æ¥</h2><p>äºæ˜¯å°è¯•ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼Œçœ‹çœ‹ä¸»æœºæ˜¯å¦èƒ½æˆåŠŸè¿æ¥åˆ°<code>kaiheila.cn</code>(kookapp.cn) å¹¶è®¤è¯sslè¯ä¹¦</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl s_client -connect www.kookapp.cn:443 -showcerts</span><br></pre></td></tr></table></figure><p>è¾“å‡ºäº†å¦‚ä¸‹çš„ä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">depth=2 C = US, O = DigiCert Inc, OU = www.digicert.com, CN = DigiCert Global Root CA</span><br><span class="line">verify return:1</span><br><span class="line">depth=1 C = US, O = &quot;DigiCert, Inc.&quot;, CN = RapidSSL Global TLS RSA4096 SHA256 2022 CA1</span><br><span class="line">verify return:1</span><br><span class="line">depth=0 CN = *.kookapp.cn</span><br><span class="line">verify return:1</span><br><span class="line">CONNECTED(00000003)</span><br><span class="line">---</span><br><span class="line">Certificate chain</span><br><span class="line"> 0 s:CN = *.kookapp.cn</span><br><span class="line">   i:C = US, O = &quot;DigiCert, Inc.&quot;, CN = RapidSSL Global TLS RSA4096 SHA256 2022 CA1</span><br><span class="line">-----BEGIN CERTIFICATE-----</span><br><span class="line">MIIHkTCCBXmgAwIBAgIQCUlurlf6m1VXsuISNqlT8DANBgkqhkiG9w0BAQsFADBc</span><br><span class="line">MQswCQYDVQQGEwJVUzEXMBUGA1UEChMORGlnaUNlcnQsIEluYy4xNDAyBgNVBAMT</span><br><span class="line">K1JhcGlkU1NMIEdsb2JhbCBUTFMgUlNBNDA5NiBTSEEyNTYgMjAyMiBDQTEwHhcN</span><br><span class="line">MjIwNjE1MDAwMDAwWhcNMjMwNjE1MjM1OTU5WjAXMRUwEwYDVQQDDAwqLmtvb2th</span><br><span class="line">cHAuY24wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDB1uHkQ/oEkGNl</span><br><span class="line">oVa6wHz424VznxL+eUt6AAfNhtIXeone8rtnJqeoDJ24lmBYUrL00tChCp4rdTdd</span><br><span class="line">crqPppDYSEY7+/U0hf39pDrmsGKZeeOu7JvANjtvqLFdXsqe5CnXtxAo5QUXB9gc</span><br><span class="line">kttoLTZZX5O1Gyi6mqDtsFCTaVpsQmZWVcbA21zLAdAZJyUyzM2VyfCUPQHs+VFE</span><br><span class="line">rcmA9SN8nkppLyf00lIHCWR6v9HYC2XgjHN2JX8ARJwTEddhHjvleMc/SlHncU6f</span><br><span class="line">pZ8itWx8NzBL6MwPKEjmHgKp0VYBMY6PHrSR/j/XtgOweodp1JBIr6yLLlyCu/lJ</span><br><span class="line">ksCwMUIZAgMBAAGjggOSMIIDjjAfBgNVHSMEGDAWgBTwnIX9op99j8lou9XUiU0d</span><br><span class="line">vtOQ/zAdBgNVHQ4EFgQUYe6lb4/s4J82aqWfNDaev2MD8k4wIwYDVR0RBBwwGoIM</span><br><span class="line">Ki5rb29rYXBwLmNuggprb29rYXBwLmNuMA4GA1UdDwEB/wQEAwIFoDAdBgNVHSUE</span><br><span class="line">FjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwgZ8GA1UdHwSBlzCBlDBIoEagRIZCaHR0</span><br><span class="line">cDovL2NybDMuZGlnaWNlcnQuY29tL1JhcGlkU1NMR2xvYmFsVExTUlNBNDA5NlNI</span><br><span class="line">QTI1NjIwMjJDQTEuY3JsMEigRqBEhkJodHRwOi8vY3JsNC5kaWdpY2VydC5jb20v</span><br><span class="line">UmFwaWRTU0xHbG9iYWxUTFNSU0E0MDk2U0hBMjU2MjAyMkNBMS5jcmwwPgYDVR0g</span><br><span class="line">BDcwNTAzBgZngQwBAgEwKTAnBggrBgEFBQcCARYbaHR0cDovL3d3dy5kaWdpY2Vy</span><br><span class="line">dC5jb20vQ1BTMIGHBggrBgEFBQcBAQR7MHkwJAYIKwYBBQUHMAGGGGh0dHA6Ly9v</span><br><span class="line">Y3NwLmRpZ2ljZXJ0LmNvbTBRBggrBgEFBQcwAoZFaHR0cDovL2NhY2VydHMuZGln</span><br><span class="line">aWNlcnQuY29tL1JhcGlkU1NMR2xvYmFsVExTUlNBNDA5NlNIQTI1NjIwMjJDQTEu</span><br><span class="line">Y3J0MAkGA1UdEwQCMAAwggF/BgorBgEEAdZ5AgQCBIIBbwSCAWsBaQB3AOg+0No+</span><br><span class="line">9QY1MudXKLyJa8kD08vREWvs62nhd31tBr1uAAABgWbUskcAAAQDAEgwRgIhAL1q</span><br><span class="line">ZKig2NqYtlAVnaXtJ7Tk+OuROrPHGR8t2zyNTb6xAiEAsLL5yuvJ/WtIj0bLwbKR</span><br><span class="line">0/nFe/Juub3aZjrNvUhzZIIAdQA1zxkbv7FsV78PrUxtQsu7ticgJlHqP+Eq76gD</span><br><span class="line">wzvWTAAAAYFm1LJ6AAAEAwBGMEQCIDK3qkxuTUB1Dngycy9/LECyVXjlpi2eJBAC</span><br><span class="line">6oZPJQ/VAiBs1iupiYwavmD2m6QrDzzZrW2MJWx4LMxCtvf6pmN3NwB3ALc++yTf</span><br><span class="line">nE26dfI5xbpY9Gxd/ELPep81xJ4dCYEl7bSZAAABgWbUsnkAAAQDAEgwRgIhAL5v</span><br><span class="line">fkeeQAwowpkUhf0U/Z2fFiL8IY+QsCyED40zw0d1AiEA02UjHM3tztsrMn2xyzmT</span><br><span class="line">kVgXnly/OozP+LjdwdsTa6gwDQYJKoZIhvcNAQELBQADggIBAGdBom7y2NXOZL7K</span><br><span class="line">xtZFBFQCBJrEQOHZvuN4Etkmotb+0aVnrEZ/Qc5+zl86YqURcmOZgPhzSjuVfTvU</span><br><span class="line">sJJ1TkC/tMYofoo1Db7B5yRxQmjEYRNLFAZ8rbP/pd5Js8ZGWW7RcxqG+zebqDDD</span><br><span class="line">2CWvpiJNStu/yjWwdsFXQUwU0XOGUfwJDHD0eSBaa3uclAn3kUqF82l2X9qzvy9E</span><br><span class="line">exGjPOSWyNuksjeScr32OyNUrwo7RUYJU4Ztl8xaiaxcvg7u2/o9WWzPhHMVI6ij</span><br><span class="line">rJbj6Wn+BMe3SMYcR/L+foItjWAuOqOVB7IKO32JgCkP1vyl8AWs0up8ddI/9jn3</span><br><span class="line">px8ii0HphKJnkCPZNmLnnOhFXQjoPy2PRmKqusP0kleJw1ZpQXsQpm3yZqFggyFH</span><br><span class="line">8S4ii83kkHBynC89dlwlBIkF29Ds4mYjau6mZZxE69By7ptvFvcYREYslaRMxd16</span><br><span class="line">6PEf5mp5jBKSiI2iYcP8PQOudhObpkuw+KHz8ntkf++HeluuEiqsKyiyyiXm5dmR</span><br><span class="line">E/9uIUjPcQia5ohs2VpAgOLhLG6yphWCHQ6awFj9q3Ce1Mm5yXyZFvLXWGwoJj6j</span><br><span class="line">CVXAZDchwX4uiHW2fI3GHz1pTPg0L3NE/M2CHnQWJlh9cgOljmaZXCeKmLdA9phD</span><br><span class="line">+NQho5xVElRiF+rijlrkMutS7p1Y</span><br><span class="line">-----END CERTIFICATE-----</span><br><span class="line"> 1 s:C = US, O = &quot;DigiCert, Inc.&quot;, CN = RapidSSL Global TLS RSA4096 SHA256 2022 CA1</span><br><span class="line">   i:C = US, O = DigiCert Inc, OU = www.digicert.com, CN = DigiCert Global Root CA</span><br><span class="line">-----BEGIN CERTIFICATE-----</span><br><span class="line">MIIFyzCCBLOgAwIBAgIQCgWbJfVLPYeUzGYxR3U4ozANBgkqhkiG9w0BAQsFADBh</span><br><span class="line">MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3</span><br><span class="line">d3cuZGlnaWNlcnQuY29tMSAwHgYDVQQDExdEaWdpQ2VydCBHbG9iYWwgUm9vdCBD</span><br><span class="line">QTAeFw0yMjA1MDQwMDAwMDBaFw0zMTExMDkyMzU5NTlaMFwxCzAJBgNVBAYTAlVT</span><br><span class="line">MRcwFQYDVQQKEw5EaWdpQ2VydCwgSW5jLjE0MDIGA1UEAxMrUmFwaWRTU0wgR2xv</span><br><span class="line">YmFsIFRMUyBSU0E0MDk2IFNIQTI1NiAyMDIyIENBMTCCAiIwDQYJKoZIhvcNAQEB</span><br><span class="line">BQADggIPADCCAgoCggIBAKY5PJhwCX2UyBb1nelu9APen53D5+C40T+BOZfSFaB0</span><br><span class="line">v0WJM3BGMsuiHZX2IHtwnjUhLL25d8tgLASaUNHCBNKKUlUGRXGztuDIeXb48d64</span><br><span class="line">k7Gk7u7mMRSrj+yuLSWOKnK6OGKe9+s6oaVIjHXY+QX8p2I2S3uew0bW3BFpkeAr</span><br><span class="line">LBCU25iqeaoLEOGIa09DVojd3qc/RKqr4P11173R+7Ub05YYhuIcSv8e0d7qN1sO</span><br><span class="line">1+lfoNMVfV9WcqPABmOasNJ+ol0hAC2PTgRLy/VZo1L0HRMr6j8cbR7q0nKwdbn4</span><br><span class="line">Ar+ZMgCgCcG9zCMFsuXYl/rqobiyV+8U37dDScAebZTIF/xPEvHcmGi3xxH6g+dT</span><br><span class="line">CjetOjJx8sdXUHKXGXC9ka33q7EzQIYlZISF7EkbT5dZHsO2DOMVLBdP1N1oUp0/</span><br><span class="line">1f6fc8uTDduELoKBRzTTZ6OOBVHeZyFZMMdi6tA5s/jxmb74lqH1+jQ6nTU2/Mma</span><br><span class="line">hGNxUuJpyhUHezgBA6sto5lNeyqc+3Cr5ehFQzUuwNsJaWbDdQk1v7lqRaqOlYjn</span><br><span class="line">iomOl36J5txTs0wL7etCeMRfyPsmc+8HmH77IYVMUOcPJb+0gNuSmAkvf5QXbgPI</span><br><span class="line">Zursn/UYnP9obhNbHc/9LYdQkB7CXyX9mPexnDNO7pggNA2jpbEarLmZGi4grMmf</span><br><span class="line">AgMBAAGjggGCMIIBfjASBgNVHRMBAf8ECDAGAQH/AgEAMB0GA1UdDgQWBBTwnIX9</span><br><span class="line">op99j8lou9XUiU0dvtOQ/zAfBgNVHSMEGDAWgBQD3lA1VtFMu2bwo+IbG8OXsj3R</span><br><span class="line">VTAOBgNVHQ8BAf8EBAMCAYYwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMC</span><br><span class="line">MHYGCCsGAQUFBwEBBGowaDAkBggrBgEFBQcwAYYYaHR0cDovL29jc3AuZGlnaWNl</span><br><span class="line">cnQuY29tMEAGCCsGAQUFBzAChjRodHRwOi8vY2FjZXJ0cy5kaWdpY2VydC5jb20v</span><br><span class="line">RGlnaUNlcnRHbG9iYWxSb290Q0EuY3J0MEIGA1UdHwQ7MDkwN6A1oDOGMWh0dHA6</span><br><span class="line">Ly9jcmwzLmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydEdsb2JhbFJvb3RDQS5jcmwwPQYD</span><br><span class="line">VR0gBDYwNDALBglghkgBhv1sAgEwBwYFZ4EMAQEwCAYGZ4EMAQIBMAgGBmeBDAEC</span><br><span class="line">AjAIBgZngQwBAgMwDQYJKoZIhvcNAQELBQADggEBAAfjh/s1f5dDdfm0sNm74/dW</span><br><span class="line">MbbsxfYV1LoTpFt+3MSUWvSbiPQfUkoV57b5rutRJvnPP9mSlpFwcZ3e1nSUbi2o</span><br><span class="line">ITGA7RCOj23I1F4zk0YJm42qAwJIqOVenR3XtyQ2VR82qhC6xslxtNf7f2Ndx2G7</span><br><span class="line">Mem4wpFhyPDT2P6UJ2MnrD+FC//ZKH5/ERo96ghz8VqNlmL5RXo8Ks9rMr/Ad9xw</span><br><span class="line">Y4hyRvAz5920myUffwdUqc0SvPlFnahsZg15uT5HkK48tHR0TLuLH8aRpzh4KJ/Y</span><br><span class="line">p0sARNb+9i1R4Fg5zPNvHs2BbIve0vkwxAy+R4727qYzl3027w9jEFC6HMXRaDc=</span><br><span class="line">-----END CERTIFICATE-----</span><br><span class="line">---</span><br><span class="line">Server certificate</span><br><span class="line">subject=CN = *.kookapp.cn</span><br><span class="line"></span><br><span class="line">issuer=C = US, O = &quot;DigiCert, Inc.&quot;, CN = RapidSSL Global TLS RSA4096 SHA256 2022 CA1</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">No client certificate CA names sent</span><br><span class="line">Peer signing digest: SHA256</span><br><span class="line">Peer signature type: RSA-PSS</span><br><span class="line">Server Temp Key: X25519, 253 bits</span><br><span class="line">---</span><br><span class="line">SSL handshake has read 3993 bytes and written 392 bytes</span><br><span class="line">Verification: OK</span><br><span class="line">---</span><br><span class="line">New, TLSv1.3, Cipher is TLS_AES_256_GCM_SHA384</span><br><span class="line">Server public key is 2048 bit</span><br><span class="line">Secure Renegotiation IS NOT supported</span><br><span class="line">Compression: NONE</span><br><span class="line">Expansion: NONE</span><br><span class="line">No ALPN negotiated</span><br><span class="line">Early data was not sent</span><br><span class="line">Verify return code: 0 (ok)</span><br><span class="line">---</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œé¢èƒ½çœ‹åˆ°å¦‚ä¸‹å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SSL handshake has read 3993 bytes and written 392 bytes</span><br><span class="line">Verification: OK</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çš„æœ¬åœ°ä¸»æœºæ˜¯èƒ½æˆåŠŸè®¤è¯<code>kookapp.cn</code>çš„sslè¯ä¹¦çš„ï¼Œé‚£ä¹ˆé—®é¢˜å°±å‡ºç°åœ¨pythonçš„sslæ¨¡å—ä¸­äº†ï¼</p><h2 id="2-3-æ£€æµ‹pythonçš„sslæ¨¡å—"><a href="#2-3-æ£€æµ‹pythonçš„sslæ¨¡å—" class="headerlink" title="2.3 æ£€æµ‹pythonçš„sslæ¨¡å—"></a>2.3 æ£€æµ‹pythonçš„sslæ¨¡å—</h2><p>pythonå¼€å¯ä¸€ä¸ªREPLï¼Œè¾“å…¥å¦‚ä¸‹çš„ä¸¤è¡Œä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line">ssl.create_default_context().cert_store_stats()</span><br></pre></td></tr></table></figure><p>è¾“å‡ºçš„å†…å®¹å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import ssl</span><br><span class="line">&gt;&gt;&gt; ssl.create_default_context().cert_store_stats()</span><br><span class="line">&#123;&#x27;x509&#x27;: 0, &#x27;crl&#x27;: 0, &#x27;x509_ca&#x27;: 0&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±èƒ½çœ‹å‡ºæ¥é—®é¢˜äº†ï¼Œå…¨éƒ½æ˜¯0ï¼éš¾æ€ªè¯´æ²¡æœ‰åŠæ³•è·å–æœ¬åœ°çš„CA</p><p>ä½œä¸ºå¯¹æ¯”ï¼Œä¸€å°<strong>æ­£å¸¸çš„</strong>windows11ç”µè„‘è¾“å‡ºå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import ssl</span><br><span class="line">&gt;&gt;&gt; ssl.create_default_context().cert_store_stats()</span><br><span class="line">&#123;&#x27;x509&#x27;: 87, &#x27;crl&#x27;: 0, &#x27;x509_ca&#x27;: 84&#125;</span><br></pre></td></tr></table></figure><h2 id="2-4-è§£å†³é”™è¯¯"><a href="#2-4-è§£å†³é”™è¯¯" class="headerlink" title="2.4 è§£å†³é”™è¯¯"></a>2.4 è§£å†³é”™è¯¯</h2><p>æ‰¾åˆ°äº†é”™è¯¯ï¼Œé‚£å°±å¾—æƒ³åŠæ³•è§£å†³ï¼</p><p>pythonå¼€å¯ä¸€ä¸ªREPLï¼Œè¾“å…¥å¦‚ä¸‹çš„ä¸¤è¡Œä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import ssl</span><br><span class="line">ssl.get_default_verify_paths()</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå†…å®¹å¦‚ä¸‹ï¼Œè¿™æ˜¯æœ¬åœ°pythonæŸ¥æ‰¾caè¯ä¹¦çš„ä½ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import ssl</span><br><span class="line">&gt;&gt;&gt; ssl.get_default_verify_paths()</span><br><span class="line">DefaultVerifyPaths(cafile=None, capath=&#x27;/usr/local/openssl-1.1.1/ssl/certs&#x27;, openssl_cafile_env=&#x27;SSL_CERT_FILE&#x27;, openssl_cafile=&#x27;/usr/local/openssl-1.1.1/ssl/cert.pem&#x27;, openssl_capath_env=&#x27;SSL_CERT_DIR&#x27;, openssl_capath=&#x27;/usr/local/openssl-1.1.1/ssl/certs&#x27;)</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>/usr/local/openssl-1.1.1/ssl/cert.pem</code>ä¸­åº”è¯¥ä¼šä¿å­˜CAçš„ä¿¡æ¯</p><p>æŸ¥çœ‹æœ¬åœ°çš„è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /usr/local/openssl-1.1.1/ssl/cert.pem</span><br></pre></td></tr></table></figure><p>å¥½å®¶ä¼™ï¼Œå‘ç°æ–‡ä»¶å‹æ ¹ä¸å­˜åœ¨ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls: cannot access &#x27;/usr/local/openssl-1.1.1/ssl/cert.pem&#x27;: No such file or directory</span><br></pre></td></tr></table></figure><p>çœ‹çœ‹opensslçš„ç‰ˆæœ¬å’Œè·¯å¾„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl  version -d</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OPENSSLDIR: &quot;/etc/pki/tls&quot;</span><br></pre></td></tr></table></figure><p>äºæ˜¯çœ‹çœ‹è¿™ä¸ªç›®å½•ä¸‹æœ‰æ²¡æœ‰æˆ‘ä»¬éœ€è¦çš„<code>cert.pem</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ls /etc/pki/tls</span><br><span class="line">cert.pem  certs  ct_log_list.cnf  misc  openssl.cnf  private</span><br></pre></td></tr></table></figure><p>æœ‰ï¼é‚£ä¹ˆæ¥ä¸‹æ¥è¦åšçš„ï¼Œå°±æ˜¯åˆ›å»ºä¸€ä¸ªè½¯è¿æ¥ï¼Œå°†å…¶å¼„åˆ°&#x2F;usr&#x2F;localä¸­ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /etc/pki/tls/cert.pem /usr/local/openssl-1.1.1/ssl/cert.pem</span><br></pre></td></tr></table></figure><h1 id="3-å®Œç¾ï¼"><a href="#3-å®Œç¾ï¼" class="headerlink" title="3.å®Œç¾ï¼"></a>3.å®Œç¾ï¼</h1><p>åšå®Œè¿™ä¸€åˆ‡åï¼Œå†æ¬¡è¿è¡Œæœºå™¨äººï¼Œè¿™æ¬¡ä¹ˆæœ‰æŠ¥é”™äº†ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ py3 main.py</span><br><span class="line">[FileManage] load all files</span><br><span class="line">[BOT] Start at: [23-02-24 00:25:29]</span><br><span class="line">[BOT.TASK] fetch_public_channel success</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¹ŸæˆåŠŸå“åº”äº†å‘½ä»¤ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f812d3abf94.png"                      alt="image-20230224092852118"                ></p><p>ä¼¼ä¹è¿™ä¸ªé—®é¢˜åœ¨macä¸‹æ›´å¸¸è§ï¼Ÿç”±äºæ²¡æœ‰ä½¿ç”¨è¿‡macï¼Œæœ¬æ–‡ä¸è§£é‡Šç›¸å…³å†…å®¹</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f81349c99b9.png"                      alt="image-20230224093050205"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img.kookapp.cn/assets/2023-02/GA7qO90wIl1hs0ns.png"                                     ></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;CentOS8 å‡ºç° SSL certificate problem: unable to get local issuer certificate è§£å†³åŠæ³•&lt;/p&gt;</summary>
    
    
    
    <category term="é€Ÿé€šPython" scheme="https://blog.musnow.top/categories/%E9%80%9F%E9%80%9APython/"/>
    
    
    <category term="Python" scheme="https://blog.musnow.top/tags/Python/"/>
    
    <category term="CentOS" scheme="https://blog.musnow.top/tags/CentOS/"/>
    
  </entry>
  
  <entry>
    <title>ã€Nasã€‘ç»¿è”å®‰è£…CentOS8å®¹å™¨</title>
    <link href="https://blog.musnow.top/2023/02/23/nas/10%E7%BB%BF%E8%81%94%E5%AE%89%E8%A3%85centos/"/>
    <id>https://blog.musnow.top/2023/02/23/nas/10%E7%BB%BF%E8%81%94%E5%AE%89%E8%A3%85centos/</id>
    <published>2023-02-23T14:25:57.000Z</published>
    <updated>2023-03-11T11:25:36.235Z</updated>
    
    <content type="html"><![CDATA[<p>ç»¿è”å®‰è£…CentOS8å®¹å™¨</p><span id="more"></span><h1 id="1-åˆ›å»ºå®¹å™¨"><a href="#1-åˆ›å»ºå®¹å™¨" class="headerlink" title="1.åˆ›å»ºå®¹å™¨"></a>1.åˆ›å»ºå®¹å™¨</h1><p>å…ˆåœ¨å®¢æˆ·ç«¯å®‰è£…å®¹å™¨ï¼Œéšåç”¨xshellè¿›å…¥ç»¿è”çš„sshï¼ˆå¦‚ä½•<a class="link"   href="https://www.bilibili.com/video/BV1J84y1C7Zu/?spm_id_from=333.337.search-card.all.click" >å¼€å¯sshå‚è€ƒè§†é¢‘<i class="fas fa-external-link-alt"></i></a>ï¼‰</p><blockquote><p>ç®€å•è¯´æ¥ï¼Œå°±æ˜¯åœ¨å®¢æˆ·ç«¯é‡Œé¢å¼€å¯è¿œç¨‹è°ƒè¯•ï¼Œå°†è¿œç¨‹è°ƒè¯•çš„éªŒè¯ç å’Œä¸‹é¢çš„å¯†ç æ‹¼èµ·æ¥ï¼Œå°±æ˜¯ç»¿è”sshçš„rootå¯†ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">L#W$%W1uGa</span><br></pre></td></tr></table></figure><p>ç«¯å£æ˜¯922ï¼Œåˆ©ç”¨puttyæˆ–è€…xshellç­‰è½¯ä»¶é“¾æ¥ï¼ˆæ¨èxshellï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh ç»¿è”æœ¬åœ°ip:922</span><br></pre></td></tr></table></figure><p>ä¼šå‡ºç°æç¤ºæ¡†è¦ä½ è¾“å…¥è´¦æˆ·å’Œå¯†ç ï¼Œè´¦æˆ·å†™rootï¼Œå¯†ç ç”¨ä¸Šé¢æ‹¼å¥½çš„å¯†ç ï¼Œç›´æ¥å¤åˆ¶åï¼Œ<code>shift+ins</code>ç²˜è´´åˆ°ç»ˆç«¯åå›è½¦</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ³¨æ„ï¼Œç»ˆç«¯å†…å¡«å†™å¯†ç æ˜¯ä¸ä¼šæœ‰ä»»ä½•æç¤ºçš„ï¼Œéœ€è¦ç›²æ•²</span><br></pre></td></tr></table></figure></blockquote><p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œä»¥<strong>ç‰¹æƒæ¨¡å¼</strong>åˆ›å»ºä¸€ä¸ªcentoså®¹å™¨ï¼Œå¹¶å°†å®¹å™¨å†…çš„22ç«¯å£æ˜ å°„ç»™ä¸»æœºçš„22222ç«¯å£</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">-p 22222:22 \</span><br><span class="line">--name centos \</span><br><span class="line">--privileged=true \</span><br><span class="line">centos:latest \</span><br><span class="line">/usr/sbin/init</span><br></pre></td></tr></table></figure><p>æå®šäº†ä¹‹åï¼Œè¿›ç»¿è”å®¢æˆ·ç«¯ï¼Œåœæ­¢å®¹å™¨è¿è¡Œï¼Œè®¾ç½®ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ç»™å®¹å™¨å†…éƒ¨ï¼Œæ–¹ä¾¿dockerå®¹å™¨å’Œnasèµ„æ–™äº’ä¼ ï¼ˆä¸è®¾ç½®ä¹Ÿä¸æ˜¯ä¸è¡Œï¼‰</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f74c586cb56.png"                      alt="image-20230223192152276"                ></p><p>æ³¨æ„ï¼Œåœ¨å®¢æˆ·ç«¯é…ç½®çš„æ—¶å€™ï¼Œéœ€è¦æŠŠæ‰€æœ‰èƒ½ç»™çš„é€‰é¡¹ï¼ˆ<code>-i -t é«˜çº§é€‰é¡¹</code>ï¼‰å…¨éƒ½å‹¾ä¸Šï¼Œé¿å…dockerå®‰è£…çš„centosç¼ºå°‘æƒé™ï¼›</p><hr><p>å›åˆ°ç»¿è”çš„sshç»ˆç«¯ï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤è¿›å…¥å®¹å™¨å†…éƒ¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it centos /bin/bash</span><br></pre></td></tr></table></figure><p>ä½ ä¹Ÿå¯ä»¥ç”¨å®¢æˆ·ç«¯é‡Œé¢çš„ç»ˆç«¯åŠŸèƒ½ï¼Œä½†æ˜¯é‚£ä¸ªå¤ªç®€é™‹äº†ï¼Œä¸å¤ªå¥½ç”¨ã€‚æ—¢ç„¶éƒ½å·²ç»èƒ½sshè¿ä¸Šç»¿è”äº†ï¼Œé‚£å®Œå…¨æ²¡å¿…è¦ç”¨å®¢æˆ·ç«¯</p><h2 id="1-1-åˆ¤æ–­æ˜¯å¦æˆåŠŸä»¥ç‰¹æƒæ¨¡å¼å®‰è£…"><a href="#1-1-åˆ¤æ–­æ˜¯å¦æˆåŠŸä»¥ç‰¹æƒæ¨¡å¼å®‰è£…" class="headerlink" title="1.1 åˆ¤æ–­æ˜¯å¦æˆåŠŸä»¥ç‰¹æƒæ¨¡å¼å®‰è£…"></a>1.1 åˆ¤æ–­æ˜¯å¦æˆåŠŸä»¥ç‰¹æƒæ¨¡å¼å®‰è£…</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl </span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæ­¤å‘½ä»¤ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰å¦‚ä¸‹è¾“å‡ºã€‚å¦‚æœæ²¡æœ‰ï¼Œä»£è¡¨æ²¡æœ‰æˆåŠŸä»¥ç‰¹æƒæ¨¡å¼å®‰è£…ã€‚<code>systemctl</code>åœ¨linuxä¸­å¾ˆå¸¸ç”¨ï¼Œä¸”å¼€å¯å®¹å™¨çš„sshä¹Ÿéœ€è¦ä½¿ç”¨æ­¤å‘½ä»¤ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f74e0d90e2c.png"                      alt="image-20230223192918079"                ></p><p>å¦‚æœæ²¡èƒ½æˆåŠŸä½¿ç”¨ï¼Œè¯·é‡è¯•ä¸Šé¢çš„æ­¥éª¤</p><h1 id="2-æ›´æ–°è½¯ä»¶"><a href="#2-æ›´æ–°è½¯ä»¶" class="headerlink" title="2.æ›´æ–°è½¯ä»¶"></a>2.æ›´æ–°è½¯ä»¶</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum update -y &amp;&amp; yum upgrade -y</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡æ‰§è¡Œæ­¤å‘½ä»¤çš„æ—¶å€™ï¼Œå¤§æ¦‚ç‡ä¼šå‡ºç°ä¸‹é¢çš„æŠ¥é”™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: Failed to download metadata for repo &#x27;appstream&#x27;: Cannot prepare internal mirrorlist</span><br></pre></td></tr></table></figure><p>å‚è€ƒ <a class="link"   href="https://blog.csdn.net/weixin_43252521/article/details/124409151" >Error: Failed to download metadata for repo â€˜appstreamâ€˜: Cannot prepare internal mirrorlist<i class="fas fa-external-link-alt"></i></a> åšå®¢ï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤è§£å†³è¿™ä¸ªé—®é¢˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/yum.repos.d/</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -i &#x27;s/mirrorlist/#mirrorlist/g&#x27; /etc/yum.repos.d/CentOS-*</span><br><span class="line">sed -i &#x27;s|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g&#x27; /etc/yum.repos.d/CentOS-*</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ<code>makecache</code>åï¼Œç³»ç»Ÿä¼šè·å–ä¸€äº›å†…å®¹ï¼Œè®©åæˆ‘ä»¬é‡æ–°æŒ‡å‘å¦‚ä¸‹å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum update -y &amp;&amp; yum upgrade -y</span><br></pre></td></tr></table></figure><p>ä¼šè¿›è¡Œä¸€è¿ä¸²çš„æ›´æ–°ï¼Œç›´åˆ°å‡ºç°ä¸‹é¢çš„completeçª—å£ï¼Œä»£è¡¨æˆåŠŸï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f74f439f368.png"                      alt="image-20230223193425765"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f74edeaacc9.png"                      alt="image-20230223193247217"                ></p><h1 id="3-sshé“¾æ¥"><a href="#3-sshé“¾æ¥" class="headerlink" title="3.sshé“¾æ¥"></a>3.sshé“¾æ¥</h1><h2 id="3-1-å®‰è£…passwd"><a href="#3-1-å®‰è£…passwd" class="headerlink" title="3.1 å®‰è£…passwd"></a>3.1 å®‰è£…passwd</h2><p>ä¸€ä¸ªlinuxç³»ç»Ÿï¼Œä¸èƒ½sshé“¾æ¥å¯ä¸è¡Œï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°ä¸€ä¸‹å†…å®¹ï¼Œå®ç°sshé“¾æ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install passwd</span><br></pre></td></tr></table></figure><p>å…ˆå®‰è£…passwdå‘½ä»¤ï¼Œè®¾ç½®rootçš„å¯†ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd</span><br></pre></td></tr></table></figure><p>ä¼šå¼¹å‡ºæ¥è®©ä½ è¾“å…¥å¯†ç ï¼Œç›²æ•²å°±è¡Œ</p><h2 id="3-2-å®‰è£…vimå’Œopenssh"><a href="#3-2-å®‰è£…vimå’Œopenssh" class="headerlink" title="3.2 å®‰è£…vimå’Œopenssh"></a>3.2 å®‰è£…vimå’Œopenssh</h2><p>ç”¨ä¸‹é¢çš„å‘½ä»¤å®‰è£…vimå’Œopenssh</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install vim openssh-server openssh-clients -y</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæ¯•åï¼Œä¿®æ”¹sshçš„é…ç½®æ–‡ä»¶ï¼ˆvimçš„ä½¿ç”¨è¯·ç™¾åº¦ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><p><strong>å–æ¶ˆæ³¨é‡Š</strong>ä¸‹é¢çš„å­—æ®µå³å¯å¼€å¯ssh</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Port 22</span><br><span class="line">ListenAddress 0.0.0.0</span><br><span class="line">ListenAddress ::</span><br><span class="line"></span><br><span class="line">PermitRootLogin yes</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line">AuthorizedKeysFile .ssh/authorized_keys</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å¥½äº†ä¹‹åï¼Œé€€å‡ºç»ˆç«¯ï¼›</p><p>ç”¨ä¸‹é¢çš„å‘½ä»¤é‡å¯sshæœåŠ¡ï¼Œå¹¶è®¾ç½®å¼€æœºå¯åŠ¨ssh</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart sshd.service</span><br><span class="line">systemctl enable sshd.service</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸€åˆ‡æ­£å¸¸çš„è¯ï¼Œè¿™ä¸¤ä¸ªå‘½ä»¤åº”è¯¥ä»€ä¹ˆéƒ½ä¸ä¼šè¾“å‡ºï¼</p><h2 id="3-3-å°è¯•sshé“¾æ¥"><a href="#3-3-å°è¯•sshé“¾æ¥" class="headerlink" title="3.3 å°è¯•sshé“¾æ¥"></a>3.3 å°è¯•sshé“¾æ¥</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh ç»¿è”æœ¬åœ°ip:22222</span><br></pre></td></tr></table></figure><p>ä¼šå¼¹å‡ºæ¥è®©ä½ éªŒè¯ç™»å½•ï¼Œåˆ°è¿™é‡Œå°±æ˜¯okäº†</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f750c5f3325.png"                      alt="image-20230223194054648"                ></p><h2 id="3-4-é…ç½®lså‘½ä»¤é¢œè‰²"><a href="#3-4-é…ç½®lså‘½ä»¤é¢œè‰²" class="headerlink" title="3.4 é…ç½®lså‘½ä»¤é¢œè‰²"></a>3.4 é…ç½®lså‘½ä»¤é¢œè‰²</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure><p>åœ¨æœ«å°¾æ·»åŠ å¦‚ä¸‹å­—æ®µ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export LS_OPTIONS=&#x27;--color=auto&#x27;</span><br><span class="line">alias ls=&#x27;ls $LS_OPTIONS&#x27;</span><br><span class="line">alias ll=&#x27;ls $LS_OPTIONS -lA&#x27;</span><br></pre></td></tr></table></figure><p>éšåé‡å¯å®¹å™¨å³å¯</p><h2 id="3-5-é…ç½®yumé˜¿ç‹¸æº"><a href="#3-5-é…ç½®yumé˜¿ç‹¸æº" class="headerlink" title="3.5 é…ç½®yumé˜¿ç‹¸æº"></a>3.5 é…ç½®yumé˜¿ç‹¸æº</h2><p>å¤‡ä»½åŸæœ‰æº</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zcvf CentOS-bk.tar.gz /etc/yum.repos.d/CentOS-*</span><br></pre></td></tr></table></figure><p>çœ‹çœ‹æœ¬åœ°çš„centosæ˜¯ä»€ä¹ˆç‰ˆæœ¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/redhat-release</span><br></pre></td></tr></table></figure><p>æˆ‘è¿™é‡Œçš„ç‰ˆæœ¬æ˜¯8.5</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CentOS Linux release 8.5.2111</span><br></pre></td></tr></table></figure><p>æ›¿æ¢é˜¿é‡Œæº</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-8.repo</span><br><span class="line">curl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-8.repo</span><br></pre></td></tr></table></figure><p>é‡æ–°ç”Ÿæˆç¼“å­˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f7562e6d44a.png"                      alt="image-20230223200200975"                ></p><p>ç°åœ¨é€Ÿåº¦å¿«å¤šäº†ï¼</p><h1 id="å¼€ç”¨ï¼"><a href="#å¼€ç”¨ï¼" class="headerlink" title="å¼€ç”¨ï¼"></a>å¼€ç”¨ï¼</h1><p>åç»­çš„ä½¿ç”¨å°±ä¸å†å¤šè¯´æ‹‰ï¼æ—¢ç„¶ä½ æƒ³å®‰è£…centosï¼Œæƒ³å¿…å¯¹linuxçš„äº†è§£è‚¯å®šæ¯”æˆ‘å¤šğŸ˜‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç»¿è”å®‰è£…CentOS8å®¹å™¨&lt;/p&gt;</summary>
    
    
    
    <category term="æ£é¼“æŠ˜è…¾nas" scheme="https://blog.musnow.top/categories/%E6%8D%A3%E9%BC%93%E6%8A%98%E8%85%BEnas/"/>
    
    
    <category term="CentOS" scheme="https://blog.musnow.top/tags/CentOS/"/>
    
    <category term="nas" scheme="https://blog.musnow.top/tags/nas/"/>
    
  </entry>
  
  <entry>
    <title>ã€Dockerã€‘é…ç½®CentOSå®¹å™¨æ—¶å‡ºç° Error Failed to download metadata for repo &#39;appstream&#39; Cannot prepare internal mirrorlist</title>
    <link href="https://blog.musnow.top/2023/02/23/docker/8docker%E5%AE%89%E8%A3%85centos%E9%81%87%E5%88%B0%E6%8A%A5%E9%94%99/"/>
    <id>https://blog.musnow.top/2023/02/23/docker/8docker%E5%AE%89%E8%A3%85centos%E9%81%87%E5%88%B0%E6%8A%A5%E9%94%99/</id>
    <published>2023-02-23T09:45:33.000Z</published>
    <updated>2023-03-11T11:03:57.789Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬ç«™ç»å¸¸æ¬è¿ä¸€äº›å…¶ä»–åšä¸»æ–‡ç« ï¼Œä¸»è¦æ˜¯ä¸ºäº†æŒä¹…åŒ–è®¿é—®ã€‚é¿å…æ—¥åä»–äººåˆ æ–‡oråŸæ–‡æ— æ³•è®¿é—®ï¼›æ‰€æœ‰æ¬è¿çš„æ–‡ç« éƒ½ä¼šå†™æ˜åŸæ–‡åœ°å€ï¼Œå¹¶ä¸”ä¸ä¼šå±•ç¤ºæœ¬ç«™çš„<code>copyright_info</code></p><span id="more"></span><p>ä¸‹æ–‡æ‰€å‡ºç°çš„åœºæ™¯ï¼Œæ˜¯æˆ‘åœ¨linuxä¸Šä½¿ç”¨dockerå®‰è£…centoså®¹å™¨æ—¶å‡ºç°çš„ï¼</p><hr><p>âœ¨åœ¨å­¦ä¹ ä½¿ç”¨ docker æŠ€æœ¯è¿‡ç¨‹ä¸­ï¼ŒåŸºäº centos é•œåƒè‡ªå®šä¹‰æ–°çš„é•œåƒï¼Œå…¶ä¸­åŸºç¡€é•œåƒ centos éœ€è¦æå‰å®‰è£…å¥½ <a class="link"   href="https://so.csdn.net/so/search?q=vim&spm=1001.2101.3001.7020" >vim<i class="fas fa-external-link-alt"></i></a> å’Œ net-toolsï¼Œç„¶è€Œåœ¨åˆšå¼€å§‹é€šè¿‡ <code>yum -y install vim</code> å®‰è£… vim æ—¶ï¼Œä¾¿å‡ºç°äº†é”™è¯¯æç¤ºä¿¡æ¯ï¼š<br><img                       lazyload                     alt="image"                     data-src="https://img-blog.csdnimg.cn/e37da7b938584262b8d469360f463300.png"                                     ></p><pre><code>Error: Failed to download metadata for repo &#39;appstream&#39;: Cannot prepare internal mirrorlist: No URLs in mirrorlist</code></pre><p>âœ¨ä¸Šé¢çš„æŠ¥é”™ä¿¡æ¯æ„æ€æ˜¯ï¼Œ<strong>ä»ä»“åº“ â€˜appstreamâ€™ ä¸‹è½½å…ƒæ•°æ®å¤±è´¥ï¼šç”±äºé•œåƒåˆ—è¡¨ä¸­æ²¡æœ‰ URLï¼Œä¸èƒ½å‡†å¤‡å†…éƒ¨é•œåƒåˆ—è¡¨</strong>ã€‚</p><h1 id="ğŸ¥é—®é¢˜åˆ†æï¼š"><a href="#ğŸ¥é—®é¢˜åˆ†æï¼š" class="headerlink" title="ğŸ¥é—®é¢˜åˆ†æï¼š"></a>ğŸ¥é—®é¢˜åˆ†æï¼š</h1><ul><li>âœ¨ç¬¬ä¸€ç§å¯èƒ½çš„æƒ…å†µä¾¿æ˜¯ç½‘ç»œè¿æ¥é—®é¢˜ã€‚æ£€æŸ¥æ˜¯å¦å¯ä»¥è¿æ¥å¤–éƒ¨ç½‘ç»œï¼Œå¯ä»¥ä½¿ç”¨ <code>ping baidu.com</code> æŸ¥çœ‹æ˜¯å¦æœ‰ä¸¢åŒ…æƒ…å†µã€‚å¦‚æœä¸¢åŒ…ï¼Œåˆ™è¿›ä¸€æ­¥æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸ï¼›å¦‚æœæ²¡æœ‰ä¸¢åŒ…ï¼Œç»§ç»­é˜…è¯»ä¸‹æ–‡</li><li>âœ¨é‚£ä¹ˆç¬¬äºŒç§æƒ…å†µï¼Œä¾¿æ˜¯ CentOS å·²ç»åœæ­¢ç»´æŠ¤çš„é—®é¢˜ã€‚2020 å¹´ 12 æœˆ 8 å·ï¼ŒCentOS å®˜æ–¹å®£å¸ƒäº†åœæ­¢ç»´æŠ¤ CentOS Linux çš„è®¡åˆ’ï¼Œå¹¶æ¨å‡ºäº† CentOS Stream é¡¹ç›®ï¼ŒCentOS Linux 8 ä½œä¸º RHEL 8 çš„å¤åˆ»ç‰ˆæœ¬ï¼Œç”Ÿå‘½å‘¨æœŸç¼©çŸ­ï¼Œäº 2021 å¹´ 12 æœˆ 31 æ—¥åœæ­¢æ›´æ–°å¹¶åœæ­¢ç»´æŠ¤ï¼ˆEOLï¼‰ï¼Œ</li><li>æ›´å¤šçš„ä¿¡æ¯å¯ä»¥æŸ¥çœ‹ <a class="link"   href="https://blog.centos.org/2020/12/future-is-centos-stream/?spm=a2c4g.11186623.0.0.3b005eb35dW2Kg" >CentOS å®˜æ–¹å…¬å‘Š<i class="fas fa-external-link-alt"></i></a>ã€‚<strong>å¦‚æœéœ€è¦æ›´æ–° CentOSï¼Œéœ€è¦å°†é•œåƒä» <a class="link"   href="http://mirror.centos.org/" >mirror.centos.org<i class="fas fa-external-link-alt"></i></a> æ›´æ”¹ä¸º <a class="link"   href="https://vault.centos.org/" >vault.centos.org<i class="fas fa-external-link-alt"></i></a></strong></li></ul><h1 id="ğŸ¥é‚£ä¹ˆé’ˆå¯¹ä¸Šé¢æåˆ°çš„ç¬¬äºŒç§æƒ…å†µï¼Œç»™å‡ºçš„è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š"><a href="#ğŸ¥é‚£ä¹ˆé’ˆå¯¹ä¸Šé¢æåˆ°çš„ç¬¬äºŒç§æƒ…å†µï¼Œç»™å‡ºçš„è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š" class="headerlink" title="ğŸ¥é‚£ä¹ˆé’ˆå¯¹ä¸Šé¢æåˆ°çš„ç¬¬äºŒç§æƒ…å†µï¼Œç»™å‡ºçš„è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š"></a>ğŸ¥é‚£ä¹ˆé’ˆå¯¹ä¸Šé¢æåˆ°çš„ç¬¬äºŒç§æƒ…å†µï¼Œç»™å‡ºçš„è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š</h1><ul><li><p>ğŸ”” <strong>é¦–å…ˆ</strong>ï¼Œè¿›å…¥åˆ° yum çš„ repos ç›®å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/yum.repos.d/</span><br></pre></td></tr></table></figure></li><li><p>ğŸ””<strong>å…¶æ¬¡</strong>ï¼Œä¿®æ”¹ centos æ–‡ä»¶å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -i &#x27;s/mirrorlist/#mirrorlist/g&#x27; /etc/yum.repos.d/CentOS-*</span><br><span class="line">sed -i &#x27;s|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g&#x27; /etc/yum.repos.d/CentOS-*</span><br></pre></td></tr></table></figure></li><li><p>ğŸ”” <strong>ç„¶å</strong>ï¼Œç”Ÿæˆç¼“å­˜æ›´æ–°ï¼ˆç¬¬ä¸€æ¬¡æ›´æ–°ï¼Œé€Ÿåº¦ç¨å¾®æœ‰ç‚¹æ…¢ï¼Œè€å¿ƒç­‰å¾…ä¸¤åˆ†é’Ÿå·¦å³ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache</span><br></pre></td></tr></table></figure></li><li><p>ğŸ”” <strong>æœ€å</strong>ï¼Œè¿è¡Œ yum update å¹¶é‡æ–°å®‰è£… vim</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum update -y</span><br><span class="line">yum -y install vim</span><br></pre></td></tr></table></figure></li></ul><p>ğŸ‰<strong>è‡³æ­¤ï¼Œé’ˆå¯¹ç¬¬äºŒç§æƒ…å†µå‡ºç°çš„é—®é¢˜æˆåŠŸè§£å†³ï¼</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åŸæ–‡ä½œè€…ï¼šReadThroughLife</span><br><span class="line">åŸæ–‡åœ°å€ï¼šhttps://blog.csdn.net/weixin_43252521/article/details/124409151</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ¬ç«™ç»å¸¸æ¬è¿ä¸€äº›å…¶ä»–åšä¸»æ–‡ç« ï¼Œä¸»è¦æ˜¯ä¸ºäº†æŒä¹…åŒ–è®¿é—®ã€‚é¿å…æ—¥åä»–äººåˆ æ–‡oråŸæ–‡æ— æ³•è®¿é—®ï¼›æ‰€æœ‰æ¬è¿çš„æ–‡ç« éƒ½ä¼šå†™æ˜åŸæ–‡åœ°å€ï¼Œå¹¶ä¸”ä¸ä¼šå±•ç¤ºæœ¬ç«™çš„&lt;code&gt;copyright_info&lt;/code&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="dockerçœŸå¥½ç©" scheme="https://blog.musnow.top/categories/docker%E7%9C%9F%E5%A5%BD%E7%8E%A9/"/>
    
    
    <category term="CentOS" scheme="https://blog.musnow.top/tags/CentOS/"/>
    
    <category term="Docker" scheme="https://blog.musnow.top/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>ã€C++ã€‘C++11ä¸­å±€éƒ¨staticå˜é‡çš„çº¿ç¨‹å®‰å…¨é—®é¢˜</title>
    <link href="https://blog.musnow.top/2023/02/20/cpp/29C++11%E5%B1%80%E9%83%A8%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F%E5%88%9D%E5%A7%8B%E5%8C%96%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/"/>
    <id>https://blog.musnow.top/2023/02/20/cpp/29C++11%E5%B1%80%E9%83%A8%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F%E5%88%9D%E5%A7%8B%E5%8C%96%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/</id>
    <published>2023-02-20T13:13:46.000Z</published>
    <updated>2023-03-10T14:54:08.274Z</updated>
    
    <content type="html"><![CDATA[<p>C++11ä¸­å±€éƒ¨staticå˜é‡çš„çº¿ç¨‹å®‰å…¨é—®é¢˜</p><span id="more"></span><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å¤§å®¶éƒ½çŸ¥é“ï¼Œåœ¨C++11æ ‡å‡†ä¸­ï¼Œè¦æ±‚å±€éƒ¨é™æ€å˜é‡åˆå§‹åŒ–å…·æœ‰<a class="link"   href="https://so.csdn.net/so/search?q=%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8&spm=1001.2101.3001.7020" >çº¿ç¨‹å®‰å…¨<i class="fas fa-external-link-alt"></i></a>æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“å®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å•ä¾‹ç±»ï¼š</p><pre><code>class Foo&#123;public:    static Foo *getInstance()    &#123;        static Foo s_instance;        return &amp;s_instance;    &#125;private:    Foo() &#123;&#125;&#125;;</code></pre><p>åœ¨C++æ ‡å‡†ä¸­ï¼Œæ˜¯è¿™æ ·æè¿°çš„ï¼ˆåœ¨<a class="link"   href="https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3337.pdf" >æ ‡å‡†è‰æ¡ˆ<i class="fas fa-external-link-alt"></i></a>çš„6.7èŠ‚ä¸­ï¼‰ï¼š</p><blockquote><p>such a variable is initialized the first time control passes through its declaration; such a variable is considered initialized upon the completion of its initialization. If the initialization exits by throwing an exception, the initialization is not complete, so it will be tried again the next time control enters the declaration. If control enters the declaration concurrently while the variable is being initialized, the concurrent execution shall wait for completion of the initialization. If control re-enters the declaration recursively while the variable is being initialized, the behavior is undefined.</p></blockquote><h1 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h1><p>æ ‡å‡†å…³äºå±€éƒ¨é™æ€å˜é‡åˆå§‹åŒ–ï¼Œæœ‰è¿™ä¹ˆå‡ ç‚¹è¦æ±‚ï¼š</p><ol><li>å˜é‡åœ¨ä»£ç ç¬¬ä¸€æ¬¡æ‰§è¡Œåˆ°å˜é‡å£°æ˜çš„åœ°æ–¹æ—¶åˆå§‹åŒ–ã€‚</li><li>åˆå§‹åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸çš„è¯è§†ä¸ºæœªå®Œæˆåˆå§‹åŒ–ï¼Œæœªå®Œæˆåˆå§‹åŒ–çš„è¯ï¼Œéœ€è¦ä¸‹æ¬¡æœ‰ä»£ç æ‰§è¡Œåˆ°ç›¸åŒä½ç½®æ—¶å†æ¬¡åˆå§‹åŒ–ã€‚</li><li>åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œåˆ°éœ€è¦åˆå§‹åŒ–å˜é‡çš„åœ°æ–¹æ—¶ï¼Œå¦‚æœæœ‰å…¶ä»–çº¿ç¨‹æ­£åœ¨åˆå§‹åŒ–è¯¥å˜é‡ï¼Œåˆ™é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°åˆå§‹åŒ–å®Œæˆä¸ºæ­¢ã€‚</li><li>å¦‚æœåˆå§‹åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¯¹åˆå§‹åŒ–çš„é€’å½’è°ƒç”¨ï¼Œåˆ™è§†ä¸ºæœªå®šä¹‰è¡Œä¸ºã€‚</li></ol><p>å…³äºç¬¬4ç‚¹ï¼Œå¦‚æœä¸æ˜ç™½ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹ä»£ç ï¼š</p><pre><code>class Bar&#123;public:    static Bar *getInstance()    &#123;        static Bar s_instance;        return &amp;s_instance;    &#125;private:    Bar()    &#123;        getInstance();    &#125;&#125;;</code></pre><h1 id="GCCçš„å®ç°"><a href="#GCCçš„å®ç°" class="headerlink" title="GCCçš„å®ç°"></a>GCCçš„å®ç°</h1><p>ä»¥GCC 7.3.0ç‰ˆæœ¬ä¸ºä¾‹ï¼Œæˆ‘ä»¬æ¥åˆ†æGCCæ˜¯å¦‚ä½•å®ç°æ ‡å‡†çš„ã€‚</p><h2 id="Foo-getInstance"><a href="#Foo-getInstance" class="headerlink" title="Foo::getInstance()"></a>Foo::getInstance()</h2><p>ä½¿ç”¨GCCç¼–è¯‘åï¼Œæˆ‘ä»¬ä½¿ç”¨gdbå°†æ–‡ç« å¼€å¤´çš„<code>Foo::getInstance()</code>åæ±‡ç¼–ï¼š</p><pre><code>Dump of assembler code for function Foo::getInstance():   0x00005555555546ea &lt;+0&gt;:     push   %rbp   0x00005555555546eb &lt;+1&gt;:     mov    %rsp,%rbp=&gt; 0x00005555555546ee &lt;+4&gt;:     movzbl 0x20092b(%rip),%eax        # 0x555555755020 &lt;_ZGVZN3Foo11getInstanceEvE10s_instance&gt;   0x00005555555546f5 &lt;+11&gt;:    test   %al,%al   0x00005555555546f7 &lt;+13&gt;:    sete   %al   0x00005555555546fa &lt;+16&gt;:    test   %al,%al   0x00005555555546fc &lt;+18&gt;:    je     0x55555555472b &lt;Foo::getInstance()+65&gt;   0x00005555555546fe &lt;+20&gt;:    lea    0x20091b(%rip),%rdi        # 0x555555755020 &lt;_ZGVZN3Foo11getInstanceEvE10s_instance&gt;   0x0000555555554705 &lt;+27&gt;:    callq  0x5555555545b0 &lt;__cxa_guard_acquire@plt&gt;   0x000055555555470a &lt;+32&gt;:    test   %eax,%eax   0x000055555555470c &lt;+34&gt;:    setne  %al   0x000055555555470f &lt;+37&gt;:    test   %al,%al   0x0000555555554711 &lt;+39&gt;:    je     0x55555555472b &lt;Foo::getInstance()+65&gt;   0x0000555555554713 &lt;+41&gt;:    lea    0x2008fe(%rip),%rdi        # 0x555555755018 &lt;_ZZN3Foo11getInstanceEvE10s_instance&gt;   0x000055555555471a &lt;+48&gt;:    callq  0x555555554734 &lt;Foo::Foo()&gt;   0x000055555555471f &lt;+53&gt;:    lea    0x2008fa(%rip),%rdi        # 0x555555755020 &lt;_ZGVZN3Foo11getInstanceEvE10s_instance&gt;   0x0000555555554726 &lt;+60&gt;:    callq  0x5555555545a0 &lt;__cxa_guard_release@plt&gt;   0x000055555555472b &lt;+65&gt;:    lea    0x2008e6(%rip),%rax        # 0x555555755018 &lt;_ZZN3Foo11getInstanceEvE10s_instance&gt;   0x0000555555554732 &lt;+72&gt;:    pop    %rbp   0x0000555555554733 &lt;+73&gt;:    retq   End of assembler dump.</code></pre><p>åœ¨<code>+4</code>ã€<code>+20</code>ã€<code>+53</code>å‡ºç°çš„<code>_ZGVZN3Foo11getInstanceEvE10s_instance</code>ä½¿ç”¨<code>c++filt</code>åˆ†æä¸º<code>guard variable for Foo::getInstance()::s_instance</code>ï¼Œè€Œ<code>+41</code>ã€<code>+65</code>ä½ç½®å‡ºç°çš„<code>_ZZN3Foo11getInstanceEvE10s_instance</code>åˆ™ä¸º<code>Foo::getInstance()::s_instance</code>ã€‚åè€…æ˜¯<code>s_instance</code>è¿™ä¸ªå±€éƒ¨é™æ€å˜é‡ï¼Œå‰è€…ä»åå­—çœ‹å°±çŸ¥é“æ˜¯ä¸ª<code>guard</code>æ ‡å¿—å˜é‡ï¼Œç”¨æ¥æŒ‡ç¤ºå±€éƒ¨é™æ€å˜é‡çš„åˆå§‹åŒ–çŠ¶æ€ã€‚</p><h3 id="4-18"><a href="#4-18" class="headerlink" title="+4 ~ +18"></a>+4 ~ +18</h3><p>æµ‹è¯•<code>guard</code>å˜é‡çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œå¦‚æœä¸º<code>0</code>ï¼Œä»£è¡¨<code>s_instance</code>æœªåˆå§‹åŒ–ï¼Œè¿›å…¥<code>+27</code>ï¼›å¦åˆ™ä»£è¡¨<code>s_instance</code>å·²åˆå§‹åŒ–ï¼Œè¿›å…¥<code>+65</code>ã€‚</p><h3 id="20-ï½-27"><a href="#20-ï½-27" class="headerlink" title="+20 ï½ +27"></a>+20 ï½ +27</h3><p>ä»¥<code>guard</code>å˜é‡åœ°å€ä½œä¸ºå‚æ•°ï¼Œæ‰§è¡Œ<code>__cxa_guard_acquire</code>å‡½æ•°ã€‚</p><h3 id="32-ï½-39"><a href="#32-ï½-39" class="headerlink" title="+32 ï½ +39"></a>+32 ï½ +39</h3><p>æµ‹è¯•è¿”å›å€¼ï¼Œå¦‚æœä¸º<code>0</code>ï¼Œä»£è¡¨<code>s_instance</code>å·²åˆå§‹åŒ–ï¼Œè¿›å…¥<code>+65</code>ï¼›å¦åˆ™ä»£è¡¨<code>s_instance</code>æœªåˆå§‹åŒ–ï¼Œè¿›å…¥<code>+41</code>ã€‚</p><h3 id="41-ï½-48"><a href="#41-ï½-48" class="headerlink" title="+41 ï½ +48"></a>+41 ï½ +48</h3><p>åˆå§‹åŒ–<code>s_instance</code></p><h3 id="53-ï½-60"><a href="#53-ï½-60" class="headerlink" title="+53 ï½ +60"></a>+53 ï½ +60</h3><p>ä»¥<code>guard</code>å˜é‡åœ°å€ä½œä¸ºå‚æ•°ï¼Œæ‰§è¡Œ<code>__cxa_guard_release</code>å‡½æ•°ã€‚</p><h3 id="65-ï½-73"><a href="#65-ï½-73" class="headerlink" title="+65 ï½ +73"></a>+65 ï½ +73</h3><p>è¿”å›<code>s_instance</code>åœ°å€</p><h2 id="cxa-guard-acquire"><a href="#cxa-guard-acquire" class="headerlink" title="__cxa_guard_acquire"></a>__cxa_guard_acquire</h2><p>æˆ‘ä»¬æ¥çœ‹çœ‹<code>__cxa_guard_acquire</code>è¿™ä¸ªå‡½æ•°å…·ä½“åšäº†ä»€ä¹ˆï¼Œè¯¥å‡½æ•°ä»£ç ä½äº<code>gcc-7-7.3.0/gcc-7.3.0/libstdc++-v3/libsupc++/guard.cc</code>ã€‚ç”±äºè¿™ä¸ªå‡½æ•°é’ˆå¯¹ä¸åŒå¹³å°åšäº†ä¸åŒçš„å®ç°ï¼Œæœ‰äº›æˆ‘ä»¬ä¸éœ€è¦çš„ä»£ç ï¼Œä»¥æˆ‘æœºå™¨çš„è®¾ç½®ï¼Œæ”¯æŒçº¿ç¨‹å’Œfutexç³»ç»Ÿè°ƒç”¨ï¼Œæ‰€ä»¥åˆ é™¤äº†ä¸€äº›ä¸ç›¸å…³çš„ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cxa_guard_acquire (__guard *g)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// If the target can reorder loads, we need to insert a read memory</span></span><br><span class="line">    <span class="comment">// barrier so that accesses to the guarded variable happen after the</span></span><br><span class="line">    <span class="comment">// guard test.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1</span></span><br><span class="line">    <span class="keyword">if</span> (_GLIBCXX_GUARD_TEST_AND_ACQUIRE (g))</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If __atomic_* and futex syscall are supported, don&#x27;t use any global</span></span><br><span class="line">    <span class="comment">// mutex.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2</span></span><br><span class="line">    <span class="keyword">if</span> (__gthread_active_p ())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> *gi = (<span class="type">int</span> *) (<span class="type">void</span> *) g;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3</span></span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> guard_bit = _GLIBCXX_GUARD_BIT;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> pending_bit = _GLIBCXX_GUARD_PENDING_BIT;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> waiting_bit = _GLIBCXX_GUARD_WAITING_BIT;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 4</span></span><br><span class="line">            <span class="function"><span class="type">int</span> <span class="title">expected</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">            <span class="keyword">if</span> (__atomic_compare_exchange_n(gi, &amp;expected, pending_bit, <span class="literal">false</span>,</span><br><span class="line">                                            __ATOMIC_ACQ_REL,</span><br><span class="line">                                            __ATOMIC_ACQUIRE))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// This thread should do the initialization.</span></span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 5</span></span><br><span class="line">            <span class="keyword">if</span> (expected == guard_bit)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// Already initialized.</span></span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 6</span></span><br><span class="line">            <span class="keyword">if</span> (expected == pending_bit)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// Use acquire here.</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 7</span></span><br><span class="line">                <span class="type">int</span> newv = expected | waiting_bit;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 8</span></span><br><span class="line">                <span class="keyword">if</span> (!__atomic_compare_exchange_n(gi, &amp;expected, newv, <span class="literal">false</span>,</span><br><span class="line">                                                 __ATOMIC_ACQ_REL,</span><br><span class="line">                                                 __ATOMIC_ACQUIRE))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 9</span></span><br><span class="line">                    <span class="keyword">if</span> (expected == guard_bit)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// Make a thread that failed to set the</span></span><br><span class="line">                        <span class="comment">// waiting bit exit the function earlier,</span></span><br><span class="line">                        <span class="comment">// if it detects that another thread has</span></span><br><span class="line">                        <span class="comment">// successfully finished initialising.</span></span><br><span class="line">                        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 10</span></span><br><span class="line">                    <span class="keyword">if</span> (expected == <span class="number">0</span>)</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 11</span></span><br><span class="line">                expected = newv;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 12</span></span><br><span class="line">            <span class="built_in">syscall</span> (SYS_futex, gi, _GLIBCXX_FUTEX_WAIT, expected, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">acquire</span> (g);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>é¦–å…ˆæ£€æµ‹<code>guard</code>å˜é‡ï¼Œ<code>guard</code>å˜é‡ç­‰äº<code>1</code>çš„è¯ï¼Œç›´æ¥è¿”å›<code>0</code>ï¼Œä»£è¡¨<code>s_instance</code>å·²åˆå§‹åŒ–ï¼Œä¸éœ€è¦å†æ¬¡åˆå§‹åŒ–ã€‚</li><li>æ£€æµ‹æ˜¯å¦ä¸ºå¤šçº¿ç¨‹ç¯å¢ƒï¼Œå¦‚æœæ²¡æœ‰å¤šçº¿ç¨‹çš„è¯ï¼Œä¹Ÿå°±æ²¡æœ‰å¿…è¦å»åšé¢å¤–å·¥ä½œæ¥ä¿è¯çº¿ç¨‹å®‰å…¨äº†ã€‚</li><li><code>guard_bit</code>è¡¨ç¤º<code>s_instance</code>å·²ç»åˆå§‹åŒ–æˆåŠŸï¼›<code>pending_bit</code>è¡¨ç¤º<code>s_instance</code>æ­£åœ¨åˆå§‹åŒ–ï¼›<code>waiting_bit</code>è¡¨ç¤ºæœ‰å…¶ä»–çº¿ç¨‹æ­£åœ¨ç­‰å¾…<code>s_instance</code>çš„åˆå§‹åŒ–ã€‚</li><li>ä½¿ç”¨ä¸€ä¸ªåŸå­æ“ä½œæ¥æ£€æµ‹<code>guard</code>å˜é‡æ˜¯å¦ä¸º<code>0</code>ï¼Œå¦‚æœä¸º<code>0</code>ï¼Œåˆ™ç”±å½“å‰çº¿ç¨‹åˆå§‹åŒ–<code>s_instance</code>ï¼ŒæŠŠ<code>pending_bit</code>å†™å…¥guardå˜é‡ï¼Œè¿”å›<code>1</code>ã€‚å¦‚æœä¸ä¸º<code>0</code>ï¼Œåˆ™å°†guardå½“å‰å€¼å†™å…¥<code>expected</code>ã€‚</li><li>æ£€æµ‹<code>expected</code>å€¼æ˜¯å¦ä¸º<code>guard_bit</code>ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™<code>s_instance</code>å·²åˆå§‹åŒ–å®Œæˆï¼Œä¸å†éœ€è¦åˆå§‹åŒ–ï¼Œè¿”å›<code>0</code>ã€‚</li><li>æ£€æµ‹<code>expected</code>å€¼æ˜¯å¦ä¸º<code>pending_bit</code>ï¼Œå¦‚æœæ˜¯ï¼Œè¯´æ˜<code>s_instance</code>æ­£åœ¨åˆå§‹åŒ–ï¼Œä¸”æ²¡æœ‰å…¶ä»–çº¿ç¨‹ç­‰å¾…åˆå§‹åŒ–ã€‚</li><li>å°†<code>newv</code>å˜é‡è®¾ç½®ä¸º<code>pending_bit | waiting_bit</code>ï¼Œè¡¨ç¤º<code>s_instance</code>æ­£åœ¨åˆå§‹åŒ–ä¸”æœ‰çº¿ç¨‹æ­£åœ¨ç­‰å¾…åˆå§‹åŒ–ã€‚</li><li>ä½¿ç”¨ä¸€ä¸ªåŸå­æ“ä½œæ¥æ£€æµ‹<code>guard</code>å˜é‡æ˜¯å¦ä¸º<code>pending_bit</code>ï¼Œå¦‚æœä¸æ˜¯ï¼Œè¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†<code>guard</code>å˜é‡ï¼Œéœ€è¦åšè¿›ä¸€æ­¥æ£€æµ‹ï¼›å¦‚æœæ˜¯ï¼Œè¯´æ˜æ²¡æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹<code>guard</code>å˜é‡ï¼Œåˆ™å°†<code>pending_bit | waiting_bit</code>å†™å…¥<code>guard</code>å˜é‡ã€‚</li><li>å¦‚æœ<code>expected</code>ç­‰äº<code>guard_bit</code>ï¼Œè¯´æ˜<code>s_instance</code>è¢«åˆå§‹åŒ–æˆåŠŸï¼Œä¸éœ€è¦å†åˆå§‹åŒ–ï¼Œè¿”å›<code>0</code>ã€‚</li><li>å¦‚æœ<code>expected</code>ç­‰äº<code>0</code>ï¼Œè¯´æ˜<code>s_instance</code>åˆå§‹åŒ–å¤±è´¥ï¼Œå›åˆ°<code>4</code>é‡æ–°å¼€å§‹æ£€æµ‹ã€‚</li><li>å¦‚æœåœ¨<code>8</code>ä¸­æ²¡æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡<code>guard</code>å˜é‡ï¼Œå°†<code>expected</code>è®¾ç½®ä¸º<code>pending_bit | waiting_bit</code>ï¼Œè¡¨ç¤º<code>s_instance</code>æ­£åœ¨åˆå§‹åŒ–ä¸”æœ‰çº¿ç¨‹ï¼ˆä¹Ÿå°±æ˜¯å½“å‰çº¿ç¨‹ï¼‰æ­£åœ¨ç­‰å¾…åˆå§‹åŒ–ã€‚</li><li>å¦‚æœåœ¨<code>6</code>å¤„æ²¡æœ‰è¿›å…¥ifåˆ†æ”¯ï¼Œè¯´æ˜<code>expected</code>ç­‰äº<code>pending_bit | waiting_bit</code>ï¼Œå¦‚æœè¿›å…¥äº†ifåˆ†æ”¯ï¼Œç”±<code>11</code>å¯å¾—ï¼Œæ­¤æ—¶<code>expected</code>ä¹Ÿè¢«ä¿®æ”¹ä¸ºäº†<code>pending_bit | waiting_bit</code>ã€‚æ€»ä¹‹ï¼Œæ­¤æ—¶<code>s_instance</code>æ­£åœ¨åˆå§‹åŒ–ä¸”æœ‰çº¿ç¨‹æ­£åœ¨ç­‰å¾…åˆå§‹åŒ–ã€‚åˆ©ç”¨<code>futex</code>ç³»ç»Ÿè°ƒç”¨ï¼Œå†æ¬¡æ£€æµ‹<code>guard</code>å˜é‡æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼Œå¦‚æœå‘ç”Ÿäº†å˜åŒ–ï¼Œå›åˆ°<code>4</code>é‡æ–°å¼€å§‹æ£€æµ‹ï¼›å¦‚æœæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä»ç„¶ç­‰äº<code>pending_bit | waiting_bit</code>ï¼Œåˆ™æŒ‚èµ·å½“å‰çº¿ç¨‹ã€‚</li></ol><p>æ€»ä¹‹ï¼Œ<code>__cxa_guard_acquire</code>è¦ä¹ˆè¿”å›<code>0</code>è¦ä¹ˆè¿”å›<code>1</code>ï¼Œç”¨æ¥æŒ‡ç¤º<code>s_instance</code>å·²åˆå§‹åŒ–æˆ–æœªåˆå§‹åŒ–ã€‚<code>__cxa_guard_acquire</code>å¯èƒ½ä¼šå¯¼è‡´å½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œè¿™å‘ç”Ÿåœ¨<code>s_instance</code>æ­£åœ¨åˆå§‹åŒ–çš„æ—¶å€™ã€‚</p><h2 id="cxa-guard-release"><a href="#cxa-guard-release" class="headerlink" title="__cxa_guard_release"></a>__cxa_guard_release</h2><p>ç”±äº<code>__cxa_guard_acquire</code>å¯èƒ½å¯¼è‡´å½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œå› æ­¤éœ€è¦åœ¨<code>s_instance</code>åˆå§‹åŒ–å®Œæˆåä½¿ç”¨å°†<code>__cxa_guard_release</code>çº¿ç¨‹å”¤é†’ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cxa_guard_release (__guard *g) <span class="keyword">throw</span> ()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// If __atomic_* and futex syscall are supported, don&#x27;t use any global</span></span><br><span class="line">    <span class="comment">// mutex.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1</span></span><br><span class="line">    <span class="keyword">if</span> (__gthread_active_p ())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> *gi = (<span class="type">int</span> *) (<span class="type">void</span> *) g;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> guard_bit = _GLIBCXX_GUARD_BIT;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> waiting_bit = _GLIBCXX_GUARD_WAITING_BIT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2</span></span><br><span class="line">        <span class="type">int</span> old = __atomic_exchange_n (gi, guard_bit, __ATOMIC_ACQ_REL);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3</span></span><br><span class="line">        <span class="keyword">if</span> ((old &amp; waiting_bit) != <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">syscall</span> (SYS_futex, gi, _GLIBCXX_FUTEX_WAKE, INT_MAX);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">set_init_in_progress_flag</span>(g, <span class="number">0</span>);</span><br><span class="line">    _GLIBCXX_GUARD_SET_AND_RELEASE (g);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>æ£€æµ‹æ˜¯å¦ä¸ºå¤šçº¿ç¨‹ç¯å¢ƒ</li><li>ä½¿ç”¨åŸå­æ“ä½œå°†<code>guard</code>å˜é‡ç½®ä¸º<code>guard_bit</code>ï¼ŒåŒæ—¶è·å–<code>guard</code>å˜é‡åŸå§‹å€¼ã€‚</li><li>å¦‚æœ<code>guard</code>å˜é‡åŸå§‹å€¼åŒ…å«<code>waiting_bit</code>ï¼Œè¯´æ˜æœ‰çº¿ç¨‹æŒ‚èµ·ï¼ˆæˆ–å°†è¦è°ƒç”¨<code>futex</code>æ¬²ä½¿çº¿ç¨‹æŒ‚èµ·ï¼‰ï¼Œè°ƒç”¨<code>futex</code>å”¤é†’æŒ‚èµ·çš„è¿›ç¨‹ã€‚</li></ol><h2 id="cxa-guard-abort"><a href="#cxa-guard-abort" class="headerlink" title="__cxa_guard_abort"></a>__cxa_guard_abort</h2><p>ç”±äº<code>s_instance</code>å¯èƒ½åˆå§‹åŒ–å¤±è´¥ï¼ˆæœ¬ä¾‹ä¸­å¹¶æœªä½“ç°ï¼‰ï¼Œå› æ­¤è¿˜æœ‰ä¸€ä¸ª<code>__cxa_guard_abort</code>å‡½æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cxa_guard_abort (__guard *g) <span class="keyword">throw</span> ()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// If __atomic_* and futex syscall are supported, don&#x27;t use any global</span></span><br><span class="line">    <span class="comment">// mutex.</span></span><br><span class="line">    <span class="keyword">if</span> (__gthread_active_p ())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> *gi = (<span class="type">int</span> *) (<span class="type">void</span> *) g;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> waiting_bit = _GLIBCXX_GUARD_WAITING_BIT;</span><br><span class="line">        <span class="type">int</span> old = __atomic_exchange_n (gi, <span class="number">0</span>, __ATOMIC_ACQ_REL);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((old &amp; waiting_bit) != <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">syscall</span> (SYS_futex, gi, _GLIBCXX_FUTEX_WAKE, INT_MAX);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">set_init_in_progress_flag</span>(g, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸<code>__cxa_guard_release</code>åŸºæœ¬ä¸€è‡´ï¼Œä¸åŒçš„åœ°æ–¹åœ¨äºä¼šå°†<code>guard</code>å˜é‡ç½®<code>0</code>ã€‚</p><h2 id="é€’å½’åˆå§‹åŒ–è°ƒç”¨"><a href="#é€’å½’åˆå§‹åŒ–è°ƒç”¨" class="headerlink" title="é€’å½’åˆå§‹åŒ–è°ƒç”¨"></a>é€’å½’åˆå§‹åŒ–è°ƒç”¨</h2><p>ç”±äºåœ¨C++11æ ‡å‡†ä¸­ï¼Œåˆå§‹åŒ–å¦‚æœå‘ç”Ÿäº†é€’å½’æ˜¯æœªå®šä¹‰è¡Œä¸ºï¼Œæ‰€ä»¥GCC 7.3.0é’ˆå¯¹æ˜¯å¦ä¸º<a class="link"   href="https://so.csdn.net/so/search?q=%E5%A4%9A%E7%BA%BF%E7%A8%8B&spm=1001.2101.3001.7020" >å¤šçº¿ç¨‹<i class="fas fa-external-link-alt"></i></a>ç¯å¢ƒåšäº†ä¸åŒçš„å¤„ç†ã€‚å¦‚æœæ˜¯å¤šçº¿ç¨‹ç¯å¢ƒï¼Œä¸è¿›è¡Œé¢å¤–å¤„ç†ï¼Œä¼šå‘ç”Ÿæ­»é”ï¼›å¦‚æœæ˜¯å•çº¿ç¨‹ç¯å¢ƒï¼Œåˆ™ä¼šæŠ›å¼‚å¸¸ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// acquire() is a helper function used to acquire guard if thread support is</span></span><br><span class="line"><span class="comment">// not compiled in or is compiled in but not enabled at run-time.</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span></span></span><br><span class="line"><span class="function"><span class="title">acquire</span><span class="params">(__guard *g)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Quit if the object is already initialized.</span></span><br><span class="line">    <span class="keyword">if</span> (_GLIBCXX_GUARD_TEST(g))</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">init_in_progress_flag</span>(g))</span><br><span class="line">        <span class="built_in">throw_recursive_init_exception</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">set_init_in_progress_flag</span>(g, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>çœ‹åˆ°äº†GCCå¦‚æ­¤å¤æ‚çš„å®ç°ï¼Œæˆ‘çš„ä¸ªäººæ„Ÿæƒ³æ˜¯è¿˜æ˜¯ä¸è¦è‡ªå·±é€ è½®å­æ¥ä¿è¯å•ä¾‹ç±»çš„çº¿ç¨‹å®‰å…¨äº†ï¼Œæƒ³è¦åšåˆ°å’ŒGCCä¸€æ ·çš„é«˜æ•ˆè¿˜æ˜¯æ¯”è¾ƒéš¾çš„ï¼Œåˆ©ç”¨C++11æ ‡å‡†çš„å¸¦æ¥çš„ä¾¿åˆ©å°±æŒºå¥½ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åŸæ–‡ä½œè€…ï¼šimred</span><br><span class="line">åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/imred/article/details/89069750</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;C++11ä¸­å±€éƒ¨staticå˜é‡çš„çº¿ç¨‹å®‰å…¨é—®é¢˜&lt;/p&gt;</summary>
    
    
    
    <category term="é‡è§C++" scheme="https://blog.musnow.top/categories/%E9%81%87%E8%A7%81C/"/>
    
    
    <category term="C++" scheme="https://blog.musnow.top/tags/C/"/>
    
    <category term="C++11" scheme="https://blog.musnow.top/tags/C-11/"/>
    
  </entry>
  
  <entry>
    <title>ã€Curlã€‘é€šè¿‡curlæ¨¡æ‹Ÿrefererè·å–åˆ°æœ‰é˜²ç›—é“¾çš„å›¾ç‰‡</title>
    <link href="https://blog.musnow.top/2023/02/20/tools/15curl%E6%A8%A1%E6%8B%9Freferer%E8%8E%B7%E5%8F%96%E8%B5%84%E6%BA%90/"/>
    <id>https://blog.musnow.top/2023/02/20/tools/15curl%E6%A8%A1%E6%8B%9Freferer%E8%8E%B7%E5%8F%96%E8%B5%84%E6%BA%90/</id>
    <published>2023-02-20T04:20:31.000Z</published>
    <updated>2023-03-11T11:25:36.228Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡æ‰€æè¿°æ“ä½œä»…ä¾›å­¦ä¹ curlå‘½ä»¤ï¼Œè¯·å‹¿ç”¨äºç›—åˆ·ä»–äººå›¾åºŠç­‰è¿è§„æ“ä½œï¼ğŸ™…â€â™€ï¸</p><span id="more"></span><h1 id="1-è¯´æ˜"><a href="#1-è¯´æ˜" class="headerlink" title="1.è¯´æ˜"></a>1.è¯´æ˜</h1><p>å½“æˆ‘æƒ³æŠŠ51laæ·»åŠ åˆ°æˆ‘çš„å¯¼èˆªç«™ç‚¹ï¼Œå´å‘ç°å®ƒçš„iconå›¾æ ‡æœ‰é˜²ç›—é“¾ï¼Œç¦æ­¢ç©ºrefererè®¿é—®çš„ï¼›</p><p>è¿™ç‚¹å®Œå…¨å¯ä»¥ç†è§£ï¼Œä¸ºäº†é˜²æ­¢ä»–äººç›—åˆ·æœ¬ç«™çš„å›¾ç‰‡ï¼Œé€šå¸¸æˆ‘ä»¬éƒ½éœ€è¦ç»™å›¾ç‰‡åœ°å€åŠ ä¸Šé˜²ç›—é“¾ã€‚</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f2fa1399fff.png"                      alt="image-20230220124149093"                ></p><p>å…¶å®51laæä¾›äº†è‡ªå·±çš„iconï¼Œä½†è¿™é‡Œæä¾›çš„iconåƒç´ ç‰¹åˆ«ä½ï¼Œåªæœ‰16*16ï¼Œåœ¨æˆ‘çš„å¯¼èˆªç«™ç‚¹ä¸Šçš„æ˜¾ç¤ºå°±æ²¡æœ‰é‚£ä¹ˆå‹å¥½äº†</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f2fb32ccc10.png"                      alt="image-20230220124643681"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f2fb5f7cf73.png"                      alt="image-20230220124728488"                ></p><p>æ‰€ä»¥æˆ‘æ‰æƒ³æŠŠç¨å¾®æ¸…æ™°ä¸€ç‚¹çš„iconå›¾æ ‡ä¸‹è½½ä¸‹æ¥</p><h1 id="2-curlä½¿ç”¨"><a href="#2-curlä½¿ç”¨" class="headerlink" title="2.curlä½¿ç”¨"></a>2.curlä½¿ç”¨</h1><blockquote><p>å‚è€ƒ <a class="link"   href="https://www.ruanyifeng.com/blog/2019/09/curl-reference.html" >https://www.ruanyifeng.com/blog/2019/09/curl-reference.html<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>è¦é¿å¼€è¿™ä¸ª403è®¿é—®ï¼Œéœ€è¦åšçš„å°±æ˜¯ç»™è¯·æ±‚å¤´ç»™å®šä¸€ä¸ªrefererå­—æ®µï¼Œå‘Šè¯‰51laçš„æœåŠ¡å™¨ï¼Œæˆ‘æ˜¯é€šè¿‡ä»–è‡ªå·±çš„åŸŸåè®¿é—®å›¾æ ‡æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl \</span><br><span class="line">-H &#x27;Referer: https://v6.51.la/&#x27; \</span><br><span class="line">https://v6-static.51.la/v6-static/202302161047/favicon.ico \</span><br><span class="line">-o favicon.ico</span><br></pre></td></tr></table></figure><p>å¯¹ä¸Šé¢æåˆ°çš„å‡ ä¸ªå‚æ•°åšä¸€å®šè§£é‡Š</p><ul><li>-Hè®¾å®šè¯·æ±‚å¤´ï¼Œéœ€è¦ç¬¦å·httpåè®®çš„æ ‡å‡†<code>key: value</code></li><li>-oå°†è·å–åˆ°çš„å†…å®¹ä¿å­˜ä¸ºæ–‡ä»¶ï¼Œåœ¨åé¢æŒ‡å®šæ–‡ä»¶åï¼ˆè¿™é‡Œæˆ‘æŒ‡å®šä¸ºäº†<code>favicon.ico</code>ï¼‰</li></ul><p>åœ¨linuxä¸‹ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œå°±èƒ½æˆåŠŸæ‹‰å–åˆ°51laçš„ç«™ç‚¹å›¾ç‰‡</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f2fb9421523.png"                      alt="image-20230220124820822"                ></p><p>å¦‚æœä¸åŠ refererå­—æ®µï¼Œåˆ™è¿˜æ˜¯ä¼šè¿”å›403</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ curl https://v6-static.51.la/v6-static/202302161047/favicon.ico </span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt;&lt;/center&gt;</span><br><span class="line">&lt;hr&gt;&lt;center&gt;openresty&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ¬æ–‡æ‰€æè¿°æ“ä½œä»…ä¾›å­¦ä¹ curlå‘½ä»¤ï¼Œè¯·å‹¿ç”¨äºç›—åˆ·ä»–äººå›¾åºŠç­‰è¿è§„æ“ä½œï¼ğŸ™…â€â™€ï¸&lt;/p&gt;</summary>
    
    
    
    <category term="å·®ç”Ÿæ–‡å…·å¤š" scheme="https://blog.musnow.top/categories/%E5%B7%AE%E7%94%9F%E6%96%87%E5%85%B7%E5%A4%9A/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="curl" scheme="https://blog.musnow.top/tags/curl/"/>
    
  </entry>
  
  <entry>
    <title>ã€C++ã€‘thread|mutex|atomic|condition_variable</title>
    <link href="https://blog.musnow.top/2023/02/19/cpp/28C++%E7%BA%BF%E7%A8%8B/"/>
    <id>https://blog.musnow.top/2023/02/19/cpp/28C++%E7%BA%BF%E7%A8%8B/</id>
    <published>2023-02-19T15:30:46.000Z</published>
    <updated>2023-03-11T11:25:36.272Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ï¼Œè®©æˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹C++ä¸­çš„çº¿ç¨‹æ“ä½œ</p><span id="more"></span><blockquote><p>æ‰€ç”¨ç¼–è¯‘å™¨ï¼švs2019</p><p>é˜…è¯»æœ¬æ–‡å‰ï¼Œå»ºè®®å…ˆäº†è§£çº¿ç¨‹çš„æ¦‚å¿µ ğŸ‘‰ <a href="https://blog.musnow.top/2022/12/23/note_linux/19%E7%BA%BF%E7%A8%8B%E4%BA%92%E6%96%A5/">çº¿ç¨‹æ¦‚å¿µ</a></p></blockquote><h1 id="1-åŸºæœ¬ä»‹ç»"><a href="#1-åŸºæœ¬ä»‹ç»" class="headerlink" title="1.åŸºæœ¬ä»‹ç»"></a>1.åŸºæœ¬ä»‹ç»</h1><p>åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œwindowsã€linuxã€macä¸Šï¼Œéƒ½ä¼šå¯¹å¤šçº¿ç¨‹æ“ä½œæä¾›è‡ªå·±çš„ç³»ç»Ÿè°ƒç”¨æ¥å£</p><p>ä¸ºä»€ä¹ˆC++éœ€è¦å°è£…ä¸€ä¸ªçº¿ç¨‹ï¼Ÿç›´æ¥ç”¨ç³»ç»Ÿçš„æ¥å£ä¸å¥½å—ï¼Ÿ</p><p>åœ¨<a href="https://blog.musnow.top/2022/11/01/note_linux/14%E6%96%87%E4%BB%B6io/#1-%E4%BB%80%E4%B9%88%E6%98%AF%E6%96%87%E4%BB%B6%EF%BC%9F">Linuxæ–‡ä»¶åšå®¢</a>ä¸­ï¼Œå·²ç»è°ˆè¿‡äº†è¿™ä¸€ç‚¹ï¼šå¯¹äºC++ã€pythonã€javaè¿™äº›<strong>è·¨å¹³å°</strong>çš„è¯­è¨€æ¥è¯´ï¼Œå¦‚æœç›´æ¥ç”¨ç³»ç»Ÿçš„æ¥å£ï¼Œæ˜¯å¯ä»¥å®ç°å¯¹åº”æ“ä½œçš„ã€‚ä½†æ˜¯ï¼Œè¿™æ ·ä¼šå¯¼è‡´ä»£ç <strong>åªèƒ½åœ¨æŸä¸€ä¸ªç‰¹å®šå¹³å°</strong>ï¼Œç”šè‡³æ˜¯æŸä¸€ä¸ªç‰ˆæœ¬çš„ç‰¹å®šæ“ä½œç³»ç»Ÿä¸Šæ‰èƒ½æ­£å¸¸è¿è¡Œï¼Œç›´æ¥ä¸è·¨å¹³å°çš„ç‰¹æ€§ç›¸è¿èƒŒã€‚</p><p>è§£å†³çš„åŠæ³•å‘¢ï¼Œå°±æ˜¯å¯¹ç³»ç»Ÿçš„æ¥å£å¥—ä¸€ä¸ªè¯­è¨€çº§åˆ«çš„è½¯ä»¶å±‚ï¼Œ<strong>å°è£…ç³»ç»Ÿçš„æ¥å£</strong>ã€‚å¹¶ç”¨<code>æ¡ä»¶ç¼–è¯‘</code>çš„æ–¹å¼æ¥è¯†åˆ«ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œå·²è°ƒç”¨ä¸åŒæ“ä½œç³»ç»Ÿçš„ç³»ç»Ÿæ¥å£ï¼Œä»¥å®ç°è·¨å¹³å°æ€§</p><h1 id="2-threadç±»"><a href="#2-threadç±»" class="headerlink" title="2.threadç±»"></a>2.threadç±»</h1><blockquote><p><a class="link"   href="https://legacy.cplusplus.com/reference/thread/thread/thread/" >https://legacy.cplusplus.com/reference/thread/thread/thread/<i class="fas fa-external-link-alt"></i></a></p></blockquote><h2 id="2-1-æ„é€ -x2F-èµ‹å€¼"><a href="#2-1-æ„é€ -x2F-èµ‹å€¼" class="headerlink" title="2.1 æ„é€ &#x2F;èµ‹å€¼"></a>2.1 æ„é€ &#x2F;èµ‹å€¼</h2><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f20f5b7be4e.png"                      alt="image-20230219195214155"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f20f5f8605c.png"                      alt="image-20230219200034593"                ></p><p>çº¿ç¨‹æ˜¯ä¸å…è®¸æ‹·è´æ„é€ å’Œèµ‹å€¼é‡è½½çš„ï¼Œä½†æ˜¯å…¶æ”¯æŒ<strong>å³å€¼å¼•ç”¨</strong>çš„é‡è½½ï¼ˆä¸»è¦æ˜¯ä¸ºäº†åŒ¿åå¯¹è±¡æ„é€ ï¼‰ä¹Ÿæ”¯æŒç©ºæ„é€ </p><blockquote><p>å³å€¼ï¼šæ— æ³•è¿›è¡Œå–åœ°å€çš„å˜é‡</p></blockquote><h2 id="2-2-get-id"><a href="#2-2-get-id" class="headerlink" title="2.2 get_id"></a>2.2 get_id</h2><p>å¯¹äºçº¿ç¨‹è€Œè¨€ï¼Œæ¯”è¾ƒé‡è¦çš„å°±æ˜¯è¿™ä¸ªidå·äº†ï¼Œå…¶ç”¨äºæ ‡è¯†çº¿ç¨‹çš„å”¯ä¸€æ€§</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f22efb3c6f0.png"                      alt="image-20230219221526489"                ></p><h2 id="2-3-join-x2F-detach"><a href="#2-3-join-x2F-detach" class="headerlink" title="2.3 join&#x2F;detach"></a>2.3 join&#x2F;detach</h2><p>åˆ›å»ºå¥½äº†ä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œjoinç­‰å¾…æˆ–è€…detachåˆ†ç¦»</p><ul><li>å¦‚æœä¸»çº¿ç¨‹ä¸éœ€è¦è·å–å­è¿›ç¨‹æ‰§è¡Œçš„ç»“æœï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œdetach</li><li>å¦‚æœéœ€è¦ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œï¼Œåˆ™æ‰§è¡Œjoin</li></ul><p>ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè¿™ä¸¤ä¸ªåˆ†æ­§å‘¢ï¼Ÿæ˜¯å› ä¸ºjoinç­‰å¾…æ˜¯æœ‰ä¸€å®šæ¶ˆè€—çš„ã€‚å¦‚æœæˆ‘ä»¬ä¸å…³å¿ƒçº¿ç¨‹æ‰§è¡Œçš„è¿”å›å€¼ï¼Œåº”è¯¥é‡‡ç”¨detachå°½é‡å‡å°æ¶ˆè€—</p><h2 id="2-4-ä½¿ç”¨ç¤ºä¾‹"><a href="#2-4-ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="2.4 ä½¿ç”¨ç¤ºä¾‹"></a>2.4 ä½¿ç”¨ç¤ºä¾‹</h2><p>ç›¸æ¯”äºLinuxç³»ç»Ÿæä¾›çš„pthreadæ¥å£ï¼ŒC++çš„ä½¿ç”¨æ–¹æ³•æ›´åŠ ç›´æ¥</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; a + b &lt;&lt; endl;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">thread <span class="title">t1</span><span class="params">(Add, <span class="number">10</span>, <span class="number">20</span>)</span></span>;</span><br><span class="line"><span class="function">thread <span class="title">t2</span><span class="params">(Add, <span class="number">10</span>, <span class="number">30</span>)</span></span>;</span><br><span class="line">t1.<span class="built_in">join</span>();</span><br><span class="line">t2.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f220e7cf62b.png"                      alt="image-20230219211523002"                ></p><h2 id="2-5-ç©ºæ„é€ å’Œç§»åŠ¨èµ‹å€¼"><a href="#2-5-ç©ºæ„é€ å’Œç§»åŠ¨èµ‹å€¼" class="headerlink" title="2.5 ç©ºæ„é€ å’Œç§»åŠ¨èµ‹å€¼"></a>2.5 ç©ºæ„é€ å’Œç§»åŠ¨èµ‹å€¼</h2><p>å¦‚æœæˆ‘ä»¬åªæ˜¯å®šä¹‰äº†ä¸€ä¸ªt1ï¼Œæ²¡æœ‰ç›´æ¥è°ƒç”¨æ„é€ å‡½æ•°æŒ‡å®šå…¶è¦è¿è¡Œçš„å‡½æ•°ï¼ˆå…¶å®æ˜¯è°ƒç”¨äº†ç©ºæ„é€ ï¼‰é‚£ä¹ˆè¦æ€ä¹ˆç»™è¿™ä¸ªçº¿ç¨‹æŒ‡å®šå‡½æ•°å‘¢ï¼Ÿ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thread t3;<span class="comment">//è°ƒç”¨äº†ç©ºæ„é€ </span></span><br></pre></td></tr></table></figure><p>åˆ«å¿˜äº†ï¼Œè™½ç„¶çº¿ç¨‹ä¸æ”¯æŒæ‹·è´æ„é€ ï¼Œä½†ä»–æœ‰ç§»åŠ¨èµ‹å€¼ï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thread&amp; <span class="keyword">operator</span>= (thread&amp;&amp; rhs) <span class="keyword">noexcept</span>;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦åšçš„ï¼Œå°±æ˜¯é‡‡ç”¨åŒ¿åå¯¹è±¡çš„æ–¹å¼ï¼Œèµ‹å€¼ç»™t3</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">thread t3;</span><br><span class="line">t3 = <span class="built_in">thread</span>(Add, <span class="number">20</span>, <span class="number">30</span>);</span><br><span class="line">t3.<span class="built_in">join</span>();</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f22a162f785.png"                      alt="image-20230219215433403"                ></p><h2 id="2-6-joinable"><a href="#2-6-joinable" class="headerlink" title="2.6 joinable"></a>2.6 joinable</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">joinable</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span></span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯æ ‡è¯†ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦è¿˜èƒ½è¿›è¡Œjoinï¼›ä¸‹é¢å‡ ç§æƒ…å†µï¼Œçº¿ç¨‹ä¸èƒ½è¢«join</p><ul><li>åªè°ƒç”¨äº†ç©ºæ„é€ ï¼ˆéƒ½æ²¡æœ‰æŒ‡å®šéœ€è¦è¿è¡Œçš„å‡½æ•°æ€ä¹ˆjoinç­‰å¾…ï¼Ÿï¼‰</li><li>è¢«moveäº†ï¼ˆmoveä¼šå°†å¯¹è±¡å˜æˆå°†äº¡å€¼ï¼Œä¹Ÿå°±æ˜¯å³å€¼ï¼‰</li><li>è¯¥å¯¹è±¡å·²ç»è°ƒç”¨è¿‡joinæˆ–è€…detach</li></ul><p>å¦‚æœæ˜¯åœ¨å¤šå±‚å‡½æ•°ä¸­è°ƒç”¨çš„çº¿ç¨‹ï¼Œé‚£å¯èƒ½joinä¹‹å‰å°±å¯ä»¥åˆ¤æ–­ä¸€ä¸‹å½“å‰å¯¹è±¡æ˜¯å¦è¿˜èƒ½join</p><h2 id="2-7-swap-x2F-move"><a href="#2-7-swap-x2F-move" class="headerlink" title="2.7 swap&#x2F;move"></a>2.7 swap&#x2F;move</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span> <span class="params">(thread&amp; x)</span> <span class="keyword">noexcept</span></span>;</span><br></pre></td></tr></table></figure><p>è¯¥æˆå‘˜å‡½æ•°çš„ä½œç”¨æ˜¯å°†å¦å¤–ä¸€ä¸ªçº¿ç¨‹åˆ‡æ¢ç»™å½“å‰çº¿ç¨‹</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f23b7a0ba31.png"                      alt="image-20230219230844481"                ></p><p>å…¶æœ¬è´¨å°±æ˜¯ä¸€ä¸ªmoveç§»åŠ¨èµ‹å€¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f23c727a61c.png"                      alt="image-20230219231249899"                ></p><p>è¢«ç§»åŠ¨åçš„çº¿ç¨‹t3ä¸å†<code>joinable</code>ï¼Œä¸ä¼šè¿è¡Œï¼Œä¹Ÿä¸èƒ½è¢«joinæˆ–detach</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f23bc928163.png"                      alt="image-20230219231000662"                ></p><p>å¼ºè¡Œjoinä¼šæŠ¥é”™</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f23bf8def67.png"                      alt="image-20230219231048460"                ></p><h2 id="2-8-linuxä¸‹ç¼–è¯‘"><a href="#2-8-linuxä¸‹ç¼–è¯‘" class="headerlink" title="2.8 linuxä¸‹ç¼–è¯‘"></a>2.8 linuxä¸‹ç¼–è¯‘</h2><p>ç”±äºstdæ˜¯å¯¹ç³»ç»Ÿæ¥å£è¿›è¡Œçš„å°è£…\</p><p>æ‰€ä»¥åœ¨linuxä¸‹ç¼–è¯‘å¸¦c++çº¿ç¨‹åº“çš„ä»£ç æ—¶ï¼Œéœ€è¦å¸¦ä¸Špthreadåº“çš„é€‰é¡¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ test.cpp -o test -std=c++11 -lpthread</span><br></pre></td></tr></table></figure><h1 id="3-std-ref"><a href="#3-std-ref" class="headerlink" title="3.std::ref"></a>3.std::ref</h1><p>è¿™é‡Œæœ‰ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°refï¼Œè¦æƒ³çŸ¥é“å…¶ä½œç”¨ï¼Œæˆ‘ä»¬éœ€è¦å…ˆçœ‹ä¸‹é¢è¿™ä¸ªåœºæ™¯</p><h2 id="3-1-å¼•ç”¨ä¼ å‚"><a href="#3-1-å¼•ç”¨ä¼ å‚" class="headerlink" title="3.1 å¼•ç”¨ä¼ å‚"></a>3.1 å¼•ç”¨ä¼ å‚</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS 1</span></span><br><span class="line"><span class="comment">//#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Print</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span>&amp; a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt;  a++ &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="function">thread <span class="title">t1</span><span class="params">(Print,<span class="number">10</span>, count)</span></span>;</span><br><span class="line"><span class="function">thread <span class="title">t2</span><span class="params">(Print,<span class="number">10</span>, count)</span></span>;</span><br><span class="line">t1.<span class="built_in">join</span>();</span><br><span class="line">t2.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;main: &quot;</span> &lt;&lt; count &lt;&lt; endl;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæˆ‘æƒ³è¾¾åˆ°çš„ç›®æ ‡æ˜¯è®©t1å’Œt2ä¸¤ä¸ªçº¿ç¨‹å¸®æˆ‘ä»¬å¯¹countè¿›è¡Œ++ï¼Œæœ€ç»ˆåœ¨mainé‡Œé¢æ‰“å°ç»“æœï¼›å¯ç¼–è¯‘ä¼šå‘ç°æŠ¥é”™ï¼Œä¸ç»™æˆ‘ä»¬è¿™æ ·å†™</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f1fbf492ae1.png"                      alt="image-20230219183743136"                ></p><p>ç›¸åŒçš„ä»£ç åœ¨linuxä¸‹ä¹Ÿå‡ºç°äº†ç¼–è¯‘é”™è¯¯ï¼Œæ‰€ç”¨g++ç‰ˆæœ¬å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ (GCC) 11.2.1 20220127 (Red Hat 11.2.1-9)</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f1e519b4676.png"                      alt="image-20230219170012180"                ></p><p>ä¸ºäº†ç¡®è®¤å…·ä½“çš„æŠ¥é”™ä½ç½®ï¼Œæˆ‘ä»¬å…ˆæŠŠ<code>int&amp; a</code>çš„å¼•ç”¨å»æ‰ï¼Œå†çœ‹çœ‹æƒ…å†µ</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f19d78e1d62.png"                      alt="image-20230219115434795"                ></p><p>èƒ½çœ‹åˆ°ï¼Œåœ¨æ²¡æœ‰é‡‡ç”¨<strong>å¼•ç”¨ä¼ å‚</strong>çš„æƒ…å†µä¸‹ï¼Œå‡½æ•°ä¸­å¯¹countè¿›è¡Œçš„æ“ä½œå¹¶ä¸ä¼šåé¦ˆåˆ°mainä¸­ï¼Œå› ä¸ºé‡‡ç”¨çš„æ˜¯<strong>ä¼ å€¼</strong>ï¼Œä¼šè¿›è¡Œæ‹·è´ã€‚</p><h2 id="3-2-threadæ„é€ å‡½æ•°"><a href="#3-2-threadæ„é€ å‡½æ•°" class="headerlink" title="3.2 threadæ„é€ å‡½æ•°"></a>3.2 threadæ„é€ å‡½æ•°</h2><p>é‚£ä¸ºä»€ä¹ˆåŠ ä¸Šå¼•ç”¨ä¹‹åï¼Œä¼šæŠ¥é”™å‘¢ï¼Ÿè¿™å°±å’Œthreadçš„æ„é€ å‡½æ•°æœ‰å…³ç³»äº†</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Fn</span>, <span class="keyword">class</span>... Args&gt;</span><br><span class="line"><span class="function"><span class="keyword">explicit</span> <span class="title">thread</span> <span class="params">(Fn&amp;&amp; fn, Args&amp;&amp;... args)</span></span>;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šï¼Œå½“æˆ‘ä»¬æ„é€ ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡çš„æ—¶å€™ï¼Œé‡‡ç”¨çš„æ˜¯<a href="https://blog.musnow.top/2022/09/28/note_cpp/20c++11%E7%89%B9%E6%80%A7/#7-%E5%8F%AF%E5%8F%98%E6%A8%A1%E6%9D%BF%E5%8F%82%E6%95%B0">å¯å˜æ¨¡æ¿å‚æ•°</a>ï¼›åœ¨æˆ‘çš„åšå®¢ä¸­å†™åˆ°è¿‡ï¼Œå¯å˜æ¨¡æ¿å‚æ•°éœ€è¦é‡‡ç”¨<code>é€’å½’</code>æ¥è¿›è¡Œå‚æ•°ç±»å‹çš„æ¨æµ‹ã€‚</p><p>ç”±äºåº•å±‚å®ç°çš„é—®é¢˜ï¼ˆä¹Ÿåªèƒ½æ˜¯è¿™ä¸ªåŸå› äº†ï¼‰åœ¨è¿›è¡Œæ„é€ çš„å®Œç¾è½¬å‘æ—¶ï¼Œæ‰€æœ‰çš„å‚æ•°éƒ½é‡‡ç”¨äº†<code>æ‹·è´</code>è€Œä¸æ˜¯å¼•ç”¨ä¼ å‚ã€‚</p><p>è¿™ä¹Ÿå°±å¯¼è‡´æˆ‘ä»¬æ²¡æœ‰åŠæ³•å°†ä¸€ä¸ªå‚æ•°é€šè¿‡<strong>å¼•ç”¨</strong>ä¼ å…¥çº¿ç¨‹éœ€è¦æ‰§è¡Œçš„å‡½æ•°ï¼</p><blockquote><p>ç”¨æŒ‡é’ˆè‚¯å®šæ˜¯å¯ä»¥çš„ï¼Œå¯C++æå‡ºå¼•ç”¨è¿™ä¸ªä¸œè¥¿ï¼Œå°±æ˜¯ä¸ºäº†é¿å…ä½¿ç”¨æŒ‡é’ˆ</p></blockquote><h2 id="3-3-refå‡ºåœº"><a href="#3-3-refå‡ºåœº" class="headerlink" title="3.3 refå‡ºåœº"></a>3.3 refå‡ºåœº</h2><blockquote><p><a class="link"   href="https://legacy.cplusplus.com/reference/functional/ref/?kw=ref" >https://legacy.cplusplus.com/reference/functional/ref/?kw=ref<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>äºæ˜¯ä¹ï¼Œstdåº“ä¸­å°±æ–°å¢äº†ä¸€ä¸ªåº“å‡½æ•°<code>ref</code>ï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// refçš„ç”¨æ³•</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function">reference_wrapper&lt;T&gt; <span class="title">ref</span> <span class="params">(T&amp; elem)</span> <span class="keyword">noexcept</span></span>;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function">reference_wrapper&lt;T&gt; <span class="title">ref</span> <span class="params">(reference_wrapper&lt;T&gt;&amp; x)</span> <span class="keyword">noexcept</span></span>;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="type">void</span> <span class="title">ref</span> <span class="params">(<span class="type">const</span> T&amp;&amp;)</span> </span>= <span class="keyword">delete</span>;</span><br></pre></td></tr></table></figure><blockquote><p>Constructs an object of the appropriate <a class="link"   href="https://legacy.cplusplus.com/reference_wrapper" >reference_wrapper<i class="fas fa-external-link-alt"></i></a> type to hold a reference to elem.</p><p>If the argument is itself a <a class="link"   href="https://legacy.cplusplus.com/reference_wrapper" >reference_wrapper<i class="fas fa-external-link-alt"></i></a> <em>(2)</em>, it creates a copy of x instead.</p><p>The function calls the proper <a class="link"   href="https://legacy.cplusplus.com/reference_wrapper" >reference_wrapper<i class="fas fa-external-link-alt"></i></a> constructor.</p></blockquote><p>è¿™ä¸ªå‡½æ•°ä¼šæ„é€ ä¸€ä¸ªåˆé€‚çš„<code>reference_wrapper</code>å¯¹è±¡ï¼Œæ¥ç®¡ç†ä¸€ä¸ªå˜é‡çš„<strong>å¼•ç”¨</strong>ã€‚å¦‚æœå‚æ•°æœ¬èº«å°±æ˜¯<code>reference_wrapper</code>ç±»å‹ï¼Œåˆ™ä¼šè°ƒç”¨<code>reference_wrapper</code>çš„æ‹·è´æ„é€ ã€‚</p><p>è€Œrefå‡½æ•°ä¸èƒ½ä¼ é€’å³å€¼ï¼Œå…¶å³å€¼å¼•ç”¨çš„é‡è½½æ˜¯è¢«<code>delete</code>çš„</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f1e6be2fd55.png"                      alt="image-20230219170711744"                ></p><h2 id="3-4-refä½¿ç”¨"><a href="#3-4-refä½¿ç”¨" class="headerlink" title="3.4 refä½¿ç”¨"></a>3.4 refä½¿ç”¨</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">thread <span class="title">t1</span><span class="params">(Print,<span class="number">10</span>, ref(count))</span></span>;</span><br><span class="line"><span class="function">thread <span class="title">t2</span><span class="params">(Print,<span class="number">10</span>, ref(count))</span></span>;</span><br><span class="line">t1.<span class="built_in">join</span>();</span><br><span class="line">t2.<span class="built_in">join</span>();</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨äº†è¯¥åº“å‡½æ•°ä¹‹åï¼Œç¼–è¯‘ä¸å†æŠ¥é”™ï¼Œmainä¸­çš„å€¼ä¹ŸæˆåŠŸè¢«ä¿®æ”¹</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f1e573a7d52.png"                      alt="image-20230219170142211"                ></p><p>é€šè¿‡refä¼ é€’çš„å‚æ•°ï¼Œä¹Ÿä¼šéµå®ˆå‡½æ•°æœ¬èº«çš„å˜é‡è§„åˆ™ã€‚å¦‚æœå‡½æ•°æœ¬èº«æ²¡æœ‰é‡‡ç”¨å¼•ç”¨ä¼ å‚ï¼Œåˆ™è¿˜æ˜¯è°ƒç”¨ä¼ å€¼å‚æ•°ï¼Œä¼šè¿›è¡Œæ‹·è´ï¼›</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f1e703647b4.png"                      alt="image-20230219170821981"                ></p><p>ä¸ºäº†é¿å…åç»­å‡ºç°è¿™ç§é—®é¢˜ï¼Œå¯ä»¥ç»™æ‰€æœ‰å¯¹çº¿ç¨‹çš„å·¦å€¼ä¼ å‚éƒ½å¸¦ä¸ŠrefğŸ˜æ¯”å¦‚ç»™ä¸¤ä¸ªçº¿ç¨‹å‡½æ•°ä¼ å…¥åŒä¸€æŠŠé”çš„æ—¶å€™ï¼Œå°±éœ€è¦é‡‡ç”¨<code>ref</code>è¿›è¡Œå¼•ç”¨ä¼ å‚</p><h1 id="4-æŒ‡ä»¤é‡æ’"><a href="#4-æŒ‡ä»¤é‡æ’" class="headerlink" title="4.æŒ‡ä»¤é‡æ’"></a>4.æŒ‡ä»¤é‡æ’</h1><blockquote><p><a class="link"   href="https://zhuanlan.zhihu.com/p/271701839" >è°ˆè°ˆæŒ‡ä»¤é‡æ’ - çŸ¥ä¹<i class="fas fa-external-link-alt"></i></a></p><p><a class="link"   href="https://developer.aliyun.com/article/1155673#:~:text=%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92%E7%9A%84%E6%96%B9%E5%BC%8F%201%20%E7%BC%96%E8%AF%91%E5%99%A8%E4%BC%98%E5%8C%96%20%E9%87%8D%E6%96%B0%E5%AE%89%E6%8E%92%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F%202,%E6%8C%87%E4%BB%A4%E5%B9%B6%E8%A1%8C%E9%87%8D%E6%8E%92%20%E5%88%A9%E7%94%A8%E6%8C%87%E4%BB%A4%E7%BA%A7%E5%B9%B6%E8%A1%8C%E6%8A%80%E6%9C%AF%E5%B0%86%E5%A4%9A%E4%B8%AA%E6%8C%87%E4%BB%A4%E5%B9%B6%E8%A1%8C%E6%89%A7%E8%A1%8C%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%8C%87%E4%BB%A4%E4%B9%8B%E5%89%8D%E6%B2%A1%E6%9C%89%E6%95%B0%E6%8D%AE%E4%BE%9D%E8%B5%96%EF%BC%8C%E5%A4%84%E7%90%86%E5%99%A8%E5%8F%AF%E4%BB%A5%E6%94%B9%E5%8F%98%E5%AF%B9%E5%BA%94%E6%9C%BA%E5%99%A8%E6%8C%87%E4%BB%A4%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F%203%20%E5%86%85%E5%AD%98%E7%B3%BB%E7%BB%9F%E9%87%8D%E6%8E%92%20%E7%94%B1%E4%BA%8E%E5%A4%84%E7%90%86%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98%E5%92%8C%E8%AF%BB%E5%86%99%E7%BC%93%E5%86%B2%E5%8C%BA%EF%BC%8C%E6%89%80%E4%BB%A5%E5%AE%83%E4%BB%AC%E6%98%AF%E4%B9%B1%E5%BA%8F%E7%9A%84" >é¢è¯•å®˜: æœ‰äº†è§£è¿‡æŒ‡ä»¤é‡æ’å—ï¼Œä»€ä¹ˆæ˜¯happens-before<i class="fas fa-external-link-alt"></i></a></p></blockquote><h2 id="4-1-ä»€ä¹ˆæ˜¯é‡æ’åº"><a href="#4-1-ä»€ä¹ˆæ˜¯é‡æ’åº" class="headerlink" title="4.1 ä»€ä¹ˆæ˜¯é‡æ’åº"></a>4.1 ä»€ä¹ˆæ˜¯é‡æ’åº</h2><p>é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯é‡æ’åºâ“è®¡ç®—æœºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œä¼šå¯¹ç¼–è¯‘å™¨å’Œç¼–è¯‘å™¨åš<code>æŒ‡ä»¤é‡æ’</code>ã€‚</p><p>è¿™ä¹ˆåšä¸ºå•¥å¯ä»¥æé«˜æ€§èƒ½å‘¢â“</p><p>æˆ‘ä»¬çŸ¥é“è®¡ç®—æœºåœ¨æ‰§è¡Œçš„æ—¶å€™éƒ½æ˜¯ä¸€ä¸ªä¸ªæŒ‡ä»¤å»æ‰§è¡Œï¼Œä¸åŒçš„æŒ‡ä»¤å¯èƒ½æ“ä½œçš„ç¡¬ä»¶ä¸ä¸€æ ·ï¼Œåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šäº§ç”Ÿ<code>ä¸­æ–­</code>ã€‚</p><p>æ‰“ä¸ªæ¯”æ–¹ï¼Œä¸¤ä¸ªæŒ‡ä»¤aå’Œbä»–ä»¬æ“ä½œçš„ä¸œè¥¿å„ä¸ç›¸åŒï¼Œå¦‚æœåŠ è½½açš„æ—¶å€™åœé¡¿äº†ï¼Œbå°±åŠ è½½ä¸åˆ°ï¼Œä½†æ˜¯å®é™…ä¸Šå®ƒä»¬äº’è¡¥å½±å“ï¼Œæˆ‘ä¹Ÿå¯ä»¥å…ˆåŠ è½½båœ¨åŠ è½½aï¼Œæ‰€ä»¥<code>æŒ‡ä»¤é‡æ’</code>æ˜¯å‡å°‘åœé¡¿çš„ä¸€ç§æ–¹æ³•ï¼Œè¿™æ ·å¤§å¤§æé«˜äº†æ•ˆç‡ã€‚</p><h3 id="4-1-1-æŒ‡ä»¤é‡æ’çš„æ–¹å¼"><a href="#4-1-1-æŒ‡ä»¤é‡æ’çš„æ–¹å¼" class="headerlink" title="4.1.1 æŒ‡ä»¤é‡æ’çš„æ–¹å¼"></a>4.1.1 æŒ‡ä»¤é‡æ’çš„æ–¹å¼</h3><p>æŒ‡ä»¤é‡æ’ä¸€èˆ¬åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§</p><ul><li><code>ç¼–è¯‘å™¨ä¼˜åŒ–</code> é‡æ–°å®‰æ’è¯­å¥çš„æ‰§è¡Œé¡ºåº</li><li><code>æŒ‡ä»¤å¹¶è¡Œé‡æ’</code> åˆ©ç”¨æŒ‡ä»¤çº§å¹¶è¡ŒæŠ€æœ¯å°†å¤šä¸ªæŒ‡ä»¤å¹¶è¡Œæ‰§è¡Œï¼Œå¦‚æœæŒ‡ä»¤ä¹‹å‰æ²¡æœ‰æ•°æ®ä¾èµ–ï¼Œå¤„ç†å™¨å¯ä»¥æ”¹å˜å¯¹åº”æœºå™¨æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåº</li><li><code>å†…å­˜ç³»ç»Ÿé‡æ’</code> ç”±äºå¤„ç†ä½¿ç”¨ç¼“å­˜å’Œè¯»å†™ç¼“å†²åŒºï¼Œæ‰€ä»¥å®ƒä»¬æ˜¯ä¹±åºçš„</li></ul><p>æŒ‡ä»¤é‡æ’å¯ä»¥ä¿è¯<code>ä¸²è¡Œè¯­ä¹‰</code>ä¸€è‡´ï¼Œä½†æ˜¯æ²¡æœ‰ä¹‰åŠ¡ä¿è¯<code>å¤šçº¿ç¨‹é—´çš„è¯­ä¹‰</code>ä¹Ÿä¸€è‡´**ã€‚æ‰€ä»¥åœ¨å¤šçº¿ç¨‹ä¸‹ï¼ŒæŒ‡ä»¤é‡æ’åºå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜</p><h2 id="4-2-å®é™…åœºæ™¯"><a href="#4-2-å®é™…åœºæ™¯" class="headerlink" title="4.2 å®é™…åœºæ™¯"></a>4.2 å®é™…åœºæ™¯</h2><p>ä»¥æ‡’æ±‰çš„å•ä¾‹æ¨¡å¼ä¸ºä¾‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–å•ä¾‹å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="type">static</span> InfoMgr* <span class="title">GetInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (_sp == <span class="literal">nullptr</span>)<span class="comment">//ç¬¬ä¸€æ¬¡æ£€æµ‹ä¿è¯å•ä¾‹</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">unique_lock&lt;mutex&gt; <span class="title">lock</span><span class="params">(_mtx)</span></span>;</span><br><span class="line">        <span class="keyword">if</span> (_sp == <span class="literal">nullptr</span>)<span class="comment">//ç¬¬äºŒæ¬¡æ£€æµ‹ä¿è¯çº¿ç¨‹å®‰å…¨</span></span><br><span class="line">        &#123;</span><br><span class="line">            _sp = <span class="keyword">new</span> InfoMgr;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _sp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ<code>new</code>ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œæ‰§è¡Œçš„é¡ºåºåº”è¯¥æ˜¯è¿™æ ·çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">operator new</span><br><span class="line">æ„é€ å¯¹è±¡</span><br><span class="line">èµ‹å€¼ç»™_sp</span><br></pre></td></tr></table></figure><p>ä½†ç¼–è¯‘å™¨å¦‚æœè¿›è¡Œäº†æŒ‡ä»¤é‡æ’ï¼Œå¯èƒ½å°±ä¼šå˜æˆè¿™æ ·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">operator new</span><br><span class="line">èµ‹å€¼ç»™_sp</span><br><span class="line">æ„é€ å¯¹è±¡</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°ç¬¬äºŒæ­¥<code>èµ‹å€¼ç»™_sp</code>çš„æ—¶å€™ï¼Œå› ä¸ºæ—¶é—´ç‰‡åˆ°äº†è¢«åˆ‡æ¢èµ°äº†ï¼›å…¶ä»–çº¿ç¨‹æ¥è·å–å•ä¾‹ï¼Œå°±ä¼šå¯¼è‡´<code>_sp</code>å˜é‡æ˜¯ä¸€ä¸ªå·²ç»è¢«èµ‹å€¼äº†ï¼Œä½†æ˜¯å…¶æŒ‡å‘çš„æ˜¯<strong>æ²¡æœ‰åˆå§‹åŒ–çš„ç©ºå¯¹è±¡</strong>ï¼Œè¿™æ˜¯é”™è¯¯çš„ï¼</p><h2 id="4-3-å¯è¡Œçš„è§£å†³åŠæ³•ï¼šå†…å­˜æ …æ "><a href="#4-3-å¯è¡Œçš„è§£å†³åŠæ³•ï¼šå†…å­˜æ …æ " class="headerlink" title="4.3 å¯è¡Œçš„è§£å†³åŠæ³•ï¼šå†…å­˜æ …æ "></a>4.3 å¯è¡Œçš„è§£å†³åŠæ³•ï¼šå†…å­˜æ …æ </h2><p>æ‰€è°“å†…å­˜æ …æ ï¼Œæ˜¯ç³»ç»Ÿæä¾›çš„çš„æ¥å£ï¼Œç”¨äºç¦æ­¢cpuå¯¹æŒ‡ä»¤çš„ä¼˜åŒ–ï¼›</p><blockquote><p><a class="link"   href="https://blog.csdn.net/qq_16498553/article/details/128030833" >https://blog.csdn.net/qq_16498553/article/details/128030833<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>ä½†å†…å­˜æ ˆæ æ˜¯ç³»ç»Ÿæ¥å£ï¼Œæ²¡æœ‰è·¨å¹³å°æ€§ï¼›è¿™é‡Œåªåšäº†è§£ï¼ŒçŸ¥é“æœ‰è¿™ä¸ªé—®é¢˜å³å¯ï¼</p><hr><p>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‹…å¿ƒ<code>4.2</code>ä¸­æåˆ°çš„é—®é¢˜ï¼Œå› ä¸ºæŒ‡ä»¤ä¼˜åŒ–æ˜¯æœ‰ä¸¥æ ¼è§„åˆ™çš„ï¼Œä¸ä¼šå¯¹èµ‹å€¼å’Œæ„é€ è¿™ç±»æŒ‡ä»¤è¿›è¡Œèƒ¡ä¹±ä¼˜åŒ–ï¼ˆå› ä¸ºè¿™æ ·ä¼˜åŒ–å¹¶ä¸ä¼šæœ‰æ•ˆç‡æå‡å•Šï¼‰</p><p>ä½†è¿™ä¹Ÿéœ€è¦çœ‹å…·ä½“å¹³å°çš„åº•å±‚å®ç°äº†ï¼</p><h1 id="5-è·å–çº¿ç¨‹è¿”å›å€¼"><a href="#5-è·å–çº¿ç¨‹è¿”å›å€¼" class="headerlink" title="5.è·å–çº¿ç¨‹è¿”å›å€¼"></a>5.è·å–çº¿ç¨‹è¿”å›å€¼</h1><h2 id="5-1-è¾“å‡ºå‹å‚æ•°"><a href="#5-1-è¾“å‡ºå‹å‚æ•°" class="headerlink" title="5.1 è¾“å‡ºå‹å‚æ•°"></a>5.1 è¾“å‡ºå‹å‚æ•°</h2><p>åœ¨Cè¯­è¨€ä¸­ï¼Œæƒ³è·å–çº¿ç¨‹è¿”å›å€¼ï¼Œéœ€è¦ä½¿ç”¨è¾“å‡ºå‹å‚æ•°ï¼ˆC++å¯ä»¥ç”¨å¼•ç”¨ä¼ å€¼ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b,<span class="type">int</span>&amp; out)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">out = a + b;</span><br><span class="line"><span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line"><span class="function">thread <span class="title">t2</span><span class="params">(Add, <span class="number">10</span>, <span class="number">39</span>, ref(ret))</span></span>;</span><br><span class="line">t2.<span class="built_in">join</span>();</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;main: &quot;</span> &lt;&lt; ret &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f21f423ea1b.png"                      alt="image-20230219210821383"                ></p><h2 id="5-2-lambda"><a href="#5-2-lambda" class="headerlink" title="5.2 lambda"></a>5.2 lambda</h2><p>åœ¨C++ä¸­ï¼Œè¿˜å¯ä»¥ä½¿ç”¨lambdaè¡¨è¾¾å¼ï¼Œæ¥åœ¨<code>main</code>ä¸­è·å–çº¿ç¨‹çš„è¿”å›å€¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line"><span class="function">thread <span class="title">t1</span><span class="params">([&amp;ret]() &#123; ret = Add(<span class="number">10</span>, <span class="number">29</span>); &#125;)</span></span>;</span><br><span class="line">t1.<span class="built_in">join</span>();</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;main: &quot;</span> &lt;&lt; ret &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f219625e81a.png"                      alt="image-20230219204317460"                ></p><h1 id="6-å‡½æ•°é‡è½½é—®é¢˜"><a href="#6-å‡½æ•°é‡è½½é—®é¢˜" class="headerlink" title="6.å‡½æ•°é‡è½½é—®é¢˜"></a>6.å‡½æ•°é‡è½½é—®é¢˜</h1><p>åœ¨æˆ‘æµ‹è¯•çš„æ—¶å€™å‘ç°ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°å…·æœ‰é‡è½½ï¼Œçº¿ç¨‹æ˜¯ä¸æ”¯æŒçš„ï¼›</p><p>å…·ä½“çš„åŸå› å˜›ï¼Œæˆ‘çŒœå’Œçº¿ç¨‹æ„é€ çš„å¯å˜æ¨¡æ¿å‚æ•°æœ‰å…³ç³»ã€‚</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f22aa4c21de.png"                      alt="img"                ></p><p>ç™¾åº¦äº†ä¸€ä¸‹ï¼Œè§£å†³åŠæ³•ï¼Œæ˜¯ç»™ç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ä¸€ä¸ª<strong>å‡½æ•°æŒ‡é’ˆ</strong>æˆ–è€…fuctionalå¯¹è±¡ï¼Œæ‰‹åŠ¨æŒ‡å®šä½¿ç”¨çš„æ˜¯å“ªä¸€ä¸ªå‡½æ•°ã€‚</p><p>å½“ç„¶ï¼Œè¿˜æœ‰ä¸€ä¸ªè§£å†³åŠæ³•ï¼šçº¿ç¨‹è°ƒç”¨çš„å‡½æ•°ä¸è¦æœ‰é‡è½½ğŸ˜‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b,<span class="type">int</span>&amp; out)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">out = a + b;</span><br><span class="line"><span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> tmp = a + b;</span><br><span class="line">cout &lt;&lt; tmp &lt;&lt; endl;;</span><br><span class="line"><span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// ä½¿ç”¨å‡½æ•°æŒ‡é’ˆæŒ‡å®šå¯¹åº”çš„å‡½æ•°</span></span><br><span class="line"><span class="function">thread <span class="title">t2</span><span class="params">(<span class="keyword">static_cast</span>&lt;<span class="type">int</span>(*)(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span>&amp; out)&gt;(Add), <span class="number">10</span>, <span class="number">39</span>, ref(ret))</span></span>;</span><br><span class="line">t2.<span class="built_in">join</span>();</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;main: &quot;</span> &lt;&lt; ret &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f22bfb930fa.png"                      alt="image-20230219220238736"                ></p><h1 id="7-this-thread"><a href="#7-this-thread" class="headerlink" title="7.this_thread"></a>7.this_thread</h1><p>stdåº“ä¸­è¿˜ç”¨å‘½åç©ºé—´å¯¹çº¿ç¨‹çš„ä¸€äº›æ“ä½œè¿›è¡Œäº†å°è£…</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f3137e63079.png"                      alt="image-20230220143023521"                ></p><ul><li>get_id è·å–çº¿ç¨‹idå·ï¼ˆå…¶å®çº¿ç¨‹ç±»é‡Œé¢å·²ç»æœ‰è¿™ä¸ªä¸œä¸œäº†ï¼Œä½†æ˜¯ä¸ºäº†æ–¹ä¾¿å‡½æ•°ä¸­ç›´æ¥è°ƒç”¨ï¼Œåˆå¤šå¼€äº†ä¸€ä¸ªå‡½æ•°ï¼‰</li><li>yield æ”¾å¼ƒè‡ªå·±çš„æ—¶é—´ç‰‡</li><li>sleep_until ä¼‘çœ åˆ°ä¸€ä¸ªæ—¶é—´ç‚¹ï¼ˆæ¯”å¦‚ç¡åˆ°æ˜å¤©æ—©å…«ï¼‰</li><li>sleep_for ä¼‘çœ ä¸€å®šæ—¶é—´ï¼ˆç¡2åˆ†é’Ÿï¼‰</li></ul><p>ä¸‹é¢æ¥å¯¹åé¢ä¸‰ä¸ªå‡½æ•°åšä¸€ç‚¹è§£é‡Šï¼ˆç¬¬ä¸€ä¸ªå°±ä¸è§£é‡Šäº†å“ˆï¼‰</p><h2 id="7-1-yield"><a href="#7-1-yield" class="headerlink" title="7.1 yield"></a>7.1 yield</h2><p>yieldçš„ä½œç”¨æ˜¯è®©å‡ºå½“å‰çº¿ç¨‹çš„æ—¶é—´ç‰‡ï¼›</p><p>æˆ‘ä»¬çŸ¥é“æ¯ä¸€ä¸ªçº¿ç¨‹è¿è¡Œæ—¶éƒ½ä¼šæœ‰ä¸€ä¸ªè‡ªå·±çš„æ—¶é—´ç‰‡ï¼Œæ—¶é—´ç‰‡åˆ°äº†ï¼Œå°±ä¼šè¿›è¡Œçº¿ç¨‹çš„åˆ‡æ¢ï¼›</p><p>ä»¥ä¸‹é¢çš„åœºæ™¯ä¸ºä¾‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">volatile</span> <span class="type">bool</span> ready = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">count1m</span><span class="params">(<span class="type">int</span> id)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// å¦‚æœmainæ²¡æœ‰è®¾ç½®readyä¿¡å·ï¼Œçº¿ç¨‹ä¼šä¸€ç›´è®©å‡ºè‡ªå·±çš„æ—¶é—´ç‰‡ï¼Œä¸ä¼šè¿è¡Œ</span></span><br><span class="line"><span class="keyword">while</span> (!ready) </span><br><span class="line">&#123;            </span><br><span class="line">this_thread::<span class="built_in">yield</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¼€å§‹è¿è¡Œï¼Œ++æ•°æ®</span></span><br><span class="line"><span class="keyword">volatile</span> <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; <span class="number">10000000</span>; i++) </span><br><span class="line">&#123; </span><br><span class="line">; <span class="comment">// å¾ªç¯ä½“å•¥éƒ½ä¸å¹²</span></span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test4</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">thread threads[<span class="number">10</span>];</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;åˆ›å»º10ä¸ªçº¿ç¨‹ è®¡æ•°\n&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) </span><br><span class="line">&#123;</span><br><span class="line">threads[i] = <span class="built_in">thread</span>(count1m, i);</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;åˆ›å»º10ä¸ªçº¿ç¨‹ å®Œæ¯•\n&quot;</span>;</span><br><span class="line">ready = <span class="literal">true</span>;<span class="comment">//è®¾ç½®çŠ¶æ€ï¼Œè®©çº¿ç¨‹å¼€å§‹è¿è¡Œ</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;main set ture: &quot;</span> &lt;&lt; ready &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; th : threads) </span><br><span class="line">&#123;</span><br><span class="line">th.<span class="built_in">join</span>();</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;\nmain join æˆåŠŸ&quot;</span> &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»º10ä¸ªçº¿ç¨‹ è®¡æ•°</span><br><span class="line">åˆ›å»º10ä¸ªçº¿ç¨‹ å®Œæ¯•</span><br><span class="line">main set ture: 1</span><br><span class="line">3746089215</span><br><span class="line">main join æˆåŠŸ</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹è¢«è®¾ç½®äº†taskåï¼Œéƒ½ä¼šå…ˆè¿›å…¥ä¸€ä¸ªwhileå¾ªç¯ï¼Œç­‰å¾…ä¸»çº¿ç¨‹è¿›è¡Œreadyçš„è®¾ç½®</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (!ready) </span><br><span class="line">&#123;            </span><br><span class="line">;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥åœ¨whileå¾ªç¯ä¸­è¿›è¡Œyieldè®©çº¿ç¨‹<strong>è®©å‡ºè‡ªå·±</strong>çš„æ—¶é—´ç‰‡ã€‚å¦åˆ™è¿™ä¸ªçº¿ç¨‹ä¼šä¸€ç›´ç–¯ç‹‚è®¿é—®readyï¼Œå¯¼è‡´cpuå ç”¨æé«˜ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœmainæ²¡æœ‰è®¾ç½®readyä¿¡å·ï¼Œçº¿ç¨‹ä¼šä¸€ç›´è®©å‡ºè‡ªå·±çš„æ—¶é—´ç‰‡ï¼Œä¸ä¼šè¿è¡Œ</span></span><br><span class="line"><span class="keyword">while</span> (!ready) </span><br><span class="line">&#123;            </span><br><span class="line">this_thread::<span class="built_in">yield</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ç§<strong>è½®è¯¢æ£€æµ‹</strong>çš„åœºæ™¯ä¸‹ï¼Œä½¿ç”¨yieldèƒ½é¿å…æŸä¸€ä¸ªçº¿ç¨‹é•¿æ—¶é—´å ç”¨æ‰§è¡Œæµï¼Œè§£å†³äº†å…¶ä»–çº¿ç¨‹çš„é¥¥é¥¿é—®é¢˜ã€‚</p><h2 id="7-2-sleep-until"><a href="#7-2-sleep-until" class="headerlink" title="7.2 sleep_until"></a>7.2 sleep_until</h2><p>ç”¨<a class="link"   href="https://legacy.cplusplus.com/reference/thread/this_thread/sleep_until/" >cplusplus<i class="fas fa-external-link-alt"></i></a>çš„ç¤ºä¾‹ä»£ç æ¥å­¦ä¹ ä½¿ç”¨æ–¹æ³•ï¼Œè¿™é‡Œæ¶‰åŠåˆ°äº†å¤šä¸ªåº“å‡½æ•°ï¼Œè¯¦è§æ³¨é‡Š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span>  <span class="comment">//std::chrono</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span> <span class="comment">//std::put_time</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span>   <span class="comment">//std::time_t, std::tm, std::localtime, std::mktime</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›´æ¥æŠŠmainå½“ä½œä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test5</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">time_t</span> tt = chrono::system_clock::<span class="built_in">to_time_t</span>(chrono::system_clock::<span class="built_in">now</span>()); <span class="comment">// è·å–å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">tm</span>* ptm = <span class="built_in">localtime</span>(&amp;tt); <span class="comment">// è®¾ç½®ä¸€ä¸ªtmç»“æ„ä½“ï¼Œä»å½“å‰æ—¶é—´æˆ³åˆ›å»º</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Current time: &quot;</span> &lt;&lt; <span class="built_in">put_time</span>(ptm, <span class="string">&quot;%X&quot;</span>) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; <span class="comment">// æ‰“å°å½“å‰æ—¶é—´</span></span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Waiting for the next minute to begin...\n&quot;</span>;</span><br><span class="line">(ptm-&gt;tm_min)++; <span class="comment">// è®¾ç½®ptmçš„minä¸ºä¸‹ä¸€åˆ†é’Ÿ</span></span><br><span class="line">ptm-&gt;tm_sec = <span class="number">0</span>; <span class="comment">// ä¸‹ä¸€åˆ†é’Ÿçš„ç¬¬0s</span></span><br><span class="line">this_thread::<span class="built_in">sleep_until</span>(chrono::system_clock::<span class="built_in">from_time_t</span>(<span class="built_in">mktime</span>(ptm))); <span class="comment">// ç­‰å¾…ä¸‹ä¸€åˆ†é’Ÿå¼€å§‹è¿è¡Œ</span></span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="built_in">put_time</span>(ptm, <span class="string">&quot;%X&quot;</span>) &lt;&lt; <span class="string">&quot; reached!\n&quot;</span>; <span class="comment">// å†æ¬¡æ‰“å°å½“å‰æ—¶é—´</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼Œä¼šç­‰åˆ°ä¸‹ä¸€åˆ†é’Ÿçš„ç¬¬0sç»§ç»­æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Current time: 15:13:40</span><br><span class="line">Waiting for the next minute to begin...</span><br><span class="line">15:14:00 reached!</span><br></pre></td></tr></table></figure><h2 id="7-3-sleep-for"><a href="#7-3-sleep-for" class="headerlink" title="7.3 sleep_for"></a>7.3 sleep_for</h2><p>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨å’Œwindowsã€linuxä¸‹éƒ½æœ‰çš„sleepå‡½æ•°ä¸€æ ·ï¼Œæ˜¯ç¡æŒ‡å®šçš„æ—¶é—´</p><p>éœ€è¦ç”¨stdä¸­çš„<code>chrono</code>æ¨¡å—æ¥æŒ‡å®šè¿è¡Œçš„æ—¶é—´ï¼Œæ”¯æŒä»å°æ—¶ä¸€ç›´åˆ°çº³ç§’</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f341a573324.png"                      alt="image-20230220174718938"                ></p><p>ç¤ºä¾‹å¦‚ä¸‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test6</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">time_t</span> now;</span><br><span class="line"><span class="built_in">time</span>(&amp;now);<span class="comment">//è·å–å½“å‰æ—¶é—´æˆ³</span></span><br><span class="line">cout &lt;&lt; now &lt;&lt; endl;</span><br><span class="line">this_thread::<span class="built_in">sleep_for</span>(chrono::<span class="built_in">seconds</span>(<span class="number">30</span>));<span class="comment">//ç¡30s</span></span><br><span class="line"><span class="built_in">time</span>(&amp;now);<span class="comment">//è·å–å½“å‰æ—¶é—´æˆ³</span></span><br><span class="line">cout &lt;&lt; now &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿›ç¨‹ç¡®å®ä¼‘çœ äº†30s</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f31fbf07392.png"                      alt="image-20230220152240203"                ></p><h1 id="8-mutex"><a href="#8-mutex" class="headerlink" title="8.mutex"></a>8.mutex</h1><p>æœ‰äº†çº¿ç¨‹ï¼Œé‚£è‚¯å®šç¦»ä¸å¼€é”ï¼›å…³äºçº¿ç¨‹åŠ é”çš„é—®é¢˜ï¼Œè¯¦è§<a href="https://blog.musnow.top/2022/12/23/note_linux/19%E7%BA%BF%E7%A8%8B%E4%BA%92%E6%96%A5/#4-3-%E7%BA%BF%E7%A8%8B%E5%8A%A0%E9%94%81">æˆ‘çš„linuxåšå®¢</a></p><p>è¿™é‡Œåªå¯¹C++ä¸­é”çš„åªç”¨æ–¹æ³•åšä¸€å®šæ¼”ç¤º</p><h2 id="8-1-æ„é€ "><a href="#8-1-æ„é€ " class="headerlink" title="8.1 æ„é€ "></a>8.1 æ„é€ </h2><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f3482920bbf.png"                      alt="image-20230220181505745"                ></p><p>é”çš„æ„é€ ç›¸å¯¹è¾ƒç®€å•ï¼Œåªæœ‰ä¸€ä¸ªæ— å‚çš„æ„é€ ï¼Œå…¶ä¸æ”¯æŒæ‹·è´æ„é€ ï¼ˆæ¯”å¦‚å‡½æ•°ä¼ å‚ä¸­ï¼Œä¸€ä¸ªé”è¢«æ‹·è´äº†ï¼Œå°±å¤±å»äº†æ„ä¹‰ï¼‰</p><h2 id="8-2-æˆå‘˜å‡½æ•°"><a href="#8-2-æˆå‘˜å‡½æ•°" class="headerlink" title="8.2 æˆå‘˜å‡½æ•°"></a>8.2 æˆå‘˜å‡½æ•°</h2><p>å…¶ä½™æˆå‘˜å°±æ˜¯ä¸€ä¸ªé”çš„åŸºæœ¬æ¥å£ï¼Œå¯¹åº”çš„ä¹Ÿæ˜¯<code>pthread_mutex</code>ä¸­çš„å‡ ä¸ªæ¥å£</p><ul><li>lock åŠ é”ï¼Œä¸èƒ½ç”³è¯·é”åˆ™é˜»å¡ç­‰å¾…</li><li>try_lock æµ‹è¯•æ˜¯å¦èƒ½ç”³è¯·é”ï¼Œä¸èƒ½ç”³è¯·åˆ™return</li><li>unlock è§£é”</li></ul><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f3486d109dd.png"                      alt="image-20230220181614701"                ></p><h2 id="8-3-åœºæ™¯"><a href="#8-3-åœºæ™¯" class="headerlink" title="8.3 åœºæ™¯"></a>8.3 åœºæ™¯</h2><p>æ‰€è°“åŠ é”ï¼Œä¿æŠ¤çš„å°±æ˜¯ä¸´ç•Œèµ„æºï¼›æ¯”å¦‚åœ¨ä¸‹é¢çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œå…¨å±€å˜é‡<code>count1</code>å°±æ˜¯ä¸€ä¸ªä¸´ç•Œèµ„æºï¼Œå…¶èƒ½å¤Ÿè¢«å¤šä¸ªæ‰§è¡Œæµè®¿é—®ã€‚</p><p><font color=Red>æ³¨æ„ï¼š</font>å¦‚æœä½ å±•å¼€äº†stdå‘½åç©ºé—´ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª<code>count</code>å‡½æ•°ï¼Œä¼šå’Œä½ è‡ªå·±å®šä¹‰çš„å…¨å±€<code>count</code>å˜é‡å†²çªã€‚åˆšå¼€å§‹æˆ‘å°±å®šä¹‰äº†countï¼Œå‘ç°æŠ¥é”™å˜é‡ä¸æ˜ç¡®ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> TOP 100</span></span><br><span class="line"><span class="keyword">volatile</span> <span class="type">int</span> count1 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (count1 == TOP)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; : &quot;</span> &lt;&lt; count1++ &lt;&lt; endl;</span><br><span class="line">this_thread::<span class="built_in">sleep_for</span>(chrono::<span class="built_in">milliseconds</span>(<span class="number">10</span>));</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; : &quot;</span> &lt;&lt; count1 &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test7</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">thread threading[<span class="number">10</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">threading[i] = <span class="built_in">thread</span>(func);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">threading[i].<span class="built_in">join</span>();</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;main: &quot;</span> &lt;&lt; count1 &lt;&lt; endl;</span><br><span class="line">this_thread::<span class="built_in">sleep_for</span>(chrono::<span class="built_in">seconds</span>(<span class="number">2</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•çš„æ—¶å€™ï¼Œå°±èƒ½çœ‹åˆ°ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„å†²çªç»“æœã€‚31752çº¿ç¨‹å·²ç»++åˆ°100äº†ï¼Œç»“æœå®ƒåŠªåŠ›çš„ç»“æœè¢«å…¶ä»–ä¸¤ä¸ªçº¿ç¨‹ç›´æ¥å¤å†™ï¼›</p><p>å½“ç„¶ï¼Œè¿™é‡Œä¹Ÿæœ‰å¯èƒ½æ˜¯æ˜¾ç¤ºå™¨ä¹±åºæ‰“å°çš„ç»“æœã€‚è¦çŸ¥é“ï¼Œæ˜¾ç¤ºå™¨ä¹Ÿæ˜¯ä¸€ä¸ªä¸´ç•Œèµ„æº</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f34965d82fb.png"                      alt="image-20230220182023292"                ></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mutex mtx;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (count1 == TOP)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åŠ é”çš„ç²’åº¦è¦ä½</span></span><br><span class="line">mtx.<span class="built_in">lock</span>();</span><br><span class="line">cout &lt;&lt; this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; : &quot;</span> &lt;&lt; count1++ &lt;&lt; endl;</span><br><span class="line">mtx.<span class="built_in">unlock</span>();</span><br><span class="line">this_thread::<span class="built_in">sleep_for</span>(chrono::<span class="built_in">milliseconds</span>(<span class="number">10</span>));</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; : &quot;</span> &lt;&lt; count1 &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»™è®¿é—®countçš„å‡½æ•°æ·»åŠ ä¸Šé”ï¼Œå°±èƒ½é¿å…æ‰ä¸Šé¢å‡ºç°çš„é—®é¢˜</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f34a2934127.png"                      alt="image-20230220182338849"                ></p><h1 id="9-CASåŸå­æ“ä½œ"><a href="#9-CASåŸå­æ“ä½œ" class="headerlink" title="9.CASåŸå­æ“ä½œ"></a>9.CASåŸå­æ“ä½œ</h1><p>åœ¨ç³»ç»Ÿä¸­ï¼Œæä¾›äº†ä¸€äº›æŒ‡ä»¤ï¼Œæ¥å®ç°åŸå­æ“ä½œï¼</p><h2 id="9-1-åŸç†"><a href="#9-1-åŸç†" class="headerlink" title="9.1 åŸç†"></a>9.1 åŸç†</h2><p>Compare And Setï¼ˆæˆ–Compare And Swapï¼‰ï¼Œç®€ç§°CASã€‚å…¶æ˜¯è§£å†³å¤šçº¿ç¨‹<strong>å¹¶è¡Œ</strong>æƒ…å†µä¸‹ä½¿ç”¨é”é€ æˆæ€§èƒ½æŸè€—çš„ä¸€ç§æœºåˆ¶ï¼Œé‡‡ç”¨è¿™ç§<strong>æ— é”çš„åŸå­æ“ä½œ</strong>å¯ä»¥å®ç°çº¿ç¨‹å®‰å…¨ï¼Œé¿å…åŠ é”çš„ç¬¨é‡æ€§ã€‚</p><p>CASæ“ä½œåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°ï¼šå†…å­˜ä½ç½®ï¼ˆVï¼‰ã€é¢„æœŸåŸå€¼ï¼ˆAï¼‰ã€æ–°å€¼(B)</p><p>å…·ä½“æ“ä½œæµç¨‹è¯·çœ‹ä¸‹å›¾ï¼š</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f362c326f23.png"                      alt="image-20230220200715839"                ></p><p>å¦‚æœä¸Šé¢çš„å›¾çœ‹ä¸æ‡‚ï¼Œè¿˜å¯ä»¥çœ‹ä¸‹é¢è¿™ä¸ªå›¾</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f363eb304d7.png"                      alt="image-20230220201332945"                ></p><p>æ–‡å­—æè¿°å¦‚ä¸‹ï¼š</p><ul><li>å¦‚æœå†…å­˜ä½ç½®çš„å€¼ï¼ˆVï¼‰ä¸é¢„æœŸåŸå€¼ï¼ˆAï¼‰ç›¸åŒï¼Œå¤„ç†å™¨ä¼šå°†è¯¥ä½ç½®çš„å€¼<strong>æ›´æ–°</strong>ä¸ºæ–°å€¼ï¼ˆBï¼‰ CAS æ“ä½œæˆåŠŸï¼</li><li>å¦åˆ™ï¼Œå¤„ç†å™¨ä¸åšä»»ä½•æ›´æ”¹ï¼Œåªéœ€è¦å°†<strong>å½“å‰ä½ç½®çš„å€¼è¿›è¡Œè¿”å›</strong>å³å¯</li></ul><p>CASæ˜¯å®ç°<strong>è‡ªæ—‹é”</strong>çš„åŸºç¡€ï¼ŒCAS åˆ©ç”¨CPUæŒ‡ä»¤ä¿è¯äº†æ“ä½œçš„åŸå­æ€§ï¼Œä»¥è¾¾åˆ°é”çš„æ•ˆæœï¼Œå¾ªç¯è¿™ä¸ªæŒ‡ä»¤ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚</p><h2 id="9-2-é—®é¢˜"><a href="#9-2-é—®é¢˜" class="headerlink" title="9.2 é—®é¢˜"></a>9.2 é—®é¢˜</h2><p>CASä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå…¶åœ¨å¦‚ä¸‹åœºæ™¯ä¸‹å¯èƒ½ä¼šå‡ºç°é—®é¢˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.æœ‰çº¿ç¨‹aå’Œb</span><br><span class="line">2.æœ‰å…¨å±€å˜é‡ï¼Œåˆå§‹å€¼ä¸º1</span><br><span class="line">3.çº¿ç¨‹aå…ˆæ¥è®¿é—®ï¼Œæ‹¿èµ°äº†åˆå§‹å€¼1</span><br><span class="line">4.å‘ç”Ÿçº¿ç¨‹åˆ‡æ¢ï¼Œçº¿ç¨‹bæ¥è®¿é—®ï¼Œæ‹¿èµ°åˆå§‹å€¼1ï¼Œæ›´æ–°ä¸º2ï¼Œåˆä¿®æ”¹å›1</span><br><span class="line">5.å‘ç”Ÿçº¿ç¨‹åˆ‡æ¢ï¼Œçº¿ç¨‹aç»§ç»­è®¿é—®ï¼Œæ­¤æ—¶å€¼ä¾æ—§æ˜¯1ï¼Œçº¿ç¨‹aä¼šè®¤ä¸ºæ²¡æœ‰é—®é¢˜ï¼Œå†™å…¥</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä¸Šé¢çš„åœºæ™¯ä¸­ï¼Œæœ‰ä¸€ä¸ªçº¿ç¨‹æŠŠå…¨å±€å˜é‡ä¿®æ”¹äº†ä¹‹ååˆæ”¹äº†å›å»ï¼Œè¿™æ—¶å€™å°±æ²¡æœ‰åŠæ³•ä»<strong>å–å€¼</strong>åˆ¤æ–­å˜é‡æ˜¯å¦è¿˜æ˜¯â€œåŸæ¥çš„é‚£ä¸ªâ€äº†</p><blockquote><p>é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œjavaå¹¶å‘åŒ…ä¸­æä¾›äº†ä¸€ä¸ªå¸¦æœ‰æ ‡è®°çš„åŸå­å¼•ç”¨ç±»â€AtomicStampedReferenceâ€ï¼Œå®ƒå¯ä»¥é€šè¿‡æ§åˆ¶å˜é‡å€¼çš„ç‰ˆæœ¬æ¥ä¿è¯CASçš„æ­£ç¡®æ€§ã€‚</p></blockquote><p>C&#x2F;C++ä¸­æœ‰æ²¡æœ‰åŠæ³•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæˆ‘æ²¡ç™¾åº¦åˆ°ğŸ˜‚</p><h1 id="10-lock-guard"><a href="#10-lock-guard" class="headerlink" title="10.lock_guard"></a>10.lock_guard</h1><p>äººå¦‚å…¶åï¼Œè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªå®ˆæŠ¤é”ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Mutex</span>&gt; <span class="keyword">class</span> <span class="title class_">lock_guard</span>;</span><br></pre></td></tr></table></figure><p>å…¶è¿ç”¨äº†RAIIçš„æ€è·¯ï¼Œèƒ½åœ¨æ„é€ çš„æ—¶å€™åŠ é”ï¼Œææ„çš„æ—¶å€™è§£é”ã€‚æˆ‘ä»¬å°±ä¸éœ€è¦è‡ªå·±æ“ä½œäº†ã€‚</p><p>æ¯•ç«Ÿï¼Œä»£ç ä¸€é•¿èµ·æ¥ï¼Œä¸€ä¸ªé”æœ‰æ²¡æœ‰è¢«è§£å¼€ï¼Œæ˜¯çœŸçš„æä¸æ¸…æ¥šğŸ˜¥</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">mutex mtx;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test7</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> n = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> m = <span class="number">1000000</span>;</span><br><span class="line">cin &gt;&gt; n;</span><br><span class="line"><span class="function">vector&lt;thread&gt; <span class="title">threading</span><span class="params">(n)</span></span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">&#123;</span><br><span class="line">threading[i] = <span class="built_in">thread</span>([&amp;]() &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">&#123;</span><br><span class="line">lock_guard&lt;mutex&gt; <span class="built_in">t</span>(mtx);<span class="comment">//è‡ªåŠ¨åŠ é”è§£é”</span></span><br><span class="line">x++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">&#123;</span><br><span class="line">threading[i].<span class="built_in">join</span>();</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;main: &quot;</span> &lt;&lt; x &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f366f3c1b90.png"                      alt="image-20230220202628663"                ></p><p>å¦‚æœforå¾ªç¯ä¸­éœ€è¦æ‰§è¡Œçš„ä»£ç å¾ˆå¤šï¼Œè€Œåªæœ‰xæ˜¯ä¸´ç•Œèµ„æºçš„è¯ï¼Œé‚£å°±éœ€è¦æˆ‘ä»¬<code>æ‰‹åŠ¨æ§åˆ¶</code>ä¸€ä¸‹ä½œç”¨åŸŸ<code>&#123;&#125;</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">&#123;</span><br><span class="line">             <span class="comment">//å…¶ä»–ä»£ç </span></span><br><span class="line">             &#123;</span><br><span class="line">                 <span class="function">lock_guard&lt;mutex&gt; <span class="title">t</span><span class="params">(mtx)</span></span>;<span class="comment">//è‡ªåŠ¨åŠ é”è§£é”</span></span><br><span class="line">   x++;</span><br><span class="line">             &#125;</span><br><span class="line">             <span class="comment">//å…¶ä»–ä»£ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="11-unique-lock"><a href="#11-unique-lock" class="headerlink" title="11.unique_lock"></a>11.unique_lock</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Mutex</span>&gt; <span class="keyword">class</span> <span class="title class_">unique_lock</span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ å­¦ä¹ è¿‡æ™ºèƒ½æŒ‡é’ˆï¼Œé‚£è‚¯å®šå°±çŸ¥é“è¿™ä¸ªå‘½åçš„å«ä¹‰ï¼›</p><p><code>unique_lock</code>æ˜¯<code>lock_graud</code>çš„å¢å¼ºç‰ˆæœ¬ï¼Œå…¶åœ¨æ”¯æŒè‡ªåŠ¨åŠ é”è§£é”çš„å‰æä¸‹ï¼Œè¿˜æ”¯æŒæ‰‹åŠ¨åŠ é”è§£é”ï¼›</p><h2 id="11-1-ä½¿ç”¨ç¤ºä¾‹"><a href="#11-1-ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="11.1 ä½¿ç”¨ç¤ºä¾‹"></a>11.1 ä½¿ç”¨ç¤ºä¾‹</h2><p>ä¸‹é¢å°±æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ä½¿ç”¨åœºæ™¯</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">threading[i] = <span class="built_in">thread</span>([&amp;]() &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">&#123;</span><br><span class="line">unique_lock&lt;mutex&gt; <span class="built_in">t</span>(mtx);<span class="comment">//è‡ªåŠ¨åŠ é”</span></span><br><span class="line">x++;</span><br><span class="line">t.<span class="built_in">unlock</span>(); <span class="comment">//æ‰‹åŠ¨è§£é”</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿå…¶ä»–å·¥ä½œ</span></span><br><span class="line">this_thread::<span class="built_in">sleep_for</span>(chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆéœ€è¦è®¿é—®ä¸´ç•Œèµ„æº</span></span><br><span class="line">t.<span class="built_in">lock</span>();<span class="comment">// æ‰‹åŠ¨è§£é”</span></span><br><span class="line">x++;</span><br><span class="line">&#125;<span class="comment">// å‡ºä½œç”¨åŸŸï¼Œè‡ªåŠ¨è§£é”</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="11-2-try-lock"><a href="#11-2-try-lock" class="headerlink" title="11.2 try_lock"></a>11.2 try_lock</h2><p>é™¤äº†æœ€åŸºç¡€çš„try_lockä¹‹å¤–ï¼Œè¿™ä¸ªç±»è¿˜æ”¯æŒforå’Œuntilï¼Œå’Œ<code>this_thread</code>ä¸­çš„sleepæ˜¯ä¸€æ ·çš„å«ä¹‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">try_lock</span><br><span class="line">Lock mutex if not locked (public member function )</span><br><span class="line"></span><br><span class="line">try_lock_for</span><br><span class="line">Try to lock mutex during time span (public member function )</span><br><span class="line">åŠ é”ä¸€ç›´åˆ°æŒ‡å®šæ—¶é—´è§£é”ï¼ˆåŠ é”åˆ°æ˜å¤©æ—©å…«ï¼‰</span><br><span class="line"></span><br><span class="line">try_lock_until</span><br><span class="line">Try to lock mutex until time point (public member function )</span><br><span class="line">åŠ é”xxæ—¶é—´ï¼ˆåŠ é”100ç§’ï¼Œæ—¶é—´åˆ°äº†è‡ªåŠ¨è§£é”ï¼‰</span><br></pre></td></tr></table></figure><p>æ—¶é—´åˆ°äº†ä¹‹åï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¿›è¡Œè§£é”ã€‚å¦‚æœç”¨æˆ·åœ¨è¿™ä¹‹å‰å·²ç»æ‰‹åŠ¨è§£é”äº†ï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸ä¼šåš</p><h2 id="11-3-release"><a href="#11-3-release" class="headerlink" title="11.3 release"></a>11.3 release</h2><p>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨å°±å¾ˆç‹¬ç‰¹äº†ï¼Œå…¶å°†è‡ªå·±ç®¡ç†çš„é”é‡Šæ”¾æ‰ï¼Œä¸å†ç®¡ç†è¿™ä¸ªé”</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">mutex_type* <span class="title">release</span><span class="params">()</span> <span class="keyword">noexcept</span></span>;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨è¿™ä¸ªå‡½æ•°ä¼šè¿”å›æ‰˜ç®¡äº’æ–¥å¯¹è±¡çš„<strong>æŒ‡é’ˆ</strong>ï¼Œé‡Šæ”¾å…¶æ‰€æœ‰æƒã€‚è°ƒç”¨åï¼Œunique_lockå¯¹è±¡ä¸å†ç®¡ç†ä»»ä½•äº’æ–¥å¯¹è±¡ï¼ˆå³ï¼Œå®ƒå¤„äºä¸ifé»˜è®¤æ„é€ ç›¸åŒçš„çŠ¶æ€ï¼‰ã€‚</p><p> æ³¨æ„ï¼Œæ­¤å‡½æ•°ä¸ä¼š<strong>é”å®šæˆ–è§£é”</strong>è¿”å›çš„äº’æ–¥å¯¹è±¡ã€‚</p><p>è¯´äººè¯å°±æ˜¯ï¼Œä¸éœ€è¦ä½ RALLæ¥ç®¡ç†è¿™ä¸ªé”äº†ï¼Œäº¤ç»™ç”¨æˆ·è‡ªå·±ç®¡ç†ï¼</p><h1 id="12-share-ptr"><a href="#12-share-ptr" class="headerlink" title="12.share_ptr"></a>12.share_ptr</h1><blockquote><p><code>share_ptr</code>çš„å®Œæ•´ä»£ç è¯·çœ‹æˆ‘çš„ <a class="link"   href="https://gitee.com/musnow/learn_cpp_code/tree/master/Cpp/23-02-19%20thread" >Gitee<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>åœ¨æ™ºèƒ½æŒ‡é’ˆä¸­ï¼Œ<code>share_ptr</code>é‡‡ç”¨å¼•ç”¨è®¡æ•°æ¥åˆ¤æ–­æœ‰å¤šå°‘æ¬¡æ‹·è´ï¼ˆæ‹·è´æ„é€ ã€èµ‹å€¼é‡è½½ï¼‰ï¼Œåªæœ‰æ‹·è´è®¡æ•°å™¨ä¸º1çš„æ—¶å€™ï¼Œææ„æ‰éœ€è¦é‡Šæ”¾èµ„æºã€‚</p><p>åœ¨<code>share_ptr</code>å†…éƒ¨æœ‰ä¸€ä¸ªå˜é‡è¿›è¡Œè®¡æ•°ã€‚æ—¢ç„¶æœ‰ä¸€ä¸ªè®¡æ•°å˜é‡ï¼Œé‚£å°±éœ€è¦ä¿è¯å¤šçº¿ç¨‹æ‰§è¡Œæ—¶çš„åŸå­æ€§ï¼</p><h2 id="12-1-å¼•ç”¨è®¡æ•°åŠ é”"><a href="#12-1-å¼•ç”¨è®¡æ•°åŠ é”" class="headerlink" title="12.1 å¼•ç”¨è®¡æ•°åŠ é”"></a>12.1 å¼•ç”¨è®¡æ•°åŠ é”</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">AddRef</span><span class="params">()</span><span class="comment">//æ–°å¢å¼•ç”¨</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">_pMutex-&gt;<span class="built_in">lock</span>();</span><br><span class="line"></span><br><span class="line">++(*_pRefCount);</span><br><span class="line"></span><br><span class="line">_pMutex-&gt;<span class="built_in">unlock</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="12-2-é‡Šæ”¾"><a href="#12-2-é‡Šæ”¾" class="headerlink" title="12.2 é‡Šæ”¾"></a>12.2 é‡Šæ”¾</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Release</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">bool</span> flag = <span class="literal">false</span>;<span class="comment">//åˆ¤æ–­é”æ˜¯å¦éœ€è¦è¢«é‡Šæ”¾</span></span><br><span class="line"></span><br><span class="line">_pMutex-&gt;<span class="built_in">lock</span>();</span><br><span class="line"><span class="keyword">if</span> (--(*_pRefCount) == <span class="number">0</span> &amp;&amp; _ptr)</span><br><span class="line">&#123;</span><br><span class="line">               <span class="comment">//è¿›å…¥äº†è¿™ä¸ªå‡½æ•°ï¼Œä»£è¡¨å¼•ç”¨è®¡æ•°ä¸º0</span></span><br><span class="line"><span class="keyword">delete</span> _ptr;</span><br><span class="line"><span class="keyword">delete</span> _pRefCount;</span><br><span class="line"><span class="comment">//æ ‡è¯†éœ€è¦é‡Šæ”¾é”</span></span><br><span class="line">flag = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">_pMutex-&gt;<span class="built_in">unlock</span>();<span class="comment">//è§£é”</span></span><br><span class="line"><span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line"><span class="keyword">if</span> (flag)&#123;</span><br><span class="line"><span class="keyword">delete</span> _pMutex;</span><br><span class="line">           &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="12-3-æ³¨æ„äº‹é¡¹"><a href="#12-3-æ³¨æ„äº‹é¡¹" class="headerlink" title="12.3 æ³¨æ„äº‹é¡¹"></a>12.3 æ³¨æ„äº‹é¡¹</h2><p><code>share_ptr</code>çš„åŠ é”åªé™äºè¿™ä¸ªç±»å¯¹è±¡æœ¬èº«çš„å®‰å…¨æ€§ï¼Œè¿™ä¸ªé”å¹¶<strong>ä¸æ˜¯</strong>ç”¨æ¥ä¿æŠ¤<code>share_ptr</code>æ‰€æŒ‡å‘çš„èµ„æºçš„ï¼</p><h1 id="13-atomic"><a href="#13-atomic" class="headerlink" title="13.atomic"></a>13.atomic</h1><p>åœ¨å…¨å±€å˜é‡ä¸­ï¼Œè®¡æ•°å™¨æ˜¯å¾ˆå¸¸ç”¨çš„ç±»å‹ã€‚æ‰€ä»¥C++ä¸­è¿˜æä¾›äº†ä¸€ä¸ªå¯ä»¥è¿›è¡ŒåŸå­æ“ä½œçš„ç±»ï¼Œå¯¹è¿™ä¸ªå˜é‡è¿›è¡Œçš„æ“ä½œæ˜¯å…·æœ‰åŸå­æ€§çš„ï¼Œä¸éœ€è¦æˆ‘ä»¬è¿›è¡ŒåŠ é”è§£é”</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="keyword">struct</span> <span class="title class_">atomic</span>;</span><br></pre></td></tr></table></figure><h2 id="13-1-åŸºæœ¬ä½¿ç”¨"><a href="#13-1-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="13.1 åŸºæœ¬ä½¿ç”¨"></a>13.1 åŸºæœ¬ä½¿ç”¨</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">atomic&lt;<span class="type">int</span>&gt; val=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test8</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; val &lt;&lt; endl;</span><br><span class="line">val++;</span><br><span class="line">cout &lt;&lt; val &lt;&lt; endl;</span><br><span class="line">val = <span class="number">20</span>;</span><br><span class="line">cout &lt;&lt; val &lt;&lt; endl;</span><br><span class="line">val--;</span><br><span class="line">cout &lt;&lt; val &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯intç±»å‹ï¼ŒåŸå­å˜é‡å’Œæ™®é€šçš„intå˜é‡çš„ä½¿ç”¨æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f4830c02ad0.png"                      alt="image-20230221163836363"                ></p><p>å¯ä»¥çœ‹åˆ°ï¼Œé‡è½½äº†ä»¥åï¼ŒåŸå­å˜é‡æ”¯æŒ<code>++  --</code>ï¼Œä¹Ÿæ”¯æŒç›´æ¥èµ‹å€¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f48604478a8.png"                      alt="image-20230221165116759"                ></p><p>ä¸è¿‡ï¼Œè¿™äº›æ–¹æ³•æ ‡æ˜äº†ï¼Œåªæœ‰æ•´å½¢å®¶æ—å’ŒæŒ‡é’ˆç±»å‹å¯ä»¥ä½¿ç”¨ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f4862eea490.png"                      alt="image-20230221165159400"                ></p><h2 id="13-2-operator-x3D"><a href="#13-2-operator-x3D" class="headerlink" title="13.2 operator &#x3D;"></a>13.2 operator &#x3D;</h2><p>åŸå­å˜é‡å¯ä»¥ç›´æ¥èµ‹å€¼ï¼Œæ˜¯å› ä¸ºå…¶é‡è½½äº† <code>operator =</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//set value (1)</span></span><br><span class="line">T <span class="keyword">operator</span>= (T val) <span class="keyword">noexcept</span>;</span><br><span class="line">T <span class="keyword">operator</span>= (T val) <span class="keyword">volatile</span> <span class="keyword">noexcept</span>;</span><br><span class="line"><span class="comment">//copy [deleted] (2)</span></span><br><span class="line">atomic&amp; <span class="keyword">operator</span>= (<span class="type">const</span> atomic&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">atomic&amp; <span class="keyword">operator</span>= (<span class="type">const</span> atomic&amp;) <span class="keyword">volatile</span> = <span class="keyword">delete</span>;</span><br></pre></td></tr></table></figure><h2 id="13-3-operator-T-x2F-load"><a href="#13-3-operator-T-x2F-load" class="headerlink" title="13.3 operator T&#x2F;load"></a>13.3 operator T&#x2F;load</h2><p><code>operator T </code>çš„ä½œç”¨ï¼Œæ˜¯æ”¯æŒ<strong>éšå¼ç±»å‹</strong>è½¬æ¢ï¼Œè¿™æ ·åŸå­å˜é‡åœ¨è¿›è¡Œifæ¯”è¾ƒçš„æ—¶å€™ï¼Œä¼šè½¬æ¢æˆé‡è½½åçš„ç±»å‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">operator</span> <span class="title">T</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">volatile</span> <span class="keyword">noexcept</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">operator</span> <span class="title">T</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span></span>;</span><br></pre></td></tr></table></figure><p>åœ¨vs2019é‡Œé¢è·³è½¬æºç ï¼Œèƒ½çœ‹åˆ°é‡è½½åçš„è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œå…¶å®æ˜¯è°ƒç”¨äº†loadæ–¹æ³•</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Ty</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">atomic</span> : _Choose_atomic_base_t&lt;_Ty&gt;&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line"><span class="keyword">operator</span> _Ty() <span class="type">const</span> <span class="keyword">volatile</span> <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="built_in">static_assert</span>(_Deprecate_non_lock_free_volatile&lt;_Ty&gt;, <span class="string">&quot;Never fails&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;<span class="built_in">load</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">operator</span> _Ty() <span class="type">const</span> <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;<span class="built_in">load</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f4844ba3f8a.png"                      alt="image-20230221164356074"                ></p><p>æŸ¥çœ‹cplusplusçš„è§£é‡Šï¼Œloadæ–¹æ³•å°±æ˜¯è¿”å›äº†å…¶å†…éƒ¨æ‰€åŒ…å«çš„å€¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">T <span class="title">load</span> <span class="params">(memory_order sync = memory_order_seq_cst)</span> <span class="type">const</span> <span class="keyword">volatile</span> <span class="keyword">noexcept</span></span>;</span><br><span class="line"><span class="function">T <span class="title">load</span> <span class="params">(memory_order sync = memory_order_seq_cst)</span> <span class="type">const</span> <span class="keyword">noexcept</span></span>;</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f484917ab03.png"                      alt="image-20230221164506017"                ></p><p>è¿™é‡Œè¿˜ç‰¹æ„æ ‡æ³¨äº†ï¼Œloadæ–¹æ³•çš„ä½¿ç”¨æ˜¯åŸå­æ€§çš„</p><h2 id="13-4-exchange"><a href="#13-4-exchange" class="headerlink" title="13.4 exchange"></a>13.4 exchange</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">T <span class="title">exchange</span> <span class="params">(T val, memory_order sync = memory_order_seq_cst)</span> <span class="keyword">volatile</span> <span class="keyword">noexcept</span></span>;</span><br><span class="line"><span class="function">T <span class="title">exchange</span> <span class="params">(T val, memory_order sync = memory_order_seq_cst)</span> <span class="keyword">noexcept</span></span>;</span><br></pre></td></tr></table></figure><p><code>exchange</code>å‡½æ•°çš„ä½œç”¨æ˜¯ä¿®æ”¹åŸå­å˜é‡ç®¡ç†çš„å€¼ï¼Œå…¶è¿”å›å€¼æ˜¯<strong>ä¿®æ”¹ä¹‹å‰</strong>çš„å˜é‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Return value</span><br><span class="line">The contained value before the call.</span><br><span class="line">T is atomic&#x27;s template parameter (the type of the contained value).</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹é¢çš„ä»£ç ä¸ºä¾‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">atomic&lt;<span class="type">int</span>&gt; val=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test8</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; val &lt;&lt; endl;</span><br><span class="line"><span class="type">int</span> tmp = val.<span class="built_in">exchange</span>(<span class="number">450</span>);</span><br><span class="line">cout &lt;&lt; val &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; tmp &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°tmpæ¥æ”¶åˆ°çš„ç»“æœæ˜¯valçš„åˆå§‹å€¼0ï¼Œvalæœ¬èº«è¢«ä¿®æ”¹ä¸º450</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f48556ad15c.png"                      alt="image-20230221164823139"                ></p><h2 id="13-5-store"><a href="#13-5-store" class="headerlink" title="13.5 store"></a>13.5 store</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">store</span> <span class="params">(T val, memory_order sync = memory_order_seq_cst)</span> <span class="keyword">volatile</span> <span class="keyword">noexcept</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">store</span> <span class="params">(T val, memory_order sync = memory_order_seq_cst)</span> <span class="keyword">noexcept</span></span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ¯”exchangeç®€å•ï¼Œå…¶åªä¿®æ”¹å­˜å‚¨çš„å˜é‡ï¼Œæ²¡æœ‰è¿”å›å€¼</p><hr><p>å…³äºåŸå­å˜é‡çš„ä»‹ç»å°±è¿™ä¹ˆå¤šï¼Œä¸‹é¢æ¥åº·åº·C++ä¸­çš„æ¡ä»¶å˜é‡</p><h1 id="14-condition-variable"><a href="#14-condition-variable" class="headerlink" title="14.condition_variable"></a>14.condition_variable</h1><blockquote><p>æ¡ä»¶å˜é‡çš„æ¦‚å¿µï¼Œå‚è€ƒ <a href="https://blog.musnow.top/2022/12/30/note_linux/20%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5/">linux çº¿ç¨‹åŒæ­¥</a></p></blockquote><h2 id="14-1-æ„é€ å’Œwait"><a href="#14-1-æ„é€ å’Œwait" class="headerlink" title="14.1 æ„é€ å’Œwait"></a>14.1 æ„é€ å’Œwait</h2><p>æ¡ä»¶å˜é‡ï¼Œæ˜¯ç”¨äºçº¿ç¨‹åŒæ­¥æ“ä½œçš„ä¸€ä¸ªæ¥å£ã€‚åœ¨C++ä¸­ï¼Œæ¡ä»¶å˜é‡åªæœ‰ä¸€ä¸ªç©ºæ„é€ </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//default (1)</span></span><br><span class="line"><span class="built_in">condition_variable</span>();</span><br><span class="line"><span class="comment">//copy [deleted] (2)</span></span><br><span class="line"><span class="built_in">condition_variable</span> (<span class="type">const</span> condition_variable&amp;) = <span class="keyword">delete</span>;</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬è¿›è¡Œwaitç­‰å¾…çš„æ—¶å€™ï¼Œéœ€è¦å¾€æ¡ä»¶å˜é‡å†…ä¼ å…¥ä¸€ä¸ªé”ï¼›è¿›å…¥waitå‡½æ•°ï¼Œå¼€å§‹ç­‰å¾…å‰ä¼šå…ˆè§£é”ï¼Œé€€å‡ºå‡½æ•°å‰ä¼šåŠ é”ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//unconditional (1)</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">wait</span> <span class="params">(unique_lock&lt;mutex&gt;&amp; lck)</span></span>;</span><br><span class="line"><span class="comment">//predicate (2)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Predicate</span>&gt;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">wait</span> <span class="params">(unique_lock&lt;mutex&gt;&amp; lck, Predicate pred)</span></span>;</span><br></pre></td></tr></table></figure><p>waitå‡½æ•°é™¤äº†ä¼ å…¥é”ï¼Œè¿˜å¯ä»¥ä¼ å…¥ä¸€ä¸ª<code>Predicate pred</code>å¯æ‰§è¡Œå‡½æ•°ä½“ï¼Œæ¥åˆ¤æ–­æ¡ä»¶å˜é‡æ˜¯å¦æ»¡è¶³ï¼›</p><p>å¦‚æœæŒ‡å®šäº†predï¼Œåˆ™åªæœ‰å½“predè¿”å›falseæ—¶ï¼Œè¯¥å‡½æ•°æ‰ä¼šé˜»å¡ï¼›å¹¶ä¸”åªæœ‰å½“å®ƒå˜ä¸ºtrueæ—¶ï¼Œé€šçŸ¥æ‰èƒ½è§£é™¤é˜»å¡çº¿ç¨‹ï¼ˆè¿™å¯¹äºæ£€æŸ¥<strong>è™šå‡å”¤é†’</strong>ç‰¹åˆ«æœ‰ç”¨ï¼‰</p><ul><li>è™šå‡å”¤é†’ï¼ŒæŒ‡çš„æ˜¯ä¸€äº›ä»£ç é”™è¯¯çš„æƒ…å†µä¸‹ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹åœ¨æ¡ä»¶å°šæœªçœŸæ­£å°±ç»ªçš„æ—¶å€™å°±å”¤é†’äº†è¯¥çº¿ç¨‹</li><li>æ·»åŠ ä¸Šåˆ¤æ–­æ¡ä»¶ï¼Œ<strong>èƒ½åœ¨waitä¸­åˆ¤æ–­æ¡ä»¶æ˜¯å¦å·²ç»çœŸæ­£æ»¡è¶³</strong>ï¼Œä»è€Œé¿å…è™šå‡å”¤é†’</li></ul><p>waitå†…éƒ¨å¯¹predçš„æ£€æµ‹æ˜¯ä¸‹é¢è¿™æ ·</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (!<span class="built_in">pred</span>()) <span class="built_in">wait</span>(lck);</span><br></pre></td></tr></table></figure><p>åªæœ‰predè¿”å›çœŸçš„æ—¶å€™ï¼Œæ‰ä¼šè·³å‡ºwhileå¾ªç¯ï¼Œå”¤é†’çº¿ç¨‹ã€‚</p><p>é™¤äº†æ£€æµ‹è™šå‡å”¤é†’ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨è¯¥æ‰§è¡Œä½“ï¼Œå¯¹ä¸åŒçš„çº¿ç¨‹<strong>æŒ‡å®šä¸åŒçš„å”¤é†’æ¡ä»¶</strong>ï¼</p><h2 id="14-2-å…¶ä»–æ¥å£"><a href="#14-2-å…¶ä»–æ¥å£" class="headerlink" title="14.2 å…¶ä»–æ¥å£"></a>14.2 å…¶ä»–æ¥å£</h2><p>å…¶ä»–æ¥å£çš„ä½¿ç”¨ä¹Ÿå¾ˆç›´æ¥ï¼Œå…¶ä¸­wait_forå’Œuntilå‰é¢å·²ç»ä»‹ç»è¿‡äº†</p><ul><li>waitï¼šåœ¨æ¡ä»¶å˜é‡ä¸­é˜»å¡ç­‰å¾…ï¼Œç­‰å¾…è¢«å”¤é†’</li><li>notify_oneï¼šå”¤é†’åœ¨è¯¥æ¡ä»¶å˜é‡ç­‰å¾…ä¸‹çš„ä¸€ä¸ªçº¿ç¨‹</li><li>notify_allï¼šå”¤é†’åœ¨è¯¥æ¡ä»¶å˜é‡ä¸‹ç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹</li></ul><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f48806d52a4.png"                      alt="image-20230221165951372"                ></p><h2 id="14-3-å®é™…ç”¨ä¾‹"><a href="#14-3-å®é™…ç”¨ä¾‹" class="headerlink" title="14.3 å®é™…ç”¨ä¾‹"></a>14.3 å®é™…ç”¨ä¾‹</h2><p>å½“ä¸‹æˆ‘ä»¬æœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è®©t1å’Œt2çº¿ç¨‹å…±åŒç®¡ç†ä¸€ä¸ªå˜é‡iï¼Œå¯¹å…¶è¿›è¡Œ++ï¼Œå¹¶å®ç°t1æ‰“å°å¥‡æ•°ï¼Œt2æ‰“å°å¶æ•°çš„åŠŸèƒ½ï¼ˆäºŒè€…äº¤é”™æ‰“å°ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test9</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// ç›®æ ‡ï¼št1æ‰“å°å¥‡æ•°ï¼Œt2æ‰“å°å¶æ•°ï¼ŒäºŒè€…äº¤é”™æ‰“å°</span></span><br><span class="line">    <span class="type">bool</span> ready = <span class="literal">true</span>;</span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> n = <span class="number">100</span>;</span><br><span class="line">mutex mtx;</span><br><span class="line">condition_variable cv;</span><br><span class="line"></span><br><span class="line"><span class="comment">// t1æ‰“å°å¥‡æ•°</span></span><br><span class="line"><span class="function">thread <span class="title">t1</span><span class="params">([&amp;]()&#123;</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="keyword">while</span> (i &lt; n)</span></span></span><br><span class="line"><span class="params"><span class="function">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">            unique_lock&lt;mutex&gt; lock(mtx);</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">            cout &lt;&lt; <span class="string">&quot;t1 : &quot;</span> &lt;&lt; this_thread::get_id() &lt;&lt; <span class="string">&quot; : &quot;</span> &lt;&lt; i &lt;&lt; endl;</span></span></span><br><span class="line"><span class="params"><span class="function">            i++;</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// t2æ‰“å°å¶æ•°</span></span><br><span class="line"><span class="function">thread <span class="title">t2</span><span class="params">([&amp;]() &#123;</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="keyword">while</span> (i &lt; n)</span></span></span><br><span class="line"><span class="params"><span class="function">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">unique_lock&lt;mutex&gt; lock(mtx);</span></span></span><br><span class="line"><span class="params"><span class="function">cout &lt;&lt;<span class="string">&quot;t2 : &quot;</span>&lt;&lt;this_thread::get_id() &lt;&lt; <span class="string">&quot; : &quot;</span> &lt;&lt; i &lt;&lt; endl;</span></span></span><br><span class="line"><span class="params"><span class="function">i++;</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;)</span></span>;</span><br><span class="line"></span><br><span class="line">this_thread::<span class="built_in">sleep_for</span>(chrono::<span class="built_in">seconds</span>(<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;t1:&quot;</span> &lt;&lt; t1.<span class="built_in">get_id</span>() &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;t2:&quot;</span> &lt;&lt; t2.<span class="built_in">get_id</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">t1.<span class="built_in">join</span>();</span><br><span class="line">t2.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ä¸‹å·²ç»å®ç°å‡ºäº†äºŒè€…çš„åŸºæœ¬æ“ä½œï¼Œä½†ç›´æ¥è¿è¡Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œt1éƒ½å·²ç»æ‰“å°åˆ°99äº†ï¼Œt2æ‰å¼€å§‹æ‰§è¡Œï¼Œå®Œå…¨ä¸ç¬¦åˆäº¤é”™æ‰“å°çš„éœ€æ±‚</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f487e871e3c.png"                      alt="image-20230221165920681"                ></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">thread <span class="title">t1</span><span class="params">([&amp;]()&#123;</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="keyword">while</span> (i &lt; n)</span></span></span><br><span class="line"><span class="params"><span class="function">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">unique_lock&lt;mutex&gt; lock(mtx);</span></span></span><br><span class="line"><span class="params"><span class="function">cout &lt;&lt; <span class="string">&quot;t1 : &quot;</span> &lt;&lt; this_thread::get_id() &lt;&lt; <span class="string">&quot; : &quot;</span> &lt;&lt; i &lt;&lt; endl;</span></span></span><br><span class="line"><span class="params"><span class="function">i++;</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">this_thread::sleep_for(chrono::microseconds(<span class="number">100</span>));</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;)</span></span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœåœ¨t1çš„whileå¾ªç¯ä¸­åŠ ä¸Šä¸€ä¸ªä¼‘çœ ï¼Œt2çš„å‡½æ•°ä½“ä¿æŒä¸å˜ï¼Œåˆ™ä¼šå‘ç°æ˜¯t2ç›´æ¥åŠ åˆ°äº†99ï¼Œæ‰è®©å¯æ€œå·´å·´çš„t1è®¿é—®äº†ä¸´ç•Œèµ„æºï¼ˆé¥¥é¥¿é—®é¢˜ï¼‰</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f48a571b2b9.png"                      alt="image-20230221170943659"                ></p><p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ¡ä»¶å˜é‡æ¥å®ç°çº¿ç¨‹ç›¸äº’å”¤é†’å’Œäº¤é”™æ‰“å°ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¡ä»¶å˜é‡æµ‹è¯•</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test9</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// ç›®æ ‡ï¼št1æ‰“å°å¥‡æ•°ï¼Œt2æ‰“å°å¶æ•°ï¼ŒäºŒè€…äº¤é”™æ‰“å°</span></span><br><span class="line"><span class="type">bool</span> ready = <span class="literal">true</span>;</span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> n = <span class="number">100</span>;</span><br><span class="line">mutex mtx;</span><br><span class="line">condition_variable cv;</span><br><span class="line"></span><br><span class="line"><span class="comment">// t1æ‰“å°å¥‡æ•°</span></span><br><span class="line"><span class="function">thread <span class="title">t1</span><span class="params">([&amp;]()&#123;</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="keyword">while</span> (i &lt; n)</span></span></span><br><span class="line"><span class="params"><span class="function">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">            unique_lock&lt;mutex&gt; lock(mtx);</span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="comment">//readyä¸ºå‡çš„æ—¶å€™ï¼Œå”¤é†’t1</span></span></span></span><br><span class="line"><span class="params"><span class="function">            cv.wait(lock, [&amp;ready]()&#123;<span class="keyword">return</span> !ready; &#125;);</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">            cout &lt;&lt; <span class="string">&quot;t1 : &quot;</span> &lt;&lt; this_thread::get_id() &lt;&lt; <span class="string">&quot; : &quot;</span> &lt;&lt; i &lt;&lt; endl;</span></span></span><br><span class="line"><span class="params"><span class="function">            i++;</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">            ready = <span class="literal">true</span>;</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">            cv.notify_one();</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// t2æ‰“å°å¶æ•°</span></span><br><span class="line"><span class="function">thread <span class="title">t2</span><span class="params">([&amp;]() &#123;</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="keyword">while</span> (i &lt; n)</span></span></span><br><span class="line"><span class="params"><span class="function">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">unique_lock&lt;mutex&gt; lock(mtx);</span></span></span><br><span class="line"><span class="params"><span class="function">             <span class="comment">//readyä¸ºçœŸçš„æ—¶å€™ï¼Œå”¤é†’t2</span></span></span></span><br><span class="line"><span class="params"><span class="function">cv.wait(lock, [&amp;ready]()&#123;<span class="keyword">return</span> ready; &#125;);</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">cout &lt;&lt;<span class="string">&quot;t2 : &quot;</span>&lt;&lt;this_thread::get_id() &lt;&lt; <span class="string">&quot; : &quot;</span> &lt;&lt; i &lt;&lt; endl;</span></span></span><br><span class="line"><span class="params"><span class="function">i++;</span></span></span><br><span class="line"><span class="params"><span class="function">ready = <span class="literal">false</span>;</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">cv.notify_one();</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;)</span></span>;</span><br><span class="line"></span><br><span class="line">this_thread::<span class="built_in">sleep_for</span>(chrono::<span class="built_in">seconds</span>(<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;t1:&quot;</span> &lt;&lt; t1.<span class="built_in">get_id</span>() &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;t2:&quot;</span> &lt;&lt; t2.<span class="built_in">get_id</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">t1.<span class="built_in">join</span>();</span><br><span class="line">t2.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆåŠŸé€šè¿‡æ¡ä»¶å˜é‡ï¼Œä½¿è¿™ä¸¤ä¸ªçº¿ç¨‹äº¤é”™æ‰“å°å¥‡å¶æ•°ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">t2 : 23208 : 0</span><br><span class="line">t1 : 24896 : 1</span><br><span class="line">t2 : 23208 : 2</span><br><span class="line">t1 : 24896 : 3</span><br><span class="line">t2 : 23208 : 4</span><br><span class="line">t1 : 24896 : 5</span><br><span class="line">t2 : 23208 : 6</span><br><span class="line">t1 : 24896 : 7</span><br><span class="line">t2 : 23208 : 8</span><br><span class="line">t1 : 24896 : 9</span><br><span class="line">t2 : 23208 : 10</span><br><span class="line">t1 : 24896 : 11</span><br><span class="line">//....</span><br><span class="line">t2 : 23208 : 90</span><br><span class="line">t1 : 24896 : 91</span><br><span class="line">t2 : 23208 : 92</span><br><span class="line">t1 : 24896 : 93</span><br><span class="line">t2 : 23208 : 94</span><br><span class="line">t1 : 24896 : 95</span><br><span class="line">t2 : 23208 : 96</span><br><span class="line">t1 : 24896 : 97</span><br><span class="line">t2 : 23208 : 98</span><br><span class="line">t1 : 24896 : 99</span><br><span class="line">t2 : 23208 : 100</span><br></pre></td></tr></table></figure><p>å³ä¾¿åœ¨t1ä¸­é¢å¤–åŠ ä¸Šä¼‘çœ ï¼Œä¹Ÿä¸ä¼šå½±å“è¾“å‡ºç»“æœçš„å‡†ç¡®æ€§ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63f48c6d2f8ff.png"                      alt="image-20230221171837565"                ></p><p>è¿™ä¾¿æ˜¯æ¡ä»¶å˜é‡å¯¹äºçº¿ç¨‹åŒæ­¥æ§åˆ¶çš„ç”¨æ³•</p><h1 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h1><p>åœ¨å­¦ä¹ è¿‡linuxçš„çº¿ç¨‹åŸºç¡€å’Œç³»ç»Ÿæ¥å£åï¼Œç†è§£C++è¿™é‡Œçš„å¤šçº¿ç¨‹æ“ä½œè¿˜ç®—è½»æ¾ï¼</p><p>C++è¯­æ³•å­¦ä¹ çš„æœ€åä¸€å—æ‹¼å›¾ä¹Ÿè¢«è¡¥ä¸Šäº†ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/202211021535708.jpg"                      alt="QQå›¾ç‰‡20220424132540"                ></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ¬ç¯‡åšå®¢ï¼Œè®©æˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹C++ä¸­çš„çº¿ç¨‹æ“ä½œ&lt;/p&gt;</summary>
    
    
    
    <category term="é‡è§C++" scheme="https://blog.musnow.top/categories/%E9%81%87%E8%A7%81C/"/>
    
    
    <category term="C++" scheme="https://blog.musnow.top/tags/C/"/>
    
    <category term="C++11" scheme="https://blog.musnow.top/tags/C-11/"/>
    
  </entry>
  
  <entry>
    <title>ã€Nasã€‘tmmåˆ®å‰Šå™¨æ— æ³•è¿æ¥tmdbçš„è§£å†³åŠæ³•ï¼ˆæ”¹hostï¼‰</title>
    <link href="https://blog.musnow.top/2023/02/15/nas/9tmm%E5%88%AE%E5%89%8A%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/"/>
    <id>https://blog.musnow.top/2023/02/15/nas/9tmm%E5%88%AE%E5%89%8A%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/</id>
    <published>2023-02-15T13:25:57.000Z</published>
    <updated>2023-03-11T11:25:36.232Z</updated>
    
    <content type="html"><![CDATA[<p>tmmåˆ®å‰Šå™¨æ— æ³•è¿æ¥tmdbçš„è§£å†³åŠæ³•ï¼ˆæ”¹hostï¼‰</p><span id="more"></span><p>å¦‚é¢˜ï¼Œæœ€è¿‘å‘ç°è‡ªå·±windowsç”µè„‘ä¸Šçš„tmmåˆæ— æ³•åˆ®å‰Šäº†ï¼Œæ‰“å¼€ç³»ç»Ÿhostç›®ä¸€çœ‹ï¼Œå‘ç°æ–‡ä»¶è¢«æ¸…ç©ºäº†ï¼Œå¾—è‡ªå·±é‡æ–°å†æä¸€é</p><h1 id="1-æ€è·¯"><a href="#1-æ€è·¯" class="headerlink" title="1.æ€è·¯"></a>1.æ€è·¯</h1><p>æ€è·¯å¾ˆç®€å•ï¼Œå°±æ˜¯æˆ‘ä»¬å½“å‰è®¿é—® <code>api.themoviedb.org</code>çš„åŸŸåï¼Œæ²¡æœ‰åŠæ³•æ‰¾åˆ°ä¸€ä¸ªå›½å†…èƒ½æˆåŠŸè®¿é—®çš„ipã€‚æ‰€ä»¥å°±ä¼šæŠ¥é”™ <code>timeout</code></p><p>ä¿®æ”¹hostçš„ä½œç”¨ï¼Œå°±æ˜¯å‘Šè¯‰ç³»ç»Ÿï¼Œè®¿é—®<code>api.themoviedb.org</code>çš„æ—¶å€™ï¼Œå…ˆåœ¨æœ¬åœ°hostsæ–‡ä»¶é‡Œé¢æœ‰çš„è¿™äº›ä¸»æœºè¯•ä¸€è¯•ï¼Œèƒ½æˆåŠŸå°±ä¸éœ€è¦å»ä¸»åŠ¨æ‰¾hostæœåŠ¡å™¨äº†</p><p>æ‰€ä»¥æˆ‘ä»¬åªè¦å°†å›½å†…èƒ½è®¿é—®çš„ipå†™å…¥hostå°±å¯ä»¥äº†</p><h1 id="2-æ‰¾å¯»å¯ç”¨host"><a href="#2-æ‰¾å¯»å¯ç”¨host" class="headerlink" title="2.æ‰¾å¯»å¯ç”¨host"></a>2.æ‰¾å¯»å¯ç”¨host</h1><p>æœ‰äº†ä¸Šé¢çš„æ€è·¯ï¼Œä¸‹é¢è¦åšçš„å°±æ˜¯çœ‹çœ‹é‚£äº›hostå¯ä»¥è®¿é—®</p><p>é€šè¿‡ <a class="link"   href="https://www.itdog.cn/ping/api.themoviedb.org" >ITDOGç½‘ç«™<i class="fas fa-external-link-alt"></i></a>ï¼Œåœ¨çº¿ping <code>api.themoviedb.org</code>ç«™ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°å¤§éƒ¨åˆ†åœ°åŒºçš„è®¿é—®éƒ½æ˜¯è¶…æ—¶çš„</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ecde92b026b.png"                      alt="image-20230215213018481"                ></p><p>æˆ‘ä»¬è¦åšçš„å°±æ˜¯æ‰¾åˆ°æ²¡æœ‰è¶…æ—¶çš„è¿™äº›ipï¼Œè®°å½•ä¸‹æ¥ã€‚ç‰¹åˆ«æ˜¯é¦™æ¸¯å’Œå°æ¹¾çš„</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ecdee791f45.png"                      alt="image-20230215213225991"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ecdef38a4ed.png"                      alt="image-20230215213238033"                ></p><p>è¦æƒ³çŸ¥é“è¿™äº›ipåœ¨ä½ è¿™ä¸ªåœ°æ–¹èƒ½ä¸èƒ½è®¿é—®ï¼Œé‚£å°±é‡‡ç”¨windowså‘½ä»¤è¡Œè¿›è¡Œpingï¼Œèƒ½è·å–åˆ°ä¿¡æ¯å°±æ˜¯okçš„</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ecdf3e94acd.png"                      alt="image-20230215213353171"                ></p><h1 id="3-æ”¹host"><a href="#3-æ”¹host" class="headerlink" title="3.æ”¹host"></a>3.æ”¹host</h1><p>windowsä¸‹çš„æ–‡ä»¶è·¯å¾„æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\drivers\etc\hosts</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æä¾›å¯ç”¨çš„hostï¼Œå»ºè®®é‡‡ç”¨ä¸Šé¢çš„åŠæ³•è‡ªå·±æ‰¾ä¸€ä¸‹ï¼Œå› ä¸ºipæ˜¯ä¼šå˜åŠ¨çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">13.224.161.52 api.themoviedb.org</span><br><span class="line">99.84.192.81 api.themoviedb.org</span><br><span class="line">13.33.33.60 api.themoviedb.org</span><br><span class="line">13.224.167.74 api.themoviedb.org</span><br><span class="line">13.35.166.20 api.themoviedb.org</span><br><span class="line">202.182.98.125 api.themoviedb.org</span><br><span class="line">13.224.205.59 api.themoviedb.org</span><br><span class="line">54.230.184.46 api.themoviedb.org</span><br><span class="line">31.13.67.19 api.themoviedb.org</span><br><span class="line">99.84.224.92 api.themoviedb.org</span><br><span class="line">99.84.224.149 api.themoviedb.org</span><br><span class="line">99.86.149.118 api.themoviedb.org</span><br><span class="line">65.9.83.54 api.themoviedb.org</span><br><span class="line">99.86.149.118 api.themoviedb.org</span><br><span class="line">13.224.163.98 api.themoviedb.org</span><br></pre></td></tr></table></figure><p>æ·»åŠ å®Œæ¯•åï¼Œä»¥ç®¡ç†å‘˜èº«ä»½ä¿å­˜æ–‡ä»¶ï¼ˆå¦åˆ™æƒé™ä¸è¶³æ— æ³•å†™å…¥ï¼‰</p><p>ç°åœ¨åº”è¯¥å°±å¯ä»¥äº†</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;tmmåˆ®å‰Šå™¨æ— æ³•è¿æ¥tmdbçš„è§£å†³åŠæ³•ï¼ˆæ”¹hostï¼‰&lt;/p&gt;</summary>
    
    
    
    <category term="æ£é¼“æŠ˜è…¾nas" scheme="https://blog.musnow.top/categories/%E6%8D%A3%E9%BC%93%E6%8A%98%E8%85%BEnas/"/>
    
    
    <category term="nas" scheme="https://blog.musnow.top/tags/nas/"/>
    
  </entry>
  
  <entry>
    <title>ã€ç½‘ç»œã€‘http(s)åè®® | content-lengthè¯¦è§£</title>
    <link href="https://blog.musnow.top/2023/02/15/Linux/35http%E4%B8%ADcontent-length/"/>
    <id>https://blog.musnow.top/2023/02/15/Linux/35http%E4%B8%ADcontent-length/</id>
    <published>2023-02-15T04:30:55.000Z</published>
    <updated>2023-02-15T11:28:13.686Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡é€šè¿‡ä¸€ä¸ªçº¿ä¸Šå®ä¾‹ï¼Œè¯¦ç»†ä»‹ç»httpåè®®ä¸­çš„content-lengthå­—æ®µã€‚</p><span id="more"></span><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>httpåè®®æ˜¯äº’è”ç½‘ä¸­æœ€é‡è¦çš„åè®®ä¹‹ä¸€ï¼Œè™½ç„¶çœ‹ä¸Šå»å¾ˆç®€å•ï¼Œä½†æ˜¯å®é™…ä¸­ç»å¸¸é‡åˆ°é—®é¢˜ï¼Œæˆ‘ä»¬å°±å·²ç»é‡åˆ°å¥½å‡ æ¬¡äº†ã€‚æœ‰é•¿è¿æ¥ç›¸å…³çš„ï¼Œæœ‰æŠ¥æ–‡è§£æç›¸å…³çš„ã€‚å¯¹httpåè®®ä¸èƒ½ä¸€çŸ¥åŠè§£ï¼Œå¿…é¡»é€å½»ç†è§£æ‰è¡Œã€‚</p><p>æœ¬æ–‡é€šè¿‡ä¸€ä¸ªçº¿ä¸Šå®ä¾‹ï¼Œè¯¦ç»†ä»‹ç»httpåè®®ä¸­çš„content-lengthå­—æ®µã€‚</p><h1 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h1><p>æˆ‘ä»¬çš„æ‰‹æœºAppåœ¨åšæ›´æ–°æ—¶ä¼šä»æœåŠ¡å™¨ä¸Šä¸‹è½½çš„ä¸€äº›èµ„æºï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸€äº›å°æ–‡ä»¶ï¼Œæ›´æ–°çš„ä»£ç å·®ä¸å¤šæ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://172.16.59.129:8000/update/test.so&quot;</span>);</span><br><span class="line">    <span class="type">HttpURLConnection</span> <span class="variable">conn</span> <span class="operator">=</span> (HttpURLConnection) url.openConnection();</span><br><span class="line">    <span class="keyword">if</span>(conn.getResponseCode() == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">totalLength</span> <span class="operator">=</span> conn.getContentLength();</span><br><span class="line"><span class="type">BufferedInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(conn.getInputStream());</span><br><span class="line"><span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">512</span>];</span><br><span class="line"><span class="type">int</span> <span class="variable">readLength</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>((length=in.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">readLength += length;</span><br><span class="line"><span class="comment">//è¿›åº¦æ¡</span></span><br><span class="line">System.out.println(((<span class="type">float</span>)readLength) /((<span class="type">float</span>)(totalLength)));</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ä¸Šé¢çš„ä»£ç æ›´æ–°ä¸€ä¸ªsoæ–‡ä»¶ï¼Œå…ˆé€šè¿‡content-lengthè·å–æ–‡ä»¶çš„æ€»å¤§å°ï¼Œç„¶åè¯»Streamï¼Œæ¯è¯»ä¸€æ®µï¼Œå°±è®¡ç®—å‡ºå½“å‰è¯»çš„æ€»å¤§å°ï¼Œé™¤ä»¥content-lengthï¼Œç”¨æ¥æ˜¾ç¤ºè¿›åº¦æ¡ã€‚</p><p>ç»“æœweblogicä»10å‡çº§åˆ°12åï¼Œcontent-lengthä¸€ç›´è¿”å›-1ï¼Œè¿™æ ·å°±ä¸èƒ½æ˜¾ç¤ºè¿›åº¦æ¡äº†ï¼Œä½†æ˜¯æ–‡ä»¶æµè¿˜èƒ½æ­£å¸¸è¯»ã€‚æŠŠweblogicé‡å¯äº†ï¼Œä¸€å¼€å§‹è¿˜èƒ½è¿”å›content-lengthï¼Œä¸€ä¼šåˆæ˜¯-1äº†ã€‚</p><h1 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h1><p>Httpåè®®çš„è¯·æ±‚æŠ¥æ–‡å’Œå›å¤æŠ¥æ–‡éƒ½æœ‰headerå’Œbodyï¼Œbodyå°±æ˜¯ä½ è¦è·å–çš„èµ„æºï¼Œä¾‹å¦‚ä¸€ä¸ªhtmlé¡µé¢ï¼Œä¸€ä¸ªjpegå›¾ç‰‡ï¼Œè€Œheaderæ˜¯ç”¨æ¥åšæŸäº›çº¦å®šçš„ã€‚ä¾‹å¦‚å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å•†å®šä¸€äº›ä¼ è¾“æ ¼å¼ï¼Œå®¢æˆ·ç«¯å…ˆè·å–å¤´éƒ¨ï¼Œå¾—çŸ¥ä¸€äº›æ ¼å¼ä¿¡æ¯ï¼Œç„¶åæ‰å¼€å§‹è¯»å–bodyã€‚</p><blockquote><p>å®¢æˆ·ç«¯ï¼š Accept-Encoding:gzip ï¼ˆç»™æˆ‘å‹ç¼©ä¸€ä¸‹ï¼Œæˆ‘ç”¨çš„æ˜¯æµé‡ï¼Œå…ˆä¸‹è½½ä¸‹æ¥æˆ‘å†æ…¢æ…¢è§£å‹å§ï¼‰</p><p>æœåŠ¡ç«¯1ï¼šContent-Encoding:null(æ²¡æœ‰Content-Encodingå¤´ã€‚ æˆ‘ä¸ç»™å‹ç¼©ï¼ŒCPUæ²¡ç©ºï¼Œä½ çˆ±è¦ä¸è¦ï¼‰</p><p>æœåŠ¡ç«¯2ï¼šContent-Encoding:gzip (ç»™ä½ èŠ‚çœæµé‡ï¼Œå‹ç¼©ä¸€ä¸‹ï¼‰</p></blockquote><blockquote><p>å®¢æˆ·ç«¯ï¼šConnection: keep-alive (å¤§å“¥ï¼Œå’±å¥½ä¸å®¹æ˜“å»ºäº†ä¸ªTCPè¿æ¥ï¼Œä¸‹æ¬¡æ¥ç€ç”¨ï¼‰</p><p>æœåŠ¡ç«¯1: Connection: keep-alive ï¼ˆéƒ½ä¸å®¹æ˜“ï¼Œæ¥ç€ç”¨ï¼‰</p><p>æœåŠ¡ç«¯2: Connection: close (è°è·Ÿä½ æ¥ç€ç”¨ï¼Œæˆ‘ä»¬è¿™ä¸ªTCPæ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä¸‹æ¬¡å†æ‰¾æˆ‘è¿˜å¾—é‡æ–°è¿)</p></blockquote><p>httpåè®®æ²¡æœ‰ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¸€èˆ¬å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯è¯·æ±‚èµ„æºæ—¶ï¼Œä»¥æœåŠ¡ç«¯ä¸ºå‡†ã€‚è¿˜æœ‰ä¸€äº›headerå¹¶æ²¡æœ‰åå•†çš„è¿‡ç¨‹ï¼Œè€Œæ˜¯æœåŠ¡ç«¯ç›´æ¥å‘Šè¯‰å®¢æˆ·ç«¯æŒ‰ä»€ä¹ˆæ¥ã€‚ä¾‹å¦‚ä¸Šè¿°çš„Content-Lengthï¼Œæ˜¯æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯bodyçš„å¤§å°æœ‰å¤šå¤§ã€‚ä½†æ˜¯ï¼æœåŠ¡ç«¯å¹¶ä¸ä¸€å®šèƒ½å‡†ç¡®çš„æå‰å‘Šè¯‰ä½ bodyæœ‰å¤šå¤§ã€‚æœåŠ¡ç«¯è¦å…ˆå†™headerï¼Œå†å†™bodyï¼Œå¦‚æœè¦åœ¨headeré‡ŒæŠŠbodyå¤§å°å†™è¿›å»ï¼Œå°±å¾—æå‰çŸ¥é“bodyå¤§å°ã€‚å¦‚æœè¿™ä¸ªbodyæ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼ŒæœåŠ¡ç«¯å…ˆç”Ÿæˆå®Œï¼Œå†å¼€å§‹å†™headerï¼Œè¿™æ ·éœ€è¦å¾ˆå¤šé¢å¤–çš„å¼€é”€ï¼Œæ‰€ä»¥headeré‡Œä¸ä¸€å®šæœ‰content-lengthã€‚</p><p>é‚£å®¢æˆ·ç«¯æ€ä¹ˆçŸ¥é“bodyçš„å¤§å°å‘¢ï¼ŸæœåŠ¡å™¨æœ‰ä¸‰ç§æ–¹å¼å‘Šè¯‰ä½ ã€‚</p><p>1.æœåŠ¡å™¨å·²ç»çŸ¥é“èµ„æºå¤§å°ï¼Œé€šè¿‡content-lengthè¿™ä¸ªheaderå‘Šè¯‰ä½ ã€‚</p><pre><code>Content-Length:1076(bodyçš„å¤§å°æ˜¯1076Bï¼Œä½ è¯»å–1076Bå°±å¯ä»¥å®Œæˆä»»åŠ¡äº†ï¼‰Transfer-Encoding: null</code></pre><p>2.æœåŠ¡å™¨æ²¡æ³•æå‰çŸ¥é“èµ„æºçš„å¤§å°ï¼Œæˆ–è€…ä¸æ„¿æ„èŠ±è´¹èµ„æºæå‰è®¡ç®—èµ„æºå¤§å°ï¼Œå°±ä¼šæŠŠhttpå›å¤æŠ¥æ–‡ä¸­åŠ ä¸€ä¸ªheaderå«Transfer-Encoding:chunkedï¼Œå°±æ˜¯åˆ†å—ä¼ è¾“çš„æ„æ€ã€‚æ¯ä¸€å—éƒ½ä½¿ç”¨å›ºå®šçš„æ ¼å¼ï¼Œå‰è¾¹æ˜¯å—çš„å¤§å°ï¼Œåé¢æ˜¯æ•°æ®ï¼Œç„¶åæœ€åä¸€å—å¤§å°æ˜¯0ã€‚è¿™æ ·å®¢æˆ·ç«¯è§£æçš„æ—¶å€™å°±éœ€è¦æ³¨æ„å»æ‰ä¸€äº›æ— ç”¨çš„å­—æ®µã€‚</p><pre><code>Content-Length:nullTransfer-Encoding:chunked (æ¥ä¸‹æ¥çš„bodyæˆ‘è¦ä¸€å—ä¸€å—çš„ä¼ ï¼Œæ¯ä¸€å—å¼€å§‹æ˜¯è¿™ä¸€å—çš„å¤§å°ï¼Œç­‰æˆ‘ä¼ åˆ°å¤§å°ä¸º0çš„å—æ—¶ï¼Œå°±æ²¡äº†ï¼‰</code></pre><p>3.æœåŠ¡å™¨ä¸çŸ¥é“èµ„æºçš„å¤§å°ï¼ŒåŒæ—¶ä¹Ÿä¸æ”¯æŒchunkedçš„ä¼ è¾“æ¨¡å¼ï¼Œé‚£ä¹ˆå°±æ—¢æ²¡æœ‰content-lengthå¤´ï¼Œä¹Ÿæ²¡æœ‰transfer-encodingå¤´ï¼Œè¿™ç§æƒ…å†µä¸‹å¿…é¡»ä½¿ç”¨çŸ­è¿æ¥ï¼Œä»¥è¿æ¥ç»“æŸæ¥æ ‡ç¤ºæ•°æ®ä¼ è¾“ç»“æŸï¼Œä¼ è¾“ç»“æŸå°±èƒ½çŸ¥é“å¤§å°äº†ã€‚è¿™æ—¶å€™æœåŠ¡å™¨è¿”å›çš„headeré‡ŒConnectionä¸€å®šæ˜¯closeã€‚</p><pre><code>Content-Length:null Transfer-Encoding:null Connection:close(æˆ‘ä¸çŸ¥é“å¤§å°ï¼Œæˆ‘ä¹Ÿç”¨ä¸äº†chunkedï¼Œå•¥æ—¶å€™æˆ‘å…³äº†tcpè¿æ¥ï¼Œå°±è¯´æ˜ä¼ è¾“ç»“æŸäº†ï¼‰</code></pre><h1 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h1><p>æˆ‘é€šè¿‡nginxåœ¨è™šæ‹Ÿæœºé‡Œåšå®éªŒï¼Œé»˜è®¤nginxæ˜¯æ”¯æŒchunkedæ¨¡å¼çš„ï¼Œå¯ä»¥å…³æ‰ã€‚</p><p>ä½¿ç”¨çš„ä»£ç å¦‚ä¸‹ï¼Œå¯èƒ½ä¼šè°ƒæ•´å‚æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://172.16.59.129:8000/update/test.so&quot;</span>);</span><br><span class="line">    <span class="type">HttpURLConnection</span> <span class="variable">conn</span> <span class="operator">=</span> (HttpURLConnection) url.openConnection();</span><br><span class="line">    <span class="comment">//conn.setRequestProperty(&quot;Accept-Encoding&quot;, &quot;gzip&quot;);</span></span><br><span class="line">    <span class="comment">//conn.setRequestProperty(&quot;Connection&quot;, &quot;keep-alive&quot;);</span></span><br><span class="line">    conn.connect();</span><br><span class="line">    <span class="keyword">if</span>(conn.getResponseCode() == <span class="number">200</span>) &#123;</span><br><span class="line">        System.out.println(conn.getHeaderFields().keySet());</span><br><span class="line">        System.out.println(conn.getHeaderField(<span class="string">&quot;transfer-encoding&quot;</span>));</span><br><span class="line">        System.out.println(conn.getHeaderField(<span class="string">&quot;Content-Length&quot;</span>));</span><br><span class="line">        System.out.println(conn.getHeaderField(<span class="string">&quot;Content-Encoding&quot;</span>));</span><br><span class="line">        System.out.println(conn.getHeaderField(<span class="string">&quot;Connection&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1-nginxåœ¨å¼€å¯chunked-transfer-encodingçš„æ—¶å€™"><a href="#1-nginxåœ¨å¼€å¯chunked-transfer-encodingçš„æ—¶å€™" class="headerlink" title="1.nginxåœ¨å¼€å¯chunked_transfer_encodingçš„æ—¶å€™"></a>1.nginxåœ¨å¼€å¯chunked_transfer_encodingçš„æ—¶å€™</h2><p>(1) åœ¨reqeust headeré‡Œä¸ä½¿ç”¨gzipï¼Œä¹Ÿå°±æ˜¯ä¸åŠ <code>accept-encoding: gzip</code></p><table><thead><tr><th>test.soæ–‡ä»¶å¤§å°</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>100B</td><td>èƒ½æ­£å¸¸è¿”å›content-length,æ²¡æœ‰transfer-encodingå¤´</td></tr><tr><td>69M</td><td>èƒ½æ­£å¸¸è¿”å›content-length,æ²¡æœ‰transfer-encodingå¤´</td></tr><tr><td>3072M</td><td>èƒ½æ­£å¸¸è¿”å›content-length,æ²¡æœ‰transfer-encodingå¤´</td></tr></tbody></table><p>å¯ä»¥å‘ç°nginxä¸ç®¡èµ„æºå¤šå¤§ï¼Œå¦‚æœå®¢æˆ·ç«¯ä¸æ¥å—gzipçš„å‹ç¼©æ ¼å¼ï¼Œå°±ä¸ä¼šä½¿ç”¨chunkedæ¨¡å¼ï¼Œè€Œä¸”è·Ÿæ˜¯å¦ä½¿ç”¨çŸ­è¿æ¥æ²¡å…³ç³»ã€‚</p><p>(2)åœ¨request headeré‡ŒåŠ å…¥gzipï¼Œ<code>accepting-encoding: gzip</code></p><table><thead><tr><th>test.soæ–‡ä»¶å¤§å°</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>100B</td><td>æ²¡æœ‰content-length,transfer-encoding&#x3D;trunked</td></tr><tr><td>69M</td><td>æ²¡æœ‰content-length,transfer-encoding&#x3D;trunked</td></tr><tr><td>3072M</td><td>æ²¡æœ‰content-length,transfer-encoding&#x3D;trunked</td></tr></tbody></table><p>å¯ä»¥çœ‹åˆ°nginxåœ¨å¼€å¯<code>chunked_transfer_encoding</code>ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯æ¥å—gzipçš„æ—¶å€™ï¼Œä¼šä½¿ç”¨chunkedæ¨¡å¼ï¼Œnginxå¼€å¯gzipåä¸ä¼šè®¡ç®—èµ„æºçš„å¤§å°ï¼Œç›´æ¥ç”¨chunkedæ¨¡å¼ã€‚</p><h2 id="2-nginxå…³é—­chunked-transfer-encoding"><a href="#2-nginxå…³é—­chunked-transfer-encoding" class="headerlink" title="2.nginxå…³é—­chunked_transfer_encoding"></a>2.nginxå…³é—­chunked_transfer_encoding</h2><p>(1) åœ¨reqeust headeré‡Œä¸ä½¿ç”¨gzipï¼Œä¹Ÿå°±æ˜¯ä¸åŠ <code>accept-encoding:gzip</code></p><table><thead><tr><th>test.soæ–‡ä»¶å¤§å°</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>100B</td><td>èƒ½æ­£å¸¸è¿”å›content-length,æ²¡æœ‰transfer-encodingå¤´</td></tr><tr><td>69M</td><td>èƒ½æ­£å¸¸è¿”å›content-length,æ²¡æœ‰transfer-encodingå¤´</td></tr><tr><td>3072M</td><td>èƒ½æ­£å¸¸è¿”å›content-length,æ²¡æœ‰transfer-encodingå¤´</td></tr></tbody></table><p>å› ä¸ºèƒ½å¾ˆå®¹æ˜“çš„çŸ¥é“æ–‡ä»¶å¤§å°ï¼Œæ‰€ä»¥nginxè¿˜æ˜¯èƒ½è¿”å›content-lengthã€‚</p><p>(2)åœ¨request headeré‡ŒåŠ å…¥gzipï¼Œ<code>accepting-encoding:gzip</code></p><table><thead><tr><th>test.soæ–‡ä»¶å¤§å°</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>100B</td><td>æ²¡æœ‰content-lengthå’Œtransfer-encodingå¤´ï¼Œä¸è®ºå®¢æˆ·ç«¯connectionä¸ºkeep-aliveè¿˜æ˜¯closeï¼ŒæœåŠ¡ç«¯è¿”å›çš„connectionå¤´éƒ½æ˜¯close</td></tr><tr><td>69M</td><td>æ²¡æœ‰content-lengthå’Œtransfer-encodingå¤´ï¼Œä¸è®ºå®¢æˆ·ç«¯connectionä¸ºkeep-aliveè¿˜æ˜¯closeï¼ŒæœåŠ¡ç«¯è¿”å›çš„connectionå¤´éƒ½æ˜¯close</td></tr><tr><td>3072M</td><td>æ²¡æœ‰content-lengthå’Œtransfer-encodingå¤´ï¼Œä¸è®ºå®¢æˆ·ç«¯connectionä¸ºkeep-aliveè¿˜æ˜¯closeï¼ŒæœåŠ¡ç«¯è¿”å›çš„connectionå¤´éƒ½æ˜¯close</td></tr></tbody></table><p>è¿™å°±æ˜¯ä¸Šé¢è¯´çš„ç¬¬ä¸‰ç§æƒ…å†µï¼Œä¸çŸ¥é“å¤§å°ï¼Œä¹Ÿä¸æ”¯æŒtrunkedï¼Œé‚£å°±å¿…é¡»ä½¿ç”¨çŸ­è¿æ¥æ¥æ ‡ç¤ºç»“æŸã€‚</p><h1 id="é—®é¢˜è§£å†³æ–¹æ¡ˆ"><a href="#é—®é¢˜è§£å†³æ–¹æ¡ˆ" class="headerlink" title="é—®é¢˜è§£å†³æ–¹æ¡ˆ"></a>é—®é¢˜è§£å†³æ–¹æ¡ˆ</h1><p>å’¨è¯¢äº†ä¸­é—´ä»¶ç»„çš„åŒäº‹ï¼Œä»¥å‰ä¹Ÿé‡åˆ°ç±»ä¼¼çš„é—®é¢˜ï¼Œå› ä¸ºå‡çº§äº†Weblogicå¯¼è‡´å®¢æˆ·ç«¯è§£æXMLå‡ºé”™ï¼Œå› ä¸ºä½¿ç”¨äº†chunkedæ¨¡å¼ï¼Œä¸­é—´æœ‰ä¸€äº›æ ¼å¼åŒ–çš„å­—ç¬¦ï¼Œè€Œå®¢æˆ·ç«¯è§£æçš„ä»£ç å¹¶æ²¡æœ‰è€ƒè™‘chunkedæ¨¡å¼çš„è§£æï¼Œå¯¼è‡´è§£æå‡ºé”™ã€‚</p><p>å› ä¸ºæˆ‘ä»¬å®¢æˆ·ç«¯å¿…é¡»ç”¨content-lengthå±•ç¤ºè¿›åº¦ï¼Œå› æ­¤ä¸èƒ½ç”¨chunkedæ¨¡å¼ï¼ŒWeblogicå¯ä»¥æŠŠchunkedæ¨¡å¼å…³é—­ã€‚ç”¨ä¸‹é¢çš„æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!java weblogic.WLST </span><br><span class="line"><span class="title function_">connect</span><span class="params">(<span class="string">&#x27;usernameâ€™,&#x27;</span>password<span class="string">&#x27;, &#x27;</span>t3://localhost:<span class="number">7001</span><span class="string">&#x27;)</span></span></span><br><span class="line"><span class="string"><span class="params">edit()</span></span></span><br><span class="line"><span class="string"><span class="params">startEdit()</span></span></span><br><span class="line"><span class="string"><span class="params">cd(&quot;Servers/AdminServer/WebServer/AdminServer&quot;)</span></span></span><br><span class="line"><span class="string"><span class="params">cmo.setChunkedTransferDisabled(true)</span></span></span><br><span class="line"><span class="string"><span class="params">save()</span></span></span><br><span class="line"><span class="string"><span class="params">activate()</span></span></span><br><span class="line"><span class="string"><span class="params">exit()</span></span></span><br></pre></td></tr></table></figure><p>æ”¹äº†ä¹‹åï¼Œç¡®å®ä¸è¿”å›chunkedäº†ï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰content-lengthï¼Œå› ä¸ºWeblogicå°±æ˜¯ä¸æå‰è·å–æ–‡ä»¶å¤§å°ï¼Œè€Œæ˜¯å¼ºåˆ¶åŠ äº†<code>connection:close</code>ï¼Œä¹Ÿå°±æ˜¯å‰è¾¹è¯´çš„ç¬¬ä¸‰ç§ï¼Œé€šè¿‡è¿æ¥ç»“æŸæ ‡è¯†æ•°æ®ç»“æŸã€‚æœ€ååªèƒ½æŠŠè¿™äº›èµ„æºæ”¾å€’apacheé‡Œäº†ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä¸€ä¸ªå¥½çš„httpå®¢æˆ·ç«¯ï¼Œå¿…é¡»å……åˆ†å®ç°åè®®ï¼Œä¸ç„¶å°±å¯èƒ½å‡ºé—®é¢˜ï¼Œæµè§ˆå™¨å¯¹äºæœåŠ¡ç«¯å¯èƒ½äº§ç”Ÿçš„å„ç§æƒ…å†µéƒ½å¾ˆå¥½çš„åšäº†å¤„ç†ï¼Œä½†æ˜¯è‡ªå·±å®ç°httpåè®®çš„è§£ææ—¶ä¸€å®šå¾—æ³¨æ„è€ƒè™‘å¤šç§æƒ…å†µã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ–‡ç« ä½œè€…ï¼šç‰›ç«‹æ–°</span><br><span class="line">åŸæ–‡é“¾æ¥ï¼šhttps://www.cnblogs.com/nxlhero/p/11670942.html</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ¬æ–‡é€šè¿‡ä¸€ä¸ªçº¿ä¸Šå®ä¾‹ï¼Œè¯¦ç»†ä»‹ç»httpåè®®ä¸­çš„content-lengthå­—æ®µã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="ç½‘ç»œ" scheme="https://blog.musnow.top/tags/%E7%BD%91%E7%BB%9C/"/>
    
    <category term="nginx" scheme="https://blog.musnow.top/tags/nginx/"/>
    
    <category term="http" scheme="https://blog.musnow.top/tags/http/"/>
    
  </entry>
  
  <entry>
    <title>ã€ç½‘ç»œã€‘http(s)åè®® | ä»‹ç»</title>
    <link href="https://blog.musnow.top/2023/02/15/Linux/34http%E5%8D%8F%E8%AE%AE/"/>
    <id>https://blog.musnow.top/2023/02/15/Linux/34http%E5%8D%8F%E8%AE%AE/</id>
    <published>2023-02-15T03:30:55.000Z</published>
    <updated>2023-03-11T11:25:36.239Z</updated>
    
    <content type="html"><![CDATA[<p>å·²ç»å­¦ä¹ è¿‡è‡ªå·±å®šåˆ¶ä¸€ä¸ªåè®®äº†ï¼Œç°åœ¨å°±æ¥çœ‹çœ‹å½“ä¸‹å¹¿æ³›ä½¿ç”¨çš„httpåè®®å§</p><span id="more"></span><h1 id="1-ä»‹ç»"><a href="#1-ä»‹ç»" class="headerlink" title="1.ä»‹ç»"></a>1.ä»‹ç»</h1><blockquote><p>è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHyper Text Transfer Protocolï¼ŒHTTPï¼‰æ˜¯ä¸€ä¸ªç®€å•çš„è¯·æ±‚-å“åº”åè®®ï¼Œå®ƒé€šå¸¸è¿è¡Œåœ¨TCPä¹‹ä¸Šã€‚å®ƒæŒ‡å®šäº†å®¢æˆ·ç«¯å¯èƒ½å‘é€ç»™æœåŠ¡å™¨ä»€ä¹ˆæ ·çš„æ¶ˆæ¯ä»¥åŠå¾—åˆ°ä»€ä¹ˆæ ·çš„å“åº”ã€‚</p></blockquote><p>httpå’Œhttpsæ˜¯å½“ä¸‹æœ€é€šç”¨çš„åè®®ä¹‹ä¸€ï¼Œæˆ‘ä»¬è®¿é—®çš„å¤§éƒ¨åˆ†ç½‘é¡µç”¨çš„éƒ½æ˜¯è¿™ä¸ªåè®®ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.bilibili.com/</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªåè®®ä¸»è¦çš„å·®åˆ«ï¼Œé‚£å°±æ˜¯httpæ˜¯ç”¨æ˜æ–‡ä¼ è¾“æ•°æ®çš„ï¼Œæˆ‘ä»¬çš„æ•°æ®åœ¨äº’è”ç½‘è£¸å¥”ï¼Œå¯èƒ½æœ‰å®‰å…¨é—®é¢˜ï¼›ç›¸æ¯”ä¹‹ä¸‹ï¼Œhttpsä¼ è¾“æ•°æ®çš„è¿‡ç¨‹ä¼šå¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œä½†è¿™ä¹Ÿä¸ä»£è¡¨httpsæ˜¯å®Œå…¨å®‰å…¨çš„ã€‚</p><h2 id="1-1-url"><a href="#1-1-url" class="headerlink" title="1.1 url"></a>1.1 url</h2><p>è¦è®¤è¯†è¿™ä¸¤ä¸ªåè®®ï¼Œæˆ‘ä»¬è¦ä»urlçš„è®¤è¯†å¼€å§‹ï¼›</p><p><code>HTTP(S)</code> ä¸å…è®¸ä½¿ç”¨ç”¨æˆ·åæˆ–å¯†ç ï¼Œä¸€ä¸ªåˆæ³•çš„ <code>HTTP(S)</code> URL æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http(s)://&lt;host&gt;:&lt;port&gt;/&lt;path&gt;?&lt;query&gt;#&lt;frag&gt;</span><br></pre></td></tr></table></figure><ul><li>å¼€å¤´ä¸ºåè®®åï¼šhttp æˆ– https åè®®ï¼› </li><li><code>&lt;host&gt;</code>ï¼šä¸»æœºåã€‚ä¸€ä¸ª URL ä¸­ï¼Œæ—¢å¯ä»¥ä½¿ç”¨åŸŸåä¹Ÿå¯ä»¥ä½¿ç”¨ IP è¡¨ç¤ºä¸»æœºåœ°å€</li><li><code>&lt;port&gt;</code>ï¼šç«¯å£ã€‚ä¸»æœºåå’Œç«¯å£ä¹‹é—´ä½¿ç”¨å†’å·åˆ†éš”ã€‚ç«¯å£æ˜¯å¯é€‰çš„ï¼Œå¦‚æœçœç•¥å°†é‡‡ç”¨é»˜è®¤ç«¯å£ï¼Œhttp é»˜è®¤ç«¯å£æ˜¯ 80ï¼Œhttps é»˜è®¤ç«¯å£ 443ï¼›</li><li><code>&lt;path&gt;</code>ï¼šèµ„æºè·¯å¾„ã€‚èµ„æºåœ¨ç½‘ç»œä¸»æœºä¸Šçš„è·¯å¾„ï¼Œè·¯å¾„ä¹Ÿæ˜¯å¯é€‰çš„ï¼Œç¼ºçœè®¿é—®é»˜è®¤èµ„æºï¼› </li><li><code>&lt;query&gt;</code>ï¼šæŸ¥è¯¢å‚æ•°ã€‚æ ¼å¼ä¸º key&#x3D;valueï¼Œå¤šä¸ªå‚æ•°ä½¿ç”¨ &amp; åˆ†éš”ï¼›å‚æ•°ä¹Ÿæ˜¯å¯é€‰çš„ï¼› </li><li><code>&lt;frag&gt;</code>ï¼šç‰‡æ®µã€‚ä» # å¼€å§‹åˆ°æœ€åï¼Œä¸€èˆ¬ç”¨äºå®šä½åˆ°èµ„æºå†…çš„ä¸€ä¸ªç‰‡æ®µï¼Œæ¯”å¦‚æ–‡æ¡£çš„ä¸€ä¸ªç« èŠ‚ï¼›ç‰‡æ®µä¹Ÿæ˜¯å¯é€‰çš„ã€‚</li></ul><h3 id="1-1-1-æ —å­-â‘ "><a href="#1-1-1-æ —å­-â‘ " class="headerlink" title="1.1.1 æ —å­ â‘ "></a>1.1.1 æ —å­ â‘ </h3><p>æ¥ä¸‹æ¥ä¸¾ä¸€ä¸ªå…·ä½“çš„ä¾‹å­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.musnow.top/2022/08/07/note_linux/6gdb_g++_make_vim/#4-make-x2F-makefile</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šæ˜¯æˆ‘çš„ä¸ªäººåšå®¢ä¸­çš„ä¸€ç¯‡æ–‡ç« </p><ul><li>åè®®æ˜¯https</li><li>åŸŸåæ˜¯<code>blog.musnow.top</code>ï¼Œå¯¹åº”çš„å°±æ˜¯<code>&lt;host&gt;:&lt;port&gt;</code>ï¼›è¿™é‡Œéšè—äº†ç«¯å£ï¼Œä¼šåœ¨ä¸‹é¢è¯´æ˜ã€‚</li><li><code>/2022/08/07/note_linux/6gdb_g++_make_vim/</code>è¿™ä¸€é•¿ä¸²éƒ½æ˜¯æ–‡ä»¶çš„è·¯å¾„ï¼Œå…¶æ ‡ç¤ºäº†æ–‡ä»¶åœ¨æœåŠ¡å™¨ä¸Šå­˜æ”¾çš„ä½ç½®</li><li>è¿™ä¸ªurlå†…æ²¡æœ‰å¸¦<code>&lt;query&gt;</code>å‚æ•°</li><li><code>#4-make-x2F-makefile</code>å¯¹åº”çš„æ˜¯<code>&lt;frag&gt;</code>ç‰‡æ®µï¼Œæ ‡è¯†äº†æˆ‘å½“å‰æµè§ˆçš„ä½ç½®</li></ul><p>å½“ä½ æŠŠè¿™ä¸ªurlç²˜è´´é“æµè§ˆå™¨ï¼Œå…¶ä¼šç›´æ¥è·³è½¬åˆ°å¯¹åº”çš„æ ‡é¢˜ä½ç½®ï¼Œè€Œä¸æ˜¯è¿™ç¯‡æ–‡ç« çš„é¡µé¦–ï¼›è¿™å°±æ˜¯<code>&lt;frag&gt;</code>ç‰‡æ®µçš„ä½œç”¨</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ec475e3c6a2.png"                      alt="image-20230215104544655"                ></p><h3 id="1-1-2-æ —å­-â‘¡"><a href="#1-1-2-æ —å­-â‘¡" class="headerlink" title="1.1.2 æ —å­ â‘¡"></a>1.1.2 æ —å­ â‘¡</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.baidu.com/s?tn=68018901_39_oem_dg&amp;ie=utf-8&amp;word=test</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬åœ¨ç™¾åº¦æœç´¢å•è¯<code>test</code>çš„æ—¶å€™ï¼Œç™¾åº¦çš„urlä¸­å°±ä¼šå‡ºç°<code>&lt;query&gt;</code>å‚æ•°ï¼›</p><p>å…¶ä¸­<code>?</code>æ˜¯å‚æ•°çš„å¼€å¤´ï¼Œåç»­çš„ä¸€ä¸²ä»¥<code>&amp;</code>åˆ†éš”çš„kvé”®å€¼å¯¹ï¼Œå°±æ˜¯å‚æ•°çš„å†…å®¹ã€‚åœ¨è¿™é‡Œé¢æˆ‘ä»¬èƒ½çœ‹åˆ°<code>word=test</code>ï¼Œæˆ‘ä»¬æŸ¥è¯¢çš„å•è¯testå°±åœ¨è¿™ä¸ªå‚æ•°åï¼›</p><p>æˆ‘ä»¬çš„æœç´¢è®¿é—®ï¼Œå°±æ˜¯å°†è¿™äº›å‚æ•°ä¼ é€ç»™æœåŠ¡å™¨ï¼Œå†ç”±ç™¾åº¦çš„æœåŠ¡å™¨è¿”å›æœç´ ç»“æœçš„ã€‚</p><h2 id="1-2-åŸŸåå’Œç«¯å£éšè—"><a href="#1-2-åŸŸåå’Œç«¯å£éšè—" class="headerlink" title="1.2 åŸŸåå’Œç«¯å£éšè—"></a>1.2 åŸŸåå’Œç«¯å£éšè—</h2><p>ä½†æˆ‘ä»¬æ—¥å¸¸è®¿é—®çš„ç½‘é¡µä¸­ï¼Œå¾ˆå°‘è§åˆ°è¿‡<code>ip:ç«¯å£</code>çš„å½¢å¼ï¼Œè€Œå¤§å¤šæ˜¯ç”¨åŸŸåä¸ºæˆ‘ä»¬æä¾›æœåŠ¡çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.bilibili.com/</span><br></pre></td></tr></table></figure><p>è¿™å¹¶ä¸ä»£è¡¨å…¶èƒŒåä¸éœ€è¦ç«¯å£å·ã€‚è€Œæ˜¯å› ä¸ºå¦‚æœæˆ‘ä»¬çš„è®¿é—®<strong>ä¸æŒ‡å®šç«¯å£</strong>çš„æ—¶å€™ï¼Œhttp(s)åè®®ä¼šé‡‡ç”¨é»˜è®¤ç«¯å£å·80æˆ–443ï¼Œä»è€Œå®ç°éšè—ç«¯å£å·æä¾›æœåŠ¡</p><blockquote><p>http é»˜è®¤ç«¯å£æ˜¯ 80ï¼Œhttps é»˜è®¤ç«¯å£ 443</p></blockquote><p>æ¯•ç«Ÿå¯¹äºç”¨æˆ·è€Œè¨€ï¼Œè®°ä½ä¸€ä¸ªåŸŸåå·²ç»ä¸å®¹æ˜“äº†ï¼Œè¿˜è¦è®°ä½ä½ çš„æœåŠ¡æ˜¯åœ¨å“ªä¸€ä¸ªç«¯å£ï¼Œé‚£å°±æ›´éš¾äº†ï¼›</p><p>è€ŒåŸŸåä¹Ÿä¸æ˜¯å‡­ç©ºç»™æˆ‘ä»¬æä¾›æœåŠ¡çš„ï¼Œæ¯ä¸€ä¸ªåŸŸåéƒ½éœ€è¦ç»‘å®šä¸€ä¸ªå…·ä½“çš„å…¬ç½‘ipï¼ˆåŸŸåè§£æï¼‰ï¼Œæ‰èƒ½ä¸ºç”¨æˆ·æä¾›æœåŠ¡ã€‚åœ¨åŸŸåçš„èƒŒåï¼Œéƒ½æ˜¯ä¸€ä¸ªipï¼Œæ¯ä¸€ä¸ªipä¹Ÿå°±æ˜¯ä¸€å°æœåŠ¡å™¨ã€‚</p><p>åŸŸåçš„ä½œç”¨ï¼Œå°±æ˜¯æ¥éšè—æ‰ipè¿™ä¸ªæ— è§„å¾‹çš„é•¿æ•°å­—ï¼Œæ–¹ä¾¿ç”¨æˆ·è®¿é—®ï¼›</p><blockquote><p>ä½ è§‰å¾—æ˜¯è®°ä½<code>baidu.com</code>å®¹æ˜“ï¼Œè¿˜æ˜¯è®°ä½<code>114.514.77.58</code>å®¹æ˜“å‘¢ï¼Ÿ</p></blockquote><p>åœ¨å‘½ä»¤è¡Œä½¿ç”¨pingå·¥å…·ï¼Œæˆ‘ä»¬èƒ½çŸ¥é“ä¸€ä¸ªç½‘ç«™æœåŠ¡å™¨çš„ipæ˜¯ä»€ä¹ˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping www.bilibili.com</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚æˆ‘ä»¬pingä¸€ä¸‹bç«™çš„åŸŸåï¼Œå¯ä»¥çœ‹åˆ°å…¶å…¬ç½‘ipæ˜¯<code>183.131.147.29</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">æ­£åœ¨ Ping a.w.bilicdn1.com [183.131.147.29] å…·æœ‰ 32 å­—èŠ‚çš„æ•°æ®:</span><br><span class="line">æ¥è‡ª 183.131.147.29 çš„å›å¤: å­—èŠ‚=32 æ—¶é—´=10ms TTL=55</span><br><span class="line">æ¥è‡ª 183.131.147.29 çš„å›å¤: å­—èŠ‚=32 æ—¶é—´=12ms TTL=55</span><br><span class="line">æ¥è‡ª 183.131.147.29 çš„å›å¤: å­—èŠ‚=32 æ—¶é—´=12ms TTL=55</span><br><span class="line">æ¥è‡ª 183.131.147.29 çš„å›å¤: å­—èŠ‚=32 æ—¶é—´=12ms TTL=55</span><br><span class="line"></span><br><span class="line">183.131.147.29 çš„ Ping ç»Ÿè®¡ä¿¡æ¯:</span><br><span class="line">    æ•°æ®åŒ…: å·²å‘é€ = 4ï¼Œå·²æ¥æ”¶ = 4ï¼Œä¸¢å¤± = 0 (0% ä¸¢å¤±)ï¼Œ</span><br><span class="line">å¾€è¿”è¡Œç¨‹çš„ä¼°è®¡æ—¶é—´(ä»¥æ¯«ç§’ä¸ºå•ä½):</span><br><span class="line">    æœ€çŸ­ = 10msï¼Œæœ€é•¿ = 12msï¼Œå¹³å‡ = 11ms</span><br></pre></td></tr></table></figure><h2 id="1-3-ip-ç«¯å£"><a href="#1-3-ip-ç«¯å£" class="headerlink" title="1.3 ip:ç«¯å£"></a>1.3 ip:ç«¯å£</h2><p>æˆ‘ä»¬å¯ä»¥ç”¨<code>ip:ç«¯å£</code>æ¥è®¿é—®è‡ªå·±çš„æœåŠ¡ï¼ˆä»¥ä¸‹ipçº¯å±è™šæ„ï¼Œå¦‚æœ‰æ’è½¦ï¼Œçº¯å±å·§åˆï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">114.514.77.58:8080</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬æŠŠè¿™ä¸ªç²˜è´´é“æµè§ˆå™¨ï¼Œå†å¤åˆ¶ç²˜è´´å‡ºæ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå‘ç°å‰é¢å¤šäº†ä¸€ä¸ªhttp</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://114.514.77.58:8080</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºå½“æˆ‘ä»¬ä½¿ç”¨ipè®¿é—®ä¸€ä¸ªæœåŠ¡çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šé»˜è®¤é‡‡ç”¨httpçš„åè®®å»è®¿é—®ï¼Œæ‰€ä»¥åœ¨å‰é¢åŠ äº†ä¸€ä¸ªæˆ‘ä»¬çœ‹ä¸åˆ°çš„<code>http://</code></p><h2 id="1-4-åè®®ä½œç”¨"><a href="#1-4-åè®®ä½œç”¨" class="headerlink" title="1.4 åè®®ä½œç”¨"></a>1.4 åè®®ä½œç”¨</h2><p>httpåè®®çš„ä½œç”¨ï¼Œå°±æ˜¯å‘<strong>æœåŠ¡å™¨</strong>ç”³è¯·ç‰¹å®šçš„èµ„æºï¼Œå†å°†èµ„æºæ‹‰å–åˆ°æœ¬åœ°è¿›è¡Œå±•ç¤ºorä½¿ç”¨ã€‚</p><p>èµ„æºéƒ½æ˜¯å­˜åœ¨æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸Šçš„ï¼Œå½“ç”¨æˆ·è¯·æ±‚çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨å¿…é¡»è¦çŸ¥é“èµ„æºçš„è·¯å¾„ï¼Œå°†å…¶<code>read</code>æ‰“å¼€è¯»å–ï¼Œå†<code>write</code>å†™ç»™æˆ‘ä»¬çš„å®¢æˆ·ç«¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/2022/08/07/note_linux/6gdb_g++_make_vim/</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥httpçš„è¯·æ±‚ä¸­æ‰ä¼šå¸¦ä¸Šèµ„æºçš„è·¯å¾„ï¼Œè¿™æ˜¯æ–¹ä¾¿æœåŠ¡å™¨è¿›è¡Œèµ„æºæ–‡ä»¶çš„è¯»å–ï¼›åŒæ—¶ï¼Œæ–‡ä»¶çš„è·¯å¾„ä¹Ÿæ˜¯å¯¹ä¸€ä¸ªæ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†ï¼Œåœ¨å‘Šè¯‰æœåŠ¡å™¨æ–‡ä»¶è·¯å¾„çš„åŒæ—¶ï¼Œä¹Ÿä¿è¯äº†æˆ‘ä»¬è¯·æ±‚çš„æ–‡ä»¶çš„å”¯ä¸€æ€§ï¼Œä¸ä¼šå‡ºç°äºŒä¹‰æ€§ï¼›</p><hr><p>è¿™æ—¶å€™åˆä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå½“æˆ‘ä»¬è®¿é—®ç½‘ç«™çš„æ ¹ç›®å½•çš„æ—¶å€™ï¼Œæ²¡æœ‰æä¾›æ–‡ä»¶çš„è·¯å¾„å‘€ï¼Œé‚£è¿™æ—¶å€™ï¼Œè®¿é—®çš„ä»€ä¹ˆæ–‡ä»¶å‘¢ï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.baidu.com/</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬è®¿é—®çš„æ˜¯æœåŠ¡å™¨æ ¹ç›®å½•çš„<code>index.html</code>æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://www.baidu.com/</span><br><span class="line">https://www.baidu.com/index.html</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥è¯•ç€æ‰“å¼€è¿™ä¸¤ä¸ªé“¾æ¥ï¼Œå…¶å‡ºç°çš„é¡µé¢æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼›</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ec4cb9820b6.png"                      alt="image-20230215110843400"                ></p><p>ç±»ä¼¼äºç«¯å£å·éšè—ï¼Œhttpåè®®ä¹Ÿç¡®å®šäº†å½“ä¸‹ä½¿ç”¨çš„ç½‘é¡µæ–‡ä»¶çš„å‘½åä¸º<code>index.html</code>ï¼Œå½“æˆ‘ä»¬è®¿é—®ä¸€ä¸ªç½‘ç«™çš„æ—¶å€™ï¼Œå°±ä¼šé»˜è®¤è®¿é—®æ ¹ç›®å½•ä¸‹çš„<code>index.html</code>æ–‡ä»¶ï¼ˆæ—¢ç„¶æ˜¯é»˜è®¤çš„ï¼Œé‚£å°±å¯ä»¥ç›´æ¥éšè—ï¼‰å¦‚æœè¿™ä¸ªæ–‡ä»¶ä¸å­˜åœ¨ï¼Œé‚£å°±ä¸ä¼šæ¸²æŸ“å‡ºæˆ‘ä»¬çœ‹åˆ°çš„ç½‘é¡µï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.htmlæ˜¯ç”¨å‰ç«¯è¯­è¨€ç¼–å†™çš„ç½‘é¡µä»£ç </span><br></pre></td></tr></table></figure><p>åŒç†ï¼Œå½“æˆ‘ä»¬è®¿é—®åšå®¢çš„æ—¶å€™ï¼Œè¯»å–é“çš„ä¹Ÿä¸æ˜¯ç›®å½•ï¼Œè€Œæ˜¯ç›®å½•ä¸‹çš„<code>index.html</code>æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.musnow.top/2022/08/07/note_linux/6gdb_g++_make_vim/</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ec4d38428a8.png"                      alt="image-20230215111050026"                ></p><p>æˆ‘çš„åšå®¢ä½¿ç”¨çš„æ˜¯hexoæ¡†æ¶ï¼Œå…¶ç½‘é¡µçš„æºè·¯å¾„åœ¨githubä¸Šå¼€æºäº†ï¼Œå¯ä»¥å¸®åŠ©ä½ ç†è§£urlä¸­çš„æ–‡ä»¶è·¯å¾„ã€‚</p><p>å½“å‰ä½ çœ‹åˆ°çš„æ–‡ä»¶ç›®å½•ï¼Œå°±æ˜¯åšå®¢æœåŠ¡çš„æ ¹ç›®å½•ã€‚è®¿é—®çš„åšå®¢é¦–é¡µï¼Œå°±æ˜¯æ ¹ç›®å½•ä¸‹çš„<code>index.html</code></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ec4d71b69ed.png"                      alt="image-20230215111147560"                ></p><p>ç”¨ä½œç¤ºä¾‹çš„<a href="https://blog.musnow.top/2022/08/07/note_linux/6gdb_g++_make_vim/index.html">linuxå·¥å…·ä½¿ç”¨</a>åšå®¢ï¼Œä¹Ÿå¯ä»¥æ ¹æ®å®ƒçš„è·¯å¾„ï¼Œæ‰¾åˆ°<code>index.html</code>æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/2022/08/07/note_linux/6gdb_g++_make_vim/</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ec4e066de99.png"                      alt="image-20230215111416443"                ></p><p>è¿™ä¾¿æ˜¯httpåè®®urlä¸­æ–‡ä»¶è·¯å¾„çš„ä½œç”¨ï¼</p><p>è¿™é‡Œçš„<code>/</code>æ ¹ç›®å½•æ˜¯<strong>æœåŠ¡ç«¯è®¾ç½®</strong>çš„ï¼Œå¹¶ä¸ä¸€å®šæ˜¯ï¼ˆå¤§æ¦‚ç‡ä¸æ˜¯ï¼‰æœåŠ¡ç«¯linuxæœåŠ¡å™¨çš„æ ¹ç›®å½•</p><h2 id="1-5-ç¼–ç è§£ç "><a href="#1-5-ç¼–ç è§£ç " class="headerlink" title="1.5 ç¼–ç è§£ç "></a>1.5 ç¼–ç è§£ç </h2><p>åœ¨urlä¸­ï¼Œè¿˜ä¼šå¯¹ä¸€äº›ç‰¹æ®Šå­—ç¬¦è¿›è¡Œç¼–è§£ç ï¼Œæ¯”å¦‚ä¸­æ–‡ï¼Œå’Œä¸€äº›ç‰¹æ®Šçš„ç¬¦å·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.musnow.top/2022/08/07/note_linux/6gdb_g++_make_vim/#4-make-x2F-makefile</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚åœ¨ä½œä¸ºç¤ºä¾‹çš„urlä¸­ï¼Œè¿™é‡Œå‡ºç°äº†<code>x2F</code>ï¼Œè€ŒåŸæ–‡ä¸­æ˜¯<code>4.make/makefile</code>;è¿™é‡Œçš„ç¼–ç å°±æ˜¯ä¸ºäº†é¿å…<code>make/makefile</code>è¢«è¯†åˆ«æˆè·¯å¾„çš„æ ‡è¯†ç¬¦ï¼Œä»è€Œå‡ºç°é”™è¯¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.baidu.com/s?tn=68018901_39_oem_dg&amp;ie=utf-8&amp;word=%E4%BD%A0%E5%A5%BD</span><br></pre></td></tr></table></figure><p>å½“urlè·¯å¾„ä¸­æœ‰ä¸­æ–‡çš„æ—¶å€™ï¼Œä¹Ÿä¼šè¢«è½¬ç æˆç‰¹å®šçš„æ ¼å¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ec503e1f0d6.png"                      alt="image-20230215112344227"                ></p><p>æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸Šçœ‹åˆ°çš„ä¾æ—§æ˜¯ä¸­æ–‡ï¼Œè¿™æ˜¯å› ä¸ºæµè§ˆå™¨è¿™æ®µå¸®æˆ‘ä»¬è¿›è¡Œäº†è§£ç </p><blockquote><p>å°†éœ€è¦è½¬ç çš„å­—ç¬¦è½¬ä¸º16è¿›åˆ¶ï¼Œç„¶åä»å³åˆ°å·¦ï¼Œå–4ä½(ä¸è¶³4ä½ç›´æ¥å¤„ç†)ï¼Œæ¯2ä½åšä¸€ä½ï¼Œå‰é¢åŠ ä¸Š%ï¼Œç¼–ç æˆ<code>%XY</code>æ ¼å¼</p></blockquote><h1 id="2-httpåè®®è¯·æ±‚æ ¼å¼"><a href="#2-httpåè®®è¯·æ±‚æ ¼å¼" class="headerlink" title="2.httpåè®®è¯·æ±‚æ ¼å¼"></a>2.httpåè®®è¯·æ±‚æ ¼å¼</h1><p>äº†è§£äº†httpåè®®ä¸­çš„urlç½‘å€ï¼Œç°åœ¨å°±å¯ä»¥è¿›ä¸€æ­¥äº†è§£httpåè®®çš„æŠ¥å¤´å’ŒæŠ¥æ–‡äº†;</p><p>ä¸€ä¸ª<code>http request/response</code>çš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ec536219bf8.png"                      alt="image-20230215113707995"                ></p><p>åœ¨è¯·æ±‚ä¸­ï¼Œå®¢æˆ·ç«¯ä¼šæä¾›è‡ªå·±çš„è¯·æ±‚æ–¹æ³•ï¼ˆGET&#x2F;POST&#x2F;PUTç­‰ç­‰ï¼‰ï¼Œå¹¶æä¾›urlæ¥æ ‡è¯†è‡ªå·±éœ€è¦çš„æ–‡ä»¶è·¯å¾„ï¼›è¿™ä¸ªurlå¯èƒ½æ˜¯çŸ­é“¾æ¥ï¼ˆæˆªå–æ ¹ç›®å½•ä¹‹åçš„éƒ¨åˆ†ï¼‰ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å®Œæ•´çš„é“¾æ¥ã€‚</p><p>éšåï¼Œå°±ä¼šè·Ÿä¸Šä¸€å¤§å †çš„è¯·æ±‚å‚æ•°ï¼Œæ³¨æ„ï¼Œè¿™é‡Œçš„è¯·æ±‚å‚æ•°å¹¶ä¸æ˜¯urlä¸­çš„<code>&lt;query&gt;</code>å‚æ•°ï¼Œè€Œæ˜¯httpåè®®è‡ªèº«çš„è¯·æ±‚å‚æ•°ã€‚æ¯ä¸€ä¸ªè¯·æ±‚å‚æ•°éƒ½ç”¨äº†<code>\r\n</code>ä½œä¸ºåˆ†éš”ï¼Œè¿™å’Œæˆ‘ä»¬å†™çš„<a href="https://blog.musnow.top/2023/02/11/note_linux/32tcp%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8D%8F%E8%AE%AE/#3-1-%E5%8D%8F%E8%AE%AE%E5%AE%9A%E5%88%B6">è‡ªå®šä¹‰åè®®</a>ä¸­é‡‡ç”¨<code>\t</code>è¿›è¡Œåˆ†å‰²æ˜¯ç›¸åŒçš„åŸç†ï¼</p><p>è¿™å‡ ä¸ªéƒ¨åˆ†ä¸­ï¼Œè¯·æ±‚çš„æ­£æ–‡å¯ä»¥ä¸å¸¦ï¼ˆä¸ºç©ºï¼‰</p><h2 id="2-1-è¯»å–å¤šé•¿ï¼Ÿ"><a href="#2-1-è¯»å–å¤šé•¿ï¼Ÿ" class="headerlink" title="2.1 è¯»å–å¤šé•¿ï¼Ÿ"></a>2.1 è¯»å–å¤šé•¿ï¼Ÿ</h2><p>ä¸ºäº†è®©åè®®è¯»å–çš„æ—¶å€™ï¼Œèƒ½å¤ŸçŸ¥é“ä»€ä¹ˆæ—¶å€™è¯»å–å®Œæ¯•äº†æŠ¥å¤´ï¼Œhttpåè®®æä¾›äº†ä¸€ä¸ª<code>\r\n</code>çš„ç©ºè¡Œï¼Œè¯»å–é“è¿™ä¸ªç©ºè¡Œï¼Œå°±ä»£è¡¨æŠ¥å¤´è¯»å–å®Œæ¯•äº†ï¼Œå‰©ä¸‹çš„å†…å®¹éƒ½æ˜¯æŠ¥æ–‡ã€‚</p><p>è€Œä¸ºäº†æ ‡è¯†æŠ¥æ–‡çš„é•¿åº¦ï¼Œhttpåè®®ä¼šåœ¨å‘é€çš„æ—¶å€™æä¾›ä¸€ä¸ªå‚æ•°<code>content-length</code>ï¼Œç”¨äºæ ‡è¯†æŠ¥æ–‡çš„é•¿åº¦ã€‚åœ¨è¯»å–å®Œæ¯•æŠ¥å¤´åï¼Œè‚¯å®šæ˜¯è¯»å–åˆ°äº†è¿™ä¸ª<code>content-length</code>å‚æ•°çš„ï¼Œä¹Ÿå°±çŸ¥é“åç»­åº”è¯¥ç»§ç»­è¯»å–å¤šé•¿ï¼Œæ‰èƒ½è¯»å®Œæ•´ä¸ªåè®®å­—æ®µï¼</p><p>å…³äºè¿™éƒ¨åˆ†çš„ä»‹ç»ï¼Œå¯ä»¥æŸ¥çœ‹å¦å¤–ä¸€ç¯‡åšå®¢ <a href="https://blog.musnow.top/2023/02/15/note_Linux/35http%E4%B8%ADcontent-length/">httpåè®®content-lengthè¯¦è§£</a></p><h2 id="2-2-å“åº”çš„çŠ¶æ€ç "><a href="#2-2-å“åº”çš„çŠ¶æ€ç " class="headerlink" title="2.2 å“åº”çš„çŠ¶æ€ç "></a>2.2 å“åº”çš„çŠ¶æ€ç </h2><p>å’Œæˆ‘ä»¬è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ä¸€æ ·ï¼Œhttpä¹Ÿè¡¨æ˜äº†ä¸€éƒ¨åˆ†å“åº”çš„çŠ¶æ€ç ï¼Œå…¶ä¸­æˆ‘ä»¬æ—¥å¸¸æœ€å¸¸è§åˆ°çš„ï¼Œæ˜¯<code>404/403</code>è¿™ä¸¤ä¸ªçŠ¶æ€ç </p><blockquote><p><a class="link"   href="https://baike.baidu.com/item/HTTP%E7%8A%B6%E6%80%81%E7%A0%81/5053660" >httpçŠ¶æ€ç -ç™¾åº¦ç™¾ç§‘<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>çŠ¶æ€ç å°±æ˜¯æ ‡è¯†æœåŠ¡å™¨æä¾›çš„æœåŠ¡çŠ¶æ€ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯å®ƒçš„è¯·æ±‚æ˜¯å¦æˆåŠŸäº†ã€‚å¦‚æœçŠ¶æ€ç æ˜¯200ï¼Œä»£è¡¨è¯·æ±‚æ˜¯æˆåŠŸçš„ã€‚å…¶ä½™çŠ¶æ€ç ä¼šæœ‰å„è‡ªçš„ä½¿ç”¨åœºæ™¯ï¼Œæ¯”å¦‚404çŠ¶æ€ç ï¼Œä»£è¡¨è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨ï¼Œæ‰€ä»¥æ‰å« <code>404 not found!</code></p><h1 id="3-å®ä¾‹"><a href="#3-å®ä¾‹" class="headerlink" title="3.å®ä¾‹"></a>3.å®ä¾‹</h1><p>å®Œæ•´ä»£ç è¯¦è§ <a class="link"   href="https://gitee.com/musnow/raspberry-practice/tree/master/code" >Gitee<i class="fas fa-external-link-alt"></i></a></p><h2 id="3-1-å‰ç«¯é¡µé¢"><a href="#3-1-å‰ç«¯é¡µé¢" class="headerlink" title="3.1 å‰ç«¯é¡µé¢"></a>3.1 å‰ç«¯é¡µé¢</h2><p>ç”±äºæœ¬äººå¹¶æ²¡æœ‰å­¦ä¹ è¿‡å‰ç«¯è¯­æ³•ï¼Œè¿™é‡Œé‡‡ç”¨ <a class="link"   href="https://www.runoob.com/html/html-tutorial.html" >èœé¸Ÿæ•™ç¨‹<i class="fas fa-external-link-alt"></i></a> æä¾›çš„å‰ç«¯ç¤ºä¾‹ä»£ç æ¥æ¼”ç¤º</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>èœé¸Ÿæ•™ç¨‹(runoob.com)<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>æˆ‘çš„ç¬¬ä¸€ä¸ªæ ‡é¢˜<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘çš„ç¬¬ä¸€ä¸ªæ®µè½ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ—¥å¸¸æ‰€è®¿é—®çš„ç½‘é¡µéƒ½æ˜¯è¿™æ ·çš„ä»£ç ï¼Œç»ç”±æµè§ˆå™¨è¿›è¡Œæ¸²æŸ“ï¼Œå†å±•ç¤ºå‡ºæ¥</p><h2 id="3-2-æœåŠ¡ç«¯ä»£ç "><a href="#3-2-æœåŠ¡ç«¯ä»£ç " class="headerlink" title="3.2 æœåŠ¡ç«¯ä»£ç "></a>3.2 æœåŠ¡ç«¯ä»£ç </h2><p>ç”±äºhttpæ˜¯åŸºäºtcpçš„ï¼Œè¿™é‡Œç›´æ¥æŠŠä¹‹å‰å†™çš„tcpServeræ¬è¿‡æ¥å°±èƒ½ç”¨ï¼å…·ä½“çš„ä»£ç è§£æè¯·çœ‹æ³¨é‡Šï¼Œæƒ³å¿…è¯´çš„æ˜¯å¾ˆæ¸…æ¥šçš„</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> CRLF <span class="string">&quot;\r\n&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CRLF_LEN strlen(CRLF)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPACE <span class="string">&quot; &quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPACE_LEN strlen(SPACE)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HOME_PAGE <span class="string">&quot;index.html&quot;</span> <span class="comment">// é¦–é¡µæ–‡ä»¶</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ROOT_PATH <span class="string">&quot;web&quot;</span> <span class="comment">// ç½‘å€æ ¹ç›®å½•åœ°å€</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–httpè¯·æ±‚ä¸­çš„è·¯å¾„</span></span><br><span class="line"><span class="function">string <span class="title">getPath</span><span class="params">(string http_request)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">size_t</span> pos = http_request.<span class="built_in">find</span>(CRLF);<span class="comment">//æ‰¾åˆ°ç¬¬ä¸€è¡Œçš„åˆ†éš”ç¬¦</span></span><br><span class="line">    <span class="keyword">if</span>(pos == string::npos) </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    string request_line = http_request.<span class="built_in">substr</span>(<span class="number">0</span>, pos);<span class="comment">//å–å‡ºç¬¬ä¸€è¡Œ</span></span><br><span class="line">    <span class="comment">//è¯·æ±‚çš„ç¬¬ä¸€è¡Œï¼šGET /a/b/c http/1.0</span></span><br><span class="line">    <span class="type">size_t</span> first = request_line.<span class="built_in">find</span>(SPACE);<span class="comment">// æ‰¾åˆ°ç¬¬ä¸€ä¸ªç©ºæ ¼</span></span><br><span class="line">    <span class="keyword">if</span>(pos == string::npos) </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="type">size_t</span> second = request_line.<span class="built_in">rfind</span>(SPACE); <span class="comment">// ä»åå¾€å‰æ‰¾ç©ºæ ¼</span></span><br><span class="line">    <span class="keyword">if</span>(pos == string::npos) </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">// æ‰¾åˆ°ä¸¤ä¸ªç©ºæ ¼äº†ï¼Œä¸¤ä¸ªç©ºæ ¼ä¹‹é—´çš„å°±æ˜¯è¯·æ±‚çš„è·¯å¾„</span></span><br><span class="line">    string path = request_line.<span class="built_in">substr</span>(first+SPACE_LEN, second - (first+SPACE_LEN));</span><br><span class="line">    <span class="keyword">if</span>(path.<span class="built_in">size</span>() == <span class="number">1</span> &amp;&amp; path[<span class="number">0</span>] == <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">        path += HOME_PAGE; <span class="comment">//å†åŠ ä¸Šè¢«éšè—çš„index.htmlæ–‡ä»¶å</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> path;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¯»å–æ–‡ä»¶</span></span><br><span class="line"><span class="function">string <span class="title">readFile</span><span class="params">(<span class="type">const</span> string &amp;recource)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">ifstream <span class="title">in</span><span class="params">(recource, ios::binary)</span></span>;</span><br><span class="line">    <span class="keyword">if</span>(!in.<span class="built_in">is_open</span>()) <span class="comment">//æ–‡ä»¶æ‰“å¼€å¤±è´¥</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;404&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å†…å®¹</span></span><br><span class="line">    string content;</span><br><span class="line">    string line;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">getline</span>(in, line))</span><br><span class="line">    &#123;</span><br><span class="line">        content += line;</span><br><span class="line">    &#125;</span><br><span class="line">    in.<span class="built_in">close</span>();</span><br><span class="line">    <span class="keyword">return</span> content;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">handlerHttpRequest</span><span class="params">(<span class="type">int</span> sock)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;###########start#############&quot;</span> &lt;&lt; endl;<span class="comment">//æ‰“å°ä¸€ä¸ªåˆ†éš”çº¿</span></span><br><span class="line">    <span class="type">char</span> buffer[<span class="number">10240</span>];</span><br><span class="line">    <span class="type">ssize_t</span> s = <span class="built_in">read</span>(sock, buffer, <span class="built_in">sizeof</span>(buffer));</span><br><span class="line">    <span class="keyword">if</span>(s &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        cout &lt;&lt; buffer &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;###########end############&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    string path = <span class="built_in">getPath</span>(buffer);</span><br><span class="line">    <span class="comment">// å‡è®¾ç”¨æˆ·è¯·æ±‚çš„æ˜¯ /a/b è·¯å¾„</span></span><br><span class="line">    <span class="comment">// é‚£ä¹ˆæœåŠ¡ç«¯å¤„ç†çš„æ—¶å€™ï¼Œå°±éœ€è¦æ·»åŠ æ ¹ç›®å½•ä½ç½®å’Œé»˜è®¤çš„æ–‡ä»¶å</span></span><br><span class="line">    <span class="comment">// &lt;root&gt;/a/b/index.html</span></span><br><span class="line">    <span class="comment">// åœ¨æœ¬æ¬¡ç”¨ä¾‹ä¸­ï¼Œæ ¹ç›®å½•ä¸º ./webæ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥å®Œæ•´çš„æ–‡ä»¶è·¯å¾„åº”è¯¥æ˜¯</span></span><br><span class="line">    <span class="comment">// ./web/a/b/index.html</span></span><br><span class="line"></span><br><span class="line">    string resources = ROOT_PATH; <span class="comment">// æ ¹ç›®å½•è·¯å¾„</span></span><br><span class="line">    resources += path; <span class="comment">// æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">    <span class="built_in">logging</span>(DEBUG,<span class="string">&quot;[sockfd: %d] filePath: %s&quot;</span>,sock,resources.<span class="built_in">c_str</span>()); <span class="comment">// æ‰“å°ç”¨ä½œdebug</span></span><br><span class="line"></span><br><span class="line">    string html = <span class="built_in">readFile</span>(resources);<span class="comment">// æ‰“å¼€æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€å§‹å“åº”</span></span><br><span class="line">    string response = <span class="string">&quot;HTTP/1.0 200 OK\r\n&quot;</span>;</span><br><span class="line">    <span class="comment">//å¦‚æœreadFileè¿”å›çš„æ˜¯404ï¼Œä»£è¡¨æ–‡ä»¶è·¯å¾„ä¸å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">strcmp</span>(html.<span class="built_in">c_str</span>(),<span class="string">&quot;404&quot;</span>)==<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        response = <span class="string">&quot;HTTP/1.0 404 NOT FOUND\r\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿½åŠ åç»­å­—æ®µ</span></span><br><span class="line">    response += <span class="string">&quot;Content-Type: text/html\r\n&quot;</span>;</span><br><span class="line">    response += (<span class="string">&quot;Content-Length: &quot;</span> + <span class="built_in">to_string</span>(html.<span class="built_in">size</span>()) + <span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">    response += <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">    response += html;</span><br><span class="line">    <span class="comment">// å‘é€ç»™ç”¨æˆ·</span></span><br><span class="line">    <span class="built_in">send</span>(sock, response.<span class="built_in">c_str</span>(), response.<span class="built_in">size</span>(), <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-3-æµ‹è¯•"><a href="#3-3-æµ‹è¯•" class="headerlink" title="3.3 æµ‹è¯•"></a>3.3 æµ‹è¯•</h2><p>å¯åŠ¨æœåŠ¡å™¨ä¹‹å‰ï¼Œè¯·å…ˆæ‰“å¼€ä½ çš„äº‘æœåŠ¡å™¨é˜²ç«å¢™ä¸­çš„å¯¹åº”ç«¯å£ï¼›è¿™é‡Œæˆ‘ç»‘å®šçš„æ˜¯ç«¯å£10000ï¼Œåœ¨æµè§ˆå™¨ä¸­ç”¨<code>ip:ç«¯å£</code>çš„æ–¹å¼å¯ä»¥æ­£å¸¸è®¿é—®ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ec6f01b93dd.png"                      alt="image-20230215133459929"                ></p><p>è¿™é‡Œæ ‡è¯†çš„<code>ä¸å®‰å…¨</code>æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰é‡‡ç”¨å¸¦åŠ å¯†çš„httpsåè®®ï¼Œè¿™ä¸æ˜¯å½“ä¸‹éœ€è¦è€ƒè™‘çš„é—®é¢˜ã€‚ä¸ç®¡ä»–å°±å¯ä»¥äº†ã€‚</p><p>æŒ‰F12æ‰“å¼€å¼€å‘è€…é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹æ–¹å‡ºç°äº†å®Œæ•´çš„htmlä»£ç ï¼Œæˆ‘ä»¬æˆåŠŸæä¾›äº†æœåŠ¡ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ec720503cdc.png"                      alt="image-20230215134751216"                ></p><h2 id="3-4-åç«¯æ‰“å°çš„æŠ¥æ–‡"><a href="#3-4-åç«¯æ‰“å°çš„æŠ¥æ–‡" class="headerlink" title="3.4 åç«¯æ‰“å°çš„æŠ¥æ–‡"></a>3.4 åç«¯æ‰“å°çš„æŠ¥æ–‡</h2><p>åœ¨æœåŠ¡å™¨åç«¯ï¼Œæˆ‘ä»¬çœ‹åˆ°å…¶æ‰“å°å‡ºæ¥äº†ä¸€ä¸ªåŸºæœ¬çš„httpè¯·æ±‚ï¼Œå’Œä¸Šé¢è¯´æ˜çš„æ ¼å¼æ˜¯ä¸€æ ·çš„ã€‚è¿™é‡Œç®€å•çš„è¿›è¡Œä¸€éƒ¨åˆ†è¯´æ˜ï¼š</p><ul><li>GETï¼šè¯·æ±‚æ–¹å¼ä¸ºè·å–æ•°æ®</li><li><code>/</code>ï¼šè¯·æ±‚çš„æ˜¯æ ¹è·¯å¾„</li><li><code>HTTP/1.1</code>ï¼šä½¿ç”¨çš„httpåè®®ç‰ˆæœ¬</li><li><code>Connetion</code>ï¼šä»£è¡¨æˆ‘ä»¬å’ŒæœåŠ¡å™¨çš„é“¾æ¥æ–¹å¼ï¼Œkeep-aliveä»£è¡¨ä¿æŒè¿æ¥</li><li><code>User-Agent</code>ï¼šå®¢æˆ·ç«¯ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯windowsç³»ç»Ÿã€Chromeå†…æ ¸çš„æµè§ˆå™¨ï¼ˆæˆ‘æ˜¯ç”¨çš„æ˜¯edgeæµè§ˆå™¨ï¼‰</li><li>Accept: æ”¯æŒæ¥æ”¶çš„ä¿¡æ¯ç±»å‹</li><li><code>Aceept-Encoding</code>: å¯¹ä¿¡æ¯è¿›è¡Œå‹ç¼©</li><li><code>Accept-Language</code>ï¼šæ”¯æŒçš„è¯­è¨€</li><li><code>Cookie</code>ï¼šèº«ä»½ä¿¡æ¯ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»</li></ul><p>å…¶ä¸­å‡ºç°äº†ä¸€ä¸ªç©ºè¡Œï¼Œä»£è¡¨æŠ¥æ–‡ç»“æŸï¼›</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ec78b4c5cf2.png"                      alt="image-20230215141623151"                ></p><p>å¾€ä¸‹æ»‘ï¼Œä¼šå‘ç°æµè§ˆå™¨è¿˜å‘å‡ºäº†ç¬¬äºŒä¸ªè¯·æ±‚ï¼Œè·¯å¾„æ˜¯<code>/favicon.ico</code>ï¼Œè¿™æ˜¯é»˜è®¤çš„ç«™ç‚¹å¤´åƒæ–‡ä»¶çš„å‘½åã€‚å› ä¸ºæˆ‘ä»¬çš„htmlæ–‡ä»¶ä¸­æ²¡æœ‰å†™æ˜ç«™ç‚¹å¤´åƒçš„è·¯å¾„ï¼Œæ‰€ä»¥æµè§ˆå™¨å°±å°è¯•è¯·æ±‚é»˜è®¤çš„å¤´åƒæ–‡ä»¶</p><p>ä½†æ˜¯ï¼Œå½“å‰æˆ‘ä»¬çš„ç«™ç‚¹æ ¹ç›®å½•webä¸‹å¹¶æ²¡æœ‰è¯¥æ–‡ä»¶ï¼Œåº”è¯¥è¿”å›ä¸€ä¸ª404çŠ¶æ€ç ã€‚</p><ul><li>è¯·æ±‚ä¸­å‡ºç°äº†ä¸€ä¸ªæ–°çš„å‚æ•°<code>Referer</code>ï¼Œä»£è¡¨æ˜¯ä»å½“å‰ç½‘é¡µè¯·æ±‚å¤´åƒçš„ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œè¯·æ±‚ç½‘é¡µçš„æŠ¥æ–‡ä¸­æ²¡æœ‰<code>Referer</code>å‚æ•°</li></ul><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ec8b10b0daf.png"                      alt="image-20230215153442298"                ></p><p>æ­¤æ—¶å¯ä»¥éšä¾¿æ‰¾ä¸ªå›¾ç‰‡åšå¤´åƒï¼Œçœ‹çœ‹èƒ½ä¸èƒ½åŠ è½½å‡ºæ¥ï¼›ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘éšä¾¿æ‰¾äº†ä¸€å¼ çº¯ç»¿è‰²çš„å›¾ç‰‡ï¼Œå¹¶å°†å…¶<a class="link"   href="http://www.ico51.cn/" >åœ¨çº¿è½¬æ¢ä¸ºico<i class="fas fa-external-link-alt"></i></a>ï¼Œæ”¾å…¥äº†ç«™ç‚¹çš„æ ¹ç›®å½•ã€‚</p><p>é‡å¯æœåŠ¡å™¨è¿›ç¨‹ï¼Œåˆ·æ–°æµè§ˆå™¨å†æ¬¡è¯·æ±‚ï¼Œå¯ä»¥çœ‹åˆ°æˆåŠŸå‡ºç°äº†ç«™ç‚¹çš„å¤´åƒï¼›</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ec7575b082e.png"                      alt="image-20230215140232033"                ></p><h2 id="3-5-å¸¸è§å‚æ•°è¡¨"><a href="#3-5-å¸¸è§å‚æ•°è¡¨" class="headerlink" title="3.5 å¸¸è§å‚æ•°è¡¨"></a>3.5 å¸¸è§å‚æ•°è¡¨</h2><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ec8de7299b2.png"                      alt="img"                ></p><h1 id="4-è¯·æ±‚æ–¹æ³•"><a href="#4-è¯·æ±‚æ–¹æ³•" class="headerlink" title="4.è¯·æ±‚æ–¹æ³•"></a>4.è¯·æ±‚æ–¹æ³•</h1><p>ä¸€èˆ¬æˆ‘ä»¬è·å–ä¸€ä¸ªç½‘é¡µï¼Œç”¨çš„éƒ½æ˜¯GETæ–¹æ³•ã€‚æ¥ä¸‹æ¥ç”¨ä¸€ä¸ªå¸¦æŒ‰é’®çš„è¡¨å•åˆ›å»ºè¯·æ±‚ï¼Œå°è¯•å‘æœåŠ¡ç«¯å‘é€<code>&lt;query&gt;</code>å‚æ•°</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>èœé¸Ÿæ•™ç¨‹(runoob.com)<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>æˆ‘çš„ç¬¬ä¸€ä¸ªæ ‡é¢˜<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘çš„ç¬¬ä¸€ä¸ªæ®µè½ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/a/index.html&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">    Username: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    Password: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;passwd&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="4-1-GET"><a href="#4-1-GET" class="headerlink" title="4.1 GET"></a>4.1 GET</h2><p>åœ¨methodé‡Œé¢ï¼Œæˆ‘ä»¬æŒ‡å®šäº†getæ–¹æ³•ï¼Œæ­¤æ—¶</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/a/index.html&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">    Username: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    Password: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;passwd&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶é¡µé¢ä¸­å‡ºç°äº†ä¸¤ä¸ªè¾“å…¥æ¡†ï¼Œä¾›æˆ‘ä»¬è¾“å…¥å¯†ç ï¼Œä¸”å¯†ç ä¼šæ˜¾ç¤ºä¸º<code>****</code>è€Œä¸æ˜¯æ˜æ–‡</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ec89644d733.png"                      alt="image-20230215152726050"                ></p><p>ç‚¹å‡»æŒ‰é’®ï¼Œä¼šè·³è½¬åˆ°ä¸€ä¸ª404é¡µé¢ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬çš„<code>a/index.html</code>è·¯å¾„å¹¶ä¸æ”¯æŒå‚æ•°è¯·æ±‚ï¼Œæ‰€ä»¥å‘é€äº†404é”™è¯¯ç </p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ec89a063d20.png"                      alt="image-20230215152834203"                ></p><p>ä¸è¿‡è¿™ä¸é‡è¦ï¼Œæˆ‘ä»¬çœ‹çœ‹åç«¯æ‰“å°çš„å†…å®¹ã€‚å…¶ä¸­å‚æ•°æ˜¯è¿½åŠ åˆ°urlä¸­ï¼Œä»¥æ˜æ–‡ä¼ è¾“è¿‡æ¥çš„ï¼›æ­£æ–‡éƒ¨åˆ†ä¸ºç©ºï¼Œå¹¶æ²¡æœ‰æºå¸¦å‚æ•°</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ec8b5dd10c0.png"                      alt="image-20230215153559515"                ></p><h2 id="4-2-POST"><a href="#4-2-POST" class="headerlink" title="4.2 POST"></a>4.2 POST</h2><p>å°†è¯·æ±‚æ–¹æ³•æ”¹æˆpostï¼Œå†æ¬¡å°è¯•</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/a/index.html&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    Username: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    Password: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;passwd&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™èƒ½æ­£å¸¸æ˜¾ç¤ºå‡º<code>a/index.html</code>é¡µé¢ï¼Œurlä¸­ä¸å†å¸¦æœ‰å‚æ•°</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ec8beb1e0c5.png"                      alt="image-20230215153820898"                ></p><p>æ­¤æ—¶æŸ¥çœ‹åç«¯ä¸­çš„ä¿¡æ¯ï¼Œèƒ½çœ‹åˆ°è¯·æ±‚æ–¹æ³•å˜ä¸ºPOSTï¼Œå‚æ•°å‡ºç°åœ¨äº†æ­£æ–‡éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯urlä¸­</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ec8c2e7faa5.png"                      alt="image-20230215153928118"                ></p><h2 id="4-3-GET-x2F-POSTåŒºåˆ«"><a href="#4-3-GET-x2F-POSTåŒºåˆ«" class="headerlink" title="4.3 GET&#x2F;POSTåŒºåˆ«"></a>4.3 GET&#x2F;POSTåŒºåˆ«</h2><p>è¿™ä¹Ÿæ˜¯GETå’ŒPOSTæ–¹æ³•çš„åŒºåˆ«ä¹‹ä¸€ï¼š</p><ul><li>GETæ–¹æ³•é€šè¿‡urlä¼ å‚</li><li>POSTæ–¹æ³•ä¼šå°†urlå‚æ•°æå–å‡ºæ¥ï¼Œæ‹¼æ¥åˆ°æ­£æ–‡éƒ¨åˆ†</li></ul><p>ç”±æ­¤èƒ½æ¨å‡ºäºŒè€…çš„å®‰å…¨æ€§åŒºåˆ«</p><ul><li>GETæ–¹æ³•ç›¸å¯¹ä¸å®‰å…¨ï¼Œå› ä¸ºå‚æ•°ç›´æ¥ä»¥æ˜æ–‡è´´åœ¨äº†urlä¸Š</li><li>POSTæ–¹æ³•ä»¥æ­£æ–‡ä¼ å‚ï¼Œä½¿ç”¨httpsåè®®çš„æ—¶å€™èƒ½è¿›è¡ŒåŠ å¯†ï¼Œç›¸å¯¹è¾ƒå®‰å…¨</li></ul><h2 id="4-4-æ›´å¤šæ–¹æ³•"><a href="#4-4-æ›´å¤šæ–¹æ³•" class="headerlink" title="4.4 æ›´å¤šæ–¹æ³•"></a>4.4 æ›´å¤šæ–¹æ³•</h2><p>httpè¯·æ±‚è¿˜æ”¯æŒæ›´å¤šæ–¹æ³•ï¼Œå¦‚ä¸‹</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ec8daba6e19.png"                      alt="img"                ></p><h1 id="5-çŠ¶æ€ç "><a href="#5-çŠ¶æ€ç " class="headerlink" title="5.çŠ¶æ€ç "></a>5.çŠ¶æ€ç </h1><h2 id="5-1-çŠ¶æ€ç è¡¨"><a href="#5-1-çŠ¶æ€ç è¡¨" class="headerlink" title="5.1 çŠ¶æ€ç è¡¨"></a>5.1 çŠ¶æ€ç è¡¨</h2><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå“åº”çŠ¶æ€ç çš„æ€»è¡¨</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ec8ef551dec.png"                      alt="image-20230215155118813"                ></p><h2 id="5-2-404-x2F-403çŠ¶æ€ç "><a href="#5-2-404-x2F-403çŠ¶æ€ç " class="headerlink" title="5.2 404&#x2F;403çŠ¶æ€ç "></a>5.2 404&#x2F;403çŠ¶æ€ç </h2><p>æˆ‘ä»¬èƒ½çœ‹åˆ°404å’Œ403éƒ½æ˜¯å®¢æˆ·ç«¯çŠ¶æ€ç ï¼Œä¸ºä»€ä¹ˆè¯´æ˜¯å®¢æˆ·ç«¯é”™è¯¯å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºä½ å‘æœåŠ¡å™¨è¯·æ±‚äº†ä¸€ä¸ªæœåŠ¡å™¨æ²¡æœ‰çš„èµ„æºï¼Œ<strong>è¿™ä¸ªé—®é¢˜ä¸åº”è¯¥æ˜¯æœåŠ¡å™¨çš„é—®é¢˜</strong>ã€‚</p><p>è¿™å°±å¥½æ¯”ä½ å»è¥¿ç“œæ‘Šä¹°è‚‰ï¼Œäººå®¶å‹æ ¹ä¸å–è‚‰ã€‚é—®é¢˜å‡ºåœ¨ä½ èº«ä¸Šï¼Œä½ ä¸åº”è¯¥æ‰¾è¥¿ç“œæ‘Šè€æ¿ä¹°è‚‰ã€‚æ‰€ä»¥404çŠ¶æ€ç ï¼Œåº”è¯¥æ˜¯å®¢æˆ·ç«¯çš„é—®é¢˜ï¼</p><p>è€Œ403çŠ¶æ€ç çš„å«ä¹‰æ˜¯<code>403 forbidden</code>ï¼ŒæœåŠ¡å™¨æ‹’ç»äº†ä½ çš„è¯·æ±‚ï¼ˆä½ æ²¡æœ‰æƒé™è®¿é—®ï¼‰è¿™ä¹Ÿæ˜¯å®¢æˆ·ç«¯çš„é—®é¢˜ã€‚ä½ ä¸èƒ½å»è¶…å¸‚ä¹°ä¸œè¥¿ï¼Œç„¶åé—®è€æ¿èƒ½ä¸èƒ½è®©ä½ çœ‹çœ‹è€æ¿çš„é’±ç½å­ã€‚è€æ¿è‚¯å®šä¸ç»™ä½ çœ‹å•Šï¼æ‰€ä»¥æ‰ä¼šå‘Šè¯‰ä½ 403ï¼Œä¸ç»™ä½ è®¿é—®ã€‚</p><h2 id="5-3-5xxçŠ¶æ€ç "><a href="#5-3-5xxçŠ¶æ€ç " class="headerlink" title="5.3 5xxçŠ¶æ€ç "></a>5.3 5xxçŠ¶æ€ç </h2><p>ä»€ä¹ˆæ—¶å€™ä¼šå‡ºç°æœåŠ¡å™¨é”™è¯¯çš„5xxçŠ¶æ€ç å‘¢ï¼Ÿ</p><p>å½“ä½ è¯·æ±‚ä¸€ä¸ªæœåŠ¡ï¼ŒæœåŠ¡ç«¯éœ€è¦å¤„ç†ä¹‹åç»™ä½ è¿”å›ç»“æœã€‚æ­¤æ—¶æœåŠ¡å™¨åœ¨å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½å› ä¸ºç¨‹åºæœ‰bugæå‰é€€å‡ºï¼Œè¿™æ—¶å€™å°±åº”è¯¥ç»™å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª<code>5xx</code>çŠ¶æ€ç ï¼Œæ ‡è¯†æœåŠ¡å™¨åœ¨å¤„ç†ä½ çš„è¯·æ±‚çš„è¿‡ç¨‹ä¸­ï¼Œå‡ºç°äº†é”™è¯¯ï¼Œæ— æ³•è¿”å›ç»“æœã€‚</p><h2 id="5-4-301-x2F-302é‡å®šå‘"><a href="#5-4-301-x2F-302é‡å®šå‘" class="headerlink" title="5.4 301&#x2F;302é‡å®šå‘"></a>5.4 301&#x2F;302é‡å®šå‘</h2><p>å…³äº3å¼€å¤´çš„çŠ¶æ€ç ï¼Œä¸»è¦è°ˆè°ˆä¸‹é¢è¿™ä¸¤ä¸ª</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">301 æ°¸ä¹…é‡å®šå‘</span><br><span class="line">302 ä¸´æ—¶é‡å®šå‘</span><br></pre></td></tr></table></figure><p>ä¸ºä½•ä¸€ä¸ªæ˜¯æ°¸ä¹…ï¼Œä¸€ä¸ªæ˜¯ä¸´æ—¶å‘¢ï¼Ÿ</p><p>åœ¨httpè¿›è¡Œå“åº”çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯å¯ä»¥å‘é€ä¸€ä¸ª<code>location</code>å‚æ•°ï¼Œå‘é€ä¸€ä¸ªæ–°çš„urlç»™å®¢æˆ·ç«¯ï¼›æˆ‘ä»¬çš„æµè§ˆå™¨åœ¨æ”¶åˆ°è¿™ä¸ªå‚æ•°åï¼Œä¼šè‡ªåŠ¨æ‰“å¼€å¯¹åº”çš„é¡µé¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Location: https://www.baidu.com/</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸Šé¢çš„ä»£ç æ¥æµ‹è¯•ä¸€ä¸‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°è¯•è¿›è¡Œ302é‡å®šå‘</span></span><br><span class="line">string response = <span class="string">&quot;HTTP/1.1 302 Temporarily moved\r\n&quot;</span>;</span><br><span class="line">response+= <span class="string">&quot;Location: https://www.baidu.com/\r\n&quot;</span>;</span><br><span class="line">response+= <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘é€ç»™ç”¨æˆ·</span></span><br><span class="line"><span class="built_in">send</span>(sock, response.<span class="built_in">c_str</span>(), response.<span class="built_in">size</span>(), <span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶è®¿é—®æˆ‘ä»¬è‡ªå·±çš„<code>IP:ç«¯å£</code>ï¼Œä¼šè·³è½¬åˆ°ç™¾åº¦çš„é¡µé¢ã€‚è¿™å°±æ˜¯é‡å®šå‘çš„ä½œç”¨</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ec9497019d5.png"                      alt="image-20230215161520817"                ></p><ul><li>é‚£ä¸´æ—¶é‡å®šå‘å’Œæ°¸ä¹…é‡å®šå‘æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢?</li></ul><p>å‡å¦‚æˆ‘è®¾ç«‹äº†ä¸€ä¸ªå…¬å¼€ç«™ç‚¹ï¼ŒåŸŸåæ˜¯<code>test.com</code>ï¼Œè¿™å‡ å¹´ä¸€ç›´æä¾›æœåŠ¡ï¼Œç§¯ç´¯äº†ä¸€éƒ¨åˆ†çš„ç”¨æˆ·ã€‚è¿‡äº†ä¸€ä¼šï¼Œæˆ‘ä¸æƒ³è¦è¿™ä¸ªåŸŸåäº†ï¼Œæƒ³æ¢ä¸€ä¸ª<code>test.cn</code>ï¼›å¯ç”¨æˆ·å·²ç»æœ‰é‚£ä¹ˆå¤šï¼Œå¤§å®¶éƒ½åªè®°å¾—ä½ çš„<code>test.com</code>ï¼Œå¦‚æœç›´æ¥æ›´æ¢åŸŸåï¼Œå°±ä¼šå¯¼è‡´ç”¨æˆ·æ— æ³•è®¿é—®<code>test.com</code>ï¼Œä»¥ä¸ºä½ è·‘è·¯äº†ï¼Œå°±æ”¾å¼ƒä½¿ç”¨ä½ çš„ç½‘é¡µã€‚</p><p>è¿™æ ·çš„ç»“æœæ˜¾è€Œæ˜“è§ï¼šä¸¥é‡çš„å®¢æˆ·æµå¤±ï¼</p><p>æ‰€ä»¥ï¼Œä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å¯ä»¥å…ˆå°†æœåŠ¡è¿ç§»åˆ°<code>test.cn</code>æ–°åŸŸåï¼Œåœ¨æ—§åŸŸå<code>test.com</code>ä¸­è®¾ç½®ä¸€ä¸ª301é‡å®šå‘åˆ°<code>test.cn</code>ï¼Œå‘Šè¯‰ç”¨æˆ·æˆ‘æ¢æ–°åŸŸåäº†ã€‚è¿™æ ·æŒç»­ä¸€æ®µæ—¶é—´åï¼Œç­‰åˆ°<code>test.com</code>çš„ä½¿ç”¨è€…ä¸å¤šäº†ï¼Œå°±å¯ä»¥è€ƒè™‘å½»åº•å–æ¶ˆ<code>test.com</code>çš„è§£æï¼Œå…³åœæ­¤åŸŸåäº†ã€‚</p><p>åœ¨ä¸Šé¢çš„åœºæ™¯ä¸­ï¼Œæˆ‘æ˜¯éœ€è¦æ›´æ¢åŸŸåï¼Œæ˜¯æ°¸ä¹…æ›´æ¢ã€‚æˆ‘ä»¬å°±åº”è¯¥æŠŠçŠ¶æ€ç è®¾ç½®ä¸º301ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯è¿™ä¸ªåŸŸåå°†è¢«æ°¸ä¹…é‡å®šå‘åˆ°å¦å¤–ä¸€ä¸ªåŸŸåä¸Š</p><hr><p>å¦å¤–çš„æƒ…å†µæ˜¯ï¼Œæˆ‘æœ‰ä¸€ä¸ª<code>example.com</code>åŸŸåï¼Œæˆ‘çš„æœåŠ¡éœ€è¦è¿›è¡Œç»´æŠ¤ï¼›æ­¤æ—¶å°±å°†<code>example.com</code>é‡å®šå‘åˆ°å¦å¤–ä¸€ä¸ªåŸŸå<code>example.cn</code>ï¼ŒæŒ‡å‘å¦å¤–ä¸€ä¸ªæœåŠ¡å™¨ï¼Œè®©è¿™ä¸ªæœåŠ¡å™¨ä¸´æ—¶æä¾›æœåŠ¡ã€‚</p><p>æœåŠ¡ç»´æŠ¤å®Œæ¯•åï¼Œå°±å°†é‡å®šå‘å–æ¶ˆï¼Œç»§ç»­ä½¿ç”¨å½“å‰çš„æœåŠ¡å™¨ã€‚</p><p>è¿™ä¸ªåœºæ™¯ä¸­ï¼Œé‡å®šå‘åªæ˜¯ç»´æŠ¤æœŸé—´çš„ä¸€ä¸ªä¸´æ—¶ç­–ç•¥ï¼Œæ‰€ä»¥çŠ¶æ€ç è®¾ç½®æˆ302ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯æˆ‘åªæ˜¯ä¸´æ—¶è¿›è¡Œé‡å®šå‘ï¼Œæˆ‘è¿˜ä¼šå›æ¥çš„ã€‚</p><h1 id="6-cookie-x2F-session"><a href="#6-cookie-x2F-session" class="headerlink" title="6.cookie&#x2F;session"></a>6.cookie&#x2F;session</h1><p>æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œå½“æˆ‘ä»¬åœ¨ä¸€ä¸ªwebé¡µé¢ä¸­ç™»å½•äº†ï¼ˆå¦‚github&#x2F;gitee&#x2F;csdnï¼‰è¿™ä¸ªç½‘é¡µåœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…éƒ½ä¼šä¿æŒç™»å½•ï¼Œç›´åˆ°è¶…æ—¶äº¦æˆ–è€…æ˜¯å‡ºç°äº†å¼‚åœ°è®¿é—®ã€‚</p><p>å‡å¦‚ä½ ç°åœ¨æœ‰ä¸ªç½‘é¡µï¼Œä½†æ˜¯æ¯æ¬¡ç”¨æˆ·è®¿é—®çš„æ—¶å€™ï¼Œéƒ½éœ€è¦é‡æ–°è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œåˆšåˆšè¾“å…¥è¿‡äº†ï¼Œæ¢ä¸€ä¸ªé¡µé¢åˆä¸è¡Œäº†ã€‚è¿™æ ·ä¸€æ¥ï¼Œç”¨æˆ·è¿˜ä¼šæƒ³ç”¨ä½ è¿™ä¸ªæœåŠ¡å—ï¼Ÿ</p><p>ä¸ºäº†é¿å…æ­¤ç±»é—®é¢˜ï¼Œhttpåè®®å°±éœ€è¦å¼•å…¥å…¶ä»–çš„å‚æ•°ï¼Œæ¥ç»´æŒç”¨æˆ·çš„ç™»å½•ä¼šè¯ã€‚cookie&#x2F;sessionä¾¿æ˜¯å› æ­¤è€Œæ¥çš„ã€‚</p><h2 id="6-1-set-cookie"><a href="#6-1-set-cookie" class="headerlink" title="6.1 set cookie"></a>6.1 set cookie</h2><p>æœåŠ¡ç«¯å¯ä»¥åœ¨å“åº”å¤´ä¸­å¸¦ä¸Š<code>Set-Cookie</code>å­—æ®µï¼Œç»™å®¢æˆ·ç«¯è®¾ç½®ä¸Šcookie</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response += <span class="string">&quot;Set-Cookie: This is my cookie test\r\n&quot;</span>;</span><br></pre></td></tr></table></figure><p>æ‰“å¼€f12å¼€å‘è€…ç•Œé¢ï¼Œèƒ½åœ¨å…¶ä¸­çœ‹åˆ°æˆ‘ä»¬è®¾ç½®çš„cookie</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63eca303c2533.png"                      alt="image-20230215171652910"                ></p><p>å†æ¬¡åˆ·æ–°ç½‘é¡µï¼Œå¯ä»¥çœ‹åˆ°åœ¨ä¹‹åçš„è¯·æ±‚ä¸­ï¼Œæµè§ˆå™¨éƒ½ä¼šå‘é€ä¸€æ¬¡æœåŠ¡å™¨è®¾ç½®çš„cookieã€‚è¿™æ ·æœåŠ¡ç«¯åœ¨æ”¶åˆ°cookieåï¼Œå°±èƒ½è§£æåˆ°è‡ªå·±è®¾ç½®çš„cookieï¼Œç¡®å®šäº†æŒ‡å®šçš„ç”¨æˆ·</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63eca34befdf0.png"                      alt="image-20230215171805924"                ></p><p>åœ¨æœåŠ¡å™¨ç«¯ä¹Ÿèƒ½çœ‹åˆ°è¿™ä¸ªå­—æ®µ</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63eca54f23dfe.png"                      alt="image-20230215172640992"                ></p><h2 id="6-2-ä»€ä¹ˆæ˜¯cookie"><a href="#6-2-ä»€ä¹ˆæ˜¯cookie" class="headerlink" title="6.2 ä»€ä¹ˆæ˜¯cookie"></a>6.2 ä»€ä¹ˆæ˜¯cookie</h2><p>æ‰€è°“cookieï¼Œå…¶å®å°±æ˜¯æµè§ˆå™¨å¸®æˆ‘ä»¬å­˜å–äº†ä¸€å®šçš„èº«ä»½ä¿¡æ¯åœ¨æœ¬åœ°ï¼ˆå†…å­˜orç£ç›˜ï¼‰</p><p>ä¸‹ä¸€æ¬¡æ‰“å¼€ç‰¹å®šçš„ç½‘é¡µçš„æ—¶å€™ï¼Œå°±èƒ½æ˜¾ç¤ºå¯¹åº”çš„èº«ä»½ä¿¡æ¯ï¼ˆä¸ä¸€å®šæ˜¯ä½ çš„è´¦æˆ·å¯†ç ï¼‰ï¼Œå¹¶å‘Šè¯‰æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å°±è¯†åˆ«åˆ°äº†ä½ å½“å‰çš„ç”¨æˆ·ï¼Œå¹¶ä¸ºä½ ä¿æŒç™»é™†çŠ¶æ€ã€‚</p><p>æ—¢ç„¶æ˜¯ä¿å­˜åœ¨ç”¨æˆ·æœ¬åœ°çš„ï¼Œé‚£å°±æœ‰å¯èƒ½è¢«çªƒå–ã€‚ä¸€äº›æ¶æ„è½¯ä»¶å°±ä¼šå»æ‰«æä½ æµè§ˆå™¨æœ¬åœ°ç¼“å­˜ä¸­çš„cookieä¿¡æ¯ï¼Œå¯¹äºä¸€äº›å®‰å…¨æ€§ä¸é«˜çš„ç½‘ç«™è€Œè¨€ï¼Œæœ‰äº†è¿™ä¸ªcookieï¼Œå°±ç›¸å½“äºä»–æœ‰äº†ä½ çš„è´¦æˆ·ï¼Œå¯ä»¥ç›´æ¥ç™»å½•ä½ çš„è´¦æˆ·è¿›è¡Œæ“ä½œã€‚</p><p>å› æ­¤ï¼Œå¼•å…¥äº†å¦å¤–ä¸€ç§èº«ä»½è®¤è¯çš„æ–¹å¼ <code>cookie+session</code></p><h2 id="6-3-cookie-session"><a href="#6-3-cookie-session" class="headerlink" title="6.3 cookie+session"></a>6.3 cookie+session</h2><p>æ¯”èµ·å°†èº«ä»½ä¿¡æ¯å­˜åˆ°å®¢æˆ·ç«¯ï¼Œå­˜è‡³æœåŠ¡ç«¯æ›´ä¸ºå®‰å…¨ï¼ˆæ”»å‡»ä¼ä¸šæœåŠ¡å™¨çš„æˆæœ¬ï¼Œæ¯”åœ¨ç”¨æˆ·ç«¯æ¤å…¥æœ¨é©¬ç¨‹åºçš„æˆæœ¬æ›´é«˜ï¼‰</p><ul><li>ç”¨æˆ·ä½¿ç”¨è´¦æˆ·å¯†ç è¯·æ±‚ç™»å½•ï¼ŒæœåŠ¡å™¨æ”¶åˆ°ç™»å½•è¯·æ±‚ï¼ŒéªŒè¯æˆåŠŸåï¼Œç»™å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ª<code>å”¯ä¸€å­—ç¬¦ä¸²session_id</code>æ¥æ ‡è¯†ç”¨æˆ·</li><li>å®¢æˆ·ç«¯ä¸‹ä¸€æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œå¸¦ä¸Šäº†è¿™ä¸ªå”¯ä¸€å­—ç¬¦ä¸²</li><li>æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œåœ¨æœ¬åœ°çš„<code>session_id</code>åº“ä¸­æŸ¥æ‰¾è¿™ä¸ªidï¼Œæ‰¾åˆ°åï¼Œå°±å°†ç”¨æˆ·ä¿¡æ¯åŒ¹é…ç»™å®¢æˆ·ç«¯ï¼Œç›¸å½“äºå®¢æˆ·ç«¯ç™»å½•æˆåŠŸäº†</li></ul><p>è¿™æ ·ï¼Œå°±å°†åŸæœ¬å­˜åœ¨ç”¨æˆ·æœ¬åœ°çš„èº«ä»½è®¤è¯ä¿¡æ¯ï¼Œ<strong>å­˜åˆ°äº†æœåŠ¡ç«¯ä¸­</strong>ã€‚å®¢æˆ·ç«¯å°±åªå‰©ä¸‹ä¸€ä¸ªå­¤é›¶é›¶çš„å­—ç¬¦ä¸²idï¼Œä¸ä¼šæœ‰ç”¨æˆ·çš„ç§å¯†ä¿¡æ¯ã€‚å³ä¾¿ä¸¢å¤±ï¼Œä¹Ÿä¸ä¼šå½±å“ç”¨æˆ·çš„éšç§ã€‚</p><ul><li>ä½ å¯èƒ½ä¼šè¯´ï¼Œé‚£æˆ‘å·èµ°è¿™ä¸ªidä¸ä¹Ÿæ˜¯ä¸€æ ·çš„æ•ˆæœï¼Ÿ</li></ul><p>å…¶å®æ²¡æœ‰é‚£ä¹ˆç®€å•ï¼ŒæœåŠ¡ç«¯å¯ä»¥å°†<code>session_id</code>å’Œç”¨æˆ·çš„ipæˆ–è€…ç»ˆç«¯User-Agentç»‘å®šï¼Œè¿™æ ·åªè¦ç”¨æˆ·<strong>åˆ‡æ¢è®¾å¤‡</strong>æˆ–è€…<strong>æ¢äº†ç™»å½•çš„åœ°ç‚¹</strong>ï¼ˆæ¯”å¦‚ä»ä¸‰äºšè·‘åˆ°äº†å“ˆå°”æ»¨ï¼‰å°±ç›´æ¥è®©<code>session_id</code>å¤±æ•ˆï¼Œè¦æ±‚ç”¨æˆ·é‡æ–°ç™»å½•ã€‚</p><h1 id="7-é•¿çŸ­é“¾æ¥"><a href="#7-é•¿çŸ­é“¾æ¥" class="headerlink" title="7.é•¿çŸ­é“¾æ¥"></a>7.é•¿çŸ­é“¾æ¥</h1><p>åœ¨æ—©æœŸçš„httpåè®®ä¸­ï¼Œé‡‡ç”¨çš„éƒ½æ˜¯çŸ­é“¾æ¥ï¼Œä¸€æ¬¡è¿æ¥åªèƒ½å¤„ç†1æ¬¡httpè¯·æ±‚ã€‚å½“æ—¶çš„ç½‘é¡µå¤§å¤šä»¥æ–‡å­—ä¸ºä¸»ï¼Œæ•°æ®é‡å¾ˆå°ï¼Œä¸€èµ·è¯·æ±‚ä¹Ÿèƒ½å¤Ÿæ»¡è¶³éœ€æ±‚ã€‚</p><p>ä½†ç°åœ¨æ—¶ä»£å·²ç»å˜äº†ï¼Œä¸€ä¸ªç½‘é¡µé‡Œé¢æœ‰å›¾ç‰‡ï¼Œæ–‡å­—ï¼ŒéŸ³é¢‘ï¼Œè§†é¢‘ã€‚è¿™äº›æ–‡ä»¶çš„ä½“ç§¯æ‰“èµ·æ¥ä¹‹åï¼ŒçŸ­é“¾æ¥çš„æ–¹å¼å°±ä¸é€‚ç”¨äº†ã€‚æ­¤æ—¶å°±å‡ºç°äº†é•¿é“¾æ¥ï¼Œä¸€æ¬¡tcpé“¾æ¥ï¼Œå¯ä»¥æŒç»­ä¼ è¾“æ•°æ®ã€‚</p><p>ç›¸æ¯”çŸ­é“¾æ¥ï¼Œé•¿é“¾æ¥è¿ä¸Šä¹‹åï¼Œèƒ½æŒç»­ä¼ è¾“æ•°æ®ï¼Œ<strong>é¿å…äº†tcp3æ¬¡æ¡æ‰‹çš„æ¶ˆè€—</strong>ï¼Œæé«˜äº†æ•°æ®ä¼ è¾“çš„æ•ˆç‡ï¼</p><h2 id="7-1-Connetion"><a href="#7-1-Connetion" class="headerlink" title="7.1 Connetion"></a>7.1 Connetion</h2><p>åœ¨æœ¬æ–‡çš„<code>3.4</code>ä¸­ï¼Œä¾¿å‡ºç°äº†è¿™ä¸ªå‚æ•°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¼šæœ‰ä¸‹é¢ä¸¤ç§æƒ…å†µ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Connetion: keep-alive</span><br><span class="line">Connetion: closed</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>keep-alive</code>å°±æ˜¯é•¿é“¾æ¥ï¼Œ<code>closed</code>ä»£è¡¨å½“å‰ç«¯å£åªæ”¯æŒçŸ­é“¾æ¥ã€‚</p><p>å½“å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚å¤´ä¸­åŒ…å«<code>Connetion: keep-alive</code>å­—æ®µï¼Œå¦‚æœæœåŠ¡å™¨æ”¯æŒé•¿é“¾æ¥ï¼Œå°±éœ€è¦åœ¨å“åº”å¤´ä¸­ä¹Ÿå¸¦ä¸Š<code>Connetion: keep-alive</code>ï¼Œè¿™æ ·åŒæ–¹åå•†æˆåŠŸï¼Œå¤§å®¶éƒ½å¯ä»¥ä½¿ç”¨é•¿é“¾æ¥ã€‚</p><p>å¦‚æœæœåŠ¡å™¨çš„å“åº”å¤´ä¸­æ²¡æœ‰å¸¦<code>Connetion: keep-alive</code>ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å°±ä¼šè®¤ä¸ºæœåŠ¡å™¨ä¸æ”¯æŒé•¿é“¾æ¥ï¼Œä¸‹æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œä¼šé‡æ–°å‘æœåŠ¡å™¨é“¾æ¥ï¼Œå†è·å–èµ„æºã€‚</p><p>å¦‚æœå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä»»æ„ä¸€æ–¹çš„å“åº”å¤´ä¸­åŒ…å«<code>Connetion: closed</code>ï¼Œé‚£ä¹ˆå°±ä¼šè®¤ä¸ºå½“å‰çš„ä¼šè¯åªæ”¯æŒçŸ­é“¾æ¥ï¼Œä¸‹æ¬¡è¯·æ±‚ä¼šé‡æ–°å»ºç«‹é“¾æ¥ã€‚</p><h2 id="7-2-httpå’Œtcpçš„å…³ç³»"><a href="#7-2-httpå’Œtcpçš„å…³ç³»" class="headerlink" title="7.2 httpå’Œtcpçš„å…³ç³»"></a>7.2 httpå’Œtcpçš„å…³ç³»</h2><p>httpè™½ç„¶æ˜¯åŸºäºtcpçš„ï¼Œä½†httpæœ¬èº«æ˜¯æ— é“¾æ¥çš„ã€‚</p><blockquote><p>ä¸¾ä¸ªæœ€æ˜æ˜¾çš„æ —å­ï¼Œåœ¨ä½ æ‰“å¼€ä¸€ä¸ªç½‘é¡µä¹‹åï¼Œä½ å…³é—­æ‰è‡ªå·±çš„wifiï¼Œä½ çš„ç½‘é¡µå¹¶ä¸ä¼šå› æ­¤æ¶ˆå¤±ã€‚åªæ˜¯æ— æ³•è¿›è¡Œåç»­æ“ä½œè€Œå·²ã€‚</p></blockquote><p>httpæ˜¯ä¸€ä¸ªæ— é“¾æ¥çš„åº”ç”¨å±‚åè®®ï¼Œå…¶å€ŸåŠ©tcpè¿›è¡Œæ•°æ®çš„æµå¼ä¼ è¾“ï¼Œä½†ä¸ä¸€å®šéœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¿æŒè¿æ¥ã€‚</p><p>æ‰€ä»¥ï¼Œhttpå°±å¯ä»¥å€ŸåŠ©å•ä¸ªtcpå¥—æ¥å­—<strong>æŒç»­çš„ä¼ è¾“æ•°æ®</strong>ï¼Œä¹Ÿå°±å¤©ç„¶åœ°æ”¯æŒäº†é•¿é“¾æ¥é€šä¿¡ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œhttpåªæ˜¯å€Ÿç”¨äº†tcpçš„èƒ½åŠ›ï¼Œå…¶æ— è¿æ¥çš„ç‰¹æ€§å’Œtcpæ²¡æœ‰å…³ç³»ï¼</p><h2 id="7-3-pipeline"><a href="#7-3-pipeline" class="headerlink" title="7.3 pipeline"></a>7.3 pipeline</h2><p>è¿™å…¶ä¸­ä¼šç‰µæ‰¯åˆ°ä¸€ä¸ª<code>pipeline</code>ï¼Œå…¶ç»´æŠ¤äº†httpé•¿é“¾æ¥è¯·æ±‚æ—¶çš„<strong>å“åº”é¡ºåº</strong>ã€‚</p><p>æ¯”å¦‚äººå®¶éœ€è¦åŠ è½½ä¸€ä¸ªç½‘é¡µï¼ŒæœåŠ¡ç«¯åº”è¯¥å…ˆæŠŠç½‘é¡µçš„æ•´ä½“æ¡†æ¶ç»™ç”¨æˆ·åŠ è½½å‡ºæ¥ï¼Œå†ç»™ç”¨æˆ·åŠ è½½å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ç­‰èµ„æºã€‚ä¸‹å›¾Bç«™çš„åŠ è½½å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ —å­ã€‚</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ee31578364a.png"                      alt="image-20230216213625496"                ></p><p>å¦åˆ™ä¹±åºäº†ï¼Œæ¯”å¦‚åªå‡ºç°äº†ä¸€ä¸ªå­¤é›¶é›¶çš„å›¾ç‰‡ï¼Œå°±ä¼šè®©äººæ„Ÿè§‰éå¸¸å¥‡æ€ªã€‚</p><h1 id="8-https"><a href="#8-https" class="headerlink" title="8.https"></a>8.https</h1><p>å› ä¸ºhttpçš„æ•°æ®æ˜¯æ— åŠ å¯†æ˜æ–‡å‘é€çš„ï¼Œç›¸å¯¹æ¥è¯´å¹¶ä¸æ˜¯éå¸¸çš„å®‰å…¨ï¼›ä¸ºäº†å®ç°æ•°æ®åŠ å¯†ï¼Œhttpsåœ¨httpçš„ä¸‹å±‚æ·»åŠ äº†ä¸€ä¸ª<code>SSL/TLS</code>è½¯ä»¶å±‚ï¼Œæ¥è¿›è¡Œæ•°æ®åŠ è§£å¯†å·¥ä½œ</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ecc49657516.png"                      alt="image-20230215193931213"                ></p><h2 id="8-1-ä¸ºå•¥è¦åŠ å¯†ï¼Ÿ"><a href="#8-1-ä¸ºå•¥è¦åŠ å¯†ï¼Ÿ" class="headerlink" title="8.1 ä¸ºå•¥è¦åŠ å¯†ï¼Ÿ"></a>8.1 ä¸ºå•¥è¦åŠ å¯†ï¼Ÿ</h2><p>è¦çŸ¥é“ï¼Œæ‰€æœ‰çš„åŠ å¯†å·¥ä½œï¼Œéƒ½æ˜¯ä¸ºäº†é˜²æ­¢æ•°æ®åœ¨ä¸­é—´ä¼ è¾“çš„è¿‡ç¨‹ï¼Œè¢«çªƒå–æˆ–ä¿®æ”¹ã€‚å¦‚æœæˆ‘ä»¬è¯·æ±‚ä¸€ä¸ªç½‘ç«™ç™»å½•çš„æ—¶å€™ï¼Œæ•°æ®åŒ…ä¸­å°±ä¼šåŒ…å«æˆ‘ä»¬çš„è´¦æˆ·å¯†ç ã€‚å¦‚æœè¢«çªƒå–ï¼Œæˆ‘ä»¬çš„éšç§å°±æ³„éœ²äº†ã€‚è¿™æ˜¯å¾ˆéš¾å—çš„ä¸€ä»¶äº‹ï¼</p><blockquote><p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆï¼Œæˆ‘ä»¬ç»å¸¸èƒ½å¬åˆ°<code>å…è´¹å…¬å…±wifiä¸å®‰å…¨</code>è¿™ä¸€è¯´æ³•ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨è¿™ä¸ªwifiä¸Šè¿›è¡Œçš„æ‰€æœ‰æ•°æ®äº¤æ¢ï¼Œéƒ½ä¼šèµ°è¿™ä¸ªwifiçš„è·¯ç”±å™¨ï¼Œå¾ˆå®¹æ˜“è¢«<code>ä¸­é—´äºº</code>çªƒå–å¹¶è·å–åˆ°æˆ‘ä»¬çš„æ•°æ®åŒ…ã€‚</p><p>è¿™ç§æƒ…å†µä¸‹ï¼Œhttpsçš„åŠ å¯†å°±æ›´æœ‰å¿…è¦äº†ï¼</p></blockquote><p>ä½†æ˜¯ï¼ŒåŠ å¯†è§£å¯†æ˜¯éœ€è¦æ—¶é—´çš„ï¼Œæ‰€ä»¥httpså“åº”çš„é€Ÿåº¦ä¼šç¨æ…¢äºhttpã€‚ä¸è¿‡å½“ä¸‹cpuçš„æ‰§è¡Œé€Ÿåº¦å·²ç»éå¸¸å¿«ï¼Œè¿™ç‚¹æ—¶é—´å·®è·å¾ˆå°ï¼Œä¸ä¼šç‰¹åˆ«å½±å“æˆ‘ä»¬çš„æ—¥å¸¸ä½¿ç”¨ï¼</p><p>ä¸è¿‡ï¼ŒåŠ å¯†å¹¶ä¸æ˜¯ä¸€ä¸ªä¸‡é‡‘æ²¹ï¼Œå¹¶ä¸æ˜¯è¯´åŠ å¯†äº†ä¹‹åçš„æ•°æ®å°±ä¸€å®šèƒ½é¿å…è¢«çªƒå–ã€‚ä½†åŠ å¯†å¯ä»¥å¤§å¤§æé«˜çªƒå–ç ´è§£çš„æˆæœ¬ï¼Œæ— å½¢ä¸­é™ä½äº†æ•°æ®è¢«çªƒå–çš„æ¦‚ç‡ï¼Œä¿è¯äº†ä¸€å®šçš„æ•°æ®å®‰å…¨ã€‚</p><h2 id="8-2-å¸¸è§åŠ å¯†æ–¹å¼"><a href="#8-2-å¸¸è§åŠ å¯†æ–¹å¼" class="headerlink" title="8.2 å¸¸è§åŠ å¯†æ–¹å¼"></a>8.2 å¸¸è§åŠ å¯†æ–¹å¼</h2><h3 id="8-2-1-å¯¹ç§°åŠ å¯†"><a href="#8-2-1-å¯¹ç§°åŠ å¯†" class="headerlink" title="8.2.1 å¯¹ç§°åŠ å¯†"></a>8.2.1 å¯¹ç§°åŠ å¯†</h3><p>æ‰€è°“å¯¹ç§°åŠ å¯†ï¼Œå¥½æ¯”æœ‰ä¸€ä¸ªå¸¦é”çš„ç›’å­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æœ‰ä¸€æŠŠé’¥åŒ™ã€‚å®¢æˆ·ç«¯å…ˆæŠŠä¿¡æ¯ä¸¢è¿›ç›’å­é‡Œï¼Œå†ç”¨ğŸ”‘é”ä¸Šç›’å­ï¼Œå‘é€ç»™æœåŠ¡ç«¯ã€‚æœåŠ¡ç«¯ç”¨ğŸ”‘æ‰“å¼€ç›’å­ï¼Œå–å‡ºæ•°æ®ã€‚</p><p>å› ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æŒæœ‰çš„é’¥åŒ™æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œæ‰€ä»¥è¢«ç§°ä¸ºå¯¹ç§°åŠ å¯†ã€‚åœ¨åŠ å¯†çš„åœºæ™¯ä¸‹ï¼Œé’¥åŒ™ä¸€èˆ¬è¢«ç§°ä¸º<code>å¯†é’¥</code></p><p>åœ¨ç½‘ç»œåœºæ™¯é‡Œï¼Œ<strong>å¯¹ç§°åŠ å¯†æ˜¯ä¸å¯å–çš„</strong>ã€‚åªè¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¼ è¾“å¯†é’¥çš„æ—¶å€™è¢«çªƒå–ï¼Œé‚£ä¹ˆåŒæ–¹çš„åŠ å¯†å°±å¤±æ•ˆäº†ã€‚å› ä¸ºæ˜¯ç”¨åŒä¸€ä¸ªå¯†é’¥æ¥åŠ å¯†è§£å¯†ï¼Œæˆ‘æ‹¿èµ°äº†ä½ çš„é’¥åŒ™ï¼Œè‡ªç„¶å°±èƒ½æ‰“å¼€ä½ è¿™æŠŠé”ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<font color=orange>å¯†é’¥çš„ä¼ è¾“ä¹Ÿéœ€è¦åŠ å¯†</font>ã€‚ä½†æ˜¯è¿™åˆå¼•å‡ºä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘éƒ½æ²¡æœ‰ä½ çš„å¯†é’¥ï¼Œæˆ‘æ€ä¹ˆè§£å¯†ä½ å‘è¿‡æ¥çš„å¯†é’¥ä¿¡æ¯ï¼Ÿè¿™æ˜¯ä¸€ä¸ª<code>å…ˆæœ‰è›‹è¿˜æ˜¯å…ˆæœ‰é¸¡</code>çš„æ­»å¾ªç¯ï¼</p><h3 id="8-2-2-éå¯¹ç§°åŠ å¯†"><a href="#8-2-2-éå¯¹ç§°åŠ å¯†" class="headerlink" title="8.2.2 éå¯¹ç§°åŠ å¯†"></a>8.2.2 éå¯¹ç§°åŠ å¯†</h3><p>éå¯¹ç§°åŠ å¯†åœºæ™¯ä¸‹ï¼Œä¼šæœ‰ä¸€ä¸ªå…¬é’¥å’Œç§é’¥</p><ul><li>ç§é’¥å¯¹æ•°æ®åŠ å¯†ï¼Œå˜æˆå¯†æ–‡</li><li>å…¬é’¥å¯¹æ•°æ®è§£å¯†ï¼Œå˜æˆæ˜æ–‡</li></ul><p>äºŒè€…ä¹Ÿå¯ä»¥åè¿‡æ¥</p><ul><li>ç§é’¥å¯¹æ•°æ®è§£å¯†</li><li>å…¬é’¥å¯¹æ•°æ®åŠ å¯†</li></ul><p>å…¶ä¸­æœ€å¸¸ç”¨çš„éå¯¹ç§°åŠ å¯†ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨<a href="https://blog.musnow.top/2022/05/09/note_linux/1%E4%BD%BF%E7%94%A8ssh%E8%BF%9E%E6%8E%A5git/">gitçš„sshæ“ä½œ</a>ä¸­ä½¿ç”¨è¿‡çš„<code>rsa</code>å¯†é’¥ï¼Œå…¶ä¸­å°±æœ‰ä¸€ä¸ª<code>.pem</code>å…¬é’¥å’Œä¸€ä¸ªç§é’¥ã€‚æˆ‘ä»¬å°†å…¬é’¥æä¾›ç»™githubï¼Œç§é’¥ä¿å­˜åˆ°æœ¬åœ°ï¼Œå°±èƒ½å®ç°æ— å¯†ç ä¸Šä¼ æ•°æ®åˆ°gitä»“åº“ã€‚</p><hr><p>ä½†æ˜¯éå¯¹ç§°åŠ å¯†è¿˜æ˜¯ä¼šå­˜åœ¨ä¸­é—´äººæ”»å‡»çš„é—®é¢˜ã€‚å…ˆçœ‹å¦‚ä¸‹å›¾ï¼Œä½ åº”è¯¥èƒ½å‘ç°ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªé‡è¦çš„ç¯èŠ‚ï¼Œ<strong>å°±æ˜¯æœåŠ¡ç«¯è¦æŠŠå…¬é’¥å‘é€ç»™å®¢æˆ·ç«¯</strong></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ee25050db71.png"                      alt="image-20230216204344555"                ></p><p>åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œå…¬é’¥æ˜¯å…¬å¼€ä¼ è¾“ç»™å®¢æˆ·ç«¯çš„ï¼Œä¹Ÿå°±æ˜¯åç»­æœåŠ¡å™¨å‘é€ç»™å®¢æˆ·ç«¯çš„æ‰€æœ‰ä¿¡æ¯ï¼Œéƒ½å¯ä»¥è¢«å…¶ä»–äººç”¨è¿™ä¸ªå…¬é’¥è§£æå‡ºæ¥ï¼›</p><p>æ•´ä¸ªç¯èŠ‚ä¸­ï¼Œåªåšåˆ°äº†å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨çš„ä¿¡æ¯å®‰å…¨ï¼Œå› ä¸ºåªæœ‰æœåŠ¡å™¨æ‹¥æœ‰ç§é’¥ï¼Œèƒ½è§£å¯†å‡ºæ•°æ®ã€‚</p><h3 id="8-2-3-åŒéå¯¹ç§°"><a href="#8-2-3-åŒéå¯¹ç§°" class="headerlink" title="8.2.3 åŒéå¯¹ç§°"></a>8.2.3 åŒéå¯¹ç§°</h3><p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨åŒéå¯¹ç§°å¯†é’¥åŠ å¯†çš„æ–¹å¼ï¼æ—¢ç„¶éå¯¹ç§°åªèƒ½ä¿è¯å•æ–¹çš„æ•°æ®å®‰å…¨ï¼Œé‚£ä½¿ç”¨ä¸¤ä¸ªéå¯¹ç§°ï¼Œä¸å°±èƒ½ä¿è¯åŒæ–¹æ•°æ®å®‰å…¨äº†å˜›ï¼</p><ul><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯äº¤æ¢å…¬é’¥<code>a&#39; å’Œ b&#39;</code></li><li>å®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯å‘ä¿¡æ¯ï¼šå…ˆç”¨<code>a&#39;</code>å¯¹æ•°æ®åŠ å¯†ï¼Œå†å‘é€ï¼›åªèƒ½ç”±æœåŠ¡å™¨è§£å¯†ï¼Œå› ä¸ºåªæœ‰æœåŠ¡å™¨æœ‰ç§é’¥a</li><li>æœåŠ¡ç«¯ç»™å®¢æˆ·ç«¯å‘ä¿¡æ¯ï¼šå…ˆç”¨<code>b&#39;</code>å¯¹æ•°æ®åŠ å¯†ï¼Œå†å‘é€ï¼›åªèƒ½ç”±å®¢æˆ·ç«¯è§£å¯†ï¼Œå› ä¸ºåªæœ‰å®¢æˆ·ç«¯æœ‰ç§é’¥b</li></ul><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ee2acb5bf6c.png"                      alt="image-20230216210830169"                ></p><p>å› ä¸ºä¸¤ä»½ç§é’¥éƒ½åªæœ‰å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è‡ªå·±æ‹¥æœ‰ï¼Œæ‰€ä»¥é»‘å®¢æ²¡æœ‰åŠæ³•è¿›è¡Œæ•°æ®çš„çªƒå–ï¼Œä¹Ÿå°±ä¿è¯äº†æ•°æ®çš„å®‰å…¨ã€‚</p><p>å³ä¾¿ä¸­é—´äºº<strong>æ›¿æ¢äº†äº¤æ¢çš„å…¬é’¥</strong>ï¼Œä¹Ÿä¼šå› ä¸ºåç»­çš„é€šä¿¡ï¼Œå®¢æˆ·ç«¯oræœåŠ¡ç«¯<strong>æœ¬åœ°çš„ç§é’¥</strong>æ— æ³•æ­£å¸¸è§£å¯†ï¼Œè€Œå‘ç°æ•°æ®è¢«çªƒå–ï¼</p><p>ä½†æ˜¯ä½†æ˜¯ï¼Œè¿™æ ·å·¦è¿˜ç®—æœ‰å¾ˆå¤§çš„<strong>ç¼ºç‚¹</strong></p><ul><li>æ•ˆç‡å¤ªä½ï¼ˆéå¯¹ç§°åŠ å¯†è§£å¯†è´Ÿè½½å¤ªé«˜ï¼Œæ•ˆç‡ä½ä¸‹ï¼Œç‰¹å®šåœºæ™¯ä¸‹æ— æ³•æ»¡è¶³è¦æ±‚ï¼‰</li><li>ä¾æ—§å¯èƒ½å­˜åœ¨å®‰å…¨é—®é¢˜</li></ul><h3 id="8-2-4-éå¯¹ç§°-å¯¹ç§°"><a href="#8-2-4-éå¯¹ç§°-å¯¹ç§°" class="headerlink" title="8.2.4 éå¯¹ç§°+å¯¹ç§°"></a>8.2.4 éå¯¹ç§°+å¯¹ç§°</h3><ul><li>æœåŠ¡ç«¯å…·æœ‰éå¯¹ç§°å…¬é’¥Så’Œç§é’¥Sâ€™</li><li>å®¢â¼¾ç«¯å‘èµ·è¯·æ±‚ï¼Œè·å–æœåŠ¡ç«¯å…¬é’¥S</li><li>å®¢â¼¾ç«¯åœ¨æœ¬åœ°ç”Ÿæˆå¯¹ç§°å¯†é’¥C, é€šè¿‡å…¬é’¥SåŠ å¯†, å‘é€ç»™æœåŠ¡å™¨.</li><li>ç”±äºä¸­é—´äººæ²¡æœ‰ç§é’¥ï¼Œå³ä½¿æˆªè·äº†æ•°æ®ï¼Œä¹Ÿæ— æ³•è¿˜åŸå‡ºå†…éƒ¨çš„åŸæ–‡ï¼Œä¹Ÿå°±æ— æ³•è·å–åˆ°å¯¹ç§°å¯†é’¥</li><li>æœåŠ¡å™¨é€šè¿‡ç§é’¥<code>S&#39;</code>è§£å¯†ï¼Œè¿˜åŸå‡ºå®¢æˆ·ç«¯å‘é€çš„å¯¹ç§°å¯†é’¥Cï¼Œå¹¶ä¸”ä½¿ç”¨è¿™ä¸ªå¯¹ç§°å¯†é’¥åŠ å¯†ç»™å®¢æˆ·ç«¯å‘é€çš„å“åº”æ•°æ®</li><li>åç»­å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½é‡‡ç”¨å¯†é’¥Cæ¥è¿›è¡Œå¯¹ç§°åŠ å¯†é€šä¿¡</li></ul><p>å› ä¸ºå¯¹ç§°<strong>å¯†é’¥Cåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯åŠ å¯†</strong>çš„ï¼Œåªæœ‰å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çŸ¥é“å¯†é’¥æ˜¯ä»€ä¹ˆï¼Œä¹Ÿå°±å®ç°äº†æ•°æ®çš„å®‰å…¨é€šä¿¡ï¼</p><h2 id="8-3-æ•°æ®æ‘˜è¦ï¼ˆæŒ‡çº¹ï¼‰"><a href="#8-3-æ•°æ®æ‘˜è¦ï¼ˆæŒ‡çº¹ï¼‰" class="headerlink" title="8.3 æ•°æ®æ‘˜è¦ï¼ˆæŒ‡çº¹ï¼‰"></a>8.3 æ•°æ®æ‘˜è¦ï¼ˆæŒ‡çº¹ï¼‰</h2><p>æ•°å­—æŒ‡çº¹(æ•°æ®æ‘˜è¦)ï¼Œ å…¶åŸºæœ¬åŸç†æ˜¯åˆ©â½¤å•å‘æ•£åˆ—å‡½æ•°(<code>Hashå‡½æ•°</code>)å¯¹ä¿¡æ¯è¿›è¡Œè¿ç®—ï¼Œç”Ÿæˆâ¼€ä¸²<strong>å›ºå®šé•¿åº¦</strong>çš„æ•°å­—æ‘˜è¦ã€‚</p><p>å¸¸è§çš„æ‘˜è¦ç®—æ³•æœ‰<code>MD5/SHA1/SHA256/SHA512</code>ç­‰ï¼›</p><p>æ•°å­—æŒ‡çº¹å¹¶ä¸æ˜¯â¼€ç§åŠ å¯†æœºåˆ¶ï¼Œä½†å¯ä»¥ç”¨æ¥åˆ¤æ–­<strong>æ•°æ®æœ‰æ²¡æœ‰è¢«çªœæ”¹</strong>ï¼Œäº¦æˆ–è€…æ˜¯ä¸‹è½½çš„æ•°æ®åŒ…æœ‰æ²¡æœ‰å‡ºç°æŸåã€‚</p><ul><li>åŒä¸€ä¸ªæ•°æ®æ–‡ä»¶ï¼Œç”¨åŒä¸€ä¸ªæ–¹æ³•ç”Ÿæˆçš„æ•°æ®æ‘˜è¦æ˜¯ä¸€è‡´çš„</li><li>ä¸åŒæ–‡ä»¶ç”Ÿæˆçš„æ•°æ®æ‘˜è¦å¯èƒ½ä¼šæ’è½¦ï¼Œä½†å‡ ç‡æä½ï¼Œå¯ä»¥è®¤ä¸ºå…·æœ‰å”¯ä¸€æ€§ï¼</li><li>æˆ‘ä»¬æ— æ³•ç”¨æ•°æ®æ‘˜è¦åæ¨å‡ºæ•°æ®å†…å®¹ï¼ˆæ€ä¹ˆå¯èƒ½ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²æ¨æµ‹å‡ºåŸæœ¬çš„å†…å®¹å‘¢ï¼Ÿé‚£æ ·è¿˜å­˜æ”¾æºæ–‡ä»¶å¹²å“ˆï¼ŸğŸ˜‚ï¼‰</li></ul><p>æ•°æ®æ‘˜è¦åœ¨ç½‘ç›˜äº§å“ä¸­ä¹Ÿæœ‰ä½¿ç”¨ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨<strong>ç™¾åº¦äº‘ç›˜ã€é˜¿é‡Œäº‘ç›˜</strong>çš„æ—¶å€™ï¼Œä¼šé‡åˆ°ä¸€ä¸ªå¤§çš„èµ„æºæ–‡ä»¶åªç”¨äº†<strong>çŸ­çŸ­å‡ ç§’</strong>å°±æˆåŠŸä¸Šä¼ åˆ°æœåŠ¡å™¨çš„æƒ…å†µã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯çœŸçš„ç”¨å‡ ç§’å°±æŠŠæ•°æ®ä¼ è¾“ä¸Šå»äº†ï¼Œè€Œæ˜¯ç»å†äº†ä»¥ä¸‹é˜¶æ®µ</p><ul><li>ç½‘ç›˜å®¢æˆ·ç«¯å¯¹æœ¬åœ°æ–‡ä»¶ç”Ÿæˆæ•°æ®æ‘˜è¦</li><li>ç”Ÿæˆåï¼Œåˆ¤æ–­æœåŠ¡å™¨ç«¯<strong>å·²æœ‰æ–‡ä»¶</strong>ä¸­ï¼Œæ˜¯å¦æœ‰åŒè¯¥æ•°æ®æ‘˜è¦ç›¸åŒçš„æ–‡ä»¶</li><li>å¦‚æœæœ‰ï¼Œä»£è¡¨è¯¥æ–‡ä»¶å·²ç»å­˜åœ¨äº†äº‘ç›˜ä¸­</li><li>æœåŠ¡å™¨å°†è¯¥æ–‡ä»¶ç»™ä½ çš„è´¦æˆ·å»ºç«‹ä¸€ä¸ªè½¯é“¾æ¥&#x2F;ç¡¬é“¾æ¥ï¼Œå°±å®ç°äº†<code>&quot;å¦™ä¼ &quot;</code></li><li>å¦‚æœæ²¡æœ‰ï¼Œåˆ™è€è€å®å®çš„ä»æœ¬åœ°ä¸Šä¼ æ–‡ä»¶åˆ°äº‘ç›˜</li></ul><p>äº‘ç›˜å‚å®¶è¿™ä¹ˆåšçš„åŸå› å¾ˆç®€å•ï¼šé¿å…åŒä¸€ä»½æ–‡ä»¶è¢«å¤šæ¬¡å­˜å‚¨ã€‚å½“ä¸‹ç½‘ç›˜ç»™ç”¨æˆ·çš„å…è´¹ç©ºé—´åŠ¨åˆ™ä¸ŠTï¼Œå¦‚æœæ‰€æœ‰æ–‡ä»¶éƒ½é‡å¤ä¿å­˜ï¼Œé‚£å¯¹äºäº‘æœåŠ¡å™¨å‚å®¶æ¥è¯´ï¼Œèµ„æºæ¶ˆè€—å¤ªå¤§äº†ã€‚</p><p>è¿™ä¸ªåšæ³•å¹¶ä¸ä¼šäº§ç”Ÿæ•°æ®éšç§é—®é¢˜ï¼Œä¸€èˆ¬åªæœ‰ç”µå½±ç­‰èµ„æºæ–‡ä»¶æ‰æœ‰å¯èƒ½å¦™ä¼ æˆåŠŸã€‚ä½ å¯ä»¥ä½¿ç”¨ä¸€äº›â€œå…¶ä»–æ‰‹æ®µâ€ï¼Œæ¯”å¦‚æŠŠèµ„æºæ‰“ä¸ªå‹ç¼©åŒ…ï¼Œå¹¶åœ¨å‹ç¼©åŒ…ä¸­éšä¾¿ä¸¢å¦å¤–ä¸€ä¸ªæ–‡ä»¶ï¼Œè®©æ–‡ä»¶çš„æ•°æ®æŒ‡çº¹å’Œå·²æœ‰èµ„æºä¸ç›¸åŒï¼Œå°±ä¸ä¼šè¿›è¡Œ<code>å¦™ä¼ </code>äº†ã€‚</p><h2 id="8-4-æ•°å­—ç­¾å"><a href="#8-4-æ•°å­—ç­¾å" class="headerlink" title="8.4 æ•°å­—ç­¾å"></a>8.4 æ•°å­—ç­¾å</h2><p>å¯¹æ•°æ®æ‘˜è¦è¿›è¡ŒåŠ å¯†ï¼Œç”Ÿæˆçš„å†…å®¹è¢«ç§°ä¸º<strong>æ•°å­—ç­¾å</strong></p><h2 id="8-5-ä¸­é—´äººæ”»å‡»"><a href="#8-5-ä¸­é—´äººæ”»å‡»" class="headerlink" title="8.5 ä¸­é—´äººæ”»å‡»"></a>8.5 ä¸­é—´äººæ”»å‡»</h2><p>ä¸­é—´äººæ”»å‡»ï¼ˆMan-in-the-MiddleAttackï¼‰ï¼Œç®€ç§°â€œ<code>MITMæ”»å‡»</code>â€ï¼›</p><p>ä»¥<code>8.2.2</code>çš„å•éå¯¹ç§°åŠ å¯†ä¸ºä¾‹ï¼Œä¸­é—´äººå¯ä»¥åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­è¿›è¡Œ<strong>å·æ¢æ¢æŸ±</strong>ï¼Œçªƒå–åŒæ–¹çš„ä¿¡æ¯</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ee26a502a69.png"                      alt="image-20230216205047679"                ></p><p>é€è¿‡è¿™ä¸ªæ —å­ğŸŒ°ï¼Œå®é™…ä¸Šï¼Œå¦‚æœä¸­é—´äººåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯<strong>å¼€å§‹é€šä¿¡ä¹‹å‰</strong>å°±æ¥çªƒå¬å¹¶<strong>å‡†å¤‡æ¢æŸ±</strong>äº†ï¼Œä»–å°±æœ‰å¯èƒ½æ›¿æ¢åŒæ–¹å¯†é’¥ï¼Œä»è€Œè§£å¯†åŒæ–¹å‘é€çš„ä¿¡æ¯ï¼</p><p>æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œæ˜¯å®¢æˆ·ç«¯oræœåŠ¡ç«¯<strong>éƒ½æ²¡æœ‰åŠæ³•è¯æ˜</strong>ï¼Œå½“å‰çš„å…¬é’¥æ˜¯ç›´æ¥ä»æœåŠ¡ç«¯orå®¢æˆ·ç«¯å‘æ¥çš„ï¼Œå®ƒä»¬æ²¡æœ‰åŠæ³•æ£€éªŒå…¬é’¥çš„æƒå¨æ€§ï¼Œåªèƒ½è¢«åŠ¨æ¥å—ã€‚ç”±æ­¤ç»™ä¸­é—´äºº<code>å·æ¢æ¢æŸ±</code>æä¾›äº†å¯èƒ½ã€‚</p><h2 id="8-6-CAè¯ä¹¦"><a href="#8-6-CAè¯ä¹¦" class="headerlink" title="8.6 CAè¯ä¹¦"></a>8.6 CAè¯ä¹¦</h2><p>æ‰€è°“CAè¯ä¹¦ï¼Œæ˜¯ç”±<strong>CAæœºæ„</strong>é¢å‘çš„æƒå¨è¯ä¹¦ã€‚CAæœºæ„åœ¨é¢å‘è¯ä¹¦æ—¶ï¼Œä¼šåœ¨è¯ä¹¦ä¸­é™„å¸¦ä¸Šè¯¥ç«™ç‚¹çš„åŸŸåï¼Œä»¥åŠç”³è¯·äººï¼ˆä¼ä¸šï¼‰çš„ç›¸å…³ä¿¡æ¯</p><ul><li>CAæœºæ„ä¼šæœ‰ä¸€ä¸ªè‡ªå·±çš„ç§é’¥å’Œå…¬é’¥ï¼Œå…¶å…¬é’¥å‘<strong>æ‰€æœ‰äºº</strong>å…¬å¼€</li><li>CAæœºæ„çš„ç§é’¥ç”±å…¶è‡ªå·±ä¿å­˜ï¼ˆç§é’¥ä¸€å®šä¸èƒ½æ³„éœ²ï¼‰</li><li>å½“ä¸‹çš„æµè§ˆå™¨ã€æ“ä½œç³»ç»Ÿéƒ½ä¼šå†…ç½®è®¤å¯çš„CAï¼›åªæœ‰è¢«è®¤å¯çš„CAï¼Œæ‰èƒ½ä¸ºç«™ç‚¹æä¾›sslè¯ä¹¦æœåŠ¡</li></ul><p>åœ¨æˆ‘ä»¬windowsæœ¬åœ°å°±èƒ½çœ‹åˆ°å½“å‰æ“ä½œç³»ç»Ÿè®¤å¯çš„CAæœºæ„å…¶å…¬é’¥ï¼›åœ¨edgeæµè§ˆå™¨ä¸­ï¼Œç‚¹å‡»å³ä¸Šè§’é€‰æ‹©ï¼Œè¿›å…¥è®¾ç½®ï¼Œåœ¨é€‰æ‹©éšç§é¡µé¢ï¼Œæ‰¾åˆ°<code>ç®¡ç†è¯ä¹¦</code></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ee3dd712d42.png"                      alt="image-20230216222946008"                ></p><p>ç‚¹å‡»å®ƒï¼Œå°±èƒ½çœ‹åˆ°å½“å‰æœ¬åœ°è®¤å¯çš„CA</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ee3e40b1733.png"                      alt="image-20230216223131725"                ></p><h3 id="8-6-1-sslè¯ä¹¦åŠ å¯†åŸç†"><a href="#8-6-1-sslè¯ä¹¦åŠ å¯†åŸç†" class="headerlink" title="8.6.1 sslè¯ä¹¦åŠ å¯†åŸç†"></a>8.6.1 sslè¯ä¹¦åŠ å¯†åŸç†</h3><p>å½“ä¸€ä¸ªç«™ç‚¹è·å–äº†sslè¯ä¹¦åï¼Œåœ¨å‘ç”¨æˆ·å‘é€sslè¯ä¹¦ä¸­åŒ…å«çš„å…¬é’¥çš„åŒæ—¶ï¼Œè¿˜ä¼šå‘é€ä¸€ä¸ª<strong>ç”±CAæœºæ„</strong>å¯¹sslè¯ä¹¦å…¬é’¥åšçš„<strong>æ•°å­—ç­¾å</strong></p><ul><li>sslè¯ä¹¦å…¬é’¥çš„æ•°å­—ç­¾åAï¼Œé€šè¿‡CAæœºæ„çš„<strong>ç§é’¥</strong>è¿›è¡ŒåŠ å¯†</li><li>sslè¯ä¹¦çš„å…¬é’¥B</li></ul><p>å½“å®¢æˆ·ç«¯æ”¶åˆ°è¿™ä»½ä¿¡æ¯ä¹‹åï¼Œä¼šé‡‡ç”¨hashå‡½æ•°å¯¹æ”¶åˆ°çš„sslè¯ä¹¦å…¬é’¥è¿›è¡Œæ•°å­—ç­¾åï¼Œå¾—åˆ°ä¸€ä¸ª<strong>æœ¬åœ°ç”Ÿæˆçš„æ•°å­—ç­¾åC</strong></p><p>å†ç”¨CAæœºæ„çš„å…¬é’¥å¯¹ä¼ è¾“è¿‡æ¥çš„æ•°å­—ç­¾åAè¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°æ•°å­—ç­¾åAçš„æ˜æ–‡ï¼›åˆ¤æ–­ç”±CAæœºæ„ç”Ÿæˆçš„sslå…¬é’¥æ•°å­—ç­¾åAæ˜¯å¦å’Œæœ¬åœ°ç”Ÿæˆçš„æ•°å­—ç­¾åCç›¸åŒï¼›</p><ul><li>å¦‚æœç›¸åŒï¼Œåˆ™ä»£è¡¨è¯ä¹¦æ­£ç¡®ï¼</li><li>ä¸ç›¸åŒï¼Œä»£è¡¨è¯ä¹¦å‡ºç°é”™è¯¯ï¼</li></ul><p>ç”»ä¸ªå›¾ï¼Œå¤§æ¦‚å°±æ˜¯ä¸‹é¢è¿™æ ·</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63ee3aa8d2aa1.png"                      alt="image-20230216221611664"                ></p><p>ç”±äºå½“ä¸‹å‘é€çš„æ•°æ®åŒ…ä¸­ï¼ŒåŒæ—¶å­˜åœ¨sslå…¬é’¥çš„æ˜æ–‡+ç”±CAæœºæ„åŠ å¯†åçš„æ•°å­—ç­¾åï¼Œä¸­é—´äººæ— æ³•è¿›è¡Œä»»ä½•æ”»å‡»ä¿®æ”¹ï¼</p><ul><li>è‹¥ä¿®æ”¹sslå…¬é’¥ï¼Œç”±äºä¸­é—´äººæ²¡æœ‰CAæœºæ„çš„ç§é’¥ï¼Œæ— æ³•å¯¹ä¿®æ”¹åçš„sslå…¬é’¥ç”Ÿæˆå¯¹åº”çš„åŠ å¯†åæ•°å­—ç­¾å</li><li>è‹¥ä½¿ç”¨CAå…¬é’¥è§£å¯†æ•°å­—ç­¾ååä¿®æ”¹â€¦â€¦ä¾æ—§ä¼šå› ä¸ºæ²¡æœ‰CAæœºæ„ç§é’¥ï¼Œæ— æ³•æŠŠä¿®æ”¹åçš„ç­¾ååŠ å¯†å›å»</li><li>å¦‚æœä¸­é—´äººç”¨è‡ªå·±çš„ç§é’¥ç”Ÿæˆä¸€ä¸ªæ•°å­—ç­¾åï¼Œä½†æˆ‘ä¸è®¤è¯†ä½ è¿™ä¸ªCAï¼Œä¹Ÿä¸çŸ¥é“ä½ çš„å…¬é’¥æ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆè§£å¯†ä½ çš„ä¿¡æ¯å‘¢ï¼Ÿ</li></ul><p>ç»¼ä¸Šï¼Œä¸­é—´äººè¦æƒ³å·æ¢æ¢æŸ±ï¼Œåªæœ‰ä¸€ä¸ªåŠæ³•äº†ï¼Œé‚£å°±æ˜¯æ‹¿ä¸€ä¸ª<strong>çœŸçš„è¯ä¹¦</strong>æ•´ä½“æ›¿æ¢æ‰è¿™ä¸ªæ•°æ®åŒ…ã€‚</p><p>å¯sslè¯ä¹¦ä¸­è¿˜åŒ…å«äº†åŸŸåã€ç«™ç‚¹ä¸»ä½“ç­‰å„ç±»ä¿¡æ¯ï¼Œæˆ‘å½“ä¸‹è®¿é—®çš„æ˜¯<code>baidu.com</code>ï¼Œç»“æœæ”¶åˆ°çš„è¯ä¹¦æ˜¯<code>qq.com</code>çš„ï¼Œé‚£è‚¯å®šæœ‰é—®é¢˜å•Šï¼æµè§ˆå™¨ä¼šç›´æ¥æ‹’ç»è®¿é—®ï¼ğŸ˜‚</p><p>å½“æˆ‘ä»¬è®¿é—®ä¸€äº›ç½‘ç«™ï¼Œ<strong>æµè§ˆå™¨æŠ¥sslè¯ä¹¦è¿‡æœŸ</strong>ï¼Œä¹Ÿæ˜¯ä¼šå‡ºç°ä¸€å®šçš„å®‰å…¨é—®é¢˜çš„ï¼</p><h3 id="8-6-2-sslè¯ä¹¦-éå¯¹ç§°-å¯¹ç§°"><a href="#8-6-2-sslè¯ä¹¦-éå¯¹ç§°-å¯¹ç§°" class="headerlink" title="8.6.2 sslè¯ä¹¦+éå¯¹ç§°+å¯¹ç§°"></a>8.6.2 sslè¯ä¹¦+éå¯¹ç§°+å¯¹ç§°</h3><p>æœ‰äº†ä¸Šé¢è¿™ä¸ªä¸èƒ½è¢«ç¯¡æ”¹çš„sslè¯ä¹¦å…¬é’¥ï¼Œä¸‹é¢æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨<code>éå¯¹ç§°+å¯¹ç§°åŠ å¯†</code>çš„æ–¹å¼è¿›è¡Œé€šä¿¡äº†</p><ul><li>å®¢æˆ·ç«¯æ”¶åˆ°sslè¯ä¹¦ï¼Œå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªæœ¬åœ°ç”Ÿæˆçš„å¯†é’¥Dï¼ˆä½¿ç”¨sslè¯ä¹¦å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼‰</li><li>æœåŠ¡ç«¯æ”¶åˆ°å¯†é’¥Dçš„åŠ å¯†ä¿¡æ¯ï¼Œä½¿ç”¨sslè¯ä¹¦çš„ç§é’¥è¿›è¡Œè§£å¯†ï¼Œè·å–åˆ°å¯†é’¥D</li><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä½¿ç”¨å¯†é’¥Dè¿›è¡Œå¯¹ç§°åŠ å¯†é€šä¿¡</li></ul><p>è¿™æ ·å³è§£å†³äº†å®‰å…¨é—®é¢˜ï¼Œåˆè§„é¿äº†éå¯¹ç§°åŠ å¯†çš„æ•ˆç‡é—®é¢˜ï¼Œä¸€ä¸¾å¤šå¾—ï¼</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;å·²ç»å­¦ä¹ è¿‡è‡ªå·±å®šåˆ¶ä¸€ä¸ªåè®®äº†ï¼Œç°åœ¨å°±æ¥çœ‹çœ‹å½“ä¸‹å¹¿æ³›ä½¿ç”¨çš„httpåè®®å§&lt;/p&gt;</summary>
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="ç½‘ç»œ" scheme="https://blog.musnow.top/tags/%E7%BD%91%E7%BB%9C/"/>
    
    <category term="http" scheme="https://blog.musnow.top/tags/http/"/>
    
  </entry>
  
  <entry>
    <title>ã€ç½‘ç»œã€‘è‡ªå®šä¹‰åè®® | åºåˆ—åŒ–å’Œååºåˆ—åŒ– | Jsoncpp</title>
    <link href="https://blog.musnow.top/2023/02/12/Linux/33jsoncpp%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <id>https://blog.musnow.top/2023/02/12/Linux/33jsoncpp%E5%BA%8F%E5%88%97%E5%8C%96/</id>
    <published>2023-02-12T04:30:55.000Z</published>
    <updated>2023-03-11T11:25:36.240Z</updated>
    
    <content type="html"><![CDATA[<p>ä»¥tcpServerçš„<strong>è®¡ç®—å™¨</strong>æœåŠ¡ä¸ºä¾‹ï¼Œå®ç°ç”¨jsoncppæ¥è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–</p><span id="more"></span><blockquote><p>é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œè¯·å…ˆé˜…è¯» <a href="https://blog.musnow.top/2023/02/11/note_linux/32tcp%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8D%8F%E8%AE%AE/">è‡ªå®šä¹‰åè®® | åºåˆ—åŒ–å’Œååºåˆ—åŒ– | ä»¥tcpServerä¸ºä¾‹</a></p></blockquote><h1 id="1-å®‰è£…åŒ…"><a href="#1-å®‰è£…åŒ…" class="headerlink" title="1.å®‰è£…åŒ…"></a>1.å®‰è£…åŒ…</h1><p>æˆ‘æ‰€ç”¨çš„ç³»ç»Ÿæ˜¯<code>centos7.6</code>ï¼Œå…ˆç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥æ‰¾ç›¸å…³çš„åŒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum list | grep jsoncpp-devel</span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºå‡ºæ¥çš„åŒ…å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Repository epel is listed more than once in the configuration</span><br><span class="line">jsoncpp-devel.x86_64                0.10.5-2.el7           @epel </span><br></pre></td></tr></table></figure><p>éšåå®‰è£…è¿™ä¸ªåŒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install jsoncpp</span><br></pre></td></tr></table></figure><p>ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œå®‰è£…<code>jsoncpp-devel.x86_64</code>æ˜¾ç¤ºæ‰¾ä¸åˆ°ç›¸å…³åŒ…</p><h2 id="1-1-ä»€ä¹ˆæ˜¯jsonï¼Ÿ"><a href="#1-1-ä»€ä¹ˆæ˜¯jsonï¼Ÿ" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯jsonï¼Ÿ"></a>1.1 ä»€ä¹ˆæ˜¯jsonï¼Ÿ</h2><p>jsonæ˜¯ä¸€ä¸ªkvé”®å€¼å¯¹çš„åºåˆ—åŒ–æ–¹å¼ï¼Œæ¯ä¸€ä¸ªkeyéƒ½å¯¹åº”äº†ä¸€ä¸ªvalue</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;value&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™å°±æœ‰ç‚¹ç±»ä¼¼c++ä¸­çš„mapï¼Œä¸è¿‡jsonèƒ½åšçš„æ›´å¤š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;data1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;value&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;data2&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;key1&quot;</span><span class="punctuation">:</span><span class="string">&quot;value1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;key2&quot;</span><span class="punctuation">:</span><span class="string">&quot;value2&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;key3&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;key4&quot;</span><span class="punctuation">:</span><span class="keyword">true</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>jsonå¯ä»¥åœ¨é‡Œé¢åµŒå¥—æ·»åŠ æ›´å¤šçš„å†…å®¹ï¼Œä¸ç®¡æ˜¯å­—ç¬¦ä¸²è¿˜æ˜¯æ•´å½¢ï¼Œè¿˜èƒ½æ˜¯boolç±»å‹çš„<code>true/false</code>ï¼›</p><p>å› ä¸ºjsonå¯¹ååºåˆ—åŒ–åºåˆ—åŒ–çš„æ§åˆ¶å¾ˆæ˜¯ä¸é”™ï¼Œå¯è¯»æ€§ä¹Ÿå¾ˆå¥½ï¼Œæ‰€ä»¥è¢«å¹¿æ³›ä½¿ç”¨ï¼</p><p>ç›¸æ¯”äºè‡ªå·±å†™ä¸€ä¸ªåºåˆ—åŒ–æ–¹å¼ï¼Œç›´æ¥ç”¨åˆ«äººçš„è½®å­ï¼Œä¹Ÿä¸é”™ğŸ‘»</p><p>ç±»ä¼¼çš„åºåˆ—åŒ–æ¡†æ¶è¿˜æœ‰<code>xml</code></p><h1 id="2-ä»£ç ç¤ºä¾‹"><a href="#2-ä»£ç ç¤ºä¾‹" class="headerlink" title="2.ä»£ç ç¤ºä¾‹"></a>2.ä»£ç ç¤ºä¾‹</h1><h2 id="2-1-åºåˆ—åŒ–"><a href="#2-1-åºåˆ—åŒ–" class="headerlink" title="2.1 åºåˆ—åŒ–"></a>2.1 åºåˆ—åŒ–</h2><p>ç›¸æ¯”æˆ‘ä»¬è‡ªå·±å†™çš„åºåˆ—åŒ–æ–¹å¼ï¼Œjsonçš„ä½¿ç”¨ç®€å•å¤šäº†</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">serialize</span><span class="params">(std::string&amp; out)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     <span class="comment">//ä½¿ç”¨jsoncppçš„ä»£ç </span></span><br><span class="line">    Json::Value root;</span><br><span class="line">    root[<span class="string">&quot;x&quot;</span>] = _x;</span><br><span class="line">    root[<span class="string">&quot;y&quot;</span>] = _y;</span><br><span class="line">    root[<span class="string">&quot;op&quot;</span>] = _ops;</span><br><span class="line"></span><br><span class="line">    Json::FastWriter fw; <span class="comment">// è¿™ä¸ªæ˜¯å†™æˆä¸€è¡Œï¼Œå¯¹äºè®¡ç®—æœºæ¥è¯´å¤„ç†çš„è´Ÿæ‹…å°</span></span><br><span class="line">    <span class="comment">// Json::StyledWriter fw; // è¿™ä¸ªä¼šè¿›è¡Œæ ¼å¼åŒ–ï¼Œæ›´å¥½çœ‹ï¼ˆä½†æ˜¯å†…å®¹æ²¡å·®è·ï¼‰</span></span><br><span class="line">    out = fw.<span class="built_in">write</span>(root);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äº<code>fw.write(root)</code>ï¼Œå…¶è¿”å›å€¼æ˜¯ä¸€ä¸ªstringï¼Œä¹Ÿæ–¹ä¾¿æˆ‘ä»¬æ¥æ”¶</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e87f6032516.png"                      alt="image-20230212135543386"                ></p><p>å…¶ä¸­<code>FastWriter</code>å’Œ<code>StyledWriter</code>æœ‰ä¸€ç‚¹åŒºåˆ«ï¼Œå¦‚ä¸‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//FastWriter</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;value&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">//StyledWriter</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;value&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç®€å•æ¥è¯´ï¼Œ<code>StyledWriter</code>ä¼šå¯¹æˆ‘ä»¬çš„kvé”®å€¼å¯¹è¿›è¡Œæ ¼å¼åŒ–ï¼Œæ›´æ–¹ä¾¿äººç±»çš„é˜…è¯»ã€‚è€Œ<code>FastWriter</code>æ˜¯ç›´æ¥å†™æˆä¸€æ•´è¡Œï¼Œåœ¨ä¼ è¾“çš„æ—¶å€™ä¼šæ–¹ä¾¿ä¸€ç‚¹ï¼ˆå› ä¸ºä¸éœ€è¦<code>\n</code>ï¼‰</p><h2 id="2-2-ååºåˆ—åŒ–"><a href="#2-2-ååºåˆ—åŒ–" class="headerlink" title="2.2 ååºåˆ—åŒ–"></a>2.2 ååºåˆ—åŒ–</h2><p>ååºåˆ—åŒ–éœ€è¦ä¸€ä¸ªReaderæ¥è¯»å–å­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶å†…å®¹æ ¹æ®é”®å€¼éšå°„ç»™æˆå‘˜å˜é‡</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">deserialize</span><span class="params">(<span class="type">const</span> std::string &amp;in)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//json</span></span><br><span class="line">    Json::Value root;</span><br><span class="line">    Json::Reader rd;</span><br><span class="line">    rd.<span class="built_in">parse</span>(in, root);</span><br><span class="line">    _x = root[<span class="string">&quot;x&quot;</span>].<span class="built_in">asInt</span>();</span><br><span class="line">    _y = root[<span class="string">&quot;y&quot;</span>].<span class="built_in">asInt</span>();</span><br><span class="line">    _ops = root[<span class="string">&quot;op&quot;</span>].<span class="built_in">asInt</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3-æµ‹è¯•"><a href="#3-æµ‹è¯•" class="headerlink" title="3.æµ‹è¯•"></a>3.æµ‹è¯•</h1><p>å› ä¸ºjsoncppæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œæˆ‘ä»¬é“¾æ¥çš„æ—¶å€™éœ€è¦åŠ ä¸Šå‘½ä»¤<code>-ljsoncpp</code></p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">tcpServer:tcpServer.cpp</span></span><br><span class="line">g++ -o <span class="variable">$@</span> <span class="variable">$^</span> -std=c++11 -lpthread -ljsoncpp</span><br></pre></td></tr></table></figure><p>å‘é€æ¶ˆæ¯åï¼Œå¯ä»¥çœ‹åˆ°ï¼Œjsonå¸®æˆ‘ä»¬æ ¼å¼åŒ–ä¸ºå¦‚ä¸‹å½¢å¼çš„å­—ç¬¦ä¸²</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;op&quot;</span><span class="punctuation">:</span><span class="number">43</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;op&quot;</span><span class="punctuation">:</span><span class="number">43</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">333</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">234</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e8829420bc4.png"                      alt="image-20230212140924067"                ></p><h1 id="4-gccç»™äºˆå®å®šä¹‰"><a href="#4-gccç»™äºˆå®å®šä¹‰" class="headerlink" title="4.gccç»™äºˆå®å®šä¹‰"></a>4.gccç»™äºˆå®å®šä¹‰</h1><p>ä¸ºäº†æ–¹ä¾¿å¯¹åºåˆ—åŒ–é‡‡ç”¨çš„æ–¹å¼è¿›è¡Œæ§åˆ¶ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨äº†é¢„å¤„ç†æŒ‡ä»¤<code>ifdef/endif</code>æ¥è¿›è¡Œåˆ¤æ–­ï¼Œåªè¦æˆ‘ä»¬åœ¨æ–‡ä»¶å¤´å®šä¹‰äº†<code>MYPROTOCOL</code>ï¼Œè¿™é‡Œå°±ä¼šé‡‡ç”¨æˆ‘ä»¬è‡ªå·±çš„å†™çš„åºåˆ—åŒ–æ–¹å¼ï¼Œå¦åˆ™é‡‡ç”¨json</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MYPROTOCOL 1  <span class="comment">//å¦‚æœdefineäº†è¿™ä¸ªï¼Œé‚£å°±ä½¿ç”¨è‡ªå·±çš„ä»£ç </span></span></span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e8bdcb448d6.png"                      alt="image-20230212182113854"                ></p><h2 id="4-1-å‘½ä»¤è¡Œ"><a href="#4-1-å‘½ä»¤è¡Œ" class="headerlink" title="4.1 å‘½ä»¤è¡Œ"></a>4.1 å‘½ä»¤è¡Œ</h2><p>ä½†æ˜¯åœ¨æ–‡ä»¶é‡Œé¢ä¿®æ”¹defineè¿˜æ˜¯ä¸å¤ªæ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é‡‡ç”¨gccçš„å‘½ä»¤è¡Œå‚æ•°çš„æ–¹å¼ï¼Œè¿›è¡Œdefineçš„æ’å…¥ï¼ˆè¿™ä¹ˆåšä¹‹å‰ï¼Œè¦å…ˆåˆ é™¤æ–‡ä»¶ä¸­å¯¹<code>MYPROTOCOL</code>çš„defineï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g++ -DMYPROTOCOL tcpServer.cpp -o tcpServer -lpthread -ljsoncpp</span><br><span class="line">g++ -DMYPROTOCOL tcpClient.cpp -o tcpClient -lpthread -ljsoncpp</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸åŠ ç¼–è¯‘æŒ‡ä»¤ç¼–è¯‘å‡ºæ¥çš„æœåŠ¡å™¨ï¼Œé‡‡ç”¨çš„æ˜¯jsonçš„æ–¹å¼æ¥åºåˆ—åŒ–</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e8bed2edae3.png"                      alt="image-20230212182627766"                ></p><p>æ·»åŠ äº†ä¹‹åï¼Œå°±æ˜¯ç”¨æˆ‘ä»¬è‡ªå·±å†™çš„åºåˆ—åŒ–æ–¹å¼æ¥åºåˆ—åŒ–äº†</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e8bf7e58fae.png"                      alt="image-20230212182919150"                ></p><h2 id="4-2-makefile"><a href="#4-2-makefile" class="headerlink" title="4.2 makefile"></a>4.2 makefile</h2><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹makefileæ¥å®ç°è¿™ä¸€ç‚¹</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><span class="keyword">.PHONY</span>:all</span></span><br><span class="line"><span class="section">all:tcpClient tcpServer</span></span><br><span class="line">MYSELF=-DMYPROTOCOL</span><br><span class="line"></span><br><span class="line"><span class="section">tcpClient: tcpClient.cpp</span></span><br><span class="line">g++ <span class="variable">$(MYSELF)</span> -o <span class="variable">$@</span> <span class="variable">$^</span> -std=c++11 -lpthread -ljsoncpp</span><br><span class="line"><span class="section">tcpServer:tcpServer.cpp</span></span><br><span class="line">g++ <span class="variable">$(MYSELF)</span> -o <span class="variable">$@</span> <span class="variable">$^</span> -std=c++11 -lpthread -ljsoncpp</span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>:clean</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">rm -f tcpClient tcpServer</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬éœ€è¦ç”¨è‡ªå·±åè®®çš„æ—¶å€™ï¼Œå°±åœ¨æœ€å‰é¢åŠ ä¸Š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MYSELF=-DMYPROTOCOL</span><br></pre></td></tr></table></figure><p>å¦åˆ™ç›´æ¥<strong>åˆ é™¤</strong>è¿™ä¸ªå®šä¹‰ï¼Œæˆ–è€…æ³¨é‡Šæ‰åé¢çš„å†…å®¹ï¼Œå°±èƒ½é‡‡ç”¨jsoncpp</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MYSELF=<span class="comment">#-DMYPROTOCOL</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±æ–¹ä¾¿ä¸€äº›äº†</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e8c0cf35f88.png"                      alt="image-20230212183456024"                ></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä»¥tcpServerçš„&lt;strong&gt;è®¡ç®—å™¨&lt;/strong&gt;æœåŠ¡ä¸ºä¾‹ï¼Œå®ç°ç”¨jsoncppæ¥è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–&lt;/p&gt;</summary>
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="ç½‘ç»œ" scheme="https://blog.musnow.top/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>ã€ç½‘ç»œã€‘è‡ªå®šä¹‰åè®® | åºåˆ—åŒ–å’Œååºåˆ—åŒ– | ä»¥tcpServerä¸ºä¾‹</title>
    <link href="https://blog.musnow.top/2023/02/11/Linux/32tcp%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8D%8F%E8%AE%AE/"/>
    <id>https://blog.musnow.top/2023/02/11/Linux/32tcp%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8D%8F%E8%AE%AE/</id>
    <published>2023-02-11T04:30:55.000Z</published>
    <updated>2023-03-11T11:25:36.240Z</updated>
    
    <content type="html"><![CDATA[<p>ä»¥tcpServerçš„<strong>è®¡ç®—å™¨</strong>æœåŠ¡ä¸ºä¾‹ï¼Œå®ç°ä¸€ä¸ªè‡ªå®šä¹‰åè®®</p><span id="more"></span><blockquote><p>é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œè¯·å…ˆé˜…è¯» <a href="https://blog.musnow.top/2023/02/05/note_linux/29tcp%E4%BB%A3%E7%A0%81/">tcpServer</a></p><p>æœ¬æ–‡å®Œæ•´ä»£ç è¯¦è§ <a class="link"   href="https://gitee.com/musnow/raspberry-practice/tree/master/code" >Gitee<i class="fas fa-external-link-alt"></i></a></p></blockquote><h1 id="1-é‡è°ˆtcp"><a href="#1-é‡è°ˆtcp" class="headerlink" title="1.é‡è°ˆtcp"></a>1.é‡è°ˆtcp</h1><p>æ³¨æ„ï¼Œå½“ä¸‹æ‰€å¯¹tcpçš„æè¿°éƒ½æ˜¯<strong>ä»¥ç®€å•ã€æ–¹ä¾¿ç†è§£</strong>èµ·è§ï¼Œåç»­ä¼šå¯¹tcpåè®®è¿›è¡Œæ·±å…¥è§£è¯»</p><h2 id="1-1-é“¾æ¥"><a href="#1-1-é“¾æ¥" class="headerlink" title="1.1 é“¾æ¥"></a>1.1 é“¾æ¥</h2><p>æˆ‘ä»¬çŸ¥é“ï¼Œtcpæ˜¯é¢å‘è¿æ¥çš„ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¦å…ˆå»ºç«‹é“¾æ¥ï¼Œæ‰èƒ½å¼€å§‹é€šä¿¡</p><ul><li>åœ¨é“¾æ¥è¿‡ç¨‹ä¸­ï¼Œtcpé‡‡ç”¨ä¸‰æ¬¡æ¡æ‰‹</li><li>åœ¨æ–­çº¿è¿‡ç¨‹ä¸­ï¼Œtcpé‡‡ç”¨å››æ¬¡æŒ¥æ‰‹</li></ul><p>ä¸¾ä¸ªæ—¥å¸¸ç”Ÿæ´»ä¸­çš„æ —å­ï¼Œå¸®åŠ©ç†è§£3æ¬¡æ¡æ‰‹å’Œ4æ¬¡æŒ¥æ‰‹</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e7000c46813.png"                      alt="image-20230211103933999"                ></p><h2 id="1-2-ä¿¡æ¯å‘é€"><a href="#1-2-ä¿¡æ¯å‘é€" class="headerlink" title="1.2 ä¿¡æ¯å‘é€"></a>1.2 ä¿¡æ¯å‘é€</h2><blockquote><p>å‡å¦‚æˆ‘ä»¬ç°åœ¨éœ€è¦å‘é€ç»“æ„åŒ–æ•°æ®ï¼Œé‚£åº”è¯¥æ€ä¹ˆåŠï¼Ÿ</p></blockquote><p>æˆ‘ä»¬çŸ¥é“ï¼Œtcpæ˜¯é¢å‘å­—èŠ‚æµçš„ï¼Œä¹Ÿå°±æ˜¯å…¶èƒ½å¤Ÿå‘é€ä»»æ„æ•°æ®ã€‚ä¹Ÿèƒ½å¤Ÿå‘é€<strong>Cè¯­è¨€ç»“æ„ä½“</strong>çš„äºŒè¿›åˆ¶æ•°æ®ï¼›</p><ul><li>ä½†èƒ½å‘é€ï¼Œå°±ä»£è¡¨æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå¹²å—ï¼Ÿ</li><li>ç­”æ¡ˆè‡ªç„¶æ˜¯<strong>ä¸è¡Œ</strong>ï¼</li></ul><p>ä¸åŒå¹³å°ï¼Œå¯¹<a href="https://blog.musnow.top/2022/01/28/note_c/40%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B%E8%AF%A6%E8%A7%A3/">ç»“æ„ä½“å¯¹é½</a>çš„é…ç½®ä¸åŒï¼Œå¤§å°ç«¯ä¸åŒï¼Œå…¶æœ€ç»ˆå¯¹æˆ‘ä»¬å­—èŠ‚æµçš„è§£æä¹Ÿå°±ä¸ä¸€æ ·ã€‚å¦‚æœé‡‡ç”¨ç›´æ¥å‘é€ç»“æ„ä½“æ•°æ®çš„æ–¹å¼æ¥é€šä¿¡ï¼Œé€‚é…æ€§æä½ï¼Œæˆ‘ä»¬çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½ä¼šè¢«é™åˆ¶åœ¨å½“å‰çš„ç³»ç»Ÿç¯å¢ƒä¸­è¿è¡Œï¼›</p><p>å¯æ˜¯ï¼Œå“ªæ€•æ˜¯åŒä¸€ä¸ªç³»ç»Ÿï¼Œå…¶å†…éƒ¨å¯¹å¤§å°ç«¯çš„é…ç½®ä¹Ÿæœ‰å¯èƒ½æ”¹å˜ï¼åˆ°æ—¶å€™æˆ‘ä»¬çš„ä»£ç ææ€•å°±æ— æ³•è¿è¡Œäº†ï¼</p><p>åŒç†ï¼Œåœ¨å½“åˆç¼–å†™<a class="link"   href="https://gitee.com/musnow/learn_c_code/tree/master/DAY_Code/DAY038%20%E9%80%9A%E8%AE%AF%E5%BD%95%E4%BB%A3%E7%A0%81" >Cè¯­è¨€é€šè®¯å½•<i class="fas fa-external-link-alt"></i></a>çš„ä»£ç çš„æ—¶å€™ï¼Œä¹Ÿä¸èƒ½é‡‡ç”¨ç›´æ¥å°†ç»“æ„ä½“æ•°æ®å†™å…¥æ–‡ä»¶çš„æ–¹å¼ã€‚åç»­ä»£ç å‡çº§ã€ç¯å¢ƒæ”¹å˜ï¼Œ<strong>éƒ½å¯èƒ½å¯¼è‡´æˆ‘ä»¬å­˜åœ¨æ–‡ä»¶ä¸­çš„æ•°æ®å¤±æ•ˆ</strong>ï¼Œè¿™è‚¯å®šæ˜¯æˆ‘ä»¬ä¸å¸Œæœ›çœ‹åˆ°çš„æƒ…å†µã€‚</p><p>æ‰€ä»¥ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±åº”è¯¥å°†æ•°æ®è¿›è¡Œ<code>åºåˆ—åŒ–</code>ä¹‹åå†å‘é€ï¼Œå®¢æˆ·ç«¯æ¥æ”¶åˆ°ä¿¡æ¯åï¼Œè¿›è¡Œ<code>ååºåˆ—åŒ–</code>è§£æå‡ºæ•°æ®ï¼</p><h1 id="2-åºåˆ—åŒ–å’Œååºåˆ—åŒ–"><a href="#2-åºåˆ—åŒ–å’Œååºåˆ—åŒ–" class="headerlink" title="2.åºåˆ—åŒ–å’Œååºåˆ—åŒ–"></a>2.åºåˆ—åŒ–å’Œååºåˆ—åŒ–</h1><h2 id="2-1-ç®€ä»‹"><a href="#2-1-ç®€ä»‹" class="headerlink" title="2.1 ç®€ä»‹"></a>2.1 ç®€ä»‹</h2><p>æ‰€è°“åºåˆ—åŒ–ï¼Œå°±æ˜¯å°†ç»“æ„åŒ–çš„æ•°æ®ï¼ˆå¯ä»¥æš‚æ—¶ç†è§£ä¸ºcçš„ç»“æ„ä½“ï¼‰è½¬æ¢æˆå­—ç¬¦ä¸²çš„æ–¹å¼ï¼Œå‘é€å‡ºå»</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">date</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">int</span> year;</span><br><span class="line">    <span class="type">int</span> month;</span><br><span class="line">    <span class="type">int</span> day;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ä¸Šé¢è¿™ä¸ªæ—¥æœŸç»“æ„ä½“ï¼Œæˆ‘ä»¬è¦æƒ³å°†å…¶åºåˆ—åŒ–ï¼Œå°±å¯ä»¥ç”¨ä¸€ä¸ªå¾ˆç®€å•çš„æ–¹å¼æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆåºåˆ—åŒ–ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">year-month-day</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯æ”¶åˆ°è¿™ä¸ªå­—ç¬¦ä¸²ä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡æŸ¥æ‰¾åˆ†éš”ç¬¦<code>-</code>çš„æ–¹å¼ï¼Œå–å‡ºä¸‰ä¸ªå˜é‡ï¼Œå°†å…¶è½¬æˆintåå­˜æ”¾å›ç»“æ„ä½“ï¼ˆååºåˆ—åŒ–ï¼‰</p><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±ç®—æ˜¯è§„å®šäº†ä¸€ä¸ªåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç®€å•çš„<strong>åè®®</strong>ï¼</p><hr><h2 id="2-2-ç¼–ç è§£ç "><a href="#2-2-ç¼–ç è§£ç " class="headerlink" title="2.2 ç¼–ç è§£ç "></a>2.2 ç¼–ç è§£ç </h2><p>è¿™é‡Œè¿˜ä¼šå‡ºç°å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘è¦æ€ä¹ˆçŸ¥é“æˆ‘å·²ç»<strong>è¯»å–å®Œæ¯•</strong>äº†ä¸€ä¸ªåºåˆ—åŒ–åçš„æ•°æ®å‘¢ï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2000-12-10</span><br><span class="line">10000-01-01</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šï¼Œå‡è®¾æœ‰ä¸€å¤©ï¼Œæˆ‘ä»¬çš„å¹´å˜æˆäº†äº”ä½æ•°ï¼›è¿™æ—¶å€™ï¼ŒæœåŠ¡ç«¯è¦æ€ä¹ˆçŸ¥é“è‡ªå·±æ˜¯å¦è¯»å–å®Œæ¯•äº†ä¸€ä¸ªå®Œæ•´çš„åºåˆ—åŒ–æ•°æ®å‘¢ï¼Ÿ</p><p>è¿™å°±éœ€è¦æˆ‘ä»¬åšå¥½è§„å®šï¼Œ<strong>å°†å‰nå­—èŠ‚ä½œä¸ºæ ‡è¯†é•¿åº¦çš„æ•°æ®</strong>ã€‚æ¥æ”¶åˆ°æ•°æ®åï¼Œå…ˆå–å‡ºå‰nä¸ªå­—èŠ‚ï¼Œè¯»å–é“æ­¤æ¬¡æ¶ˆæ¯çš„é•¿åº¦mï¼Œå†å¾€åè¯»å–mä¸ªå­—èŠ‚çš„æ•°æ®ï¼ŒæˆåŠŸå–å‡ºå®Œæ•´çš„å­—ç¬¦ä¸²;</p><ul><li>è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç§°ä½œ<strong>ç¼–ç å’Œè§£ç </strong>çš„è¿‡ç¨‹</li></ul><p>ä¸ºäº†åŒºåˆ†æ ‡è¯†é•¿åº¦çš„æ•°æ®å’Œå®é™…éœ€è¦çš„åºåˆ—åŒ–å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¹‹ä¸­åŠ ä¸Šåˆ†éš”ç¬¦<code>\t</code>ï¼›ä½†è¿™ä¹Ÿéœ€è¦æˆ‘ä»¬ç¡®è®¤ï¼Œä¼ è¾“çš„æ•°æ®æœ¬èº«ä¸èƒ½å¸¦ä¸Š<code>\t</code>ï¼Œå¦åˆ™ä¼šäº§ç”Ÿä¸€ç³»åˆ—çš„é—®é¢˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">10\t2000-12-10\t</span><br><span class="line">11\t10000-01-01\t</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šçš„è¿™ä¸€ç³»åˆ—å·¥ä½œï¼Œéƒ½æ˜¯<code>åè®®å®šåˆ¶</code>çš„ä¸€éƒ¨åˆ†ï¼æˆ‘ä»¬ç»™æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è§„å®šäº†ä¸€ä¸ªåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ–¹å¼ï¼Œè®©äºŒè€…é€šä¿¡è§„é¿æ‰äº†å¹³å°çš„é™åˆ¶ã€‚æ¯•ç«Ÿä»»ä½•å¹³å°å¯¹<strong>å­—ç¬¦ä¸²</strong>è§£ç å‡ºæ¥çš„æ•°æ®éƒ½ä¼šæ˜¯ç›¸åŒçš„ï¼</p><p>ä¸‹é¢å°±ç”¨ä¸€ä¸ª<strong>è®¡ç®—å™¨</strong>çš„æœåŠ¡ï¼Œæ¥æ¼”ç¤ºä¸€ä¸‹å§ğŸ˜</p><h1 id="3-è®¡ç®—å™¨æœåŠ¡"><a href="#3-è®¡ç®—å™¨æœåŠ¡" class="headerlink" title="3.è®¡ç®—å™¨æœåŠ¡"></a>3.è®¡ç®—å™¨æœåŠ¡</h1><p>å› ä¸ºæœ¬æ–‡çš„é‡å¿ƒæ˜¯å¯¹åè®®å®šåˆ¶çš„æ¼”ç¤ºï¼Œæ‰€ä»¥è¿™é‡Œçš„è®¡ç®—å™¨<em>ä¸è€ƒè™‘è¿ç»­æ“ä½œç¬¦</em>çš„æƒ…å†µï¼Œ</p><h2 id="3-1-åè®®å®šåˆ¶"><a href="#3-1-åè®®å®šåˆ¶" class="headerlink" title="3.1 åè®®å®šåˆ¶"></a>3.1 åè®®å®šåˆ¶</h2><p>è¦æƒ³å®ç°ä¸€ä¸ªè®¡ç®—å™¨ï¼Œæˆ‘ä»¬é¦–å…ˆè¦ææ˜ç™½è®¡ç®—å™¨æœ‰å‡ ä¸ªæˆå‘˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x+y</span><br><span class="line">x/y</span><br><span class="line">x*y</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªè®¡ç®—å™¨åªéœ€è¦3ä¸ªæˆå‘˜ï¼Œåˆ†åˆ«æ˜¯ä¸¤ä¸ªæ“ä½œæ•°å’Œä¸€ä¸ªè¿ç®—ç¬¦ï¼Œå°±èƒ½å¼€å§‹è®¡ç®—ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†è¿™é‡Œçš„ä¸‰ä¸ªå­—æ®µè®¾è®¡æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ç°åºåˆ—åŒ–ï¼›</p><p>æ¯”å¦‚æˆ‘ä»¬åº”è¯¥è§„å®šåºåˆ—åŒ–ä¹‹åçš„æ•°æ®åº”è¯¥æ˜¯å¦‚ä¸‹çš„ï¼Œä¸¤ä¸ªæ“ä½œæ•°å’Œæ“ä½œç¬¦ä¹‹é—´åº”è¯¥è¦æœ‰<strong>ç©ºæ ¼</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a + b</span><br></pre></td></tr></table></figure><p>å†åœ¨å¼€å¤´æ·»åŠ ä¸Šæ•°æ®é•¿åº¦çš„æ ‡è¯†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ•°æ®é•¿åº¦\tå…¬å¼\t</span><br><span class="line"></span><br><span class="line">7\t10 + 20\t</span><br><span class="line">8\t100 / 30\t</span><br><span class="line">9\t300 - 200\t</span><br></pre></td></tr></table></figure><p>å¯¹äºæœåŠ¡ç«¯ï¼Œæˆ‘ä»¬éœ€è¦è¿”å›ä¸¤ä¸ªå‚æ•°ï¼šçŠ¶æ€ç å’Œç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é€€å‡ºçŠ¶æ€ ç»“æœ</span><br></pre></td></tr></table></figure><p>å¦‚æœé€€å‡ºçŠ¶æ€ä¸ä¸º0ï¼Œåˆ™ä»£è¡¨å‡ºç°é”™è¯¯ï¼Œç»“æœæ— æ•ˆï¼›åªæœ‰é€€å‡ºç»“æœä¸º0ï¼Œç»“æœæ‰æ˜¯æœ‰æ•ˆçš„ã€‚</p><p>åŒæ ·çš„ï¼Œä¹Ÿéœ€è¦ç»™æœåŠ¡å™¨çš„åºåˆ—åŒ–å­—ç¬¦ä¸²æ·»åŠ ä¸Šæ•°æ®çš„é•¿åº¦</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ•°æ®é•¿åº¦\té€€å‡ºçŠ¶æ€ ç»“æœ\t</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±æå®šäº†ä¸€ä¸ªè®¡ç®—å™¨çš„è‡ªå®šä¹‰åè®®ï¼›</p><h2 id="3-2-æˆå‘˜"><a href="#3-2-æˆå‘˜" class="headerlink" title="3.2 æˆå‘˜"></a>3.2 æˆå‘˜</h2><p>ä¾ç…§å¦‚ä¸Šçš„åè®®ï¼Œå…ˆæŠŠè¯·æ±‚å’Œè¿”å›çš„æˆå‘˜å˜é‡å†™å¥½</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Request</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> _x;</span><br><span class="line">    <span class="type">int</span> _y;</span><br><span class="line">    <span class="type">char</span> _ops;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Response</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> _exitCode; <span class="comment">//è®¡ç®—æœåŠ¡çš„é€€å‡ºç </span></span><br><span class="line"><span class="type">int</span> _result;  <span class="comment">// ç»“æœ</span></span><br><span class="line">&#125;;  </span><br></pre></td></tr></table></figure><p>è¿™äº›æˆå‘˜å˜é‡éƒ½è®¾ç½®ä¸ºå…¬æœ‰ï¼Œæ–¹ä¾¿åœ¨taské‡Œé¢è¿›è¡Œå¤„ç†ï¼ˆå¦åˆ™å°±éœ€è¦å†™getå‡½æ•°ï¼Œå¾ˆéº»çƒ¦ï¼‰</p><p>åŒæ—¶ï¼Œæœ€å¥½è¿˜æ˜¯æŠŠåè®®ä¸­çš„åˆ†éš”ç¬¦ç»™å®šä¹‰å‡ºæ¥ï¼Œæ–¹ä¾¿åç»­ç»Ÿä¸€ä½¿ç”¨oræ›´æ”¹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> CRLF <span class="string">&quot;\t&quot;</span>   <span class="comment">//åˆ†éš”ç¬¦</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CRLF_LEN strlen(CRLF) <span class="comment">//åˆ†éš”ç¬¦é•¿åº¦</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPACE <span class="string">&quot; &quot;</span>   <span class="comment">//ç©ºæ ¼</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPACE_LEN strlen(SPACE) <span class="comment">//ç©ºæ ¼é•¿åº¦</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> OPS <span class="string">&quot;+-*/%&quot;</span> <span class="comment">//è¿ç®—ç¬¦</span></span></span><br></pre></td></tr></table></figure><h2 id="3-3-ç¼–ç è§£ç "><a href="#3-3-ç¼–ç è§£ç " class="headerlink" title="3.3 ç¼–ç è§£ç "></a>3.3 ç¼–ç è§£ç </h2><p>å¯¹äºè¯·æ±‚å’Œå›åº”æ¥è¯´ï¼Œç¼–è§£ç çš„æ“ä½œæ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å¾€å­—ç¬¦ä¸²çš„å¼€å¤´æ·»åŠ ä¸Šé•¿åº¦å’Œåˆ†éš”ç¬¦</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é•¿åº¦\tåºåˆ—åŒ–å­—ç¬¦ä¸²\t</span><br></pre></td></tr></table></figure><p>è§£ç å°±æ˜¯å°†é•¿åº¦å’Œåˆ†éš”ç¬¦å»æ‰ï¼Œåªè§£æå‡ºåºåˆ—åŒ–å­—ç¬¦ä¸²</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åºåˆ—åŒ–å­—ç¬¦ä¸²</span><br></pre></td></tr></table></figure><p>ç¼–ç è§£ç çš„æ•´ä¸ªè¿‡ç¨‹åœ¨æ³¨é‡Šé‡Œé¢éƒ½å†™æ˜äº†ğŸ˜ä¸ºäº†æ–¹ä¾¿è¯·æ±‚å’Œå›åº”å»ä½¿ç”¨ï¼Œç›´æ¥æ”¾åˆ°å¤–å¤´ï¼Œä¸åšç±»å†…å°è£…</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‚æ•°lenä¸ºinçš„é•¿åº¦ï¼Œæ˜¯ä¸€ä¸ªè¾“å‡ºå‹å‚æ•°ã€‚å¦‚æœä¸º0ä»£è¡¨err</span></span><br><span class="line"><span class="function">std::string <span class="title">decode</span><span class="params">(std::string&amp; in,<span class="type">size_t</span>*len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">assert</span>(len);<span class="comment">//å¦‚æœé•¿åº¦ä¸º0æ˜¯é”™è¯¯çš„</span></span><br><span class="line">    <span class="comment">// 1.ç¡®è®¤inçš„åºåˆ—åŒ–å­—ç¬¦ä¸²å®Œæ•´ï¼ˆåˆ†éš”ç¬¦ï¼‰</span></span><br><span class="line">    *len=<span class="number">0</span>;</span><br><span class="line">    <span class="type">size_t</span> pos = in.<span class="built_in">find</span>(CRLF);<span class="comment">//æŸ¥æ‰¾åˆ†éš”ç¬¦</span></span><br><span class="line">    <span class="comment">//æŸ¥æ‰¾ä¸åˆ°ï¼Œerr</span></span><br><span class="line">    <span class="keyword">if</span>(pos == std::string::npos)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;<span class="comment">//è¿”å›ç©ºä¸²</span></span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="comment">// 2.æœ‰åˆ†éš”ç¬¦ï¼Œåˆ¤æ–­é•¿åº¦æ˜¯å¦è¾¾æ ‡</span></span><br><span class="line">    <span class="comment">// æ­¤æ—¶posä¸‹æ ‡æ­£å¥½å°±æ˜¯æ ‡è¯†å¤§å°çš„å­—ç¬¦é•¿åº¦</span></span><br><span class="line">    std::string inLenStr = in.<span class="built_in">substr</span>(<span class="number">0</span>,pos);<span class="comment">//æå–å­—ç¬¦ä¸²é•¿åº¦</span></span><br><span class="line">    <span class="type">size_t</span> inLen = <span class="built_in">atoi</span>(inLenStr.<span class="built_in">c_str</span>());<span class="comment">//è½¬int</span></span><br><span class="line">    <span class="type">size_t</span> left = in.<span class="built_in">size</span>() - inLenStr.<span class="built_in">size</span>()- <span class="number">2</span>*CRLF_LEN;<span class="comment">//å‰©ä¸‹çš„å­—ç¬¦é•¿åº¦</span></span><br><span class="line">    <span class="keyword">if</span>(left&lt;inLen)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>; <span class="comment">//å‰©ä¸‹çš„é•¿åº¦æ²¡æœ‰è¾¾åˆ°æ ‡æ˜çš„é•¿åº¦</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.èµ°åˆ°æ­¤å¤„ï¼Œå­—ç¬¦ä¸²å®Œæ•´ï¼Œå¼€å§‹æå–åºåˆ—åŒ–å­—ç¬¦ä¸²</span></span><br><span class="line">    std::string ret = in.<span class="built_in">substr</span>(pos+CRLF_LEN,inLen);</span><br><span class="line">    *len = inLen;</span><br><span class="line">    <span class="comment">// 4.å› ä¸ºinä¸­å¯èƒ½è¿˜æœ‰å…¶ä»–çš„æŠ¥æ–‡ï¼ˆä¸‹ä¸€æ¡ï¼‰</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥éœ€è¦æŠŠå½“å‰çš„æŠ¥æ–‡ä»inä¸­åˆ é™¤ï¼Œæ–¹ä¾¿ä¸‹æ¬¡decodeï¼Œé¿å…äºŒæ¬¡è¯»å–</span></span><br><span class="line">    <span class="type">size_t</span> rmLen = inLenStr.<span class="built_in">size</span>() + ret.<span class="built_in">size</span>() + <span class="number">2</span>*CRLF_LEN;</span><br><span class="line">    in.<span class="built_in">erase</span>(<span class="number">0</span>,rmLen);</span><br><span class="line">    <span class="comment">// 5.è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼–ç ä¸éœ€è¦ä¿®æ”¹æºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥constã€‚å‚æ•°lenä¸ºinçš„é•¿åº¦</span></span><br><span class="line"><span class="function">std::string <span class="title">encode</span><span class="params">(<span class="type">const</span> std::string&amp; in,<span class="type">size_t</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::string ret = std::<span class="built_in">to_string</span>(len);<span class="comment">//å°†é•¿åº¦è½¬ä¸ºå­—ç¬¦ä¸²æ·»åŠ åœ¨æœ€å‰é¢ï¼Œä½œä¸ºæ ‡è¯†</span></span><br><span class="line">    ret+=CRLF;</span><br><span class="line">    ret+=in;</span><br><span class="line">    ret+=CRLF;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-4-request"><a href="#3-4-request" class="headerlink" title="3.4 request"></a>3.4 request</h2><p>ç¼–ç è§£ç å†™å¥½äº†ï¼Œå…ˆæ¥å¤„ç†æ¯”è¾ƒéº»çƒ¦çš„è¯·æ±‚éƒ¨åˆ†ï¼›è¯´éº»çƒ¦å§ï¼Œå…¶å®å¤§å¤šæ•°ä¹Ÿæ˜¯c++çš„stringæ“ä½œï¼Œè¦ç†Ÿç»ƒè¿ç”¨stringçš„å„ç±»æˆå‘˜å‡½æ•°ï¼Œæ‰èƒ½å¾ˆå¥½çš„å®ç°</p><h3 id="3-4-1-æ„é€ "><a href="#3-4-1-æ„é€ " class="headerlink" title="3.4.1 æ„é€ "></a>3.4.1 æ„é€ </h3><p>æ¯”è¾ƒé‡è¦çš„æ˜¯è¿™ä¸ªæ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦å°†ç”¨æˆ·çš„è¾“å…¥è½¬æˆå†…éƒ¨çš„ä¸‰ä¸ªæˆå‘˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ·å¯èƒ½è¾“å…¥x+yï¼Œx+ yï¼Œx +y,x + yç­‰ç­‰æ ¼å¼</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜éœ€è¦æ³¨æ„ï¼Œç”¨æˆ·çš„è¾“å…¥ä¸ä¸€å®šæ˜¯æ ‡å‡†çš„<code>X+Y</code>ï¼Œé‡Œé¢å¯èƒ½åœ¨ä¸åŒä½ç½®é‡Œé¢ä¼šæœ‰ç©ºæ ¼ã€‚ä¸ºäº†ç»Ÿä¸€æ–¹ä¾¿å¤„ç†ï¼Œåœ¨è§£æä¹‹å‰ï¼Œ<strong>æœ€å¥½å…ˆæŠŠç”¨æˆ·è¾“å…¥å†…çš„ç©ºæ ¼ç»™å»æ‰</strong>ï¼</p><p>å¯¹äºstringè€Œè¨€ï¼Œå»æ‰ç©ºæ ¼å°±å¾ˆç®€å•äº†ï¼Œç›´æ¥ä¸€ä¸ªéå†æå®š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ é™¤è¾“å…¥ä¸­çš„ç©ºæ ¼</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rmSpace</span><span class="params">(std::string&amp; in)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::string tmp;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> e:in)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(e!=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            tmp+=e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    in = tmp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæˆçš„æ„é€ å¦‚ä¸‹ï¼Œè¿™é‡Œæ¶‰åŠåˆ°Cè¯­è¨€çš„<a href="https://blog.musnow.top/2022/01/25/note_c/39%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0%E5%92%8C%E5%86%85%E5%AD%98%E5%87%BD%E6%95%B0/#1-7-strtok">å‡½æ•°strtok</a>ï¼Œè¦å¤ä¹ å¤ä¹ </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†ç”¨æˆ·çš„è¾“å…¥è½¬æˆå†…éƒ¨æˆå‘˜</span></span><br><span class="line"><span class="comment">// ç”¨æˆ·å¯èƒ½è¾“å…¥x+yï¼Œx+ yï¼Œx +y,x + yç­‰ç­‰æ ¼å¼</span></span><br><span class="line"><span class="comment">// æå‰ä¿®æ”¹ç”¨æˆ·è¾“å…¥ï¼ˆä¸»è¦è¿˜æ˜¯å»æ‰ç©ºæ ¼ï¼‰ï¼Œæå–å‡ºæˆå‘˜</span></span><br><span class="line"><span class="built_in">Request</span>(std::string in,<span class="type">bool</span>* status)</span><br><span class="line">    :_x(<span class="number">0</span>),_y(<span class="number">0</span>),_ops(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">rmSpace</span>(in);</span><br><span class="line">    <span class="comment">// è¿™é‡Œä½¿ç”¨cçš„å­—ç¬¦ä¸²ï¼Œå› ä¸ºæœ‰strtok</span></span><br><span class="line">    <span class="type">char</span> buf[<span class="number">1024</span>];</span><br><span class="line">    <span class="comment">// æ‰“å°nä¸ªå­—ç¬¦ï¼Œå¤šçš„ä¼šè¢«æˆªæ–­</span></span><br><span class="line">    <span class="built_in">snprintf</span>(buf,<span class="built_in">sizeof</span>(buf),<span class="string">&quot;%s&quot;</span>,in.<span class="built_in">c_str</span>());</span><br><span class="line">    <span class="type">char</span>* left = <span class="built_in">strtok</span>(buf,OPS);</span><br><span class="line">    <span class="keyword">if</span>(!left)&#123;<span class="comment">//æ‰¾ä¸åˆ°</span></span><br><span class="line">        *status = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">char</span>*right = <span class="built_in">strtok</span>(<span class="literal">nullptr</span>,OPS);</span><br><span class="line">    <span class="keyword">if</span>(!right)&#123;<span class="comment">//æ‰¾ä¸åˆ°</span></span><br><span class="line">        *status = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// x+y, strtokä¼šå°†+è®¾ç½®ä¸º\0</span></span><br><span class="line">    <span class="type">char</span> mid = in[<span class="built_in">strlen</span>(left)];<span class="comment">//æˆªå–å‡ºæ“ä½œç¬¦</span></span><br><span class="line">    <span class="comment">//è¿™æ˜¯åœ¨åŸå­—ç¬¦ä¸²é‡Œé¢å–å‡ºæ¥ï¼Œbufé‡Œé¢çš„è¿™ä¸ªä½ç½®è¢«æ”¹æˆ\0äº†</span></span><br><span class="line"></span><br><span class="line">    _x = <span class="built_in">atoi</span>(left);</span><br><span class="line">    _y = <span class="built_in">atoi</span>(right);</span><br><span class="line">    _ops = mid;</span><br><span class="line">    *status=<span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4-2-åºåˆ—åŒ–"><a href="#3-4-2-åºåˆ—åŒ–" class="headerlink" title="3.4.2 åºåˆ—åŒ–"></a>3.4.2 åºåˆ—åŒ–</h3><p>è§£æå‡ºæˆå‘˜ä»¥åï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯å¯¹æˆå‘˜è¿›è¡Œåºåˆ—åŒ–ï¼Œå°†å…¶æŒ‰æŒ‡å®šçš„ä½ç½®æ‘†æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚è¿™é‡Œé‡‡ç”¨äº†<strong>è¾“å‡ºå‹å‚æ•°</strong>çš„æ–¹å¼æ¥åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ”¹æˆç”¨è¿”å›å€¼çš„æ–¹å¼æ¥æ“ä½œã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ“ä½œç¬¦æœ¬èº«å°±æ˜¯<code>char</code>ä¸èƒ½ä½¿ç”¨<code>to_string</code>æ¥æ“ä½œï¼Œä¼šè¢«è½¬æˆ<code>ascii</code>ç ï¼Œä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åºåˆ—åŒ– ï¼ˆå…¥å‚åº”è¯¥æ˜¯ç©ºçš„ï¼‰</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">serialize</span><span class="params">(std::string&amp; out)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// x + y</span></span><br><span class="line">    out.<span class="built_in">clear</span>(); <span class="comment">// åºåˆ—åŒ–çš„å…¥å‚æ˜¯ç©ºçš„</span></span><br><span class="line">    out+= std::<span class="built_in">to_string</span>(_x);</span><br><span class="line">    out+= SPACE;</span><br><span class="line">    out+= _ops;<span class="comment">//æ“ä½œç¬¦ä¸èƒ½ç”¨tostringï¼Œä¼šè¢«è½¬æˆascii</span></span><br><span class="line">    out+= SPACE;</span><br><span class="line">    out+= std::<span class="built_in">to_string</span>(_y);</span><br><span class="line">    <span class="comment">// ä¸ç”¨æ·»åŠ åˆ†éš”ç¬¦ï¼ˆè¿™æ˜¯encodeè¦å¹²çš„äº‹æƒ…ï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4-3-ååºåˆ—åŒ–"><a href="#3-4-3-ååºåˆ—åŒ–" class="headerlink" title="3.4.3 ååºåˆ—åŒ–"></a>3.4.3 ååºåˆ—åŒ–</h3><p>æ³¨æ„ï¼Œæ€è·¯ä¸èƒ½æé”™äº†ã€‚åˆšå¼€å§‹æˆ‘è®¤ä¸º<code>request</code>çš„ååºåˆ—åŒ–åº”è¯¥é’ˆå¯¹çš„æ˜¯æœåŠ¡å™¨çš„è¿”å›å€¼ï¼Œ<strong>å®é™…å¹¶éå¦‚æ­¤</strong>ï¼</p><p>åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½éœ€è¦ä½¿ç”¨<code>request</code>ï¼Œå®¢æˆ·ç«¯è¿›è¡Œåºåˆ—åŒ–ï¼ŒæœåŠ¡ç«¯å¯¹æ¥æ”¶åˆ°çš„ç»“æœåˆ©ç”¨<code>request</code>è¿›è¡Œååºåˆ—åŒ–ã€‚requeståªå…³æ³¨äºå¯¹è¯·æ±‚çš„å¤„ç†ï¼Œè€Œä¸å¤„ç†æœåŠ¡å™¨çš„è¿”å›å€¼ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">deserialize</span><span class="params">(<span class="type">const</span> std::string &amp;in)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// x + y éœ€è¦å–å‡ºxï¼Œyå’Œæ“ä½œç¬¦</span></span><br><span class="line">    <span class="type">size_t</span> space1 = in.<span class="built_in">find</span>(SPACE); <span class="comment">//ç¬¬ä¸€ä¸ªç©ºæ ¼</span></span><br><span class="line">    <span class="keyword">if</span>(space1 == std::string::npos)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">size_t</span> space2 = in.<span class="built_in">rfind</span>(SPACE); <span class="comment">//ç¬¬äºŒä¸ªç©ºæ ¼</span></span><br><span class="line">    <span class="keyword">if</span>(space2 == std::string::npos)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸¤ä¸ªç©ºæ ¼éƒ½å­˜åœ¨ï¼Œå¼€å§‹å–æ•°æ®</span></span><br><span class="line">    std::string dataX = in.<span class="built_in">substr</span>(<span class="number">0</span>,space1);</span><br><span class="line">    std::string dataY = in.<span class="built_in">substr</span>(space2+SPACE_LEN);<span class="comment">//é»˜è®¤å–åˆ°ç»“å°¾</span></span><br><span class="line">    std::string op = in.<span class="built_in">substr</span>(space1+SPACE_LEN,space2 -(space1+SPACE_LEN));</span><br><span class="line">    <span class="keyword">if</span>(op.<span class="built_in">size</span>()!=<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;<span class="comment">//æ“ä½œç¬¦é•¿åº¦æœ‰é—®é¢˜</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ²¡é—®é¢˜äº†ï¼Œè½¬å†…éƒ¨æˆå‘˜</span></span><br><span class="line">    _x = <span class="built_in">atoi</span>(dataX.<span class="built_in">c_str</span>());</span><br><span class="line">    _y = <span class="built_in">atoi</span>(dataY.<span class="built_in">c_str</span>());</span><br><span class="line">    _ops = op[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-5-response"><a href="#3-5-response" class="headerlink" title="3.5 response"></a>3.5 response</h2><h3 id="3-5-1-æ„é€ "><a href="#3-5-1-æ„é€ " class="headerlink" title="3.5.1 æ„é€ "></a>3.5.1 æ„é€ </h3><p>è¿”å›å€¼çš„æ„é€ æ¯”è¾ƒç®€å•ï¼Œå› ä¸ºæ˜¯æœåŠ¡å™¨å¤„ç†ç»“æœä¹‹åçš„æ“ä½œï¼›è¿™äº›æˆå‘˜å˜é‡éƒ½è®¾ç½®ä¸ºäº†å…¬æœ‰ï¼Œæ–¹ä¾¿åç»­ä¿®æ”¹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Response</span>(<span class="type">int</span> code=<span class="number">0</span>,<span class="type">int</span> result=<span class="number">0</span>)</span><br><span class="line">    :_exitCode(code),_result(result)</span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="3-5-2-åºåˆ—åŒ–"><a href="#3-5-2-åºåˆ—åŒ–" class="headerlink" title="3.5.2 åºåˆ—åŒ–"></a>3.5.2 åºåˆ—åŒ–</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…¥å‚æ˜¯ç©ºçš„</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">serialize</span><span class="params">(std::string&amp; out)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// code ret</span></span><br><span class="line">    out.<span class="built_in">clear</span>();</span><br><span class="line">    out+= std::<span class="built_in">to_string</span>(_exitCode);</span><br><span class="line">    out+= SPACE;</span><br><span class="line">    out+= std::<span class="built_in">to_string</span>(_result);</span><br><span class="line">    out+= CRLF;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-5-3-ååºåˆ—åŒ–"><a href="#3-5-3-ååºåˆ—åŒ–" class="headerlink" title="3.5.3 ååºåˆ—åŒ–"></a>3.5.3 ååºåˆ—åŒ–</h3><p>å“åº”çš„ååºåˆ—åŒ–åªéœ€è¦å¤„ç†ä¸€ä¸ªç©ºæ ¼ï¼Œç›¸å¯¹æ¥è¯´è¾ƒä¸ºç®€å•</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">deserialize</span><span class="params">(<span class="type">const</span> std::string &amp;in)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// åªæœ‰ä¸€ä¸ªç©ºæ ¼</span></span><br><span class="line">    <span class="type">size_t</span> space = in.<span class="built_in">find</span>(SPACE);</span><br><span class="line">    <span class="keyword">if</span>(space == std::string::npos)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    std::string dataCode = in.<span class="built_in">substr</span>(<span class="number">0</span>,space);</span><br><span class="line">    std::string dataRes = in.<span class="built_in">substr</span>(space+SPACE_LEN);</span><br><span class="line">    _exitCode = <span class="built_in">atoi</span>(dataCode.<span class="built_in">c_str</span>());</span><br><span class="line">    _result = <span class="built_in">atoi</span>(dataRes.<span class="built_in">c_str</span>());</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-6-å®¢æˆ·ç«¯"><a href="#3-6-å®¢æˆ·ç«¯" class="headerlink" title="3.6 å®¢æˆ·ç«¯"></a>3.6 å®¢æˆ·ç«¯</h2><p>ä¹‹å‰å†™çš„å®¢æˆ·ç«¯ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œåºåˆ—åŒ–æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸Šåºåˆ—åŒ–æ“ä½œï¼Œå¹¶å¯¹æœåŠ¡å™¨çš„è¿”å›å€¼è¿›è¡Œååºåˆ—åŒ–ã€‚è¿™æœŸé—´éœ€è¦åŠ ä¸Šä¸€ç³»åˆ—åˆ¤æ–­ï¼›</p><p>ä¸ºäº†é™åˆ¶ç¯‡å¹…ï¼Œä¸‹é¢åªè´´å‡ºæ¥å®¢æˆ·ç«¯çš„å¾ªç¯æ“ä½œï¼›è¯¦æƒ…å‚è€ƒæ³¨é‡Šã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®¢æˆ·ç«¯å‘ç°çš„æ¶ˆæ¯</span></span><br><span class="line">string message;</span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    message.<span class="built_in">clear</span>();<span class="comment">//æ¯æ¬¡å¾ªç¯å¼€å§‹ï¼Œéƒ½æ¸…ç©ºä¸€ä¸‹msg</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;è¯·è¾“å…¥ä½ çš„æ¶ˆæ¯# &quot;</span>;</span><br><span class="line">    <span class="built_in">getline</span>(cin, message);<span class="comment">//è·å–è¾“å…¥</span></span><br><span class="line">    <span class="comment">// å¦‚æœå®¢æˆ·ç«¯è¾“å…¥äº†quitï¼Œåˆ™é€€å‡º</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strcasecmp</span>(message.<span class="built_in">c_str</span>(), <span class="string">&quot;quit&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">// å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºä¸€ä¸ªrequestï¼ˆåˆ†ç¦»å‚æ•°ï¼‰</span></span><br><span class="line">    <span class="type">bool</span> reqStatus = <span class="literal">true</span>;</span><br><span class="line">    <span class="function">Request <span class="title">req</span><span class="params">(message,&amp;reqStatus)</span></span>;</span><br><span class="line">    <span class="keyword">if</span>(!reqStatus)&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;make req err!&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.åºåˆ—åŒ–å’Œç¼–ç </span></span><br><span class="line">    string package;</span><br><span class="line">    req.<span class="built_in">serialize</span>(package);<span class="comment">//åºåˆ—åŒ–</span></span><br><span class="line">    package = <span class="built_in">encode</span>(package,package.<span class="built_in">size</span>());<span class="comment">//ç¼–ç </span></span><br><span class="line">    <span class="comment">// 3.å‘é€ç»™æœåŠ¡å™¨</span></span><br><span class="line">    <span class="type">ssize_t</span> s = <span class="built_in">write</span>(sock,package.<span class="built_in">c_str</span>(), package.<span class="built_in">size</span>());</span><br><span class="line">    <span class="keyword">if</span> (s &gt; <span class="number">0</span>) <span class="comment">// å†™å…¥æˆåŠŸ</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 4.è·å–æœåŠ¡å™¨çš„ç»“æœ</span></span><br><span class="line">        <span class="type">char</span> buff[BUFFER_SIZE];</span><br><span class="line">        <span class="type">size_t</span> s = <span class="built_in">read</span>(sock, buff, <span class="built_in">sizeof</span>(buff)<span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">if</span>(s &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            buff[s] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        std::string echoPackage = buff;</span><br><span class="line">        Response resp;</span><br><span class="line">        <span class="type">size_t</span> len = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 5.è§£ç å’Œååºåˆ—åŒ–</span></span><br><span class="line">        std::string tmp = <span class="built_in">decode</span>(echoPackage, &amp;len);</span><br><span class="line">        <span class="keyword">if</span>(len &gt; <span class="number">0</span>)<span class="comment">//è§£ç æˆåŠŸ</span></span><br><span class="line">        &#123;</span><br><span class="line">            echoPackage = tmp;</span><br><span class="line">            <span class="keyword">if</span>(resp.<span class="built_in">deserialize</span>(echoPackage))<span class="comment">//ååºåˆ—åŒ–å¹¶åˆ¤æ–­</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;ECHO [exitcode: %d] %d\n&quot;</span>, resp._exitCode, resp._result);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                cerr &lt;&lt; <span class="string">&quot;server echo deserialize err!&quot;</span> &lt;&lt; endl;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            cerr &lt;&lt; <span class="string">&quot;server echo decode err!&quot;</span> &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (s &lt;= <span class="number">0</span>) <span class="comment">// å†™å…¥å¤±è´¥</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-7-æœåŠ¡ç«¯"><a href="#3-7-æœåŠ¡ç«¯" class="headerlink" title="3.7 æœåŠ¡ç«¯"></a>3.7 æœåŠ¡ç«¯</h2><p>æœåŠ¡ç«¯æ— é¡»ä¿®æ”¹ä»£ç ï¼Œéœ€è¦ä¿®æ”¹çš„æ˜¯taskæ¶ˆæ¯é˜Ÿåˆ—ä¸­å¤„ç†çš„ä»»åŠ¡ï¼›è¿™å°±æ˜¯ä¹‹å‰åšå¥½å°è£…çš„å¥½å¤„ï¼Œå› ä¸ºåªéœ€è¦ä¿®æ”¹taské‡Œé¢ä¼ å…¥çš„å‡½æ•°æŒ‡é’ˆï¼Œå°±ç®—æ˜¯ä¿®æ”¹äº†æœåŠ¡å™¨æ‰€è¿›è¡Œçš„æœåŠ¡</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æä¾›æœåŠ¡ï¼ˆé€šè¿‡çº¿ç¨‹æ± ï¼‰</span></span><br><span class="line"><span class="function">Task <span class="title">t</span><span class="params">(conet,senderIP,senderPort,CaculateService)</span></span>;</span><br><span class="line">_tpool-&gt;<span class="built_in">push</span>(t);</span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹æ˜¯è®¡ç®—å™¨æœåŠ¡çš„ä»£ç </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CaculateService</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> std::string &amp;clientIP, <span class="type">uint16_t</span> clientPort)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">assert</span>(sockfd &gt;= <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">assert</span>(!clientIP.<span class="built_in">empty</span>());</span><br><span class="line">    <span class="built_in">assert</span>(clientPort &gt; <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    std::string inbuf;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        Request req;</span><br><span class="line">        <span class="type">char</span> buf[BUFFER_SIZE];</span><br><span class="line">        <span class="comment">// 1.è¯»å–å®¢æˆ·ç«¯å‘é€çš„ä¿¡æ¯</span></span><br><span class="line">        <span class="type">ssize_t</span> s = <span class="built_in">read</span>(sockfd, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (s == <span class="number">0</span>)</span><br><span class="line">        &#123;   <span class="comment">// s == 0ä»£è¡¨å¯¹æ–¹å‘é€äº†ç©ºæ¶ˆæ¯ï¼Œè§†ä½œå®¢æˆ·ç«¯ä¸»åŠ¨é€€å‡º</span></span><br><span class="line">            <span class="built_in">logging</span>(DEBUG, <span class="string">&quot;client quit: %s[%d]&quot;</span>, clientIP.<span class="built_in">c_str</span>(), clientPort);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(s&lt;<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// å‡ºç°äº†è¯»å–é”™è¯¯ï¼Œæ‰“å°æ—¥å¿—åæ–­å¼€è¿æ¥</span></span><br><span class="line">            <span class="built_in">logging</span>(DEBUG, <span class="string">&quot;read err: %s[%d] = %s&quot;</span>, clientIP.<span class="built_in">c_str</span>(), clientPort, <span class="built_in">strerror</span>(errno));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.è¯»å–æˆåŠŸ</span></span><br><span class="line">        buf[s] = <span class="string">&#x27;\0&#x27;</span>; <span class="comment">// æ‰‹åŠ¨æ·»åŠ å­—ç¬¦ä¸²ç»ˆæ­¢ç¬¦</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcasecmp</span>(buf, <span class="string">&quot;quit&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">        &#123; <span class="comment">// å®¢æˆ·ç«¯ä¸»åŠ¨é€€å‡º</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.å¼€å§‹æœåŠ¡</span></span><br><span class="line">        inbuf = buf;</span><br><span class="line">        <span class="type">size_t</span> packageLen = inbuf.<span class="built_in">size</span>();</span><br><span class="line">        <span class="comment">// 3.1.è§£ç å’Œååºåˆ—åŒ–å®¢æˆ·ç«¯ä¼ æ¥çš„æ¶ˆæ¯</span></span><br><span class="line">        std::string package = <span class="built_in">decode</span>(inbuf, &amp;packageLen);<span class="comment">//è§£ç </span></span><br><span class="line">        <span class="keyword">if</span>(packageLen==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="built_in">logging</span>(DEBUG, <span class="string">&quot;decode err: %s[%d] status: %d&quot;</span>, clientIP.<span class="built_in">c_str</span>(), clientPort, packageLen);</span><br><span class="line">            <span class="keyword">continue</span>;<span class="comment">//æŠ¥æ–‡ä¸å®Œæ•´æˆ–æœ‰è¯¯</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">logging</span>(DEBUG,<span class="string">&quot;package: %s[%d] = %s&quot;</span>,clientIP.<span class="built_in">c_str</span>(), clientPort,package.<span class="built_in">c_str</span>());</span><br><span class="line">        <span class="type">bool</span> deStatus = req.<span class="built_in">deserialize</span>(package); <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">        <span class="keyword">if</span>(deStatus) <span class="comment">// è·å–æ¶ˆæ¯ååºåˆ—åŒ–æˆåŠŸ</span></span><br><span class="line">        &#123;</span><br><span class="line">            req.<span class="built_in">debug</span>(); <span class="comment">// æ‰“å°ä¿¡æ¯</span></span><br><span class="line">            <span class="comment">// 3.2.è·å–ç»“æ„åŒ–çš„ç›¸åº”</span></span><br><span class="line">            Response resp = <span class="built_in">Caculater</span>(req);</span><br><span class="line">            <span class="comment">// 3.3.åºåˆ—åŒ–å’Œç¼–ç å“åº”</span></span><br><span class="line">            std::string echoStr;</span><br><span class="line">            resp.<span class="built_in">serialize</span>(echoStr);</span><br><span class="line">            echoStr = <span class="built_in">encode</span>(echoStr,echoStr.<span class="built_in">size</span>());</span><br><span class="line">            <span class="comment">// 3.4.å†™å…¥ï¼Œå‘é€è¿”å›å€¼ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">            <span class="built_in">write</span>(sockfd, echoStr.<span class="built_in">c_str</span>(), echoStr.<span class="built_in">size</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">// å®¢æˆ·ç«¯æ¶ˆæ¯ååºåˆ—åŒ–å¤±è´¥</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">logging</span>(DEBUG, <span class="string">&quot;deserialize err: %s[%d] status: %d&quot;</span>, clientIP.<span class="built_in">c_str</span>(), clientPort, deStatus);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(sockfd);</span><br><span class="line">    <span class="built_in">logging</span>(DEBUG, <span class="string">&quot;server quit: %s[%d] %d&quot;</span>,clientIP.<span class="built_in">c_str</span>(), clientPort, sockfd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­æœ‰ä¸€ä¸ªè®¡ç®—å‡½æ•°ï¼Œæ¯”è¾ƒç®€å•ï¼Œé€šè¿‡switch caseè¯­å¥ï¼Œè®¡ç®—ç»“æœï¼Œå¹¶åˆ¤æ–­æ“ä½œæ•°æ˜¯å¦æœ‰é—®é¢˜ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Response <span class="title">Caculater</span><span class="params">(<span class="type">const</span> Request&amp; req)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Response resp;<span class="comment">//æ„é€ å‡½æ•°ä¸­å·²ç»æŒ‡å®šäº†exitcodeä¸º0</span></span><br><span class="line">    <span class="keyword">switch</span> (req._ops)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">        resp._result = req._x + req._y;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">        resp._result = req._x - req._y;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">        resp._result = req._x * req._y;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;%&#x27;</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(req._y == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            resp._exitCode = <span class="number">-1</span>;<span class="comment">//å–æ¨¡é”™è¯¯</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        resp._result = req._x % req._y;<span class="comment">//å–æ¨¡æ˜¯å¯ä»¥æ“ä½œè´Ÿæ•°çš„</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(req._y == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            resp._exitCode = <span class="number">-2</span>;<span class="comment">//é™¤0é”™è¯¯</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        resp._result = req._x / req._y;<span class="comment">//å–æ¨¡æ˜¯å¯ä»¥æ“ä½œè´Ÿæ•°çš„</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        resp._exitCode = <span class="number">-3</span>;<span class="comment">//æ“ä½œç¬¦éæ³•</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> resp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬çš„åºåˆ—åŒ–å¤„ç†å°±æˆåŠŸäº†ï¼æµ‹è¯•ä¸€ä¸‹å§</p><h1 id="4-æµ‹è¯•"><a href="#4-æµ‹è¯•" class="headerlink" title="4.æµ‹è¯•"></a>4.æµ‹è¯•</h1><p>è¿è¡ŒæœåŠ¡å™¨ï¼Œå¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å™¨èƒ½æˆåŠŸå¤„ç†å®¢æˆ·ç«¯çš„è®¡ç®—ï¼Œå¹¶è¿”å›ç»“æœ</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e86fed80298.png"                      alt="image-20230212124940995"                ></p><p>è¾“å…¥quitï¼ŒæœåŠ¡å™¨ä¼šæ‰“å°ä¿¡æ¯ï¼Œå¹¶é€€å‡ºæœåŠ¡</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e87096915d4.png"                      alt="image-20230212125238473"                ></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä»¥tcpServerçš„&lt;strong&gt;è®¡ç®—å™¨&lt;/strong&gt;æœåŠ¡ä¸ºä¾‹ï¼Œå®ç°ä¸€ä¸ªè‡ªå®šä¹‰åè®®&lt;/p&gt;</summary>
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="ç½‘ç»œ" scheme="https://blog.musnow.top/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>ã€Gitã€‘å¦‚ä½•ä¿®æ”¹æœ¬åœ°ä»“åº“çš„ç”¨æˆ·åå’Œé‚®ç®±</title>
    <link href="https://blog.musnow.top/2023/02/11/tools/13%E4%BF%AE%E6%94%B9git%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E9%82%AE%E7%AE%B1/"/>
    <id>https://blog.musnow.top/2023/02/11/tools/13%E4%BF%AE%E6%94%B9git%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E9%82%AE%E7%AE%B1/</id>
    <published>2023-02-11T01:19:28.000Z</published>
    <updated>2023-03-11T11:25:36.228Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æˆ‘ä¿®æ”¹äº†æˆ‘giteeå’Œgithubçš„ç”¨æˆ·åè¿˜æœ‰é‚®ç®±ï¼Œæ‰€ä»¥éœ€è¦å¯¹æœ¬åœ°ä»“åº“é…ç½®çš„ç”¨æˆ·åå’Œé‚®ç®±è¿›è¡Œæ›´æ”¹</p><span id="more"></span><h1 id="1-å‘½ä»¤"><a href="#1-å‘½ä»¤" class="headerlink" title="1.å‘½ä»¤"></a>1.å‘½ä»¤</h1><p> åˆšå¼€å§‹æˆ‘ä½¿ç”¨çš„æ˜¯å¦‚ä¸‹å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.email &quot;é‚®ç®±&quot;</span><br><span class="line">git config --global user.name &quot;ç”¨æˆ·å&quot;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¾ˆä¸è¾›ï¼Œè¿™ä¸ªå‘½ä»¤æ²¡æœ‰ç”¨ï¼Œå› ä¸ºå®ƒæ˜¯ç”¨æ¥åˆå§‹åŒ–ä½ çš„gitç¯å¢ƒçš„ï¼Œå¯¹å·²æœ‰çš„gitä»“åº“ä¸èµ·ä½œç”¨</p><p>ä½†æ˜¯æˆ‘ä»¬åœ¨<code>linux</code>ä¸‹å¯ä»¥æ·»åŠ ä¸Šå¦å¤–ä¸€ä¸ªå‚æ•°æ¥å®ç°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global --replace-all user.email &quot;é‚®ç®±&quot; </span><br><span class="line">git config --global --replace-all user.name &quot;ç”¨æˆ·å&quot;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±ä¿®æ”¹æˆåŠŸäº†</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e6eaa589b3b.png"                      alt="image-20230211090846508"                ></p><blockquote><p>è¿™ä¸ªå‘½ä»¤åœ¨windowsä¸‹ä¼¼ä¹æ— æ³•è¯†åˆ«ï¼Œä¼šå¼¹å‡ºgitçš„å‘½ä»¤è¡Œå¸®åŠ©</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e6ec242c79e.png"                      alt="image-20230211091516456"                ></p></blockquote><p>ä½†æ˜¯ï¼Œä¿®æ”¹æˆåŠŸåçš„æäº¤ï¼Œåªå¯¹æœªæ¥çš„æäº¤æœ‰æ•ˆï¼›è¿™é‡Œå¿…é¡»å¾—åæ§½ä¸€ä¸‹giteeå’Œgithubç»Ÿè®¡æäº¤çš„ä¸åŒä¹‹å¤„</p><ul><li>giteeç»Ÿè®¡æäº¤ä¾æ®çš„æ˜¯ç”¨æˆ·å+é‚®ç®±ï¼Œåªè¦æœ‰ä¸€ä¸ªä¸å¯¹å°±æ— æ³•ç»Ÿè®¡</li><li>githubç»Ÿè®¡æäº¤åªä¾æ®é‚®ç®±ï¼Œåªè¦ä½ é‚®ç®±å¯¹äº†ï¼Œç”¨æˆ·åæ˜¯ä¸ç®¡ä½ çš„</li></ul><p>æ‰€ä»¥è¦æƒ³è®©giteeçš„ç»Ÿè®¡èƒ½ç”Ÿæ•ˆï¼Œé‚£å°±å¿…é¡»è¦ä¿®æ”¹ä¹‹å‰æ‰€æœ‰æäº¤ä¿¡æ¯ä¸­çš„ç”¨æˆ·åå’Œé‚®ç®±</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e6eba93dc9c.png"                      alt="image-20230211091313728"                ></p><h1 id="2-ä¿®æ”¹ä¹‹å‰æäº¤ä¸­çš„ç”¨æˆ·åå’Œé‚®ç®±"><a href="#2-ä¿®æ”¹ä¹‹å‰æäº¤ä¸­çš„ç”¨æˆ·åå’Œé‚®ç®±" class="headerlink" title="2.ä¿®æ”¹ä¹‹å‰æäº¤ä¸­çš„ç”¨æˆ·åå’Œé‚®ç®±"></a>2.ä¿®æ”¹ä¹‹å‰æäº¤ä¸­çš„ç”¨æˆ·åå’Œé‚®ç®±</h1><blockquote><p><a class="link"   href="https://cloud.tencent.com/developer/article/1946705#:~:text=%E5%A6%82%E6%9E%9C%E9%9C%80%E8%A6%81%E4%BF%AE%E6%94%B9%20git%20%E5%9C%A8%E6%9C%AC%E5%9C%B0%E7%9A%84%E5%85%A8%E5%B1%80%E9%82%AE%E7%AE%B1%E5%92%8C%E7%94%A8%E6%88%B7%E5%90%8D%EF%BC%8C%E6%89%A7%E8%A1%8C%E4%B8%8B%E9%9D%A2%E7%9A%84%E5%91%BD%E4%BB%A4%E3%80%82%20git%20config%20--global%20user.name%20%22%E8%BE%93%E5%85%A5%E4%BD%A0%E7%9A%84%E7%94%A8%E6%88%B7%E5%90%8D%22,%22%E8%BE%93%E5%85%A5%E4%BD%A0%E7%9A%84%E9%82%AE%E7%AE%B1%22%20%E7%8E%B0%E5%9C%A8%E6%88%91%E4%BB%AC%E5%B7%B2%E7%BB%8F%E8%AE%BE%E7%BD%AE%E5%A5%BD%E4%BA%86%E6%9C%AC%E5%9C%B0%20git%20%E7%9A%84%20user.name%20%E5%92%8C%20user.email%20%E4%BF%A1%E6%81%AF%E3%80%82" >å‚è€ƒåšå®¢<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>å¤åˆ¶å¦‚ä¸‹ä»£ç åˆ°ä¸€ä¸ªæœ¬æ–‡ç¼–è¾‘å™¨é‡Œé¢ï¼Œå°†å†…éƒ¨çš„é‚®ç®±å’Œç”¨æˆ·ä¿¡æ¯ä¿®æ”¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">git filter-branch -f --env-filter &#x27;</span><br><span class="line">OLD_EMAIL=&quot;åŸæ¥çš„é‚®ç®±&quot;</span><br><span class="line">CORRECT_NAME=&quot;ç°åœ¨çš„åå­—&quot;</span><br><span class="line">CORRECT_EMAIL=&quot;ç°åœ¨çš„é‚®ç®±&quot;</span><br><span class="line">if [ &quot;$GIT_COMMITTER_EMAIL&quot; = &quot;$OLD_EMAIL&quot; ]</span><br><span class="line">then</span><br><span class="line">    export GIT_COMMITTER_NAME=&quot;$CORRECT_NAME&quot;</span><br><span class="line">    export GIT_COMMITTER_EMAIL=&quot;$CORRECT_EMAIL&quot;</span><br><span class="line">fi</span><br><span class="line">if [ &quot;$GIT_AUTHOR_EMAIL&quot; = &quot;$OLD_EMAIL&quot; ]</span><br><span class="line">then</span><br><span class="line">    export GIT_AUTHOR_NAME=&quot;$CORRECT_NAME&quot;</span><br><span class="line">    export GIT_AUTHOR_EMAIL=&quot;$CORRECT_EMAIL&quot;</span><br><span class="line">fi</span><br><span class="line">&#x27; --tag-name-filter cat -- --branches --tags</span><br></pre></td></tr></table></figure><p>éšåå°†å…¶ç²˜è´´åˆ°gitå‘½ä»¤è¡Œä¸­ï¼Œå›è½¦æ‰§è¡Œ</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e6eb4885b41.png"                      alt="image-20230211091136866"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e6ec56eebd5.png"                      alt="image-20230211091607229"                ></p><p>æ‰§è¡Œå®Œæ¯•ï¼Œå°±èƒ½çœ‹åˆ°æ‰€æœ‰gitæäº¤çš„ç”¨æˆ·åå’Œé‚®ç®±éƒ½ä¿®æ”¹æˆåŠŸäº†ï¼æ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯å¼ºåˆ¶æäº¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -f</span><br></pre></td></tr></table></figure><p>å¼ºåˆ¶æäº¤äº†ä¹‹åï¼Œä¹‹å‰æ˜¾ç¤ºä¸å‡ºæ¥çš„ä¿¡æ¯å’Œå°ç»¿ç‚¹ï¼Œç°åœ¨ä¹Ÿèƒ½æ­£å¸¸æ˜¾ç¤ºäº†</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e6eb7339c69.png"                      alt="image-20230211091219547"                ></p><p>å¦‚æœç”¨ä¸Šé¢çš„å‘½ä»¤ä¿®æ”¹å¤±è´¥çš„è¯ï¼Œé‚£å°±å°è¯•æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git filter-branch -f --index-filter &#x27;git rm --cached --ignore-unmatch Rakefile&#x27; HEAD</span><br></pre></td></tr></table></figure><p>éšåå†é‡è¯•ä¸Šé¢çš„å‘½ä»¤ï¼Œåº”è¯¥å°±OKäº†</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ€è¿‘æˆ‘ä¿®æ”¹äº†æˆ‘giteeå’Œgithubçš„ç”¨æˆ·åè¿˜æœ‰é‚®ç®±ï¼Œæ‰€ä»¥éœ€è¦å¯¹æœ¬åœ°ä»“åº“é…ç½®çš„ç”¨æˆ·åå’Œé‚®ç®±è¿›è¡Œæ›´æ”¹&lt;/p&gt;</summary>
    
    
    
    <category term="å·®ç”Ÿæ–‡å…·å¤š" scheme="https://blog.musnow.top/categories/%E5%B7%AE%E7%94%9F%E6%96%87%E5%85%B7%E5%A4%9A/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="git" scheme="https://blog.musnow.top/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>ã€Pythonã€‘æ•™ä½ ç™½å«–replitéƒ¨ç½²kook-ticket-bot</title>
    <link href="https://blog.musnow.top/2023/02/09/Python/9%E7%99%BD%E5%AB%96replist%E9%83%A8%E7%BD%B2ticket%E6%9C%BA%E5%99%A8%E4%BA%BA/"/>
    <id>https://blog.musnow.top/2023/02/09/Python/9%E7%99%BD%E5%AB%96replist%E9%83%A8%E7%BD%B2ticket%E6%9C%BA%E5%99%A8%E4%BA%BA/</id>
    <published>2023-02-09T10:19:00.000Z</published>
    <updated>2023-03-11T11:25:36.230Z</updated>
    
    <content type="html"><![CDATA[<p>æ•™ä½ ç™½å«–replitéƒ¨ç½²kookçš„ticketæœºå™¨äºº</p><span id="more"></span><h1 id="1-å‰è¨€"><a href="#1-å‰è¨€" class="headerlink" title="1.å‰è¨€"></a>1.å‰è¨€</h1><p>æœ€è¿‘æœ‰ä¸å°‘è€å“¥æ¥æ‰¾æˆ‘å’¨è¯¢æœ‰å…³ticketæœºå™¨äººçš„äº‹æƒ…ï¼Œå½“å‰ticketæœºå™¨äººéœ€è¦äº‘æœåŠ¡å™¨æ‰èƒ½éƒ¨ç½²ï¼Œæœ‰äº›ä¸å¤ªå‹å¥½ï¼ˆè¦é’±å•Šï¼è€Œä¸”ä¹Ÿä¸æ˜¯äººäººéƒ½ä¼šå®‰è£…pythonç¯å¢ƒï¼‰</p><p>æ‰€ä»¥åœ¨è¿™é‡Œåˆ©ç”¨<a class="link"   href="https://replit.com/" >replit<i class="fas fa-external-link-alt"></i></a>å’Œ<a class="link"   href="https://uptimerobot.com/" >uptimerobot<i class="fas fa-external-link-alt"></i></a>ä¸¤ä¸ªå¹³å°ï¼Œç»™å¤§å®¶ä»‹ç»ä¸€ä¸ªç™½å«–çš„æ–¹æ³•ï¼Œå®ç°éƒ¨ç½²<a class="link"   href="https://gitee.com/musnow/Kook-Ticket-Bot/tree/main" >kook-ticket-bot<i class="fas fa-external-link-alt"></i></a></p><p><font color=Red>æ³¨æ„ï¼</font>replitä¸Šçš„å…è´¹ä»“åº“ï¼Œé»˜è®¤æ˜¯<strong>å…¬å¼€</strong>çš„ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰äººéƒ½èƒ½è®¿é—®åˆ°ä½ è¿™ä¸ªä»“åº“é‡Œé¢çš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬botçš„tokenå’Œæ—¥å¿—ä¿¡æ¯ï¼è‹¥æ‚¨çš„ticket-botå¯¹æ•°æ®ç§å¯†æ€§è¦æ±‚è¾ƒé«˜ï¼Œè¯·<strong>è‡ªè´­æœåŠ¡å™¨</strong>æˆ–æ‰¾å¼€å‘è€…ä»£ä¸ºéƒ¨ç½²ï¼</p><h1 id="2-å‡†å¤‡"><a href="#2-å‡†å¤‡" class="headerlink" title="2.å‡†å¤‡"></a>2.å‡†å¤‡</h1><h2 id="2-1-æ³¨å†Œè´¦æˆ·"><a href="#2-1-æ³¨å†Œè´¦æˆ·" class="headerlink" title="2.1 æ³¨å†Œè´¦æˆ·"></a>2.1 æ³¨å†Œè´¦æˆ·</h2><p>è¿™ä¸¤ä¸ªå¹³å°å›½å†…è®¿é—®ç¼“æ…¢ï¼Œå¦‚æœå®åœ¨è¿›ä¸å»ï¼Œå°±ä¸‹è½½ä¸€ä¸ª<code>steam++</code>(åˆç§°watt toolkit)</p><blockquote><p><a class="link"   href="https://gitee.com/rmbgame/SteamTools/releases/tag/2.8.6" >https://gitee.com/rmbgame/SteamTools/releases/tag/2.8.6<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>å¦‚å›¾ï¼Œä¸‹è½½exeå°±å¯ä»¥äº†</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4c97b28c87.png"                      alt="image-20230209182251919"                ></p><p>å®‰è£…æ‰“å¼€ä»¥åï¼ŒæŠŠè¿™ä¸€å †æ— å·®åˆ«å‹¾ä¸Šï¼Œç‚¹ä¸€é”®åŠ é€Ÿï¼Œåº”è¯¥å°±okäº†ï¼Œè®¿é—®ä¼šç¨å¾®å¿«ä¸€ç‚¹</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4c99abf86a.png"                      alt="image-20230209182323805"                ></p><p>éšåå°±æ˜¯æ³¨å†Œè¿™ä¸¤ä¸ªå¹³å°çš„è´¦æˆ·äº†ï¼Œåº”è¯¥ä¸éœ€è¦æ•™å§ï¼ˆdogeï¼‰</p><h2 id="2-2-æ‰“å¼€giteeä»“åº“"><a href="#2-2-æ‰“å¼€giteeä»“åº“" class="headerlink" title="2.2 æ‰“å¼€giteeä»“åº“"></a>2.2 æ‰“å¼€giteeä»“åº“</h2><blockquote><p><a class="link"   href="https://gitee.com/musnow/Kook-Ticket-Bot/tree/main/code" >https://gitee.com/musnow/Kook-Ticket-Bot/tree/main/code<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>ä¸ºäº†æ–¹ä¾¿è®¿é—®ï¼Œæˆ‘å°†ticket-botåœ¨giteeä¹Ÿä¼ äº†ä¸€ä»½ï¼Œå¤§å®¶æ‰“å¼€ä»“åº“çš„codeç›®å½•ï¼Œå‡†å¤‡æ‹·è´ä»£ç </p><h2 id="2-3-ç”³è¯·kookå¼€å‘è€…"><a href="#2-3-ç”³è¯·kookå¼€å‘è€…" class="headerlink" title="2.3 ç”³è¯·kookå¼€å‘è€…"></a>2.3 ç”³è¯·kookå¼€å‘è€…</h2><blockquote><p><a class="link"   href="https://developer.kookapp.cn/app/index" >https://developer.kookapp.cn/app/index<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>åˆ°kookçš„å¼€å‘è€…å¹³å°ï¼ŒåŠ å…¥å®˜æ–¹é¢‘é“ç”³è¯·æ‰¿ä¸ºå¼€å‘è€…ï¼Œè·å–åˆ›å»ºbotçš„æƒé™ï¼›æœ‰äº†æƒé™ä¹‹åï¼Œæ–°å»ºä¸€ä¸ªåº”ç”¨</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4cad5ec685.png"                      alt="image-20230209182839605"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4cba500721.png"                      alt="image-20230209183206514"                ></p><p>éšåè¿›å…¥æœºå™¨äººé¡µé¢ï¼Œå¤åˆ¶è¿™é‡Œçš„tokenï¼Œå…ˆä¿å­˜èµ·æ¥ï¼Œåé¢è¦ç”¨ï¼ˆä¸€ä¼šå†æ¥å¤åˆ¶ä¹Ÿè¡Œï¼‰</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4cbd3db568.png"                      alt="image-20230209183253285"                ></p><p>è¿›å…¥é‚€è¯·é¡µé¢ï¼Œç»™äºˆæœºå™¨äººç®¡ç†å‘˜æƒé™ï¼ˆè¿™æ ·æ˜¯ä¸ºäº†æ–¹ä¾¿ï¼Œä¸ç„¶å¾—é’©ä¸€å¤§å †ï¼‰</p><p>ç„¶åå¤åˆ¶ä¸Šé¢çš„é‚€è¯·é“¾æ¥åˆ°æµè§ˆå™¨ï¼Œé‚€è¯·æœºå™¨äººè¿›å…¥ä½ çš„æœåŠ¡å™¨</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4cc23379a8.png"                      alt="image-20230209183412507"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4cc59c0389.png"                      alt="image-20230209183507516"                ></p><h1 id="3-å¼€å§‹éƒ¨ç½²"><a href="#3-å¼€å§‹éƒ¨ç½²" class="headerlink" title="3.å¼€å§‹éƒ¨ç½²"></a>3.å¼€å§‹éƒ¨ç½²</h1><h2 id="3-1-åˆ›å»ºpython"><a href="#3-1-åˆ›å»ºpython" class="headerlink" title="3.1 åˆ›å»ºpython"></a>3.1 åˆ›å»ºpython</h2><p>æ¥åˆ°replitï¼Œåˆ›å»ºä»“åº“</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4cc934caf7.png"                      alt="image-20230209183604137"                ></p><p>é€‰æ‹©pythonï¼Œç„¶åç»™å®ƒå–ä¸ªåå­—</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4cca3b57b2.png"                      alt="image-20230209183621372"                ></p><p>åˆ›å»ºä¹‹åè¿›å…¥è¿™ä¸ªé¡¹ç›®</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4ccf8373da.png"                      alt="image-20230209183745982"                ></p><h2 id="3-2-æ·»åŠ ä»£ç æ–‡ä»¶"><a href="#3-2-æ·»åŠ ä»£ç æ–‡ä»¶" class="headerlink" title="3.2 æ·»åŠ ä»£ç æ–‡ä»¶"></a>3.2 æ·»åŠ ä»£ç æ–‡ä»¶</h2><p>è¿›æ¥ä¹‹åæ˜¯è¿™æ ·çš„é¡µé¢ï¼Œåªæœ‰ä¸€ä¸ª<code>main.py</code>ï¼Œå…¶ä»–ä»€ä¹ˆéƒ½æ— </p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4cd2483286.png"                      alt="image-20230209183829907"                ></p><p>ç‚¹å‡»å·¦ä¸Šè§’è¿™ä¸ªå°æŒ‰é’®ï¼Œåˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå‘½åä¸º<code>keepal.py</code></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4cd99c5447.png"                      alt="image-20230209184027580"                ></p><p>å¤åˆ¶å¦‚ä¸‹ä»£ç åˆ°<code>keepal.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="comment"># åˆå§‹åŒ–</span></span><br><span class="line">app = Flask(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"><span class="comment"># è®¾ç«‹æ ¹è·¯å¾„ä½œä¸ºapiè°ƒç”¨</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">  text = <span class="string">&quot;ticket bot online!&quot;</span></span><br><span class="line">  <span class="built_in">print</span>(text)</span><br><span class="line">  <span class="keyword">return</span> text</span><br><span class="line"><span class="comment"># å¼€å§‹è¿è¡Œï¼Œç»‘å®šipå’Œç«¯å£</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line">  app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port = <span class="number">8000</span>)</span><br><span class="line"><span class="comment"># é€šè¿‡çº¿ç¨‹è¿è¡Œ</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">keep_alive</span>():</span><br><span class="line">  t= Thread(target=run)</span><br><span class="line">  t.start()</span><br></pre></td></tr></table></figure><p>éšåï¼Œå°±å¼€å§‹æ ¹æ®æˆ‘ä»“åº“çš„ä»£ç ï¼Œåˆ›å»ºåŒåæ–‡ä»¶ï¼Œå¹¶å°†ä»£ç å¤åˆ¶è¿›å»</p><blockquote><p>githubçš„ä»£ç æ›´åŠ æ–°ï¼Œå¦‚æœèƒ½æ‰“å¼€githubï¼Œè¯·åœ¨githubå¤åˆ¶ä»£ç ï¼š<a class="link"   href="https://github.com/musnows/Kook-Ticket-Bot" >https://github.com/musnows/Kook-Ticket-Bot<i class="fas fa-external-link-alt"></i></a></p><p>å®åœ¨æ‰“ä¸å¼€ï¼Œå†æ¥giteeï¼š<a class="link"   href="https://gitee.com/musnow/Kook-Ticket-Bot/tree/main/code" >https://gitee.com/musnow/Kook-Ticket-Bot/tree/main/code<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>mainå°±ä¸ç”¨åˆ›å»ºäº†ï¼Œé»˜è®¤å·²ç»æœ‰äº†ï¼Œç›´æ¥æŠŠä»£ç å¤åˆ¶è¿›å»å°±è¡Œäº†ï¼›æ‰€æœ‰æ–‡ä»¶æ·»åŠ å®Œæ¯•ä¹‹åï¼Œåº”è¯¥æ˜¯ä¸‹é¢è¿™æ ·çš„</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d089ce45e.png"                      alt="image-20230209185259526"                ></p><p>è¿™æ ·ï¼Œä»£ç å°±æ·»åŠ å¥½äº†</p><h2 id="3-3-æ·»åŠ é…ç½®æ–‡ä»¶"><a href="#3-3-æ·»åŠ é…ç½®æ–‡ä»¶" class="headerlink" title="3.3 æ·»åŠ é…ç½®æ–‡ä»¶"></a>3.3 æ·»åŠ é…ç½®æ–‡ä»¶</h2><p>æ¥ä¸‹æ¥å°±æ˜¯æ›´å…·ä»“åº“çš„READMEæ·»åŠ å„ç±»é…ç½®æ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">config/config.json <span class="comment">#æœºå™¨äººtokené…ç½®</span></span><br><span class="line">config/TicketConf.json <span class="comment"># ticketé…ç½®</span></span><br><span class="line">log/TicketLog.json <span class="comment">#ticketæ—¥å¿—</span></span><br><span class="line">log/TicketMsgLog.json <span class="comment"># æ¶ˆæ¯è®°å½•</span></span><br><span class="line">log/ColorID.json <span class="comment"># è¡¨æƒ…å›åº”ä¸Šè§’è‰²</span></span><br></pre></td></tr></table></figure><p>å…ˆæŠŠå¦‚ä¸Šçš„å‡ ä¸ªæ–‡ä»¶å…¨éƒ¨å»ºç«‹å¥½ï¼Œç„¶åæ ¹æ®<a class="link"   href="https://gitee.com/musnow/Kook-Ticket-Bot/blob/main/README.md" >ä»“åº“çš„README<i class="fas fa-external-link-alt"></i></a>å¾€é‡Œé¢æ·»åŠ é”®å€¼ï¼Œè¿™é‡Œä¸é‡å¤READMEä¸­å·²æœ‰å†…å®¹</p><p>å¾ˆå¤šæ“ä½œéƒ½éœ€è¦å¤åˆ¶IDï¼Œå…ˆåœ¨è®¾ç½®é«˜çº§è®¾ç½®ä¸­å¼€å¯å¼€å‘è€…æ¨¡å¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d159b33fa.png"                      alt="image-20230209185627493"                ></p><p>ä¸‹é¢ç»™å‡ºä¸€ä¸ª<code>TicketConf.json</code>ä¸­éœ€è¦é…ç½®çš„å‡ é¡¹çš„æ ·ä¾‹</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d287f32c9.png"                      alt="image-20230209190129489"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d2e8b0e74.png"                      alt="image-20230209190306382"                ></p><p>åœ¨è¿™é‡Œé‡ç”³ï¼Œæ·»åŠ äº†è¿™ä¸¤ä¸ªè§’è‰²idä¹‹åï¼Œ<strong>å¿…é¡»è¦ç»™äºˆç”¨æˆ·å¯¹åº”çš„è§’è‰²</strong>ï¼ˆç‰¹åˆ«æ˜¯è…ç«¹ï¼‰æ‰èƒ½æ“ä½œbotçš„å‘½ä»¤ï¼Œå¦åˆ™æç¤ºæƒé™ä¸è¶³</p><p>é…ç½®ä¸ºæ–‡ä»¶æ·»åŠ å®Œæ¯•ä¹‹åï¼Œåº”è¯¥æ˜¯ä¸‹é¢è¿™æ ·çš„</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d7db5ccc3.png"                      alt="image-20230209192413122"                ></p><h2 id="3-4-å¼€å§‹è¿è¡Œ"><a href="#3-4-å¼€å§‹è¿è¡Œ" class="headerlink" title="3.4 å¼€å§‹è¿è¡Œ"></a>3.4 å¼€å§‹è¿è¡Œ</h2><p>å¼€å§‹è¿è¡Œå‰çš„æœ€åä¸€æ­¥ï¼Œè¿›å…¥<code>main.py</code>ï¼Œå–æ¶ˆå¯¹æœ€åä¸¤è¡Œä»£ç çš„æ³¨é‡Š</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d41360485.png"                      alt="image-20230209190805189"                ></p><p>è¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç‚¹å‡»é¡¶éƒ¨çš„runï¼Œå°è¯•è¿è¡Œbotäº†ï¼Œå˜æˆä¸‹é¢çš„æ ·å­é‚£å°±æ˜¯åœ¨è¿è¡Œäº†</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d358873d0.png"                      alt="image-20230209190458439"                ></p><p>åˆšå¼€å§‹æ‰“å°ä¼šæç¤ºè¿™ä¸ªï¼Œä»£è¡¨æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„åŒ…</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d367a7794.png"                      alt="image-20230209190513475"                ></p><p>å·¥å…·toolsé‡Œé¢é€‰æ‹©packgesï¼Œåœ¨é‡Œé¢æœç´¢khl.py</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d37809943.png"                      alt="image-20230209190529916"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d3d2dae7e.png"                      alt="image-20230209190601848"                ></p><p>å¦‚ä¸‹æç¤ºï¼Œå®‰è£…æˆåŠŸï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d3cfc2cc7.png"                      alt="image-20230209190657593"                ></p><p>åœ¨ç‚¹å‡»è¿è¡Œï¼Œå‡ºç°å¦‚å›¾æ‰€ç¤ºçš„é¡µé¢ï¼Œé‚£å°±æ˜¯è¿è¡ŒæˆåŠŸäº†ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d437ebe6e.png"                      alt="image-20230209190841115"                ></p><p>ç°åœ¨è¿›kooké‡Œé¢ï¼Œå…ˆæµ‹è¯•ä¸€ä¸‹æˆ‘ä»¬çš„botæ˜¯å¦åœ¨çº¿</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d45c3ee99.png"                      alt="image-20230209190918053"                ></p><p>æµ‹è¯•é€šè¿‡ï¼åå°ä¹Ÿæ‰“å°å‡ºäº†æ—¥å¿—</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d48dd932c.png"                      alt="image-20230209191007686"                ></p><h2 id="3-5-uptimeRobot"><a href="#3-5-uptimeRobot" class="headerlink" title="3.5 uptimeRobot"></a>3.5 uptimeRobot</h2><p>åˆ«æ€¥åˆ«æ€¥ï¼Œè™½ç„¶åˆ°è¿™é‡Œå·²ç»okäº†ï¼Œä½†æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªæ­¥éª¤è¦åš</p><p>è¿›å…¥uptimeRobotï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªç›‘æ§å®ä¾‹ï¼Œæ¥è°ƒç”¨æˆ‘ä»¬çš„<code>keepal</code>æ¨¡ç»„ä¸­çš„å‡½æ•°ï¼Œä¿è¯æˆ‘ä»¬çš„botä¸ä¼šå› ä¸ºreplitçš„ç­–ç•¥è€Œä¸‹çº¿</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d4c987b38.png"                      alt="image-20230209191107440"                ></p><p>ç‚¹å‡»<code>add new monitor</code>ï¼Œé€‰æ‹©http</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d4d329cad.png"                      alt="image-20230209191116969"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d4f293359.png"                      alt="image-20230209191148477"                ></p><p>æŒ‰å¦‚ä¸‹æ‰€ç¤ºå¡«å†™</p><ul><li>nameéšä¾¿å¡«ä¸ªè‹±æ–‡å</li><li>urlå¡«åœ¨replitå¤åˆ¶çš„é“¾æ¥</li><li>intervelæ˜¯å•æ¬¡ç›‘æ§çš„é—´éš”ï¼Œé€‰æ‹©1-5åˆ†é’Ÿéƒ½å¯ä»¥</li><li>timeouté»˜è®¤30sä¸éœ€è¦ä¿®æ”¹</li><li>ä¸¤ä¸ªsslå–æ¶ˆå‹¾é€‰</li></ul><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d55ecb6e0.png"                      alt="image-20230209191336353"                ></p><p>å»ºè®®å‹¾é€‰ä¸Šè¿™ä¸ªï¼Œåœ¨botä¸‹çº¿çš„æ—¶å€™ï¼Œä¼šå‘ä½ çš„é‚®ç®±å‘é€é€šçŸ¥</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d5ab3b849.png"                      alt="image-20230209191453032"                ></p><p>é…ç½®å®Œæ¯•ï¼Œç‚¹å‡»å³ä¸‹è§’çš„create</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d5d51fadc.png"                      alt="image-20230209191534999"                ></p><p>è¿™æ—¶å€™å°±ä¼šå¼€å§‹è¿è¡Œäº†ï¼ä¸‹æ–¹çš„<code>pause</code>å¯ä»¥æš‚åœè¿è¡Œã€‚</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d60795e56.png"                      alt="image-20230209191625292"                ></p><p>å¦‚æœä½ createå®Œæ¯•ï¼Œå‘ç°æ˜¯é»‘è‰²çš„ï¼Œé‚£å°±ç‚¹å‡»ä¸€ä¸‹<code>start</code>è®©ä»–å¼€å§‹è¿è¡Œ</p><h1 id="4-æ—¥å¿—æ–‡ä»¶"><a href="#4-æ—¥å¿—æ–‡ä»¶" class="headerlink" title="4.æ—¥å¿—æ–‡ä»¶"></a>4.æ—¥å¿—æ–‡ä»¶</h1><p>é»˜è®¤çš„æ‰€æœ‰æ‰“å°éƒ½ä¼šæ‰“å°åˆ°æ§åˆ¶å°é‡Œé¢ï¼Œè¿è¡Œæ—¶é—´ä¹…äº†ï¼Œreplitçš„æ§åˆ¶å°å¯èƒ½æ— æ³•è·å–åˆ°æ‰€æœ‰ä¿¡æ¯ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹è¾“å‡ºè¿›è¡Œé‡å®šå‘</p><p>å¦‚æœä½ éœ€è¦æ—¥å¿—æ–‡ä»¶ï¼ˆæˆ‘å»ºè®®ä¸€å®šè¦è¿™ä¹ˆåšï¼ï¼‰é‚£å°±éœ€åœ¨mainé‡Œé¢æ·»åŠ ä¸€éƒ¨åˆ†ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ ‡å‡†è¾“å‡ºé‡å®šå‘è‡³æ–‡ä»¶</span></span><br><span class="line">file =  <span class="built_in">open</span>(<span class="string">&#x27;./log/log.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">sys.stdout = file </span><br><span class="line">sys.stderr = file</span><br></pre></td></tr></table></figure><p>æ·»åŠ åˆ°å¼€å¤´<code>start_time</code>ä»¥åå³å¯</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4e3a4815e1.png"                      alt="image-20230209201430435"                ></p><p>ç°åœ¨æ›´æ–°äº†ä»£ç ä»¥åï¼Œåªéœ€è¦å–æ¶ˆå¼€å¤´è¿™é‡Œçš„æ³¨é‡Šå³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ ‡å‡†è¾“å‡ºé‡å®šå‘è‡³æ–‡ä»¶</span></span><br><span class="line">logDup(<span class="string">&#x27;./log/log.txt&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4e89784e2b.png"                      alt="image-20230209203537248"                ></p><p>è¿™æ ·åšè¿˜ä¸å¤Ÿï¼Œbotæœ‰ä¸€ä¸ªç‰¹æ®Šçš„killå‘½ä»¤ï¼Œæ‰§è¡Œæ­¤killå‘½ä»¤ï¼Œå¯ä»¥åˆ·æ–°ç¼“å†²åŒºï¼Œé¿å…å‡ºç°æ•°æ®åœ¨ç¼“å†²åŒºä¸­æ²¡æœ‰å†™å…¥åˆ°æ–‡ä»¶ï¼Œå¯¼è‡´ä¸¢å¤±æ—¥å¿—</p><p><strong>å¦‚æœä½ æƒ³é€€å‡ºbotï¼Œå»ºè®®ä½¿ç”¨killå‘½ä»¤æ¥æ“ä½œ</strong>ï¼</p><h1 id="å¤§åŠŸå‘Šæˆï¼"><a href="#å¤§åŠŸå‘Šæˆï¼" class="headerlink" title="å¤§åŠŸå‘Šæˆï¼"></a>å¤§åŠŸå‘Šæˆï¼</h1><p>ç°åœ¨ä½ å¯ä»¥æ ¹æ®helpå»æµ‹è¯•ä¸€ä¸‹å„ç±»å‘½ä»¤æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œå•¦</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d65f0d1ba.png"                      alt="image-20230209191752878"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d66ef26cc.png"                      alt="image-20230209191808588"                ></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d88927a1e.png"                      alt="image-20230209192707010"                ></p><p>æ³¨æ„ï¼Œå…³é—­ticketä¹‹åå¯èƒ½ä¼šå‡ºç°è¿™ä¸ªæŠ¥é”™ï¼Œè¿™æ˜¯å› ä¸ºç”¨æˆ·ä»æ¥æ²¡æœ‰ç»™botå‘é€è¿‡ä¿¡æ¯ï¼Œå¯¼è‡´botæ— æ³•ç”¨æˆ·å‘é€ç§ä¿¡ï¼Œ<strong>å¿½ç•¥</strong>æ­¤æŠ¥é”™å³å¯ï¼ˆæ–°ç‰ˆæœ¬å·²ç»å–æ¶ˆäº†è¿™ä¸ªæŠ¥é”™ï¼‰</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4d688ea0df.png"                      alt="image-20230209191834582"                ></p><p>å› ä¸ºreplitæ˜¯å…è´¹çš„ï¼Œæ‰€ä»¥botçš„ååº”å¯èƒ½æœ‰äº›è¿Ÿé’ï¼Œæ­£å¸¸æƒ…å†µï¼</p><p><font color=Red>å†æ¬¡æé†’ï¼</font>replitä¸Šçš„å…è´¹ä»“åº“ï¼Œé»˜è®¤æ˜¯<strong>å…¬å¼€</strong>çš„ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰äººéƒ½èƒ½è®¿é—®åˆ°ä½ è¿™ä¸ªä»“åº“é‡Œé¢çš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬botçš„tokenå’Œæ—¥å¿—ä¿¡æ¯ï¼è‹¥æ‚¨çš„ticket-botå¯¹æ•°æ®ç§å¯†æ€§è¦æ±‚è¾ƒé«˜ï¼Œè¯·<strong>è‡ªè´­æœåŠ¡å™¨</strong>æˆ–æ‰¾å¼€å‘è€…ä»£ä¸ºéƒ¨ç½²ï¼</p><blockquote><p>ä½ å¯ä»¥<a class="link"   href="https://replit.com/@Aewait/ticket#keepal.py" >forkæˆ‘è¿™æ¬¡éƒ¨ç½²çš„bot<i class="fas fa-external-link-alt"></i></a>ï¼ˆ23-02-10ï¼‰ä½†æ˜¯åç»­çš„ä»£ç æ›´æ–°è¿˜æ˜¯éœ€è¦è‡ªå·±æ“ä½œå“¦ï¼</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ•™ä½ ç™½å«–replitéƒ¨ç½²kookçš„ticketæœºå™¨äºº&lt;/p&gt;</summary>
    
    
    
    <category term="é€Ÿé€šPython" scheme="https://blog.musnow.top/categories/%E9%80%9F%E9%80%9APython/"/>
    
    
    <category term="Python" scheme="https://blog.musnow.top/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>ã€Linuxã€‘å®ç°å®ˆæŠ¤è¿›ç¨‹ | ä»¥tcpServerä¸ºä¾‹</title>
    <link href="https://blog.musnow.top/2023/02/09/Linux/30%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B/"/>
    <id>https://blog.musnow.top/2023/02/09/Linux/30%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B/</id>
    <published>2023-02-09T06:08:30.000Z</published>
    <updated>2023-03-11T11:25:36.240Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡å°†ä»¥tcpæœåŠ¡å™¨ä»£ç ä¸ºåŸºæœ¬ï¼Œè®²è¿°å¦‚ä½•å°†è¿›ç¨‹å®ˆæŠ¤è¿›ç¨‹åŒ–ï¼Œåå°è¿è¡Œ</p><span id="more"></span><h1 id="1-å®ˆæŠ¤è¿›ç¨‹"><a href="#1-å®ˆæŠ¤è¿›ç¨‹" class="headerlink" title="1.å®ˆæŠ¤è¿›ç¨‹"></a>1.å®ˆæŠ¤è¿›ç¨‹</h1><p>æ‰€è°“å®ˆæŠ¤è¿›ç¨‹ï¼Œå°±æ˜¯å’Œå…¶ä»–è¿›ç¨‹æ²¡æœ‰å…³ç³»çš„è¿›ç¨‹ï¼›å…¶ç‹¬ç«‹è¿è¡Œäºç³»ç»Ÿåå°ï¼Œé™¤éè‡ªå·±é€€å‡ºæˆ–æ”¶åˆ°ä¿¡å·ç»ˆæ­¢ï¼Œå¦åˆ™ä¼šä¸€ç›´è¿è¡Œä¸‹å»</p><h2 id="1-1-è¿›ç¨‹ç»„"><a href="#1-1-è¿›ç¨‹ç»„" class="headerlink" title="1.1 è¿›ç¨‹ç»„"></a>1.1 è¿›ç¨‹ç»„</h2><p>åœ¨æˆ‘ä»¬ä½¿ç”¨çš„bashä¸­ï¼ŒåŒä¸€æ—¶åˆ»åªä¼šæœ‰ä¸€ä¸ª<strong>å‰å°è¿›ç¨‹ç»„</strong></p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e457da7126b.png"                      alt="image-20230209101802180"                ></p><p>å¦‚å›¾ï¼Œå½“ä¸€ä¸ªå‰å°è¿›ç¨‹å¼€å§‹è¿è¡Œä¹‹åï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•åœ¨å½“å‰ç»ˆç«¯å¼€å¯<strong>ç¬¬äºŒä¸ªå‰å°è¿›ç¨‹</strong>ã€‚</p><p>åœ¨è¿è¡Œçš„å‘½ä»¤åé¢åŠ &amp;ï¼Œä¸´æ—¶è®©å½“å‰è¿›ç¨‹<strong>åœ¨åå°è¿è¡Œ</strong>ã€‚æ³¨æ„ï¼Œæ­¤æ—¶tcpè™½ç„¶åœ¨åå°è¿è¡Œäº†ï¼Œ ä½†å¯¹äºå®ƒè€Œè¨€ï¼Œ<code>stdin/stdout/stderr</code>çš„æ–‡ä»¶æè¿°ç¬¦ä¾æ—§æŒ‡å‘çš„æ˜¯å½“å‰bashçš„è¾“å…¥è¾“å‡ºï¼Œæ‰€ä»¥å®ƒçš„æ—¥å¿—ä¾æ—§ä¼šæ‰“å°åˆ°å½“å‰ç»ˆç«¯ä¸Šã€‚</p><p>ç”¨<code>ps</code>å‘½ä»¤æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„ä¿¡æ¯ï¼Œå…¶ä¸­<code>ppid</code>æ˜¯å½“å‰è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯å½“å‰bashï¼Œ<code>pid</code>æ˜¯è¿›ç¨‹ç¼–å·ï¼Œ<code>pgid</code>æ˜¯è¿›ç¨‹çš„ç»„ç¼–å·ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªç»„ç¼–å·å’Œgrepå‘½ä»¤çš„ç»„ç¼–å·æ˜¯ä¸åŒçš„ã€‚</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e45ba4133c4.png"                      alt="image-20230209103412568"                ></p><p>æˆ‘ä»¬ç”¨è¿™ä¸ªcè¯­è¨€çš„ä»£ç è°ƒç”¨ä¸¤æ¬¡forkï¼Œç›¸å½“äºåˆ›å»ºäº†3ä¸ªå­è¿›ç¨‹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    fork();</span><br><span class="line">    fork();</span><br><span class="line">    sleep(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å†æ¥æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯ï¼Œèƒ½çœ‹åˆ°è¿™4ä¸ªè¿›ç¨‹çš„è¿›ç¨‹ç»„pgidæ˜¯ç›¸åŒçš„ï¼Œè€Œä¸”å’Œ<strong>ç¬¬ä¸€ä¸ªtestçš„pidç›¸åŒ</strong>ï¼›è¿™è¯´æ˜ç¬¬ä¸€ä¸ªtestå°±æ˜¯<strong>çˆ¶è¿›ç¨‹</strong>ï¼Œåé¢çš„3ä¸ªéƒ½æ˜¯å­è¿›ç¨‹ã€‚</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e45da7770c3.png"                      alt="image-20230209104248061"                ></p><h2 id="1-2-è¿›ç¨‹ä¼šè¯"><a href="#1-2-è¿›ç¨‹ä¼šè¯" class="headerlink" title="1.2 è¿›ç¨‹ä¼šè¯"></a>1.2 è¿›ç¨‹ä¼šè¯</h2><p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæˆ‘ä»¬ä¹‹å‰æ²¡æœ‰å¤ªå¤šäº†è§£çš„ä¿¡æ¯ï¼Œè¿›ç¨‹çš„<strong>sid</strong>æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>è¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼Œåœ¨å›¾ä¸­èƒ½çœ‹åˆ°ï¼Œæˆ‘ä»¬æ‰§è¡Œçš„testå’Œgrepçš„sidéƒ½æ˜¯ç›¸åŒçš„ï¼Œè€Œä¸”éƒ½ç­‰äºç¬¬ä¸€ä¸ªtestè¿›ç¨‹çš„ppidï¼ˆbashçš„pidï¼‰</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e45da7770c3.png"                      alt="image-20230209104248061"                ></p><p>è¿™è¡¨æ˜å›¾ä¸­çš„5ä¸ªè¿›ç¨‹åŒå±äºä¸€ä¸ªè¿›ç¨‹ä¼šè¯ï¼Œ<strong>è¿™ä¸ªä¼šè¯å°±æ˜¯æˆ‘ä»¬å½“å‰æ‰“å¼€çš„bash</strong>ï¼Œå¹¶ç”¨sidæ¥è¡¨ç¤ºè¿›ç¨‹ä¼šè¯ï¼›</p><blockquote><p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ç™»å½•linuxçš„æ—¶å€™ä¸€å®šä¼šæœ‰ä¸€ä¸ªç»ˆç«¯ï¼Œlinuxç³»ç»Ÿå°±æ˜¯åˆ›å»ºä¼šè¯å¹¶åŠ è½½bashï¼Œæ¥ç»™ç”¨æˆ·æä¾›æœåŠ¡çš„ã€‚</p></blockquote><p>æ—¢ç„¶å­˜åœ¨ä¼šè¯ï¼Œé‚£å°±è‚¯å®šä¼šæœ‰ä¼šè¯çš„èµ„æºä¸Šé™ã€‚ä¸€æ—¦æ»¡äº†ï¼Œ<strong>å°±ä¼šå¼€å§‹æ€æ‰ä¸€äº›è¿›ç¨‹</strong>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./test &amp;</span><br></pre></td></tr></table></figure><p>å³ä¾¿æˆ‘ä»¬ç”¨&amp;è®©è¿›ç¨‹åœ¨åå°è¿è¡Œï¼Œå…¶ä¹Ÿæœ‰å¯èƒ½æ”¶åˆ°ä¼šè¯çš„<code>åˆ›å»º/å…³é—­</code>çš„å½±å“è€Œè¢«æ“ä½œç³»ç»Ÿå¹²æ‰ğŸ§æ¯”å¦‚æˆ‘ä»¬å°†<strong>å½“å‰æ­£åœ¨è¿è¡Œè¿›ç¨‹çš„bashå…³æ‰</strong>ï¼Œå…¶å‰å°è¿›ç¨‹ä¼šè¢«ç›´æ¥ç»ˆæ­¢ï¼Œåå°è¿›ç¨‹ä¹Ÿä¼šå—åˆ°å½±å“ï¼ˆæœ‰å¯èƒ½ç»ˆæ­¢æœ‰å¯èƒ½ä¸ç»ˆæ­¢ï¼Œå–å†³äºç³»ç»Ÿï¼‰</p><p>è¿™å’Œæˆ‘ä»¬å¯¹tcpæœåŠ¡å™¨çš„éœ€æ±‚ä¸ä¸€è‡´ï¼šæˆ‘ä»¬éœ€è¦çš„æ˜¯è®©tcpæœåŠ¡å™¨çš„è¿›ç¨‹èƒ½ä¸€ç›´ç¨³å®šçš„åœ¨åå°è¿è¡Œï¼Œ<strong>è®©æ“ä½œç³»ç»Ÿåˆ«å»ç®¡å®ƒ</strong>ï¼›é™¤éç³»ç»Ÿå†…å­˜æ»¡äº†ï¼Œè´Ÿè½½é‡åˆ°å®åœ¨æ²¡æœ‰åŠæ³•çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿæ‰èƒ½è¿‡æ¥æŠŠä»–åˆ€äº†ã€‚</p><p>ä¸ºäº†ä¸è®©å®ˆæŠ¤è¿›ç¨‹å—åˆ°è¿›ç¨‹ä¼šè¯çš„å½±å“ï¼Œæˆ‘ä»¬å°±å¿…é¡»è®©å…¶èƒ½å¤Ÿç‹¬ç«‹å‡ºæ¥ï¼Œ<strong>è‡ªæˆä¸€ä¸ªè¿›ç¨‹ç»„å’Œä¸€ä¸ªæ–°ä¼šè¯</strong></p><p>ğŸ‘†è¿™ç§ç‹¬ç«‹çš„è¿›ç¨‹ï¼Œå°±å¯ä»¥è¢«ç§°ä¸º<code>å®ˆæŠ¤è¿›ç¨‹/ç²¾çµè¿›ç¨‹</code></p><h1 id="2-å®ç°"><a href="#2-å®ç°" class="headerlink" title="2.å®ç°"></a>2.å®ç°</h1><h2 id="2-1-è‡ªå·±å†™"><a href="#2-1-è‡ªå·±å†™" class="headerlink" title="2.1 è‡ªå·±å†™"></a>2.1 è‡ªå·±å†™</h2><p>åˆ«ä»¥ä¸ºå†™è¿™ä¸ªå¾ˆéš¾å“¦ï¼Œå®é™…ç‰¹åˆ«ç®€å•ï¼</p><h3 id="2-1-1-setsid"><a href="#2-1-1-setsid" class="headerlink" title="2.1.1 setsid"></a>2.1.1 setsid</h3><p>è¿™é‡Œéœ€è¦ç”¨åˆ°çš„setsidæ¥å£ï¼Œå…¶ä½œç”¨å¦‚åå­—ä¸€èˆ¬ï¼Œæ˜¯è®¾ç½®å½“å‰è¿›ç¨‹çš„è¿›ç¨‹ä¼šè¯ç»„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">pid_t</span> <span class="title function_">setsid</span><span class="params">(<span class="type">void</span>)</span>;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è°ƒç”¨è¿™ä¸ªå‡½æ•°æœ‰ä¸€ä¸ªè¦æ±‚ï¼šè°ƒç”¨çš„è¿›ç¨‹ä¸èƒ½æ˜¯è¿›ç¨‹ç»„çš„ç»„é•¿ï¼</p><p>æ¯”å¦‚ä¸‹å›¾ä¸­ï¼Œç¬¬ä¸€ä¸ªtestå°±æ˜¯è¿›ç¨‹ç»„çš„ç»„é•¿ï¼Œå®ƒä¸èƒ½è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚ä¼šæŠ¥é”™</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e45da7770c3.png"                      alt="image-20230209104248061"                ></p><p>é‚£è¦æ€ä¹ˆè®©è‡ªå·±ä¸æˆä¸ºè¿›ç¨‹ç»„çš„ç»„é•¿å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹å°±okäº†ï¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (fork() &gt; <span class="number">0</span>)</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);<span class="comment">//çˆ¶è¿›ç¨‹ç›´æ¥é€€å‡º</span></span><br></pre></td></tr></table></figure><h3 id="2-1-2-é‡å®šå‘åˆ°dev-x2F-null"><a href="#2-1-2-é‡å®šå‘åˆ°dev-x2F-null" class="headerlink" title="2.1.2 é‡å®šå‘åˆ°dev&#x2F;null"></a>2.1.2 é‡å®šå‘åˆ°dev&#x2F;null</h3><blockquote><p>å¦‚æœä½ ä¸çŸ¥é“ä»€ä¹ˆæ˜¯<code>/dev/null</code>ï¼Œç®€è€Œè¨€ä¹‹ï¼Œè¿™æ˜¯ä¸€ä¸ªlinuxä¸‹çš„æ•°æ®åƒåœ¾æ¡¶ã€‚å’Œwindowsçš„å›æ”¶ç«™ä¼šå­˜æ”¾åˆ é™¤çš„èµ„æ–™ä¸åŒï¼Œè¿™ä¸ªåƒåœ¾æ¡¶æ˜¯ä¸ªé»‘æ´ï¼Œä¸¢è¿›å»çš„ä¸œè¥¿ä¸ä¼šè¢«å­˜æ”¾ï¼Œæ˜¯ç›´æ¥ä¸¢å¼ƒçš„ï¼</p></blockquote><p>å®ˆæŠ¤è¿›ç¨‹éœ€è¦æŠŠé»˜è®¤çš„<code>0.1.2</code>æ–‡ä»¶æè¿°ç¬¦éƒ½é‡å®šå‘åˆ°<code>dev/null</code>ï¼Œæ˜¯å› ä¸ºè®¾ç½®æˆç‹¬ç«‹çš„è¿›ç¨‹ç»„å’Œè¿›ç¨‹ä¼šè¯äº†ä¹‹åï¼Œå½“å‰è¿›ç¨‹æ˜¯æ²¡æœ‰å’Œbashå…³è”çš„ã€‚</p><p>æ­¤æ—¶ï¼Œé»˜è®¤è¿™ä¸ª<code>0 1 2</code>æ‰€æŒ‡å‘çš„bashæ˜¯<strong>æ— æ•ˆ</strong>çš„ï¼å¦‚æœä¸é‡å®šå‘ï¼Œä½¿ç”¨coutæ‰“å°çš„æ—¶å€™ï¼Œå°±ä¼šå¼•å‘å¼‚å¸¸ï¼ˆå¯ä»¥ç†è§£ä¸ºå¾€ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ä¸­å†™å†…å®¹ï¼‰ï¼ŒæœåŠ¡å™¨ç›´æ¥é€€å‡ºäº†ï¼Œæ— æ³•å®ç°å®ˆæŠ¤è¿›ç¨‹ã€‚</p><p>é‡å®šå‘äº†ä¹‹åï¼Œæ‰€æœ‰çš„æ‰“å°è¾“å‡ºéƒ½ä¼šè¢«ä¸¢åˆ°<code>/dev/null</code>è¿™ä¸ªæ–‡ä»¶åƒåœ¾æ¡¶ä¸­ï¼Œä¹Ÿå°±ä¸éœ€è¦æ‹…å¿ƒä¸Šè¿°çš„é—®é¢˜ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((fd = open(<span class="string">&quot;/dev/null&quot;</span>, O_RDWR)) != <span class="number">-1</span>) <span class="comment">// fd == 3</span></span><br><span class="line">&#123;</span><br><span class="line">    dup2(fd, STDIN_FILENO);</span><br><span class="line">    dup2(fd, STDOUT_FILENO);</span><br><span class="line">    dup2(fd, STDERR_FILENO);</span><br><span class="line">    <span class="comment">// 6. å…³é—­æ‰ä¸éœ€è¦çš„fd</span></span><br><span class="line">    <span class="comment">// å› ä¸ºfdåªæ˜¯ä¸´æ—¶ç”¨äºé‡å®šå‘ï¼Œæ“ä½œå®Œæ¯•äº†å°±å¯ä»¥å…³æ‰äº†</span></span><br><span class="line">    <span class="keyword">if</span>(fd &gt; STDERR_FILENO) </span><br><span class="line">        close(fd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼Œé‚£æ—¥å¿—ä¿¡æ¯ä¹Ÿè¢«ä¸¢åˆ°åƒåœ¾æ¡¶é‡Œé¢äº†ï¼Œæ€ä¹ˆåŠï¼Ÿ</p><p>å¾ˆç®€å•ï¼Œå› ä¸ºæˆ‘ä»¬æœåŠ¡å™¨çš„æ—¥å¿—éƒ½ç»Ÿä¸€ä½¿ç”¨äº†<code>log.hpp</code>é‡Œé¢çš„<code>logging</code>å‡½æ•°ï¼Œæ‰€ä»¥åªéœ€è¦å¯¹<code>logging</code>å‡½æ•°çš„è¾“å‡ºé‡å®šå‘åˆ°æ—¥å¿—æ–‡ä»¶é‡Œé¢ï¼Œå°±okäº†ï¼</p><h3 id="2-1-3-chdirï¼ˆé€‰åšï¼‰"><a href="#2-1-3-chdirï¼ˆé€‰åšï¼‰" class="headerlink" title="2.1.3 chdirï¼ˆé€‰åšï¼‰"></a>2.1.3 chdirï¼ˆé€‰åšï¼‰</h3><p>è¿™ä¸ªæ“ä½œçš„ç›®çš„æ˜¯ä¿®æ”¹å·¥ä½œè·¯å¾„ã€‚ä½œä¸ºæœåŠ¡å™¨è¿›ç¨‹ï¼Œå¾ˆå¤šæ—¥å¿—ä¿¡æ¯æ˜¯å­˜æ”¾åœ¨<code>/etc/</code>ç›®å½•è€Œä¸æ˜¯å½“å‰è·¯å¾„ä¸‹çš„ï¼Œä¸ºäº†å®‰å…¨ï¼Œä¹Ÿåº”è¯¥ä½¿ç”¨<code>ç»å¯¹è·¯å¾„</code>è€Œä¸ç”¨ç›¸å¯¹è·¯å¾„ï¼Œé¿å…å‡ºç°å·¥ä½œç›®å½•åˆ‡æ¢è€Œå¯¼è‡´çš„æ— æ³•è¯»å†™æ–‡ä»¶çš„é—®é¢˜</p><p>ä¸è¿‡ï¼Œå¦‚æœä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œå³ä¾¿æˆ‘ä»¬ä¸ä¿®æ”¹å·¥ä½œç›®å½•ï¼Œä¹Ÿæ˜¯èƒ½æ­£å¸¸è®¿é—®çš„ï¼›æ‰€ä»¥è¿™ä¸ªæ“ä½œæ˜¯é€‰åšçš„</p><h3 id="2-1-4-ä¿¡å·æ•æ‰"><a href="#2-1-4-ä¿¡å·æ•æ‰" class="headerlink" title="2.1.4 ä¿¡å·æ•æ‰"></a>2.1.4 ä¿¡å·æ•æ‰</h3><p>è‡ªå·±å†™è¿™ä¸ªå‡½æ•°æœ‰ä¸ªå¥½å¤„ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨é‡Œé¢è‡ªå®šä¹‰æ•æ‰ä¸€äº›ä¿¡å·ï¼Œç»™è¿™äº›ä¿¡å· åŠ ä¸Šè‡ªå·±çš„è‡ªå®šä¹‰æ–¹æ³•ï¼›</p><p>æ¯”å¦‚<code>SIGPIPE</code>å°±æ˜¯ç®¡é“çš„ä¿¡å·ï¼Œå½“ç®¡é“çš„è¯»ç«¯å…³é—­çš„æ—¶å€™ï¼Œå†™ç«¯ä¼šè¢«ç»ˆæ­¢ï¼›æ­¤æ—¶å†™ç«¯å°±ä¼šæ”¶åˆ°è¿™ä¸ªä¿¡å·ã€‚å¦‚æœä¸å¯¹è¿™ä¸ªä¿¡å·è¿›è¡Œ<code>SIG_IGN</code>å¿½ç•¥ï¼Œæˆ‘ä»¬çš„æœåŠ¡å™¨ä¼šç›´æ¥ç»ˆæ­¢ï¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">signal(SIGPIPE, SIG_IGN);</span><br></pre></td></tr></table></figure><p>é™¤äº†è¿™ä¸ªä¿¡å·ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹2å·æˆ–è€…3å·ä¿¡å·è¿›è¡Œè‡ªå®šä¹‰æ•æ‰ï¼Œè®¾å®šé€€å‡ºä¿¡å·ï¼Œè®©æœåŠ¡å™¨èƒ½å¤Ÿ<strong>å®‰å…¨é€€å‡º</strong>ï¼ˆä¿å­˜æ—¥å¿—ä¿¡æ¯åˆ°ç£ç›˜ï¼Œé‡Šæ”¾èµ„æºç­‰ï¼›è™½ç„¶è¿›ç¨‹é€€å‡ºä¹‹åæ“ä½œç³»ç»Ÿä¼šå¸®æˆ‘ä»¬å¹²è¿™äº›äº‹ï¼Œä½†æˆ‘ä»¬è¿™ä¹ˆå†™èƒ½è®©é¡¹ç›®æ›´è§„èŒƒï¼‰</p><h3 id="2-1-5-å®Œæ•´ä»£ç "><a href="#2-1-5-å®Œæ•´ä»£ç " class="headerlink" title="2.1.5 å®Œæ•´ä»£ç "></a>2.1.5 å®Œæ•´ä»£ç </h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span> <span class="comment">// O_RDWR éœ€è¦</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">daemonize</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> fd = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 1. å¿½ç•¥SIGPIPE (ç®¡é“è¯»å†™ï¼Œè¯»ç«¯å…³é—­ï¼Œå†™ç«¯ä¼šæ”¶åˆ°ä¿¡å·ç»ˆæ­¢)</span></span><br><span class="line">    signal(SIGPIPE, SIG_IGN);</span><br><span class="line">    <span class="comment">// 2. æ›´æ”¹è¿›ç¨‹çš„å·¥ä½œç›®å½•</span></span><br><span class="line">    <span class="comment">// chdir(); // å¯ä»¥æ”¹ï¼Œå¯ä»¥ä¸æ”¹</span></span><br><span class="line">    <span class="comment">// 3. è®©è‡ªå·±ä¸è¦æˆä¸ºè¿›ç¨‹ç»„ç»„é•¿</span></span><br><span class="line">    <span class="keyword">if</span> (fork() &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 4. è®¾ç½®è‡ªå·±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ä¼šè¯</span></span><br><span class="line">    setsid();</span><br><span class="line">    <span class="comment">// 5. é‡å®šå‘0,1,2</span></span><br><span class="line">    <span class="keyword">if</span> ((fd = open(<span class="string">&quot;/dev/null&quot;</span>, O_RDWR)) != <span class="number">-1</span>) <span class="comment">// fd == 3</span></span><br><span class="line">    &#123;</span><br><span class="line">        dup2(fd, STDIN_FILENO);</span><br><span class="line">        dup2(fd, STDOUT_FILENO);</span><br><span class="line">        dup2(fd, STDERR_FILENO);</span><br><span class="line">        <span class="comment">// 6. å…³é—­æ‰ä¸éœ€è¦çš„fd</span></span><br><span class="line">        <span class="comment">// å› ä¸ºfdåªæ˜¯ä¸´æ—¶ç”¨äºé‡å®šå‘ï¼Œæ“ä½œå®Œæ¯•äº†å°±å¯ä»¥å…³æ‰äº†</span></span><br><span class="line">        <span class="keyword">if</span>(fd &gt; STDERR_FILENO) </span><br><span class="line">            close(fd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿™é‡Œè¿˜æœ‰å¦å¤–ä¸€ç§æ“ä½œï¼Œå°±æ˜¯æŠŠstdin/stdout/stderrç»™closeäº†</span></span><br><span class="line">    <span class="comment">// ä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´åªè¦æœ‰æ‰“å°è¾“å‡ºçš„ä»£ç ï¼Œè¿›ç¨‹ä¼šå°±å¼‚å¸¸é€€å‡º</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ²¡é”™ï¼Œå°±è¿™ä¸€ç‚¹ç‚¹ä»£ç ï¼Œå°±èƒ½è®©æˆ‘ä»¬çš„tcpæœåŠ¡å™¨å˜æˆå®ˆæŠ¤è¿›ç¨‹ï¼</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e487fbb466e.png"                      alt="image-20230209134324709"                ></p><p>æ­¤æ—¶æˆ‘ä»¬çš„å®¢æˆ·ç«¯ä¾æ—§èƒ½æ­£å¸¸è¿æ¥æœåŠ¡ç«¯ï¼Œè·å–ç»“æœ</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e48818b281f.png"                      alt="image-20230209134353714"                ></p><h2 id="2-2-nohup"><a href="#2-2-nohup" class="headerlink" title="2.2 nohup"></a>2.2 nohup</h2><p>no hang upï¼ˆä¸æŒ‚èµ·ï¼‰ï¼Œç”¨äºåœ¨ç³»ç»Ÿåå°ä¸æŒ‚æ–­åœ°è¿è¡Œå‘½ä»¤ï¼Œé€€å‡ºç»ˆç«¯ä¸ä¼šå½±å“ç¨‹åºçš„è¿è¡Œã€‚ç”¨nohupå‘½ä»¤æ‰§è¡Œä¸€ä¸ªè¿›ç¨‹ï¼Œ<strong>å°±èƒ½è®©è¿™ä¸ªè¿›ç¨‹æˆä¸ºä¸å—ç»ˆç«¯é€€å‡ºå½±å“çš„è¿›ç¨‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup ./test &amp;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œnohupä¼šåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code>nohup.out</code>æ–‡ä»¶ï¼Œç”¨äºè®°å½•testè¿›ç¨‹çš„è¾“å‡ºä¿¡æ¯ï¼ˆå¦‚æœé€šè¿‡äº†<code>&gt;</code>æˆ–<code>&gt;&gt;</code>æ‰§è¡Œäº†é‡å®šå‘ï¼Œåˆ™ä¸ä¼šåˆ›å»ºï¼‰</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e463b45c460.png"                      alt="image-20230209110836838"                ></p><p>é€šè¿‡pså¯å·²çœ‹åˆ°ï¼Œå½“å‰testè¿›ç¨‹çš„<strong>è¿›ç¨‹ä¼šè¯</strong>è¿˜æ˜¯å’Œbashç›¸åŒï¼Œä½†æˆ‘ä»¬å…³é—­å½“å‰bashï¼Œè¿™ä¸ªtestè¿›ç¨‹ä¾æ—§èƒ½æ­£å¸¸è¿è¡Œï¼Œåªä¸è¿‡çˆ¶è¿›ç¨‹ä¼šå˜æˆæ“ä½œç³»ç»Ÿ<code>1</code>ï¼Œæˆ‘ä»¬çš„ç›®çš„ä¹Ÿç®—æ˜¯è¾¾åˆ°äº†</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e46502f3387.png"                      alt="image-20230209111411664"                ></p><h2 id="2-3-deamonæ¥å£"><a href="#2-3-deamonæ¥å£" class="headerlink" title="2.3 deamonæ¥å£"></a>2.3 deamonæ¥å£</h2><p>linuxç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªæ¥å£<code>daemon</code>ï¼Œå¯ä»¥å¸®æˆ‘ä»¬å®ç°å®ˆæŠ¤è¿›ç¨‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">daemon</span><span class="params">(<span class="type">int</span> nochdir, <span class="type">int</span> noclose)</span>;</span><br></pre></td></tr></table></figure><p>äº†è§£è¿‡å®ˆæŠ¤è¿›ç¨‹çš„å†™æ³•äº†ä¹‹åï¼Œè¿™ä¸¤ä¸ªå‚æ•°çš„ä½œç”¨å°±å¾ˆæ˜æ˜¾äº†</p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°nochdirè¡¨æ˜æ˜¯å¦éœ€è¦ä¿®æ”¹å·¥ä½œç›®å½•ï¼›å¦‚æœè®¾ç½®ä¸º0ï¼Œåˆ™åˆ‡æ¢å·¥ä½œç›®å½•åˆ°<code>/</code>ç³»ç»Ÿæ ¹ç›®å½•</li><li>ç¬¬äºŒä¸ªå‚æ•°nocloseè¡¨æ˜æ˜¯å¦éœ€è¦é‡å®šå‘åŸºç¡€ioåˆ°<code>/dev/null</code>ï¼›è®¾ç½®ä¸º0åˆ™é‡å®šå‘</li></ul><p>ä»¥ä¸‹æ˜¯manæ‰‹å†Œä¸­çš„è¯´æ˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">If nochdir is zero, daemon() changes the calling process&#x27;s current working directory to the root directory (&quot;/&quot;); otherwise, the  curâ€</span><br><span class="line">rent working directory is left unchanged.</span><br><span class="line"></span><br><span class="line">If noclose is zero, daemon() redirects standard input, standard output and standard error to /dev/null; otherwise, no changes are made</span><br><span class="line">to these file descriptors.</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç›´æ¥ç”¨ä¸€ä¸ªç®€å•ä»£ç æ¥æ¼”ç¤º</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//ä¸éœ€è¦ä¿®æ”¹å·¥ä½œç›®å½•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è®¾ä¸º1</span></span><br><span class="line">    <span class="comment">//å› ä¸ºæ²¡æœ‰è¿›è¡Œæ‰“å°ï¼Œé‡å®šå‘è®¾ç½®æˆ1ï¼Œä¸è¿›è¡Œé‡å®šå‘</span></span><br><span class="line">    <span class="type">int</span> ret = daemon(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    sleep(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¹‹åå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªè¿›ç¨‹çš„çˆ¶idæ˜¯æ“ä½œç³»ç»Ÿï¼Œå…¶è‡ªæˆä¸€ä¸ªè¿›ç¨‹ç»„å’Œè¿›ç¨‹ä¼šè¯ï¼›å’Œæˆ‘ä»¬è‡ªå·±å†™çš„å‡½æ•°ä½œç”¨ç›¸åŒ</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e482494ff4d.png"                      alt="image-20230209131905946"                ></p><h1 id="3-é‡å®šå‘log"><a href="#3-é‡å®šå‘log" class="headerlink" title="3.é‡å®šå‘log"></a>3.é‡å®šå‘log</h1><p>å› ä¸ºå®ˆæŠ¤è¿›ç¨‹æŠŠè¾“å…¥è¾“å‡ºä¸¢åˆ°äº†åƒåœ¾æ…é‡Œé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦é‡å®šå‘æ—¥å¿—çš„è¾“å‡º</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> LOG_PATH <span class="string">&quot;./log.txt&quot;</span> <span class="comment">//å·¥ä½œè·¯å¾„ä¸‹çš„log.txt</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™ä¸ªç±»åªç”¨äºé‡å®šå‘ï¼Œä¸éœ€è¦åœ¨é‡Œé¢åŠ å…¶ä»–ä¸œè¥¿</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Logdup</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Logdup</span>()</span><br><span class="line">        :_fdout(<span class="number">-1</span>),_fderr(<span class="number">-1</span>)</span><br><span class="line">    &#123;&#125;</span><br><span class="line">    <span class="built_in">Logdup</span>(<span class="type">const</span> <span class="type">char</span>* pout=LOG_PATH,<span class="type">const</span> <span class="type">char</span>* perr=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        :_fdout(<span class="number">-1</span>),_fderr(<span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœåªä¼ å…¥äº†ç¬¬ä¸€ä¸ªpoutï¼Œåˆ™ä»£è¡¨å°†perrå’Œpouté‡å®šå‘ä¸ºä¸€ä¸ªè·¯å¾„</span></span><br><span class="line">        <span class="built_in">umask</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="type">int</span> logfd = <span class="built_in">open</span>(pout, O_WRONLY | O_CREAT | O_APPEND, <span class="number">0666</span>);</span><br><span class="line">        <span class="built_in">assert</span>(logfd != <span class="number">-1</span>);</span><br><span class="line">        _fdout = _fderr = logfd;<span class="comment">//èµ‹å€¼å¯ä»¥è¿ç­‰</span></span><br><span class="line">        <span class="comment">//åˆ¤æ–­æ˜¯ä¸æ˜¯ç©ºä¸²</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">strcmp</span>(perr,<span class="string">&quot;&quot;</span>)!=<span class="number">0</span>)<span class="comment">//ä¸ç›¸åŒï¼Œä»£è¡¨å•ç‹¬è®¾ç½®äº†errçš„è·¯å¾„</span></span><br><span class="line">        &#123;</span><br><span class="line">            logfd = <span class="built_in">open</span>(perr, O_WRONLY | O_CREAT | O_APPEND, <span class="number">0666</span>);</span><br><span class="line">            <span class="built_in">assert</span>(logfd != <span class="number">-1</span>);</span><br><span class="line">            _fderr = logfd;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">dup2</span>(_fdout, <span class="number">1</span>);<span class="comment">//é‡å®šå‘stdout</span></span><br><span class="line">        <span class="built_in">dup2</span>(_fderr, <span class="number">2</span>);<span class="comment">//é‡å®šå‘stderr</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">Logdup</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(_fdout!= <span class="number">-1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">fsync</span>(_fdout);</span><br><span class="line">            <span class="built_in">fsync</span>(_fderr);</span><br><span class="line">            <span class="comment">// å…ˆå†™ç›˜å†å…³é—­</span></span><br><span class="line">            <span class="built_in">close</span>(_fdout);</span><br><span class="line">            <span class="built_in">close</span>(_fderr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _fdout;<span class="comment">//é‡å®šå‘çš„æ—¥å¿—æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">    <span class="type">int</span> _fderr;<span class="comment">//é‡å®šå‘çš„é”™è¯¯æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">&#125;;c</span><br></pre></td></tr></table></figure><p>åšå®Œè¿™ä¸€åˆ‡ä¹‹åï¼Œæˆ‘ä»¬è¿è¡ŒæœåŠ¡å™¨ï¼Œçš„ç¡®åˆ›å»ºäº†log.txtæ–‡ä»¶ï¼Œå¯é‡Œé¢ç©ºç©ºå¦‚ä¹Ÿ</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e493ab4ff59.png"                      alt="image-20230209143230108"                ></p><p>è¿™æ˜¯å› ä¸ºæˆ‘ä»¬çš„æ•°æ®å…¶å®éƒ½è¢«å†™é“äº†ç¼“å†²åŒºé‡Œé¢ï¼Œæˆ‘ä»¬éœ€è¦åœ¨loggingé‡Œé¢æ·»åŠ ä¸€ä¸ªåˆ·æ–°æœºåˆ¶ï¼Œæ‰èƒ½è®©æ•°æ®å°½å¿«å†™å…¥åˆ°ç¡¬ç›˜ä¸­ï¼Œé¿å…æ—¥å¿—ä¸¢å¤±</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fflush(out); <span class="comment">// å°†Cç¼“å†²åŒºä¸­çš„æ•°æ®åˆ·æ–°åˆ°OS</span></span><br><span class="line">fsync(fileno(out));<span class="comment">// å°†OSä¸­çš„æ•°æ®å†™å…¥ç¡¬ç›˜</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å†è¿è¡ŒæœåŠ¡å™¨ï¼Œå°±èƒ½çœ‹åˆ°æ—¥å¿—å¾ˆå¿«è¢«å†™å…¥æ–‡ä»¶é‡Œé¢äº†ã€‚</p><p><img                       lazyload                     alt="image"                     data-src="https://img1.musnow.top/i/2023/02/63e4957c97194.png"                      alt="image-20230209144101425"                ></p><h1 id="over"><a href="#over" class="headerlink" title="over"></a>over</h1><p>æå®šå•¦ï¼</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ¬æ–‡å°†ä»¥tcpæœåŠ¡å™¨ä»£ç ä¸ºåŸºæœ¬ï¼Œè®²è¿°å¦‚ä½•å°†è¿›ç¨‹å®ˆæŠ¤è¿›ç¨‹åŒ–ï¼Œåå°è¿è¡Œ&lt;/p&gt;</summary>
    
    
    
    <category term="ç©ä¸ŠLinux" scheme="https://blog.musnow.top/categories/%E7%8E%A9%E4%B8%8ALinux/"/>
    
    
    <category term="Linux" scheme="https://blog.musnow.top/tags/Linux/"/>
    
    <category term="ç½‘ç»œ" scheme="https://blog.musnow.top/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
</feed>
