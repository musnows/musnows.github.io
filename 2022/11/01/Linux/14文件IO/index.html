<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="Hexo Theme Keep"><meta name="description" content="çˆ±æŠ˜è…¾çš„ä»£ç åˆå­¦è€…"><meta name="author" content="æ…•é›ªå¹´å"><meta name="baidu-site-verification" content="codeva-aZGKJiqRSI"><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"JwxEfuZ8fwQ1GPEq",ck:"JwxEfuZ8fwQ1GPEq"})</script><title>ã€Linuxã€‘æ–‡ä»¶IO | æ…•é›ªçš„å¯’èˆ</title><link rel="stylesheet" href="/css/style.css"><link rel="shortcut icon" href="/images/myPNG.jpg"><link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/fontawesome.min.css"><link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/regular.min.css"><link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/solid.min.css"><link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/brands.min.css"><script id="hexo-configurations">let KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"blog.musnow.top","root":"/","language":"zh-CN","path":"search.json"}
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true},"style":{"primary_color":"#0066cc","logo":"/images/myPNG.jpg","favicon":"/images/myPNG.jpg","avatar":"/images/myPNG.jpg","font_size":null,"font_family":null,"hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"header_transparent":false,"background_img":"/images/MainBG.jpg","background_post_img":"/images/mothra.png","description":"å¾å¿ƒå¦‚ä¸€ï¼Œæ…•é›ªçº·çº·","font_color":null,"hitokoto":true},"scroll":{"progress_bar":true,"percent":true},"left_side_width":"260px","content_max_width":"920px"},"local_search":{"enable":true,"preload":true},"code_copy":{},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"default"},"side_tools":{},"pjax":{"enable":true},"lazyload":{"enable":true},"comment":{"enable":true,"use":"waline","valine":{"appid":"meufCipLPHNWVE3gWEnozHzz-gzGzoHsz","appkey":"CFX9WelJjGHkaMnSunOlv3dX","server_urls":null,"placeholder":"æ¬¢è¿ç•™ä¸‹ä½ çš„å£°éŸ³ğŸ˜‹"},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.8"},"waline":{"server_url":"https://waline.musnow.top/","reaction":false,"version":2}},"post":{"author_label":{"enable":false,"auto":true,"custom_label_list":["Trainee","Engineer","Architect"]},"word_count":{"enable":true,"wordcount":true,"min2read":false},"img_align":"center","copyright_info":true},"version":"3.6.1"}
    KEEP.language_ago = {"second":"%s ç§’å‰","minute":"%s åˆ†é’Ÿå‰","hour":"%s å°æ—¶å‰","day":"%s å¤©å‰","week":"%s å‘¨å‰","month":"%s ä¸ªæœˆå‰","year":"%s å¹´å‰"}
    KEEP.language_code_block = {"copy":"å¤åˆ¶ä»£ç ","copied":"å·²å¤åˆ¶","fold":"æŠ˜å ä»£ç å—","folded":"å·²æŠ˜å "}
    KEEP.language_copy_copyright = {"copy":"å¤åˆ¶ç‰ˆæƒä¿¡æ¯","copied":"å·²å¤åˆ¶","title":"åŸæ–‡æ ‡é¢˜","author":"åŸæ–‡ä½œè€…","link":"åŸæ–‡é“¾æ¥"}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="æ…•é›ªçš„å¯’èˆ" type="application/atom+xml"></head><body><div class="progress-bar-container"><span class="scroll-progress-bar"></span> <span class="pjax-progress-bar"></span> <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i></div><main class="page-container"><div class="page-main-content"><div class="page-main-content-top"><header class="header-wrapper"><div class="header-content"><div class="left"><a class="logo-image" href="/about/"><img src="/images/myPNG.jpg"> </a><a class="logo-title" href="/">æ…•é›ªçš„å¯’èˆ</a></div><div class="right"><div class="pc"><ul class="menu-list"><li class="menu-item"><a href="/">é¦–é¡µ</a></li><li class="menu-item"><a href="/archives">å½’æ¡£</a></li><li class="menu-item"><a href="/categories">åˆ†ç±»</a></li><li class="menu-item"><a href="/tags">æ ‡ç­¾</a></li><li class="menu-item"><a href="/qa">ç•™è¨€</a></li><li class="menu-item"><a href="/links">å‹é“¾</a></li><li class="menu-item search search-popup-trigger"><i class="fas fa-search"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div><div class="icon-item menu-bar"><div class="menu-bar-middle"></div></div></div></div></div><div class="header-drawer"><ul class="drawer-menu-list"><li class="drawer-menu-item flex-center"><a href="/">é¦–é¡µ</a></li><li class="drawer-menu-item flex-center"><a href="/archives">å½’æ¡£</a></li><li class="drawer-menu-item flex-center"><a href="/categories">åˆ†ç±»</a></li><li class="drawer-menu-item flex-center"><a href="/tags">æ ‡ç­¾</a></li><li class="drawer-menu-item flex-center"><a href="/qa">ç•™è¨€</a></li><li class="drawer-menu-item flex-center"><a href="/links">å‹é“¾</a></li></ul></div><div class="window-mask"></div></header></div><div class="page-main-content-middle"><div class="main-content"><div class="fade-in-down-animation"><div class="post-page-container"><div class="article-content-container"><div class="article-title"><span class="title-hover-animation">ã€Linuxã€‘æ–‡ä»¶IO</span></div><div class="article-header"><div class="avatar"><img src="/images/myPNG.jpg"></div><div class="info"><div class="author"><span class="name">æ…•é›ªå¹´å</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-calendar-plus"></i>&nbsp; <span class="pc">2022-11-01 20:40:16</span> <span class="mobile">2022-11-01 20:40</span> </span><span class="article-update-date article-meta-item"><i class="fas fa-file-pen"></i>&nbsp; <span class="pc">2023-02-06 13:33:14</span> </span><span class="article-categories article-meta-item"><i class="fas fa-folder"></i>&nbsp;<ul><li><a href="/categories/%E7%8E%A9%E4%B8%8ALinux/">ç©ä¸ŠLinux</a>&nbsp;</li></ul></span><span class="article-tags article-meta-item"><i class="fas fa-tags"></i>&nbsp;<ul><li><a href="/tags/Linux/">Linux</a>&nbsp;</li><li>| <a href="/tags/%E6%96%87%E4%BB%B6/">æ–‡ä»¶</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fas fa-file-word"></i>&nbsp;<span>13.1k å­—</span> </span><span class="article-pv article-meta-item"><i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content keep-markdown-body"><p>è®©æˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹linuxä¸‹çš„æ–‡ä»¶æ¥å£å§ï¼</p><span id="more"></span><blockquote><p>æ¼”ç¤ºæ‰€ç”¨ç³»ç»Ÿï¼šCentOS7.6</p><p>æœ¬æ–‡æ‰€æœ‰ä»£ç éƒ½å¯ä»¥åœ¨æˆ‘çš„giteeä»“åº“æŸ¥çœ‹ã€<a class="link" target="_blank" rel="noopener" href="https://gitee.com/musnow/raspberry-practice/tree/master/code/22-10-18_files">é“¾æ¥<i class="fas fa-external-link-alt"></i></a>ã€‘</p></blockquote><p>[TOC]</p><h1 id="1-ä»€ä¹ˆæ˜¯æ–‡ä»¶ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯æ–‡ä»¶ï¼Ÿ" class="headerlink" title="1.ä»€ä¹ˆæ˜¯æ–‡ä»¶ï¼Ÿ"></a>1.ä»€ä¹ˆæ˜¯æ–‡ä»¶ï¼Ÿ</h1><ul><li><code>æ–‡ä»¶=æ–‡ä»¶å†…å®¹+æ–‡ä»¶å±æ€§</code>ï¼Œæ–‡ä»¶å±æ€§ä¹Ÿæ˜¯æ•°æ®ï¼Œå³ä¾¿æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œä¹Ÿæ˜¯ä¼šå ç”¨ç£ç›˜ç©ºé—´çš„</li><li><code>æ–‡ä»¶æ“ä½œ=æ–‡ä»¶å†…å®¹çš„æ“ä½œ+æ–‡ä»¶å±æ€§çš„æ“ä½œ</code>ï¼Œåœ¨ä¹‹å‰<code>linuxæƒé™</code>çš„åšå®¢é‡Œé¢å°±æåˆ°è¿‡ï¼Œæ–‡ä»¶æ“ä½œæœ‰å¯èƒ½å³æ”¹å˜å†…å®¹ï¼Œåˆæ”¹å˜å±æ€§</li><li><code>æ–‡ä»¶æ‰“å¼€æ“ä½œ</code>å…¶å®æ˜¯æŠŠæ–‡ä»¶çš„å±æ€§å’Œå†…å®¹åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæ²¡æœ‰è¢«æ‰“å¼€çš„æ–‡ä»¶ä¾æ—§å¤„äºç£ç›˜å½“ä¸­</li><li><code>å½“å‰è·¯å¾„</code>ä¸ºå½“å‰è¿›ç¨‹æ‰€å¤„çš„å·¥ä½œè·¯å¾„</li></ul><p>æˆ‘ä»¬çš„æ‰“å¼€æ–‡ä»¶æ“ä½œéœ€è¦å’Œç£ç›˜è¿™ä¸ªç¡¬ä»¶æ‰“äº¤é“ï¼Œåªæœ‰æ“ä½œç³»ç»Ÿæ‰èƒ½ç›´æ¥æ“ä½œç¡¬ä»¶ã€‚æ‰€ä»¥æˆ‘ä»¬çš„æ–‡ä»¶æ“ä½œå…¶å®éƒ½æ˜¯<strong>è°ƒç”¨çš„ç³»ç»Ÿæ¥å£</strong>ã€‚</p><p>å®é™…ä¸Šï¼Œæ‰€æœ‰ç¼–ç¨‹è¯­è¨€éƒ½å¯¹æ“ä½œç³»ç»Ÿæ¥å£è¿›è¡Œäº†å°è£…ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯ä»–ä»¬çš„<strong>è·¨å¹³å°æ€§</strong>ã€‚å› ä¸ºä¸åŒæ“ä½œç³»ç»Ÿçš„å„ç§æ¥å£å„ä¸ç›¸åŒï¼Œå¦‚æœä¸è¿›è¡Œå°è£…ï¼Œç›´æ¥è°ƒç”¨ç³»ç»Ÿæ¥å£ï¼Œåˆ™è¯¥ä»£ç åªèƒ½åœ¨æŒ‡å®šç³»ç»Ÿä¸Šè·‘ï¼</p><h2 id="1-2-Cè¯­è¨€æ–‡ä»¶æ“ä½œ"><a href="#1-2-Cè¯­è¨€æ–‡ä»¶æ“ä½œ" class="headerlink" title="1.2 Cè¯­è¨€æ–‡ä»¶æ“ä½œ"></a>1.2 Cè¯­è¨€æ–‡ä»¶æ“ä½œ</h2><p>åœ¨å­¦ä¹ Linuxä¸‹æ–‡ä»¶ç›¸å…³å†…å®¹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥å¤ä¹ ä¸€ä¸‹Cè¯­è¨€çš„æ–‡ä»¶æ¥å£</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">writetest</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">char</span>*file=<span class="string">&quot;test.txt&quot;</span>;</span><br><span class="line">    FILE* f=<span class="built_in">fopen</span>(file,<span class="string">&quot;w&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i =<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(f,<span class="string">&quot;hello linux! %d\n&quot;</span>,i);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">fclose</span>(f);</span><br><span class="line">    f=<span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">readtest</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">char</span>*file=<span class="string">&quot;test.txt&quot;</span>;</span><br><span class="line">    FILE* f=<span class="built_in">fopen</span>(file,<span class="string">&quot;r&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> buff[<span class="number">128</span>];<span class="comment">//å°†è¯»å–åˆ°çš„æ•°æ®å†™å…¥buffæ•°ç»„é‡Œé¢</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i =<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fgets</span>(buff,<span class="number">20</span>,f);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>,buff);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">fclose</span>(f);</span><br><span class="line">    f=<span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”¨å¾ªç¯å…ˆå¾€<code>test.txt</code>å†…è¾“å…¥10è¡Œæ•°æ®ï¼Œå†è¯»å–å¹¶æ‰“å°åˆ°å±å¹•ä¸Š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ ./test1</span><br><span class="line">hello linux! 0</span><br><span class="line">hello linux! 1</span><br><span class="line">hello linux! 2</span><br><span class="line">hello linux! 3</span><br><span class="line">hello linux! 4</span><br><span class="line">hello linux! 5</span><br><span class="line">hello linux! 6</span><br><span class="line">hello linux! 7</span><br><span class="line">hello linux! 8</span><br><span class="line">hello linux! 9</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ </span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202210240914321.png" alt="image-20221024091420220"></p><p>é™¤äº†wå’Œræ–¹æ³•å¤–ï¼ŒCè¯­è¨€è¿˜æä¾›äº†<code>w+ r+ a</code>ä»¥åŠå¸¦<code>b</code>çš„äºŒè¿›åˆ¶è¯»å†™</p><blockquote><p>è¿™éƒ¨åˆ†å†…å®¹å¯ä»¥å»çœ‹çœ‹æˆ‘ä¹‹å‰çš„<a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/muxuen/article/details/123203942">Cè¯­è¨€æ–‡ä»¶æ“ä½œ<i class="fas fa-external-link-alt"></i></a>åšå®¢ï¼</p></blockquote><p>Cè¯­è¨€é»˜è®¤æ‰“å¼€äº†ä¸‰ä¸ªè¾“å…¥è¾“å‡ºæµï¼Œéƒ½æ˜¯ä¸€ä¸ª<code>FILE*</code>çš„æŒ‡é’ˆï¼Œåˆ†åˆ«ä¸º<code>stdin/stdout/stderr</code>ï¼Œè®°ä½è¿™ä¸ªç‚¹ï¼Œåé¢ä¼šç”¨åˆ°å“¦</p><hr><h1 id="2-åˆè¯†Linuxç³»ç»Ÿçš„æ–‡ä»¶æ¥å£"><a href="#2-åˆè¯†Linuxç³»ç»Ÿçš„æ–‡ä»¶æ¥å£" class="headerlink" title="2.åˆè¯†Linuxç³»ç»Ÿçš„æ–‡ä»¶æ¥å£"></a>2.åˆè¯†Linuxç³»ç»Ÿçš„æ–‡ä»¶æ¥å£</h1><p>Linuxä¸‹çš„æ–‡ä»¶æ“ä½œç”¨çš„æ¥å£ä¸º<code>open/write/read</code>ï¼Œéƒ½éœ€è¦å…ˆç”¨openæ‰“å¼€æ–‡ä»¶å¹¶æŒ‡å®šæ‰“å¼€æ–¹å¼åï¼Œå†ç”¨<code>write/read</code>æ“ä½œè¿›è¡Œè¯»å†™</p><blockquote><p>æ³¨ï¼šmanæŸ¥è¯¢çš„æ—¶å€™éœ€è¦æŒ‡å®š<code>man 2 open</code>ï¼Œå¦åˆ™æŸ¥è¯¢åˆ°çš„æ˜¯å‘½ä»¤ä¸æ˜¯å‡½æ•°æ¥å£</p></blockquote><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202210240942664.png" alt="image-20221024094258584"></p><p>è¿™é‡Œopenä¸€å…±æœ‰ä¸¤ä¸ªå‡½æ•°æ¥å£ï¼Œæ²¡é”™ï¼Œå°±æ˜¯<strong>å‡½æ•°é‡è½½</strong>ï¼è¿™æ˜¯å› ä¸ºlinuxä¸‹çš„Cè¯­è¨€æ ‡å‡†å’Œæˆ‘ä»¬ä¹‹å‰åœ¨winä¸‹å­¦ä¹ æ‰€ç”¨çš„æ ‡å‡†æ˜¯ä¸ä¸€æ ·çš„ï¼</p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°ä¸º<code>pathname</code>ï¼Œæ–‡ä»¶è·¯å¾„</li><li>ç¬¬äºŒä¸ªå‚æ•°ä¸º<code>flags</code>ï¼Œæ‰“å¼€æ–‡ä»¶çš„æ–¹å¼</li></ul><p>æ‰“å¼€æ–‡ä»¶çš„æ–¹å¼å¹¶ä¸åƒCè¯­è¨€ç”¨<code>w/r</code>ç­‰ç­‰ä»£æ›¿ï¼Œè€Œæ˜¯éœ€è¦æˆ‘ä»¬ä¼ å…¥å¤šä¸ª<code>flag</code>è¿›è¡Œ<strong>æŒ‰ä½ä¸</strong>ï¼Œè¿™ä¸€ç‚¹å’Œ<code>C++</code>ä¸­çš„æ–‡ä»¶ç±»ä¸€æ ·ï¼</p><blockquote><p>è¿™é‡Œçš„flagå…¶å®æ˜¯ä¸€ç§ä½å›¾ç»“æ„ã€‚æ¯ä¸€ä¸ª<code>flag</code>åªéœ€è¦åœ¨ä¸€ä¸ªæ¯”ç‰¹ä½ä¸Šä¸º1ï¼ˆåè¿›åˆ¶2çš„å€æ•°ï¼‰å…¶ä½™ä½ä¸º0ï¼Œä¿è¯äº’ä¸å½±å“ã€‚è¿™æ ·åœ¨æŒ‰ä½ä¸çš„æ—¶å€™ï¼Œæ‰èƒ½æ­£ç¡®å‡‘åˆ°ä¸€èµ·ï¼Œå¹¶é€šè¿‡æŒ‰ä½æˆ–è¿›è¡Œflagçš„å–å‡º</p></blockquote><p>flagçš„å‚æ•°ä¸­ï¼Œä¸‹é¢è¿™ä¸‰ä¸ªå€¼ï¼Œå¿…é¡»æŒ‡å®šä¸€ä¸ªä¸”åªèƒ½æŒ‡å®šä¸€ä¸ª</p><ul><li>O_RDONLY: åªè¯»æ‰“å¼€</li><li>O_WRONLY: åªå†™æ‰“å¼€</li><li>O_RDWR: è¯»ï¼Œå†™æ‰“å¼€</li></ul><p>å‰©ä½™çš„å‚æ•°æ˜¯ç”¨ä½œé¢å¤–æ“ä½œçš„</p><ul><li>O_CREAT: è‹¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºï¼›éœ€è¦ä¼ å…¥<code>mode</code>å‚æ•°ï¼Œæ¥æŒ‡æ˜æ–°æ–‡ä»¶çš„è®¿é—®æƒé™</li><li>O_APPEND: è¿½åŠ å†™</li><li>O_TRUNC: æ¸…ç©ºæ–‡ä»¶</li><li>â€¦â€¦</li></ul><p>å¸¸ç”¨çš„å‚æ•°å°±ä¸Šé¢è¿™äº›ï¼Œæ›´å¤šå‚æ•°å¯ä»¥ä½¿ç”¨<code>man 2 open</code>æŸ¥çœ‹å®Œæ•´<code>flag</code>åˆ—è¡¨</p><blockquote><p>è¿™ç§<strong>å¤§å†™+ä¸‹åˆ’çº¿</strong>çš„å‘½åæ–¹å¼å‘Šè¯‰æˆ‘ä»¬ï¼Œå®ƒå…¶å®å°±æ˜¯ç³»ç»Ÿä¸­é¢„å…ˆå®šä¹‰å¥½çš„<strong>å®</strong>ï¼</p></blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œopenå‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ª<code>int</code>ç±»å‹ï¼Œå®ƒè¢«ç§°ä¸º<code>æ–‡ä»¶æè¿°ç¬¦</code>ï¼Œåé¢ä¼šæœ‰è¯¦è§£</p><hr><h2 id="2-1-è¯»æ–‡ä»¶"><a href="#2-1-è¯»æ–‡ä»¶" class="headerlink" title="2.1 è¯»æ–‡ä»¶"></a>2.1 è¯»æ–‡ä»¶</h2><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202210241002861.png" alt="image-20221024100233819"></p><p>è¯»æ–‡ä»¶çš„æ“ä½œå’Œ<code>fgets</code>ç±»ä¼¼ï¼Œéœ€è¦æŒ‡å®šæ–‡ä»¶æè¿°ç¬¦ï¼Œä»¥åŠç”¨äºä¿å­˜æ–‡ä»¶å†…å®¹çš„<code>buf</code>ï¼Œå’Œæ•°æ®é•¿åº¦<code>count</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> SIZE 256</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">test1</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> buf[SIZE];</span><br><span class="line">    <span class="type">int</span> fd1 = open(<span class="string">&quot;test.txt&quot;</span>, O_RDONLY);</span><br><span class="line">    read(fd1,buf,<span class="built_in">strlen</span>(buf)<span class="number">-1</span>);</span><br><span class="line">    <span class="type">ssize_t</span> s = read(fd1, buf, <span class="keyword">sizeof</span>(buf)<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">if</span>(s &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">       buf[s] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">       <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    close(fd1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ssize_t</code>æ˜¯æœ‰ç¬¦å·æ•´å‹ï¼Œå…¶å®å°±æ˜¯int</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">int</span> <span class="type">ssize_t</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬æ‰“å¼€äº†åˆšåˆšæµ‹è¯•Cè¯­è¨€ç”¨çš„<code>test.txt</code>æ–‡ä»¶ï¼ŒæˆåŠŸè¯»å‡ºäº†é‡Œé¢çš„å†…å®¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ ./test</span><br><span class="line">hello linux! 0</span><br><span class="line">hello linux! 1</span><br><span class="line">hello linux! 2</span><br><span class="line">hello linux! 3</span><br><span class="line">hello linux! 4</span><br><span class="line">hello linux! 5</span><br><span class="line">hello linux! 6</span><br><span class="line">hello linux! 7</span><br><span class="line">hello linux! 8</span><br><span class="line">hello linux! 9</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ </span><br></pre></td></tr></table></figure><h2 id="2-2-å†™æ–‡ä»¶"><a href="#2-2-å†™æ–‡ä»¶" class="headerlink" title="2.2 å†™æ–‡ä»¶"></a>2.2 å†™æ–‡ä»¶</h2><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202210241012338.png" alt="image-20221024101226288"></p><p>æ³¨æ„çš„æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬ä¸åœ¨<code>open</code>çš„æ—¶å€™æŒ‡å®šç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå…¶åˆ›å»ºçš„æ–°æ–‡ä»¶ï¼Œæƒé™æ˜¯ä¹±æ‰çš„ã€‚è€Œå•ç»™ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥<code>0666</code>è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬éœ€è¦å…ˆæŠŠç³»ç»Ÿçš„<code>umask</code>åœ¨å½“å‰è¿›ç¨‹ä¸­è®¾ç½®ä¸º0ï¼Œä»¥é¿å…ç³»ç»Ÿ<code>umask</code>çš„é»˜è®¤å€¼å¯¹æˆ‘ä»¬åˆ›å»ºæ–‡ä»¶çš„æƒé™é€ æˆå½±å“</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">umask</span>(<span class="number">0</span>);<span class="comment">//å…ˆæŠŠumaskè®¾ç½®ä¸º0ï¼Œä¿è¯æƒé™å€¼è®¾ç½®æ­£ç¡®ï¼Œä¸å—ç³»ç»Ÿumaskå½±å“</span></span><br><span class="line">    <span class="type">int</span> fd = <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, O_WRONLY | O_CREAT | O_TRUNC, <span class="number">0666</span>);</span><br><span class="line">	<span class="comment">//è¿™é‡Œæˆ‘ä»¬æŒ‡å®šäº†0_CREATï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®š0666ä½œä¸ºæƒé™å€¼</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *str = <span class="string">&quot;bbbbbb\n&quot;</span>;</span><br><span class="line">    <span class="built_in">write</span>(fd, str, <span class="built_in">strlen</span>(str));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">close</span>(fd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¸Šè¿°ä»£ç åï¼Œå¯ä»¥çœ‹åˆ°æ•°æ®è¢«æˆåŠŸå†™å…¥</p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202210241015476.png" alt="image-20221024101514428"></p><p>è¿™é‡Œæˆ‘ä»¬è¿˜æŒ‡å®šäº†<code>O_TRUNC</code>ï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œæ–‡ä»¶å†…éƒ¨çš„å†…å®¹éƒ½ä¼šè¢«æ¸…ç©ºã€‚ä¿®æ”¹<code>str</code>åé‡æ–°è¿›è¡Œæµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ°åŸæœ‰çš„å†…å®¹ä¸è§äº†</p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202210241017590.png" alt="image-20221024101732559"></p><p>å¦‚æœä¸æŒ‡å®šï¼Œå…¶ä¸ä¼šæ¸…ç©ºå·²æœ‰å†…å®¹ã€‚è€Œæ˜¯ä¼šä»å¼€å¤´è¿›è¡Œå†™å…¥ï¼Œè¦†ç›–å¼€å¤´å·²æœ‰çš„å†…å®¹ï¼ˆå·¦è¾¹ä¸ºå†™å…¥åï¼Œå³è¾¹ä¸ºå†™å…¥å‰ï¼‰</p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202210241028982.png" alt="image-20221024102817916"></p><p>å®é™…ä¸Šï¼ŒCè¯­è¨€çš„æ–‡ä»¶æ“ä½œï¼Œè°ƒç”¨çš„å°±æ˜¯<code>linux</code>çš„æ–‡ä»¶æ¥å£</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fopen(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;w&quot;</span>); <span class="comment">//åº•å±‚è°ƒç”¨openï¼ŒO_WRONLY | O_CREAT | O_TRUNC</span></span><br><span class="line">fopen(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;a&quot;</span>); <span class="comment">//åº•å±‚è°ƒç”¨openï¼ŒO_WRONLY | O_CREAT | O_APPEND</span></span><br></pre></td></tr></table></figure><h3 id="å†™æ–¹å¼è¦†ç›–ï¼Ÿ"><a href="#å†™æ–¹å¼è¦†ç›–ï¼Ÿ" class="headerlink" title="å†™æ–¹å¼è¦†ç›–ï¼Ÿ"></a>å†™æ–¹å¼è¦†ç›–ï¼Ÿ</h3><p>åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªç¥å¥‡çš„æƒ…å†µ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">test2</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    umask(<span class="number">0</span>);<span class="comment">//å…ˆæŠŠumaskè®¾ç½®ä¸º0ï¼Œä¿è¯æƒé™å€¼è®¾ç½®æ­£ç¡®ï¼Œä¸å—ç³»ç»Ÿumaskå½±å“</span></span><br><span class="line">    <span class="type">int</span> fd1 = open(<span class="string">&quot;test.txt&quot;</span>, O_WRONLY | O_CREAT, <span class="number">0666</span>);</span><br><span class="line">    <span class="type">int</span> fd2 = open(<span class="string">&quot;test.txt&quot;</span>, O_WRONLY | O_CREAT | O_TRUNC, <span class="number">0666</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;fd1: %d  fd2: %d\n&quot;</span>,fd1,fd2);</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *str = <span class="string">&quot;bbadsfasdfasdfa23123bbbb&quot;</span>;</span><br><span class="line">    write(fd1, str, <span class="built_in">strlen</span>(str));</span><br><span class="line"></span><br><span class="line">    close(fd1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘åˆ†åˆ«ç”¨<code>fd1/fd2</code>æ‰“å¼€äº†<code>test.txt</code>æ–‡ä»¶ï¼Œæ‰“å°å®ƒä»¬çš„æ–‡ä»¶æè¿°ç¬¦å¯ä»¥çœ‹åˆ°ï¼Œç»“æœä¸ä¸€æ ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ ./test</span><br><span class="line">fd1: 3  fd2: 4</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ </span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œæ‰§è¡Œçš„å†™å…¥ï¼Œå´æ˜¯<code>O_TRUNC</code>çš„è¦†ç›–æ–¹æ³•ï¼</p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202210241045432.png" alt="image-20221024104541372"></p><p>å®é™…ä¸Šï¼Œå¹¶ä¸æ˜¯<code>fd2</code>çš„å†™å…¥æ–¹æ³•è¦†ç›–äº†<code>fd1</code>çš„ï¼Œè€Œæ˜¯å½“æˆ‘ä»¬ä½¿ç”¨<code>O_TRUNC</code>æ–¹æ³•æ‰“å¼€æ–‡ä»¶çš„æ—¶å€™ï¼Œæ–‡ä»¶é‡Œé¢çš„å†…å®¹å°±å·²ç»è¢«æ¸…ç©ºäº†ï¼</p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202210241554067.png" alt="image-20221024155450999"></p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202210241558186.png" alt="image-20221024155807127"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œåˆšåˆšæ‰<code>begin fd2</code>çš„æ—¶å€™ï¼Œ<code>test.txt</code>çš„æ–‡ä»¶å¤§å°å°±å·²ç»å˜æˆ0äº†</p><p>ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå»ºè®®ä¸è¦åœ¨åŒä¸€ä¸ªè¿›ç¨‹é‡Œé¢å¤šæ¬¡æ‰“å¼€ä¸€ä¸ªä¹‹å‰å·²ç»æ‰“å¼€è¿‡çš„æ–‡ä»¶ï¼</p><h1 id="3-æ–‡ä»¶æè¿°ç¬¦"><a href="#3-æ–‡ä»¶æè¿°ç¬¦" class="headerlink" title="3.æ–‡ä»¶æè¿°ç¬¦"></a>3.æ–‡ä»¶æè¿°ç¬¦</h1><h2 id="3-1-ä¸ºä»€ä¹ˆæ˜¯ä»3å¼€å§‹ï¼Ÿ"><a href="#3-1-ä¸ºä»€ä¹ˆæ˜¯ä»3å¼€å§‹ï¼Ÿ" class="headerlink" title="3.1 ä¸ºä»€ä¹ˆæ˜¯ä»3å¼€å§‹ï¼Ÿ"></a>3.1 ä¸ºä»€ä¹ˆæ˜¯ä»3å¼€å§‹ï¼Ÿ</h2><p>è¿™é‡Œæˆ‘ä»¬ä¸€æ¬¡æ€§æ‰“å¼€å¤šä¸ªæ–‡ä»¶ï¼Œæ‰“å°ä»–ä»¬çš„æ–‡ä»¶æè¿°ç¬¦</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test3</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> fda = <span class="built_in">open</span>(<span class="string">&quot;loga.txt&quot;</span>, O_WRONLY | O_CREAT | O_TRUNC, <span class="number">0666</span>);</span><br><span class="line">    <span class="type">int</span> fdb = <span class="built_in">open</span>(<span class="string">&quot;logb.txt&quot;</span>, O_WRONLY | O_CREAT | O_TRUNC, <span class="number">0666</span>);</span><br><span class="line">    <span class="type">int</span> fdc = <span class="built_in">open</span>(<span class="string">&quot;logc.txt&quot;</span>, O_WRONLY | O_CREAT | O_TRUNC, <span class="number">0666</span>);</span><br><span class="line">    <span class="type">int</span> fdd = <span class="built_in">open</span>(<span class="string">&quot;logd.txt&quot;</span>, O_WRONLY | O_CREAT | O_TRUNC, <span class="number">0666</span>);</span><br><span class="line">    <span class="type">int</span> fde = <span class="built_in">open</span>(<span class="string">&quot;loge.txt&quot;</span>, O_WRONLY | O_CREAT | O_TRUNC, <span class="number">0666</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;fda: %d\n&quot;</span>, fda);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;fdb: %d\n&quot;</span>, fdb);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;fdc: %d\n&quot;</span>, fdc);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;fdd: %d\n&quot;</span>, fdd);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;fde: %d\n&quot;</span>, fde);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202210241124041.png" alt="image-20221024112417994"></p><p>ä¼šå‘ç°æ‰“å°çš„æ–‡ä»¶æ˜¯ä»3å¼€å§‹çš„ã€‚è¿™å’Œæˆ‘ä»¬ä¹‹å‰æ˜¯å¦æœ‰æ‰“å¼€è¿‡æ–‡ä»¶æ²¡å…³ç³»ï¼Œä»»ä½•è¿›ç¨‹opençš„è‡ªå·±çš„æ–‡ä»¶éƒ½æ˜¯ä»3å¼€å§‹çš„ï¼</p><p>è¿˜è®°å¾—å‰é¢Cè¯­è¨€éƒ¨åˆ†æåˆ°çš„<code>stdin/stdout/stderr</code>å—ï¼Ÿ</p><p>linuxç³»ç»Ÿä¸‹ä¸€åˆ‡çš†æ–‡ä»¶ï¼Œè¿™ä¸‰ä¸ªå®¶ä¼™ä¹Ÿä¸ä¾‹å¤–ï¼æ—¢ç„¶Cè¯­è¨€çš„æ–‡ä»¶æ“ä½œå°è£…äº†ç³»ç»Ÿçš„æ¥å£ï¼Œ<strong>é‚£ä¹ˆå…¶å†…éƒ¨è‚¯å®šæ˜¯æœ‰æ–‡ä»¶æè¿°ç¬¦çš„å­˜åœ¨çš„</strong>ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°å®ƒå°±è¡Œäº†ã€‚</p><p>è¿™ä¸€ç‚¹ï¼Œä»£ç è¡¥å…¨å°±å¯ä»¥å¸®å¿™äº†</p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202210241128792.png" alt="image-20221024112816731"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">test4</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//cè¯­è¨€ä¸­çš„FILEæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œé‡Œé¢ç®¡ç†äº†linuxç³»ç»Ÿçš„æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;stdin %d\n&quot;</span>,<span class="built_in">stdin</span>-&gt;_fileno);<span class="comment">//  0</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;stdout %d\n&quot;</span>,<span class="built_in">stdout</span>-&gt;_fileno);<span class="comment">// 1</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;stderr %d\n&quot;</span>,<span class="built_in">stderr</span>-&gt;_fileno);<span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">    FILE* f1 = fopen(<span class="string">&quot;test.txt&quot;</span>,<span class="string">&quot;w&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;f1 %d\n&quot;</span>,f1-&gt;_fileno);<span class="comment">//3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ ./test</span><br><span class="line">stdin 0</span><br><span class="line">stdout 1</span><br><span class="line">stderr 2</span><br><span class="line">f1 3</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ </span><br></pre></td></tr></table></figure><p>æ‰“å°ä¹‹åæˆ‘ä»¬å‘ç°ï¼Œå…¶<code>0 1 2</code>å°±æ˜¯è¢«Cè¯­è¨€çš„è¿™ä¸‰ä¸ªé»˜è®¤æ‰“å¼€çš„æ–‡ä»¶æµå ç”¨äº†ï¼Œè€Œæˆ‘ä»¬ç”¨Cè¯­è¨€<code>fopen</code>æ‰“å¼€çš„æ–‡ä»¶ï¼Œå…¶æ–‡ä»¶æè¿°ç¬¦ä¹Ÿæ˜¯ä»3å¼€å§‹çš„ï¼</p><hr><h3 id="ç”¨æ–‡ä»¶æè¿°ç¬¦è°ƒç”¨stdin-x2F-out"><a href="#ç”¨æ–‡ä»¶æè¿°ç¬¦è°ƒç”¨stdin-x2F-out" class="headerlink" title="ç”¨æ–‡ä»¶æè¿°ç¬¦è°ƒç”¨stdin&#x2F;out"></a>ç”¨æ–‡ä»¶æè¿°ç¬¦è°ƒç”¨stdin&#x2F;out</h3><p>æ—¢ç„¶<code>stdout</code>å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦æ˜¯1ï¼Œé‚£æˆ‘ä»¬å¯ä¸å¯ä»¥ç›´æ¥è°ƒç”¨ç³»ç»Ÿçš„æ¥å£å¾€å±å¹•ä¸Šè¾“å‡ºä¸œè¥¿å‘¢ï¼Ÿ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">test5</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> buf[SIZE]=<span class="string">&quot;12345678910\n&quot;</span>;</span><br><span class="line">    write(<span class="number">1</span>,buf,<span class="built_in">strlen</span>(buf));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶æ˜¯å¯ä»¥çš„ï¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ ./test</span><br><span class="line">12345678910</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ </span><br></pre></td></tr></table></figure><p>åŒç†ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è¿™æ ·æ¥æ¥æ”¶ç”¨æˆ·è¾“å…¥</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">test6</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> buf[SIZE];</span><br><span class="line">    <span class="type">ssize_t</span> s = read(<span class="number">0</span>,buf,<span class="keyword">sizeof</span>(buf));</span><br><span class="line">    <span class="keyword">if</span>(s&gt;<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        buf[s]=<span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;stdin: %s\n&quot;</span>,buf);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202210251404470.png" alt="image-20221025140417277"></p><p>è¿è¡Œçš„æ—¶å€™ï¼Œç¨‹åºä¼šæŒ‚èµ·ç­‰å¾…ç”¨æˆ·è¾“å…¥ï¼Œç”±æ­¤å¯ä»¥æ‰“å°è·å–è¾“å…¥çš„ç»“æœğŸ‘‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ make</span><br><span class="line">gcc test.c -o <span class="built_in">test</span> -std=c99</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ ./test</span><br><span class="line">asdfasdfadfadf</span><br><span class="line">stdin: asdfasdfadfadf</span><br><span class="line"></span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ </span><br></pre></td></tr></table></figure><hr><h2 id="3-2-ä»0å¼€å§‹ï¼Ÿæ•°ç»„ä¸‹æ ‡ï¼"><a href="#3-2-ä»0å¼€å§‹ï¼Ÿæ•°ç»„ä¸‹æ ‡ï¼" class="headerlink" title="3.2 ä»0å¼€å§‹ï¼Ÿæ•°ç»„ä¸‹æ ‡ï¼"></a>3.2 ä»0å¼€å§‹ï¼Ÿæ•°ç»„ä¸‹æ ‡ï¼</h2><blockquote><p>æ—¢ç„¶<code>stdin/stdout/stderr</code>åˆ†åˆ«å¯¹åº”çš„æ˜¯<code>0/1/2</code>ï¼Œè€Œæˆ‘ä»¬æ‰“å¼€çš„è‡ªå·±çš„æ–‡ä»¶å¯¹åº”çš„æ˜¯3å¼€å§‹ï¼Œæœ‰æ²¡æœ‰å¯èƒ½ï¼Œè¿™äº›æ•°å­—æ˜¯ä¸€ä¸ªæ•°ç»„çš„ä¸‹æ ‡å‘¢ï¼Ÿ</p></blockquote><p>ä¸€ä¸ªè¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ï¼Œå…¶æ•°æ®æ˜¯åœ¨å†…å­˜ä¸­çš„ã€‚æ“ä½œç³»ç»Ÿå†…æ ¸è‚¯å®šéœ€è¦ç®¡ç†ä¸€ä¸ªè¿›ç¨‹å·²ç»æ‰“å¼€çš„æ–‡ä»¶ï¼ä¸‡ä¸€æœ‰â€œå¤§èªæ˜â€å¿˜è®°<code>close</code>æ–‡ä»¶äº†ï¼Œè€Œæ“ä½œç³»ç»Ÿåˆæ²¡å»ç®¡ç†å·²æœ‰æ–‡ä»¶ï¼Œå…¶ä¸å°±ä¼šé€ æˆ<strong>å†…å­˜æ³„æ¼</strong>å—ï¼Ÿ</p><p>åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œæœ‰ä¸€ä¸ª<code>struct file</code>ï¼Œå…¶ç®¡ç†çš„å°±æ˜¯å·²ç»æ‰“å¼€äº†çš„æ–‡ä»¶</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">file</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="comment">//åŒ…å«äº†æ–‡ä»¶çš„å†…å®¹+å±æ€§</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ—¶ï¼Œè¿™ä¸ªæ–‡ä»¶å†…æ ¸è¿˜ä¼šè¢«æ’å…¥åˆ°è¿›ç¨‹çš„<code>task_struct</code>ä¸­ï¼Œå› ä¸ºä¸€ä¸ªè¿›ç¨‹æ˜¯å¯ä»¥åŒæ—¶æ‰“å¼€å¤šä¸ªæ–‡ä»¶çš„ã€‚æ“ä½œç³»ç»Ÿåœ¨å¯¹å·²æ‰“å¼€æ–‡ä»¶è¿›è¡Œç®¡ç†çš„åŒæ—¶ï¼Œè¿˜éœ€è¦å¯¹ä¸€ä¸ª<strong>è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶</strong>è¿›è¡Œç®¡ç†ï¼ˆçŸ¥é“æŸä¸ªæ–‡ä»¶æ˜¯è°æ‰“å¼€çš„ï¼‰</p><blockquote><p>ä¸‹è½½çš„linuxæºç ä¸­ï¼Œtask_strcutçš„ä½ç½®å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">linux-2.6.32.12/include/linux/sched.h</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202210251431673.png" alt="image-20221025143114568"></p></blockquote><p>è€Œæˆ‘ä»¬æ–‡ä»¶æè¿°ç¬¦ï¼Œå…¶å®å°±æ˜¯è¿›ç¨‹ä¸­ç®¡ç†æ–‡ä»¶çš„ä¸€ä¸ªæ•°ç»„çš„ä¸‹æ ‡ã€‚</p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202210251433844.png" alt="image-20221025143326760"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">files_struct</span> &#123;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * read mostly part</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">	<span class="type">atomic_t</span> count;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">fdtable</span> *fdt;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">fdtable</span> fdtab;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * written part on a separate cache line in SMP</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">	<span class="type">spinlock_t</span> file_lock ____cacheline_aligned_in_smp;</span><br><span class="line">	<span class="type">int</span> next_fd;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">embedded_fd_set</span> close_on_exec_init;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">embedded_fd_set</span> open_fds_init;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">file</span> * fd_array[NR_OPEN_DEFAULT];<span class="comment">//æ–‡ä»¶æ•°ç»„</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å¯¹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶çš„ç®¡ç†ï¼Œå°±è¢«è½¬åŒ–ä¸ºäº†å¯¹è¿™ä¸ªæ•°ç»„çš„<strong>å¢åˆ æŸ¥æ”¹</strong></p><h2 id="3-3-Linuxä¸‹ä¸€åˆ‡çš†æ–‡ä»¶"><a href="#3-3-Linuxä¸‹ä¸€åˆ‡çš†æ–‡ä»¶" class="headerlink" title="3.3 Linuxä¸‹ä¸€åˆ‡çš†æ–‡ä»¶"></a>3.3 Linuxä¸‹ä¸€åˆ‡çš†æ–‡ä»¶</h2><p>æœ€åˆå­¦ä¹ Linuxçš„æ—¶å€™ï¼Œå°±æåˆ°äº†Linuxä¸‹ä¸€åˆ‡çš†æ–‡ä»¶</p><p>ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†å†…æ ¸ä¸­æ˜¯ç”¨<code>file</code>ç»“æ„ä½“æ¥ç®¡ç†æ–‡ä»¶çš„ï¼Œé‚£ä¹ˆï¼Œå®ƒæ˜¯æ€ä¹ˆç”¨<strong>æ–‡ä»¶</strong>æ¥ç®¡ç†é”®ç›˜ã€é¼ æ ‡ã€æ˜¾ç¤ºå™¨ã€ç£ç›˜ã€ç½‘å¡çš„å‘¢ï¼Ÿ</p><p>è¿™æ—¶å€™å°±å¯ä»¥æ¥â€œæµ…æµ…â€çš„çœ‹ä¸€ä¸‹æºç äº†ï¼ä¸æ±‚çœ‹æ‡‚ä»£ç å®ç°ï¼Œåªæ±‚ç†è§£ç†å¿µ</p><blockquote><p><code>struct file</code>ä½äº<code>include/linux/fs.h</code>ä¸­</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">file</span> &#123;</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * fu_list becomes invalid after file_free is called and queued via</span></span><br><span class="line"><span class="comment">	 * fu_rcuhead for RCU freeing</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span>	<span class="title">fu_list</span>;</span></span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">rcu_head</span> 	<span class="title">fu_rcuhead</span>;</span></span><br><span class="line">	&#125; f_u;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">path</span>		<span class="title">f_path</span>;</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> f_dentry	f_path.dentry</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> f_vfsmnt	f_path.mnt</span></span><br><span class="line">	<span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">file_operations</span>	*<span class="title">f_op</span>;</span></span><br><span class="line">	<span class="type">spinlock_t</span>		f_lock;  <span class="comment">/* f_ep_links, f_flags, no IRQ */</span></span><br><span class="line">	<span class="type">atomic_long_t</span>		f_count;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> 		f_flags;</span><br><span class="line">	<span class="type">fmode_t</span>			f_mode;</span><br><span class="line">	<span class="type">loff_t</span>			f_pos;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">fown_struct</span>	<span class="title">f_owner</span>;</span></span><br><span class="line">	<span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">cred</span>	*<span class="title">f_cred</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">file_ra_state</span>	<span class="title">f_ra</span>;</span></span><br><span class="line"></span><br><span class="line">	u64			f_version;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_SECURITY</span></span><br><span class="line">	<span class="type">void</span>			*f_security;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">	<span class="comment">/* needed for tty driver, and maybe others */</span></span><br><span class="line">	<span class="type">void</span>			*private_data;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_EPOLL</span></span><br><span class="line">	<span class="comment">/* Used by fs/eventpoll.c to link all the hooks to this file */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span>	<span class="title">f_ep_links</span>;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">/* #ifdef CONFIG_EPOLL */</span></span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">address_space</span>	*<span class="title">f_mapping</span>;</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_DEBUG_WRITECOUNT</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> f_mnt_write_state;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å…¶ä½™å†…å®¹ç”¨æ¥å¹²å“ˆå­çš„å’±æš‚ä¸”ä¸ç®¡ï¼Œç›®å…‰èšç„¦äºè¿™ä¸€ä¸ªç»“æ„ä½“</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">file_operations</span>	*<span class="title">f_op</span>;</span></span><br></pre></td></tr></table></figure><p>ç¿»è¯‘è¿‡æ¥ï¼Œè¿™ä¸ªæˆå‘˜çš„åå­—ä¸ºæ–‡ä»¶æ“ä½œã€‚å†æ¥å¤ä¹ ä¸€ä¸‹<code>constä¿®é¥°æŒ‡é’ˆ</code>çš„çŸ¥è¯†ç‚¹</p><blockquote><p>constä¿®é¥°æŒ‡é’ˆæœ‰ä¸‹é¢ä¸¤ç§å½¢å¼</p><ul><li>åœ¨<code>*</code>ä¹‹å‰ä¿®é¥°ï¼Œä»£è¡¨è¯¥æŒ‡é’ˆæŒ‡å‘å¯¹è±¡çš„å†…å®¹ä¸èƒ½è¢«ä¿®æ”¹ï¼ˆåœ°å€é‡Œçš„å†…å®¹ä¸èƒ½æ”¹ï¼‰</li><li>åœ¨<code>*</code>ä¹‹åä¿®é¥°ï¼Œä»£è¡¨è¯¥æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ä¸èƒ½è¢«ä¿®æ”¹ï¼ˆæŒ‡å‘çš„åœ°å€ä¸èƒ½æ”¹ï¼‰</li></ul></blockquote><p>åœ¨è¿™ä¸ªç»“æ„ä½“ä¸­ï¼Œå°±æœ‰<code>read/write</code>æ–¹æ³•ï¼Œå®ƒä»¬æ˜¯ä¸¤ä¸ªå‡½æ•°æŒ‡é’ˆ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">file_operations</span> &#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">module</span> *<span class="title">owner</span>;</span></span><br><span class="line">	<span class="type">loff_t</span> (*llseek) (<span class="keyword">struct</span> file *, <span class="type">loff_t</span>, <span class="type">int</span>);</span><br><span class="line">	<span class="type">ssize_t</span> (*read) (<span class="keyword">struct</span> file *, <span class="type">char</span> __user *, <span class="type">size_t</span>, <span class="type">loff_t</span> *);</span><br><span class="line">	<span class="type">ssize_t</span> (*write) (<span class="keyword">struct</span> file *, <span class="type">const</span> <span class="type">char</span> __user *, <span class="type">size_t</span>, <span class="type">loff_t</span> *);</span><br><span class="line">	<span class="type">ssize_t</span> (*aio_read) (<span class="keyword">struct</span> kiocb *, <span class="type">const</span> <span class="keyword">struct</span> iovec *, <span class="type">unsigned</span> <span class="type">long</span>, <span class="type">loff_t</span>);</span><br><span class="line">	<span class="type">ssize_t</span> (*aio_write) (<span class="keyword">struct</span> kiocb *, <span class="type">const</span> <span class="keyword">struct</span> iovec *, <span class="type">unsigned</span> <span class="type">long</span>, <span class="type">loff_t</span>);</span><br><span class="line">	<span class="type">int</span> (*readdir) (<span class="keyword">struct</span> file *, <span class="type">void</span> *, <span class="type">filldir_t</span>);</span><br><span class="line">	<span class="type">unsigned</span> <span class="title function_">int</span> <span class="params">(*poll)</span> <span class="params">(<span class="keyword">struct</span> file *, <span class="keyword">struct</span> poll_table_struct *)</span>;</span><br><span class="line">	<span class="type">int</span> (*ioctl) (<span class="keyword">struct</span> inode *, <span class="keyword">struct</span> file *, <span class="type">unsigned</span> <span class="type">int</span>, <span class="type">unsigned</span> <span class="type">long</span>);</span><br><span class="line">	<span class="type">long</span> (*unlocked_ioctl) (<span class="keyword">struct</span> file *, <span class="type">unsigned</span> <span class="type">int</span>, <span class="type">unsigned</span> <span class="type">long</span>);</span><br><span class="line">	<span class="type">long</span> (*compat_ioctl) (<span class="keyword">struct</span> file *, <span class="type">unsigned</span> <span class="type">int</span>, <span class="type">unsigned</span> <span class="type">long</span>);</span><br><span class="line">	<span class="type">int</span> (*mmap) (<span class="keyword">struct</span> file *, <span class="keyword">struct</span> vm_area_struct *);</span><br><span class="line">	<span class="type">int</span> (*open) (<span class="keyword">struct</span> inode *, <span class="keyword">struct</span> file *);</span><br><span class="line">	<span class="type">int</span> (*flush) (<span class="keyword">struct</span> file *, <span class="type">fl_owner_t</span> id);</span><br><span class="line">	<span class="type">int</span> (*release) (<span class="keyword">struct</span> inode *, <span class="keyword">struct</span> file *);</span><br><span class="line">	<span class="type">int</span> (*fsync) (<span class="keyword">struct</span> file *, <span class="keyword">struct</span> dentry *, <span class="type">int</span> datasync);</span><br><span class="line">	<span class="type">int</span> (*aio_fsync) (<span class="keyword">struct</span> kiocb *, <span class="type">int</span> datasync);</span><br><span class="line">	<span class="type">int</span> (*fasync) (<span class="type">int</span>, <span class="keyword">struct</span> file *, <span class="type">int</span>);</span><br><span class="line">	<span class="type">int</span> (*lock) (<span class="keyword">struct</span> file *, <span class="type">int</span>, <span class="keyword">struct</span> file_lock *);</span><br><span class="line">	<span class="type">ssize_t</span> (*sendpage) (<span class="keyword">struct</span> file *, <span class="keyword">struct</span> page *, <span class="type">int</span>, <span class="type">size_t</span>, <span class="type">loff_t</span> *, <span class="type">int</span>);</span><br><span class="line">	<span class="type">unsigned</span> <span class="title function_">long</span> <span class="params">(*get_unmapped_area)</span><span class="params">(<span class="keyword">struct</span> file *, <span class="type">unsigned</span> <span class="type">long</span>, <span class="type">unsigned</span> <span class="type">long</span>, <span class="type">unsigned</span> <span class="type">long</span>, <span class="type">unsigned</span> <span class="type">long</span>)</span>;</span><br><span class="line">	<span class="type">int</span> (*check_flags)(<span class="type">int</span>);</span><br><span class="line">	<span class="type">int</span> (*flock) (<span class="keyword">struct</span> file *, <span class="type">int</span>, <span class="keyword">struct</span> file_lock *);</span><br><span class="line">	<span class="type">ssize_t</span> (*splice_write)(<span class="keyword">struct</span> pipe_inode_info *, <span class="keyword">struct</span> file *, <span class="type">loff_t</span> *, <span class="type">size_t</span>, <span class="type">unsigned</span> <span class="type">int</span>);</span><br><span class="line">	<span class="type">ssize_t</span> (*splice_read)(<span class="keyword">struct</span> file *, <span class="type">loff_t</span> *, <span class="keyword">struct</span> pipe_inode_info *, <span class="type">size_t</span>, <span class="type">unsigned</span> <span class="type">int</span>);</span><br><span class="line">	<span class="type">int</span> (*setlease)(<span class="keyword">struct</span> file *, <span class="type">long</span>, <span class="keyword">struct</span> file_lock **);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>linuxæ“ä½œç³»ç»Ÿå†…çš„æ–‡ä»¶ç³»ç»Ÿä»¥<strong>ç»Ÿä¸€çš„æ–¹å¼</strong>çœ‹å¾…æ‰€æœ‰çš„è®¾å¤‡ã€‚</p><p>ç‰¹å®šçš„è®¾å¤‡çš„<code>read/write</code>æ–¹æ³•æ˜¯ä¸ä¸€æ ·çš„ï¼Œåªéœ€è¦åœ¨è¿™äº›ç¡¬ä»¶çš„<strong>é©±åŠ¨ç¨‹åº</strong>ä¸­ç»™æ“ä½œç³»ç»Ÿæä¾›è¯»å†™è¿™ä¸ªè®¾å¤‡çš„å‡½æ•°å®ç°ï¼Œæ“ä½œç³»ç»Ÿåˆ™å°†<strong>å‡½æ•°æŒ‡é’ˆ</strong>æŒ‡å‘å¯¹åº”çš„å‡½æ•°ï¼Œä¾¿èƒ½å®ç°å¯¹æŸä¸€ä¸ªç¡¬ä»¶è®¾å¤‡çš„æ“ä½œï¼</p><p>æ¯”å¦‚è°ƒç”¨æ˜¾ç¤ºå™¨é©±åŠ¨çš„writeåˆ·æ–°æ˜¾ç¤ºå™¨çš„ç”»é¢ï¼Œè°ƒç”¨ç½‘å¡çš„<code>read/write</code>æ¥<code>ä¸‹è½½/ä¸Šä¼ </code>æ•°æ®ç­‰ç­‰ï¼</p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202210261210571.png" alt="image-20221026121038482"></p><hr><h2 id="3-4-åˆ†é…è§„åˆ™"><a href="#3-4-åˆ†é…è§„åˆ™" class="headerlink" title="3.4 åˆ†é…è§„åˆ™"></a>3.4 åˆ†é…è§„åˆ™</h2><p>åˆ†é…æ–‡ä»¶æè¿°ç¬¦çš„æ—¶å€™ï¼Œä¼šä»å¤´å¼€å§‹éå†<code>fd_array[]</code>ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ²¡æœ‰è¢«ä½¿ç”¨çš„ä¸‹æ ‡ï¼Œåˆ†é…ç»™æ–°çš„æ–‡ä»¶ï¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">test7</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> fda = open(<span class="string">&quot;loga.txt&quot;</span>, O_WRONLY | O_CREAT | O_TRUNC, <span class="number">0666</span>);</span><br><span class="line">    <span class="type">int</span> fdb = open(<span class="string">&quot;logb.txt&quot;</span>, O_WRONLY | O_CREAT | O_TRUNC, <span class="number">0666</span>);    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;fda: %d\n&quot;</span>, fda);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;fdb: %d\n&quot;</span>, fdb);</span><br><span class="line">    close(fda);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> fdc = open(<span class="string">&quot;logc.txt&quot;</span>, O_WRONLY | O_CREAT | O_TRUNC, <span class="number">0666</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;fdc: %d\n&quot;</span>, fdc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬å…ˆæ‰“å¼€äº†ä¸¤ä¸ªæ–‡ä»¶ï¼Œæ‰“å°å¯ä»¥çœ‹åˆ°å…¶æ–‡ä»¶æè¿°ç¬¦ä¸º<code>3/4</code>ï¼›å…³æ‰ç¬¬ä¸€ä¸ªæ–‡ä»¶åï¼Œå†æ‰“å¼€ä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œä¼šå‘ç°æ–‡ä»¶æè¿°ç¬¦è¿˜æ˜¯3ï¼ˆç¬¬ä¸€ä¸ªä¸ºç©ºçš„æ–‡ä»¶æè¿°ç¬¦ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ ./test</span><br><span class="line">fda: 3</span><br><span class="line">fdb: 4</span><br><span class="line"></span><br><span class="line">fdc: 3</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ </span><br></pre></td></tr></table></figure><h3 id="è¾“å‡ºé‡å®šå‘"><a href="#è¾“å‡ºé‡å®šå‘" class="headerlink" title="è¾“å‡ºé‡å®šå‘"></a>è¾“å‡ºé‡å®šå‘</h3><p>åŒç†ï¼Œå¦‚æœæˆ‘ä»¬åœ¨æ‰“å¼€æ–‡ä»¶ä¹‹å‰ï¼Œå°±å…³é—­æ‰Cè¯­è¨€æ‰“å¼€çš„<code>stdout</code>ï¼Œé‚£ä¹ˆæ­¤æ—¶æ‰“å¼€æ–‡ä»¶çš„fdå°±ä¸º1ï¼Œæˆ‘ä»¬çš„printfåˆ™ä¼šæŠŠæ•°æ®æ‰“å°åˆ°è¯¥æ–‡ä»¶å½“ä¸­ï¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">test8</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//æ–‡ä»¶æè¿°ç¬¦åˆ†é…çš„æ—¶å€™ï¼Œä¼šåœ¨æ•°ç»„é‡Œé¢æ‰¾ç¬¬ä¸€ä¸ªä¸ºç©ºçš„æè¿°ç¬¦</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;start test!\n&quot;</span>);<span class="comment">//æ‰“å°åˆ°å±å¹•ä¸Š</span></span><br><span class="line">    close(<span class="number">1</span>);<span class="comment">//å…³é—­stdout</span></span><br><span class="line">    <span class="type">int</span> fd = open(<span class="string">&quot;log.txt&quot;</span>, O_WRONLY | O_CREAT | O_TRUNC, <span class="number">0666</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;fd: %d\n&quot;</span>,fd);<span class="comment">//æ‰“å°åˆ°æ–‡ä»¶ä¸­</span></span><br><span class="line">    close(fd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿è¡Œ<code>./test</code>ä¹‹å‰ï¼Œæ–‡ä»¶é‡Œé¢æ²¡æœ‰å†…å®¹ã€‚æ‰§è¡Œä¹‹åï¼Œå°±æŠŠæˆ‘ä»¬<code>printf</code>çš„æ•°æ®è¾“å‡ºåˆ°æ–‡ä»¶å½“ä¸­äº†ï¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ <span class="built_in">cat</span> log.txt</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ ./test</span><br><span class="line">start <span class="built_in">test</span>!</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ <span class="built_in">cat</span> log.txt</span><br><span class="line">fd: 1</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ </span><br></pre></td></tr></table></figure><p>è¿™ç§æ“ä½œå°±å«åš<strong>è¾“å‡ºé‡å®šå‘</strong>ï¼</p><p>å¦å¤–<span id="jump">ä¸€ç§æƒ…å†µ</span>ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å…³é—­<code>stdout</code>ä¹‹å‰ä¸è¿›è¡Œ<code>printf</code>ï¼Œåˆ™ä¸ä¼šç«‹é©¬åˆ·æ–°åˆ°<code>log.txt</code>è€Œæ˜¯éœ€è¦æˆ‘ä»¬åˆ·æ–°äº†ç¼“å†²åŒºä¹‹åï¼Œæ‰ä¼šå†™å…¥åˆ°æ–‡ä»¶ä¸­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">close(<span class="number">1</span>);<span class="comment">//å…³é—­stdout</span></span><br><span class="line"><span class="type">int</span> fd = open(<span class="string">&quot;log.txt&quot;</span>, O_WRONLY | O_CREAT | O_TRUNC, <span class="number">0666</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;fd: %d\n&quot;</span>,fd);</span><br><span class="line">fflush(<span class="built_in">stdout</span>);</span><br><span class="line">close(fd);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸ªå°æŠ€å·§<code>&gt;log.txt</code>å¯ä»¥ç”¨æ¥æ¸…ç©ºæ–‡ä»¶çš„å†…å®¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ &gt;log.txt</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ ./test</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ <span class="built_in">cat</span> log.txt</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$</span><br></pre></td></tr></table></figure><hr><h2 id="3-5-dup2"><a href="#3-5-dup2" class="headerlink" title="3.5 dup2"></a>3.5 dup2</h2><p>ä¸Šé¢æ˜¯æˆ‘ä»¬æ‰‹åŠ¨è¿›è¡Œçš„<strong>è¾“å‡ºé‡å®šå‘</strong>æ“ä½œã€‚æ“ä½œç³»ç»Ÿæä¾›äº†ä¸€ä¸ª<strong>æ¥å£</strong>ï¼Œå¯ä»¥è®©æˆ‘ä»¬å¾ˆæ–¹ä¾¿åœ°è¿›è¡Œè¾“å‡ºé‡å®šå‘</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">dup2</span><span class="params">(<span class="type">int</span> oldfd, <span class="type">int</span> newfd)</span>;</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202210261610321.png" alt="image-20221026161000273"></p><p>è¿™é‡Œæˆ‘ä»¬è¦ç”¨çš„æ˜¯<code>dup2</code>å‡½æ•°ï¼Œå®ƒçš„ä½œç”¨å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dup2() makes newfd be the copy of oldfd, closing newfd first if necessary, but note the following:</span><br><span class="line"></span><br><span class="line">*  If oldfd is not a valid file descriptor, then the call fails, and newfd is not closed.</span><br><span class="line">*  If oldfd is a valid file descriptor, and newfd has the same value as oldfd, then dup2() does nothing, and returns newfd.</span><br></pre></td></tr></table></figure><p>ä¸€å®šè¦çœ‹æ¸…æ¥šï¼Œæ˜¯å°†<code>newfd</code>å˜æˆ<code>oldfd</code>çš„ä¸€ä¸ªæ‹·è´ï¼Œåœ¨æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå°±åªå‰©<code>oldfd</code>äº†ï¼</p><p>å¦‚æœ<code>newfd</code>åŸæœ¬å·²ç»æ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œè¯¥æ“ä½œä¼šå…ˆå°†<code>newfd</code>ç»™å…³æ‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RETURN VALUE</span><br><span class="line">On success, these system calls return the new descriptor.  On error, -1 is returned, and errno is set appropriately.</span><br></pre></td></tr></table></figure><p>è¯¥å‡½æ•°æˆåŠŸçš„æ—¶å€™ä¼šè¿”å›<code>newfd</code>ï¼Œå¦åˆ™è¿”å›<code>-1</code></p><hr><p>ä¸‹é¢ä¸ºä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œå‡è®¾æˆ‘ä»¬æƒ³å°†è¾“å‡ºçš„å†…å®¹é‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>dup2</code>å°†1æ›¿æ¢ä¸ºæˆ‘ä»¬è‡ªå·±çš„fdï¼Œæ­¤æ—¶<code>oldfd=fd,newfd=1</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">test9</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> fd = open(<span class="string">&quot;log.txt&quot;</span>, O_WRONLY | O_CREAT | O_TRUNC, <span class="number">0666</span>);</span><br><span class="line">    dup2(fd, <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> ret = dup2(fd, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(ret &gt; <span class="number">0</span>) </span><br><span class="line">        close(fd);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;ret: %d\n&quot;</span>, ret);<span class="comment">//retä¸ºnewfd</span></span><br><span class="line">    <span class="comment">//æœ¬æ¥å¾€æ˜¾ç¤ºå™¨æ‰“å°ï¼Œæœ€ç»ˆå˜æˆå‘æŒ‡å®šæ–‡ä»¶æ‰“å° -&gt; é‡å®šå‘</span></span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stdout</span>, <span class="string">&quot;æ‰“å¼€æ–‡ä»¶æˆåŠŸï¼Œfd: %d\n&quot;</span>, fd);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);<span class="comment">//åˆ·æ–°ç¼“å†²åŒº</span></span><br><span class="line">    close(fd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼Œæˆ‘ä»¬æˆåŠŸçš„å°†å†…å®¹<code>printf</code>åˆ°äº†æŒ‡å®šæ–‡ä»¶ä¸­</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ &gt;log.txt</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ ./test</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ <span class="built_in">cat</span> log.txt</span><br><span class="line">ret: 1</span><br><span class="line">æ‰“å¼€æ–‡ä»¶æˆåŠŸï¼Œfd: 3</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ </span><br></pre></td></tr></table></figure><ul><li>ä¸ºä»€ä¹ˆè¿™é‡Œå¯ä»¥ç”¨<code>stdout</code>æ¥è¾“å‡ºåˆ°æ–‡ä»¶ä¸­å‘¢ï¼Ÿ</li></ul><p>å› ä¸ºå½“æˆ‘ä»¬ä½¿ç”¨<code>dup2</code>çš„æ—¶å€™ï¼Œstdoutæ‰€æŒ‡å‘çš„æ–‡ä»¶æè¿°ç¬¦1å·²ç»è¢«æ›¿æ¢æˆäº†<code>log.txt</code>ï¼Œæ­¤æ—¶å¯¹stdoutçš„æ“ä½œå°±æ˜¯å¯¹æˆ‘ä»¬è‡ªå·±çš„æ–‡ä»¶æ“ä½œ</p><ul><li>ä¸ºä»€ä¹ˆè¿™é‡Œæˆ‘ä»¬å·²ç»æŠŠ<code>fd</code>å…³æ‰äº†ï¼Œä½†æ˜¯æ›¿æ¢æ‰çš„æ–‡ä»¶æè¿°ç¬¦<code>1</code>ä¸å—å½±å“å‘¢ï¼Ÿ</li></ul><p>åŒä¸€ä¸ªæ–‡ä»¶æ˜¯å¯ä»¥è¢«æ‰“å¼€å¤šæ¬¡çš„ï¼æ‰§è¡Œ<code>dup2</code>çš„æ—¶å€™ï¼Œå¯ä»¥ç†è§£ä¸ºæ“ä½œç³»ç»Ÿåˆä¸€æ¬¡æ‰“å¼€äº†<code>fd</code>æŒ‡å‘çš„æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶åº•å±‚ï¼Œåˆ™æœ‰ä¸€ä¸ªè®¡æ•°æ¥åˆ¤æ–­è¯¥æ–‡ä»¶è¢«æ‰“å¼€äº†å‡ æ¬¡ã€‚å½“æˆ‘ä»¬<code>close(fd)</code>çš„æ—¶å€™ï¼Œåªæ˜¯è®©è¯¥æ–‡ä»¶åº•å±‚<code>struct file</code>çš„æ‰“å¼€è®¡æ•°<code>-1</code>ï¼Œå¹¶éå®Œå…¨å…³é—­äº†è¯¥æ–‡ä»¶ï¼æ­¤æ—¶<code>1</code>è¿˜èƒ½æ­£ç¡®æŒ‡å‘<code>log.txt</code>å‘¢</p><h3 id="è¿½åŠ é‡å®šå‘"><a href="#è¿½åŠ é‡å®šå‘" class="headerlink" title="è¿½åŠ é‡å®šå‘"></a>è¿½åŠ é‡å®šå‘</h3><p>è¿™é‡Œåªéœ€è¦æˆ‘ä»¬æ”¹å˜<code>fd</code>æ‰“å¼€çš„æ–¹å¼ï¼ŒåŠ ä¸Š<code>O_APPEND</code>å³å¯ï¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">test9</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> fd = open(<span class="string">&quot;log.txt&quot;</span>, O_WRONLY | O_CREAT | O_APPEND, <span class="number">0666</span>);</span><br><span class="line">    dup2(fd, <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> ret = dup2(fd, <span class="number">1</span>);<span class="comment">//</span></span><br><span class="line">    <span class="keyword">if</span>(ret &gt; <span class="number">0</span>) </span><br><span class="line">        close(fd);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;ret: %d\n&quot;</span>, ret);<span class="comment">//retä¸ºnewfd</span></span><br><span class="line">    <span class="comment">//æœ¬æ¥å¾€æ˜¾ç¤ºå™¨æ‰“å°ï¼Œæœ€ç»ˆå˜æˆå‘æŒ‡å®šæ–‡ä»¶æ‰“å° -&gt; é‡å®šå‘</span></span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stdout</span>, <span class="string">&quot;æ‰“å¼€æ–‡ä»¶æˆåŠŸï¼Œfd: %d\n&quot;</span>, fd);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);<span class="comment">//åˆ·æ–°ç¼“å†²åŒº</span></span><br><span class="line">    close(fd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œå¯ä»¥çœ‹åˆ°ï¼ŒæˆåŠŸåœ¨åé¢è¿½åŠ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ <span class="built_in">cat</span> log.txt</span><br><span class="line">ret: 1</span><br><span class="line">æ‰“å¼€æ–‡ä»¶æˆåŠŸï¼Œfd: 3</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ ./test</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ <span class="built_in">cat</span> log.txt</span><br><span class="line">ret: 1</span><br><span class="line">æ‰“å¼€æ–‡ä»¶æˆåŠŸï¼Œfd: 3</span><br><span class="line">ret: 1</span><br><span class="line">æ‰“å¼€æ–‡ä»¶æˆåŠŸï¼Œfd: 3</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ </span><br></pre></td></tr></table></figure><h3 id="è¾“å…¥é‡å®šå‘"><a href="#è¾“å…¥é‡å®šå‘" class="headerlink" title="è¾“å…¥é‡å®šå‘"></a>è¾“å…¥é‡å®šå‘</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¾“å…¥é‡å®šå‘</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">test11</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> fd = open(<span class="string">&quot;log.txt&quot;</span>,O_RDONLY);</span><br><span class="line">    <span class="keyword">if</span>(fd&lt;<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = dup2(fd,<span class="number">0</span>);<span class="comment">//é‡å®šå‘stdin</span></span><br><span class="line">    <span class="keyword">if</span>(ret &gt; <span class="number">0</span>) </span><br><span class="line">        close(fd);</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> buf[<span class="number">128</span>];</span><br><span class="line">    <span class="keyword">while</span>(fgets(buf,<span class="keyword">sizeof</span>(buf),<span class="built_in">stdin</span>)!=<span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>,buf);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æˆ‘ä»¬çš„<code>stdin</code>è¢«<code>dup2</code>æ›¿æ¢æˆäº†<code>log.txt</code>ï¼Œå…¶è·å–è¾“å…¥çš„æ“ä½œè½¬ä¸ºäº†è¯»å–æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ <span class="built_in">cat</span> log.txt</span><br><span class="line">ret: 1</span><br><span class="line">æ‰“å¼€æ–‡ä»¶æˆåŠŸï¼Œfd: 3</span><br><span class="line">ret: 1</span><br><span class="line">æ‰“å¼€æ–‡ä»¶æˆåŠŸï¼Œfd: 3</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ ./test</span><br><span class="line">ret: 1</span><br><span class="line">æ‰“å¼€æ–‡ä»¶æˆåŠŸï¼Œfd: 3</span><br><span class="line">ret: 1</span><br><span class="line">æ‰“å¼€æ–‡ä»¶æˆåŠŸï¼Œfd: 3</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-18_files]$ </span><br></pre></td></tr></table></figure><h2 id="3-6-æ ‡å‡†è¾“å‡º-x2F-æ ‡å‡†é”™è¯¯"><a href="#3-6-æ ‡å‡†è¾“å‡º-x2F-æ ‡å‡†é”™è¯¯" class="headerlink" title="3.6 æ ‡å‡†è¾“å‡º&#x2F;æ ‡å‡†é”™è¯¯"></a>3.6 æ ‡å‡†è¾“å‡º&#x2F;æ ‡å‡†é”™è¯¯</h2><p>ä¹‹å‰å†™ä»£ç çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸¸å¸¸ç›´æ¥ä½¿ç”¨äº†printfæ¥æ‰“å°ä¸€äº›é”™è¯¯ä¿¡æ¯ï¼Œè€Œæ²¡æœ‰æ€ä¹ˆç”¨è¿‡<code>perror/cerr</code>è¿™ä¸¤ä¸ªåº“å‡½æ•°</p><p>é‚£ä¹ˆå®ƒä»¬å’Œ<code>printf/cout</code>åˆæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// stdout</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;hello printf\n&quot;</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(stdout, <span class="string">&quot;hello fprintf to stdout\n&quot;</span>);</span><br><span class="line">    <span class="built_in">fputs</span>(<span class="string">&quot;hello fputs to stdout\n&quot;</span>, stdout);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;hello cout&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// stderr</span></span><br><span class="line">    <span class="built_in">perror</span>(<span class="string">&quot;hello perror&quot;</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;hello fprintf to stderr\n&quot;</span>);</span><br><span class="line">    <span class="built_in">fputs</span>(<span class="string">&quot;hello fputs to stderr\n&quot;</span>, stderr);</span><br><span class="line">    cerr &lt;&lt; <span class="string">&quot;hello cerr&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•å‘ç°ï¼Œä¼¼ä¹æ²¡æœ‰å•¥åŒºåˆ«å•Šï¼Œä¸éƒ½æ‰“å°åˆ°å±å¹•ä¸Šäº†å—ï¼Ÿ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-31_stdout_err]$ ./test</span><br><span class="line">hello <span class="built_in">printf</span></span><br><span class="line">hello fprintf to stdout</span><br><span class="line">hello fputs to stdout</span><br><span class="line">hello cout</span><br><span class="line">hello perror: Success</span><br><span class="line">hello fprintf to stderr</span><br><span class="line">hello fputs to stderr</span><br><span class="line">hello cerr</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-31_stdout_err]$ </span><br></pre></td></tr></table></figure><p>éä¹Ÿï¼å½“æˆ‘ä»¬ä½¿ç”¨é‡å®šå‘çš„æ—¶å€™ï¼Œå°±å‡ºç°é—®é¢˜äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-31_stdout_err]$ ./test &gt;log.txt</span><br><span class="line">hello perror: Success</span><br><span class="line">hello fprintf to stderr</span><br><span class="line">hello fputs to stderr</span><br><span class="line">hello cerr</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-31_stdout_err]$ <span class="built_in">cat</span> log.txt</span><br><span class="line">hello <span class="built_in">printf</span></span><br><span class="line">hello fprintf to stdout</span><br><span class="line">hello fputs to stdout</span><br><span class="line">hello cout</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-31_stdout_err]$ </span><br></pre></td></tr></table></figure><p>æ¬¸ï¼Ÿä¸æ˜¯ä½¿ç”¨äº†é‡å®šå‘å—ï¼Œä¸ºä»€ä¹ˆè¿˜åœ¨å±å¹•ä¸Šè¾“å‡ºäº†å†…å®¹å‘¢ï¼Ÿ</p><p>ä»”ç»†ä¸€çœ‹ï¼Œè¾“å‡ºçš„éƒ½æ˜¯<code>stderr</code>çš„å†…å®¹ï¼Œè€Œæ²¡æœ‰<code>stdout</code>ã€‚catæ–‡ä»¶ä¸€çœ‹ï¼Œ<code>stdout</code>çš„å†…å®¹éƒ½åœ¨æ–‡ä»¶é‡Œé¢å˜ï¼</p><p>è¿˜è®°å¾—å—ï¼Ÿ<code>stdout/stderr</code>å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦æ˜¯<code>1/2</code>ï¼Œè€Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬éƒ½æŒ‡å‘çš„æ˜¯æ˜¾ç¤ºå™¨ã€‚</p><blockquote><p>æ³¨æ„ï¼šè™½ç„¶å®ƒä»¬ä¸¤ä¸ªæŒ‡å‘éƒ½æ˜¯æ˜¾ç¤ºå™¨ï¼Œä½†å®ƒä»¬æ˜¯é€šè¿‡ä¸¤ä¸ª<strong>ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦</strong>ï¼Œç‹¬ç«‹åœ°å¾€æ˜¾ç¤ºå™¨ä¸Šæ‰“å°å†…å®¹çš„ï¼</p></blockquote><p>æˆ‘ä»¬é‡å®šå‘çš„æ—¶å€™ï¼Œå…¶å®çœç•¥äº†ä¸€ä¸ª1ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œé‡å®šå‘åªå¯¹1å·æè¿°ç¬¦ï¼Œä¹Ÿå°±æ˜¯stdoutæœ‰æ•ˆï¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./test &gt;log.txt</span><br><span class="line">./test 1&gt;log.txt</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æŠŠè¿™é‡Œçš„1æ¢æˆ2ï¼Œç»“æœå°±ä¸ä¸€æ ·äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-31_stdout_err]$ ./test 2&gt;log.txt</span><br><span class="line">hello <span class="built_in">printf</span></span><br><span class="line">hello fprintf to stdout</span><br><span class="line">hello fputs to stdout</span><br><span class="line">hello cout</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-31_stdout_err]$ <span class="built_in">cat</span> log.txt</span><br><span class="line">hello perror: Success</span><br><span class="line">hello fprintf to stderr</span><br><span class="line">hello fputs to stderr</span><br><span class="line">hello cerr</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-31_stdout_err]$ </span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œstderrçš„å†…å®¹è¿›äº†æ–‡ä»¶ï¼Œè€Œstdoutçš„å†…å®¹è¾“å‡ºåˆ°äº†å±å¹•ä¸Š</p><h3 id="åŒºåˆ†é”™è¯¯å’Œæ­£å¸¸è¾“å‡º"><a href="#åŒºåˆ†é”™è¯¯å’Œæ­£å¸¸è¾“å‡º" class="headerlink" title="åŒºåˆ†é”™è¯¯å’Œæ­£å¸¸è¾“å‡º"></a>åŒºåˆ†é”™è¯¯å’Œæ­£å¸¸è¾“å‡º</h3><p>è¿™ä¹ˆè®¾è®¡çš„æ„ä¹‰ï¼Œå°±æ˜¯ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬å®šä½é—®é¢˜ã€‚å°†é”™è¯¯å’Œæ­£å¸¸çš„æ‰“å°è¾“å‡ºå†™é“ä¸åŒçš„æ–‡ä»¶ä¸­ã€‚å¦‚æœæˆ‘ä»¬åƒåªå…³æ³¨é”™è¯¯ï¼Œå°±åªéœ€è¦å»æŸ¥æ‰¾è®°å½•äº†é”™è¯¯ä¿¡æ¯çš„æ–‡ä»¶å³å¯</p><h3 id="æ··åˆè¾“å‡º2-gt-amp-1"><a href="#æ··åˆè¾“å‡º2-gt-amp-1" class="headerlink" title="æ··åˆè¾“å‡º2&gt;&amp;1"></a>æ··åˆè¾“å‡º2&gt;&amp;1</h3><p>å¦‚æœæˆ‘ä»¬å°±æ˜¯ä¸å¬ä¸å¬ï¼Œéè¦æŠŠä»–ä¿©æ‰“ä¸€ä¸ªæ–‡ä»¶é‡Œé¢ï¼Œåº”è¯¥æ€ä¹ˆå¼„å‘¢ï¼Ÿ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./test &gt;log.txt 2&gt;&amp;1</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª<code>2&gt;&amp;1</code>çš„æ“ä½œéœ€è¦æˆ‘ä»¬ç†è§£ï¼š</p><ul><li><code>./test</code>è¿è¡Œå¯æ‰§è¡Œç¨‹åº</li><li><code>&gt;log.txt</code>ä»£è¡¨é‡å®šå‘ï¼Œé»˜è®¤åªé‡å®šå‘äº†1</li><li>ç°åœ¨æŒ‡å‘<code>log.txt</code>çš„æ˜¯1å·æ–‡ä»¶æè¿°ç¬¦ï¼Œä»£è¡¨stdout</li><li><code>2&gt;&amp;1</code>ä»£è¡¨å°†2é‡å®šå‘åˆ°1ï¼Œå¯ä»¥ç†è§£ä¸º<code>dup2(1,2);</code></li><li>æ‰§è¡Œç»“æŸåï¼Œ2å°±æˆäº†1çš„ä¸€ä»½æ‹·è´ï¼Œç°åœ¨åªå‰©ä¸‹äº†1</li><li>å› ä¸º1æŒ‡å‘çš„æ˜¯<code>log.txt</code>ï¼Œæ‰€ä»¥2ä¹ŸæŒ‡å‘çš„æ˜¯ç›¸åŒæ–‡ä»¶</li></ul><p>è€Œè¿™ä¸ªè¯­å¥å¿…é¡»å†™åœ¨<code>&gt;log.txt</code>çš„åé¢ï¼Œ å¦åˆ™æ„ä¹‰å°±é”™è¯¯äº†ğŸ‘‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./test 2&gt;&amp;1 &gt;log.txt <span class="comment">#é”™è¯¯å†™æ³•</span></span><br></pre></td></tr></table></figure><ul><li><code>2&gt;&amp;1</code>ä»£è¡¨å°†2é‡å®šå‘åˆ°1ï¼Œæ­¤æ—¶1æŒ‡å‘çš„æ˜¯å±å¹•ï¼Œæ‰€ä»¥2ä¹ŸæŒ‡å‘äº†å±å¹•</li><li><code>&gt;log.txt</code>ä»£è¡¨å°†1æŒ‡å‘æ–‡ä»¶ï¼Œæ­¤æ—¶1æŒ‡å‘äº†æ–‡ä»¶ï¼Œä½†æ˜¯2è¿˜æ˜¯æŒ‡å‘å±å¹•</li><li>ç™½å†™ï¼</li></ul><p>æ‰§è¡Œäº†æ­£ç¡®çš„å‘½ä»¤åï¼Œæ¥çœ‹çœ‹ç»“æœå§ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-31_stdout_err]$ ./test &gt;log.txt 2&gt;&amp;1</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-31_stdout_err]$ cat log.txt</span><br><span class="line">hello printf</span><br><span class="line">hello fprintf to stdout</span><br><span class="line">hello fputs to stdout</span><br><span class="line">hello cout</span><br><span class="line">hello perror: Success</span><br><span class="line">hello fprintf to stderr</span><br><span class="line">hello fputs to stderr</span><br><span class="line">hello cerr</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-31_stdout_err]$ </span><br></pre></td></tr></table></figure><p>æ ‡å‡†é”™è¯¯å’Œæ ‡å‡†è¾“å‡ºçš„å†…å®¹éƒ½è¢«å†™å…¥åˆ°æ–‡ä»¶ä¸­äº†ï¼</p><p>ä¸Šé¢çš„æ•´æ³•å®åœ¨æœ‰ç‚¹å¤ªé•¿äº†ï¼Œè€Œä¸”è¿˜æœ‰å¯èƒ½è®°ä¸ä½å†™åäº†ã€‚æ‰€ä»¥æœ‰ä¸€ç§ç®€å†™çš„æ–¹å¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç®€å†™æ–¹å¼</span></span><br><span class="line">&amp;&gt;log.txt</span><br><span class="line"><span class="comment">#ä¸Šé¢çš„å†™æ³•ç­‰åŒäº</span></span><br><span class="line">&gt;log.txt 2&gt;&amp;1</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¸€ä¸‹ï¼Œæ²¡é—®é¢˜ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-31_stdout_err]$ &gt;log.txt</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-31_stdout_err]$ ./test &amp;&gt;log.txt</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-31_stdout_err]$ cat log.txt</span><br><span class="line">hello printf</span><br><span class="line">hello fprintf to stdout</span><br><span class="line">hello fputs to stdout</span><br><span class="line">hello cout</span><br><span class="line">hello perror: Success</span><br><span class="line">hello fprintf to stderr</span><br><span class="line">hello fputs to stderr</span><br><span class="line">hello cerr</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-31_stdout_err]$ </span><br></pre></td></tr></table></figure><blockquote><p>å…³äº<code>2&gt;&amp;1</code>çš„è¯¦è§£å‚è€ƒğŸ‘‰ <a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/zhaominpro/article/details/82630528">ä¼ é€é—¨<i class="fas fa-external-link-alt"></i></a></p></blockquote><hr><h1 id="4-Cè¯­è¨€ç¼“å†²åŒº"><a href="#4-Cè¯­è¨€ç¼“å†²åŒº" class="headerlink" title="4.Cè¯­è¨€ç¼“å†²åŒº"></a>4.Cè¯­è¨€ç¼“å†²åŒº</h1><h2 id="4-1-è§‚å¯Ÿç°è±¡"><a href="#4-1-è§‚å¯Ÿç°è±¡" class="headerlink" title="4.1 è§‚å¯Ÿç°è±¡"></a>4.1 è§‚å¯Ÿç°è±¡</h2><p>å…ˆæ¥çœ‹çœ‹ä¸‹é¢çš„ä»£ç ï¼Œåˆ†åˆ«è°ƒç”¨Cè¯­è¨€çš„<code>printf</code>å’Œæ“ä½œç³»ç»Ÿçš„<code>write</code>æ¥å£ï¼Œå¾€å±å¹•ä¸Šæ‰“å°å†…å®¹ã€‚ç»“æŸå<code>sleep(3)</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">test1</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;test printf &quot;</span>);</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>*msg = <span class="string">&quot;test write &quot;</span>;</span><br><span class="line">    write(<span class="built_in">stdout</span>-&gt;_fileno,msg,<span class="built_in">strlen</span>(msg));</span><br><span class="line"></span><br><span class="line">    sleep(<span class="number">3</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202210270937921.gif" alt="GIF"></p><p>æˆ‘ä»¬æƒŠå¥‡çš„å‘ç°ï¼Œç¬¬ä¸€ä¸ªæ‰“å°å‡ºæ¥çš„ç«Ÿç„¶æ˜¯<code>write</code>ï¼Œè€Œä¸æ˜¯åœ¨å®ƒä¹‹å‰çš„<code>printf</code>æ¥å£ï¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">test1</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;test printf &quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>*msg = <span class="string">&quot;test write &quot;</span>;</span><br><span class="line">    write(<span class="built_in">stdout</span>-&gt;_fileno,msg,<span class="built_in">strlen</span>(msg));</span><br><span class="line">    </span><br><span class="line">    sleep(<span class="number">3</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªæœ‰åœ¨<code>printf</code>åç«‹é©¬è°ƒç”¨<code>fflush</code>åˆ·æ–°ç¼“å†²åŒºï¼Œæ‰èƒ½æŒ‰æ­£ç¡®çš„â€œé¡ºåºâ€æ‰“å°å‡ºå†…å®¹æ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-27_buffer]$ ./test</span><br><span class="line"><span class="built_in">test</span> <span class="built_in">printf</span> <span class="built_in">test</span> write [muxue@bt-7274:~/git/linux/code/22-10-27_buffer]$ </span><br></pre></td></tr></table></figure><p>åœ¨è°ƒç”¨å…¶ä»–Cè¯­è¨€çš„å‡½æ•°ï¼Œå¾€å±å¹•ä¸Šè¾“å‡ºä¿¡æ¯ã€‚æˆ‘ä»¬ä¼šå‘ç°ç»“æœç›¸åŒï¼éƒ½æ˜¯å…ˆæ‰“å°å‡ºæ¥<code>write</code>ç»“æœï¼Œæ‰<strong>ä¸€æ¬¡æ€§</strong>æ‰“å°å‡ºæ‰€æœ‰Cè¯­è¨€å‡½æ•°çš„ç»“æœ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">test2</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;test printf &quot;</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stdout</span>,<span class="string">&quot;test fprintf &quot;</span>);</span><br><span class="line">    <span class="built_in">fputs</span>(<span class="string">&quot;test fputs &quot;</span>,<span class="built_in">stdout</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>*msg = <span class="string">&quot;test write &quot;</span>;</span><br><span class="line">    write(<span class="built_in">stdout</span>-&gt;_fileno,msg,<span class="built_in">strlen</span>(msg));</span><br><span class="line">    </span><br><span class="line">    sleep(<span class="number">3</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-27_buffer]$ ./test</span><br><span class="line"><span class="built_in">test</span> write <span class="built_in">test</span> <span class="built_in">printf</span> <span class="built_in">test</span> fprintf <span class="built_in">test</span> fputs [muxue@bt-7274:~/git/linux/code/22-10-27_buffer]$ </span><br></pre></td></tr></table></figure><p>ç”±æ­¤å¯è§ï¼Œä¹‹å‰æˆ‘ä»¬ä¸€ç›´æåˆ°çš„ç¼“å†²åŒºï¼Œå…¶å®æ˜¯<strong>Cè¯­è¨€æä¾›</strong>çš„ï¼</p><blockquote><p>æ³¨æ„ï¼šç¼“å†²åŒºä¸æ­¢Cè¯­è¨€å†…éƒ¨æœ‰ï¼Œæ“ä½œç³»ç»Ÿå†…ä¹Ÿæœ‰ã€‚æœ¬æ–‡åªè®¨è®ºCè¯­è¨€æä¾›çš„ç¼“å†²åŒº</p></blockquote><hr><h2 id="4-2-ç¼“å†²åŒºåœ¨å“ª"><a href="#4-2-ç¼“å†²åŒºåœ¨å“ª" class="headerlink" title="4.2 ç¼“å†²åŒºåœ¨å“ª?"></a>4.2 ç¼“å†²åŒºåœ¨å“ª?</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;test printf &quot;</span>);</span><br><span class="line"><span class="built_in">fprintf</span>(<span class="built_in">stdout</span>,<span class="string">&quot;test fprintf &quot;</span>);</span><br><span class="line"><span class="built_in">fputs</span>(<span class="string">&quot;test fputs &quot;</span>,<span class="built_in">stdout</span>);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™å‡ ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹ï¼šå®ƒä»¬éƒ½å¾€<code>stdout</code>é‡Œé¢æ‰“å°äº†å†…å®¹ï¼</p><blockquote><p><code>printf</code>è™½ç„¶æ²¡æœ‰æ˜¾ç¤ºæŒ‡å®š<code>stdout</code>ï¼Œä½†æ˜¯åº•å±‚æ˜¯æœ‰çš„</p></blockquote><p>æˆ‘ä»¬çŸ¥é“ï¼ŒCè¯­è¨€çš„æ–‡ä»¶æ˜¯ä¸€ä¸ª<code>FILE</code>ç±»å‹çš„ç»“æ„ä½“ã€‚è¯¥ç»“æ„ä½“å†…å°è£…äº†å¾ˆå¤šå±æ€§ï¼Œå…¶ä¸­<code>stdout</code>çš„<code>_fileno</code>æ–‡ä»¶æè¿°ç¬¦ï¼Œå°±æ˜¯è¯¥<code>FILE</code>å¯¹åº”çš„è¯­è¨€çº§åˆ«çš„ç¼“å†²åŒºï¼</p><h3 id="å…³é—­æ–‡ä»¶æè¿°ç¬¦"><a href="#å…³é—­æ–‡ä»¶æè¿°ç¬¦" class="headerlink" title="å…³é—­æ–‡ä»¶æè¿°ç¬¦"></a>å…³é—­æ–‡ä»¶æè¿°ç¬¦</h3><p>å¦‚æœæˆ‘ä»¬åœ¨æ•°æ®åˆ·æ–°ä¹‹å‰ï¼Œå…³é—­äº†<code>stdout</code>å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;test printf &quot;</span>);</span><br><span class="line"><span class="built_in">fprintf</span>(<span class="built_in">stdout</span>,<span class="string">&quot;test fprintf &quot;</span>);</span><br><span class="line"><span class="built_in">fputs</span>(<span class="string">&quot;test fputs &quot;</span>,<span class="built_in">stdout</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>*msg = <span class="string">&quot;test write &quot;</span>;</span><br><span class="line">write(<span class="built_in">stdout</span>-&gt;_fileno,msg,<span class="built_in">strlen</span>(msg));</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">3</span>);</span><br><span class="line">close(<span class="built_in">stdout</span>-&gt;_fileno);</span><br></pre></td></tr></table></figure><p>ç»“æœå°±æ˜¯ï¼Œå•¥éƒ½æ²¡æœ‰åˆ·æ–°ï¼</p><p>ç¼“å†²åŒºéƒ½è¢«å…³é—­äº†ï¼Œå…¶å†…éƒ¨çš„æ•°æ®éƒ½æ— äº†ï¼Œè‚¯å®šä¸ä¼šåˆ·æ–°å•¦~</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt<span class="number">-7274</span>:~/git/linux/code/<span class="number">22</span><span class="number">-10</span><span class="number">-27</span>_buffer]$ ./test</span><br><span class="line">test write [muxue@bt<span class="number">-7274</span>:~/git/linux/code/<span class="number">22</span><span class="number">-10</span><span class="number">-27</span>_buffer]$ </span><br></pre></td></tr></table></figure><p>è€Œåœ¨<a href="#jump">è¾“å‡ºé‡å®šå‘</a>ä¸­ï¼Œæ‰“å°çš„å†…å®¹æ²¡æœ‰ç›´æ¥è¢«æ˜¾ç¤ºçš„ï¼Œä¹Ÿæ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰åœ¨å…³é—­<code>fd</code>ä¹‹å‰åˆ·æ–°<code>stdout</code>ï¼ˆæ­¤æ—¶æŒ‡å‘çš„æ˜¯fdï¼‰ä¸­çš„ç¼“å†²åŒº</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">close(<span class="number">1</span>);<span class="comment">//å…³é—­stdout</span></span><br><span class="line"><span class="type">int</span> fd = open(<span class="string">&quot;log.txt&quot;</span>, O_WRONLY | O_CREAT | O_TRUNC, <span class="number">0666</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;fd: %d\n&quot;</span>,fd);</span><br><span class="line">fflush(<span class="built_in">stdout</span>);</span><br><span class="line">close(fd);</span><br></pre></td></tr></table></figure><h3 id="FILE"><a href="#FILE" class="headerlink" title="FILE"></a>FILE</h3><p>æ—¢ç„¶stdoutçš„ç¼“å†²åŒºåœ¨FILEå†…éƒ¨ï¼Œæ¨è€Œå¹¿ä¹‹ï¼Œæ‰€æœ‰ç”¨Cè¯­è¨€æ‰“å¼€çš„æ–‡ä»¶ï¼Œ<code>FILE</code>ä¸­éƒ½ä¼šæœ‰ä¸€ä¸ª<strong>æ–‡ä»¶æè¿°ç¬¦</strong>å’Œå®ƒè‡ªå·±çš„<strong>è¯­è¨€çº§åˆ«ç¼“å†²åŒº</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> <span class="title">FILE</span>;</span></span><br></pre></td></tr></table></figure><p>åº“å‡½æ•°ä¸­çš„<code>FILE</code>æ˜¯ä¸€ä¸ª<code>struct _IO_FILE</code>ç±»å‹çš„ç»“æ„ä½“ï¼Œå…¶å®šä¹‰å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> &#123;</span></span><br><span class="line">  <span class="type">int</span> _flags;		<span class="comment">/* High-order word is _IO_MAGIC; rest is flags. */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _IO_file_flags _flags</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//ä¸‹é¢è¿™äº›å°±æ˜¯å®ƒçš„ç¼“å†²åŒº</span></span><br><span class="line">  <span class="comment">/* The following pointers correspond to the C++ streambuf protocol. */</span></span><br><span class="line">  <span class="comment">/* Note:  Tk uses the _IO_read_ptr and _IO_read_end fields directly. */</span></span><br><span class="line">  <span class="type">char</span>* _IO_read_ptr;	<span class="comment">/* Current read pointer */</span></span><br><span class="line">  <span class="type">char</span>* _IO_read_end;	<span class="comment">/* End of get area. */</span></span><br><span class="line">  <span class="type">char</span>* _IO_read_base;	<span class="comment">/* Start of putback+get area. */</span></span><br><span class="line">  <span class="type">char</span>* _IO_write_base;	<span class="comment">/* Start of put area. */</span></span><br><span class="line">  <span class="type">char</span>* _IO_write_ptr;	<span class="comment">/* Current put pointer. */</span></span><br><span class="line">  <span class="type">char</span>* _IO_write_end;	<span class="comment">/* End of put area. */</span></span><br><span class="line">  <span class="type">char</span>* _IO_buf_base;	<span class="comment">/* Start of reserve area. */</span></span><br><span class="line">  <span class="type">char</span>* _IO_buf_end;	<span class="comment">/* End of reserve area. */</span></span><br><span class="line">  <span class="comment">/* The following fields are used to support backing up and undo. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_save_base; <span class="comment">/* Pointer to start of non-current get area. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_backup_base;  <span class="comment">/* Pointer to first valid character of backup area */</span></span><br><span class="line">  <span class="type">char</span> *_IO_save_end; <span class="comment">/* Pointer to end of non-current get area. */</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_marker</span> *_<span class="title">markers</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> *_<span class="title">chain</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> _fileno;<span class="comment">//æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 0</span></span><br><span class="line">  <span class="type">int</span> _blksize;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">  <span class="type">int</span> _flags2;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  _IO_off_t _old_offset; <span class="comment">/* This used to be _offset but it&#x27;s too small.  */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __HAVE_COLUMN <span class="comment">/* temporary */</span></span></span><br><span class="line">  <span class="comment">/* 1+column number of pbase(); 0 is unknown. */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> _cur_column;</span><br><span class="line">  <span class="type">signed</span> <span class="type">char</span> _vtable_offset;</span><br><span class="line">  <span class="type">char</span> _shortbuf[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*  char* _save_gptr;  char* _save_egptr; */</span></span><br><span class="line"></span><br><span class="line">  _IO_lock_t *_lock;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _IO_USE_OLD_IO_FILE</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰å¤šä¸ªå˜é‡ç”¨äºç»´æŠ¤è¯¥æ–‡ä»¶çš„ç¼“å†²åŒºï¼Œä¹Ÿè¯å®äº†ç¼“å†²åŒºæ˜¯ç”±Cè¯­è¨€æä¾›çš„è¿™ä¸€ç»“è®ºã€‚</p><h2 id="4-3-ç¼“å†²åŒºçš„ä½œç”¨"><a href="#4-3-ç¼“å†²åŒºçš„ä½œç”¨" class="headerlink" title="4.3 ç¼“å†²åŒºçš„ä½œç”¨"></a>4.3 ç¼“å†²åŒºçš„ä½œç”¨</h2><p>Cè¯­è¨€æä¾›ç¼“å†²åŒºçš„ç†ç”±å¾ˆç®€å•ï¼Œç›¸å¯¹äºå†…å­˜è€Œè¨€ï¼Œå…¶ä½™ç¡¬ä»¶éƒ½æ˜¯æ»¡è®¾å¤‡ã€‚</p><ul><li>ä¸ºä»£ç æä¾›ç¼“å†²åŒºï¼Œå¯ä»¥æé«˜è¯¥ç¨‹åº&#x2F;è¿›ç¨‹è¾“å‡ºçš„æ•ˆç‡</li><li>ç¼“å†²åŒºå¯ä»¥é›†ä¸­å¤„ç†æ•°æ®åˆ·æ–°ï¼Œå‡å°‘IOçš„æ¬¡æ•°ï¼Œæé«˜äº†<strong>æ•´æœº</strong>è¿è¡Œæ•ˆç‡</li></ul><h2 id="4-4-ä»€ä¹ˆæ—¶å€™åˆ·æ–°ç¼“å†²åŒºï¼Ÿ"><a href="#4-4-ä»€ä¹ˆæ—¶å€™åˆ·æ–°ç¼“å†²åŒºï¼Ÿ" class="headerlink" title="4.4 ä»€ä¹ˆæ—¶å€™åˆ·æ–°ç¼“å†²åŒºï¼Ÿ"></a>4.4 ä»€ä¹ˆæ—¶å€™åˆ·æ–°ç¼“å†²åŒºï¼Ÿ</h2><p>ä»€ä¹ˆæ—¶å€™åˆ·æ–°ç¼“å†²åŒºï¼Œå¯¹åº”çš„æ˜¯<code>åˆ·æ–°ç­–ç•¥</code>é—®é¢˜</p><p><span id="jump1">å¸¸è§„çš„åˆ·æ–°ç­–ç•¥</span></p><ul><li>æ— ç¼“å†²ï¼ˆç«‹å³åˆ·æ–°ï¼‰</li><li>è¡Œç¼“å†²ï¼ˆé€è¡Œåˆ·æ–°ï¼‰</li><li>å…¨ç¼“å†²ï¼ˆç¼“å­˜åŒºæ»¡ï¼Œåˆ·æ–°ï¼‰</li></ul><p>ç‰¹æ®Šæƒ…å†µ</p><ul><li>è¿›ç¨‹é€€å‡ºï¼ˆåˆ·æ–°ï¼‰</li><li>ç”¨æˆ·è°ƒç”¨å‡½æ•°ï¼Œå¼ºåˆ¶åˆ·æ–°</li></ul><h3 id="åˆ·æ–°ä¸å­è¿›ç¨‹"><a href="#åˆ·æ–°ä¸å­è¿›ç¨‹" class="headerlink" title="åˆ·æ–°ä¸å­è¿›ç¨‹"></a>åˆ·æ–°ä¸å­è¿›ç¨‹</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">test3</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>*str1=<span class="string">&quot;test printf\n&quot;</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>*str2=<span class="string">&quot;test fprintf\n&quot;</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>*str3=<span class="string">&quot;test fputs\n&quot;</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>*str4=<span class="string">&quot;test write\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Cè¯­è¨€</span></span><br><span class="line">    <span class="built_in">printf</span>(str1);<span class="comment">//è¿™æ ·å†™ä¹Ÿæ˜¯okçš„</span></span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stdout</span>,str2);</span><br><span class="line">    <span class="built_in">fputs</span>(str3,<span class="built_in">stdout</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç³»ç»Ÿæ¥å£</span></span><br><span class="line">    write(<span class="built_in">stdout</span>-&gt;_fileno,str4,<span class="built_in">strlen</span>(str4));</span><br><span class="line">    <span class="comment">//å­è¿›ç¨‹åˆ›å»º</span></span><br><span class="line">    fork();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ï¼Œä¼šå‡ºç°ä¸¤ç§è¿è¡Œæƒ…å†µ</p><ul><li>å¦‚æœç›´æ¥æ‰“å°åˆ°å±å¹•ä¸Šï¼Œæ‰“å°çš„é¡ºåºå’Œå†…å®¹éƒ½æ˜¯æ­£ç¡®çš„</li><li>å¦‚æœé‡å®šå‘åˆ°æ–‡ä»¶ä¸­ï¼Œå´å‘ç°Cè¯­è¨€æ‰“å°çš„å†…å®¹éƒ½å¤šæ‰“äº†ä¸€æ¬¡ï¼</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-27_buffer]$ ./test</span><br><span class="line"><span class="built_in">test</span> <span class="built_in">printf</span></span><br><span class="line"><span class="built_in">test</span> fprintf</span><br><span class="line"><span class="built_in">test</span> fputs</span><br><span class="line"><span class="built_in">test</span> write</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-27_buffer]$ <span class="built_in">cat</span> log.txt</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-27_buffer]$ ./test &gt; log.txt</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-27_buffer]$ <span class="built_in">cat</span> log.txt</span><br><span class="line"><span class="built_in">test</span> write</span><br><span class="line"><span class="built_in">test</span> <span class="built_in">printf</span></span><br><span class="line"><span class="built_in">test</span> fprintf</span><br><span class="line"><span class="built_in">test</span> fputs</span><br><span class="line"><span class="built_in">test</span> <span class="built_in">printf</span></span><br><span class="line"><span class="built_in">test</span> fprintf</span><br><span class="line"><span class="built_in">test</span> fputs</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-27_buffer]$ </span><br></pre></td></tr></table></figure><p>åˆ·æ–°çš„æœ¬è´¨ï¼Œå…¶å®å°±æ˜¯æŠŠç¼“å†²åŒºä¸­æ•°æ®ï¼Œè°ƒç”¨<code>write</code>æ¥å£é€šè¿‡æ“ä½œç³»ç»Ÿå†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚è€Œ<code>FILE</code>å†…éƒ¨çš„ç¼“å†²åŒºï¼Œæ˜¯å±äº<strong>çˆ¶è¿›ç¨‹å†…éƒ¨</strong>çš„æ•°æ®ã€‚</p><p>å½“æˆ‘ä»¬åœ¨åˆ·æ–°ä¹‹å‰<code>fork</code>åˆ›å»ºå­è¿›ç¨‹çš„æ—¶å€™ï¼Œä¼šå‘ç”Ÿä¸€æ¬¡<strong>å†™æ—¶æ‹·è´</strong></p><p>ç»“æœå°±æ˜¯çˆ¶è¿›ç¨‹ã€å­è¿›ç¨‹<strong>å„åˆ·æ–°ä¸€æ¬¡</strong>ã€‚äºæ˜¯å°±å‡ºç°äº†ä¸Šé¢çš„Cè¯­è¨€çš„å†…å®¹å¤šäº†ä¸€ä»½çš„ç°è±¡ï¼</p><hr><h2 id="4-5-ç®€å•æ¨¡æ‹Ÿå®ç°"><a href="#4-5-ç®€å•æ¨¡æ‹Ÿå®ç°" class="headerlink" title="4.5 ç®€å•æ¨¡æ‹Ÿå®ç°"></a>4.5 ç®€å•æ¨¡æ‹Ÿå®ç°</h2><p>ç¼“å†²åŒºï¼Œæœ¬è´¨å°±æ˜¯Cè¯­è¨€åœ¨æ–‡ä»¶çš„ç»“æ„ä½“ä¸­ç»´æŠ¤çš„ä¸€ä¸ªæ•°ç»„ã€‚åŒæ—¶ç»´æŠ¤äº†å¤šç§<a href="#jump1">åˆ·æ–°ç­–ç•¥</a>ï¼Œåœ¨ä¸åŒçš„æ—¶åˆ»å°†è¯¥æ•°ç»„çš„å†…å®¹è°ƒç”¨ç³»ç»Ÿæ¥å£<code>write</code>å†™å…¥æ–‡ä»¶</p><p>è¿™é‡Œæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç®€å•çš„<code>MyFILE</code>ç»“æ„ä½“ï¼Œå†…éƒ¨å°è£…æ–‡ä»¶æè¿°ç¬¦ã€åˆ·æ–°ç­–ç•¥ã€ç¼“å†²åŒº</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> NONE_FLUSH 0x0 <span class="comment">//æ— åˆ·</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LINE_FLUSH 0x1 <span class="comment">//è¡Œåˆ·</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FULL_FLUSH 0x2 <span class="comment">//å…¨ç¼“å­˜</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">MyFILE</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> _fileno;</span><br><span class="line">    <span class="type">char</span> _buffer[NUM];</span><br><span class="line">    <span class="type">int</span> _end;<span class="comment">//ç¼“å†²åŒºç»“å°¾</span></span><br><span class="line">    <span class="type">int</span> _fflags; <span class="comment">//åˆ·æ–°ç­–ç•¥</span></span><br><span class="line">&#125;MyFILE;</span><br></pre></td></tr></table></figure><p>æœ‰äº†è‡ªå·±çš„æ–‡ä»¶ç»“æ„ä½“ï¼Œå¯¹åº”çš„ä¹Ÿéœ€è¦åˆ†è£…ä¸€ä¸‹ç³»ç»Ÿçš„<code>open/read/write/close</code>ç­‰æ¥å£ï¼Œè¿˜æœ‰<code>fflush</code>ç”¨äºå¼ºåˆ¶åˆ·æ–°</p><hr><h3 id="å°è£…æ¥å£"><a href="#å°è£…æ¥å£" class="headerlink" title="å°è£…æ¥å£"></a>å°è£…æ¥å£</h3><p>ä¸ºäº†åšåˆ°å°½é‡ç®€å•ï¼Œè¿™é‡Œæš‚æ—¶åªå°è£…<code>r/w/a</code>ä¸‰ç§æ‰“å¼€æ–¹æ³•</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">MyFILE *<span class="title function_">my_fopen</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *filename, <span class="type">const</span> <span class="type">char</span> *method)</span></span><br><span class="line">&#123;</span><br><span class="line">    assert(filename);</span><br><span class="line">    assert(method);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> flags = O_RDONLY;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">strcmp</span>(method, <span class="string">&quot;r&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        flags = O_RDONLY;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(method, <span class="string">&quot;w&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        flags = O_WRONLY | O_CREAT | O_TRUNC;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(method, <span class="string">&quot;a&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        flags = O_WRONLY | O_CREAT | O_APPEND;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> fileno = open(filename, flags, <span class="number">0666</span>);</span><br><span class="line">    <span class="keyword">if</span>(fileno &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    MyFILE *fp = (MyFILE *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(MyFILE));</span><br><span class="line">    <span class="keyword">if</span>(fp == <span class="literal">NULL</span>) <span class="keyword">return</span> fp;</span><br><span class="line">    <span class="built_in">memset</span>(fp, <span class="number">0</span>, <span class="keyword">sizeof</span>(MyFILE));</span><br><span class="line">    fp-&gt;_fileno = fileno;</span><br><span class="line">    fp-&gt;_fflags |= LINE_FLUSH;<span class="comment">//é»˜è®¤è¡Œç¼“å†²</span></span><br><span class="line">    fp-&gt;_end = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> fp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæš‚æ—¶åªç”¨è¡Œç¼“å†²å’Œå…¨ç¼“å†²æ¥ä½“éªŒä¸€ä¸‹ç¼“å†²åŒºçš„ä½œç”¨ã€‚åŒæ—¶åªå¯¹å­—ç¬¦ä¸²ç»“å°¾çš„<code>\n</code>è¿›è¡Œäº†åˆ¤æ–­ï¼Œæƒ…å†µä¸å¤Ÿå…¨é¢ã€‚</p><blockquote><p>è¿™é‡Œå…¶å®æˆ‘å¾ˆå¥½å¥‡ï¼ŒCåº“é‡Œé¢æ˜¯æ€ä¹ˆå¤„ç†<code>\n</code>çš„æï¼›æ€»ä¸èƒ½ç”¨éå†å§ï¼Ÿé‚£æ ·æ•ˆç‡ä¹Ÿå¤ªä½äº†ã€‚ä¸ªäººçŒœæµ‹æ˜¯å’Œé¢„å…ˆè®¾ç½®çš„ç‰¹æ®Šå­—ç¬¦æœ‰å…³ç³»ã€‚</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">my_fwrite</span><span class="params">(MyFILE *fp, <span class="type">const</span> <span class="type">char</span> *start, <span class="type">int</span> len)</span></span><br><span class="line">&#123;</span><br><span class="line">    assert(fp);</span><br><span class="line">    assert(start);</span><br><span class="line">    assert(len &gt; <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…ˆå†™å…¥åˆ°ç¼“å†²åŒºé‡Œé¢</span></span><br><span class="line">    <span class="built_in">strncpy</span>(fp-&gt;_buffer+fp-&gt;_end, start, len); <span class="comment">//å°†æ•°æ®å†™å…¥åˆ°ç¼“å†²åŒºäº†</span></span><br><span class="line">    fp-&gt;_end += len;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(fp-&gt;_fflags &amp; NONE_FLUSH)</span><br><span class="line">    &#123;&#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(fp-&gt;_fflags &amp; LINE_FLUSH)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//è¿™é‡Œçš„åˆ¤æ–­åªæ˜¯æµ‹è¯•ï¼Œå®é™…ä¸Šè¿˜éœ€è¦åˆ¤æ–­ä¸­é—´æœ‰æ— \n</span></span><br><span class="line">        <span class="keyword">if</span>(fp-&gt;_end &gt; <span class="number">0</span> &amp;&amp; fp-&gt;_buffer[fp-&gt;_end<span class="number">-1</span>] == <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//å†™å…¥åˆ°å†…æ ¸ä¸­</span></span><br><span class="line">            write(fp-&gt;_fileno, fp-&gt;_buffer, fp-&gt;_end);</span><br><span class="line">            fp-&gt;_end = <span class="number">0</span>;</span><br><span class="line">            syncfs(fp-&gt;_fileno);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(fp-&gt;_fflags &amp; FULL_FLUSH)</span><br><span class="line">    &#123;<span class="comment">//æ»¡äº†åˆ·æ–°</span></span><br><span class="line">        <span class="keyword">if</span>(fp-&gt;_end &gt; <span class="number">0</span> &amp;&amp; fp-&gt;_end==NUM)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//å†™å…¥åˆ°å†…æ ¸ä¸­</span></span><br><span class="line">            write(fp-&gt;_fileno, fp-&gt;_buffer, fp-&gt;_end);</span><br><span class="line">            fp-&gt;_end = <span class="number">0</span>;</span><br><span class="line">            syncfs(fp-&gt;_fileno);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€ä¸ªæ–°æ¥è§¦çš„å‡½æ•°<code>syncfs</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">syncfs</span><span class="params">(<span class="type">int</span> fd)</span>;</span><br></pre></td></tr></table></figure><p>è¯¥å‡½æ•°æ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨æ¥å£ï¼Œç”¨äºå°†æ–‡ä»¶å†…æ ¸ç¼“å†²åŒºå†…çš„æ•°æ®å†™å…¥åˆ°æŒ‡å®šæ–‡ä»¶ä¸­ã€‚</p><p>å‰é¢æˆ‘ä»¬æåˆ°çš„ç¼“å†²åŒºï¼Œä¸€ç›´è¯´çš„éƒ½æ˜¯Cè¯­è¨€å†…éƒ¨ç»´æŠ¤çš„ã€‚ä»è¿™ä¸ªæ¥å£ä¹Ÿèƒ½çœ‹å‡ºï¼Œæ“ä½œç³»ç»ŸåŒæ ·å¯¹æ–‡ä»¶è¿›è¡Œäº†ç¼“å†²åŒºçš„ç»´æŠ¤ã€‚</p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202210310827200.png" alt="image-20221031082754128"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">my_fflush</span><span class="params">(MyFILE *fp)</span></span><br><span class="line">&#123;</span><br><span class="line">    assert(fp);</span><br><span class="line">    <span class="keyword">if</span>(fp-&gt;_end &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        write(fp-&gt;_fileno, fp-&gt;_buffer, fp-&gt;_end);</span><br><span class="line">        fp-&gt;_end = <span class="number">0</span>;</span><br><span class="line">        syncfs(fp-&gt;_fileno);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">my_fclose</span><span class="params">(MyFILE *fp)</span></span><br><span class="line">&#123;</span><br><span class="line">    my_fflush(fp);</span><br><span class="line">    close(fp-&gt;_fileno);</span><br><span class="line">    <span class="built_in">free</span>(fp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è¿è¡Œæµ‹è¯•"><a href="#è¿è¡Œæµ‹è¯•" class="headerlink" title="è¿è¡Œæµ‹è¯•"></a>è¿è¡Œæµ‹è¯•</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    MyFILE *fp = my_fopen(<span class="string">&quot;log.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(fp == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;my_fopen error\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">const</span> <span class="type">char</span> *a = <span class="string">&quot;hello my 111\n&quot;</span>;</span><br><span class="line">    my_fwrite(fp, a, <span class="built_in">strlen</span>(a));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;æ¶ˆæ¯ç«‹å³åˆ·æ–°\n&quot;</span>);</span><br><span class="line">    sleep(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *b = <span class="string">&quot;hello my 222 &quot;</span>;</span><br><span class="line">    my_fwrite(fp, b, <span class="built_in">strlen</span>(b));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;å†™å…¥äº†ä¸€ä¸ªä¸æ»¡è¶³åˆ·æ–°æ¡ä»¶çš„å­—ç¬¦ä¸²\n&quot;</span>);</span><br><span class="line">    sleep(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *c = <span class="string">&quot;hello my 333 &quot;</span>;</span><br><span class="line">    my_fwrite(fp, c, <span class="built_in">strlen</span>(c));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;å†™å…¥äº†ä¸€ä¸ªä¸æ»¡è¶³åˆ·æ–°æ¡ä»¶çš„å­—ç¬¦ä¸²\n&quot;</span>);</span><br><span class="line">    sleep(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *d = <span class="string">&quot;end\n&quot;</span>;</span><br><span class="line">    my_fwrite(fp, d, <span class="built_in">strlen</span>(d));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;å†™å…¥äº†ä¸€ä¸ªæ»¡è¶³åˆ·æ–°æ¡ä»¶çš„å­—ç¬¦ä¸²\n&quot;</span>);</span><br><span class="line">    sleep(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    my_fclose(fp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;ç¨‹åºç»“æŸ\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆšå¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å†™å…¥äº†ä¸€ä¸ª<code>\n</code>ç»“å°¾çš„å­—ç¬¦ä¸²ï¼Œå…¶ç«‹é©¬å†™å…¥åˆ°äº†æ–‡ä»¶ä¸­</p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202210310837274.png" alt="image-20221031083740203"></p><p>éšåå†™å…¥äº†ä¸¤ä¸ªä¸æ»¡è¶³åˆ·æ–°æ¡ä»¶çš„å­—ç¬¦ä¸²ï¼Œæ–‡ä»¶ä¸­æ²¡æœ‰å‡ºç°ç»“æœ</p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202210310843013.png" alt="image-20221031084319928"></p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202210310845723.png" alt="image-20221031084533660"></p><p>è€Œå½“æˆ‘ä»¬å†™å…¥ä¸€ä¸ªæ»¡è¶³åˆ·æ–°æ¡ä»¶çš„å­—ç¬¦ä¸²åï¼Œç¼“å†²åŒºçš„å†…å®¹å°±<strong>åŒæ—¶</strong>è¢«å†™å…¥åˆ°æ–‡ä»¶ä¸­äº†ï¼</p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202210310844732.png" alt="image-20221031084426633"></p><h3 id="å­è¿›ç¨‹æµ‹è¯•"><a href="#å­è¿›ç¨‹æµ‹è¯•" class="headerlink" title="å­è¿›ç¨‹æµ‹è¯•"></a>å­è¿›ç¨‹æµ‹è¯•</h3><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æµ‹è¯•ä¸€ä¸‹å­è¿›ç¨‹æ˜¯å¦ä¼šå‡ºç°åˆ·æ–°ä¸¤æ¬¡çš„æƒ…å†µ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">test2</span><span class="params">(MyFILE * fp)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *s = <span class="string">&quot;-test &quot;</span>;</span><br><span class="line">    my_fwrite(fp, s, <span class="built_in">strlen</span>(s));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;å†™å…¥äº†ä¸€ä¸ªä¸æ»¡è¶³åˆ·æ–°æ¡ä»¶çš„å­—ç¬¦ä¸²\n&quot;</span>);</span><br><span class="line">    fork();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    MyFILE *fp = my_fopen(<span class="string">&quot;log.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(fp == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;my_fopen error\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//test1(fp);</span></span><br><span class="line">    test2(fp);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¨¡æ‹Ÿè¿›ç¨‹é€€å‡º</span></span><br><span class="line">    my_fclose(fp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;ç¨‹åºç»“æŸ\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚æˆ‘ä»¬æ‰€æ–™ï¼Œæ–‡ä»¶ä¸­å‡ºç°äº†ä¸¤ä¸ª<code>-test</code>ï¼ŒåŸå› åœ¨<code>4.4</code>ä¸­å·²åšè§£é‡Š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-27_buffer]$ <span class="built_in">cat</span> log.txt</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-27_buffer]$ ./test1</span><br><span class="line">å†™å…¥äº†ä¸€ä¸ªä¸æ»¡è¶³åˆ·æ–°æ¡ä»¶çš„å­—ç¬¦ä¸²</span><br><span class="line">ç¨‹åºç»“æŸ</span><br><span class="line">ç¨‹åºç»“æŸ</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-27_buffer]$ <span class="built_in">cat</span> log.txt</span><br><span class="line">-<span class="built_in">test</span> -<span class="built_in">test</span> [muxue@bt-7274:~/git/linux/code/22-10-27_buffer]$ </span><br></pre></td></tr></table></figure><hr><h1 id="5-æ–‡ä»¶ç³»ç»Ÿ"><a href="#5-æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="5.æ–‡ä»¶ç³»ç»Ÿ"></a>5.æ–‡ä»¶ç³»ç»Ÿ</h1><p>ä¹‹å‰æˆ‘ä»¬æåˆ°çš„è¿™äº›æ•°æ®ï¼Œéƒ½æ˜¯å­˜æ”¾åœ¨å†…å­˜ä¸­çš„ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¾¿è¦æ¥äº†è§£ä¸€ä¸‹æ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•ç®¡ç†ç£ç›˜ä¸Šçš„æ–‡ä»¶ã€‚</p><hr><h2 id="5-1-ç£ç›˜çš„ç‰©ç†ç»“æ„"><a href="#5-1-ç£ç›˜çš„ç‰©ç†ç»“æ„" class="headerlink" title="5.1 ç£ç›˜çš„ç‰©ç†ç»“æ„"></a>5.1 ç£ç›˜çš„ç‰©ç†ç»“æ„</h2><p>ä»¥æœºæ¢°ç¡¬ç›˜ä¸ºä¾‹ï¼Œå…¶å†…éƒ¨ä¸»è¦ç”±ç›˜ç‰‡å’Œç£å¤´ç»„æˆã€‚</p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202211011519001.png" alt="image-20221101151954853"></p><p>å½“æˆ‘ä»¬æ”¹å˜ç£ç›˜ä¸ŠæŸä¸€ä¸ªä½ç½®çš„NSæï¼Œå°±å¥½æ¯”æ›´æ”¹äº†æ­¤å¤„ä¿å­˜çš„æ•°æ®<code>0/1</code></p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202211011523967.png" alt="image-20221101152349875"></p><p>åœ¨æœºæ¢°ç¡¬ç›˜ä¸­ï¼Œä¸€ä¸ªç›˜ç‰‡å¯¹åº”ä¸€ä¸ªç£å¤´</p><ul><li>æ¯ä¸ªç›˜ç‰‡è¢«åˆ†ä¸ºè¯ºå¹²ä¸ªåŒå¿ƒåœ†ï¼Œæ¯ä¸€ä¸ªåŒå¿ƒåœ†å°±æ˜¯ä¸€ä¸ª<code>ç£é“</code></li><li>æ¯ä¸ªç£é“è¢«åˆ’åˆ†ä¸ºè¯ºå¹²<code>æ®µ</code>ï¼ˆæ‰‡åŒºï¼‰</li><li>æ¯ä¸ªæ‰‡åŒºçš„å­˜å‚¨å®¹é‡ä¸º<code>512å­—èŠ‚</code></li></ul><p>ç”±æ­¤å¯è§ï¼Œå½“æˆ‘ä»¬è¯»å†™æœºæ¢°ç¡¬ç›˜çš„æ—¶å€™ï¼Œéœ€è¦å»æ‰¾æŸä¸€ä¸ªç›˜é¢ã€æŸä¸€ä¸ªç£é“çš„æŸä¸€ç‰‡æ‰‡åŒºï¼Œå°±èƒ½æ‰¾åˆ°è¯¥æ‰‡åŒºçš„æ•°æ®ï¼</p><ul><li>ç›˜é¢ï¼ˆç£é¢ï¼‰æœ‰è‡ªå·±å¯¹åº”çš„ç£å¤´</li><li>ç£é“æ˜¯ç”±è·ç¦»åœ†å¿ƒçš„åŠå¾„å†³å®šçš„</li><li>æ‰‡åŒºæ˜¯ç”±ç›˜é¢æ—‹è½¬å†³å®šçš„</li></ul><p>è€Œæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿæ‰€ä½œçš„å·¥ä½œï¼Œä¾¿æ˜¯å°†æ–‡ä»¶å’Œå…¶å¯¹åº”çš„<strong>æ‰‡åŒº</strong>è”ç³»èµ·æ¥ã€‚ç”¨ä¸Šé¢æåˆ°çš„åŠæ³•ï¼Œä¾¿å¯ä»¥æŸ¥æ‰¾åˆ°æ¯ä¸€ä¸ªæ‰‡åŒºï¼</p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202211011600086.png" alt="image-20221101160047022"></p><p>è¿™ç§æŸ¥æ‰¾æ•°æ®ä½ç½®çš„æ“ä½œï¼Œè¢«ç§°ä¸º<code>CHSå¯»å€</code>ï¼Œ<code>CHS</code>åˆ†åˆ«å¯¹åº”ç£æŸ±ã€ç£é¢ã€æ‰‡åŒº</p><h2 id="5-2-CHSå’ŒLBA"><a href="#5-2-CHSå’ŒLBA" class="headerlink" title="5.2 CHSå’ŒLBA"></a>5.2 CHSå’ŒLBA</h2><blockquote><p>æ›´è¯¦ç»†çš„è§£æå‚è€ƒï¼š<a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/jadeshu/article/details/89072512">https://blog.csdn.net/jadeshu/article/details/89072512<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>å‡è®¾æˆ‘ä»¬æŠŠä¸€ä¸ªç£é“çš„æ•°æ®â€œæ‹‰ç›´â€ï¼Œå…¶å°±å˜æˆäº†ä¸€æ¡ç›´çº¿ã€‚ä¾æ­¤ç±»æ¨ï¼Œå¯ä»¥æŠŠæ¯ä¸€ä¸ªç›˜é¢ä¸Šçš„æ¯ä¸€æ¡ç£é“éƒ½â€œæ‹‰ç›´â€</p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202211011606527.png" alt="image-20221101160644467"></p><p>æœ€ç»ˆï¼Œå…¶ä¸å°±å˜æˆäº†å’Œä¸Šå›¾ç±»ä¼¼çš„â€œé•¿æ¡çŠ¶â€äº†å—ï¼Ÿæˆ‘ä»¬å­¦è¿‡çš„ä»€ä¹ˆæ•°æ®ç»“æ„ä¹Ÿæ˜¯çº¿æ€§é•¿æ¡çš„æï¼Ÿ</p><p>æ²¡é”™ï¼å°±æ˜¯<strong>æ•°ç»„</strong>ï¼</p><p>æ­¤æ—¶ï¼Œå¯¹ç£ç›˜æ–‡ä»¶çš„ä¿®æ”¹ï¼Œå°±å¯ä»¥æŠ½è±¡æˆå¯¹å†…æ ¸ä¸­ä¸€ä¸ªæ•°ç»„çš„<strong>å¢åˆ æŸ¥æ”¹</strong>æ“ä½œï¼</p><p>è¿™ç§æŠ½è±¡ä¹‹åçš„ç£ç›˜ï¼Œè¢«ç§°ä¸º<code>LBAé€»è¾‘å—åœ°å€</code>ï¼Œä»–ä»¬ä¹‹ä¸­æœ‰ä¸€ä¸ªè½¬æ¢å…³ç³»ğŸ‘‡</p><p>ç”¨Cè¡¨ç¤ºå½“å‰æŸ±é¢å·ï¼ŒHè¡¨ç¤ºå½“å‰ç£å¤´å·ï¼ŒSè¡¨ç¤ºå½“å‰æ‰‡åŒºå·ï¼ŒCSè¡¨ç¤ºèµ·å§‹æŸ±é¢å·ï¼ŒHSè¡¨ç¤ºèµ·å§‹ç£å¤´å·ï¼ŒSSè¡¨ç¤ºèµ·å§‹æ‰‡åŒºå·ï¼ŒPSè¡¨ç¤ºæ¯ç£é“æœ‰å¤šå°‘ä¸ªæ‰‡åŒºï¼ŒPHè¡¨ç¤ºæ¯æŸ±é¢æœ‰å¤šå°‘ä¸ªç£é“ï¼Œè®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š<br>$$<br>LBA &#x3D; ( C â€“ CS ) * PH * PS + ( H â€“ HS ) * PS + ( S â€“ SS )<br>$$<br>é€šè¿‡è¿™ä¸ªå…¬å¼ï¼Œæˆ‘ä»¬å°±èƒ½å°†ç£ç›˜ä¸­çš„ä¸€ä¸ªåŒºå—çš„æ•°æ®ï¼Œè½¬ä¸ºæ•°ç»„ä¸­çš„ä¸€ä¸ªä¸‹æ ‡ï¼Œæ¥æ–¹ä¾¿æ“ä½œç³»ç»Ÿè®¿é—®<br>$$<br>C &#x3D; LBA &#x2F; ( PH * PS ) + CS<br>$$</p><p>$$<br>H &#x3D; ( LBA &#x2F; PS ) % PH + HS<br>$$</p><p>$$<br>S &#x3D; LBA &#x2F; PS + SS<br>$$<br>ä¿®æ”¹äº†<strong>æ•°ç»„</strong>ä¸­çš„æ•°æ®ä¹‹åï¼Œæ“ä½œç³»ç»Ÿå°†LBAå¯¹åº”çš„CHSåœ°å€ç®—å‡ºæ¥äº¤ç»™<strong>ç£ç›˜</strong>ï¼Œè®©ç£ç›˜æ¥ä¿®æ”¹æŒ‡å®šæ‰‡åŒºçš„æ•°æ®ï¼Œä¾¿å®ç°äº†ä¿å­˜æ•°æ®åˆ°ç£ç›˜ä¸­çš„æ“ä½œ</p><hr><h2 id="5-3-IOçš„åŸºæœ¬å•ä½"><a href="#5-3-IOçš„åŸºæœ¬å•ä½" class="headerlink" title="5.3 IOçš„åŸºæœ¬å•ä½"></a>5.3 IOçš„åŸºæœ¬å•ä½</h2><p>å¯¹äºæ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œä¸€æ¬¡IOçš„åŸºæœ¬å•ä½æ˜¯4kbï¼Œä¹Ÿå°±æ˜¯8ä¸ªæ‰‡åŒº<code>8*512å­—èŠ‚</code></p><ul><li>ç£ç›˜çš„åŸºæœ¬å•ä½ï¼šæ‰‡åŒºï¼ˆä¸€èˆ¬ä¸º512å­—èŠ‚)</li><li>æ–‡ä»¶ç³»ç»Ÿè®¿é—®ç£ç›˜çš„åŸºæœ¬å•ä½ï¼š<code>4kb</code></li></ul><p>åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œä¼šå¯¹å‰é¢æåˆ°çš„é‚£ä¸ªâ€œæ•°ç»„â€è¿›ä¸€æ­¥æŠ½è±¡ï¼Œ8ä¸ªæ‰‡åŒºä¼šè¢«åˆå¹¶æˆä¸€ä¸ª<code>4KB</code>çš„åŒºå—ï¼Œç”¨äº<code>å•æ¬¡IO</code>ã€‚ä¸ºäº†æ–¹ä¾¿ç®¡ç†æ¯ä¸€ä¸ªåŒºå—ï¼Œåˆå°†å¤šä¸ªåŒºå—åˆå¹¶ï¼Œä½œä¸ºä¸€ä¸ª<strong>åˆ†åŒº</strong>è¿›è¡Œç®¡ç†</p><p>è¿™ä¾¿æ˜¯æˆ‘ä»¬ç”µè„‘ä¸ŠåŒä¸€å—ç‰©ç†ç¡¬ç›˜å¯ä»¥å¯¹åº”<strong>ä¸åŒåˆ†åŒº</strong>çš„æ¥æºäº†ï¼</p><hr><h3 id="ä¸ºä»€ä¹ˆï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆï¼Ÿ"></a>ä¸ºä»€ä¹ˆï¼Ÿ</h3><p>ä¸ºä»€ä¹ˆæ“ä½œç³»ç»Ÿè¦ä»¥4kbä½œä¸º<code>IO</code>çš„åŸºæœ¬å•ä½å‘¢ï¼Ÿ</p><blockquote><p><a class="link" target="_blank" rel="noopener" href="https://www.51cto.com/article/617936.html">https://www.51cto.com/article/617936.html<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>åœ¨ä¸Šæ–‡ä¸­æåˆ°ï¼ŒLinuxé€‰æ‹©4KBä½œä¸ºâ€œé¡µæ“ä½œâ€ï¼ˆå³è¯»å–å†…å­˜ï¼Œä»¥åŠä»å†…å­˜å†™å…¥ç£ç›˜ï¼‰çš„åŸºæœ¬å•ä½ç®—æ˜¯ä¸€ä¸ªå†å²é—ç•™é—®é¢˜äº†ã€‚</p><ul><li>è¿‡å°çš„é¡µå¤§å°ä¼šå¸¦æ¥è¾ƒå¤§çš„å¯»å€å¼€é”€</li><li>è¿‡å¤§çš„é¡µå¤§å°æµªè´¹å†…å­˜ç©ºé—´ï¼Œé€ æˆå†…å­˜ç¢ç‰‡</li></ul><p>è€Œå½“åˆè¿™ä¹ˆé€‰æ‹©ï¼Œè‚¯å®šæ˜¯æœ‰å…¶åŠŸç”¨çš„ï¼</p><ul><li>èƒ½æé«˜IOæ•ˆç‡ï¼Œä¸éœ€è¦å¤šæ¬¡å†™å…¥512å­—èŠ‚çš„æ•°æ®</li><li>ä¸è®©æ–‡ä»¶ç³»ç»Ÿçš„è®¾è®¡å’Œç£ç›˜æœ‰å¼ºç›¸å…³æ€§ï¼Œè§£è€¦åˆ</li></ul><p>å¯¹äºç¬¬äºŒç‚¹è¿›è¡Œè¯´æ˜ï¼Œå¦‚æœæ–‡ä»¶ç³»ç»Ÿä¸åœ¨æ‰‡åŒºå¤–é¢å¤–é€‰æ‹©ä¸€ä¸ªç©ºé—´ä½œä¸ºIOçš„åŸºæœ¬å•ä½ï¼Œé‚£ä¹ˆå…¶è®¾è®¡å¿…å®šä¼šä¾èµ–äº<strong>ç£ç›˜æ‰‡åŒºå¤§å°</strong>ã€‚</p><p>å¦‚æœæŸä¸€å¤©ï¼Œæ‰€æœ‰ç£ç›˜çš„æ‰‡åŒºå¤§å°éƒ½ä»512å­—èŠ‚å˜æˆäº†1024å­—èŠ‚ï¼Œé‚£å°±å¿…é¡»è¦<strong>ä¿®æ”¹æ“ä½œç³»ç»Ÿçš„æºç </strong>ï¼Œæ‰èƒ½æ­£ç¡®è®¿é—®æ–°çš„ç¡¬ç›˜ã€‚åŒæ—¶è¿˜éœ€è¦å¯¹æ—§ç›˜åšä¼˜åŒ–ï¼Œå¯è°“äº‹å€åŠŸåŠã€‚</p><p>è€Œæå‰è®¾å®šå¥½ä¸€ä¸ªæ›´å¤§çš„IOåŸºæœ¬å•ä½ï¼Œä¾¿æ˜¯é¿å…äº†ç£ç›˜å˜åŠ¨è€Œé€ æˆçš„æ— æ³•è®¿é—®ã€‚æœ‰äº†è¿™ä¸ªæ›´å¤§çš„IOåŸºæœ¬å•ä½ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠç£ç›˜çš„æ‰‡åŒºç»„æˆä¸€ä¸ª4kbå¤§å°çš„ç©ºé—´è¿›è¡ŒIOï¼Œä¸ç”¨ç®¡å…¶ç£ç›˜æ‰‡åŒºå¤§å°åˆ°åº•æ˜¯å¤šå°‘äº†ã€‚</p><blockquote><p>å½“ç„¶ï¼Œå¦‚æœå“ªå¤©æ‰‡åŒºå¤§å°å¤§äº4kbäº†ï¼Œææ€•å°±å¾—æ”¹æºç äº†ï¼Ÿ</p><p>è¿™éƒ¨åˆ†æˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ‡‚å‘¢ï¼Œä»¥ä¸Šåªæ˜¯ä¸ªäººæµ…æ˜¾çš„ç†è§£</p></blockquote><hr><h2 id="5-4-ç³»ç»Ÿç»“æ„"><a href="#5-4-ç³»ç»Ÿç»“æ„" class="headerlink" title="5.4 ç³»ç»Ÿç»“æ„"></a>5.4 ç³»ç»Ÿç»“æ„</h2><p>ä¸‹å›¾å‘æˆ‘ä»¬å±•ç¤ºäº†ä¸€ä¸ªç£ç›˜æ˜¯å¦‚ä½•è¢«æ–‡ä»¶ç³»ç»Ÿâ€œæ‹†åˆ†â€çš„</p><p>é¦–å…ˆæ˜¯åˆ†åŒºï¼Œæ¯ä¸€ä¸ªåˆ†åŒºéƒ½æœ‰ä¸€ä¸ª<code>BootSector</code>å’Œæ–‡ä»¶ç³»ç»Ÿã€‚æˆ‘ä»¬ä¸»è¦å…³æ³¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå•ä¸ª<code>Block Group</code>é‡Œé¢çš„å†…å®¹</p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202211021025226.png" alt="image-20221102102453953"></p><p>linuxé‡‡ç”¨çš„æ˜¯æ–‡ä»¶å†…å®¹ã€æ–‡ä»¶å±æ€§åˆ†å¼€å­˜æ”¾çš„å­˜å‚¨æ–¹å¼</p><ul><li>æ–‡ä»¶çš„å±æ€§æ˜¯ç¨³å®šçš„</li><li>æ–‡ä»¶çš„å†…å®¹åœ¨ä¸æ–­å¢å¤š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data blocksï¼šä¿å­˜æ•°æ®å†…å®¹</span><br><span class="line">inode tableï¼šä¿å­˜æ–‡ä»¶çš„inode</span><br><span class="line">inode bitmapï¼šä½å›¾ç»“æ„ï¼ŒæŒ‡ç¤ºinodeæ˜¯å¦è¢«ä½¿ç”¨</span><br><span class="line">GDTï¼šå…¨ç§°group descriptor tableï¼Œä¿å­˜äº†inodeä¸ªæ•°ã€èµ·å§‹inodeç¼–å·ã€å¤šå°‘inodeè¢«ä½¿ç”¨ã€å¤šå°‘data blocksè¢«ä½¿ç”¨â€¦â€¦</span><br><span class="line">Super Blocksï¼šè¯¥Block Groupæ–‡ä»¶ç³»ç»Ÿçš„é¡¶å±‚æ•°æ®ç»“æ„</span><br></pre></td></tr></table></figure><h3 id="inode"><a href="#inode" class="headerlink" title="inode"></a>inode</h3><p>è¿™é‡Œæåˆ°çš„<code>inode</code>æ˜¯linuxä¸‹æ¯ä¸€ä¸ªæ–‡ä»¶çš„ç‹¬ç«‹ç¼–å·ã€‚linuxå¹¶ä¸ä»¥æ–‡ä»¶åæ¥è¯†åˆ«æ–‡ä»¶ï¼Œè€Œæ˜¯ç”¨æ–‡ä»¶ç¼–å·æ¥è¯†åˆ«å”¯ä¸€çš„æ–‡ä»¶çš„ã€‚</p><p>inodeä¿å­˜äº†ä¸€ä¸ªæ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯</p><ul><li>æ–‡ä»¶çš„å±æ€§</li><li>rwxæƒé™</li><li>æ‰€å±ç”¨æˆ·ã€æ‰€å±ç»„</li><li>ç¡¬é“¾æ¥ä¸ªæ•°</li><li>æ–‡ä»¶è®¿é—®ã€ä¿®æ”¹ã€åˆ›å»ºçš„æ—¶é—´</li><li>æŒ‡å‘<code>data blocks</code>ä¸­æ–‡ä»¶çš„å†…å®¹</li></ul><blockquote><p><code>struct inode</code>çš„ä½ç½®åœ¨<code>/include/linux/fs.h</code></p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202211021502761.png" alt="image-20221102150228669"></p></blockquote><p>æŸ¥çœ‹inodeç¼–å·çš„æ–¹æ³•ä¸º<code>ls -i</code>ï¼Œå…¶ä¸­è¿™ä¸²æ•°å­—ä¾¿æ˜¯è¯¥æ–‡ä»¶çš„inodeç¼–å·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-31_stdout_err]$ <span class="built_in">ls</span> -i</span><br><span class="line">1453833 makefile  1453832 test.cpp</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œ<code>.å’Œ..</code>è¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹ä¹Ÿæ˜¯æœ‰è‡ªå·±çš„inodeç¼–å·çš„ï¼Œå°è¯äº†linuxä¸‹ä¸€åˆ‡çš†æ–‡ä»¶ï¼ŒåŒ…æ‹¬ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-31_stdout_err]$ <span class="built_in">ls</span> -ila</span><br><span class="line">total 16</span><br><span class="line">1453831 drwxrwxr-x  2 muxue muxue 4096 Nov  2 09:58 .</span><br><span class="line">1443736 drwxrwxr-x 16 muxue muxue 4096 Nov  2 09:20 ..</span><br><span class="line">1453833 -rw-rw-r--  1 muxue muxue   81 Nov  2 09:58 makefile</span><br><span class="line">1453832 -rw-rw-r--  1 muxue muxue  437 Nov  2 09:35 test.cpp</span><br></pre></td></tr></table></figure><h3 id="statå‘½ä»¤"><a href="#statå‘½ä»¤" class="headerlink" title="statå‘½ä»¤"></a>statå‘½ä»¤</h3><p>è¿˜å¯ä»¥ç”¨statå‘½ä»¤æ¥æŸ¥çœ‹å•ä¸ªæ–‡ä»¶çš„inodeä¿¡æ¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt<span class="number">-7274</span>:~/git/linux/code/<span class="number">22</span><span class="number">-10</span><span class="number">-31</span>_stdout_err]$ stat test.cpp</span><br><span class="line">  File: â€˜test.cppâ€™</span><br><span class="line">  Size: <span class="number">437</span>             Blocks: <span class="number">8</span>          IO Block: <span class="number">4096</span>   regular file</span><br><span class="line">Device: fd01h/<span class="number">64769</span>d    Inode: <span class="number">1453832</span>     Links: <span class="number">1</span></span><br><span class="line">Access: (<span class="number">0664</span>/-rw-rw-r--)  Uid: ( <span class="number">1001</span>/   muxue)   Gid: ( <span class="number">1001</span>/   muxue)</span><br><span class="line">Access: <span class="number">2022</span><span class="number">-11</span><span class="number">-02</span> <span class="number">09</span>:<span class="number">35</span>:<span class="number">07.684160444</span> +<span class="number">0800</span></span><br><span class="line">Modify: <span class="number">2022</span><span class="number">-11</span><span class="number">-02</span> <span class="number">09</span>:<span class="number">35</span>:<span class="number">04.328161202</span> +<span class="number">0800</span></span><br><span class="line">Change: <span class="number">2022</span><span class="number">-11</span><span class="number">-02</span> <span class="number">09</span>:<span class="number">35</span>:<span class="number">04.328161202</span> +<span class="number">0800</span></span><br><span class="line"> Birth: -</span><br></pre></td></tr></table></figure><p>inodeå†…éƒ¨æœ‰ä¸€ä¸ªç»“æ„ï¼ŒæŒ‡å‘<code>data blocks</code>ã€‚å‰é¢æåˆ°è¿‡ï¼Œæ–‡ä»¶ç³»ç»ŸIOçš„åŸºæœ¬å•ä½æ˜¯4KBï¼Œå¯¹åº”çš„ï¼Œä¸€ä¸ªblocksçš„å¤§å°å°±æ˜¯4KB</p><p>æ¯ä¸€ä¸ªæ–‡ä»¶éƒ½å¯¹åº”ä¸€ä¸ªinodeï¼Œè‡³å°‘å¯¹åº”ä¸€ä¸ªdata blocksï¼ˆinodeä¸­å‚¨å­˜äº†blocksç¼–å·ï¼‰</p><p>å› ä¸ºinodeæ‰€èƒ½ä¿å­˜çš„ç¼–å·æœ‰é™ï¼Œæ‰€ä»¥å¯¹data blocksçš„ä¿å­˜åˆ†ä¸ºä¸¤ç§æƒ…å†µ</p><ol><li>éƒ¨åˆ†data blocksç›´æ¥ä¿å­˜äº†æ–‡ä»¶çš„å†…å®¹ã€‚å¦‚æœæ˜¯å°æ–‡ä»¶ï¼Œinodeä¸­ä¿å­˜çš„blockå°±è¶³å¤Ÿå­˜ä¸‹æ‰€æœ‰æ–‡ä»¶å†…å®¹äº†</li><li>å¦‚æœæ˜¯å¤§æ–‡ä»¶ï¼Œinodeä¸­ä¸€éƒ¨åˆ†blocksä¼šç”¨æ¥ä¿å­˜è¯¥æ–‡ä»¶å‰©ä½™<code>data blocks</code>çš„ç¼–å·</li></ol><p>åœ¨å†…æ ¸ä¸­ï¼Œæ–‡ä»¶ç³»ç»Ÿä¼šå¯¹è¿™ä¸¤ç§æƒ…å†µè¿›è¡ŒåŒºåˆ†</p><p><font color="Red">æ³¨æ„</font></p><ul><li>å› ä¸ºæ¯ä¸€ä¸ªæ–‡ä»¶éƒ½è‚¯å®šæœ‰ä¸€ä¸ªinodeä¸ä¹‹å¯¹åº”ï¼Œæ‰€ä»¥åˆ›å»ºç©ºæ–‡ä»¶ä¹Ÿæ˜¯å ç”¨ç£ç›˜ç©ºé—´çš„</li><li>å¯èƒ½ä¼šå‡ºç°inodeè¢«ç”¨å®Œäº†ï¼Œç£ç›˜ç©ºé—´å´æ²¡æœ‰æ»¡çš„æƒ…å†µã€‚ä½†è¿™æ—¶å€™ä¹Ÿå·²ç»æ— æ³•åˆ›å»ºæ–°æ–‡ä»¶äº†</li></ul><p>ğŸ˜‚ä½ å¯ä»¥å°è¯•å†™ä¸€ä¸ªwhile1å¾ªç¯ï¼Œä¸æ–­å¾€ç³»ç»Ÿä¸­åˆ›å»ºæ–°æ–‡ä»¶ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½è¾¾åˆ°è¿™ä¸ªä¸´ç•Œå€¼ï¼ˆå’³å’³ï¼Œè™½ç„¶å¥½ç©ï¼Œä½†<strong>å¹¶ä¸æ¨è</strong>ä½ è¿™ä¹ˆåšï¼‰</p><hr><h3 id="æ–‡ä»¶åå­˜åœ¨å“ªå„¿ï¼Ÿ"><a href="#æ–‡ä»¶åå­˜åœ¨å“ªå„¿ï¼Ÿ" class="headerlink" title="æ–‡ä»¶åå­˜åœ¨å“ªå„¿ï¼Ÿ"></a>æ–‡ä»¶åå­˜åœ¨å“ªå„¿ï¼Ÿ</h3><p>å‰é¢æåˆ°è¿‡ï¼Œinodeä¿å­˜äº†æ–‡ä»¶çš„å±æ€§ï¼Œæ–‡ä»¶åæ˜¯å¦ä¸ºæ–‡ä»¶çš„å±æ€§å‘¢ï¼Ÿä¹Ÿç®—ï¼</p><p>ä½†inodeä¸­å¹¶ä¸ä¿å­˜æ–‡ä»¶åå­—ï¼</p><p>å®é™…ä¸Šï¼Œæ–‡ä»¶åæ˜¯å­˜åœ¨è¯¥æ–‡ä»¶æ‰€åœ¨<strong>ç›®å½•çš„æ–‡ä»¶å†…å®¹</strong>ä¸­çš„</p><blockquote><p>ç›®å½•ä¹Ÿæ˜¯æ–‡ä»¶ï¼Œæ–‡ä»¶å°±æœ‰æ–‡ä»¶å±æ€§+æ–‡ä»¶å†…å®¹</p></blockquote><p>å¯ä»¥ç†è§£ä¸ºï¼Œç›®å½•çš„å†…å®¹ä¿å­˜çš„æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œå…¶ä¸­keyä¸ºæ–‡ä»¶åï¼Œvalueä¸ºinodeç¼–å·</p><p>è¿™ä¾¿æ˜¯ä¸ºä½•ä¸€ä¸ªç›®å½•ä¸­<strong>ä¸èƒ½å‡ºç°åŒåæ–‡ä»¶</strong>ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸æ”¯æŒé”®å€¼å†—ä½™çš„<code>map(cpp-stl)</code></p><h3 id="ç›®å½•æƒé™"><a href="#ç›®å½•æƒé™" class="headerlink" title="ç›®å½•æƒé™"></a>ç›®å½•æƒé™</h3><p>æ—¢ç„¶ç›®å½•ä¹Ÿæ˜¯æ–‡ä»¶ï¼Œé‚£ä¹ˆå®ƒå°±ä¹Ÿæœ‰è‡ªå·±çš„æ–‡ä»¶æƒé™</p><blockquote><p><a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/muxuen/article/details/125776348">https://blog.csdn.net/muxuen/article/details/125776348<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>åœ¨æˆ‘ä¹‹å‰å…³äºlinuxæ–‡ä»¶æƒé™çš„è®²è§£ä¸­ï¼Œå°±æåˆ°äº†å’Œç›®å½•æœ‰å…³çš„æƒé™é—®é¢˜</p><ul><li>è¿›å…¥ç›®å½•éœ€è¦xæƒé™</li><li>åˆ›å»ºæ–‡ä»¶éœ€è¦wæƒé™</li><li>æŸ¥çœ‹æ–‡ä»¶åéœ€è¦ræƒé™</li></ul><p>äº†è§£æ–‡ä»¶ç³»ç»Ÿäº†ä¹‹åï¼Œç°åœ¨æˆ‘ä»¬çŸ¥é“ä¸ºä»€ä¹ˆç›®å½•çš„æ“ä½œéœ€è¦è¿™äº›æƒé™äº†ã€‚åœ¨ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶ï¼Œæœ¬è´¨å°±æ˜¯åœ¨ä¿®æ”¹ç›®å½•æ‰€å¯¹åº”çš„<strong>æ–‡ä»¶å†…å®¹</strong>ï¼</p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202211021535708.jpg" alt="QQå›¾ç‰‡20220424132540"></p><h2 id="5-5-åˆ›å»º-x2F-åˆ é™¤æ–‡ä»¶"><a href="#5-5-åˆ›å»º-x2F-åˆ é™¤æ–‡ä»¶" class="headerlink" title="5.5 åˆ›å»º&#x2F;åˆ é™¤æ–‡ä»¶"></a>5.5 åˆ›å»º&#x2F;åˆ é™¤æ–‡ä»¶</h2><p>å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œæ–‡ä»¶ç³»ç»Ÿåšäº†ä»€ä¹ˆæï¼Ÿ</p><ul><li>åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ç»“æ„ä½“ï¼Œå’Œå¯¹åº”çš„inodeç¼–å·</li><li>æ ¹æ®ç›®å½•çš„inodeï¼Œæ‰¾åˆ°è¯¥ç›®å½•çš„data blocks</li><li>å°†æ–‡ä»¶åå’Œinodeç¼–å·çš„å¯¹åº”å…³ç³»å†™å…¥åˆ°ç›®å½•çš„æ•°æ®å—ä¸­</li></ul><p>å½“æˆ‘ä»¬åˆ é™¤ä¸€ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼š</p><ul><li>æ“ä½œç³»ç»Ÿåªéœ€è¦åˆ é™¤å½“å‰ç›®å½•ä¸‹inodeå’Œæ–‡ä»¶åçš„å¯¹åº”å…³ç³»</li><li>åŒæ—¶åœ¨inode bitmapä¸­å°†å¯¹åº”çš„inodeç½®ä¸º0ï¼ˆä»£è¡¨æ²¡æœ‰ä½¿ç”¨ï¼‰</li></ul><p>è¿™æ ·å°±ç®—æ˜¯åˆ é™¤è¯¥æ–‡ä»¶äº†ï¼å¥½æ¯”æˆ‘ä»¬æ“ä½œçº¿æ€§è¡¨è¿›è¡Œå°¾åˆ æ“ä½œï¼Œåªæ˜¯å¯¹<code>size-1</code>ï¼Œå¹¶æ²¡æœ‰çœŸçš„æŠŠè¯¥ä½ç½®çš„æ•°æ®åˆ é™¤</p><ul><li>è¿™ä¾¿èƒ½è§£é‡Šä¸ºä»€ä¹ˆå¤åˆ¶ç²˜è´´ä¸€ä¸ªæ–‡ä»¶çš„é€Ÿåº¦è¿œæ…¢äºåˆ é™¤æ–‡ä»¶çš„é€Ÿåº¦</li><li>å› ä¸ºæ²¡æœ‰å°†æ–‡ä»¶çš„inodeå’Œdata blockæ¸…ç©ºï¼Œæ‰€ä»¥ç»™æˆ‘ä»¬<code>æ¢å¤æ•°æ®</code>å¸¦æ¥äº†å¯èƒ½ã€‚åªè¦è¯¥æ–‡ä»¶ä¹‹å‰ä½¿ç”¨çš„<code>inode/data block</code>å¹¶æ²¡æœ‰è¢«å¤å†™ï¼Œæˆ‘ä»¬å°±æœ‰å¯èƒ½è¿˜åŸå‡ºè¯¥æ–‡ä»¶çš„æ•°æ®ï¼</li></ul><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202211021557390.jpg" alt="å¥½å¾—å¾ˆ"></p><h1 id="6-è½¯ç¡¬é“¾æ¥"><a href="#6-è½¯ç¡¬é“¾æ¥" class="headerlink" title="6.è½¯ç¡¬é“¾æ¥"></a>6.è½¯ç¡¬é“¾æ¥</h1><p>åœ¨æœ€åˆå­¦ä¹ linuxå‘½ä»¤è¡Œçš„æ—¶å€™ï¼Œå°±å·²ç»å­¦ä¹ è¿‡äº†<code>ln</code>åˆ›å»ºæ–‡ä»¶é“¾æ¥çš„æ“ä½œ</p><blockquote><p>è¿™éƒ¨åˆ†æˆ‘æ²¡æœ‰å†™åšå®¢ï¼Œå› ä¸ºç½‘ä¸Šçš„æ•™ç¨‹å®åœ¨æ˜¯å¤ªå¤šå•¦</p></blockquote><p>ä½†æ˜¯å½“æ—¶å¹¶ä¸çŸ¥é“<code>è½¯é“¾æ¥/ç¡¬é“¾æ¥</code>åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå­¦ä¹ äº†æ–‡ä»¶ç³»ç»Ÿä¹‹åï¼Œå›å¤´å†æ¥çœ‹çœ‹</p><hr><h2 id="6-1-æŸ¥çœ‹æ–‡ä»¶ç¡¬é“¾æ¥ä¸ªæ•°"><a href="#6-1-æŸ¥çœ‹æ–‡ä»¶ç¡¬é“¾æ¥ä¸ªæ•°" class="headerlink" title="6.1 æŸ¥çœ‹æ–‡ä»¶ç¡¬é“¾æ¥ä¸ªæ•°"></a>6.1 æŸ¥çœ‹æ–‡ä»¶ç¡¬é“¾æ¥ä¸ªæ•°</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -li</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬æ‰§è¡Œä¸Šé¢è¿™ä¸ªå‘½ä»¤çš„æ—¶å€™ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸€ä¸ªæ–‡ä»¶çš„å®Œæ•´å±æ€§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-31_stdout_err]$ <span class="built_in">ls</span> -lia</span><br><span class="line">total 16</span><br><span class="line">1453831 drwxrwxr-x  2 muxue muxue 4096 Nov  2 09:58 .</span><br><span class="line">1443736 drwxrwxr-x 16 muxue muxue 4096 Nov  2 09:20 ..</span><br><span class="line">1453833 -rw-rw-r--  1 muxue muxue   81 Nov  2 09:58 makefile</span><br><span class="line">1453832 -rw-rw-r--  1 muxue muxue  437 Nov  2 09:35 test.cpp</span><br></pre></td></tr></table></figure><p>å¯ä¹‹å‰ä¸€ç›´æ²¡æœ‰å»äº†è§£ï¼Œè¿™ä¸ªç¬¬ä¸‰åˆ—çš„<code>2 16 1 1</code>åˆ°åº•æ˜¯ä»€ä¹ˆç©æ„å‘¢ï¼Ÿ</p><p>ä¸å–å…³å­ï¼Œå‰é¢æåˆ°inodeä¼šä¿å­˜æ–‡ä»¶çš„ç¡¬é“¾æ¥ä¸ªæ•°ï¼Œç¬¬ä¸‰åˆ—çš„æ•°å­—ï¼Œä»£è¡¨çš„ä¾¿æ˜¯è¯¥æ–‡ä»¶çš„ç¡¬é“¾æ¥ä¸ªæ•°ï¼</p><p>è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ï¼Œå’Œä¸€ä¸ªæ–°çš„æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-31_stdout_err]$ <span class="built_in">mkdir</span> test_r</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-31_stdout_err]$ <span class="built_in">touch</span> test_f</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-31_stdout_err]$ <span class="built_in">ls</span> -li</span><br><span class="line">total 12</span><br><span class="line">1453833 -rw-rw-r-- 1 muxue muxue   81 Nov  2 09:58 makefile</span><br><span class="line">1453832 -rw-rw-r-- 1 muxue muxue  437 Nov  2 09:35 test.cpp</span><br><span class="line">1453836 -rw-rw-r-- 1 muxue muxue    0 Nov  2 16:07 test_f</span><br><span class="line">1449813 drwxrwxr-x 2 muxue muxue 4096 Nov  2 16:07 test_r</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-10-31_stdout_err]$ </span><br></pre></td></tr></table></figure><p>ä½ ä¼šå‘ç°ï¼Œæ–‡ä»¶å¤¹é»˜è®¤çš„ç¡¬é“¾æ¥æ•°æ˜¯2ï¼Œè€Œæ–‡ä»¶é»˜è®¤çš„ç¡¬é“¾æ¥æ•°æ˜¯1</p><h3 id="ä¸ºä»€ä¹ˆï¼Ÿ-1"><a href="#ä¸ºä»€ä¹ˆï¼Ÿ-1" class="headerlink" title="ä¸ºä»€ä¹ˆï¼Ÿ"></a>ä¸ºä»€ä¹ˆï¼Ÿ</h3><p>å½“æˆ‘ä»¬cdè¿›å…¥ç›®å½•çš„æ—¶å€™ï¼Œlinuxä¾¿ä¼šæ‰¾åˆ°åº•å±‚çš„inodeï¼Œè¿›å…¥è¯¥inodeæ‰€å¯¹åº”çš„æ–‡ä»¶ä¸­ã€‚</p><p>å¦‚æœæƒ³çŸ¥é“ä¸€ä¸ªç›®å½•çš„ç›®å½•åï¼Œæˆ‘ä»¬å¿…é¡»è¦å»è¯¥ç›®å½•çš„<strong>ä¸Šçº§</strong>æ‰¾ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿æŸ¥æ‰¾å½“å‰ç›®å½•ä»¥åŠå…¶ä¸Šçº§ç›®å½•çš„inodeï¼Œæ¯ä¸€ä¸ªç›®å½•ä¸‹é¢ï¼Œé»˜è®¤éƒ½ä¼šæœ‰<code>..å’Œ.</code>è¿™ä¸¤ä¸ªç›®å½•æ–‡ä»¶ï¼</p><p>è¿›å…¥åˆšåˆšæˆ‘ä»¬æ–°åˆ›çš„æ–‡ä»¶å¤¹çœ‹çœ‹ï¼Œä½ ä¼šå‘ç°ï¼Œ<code>.</code>æ–‡ä»¶çš„inodeå°±æ˜¯è¯¥æ–‡ä»¶å¤¹çš„inodeï¼</p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202211021609412.png" alt="image-20221102160940330"></p><p>ä»è¿™é‡Œä¾¿å¼•å‡ºäº†è½¯è¿æ¥å’Œç¡¬é“¾æ¥çš„åŒºåˆ«</p><h2 id="6-2-è½¯ç¡¬é“¾æ¥åŒºåˆ«"><a href="#6-2-è½¯ç¡¬é“¾æ¥åŒºåˆ«" class="headerlink" title="6.2 è½¯ç¡¬é“¾æ¥åŒºåˆ«"></a>6.2 è½¯ç¡¬é“¾æ¥åŒºåˆ«</h2><p>è¿™é‡Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªæ–°æ–‡ä»¶å¤¹ï¼Œåœ¨é‡Œé¢åˆ›å»ºäº†ä¸€ä¸ª<code>test.c</code>æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-01_è½¯ç¡¬é“¾æ¥]$ <span class="built_in">ls</span> -li</span><br><span class="line">total 4</span><br><span class="line">1453842 -rw-rw-r-- 1 muxue muxue 78 Nov  2 16:13 test.c</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-01_è½¯ç¡¬é“¾æ¥]$ </span><br></pre></td></tr></table></figure><p>åŒæ—¶å¯¹è¯¥æ–‡ä»¶å¤¹åˆ›å»ºä¸€ä¸ªç¡¬é“¾æ¥å’Œè½¯è¿æ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s æº ç›®æ ‡ <span class="comment">#åˆ›å»ºè½¯è¿æ¥</span></span><br><span class="line"><span class="built_in">ln</span> æº ç›®æ ‡ <span class="comment">#åˆ›å»ºç¡¬é“¾æ¥</span></span><br></pre></td></tr></table></figure><p>åº·åº·ç»“æœğŸ‘‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-01_è½¯ç¡¬é“¾æ¥]$ <span class="built_in">ln</span> -s test.c testSoft.c</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-01_è½¯ç¡¬é“¾æ¥]$ <span class="built_in">ls</span> -li</span><br><span class="line">total 4</span><br><span class="line">1453842 -rw-rw-r-- 1 muxue muxue 78 Nov  2 16:13 test.c</span><br><span class="line">1453843 lrwxrwxrwx 1 muxue muxue  6 Nov  2 16:14 testSoft.c -&gt; test.c</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-01_è½¯ç¡¬é“¾æ¥]$ <span class="built_in">ln</span> test.c testHard.c</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-01_è½¯ç¡¬é“¾æ¥]$ <span class="built_in">ls</span> -li</span><br><span class="line">total 8</span><br><span class="line">1453842 -rw-rw-r-- 2 muxue muxue 78 Nov  2 16:13 test.c</span><br><span class="line">1453842 -rw-rw-r-- 2 muxue muxue 78 Nov  2 16:13 testHard.c</span><br><span class="line">1453843 lrwxrwxrwx 1 muxue muxue  6 Nov  2 16:14 testSoft.c -&gt; test.c</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-01_è½¯ç¡¬é“¾æ¥]$ </span><br></pre></td></tr></table></figure><p>ä½ èƒ½çœ‹å‡ºåŒºåˆ«å—ï¼Ÿ</p><ul><li>è½¯é“¾æ¥çš„inodeå’Œæºæ–‡ä»¶ä¸ç›¸åŒï¼Œæ˜¯ä¸€ä¸ªå…¨æ–°çš„æ–‡ä»¶</li><li>ç¡¬é“¾æ¥çš„inodeå’Œæºæ–‡ä»¶ç›¸åŒï¼åŒæ—¶å®ƒä»¬çš„ç¡¬é“¾æ¥æ•°+1</li></ul><p>æŠŠè¿™äº›æ–‡ä»¶éƒ½ä»¥æŒ‡é’ˆç†è§£ï¼Œä¼šæ›´æ–¹ä¾¿ä¸€äº›</p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202211021631401.png" alt="image-20221102163102293"></p><ul><li>è½¯è¿æ¥çš„æ–‡ä»¶å†…å®¹æ˜¯æ‰€æŒ‡å‘æ–‡ä»¶çš„è·¯å¾„</li><li>ç¡¬é“¾æ¥åªæ˜¯åœ¨å½“å‰ç›®å½•ä¸‹æ–°å¢æ–‡ä»¶åå’Œinodeç¼–å·çš„<strong>æ˜ å°„å…³ç³»</strong>ï¼Œå¹¶å¯¹inodeä¸­ç¡¬é“¾æ¥ä¸ªæ•°+1</li></ul><p>å¦‚æœæˆ‘ä»¬åˆ é™¤äº†<code>test.c</code>ï¼Œè½¯è¿æ¥å°±ä¼šå¤±æ•ˆï¼Œä½†ç¡¬é“¾æ¥å¹¶ä¸ä¼šï¼Œå› ä¸ºç¡¬é“¾æ¥æœ¬èº«å’Œ<code>test.c</code>æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼</p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202211021623566.png" alt="image-20221102162339477"></p><p>è€Œinodeä¸­å¯¹ç¡¬é“¾æ¥çš„è®¡æ•°ï¼Œå°±å¥½æ¯”C++ä¸­æ™ºèƒ½æŒ‡é’ˆçš„å¼•ç”¨è®¡æ•°ï¼Œå¦‚æœè¯¥è®¡æ•°ä¸º0ï¼Œå°±ä»£è¡¨è¿™ä¸ªæ–‡ä»¶éœ€è¦åˆ é™¤äº†ï¼</p><hr><h3 id="è§£ç­”ï¼"><a href="#è§£ç­”ï¼" class="headerlink" title="è§£ç­”ï¼"></a>è§£ç­”ï¼</h3><p>çŸ¥é“äº†åŒºåˆ«ï¼Œæˆ‘ä»¬ä¹Ÿä¾¿çŸ¥é“ä¸ºä½•ä¸€ä¸ªæ–°ç›®å½•çš„<strong>é»˜è®¤ç¡¬é“¾æ¥ä¸ªæ•°æ˜¯2</strong>äº†ï¼Œå…¶ä¾¿æ˜¯æ¯ä¸€ä¸ªç›®å½•éƒ½é»˜è®¤å¸¦çš„<code>.</code>æ–‡ä»¶ï¼Œç”¨äºæ ‡è¯†å½“å‰ç›®å½•çš„inodeï¼›å¦å¤–ä¸€ä¸ªæ˜¯è¯¥æ–‡ä»¶æœ¬èº«</p><ul><li>æ¯ä¸€ä¸ªæ–°åˆ›å»ºçš„æ–‡ä»¶ï¼Œé»˜è®¤éƒ½å’Œè‡ªå·±æ˜ å°„ï¼Œæ‰€ä»¥ç¡¬é“¾æ¥ä¸ªæ•°ä¸º1</li></ul><p>åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡<code>..</code>æ–‡ä»¶çš„ç¡¬é“¾æ¥ä¸ªæ•°ï¼Œå¿«é€ŸçŸ¥é“ä¸Šçº§ç›®å½•ä¸­æœ‰å¤šå°‘ä¸ªæ–‡ä»¶å¤¹ï¼ˆé™¤å»é»˜è®¤çš„<code>.å’Œ..</code>ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ä¸Šçº§ç›®å½•å†…çš„æ–‡ä»¶å¤¹ä¸ªæ•° = å½“å‰ç›®å½•..æ–‡ä»¶çš„ç¡¬é“¾æ¥ä¸ªæ•° - 2</span><br><span class="line">æŸä¸€ä¸ªç›®å½•å†…çš„æ–‡ä»¶å¤¹ä¸ªæ•° = è¯¥ç›®å½•..æ–‡ä»¶çš„ç¡¬é“¾æ¥ä¸ªæ•° - 2</span><br></pre></td></tr></table></figure><h2 id="6-3-unlinkå‘½ä»¤"><a href="#6-3-unlinkå‘½ä»¤" class="headerlink" title="6.3 unlinkå‘½ä»¤"></a>6.3 unlinkå‘½ä»¤</h2><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡unlinkå‘½ä»¤æ¥å–æ¶ˆé“¾æ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-01_è½¯ç¡¬é“¾æ¥]$ <span class="built_in">ls</span></span><br><span class="line">testHard.c  testSoft.c</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-01_è½¯ç¡¬é“¾æ¥]$ <span class="built_in">unlink</span> testSoft.c</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-01_è½¯ç¡¬é“¾æ¥]$ <span class="built_in">ls</span> -lia</span><br><span class="line">total 12</span><br><span class="line">1453838 drwxrwxr-x  2 muxue muxue 4096 Nov  2 16:39 .</span><br><span class="line">1443736 drwxrwxr-x 17 muxue muxue 4096 Nov  2 16:12 ..</span><br><span class="line">1453842 -rw-rw-r--  1 muxue muxue   78 Nov  2 16:13 testHard.c</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-01_è½¯ç¡¬é“¾æ¥]$ </span><br></pre></td></tr></table></figure><p>unlinkä¹Ÿå¯ä»¥ç”¨æ¥åˆ é™¤æ­£å¸¸æ–‡ä»¶ï¼Œä½†ä¸€èˆ¬åªç”¨å®ƒæ¥åˆ é™¤é“¾æ¥æ–‡ä»¶ï¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-01_è½¯ç¡¬é“¾æ¥]$ <span class="built_in">ls</span> -lia</span><br><span class="line">total 12</span><br><span class="line">1453838 drwxrwxr-x  2 muxue muxue 4096 Nov  2 16:39 .</span><br><span class="line">1443736 drwxrwxr-x 17 muxue muxue 4096 Nov  2 16:12 ..</span><br><span class="line">1453842 -rw-rw-r--  1 muxue muxue   78 Nov  2 16:13 testHard.c</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-01_è½¯ç¡¬é“¾æ¥]$ <span class="built_in">unlink</span> testHard.c</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-01_è½¯ç¡¬é“¾æ¥]$ <span class="built_in">ls</span> -lia</span><br><span class="line">total 8</span><br><span class="line">1453838 drwxrwxr-x  2 muxue muxue 4096 Nov  2 16:40 .</span><br><span class="line">1443736 drwxrwxr-x 17 muxue muxue 4096 Nov  2 16:12 ..</span><br></pre></td></tr></table></figure><hr><h1 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h1><p>linuxæ–‡ä»¶ç³»ç»Ÿçš„å†…å®¹ï¼Œåˆ°è¿™é‡Œå°±overè¾£ï¼åç»­å¦‚æœæœ‰ä»€ä¹ˆæ–°å¢çŸ¥è¯†ï¼Œä¼šæ¥è¿™é‡Œæ·»åŠ ï¼</p><p><img lazyload alt="image" data-src="https://img1.musnow.top/i/23/02/202211021643449.gif" alt="QQå›¾ç‰‡20220520121536"></p><p>æ„Ÿè°¢ä½ çœ‹åˆ°æœ€åï¼Œå¦‚æœæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå¯ä»¥åœ¨è¯„è®ºåŒºæå‡ºå“¦</p></div><div class="post-copyright-info"><div class="article-copyright-info-container"><ul class="copyright-info-content"><li class="post-title"><span class="type">æœ¬æ–‡æ ‡é¢˜</span>ï¼š<span class="content">ã€Linuxã€‘æ–‡ä»¶IO</span></li><li class="post-author"><span class="type">æœ¬æ–‡ä½œè€…</span>ï¼š<span class="content">æ…•é›ªå¹´å</span></li><li class="post-time"><span class="type">åˆ›å»ºæ—¶é—´</span>ï¼š<span class="content">2022-11-01 20:40:16</span></li><li class="post-link"><span class="type">æœ¬æ–‡é“¾æ¥</span>ï¼š<span class="content">2022/11/01/Linux/14æ–‡ä»¶IO/</span></li><li class="post-license"><span class="type">ç‰ˆæƒå£°æ˜</span>ï¼š<span class="content">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</span></li></ul><div class="copy-copyright-info flex-center tooltip" data-content="å¤åˆ¶ç‰ˆæƒä¿¡æ¯" data-offset-y="-2px"><i class="fa-solid fa-copy"></i></div></div></div><ul class="post-tags-box"><li class="tag-item"><a href="/tags/Linux/">#Linux</a>&nbsp;</li><li class="tag-item"><a href="/tags/%E6%96%87%E4%BB%B6/">#æ–‡ä»¶</a>&nbsp;</li></ul><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/2022/11/03/Linux/15%E5%8A%A8%E9%9D%99%E6%80%81%E5%BA%93/"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item">ã€Linuxã€‘åŠ¨é™æ€åº“</span> <span class="post-nav-item">ä¸Šä¸€ç¯‡</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/2022/10/22/cpp/24%E6%96%87%E4%BB%B6io%E6%93%8D%E4%BD%9C/"><span class="title flex-center"><span class="post-nav-title-item">ã€C++ã€‘æ–‡ä»¶IOæµ</span> <span class="post-nav-item">ä¸‹ä¸€ç¯‡</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div><div class="comment-container"><div class="comments-container"><div id="comments-anchor"></div><div class="comment-area-title"><i class="fas fa-comments"></i>&nbsp;è¯„è®º</div><div class="waline-comment-container"><link rel="stylesheet" href="/css/my/waline.css"><link rel="stylesheet" href="/css/my/waline-meta.css"><script data-pjax src="/css/my/waline.js"></script><div id="waline-comment"></div><script data-pjax>function loadWaline() {
            Waline.init({
              el: '#waline-comment',
              serverURL: 'https://waline.musnow.top/',
              lang: 'zh-CN' || 'zh-CN',
              comment: '.post-comments-count',
              reaction: 'false' === 'true',
              requiredMeta: ['nick','mail'] 
            })
          }

          if ('true' === 'true') {
            setTimeout(() => {
              loadWaline()
            }, 1000)
          } else {
            window.addEventListener('DOMContentLoaded', loadWaline)
          }</script></div></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF%E6%96%87%E4%BB%B6%EF%BC%9F"><span class="nav-text">1.ä»€ä¹ˆæ˜¯æ–‡ä»¶ï¼Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-C%E8%AF%AD%E8%A8%80%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="nav-text">1.2 Cè¯­è¨€æ–‡ä»¶æ“ä½œ</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E5%88%9D%E8%AF%86Linux%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%96%87%E4%BB%B6%E6%8E%A5%E5%8F%A3"><span class="nav-text">2.åˆè¯†Linuxç³»ç»Ÿçš„æ–‡ä»¶æ¥å£</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-%E8%AF%BB%E6%96%87%E4%BB%B6"><span class="nav-text">2.1 è¯»æ–‡ä»¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-%E5%86%99%E6%96%87%E4%BB%B6"><span class="nav-text">2.2 å†™æ–‡ä»¶</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%99%E6%96%B9%E5%BC%8F%E8%A6%86%E7%9B%96%EF%BC%9F"><span class="nav-text">å†™æ–¹å¼è¦†ç›–ï¼Ÿ</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="nav-text">3.æ–‡ä»¶æè¿°ç¬¦</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AF%E4%BB%8E3%E5%BC%80%E5%A7%8B%EF%BC%9F"><span class="nav-text">3.1 ä¸ºä»€ä¹ˆæ˜¯ä»3å¼€å§‹ï¼Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E8%B0%83%E7%94%A8stdin-x2F-out"><span class="nav-text">ç”¨æ–‡ä»¶æè¿°ç¬¦è°ƒç”¨stdin&#x2F;out</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-%E4%BB%8E0%E5%BC%80%E5%A7%8B%EF%BC%9F%E6%95%B0%E7%BB%84%E4%B8%8B%E6%A0%87%EF%BC%81"><span class="nav-text">3.2 ä»0å¼€å§‹ï¼Ÿæ•°ç»„ä¸‹æ ‡ï¼</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-Linux%E4%B8%8B%E4%B8%80%E5%88%87%E7%9A%86%E6%96%87%E4%BB%B6"><span class="nav-text">3.3 Linuxä¸‹ä¸€åˆ‡çš†æ–‡ä»¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-%E5%88%86%E9%85%8D%E8%A7%84%E5%88%99"><span class="nav-text">3.4 åˆ†é…è§„åˆ™</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91"><span class="nav-text">è¾“å‡ºé‡å®šå‘</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-5-dup2"><span class="nav-text">3.5 dup2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%BD%E5%8A%A0%E9%87%8D%E5%AE%9A%E5%90%91"><span class="nav-text">è¿½åŠ é‡å®šå‘</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BE%93%E5%85%A5%E9%87%8D%E5%AE%9A%E5%90%91"><span class="nav-text">è¾“å…¥é‡å®šå‘</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-6-%E6%A0%87%E5%87%86%E8%BE%93%E5%87%BA-x2F-%E6%A0%87%E5%87%86%E9%94%99%E8%AF%AF"><span class="nav-text">3.6 æ ‡å‡†è¾“å‡º&#x2F;æ ‡å‡†é”™è¯¯</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%BA%E5%88%86%E9%94%99%E8%AF%AF%E5%92%8C%E6%AD%A3%E5%B8%B8%E8%BE%93%E5%87%BA"><span class="nav-text">åŒºåˆ†é”™è¯¯å’Œæ­£å¸¸è¾“å‡º</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%B7%E5%90%88%E8%BE%93%E5%87%BA2-gt-amp-1"><span class="nav-text">æ··åˆè¾“å‡º2&gt;&amp;1</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-C%E8%AF%AD%E8%A8%80%E7%BC%93%E5%86%B2%E5%8C%BA"><span class="nav-text">4.Cè¯­è¨€ç¼“å†²åŒº</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-%E8%A7%82%E5%AF%9F%E7%8E%B0%E8%B1%A1"><span class="nav-text">4.1 è§‚å¯Ÿç°è±¡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-%E7%BC%93%E5%86%B2%E5%8C%BA%E5%9C%A8%E5%93%AA"><span class="nav-text">4.2 ç¼“å†²åŒºåœ¨å“ª?</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E9%97%AD%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="nav-text">å…³é—­æ–‡ä»¶æè¿°ç¬¦</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FILE"><span class="nav-text">FILE</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-%E7%BC%93%E5%86%B2%E5%8C%BA%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="nav-text">4.3 ç¼“å†²åŒºçš„ä½œç”¨</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4-%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E5%88%B7%E6%96%B0%E7%BC%93%E5%86%B2%E5%8C%BA%EF%BC%9F"><span class="nav-text">4.4 ä»€ä¹ˆæ—¶å€™åˆ·æ–°ç¼“å†²åŒºï¼Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%B7%E6%96%B0%E4%B8%8E%E5%AD%90%E8%BF%9B%E7%A8%8B"><span class="nav-text">åˆ·æ–°ä¸å­è¿›ç¨‹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-5-%E7%AE%80%E5%8D%95%E6%A8%A1%E6%8B%9F%E5%AE%9E%E7%8E%B0"><span class="nav-text">4.5 ç®€å•æ¨¡æ‹Ÿå®ç°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%81%E8%A3%85%E6%8E%A5%E5%8F%A3"><span class="nav-text">å°è£…æ¥å£</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95"><span class="nav-text">è¿è¡Œæµ‹è¯•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%90%E8%BF%9B%E7%A8%8B%E6%B5%8B%E8%AF%95"><span class="nav-text">å­è¿›ç¨‹æµ‹è¯•</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="nav-text">5.æ–‡ä»¶ç³»ç»Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-%E7%A3%81%E7%9B%98%E7%9A%84%E7%89%A9%E7%90%86%E7%BB%93%E6%9E%84"><span class="nav-text">5.1 ç£ç›˜çš„ç‰©ç†ç»“æ„</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-CHS%E5%92%8CLBA"><span class="nav-text">5.2 CHSå’ŒLBA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-IO%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8D%95%E4%BD%8D"><span class="nav-text">5.3 IOçš„åŸºæœ¬å•ä½</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="nav-text">ä¸ºä»€ä¹ˆï¼Ÿ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-4-%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84"><span class="nav-text">5.4 ç³»ç»Ÿç»“æ„</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#inode"><span class="nav-text">inode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#stat%E5%91%BD%E4%BB%A4"><span class="nav-text">statå‘½ä»¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%90%8D%E5%AD%98%E5%9C%A8%E5%93%AA%E5%84%BF%EF%BC%9F"><span class="nav-text">æ–‡ä»¶åå­˜åœ¨å“ªå„¿ï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95%E6%9D%83%E9%99%90"><span class="nav-text">ç›®å½•æƒé™</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-5-%E5%88%9B%E5%BB%BA-x2F-%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6"><span class="nav-text">5.5 åˆ›å»º&#x2F;åˆ é™¤æ–‡ä»¶</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-%E8%BD%AF%E7%A1%AC%E9%93%BE%E6%8E%A5"><span class="nav-text">6.è½¯ç¡¬é“¾æ¥</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-%E6%9F%A5%E7%9C%8B%E6%96%87%E4%BB%B6%E7%A1%AC%E9%93%BE%E6%8E%A5%E4%B8%AA%E6%95%B0"><span class="nav-text">6.1 æŸ¥çœ‹æ–‡ä»¶ç¡¬é“¾æ¥ä¸ªæ•°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%EF%BC%9F-1"><span class="nav-text">ä¸ºä»€ä¹ˆï¼Ÿ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-%E8%BD%AF%E7%A1%AC%E9%93%BE%E6%8E%A5%E5%8C%BA%E5%88%AB"><span class="nav-text">6.2 è½¯ç¡¬é“¾æ¥åŒºåˆ«</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E7%AD%94%EF%BC%81"><span class="nav-text">è§£ç­”ï¼</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-3-unlink%E5%91%BD%E4%BB%A4"><span class="nav-text">6.3 unlinkå‘½ä»¤</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BB%93%E8%AF%AD"><span class="nav-text">ç»“è¯­</span></a></li></ol></div></div></div></div></div></div></div><div class="page-main-content-bottom"><footer class="footer"><div class="info-container"><div class="copyright-info info-item">&copy; <span>2021</span> - 2023 &nbsp;<i class="fas fa-heart icon-animate"></i> &nbsp;<a href="/">æ…•é›ªå¹´å</a></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="website-count info-item">è®¿é—®äººæ•°&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp; æ€»è®¿é—®é‡&nbsp;<span id="busuanzi_value_site_pv"></span></div><div class="timerun-info info-item"><span id="timeDate">è½½å…¥å¤©æ•°...</span><span id="times">è½½å…¥æ—¶åˆ†ç§’...</span><script>var now=new Date;function createtime(){var n=new Date("04/16/2022 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="å·²å‹‰å¼ºè¿è¡Œ "+dnum+" å¤© ",document.getElementById("times").innerHTML=hnum+" æ—¶ "+mnum+" åˆ† "+snum+" ç§’"}setInterval("createtime()",250)</script></div><div class="shields-info info-item"><a href="https://github.com/XPoet/hexo-theme-keep" target="_blank"><img src="https://img.shields.io/badge/hexo-keep-blue" height="20px"> </a><a href="https://musnow.top" target="_blank"><img src="https://img.shields.io/badge/%E4%B8%BB%E7%AB%99-%E7%82%B9%E6%88%91-blueviolet" height="20px"> </a><a href="https://icp.gov.moe/?keyword=20230054" target="_blank"><img src="https://img.shields.io/badge/-%E8%90%8CICP%E5%A4%8720230054-ff69b4" height="20px"> </a><a href="https://beian.miit.gov.cn/" target="_blank"><img src="https://img.shields.io/badge/%E7%B2%A4ICP%E5%A4%87-2023007189%E5%8F%B7-red" height="20px"> </a><a href="https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referral" target="_blank"><img src="/images/UPYUN-CDN.png" height="20px"></a></div></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="tools-list"><li class="tools-item flex-center toggle-show-toc"><i class="fas fa-list"></i></li><li class="tools-item flex-center go-to-comments"><i class="fas fa-comment"></i> <span class="post-comments-count"></span></li></ul></div></div><div class="right-bottom-side-tools"><div class="side-tools-container"><ul class="side-tools-list"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-dark-light-toggle flex-center"><i class="fas fa-moon"></i></li><li class="tools-item rss flex-center"><a class="flex-center" href="/atom.xml" target="_blank"><i class="fas fa-rss"></i></a></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="exposed-tools-list"><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li><li class="tools-item tool-scroll-to-top flex-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="zoom-in-image-mask"><img class="zoom-in-image"></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fas fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="æœç´¢..." spellcheck="false" type="search" class="search-input"></div><span class="close-popup-btn"><i class="fas fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/utils.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/main.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/header-shrink.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/back2top.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/dark-light-toggle.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/local-search.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/code-block.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/lazyload.js"></script><div class="post-scripts pjax"><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/post-helper.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/libs/anime.min.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/toc.js"></script></div><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/libs/pjax.min.js"></script><script>window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });</script><script type="text/javascript" src="/js/snow.js"></script></body></html>