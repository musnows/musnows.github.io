<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="Hexo Theme Keep"><meta name="description" content="Hexo Theme Keep"><meta name="author" content="æ…•é›ªå¹´å"><meta name="baidu-site-verification" content="codeva-E1K9nNha9u"><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"JwxEfuZ8fwQ1GPEq",ck:"JwxEfuZ8fwQ1GPEq"})</script><title>ã€Linuxã€‘è¿›ç¨‹é€šä¿¡ | ä¿¡å· | æ…•é›ªçš„å¯’èˆ</title><link rel="stylesheet" href="/css/style.css"><link rel="shortcut icon" href="/images/myPNG.jpg"><link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/fontawesome.min.css"><link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/regular.min.css"><link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/solid.min.css"><link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/brands.min.css"><script id="hexo-configurations">let KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"blog.outpost54.top","root":"/","language":"zh-CN","path":"search.json"}
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true},"style":{"primary_color":"#0066cc","logo":"/images/myPNG.jpg","favicon":"/images/myPNG.jpg","avatar":"/images/myPNG.jpg","font_size":null,"font_family":null,"left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"header_transparent":false,"background_img":"/images/MainBG.jpg","background_post_img":"/images/mothra.png","description":"å¾å¿ƒå¦‚ä¸€ï¼Œæ…•é›ªçº·çº·","font_color":null,"hitokoto":true},"scroll":{"progress_bar":true,"percent":true}},"local_search":{"enable":true,"preload":true},"code_copy":{},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"default"},"side_tools":{},"pjax":{"enable":true},"lazyload":{"enable":true},"comment":{"enable":true,"use":"waline","valine":{"appid":"meufCipLPHNWVE3gWEnozHzz-gzGzoHsz","appkey":"CFX9WelJjGHkaMnSunOlv3dX","server_urls":null,"placeholder":"æ¬¢è¿ç•™ä¸‹ä½ çš„å£°éŸ³ğŸ˜‹"},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.8"},"waline":{"server_url":"https://vrcl.outpost54.top/","reaction":false,"version":2}},"post":{"author_label":{"enable":false,"auto":true,"custom_label_list":["Trainee","Engineer","Architect"]},"word_count":{"enable":true,"wordcount":true,"min2read":false},"img_align":"center","copyright_info":true},"version":"3.6.1"}
    KEEP.language_ago = {"second":"%s ç§’å‰","minute":"%s åˆ†é’Ÿå‰","hour":"%s å°æ—¶å‰","day":"%s å¤©å‰","week":"%s å‘¨å‰","month":"%s ä¸ªæœˆå‰","year":"%s å¹´å‰"}
    KEEP.language_code_block = {"copy":"å¤åˆ¶ä»£ç ","copied":"å·²å¤åˆ¶","fold":"æŠ˜å ä»£ç å—","folded":"å·²æŠ˜å "}
    KEEP.language_copy_copyright = {"copy":"å¤åˆ¶ç‰ˆæƒä¿¡æ¯","copied":"å·²å¤åˆ¶","title":"åŸæ–‡æ ‡é¢˜","author":"åŸæ–‡ä½œè€…","link":"åŸæ–‡é“¾æ¥"}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"><meta name="generator" content="Hexo 6.2.0"></head><body><div class="progress-bar-container"><span class="scroll-progress-bar"></span> <span class="pjax-progress-bar"></span> <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i></div><main class="page-container"><div class="page-main-content"><div class="page-main-content-top"><header class="header-wrapper"><div class="header-content"><div class="left"><a class="logo-image" href="/"><img src="/images/myPNG.jpg"> </a><a class="logo-title" href="/">æ…•é›ªçš„å¯’èˆ</a></div><div class="right"><div class="pc"><ul class="menu-list"><li class="menu-item"><a href="/">é¦–é¡µ</a></li><li class="menu-item"><a href="/archives">å½’æ¡£</a></li><li class="menu-item"><a href="/categories">åˆ†ç±»</a></li><li class="menu-item"><a href="/tags">æ ‡ç­¾</a></li><li class="menu-item"><a href="/QA">ç•™è¨€æ¿</a></li><li class="menu-item"><a href="/links">å‹é“¾</a></li><li class="menu-item"><a href="/about">å…³äº</a></li><li class="menu-item search search-popup-trigger"><i class="fas fa-search"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div><div class="icon-item menu-bar"><div class="menu-bar-middle"></div></div></div></div></div><div class="header-drawer"><ul class="drawer-menu-list"><li class="drawer-menu-item flex-center"><a href="/">é¦–é¡µ</a></li><li class="drawer-menu-item flex-center"><a href="/archives">å½’æ¡£</a></li><li class="drawer-menu-item flex-center"><a href="/categories">åˆ†ç±»</a></li><li class="drawer-menu-item flex-center"><a href="/tags">æ ‡ç­¾</a></li><li class="drawer-menu-item flex-center"><a href="/QA">ç•™è¨€æ¿</a></li><li class="drawer-menu-item flex-center"><a href="/links">å‹é“¾</a></li><li class="drawer-menu-item flex-center"><a href="/about">å…³äº</a></li></ul></div><div class="window-mask"></div></header></div><div class="page-main-content-middle"><div class="main-content"><div class="fade-in-down-animation"><div class="post-page-container"><div class="article-content-container"><div class="article-title"><span class="title-hover-animation">ã€Linuxã€‘è¿›ç¨‹é€šä¿¡ | ä¿¡å·</span></div><div class="article-header"><div class="avatar"><img src="/images/myPNG.jpg"></div><div class="info"><div class="author"><span class="name">æ…•é›ªå¹´å</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-calendar-plus"></i>&nbsp; <span class="pc">2022-11-20 16:30:16</span> <span class="mobile">2022-11-20 16:30</span> </span><span class="article-update-date article-meta-item"><i class="fas fa-file-pen"></i>&nbsp; <span class="pc">2023-01-08 19:34:27</span> </span><span class="article-categories article-meta-item"><i class="fas fa-folder"></i>&nbsp;<ul><li><a href="/categories/%E7%8E%A9%E4%B8%8ALinux/">ç©ä¸ŠLinux</a>&nbsp;</li></ul></span><span class="article-tags article-meta-item"><i class="fas fa-tags"></i>&nbsp;<ul><li><a href="/tags/Linux/">Linux</a>&nbsp;</li><li>| <a href="/tags/%E8%BF%9B%E7%A8%8B/">è¿›ç¨‹</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fas fa-file-word"></i>&nbsp;<span>10.8k å­—</span> </span><span class="article-pv article-meta-item"><i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content keep-markdown-body"><p>æœ¬ç¯‡åšå®¢è®©æˆ‘ä»¬ä¸€èµ·æ¥åº·åº·<strong>ä¿¡å·</strong>éƒ¨åˆ†çš„å†…å®¹</p><blockquote><p>ç³»ç»Ÿä¸ºCentOS7.6ï¼Œå®Œæ•´ä»£ç è§ <a class="link" target="_blank" rel="noopener" href="https://gitee.com/ewait/raspberry-practice/tree/master/code/22-11-16_signal">Gitee<i class="fas fa-external-link-alt"></i></a></p></blockquote><span id="more"></span><p>[TOC]</p><h1 id="1-ä»€ä¹ˆæ˜¯ä¿¡å·"><a href="#1-ä»€ä¹ˆæ˜¯ä¿¡å·" class="headerlink" title="1.ä»€ä¹ˆæ˜¯ä¿¡å·"></a>1.ä»€ä¹ˆæ˜¯ä¿¡å·</h1><p>åœ¨è¿›ç¨‹è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šå‡ºç°å„ç§å„æ ·çš„æƒ…å†µã€‚æ“ä½œç³»ç»Ÿéœ€è¦ç”¨ä¸€å¥—æœºåˆ¶ï¼Œæ¥ç®¡ç†è¿›ç¨‹çš„<strong>äº‹ä»¶</strong></p><ul><li>è¿›ç¨‹é€€å‡º</li><li>è¿›ç¨‹åœæ­¢</li><li>è¿›ç¨‹æ¢å¤è¿è¡Œ</li><li>â€¦â€¦</li></ul><p>åŒæ—¶ï¼Œè¿™å¥—ç®¡ç†æœºåˆ¶æ˜¯<code>å¼‚æ­¥</code>çš„ï¼Œå±äºä¸€ç§<code>è½¯ï¼ˆä»¶ï¼‰ä¸­æ–­</code></p><blockquote><p>å’Œç¡¬ä»¶ä¸­æ–­æ‰“æ–­å¤„ç†å™¨ç±»ä¼¼ï¼Œè½¯ä»¶ä¸­æ–­æ‰“æ–­è¿›ç¨‹çš„æ‰§ï¼Œè®©å…¶æ‰§è¡Œå¯¹åº”ä»£ç è¿›è¡Œå“åº”</p></blockquote><h2 id="1-1-ä½•ä¸ºå¼‚æ­¥"><a href="#1-1-ä½•ä¸ºå¼‚æ­¥" class="headerlink" title="1.1 ä½•ä¸ºå¼‚æ­¥?"></a>1.1 ä½•ä¸ºå¼‚æ­¥?</h2><blockquote><p>ä»¥ç½‘è´­ç‰©å“ä¸ºä¾‹ï¼šå½“å•†å“å¯„åˆ°è‡ªæç‚¹çš„æ—¶å€™ï¼Œä¼šç»™ä½ å‘é€ä¸€æ¡å–ä»¶çš„çŸ­ä¿¡ï¼ˆä¿¡å·ï¼‰ã€‚æ­¤æ—¶æˆ‘æ­£åœ¨æ‰“æ¸¸æˆï¼Œæ²¡æ—¶é—´å»å¤„ç†è¿™ä¸ªå¿«é€’ï¼ˆå³å–å¿«é€’çš„è¡Œä¸ºå¹¶ä¸æ˜¯å¿…é¡»ç«‹é©¬æ‰§è¡Œï¼‰</p><p>ä½†è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘å·²ç»çŸ¥é“æœ‰ä¸€ä¸ªå¿«é€’åˆ°äº†ï¼ˆçŸ¥é“è‡ªå·±è·å–åˆ°äº†ä¸€ä¸ªä¿¡å·ï¼‰æœ¬è´¨ä¸Šå°±æ˜¯çŸ¥é“äº†ä¸€ä¼šè¦å»å–å¿«é€’ï¼ˆä¸€ä¼šè¦å¤„ç†ä¿¡å·ï¼‰</p><p>å½“æ¸¸æˆä¸€æŠŠæ‰“å®Œäº†ï¼Œæˆ‘ä»¬å°±å»å–å¿«é€’äº†ï¼ˆå¤„ç†ä¿¡å·ï¼‰</p></blockquote><p>è¿™å°±æ˜¯ä¸€ç§<code>å¼‚æ­¥</code>çš„è¿‡ç¨‹ã€‚å› ä¸º<strong>ä½ ä¸çŸ¥é“ä½ çš„å¿«é€’ä»€ä¹ˆæ—¶å€™ä¼šåˆ°ç«™ç‚¹</strong>ï¼Œè¿›ç¨‹ä¹Ÿä¸çŸ¥é“è‡ªå·±<strong>ä»€ä¹ˆæ—¶å€™ä¼šæ”¶åˆ°ä¸€ä¸ªä¿¡å·</strong></p><h2 id="1-2-ä¿¡å·çš„ç§ç±»"><a href="#1-2-ä¿¡å·çš„ç§ç±»" class="headerlink" title="1.2 ä¿¡å·çš„ç§ç±»"></a>1.2 ä¿¡å·çš„ç§ç±»</h2><p>ä½¿ç”¨<code>kill -l</code>å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç›®å‰linuxç³»ç»Ÿä¸‹<code>64</code>ç§ä¸åŒçš„ç±»å‹ã€‚</p><p>å…¶ä¸­å‰32ä¸ºæ ‡å‡†ï¼ˆStandardï¼‰ä¿¡å·ï¼Œå32ä¸ºå®æ—¶ï¼ˆReal-timeï¼‰ä¿¡å·ï¼›<strong>æœ¬ç¯‡åšå®¢åªå…³æ³¨æ ‡å‡†ä¿¡å·</strong></p><blockquote><p>è¿™äº›ä¿¡å·ï¼Œéƒ½æ˜¯linuxç³»ç»Ÿä¸­é¢„å®šä¹‰çš„<strong>å®</strong></p></blockquote><p>å…¶ä¸­æœ€å¸¸ç”¨çš„ä¾¿æ˜¯9å·ä¿¡å·ï¼Œæ¥ä¸­æ–­è¿›ç¨‹ã€‚å¹³æ—¶æˆ‘ä»¬æœ€å¸¸ç”¨çš„<code>CTRL+C</code>ï¼Œä¹Ÿæ˜¯é€šè¿‡<strong>å‘è¿›ç¨‹å‘2å·ä¿¡å·</strong>è®©è¿›ç¨‹é€€å‡ºçš„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git]$ <span class="built_in">kill</span> -l</span><br><span class="line"> 1) SIGHUP       2) SIGINT       3) SIGQUIT      4) SIGILL       5) SIGTRAP</span><br><span class="line"> 6) SIGABRT      7) SIGBUS       8) SIGFPE       9) SIGKILL     10) SIGUSR1</span><br><span class="line">11) SIGSEGV     12) SIGUSR2     13) SIGPIPE     14) SIGALRM     15) SIGTERM</span><br><span class="line">16) SIGSTKFLT   17) SIGCHLD     18) SIGCONT     19) SIGSTOP     20) SIGTSTP</span><br><span class="line">21) SIGTTIN     22) SIGTTOU     23) SIGURG      24) SIGXCPU     25) SIGXFSZ</span><br><span class="line">26) SIGVTALRM   27) SIGPROF     28) SIGWINCH    29) SIGIO       30) SIGPWR</span><br><span class="line">31) SIGSYS      34) SIGRTMIN    35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3</span><br><span class="line">38) SIGRTMIN+4  39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8</span><br><span class="line">43) SIGRTMIN+9  44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12 47) SIGRTMIN+13</span><br><span class="line">48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14 51) SIGRTMAX-13 52) SIGRTMAX-12</span><br><span class="line">53) SIGRTMAX-11 54) SIGRTMAX-10 55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7</span><br><span class="line">58) SIGRTMAX-6  59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2</span><br><span class="line">63) SIGRTMAX-1  64) SIGRTMAX</span><br></pre></td></tr></table></figure><p>åœ¨<code>include/linux/signal.h</code>ä¸­ï¼Œæˆ‘ä»¬<span id="jump1">å¯ä»¥çœ‹åˆ°å¯¹ä¿¡å·</span>çš„è§£é‡Šï¼Œä»¥åŠå…¶<code>é»˜è®¤å¤„ç†æ–¹æ³• default action</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * In POSIX a signal is sent either to a specific thread (Linux task)</span></span><br><span class="line"><span class="comment"> * or to the process as a whole (Linux thread group).  How the signal</span></span><br><span class="line"><span class="comment"> * is sent determines whether it&#x27;s to one thread or the whole group,</span></span><br><span class="line"><span class="comment"> * which determines which signal mask(s) are involved in blocking it</span></span><br><span class="line"><span class="comment"> * from being delivered until later.  When the signal is delivered,</span></span><br><span class="line"><span class="comment"> * either it&#x27;s caught or ignored by a user handler or it has a default</span></span><br><span class="line"><span class="comment"> * effect that applies to the whole thread group (POSIX process).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The possible effects an unblocked signal set to SIG_DFL can have are:</span></span><br><span class="line"><span class="comment"> *   ignore	- Nothing Happens</span></span><br><span class="line"><span class="comment"> *   terminate	- kill the process, i.e. all threads in the group,</span></span><br><span class="line"><span class="comment"> * 		  similar to exit_group.  The group leader (only) reports</span></span><br><span class="line"><span class="comment"> *		  WIFSIGNALED status to its parent.</span></span><br><span class="line"><span class="comment"> *   coredump	- write a core dump file describing all threads using</span></span><br><span class="line"><span class="comment"> *		  the same mm and then kill all those threads</span></span><br><span class="line"><span class="comment"> *   stop 	- stop all the threads in the group, i.e. TASK_STOPPED state</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SIGKILL and SIGSTOP cannot be caught, blocked, or ignored.</span></span><br><span class="line"><span class="comment"> * Other signals when not blocked and set to SIG_DFL behaves as follows.</span></span><br><span class="line"><span class="comment"> * The job control signals also have other special effects.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *	+--------------------+------------------+</span></span><br><span class="line"><span class="comment"> *	|  POSIX signal      |  default action  |</span></span><br><span class="line"><span class="comment"> *	+--------------------+------------------+</span></span><br><span class="line"><span class="comment"> *	|  SIGHUP            |  terminate	|</span></span><br><span class="line"><span class="comment"> *	|  SIGINT            |	terminate	|</span></span><br><span class="line"><span class="comment"> *	|  SIGQUIT           |	coredump 	|</span></span><br><span class="line"><span class="comment"> *	|  SIGILL            |	coredump 	|</span></span><br><span class="line"><span class="comment"> *	|  SIGTRAP           |	coredump 	|</span></span><br><span class="line"><span class="comment"> *	|  SIGABRT/SIGIOT    |	coredump 	|</span></span><br><span class="line"><span class="comment"> *	|  SIGBUS            |	coredump 	|</span></span><br><span class="line"><span class="comment"> *	|  SIGFPE            |	coredump 	|</span></span><br><span class="line"><span class="comment"> *	|  SIGKILL           |	terminate(+)	|</span></span><br><span class="line"><span class="comment"> *	|  SIGUSR1           |	terminate	|</span></span><br><span class="line"><span class="comment"> *	|  SIGSEGV           |	coredump 	|</span></span><br><span class="line"><span class="comment"> *	|  SIGUSR2           |	terminate	|</span></span><br><span class="line"><span class="comment"> *	|  SIGPIPE           |	terminate	|</span></span><br><span class="line"><span class="comment"> *	|  SIGALRM           |	terminate	|</span></span><br><span class="line"><span class="comment"> *	|  SIGTERM           |	terminate	|</span></span><br><span class="line"><span class="comment"> *	|  SIGCHLD           |	ignore   	|</span></span><br><span class="line"><span class="comment"> *	|  SIGCONT           |	ignore(*)	|</span></span><br><span class="line"><span class="comment"> *	|  SIGSTOP           |	stop(*)(+)  	|</span></span><br><span class="line"><span class="comment"> *	|  SIGTSTP           |	stop(*)  	|</span></span><br><span class="line"><span class="comment"> *	|  SIGTTIN           |	stop(*)  	|</span></span><br><span class="line"><span class="comment"> *	|  SIGTTOU           |	stop(*)  	|</span></span><br><span class="line"><span class="comment"> *	|  SIGURG            |	ignore   	|</span></span><br><span class="line"><span class="comment"> *	|  SIGXCPU           |	coredump 	|</span></span><br><span class="line"><span class="comment"> *	|  SIGXFSZ           |	coredump 	|</span></span><br><span class="line"><span class="comment"> *	|  SIGVTALRM         |	terminate	|</span></span><br><span class="line"><span class="comment"> *	|  SIGPROF           |	terminate	|</span></span><br><span class="line"><span class="comment"> *	|  SIGPOLL/SIGIO     |	terminate	|</span></span><br><span class="line"><span class="comment"> *	|  SIGSYS/SIGUNUSED  |	coredump 	|</span></span><br><span class="line"><span class="comment"> *	|  SIGSTKFLT         |	terminate	|</span></span><br><span class="line"><span class="comment"> *	|  SIGWINCH          |	ignore   	|</span></span><br><span class="line"><span class="comment"> *	|  SIGPWR            |	terminate	|</span></span><br><span class="line"><span class="comment"> *	|  SIGRTMIN-SIGRTMAX |	terminate       |</span></span><br><span class="line"><span class="comment"> *	+--------------------+------------------+</span></span><br><span class="line"><span class="comment"> *	|  non-POSIX signal  |  default action  |</span></span><br><span class="line"><span class="comment"> *	+--------------------+------------------+</span></span><br><span class="line"><span class="comment"> *	|  SIGEMT            |  coredump	|</span></span><br><span class="line"><span class="comment"> *	+--------------------+------------------+</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * (+) For SIGKILL and SIGSTOP the action is &quot;always&quot;, not just &quot;default&quot;.</span></span><br><span class="line"><span class="comment"> * (*) Special job control effects:</span></span><br><span class="line"><span class="comment"> * When SIGCONT is sent, it resumes the process (all threads in the group)</span></span><br><span class="line"><span class="comment"> * from TASK_STOPPED state and also clears any pending/queued stop signals</span></span><br><span class="line"><span class="comment"> * (any of those marked with &quot;stop(*)&quot;).  This happens regardless of blocking,</span></span><br><span class="line"><span class="comment"> * catching, or ignoring SIGCONT.  When any stop signal is sent, it clears</span></span><br><span class="line"><span class="comment"> * any pending/queued SIGCONT signals; this happens regardless of blocking,</span></span><br><span class="line"><span class="comment"> * catching, or ignored the stop signal, though (except for SIGSTOP) the</span></span><br><span class="line"><span class="comment"> * default action of stopping the process may happen later or never.</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p>è¿™ä¹Ÿæ„å‘³ç€ï¼šå³ä¾¿æ²¡æœ‰æ¥æ”¶åˆ°ä¿¡å·ï¼Œè¿›ç¨‹ä¹Ÿå…·å¤‡æœ‰<strong>è¯†åˆ«å’Œå¤„ç†</strong>è¿™ä¸ªä¿¡å·çš„èƒ½åŠ›ï¼å› ä¸ºåœ¨ç³»ç»Ÿä¸­ï¼Œå·²ç»ç»™æ¯ä¸€ä¸ªè¿›ç¨‹å’Œä¿¡å·æŒ‡å®šäº†é»˜è®¤åŠ¨ä½œï¼</p><h2 id="1-3-ä¿¡å·äº§ç”Ÿ"><a href="#1-3-ä¿¡å·äº§ç”Ÿ" class="headerlink" title="1.3 ä¿¡å·äº§ç”Ÿ"></a>1.3 ä¿¡å·äº§ç”Ÿ</h2><p>æœ‰å¾ˆå¤šæƒ…å†µä¼šäº§ç”Ÿä¿¡å·</p><ul><li>ç³»ç»Ÿæ¥å£ï¼ˆkillå‘½ä»¤ï¼‰</li><li>é”®ç›˜äº§ç”Ÿï¼ˆ<code>CTRL+R CTRL+\</code>)</li><li>è½¯ä»¶æ¡ä»¶ï¼ˆè¿›ç¨‹åœæ­¢ï¼Œè¿›ç¨‹è¿è¡Œå®Œé€€å‡ºï¼‰</li><li>ç¡¬ä»¶å¼‚å¸¸ï¼ˆæ¯”å¦‚é™¤0é”™è¯¯ï¼‰</li></ul><h2 id="1-4-ä¿¡å·åŠ¨ä½œ"><a href="#1-4-ä¿¡å·åŠ¨ä½œ" class="headerlink" title="1.4 ä¿¡å·åŠ¨ä½œ"></a>1.4 ä¿¡å·åŠ¨ä½œ</h2><p>æ—¢ç„¶æœ‰é»˜è®¤åŠ¨ä½œï¼Œé‚£è‚¯å®šä¹Ÿæœ‰éé»˜è®¤çš„äº†ã€‚å®é™…ä¸Šï¼Œä¸€ä¸ªè¿›ç¨‹å¯¹ä¿¡å·çš„å¤„ç†åˆ†ä¸ºä¸‰ç§ä¸åŒçš„æ–¹å¼</p><ul><li>é»˜è®¤åŠ¨ä½œ</li><li>è‡ªå®šä¹‰åŠ¨ä½œ</li><li>å¿½ç•¥</li></ul><p>å‰é¢æåˆ°ï¼Œä¸€ä¸ªè¿›ç¨‹å¹¶ä¸ä¸€å®šéœ€è¦ç«‹åˆ»å¤„ç†ä¸€ä¸ªä¿¡å·ã€‚é‚£ä¹ˆå®ƒä¸€å®šéœ€è¦æœ‰ä¸€ä¸ªåŠæ³•æ¥è®°ä½è‡ªå·±æ”¶åˆ°çš„ä¿¡å·ã€‚</p><p>è€Œå­˜å‚¨ä¿¡å·ï¼Œæ˜¯ç”±<strong>è¿›ç¨‹çš„PCB</strong>æ¥å®Œæˆçš„ï¼</p><p>ç»†å¿ƒçš„ä½ å¯èƒ½ä¼šå‘ç°ï¼Œè¿›ç¨‹ä¸­çš„ä¿¡å·ä¸€å…±æ˜¯64ä¸ªï¼Œåˆšå¥½æ˜¯8ä¸ªå­—èŠ‚ï¼æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>ä½å›¾</code>ç»“æ„ï¼Œç”¨ä¸¤ä¸ªintç±»å‹æ¥å­˜æ”¾ä¸€ä¸ªè¿›ç¨‹æ”¶åˆ°çš„å„ç§ä¿¡å·ã€‚</p><p><img lazyload alt="image" data-src="https://img-7758-typora.oss-cn-shanghai.aliyuncs.com/img1/202211181850945.png" alt="image-20221118185053908"></p><p>åœ¨ç³»ç»Ÿå†…æ ¸ä¸­ï¼Œåˆ†åˆ«æœ‰ä¸‰ä¸ªè¡¨ï¼Œç”¨æ¥å­˜æ”¾è¿›ç¨‹çš„ä¿¡å·ã€‚è€Œè¿™äº›ä¿¡å·åœ¨ä½å›¾ä¸­çš„ä½ç½®ï¼Œå°±æ˜¯åœ¨<code>handler</code>æ–¹æ³•é›†ä¸­å¤„ç†åŠ¨ä½œçš„<strong>ä¸‹æ ‡</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">block - 1è¡¨ç¤ºè¯¥è¿›ç¨‹å±è”½è¿™ä¸ªä¿¡å·</span><br><span class="line">pending - è¡¨ç¤ºè¿›ç¨‹æ”¶åˆ°äº†ä»€ä¹ˆä¿¡å·ï¼Œ1ä»£è¡¨æ”¶åˆ°ä¸”æœªå¤„ç†</span><br><span class="line">handler - æ¯ä¸€ä¸ªä¿¡å·æ‰€å¯¹åº”çš„å¤„ç†æ–¹æ³•ï¼Œé»˜è®¤/å¿½ç•¥/è‡ªå®šä¹‰</span><br></pre></td></tr></table></figure><p>è¿™ä¸€åˆ‡éƒ½æ˜¯å¤„äºè¿›ç¨‹PCBä¸­çš„ï¼Œåªæœ‰<strong>æ“ä½œç³»ç»Ÿ</strong>èƒ½ä¸ºæˆ‘ä»¬ç®¡ç†ã€‚æ‰€ä»¥æ“ä½œç³»ç»Ÿæä¾›äº†ç›¸å…³çš„æ¥å£ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹è¿›ç¨‹ä¿¡å·è¿›è¡Œè‡ªå®šä¹‰è®¾ç½®ã€‚</p><p>pendingè¡¨ä¸­çš„ä¿¡å·åªèƒ½ä¿å­˜ä¸€ä¸ªï¼Œå¦‚æœä¸€ä¸ªä¿¡å·å°šæœªå¤„ç†ï¼Œè¯¥ä½å›¾ä¸º1ï¼›å¦å¤–ä¸€ä¸ªç›¸åŒä¿¡å·åˆ°æ¥çš„æ—¶å€™ï¼Œä¼šè¢«ç›´æ¥ä¸¢å¼ƒæ‰ã€‚ï¼ˆpendingè¡¨åªèƒ½è®°ä½ä¸€ä¸ªä¿¡å·ï¼‰</p><p>handlerè¡¨ä¸­çš„ä¸¤ä¸ªå®å¦‚ä¸‹ï¼š</p><ul><li>SIG_DFL é»˜è®¤æ–¹æ³•</li><li>SIG_IGN å¿½ç•¥</li><li>å¿½ç•¥æ˜¯ä¿¡å·å¤„ç†çš„ä¸€ç§æ–¹å¼ï¼Œæˆ‘ä»¬èƒ½æ­£å¸¸æ”¶åˆ°è¿™ä¸ªä¿¡å·ï¼Œå¤„ç†æ–¹æ³•æ˜¯ä¸ç®¡ä»–</li></ul><hr><h1 id="2-ç³»ç»Ÿæ¥å£"><a href="#2-ç³»ç»Ÿæ¥å£" class="headerlink" title="2.ç³»ç»Ÿæ¥å£"></a>2.ç³»ç»Ÿæ¥å£</h1><h2 id="2-1-signal"><a href="#2-1-signal" class="headerlink" title="2.1 signal"></a>2.1 signal</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">void</span> <span class="params">(*<span class="type">sighandler_t</span>)</span><span class="params">(<span class="type">int</span>)</span>;</span><br><span class="line"><span class="type">sighandler_t</span> <span class="title function_">signal</span><span class="params">(<span class="type">int</span> signum, <span class="type">sighandler_t</span> handler)</span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°å¯ä»¥ç”¨äºè®¾ç½®æŸä¸ªä¿¡å·çš„å¤„ç†æ–¹æ³•ã€‚å¦‚æœè®¾ç½®æˆåŠŸï¼Œåˆ™è¿”å›è¿™ä¸ªä¿¡å·çš„<code>æ—§å¤„ç†åŠ¨ä½œ</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RETURN VALUE</span><br><span class="line">   signal()  returns the previous value of the signal handler, or SIG_ERR on error. In the event of an error, errno is set to indicate the cause.</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚æˆ‘ä»¬å°†é”®ç›˜é€€å‡ºçš„2å·è‡ªå®šä¹‰ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œé‚£ä¹ˆå°±ä¸èƒ½ç”¨<code>ctrl+c</code>ç»ˆæ­¢è¿™ä¸ªè¿›ç¨‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">handler</span><span class="params">(<span class="type">int</span> signo)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;process get signal: &quot;</span> &lt;&lt; signo &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//å°†äºŒå·ä¿¡å·è®¾ç½®ä¸€ä¸ªå›è°ƒï¼Œå…¶ä½™ä¿¡å·ä¸åšå¤„ç†</span></span><br><span class="line">    <span class="built_in">signal</span>(<span class="number">2</span>, handler);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;è¿›ç¨‹ä¿¡å·å·²ç»è®¾ç½®å®Œäº†&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;è¿›ç¨‹æ­£åœ¨è¿è¡Œ: &quot;</span> &lt;&lt; <span class="built_in">getpid</span>() &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-1-1-å‰å°è¿›ç¨‹å’Œåå°è¿›ç¨‹"><a href="#2-1-1-å‰å°è¿›ç¨‹å’Œåå°è¿›ç¨‹" class="headerlink" title="2.1.1 å‰å°è¿›ç¨‹å’Œåå°è¿›ç¨‹"></a>2.1.1 å‰å°è¿›ç¨‹å’Œåå°è¿›ç¨‹</h3><p>è¿™é‡Œå¯¹<code>ctrl+c</code>çš„ä½œç”¨è¿›ä¸€æ­¥æè¿°ï¼Œå®ƒåªèƒ½ç”¨æ¥ä¸­æ–­ä¸€ä¸ªå‰å°è¿›ç¨‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./test <span class="comment">#æˆ‘ä»¬ç›´æ¥è¿è¡Œä¸€ä¸ªè¿›ç¨‹ï¼Œå°±æ˜¯å‰å°è¿›ç¨‹</span></span><br></pre></td></tr></table></figure><p>ä¹‹å‰è¿™ç§ç›´æ¥è¿è¡Œè¿›ç¨‹ï¼Œåœ¨bashä¸Šæ‰“å°å†…å®¹çš„æ–¹å¼ï¼Œéƒ½æ˜¯ä¸€ä¸ªå‰å°è¿›ç¨‹ï¼Œå¯ä»¥ç”¨<code>ctrl+c</code>ç»ˆæ­¢ï¼›æˆ‘ä»¬å¯ä»¥åœ¨åé¢åŠ ä¸Š<code>&amp;</code>è®¾ç½®ä¸ºä¸€ä¸ªåå°è¿›ç¨‹</p><blockquote><p><code>&amp;</code>åªæ˜¯ä¸´æ—¶åœ¨åå°è¿è¡Œï¼Œbashå…³é—­åä¼šç»ˆæ­¢ï¼›å¦‚æœæƒ³æŒä¹…åœ¨åå°è¿è¡Œï¼Œéœ€è¦åœ¨å‘½ä»¤æœ€å‰é¢åŠ ä¸Š<code>nohup</code></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ ./test &amp;</span><br><span class="line">[1] 8898</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ è¿›ç¨‹æ­£åœ¨è¿è¡Œ: 8898</span><br><span class="line">è¿›ç¨‹æ­£åœ¨è¿è¡Œ: 8898</span><br><span class="line">è¿›ç¨‹æ­£åœ¨è¿è¡Œ: 8898</span><br><span class="line">è¿›ç¨‹æ­£åœ¨è¿è¡Œ: 8898</span><br><span class="line">^C</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ è¿›ç¨‹æ­£åœ¨è¿è¡Œ: 8898</span><br><span class="line">è¿›ç¨‹æ­£åœ¨è¿è¡Œ: 8898</span><br><span class="line">è¿›ç¨‹æ­£åœ¨è¿è¡Œ: 8898</span><br><span class="line">^C</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ è¿›ç¨‹æ­£åœ¨è¿è¡Œ: 8898</span><br><span class="line">è¿›ç¨‹æ­£åœ¨è¿è¡Œ: 8898</span><br><span class="line">è¿›ç¨‹æ­£åœ¨è¿è¡Œ: 8898</span><br><span class="line">è¿›ç¨‹æ­£åœ¨è¿è¡Œ: 8898</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™è¿™ä¸ªè¿›ç¨‹ä¼šä¸€ç›´åœ¨å½“å‰bashçš„åå°æ‰“å°ï¼ŒæœŸé—´æˆ‘ä»¬å¯ä»¥æ‰§è¡Œå…¶ä»–çš„å‘½ä»¤ï¼Œä½†æ˜¯å®ƒä¾æ—§ä¼šä¸åœçš„æ‰“å°ã€‚<code>ctrl+c</code>æ— æ³•ç»ˆæ­¢è¿™ä¸ªè¿›ç¨‹ï¼Œå› ä¸ºå®ƒå¹¶æ²¡æœ‰åœ¨å‰å°è¿è¡Œï¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ ps jax | grep <span class="built_in">test</span></span><br><span class="line">22965  8898  8898 22965 pts/22   22965 S     1001   0:00 ./test</span><br></pre></td></tr></table></figure><p><code>ps</code>å‘½ä»¤æŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ°å…¶è¿è¡Œæ€ä¸º<code>S</code>ï¼›è€Œå‰å°è¿›ç¨‹ï¼Œè¿è¡Œæ€ä¸º<code>S+</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ ps jax | grep <span class="built_in">test</span></span><br><span class="line">22965  9664  9664 22965 pts/22    9664 S+    1001   0:00 ./test</span><br></pre></td></tr></table></figure><p>ä¸è¿‡ï¼Œè™½ç„¶æˆ‘ä»¬ä¸èƒ½ç”¨<code>CTRL+C</code>ç»ˆæ­¢è¿™ä¸ªè¿›ç¨‹ï¼Œä½†ä½¿ç”¨<code>kill -2</code>å‘é€2å·ä¿¡å·ï¼Œæ˜¯å¯ä»¥ç»ˆæ­¢æ‰è¿™ä¸ªè¿›ç¨‹çš„ï¼ˆå‰ææ˜¯æ²¡æœ‰è‡ªå®šä¹‰2å·ä¿¡å·çš„æ–¹æ³•ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ è¿›ç¨‹ä¿¡å·å·²ç»è®¾ç½®å®Œäº†</span><br><span class="line">è¿›ç¨‹æ­£åœ¨è¿è¡Œ: 10464</span><br><span class="line">è¿›ç¨‹æ­£åœ¨è¿è¡Œ: 10464</span><br><span class="line">è¿›ç¨‹æ­£åœ¨è¿è¡Œ: 10464</span><br><span class="line">è¿›ç¨‹æ­£åœ¨è¿è¡Œ: 10464</span><br><span class="line">è¿›ç¨‹æ­£åœ¨è¿è¡Œ: 10464</span><br><span class="line">[1]+  Interrupt               ./test</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ </span><br></pre></td></tr></table></figure><h3 id="2-1-2-å¾ªç¯æ•æ‰æ‰€æœ‰ä¿¡å·"><a href="#2-1-2-å¾ªç¯æ•æ‰æ‰€æœ‰ä¿¡å·" class="headerlink" title="2.1.2 å¾ªç¯æ•æ‰æ‰€æœ‰ä¿¡å·"></a>2.1.2 å¾ªç¯æ•æ‰æ‰€æœ‰ä¿¡å·</h3><p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ª<code>for</code>å¾ªç¯ï¼Œæ•æ‰æ‰€æœ‰çš„ä¿¡å·</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//.....</span></span><br><span class="line"><span class="comment">//å…¶ä½™ä»£ç åŒä¸Š</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//å¯¹æ‰€æœ‰çš„è¿›ç¨‹ä¿¡å·éƒ½è®¾ç½®ä¸€ä¸ªå›è°ƒ</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> sig = <span class="number">1</span>; sig &lt;= <span class="number">31</span>; sig++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">signal</span>(sig, handler);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//signal(2, handler);//å°†äºŒå·ä¿¡å·è®¾ç½®ä¸€ä¸ªå›è°ƒï¼Œå…¶ä½™ä¿¡å·ä¸åšå¤„ç†</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;è¿›ç¨‹ä¿¡å·å·²ç»è®¾ç½®å®Œäº†&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;è¿›ç¨‹æ­£åœ¨è¿è¡Œ: &quot;</span> &lt;&lt; <span class="built_in">getpid</span>() &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¾ç½®äº†ä¹‹åï¼Œå¯¹åº”çš„ä¿¡å·éƒ½ä¼šè°ƒç”¨æˆ‘ä»¬è‡ªå·±å†™çš„å‡½æ•°ã€‚ä½†æœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œé‚£ä¾¿æ˜¯<code>kill -9</code></p><p><img lazyload alt="image" data-src="https://img-7758-typora.oss-cn-shanghai.aliyuncs.com/img1/202211181934296.png" alt="image-20221118193453220"></p><h3 id="2-1-3-ä¿¡å·9-x2F-19"><a href="#2-1-3-ä¿¡å·9-x2F-19" class="headerlink" title="2.1.3 ä¿¡å·9&#x2F;19"></a>2.1.3 ä¿¡å·9&#x2F;19</h3><p>åœ¨<code>LINUX</code>ä¸‹ï¼Œ9å·ä¿¡å·æ˜¯ä¸€ä¸ªç®¡ç†å‘˜ä¿¡å·ï¼Œå…·æœ‰æ€æ­»è¿›ç¨‹çš„æœ€é«˜æƒé™ï¼Œ<strong>ä¸èƒ½è¢«è‡ªå®šä¹‰æ•æ‰</strong>ï¼</p><blockquote><p>ä½ æƒ³å•Šï¼Œè¦æ˜¯linuxä¸å¯¹9å·è¿›è¡Œé™åˆ¶ï¼Œé‚£æˆ‘æŠŠæ‰€æœ‰ä¿¡å·éƒ½æ•æ‰äº†ï¼Œå²‚ä¸æ˜¯è¿™ä¸ªè¿›è¡Œæ²¡æœ‰åŠæ³•è¢«å¤–éƒ¨ä¸­æ­¢äº†ï¼Ÿå°ç—…æ¯’å•Šï¼ğŸ˜‚</p></blockquote><p>å’Œ9å·ä¿¡å·ä¸€æ ·ä¸èƒ½è¢«å±è”½çš„ï¼Œè¿˜æœ‰19å·ä¿¡å·SIGSTOP</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ ./tsig</span><br><span class="line">è¿›ç¨‹ä¿¡å·å·²ç»è®¾ç½®å®Œäº†</span><br><span class="line">process running: 7779</span><br><span class="line">process running: 7779</span><br><span class="line">process running: 7779</span><br><span class="line">process running: 7779</span><br><span class="line">process running: 7779</span><br><span class="line"></span><br><span class="line">[1]+  Stopped                 ./tsig</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$</span><br></pre></td></tr></table></figure><p>è€Œ6å·ä¿¡å·å¯ä»¥è¢«æ•æ‰ï¼Œè‡ªå®šä¹‰æ•æ‰æ–¹æ³•æ‰§è¡Œåï¼Œè¿›ç¨‹ä¾æ—§ä¼šé€€å‡ºã€‚å‚è€ƒ<code>2.4 abort</code></p><h2 id="2-2-kill"><a href="#2-2-kill" class="headerlink" title="2.2 kill"></a>2.2 kill</h2><p>killä¸ä»…æ˜¯ä¸€ä¸ªç³»ç»Ÿå‘½ä»¤ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªç³»ç»Ÿæ¥å£ï¼›</p><blockquote><p>ä¸€èˆ¬è¿™ç§æƒ…å†µï¼Œç”¨<code>man kill</code>æŸ¥çœ‹å‘½ä»¤çš„æ–‡æ¡£ï¼Œ<code>man 2 kill</code>æŸ¥çœ‹æ¥å£å‡½æ•°</p></blockquote><p>ä¹‹å‰æˆ‘ä»¥ä¸ºå®ƒåªæ˜¯ä¸€ä¸ªç”¨æ¥å¹²æ‰è¿›ç¨‹çš„å‘½ä»¤ï¼ˆæ¯•ç«Ÿkillå°±æ˜¯è¿™ä¸ªæ„æ€ï¼‰ç°åœ¨æ‰çŸ¥é“åŸæ¥å®ƒçš„ä½œç”¨æ˜¯ç»™è¿›ç¨‹å‘ä¿¡å·</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//kill - send signal to a process</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">kill</span><span class="params">(<span class="type">pid_t</span> pid, <span class="type">int</span> sig)</span>;</span><br></pre></td></tr></table></figure><p>å®ƒçš„è¿”å›å€¼å¾ˆç®€å•ï¼Œå¦‚æœæˆåŠŸå‘é€ä¿¡å·ï¼Œåˆ™è¿”å›0ï¼Œå¦åˆ™è¿”å›-1å¹¶ä¸”æ›´æ–°errno</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RETURN VALUE</span><br><span class="line">       On success (at least one signal was sent), zero is returned.  On error, -1 is returned, and errno is set appropriately</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªç®€å•çš„å‡½æ•°å®ç°ï¼Œæ¥åˆ¶ä½œä¸€ä¸ªè‡ªå·±çš„killå‘½ä»¤</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">mykill</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(argc != <span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Usage: &quot;</span> &lt;&lt; argv[<span class="number">0</span>] &lt;&lt; <span class="string">&quot; signo-id process-id&quot;</span> &lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(kill(static_cast&lt;<span class="type">pid_t</span>&gt;(atoi(argv[<span class="number">2</span>])), atoi(argv[<span class="number">1</span>])) == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;kill: &quot;</span> &lt;&lt; strerror(errno) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">2</span>);<span class="comment">//å‡ºç°é”™è¯¯</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);<span class="comment">//æ­£å¸¸æ‰§è¡Œ</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//argcå’Œargvæ˜¯å‘½ä»¤è¡Œå‚æ•°</span></span><br><span class="line"><span class="comment">//argcä¼ å…¥å‘½ä»¤ä¸ªæ•°ï¼ŒåŒ…æ‹¬./test</span></span><br><span class="line"><span class="comment">//argvä¼ å…¥å‘½ä»¤çš„å­—ç¬¦ä¸²åœ°å€</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    mykill(argc,argv);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆåŠŸå‘é€äº†ä¿¡å·ï¼</p><p><img lazyload alt="image" data-src="https://img-7758-typora.oss-cn-shanghai.aliyuncs.com/img1/202211182305081.png" alt="image-20221118230540961"></p><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨é”™è¯¯çš„æ—¶å€™ï¼Œåˆ™ä¼šå‘é€æç¤ºä¿¡æ¯ğŸ‘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ ./mkill</span><br><span class="line">Usage: ./mkill signo-id process-id</span><br></pre></td></tr></table></figure><h3 id="2-2-1-killall"><a href="#2-2-1-killall" class="headerlink" title="2.2.1 killall"></a>2.2.1 killall</h3><p>è¿™ä¸ªæ¥å£å¯ä»¥é€šè¿‡è¿›ç¨‹åå‘æ‰€æœ‰<strong>è¿™ä¸ªåå­—çš„è¿›ç¨‹</strong>å‘ä¿¡å·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git]$ killall tsig</span><br></pre></td></tr></table></figure><p>é€šè¿‡æµ‹è¯•å¯ä»¥å‘ç°ï¼Œå®ƒå‘é€çš„æ˜¯ç¬¬15å·ä¿¡å·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ ./tsig</span><br><span class="line">è¿›ç¨‹ä¿¡å·å·²ç»è®¾ç½®å®Œäº†</span><br><span class="line">process running: 5846</span><br><span class="line">process running: 5846</span><br><span class="line">process 5846 get signal: 15</span><br><span class="line">process running: 5846</span><br><span class="line">process running: 5846</span><br></pre></td></tr></table></figure><hr><h2 id="2-3-raise"><a href="#2-3-raise" class="headerlink" title="2.3 raise"></a>2.3 raise</h2><p>è¿™ä¸ªç³»ç»Ÿæ¥å£çš„ä½œç”¨æ˜¯ç»™è‡ªå·±å‘ä¿¡å·</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">raise</span><span class="params">(<span class="type">int</span> sig)</span>;</span><br></pre></td></tr></table></figure><p>è¿”å›0ä»£è¡¨è°ƒç”¨æˆåŠŸï¼Œ<strong>é0ä»£è¡¨å¤±è´¥</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RETURN VALUE</span><br><span class="line">       raise() returns 0 on success, and nonzero for failure.</span><br></pre></td></tr></table></figure><p>ç”¨ä¸‹é¢çš„ä»£ç è¿›è¡Œæµ‹è¯•ï¼Œè¿›ç¨‹ä¼šä¸æ–­çš„ç»™è‡ªå·±å‘é€2å·ä¿¡å·</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">handler</span><span class="params">(<span class="type">int</span> signo)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;process get signal: &quot;</span> &lt;&lt; signo &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TestSignal</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">signal</span>(<span class="number">2</span>, handler);<span class="comment">//å°†äºŒå·ä¿¡å·è®¾ç½®ä¸€ä¸ªå›è°ƒï¼Œå…¶ä½™ä¿¡å·ä¸åšå¤„ç†</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;è¿›ç¨‹ä¿¡å·å·²ç»è®¾ç½®å®Œäº†&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">TestSignal</span>();<span class="comment">//è®¾ç½®å¯¹è¿›ç¨‹ä¿¡å·çš„å±è”½</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">raise</span>(<span class="number">2</span>);</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶èƒ½çœ‹åˆ°æ¯ä¸€ç§’ä¼šè°ƒç”¨æˆ‘ä»¬è‡ªå·±å†™çš„<code>handler</code>æ–¹æ³•ï¼Œæ‰“å°æ”¶åˆ°2å·ä¿¡å·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ ./tsig</span><br><span class="line">è¿›ç¨‹ä¿¡å·å·²ç»è®¾ç½®å®Œäº†</span><br><span class="line">process get signal: 2</span><br><span class="line">process get signal: 2</span><br><span class="line">process get signal: 2</span><br><span class="line">process get signal: 2</span><br><span class="line">process get signal: 2</span><br></pre></td></tr></table></figure><h2 id="2-4-abort"><a href="#2-4-abort" class="headerlink" title="2.4 abort"></a>2.4 abort</h2><p>å‘è‡ªå·±å‘é€<code>6) SIGABRT</code>ä¿¡å·</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">abort</span><span class="params">(<span class="type">void</span>)</span>;</span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯<code>2.3</code>ä¸­çš„ä»£ç ï¼Œå°†<code>raise(2)</code>ä¿®æ”¹ä¸º<code>abort()</code>ï¼ŒåŒæ—¶æ•æ‰6å·ä¿¡å·ã€‚</p><p>æ­¤æ—¶èƒ½è§‚å¯Ÿåˆ°æˆ‘ä»¬è‡ªå·±å†™çš„handleræ–¹æ³•çš„ç¡®è¢«è°ƒç”¨äº†ï¼Œä½†æ˜¯è¿›ç¨‹ä¾æ—§ç»ˆæ­¢äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ ./tsig</span><br><span class="line">è¿›ç¨‹ä¿¡å·å·²ç»è®¾ç½®å®Œäº†</span><br><span class="line">process get signal: 6</span><br><span class="line">Aborted</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$</span><br></pre></td></tr></table></figure><p>è¿™è¯´æ˜6å·ä¿¡å·æœ‰ä¸€ä¸ªç‰¹æ€§ï¼šå¯ä»¥è¢«æ•æ‰æ‰§è¡Œè‡ªå®šä¹‰æ–¹æ³•ï¼Œä½†<strong>æ‰§è¡Œå®Œæ¯•ä¹‹åéœ€è¦é€€å‡º</strong>ï¼</p><p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œ9å·ä¿¡å·æ˜¯<strong>ä¸èƒ½è¢«æ•æ‰</strong></p><hr><h2 id="2-5-alarm"><a href="#2-5-alarm" class="headerlink" title="2.5 alarm"></a>2.5 alarm</h2><p>è¿™ä¸ªæ¥å£çš„ä½œç”¨æ˜¯ä¸€ä¸ªå®šæ—¶å™¨ï¼Œè®¾å®šç§’æ•°ï¼Œæ—¶é—´åˆ°äº†ä¹‹åï¼Œä¼šæ”¶åˆ°<code>14) SIGALRM</code>ä¿¡å·</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">alarm</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> seconds)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RETURN VALUE</span><br><span class="line">    alarm()  returns  the number of seconds remaining until any previously scheduled alarm was due to be delivered, or zero if there was no previously scheduled alarm.</span><br></pre></td></tr></table></figure><p>ç”¨ä¸‹é¢çš„ä»£ç è¿›è¡Œæµ‹è¯•</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">handler</span><span class="params">(<span class="type">int</span> signo)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;process get signal: &quot;</span> &lt;&lt; signo &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TestSignal</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//å¯¹æ‰€æœ‰çš„è¿›ç¨‹ä¿¡å·éƒ½è®¾ç½®ä¸€ä¸ªå›è°ƒ</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> sig = <span class="number">1</span>; sig &lt;= <span class="number">31</span>; sig++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">signal</span>(sig, handler);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;è¿›ç¨‹ä¿¡å·å·²ç»è®¾ç½®å®Œäº†&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">TestSignal</span>();<span class="comment">//è®¾ç½®å¯¹è¿›ç¨‹ä¿¡å·çš„å±è”½</span></span><br><span class="line">    <span class="built_in">alarm</span>(<span class="number">4</span>);<span class="comment">//4såå‘è‡ªå·±å‘é€14ä¿¡å·</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;set alarm, sleep&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">8</span>);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;sleep finish&quot;</span>&lt;&lt;endl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨ä¼‘çœ æœŸé—´ï¼Œè¿›ç¨‹æ”¶åˆ°äº†14å·ä¿¡å·ã€‚æ­¤æ—¶è¿›ç¨‹å¹¶æ²¡æœ‰é€€å‡ºï¼Œè€Œæ˜¯ç»§ç»­ä¼‘çœ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ ./tsig</span><br><span class="line">è¿›ç¨‹ä¿¡å·å·²ç»è®¾ç½®å®Œäº†</span><br><span class="line">set alarm, sleep</span><br><span class="line">process get signal: 14</span><br><span class="line">sleep finish</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ </span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬ä¸å¯¹14å·ä¿¡å·è‡ªå®šä¹‰æ•æ‰ï¼Œåˆ™ä¼š<strong>ç›´æ¥é€€å‡ºè¿›ç¨‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ ./tsig</span><br><span class="line">set alarm, sleep</span><br><span class="line">Alarm clock</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ </span><br></pre></td></tr></table></figure><p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>alarm</code>ä¿¡å·æœ¬èº«ä¸ä¼šè®©è¿›ç¨‹ä¼‘çœ ã€‚å¦‚æœè¿›ç¨‹åœ¨alarmä¿¡å·è®¾å®šç§’æ•°ä¹‹å‰ç»“æŸï¼Œåˆ™ä»€ä¹ˆäº‹æƒ…éƒ½ä¸ä¼šå‘ç”Ÿ</p><h2 id="2-6-sigset-tä¿¡å·é›†"><a href="#2-6-sigset-tä¿¡å·é›†" class="headerlink" title="2.6 sigset_tä¿¡å·é›†"></a>2.6 sigset_tä¿¡å·é›†</h2><p>è¿™æ˜¯ä¸€ä¸ªæ•°æ®ç±»å‹ï¼Œå…¶ä¸ºblock&#x2F;pendingä½å›¾çš„å­˜å‚¨ç»“æ„ï¼Œè¢«ç§°ä½œ<code>ä¿¡å·é›†/ä¿¡å·å±è”½å­—</code></p><p>è™½ç„¶æˆ‘ä»¬èƒ½ç›´æ¥ä½¿ç”¨è¿™ä¸ªç±»å‹ï¼Œ ä½†æ˜¯å¯¹è¿™ä¸ªä¿¡å·é›†ä¸­çš„ä½å›¾æ“ä½œå¿…é¡»è¦<strong>è°ƒç”¨ç³»ç»Ÿæ¥å£</strong>æ¥å®Œæˆ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">sigemptyset</span><span class="params">(<span class="type">sigset_t</span> *<span class="built_in">set</span>)</span>;<span class="comment">//åˆå§‹åŒ–ä½å›¾(æ¸…ç©º)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">sigfillset</span><span class="params">(<span class="type">sigset_t</span> *<span class="built_in">set</span>)</span>;<span class="comment">//å…¨éƒ¨ç½®ä¸º1</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">sigaddset</span><span class="params">(<span class="type">sigset_t</span> *<span class="built_in">set</span>, <span class="type">int</span> signum)</span>;<span class="comment">//è®¾ç½®ä½å›¾ä¸­æŸä¸€ä½çš„æ•°æ®</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">sigdelset</span><span class="params">(<span class="type">sigset_t</span> *<span class="built_in">set</span>, <span class="type">int</span> signum)</span>;<span class="comment">//åˆ é™¤ä½å›¾ä¸­æŸä¸€ä½çš„æ•°æ®</span></span><br><span class="line"><span class="comment">//åˆ¤æ–­æŸä¸€ä½ä¿¡å·æ˜¯å¦åœ¨è¯¥é›†åˆä¸­</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">sigismember</span><span class="params">(<span class="type">const</span> <span class="type">sigset_t</span> *<span class="built_in">set</span>, <span class="type">int</span> signum)</span>;</span><br></pre></td></tr></table></figure><h2 id="2-7-sigprocmask"><a href="#2-7-sigprocmask" class="headerlink" title="2.7 sigprocmask"></a>2.7 sigprocmask</h2><p>æ›´æ”¹æˆ–åˆ™è·å–å½“å‰è¿›ç¨‹çš„ä¿¡å·å±è”½å­—</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">sigprocmask</span><span class="params">(<span class="type">int</span> how, <span class="type">const</span> <span class="type">sigset_t</span> *<span class="built_in">set</span>, <span class="type">sigset_t</span> *oldset)</span>;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå¤„ç†æ–¹æ³•ï¼Œåˆ†åˆ«æœ‰ä¸‹é¢ä¸‰ç§</p><ul><li>SIG_BLOCK å°†setå‚æ•°ä¸­åŒ…å«çš„ä½æ•°è®¾ç½®ä¸ºå±è”½</li><li>SIG_UNBLOCK å°†setå‚æ•°ä¸­åŒ…å«çš„ä½æ•°è§£é™¤å±è”½</li><li>SIG_SETMASK å°†å½“å‰çš„ä¿¡å·å±è”½å­—è®¾ç½®ä¸ºsetï¼ˆè¦†ç›–ï¼‰</li></ul><p>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªè¾“å‡ºå‹å‚æ•°ã€‚å¦‚æœä¼ å…¥äº†oldsetï¼Œé‚£ä¹ˆæ—§çš„ä¿¡å·å±è”½å­—ä¼šè¢«æ”¾å…¥<code>oldset</code>ä¸­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SIG_BLOCK</span><br><span class="line">  The set of blocked signals is the union of the current set and the set argument.</span><br><span class="line"></span><br><span class="line">SIG_UNBLOCK</span><br><span class="line">  The signals in set are removed from the current set of blocked signals.  It is permissible to attempt  to  unblock  a  signal which is not blocked.</span><br><span class="line"></span><br><span class="line">SIG_SETMASK</span><br><span class="line">   The set of blocked signals is set to the argument set.</span><br><span class="line">   </span><br><span class="line">If oldset is non-NULL, the previous value of the signal mask is stored in oldset.</span><br><span class="line"></span><br><span class="line">RETURN VALUE</span><br><span class="line">       sigprocmask() returns 0 on success and -1 on error.  In the event of an error, errno is set to indicate the cause.</span><br></pre></td></tr></table></figure><p>å¦‚æœç”¨è¯¥æ¥å£æ¥è§¦äº†å¯¹æŸä¸€ä¸ªä¿¡å·çš„é˜»å¡ï¼Œé‚£ä¹ˆåœ¨è¯¥å‡½æ•°returnå‰ï¼Œè‡³å°‘å…¶ä¸­ä¸€ä¸ªæ¶ˆæ¯è¢«é€è¾¾</p><h2 id="2-8-sigpending"><a href="#2-8-sigpending" class="headerlink" title="2.8 sigpending"></a>2.8 sigpending</h2><p>è·å–å½“å‰è¿›ç¨‹çš„pendingä¿¡å·é›†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">sigpending</span><span class="params">(<span class="type">sigset_t</span> *<span class="built_in">set</span>)</span>;</span><br></pre></td></tr></table></figure><p>å‚æ•°ä¸ºä¸€ä¸ªè¾“å‡ºå‹å‚æ•°ã€‚æ­£ç¡®è·å–è¿”å›0ï¼Œå¦åˆ™-1</p><p>è¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥å†™ä¸€ä¸ªç®€å•çš„å‡½æ•°æ¥æ‰“å°å½“å‰è¿›ç¨‹çš„ä¿¡å·é›†äº†</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‰“å°ä¿¡å·é›†çš„å†…å®¹</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">showPending</span><span class="params">(<span class="type">sigset_t</span>* pdg_ptr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;<span class="number">32</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sigismember</span>(pdg_ptr,i))</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;0&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">sigset_t</span> pdg;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">sigemptyset</span>(&amp;pdg);<span class="comment">//åˆå§‹åŒ–ä¿¡å·é›†</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sigpending</span>(&amp;pdg)==<span class="number">0</span>)<span class="comment">//è·å–</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">showPending</span>(pdg);<span class="comment">//è·å–æˆåŠŸï¼Œæ‰“å°</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="built_in">getpid</span>() &lt;&lt; <span class="string">&quot; get pending err&quot;</span>&lt;&lt;endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¹‹åå¯ä»¥çœ‹åˆ°ï¼Œç¨‹åºä¸€ç›´åœ¨æ‰“å°å½“å‰è¿›ç¨‹çš„ä¿¡å·é›†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ ./tsig</span><br><span class="line">start process: 30981</span><br><span class="line">0000000000000000000000000000000</span><br><span class="line">0000000000000000000000000000000</span><br><span class="line">0000000000000000000000000000000</span><br><span class="line">0000000000000000000000000000000</span><br><span class="line">0000000000000000000000000000000</span><br><span class="line">0000000000000000000000000000000</span><br></pre></td></tr></table></figure><p>ä¸è¿‡æ­¤æ—¶æˆ‘ä»¬å¹¶æ²¡æœ‰å¯¹ä¿¡å·è¿›è¡Œå±è”½ï¼Œæ‰€ä»¥ç»™è¿™ä¸ªè¿›ç¨‹å‘ä¿¡å·ä¼šè¢«ç«‹å³å¤„ç†ï¼ˆé€’è¾¾ï¼‰ä¸èƒ½åœ¨pendingè¡¨ä¸­è§‚å¯Ÿåˆ°ç°è±¡</p><h3 id="2-8-1-å±è”½2å·ä¿¡å·"><a href="#2-8-1-å±è”½2å·ä¿¡å·" class="headerlink" title="2.8.1 å±è”½2å·ä¿¡å·"></a>2.8.1 å±è”½2å·ä¿¡å·</h3><p>æ­¤æ—¶å°è¯•ä½¿ç”¨<code>sigprocmask</code>æ¥å±è”½æŸä¸€ä¸ªä¿¡å·ï¼Œå†æ¥è§‚å¯Ÿæƒ…å†µ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//blockæ‰2å·ä¿¡å·</span></span><br><span class="line">    <span class="type">sigset_t</span> nsig,osig;</span><br><span class="line">    <span class="built_in">sigemptyset</span>(&amp;nsig);</span><br><span class="line">    <span class="built_in">sigemptyset</span>(&amp;osig);</span><br><span class="line">    <span class="built_in">sigaddset</span>(&amp;nsig,<span class="number">2</span>);<span class="comment">//åœ¨nsigä¸­è®¾ç½®2ä¸º1</span></span><br><span class="line">    <span class="built_in">sigprocmask</span>(SIG_BLOCK,&amp;nsig,&amp;osig);<span class="comment">//æ·»åŠ å±è”½</span></span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;start process: &quot;</span> &lt;&lt; <span class="built_in">getpid</span>() &lt;&lt; endl;</span><br><span class="line">    <span class="type">sigset_t</span> pdg;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">sigemptyset</span>(&amp;pdg);<span class="comment">//åˆå§‹åŒ–ä¿¡å·é›†</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sigpending</span>(&amp;pdg)==<span class="number">0</span>)<span class="comment">//è·å–</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">showPending</span>(&amp;pdg);<span class="comment">//è·å–æˆåŠŸï¼Œæ‰“å°</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="built_in">getpid</span>() &lt;&lt; <span class="string">&quot; get pending err&quot;</span>&lt;&lt;endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å½“æˆ‘ä»¬é”®å…¥<code>CTRL+C</code>çš„æ—¶å€™ï¼Œ2å·ä¿¡å·è¢«blockäº†æ²¡æœ‰å¤„ç†ï¼Œpendingè¡¨ä¸Šçš„2å·ä¿¡å·å°±ä¼šå˜ä¸º1ï¼Œä¸”å¤šæ¬¡<code>CTRL+C</code>ä¸ä¼šæœ‰å˜åŒ–</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ ./tsig</span><br><span class="line">start process: 3608</span><br><span class="line">0000000000000000000000000000000</span><br><span class="line">0000000000000000000000000000000</span><br><span class="line">^C0100000000000000000000000000000</span><br><span class="line">0100000000000000000000000000000</span><br><span class="line">0100000000000000000000000000000</span><br><span class="line">0100000000000000000000000000000</span><br><span class="line">^C0100000000000000000000000000000</span><br><span class="line">0100000000000000000000000000000</span><br></pre></td></tr></table></figure><h3 id="2-8-2-å±è”½æ‰€æœ‰ä¿¡å·"><a href="#2-8-2-å±è”½æ‰€æœ‰ä¿¡å·" class="headerlink" title="2.8.2 å±è”½æ‰€æœ‰ä¿¡å·"></a>2.8.2 å±è”½æ‰€æœ‰ä¿¡å·</h3><p>å¯ä»¥ç”¨ä¸€ä¸ªå¾ªç¯è®¾ç½®æ‰€æœ‰çš„ä¿¡å·ä½ï¼Œè®©å½“å‰è¿›ç¨‹å±è”½æ‰æ‰€æœ‰ä¿¡å·</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//blockæ‰æ‰€æœ‰ä¿¡å·</span></span><br><span class="line">    <span class="type">sigset_t</span> nsig,osig;</span><br><span class="line">    <span class="built_in">sigemptyset</span>(&amp;nsig);</span><br><span class="line">    <span class="built_in">sigemptyset</span>(&amp;osig);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;<span class="number">32</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">sigaddset</span>(&amp;nsig,i);<span class="comment">//åœ¨nsigä¸­è®¾ç½®2ä¸º1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sigprocmask</span>(SIG_BLOCK,&amp;nsig,&amp;osig);<span class="comment">//æ·»åŠ å±è”½</span></span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;start process: &quot;</span> &lt;&lt; <span class="built_in">getpid</span>() &lt;&lt; endl;</span><br><span class="line">    <span class="type">sigset_t</span> pdg;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">sigemptyset</span>(&amp;pdg);<span class="comment">//åˆå§‹åŒ–ä¿¡å·é›†</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sigpending</span>(&amp;pdg)==<span class="number">0</span>)<span class="comment">//è·å–</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">showPending</span>(&amp;pdg);<span class="comment">//è·å–æˆåŠŸï¼Œæ‰“å°</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="built_in">getpid</span>() &lt;&lt; <span class="string">&quot; get pending err&quot;</span>&lt;&lt;endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¹‹åå¯ä»¥è§‚å¯Ÿåˆ°ï¼Œä¸ç®¡ç»™è¿™ä¸ªè¿›ç¨‹å‘å‡ å·ä¿¡å·ï¼Œéƒ½ä¼šè¢«å±è”½æ˜¾ç¤ºåœ¨pendingé›†ä¸­ï¼›9å·ä¿¡å·ä¾æ—§æ˜¯è€å¤§å“¥ï¼Œä¸å—å½±å“ï¼Œä¾æ—§èƒ½å¹²æ‰è¿™ä¸ªè¿›ç¨‹</p><p><img lazyload alt="image" data-src="https://img-7758-typora.oss-cn-shanghai.aliyuncs.com/img1/202211201832576.png" alt="image-20221120183259473"></p><h3 id="2-8-3-è§£é™¤å±è”½"><a href="#2-8-3-è§£é™¤å±è”½" class="headerlink" title="2.8.3 è§£é™¤å±è”½"></a>2.8.3 è§£é™¤å±è”½</h3><p>å¦‚æœåœ¨è®¾ç½®å±è”½ä¹‹åï¼Œä¼‘çœ 15sï¼ˆåœ¨æ­¤æœŸé—´æ¥æ”¶ä¿¡å·ï¼‰å†æ¥è§¦å¯¹ä¿¡å·çš„å±è”½</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//blockæ‰æ‰€æœ‰ä¿¡å·</span></span><br><span class="line">    <span class="type">sigset_t</span> nsig,osig;</span><br><span class="line">    <span class="built_in">sigemptyset</span>(&amp;nsig);</span><br><span class="line">    <span class="built_in">sigemptyset</span>(&amp;osig);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;<span class="number">32</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">sigaddset</span>(&amp;nsig,i);<span class="comment">//åœ¨nsigä¸­è®¾ç½®2ä¸º1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sigprocmask</span>(SIG_BLOCK,&amp;nsig,&amp;osig);<span class="comment">//æ·»åŠ å±è”½</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">TestSignal</span>();<span class="comment">//è®¾ç½®ä¿¡å·è‡ªå®šä¹‰å¤„ç†</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;start process: &quot;</span> &lt;&lt; <span class="built_in">getpid</span>() &lt;&lt; endl;</span><br><span class="line">    <span class="type">sigset_t</span> pdg;</span><br><span class="line">    <span class="type">int</span> k=<span class="number">15</span>;</span><br><span class="line">    <span class="keyword">while</span>(k--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">sigemptyset</span>(&amp;pdg);<span class="comment">//åˆå§‹åŒ–ä¿¡å·é›†</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sigpending</span>(&amp;pdg)==<span class="number">0</span>)<span class="comment">//è·å–</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">showPending</span>(&amp;pdg);<span class="comment">//è·å–æˆåŠŸï¼Œæ‰“å°</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="built_in">getpid</span>() &lt;&lt; <span class="string">&quot; get pending err&quot;</span>&lt;&lt;endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ©ç”¨osigæ¢å¤ä¹‹å‰çš„blockè¡¨</span></span><br><span class="line">    <span class="built_in">sigprocmask</span>(SIG_SETMASK,&amp;osig,<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">sigemptyset</span>(&amp;pdg);<span class="comment">//åˆå§‹åŒ–ä¿¡å·é›†</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">sigpending</span>(&amp;pdg)==<span class="number">0</span>)<span class="comment">//è·å–</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">showPending</span>(&amp;pdg);<span class="comment">//è·å–æˆåŠŸï¼Œæ‰“å°</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">10</span>);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;process quit&quot;</span>&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å°±èƒ½è§‚å¯Ÿåˆ°ï¼Œä¿¡å·è¢«ç«‹é©¬å¤„ç†ï¼Œpendingè¡¨å˜ä¸ºå…¨0</p><p><img lazyload alt="image" data-src="https://img-7758-typora.oss-cn-shanghai.aliyuncs.com/img1/202211201841950.png" alt="image-20221120184159874"></p><h2 id="2-9-sigaction"><a href="#2-9-sigaction" class="headerlink" title="2.9 sigaction"></a>2.9 sigaction</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">sigaction</span><span class="params">(<span class="type">int</span> signum, <span class="type">const</span> <span class="keyword">struct</span> sigaction *act,</span></span><br><span class="line"><span class="params">			<span class="keyword">struct</span> sigaction *oldact)</span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°çš„å‚æ•°å’Œ<code>signal</code>å‡½æ•°å¾ˆç›¸ä¼¼ï¼Œä¸è¿‡éƒ½å˜ä¸ºäº†ä¸€ä¸ªç»“æ„ä½“ã€‚è¿™ä¸ªæ¥å£ä¹Ÿå¯ä»¥ç”¨æ¥å¤„ç†<code>å®æ—¶ä¿¡å·</code>ï¼ˆä¸åœ¨æ–‡æœ¬è€ƒè™‘èŒƒå›´å†…ï¼‰</p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯éœ€è¦å¤„ç†ä¿¡å·çš„ç¼–å·</li><li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯è‡ªå®šä¹‰çš„action</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¾“å‡ºå‹å‚æ•°ï¼Œå¯ä»¥è·å–åˆ°æ—§çš„å¤„ç†æ–¹æ³•</li></ul><p>è®¾ç½®æˆåŠŸåè¿”å›0ï¼Œå‡ºé”™è¿”å›-1</p><p>è¿™ä¸ªç»“æ„ä½“çš„æˆå‘˜å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sigaction</span> &#123;</span></span><br><span class="line">    <span class="type">void</span>     (*sa_handler)(<span class="type">int</span>);<span class="comment">//å¯¹ä¿¡å·çš„å¤„ç†æ–¹æ³•</span></span><br><span class="line">    <span class="type">void</span>     (*sa_sigaction)(<span class="type">int</span>, <span class="type">siginfo_t</span> *, <span class="type">void</span> *);<span class="comment">//å¯å¿½ç•¥</span></span><br><span class="line">    <span class="type">sigset_t</span>   sa_mask;<span class="comment">//å‚è€ƒ2.8ä¸­çš„å¤„ç†æ–¹æ³•</span></span><br><span class="line">    <span class="type">int</span>        sa_flags;<span class="comment">//è®¾ä¸º0</span></span><br><span class="line">    <span class="type">void</span>     (*sa_restorer)(<span class="type">void</span>);<span class="comment">//å¯å¿½ç•¥</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="2-9-1-åŸºæœ¬ä½¿ç”¨"><a href="#2-9-1-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="2.9.1 åŸºæœ¬ä½¿ç”¨"></a>2.9.1 åŸºæœ¬ä½¿ç”¨</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰“å°æ”¶åˆ°çš„ä¿¡å·</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">handler</span><span class="params">(<span class="type">int</span> signo)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;process &quot;</span> &lt;&lt; <span class="built_in">getpid</span>() &lt;&lt; <span class="string">&quot; get signal: &quot;</span> &lt;&lt; signo &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sigaction</span> nact,oact;</span><br><span class="line">    nact.sa_flags = <span class="number">0</span>;</span><br><span class="line">    nact.sa_handler = handler;</span><br><span class="line">    <span class="built_in">sigemptyset</span>(&amp;nact.sa_mask);<span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">sigaction</span>(<span class="number">2</span>,&amp;nact,&amp;oact);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;process running: &quot;</span> &lt;&lt; <span class="built_in">getpid</span>() &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¹‹åï¼Œæˆ‘ä»¬è‡ªå®šä¹‰æ•æ‰äº†2å·ä¿¡å·ï¼ŒæˆåŠŸè°ƒç”¨è‡ªå·±çš„<code>handler</code>æ–¹æ³•ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ ./tsig</span><br><span class="line">process running: 15029</span><br><span class="line">process running: 15029</span><br><span class="line">^Cprocess 15029 get signal: 2</span><br><span class="line">process running: 15029</span><br><span class="line">process running: 15029</span><br><span class="line">^Cprocess 15029 get signal: 2</span><br><span class="line">process running: 15029</span><br><span class="line">process running: 15029</span><br><span class="line">process running: 15029</span><br><span class="line">^\Quit</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ </span><br></pre></td></tr></table></figure><h3 id="2-9-2-sa-mask"><a href="#2-9-2-sa-mask" class="headerlink" title="2.9.2 sa_mask"></a>2.9.2 sa_mask</h3><p>è¿™ä¸ªæˆå‘˜æ˜¯ä¸€ä¸ª<code>sigset_t</code>ç±»å‹ï¼Œç”¨äºå½“å¤„ç†ä¸€ä¸ªä¿¡å·çš„æ—¶å€™ï¼Œè¿å¸¦å±è”½å…¶ä»–ä¿¡å·ï¼›</p><ul><li>å½“ä¸€ä¸ªè¿›ç¨‹æ­£åœ¨å¤„ç†Aä¿¡å·çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿä¼šæŠŠAä¿¡å·è‡ªåŠ¨æ·»åŠ å…¥Blockè¡¨ï¼Œå±è”½è¯¥ä¿¡å·ï¼ˆä¸å…è®¸åŒæ—¶å¤„ç†ä¸¤ä¸ªAä¿¡å·ï¼Œé¿å…ä¿¡å·Açš„<strong>é€’å½’å¼å¤„ç†</strong>ï¼‰</li></ul><p>å¦‚æœä½ æƒ³åœ¨å¤„ç†2å·ä¿¡å·çš„æ—¶å€™ï¼Œé˜»å¡æ‰3ã€4ã€5å·ä¿¡å·ï¼Œå°±å¯ä»¥å¯¹<code>sa_mask</code>è¿›è¡Œè®¾ç½®ï¼Œè®¾ç½®æ–¹æ³•å‚è€ƒ<code>2.8</code>çš„æ“ä½œ</p><p>å› ä¸ºç°åœ¨æˆ‘æ¼”ç¤ºçš„è‡ªå®šä¹‰æ–¹æ³•åªæ˜¯ä¸€ä¸ªå†ç®€å•ä¸è¿‡çš„ç¤ºä¾‹ï¼Œå®é™…ä¸Šè¿›ç¨‹æ”¶åˆ°ä¿¡å·çš„æ—¶å€™éœ€è¦æ ¹æ®ä¸åŒæƒ…å†µè¿›è¡Œä¸åŒçš„è‡ªå®šä¹‰å¤„ç†ï¼Œè¿™äº›è‡ªå®šä¹‰å¤„ç†çš„è¿‡ç¨‹å¯èƒ½ä¼šå¾ˆé•¿ã€‚æ­¤æ—¶å°±å¯ä»¥blockæ‰å…¶ä»–çš„ä¿¡å·ï¼Œ<strong>ä¸è®©å®ƒä»¬å½±å“å½“å‰è¿›ç¨‹è¿è¡Œçš„è‡ªå®šä¹‰æ–¹æ³•</strong></p><h1 id="3-è½¯ä»¶å´©æºƒçš„æœ¬è´¨"><a href="#3-è½¯ä»¶å´©æºƒçš„æœ¬è´¨" class="headerlink" title="3.è½¯ä»¶å´©æºƒçš„æœ¬è´¨"></a>3.è½¯ä»¶å´©æºƒçš„æœ¬è´¨</h1><p>ä¹‹å‰æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°è½¯ä»¶å‡ºé”™å¥”æºƒçš„æƒ…å†µï¼Œé‚£ä¹ˆå¥”æºƒçš„æœ¬è´¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><h2 id="3-1-æƒ…æ™¯æ¼”ç¤º"><a href="#3-1-æƒ…æ™¯æ¼”ç¤º" class="headerlink" title="3.1 æƒ…æ™¯æ¼”ç¤º"></a>3.1 æƒ…æ™¯æ¼”ç¤º</h2><p>ç”¨ä¸‹é¢çš„ä¸€ä¸ª<strong>é™¤é›¶é”™è¯¯</strong>ä½œä¸ºæ¼”ç¤º</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">handler</span><span class="params">(<span class="type">int</span> signo)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;process &quot;</span> &lt;&lt; <span class="built_in">getpid</span>() &lt;&lt; <span class="string">&quot; get signal: &quot;</span> &lt;&lt; signo &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TestSignal</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//å¯¹æ‰€æœ‰çš„è¿›ç¨‹ä¿¡å·éƒ½è®¾ç½®ä¸€ä¸ªå›è°ƒ</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> sig = <span class="number">1</span>; sig &lt;= <span class="number">31</span>; sig++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">signal</span>(sig, handler);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;è¿›ç¨‹ä¿¡å·å·²ç»è®¾ç½®å®Œäº†&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">TestSignal</span>();</span><br><span class="line">    <span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line">    <span class="type">int</span> b = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> c = a / b; <span class="comment">// C++çš„é™¤0ä¸æ˜¯å¼‚å¸¸ï¼Œä¸ä¼šæŠ›å‡º</span></span><br><span class="line">        <span class="comment">//æ‰€ä»¥ä¼šç›´æ¥linuxç³»ç»Ÿè¿è¡ŒæŠ¥é”™</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">catch</span> (<span class="type">const</span> exception &amp;e)</span><br><span class="line">    &#123;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;a/0 err&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">abort</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">catch</span> (...)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;base catch&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">abort</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œäº†ä¹‹åï¼Œè¯¥è¿›ç¨‹ä¼šä¸€ç›´æ”¶åˆ°8å·ä¿¡å·ï¼Œç›´åˆ°æˆ‘ä»¬æ‰‹åŠ¨killæ‰è¿™ä¸ªè¿›ç¨‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">process 3947 get signal: 8</span><br><span class="line">process 3947 get signal: 8</span><br><span class="line">process 3947 get signal: 8</span><br><span class="line">process 3947 get signal: 8</span><br><span class="line">process 3947 get signal: 8</span><br><span class="line">process 3947 get signal: 8Killed</span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½ä¼šè§‰å¾—å¥‡æ€ªï¼Œä¸æ˜¯ç”¨<code>try/catch</code>è¿›è¡Œäº†å¼‚å¸¸å¤„ç†å—ï¼Ÿä¸ºä»€ä¹ˆæ²¡æœ‰ç”¨å‘¢ï¼Ÿ</p><p>é‚£æ˜¯å› ä¸ºï¼Œåœ¨C++ä¸­ï¼Œå¹¶<strong>ä¸ä¼šå°†é™¤é›¶é”™è¯¯å½“ä½œä¸€ä¸ªå¼‚å¸¸</strong>è¿›è¡Œå¤„ç†ï¼</p><p><img lazyload alt="image" data-src="https://img-7758-typora.oss-cn-shanghai.aliyuncs.com/img1/202211031201497.gif" alt="QQå›¾ç‰‡20220413084241"></p><hr><p>æˆ‘ä»¬è‡ªå®šä¹‰æ•æ‰äº†8å·ä¿¡å·ï¼Œæ²¡èƒ½è®©è¿›ç¨‹ç»ˆæ­¢ã€‚ä½†æ­¤æ—¶è¿™ä¸ªè¿›ç¨‹å·²ç»å‡ºç°äº†ä¸€ä¸ªä¸¥é‡çš„bugï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šä¸€ç›´ç»™è¿›ç¨‹å‘è¿™ä¸ªä¿¡å·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ ./tsig</span><br><span class="line">Floating point exception</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ </span><br></pre></td></tr></table></figure><p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œå¦‚æœä¸è‡ªå®šä¹‰æ•æ‰ï¼Œåˆ™ä¼š<strong>ç›´æ¥æŠ¥é”™+ç»ˆæ­¢è¿›ç¨‹</strong>ï¼›</p><p>8å·ä¿¡å·æ˜¯<code>SIGFPE</code>ï¼ŒFPEå³ä¸º<code>Floating point exception</code>çš„ç¼©å†™ï¼</p><h2 id="3-2-è¯´æ˜"><a href="#3-2-è¯´æ˜" class="headerlink" title="3.2 è¯´æ˜"></a>3.2 è¯´æ˜</h2><p>å´©æºƒçš„æœ¬è´¨ï¼Œæ˜¯è¯¥è¿›ç¨‹æ”¶åˆ°äº†å¼‚å¸¸ä¿¡å·ï¼Œä»è€Œç»ˆæ­¢ã€‚</p><p>ä»¥é™¤é›¶é”™è¯¯ä¸ºä¾‹ï¼ŒCPUå†…éƒ¨ä¼šæœ‰ä¸€ä¸ªçŠ¶æ€å¯„å­˜å™¨ï¼Œæ£€æµ‹åˆ°ç”¨æˆ·è¿›è¡Œé™¤é›¶è®¡ç®—çš„æ—¶å€™ï¼Œä¼šå°†çŠ¶æ€å¯„å­˜å™¨è®¾ç½®ä¸º<strong>æµ®ç‚¹æ•°é”™è¯¯</strong>ã€‚å½“æ“ä½œç³»ç»Ÿæ£€æµ‹åˆ°è¿™ä¸ªé”™è¯¯çš„æ—¶å€™ï¼Œä¾¿ä¼šå‘å½“å‰<strong>æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹</strong>å‘é€8å·ä¿¡å·ã€‚è€Œæˆ‘ä»¬çš„è¿›ç¨‹åœ¨æ”¶åˆ°ä¿¡å·çš„æ—¶å€™ï¼Œä¼šå¤„ç†è¿™ä¸ªä¿¡å·ï¼Œé»˜è®¤çš„å¤„ç†æ–¹æ³•å°±æ˜¯ç»ˆæ­¢è¿›ç¨‹ï¼</p><p>åŒç†ï¼Œå½“æˆ‘ä»¬è®¿é—®ä¸€ä¸ªé‡æŒ‡é’ˆçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿèƒ½åœ¨è™šæ‹Ÿåœ°å€è½¬æ¢çš„æ—¶å€™å‘ç°è¿™ä¸ªé—®é¢˜ï¼Œå‘æˆ‘ä»¬çš„è¿›ç¨‹å‘é€11å·ä¿¡å·</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">TestSignal</span>();</span><br><span class="line">    <span class="type">int</span> *p;</span><br><span class="line">    *p=<span class="number">20</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>11) SIGSEGV</code>ä»£è¡¨<strong>æ®µé”™è¯¯</strong>ï¼Œå†™OJé¢˜ç›®çš„æ—¶å€™è¿™ä¸ªæŠ¥é”™å¾ˆå¸¸è§ğŸ˜‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">process 6754 get signal: 11</span><br><span class="line">process 6754 get signal: 11</span><br><span class="line">process 6754 get signal: 11</span><br><span class="line">process 6754 get signal: 11</span><br><span class="line">process 6754 get signal: 11Killed</span><br></pre></td></tr></table></figure><h1 id="4-coredump"><a href="#4-coredump" class="headerlink" title="4.coredump"></a>4.coredump</h1><p>åœ¨<a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/muxuen/article/details/127331290?spm=1001.2014.3001.5501">è¿›ç¨‹æ§åˆ¶<i class="fas fa-external-link-alt"></i></a>çš„åšå®¢ä¸­ï¼Œæåˆ°å½“è¿›ç¨‹å› ä¸ºä¿¡å·ç»ˆæ­¢çš„æ—¶å€™ï¼Œå…¶statusä¸­çš„0-7ä½ä¼šæ˜¯å¯¹åº”çš„ç»ˆæ­¢ä¿¡å·ï¼Œè€Œç¬¬8ä½æ˜¯è¯¥è¿›ç¨‹çš„<code>core dump</code>æ ‡è®°ä½</p><p><img lazyload alt="image" data-src="https://img-7758-typora.oss-cn-shanghai.aliyuncs.com/img1/202211201106597.png" alt="image-20221120110639470"></p><p>åœ¨<a href="#jump1">1.2</a>è´´å‡ºæ¥çš„æºç æ³¨é‡Šä¸­å¯ä»¥çœ‹åˆ°ï¼Œæœ‰ä¸å°‘ä¿¡å·çš„é»˜è®¤åŠ¨ä½œæ˜¯è¿›è¡Œ<code>core dump</code>ï¼Œæ¯”å¦‚8å·ä¿¡å·ã€‚é‚£ä¹ˆè¿™ä¸ªä¸œè¥¿åˆ°åº•æ˜¯ä»€ä¹ˆç©æ„å‘¢ï¼Ÿ</p><hr><p>é€šè¿‡forkåˆ›å»ºå­è¿›ç¨‹ï¼Œè®©å­è¿›ç¨‹é™¤é›¶äº§ç”Ÿ8å·ä¿¡å·ï¼Œå­è¿›ç¨‹é€€å‡º</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> status;</span><br><span class="line">    <span class="type">int</span> id = fork();</span><br><span class="line">    <span class="keyword">if</span>(id == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//å­è¿›ç¨‹</span></span><br><span class="line">        <span class="type">int</span> b=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> a = <span class="number">10</span>/b;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">waitpid</span>(id,&amp;status,<span class="number">0</span>);</span><br><span class="line">    <span class="comment">//æ‰“å°å­è¿›ç¨‹çš„é€€å‡ºä¿¡æ¯</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;exitcode:%d signo:%d coredump: %d\n&quot;</span>,(status&gt;&gt;<span class="number">8</span>)&amp;&amp;<span class="number">0xff</span>,status&amp;<span class="number">0x7f</span>,(status&gt;&gt;<span class="number">7</span>)&amp;<span class="number">0x1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œcoredumpæ ‡è®°ä½ä¸º0</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ ./tsig</span><br><span class="line">exitcode:0 signo:8 coredump: 0</span><br></pre></td></tr></table></figure><h2 id="4-1-å¼€å¯è¯¥åŠŸèƒ½"><a href="#4-1-å¼€å¯è¯¥åŠŸèƒ½" class="headerlink" title="4.1 å¼€å¯è¯¥åŠŸèƒ½"></a>4.1 å¼€å¯è¯¥åŠŸèƒ½</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬äº‘æœåŠ¡å™¨çš„core dumpåŠŸèƒ½æ˜¯è¢«å…³é—­çš„ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å¼€å¯ï¼›</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ <span class="built_in">ulimit</span> -a</span><br><span class="line">core file size          (blocks, -c) 0  <span class="comment">#coredumpåŠŸèƒ½è¢«å…³é—­äº†</span></span><br><span class="line">data seg size           (kbytes, -d) unlimited</span><br><span class="line">scheduling priority             (-e) 0</span><br><span class="line">file size               (blocks, -f) unlimited</span><br><span class="line">pending signals                 (-i) 14691</span><br><span class="line">max locked memory       (kbytes, -l) unlimited</span><br><span class="line">max memory size         (kbytes, -m) unlimited</span><br><span class="line">open files                      (-n) 100002</span><br><span class="line">pipe size            (512 bytes, -p) 8</span><br><span class="line">POSIX message queues     (bytes, -q) 819200</span><br><span class="line">real-time priority              (-r) 0</span><br><span class="line">stack size              (kbytes, -s) 8192</span><br><span class="line">cpu time               (seconds, -t) unlimited</span><br><span class="line">max user processes              (-u) 14691</span><br><span class="line">virtual memory          (kbytes, -v) unlimited</span><br><span class="line">file locks                      (-x) unlimited</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ </span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>ulimit -a</code>å‘½ä»¤æŒ‡å®š<code>core file</code>çš„å¤§å°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ ulimit -c 10000</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ ulimit -a</span><br><span class="line">core file size          (blocks, -c) 10000</span><br></pre></td></tr></table></figure><p>å†æ¬¡è¿è¡Œåˆšåˆšçš„ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°æ ‡è®°ä½ä¸º1ï¼Œå¹¶ä¸”äº§ç”Ÿäº†ä¸€ä¸ª<code>core.27908</code>æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶çš„åç¼€æ˜¯äº§ç”Ÿcoredumpæ–‡ä»¶çš„è¿›ç¨‹pid</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ ./tsig</span><br><span class="line">exitcode:0 signo:8 coredump: 1</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ ll</span><br><span class="line">total 292</span><br><span class="line">-rw------- 1 muxue muxue 593920 Nov 20 12:34 core.27908</span><br><span class="line">-rw-rw-r-- 1 muxue muxue    194 Nov 20 10:31 makefile</span><br><span class="line">-rw-rw-r-- 1 muxue muxue    601 Nov 20 09:57 mkill.cc</span><br><span class="line">-rw-rw-r-- 1 muxue muxue    203 Nov 20 09:56 test.cc</span><br><span class="line">-rwxrwxr-x 1 muxue muxue  13768 Nov 20 12:34 tsig</span><br><span class="line">-rw-rw-r-- 1 muxue muxue   1772 Nov 20 12:34 tsignal.cpp</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ </span><br></pre></td></tr></table></figure><p>vscodeå‘Šè¯‰æˆ‘ä»¬è¿™ä¸ªä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„æ–‡æœ¬æ–‡ä»¶</p><p><img lazyload alt="image" data-src="https://img-7758-typora.oss-cn-shanghai.aliyuncs.com/img1/202211201238772.png" alt="image-20221120123842724"></p><p>è¿™ä¸ªç°è±¡å‘Šè¯‰æˆ‘ä»¬ï¼Œé»˜è®¤åŠ¨ä½œæ˜¯coredumpçš„ä¿¡å·ï¼Œä¼šè®©è¿›ç¨‹é€€å‡ºï¼Œå°†coredumpæ ‡è®°ä½ç½®ä¸º1å¹¶ä¸”äº§ç”Ÿä¸€ä¸ª<code>core.</code>æ–‡ä»¶</p><h2 id="4-2-ä½¿ç”¨coredump"><a href="#4-2-ä½¿ç”¨coredump" class="headerlink" title="4.2 ä½¿ç”¨coredump"></a>4.2 ä½¿ç”¨coredump</h2><p>è¿™ä¸ªåŠŸèƒ½ä¼šå°†è¿›ç¨‹åœ¨è¿è¡Œä¸­äº§ç”Ÿå¼‚å¸¸çš„ä¸Šä¸‹æ–‡æ•°æ®ï¼Œæ‰§è¡Œcore dumpï¼ˆæ ¸å¿ƒè½¬å‚¨ï¼‰ä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Œæ–¹ä¾¿æˆ‘ä»¬debug</p><p>å¦‚ä¸‹æ‰€ç¤ºï¼Œä½¿ç”¨<code>-g</code>å‘½ä»¤ä»¥debugæ¨¡å¼ç¼–è¯‘<code>test.cc</code>,è¿è¡Œçš„æ—¶å€™å¯ä»¥çœ‹åˆ°é™¤é›¶é”™è¯¯ä¹‹åè·Ÿäº†ä¸€ä¸ª<code>(core dumped)</code>æç¤ºæˆ‘ä»¬è¿›è¡Œäº†core dumpæ“ä½œï¼Œå¯¹åº”äº§ç”Ÿäº†ä¸€ä¸ª<code>core.</code>æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ g++ test.cc -g -o <span class="built_in">test</span></span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ ./test</span><br><span class="line">Floating point exception (core dumped)</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™æ‰“å¼€gdbï¼Œè¾“å…¥<code>core-file æ–‡ä»¶å</code>åŠ è½½æ–‡ä»¶ï¼Œå°±å¯ä»¥ç›´æ¥å®šä½åˆ°å‡ºé”™ä»£ç çš„ä½ç½®ï¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ gdb <span class="built_in">test</span></span><br><span class="line">GNU gdb (GDB) Red Hat Enterprise Linux 7.6.1-120.el7</span><br><span class="line">Copyright (C) 2013 Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.  Type <span class="string">&quot;show copying&quot;</span></span><br><span class="line">and <span class="string">&quot;show warranty&quot;</span> <span class="keyword">for</span> details.</span><br><span class="line">This GDB was configured as <span class="string">&quot;x86_64-redhat-linux-gnu&quot;</span>.</span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/bugs/&gt;...</span><br><span class="line">Reading symbols from /home/muxue/git/linux/code/22-11-16_signal/test...done.</span><br><span class="line">(gdb) core-file core.31997</span><br><span class="line">[New LWP 31997]</span><br><span class="line"></span><br><span class="line">Core was generated by `./test<span class="string">&#x27;.</span></span><br><span class="line"><span class="string">Program terminated with signal 8, Arithmetic exception.</span></span><br><span class="line"><span class="string">#0  0x000000000040065c in main () at test.cc:13</span></span><br><span class="line"><span class="string">13          int a=10/0;</span></span><br><span class="line"><span class="string">Missing separate debuginfos, use: debuginfo-install glibc-2.17-326.el7_9.x86_64 libgcc-4.8.5-44.el7.x86_64</span></span><br><span class="line"><span class="string">(gdb) </span></span><br><span class="line"><span class="string">(gdb) </span></span><br></pre></td></tr></table></figure><p>è¿™å¯æ¯”æˆ‘ä»¬æ‰‹åŠ¨debugæ‰¾é”™è¯¯æ–¹ä¾¿å¤šäº†</p><p><img lazyload alt="image" data-src="https://img-7758-typora.oss-cn-shanghai.aliyuncs.com/img1/202211031202739.gif" alt="QQå›¾ç‰‡20220419102702"></p><h2 id="4-3-ä¸ºä»€ä¹ˆé»˜è®¤å…³é—­ï¼Ÿ"><a href="#4-3-ä¸ºä»€ä¹ˆé»˜è®¤å…³é—­ï¼Ÿ" class="headerlink" title="4.3 ä¸ºä»€ä¹ˆé»˜è®¤å…³é—­ï¼Ÿ"></a>4.3 ä¸ºä»€ä¹ˆé»˜è®¤å…³é—­ï¼Ÿ</h2><p>ä½ å¯èƒ½ä¼šè§‰å¾—ï¼Œè¿™ä¸ªåŠŸèƒ½ä¸æŒºå¥½çš„å—ï¼Œä¸ºå•¥é»˜è®¤æ²¡æœ‰å¼€å¯å‘¢ï¼Ÿ</p><p>å…ˆæ¥çœ‹çœ‹è¿™ä¸ªæ–‡ä»¶çš„å¤§å°ï¼Œè¶³è¶³æœ‰<code>580KB</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ <span class="built_in">ls</span> -lht </span><br><span class="line">total 292K</span><br><span class="line">-rw-rw-r-- 1 muxue muxue 1.8K Nov 20 12:37 tsignal.cpp</span><br><span class="line">-rw------- 1 muxue muxue 580K Nov 20 12:34 core.27908</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬è€Œè¨€ï¼ŒæœåŠ¡ç«¯è¿è¡Œçš„ä¸€äº›è¿›ç¨‹ï¼Œéƒ½éœ€è¦ä¿æŒç¨³å®šæ€§ã€‚æ¯”å¦‚Bç«™çš„æœåŠ¡å™¨æŒ‚äº†ï¼Œç¬¬ä¸€æ—¶é—´è¦åšçš„æ˜¯<strong>é‡å¯æœåŠ¡è¿›ç¨‹</strong>ï¼ˆå¹¶ä¸æ˜¯é‡å¯æœåŠ¡å™¨æœºå™¨ï¼‰</p><p>å¦‚æœè®¾ç½®äº†è¿™ä¸ªcoredumpï¼Œå½“æœåŠ¡å™¨è¿›ç¨‹å› ä¸ºé”™è¯¯é€€å‡ºçš„æ—¶å€™ï¼Œä¼šç”Ÿæˆä¸€ä¸ª<code>core.</code>æ–‡ä»¶ï¼›è¿™æ—¶å€™æœ‰ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼ˆç”¨æ¥ç›‘è§†å¹¶åŠæ—¶é‡å¯æœåŠ¡å™¨è¿›ç¨‹ï¼‰å‘ç°æœåŠ¡å™¨è¿›ç¨‹é€€å‡ºäº†ï¼Œå°±ä¼šé‡å¯å®ƒã€‚</p><p>è¿™æ—¶å€™åˆé‡åˆ°äº†åˆšåˆšé‚£ä¸ªbugï¼ŒæœåŠ¡å™¨è¿›ç¨‹åˆé€€å‡ºäº†ï¼Œå®ˆæŠ¤è¿›ç¨‹åˆæ¥é‡å¯å®ƒâ€¦â€¦</p><p>å¦‚æ­¤å¾€å¤ï¼Œå°±ä¼šç”Ÿæˆéå¸¸éå¸¸å¤šçš„<code>core.</code>æ–‡ä»¶ï¼Œå¡æ»¡æˆ‘ä»¬çš„ç¡¬ç›˜ã€‚</p><p>å¯¹äº<strong>æ±‚ç¨³</strong>ä¸ºä¸»çš„æœåŠ¡å™¨è€Œè¨€ï¼Œè¿™å¯ä¸æ˜¯ä¸€ä¸ªå¥½äº‹ã€‚æ‰€ä»¥äº‘æœåŠ¡å™¨ä¸Šé»˜è®¤ç¦æ­¢äº†è¿™ä¸ªåŠŸèƒ½ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ ulimit -c 0</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ ulimit -a</span><br><span class="line">core file size          (blocks, -c) 0</span><br></pre></td></tr></table></figure><p>ç”¨<code>umlimit -c 0</code>æŒ‡å®šå¤§å°ä¸º0å…³é—­è¯¥åŠŸèƒ½</p><hr><h1 id="5-è¿›ç¨‹å¤„ç†ä¿¡å·"><a href="#5-è¿›ç¨‹å¤„ç†ä¿¡å·" class="headerlink" title="5.è¿›ç¨‹å¤„ç†ä¿¡å·"></a>5.è¿›ç¨‹å¤„ç†ä¿¡å·</h1><p>å‰é¢å…«å…«äº†è¿™ä¹ˆä¸€å¤§å †ï¼Œè¿›ç¨‹åˆ°åº•æ˜¯ä»€ä¹ˆæ—¶å€™æ¥å¤„ç†ä¿¡å·çš„å‘¢ï¼Ÿ</p><ul><li>å¼€é—¨è§å±±ï¼šè¿›ç¨‹ä»å†…æ ¸æ€åˆ‡æ¢æˆç”¨æˆ·æ€çš„æ—¶å€™ï¼Œå¤„ç†ä¿¡å·</li></ul><h2 id="5-1-å†…æ ¸æ€-x2F-ç”¨æˆ·æ€"><a href="#5-1-å†…æ ¸æ€-x2F-ç”¨æˆ·æ€" class="headerlink" title="5.1 å†…æ ¸æ€&#x2F;ç”¨æˆ·æ€"></a>5.1 å†…æ ¸æ€&#x2F;ç”¨æˆ·æ€</h2><p>åœ¨ç¨‹åºåœ°å€ç©ºé—´çš„åšå®¢ä¸­ï¼Œæåˆ°äº†æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰1gbçš„å†…æ ¸ç©ºé—´ï¼›è¯¥å†…æ ¸ç©ºé—´ç”¨äºå†…æ ¸çº§é¡µè¡¨çš„æ˜ å°„ï¼Œå³æ˜ å°„æ“ä½œç³»ç»Ÿçš„ç‰©ç†å†…å­˜ï¼</p><p><img lazyload alt="image" data-src="https://img-7758-typora.oss-cn-shanghai.aliyuncs.com/img1/202211201852239.png" alt="image-20221120185234159"></p><p>æœ‰å†…æ ¸çº§é¡µè¡¨çš„å­˜åœ¨ï¼Œæ— è®ºè¿›ç¨‹æ€ä¹ˆåˆ‡æ¢ï¼Œéƒ½èƒ½æ‰¾åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸çš„ä»£ç å’Œæ•°æ®ï¼Œå‰ææ˜¯æœ‰æƒé™è®¿é—®ã€‚</p><ul><li>CPUä¸­çš„CR3çŠ¶æ€å¯„å­˜å™¨ä¼šæ ‡è¯†å½“å‰è¿›ç¨‹å¤„äºå†…æ ¸æ€è¿˜æ˜¯ç”¨æˆ·æ€</li><li>å†…æ ¸æ€å¯ä»¥è®¿é—®æ‰€æœ‰ä»£ç å’Œæ•°æ®ï¼Œæƒé™æœ€é«˜</li><li>ç”¨æˆ·æ€åªèƒ½è®¿é—®å½“å‰è¿›ç¨‹è‡ªå·±çš„æ•°æ®</li></ul><p>å½“æˆ‘ä»¬è¿›ç¨‹éœ€è¦æ‰§è¡Œå†…æ ¸æ¥å£çš„æ—¶å€™ï¼Œå°±éœ€è¦å°†è¿›ç¨‹åˆ‡æ¢ä¸ºå†…æ ¸æ€ï¼›è¿è¡Œå®Œæ¯•ä¹‹åï¼Œåˆ‡æ¢å›ç”¨æˆ·æ€ã€‚</p><p>å½“æˆ‘ä»¬è¿›ç¨‹å‡ºç°äº†å¼‚å¸¸ï¼Œä¼šä»ç”¨æˆ·æ€åˆ‡æ¢æˆå†…æ ¸æ€ï¼Œç”±æ“ä½œç³»ç»Ÿæ£€æµ‹ç›¸å…³å¼‚å¸¸å¹¶å‘è¿›ç¨‹å‘é€å¯¹åº”ä¿¡å·ã€‚</p><p>å½“æˆ‘ä»¬è¿›ç¨‹çš„<strong>æ—¶é—´ç‰‡</strong>åˆ°äº†ï¼ˆéœ€è¦åˆ‡æ¢è¿›ç¨‹ï¼‰ä¹Ÿä¼šä»ç”¨æˆ·æ€è½¬ä¸ºå†…æ ¸æ€ï¼Œç”±æ“ä½œç³»ç»Ÿæ¥è¿›è¡Œè¿›ç¨‹åˆ‡æ¢ã€‚</p><h2 id="5-2-ä¿¡å·æ£€æµ‹"><a href="#5-2-ä¿¡å·æ£€æµ‹" class="headerlink" title="5.2 ä¿¡å·æ£€æµ‹"></a>5.2 ä¿¡å·æ£€æµ‹</h2><p>å½“è¿›ç¨‹ä»å†…æ ¸æ€åˆ‡æ¢å›ç”¨æˆ·æ€çš„æ—¶å€™ï¼Œ<strong>ä¼šè¿›è¡Œä¿¡å·çš„æ£€æµ‹å’Œå¤„ç†</strong>ã€‚æ­¤æ—¶åˆ¤æ–­pendingè¡¨ä¸­æ˜¯å¦æœ‰æœªå¤„ç†ä¿¡å·ï¼Œä»¥åŠè¯¥ä¿¡å·æ˜¯å¦æœ‰è¢«blockã€‚å¦‚æœä¸€ä¸ªä¿¡å·æ²¡æœ‰è¢«blockï¼Œåˆ™å°†è¯¥ä¿¡å·é€’è¾¾ç»™è¿›ç¨‹ï¼Œæ‰§è¡Œå¯¹åº”çš„å¤„ç†æ–¹æ³•</p><ul><li>æ‰§è¡Œç”¨æˆ·çš„è‡ªå®šä¹‰æ–¹æ³•æ—¶ï¼Œåº”è¯¥ä»¥ä»€ä¹ˆèº«ä»½æ‰§è¡Œï¼Ÿ</li></ul><p>æ³¨æ„ï¼Œå½“æˆ‘ä»¬ç»™ä¸€ä¸ªä¿¡å·æŒ‡å®šäº†è‡ªå®šä¹‰å¤„ç†æ–¹æ³•ï¼Œå°±ä»£è¡¨è¯¥ä¿¡å·çš„å¤„ç†æ–¹æ³•æ˜¯<strong>ç”¨æˆ·æä¾›çš„</strong>ã€‚æ­¤æ—¶éœ€è¦ä»¥ç”¨æˆ·çš„èº«ä»½å»æ‰§è¡Œè¿™ä¸ªä»£ç ï¼Œæ‰èƒ½æ­£ç¡®è®¿é—®ç”¨æˆ·çº§é¡µè¡¨ã€‚</p><p>è¿™ä¹ˆåšä¹Ÿèƒ½<strong>é¿å…æ¶æ„ä»£ç </strong>çš„æ³¨å…¥ã€‚å¦‚æœæœ‰äººåœ¨è‡ªå®šä¹‰æ–¹æ³•ä¸­å†™ä¸€ä¸ªä¿®æ”¹ç³»ç»Ÿå†…æ ¸çš„æ¶æ„ä»£ç ï¼Œä¹Ÿèƒ½è¢«æ“ä½œç³»ç»Ÿå‘ç°å¹¶é˜»æ­¢ã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç”¨ä¸‹é¢è¿™å¼ å›¾æ¥è§£é‡Šï¼ˆå¹¶éå®Œæ•´è¿‡ç¨‹ï¼Œä»…ä¾›å‚è€ƒç†è§£ï¼‰</p><p><img lazyload alt="image" data-src="https://img-7758-typora.oss-cn-shanghai.aliyuncs.com/img1/202211211425321.png" alt="image-20221121142458166"></p><p>æ¯æ¬¡å¤„ç†å®Œä¿¡å·åï¼Œä¼šè¿”å›ç”¨æˆ·è¿›ç¨‹ï¼Œä»ä¸Šä¸€æ¬¡ä¸­æ–­çš„ä½ç½®å¼€å§‹ç»§ç»­å¾€åè¿è¡Œ</p><h1 id="6-å¯é‡å…¥å‡½æ•°"><a href="#6-å¯é‡å…¥å‡½æ•°" class="headerlink" title="6.å¯é‡å…¥å‡½æ•°"></a>6.å¯é‡å…¥å‡½æ•°</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¤´æ’</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">insert</span><span class="params">(Node* p)</span></span><br><span class="line">&#123;</span><br><span class="line">	p-&gt;next=head;</span><br><span class="line">	head=p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„é“¾è¡¨å¤´æ’å‡½æ•°</p><p>å¦‚æœæˆ‘ä»¬è¿™ä¸ªå¤´æ’å‡½æ•°å¤„ç†çš„æ˜¯ä¸€ä¸ªå…¨å±€çš„é“¾è¡¨ï¼Œå°±å¯èƒ½ä¼šå› ä¸ºç”¨æˆ·æ€ã€å†…æ ¸æ€çš„åˆ‡æ¢ï¼Œ<strong>å‡½æ•°é‡å…¥é€ æˆé”™è¯¯</strong></p><p><img lazyload alt="image" data-src="https://img-7758-typora.oss-cn-shanghai.aliyuncs.com/img1/202211212114593.png" alt="image-20221121211426452"></p><p>æ‰€ä»¥<code>insert</code>å°±æ˜¯ä¸€ä¸ª<strong>ä¸å¯é‡å…¥å‡½æ•°</strong>ï¼é™¤äº†è¿™ä¸ªå¤´æ’ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„å‡½æ•°ä¹Ÿç¬¦åˆè¿™ä¸ªç‰¹æ•ˆï¼š</p><ul><li>è°ƒç”¨äº†mallocæˆ–è€…freeï¼ˆå¯èƒ½ä¼šå¤šæ¬¡mallocå’Œå¤šæ¬¡freeï¼‰</li><li>è°ƒç”¨äº†I&#x2F;Oåº“çš„å‡½æ•°</li><li>ç»å¤§å¤šæ•°åº“å‡½æ•°éƒ½æ˜¯ä¸å¯é‡å…¥çš„ï¼Œæ¯”å¦‚C++çš„STLåº“</li></ul><p>ä¾æ­¤ç±»æ¨ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°åªè®¿é—®ä»–è‡ªå·±çš„å±€éƒ¨å˜é‡ï¼Œä¸ä¼šå½±å“å…¶ä»–å‚æ•°ã€‚é‚£ä¹ˆä»–å°±æ˜¯ä¸€ä¸ª<strong>å¯é‡å…¥å‡½æ•°</strong></p><h2 id="6-1-åŸå­æ“ä½œ"><a href="#6-1-åŸå­æ“ä½œ" class="headerlink" title="6.1 åŸå­æ“ä½œ"></a>6.1 åŸå­æ“ä½œ</h2><p>æ‰€è°“åŸå­æ“ä½œæ˜¯æŒ‡ä¸ä¼šè¢« <code>çº¿ç¨‹è°ƒåº¦</code> æœºåˆ¶æ‰“æ–­çš„æ“ä½œï¼›è¿™ç§æ“ä½œä¸€æ—¦å¼€å§‹ï¼Œå°±ä¸€ç›´è¿è¡Œåˆ°ç»“æŸï¼Œä¸­é—´ä¸ä¼šæœ‰ä»»ä½• <code>context switch ï¼ˆåˆ‡æ¢åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼‰</code></p><ul><li>å¦‚æœä¸€ä¸ªå‡½æ•°è¿›è¡Œäº†å¯¹å…¨å±€å˜é‡çš„åŸå­æ“ä½œï¼Œé‚£ä¹ˆå®ƒä¹Ÿæ˜¯<strong>å¯é‡å…¥</strong>çš„å‡½æ•°ã€‚å› ä¸ºåŸå­æ“ä½œä¸åŒ…å«ä¸­é—´æ€</li><li>å¦‚æœä¸€ä¸ªå‡½æ•°å¯¹å…¨å±€å˜é‡è¿›è¡Œäº†éåŸå­æ“ä½œï¼ˆæ¯”å¦‚ä¸Šé¢çš„é“¾è¡¨å¤´æ’ï¼‰é‚£ä¹ˆä»–å°±æ˜¯ä¸€ä¸ªä¸å¯é‡å…¥å‡½æ•°</li></ul><h1 id="7-volatile"><a href="#7-volatile" class="headerlink" title="7.volatile"></a>7.volatile</h1><p>ä¹‹å‰çš„å­¦ä¹ ä¸­å°±å·²ç»çŸ¥é“ï¼Œè¿™ä¸ªå…³é”®å­—çš„ä½œç”¨æ˜¯æ¯ä¸€æ¬¡è®¿é—®å˜é‡çš„æ—¶å€™ï¼Œ<strong>éƒ½å¿…é¡»è¦å»å†…å­˜ä¸­å–</strong>ã€‚</p><hr><p>å‡è®¾æˆ‘ä»¬è¿›ç¨‹ä¸­éœ€è¦é€šè¿‡ä¸€ä¸ª<strong>å…¨å±€å˜é‡</strong>è¿›è¡Œ<strong>æ¡ä»¶åˆ¤æ–­</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> flag=<span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(flags)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//..</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//..</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬<strong>è‡ªå®šä¹‰æ•æ‰</strong>äº†ä¸€ä¸ªä¿¡å·ï¼Œæ”¶åˆ°è¯¥ä¿¡å·çš„æ—¶å€™ï¼Œä¼šä¿®æ”¹flagï¼Œæ‰§è¡Œif&#x2F;elseè¯­å¥ä¸­å¯¹åº”çš„ä»£ç ã€‚</p><p>ç”±äº<strong>ç¼–è¯‘å™¨çš„ä¼˜åŒ–é—®é¢˜</strong>ï¼Œæ¯ä¸€æ¬¡è®¿é—®flagçš„æ—¶å€™ï¼Œå®ƒå¯èƒ½ä¸ä¼šæ¯æ¬¡éƒ½å»å†…å­˜ä¸­å–ï¼Œå°±ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜</p><ul><li>å¯„å­˜å™¨ä¸­ flag&#x3D;0</li><li>ç»è¿‡è‡ªå®šä¹‰æ•æ‰å‡½æ•°å¤„ç†ï¼Œå†…å­˜ä¸­ flag&#x3D;1</li></ul><p>è¿™ä¸¤ä¸ªflagåœ¨ifæ¡ä»¶ä¸­ä¼šå¯¼å‘ä¸åŒçš„ç»“æœï¼</p><p>ä¸ºäº†é¿å…è¿™ç§å¯èƒ½å› ä¸ºå¹³å°ã€ç¼–è¯‘å™¨ã€ä¼˜åŒ–é—®é¢˜å¯¼è‡´çš„ä»£ç bugï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰æ‰€æœ‰ç¼–è¯‘å™¨ï¼Œä¸å‡†å¯¹flagå˜é‡åšä»»ä½•ä¼˜åŒ–å¤„ç†ï¼Œå¿…é¡»è¦è€è€å®å®çš„å»å†…å­˜ä¸­æ‹¿è¿™ä¸ªå˜é‡çš„æ•°æ®ï¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//volatileä¿æŒå†…å­˜çš„å¯è§æ€§</span></span><br><span class="line"><span class="keyword">volatile</span> <span class="type">int</span> flag = <span class="number">0</span>;</span><br></pre></td></tr></table></figure><h2 id="7-1-ç¤ºä¾‹"><a href="#7-1-ç¤ºä¾‹" class="headerlink" title="7.1 ç¤ºä¾‹"></a>7.1 ç¤ºä¾‹</h2><blockquote><p>gccç¼–è¯‘å™¨å¯ä»¥é€šè¿‡<code>-O2</code>æŒ‡å®šè¾ƒé«˜çš„ä¼˜åŒ–ç­‰çº§</p></blockquote><p>ä»¥ä¸‹é¢çš„ä»£ç ä¸ºä¾‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿æŒå†…å­˜çš„å¯è§æ€§</span></span><br><span class="line"><span class="type">int</span> flag = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">handler</span><span class="params">(<span class="type">int</span> signo)</span></span><br><span class="line">&#123;</span><br><span class="line">    flag = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\næ›´æ”¹flags: 0-&gt;1\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;   </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;process start %d\n&quot;</span>,getpid());</span><br><span class="line">    signal(<span class="number">2</span>, handler);<span class="comment">//è‡ªå®šä¹‰æ•æ‰2å·ä¿¡å·</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!flag)</span><br><span class="line">        ;<span class="comment">//å•¥äº‹ä¸å¹²çš„å¾ªç¯</span></span><br><span class="line">    </span><br><span class="line">   	<span class="built_in">printf</span>(<span class="string">&quot;process exit!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¹‹åï¼Œé”®å…¥<code>CTRL+C</code>ï¼Œä½ ä¼šå‘ç°è¿›ç¨‹ä¾æ—§æ²¡æœ‰é€€å‡ºï¼ç†è®ºä¸Šæ¥è¯´<code>flags=1</code>ï¼Œ<code>!flags</code>ä¸ºå‡ï¼Œåº”ç»ˆæ­¢å¾ªç¯ï¼Œé€€å‡ºè¿›ç¨‹æ‰å¯¹ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-21_volatile]$ gcc test.c -o test -O2</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-21_volatile]$ ./test</span><br><span class="line">process start 22333</span><br><span class="line">^C</span><br><span class="line">æ›´æ”¹flags: 0-&gt;1</span><br><span class="line">^C</span><br><span class="line">æ›´æ”¹flags: 0-&gt;1</span><br><span class="line">^C</span><br><span class="line">æ›´æ”¹flags: 0-&gt;1</span><br><span class="line">^C</span><br><span class="line">æ›´æ”¹flags: 0-&gt;1</span><br><span class="line">^\Quit</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-21_volatile]$ </span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬åŠ ä¸Š<code>volatile</code>å…³é”®å­—ï¼Œåˆ™ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œè¿›ç¨‹èƒ½å¤Ÿæ­£å¸¸é€€å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-21_volatile]$ gcc test.c -o test -O2</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-21_volatile]$ ./test</span><br><span class="line">process start 23086</span><br><span class="line">^C</span><br><span class="line">æ›´æ”¹flag: 0-&gt;1</span><br><span class="line">process exit!</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-21_volatile]$ </span><br></pre></td></tr></table></figure><p>å»æ‰gccç¼–è¯‘å™¨çš„ä¼˜åŒ–å‚æ•°ï¼Œå»æ‰<code>volatile</code>å…³é”®å­—ï¼Œä¼šå‘ç°è¿›ç¨‹ä¹Ÿèƒ½æ­£å¸¸é€€å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-21_volatile]$ gcc test.c -o test</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-21_volatile]$ ./test</span><br><span class="line">process start 23224</span><br><span class="line">^C</span><br><span class="line">æ›´æ”¹flag: 0-&gt;1</span><br><span class="line">process exit!</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-21_volatile]$ </span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯ç¼–è¯‘å™¨ä¼˜åŒ–ä¸åŒçš„å½±å“ï¼åŠ ä¸Švolatileå…³é”®å­—èƒ½é¿å…è¿™ä¸ªé—®é¢˜ï¼Œä½¿ä»£ç è¿è¡Œèƒ½æœ‰å”¯ä¸€ç»“æœï¼</p><h1 id="8-å­è¿›ç¨‹å‘é€ä¿¡å·"><a href="#8-å­è¿›ç¨‹å‘é€ä¿¡å·" class="headerlink" title="8.å­è¿›ç¨‹å‘é€ä¿¡å·"></a>8.å­è¿›ç¨‹å‘é€ä¿¡å·</h1><p><strong>å½“å­è¿›ç¨‹çš„çŠ¶æ€å˜åŒ–çš„æ—¶å€™</strong>ï¼Œä¼šå‘çˆ¶è¿›ç¨‹å‘é€17å·ä¿¡å·</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">testfork</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> status;</span><br><span class="line">    <span class="type">int</span> id = fork();</span><br><span class="line">    <span class="keyword">if</span>(id == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//å­è¿›ç¨‹</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;chlid process: &quot;</span> &lt;&lt;<span class="built_in">getpid</span>()&lt;&lt;endl;</span><br><span class="line">        <span class="type">int</span> b=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> a = <span class="number">10</span>/b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">TestSignal</span>();</span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">waitpid</span>(id,&amp;status,<span class="number">0</span>);</span><br><span class="line">    <span class="comment">//æ‰“å°å­è¿›ç¨‹çš„é€€å‡ºä¿¡æ¯</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;exitcode:%d signo:%d coredump: %d\n&quot;</span>,(status&gt;&gt;<span class="number">8</span>)&amp;&amp;<span class="number">0xff</span>,status&amp;<span class="number">0x7f</span>,(status&gt;&gt;<span class="number">7</span>)&amp;<span class="number">0x1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§‚å¯Ÿç»“æœï¼Œå¯ä»¥çœ‹åˆ°çˆ¶è¿›ç¨‹æ”¶åˆ°äº†å­è¿›ç¨‹çš„17å·ä¿¡å·ï¼Œæ­¤æ—¶å­è¿›ç¨‹å› ä¸º<strong>é”™è¯¯é€€å‡º</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ ./tsig</span><br><span class="line">è¿›ç¨‹ä¿¡å·å·²ç»è®¾ç½®å®Œäº†</span><br><span class="line">chlid process: 25319</span><br><span class="line">process 25318 get signal: 17</span><br><span class="line">exitcode:0 signo:8 coredump: 0</span><br><span class="line">[muxue@bt-7274:~/git/linux/code/22-11-16_signal]$ </span><br></pre></td></tr></table></figure><p>é™¤äº†é€€å‡ºæ—¶ä¼šå‘é€ä¿¡å·ï¼Œå­è¿›ç¨‹æš‚åœã€ç»§ç»­è¿è¡Œçš„æ—¶å€™ï¼Œéƒ½ä¼šå‘çˆ¶è¿›ç¨‹å‘é€ä¿¡å·</p><p><img lazyload alt="image" data-src="https://img-7758-typora.oss-cn-shanghai.aliyuncs.com/img1/202211212153388.png" alt="image-20221121215300234"></p><h2 id="8-1-çˆ¶è¿›ç¨‹å›æ”¶å­è¿›ç¨‹"><a href="#8-1-çˆ¶è¿›ç¨‹å›æ”¶å­è¿›ç¨‹" class="headerlink" title="8.1 çˆ¶è¿›ç¨‹å›æ”¶å­è¿›ç¨‹"></a>8.1 çˆ¶è¿›ç¨‹å›æ”¶å­è¿›ç¨‹</h2><p>æ—¢ç„¶çˆ¶è¿›ç¨‹èƒ½æ”¶å–åˆ°å­è¿›ç¨‹å‘é€çš„ä¿¡å·ï¼Œé‚£ä¹ˆæˆ‘ä»¬è‡ªå®šä¹‰æ•æ‰17å·ä¿¡å·ï¼Œåœ¨å…¶ä¸­è°ƒç”¨<code>waitpid</code>ï¼Œå³å¯åœ¨å­è¿›ç¨‹å‡ºé”™æˆ–æ‰§è¡Œå®Œæ¯•éœ€è¦é€€å‡ºçš„æ—¶å€™ï¼Œè¿›è¡Œçˆ¶è¿›ç¨‹å›æ”¶</p><blockquote><p>è¿™æ ·å°±ä¸éœ€è¦åœ¨mainå‡½æ•°ä¸­è¿›è¡Œä¸»åŠ¨waitäº†</p></blockquote><p>æ“ä½œå¹¶ä¸éš¾ï¼Œæˆ‘ä»¬åªéœ€è¦å°†17å·ä¿¡å·è¿›è¡Œè‡ªå®šä¹‰æ•æ‰ï¼Œåœ¨æ•æ‰å‡½æ•°ä¸­æ‰§è¡Œ<code>waitpid</code>è¿›è¡Œç­‰å¾…å³å¯</p><ul><li>æ³¨æ„ï¼šè¿™é‡Œçš„waitpidå¿…é¡»ä½¿ç”¨<code>WNOHANG</code>è¿›è¡Œéé˜»å¡ç­‰å¾…</li><li>å½“çˆ¶è¿›ç¨‹æ­£åœ¨é˜»å¡ç­‰å¾…å­è¿›ç¨‹Açš„æ—¶å€™ï¼Œå®ƒåœ¨å¤„ç†17å·ä¿¡å·ï¼Œæ–°çš„17å·ä¿¡å·æ— æ³•æ”¶åˆ°</li><li>è¿™å°±ä¼šå¯¼è‡´åœ¨Aä¹‹åç§å­çš„å­è¿›ç¨‹ï¼Œæ— æ³•å‘çˆ¶è¿›ç¨‹å‘é€æœ‰æ•ˆçš„17å·ä¿¡å·</li><li>ä»è€Œå‡ºç°äº†åƒµå°¸è¿›ç¨‹ï¼ˆæœªå›æ”¶çš„å­è¿›ç¨‹ï¼‰</li></ul><p>ä½¿ç”¨<strong>éé˜»å¡ç­‰å¾…</strong>ï¼Œå³å¯ä»¥é¿å…æ­¤é—®é¢˜ï¼Œåˆèƒ½è®©çˆ¶è¿›ç¨‹åœ¨ç­‰å¾…çš„è¿‡ç¨‹ä¸­å¤„ç†è‡ªå·±çš„å…¶ä»–å·¥ä½œï¼Œä¸€ä¸¾ä¸¤å¾—ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FreeChld</span><span class="params">(<span class="type">int</span> signo)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">assert</span>(signo == SIGCHLD);</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœæ²¡æœ‰å­è¿›ç¨‹äº†ï¼Œwaitpidå°±ä¼šè°ƒç”¨å¤±è´¥</span></span><br><span class="line">        <span class="type">pid_t</span> id = <span class="built_in">waitpid</span>(<span class="number">-1</span>, <span class="literal">nullptr</span>, WNOHANG); <span class="comment">// éé˜»å¡ç­‰å¾…</span></span><br><span class="line">        <span class="keyword">if</span> (id &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;çˆ¶è¿›ç¨‹ç­‰å¾…æˆåŠŸ, child pid: &quot;</span> &lt;&lt; id &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(id == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//è¿˜æœ‰å­è¿›ç¨‹æ²¡æœ‰é€€å‡º</span></span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;å°šæœ‰æœªé€€å‡ºçš„å­è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹ç»§ç»­è¿è¡Œ&quot;</span> &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;çˆ¶è¿›ç¨‹ç­‰å¾…æ‰€æœ‰å­è¿›ç¨‹ç»“æŸ&quot;</span> &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">signal</span>(SIGCHLD, FreeChld);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">pid_t</span> id = fork();</span><br><span class="line">        <span class="keyword">if</span> (id == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//å­è¿›ç¨‹</span></span><br><span class="line">            <span class="type">int</span> cnt = <span class="number">8</span>;</span><br><span class="line">            <span class="keyword">while</span> (cnt)</span><br><span class="line">            &#123;</span><br><span class="line">                cout &lt;&lt; <span class="string">&quot;å­è¿›ç¨‹ pid: &quot;</span> &lt;&lt; <span class="built_in">getpid</span>() &lt;&lt; <span class="string">&quot; cnt: &quot;</span> &lt;&lt; cnt-- &lt;&lt; endl;</span><br><span class="line">                <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;å­è¿›ç¨‹é€€å‡ºï¼Œè¿›å…¥åƒµå°¸çŠ¶æ€: &quot;</span> &lt;&lt; i &lt;&lt; endl;</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;çˆ¶è¿›ç¨‹æ­£åœ¨è¿è¡Œ: &quot;</span> &lt;&lt; <span class="built_in">getpid</span>() &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹å³å›¾ä¸­ï¼Œç¬¬0ä¸ªå­è¿›ç¨‹é€€å‡ºè¿›å…¥å°†æ˜¯çŠ¶æ€ï¼Œçˆ¶è¿›ç¨‹æ”¶åˆ°17å·ä¿¡å·ï¼Œå°±å¼€å§‹å›æ”¶å­è¿›ç¨‹ã€‚æ­¤æ—¶è¿˜æœ‰4ä¸ªå­è¿›ç¨‹æ²¡æœ‰è¿è¡Œå®Œæ¯•ï¼Œçˆ¶è¿›ç¨‹ä¼šç»§ç»­è¿è¡Œï¼Œç­‰å¾…å…¶ä»–å­è¿›ç¨‹ç»“æŸ</p><p><img lazyload alt="image" data-src="https://img-7758-typora.oss-cn-shanghai.aliyuncs.com/img1/202212141036517.png" alt="image-20221214103626344"></p><p>å½“æ‰€æœ‰å­è¿›ç¨‹éƒ½ç­‰å¾…ç»“æŸäº†ï¼Œ<code>waitpid</code>è¿”å›-1è®©çˆ¶è¿›ç¨‹é€€å‡ºå›æ”¶å­è¿›ç¨‹çš„å¾ªç¯ï¼Œç°åœ¨å°±åªæœ‰çˆ¶è¿›ç¨‹è‡ªå·±åœ¨å¹²æ´»äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> :; <span class="keyword">do</span> ps jax | <span class="built_in">head</span> -1 &amp;&amp; ps jax | grep <span class="built_in">test</span> | grep -v grep;<span class="built_in">sleep</span> 1; <span class="built_in">echo</span> <span class="string">&quot;########################&quot;</span>; <span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>ååº”åˆ°ç›‘æ§ä¿¡æ¯ä¸Šï¼Œçˆ¶è¿›ç¨‹å…ˆæ˜¯åˆ›å»ºäº†5ä¸ªå­è¿›ç¨‹</p><p><img lazyload alt="image" data-src="https://img-7758-typora.oss-cn-shanghai.aliyuncs.com/img1/202212141039571.png" alt="image-20221214103938520"></p><p>éšåå½“ç¬¬ä¸€ä¸ªå­è¿›ç¨‹é€€å‡ºçš„æ—¶å€™ï¼Œçˆ¶è¿›ç¨‹å¼€å§‹å›æ”¶å­è¿›ç¨‹ã€‚è¿™é‡Œä¹Ÿèƒ½è§‚æµ‹åˆ°ï¼Œå›æ”¶æˆåŠŸï¼Œå¹¶æ²¡æœ‰å‡ºç°<strong>åƒµå°¸çŠ¶æ€</strong>çš„å­è¿›ç¨‹ã€‚</p><p><img lazyload alt="image" data-src="https://img-7758-typora.oss-cn-shanghai.aliyuncs.com/img1/202212141042670.png" alt="image-20221214104215559"></p><h2 id="8-2-çˆ¶è¿›ç¨‹å¿½ç•¥å­è¿›ç¨‹"><a href="#8-2-çˆ¶è¿›ç¨‹å¿½ç•¥å­è¿›ç¨‹" class="headerlink" title="8.2 çˆ¶è¿›ç¨‹å¿½ç•¥å­è¿›ç¨‹"></a>8.2 çˆ¶è¿›ç¨‹å¿½ç•¥å­è¿›ç¨‹</h2><p>å‰é¢æåˆ°è¿‡ï¼Œ<code>SIG_IGN</code>çš„ä½œç”¨æ˜¯å¿½ç•¥è¿™ä¸ªå­è¿›ç¨‹ï¼›ä½ å¯èƒ½ä¼šæƒ³ï¼Œè¿™ä¸å¯¹å•Šï¼Œå¿½ç•¥äº†å­è¿›ç¨‹çš„ä¿¡å·ï¼Œé‚£å²‚ä¸æ˜¯çˆ¶è¿›ç¨‹ä¸æƒ³æ­ç†å­è¿›ç¨‹äº†å—ï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*	|  SIGCHLD           |	ignore   	|</span><br></pre></td></tr></table></figure><p>æŸ¥<code>1.2</code>è¡¨ä½ è¿˜ä¼šå‘ç°ï¼ŒSIGCHLDçš„<strong>é»˜è®¤åŠ¨ä½œ</strong>ä¸å°±æ˜¯å¿½ç•¥å—ï¼Ÿè‡ªå·±è®¾ç½®ä¸€ä¸‹æ˜¯ä¸æ˜¯å¤šæ­¤ä¸€ä¸¾ï¼Ÿ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">signal(SIGCHLD, SIG_IGN);</span><br></pre></td></tr></table></figure><p>ç„¶å¹¶ä¸æ˜¯è¿™æ ·ï¼Œå¯¹äº<code>SIGCHLD</code>17å·ä¿¡å·è€Œè¨€ï¼Œæˆ‘ä»¬ç»™çˆ¶è¿›ç¨‹è®¾ç½®äº†æ‰‹åŠ¨å¿½ç•¥åï¼Œå­è¿›ç¨‹é€€å‡ºçš„æ—¶å€™å°†<strong>è‡ªåŠ¨è¢«å›æ”¶</strong></p><p>è¿™ä¹ˆåšçš„å‰æï¼Œæ˜¯çˆ¶è¿›ç¨‹ä¸éœ€è¦å’Œå­è¿›ç¨‹åœ¨å›æ”¶èµ„æºçš„æ—¶å€™è¿›è¡Œå¤„ç†ï¼Œè¯´äººè¯å°±æ˜¯ï¼Œ<strong>åªè¦çˆ¶è¿›ç¨‹ä¸æƒ³ç®¡ä»»ä½•å­è¿›ç¨‹çš„å·¥ä½œ</strong>ï¼Œé‚£å°±å¯ä»¥ç›´æ¥æŠŠ17å·ä¿¡å·æ‰‹åŠ¨è®¾ç½®æˆ<code>SIG_IGN</code></p><p><img lazyload alt="image" data-src="https://img-7758-typora.oss-cn-shanghai.aliyuncs.com/img1/202211031201497.gif" alt="QQå›¾ç‰‡20220413084241"></p><h1 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h1><p>è¿›ç¨‹ä¿¡å·åˆ°è¿™é‡Œå°±åŸºæœ¬overäº†ï¼Œå¹²è´§æ»¡æ»¡ï¼</p><p>å¦‚æœå¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¿˜è¯·ç‚¹ä¸ªèµå§ï¼ï¼ï¼</p><p><img lazyload alt="image" data-src="https://img-7758-typora.oss-cn-shanghai.aliyuncs.com/img1/202211031202863.gif" alt="QQå›¾ç‰‡20220416140203"></p></div><div class="post-copyright-info"><div class="article-copyright-info-container"><ul class="copyright-info-content"><li class="post-title"><span class="type">æœ¬æ–‡æ ‡é¢˜</span>ï¼š<span class="content">ã€Linuxã€‘è¿›ç¨‹é€šä¿¡ | ä¿¡å·</span></li><li class="post-author"><span class="type">æœ¬æ–‡ä½œè€…</span>ï¼š<span class="content">æ…•é›ªå¹´å</span></li><li class="post-time"><span class="type">åˆ›å»ºæ—¶é—´</span>ï¼š<span class="content">2022-11-20 16:30:16</span></li><li class="post-link"><span class="type">æœ¬æ–‡é“¾æ¥</span>ï¼š<span class="content">2022/11/20/note_Linux/18ä¿¡å·/</span></li><li class="post-license"><span class="type">ç‰ˆæƒå£°æ˜</span>ï¼š<span class="content">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</span></li></ul><div class="copy-copyright-info flex-center tooltip" data-content="å¤åˆ¶ç‰ˆæƒä¿¡æ¯" data-offset-y="-2px"><i class="fa-solid fa-copy"></i></div></div></div><ul class="post-tags-box"><li class="tag-item"><a href="/tags/Linux/">#Linux</a>&nbsp;</li><li class="tag-item"><a href="/tags/%E8%BF%9B%E7%A8%8B/">#è¿›ç¨‹</a>&nbsp;</li></ul><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/2022/12/01/note_data_structure/15%E5%B9%B6%E6%9F%A5%E9%9B%86/"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item">ã€C++ã€‘å¹¶æŸ¥é›†</span> <span class="post-nav-item">ä¸Šä¸€ç¯‡</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/2022/11/13/note_Linux/17%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98_%E4%BF%A1%E5%8F%B7%E9%87%8F/"><span class="title flex-center"><span class="post-nav-title-item">ã€Linuxã€‘è¿›ç¨‹é€šä¿¡ | å…±äº«å†…å­˜ | ä¿¡å·é‡</span> <span class="post-nav-item">ä¸‹ä¸€ç¯‡</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div><div class="comment-container"><div class="comments-container"><div id="comments-anchor"></div><div class="comment-area-title"><i class="fas fa-comments"></i>&nbsp;è¯„è®º</div><div class="waline-comment-container"><link rel="stylesheet" href="//img-7758-typora.oss-cn-shanghai.aliyuncs.com/hexo/waline.css"><link rel="stylesheet" href="//img-7758-typora.oss-cn-shanghai.aliyuncs.com/hexo/waline-meta.css"><script data-pjax src="//img-7758-typora.oss-cn-shanghai.aliyuncs.com/hexo/waline.js"></script><div id="waline-comment"></div><script data-pjax>function loadWaline() {
            Waline.init({
              el: '#waline-comment',
              serverURL: 'https://vrcl.outpost54.top/',
              lang: 'zh-CN' || 'zh-CN',
              comment: '.post-comments-count',
              reaction: 'false' === 'true'
            })
          }

          if ('true' === 'true') {
            setTimeout(() => {
              loadWaline()
            }, 1000)
          } else {
            window.addEventListener('DOMContentLoaded', loadWaline)
          }</script></div></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF%E4%BF%A1%E5%8F%B7"><span class="nav-text">1.ä»€ä¹ˆæ˜¯ä¿¡å·</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-%E4%BD%95%E4%B8%BA%E5%BC%82%E6%AD%A5"><span class="nav-text">1.1 ä½•ä¸ºå¼‚æ­¥?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-%E4%BF%A1%E5%8F%B7%E7%9A%84%E7%A7%8D%E7%B1%BB"><span class="nav-text">1.2 ä¿¡å·çš„ç§ç±»</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-%E4%BF%A1%E5%8F%B7%E4%BA%A7%E7%94%9F"><span class="nav-text">1.3 ä¿¡å·äº§ç”Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-%E4%BF%A1%E5%8F%B7%E5%8A%A8%E4%BD%9C"><span class="nav-text">1.4 ä¿¡å·åŠ¨ä½œ</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E7%B3%BB%E7%BB%9F%E6%8E%A5%E5%8F%A3"><span class="nav-text">2.ç³»ç»Ÿæ¥å£</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-signal"><span class="nav-text">2.1 signal</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-1-%E5%89%8D%E5%8F%B0%E8%BF%9B%E7%A8%8B%E5%92%8C%E5%90%8E%E5%8F%B0%E8%BF%9B%E7%A8%8B"><span class="nav-text">2.1.1 å‰å°è¿›ç¨‹å’Œåå°è¿›ç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-2-%E5%BE%AA%E7%8E%AF%E6%8D%95%E6%8D%89%E6%89%80%E6%9C%89%E4%BF%A1%E5%8F%B7"><span class="nav-text">2.1.2 å¾ªç¯æ•æ‰æ‰€æœ‰ä¿¡å·</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-3-%E4%BF%A1%E5%8F%B79-x2F-19"><span class="nav-text">2.1.3 ä¿¡å·9&#x2F;19</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-kill"><span class="nav-text">2.2 kill</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-1-killall"><span class="nav-text">2.2.1 killall</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-raise"><span class="nav-text">2.3 raise</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-abort"><span class="nav-text">2.4 abort</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-5-alarm"><span class="nav-text">2.5 alarm</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-6-sigset-t%E4%BF%A1%E5%8F%B7%E9%9B%86"><span class="nav-text">2.6 sigset_tä¿¡å·é›†</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-7-sigprocmask"><span class="nav-text">2.7 sigprocmask</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-8-sigpending"><span class="nav-text">2.8 sigpending</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-8-1-%E5%B1%8F%E8%94%BD2%E5%8F%B7%E4%BF%A1%E5%8F%B7"><span class="nav-text">2.8.1 å±è”½2å·ä¿¡å·</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-8-2-%E5%B1%8F%E8%94%BD%E6%89%80%E6%9C%89%E4%BF%A1%E5%8F%B7"><span class="nav-text">2.8.2 å±è”½æ‰€æœ‰ä¿¡å·</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-8-3-%E8%A7%A3%E9%99%A4%E5%B1%8F%E8%94%BD"><span class="nav-text">2.8.3 è§£é™¤å±è”½</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-9-sigaction"><span class="nav-text">2.9 sigaction</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-9-1-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-text">2.9.1 åŸºæœ¬ä½¿ç”¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-9-2-sa-mask"><span class="nav-text">2.9.2 sa_mask</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-%E8%BD%AF%E4%BB%B6%E5%B4%A9%E6%BA%83%E7%9A%84%E6%9C%AC%E8%B4%A8"><span class="nav-text">3.è½¯ä»¶å´©æºƒçš„æœ¬è´¨</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-%E6%83%85%E6%99%AF%E6%BC%94%E7%A4%BA"><span class="nav-text">3.1 æƒ…æ™¯æ¼”ç¤º</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-%E8%AF%B4%E6%98%8E"><span class="nav-text">3.2 è¯´æ˜</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-coredump"><span class="nav-text">4.coredump</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-%E5%BC%80%E5%90%AF%E8%AF%A5%E5%8A%9F%E8%83%BD"><span class="nav-text">4.1 å¼€å¯è¯¥åŠŸèƒ½</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-%E4%BD%BF%E7%94%A8coredump"><span class="nav-text">4.2 ä½¿ç”¨coredump</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%BB%98%E8%AE%A4%E5%85%B3%E9%97%AD%EF%BC%9F"><span class="nav-text">4.3 ä¸ºä»€ä¹ˆé»˜è®¤å…³é—­ï¼Ÿ</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-%E8%BF%9B%E7%A8%8B%E5%A4%84%E7%90%86%E4%BF%A1%E5%8F%B7"><span class="nav-text">5.è¿›ç¨‹å¤„ç†ä¿¡å·</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-%E5%86%85%E6%A0%B8%E6%80%81-x2F-%E7%94%A8%E6%88%B7%E6%80%81"><span class="nav-text">5.1 å†…æ ¸æ€&#x2F;ç”¨æˆ·æ€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-%E4%BF%A1%E5%8F%B7%E6%A3%80%E6%B5%8B"><span class="nav-text">5.2 ä¿¡å·æ£€æµ‹</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-%E5%8F%AF%E9%87%8D%E5%85%A5%E5%87%BD%E6%95%B0"><span class="nav-text">6.å¯é‡å…¥å‡½æ•°</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C"><span class="nav-text">6.1 åŸå­æ“ä½œ</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-volatile"><span class="nav-text">7.volatile</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-%E7%A4%BA%E4%BE%8B"><span class="nav-text">7.1 ç¤ºä¾‹</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-%E5%AD%90%E8%BF%9B%E7%A8%8B%E5%8F%91%E9%80%81%E4%BF%A1%E5%8F%B7"><span class="nav-text">8.å­è¿›ç¨‹å‘é€ä¿¡å·</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#8-1-%E7%88%B6%E8%BF%9B%E7%A8%8B%E5%9B%9E%E6%94%B6%E5%AD%90%E8%BF%9B%E7%A8%8B"><span class="nav-text">8.1 çˆ¶è¿›ç¨‹å›æ”¶å­è¿›ç¨‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-2-%E7%88%B6%E8%BF%9B%E7%A8%8B%E5%BF%BD%E7%95%A5%E5%AD%90%E8%BF%9B%E7%A8%8B"><span class="nav-text">8.2 çˆ¶è¿›ç¨‹å¿½ç•¥å­è¿›ç¨‹</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BB%93%E8%AF%AD"><span class="nav-text">ç»“è¯­</span></a></li></ol></div></div></div></div></div></div></div><div class="page-main-content-bottom"><footer class="footer"><div class="info-container"><div class="copyright-info info-item">&copy; <span>2021</span> - 2023 &nbsp;<i class="fas fa-heart icon-animate"></i> &nbsp;<a href="/">æ…•é›ªå¹´å</a></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="website-count info-item">è®¿é—®äººæ•°&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp; æ€»è®¿é—®é‡&nbsp;<span id="busuanzi_value_site_pv"></span></div><div class="timerun-info info-item"><span id="timeDate">è½½å…¥å¤©æ•°...</span><span id="times">è½½å…¥æ—¶åˆ†ç§’...</span><script>var now=new Date;function createtime(){var n=new Date("04/16/2022 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="å·²å‹‰å¼ºè¿è¡Œ "+dnum+" å¤© ",document.getElementById("times").innerHTML=hnum+" æ—¶ "+mnum+" åˆ† "+snum+" ç§’"}setInterval("createtime()",250)</script></div><div class="shields-info info-item"><a href="https://github.com/XPoet/hexo-theme-keep" target="_blank"><img src="https://img.shields.io/badge/hexo-keep%20v3.6.1-blue" height="20px"> </a><a href="https://www.travellings.cn/go.html" target="_blank"><img src="/images/travellingICON.gif" height="20px"> </a><a href="https://icp.gov.moe/?keyword=20230054" target="_blank"><img src="https://img.shields.io/badge/-%E8%90%8CICP%E5%A4%8720230054%E5%8F%B7-ff69b4" height="20px"> </a><a href="https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referral" target="_blank"><img src="/images/UPYUN-CDN.png" height="20px"></a></div></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="tools-list"><li class="tools-item flex-center toggle-show-toc"><i class="fas fa-list"></i></li><li class="tools-item flex-center go-to-comments"><i class="fas fa-comment"></i> <span class="post-comments-count"></span></li></ul></div></div><div class="right-bottom-side-tools"><div class="side-tools-container"><ul class="side-tools-list"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-dark-light-toggle flex-center"><i class="fas fa-moon"></i></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="exposed-tools-list"><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li><li class="tools-item tool-scroll-to-top flex-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="zoom-in-image-mask"><img class="zoom-in-image"></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fas fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="æœç´¢..." spellcheck="false" type="search" class="search-input"></div><span class="close-popup-btn"><i class="fas fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/utils.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/main.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/header-shrink.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/back2top.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/dark-light-toggle.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/local-search.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/code-block.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/lazyload.js"></script><div class="post-scripts pjax"><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/post-helper.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/libs/anime.min.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/toc.js"></script></div><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/libs/pjax.min.js"></script><script>window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });</script><script type="text/javascript" src="/js/snow.js"></script></body></html>