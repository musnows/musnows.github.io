<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>【SLAM】在 ubuntu 18.04 arm 中以ROS环境编译与运行ORB_SLAM3 | 慕雪的寒舍</title><meta name="author" content="慕雪年华"><meta name="copyright" content="慕雪年华"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="在 ubuntu 18.04 arm 中于ROS环境编译与运行ORB_SLAM3，并以TUM数据集测试了ROS下单目、双目和RGB-D运行">
<meta property="og:type" content="article">
<meta property="og:title" content="【SLAM】在 ubuntu 18.04 arm 中以ROS环境编译与运行ORB_SLAM3">
<meta property="og:url" content="https://blog.musnow.top/posts/5090585017/index.html">
<meta property="og:site_name" content="慕雪的寒舍">
<meta property="og:description" content="在 ubuntu 18.04 arm 中于ROS环境编译与运行ORB_SLAM3，并以TUM数据集测试了ROS下单目、双目和RGB-D运行">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img.musnow.top/i/2025/02/4532d161bce1a806b99e91a7f55c5097.png">
<meta property="article:published_time" content="2025-02-09T08:18:59.000Z">
<meta property="article:modified_time" content="2025-03-03T01:51:41.000Z">
<meta property="article:author" content="慕雪年华">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="Cpp">
<meta property="article:tag" content="SLAM">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.musnow.top/i/2025/02/4532d161bce1a806b99e91a7f55c5097.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "【SLAM】在 ubuntu 18.04 arm 中以ROS环境编译与运行ORB_SLAM3",
  "url": "https://blog.musnow.top/posts/5090585017/",
  "image": "https://img.musnow.top/i/2025/02/4532d161bce1a806b99e91a7f55c5097.png",
  "datePublished": "2025-02-09T08:18:59.000Z",
  "dateModified": "2025-03-03T01:51:41.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "慕雪年华",
      "url": "https://blog.musnow.top/"
    }
  ]
}</script><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://blog.musnow.top/posts/5090585017/index.html"><link rel="preconnect"/><meta name="google-site-verification" content="iR4A6ntiwhI9JX_YDe2ZFY6DerPD7c-NaLyIDlrDguY"/><meta name="msvalidate.01" content="D5CD621F38EE3FB5071F785AD4977161"/><meta name="baidu-site-verification" content="codeva-aZGKJiqRSI"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/pluginsSrc/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="/pluginsSrc/@fancyapps/ui/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":420,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":600,"languages":{"author":"作者: 慕雪年华","link":"链接: ","source":"来源: 慕雪的寒舍","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: '/pluginsSrc/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '【SLAM】在 ubuntu 18.04 arm 中以ROS环境编译与运行ORB_SLAM3',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/equipment/equipment.css?1"><link rel="stylesheet" href="/rating/rating.css?1"><script src="/js/typing_style.js"></script><script>var _hmt = _hmt || [];(function(){var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?f444e8de702765e309d1a751aa12203e";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="慕雪的寒舍" type="application/atom+xml">
</head><body><div id="web_bg" style="background-image: url(/img/main/mothra.webp);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/favicon.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">460</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">76</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">24</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 归档</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/rating/"><i class="fa-fw fas fa-film"></i><span> 书·影</span></a></div><div class="menus_item"><a class="site-page" href="/qa/"><i class="fa-fw fa-fw fas fa-comment-dots"></i><span> 留言</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-user-friends"></i><span> 友人</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/fcircle/"><i class="fa-fw fas fa-link"></i><span> 朋友圈</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.travellings.cn/go.html"><i class="fa-fw fas fa-train"></i><span> 开往</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.foreverblog.cn/go.html"><i class="fa-fw fab fa-superpowers"></i><span> 虫洞</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://travel.moe/go.html?travel=on"><i class="fa-fw fas fa-globe-americas"></i><span> 异次元</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-glass-whiskey"></i><span> 镜像</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="https://blog.musnow.top/?utm_source=mirror"><i class="fa-fw fas fa-home"></i><span> Main</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog1.musnow.top/?utm_source=mirror"><i class="fa-fw fa-brands fa-battle-net"></i><span> Netlify</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://musnows.github.io/?utm_source=mirror"><i class="fa-fw fa-brands fa-square-github"></i><span> Github</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog2.musnow.top/?utm_source=mirror"><i class="fa-fw fa-solid fa-square-caret-up"></i><span> Vercel</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog3.musnow.top/?utm_source=mirror"><i class="fa-fw fas fa-cloud"></i><span> Cloudflare</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://keep-hexo.musnow.top/?utm_source=mirror"><i class="fa-fw fa-brands fa-kickstarter"></i><span> KeepTheme</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://musnow.blog.csdn.net/"><i class="fa-fw fas fa-copyright"></i><span> CSDN</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog.51cto.com/u_15307009"><i class="fa-fw fas fa-dice-five"></i><span> 51CTO</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fab fa-blackberry"></i><span> 更多</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 画廊</span></a></li><li><a class="site-page child" href="/equipment/"><i class="fa-fw fas fa-laptop"></i><span> 背包</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://memos.musnow.top"><i class="fa-fw fas fa-map-signs"></i><span> 说说</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://stats.uptimerobot.com/qrNpVSLkgV"><i class="fa-fw fas fa-chart-bar"></i><span> Uptime</span></a></li><li><a class="site-page child" href="/atom.xml"><i class="fa-fw fas fa-rss-square"></i><span> RSS</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(https://img.musnow.top/i/2025/02/4532d161bce1a806b99e91a7f55c5097.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/favicon.jpg" alt="Logo"><span class="site-name">慕雪的寒舍</span></a><a class="nav-page-title" href="/"><span class="site-name">【SLAM】在 ubuntu 18.04 arm 中以ROS环境编译与运行ORB_SLAM3</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 归档</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/rating/"><i class="fa-fw fas fa-film"></i><span> 书·影</span></a></div><div class="menus_item"><a class="site-page" href="/qa/"><i class="fa-fw fa-fw fas fa-comment-dots"></i><span> 留言</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-user-friends"></i><span> 友人</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/fcircle/"><i class="fa-fw fas fa-link"></i><span> 朋友圈</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.travellings.cn/go.html"><i class="fa-fw fas fa-train"></i><span> 开往</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.foreverblog.cn/go.html"><i class="fa-fw fab fa-superpowers"></i><span> 虫洞</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://travel.moe/go.html?travel=on"><i class="fa-fw fas fa-globe-americas"></i><span> 异次元</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-glass-whiskey"></i><span> 镜像</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="https://blog.musnow.top/?utm_source=mirror"><i class="fa-fw fas fa-home"></i><span> Main</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog1.musnow.top/?utm_source=mirror"><i class="fa-fw fa-brands fa-battle-net"></i><span> Netlify</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://musnows.github.io/?utm_source=mirror"><i class="fa-fw fa-brands fa-square-github"></i><span> Github</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog2.musnow.top/?utm_source=mirror"><i class="fa-fw fa-solid fa-square-caret-up"></i><span> Vercel</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog3.musnow.top/?utm_source=mirror"><i class="fa-fw fas fa-cloud"></i><span> Cloudflare</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://keep-hexo.musnow.top/?utm_source=mirror"><i class="fa-fw fa-brands fa-kickstarter"></i><span> KeepTheme</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://musnow.blog.csdn.net/"><i class="fa-fw fas fa-copyright"></i><span> CSDN</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog.51cto.com/u_15307009"><i class="fa-fw fas fa-dice-five"></i><span> 51CTO</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fab fa-blackberry"></i><span> 更多</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 画廊</span></a></li><li><a class="site-page child" href="/equipment/"><i class="fa-fw fas fa-laptop"></i><span> 背包</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://memos.musnow.top"><i class="fa-fw fas fa-map-signs"></i><span> 说说</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://stats.uptimerobot.com/qrNpVSLkgV"><i class="fa-fw fas fa-chart-bar"></i><span> Uptime</span></a></li><li><a class="site-page child" href="/atom.xml"><i class="fa-fw fas fa-rss-square"></i><span> RSS</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">【SLAM】在 ubuntu 18.04 arm 中以ROS环境编译与运行ORB_SLAM3</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-02-09T08:18:59.000Z" title="发表于 2025-02-09 16:18:59">2025-02-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-03-03T01:51:41.000Z" title="更新于 2025-03-03 09:51:41">2025-03-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/">编程学习</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95/">项目开发记录</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">5.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>24分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="ArtalkPV"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div class="ai-summary"><div class="ai-explanation" style="display: block;" data-summary="这里是慕雪的小助手，这篇文章介绍了在Ubuntu 18.04 ARM环境下于ROS环境中编译和运行ORB_SLAM3的过程，包括安装ROS环境、编译ORB_SLAM3及其ROS版本，并使用TUM和EuRoC数据集测试单目、双目和RGB-D运行。文章详细说明了编译过程中遇到的问题及解决方案，如修正build_ros.sh脚本中的目录错误和内存不足的问题，强调了先编译普通版本再编译ROS版本的重要性，并提供了增加swap文件的命令以应对内存不足的情况。">慕雪的小助手正在绞尽脑汁···</div><div class="ai-title"> <div class="ai-title-left"> <i class="fa-brands fa-slack"></i><div class="ai-title-text">慕雪小助手的总结</div></div><div class="ai-tag" id="ai-tag">LongCat-Flash-Chat</div></div></div><div id="post-outdate-notice" data="{&quot;limitDay&quot;:180,&quot;messagePrev&quot;:&quot;距离上次更新本文已经过去了&quot;,&quot;messageNext&quot;:&quot;天，文章部分内容可能已经过时，请注意甄别。&quot;,&quot;postUpdate&quot;:&quot;2025-03-03 09:51:41&quot;}" hidden></div><p>在ubuntu18.04arm中于ROS环境编译与运行ORB_SLAM3，并以TUM和EuRoC数据集测试了ROS下单目、双目和RGB-D运行。</p>
<h2 id="1-引言">1. 引言</h2>
<p>在之前的博客中，已经介绍了<a href="https://blog.musnow.top/posts/7873538113/">基于虚拟机docker环境以及云端的AutoDL环境运行ORB_SLAM3</a>的步骤。</p>
<p>在实际场景中，SLAM通常是需要在机器人平台上运行的，ROS就是一个比较常见的机器人开发平台，在ROS环境中运行，可以方便我们的SLAM系统与其他机器人功能模块（比如导航和路径规划）进行通信，而且在ros node模式下运行的SLAM更适合<strong>多机通讯环境</strong>，比如实现多机器人协同建图、机器人和PC交互等等功能。</p>
<p>ORB_SLAM3在本地运行的基础上，提供了在ROS中运行的机制，本文简述了如何在ubuntu 18.04 arm环境中安装ROS环境、编译ORB_SLAM3 ROS版本，以及用现有的数据集模拟摄像头信号输入来使用ORB_SLAM3的全流程。</p>
<p>本文示例环境：ubuntu 22.04 arm虚拟机下启动的ubuntu18.04 docker容器。</p>
<h2 id="2-安装ROS环境">2. 安装ROS环境</h2>
<p>参考<a href="https://blog.musnow.top/posts/3771271576/">【Linux】在ubuntu18.04arm中安装ROS环境</a>一文进行安装，主要基于ROS官网的教程。</p>
<h2 id="3-编译ROS环境的ORB-SLAM3">3. 编译ROS环境的ORB_SLAM3</h2>
<p>本文撰写时<code>UZ-SLAMLab/ORB_SLAM3</code>的最新提交为2022年2月10日的<code>4452a3c4ab75b1cde34e5505a36ec3f9edcdc4c4</code>，后文的教程基于此提交点。</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2025/02/335d01e00274144aad4d37adaace52ad.png" alt="image.png"></p>
<h3 id="3-1-编译命令">3.1. 编译命令</h3>
<h4 id="3-1-1-先编译普通版本">3.1.1. 先编译普通版本</h4>
<p>本文不赘述安装ORB_SLAM3依赖项的步骤，您可以参考<a href="https://blog.musnow.top/posts/1589125738/">【SLAM】于ubuntu18.04上纯CPU运行GCNv2_SLAM的记录（ARM64/AMD64） | 慕雪的寒舍</a> 一文中的依赖项安装步骤。参考博客里面的步骤安装opencv、eigen3、Pangolin6.0就可以了，不需要安装libtorch。</p>
<p>其中需要注意的是，如果你需要编译ROS的ORB_SLAM3，<strong>opencv不能安装3.4.5版本，必须安装3.2.0版本</strong>！好消息是，如果你是跟随者本站或者ROS官网的教程安装的ROS，那么opencv 3.2.0版本已经和ROS一起安装在你的系统里面了。</p>
<blockquote>
<p>经过博主的尝试，原文中给出的OpenCV 3.4.5的编译安装方法同样可以用于3.2.0版本，只需要将下载链接中的版本号更换为3.2.0即可。</p>
</blockquote>
<p>安装完毕依赖后，先<strong>以普通模式编译ORB_SLAM3</strong>，因为ROS版本依赖于普通版本才能进行编译，这一点必须要注意。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/UZ-SLAMLab/ORB_SLAM3.git ORB_SLAM3</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ORB_SLAM3</span><br><span class="line"><span class="built_in">chmod</span> +x build.sh</span><br><span class="line">./build.sh</span><br></pre></td></tr></table></figure>
<h4 id="3-1-2-修改build-ros-sh脚本">3.1.2. 修改build_ros.sh脚本</h4>
<p>编译完毕普通版本后，才可以执行<code>build_ros.sh</code>脚本。但是先别急，cat这个脚本，看看里面写了啥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-linux-22-04-02-desktop:/work/ORB_SLAM3# cat build_ros.sh </span><br><span class="line">echo &quot;Building ROS nodes&quot;</span><br><span class="line"></span><br><span class="line">cd Examples/ROS/ORB_SLAM3</span><br><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake .. -DROS_BUILD_TYPE=Release</span><br><span class="line">make -j</span><br></pre></td></tr></table></figure>
<p>其中第一个命令就有问题了，最新版本的ORB_SLAM3源码里面，Examples路径下已经没有ROS目录了，这个目录现在是<code>Examples_old/ROS/ORB_SLAM3</code>。</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2025/02/bee0b045b18a1fe693aea1048fd22862.png" alt="image.png"></p>
<p>如果你没有注意这个问题就开始执行<code>build_ros.sh</code>脚本，问题就会出现，因为<code>Examples/ROS/ORB_SLAM3</code>目录当前不存在，该脚本实际上是直接在项目根目录下创建了build目录然后cmake开始编译的，编译的完全不是ROS版本。</p>
<p>这个脚本里面还有另外一个坑，那就是<code>make -j</code>后面没有写任何数字。这会导致make无休止地使用系统资源，直到把你的整个系统内存和swap都吃光光。根据我找到的博客，ORB_SLAM3的编译最多能吃掉16GB内存，完全是个洪水猛兽。</p>
<p>最开始我没有注意这个脚本，以为它没有任何问题，就直接执行了，最终在编译时遇到了如下错误。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c++: internal compiler error: Killed (program cc1plus)</span><br><span class="line">Please submit a full bug report,</span><br><span class="line">with preprocessed source if appropriate.</span><br><span class="line">See &lt;file:///usr/share/doc/gcc-7/README.Bugs&gt; for instructions.</span><br></pre></td></tr></table></figure>
<p>这个错误就是因为系统没有资源了。开另外一个终端，再启动编译，你可以轻易地观察到编译是怎么把整个系统内存给吃光光的，最终物理内存和swap都没了，操作系统自然会kill掉编译进程，从而导致了上述报错。</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2025/02/53a81ab5712af2c3f117d62f91fe5211.png" alt="image.png"></p>
<p>如果你直接搜索“ORB_SLAM3编译失败”等字样，可能会搜到相关教程让你加大swap文件，这是一个可选项，但还不够可选，因为在我的测试中，即便再给出2GB的swap文件，编译依旧会因为内存不足而失败。下面给出新增swap文件的命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">apt install util-linux</span><br><span class="line"><span class="comment"># 分配2G</span></span><br><span class="line"><span class="built_in">sudo</span> fallocate -l 2G /swapfile</span><br><span class="line"><span class="comment"># 给予权限</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> 600 /swapfile</span><br><span class="line"><span class="comment"># 激活权限（执行了之后swap就生效了）</span></span><br><span class="line"><span class="built_in">sudo</span> mkswap /swapfile</span><br><span class="line"><span class="built_in">sudo</span> swapon /swapfile</span><br><span class="line"><span class="comment"># 不需要的时候，使用如下命令删除swap文件</span></span><br><span class="line">swapoff -v /swapfile</span><br><span class="line"><span class="built_in">rm</span> /swapfile</span><br></pre></td></tr></table></figure>
<p>实际上，在物理内存大于8GB的环境中不需要这么麻烦，前文提到了脚本里面make没有写线程数，解决办法就是修正这个脚本，首先是修正目录，其次是将make后面加上<code>-j4</code>来限制make使用的资源，这样就能绕过内存不足导致的编译错误了。修改后的脚本如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Building ROS nodes&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> Examples_old/ROS/ORB_SLAM3</span><br><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake .. -DROS_BUILD_TYPE=Release</span><br><span class="line">make -j4</span><br></pre></td></tr></table></figure>
<p>如果你的环境物理内存低于8GB，可以考虑在加大swap文件的同时进一步减少make使用的线程数，比如<code>make -j2</code>。</p>
<h4 id="3-1-3-编译ROS版本">3.1.3. 编译ROS版本</h4>
<p>修正了build_ros.sh脚本之后，就可以开始编译ROS版本了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x build_ros.sh</span><br><span class="line">./build_ros.sh</span><br></pre></td></tr></table></figure>
<p>再次提醒，ROS版本的编译依赖于普通版本，需要先编译普通版本！</p>
<h3 id="3-2-编译期间遇到的各种问题">3.2. 编译期间遇到的各种问题</h3>
<p>部分问题参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/shikaiaixuexi/article/details/143749912">记录配置ubuntu18.04下运行ORBSLAM3的ros接口的过程及执行单目imu模式遇到的问题</a></p>
<h4 id="3-2-1-cmake错误ROS-PACKAGE-PATH">3.2.1. cmake错误ROS_PACKAGE_PATH</h4>
<p>遇到的第一个错误应该是环境变量有关，编译ros版本的时候，需要将源码路径加入到环境变量中，才可以正常编译。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CMake Error at /opt/ros/melodic/share/ros/core/rosbuild/private.cmake:99 (message):</span><br><span class="line">  [rosbuild] rospack found package &quot;ORB_SLAM3&quot; at &quot;&quot;, but the current</span><br><span class="line">  directory is &quot;/work/ORB_SLAM3/Examples_old/ROS/ORB_SLAM3&quot;.  You should</span><br><span class="line">  double-check your ROS_PACKAGE_PATH to ensure that packages are found in the</span><br><span class="line">  correct precedence order.</span><br><span class="line">Call Stack (most recent call first):</span><br><span class="line">  /opt/ros/melodic/share/ros/core/rosbuild/public.cmake:177 (_rosbuild_check_package_location)</span><br><span class="line">  CMakeLists.txt:4 (rosbuild_init)</span><br></pre></td></tr></table></figure>
<p>在ORB_SLAM3项目根目录下执行如下命令即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ROS_PACKAGE_PATH=<span class="variable">$ROS_PACKAGE_PATH</span>:<span class="variable">$PWD</span>/Examples_old/ROS/ORB_SLAM3</span><br></pre></td></tr></table></figure>
<p>修正之后即可正常开始编译。注意后续执行rosrun的bash也需要执行此命令，建议直接将其写入<code>~/.bashrc</code>中!</p>
<h4 id="3-2-2-头文件se3-hpp找不到">3.2.2. 头文件se3.hpp找不到</h4>
<p>编译到30%的时候，会提示<code>&lt;sophus/se3.hpp&gt;</code>头文件找不到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[ 30%] Building CXX object CMakeFiles/Mono_Inertial.dir/src/ros_mono_inertial.cc.o</span><br><span class="line">In file included from /work/ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/../../../include/Frame.h:30:0,</span><br><span class="line">                 from /work/ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/../../../include/KeyFrame.h:28,</span><br><span class="line">                 from /work/ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/../../../include/MapPoint.h:23,</span><br><span class="line">                 from /work/ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/../../../include/FrameDrawer.h:24,</span><br><span class="line">                 from /work/ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/../../../include/Viewer.h:23,</span><br><span class="line">                 from /work/ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/../../../include/Tracking.h:26,</span><br><span class="line">                 from /work/ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/../../../include/System.h:31,</span><br><span class="line">                 from /work/ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/src/ros_mono_inertial.cc:34:</span><br><span class="line">/work/ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/../../../include/ImuTypes.h:29:10: fatal error: sophus/se3.hpp: No such file or directory</span><br><span class="line"> #include &lt;sophus/se3.hpp&gt;</span><br><span class="line">          ^~~~~~~~~~~~~~~~****</span><br></pre></td></tr></table></figure>
<p>这个第三方库sophus已经在Thirdparty文件夹里面自带了，刚刚我们编译普通版本的时候，其实也已经编译好了这个第三方库了。要做的就是进它的目录make install安装一下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> Thirdparty/Sophus/build/</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>安装以后就解决这个问题了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-linux-22-04-02-desktop:/work/ORB_SLAM3# cd Thirdparty/Sophus/build/</span><br><span class="line">root@ubuntu-linux-22-04-02-desktop:/work/ORB_SLAM3/Thirdparty/Sophus/build# make install</span><br><span class="line">[  8%] Built target test_sim2</span><br><span class="line">[ 16%] Built target test_se2</span><br><span class="line">[ 25%] Built target test_so3</span><br><span class="line">[ 33%] Built target test_rxso2</span><br><span class="line">[ 41%] Built target test_so2</span><br><span class="line">[ 50%] Built target test_se3</span><br><span class="line">[ 58%] Built target test_geometry</span><br><span class="line">[ 66%] Built target test_rxso3</span><br><span class="line">[ 75%] Built target test_sim3</span><br><span class="line">[ 83%] Built target test_velocities</span><br><span class="line">[ 91%] Built target test_common</span><br><span class="line">[100%] Built target HelloSO3</span><br><span class="line">Install the project...</span><br><span class="line">-- Install configuration: &quot;Release&quot;</span><br><span class="line">-- Installing: /usr/local/share/sophus/cmake/SophusTargets.cmake</span><br><span class="line">-- Installing: /usr/local/share/sophus/cmake/SophusConfig.cmake</span><br><span class="line">-- Installing: /usr/local/share/sophus/cmake/SophusConfigVersion.cmake</span><br><span class="line">-- Installing: /usr/local/include/sophus/average.hpp</span><br><span class="line">-- Installing: /usr/local/include/sophus/common.hpp</span><br><span class="line">-- Installing: /usr/local/include/sophus/geometry.hpp</span><br><span class="line">-- Installing: /usr/local/include/sophus/interpolate.hpp</span><br><span class="line">-- Installing: /usr/local/include/sophus/interpolate_details.hpp</span><br><span class="line">-- Installing: /usr/local/include/sophus/num_diff.hpp</span><br><span class="line">-- Installing: /usr/local/include/sophus/rotation_matrix.hpp</span><br><span class="line">-- Installing: /usr/local/include/sophus/rxso2.hpp</span><br><span class="line">-- Installing: /usr/local/include/sophus/rxso3.hpp</span><br><span class="line">-- Installing: /usr/local/include/sophus/se2.hpp</span><br><span class="line">-- Installing: /usr/local/include/sophus/se3.hpp</span><br><span class="line">-- Installing: /usr/local/include/sophus/sim2.hpp</span><br><span class="line">-- Installing: /usr/local/include/sophus/sim3.hpp</span><br><span class="line">-- Installing: /usr/local/include/sophus/sim_details.hpp</span><br><span class="line">-- Installing: /usr/local/include/sophus/so2.hpp</span><br><span class="line">-- Installing: /usr/local/include/sophus/so3.hpp</span><br><span class="line">-- Installing: /usr/local/include/sophus/types.hpp</span><br><span class="line">-- Installing: /usr/local/include/sophus/velocities.hpp</span><br><span class="line">-- Installing: /usr/local/include/sophus/formatstring.hpp</span><br></pre></td></tr></table></figure>
<h4 id="3-2-3-OpenCV-版本不匹配">3.2.3. OpenCV 版本不匹配</h4>
<p>前文提到过，OpenCV必须安装 3.2.0 版本，是因为cv_bridge默认会指向ROS自带的3.2.0版本，而不是我们自己安装的其他版本，最终编译或者运行的时候就会导致链接错误或者coredump错误。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/ld: warning: libopencv_core.so.3.2, needed by /opt/ros/melodic/lib/libcv_bridge.so, may conflict with libopencv_core.so.3.4</span><br></pre></td></tr></table></figure>
<p>如果你已经安装了其他版本的opencv，需要删掉它们。从源码安装的话，直接进入opencv源码的build目录执行<code>make uninstall</code>就可以卸载掉自己安装的opencv。</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2025/02/b1905e7093dcb9ee085ce7f23784385b.png" alt="image.png"></p>
<p>删掉了之后就会发现系统里面只剩下和ros一起安装的3.2.0版本opencv了，应该是下载ros环境的时候自动安装的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-linux-22-04-02-desktop:/work/ORB_SLAM3# pkg-config --modversion opencv</span><br><span class="line">3.2.0</span><br></pre></td></tr></table></figure>
<p>随后我们需要修改CMakeLists文件，让编译的时候使用opencv 3.2.0版本。首先是根目录下的CMakeLists，修改如下部分的版本号为3.2即可</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ORB_SLAM3/CMakeLists.txt</span></span><br><span class="line"><span class="keyword">find_package</span>(OpenCV <span class="number">3.2</span>)</span><br><span class="line">   <span class="keyword">if</span>(<span class="keyword">NOT</span> OpenCV_FOUND)</span><br><span class="line">      <span class="keyword">message</span>(FATAL_ERROR <span class="string">&quot;OpenCV &gt; 3.2 not found.&quot;</span>)</span><br><span class="line">   <span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>
<p>然后是<code>Examples_old/ROS/ORB_SLAM3</code>里面的CMakeLists文件，修改如下部分为3.2.0版本</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/CMakeLists.txt</span></span><br><span class="line"><span class="keyword">find_package</span>(OpenCV <span class="number">3.2</span>.<span class="number">0</span> QUIET) <span class="comment"># 修改为3.2.0</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">NOT</span> OpenCV_FOUND)</span><br><span class="line">   <span class="keyword">find_package</span>(OpenCV <span class="number">2.4</span>.<span class="number">3</span> QUIET)</span><br><span class="line">   <span class="keyword">if</span>(<span class="keyword">NOT</span> OpenCV_FOUND)</span><br><span class="line">      <span class="keyword">message</span>(FATAL_ERROR <span class="string">&quot;OpenCV &gt; 2.4.3 not found.&quot;</span>)</span><br><span class="line">   <span class="keyword">endif</span>()</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>
<p>接下来就要删除所有编译缓存，重新编译一遍。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rm -rf Thirdparty/g2o/build/</span><br><span class="line">rm -rf Thirdparty/DBoW2/build/</span><br><span class="line">rm -rf Thirdparty/Sophus/build/</span><br><span class="line">rm -rf Vocabulary/*.bin</span><br><span class="line">rm -rf ./build</span><br><span class="line">rm -rf Examples_old/ROS/ORB_SLAM3/build</span><br></pre></td></tr></table></figure>
<p><strong>注意ORB_SLAM3的普通版本也需要重新编译</strong>！因为最开始编译的时候我的普通版本是基于opecv 3.4.5编译的，如果不重新基于opencv 3.2.0编译普通版本，编译ROS的时候就会提示<code>libORB_SLAM3.so</code>需要3.4.5版本的opencv才能正常链接，终究还是版本对不上。</p>
<hr>
<p>另外，我们从源码使用cmake构建安装的opencv 3.2.0一般设置的安装目录都会和ROS自带的目录不同，比如cmake构建的安装目录是<code>/usr/local/lib</code>，ROS安装的目录是<code>/usr/lib/aarch64-linux-gnu</code>。所以cmake构建的时候会出现多个如下关于opencv的warning，可以不用管，不会影响程序编译和运行，因为它们都是opencv 3.2.0版本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">runtime library [libopencv_core.so.3.2] in /usr/lib/aarch64-linux-gnu may be hidden by files in:</span><br><span class="line">  /usr/local/lib</span><br></pre></td></tr></table></figure>
<p>当然，你也可以选择直接使用ROS携带的opencv 3.2.0，不自己重新编译安装一个版本了（其实也不需要）。</p>
<h4 id="3-2-4-AR代码错误（四处）">3.2.4. AR代码错误（四处）</h4>
<p>修复了opencv版本问题后，接下来就会遇到一堆由于<code>Examples_old/ROS/ORB_SLAM3/src/AR</code>路径下的代码问题导致的错误。如果你不需要使用MonoAR也就是<strong>单目AR</strong>功能，可以直接<strong>注释掉</strong>CMakeLists文件里面71行的如下部分，跳过AR代码的编译。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/CMakeLists.txt</span></span><br><span class="line"><span class="comment"># Node for monocular camera (Augmented Reality Demo)</span></span><br><span class="line">rosbuild_add_executable(MonoAR</span><br><span class="line"> src/AR/ros_mono_ar.cc</span><br><span class="line"> src/AR/ViewerAR.h</span><br><span class="line"> src/AR/ViewerAR.cc</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span>(MonoAR</span><br><span class="line"> <span class="variable">$&#123;LIBS&#125;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>注释掉之后，应该就可以成功编译其他部分了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[rosbuild] Including /opt/ros/melodic/share/roslisp/rosbuild/roslisp.cmake</span><br><span class="line">[rosbuild] Including /opt/ros/melodic/share/roscpp/rosbuild/roscpp.cmake</span><br><span class="line">[rosbuild] Including /opt/ros/melodic/share/rospy/rosbuild/rospy.cmake</span><br><span class="line">Build type: Release</span><br><span class="line">-- Using flag -std=c++11.</span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: /work/ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/build</span><br><span class="line">[  0%] Built target rospack_genmsg_libexe</span><br><span class="line">[  0%] Built target rosbuild_precompile</span><br><span class="line">[ 40%] Built target RGBD</span><br><span class="line">[ 40%] Built target Stereo</span><br><span class="line">[ 80%] Built target Mono_Inertial</span><br><span class="line">[ 80%] Built target Stereo_Inertial</span><br><span class="line">[100%] Built target Mono</span><br></pre></td></tr></table></figure>
<p>如果你需要MonoAR，<strong>就需要上手改代码了</strong>。参考<a target="_blank" rel="noopener" href="https://github.com/UZ-SLAMLab/ORB_SLAM3/issues/442">github.com/UZ-SLAMLab/ORB_SLAM3/issues/442</a>，依次修复问题。</p>
<p>这部分修改很杂，你可以直接根据我的提交记录来修改：<a target="_blank" rel="noopener" href="https://github.com/musnows/ORB_SLAM3/commit/4e1cbdb5b9d18e0b9eb0f07ad70595d3f274200f">Fix compile error of ROS AR, used opencv 3.2.0 for ROS compile. · musnows/ORB_SLAM3@4e1cbdb · GitHub</a></p>
<hr>
<p>1）类型<code>Sophus::SE3&lt;float&gt;</code>和<code>cv::Mat</code>不匹配</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/work/ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/src/AR/ros_mono_ar.cc: In member function &#x27;void ImageGrabber::GrabImage(const ImageConstPtr&amp;)&#x27;:</span><br><span class="line">/work/ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/src/AR/ros_mono_ar.cc:151:41: error: conversion from &#x27;Sophus::SE3f &#123;aka Sophus::SE3&lt;float&gt;&#125;&#x27; to non-scalar type &#x27;cv::Mat&#x27; requested</span><br><span class="line">     cv::Mat Tcw = mpSLAM-&gt;TrackMonocular(cv_ptr-&gt;image,cv_ptr-&gt;header.stamp.toSec());</span><br><span class="line">                   ~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">CMakeFiles/MonoAR.dir/build.make:198: recipe for target &#x27;CMakeFiles/MonoAR.dir/src/AR/ViewerAR.cc.o&#x27; failed</span><br></pre></td></tr></table></figure>
<p>修改<code>ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/src/AR/ros_mono_ar.cc</code>的151行，被注释掉的是源代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cv::Mat Tcw = mpSLAM-&gt;TrackMonocular(cv_ptr-&gt;image,cv_ptr-&gt;header.stamp.toSec());</span></span><br><span class="line">cv::Mat Tcw;</span><br><span class="line">Sophus::SE3f Tcw_SE3f = mpSLAM-&gt;<span class="built_in">TrackMonocular</span>(cv_ptr-&gt;image,cv_ptr-&gt;header.stamp.<span class="built_in">toSec</span>());</span><br><span class="line">Eigen::Matrix4f Tcw_Matrix = Tcw_SE3f.<span class="built_in">matrix</span>();</span><br><span class="line">cv::<span class="built_in">eigen2cv</span>(Tcw_Matrix, Tcw);</span><br></pre></td></tr></table></figure>
<p>2）<code>'eigen2cv' is not a member of 'cv'</code> 错误</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/work/ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/src/AR/ros_mono_ar.cc:155:9: error: &#x27;eigen2cv&#x27; is not a member of &#x27;cv&#x27;</span><br><span class="line">     cv::eigen2cv(Tcw_Matrix, Tcw);</span><br><span class="line">         ^~~~~~~~</span><br><span class="line">/work/ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/src/AR/ros_mono_ar.cc:155:9: note: suggested alternative: &#x27;eigen&#x27;</span><br><span class="line">     cv::eigen2cv(Tcw_Matrix, Tcw);</span><br><span class="line">         ^~~~~~~~</span><br><span class="line">         eigen</span><br></pre></td></tr></table></figure>
<p>在<code>ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/src/AR/ros_mono_ar.cc</code>和<code>ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/src/AR/ViewerAR.h</code>顶部添加三个头文件</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Eigen/Dense&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/core/eigen.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>3）类型<code>Eigen::Matrix&lt;float, 3, 1&gt;</code>和<code>cv::Mat</code>不匹配</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/work/ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/src/AR/ViewerAR.cc: In member function &#x27;void ORB_SLAM3::Plane::Recompute()&#x27;:</span><br><span class="line">/work/ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/src/AR/ViewerAR.cc:530:42: error: conversion from &#x27;Eigen::Vector3f &#123;aka Eigen::Matrix&lt;float, 3, 1&gt;&#125;&#x27; to non-scalar type &#x27;cv::Mat&#x27; requested</span><br><span class="line">             cv::Mat Xw = pMP-&gt;GetWorldPos();</span><br><span class="line">                          ~~~~~~~~~~~~~~~~^~</span><br></pre></td></tr></table></figure>
<p>修改<code>ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/src/AR/ViewerAR.cc:530</code>处代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cv::Mat Xw = pMP-&gt;GetWorldPos();</span></span><br><span class="line">cv::Mat Xw;</span><br><span class="line">cv::<span class="built_in">eigen2cv</span>(pMP-&gt;<span class="built_in">GetWorldPos</span>(), Xw);</span><br></pre></td></tr></table></figure>
<p>4）尾插错误 <code>no matching function for call to 'std::vector&lt;cv::Mat&gt;::push_back(Eigen::Vector3f)'</code></p>
<p>这个问题也是类型不匹配</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/work/ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/src/AR/ViewerAR.cc: In member function &#x27;ORB_SLAM3::Plane* ORB_SLAM3::ViewerAR::DetectPlane(cv::Mat, const std::vector&lt;ORB_SLAM3::MapPoint*&gt;&amp;, int)&#x27;:</span><br><span class="line">/work/ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/src/AR/ViewerAR.cc:405:53: error: no matching function for call to &#x27;std::vector&lt;cv::Mat&gt;::push_back(Eigen::Vector3f)&#x27;</span><br><span class="line">                 vPoints.push_back(pMP-&gt;GetWorldPos());</span><br><span class="line">                                                     ^</span><br></pre></td></tr></table></figure>
<p>修改<code>ORB_SLAM3/Examples_old/ROS/ORB_SLAM3/src/AR/ViewerAR.cc:405</code>的代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vPoints.push_back(pMP-&gt;GetWorldPos());</span></span><br><span class="line">cv::Mat WorldPos;</span><br><span class="line">cv::<span class="built_in">eigen2cv</span>(pMP-&gt;<span class="built_in">GetWorldPos</span>(), WorldPos);</span><br><span class="line">vPoints.<span class="built_in">push_back</span>(WorldPos);</span><br></pre></td></tr></table></figure>
<h3 id="3-3-成功编译">3.3. 成功编译</h3>
<p>修改完毕上述四个问题后，就应该可以编译成功了。</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2025/02/ecf71dac31b76332a3415d6ea13211a2.png" alt="image.png"></p>
<p>编译完成后会多出很多可执行文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-linux-22-04-02-desktop:/work/ORB_SLAM3/Examples_old/ROS/ORB_SLAM3# ls</span><br><span class="line">Asus.yaml  CMakeLists.txt  Mono  MonoAR  Mono_Inertial  RGBD  Stereo  Stereo_Inertial  build  lib  manifest.xml  src</span><br></pre></td></tr></table></figure>
<p>注意这些可执行文件是不能直接运行的，因为它们是针对ROS设计的文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-linux-22-04-02-desktop:/work/ORB_SLAM3/Examples_old/ROS/ORB_SLAM3# ./Mono</span><br><span class="line">[ERROR] [1739083807.698375008]: [registerPublisher] Failed to contact master at [localhost:11311].  Retrying...</span><br><span class="line">^C</span><br><span class="line">Usage: rosrun ORB_SLAM3 Mono path_to_vocabulary path_to_settings</span><br></pre></td></tr></table></figure>
<h2 id="4-在ROS下运行项目">4. 在ROS下运行项目</h2>
<p>参考博客：<a target="_blank" rel="noopener" href="https://zhaoxuhui.top/blog/2020/09/30/orb-slam3-cmake-ros-compilation-and-test.html">ORB-SLAM3的CMake与ROS编译以及测试</a>；<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/31c95d9a5f97">ORB SLAM 2 demo 复现（普通模式 + ROS 模式） - 简书</a>；</p>
<h3 id="4-1-下载TUM和EuRoC数据集">4.1. 下载TUM和EuRoC数据集</h3>
<p>因为是在ROS环境下运行，所以数据集不能用之前下载的tgz格式的了，必须使用ROS专门的bag格式的数据集。</p>
<ul>
<li>TUM RGB-D数据集：<a target="_blank" rel="noopener" href="https://cvg.cit.tum.de/data/datasets/rgbd-dataset/download">cvg.cit.tum.de/data/datasets/rgbd-dataset/download</a>；</li>
<li>EuRoC双目数据集：<a target="_blank" rel="noopener" href="http://robotics.ethz.ch/~asl-datasets/ijrr_euroc_mav_dataset/machine_hall/MH_01_easy/MH_01_easy.bag">robotics.ethz.ch/~asl-datasets/ijrr_euroc_mav_dataset/machine_ha…</a></li>
</ul>
<p>在TUM数据集的下载页面中，往下滑可以看到每个数据集的简单介绍，这里就能下载到bag格式的数据集。</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2025/02/2ec14dc5b2954aba91c9d2b437da6038.png" alt="image.png"></p>
<p>比如<code>fr1/desk</code>对应的rosbag文件的下载链接：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://cvg.cit.tum.de/rgbd/dataset/freiburg1/rgbd_dataset_freiburg1_desk.bag</span><br></pre></td></tr></table></figure>
<p>下载完毕后，可以使用rosbag info命令查看数据集中有的topic信息：</p>
<ul>
<li>Topic是一个命名的通信管道，用于在不同的ROS节点之间传递信息；</li>
<li>每个Topic都有一个唯一的名称，节点可以通过这个名称来订阅这个topic的信息；</li>
<li>Topic中的数据以message的格式传输，message是ROS中定义好的数据结构，如 <code>sensor_msgs/Image</code>、<code>geometry_msgs/Pose</code> 等；</li>
</ul>
<p>举个例子，<code>fr1/desk</code>数据集的Topic信息如下，其中depth就是深度数据，rgb就是普通的彩色录像数据。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-linux-22-04-02-desktop:/work/ORB_SLAM3# rosbag info datasets/TUM/rgbd_dataset_freiburg1_desk.bag</span><br><span class="line">path:         datasets/TUM/rgbd_dataset_freiburg1_desk.bag</span><br><span class="line">version:      2.0</span><br><span class="line">duration:     23.8s</span><br><span class="line">start:        May 10 2011 20:44:09.56 (1305031449.56)</span><br><span class="line">end:          May 10 2011 20:44:33.32 (1305031473.32)</span><br><span class="line">size:         371.7 MB</span><br><span class="line">messages:     19893</span><br><span class="line">compression:  bz2 [1210/1210 chunks; 29.85%]</span><br><span class="line">uncompressed:   1.2 GB @ 52.3 MB/s</span><br><span class="line">compressed:   370.9 MB @ 15.6 MB/s (29.85%)</span><br><span class="line">types:        sensor_msgs/CameraInfo         [c9a58c1b0b154e0e6da7578cb991d214]</span><br><span class="line">              sensor_msgs/Image              [060021388200f6f0f447d0fcd9c64743]</span><br><span class="line">              sensor_msgs/Imu                [6a62c6daae103f4ff57a132d6f95cec2]</span><br><span class="line">              tf/tfMessage                   [94810edda583a504dfda3829e70d7eec]</span><br><span class="line">              visualization_msgs/MarkerArray [f10fe193d6fac1bf68fad5d31da421a7]</span><br><span class="line">topics:       /camera/depth/camera_info     595 msgs    : sensor_msgs/CameraInfo        </span><br><span class="line">              /camera/depth/image           595 msgs    : sensor_msgs/Image             </span><br><span class="line">              /camera/rgb/camera_info       613 msgs    : sensor_msgs/CameraInfo        </span><br><span class="line">              /camera/rgb/image_color       613 msgs    : sensor_msgs/Image             </span><br><span class="line">              /cortex_marker_array         2360 msgs    : visualization_msgs/MarkerArray</span><br><span class="line">              /imu                        11815 msgs    : sensor_msgs/Imu               </span><br><span class="line">              /tf                          3302 msgs    : tf/tfMessage</span><br></pre></td></tr></table></figure>
<p>而给出的EuRoC双目数据集的Topic如下，有两个cam就对应了左侧和右侧的两个相机。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-linux-22-04-02-desktop:/work/ORB_SLAM3/datasets# rosbag info MH_01_easy.bag </span><br><span class="line">path:        MH_01_easy.bag</span><br><span class="line">version:     2.0</span><br><span class="line">duration:    3:06s (186s)</span><br><span class="line">start:       Jun 25 2014 03:02:59.81 (1403636579.81)</span><br><span class="line">end:         Jun 25 2014 03:06:06.70 (1403636766.70)</span><br><span class="line">size:        2.5 GB</span><br><span class="line">messages:    47283</span><br><span class="line">compression: none [2456/2456 chunks]</span><br><span class="line">types:       geometry_msgs/PointStamped [c63aecb41bfdfd6b7e1fac37c7cbe7bf]</span><br><span class="line">             sensor_msgs/Image          [060021388200f6f0f447d0fcd9c64743]</span><br><span class="line">             sensor_msgs/Imu            [6a62c6daae103f4ff57a132d6f95cec2]</span><br><span class="line">topics:      /cam0/image_raw    3682 msgs    : sensor_msgs/Image         </span><br><span class="line">             /cam1/image_raw    3682 msgs    : sensor_msgs/Image         </span><br><span class="line">             /imu0             36820 msgs    : sensor_msgs/Imu           </span><br><span class="line">             /leica/position    3099 msgs    : geometry_msgs/PointStamped</span><br></pre></td></tr></table></figure>
<p>假设我们使用自己的摄像头的话，也是利用ROS的工具将我们摄像头的数据输入到一个Topic中，这样就可以供系统的其他组件，比如SLAM系统来读取，以此实现在ROS系统上硬件输入和软件的读取。这便是使用ROS模式和普通模式的最大区别，普通模式下我们必须要直接提供程序的数据输入源，才能让程序运行起来；而ROS模式下我们可以先把整个SLAM系统启动起来，再通过我们想要的方式往SLAM系统订阅的Topic里面喂数据即可。</p>
<h3 id="4-2-单目运行">4.2. 单目运行</h3>
<p>刚刚我们下载的TUM fr1/desk的数据集，即可以用作RGB-D模式的输入，又可以做单目摄像头的输入，因为深度数据是独立于RGB单目数据的。</p>
<p>刚刚我们直接运行Mono的时候，就打印出了一个Usage</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-linux-22-04-02-desktop:/work/ORB_SLAM3/Examples_old/ROS/ORB_SLAM3# ./Mono</span><br><span class="line">[ERROR] [1739083807.698375008]: [registerPublisher] Failed to contact master at [localhost:11311].  Retrying...</span><br><span class="line">^C</span><br><span class="line">Usage: rosrun ORB_SLAM3 Mono path_to_vocabulary path_to_settings</span><br></pre></td></tr></table></figure>
<p>我们要使用的就是这个命令，rosrun代表启动一个节点，<code>ORB_SLAM3</code>是我们当前使用的包名称，也就是CMakeLists里面注册的项目名称，Mono是我们要执行的可执行文件名称。后面的两个参数分别是词袋文件和相机的配置文件。</p>
<p>最终执行的命令如下，需要在两个终端中执行（在项目根目录执行）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开终端A</span></span><br><span class="line">roscore</span><br><span class="line"><span class="comment"># 打开终端B</span></span><br><span class="line">rosrun ORB_SLAM3 Mono Vocabulary/ORBvoc.txt Examples_old/Monocular/TUM1.yaml</span><br></pre></td></tr></table></figure>
<p>如果执行rosrun的时候提示ORB_SLAM3找不到，则需要执行如下命令（前文提到过）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ROS_PACKAGE_PATH=<span class="variable">$ROS_PACKAGE_PATH</span>:<span class="variable">$PWD</span>/Examples_old/ROS/ORB_SLAM3</span><br></pre></td></tr></table></figure>
<p>执行了之后，就会启动ORB_SLAM3的Map Viewer，此时是黑屏的，因为么有任何数据被送到ORB_SLAM3订阅的Topic中。</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2025/02/3fb20983c6b8e63056fa3ab9f7dc80a0.png" alt="image.png"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2025/02/6f1ba02f88e3314c3040368b1af6aec9.png" alt="image.png"></p>
<p>再新建一个终端，执行如下命令，将TUM数据集bag文件里面的Topic绑定到ORB_SLAM3订阅的Topic上，这样就能获取到数据了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rosbag play \</span><br><span class="line">    datasets/TUM/rgbd_dataset_freiburg1_desk.bag \</span><br><span class="line">    /camera/rgb/image_color:=/camera/image_raw</span><br></pre></td></tr></table></figure>
<p>其中，最后一个参数<code>/camera/rgb/image_color:=/camera/image_raw</code>指代将bag文件中的<code>/camera/rgb/image_color</code>绑定到<code>/camera/image_raw</code>上，后者就是ORB_SLAM3订阅的相机原始数据的Topic，相当于将bag中已有的图像数据重新喂给了我们的SLAM系统。</p>
<p>因为ROS的Topic机制，这种喂进去的数据集和接一个摄像头得到的实时数据，对于订阅这个Topic的SLAM系统而言是完全一样的！</p>
<p>执行这个命令后，就能在GUI里面看到相机的数据流和SLAM的建图了</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2025/02/713bc539193427764c593312fd392a8e.png" alt="image.png"></p>
<h3 id="4-3-RGB-D运行">4.3. RGB-D运行</h3>
<p>RGB-D相机也是使用相同的命令来执行，先在另外一个终端执行roscore，然后执行如下命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun ORB_SLAM3 RGBD Vocabulary/ORBvoc.txt Examples_old/RGB-D/TUM1.yaml</span><br></pre></td></tr></table></figure>
<p>刚启动的时候也是黑屏</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2025/02/6f1ba02f88e3314c3040368b1af6aec9.png" alt="image.png"></p>
<p>再开另外一个终端，开始喂我们的数据集，这里用了两个<code>:=</code>号，分别绑定了原始的RGB相机数据到<code>/camera/rgb/image_raw </code>，绑定了深度数据到<code>/camera/depth_registered/image_raw</code>上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rosbag play \</span><br><span class="line">    datasets/TUM/rgbd_dataset_freiburg1_desk.bag \</span><br><span class="line">    /camera/rgb/image_color:=/camera/rgb/image_raw \</span><br><span class="line">    /camera/depth/image:=/camera/depth_registered/image_raw</span><br></pre></td></tr></table></figure>
<p>随后GUI里面也开始显示图像了</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2025/02/e5a78bd10e4b6514f7ed63f02ce7dacd.png" alt="image.png"></p>
<p>等运行结束后，会发现此时SLAM的建图结果是不对的，所有的点都在很小的一块区域中</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2025/02/51dc1236b065fbedcde4273dbea37972.png" alt="image.png"></p>
<p>作为对比，下图为本地虚拟机在普通模式下运行时的RGB-D建图结果，很明显和上图完全不一样。</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2025/02/fb081dc6226497056b3613b2220e9aa9.png" alt="image.png"></p>
<p>这是因为<code>Examples_old/RGB-D/TUM1.yaml</code>数据配置有问题。在TUM官网上提到了这两个数据集在ROS和非ROS中是不一样的，实际上这个文件里面也有注释</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deptmap values factor </span></span><br><span class="line"><span class="attr">DepthMapFactor:</span> <span class="number">5000</span> <span class="comment"># 1.0 for ROS_bag</span></span><br></pre></td></tr></table></figure>
<p>官网说明：<a target="_blank" rel="noopener" href="https://cvg.cit.tum.de/data/datasets/rgbd-dataset/file_formats#intrinsic_camera_calibration_of_the_kinect">cvg.cit.tum.de/data/datasets/rgbd-dataset/file_formats#intrinsic…</a></p>
<blockquote>
<p><strong>Color images and depth maps</strong></p>
<p>We provide the time-stamped color and depth images as a gzipped tar file (TGZ).</p>
<ul>
<li>The color images are stored as 640x480 8-bit RGB images in PNG format.</li>
<li>The depth maps are stored as 640x480 16-bit monochrome images in PNG format.</li>
<li>The color and depth images are already pre-registered using the OpenNI driver from PrimeSense, i.e., the pixels in the color and depth images correspond already 1:1.</li>
<li>The depth images are scaled by a factor of 5000, i.e., a pixel value of 5000 in the depth image corresponds to a distance of 1 meter from the camera, 10000 to 2 meter distance, etc. A pixel value of 0 means missing value/no data.</li>
</ul>
</blockquote>
<p>这里是深度值的校正系数(factor)，使用时的计算公式为<code>Z = depth_image[v,u] / factor</code>，在ROS中要把它改成1才可以。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">factor</span> <span class="string">=</span> <span class="number">5000</span> <span class="comment"># for the 16-bit PNG files</span></span><br><span class="line"><span class="string">factor</span> <span class="string">=</span> <span class="number">1</span>    <span class="comment"># for the 32-bit float images in the ROS bag files</span></span><br></pre></td></tr></table></figure>
<p>将DepthMapFactor修改为<code>1.0</code>之后的建图就正常一些了</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2025/02/e867d520f01580ce93b865cfc9b56025.png" alt="image.png"></p>
<h3 id="4-4-双目运行">4.4. 双目运行</h3>
<p>下载EuRoC对应的rosbag：<a target="_blank" rel="noopener" href="http://robotics.ethz.ch/~asl-datasets/ijrr_euroc_mav_dataset/machine_hall/MH_01_easy/MH_01_easy.bag">MH_01_easy.bag</a>，上文已经给出过该数据集对应的Topic了，其中要用到的 Topic 是左右两个摄像头的数据 <code>/cam0/image_raw</code> 和 <code>/cam1/image_raw</code>。ORB_SLAM3 中双目 Stereo 接收的 Topic 分别为 <code>/camera/left/image_raw</code> 和 <code>/camera/right/image_raw</code>，因此在运行时也需要绑定一下 Topic。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">topics:      /cam0/image_raw    3682 msgs    : sensor_msgs/Image         </span><br><span class="line">             /cam1/image_raw    3682 msgs    : sensor_msgs/Image         </span><br><span class="line">             /imu0             36820 msgs    : sensor_msgs/Imu           </span><br><span class="line">             /leica/position    3099 msgs    : geometry_msgs/PointStamped</span><br></pre></td></tr></table></figure>
<p>双目的rosrun命令最后多了一个bool类型参数<code>do_rectify</code>，含义为是否进行矫正，根据需要选择true或false。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage: rosrun ORB_SLAM3 Stereo path_to_vocabulary path_to_settings do_rectify</span><br></pre></td></tr></table></figure>
<p>执行如下命令，先启动Stereo双目模式下的SLAM，然后开始播放数据集，同样是使用<code>:=</code>分别绑定左侧和右侧两个摄像头的数据。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 终端a</span></span><br><span class="line">roscore</span><br><span class="line"><span class="comment"># 终端b</span></span><br><span class="line">rosrun ORB_SLAM3 Stereo Vocabulary/ORBvoc.txt Examples_old/Stereo/EuRoC.yaml <span class="literal">true</span></span><br><span class="line"><span class="comment"># 终端c</span></span><br><span class="line">rosbag play MH_01_easy.bag /cam0/image_raw:=/camera/left/image_raw /cam1/image_raw:=/camera/right/image_raw</span><br></pre></td></tr></table></figure>
<p>也是成功运行起来了</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2025/02/4532d161bce1a806b99e91a7f55c5097.png" alt="image.png"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2025/02/fa1f127cf0f7c119d434b75416c9f6c1.png" alt="image.png"></p>
<h2 id="5-The-end">5. The end</h2>
<p>本文介绍了如何在ROS环境下编译ORB_SLAM3，并使用TUM和EuRoC数据集测试单目、双目、RGB-D三种模式在ROS下运行的效果。希望对你有帮助！</p>
<p>更新：ORB_SLAM2的ROS运行命令和本文记录的完全一致，只需要把rosrun里面的包名改成ORB_SLAM2就可以了。下图是在ROS模式下运行ORB_SLAM2的RGB-D的截图。</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2025/02/269ace5a14d78815e436b9633e0cd435.png" alt="image.png"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.musnow.top">慕雪年华</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.musnow.top/posts/5090585017/">https://blog.musnow.top/posts/5090585017/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.musnow.top" target="_blank">慕雪的寒舍</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux/">Linux</a><a class="post-meta__tags" href="/tags/Cpp/">Cpp</a><a class="post-meta__tags" href="/tags/SLAM/">SLAM</a></div><div class="post-share"><div class="social-share" data-image="https://img.musnow.top/i/2025/02/4532d161bce1a806b99e91a7f55c5097.png" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="/pluginsSrc/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="/pluginsSrc/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://ifdian.net/a/128ahri" target="_blank"><img class="post-qr-code-img" src="/img/ico/aifadian.webp" alt="爱发电"/></a><div class="post-qr-code-desc">爱发电</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/3771271576/" title="【SLAM】在 ubuntu 18.04 arm 容器中安装ROS环境"><img class="cover" src="https://img.musnow.top/i/2025/02/0fd67ca21e085e04f3ab28ed1c4f0b5d.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">【SLAM】在 ubuntu 18.04 arm 容器中安装ROS环境</div></div><div class="info-2"><div class="info-item-1">在 ubuntu 18.04 arm（docker容器）中安装ROS环境</div></div></div></a><a class="pagination-related" href="/posts/8855455861/" title="【Hexo】hexo-butterfly主题添加影评书评页面"><img class="cover" src="https://img.musnow.top/i/2025/02/e65c6d2622d08322a542f681ee89b31b.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">【Hexo】hexo-butterfly主题添加影评书评页面</div></div><div class="info-2"><div class="info-item-1">hexo-butterfly主题添加影评书评页面，并用action实现自动化更新</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/7873538113/" title="【SLAM】在本地虚拟机和AutoDL云端环境以TUM-RGBD数据集运行ORB_SLAM3"><img class="cover" src="https://img.musnow.top/i/2025/02/fb081dc6226497056b3613b2220e9aa9.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-04</div><div class="info-item-2">【SLAM】在本地虚拟机和AutoDL云端环境以TUM-RGBD数据集运行ORB_SLAM3</div></div><div class="info-2"><div class="info-item-1">在本地虚拟机和AutoDL云端环境以TUM-RGBD数据集运行ORB_SLAM3的介绍</div></div></div></a><a class="pagination-related" href="/posts/1589125738/" title="【SLAM】于ubuntu18.04上纯CPU运行GCNv2_SLAM的记录（ARM64&#x2F;AMD64）"><img class="cover" src="https://img.musnow.top/i/2025/01/1cf6ea0426239abcba02e8a38ce24bea.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-31</div><div class="info-item-2">【SLAM】于ubuntu18.04上纯CPU运行GCNv2_SLAM的记录（ARM64&#x2F;AMD64）</div></div><div class="info-2"><div class="info-item-1">配置GCNv2_SLAM所需的环境并实现纯CPU运行项目的全过程记录（ARM64/AMD64）</div></div></div></a><a class="pagination-related" href="/posts/1071165018/" title="【SLAM】于AutoDL云上GPU运行GCNv2_SLAM的记录"><img class="cover" src="https://img.musnow.top/i/2025/02/c16bf7fe837c06718a76843ba7b923eb.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-02</div><div class="info-item-2">【SLAM】于AutoDL云上GPU运行GCNv2_SLAM的记录</div></div><div class="info-2"><div class="info-item-1">配置GCNv2_SLAM所需环境并实现AutoDL云端运行项目的全过程记录</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="artalk-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/favicon.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">慕雪年华</div><div class="author-info-description">爱折腾的代码初学者</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">460</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">76</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">24</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/musnows/"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://musnow.top/?utm_source=blog" target="_blank" title="个人主页"><i class="fa fa-home"></i></a><a class="social-icon" href="mailto:muxue@musnow.top" target="_blank" title="email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://web.musnow.top/?utm_source=blog" target="_blank" title="导航站点"><i class="fas fa-server"></i></a><a class="social-icon" href="https://gitee.com/musnows" target="_blank" title="Gitee"><i class="fa-sharp fa-solid fa-g"></i></a><a class="social-icon" href="https://blog.csdn.net/muxuen" target="_blank" title="CSDN"><i class="fa-brands fa-blogger-b"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss-square"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到寒舍，近来可好？</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%BC%95%E8%A8%80"><span class="toc-text">1. 引言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%AE%89%E8%A3%85ROS%E7%8E%AF%E5%A2%83"><span class="toc-text">2. 安装ROS环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%BC%96%E8%AF%91ROS%E7%8E%AF%E5%A2%83%E7%9A%84ORB-SLAM3"><span class="toc-text">3. 编译ROS环境的ORB_SLAM3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E7%BC%96%E8%AF%91%E5%91%BD%E4%BB%A4"><span class="toc-text">3.1. 编译命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-%E5%85%88%E7%BC%96%E8%AF%91%E6%99%AE%E9%80%9A%E7%89%88%E6%9C%AC"><span class="toc-text">3.1.1. 先编译普通版本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-%E4%BF%AE%E6%94%B9build-ros-sh%E8%84%9A%E6%9C%AC"><span class="toc-text">3.1.2. 修改build_ros.sh脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-3-%E7%BC%96%E8%AF%91ROS%E7%89%88%E6%9C%AC"><span class="toc-text">3.1.3. 编译ROS版本</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E7%BC%96%E8%AF%91%E6%9C%9F%E9%97%B4%E9%81%87%E5%88%B0%E7%9A%84%E5%90%84%E7%A7%8D%E9%97%AE%E9%A2%98"><span class="toc-text">3.2. 编译期间遇到的各种问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-cmake%E9%94%99%E8%AF%AFROS-PACKAGE-PATH"><span class="toc-text">3.2.1. cmake错误ROS_PACKAGE_PATH</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-%E5%A4%B4%E6%96%87%E4%BB%B6se3-hpp%E6%89%BE%E4%B8%8D%E5%88%B0"><span class="toc-text">3.2.2. 头文件se3.hpp找不到</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-OpenCV-%E7%89%88%E6%9C%AC%E4%B8%8D%E5%8C%B9%E9%85%8D"><span class="toc-text">3.2.3. OpenCV 版本不匹配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-4-AR%E4%BB%A3%E7%A0%81%E9%94%99%E8%AF%AF%EF%BC%88%E5%9B%9B%E5%A4%84%EF%BC%89"><span class="toc-text">3.2.4. AR代码错误（四处）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E6%88%90%E5%8A%9F%E7%BC%96%E8%AF%91"><span class="toc-text">3.3. 成功编译</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%9C%A8ROS%E4%B8%8B%E8%BF%90%E8%A1%8C%E9%A1%B9%E7%9B%AE"><span class="toc-text">4. 在ROS下运行项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E4%B8%8B%E8%BD%BDTUM%E5%92%8CEuRoC%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-text">4.1. 下载TUM和EuRoC数据集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%8D%95%E7%9B%AE%E8%BF%90%E8%A1%8C"><span class="toc-text">4.2. 单目运行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-RGB-D%E8%BF%90%E8%A1%8C"><span class="toc-text">4.3. RGB-D运行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E5%8F%8C%E7%9B%AE%E8%BF%90%E8%A1%8C"><span class="toc-text">4.4. 双目运行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-The-end"><span class="toc-text">5. The end</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/5899307553/" title="【Hexo】为自己的博客站点加上离线的AI摘要">【Hexo】为自己的博客站点加上离线的AI摘要</a><time datetime="2025-10-02T01:08:21.000Z" title="发表于 2025-10-02 09:08:21">2025-10-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/4044218607/" title="【Agent.04】AI时代的hello world：调用OpenAI接口，与大模型交互">【Agent.04】AI时代的hello world：调用OpenAI接口，与大模型交互</a><time datetime="2025-09-30T07:25:08.000Z" title="发表于 2025-09-30 15:25:08">2025-09-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/3454235760/" title="【面试】求职面试大忌：自断后路">【面试】求职面试大忌：自断后路</a><time datetime="2025-09-29T11:31:10.000Z" title="发表于 2025-09-29 19:31:10">2025-09-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/4200815612/" title="【AI】配置claude-code-router转发Claude Code请求至OpenAI API格式">【AI】配置claude-code-router转发Claude Code请求至OpenAI API格式</a><time datetime="2025-09-27T12:33:46.000Z" title="发表于 2025-09-27 20:33:46">2025-09-27</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/main/mothra.webp);"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2025 By 慕雪年华</div><div class="footer_custom_text"><img src="/img/ico/gonganbeian.png" height="15" style="position:relative; top:2px;">&nbsp;<a href="https://beian.mps.gov.cn/#/query/webSearch?code=44190002007715" rel="noreferrer" target="_blank">粤公网安备44190002007715</a></br><a href="https://icp.gov.moe/?keyword=20230054" target="_blank"><img src="/img/badge/-%E8%90%8CICP%E5%A4%8720230054-ff69b4.svg" height="20px"></a>&nbsp<a href="/sitemap.xml" target="_blank"><img src="/img/badge/-SITEMAP-00CDCD.svg" height="20px"></a>&nbsp<a href="https://beian.miit.gov.cn/" target="_blank"><img src="/img/badge/%E7%B2%A4ICP%E5%A4%872023007189-red.svg" height="20px"></a></br><a href="https://travel.moe/go.html" target="_blank"><img src="/img/ico/moe-default-white.png" style="width:auto;height:25px" title="异次元之旅-跃迁-我们一起去萌站成员的星球旅行吧！"></a>&nbsp<a href="https://www.foreverblog.cn/go.html" target="_blank"><img src="/img/ico/wormhole_1_tp.gif" height="25px"></a>&nbsp<a href="https://www.travellings.cn/go.html" target="_blank"><img src="/img/ico/travelling_icon.gif" height="25px"></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/pluginsSrc/@fancyapps/ui/dist/fancybox/fancybox.umd.js"></script><script src="/pluginsSrc/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }

      const script = document.createElement('script')
      script.src = '/pluginsSrc/mathjax/es5/tex-mml-chtml.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('/pluginsSrc/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  let artalkItem = null
  const option = null
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'

  const destroyArtalk = () => {
    if (artalkItem) {
      artalkItem.destroy()
      artalkItem = null
    }
  }

  const artalkChangeMode = theme => artalkItem && artalkItem.setDarkMode(theme === 'dark')

  const initArtalk = (el = document, pageKey = location.pathname) => {
    artalkItem = Artalk.init({
      el: el.querySelector('#artalk-wrap'),
      server: 'https://artk.musnow.top',
      site: 'mublog',
      darkMode: document.documentElement.getAttribute('data-theme') === 'dark',
      ...option,
      pageKey: isShuoshuo ? pageKey : (option && option.pageKey) || pageKey
    })

    if (GLOBAL_CONFIG.lightbox === 'null') return
    artalkItem.on('list-loaded', () => {
      artalkItem.ctx.get('list').getCommentNodes().forEach(comment => {
        const $content = comment.getRender().$content
        btf.loadLightbox($content.querySelectorAll('img:not([atk-emoticon])'))
      })
    })

    if (isShuoshuo) {
      window.shuoshuoComment.destroyArtalk = () => {
        destroyArtalk()
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    btf.addGlobalFn('pjaxSendOnce', destroyArtalk, 'destroyArtalk')
    btf.addGlobalFn('themeChange', artalkChangeMode, 'artalk')
  }

  const loadArtalk = async (el, pageKey) => {
    if (typeof Artalk === 'object') initArtalk(el, pageKey)
    else {
      await btf.getCSS('/pluginsSrc/artalk/dist/Artalk.css')
      await btf.getScript('/pluginsSrc/artalk/dist/Artalk.js')
      initArtalk(el, pageKey)
    }
  }

  if (isShuoshuo) {
    'Artalk' === 'Artalk'
      ? window.shuoshuoComment = { loadComment: loadArtalk }
      : window.loadOtherComment = loadArtalk
    return
  }

  if ('Artalk' === 'Artalk' || !false) {
    if (false) btf.loadComment(document.getElementById('artalk-wrap'), loadArtalk)
    else setTimeout(loadArtalk, 100)
  } else {
    window.loadOtherComment = loadArtalk
  }
})()</script></div><script src="/js/domain_check.js"></script><script>document.addEventListener('DOMContentLoaded',()=>{if(window.location.pathname.includes('/posts')){const e=document.querySelector('.footnotes');e&&e.insertBefore(document.createElement('strong').appendChild(document.createTextNode('脚注：')).parentNode,e.firstChild);}});</script><script id="click-heart" src="/pluginsSrc/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="true"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>