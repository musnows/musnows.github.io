<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>【网络】CDN/PCDN/SDN 详解 | 慕雪的寒舍</title><meta name="author" content="慕雪年华"><meta name="copyright" content="慕雪年华"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="朴实的学习原因：京东实习生招聘条目上写了这些技术，那就给他学了！"><meta property="og:type" content="article"><meta property="og:title" content="【网络】CDN&#x2F;PCDN&#x2F;SDN 详解"><meta property="og:url" content="https://blog.musnow.top/posts/292924834/index.html"><meta property="og:site_name" content="慕雪的寒舍"><meta property="og:description" content="朴实的学习原因：京东实习生招聘条目上写了这些技术，那就给他学了！"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://img.musnow.top/i/2023/08/1298b6b472d89a0007ac82fb213b1aeb.png"><meta property="article:published_time" content="2023-08-27T02:49:28.000Z"><meta property="article:modified_time" content="2023-08-27T02:49:28.000Z"><meta property="article:author" content="慕雪年华"><meta property="article:tag" content="CDN"><meta property="article:tag" content="SDN"><meta property="article:tag" content="P2P"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://img.musnow.top/i/2023/08/1298b6b472d89a0007ac82fb213b1aeb.png"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://blog.musnow.top/posts/292924834/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><meta name="google-site-verification" content="iR4A6ntiwhI9JX_YDe2ZFY6DerPD7c-NaLyIDlrDguY"><meta name="msvalidate.01" content="D5CD621F38EE3FB5071F785AD4977161"><meta name="baidu-site-verification" content="codeva-aZGKJiqRSI"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.4.0/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.staticfile.org/fancyapps-ui/5.0.19/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: {"limitDay":180,"position":"top","messagePrev":"距离上次更新本文已经过去了","messageNext":"天，文章部分内容可能已经过时，请注意甄别"},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":600,"languages":{"author":"作者: 慕雪年华","link":"链接: ","source":"来源: 慕雪的寒舍","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.staticfile.org/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdn.staticfile.org/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"【网络】CDN/PCDN/SDN 详解",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-08-27 10:49:28"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"JwxEfuZ8fwQ1GPEq",ck:"JwxEfuZ8fwQ1GPEq"})</script><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="慕雪的寒舍" type="application/atom+xml"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/favicon.jpg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">293</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">73</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><hr class="custom-hr"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 归档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/qa/"><i class="fa-fw fa-fw fas fa-comment-dots"></i><span> 留言</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-robot"></i><span> 机器人</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/posts/847195815/"><i class="fa-fw fab fa-waze"></i><span> Kook-Valorant</span></a></li><li><a class="site-page child" href="/posts/2556995516/"><i class="fa-fw fas fa-ticket-alt"></i><span> Kook-Ticket</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://kdocs.cn/l/cn3OnSwigGxx"><i class="fa-fw fas fa-microphone-alt"></i><span> Kook-VoiceShop</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://github.com/musnows/Kook-Afd-Webhook-Bot"><i class="fa-fw fa-brands fa-square-github"></i><span> Kook-AfdWh</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-user-friends"></i><span> 友人</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.travellings.cn/go.html"><i class="fa-fw fas fa-train"></i><span> 开往</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.foreverblog.cn/go.html"><i class="fa-fw fab fa-superpowers"></i><span> 虫洞</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-glass-whiskey"></i><span> 镜像</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="https://blog.musnow.top/?utm_source=mirror"><i class="fa-fw fas fa-home"></i><span> Main</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog1.musnow.top/?utm_source=mirror"><i class="fa-fw fa-brands fa-battle-net"></i><span> Netlify</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://musnows.github.io/?utm_source=mirror"><i class="fa-fw fa-brands fa-square-github"></i><span> Github</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog2.musnow.top/?utm_source=mirror"><i class="fa-fw fa-solid fa-square-caret-up"></i><span> Vercel</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://keep-hexo.musnow.top/?utm_source=mirror"><i class="fa-fw fa-brands fa-kickstarter"></i><span> Keep</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog.csdn.net/muxuen"><i class="fa-fw fas fa-copyright"></i><span> CSDN</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog.51cto.com/u_15307009"><i class="fa-fw fas fa-dice-five"></i><span> 51cto</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fab fa-blackberry"></i><span> 更多</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 画廊</span></a></li><li><a class="site-page child" href="/memos/"><i class="fa-fw fas fa-map-signs"></i><span> 说说</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image:url(https://img.musnow.top/i/2023/08/1298b6b472d89a0007ac82fb213b1aeb.png)"><nav id="nav"><span id="blog-info"><a href="/" title="慕雪的寒舍"><img class="site-icon" src="/favicon.jpg"><span class="site-name">慕雪的寒舍</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 归档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/qa/"><i class="fa-fw fa-fw fas fa-comment-dots"></i><span> 留言</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-robot"></i><span> 机器人</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/posts/847195815/"><i class="fa-fw fab fa-waze"></i><span> Kook-Valorant</span></a></li><li><a class="site-page child" href="/posts/2556995516/"><i class="fa-fw fas fa-ticket-alt"></i><span> Kook-Ticket</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://kdocs.cn/l/cn3OnSwigGxx"><i class="fa-fw fas fa-microphone-alt"></i><span> Kook-VoiceShop</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://github.com/musnows/Kook-Afd-Webhook-Bot"><i class="fa-fw fa-brands fa-square-github"></i><span> Kook-AfdWh</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-user-friends"></i><span> 友人</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.travellings.cn/go.html"><i class="fa-fw fas fa-train"></i><span> 开往</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.foreverblog.cn/go.html"><i class="fa-fw fab fa-superpowers"></i><span> 虫洞</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-glass-whiskey"></i><span> 镜像</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="https://blog.musnow.top/?utm_source=mirror"><i class="fa-fw fas fa-home"></i><span> Main</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog1.musnow.top/?utm_source=mirror"><i class="fa-fw fa-brands fa-battle-net"></i><span> Netlify</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://musnows.github.io/?utm_source=mirror"><i class="fa-fw fa-brands fa-square-github"></i><span> Github</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog2.musnow.top/?utm_source=mirror"><i class="fa-fw fa-solid fa-square-caret-up"></i><span> Vercel</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://keep-hexo.musnow.top/?utm_source=mirror"><i class="fa-fw fa-brands fa-kickstarter"></i><span> Keep</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog.csdn.net/muxuen"><i class="fa-fw fas fa-copyright"></i><span> CSDN</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog.51cto.com/u_15307009"><i class="fa-fw fas fa-dice-five"></i><span> 51cto</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fab fa-blackberry"></i><span> 更多</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 画廊</span></a></li><li><a class="site-page child" href="/memos/"><i class="fa-fw fas fa-map-signs"></i><span> 说说</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">【网络】CDN/PCDN/SDN 详解</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-08-27T02:49:28.000Z" title="发表于 2023-08-27 10:49:28">2023-08-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-08-27T02:49:28.000Z" title="更新于 2023-08-27 10:49:28">2023-08-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%B7%AE%E7%94%9F%E6%96%87%E5%85%B7%E5%A4%9A/">差生文具多</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>22分钟</span></span><span class="post-meta-separator">|</span><span data-flag-title="【网络】CDN/PCDN/SDN 详解"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="ArtalkPV"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>朴实的学习原因：京东实习生招聘条目上写了这些技术，那就给他学了！</p><span id="more"></span><blockquote><p>参考<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/baidu_41651554/article/details/122218513">https://blog.csdn.net/baidu_41651554/article/details/122218513</a></p></blockquote><p>嗨嗨嗨，直接上菜！</p><h1 id="1-CDN"><a href="#1-CDN" class="headerlink" title="1.CDN"></a>1.CDN</h1><p>CDN 的全程是 content delivery network，内容分发网络；说人话就是把网站产生的内容分发到各个用户请求的网络里去，具有 <strong>分布式</strong> 网络的特点！</p><h2 id="1-1- 前置声明"><a href="#1-1- 前置声明" class="headerlink" title="1.1 前置声明"></a>1.1 前置声明</h2><p>当代网络形势错综复杂，特别是视频、音频类网络服务的兴起，给互联网的贷款造成了很大的压力啊！</p><p>以之前很火的“延禧攻略”为例，当时曾经在某视频 APP 实现了 1 千万用户同时在线观看。如果大家观看的是 1080p 清晰度的视频（理论上需要 4Mbps 带宽），那么，累计需要的流量带宽是<br>$$<br>10,000,000×4Mbps&#x3D;40,000,000Mbps&#x3D;40Tbps<br>$$<br>这个数字老恐怖了！对于优酷、爱奇艺这样的互联网视频内容提供商来说，这无疑是非常巨大的流量压力。</p><p>如果按服务器用的 10Gbps 的万兆网卡来算，那也需要四千块万兆网卡才能顶得住这么大的流量消耗，更别提压根没有那么多地方给你插这么多网卡的事情了；</p><p>有这么一个说法：当用户打开一个页面，等待超过 4 秒，他就会关闭这个页面。也就是说，这个用户就会流失。用户流失对于公司来说可就是金钱流失！</p><p>所以，没有任何一家互联网服务提供商原因因为网络的问题而流失客户，那么我们就得像个办法来解决这种流量短时间暴发的问题！</p><p>而 CDN，就是一项非常有效的 <strong>缩短时延 </strong>的技术。</p><h2 id="1-2- 技术主体"><a href="#1-2- 技术主体" class="headerlink" title="1.2 技术主体"></a>1.2 技术主体</h2><p>CDN 缩短用户延时的办法也非常“简单”，其实就是将云服务部署到用户身边。在访问的时候，根据 DNS 的多线解析能力（即为不同地区提供不同的 IP 解析）选择离用户最近的服务器来为用户提供服务。</p><p><img src="https://img.musnow.top/i/2023/08/1298b6b472d89a0007ac82fb213b1aeb.png" alt="image-20230827105913951"></p><p>因为这样，CDN 就在内容层面上进行了一定的筛选和分发，所以他就叫内容分发网络；</p><p>具体来说，CDN 就是采用更多的缓存服务器（CDN 边缘节点），布放在用户访问相对集中的地区或网络中。当用户访问网站时，利用全局负载技术，将用户的访问指向距离最近的缓存服务器上，由缓存服务器响应用户请求。（有点像电商的本地仓）</p><p>大家可能觉得，这个不就是“镜像服务器”嘛？其实不一样。镜像服务器是源内容服务器的完整复制。而 CDN，是部分内容的缓存，智能程度更高。</p><p>确切地说，<strong>CDN&#x3D; 更智能的镜像 + 缓存 + 流量导流</strong></p><p>而且还需要注意的是，CDN 并不是只能缓存视频内容，它还可以对网站的静态资源（例如各类型图片、html、css、js 等）进行分发，对移动应用 APP 的静态内容（例如安装包 apk 文件、APP 内的图片视频等）进行分发。</p><p>CDN 的具体工作流程。举个例子，如果某个用户想要访问优酷的视频点播内容，那么：</p><p><img src="https://img.musnow.top/i/2023/08/8ad3d099d1138c6b02472adeb5a2097c.png" alt="img"></p><p>具体步骤如下</p><ol><li>当用户点击对应资源内容，应用根据域名地址到底层触发 DNS 请求；</li><li>先是请求的本地运营商的 DNS，再转发到 CDN 域名服务的 DNS；</li><li>CDN 域名服务的 DNS 会将 CDN 的 <strong>全局均衡负载服务器 </strong>的 IP 地址返回给用户；</li><li>用户向 CDN 的负载均衡设备发起 URL 的访问请求；</li><li>CDN 的负载均衡设备根据用户 IP 地址，以及用户请求的内容 URL，选择一台用户所属区域（离用户越近越好）的 <strong>缓存服务器</strong>；</li><li>负载均衡设备告诉用户这台缓存服务器的 IP 地址，让用户向所选择的缓存服务器发起请求；</li><li>用户向缓存服务器发起请求，缓存服务器响应，将用户请求内容发送给用户</li><li>如果这台服务器上没有用户想要的内容，那就根据 CDN 设置的 <strong>回源服务器</strong>（又称源站）来请求该 URL</li><li>缓存服务器从 <strong>源站 </strong>拉取内容缓存到本地，并传输给用户；并根据用户设置的缓存策略来判断是否需要保留该资源到本地，是则进行缓存。</li></ol><p>在 CDN 工作的整个流程中，源站的服务器 IP 是对用户不可见的；CDN 服务在实现了一定的资源访问加速的基础上，还附带了隐藏源站 IP 的功能，避免源站直接遭受火力打击（指服务器被攻击）</p><h2 id="1-3- 静态加速"><a href="#1-3- 静态加速" class="headerlink" title="1.3 静态加速"></a>1.3 静态加速</h2><p>所谓静态加速，是只加速源站所提供服务中的静态资源，包括 js、html、css、图片、音视频等不会出现变动的资源文件。将这些资源在 CDN 云服务器内进行缓存，用户访问静态资源的时候从 CDN 传输给用户，访问 asp、php、jsp 等动态资源的时候，从源站抓取，既保证了数据的及时性，又提高了静态资源的加载速度。</p><p>相比于动态资源文件，静态资源，特别是图片，是访问过程中消耗流量较大的部分；使用静态资源加速能大大减轻源站的网络贷款和资源负载的压力，又减少了用户的加载速度，使得网络服务能更快的展现在用户面前；</p><h2 id="1-4- 动态加速"><a href="#1-4- 动态加速" class="headerlink" title="1.4 动态加速"></a>1.4 动态加速</h2><p>动态加速是指 CDN 的 DNS 解析中通过动态链路探测，监控网络环境的变化，监控各地网络延迟，寻找到一条最 <strong>稳定、最高效、最快速 </strong>的路径，回源动态资源，从而实现动态资源（如 asp、php、jsp 等）加速。然后构成链路列表，绑定到 DNS 解析上，更新到 CDN 的本地域名服务器上。简单架构见下图所示。</p><p><img src="https://img.musnow.top/i/2023/08/9b51e87fe04bacbd8591b55e5d62f679.png" alt="img"></p><h2 id="1-5- 数据节点的更新和同步"><a href="#1-5- 数据节点的更新和同步" class="headerlink" title="1.5 数据节点的更新和同步"></a>1.5 数据节点的更新和同步</h2><p>cdn 分为推拉两种方式</p><ul><li>推是服务器将内容推到 cdn 节点上</li><li>拉是 cdn 在第一次接受请求的时候从服务器拉取资源进行响应并保存</li></ul><p>当资源在 cdn 缓存之后，如果服务器上的资源发生变化，cdn 节点是不会知道的，除非缓存时间到期重新拉取或者修改新资源的访问。</p><p>动态资源的话，一般都是无延迟的。静态对于 css 和 js 来说，建议在编译生成的阶段，为文件名加上时间戳。而且最好是在文件名里面，而不是 querystring 里面加。这是最方便的方案，因为一旦发生了更新，每次去取的一定是新文件，不涉及缓存刷新的问题。</p><h2 id="1-6-CDN 的好处"><a href="#1-6-CDN 的好处" class="headerlink" title="1.6 CDN 的好处"></a>1.6 CDN 的好处</h2><h3 id="1-6-1- 对服务商"><a href="#1-6-1- 对服务商" class="headerlink" title="1.6.1 对服务商"></a>1.6.1 对服务商</h3><p>采用 CDN 技术，最大的好处，就是加速了网站的访问——用户与内容之间的物理距离缩短，用户的等待时间也得以缩短。</p><p>而且，分发至不同线路的缓存服务器，也让 <strong>跨运营商 </strong>之间的访问得以加速。例如中国移动手机用户访问中国电信网络的内容源，可以通过在中国移动假设 CDN 服务器，进行加速。效果是非常明显的。</p><p>此外，CDN 还有安全方面的好处。内容进行分发后，<strong>源服务器的 IP 被隐藏</strong>，受到攻击的概率会大幅下降。而且，当某个服务器故障时，系统会调用临近的健康服务器，进行服务，避免对用户造成影响。</p><p>正因为 CDN 的好处很多，所以，目前所有主流的互联网服务提供商，都采用了 CDN 技术。所有的云服务提供商，也都提供了 CDN 服务（价格，按流量计费）</p><h3 id="1-6-2- 对通信行业"><a href="#1-6-2- 对通信行业" class="headerlink" title="1.6.2 对通信行业"></a>1.6.2 对通信行业</h3><ul><li><strong>互联网服务提供商 </strong>采用 CDN，是以存储换时延。花钱购置 CDN 服务器或云计算服务，以此换取更好的用户体验。</li><li><strong>通信运营商 </strong>也追捧 CDN，但它们的目的，是以存储换带宽 ——通过服务“下沉”，减轻上层骨干网络的流量压力，避免硬件扩容，降低网络建设成本。</li></ul><p>以上文提到的爱奇艺看视频的高带宽问题为例，如果不采用 CDN，那就是巨大的流量流入同一个机房，这会导致这个机房入网 &#x2F; 出网的线路被拥塞，影响其他业务的进行！</p><p>同样的，如果大量的业务流量数据在骨干网跑来跑去，<strong>骨干网肯定吃不消，要拼命扩容</strong>。如果这些业务流量数据在底层就被解决了，那么，骨干网的带宽压力自然就减轻了。</p><p>很多运营商已经将 CDN 下沉到地市级，以此减轻压力，同时可以提升用户体验！可谓是一举两得的美事！</p><p><img src="https://img.musnow.top/i/2023/08/9806e61f7d240e45b2701d25668935e7.png" alt="img"></p><h1 id="2-PCDN"><a href="#2-PCDN" class="headerlink" title="2.PCDN"></a>2.PCDN</h1><p>PCDN 技术是 P2P 技术 +CDN 技术的集和，在认识 PCDN 之前，我们首先要简单了解一下 P2P 技术</p><h2 id="2-1-P2P"><a href="#2-1-P2P" class="headerlink" title="2.1 P2P"></a>2.1 P2P</h2><p>P2P 即<code>Peer to Peer</code>，是一种对等连接方式，纯 P2P 架构包含如下内容</p><ul><li>没有总是在线的服务器</li><li>任意端之间直接通信</li><li>对等方之间可以间断链接，并可以动态改变 IP 地址</li></ul><p>实际的用例如下</p><ul><li>文件分发（BT 下载）</li><li>流媒体</li><li>VolP</li><li>内网穿透式访问（建立 P2P 链接，直接和内网主机通信）</li></ul><p><img src="https://img.musnow.top/i/2023/08/ebc51e20db9f5b31b0067fead78826ae.png" alt="image"></p><p>关于 P2P 想了解更多信息可以查看此文：<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2095486">详解 P2P 技术</a></p><h2 id="2-2-PCDN"><a href="#2-2-PCDN" class="headerlink" title="2.2 PCDN"></a>2.2 PCDN</h2><h3 id="2-2-1- 流程"><a href="#2-2-1- 流程" class="headerlink" title="2.2.1 流程"></a>2.2.1 流程</h3><p>前面提到了，PCDN 是 P2P+CDN，那么其是如何将 P2P 技术和 CDN 结合起来的呢？</p><p>在阿里云官网上可以看到对 PCDN 的介绍：<a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/130907">一篇文章解读提速、降费黑科技：PCDN 定义、功能、架构、场景和优势</a>；本文是对这篇文章的个人理解。</p><blockquote><p>PCDN 产品是与传统 CDN 互补协作的关系，以 P2P 技术为核心的分布式 PCDN 系统可与传统 CDN、云 CDN 无缝集成，形成互补协作，相对于 CDN 拥有成本更低、质量更好两方面的核心优势。</p></blockquote><p>P2P 内容分发网络（英文名：P2P CDN，以下简称 PCDN）是以 P2P 技术为基础，通过挖掘利用边缘网络海量碎片化闲置资源而构建的低成本高品质内容分发网络服务。你可以通过集成 PCDN SDK（以下简称 SDK）接入该服务后能获得等同（或略高于）CDN 的分发质量，同时显著降低分发成本。适用于 <strong>视频点播、直播、大文件下载 </strong>等业务场景。</p><p>使用 PCDN 后的 http 请求处理流程如下图：</p><p><img src="https://img.musnow.top/i/2023/08/d2bba1440e3c9b80ec949459fd8617a8.png" alt="image-20230827133437729"></p><p>P2P 的加入，就是将一些数据 <strong>预先留存在部分终端设备</strong>（比如家用路由器，个人电脑，个人 NAS）等产品上，再通过 P2P 技术，从这些 Peer 做种端获取到一部分数据，以此为周边用户提供服务。</p><p>使用 PCDN 的 SDK 后，在请求 DNS 之后，还会去请求 <strong>PCDN 的调度系统</strong>，PCDN 同时会返回可用的 CDN 服务器，和可用的 P2P 做种端，用户能同时从<strong> 多端 </strong>获取到数据（根据文件分块，从不同地方获取同一文件不同分块的数据，提高文件下载速度）</p><p>比如一个文件有 1MB，那么使用 PCDN，我们可能服务商的从 <strong>CDN 服务器</strong> 拉取了 500KB，再从上图中所示的两个 peerid 端获取到了 500KB 数据；</p><p>因为 p2p 使用的是个人的 peer 终端节点，不仅数量多，<strong>且分布比 CDN 服务器更广 </strong>，理论上来说至少能获得<strong> 等同于 </strong>仅使用 CDN 技术的速度优势，如果用户可以连接到的 peer 较多，则速度就会 <strong>大于 </strong>仅使用 CDN 技术！</p><p>而这些作为 peer 的做种端，会定期从 CDN 缓存一部分热门数据到本地，并为其他与自己建立 P2P 链接的终端提供服务。</p><blockquote><p>京东云路由器、迅雷的网心云、百度云盘 PC 客户端的闲时带宽上传，其实都是使用了 PCDN 技术的终端产品，其会在占用一小部分用户带宽的基础上，给用户提供京豆 &#x2F; 现金奖励；<br>但是 PCDN 似乎和运营商的政策冲突，具体的就不了解了，本文只是来学习技术的。</p></blockquote><h3 id="2-2-2- 优点"><a href="#2-2-2- 优点" class="headerlink" title="2.2.2 优点"></a>2.2.2 优点</h3><p>以下优点来自阿里云那篇文章</p><ul><li><p>价格低：通过 P2P 技术可为客户提供更低成本的内容分发服务，（以峰值带宽计价）为云 CDN 价格的 1&#x2F;2，为传统 CDN 价格的 1&#x2F;4，可显著降低客户的分发成本；</p><p>因为使用了更多 P2P 节点，减轻了 CDN 服务器、源站服务器的网络带宽压力，所以 PCDN 能在一定程度上起到降本增效的作用。</p></li><li><p>质量好：通过 CDN+P2P 多级节点调度，一个请求可由 CDN 和多个 P2P 源同时提供内容，通过资源冗余提高了服务可用性，播放流畅率高于纯 CDN，在大文件下载场景中更是能极大提高下载速度；通过调用海量分布式 P2P 节点， 平均播放流畅率 &gt; 97%，平均首播时间小于 1 秒，用户体验得到有效提升。</p></li><li><p>成熟稳定：多年为优酷土豆提供优质的视频播放、下载等加速服务，接入带宽超 10T，经历了海量用户规模的 <strong>长时间验证</strong>。拥有内网穿透、缓存处理、种子管理、传输策略等各方面的核心技术和专利；（这是阿里云给自己打的广告）</p></li></ul><p><img src="https://img.musnow.top/i/2023/08/16fb75b6c4dae42f968da0e5510cd069.png" alt="image-20230827135320425"></p><h2 id="2-3- 常见名词"><a href="#2-3- 常见名词" class="headerlink" title="2.3 常见名词"></a>2.3 常见名词</h2><p>以下是 PCDN 中常见的名词；这里面漏了的一级节点指的应该是 CDN 服务器；</p><p><img src="https://img.musnow.top/i/2023/08/121f5a17dd247d2ba0cd17676bf53139.png" alt="image-20230827134515066"></p><p>由此可见，上文提到的京东云路由器、迅雷的网心云，这些客户端在用户的电脑启动后，其就是作为 PCDN 的 <strong>三级节点 </strong>接入整个 PCDN 的网络的，其提供的也是三级带宽；</p><h2 id="2-4- 基础架构"><a href="#2-4- 基础架构" class="headerlink" title="2.4 基础架构"></a>2.4 基础架构</h2><p>关键组件</p><ul><li>index 服务：全局调度，把用户请求调度到最佳的机房</li><li>ZooKeeper (Global&amp;Local)：服务活动情况汇报给调度服务，动态配置更新</li><li>Nignx Proxy：支持私有协议的 Nginx 代理服务，针对不同文件一致性 Hash 到不同的 Channel 服务</li><li>Channel 服务：记录文件和拥有文件的端点地址信息，为下载提供就近的端点地址</li><li>Realy 服务：服务 P2P 建立连接和通讯</li><li>Hot 服务：hot 文件发现和推送</li></ul><p>以下是 PCDN 技术的架构图</p><p><img src="https://img.musnow.top/i/2023/08/459dd3bd580e337a248093066360ca91.png" alt="image-20230827135429913"></p><p>整个技术的流程在上文已经讲解过了。这里的架构图阿里云的文章并没有提供更多的说明，具体的就得在真正需要开发 PCDN 的时候在公司内部深入学习了。</p><h2 id="2-5- 适用范围"><a href="#2-5- 适用范围" class="headerlink" title="2.5 适用范围"></a>2.5 适用范围</h2><p>PCDN 产品适用于视频点播、直播、大文件下载等业务领域。</p><ul><li>视频点播：长视频点播，热度集中的短视频点播。</li><li>视频直播：大型晚会赛事直播、地方网台直播、秀场互动直播。</li><li>大文件下载：超过 1MB 且热度集中的的文件分发，如应用市场分发、在线音频分发。</li></ul><h1 id="3-SDN"><a href="#3-SDN" class="headerlink" title="3.SDN"></a>3.SDN</h1><p>SDN 全称 <code>Software Defined Network</code>，概念最早由斯坦福大学的<code>Nick McKeown</code> 教授于 2009 年提出；谷歌于 2010 到 2012 年建立的数据中心网络 B4 是 SDN 的成功案例；</p><p>该技术学习于 b 站<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV15L411E7eE/?share_source=copy_web&vd_source=7fc715db968d24a91828ac8fad0e1ad8">【408 计算机网络新增考点—软件定义网络 SDN（字幕版）】</a></p><h2 id="3-1- 看看路由器的功能"><a href="#3-1- 看看路由器的功能" class="headerlink" title="3.1 看看路由器的功能"></a>3.1 看看路由器的功能</h2><p>路由器具备如下功能</p><ul><li>报文转发</li><li>路由选择</li></ul><p>在当前的路由器架构中，分为数据层面和控制层面。</p><ul><li>为了构建出自己的路由表，路由器必须要和周边的其他路由器定期通信，才能通过自己的路由算法设置出路由表，并选择正确的路由路径（这个耗时较长）</li><li>在数据层面，路由器采用硬件，查表进行转发（耗时低）</li></ul><p><img src="https://img.musnow.top/i/2023/08/f7ec770dd37e6f4a19c73cd9133cdf90.png" alt="image-20230827143545493"></p><blockquote><p><strong>分组 </strong>是网络专有名词。大多数 <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/18763?fromModule=lemma_inlink">计算机网络 </a>都不能连续地传送任意长的数据，所以实际上网络系统把 <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%88%86%E5%89%B2/4395664?fromModule=lemma_inlink">数据分割 </a>成小块，然后逐块地发送，这种小块就称作分组（packet）。也有些书籍把分组定义为网络层的 <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%8D%8F%E8%AE%AE%E6%95%B0%E6%8D%AE%E5%8D%95%E5%85%83/8226389?fromModule=lemma_inlink">协议数据单元</a>。</p><p>说白了分组就是一个报文！</p></blockquote><h2 id="3-2-SDN 核心思想"><a href="#3-2-SDN 核心思想" class="headerlink" title="3.2 SDN 核心思想"></a>3.2 SDN 核心思想</h2><blockquote><p>SDN 这种新型 <strong>网络体系结构 </strong>的核心思想，是将网络的控制层和数据层面玻璃，让控制层可以通过软件来控制数据层的较多设备</p></blockquote><p>在 SDN 体系中，路由器的路由软件被剥离开，路由器之间也不再需要交换路由信息。</p><ul><li>控制层面：有一个逻辑上集中的远程控制器，对多个交换机进行控制；该远程控制器可以由多台物理主机组成</li></ul><p>远程控制器会掌握各个主机和整个网络体系的状态，并为每一个路由分组计算出最佳的路由，和生成正确的转发表；这时候，底层的路由器硬件就仅仅需要进行查表转发，而不需要进行耗时的路由表生产和算法计算了，大大减轻了底层交换机和路由器硬件的压力。</p><p><img src="https://img.musnow.top/i/2023/08/feb23bbf0d7ea8acff297ff8111488fa.png" alt="image-20230827145453526"></p><h2 id="3-3-OpenFlow 协议"><a href="#3-3-OpenFlow 协议" class="headerlink" title="3.3 OpenFlow 协议"></a>3.3 OpenFlow 协议</h2><p>OpenFlow 协议是一个受到高度认可的标准，其一般在 SDN 中进行使用，但 SDN 并不一定要用 OpenFlow；</p><blockquote><p>OpenFlow 协议由 <strong>开放网络基金会 ONF</strong>负责指定，该基金会致力于 SDN 的发展和标准化；OpenFlow 协议目前较为成熟的是 1.3 版本</p></blockquote><p>OpenFlow 协议是 SDN 体系结构中，控制层面和数据层面之间的通信接口，该协议可以允许控制层面的控制器对数据层面的物理设备进行直接的访问和控制。</p><p><img src="https://img.musnow.top/i/2023/08/0c9a0b49911c437a7d31a4090004fa1a.png" alt="image-20230827145816552"></p><h2 id="3-4- 路由转发的区别"><a href="#3-4- 路由转发的区别" class="headerlink" title="3.4 路由转发的区别"></a>3.4 路由转发的区别</h2><h3 id="3-4-1- 传统路由表"><a href="#3-4-1- 传统路由表" class="headerlink" title="3.4.1 传统路由表"></a>3.4.1 传统路由表</h3><p>传统的路由转发是查询路由表，根据地址掩码计算目的网络，判断是否与当前条目匹配，如果匹配，则从对应的「下一条」中发送出去。</p><p>路由转发这部分内容在我的 IP 协议详解博客中有所涉及：<a href="https://blog.musnow.top/posts/3482559497/">点我</a></p><p><img src="https://img.musnow.top/i/2023/08/e154eeaf46fb0ce68d4ca6c6ea946920.png" alt="image-20230827150215508"></p><h3 id="3-4-2-SDN 广义转发"><a href="#3-4-2-SDN 广义转发" class="headerlink" title="3.4.2 SDN 广义转发"></a>3.4.2 SDN 广义转发</h3><p>SDN 在这基础上新增了更多的内容，称为<strong> 广义转发</strong>：</p><ol><li>进行匹配：能够对网络体系结构中的各层（数据链路层，网络层，传输层）首部中的字段进行匹配</li><li>执行动作：不仅转发分组，还可以实现负载均衡、重写 IP 首部（类似 NAT 中的路由地址转换）、人为阻挡或丢弃一些分组（类似防火墙）</li></ol><p>在 SDN 广义转发中，完成这一操作的设备不再称为路由器，而是叫做 OpenFlow 交换机（或分组交换机），也可以简称为交换机。</p><h3 id="3-4-3- 流表"><a href="#3-4-3- 流表" class="headerlink" title="3.4.3 流表"></a>3.4.3 流表</h3><p>在 SDN 中替代 了传统路由表的是「流表（Flow Table）」</p><ul><li>一个流就是整个网络中的一组分组序列，在此序列中的每个分组都是 <code>共享分组首部某些字段的值</code>，例如，某个流可以是共享相同的源 IP 和目的 IP 地址的一连串分组</li><li>OpenFlow 交换机中的刘表是由 SDN 远程控制器来管理的，SDN 远程控制器通过一个安全信道，通过 OpenFlow 协议来管理 OpenFlow 交换机中的流表</li></ul><p><img src="https://img.musnow.top/i/2023/08/da25636e91b2ab521809adc0d568a7d4.png" alt="image-20230827150934738"></p><ul><li>每个 OpenFlow 交换机必须有一个或者多个流表</li><li>每一个流表包含多个流表项目</li><li>每个流表项包含三个字段：首部字段值（匹配字段）、计数器、动作（类似下一跳）</li></ul><p>OpenFlow 的首部字段值跨越了三个层次的首部，既可以处理数据链路层的 MAC 帧，又可以处理 IP 报文，或者是 TCP&#x2F;UDP 的端口</p><p><img src="https://img.musnow.top/i/2023/08/fa579c04d7c630a4b94a6158c1b0d384.png" alt="image-20230827151212669"></p><p>计数器字段包含一组计数器</p><ul><li>记录已经与该流表项匹配的分组数量的计数器；</li><li>记录该流表项上次更新到现在经历的时间的计数器</li></ul><p>动作字段是一族动作，当分组匹配到某个流表项时，执行下方的一个或者多个动作</p><ul><li>把分组转发到指定的端口</li><li>丢弃分组</li><li>把分组进行复制后，从多个端口转发出去</li><li>重写分组中的首部字段</li></ul><h3 id="3-4-4-VLAN"><a href="#3-4-4-VLAN" class="headerlink" title="3.4.4 VLAN"></a>3.4.4 VLAN</h3><blockquote><p>关于该报文中 VLAN 部分可以查看此博客：<a target="_blank" rel="noopener" href="https://blog.csdn.net/LawssssCat/article/details/127204720">https://blog.csdn.net/LawssssCat/article/details/127204720</a></p></blockquote><p>VLAN 是一种用于进一步虚拟化划分局域网的方式，假如一台路由器有 4 个网口，其可以通过将 LAN1 和 LAN2 设置成 VLAN10，LAN3 和 LAN4 设置成 VLAN20 来模拟出两个局域网</p><p><img src="https://img.musnow.top/i/2023/08/8cfceb7090ae21914683d034f680f485.png" alt="image-20230827153454860"></p><p>vlan（virtual lan）技术提供了一种灵活的解决方案；将交换机的接口根据业务需要添加到不同的 vlan 中，从而实现二层隔离。</p><ul><li>隔离广播域，即广播包只在本 vlan 中传播，从而在一定程度上可以提高整个网络的处理能力；</li><li>提高安全性，一个 vlan 内的用户和其他 vlan 内的用户不能互访，提高了网络的安全性；</li><li>增加带宽利用 &#x2F; 降低延迟 &#x2F; 管理作用</li></ul><h2 id="3-5- 举例"><a href="#3-5- 举例" class="headerlink" title="3.5 举例"></a>3.5 举例</h2><h3 id="3-5-1- 简单转发"><a href="#3-5-1- 简单转发" class="headerlink" title="3.5.1 简单转发"></a>3.5.1 简单转发</h3><p>通过不同的流表项来设置转发路径和转发动作，动作中的 <code>转发 (3)</code> 代表从该交换机的 3 号端口转发出去。端口号在图中有标注；</p><p><img src="https://img.musnow.top/i/2023/08/6faaa19507feedb4784efd2c5a5ac376.png" alt="image-20230827151650945"></p><h3 id="3-5-2- 负载均衡"><a href="#3-5-2- 负载均衡" class="headerlink" title="3.5.2 负载均衡"></a>3.5.2 负载均衡</h3><p>第二个栗子是负载均衡的栗子，在下面的场景中，我们想要 H3 发送的分组通过<code>S2-S1-S3-H5/H6</code>，要 H4 发送的分组通过<code>S2-S3-H5/H6</code>；以达到负载均衡的目的。</p><p><img src="https://img.musnow.top/i/2023/08/5f152f13954536e40cb1b6b815f0c9ad.png" alt="image-20230827151718483"></p><p>使用传统的源 IP 和目的 IP 的转发方式，无法实现这样的负载均衡。在传统场景下，当 S2 在数据链路层发现目的 MAC 地址是 S3 的 MAC 地址的时候，无论如何都会直接发送给 S3，而不是从 S1 处绕路。</p><p>但在 SDN 场景中，就可以通过两个不同的流表项来规定不同转发动作，实现这样的负载均衡（这里的 <code>转发 (4)</code> 代表从 S2 的 4 号端口转发出去）</p><p><img src="https://img.musnow.top/i/2023/08/2d076ac5eca2dc6f7480020f2e0fd57f.png" alt="image-20230827151948106"></p><h3 id="3-5-3- 防火墙"><a href="#3-5-3- 防火墙" class="headerlink" title="3.5.3 防火墙"></a>3.5.3 防火墙</h3><p>如果我们想让 S2 主机只接收来自 S1 的数据而不接受 S3 的数据，就可以通过只设置 S1 的源 IP 地址的流表项，来丢弃 S3 发送的数据（匹配不上的数据就会被丢弃）</p><p><img src="https://img.musnow.top/i/2023/08/f7be65147a7d7897ae6d4402ad2d8f26.png" alt="image-20230827152217555"></p><h2 id="3-6-SDN 体系结构的特征"><a href="#3-6-SDN 体系结构的特征" class="headerlink" title="3.6 SDN 体系结构的特征"></a>3.6 SDN 体系结构的特征</h2><p>下图中包含了 SDN 的体系结构一览图和 SDN 的四个关键特征</p><ol><li>基于流的转发</li><li>数据层面与控制层面分离</li><li>位于数据层面分组交换机之外的网络控制功能</li><li>可编程的网络</li></ol><p>其中，SDN 控制器是这个架构中最复杂的设备，其通过南向 API 控制底层的 OpenFlow 交换机，通过北向 API 接受其他网络控制器的策略配置。</p><p><img src="https://img.musnow.top/i/2023/08/a6678beda5464d34757501e8cc95580e.png" alt="image-20230827152358531"></p><h3 id="3-6-1-SDN 控制器"><a href="#3-6-1-SDN 控制器" class="headerlink" title="3.6.1 SDN 控制器"></a>3.6.1 SDN 控制器</h3><p>SDN 控制器可以分成三个层次</p><ul><li>其通信层通过 OpenFlow 协议与交换机通信</li><li>中间间来根据各种策略管理各个交换机</li><li>北向 API 接收来自其他控制策略发起端的配置</li></ul><p><img src="https://img.musnow.top/i/2023/08/46dc0f081cfa38af5ea0d3d89e0ccc68.png" alt="image-20230827152554869"></p><p>这里使用的 <code>RESTful API</code> 是基于 HTTP 的 API，也是我们较常见的 API 接口；</p><h3 id="3-6-2- 开源 SDN 控制器"><a href="#3-6-2- 开源 SDN 控制器" class="headerlink" title="3.6.2 开源 SDN 控制器"></a>3.6.2 开源 SDN 控制器</h3><p>常用的开源 SDN 控制器有 OPEN DAYLIGHT 和 ONOS；</p><h3 id="3-6-3-SDN 的优势"><a href="#3-6-3-SDN 的优势" class="headerlink" title="3.6.3 SDN 的优势"></a>3.6.3 SDN 的优势</h3><blockquote><p>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/as12138/article/details/131273381">https://blog.csdn.net/as12138/article/details/131273381</a></p></blockquote><p>SDN 相比于传统网络架构，有许多优点和优势。</p><ol><li><p>高度可编程性：SDN 架构中的控制器负责管理交换机和路由器，使得网络更加可编程、可配置。管理员可以通过控制器实现灵活调整网络拓扑、管理流量和配置流调度策略，提升网络的可演变性、可定制化和可伸缩性。</p></li><li><p>网络智能集中化：在 SDN 中，网络智能被集中在控制器中，通过控制器进行集中式管理和控制。这种分离的模式避免了网络设备中任务的复杂，提升了网络的可管理性和可控制性。此外，集中化的管理方式也可以在网络中间件和应用中实现智能控制，如分布式存储、云计算等。</p></li><li><p>可扩展性：SDN 中的网络设备是通用的硬件设备，不需要特定的功能区分，同时也不需要更新硬件，只需更新控制器即可实现拓扑可伸缩和灵活的网络管理。</p></li><li><p>自动化和提高效率：SDN 中可以实现网络的自动化，通过控制器进行自动化的网络管理，可以避免手动管理网络的局限性和不确定性，从而提高网络的效率和稳定性，同时，自动化网络管理也可以降低网络维护的成本和时间。</p></li><li><p>安全可靠性提升：网络安全和可靠性是企业网络中最基本的需求。传统的网络安全往往需要通过一些特定设备和协议来实现。相比之下，SDN 中的控制器可以根据网络实时状态自动优化管理策略，安全可靠的方式来提高网络的安全性。</p></li></ol><p>总之，SDN 的优势在于其灵活的可编程性、集中式智能管理、高效的自动化网络管理和增强网络安全性。以上优势也是 SDN 技术应用广泛的主要原因，越来越多的企业和组织将 SDN 技术应用到自己的网络架构中，以满足未来网络的需求和挑战。</p><h2 id="3-6-4-SDN 应用前景"><a href="#3-6-4-SDN 应用前景" class="headerlink" title="3.6.4 SDN 应用前景"></a>3.6.4 SDN 应用前景</h2><p>SDN 技术目前已经实现了基础网络配置、流控制、网络安全等功能。在未来，SDN 技术还会面临更多的挑战和机遇。</p><ol><li><p>5G 时代：5G 技术将会改变网络的面貌，加速物联网应用的普及。SDN 作为架构灵活、可编程的网络方式，将会在 5G 网络中发挥重要作用，实现网络的自动化和智能化管理。</p></li><li><p>IoT 设备：物联网技术带来大量设备的连接，SDN 技术的价值在于自动化了物联网设备的管理、安全和监控。未来，SDN 技术将会成为物联网管理的重要工具。</p></li><li><p>AI：随着人工智能的发展，SDN 的业界应用已经开始大规模落地。这将加速智能交通、智能城市和自动驾驶等领域的发展。</p></li><li><p>集成新技术：SDN 可以很容易地与其他技术相结合，例如 NFV（网络功能虚拟化）和 AI（人工智能），以提高网络的效率和适应性。</p></li><li><p>云计算：SDN 技术的灵活性和可编程性，也使得 SDN 与云计算等新技术的结合变得更加自然。在未来，SDN 技术将与云技术紧密结合，实现业务流程的自动化、快速应用部署和弹性云资源管理。</p></li></ol><p>总而言之，SDN 技术将为未来网络的发展和实现各种应用提供支撑。在日益增长的网络需求和复杂的网络技术背景下，SDN 的灵活性和高可用性将会带来更大的发展空间和市场需求。SDN 技术应当继续研究和发展，以满足更多的网络需求和挑战。</p><h2 id="3-7- 总结"><a href="#3-7- 总结" class="headerlink" title="3.7 总结"></a>3.7 总结</h2><p><img src="https://img.musnow.top/i/2023/08/3a0e7fd1ff2494f51ec6121d4a60e108.png" alt="image-20230827152810972"></p></article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CDN/">CDN</a><a class="post-meta__tags" href="/tags/SDN/">SDN</a><a class="post-meta__tags" href="/tags/P2P/">P2P</a></div><div class="post_share"><div class="social-share" data-image="https://img.musnow.top/i/2023/08/1298b6b472d89a0007ac82fb213b1aeb.png" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.staticfile.org/butterfly-extsrc/1.1.3/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.staticfile.org/butterfly-extsrc/1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://afdian.net/a/128ahri" target="_blank"><img class="post-qr-code-img" src="/img/ico/aifadian.png" alt="爱发电"></a><div class="post-qr-code-desc">爱发电</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/563921472/" title="【leetcode】1137. 第 N 个泰波那契数"><img class="cover" src="/img/bg/gm21.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">【leetcode】1137. 第 N 个泰波那契数</div></div></a></div><div class="next-post pull-right"><a href="/posts/73383828/" title="【API】API 的各种分类详解"><img class="cover" src="/img/bg/gm14.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">【API】API 的各种分类详解</div></div></a></div></nav><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="artalk-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/favicon.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">慕雪年华</div><div class="author-info__description">爱折腾的代码初学者</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">293</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">73</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/musnows"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:muxue@musnow.top" target="_blank" title="email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://gitee.com/musnows" target="_blank" title="Gitee"><i class="fa-sharp fa-solid fa-g"></i></a><a class="social-icon" href="https://blog.csdn.net/muxuen" target="_blank" title="CSDN"><i class="fa-brands fa-blogger-b"></i></a><a class="social-icon" href="https://musnow.top/?utm_source=blog" target="_blank" title="个人主页"><i class="fas fa-globe-asia"></i></a><a class="social-icon" href="https://web.musnow.top/?utm_source=blog" target="_blank" title="导航站点"><i class="fas fa-server"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到寒舍</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-CDN"><span class="toc-text">1.CDN</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%20%E5%89%8D%E7%BD%AE%E5%A3%B0%E6%98%8E"><span class="toc-text">1.1 前置声明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%20%E6%8A%80%E6%9C%AF%E4%B8%BB%E4%BD%93"><span class="toc-text">1.2 技术主体</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%20%E9%9D%99%E6%80%81%E5%8A%A0%E9%80%9F"><span class="toc-text">1.3 静态加速</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-%20%E5%8A%A8%E6%80%81%E5%8A%A0%E9%80%9F"><span class="toc-text">1.4 动态加速</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-%20%E6%95%B0%E6%8D%AE%E8%8A%82%E7%82%B9%E7%9A%84%E6%9B%B4%E6%96%B0%E5%92%8C%E5%90%8C%E6%AD%A5"><span class="toc-text">1.5 数据节点的更新和同步</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-6-CDN%20%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="toc-text">1.6 CDN 的好处</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-1-%20%E5%AF%B9%E6%9C%8D%E5%8A%A1%E5%95%86"><span class="toc-text">1.6.1 对服务商</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-2-%20%E5%AF%B9%E9%80%9A%E4%BF%A1%E8%A1%8C%E4%B8%9A"><span class="toc-text">1.6.2 对通信行业</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-PCDN"><span class="toc-text">2.PCDN</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-P2P"><span class="toc-text">2.1 P2P</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-PCDN"><span class="toc-text">2.2 PCDN</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%20%E6%B5%81%E7%A8%8B"><span class="toc-text">2.2.1 流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-%20%E4%BC%98%E7%82%B9"><span class="toc-text">2.2.2 优点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%20%E5%B8%B8%E8%A7%81%E5%90%8D%E8%AF%8D"><span class="toc-text">2.3 常见名词</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%20%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84"><span class="toc-text">2.4 基础架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%20%E9%80%82%E7%94%A8%E8%8C%83%E5%9B%B4"><span class="toc-text">2.5 适用范围</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-SDN"><span class="toc-text">3.SDN</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%20%E7%9C%8B%E7%9C%8B%E8%B7%AF%E7%94%B1%E5%99%A8%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="toc-text">3.1 看看路由器的功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-SDN%20%E6%A0%B8%E5%BF%83%E6%80%9D%E6%83%B3"><span class="toc-text">3.2 SDN 核心思想</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-OpenFlow%20%E5%8D%8F%E8%AE%AE"><span class="toc-text">3.3 OpenFlow 协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%20%E8%B7%AF%E7%94%B1%E8%BD%AC%E5%8F%91%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">3.4 路由转发的区别</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-1-%20%E4%BC%A0%E7%BB%9F%E8%B7%AF%E7%94%B1%E8%A1%A8"><span class="toc-text">3.4.1 传统路由表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-2-SDN%20%E5%B9%BF%E4%B9%89%E8%BD%AC%E5%8F%91"><span class="toc-text">3.4.2 SDN 广义转发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-3-%20%E6%B5%81%E8%A1%A8"><span class="toc-text">3.4.3 流表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-4-VLAN"><span class="toc-text">3.4.4 VLAN</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-%20%E4%B8%BE%E4%BE%8B"><span class="toc-text">3.5 举例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-1-%20%E7%AE%80%E5%8D%95%E8%BD%AC%E5%8F%91"><span class="toc-text">3.5.1 简单转发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-2-%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-text">3.5.2 负载均衡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-3-%20%E9%98%B2%E7%81%AB%E5%A2%99"><span class="toc-text">3.5.3 防火墙</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-SDN%20%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E7%9A%84%E7%89%B9%E5%BE%81"><span class="toc-text">3.6 SDN 体系结构的特征</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-1-SDN%20%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-text">3.6.1 SDN 控制器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-2-%20%E5%BC%80%E6%BA%90%20SDN%20%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-text">3.6.2 开源 SDN 控制器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-3-SDN%20%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="toc-text">3.6.3 SDN 的优势</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-4-SDN%20%E5%BA%94%E7%94%A8%E5%89%8D%E6%99%AF"><span class="toc-text">3.6.4 SDN 应用前景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-7-%20%E6%80%BB%E7%BB%93"><span class="toc-text">3.7 总结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/3894841472/" title="【Hexo】在中英文之间添加空格"><img src="/img/bg/gm2.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="【Hexo】在中英文之间添加空格"></a><div class="content"><a class="title" href="/posts/3894841472/" title="【Hexo】在中英文之间添加空格">【Hexo】在中英文之间添加空格</a><time datetime="2023-12-10T07:32:14.000Z" title="发表于 2023-12-10 15:32:14">2023-12-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/3528013149/" title="【Nginx】NGINX 配置避免 IP 访问时证书暴露域名"><img src="https://img.musnow.top/i/2023/12/035ad572d3638bb917c07e53e24c9575.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="【Nginx】NGINX 配置避免 IP 访问时证书暴露域名"></a><div class="content"><a class="title" href="/posts/3528013149/" title="【Nginx】NGINX 配置避免 IP 访问时证书暴露域名">【Nginx】NGINX 配置避免 IP 访问时证书暴露域名</a><time datetime="2023-12-09T09:12:55.000Z" title="发表于 2023-12-09 17:12:55">2023-12-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2029711168/" title="【Nginx】nginx 通过配置文件阻止海外 ip 访问"><img src="/img/bg/gm3.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="【Nginx】nginx 通过配置文件阻止海外 ip 访问"></a><div class="content"><a class="title" href="/posts/2029711168/" title="【Nginx】nginx 通过配置文件阻止海外 ip 访问">【Nginx】nginx 通过配置文件阻止海外 ip 访问</a><time datetime="2023-12-09T08:12:55.000Z" title="发表于 2023-12-09 16:12:55">2023-12-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/3595872827/" title="【图床】删除对象存储桶前一定要检查！"><img src="/img/bg/gm4.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="【图床】删除对象存储桶前一定要检查！"></a><div class="content"><a class="title" href="/posts/3595872827/" title="【图床】删除对象存储桶前一定要检查！">【图床】删除对象存储桶前一定要检查！</a><time datetime="2023-12-09T02:32:14.000Z" title="发表于 2023-12-09 10:32:14">2023-12-09</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(/img/bg/mothra.png)"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2023 By 慕雪年华</div><div class="footer_custom_text"><a href="https://icp.gov.moe/?keyword=20230054" target="_blank"><img src="https://img.shields.io/badge/-%E8%90%8CICP%E5%A4%8720230054-ff69b4" height="20px"></a>&nbsp<a href="/sitemap.xml" target="_blank"><img src="https://img.shields.io/badge/-SITEMAP-00CDCD" height="20px"></a>&nbsp<a href="https://beian.miit.gov.cn/" target="_blank"><img src="https://img.shields.io/badge/%E7%B2%A4ICP%E5%A4%872023007189-red" height="20px"></a><br><a href="https://www.foreverblog.cn/go.html" target="_blank"><img src="https://img.foreverblog.cn/wormhole_1_tp.gif" height="25px"></a>&nbsp<a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target="_blank"><img src="/img/ico/upyun_cdn_w.png" height="25px"></a><a href="https://www.travellings.cn/go.html" target="_blank"><img src="/img/ico/travelling_icon.gif" height="25px"></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.staticfile.org/hexo-theme-butterfly/4.9.0/js/utils.min.js"></script><script src="https://cdn.staticfile.org/hexo-theme-butterfly/4.9.0/js/main.min.js"></script><script src="https://cdn.staticfile.org/fancyapps-ui/5.0.19/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.staticfile.org/mathjax/3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>function loadArtalk () {
  function initArtalk () {
    window.artalkItem = new Artalk(Object.assign({
      el: '#artalk-wrap',
      server: 'https://artk.musnow.top',
      site: 'mublog',
      pageKey: location.pathname,
      darkMode: document.documentElement.getAttribute('data-theme') === 'dark',
      countEl: '.artalk-count'
    },null))

    if (GLOBAL_CONFIG.lightbox === 'null') return
    window.artalkItem.use(ctx => {
      ctx.on('list-loaded', () => {
        ctx.getCommentList().forEach(comment => {
          const $content = comment.getRender().$content
          btf.loadLightbox($content.querySelectorAll('img:not([atk-emoticon])'))
        })
      })
    })
  }

  if (typeof window.artalkItem === 'object') initArtalk()
  else {
    getCSS('https://cdn.staticfile.org/artalk/2.5.5/Artalk.min.css').then(()=>{
      getScript('https://cdn.staticfile.org/artalk/2.5.5/Artalk.min.js').then(initArtalk)
    })
  }
}

function artalkChangeMode (theme) {
  const artalkWrap = document.getElementById('artalk-wrap')
  if (!(artalkWrap && artalkWrap.children.length)) return
  const isDark = theme === 'dark'
  window.artalkItem.setDarkMode(isDark)
}

btf.addModeChange('artalk', artalkChangeMode)

if ('Artalk' === 'Artalk' || !false) {
  if (false) btf.loadComment(document.getElementById('artalk-wrap'), loadArtalk)
  else loadArtalk()
} else {
  function loadOtherComment () {
    loadArtalk()
  }
}</script></div><script id="click-heart" src="https://cdn.staticfile.org/butterfly-extsrc/1.1.3/click-heart.min.js" async mobile="false"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span> 数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="https://cdn.staticfile.org/hexo-theme-butterfly/4.9.0/js/search/local-search.min.js"></script></div></div></body></html>