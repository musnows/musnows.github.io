<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>【MySQL】sql字段约束 | 慕雪的寒舍</title><meta name="author" content="慕雪年华"><meta name="copyright" content="慕雪年华"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="mysql字段约束">
<meta property="og:type" content="article">
<meta property="og:title" content="【MySQL】sql字段约束">
<meta property="og:url" content="https://blog.musnow.top/posts/4138950838/index.html">
<meta property="og:site_name" content="慕雪的寒舍">
<meta property="og:description" content="mysql字段约束">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img.musnow.top/i/2023/04/64302610057ae.png">
<meta property="article:published_time" content="2023-07-22T08:52:14.000Z">
<meta property="article:modified_time" content="2024-01-22T08:52:14.000Z">
<meta property="article:author" content="慕雪年华">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.musnow.top/i/2023/04/64302610057ae.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "【MySQL】sql字段约束",
  "url": "https://blog.musnow.top/posts/4138950838/",
  "image": "https://img.musnow.top/i/2023/04/64302610057ae.png",
  "datePublished": "2023-07-22T08:52:14.000Z",
  "dateModified": "2024-01-22T08:52:14.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "慕雪年华",
      "url": "https://blog.musnow.top/"
    }
  ]
}</script><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://blog.musnow.top/posts/4138950838/index.html"><link rel="preconnect"/><meta name="google-site-verification" content="iR4A6ntiwhI9JX_YDe2ZFY6DerPD7c-NaLyIDlrDguY"/><meta name="msvalidate.01" content="D5CD621F38EE3FB5071F785AD4977161"/><meta name="baidu-site-verification" content="codeva-aZGKJiqRSI"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/pluginsSrc/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="/pluginsSrc/@fancyapps/ui/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":420,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":600,"languages":{"author":"作者: 慕雪年华","link":"链接: ","source":"来源: 慕雪的寒舍","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: '/pluginsSrc/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '【MySQL】sql字段约束',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/equipment/equipment.css?1"><link rel="stylesheet" href="/rating/rating.css?1"><script src="/js/typing_style.js"></script><script>var _hmt = _hmt || [];(function(){var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?f444e8de702765e309d1a751aa12203e";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="慕雪的寒舍" type="application/atom+xml">
</head><body><div id="web_bg" style="background-image: url(/img/main/mothra.webp);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/favicon.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">460</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">76</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">24</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 归档</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/rating/"><i class="fa-fw fas fa-film"></i><span> 书·影</span></a></div><div class="menus_item"><a class="site-page" href="/qa/"><i class="fa-fw fa-fw fas fa-comment-dots"></i><span> 留言</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-user-friends"></i><span> 友人</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/fcircle/"><i class="fa-fw fas fa-link"></i><span> 朋友圈</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.travellings.cn/go.html"><i class="fa-fw fas fa-train"></i><span> 开往</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.foreverblog.cn/go.html"><i class="fa-fw fab fa-superpowers"></i><span> 虫洞</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://travel.moe/go.html?travel=on"><i class="fa-fw fas fa-globe-americas"></i><span> 异次元</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-glass-whiskey"></i><span> 镜像</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="https://blog.musnow.top/?utm_source=mirror"><i class="fa-fw fas fa-home"></i><span> Main</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog1.musnow.top/?utm_source=mirror"><i class="fa-fw fa-brands fa-battle-net"></i><span> Netlify</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://musnows.github.io/?utm_source=mirror"><i class="fa-fw fa-brands fa-square-github"></i><span> Github</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog2.musnow.top/?utm_source=mirror"><i class="fa-fw fa-solid fa-square-caret-up"></i><span> Vercel</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog3.musnow.top/?utm_source=mirror"><i class="fa-fw fas fa-cloud"></i><span> Cloudflare</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://keep-hexo.musnow.top/?utm_source=mirror"><i class="fa-fw fa-brands fa-kickstarter"></i><span> KeepTheme</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://musnow.blog.csdn.net/"><i class="fa-fw fas fa-copyright"></i><span> CSDN</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog.51cto.com/u_15307009"><i class="fa-fw fas fa-dice-five"></i><span> 51CTO</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fab fa-blackberry"></i><span> 更多</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 画廊</span></a></li><li><a class="site-page child" href="/equipment/"><i class="fa-fw fas fa-laptop"></i><span> 背包</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://memos.musnow.top"><i class="fa-fw fas fa-map-signs"></i><span> 说说</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://stats.uptimerobot.com/qrNpVSLkgV"><i class="fa-fw fas fa-chart-bar"></i><span> Uptime</span></a></li><li><a class="site-page child" href="/atom.xml"><i class="fa-fw fas fa-rss-square"></i><span> RSS</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(https://img.musnow.top/i/2023/04/64302610057ae.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/favicon.jpg" alt="Logo"><span class="site-name">慕雪的寒舍</span></a><a class="nav-page-title" href="/"><span class="site-name">【MySQL】sql字段约束</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 归档</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/rating/"><i class="fa-fw fas fa-film"></i><span> 书·影</span></a></div><div class="menus_item"><a class="site-page" href="/qa/"><i class="fa-fw fa-fw fas fa-comment-dots"></i><span> 留言</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-user-friends"></i><span> 友人</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/fcircle/"><i class="fa-fw fas fa-link"></i><span> 朋友圈</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.travellings.cn/go.html"><i class="fa-fw fas fa-train"></i><span> 开往</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.foreverblog.cn/go.html"><i class="fa-fw fab fa-superpowers"></i><span> 虫洞</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://travel.moe/go.html?travel=on"><i class="fa-fw fas fa-globe-americas"></i><span> 异次元</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-glass-whiskey"></i><span> 镜像</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="https://blog.musnow.top/?utm_source=mirror"><i class="fa-fw fas fa-home"></i><span> Main</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog1.musnow.top/?utm_source=mirror"><i class="fa-fw fa-brands fa-battle-net"></i><span> Netlify</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://musnows.github.io/?utm_source=mirror"><i class="fa-fw fa-brands fa-square-github"></i><span> Github</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog2.musnow.top/?utm_source=mirror"><i class="fa-fw fa-solid fa-square-caret-up"></i><span> Vercel</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog3.musnow.top/?utm_source=mirror"><i class="fa-fw fas fa-cloud"></i><span> Cloudflare</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://keep-hexo.musnow.top/?utm_source=mirror"><i class="fa-fw fa-brands fa-kickstarter"></i><span> KeepTheme</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://musnow.blog.csdn.net/"><i class="fa-fw fas fa-copyright"></i><span> CSDN</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog.51cto.com/u_15307009"><i class="fa-fw fas fa-dice-five"></i><span> 51CTO</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fab fa-blackberry"></i><span> 更多</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 画廊</span></a></li><li><a class="site-page child" href="/equipment/"><i class="fa-fw fas fa-laptop"></i><span> 背包</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://memos.musnow.top"><i class="fa-fw fas fa-map-signs"></i><span> 说说</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://stats.uptimerobot.com/qrNpVSLkgV"><i class="fa-fw fas fa-chart-bar"></i><span> Uptime</span></a></li><li><a class="site-page child" href="/atom.xml"><i class="fa-fw fas fa-rss-square"></i><span> RSS</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">【MySQL】sql字段约束</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-07-22T08:52:14.000Z" title="发表于 2023-07-22 16:52:14">2023-07-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-22T08:52:14.000Z" title="更新于 2024-01-22 16:52:14">2024-01-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/">编程学习</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E6%95%B0%E6%8D%AE%E5%BA%93SQL/">数据库SQL</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">10.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>42分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="ArtalkPV"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div class="ai-summary"><div class="ai-explanation" style="display: block;" data-summary="这里是慕雪的小助手，这篇文章主要介绍了MySQL数据库中的完整性约束及其实现方式，包括实体完整性、参照完整性和用户定义完整性，并详细讲解了空属性（NULL/NOT NULL）、默认值（default）等约束类型，通过实际案例展示了在建表时如何设置这些约束以确保数据的正确性和相容性，还强调了NULL与空字符串的区别及默认值在实际应用中的作用。">慕雪的小助手正在绞尽脑汁···</div><div class="ai-title"> <div class="ai-title-left"> <i class="fa-brands fa-slack"></i><div class="ai-title-text">慕雪小助手的总结</div></div><div class="ai-tag" id="ai-tag">LongCat-Flash-Chat</div></div></div><div id="post-outdate-notice" data="{&quot;limitDay&quot;:180,&quot;messagePrev&quot;:&quot;距离上次更新本文已经过去了&quot;,&quot;messageNext&quot;:&quot;天，文章部分内容可能已经过时，请注意甄别。&quot;,&quot;postUpdate&quot;:&quot;2024-01-22 16:52:14&quot;}" hidden></div><h2 id="前言">前言</h2>
<h3 id="数据库完整性">数据库完整性</h3>
<p>数据库的完整性指的是数据的正确性和相容性。</p>
<ul>
<li>正确性：符合现实世界语义</li>
<li>相容性：同一个对象在不同表中的数据符合逻辑</li>
</ul>
<p>要想维护数据库的完整性，需要提供如下机制</p>
<ul>
<li>提供定义完整性约束条件的机制</li>
<li>提供完整性检查方法</li>
<li>进行违约处理</li>
</ul>
<p>完整性一般分为三类：</p>
<ul>
<li>实体完整性：主键唯一且非空，对应后文的<code>primary key</code>；</li>
<li>参照完整性：外键约束，对应后文的<code>foreign key</code>；</li>
<li>用户定义完整性：属性上约束条件的定义，对应后文可供用户设置的其他约束条件。</li>
</ul>
<h3 id="MySQL中的数据约束">MySQL中的数据约束</h3>
<p>在MySQL中，我们需要存储的数据在特定的场景中需要不同的约束。当新插入的数据违背了该字段的约束字段，MySQL会直接禁止插入。</p>
<ul>
<li>数据类型也是一种约束，但数据类型这个约束太过单一；</li>
<li>比如我需要存储的是一个序号，那就不可能会有负数，这时候就要用<strong>无符号</strong>来对整形进行约束；</li>
<li>如果我要存储的是一个日期，且这个日期每个字段都必须要有，那就需要用<code>NOT NULL</code>不为空来进行约束；</li>
<li>如果我要存储的是一个用户ID，在整个用户系统中这个值肯定是唯一的，就可以使用<code>UNIQUE</code>来约束唯一性</li>
</ul>
<p>本文主要介绍下面几种约束的类型，这依旧是MySQL中ddl类型的语句操作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">null/not null 是否可以为空</span><br><span class="line">default 默认值</span><br><span class="line">comment 列评论</span><br><span class="line">zerofill 前补0</span><br><span class="line">primary key 主键</span><br><span class="line">auto_increment 自增</span><br><span class="line">unique key 唯一键</span><br><span class="line">foreign key 外键</span><br><span class="line">check 数据检查约束（比如数据范围判断）</span><br></pre></td></tr></table></figure>
<p>顺带一提，在MySQL中，每一列的值可以称之为<code>列</code>或者<code>字段</code>，一般不称之为<code>键值</code>。而表中的每一行被称作<code>一条记录</code>；</p>
<blockquote>
<p>我写python的时候就一直把dict的key叫做键值，然后就叫习惯了…</p>
</blockquote>
<h2 id="1-空属性null">1.空属性null</h2>
<h3 id="1-1-说明">1.1 说明</h3>
<p>空属性包含两个值，<code>NULL/NOT NULL</code>，分别对应为空和不为空</p>
<p>在数据库中，如果我们在插入一行时没有指定某一列的值，那么数据库就会把这个值设置为NULL；</p>
<blockquote>
<p>这里要注意区分NULL和空字符串，空字符串并不是NULL！</p>
</blockquote>
<p>但实际使用数据的时候，假设这是一个整形的数据，我们需要取出来后对其进行运算。此时NULL取出来的结果就不是一个数字，没有办法进行运算。所以在很多时候，我们都会把一个字段的约束设置为<code>NOT NULL</code>并添加上一个默认值（比如0或者空字符串）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; select null;</span><br><span class="line">+------+</span><br><span class="line">| NULL |</span><br><span class="line">+------+</span><br><span class="line">| NULL |</span><br><span class="line">+------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; select not null;</span><br><span class="line">+----------+</span><br><span class="line">| not null |</span><br><span class="line">+----------+</span><br><span class="line">|     NULL |</span><br><span class="line">+----------+</span><br><span class="line">1 row in set (0.001 sec)</span><br></pre></td></tr></table></figure>
<p>由下可见空属性是没办法参与运算的，不管如何运算其结果都是NULL</p>
<p>在Python中，NULL直接对应的就是None，当你尝试用None和int类型进行运算的时候，Python就会报错了。CPP中也是如此。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; select 1+null;</span><br><span class="line">+--------+</span><br><span class="line">| 1+null |</span><br><span class="line">+--------+</span><br><span class="line">|   NULL |</span><br><span class="line">+--------+</span><br><span class="line">1 row in set (0.001 sec)</span><br></pre></td></tr></table></figure>
<h3 id="1-2-案例">1.2 案例</h3>
<p>假设我们有一个楼层中的班级和教室对应的表，其中包含班级编号和教室编号这两个字段</p>
<ul>
<li>如果班级编号为空，那就不知道在这间教室上课的是那个班级</li>
<li>如果教室编号为空，那就不知道某个班级到底是在哪里上课</li>
</ul>
<p>由实际场景可见，这两个字段都不可以为空，所以在建表的时候就需要考虑到这一点</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> myclass(</span><br><span class="line">    class_name <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not null</span>,</span><br><span class="line">    class_room <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not null</span></span><br><span class="line">)<span class="keyword">default</span> charset<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>
<p>创建了表之后，当我们尝试将一个NULL的字段插入，会出现如下的提示，标识某一列不能为空</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; insert into myclass values (&#x27;510&#x27;,NULL);</span><br><span class="line">ERROR 1048 (23000): Column &#x27;class_room&#x27; cannot be null</span><br></pre></td></tr></table></figure>
<p>而空字符串是可以被插入的，这里又一次说明了我们认为的<code>空</code>和NULL并不相同，空字符串不是NULL</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; insert into myclass values (&#x27;510&#x27;,&#x27;&#x27;);</span><br><span class="line">Query OK, 1 row affected (0.005 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; select * from myclass;</span><br><span class="line">+------------+------------+</span><br><span class="line">| class_name | class_room |</span><br><span class="line">+------------+------------+</span><br><span class="line">| 510        |            |</span><br><span class="line">+------------+------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure>
<h2 id="2-默认值default">2.默认值default</h2>
<p>当我们注册某些网站的时候，一些信息不填，就会被系统设置为默认值。</p>
<p>比如你不选择年龄的时候，系统可能就会显示你为0岁；其他用户看到你的个人主页上显示的0岁，就知道你并没有填写自己的真实年龄。（而前端开发的时候也可以将0认作没有填写，显示成”隐藏年龄“）</p>
<p>再比如我们的网站上有一个用户积分的数值，当用户注册的时候，积分肯定是0（暂时不考虑新人送积分什么的操作），这时候就可以把积分那一列的默认值设置成0，在插入的时候就可以不显式插入这列的数据；</p>
<p>在MySQL中，某一列设置了默认值后。在insert时候如果没有指定这一列的数据，那就会采用默认值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> web_user(</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not null</span> <span class="keyword">default</span> <span class="string">&#x27;默认用户名&#x27;</span>,</span><br><span class="line">    age tinyint <span class="keyword">not null</span> <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    gender <span class="type">char</span>(<span class="number">2</span>) <span class="keyword">not null</span> <span class="keyword">default</span> <span class="string">&#x27;男&#x27;</span> </span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>创建完毕这个表，当我们查看表结构的时候，就能看到是否为空，以及默认直的相关属性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; desc web_user;</span><br><span class="line">+--------+-------------+------+-----+-----------------+-------+</span><br><span class="line">| Field  | Type        | Null | Key | Default         | Extra |</span><br><span class="line">+--------+-------------+------+-----+-----------------+-------+</span><br><span class="line">| name   | varchar(30) | NO   |     | 默认用户名      |       |</span><br><span class="line">| age    | tinyint(4)  | NO   |     | 0               |       |</span><br><span class="line">| gender | char(2)     | NO   |     | 男              |       |</span><br><span class="line">+--------+-------------+------+-----+-----------------+-------+</span><br><span class="line">3 rows in set (0.004 sec)</span><br></pre></td></tr></table></figure>
<p>由于这个表里面的3个字段我们都设置了初始值，你甚至可以直接啥都不指定地插入一个数据；下方可以看到，所有列都被设置成了该列的初始值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; insert into web_user values ();</span><br><span class="line">Query OK, 1 row affected (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; select * from web_user;</span><br><span class="line">+-----------------+-----+--------+</span><br><span class="line">| name            | age | gender |</span><br><span class="line">+-----------------+-----+--------+</span><br><span class="line">| 默认用户名      |   0 | 男     |</span><br><span class="line">+-----------------+-----+--------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure>
<p>当我们想不设置某一列的值的时候，默认值就能帮上忙。</p>
<p>这里先给一个错误的演示，我们只在values里面设置了两个值，目的是让新插入的这个用户的性别采用默认值。但MySQL报错了，报错的信息提示是value的个数和列的数量不一致</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; insert into web_user values (&#x27;李华&#x27;,16);</span><br><span class="line">ERROR 1136 (21S01): Column count doesn&#x27;t match value count at row 1</span><br></pre></td></tr></table></figure>
<p>这是因为我们在插入的时候，没有显示的告诉MySQL我们这两个值到底是哪两列的值。李华是给name列还是给gender列？MySQL没有办法自主决定！所以干脆拒绝插入。</p>
<p>所以，当我们想让某一列使用缺省值的时候，就需要告诉MySQL，我们当前指定的values到底是哪几列的数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> web_user (name,age) <span class="keyword">values</span> (<span class="string">&#x27;李华&#x27;</span>,<span class="number">16</span>);</span><br></pre></td></tr></table></figure>
<p>这样才能插入成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; insert into web_user (name,age) values (&#x27;李华&#x27;,16);</span><br><span class="line">Query OK, 1 row affected (0.005 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; select * from web_user;</span><br><span class="line">+-----------------+-----+--------+</span><br><span class="line">| name            | age | gender |</span><br><span class="line">+-----------------+-----+--------+</span><br><span class="line">| 默认用户名      |   0 | 男     |</span><br><span class="line">| 李华            |  16 | 男     |</span><br><span class="line">+-----------------+-----+--------+</span><br><span class="line">2 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure>
<p>因为这里做了对列名的显示指定，所以顺序并不一定需要依照表中列名的顺序，比如下方我们反过来也是可以插入的。但并不建议这么做，在插入的时候的列名顺序应该和表中列顺序保持一致！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; insert into web_user (age,name) values (18,&#x27;小李&#x27;);</span><br><span class="line">Query OK, 1 row affected (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; select * from web_user;</span><br><span class="line">+-----------------+-----+--------+</span><br><span class="line">| name            | age | gender |</span><br><span class="line">+-----------------+-----+--------+</span><br><span class="line">| 默认用户名      |   0 | 男     |</span><br><span class="line">| 李华            |  16 | 男     |</span><br><span class="line">| 小李            |  18 | 男     |</span><br><span class="line">+-----------------+-----+--------+</span><br><span class="line">3 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure>
<p>如果想让age列采用初始值，那就是如下的插入；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; insert into web_user (name,gender) values (&#x27;菲菲公主&#x27;,&#x27;女&#x27;);</span><br><span class="line">Query OK, 1 row affected (0.005 sec)</span><br></pre></td></tr></table></figure>
<h3 id="2-1-默认值和NULL">2.1 默认值和NULL</h3>
<p>需要注意的是，默认值和<code>NOT NULL</code>并不是必须一起使用的</p>
<ul>
<li>当我们设置了默认值，但是没有设置<code>NOT NULL</code>，我们可以显式地插入NULL</li>
<li>默认值也可以设置成NULL</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> test_user(</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not null</span> <span class="keyword">default</span> <span class="string">&#x27;默认用户名&#x27;</span>,</span><br><span class="line">    age tinyint <span class="keyword">not null</span> <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    gender <span class="type">char</span>(<span class="number">2</span>) <span class="keyword">default</span> <span class="keyword">null</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>使用如上sql创建表，数据库没有报错，即代表我们的语法是被支持的。因为性别并不需要参与运算，所以我们可以认为当性别列为空的时候，就是<code>未选择性别</code>的选项。不过，也可以通过空字符串作为默认值来解决这一问题，相比之下用空字符串更好，因为这样能保证这个字段的值始终是个字符串，而不需要对null进行特殊处理</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2023/08/0e39368e2aabc0dc69f29afa1f7dca19.png" alt="image-20230804095037098"></p>
<p><code>default null</code> 和 <code>not null</code>不能一起使用，这是肯定的！</p>
<h2 id="3-列描述comment">3.列描述comment</h2>
<p>需要注意，在sqlite中是不支持comment的，不同的数据库对sql字段的支持会有些许的差距，请根据你使用的数据库为准。本文所述基于MySQL和MariaDB。</p>
<p>所谓的列描述，就是对这列到底是干嘛的一个说明信息，相当于代码的注释。其本身没有任何含义；</p>
<p>列注释的主要作用，就是让所有使用这个数据库，使用这张表的人都能理解这个字段的作用。其中还可以添加额外的注释说明，来让程序员统一在不同模块的上传代码中进行额外的处理。</p>
<p>比如我们将第二点中出现过的用户表改成如下形式，每个字段都添加上注释</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> web_user(</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not null</span> <span class="keyword">default</span> <span class="string">&#x27;默认用户名&#x27;</span> comment <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">    age tinyint <span class="keyword">not null</span> <span class="keyword">default</span> <span class="number">0</span> comment <span class="string">&#x27;用户年龄&#x27;</span>,</span><br><span class="line">    gender <span class="type">char</span>(<span class="number">2</span>) <span class="keyword">not null</span> <span class="keyword">default</span> <span class="string">&#x27;男&#x27;</span> comment <span class="string">&#x27;用户性别&#x27;</span> </span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>当我们使用这个sql创建了这个表后，如果想查询字段的注释，可以用如下命令查看创建表时使用的命令（其中就包含了表的注释）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE TABLE</span> web_user;</span><br></pre></td></tr></table></figure>
<p>显示如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; SHOW CREATE TABLE web_user;</span><br><span class="line">+----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Table    | Create Table                                                                                                                                                                                                                                                               |</span><br><span class="line">+----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| web_user | CREATE TABLE `web_user` (</span><br><span class="line">  `name` varchar(30) NOT NULL DEFAULT &#x27;默认用户名&#x27; COMMENT &#x27;用户名&#x27;,</span><br><span class="line">  `age` tinyint(4) NOT NULL DEFAULT 0 COMMENT &#x27;用户年龄&#x27;,</span><br><span class="line">  `gender` char(2) NOT NULL DEFAULT &#x27;男&#x27; COMMENT &#x27;用户性别&#x27;</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8                  |</span><br><span class="line">+----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>也可以用如下命令来展示所有列和列的属性，其中包括注释</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">FULL</span> COLUMNS <span class="keyword">FROM</span> web_user;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; SHOW FULL COLUMNS FROM web_user;</span><br><span class="line">+--------+-------------+-----------------+------+-----+-----------------+-------+---------------------------------+--------------+</span><br><span class="line">| Field  | Type        | Collation       | Null | Key | Default         | Extra | Privileges                      | Comment      |</span><br><span class="line">+--------+-------------+-----------------+------+-----+-----------------+-------+---------------------------------+--------------+</span><br><span class="line">| name   | varchar(30) | utf8_general_ci | NO   |     | 默认用户名      |       | select,insert,update,references | 用户名       |</span><br><span class="line">| age    | tinyint(4)  | NULL            | NO   |     | 0               |       | select,insert,update,references | 用户年龄     |</span><br><span class="line">| gender | char(2)     | utf8_general_ci | NO   |     | 男              |       | select,insert,update,references | 用户性别     |</span><br><span class="line">+--------+-------------+-----------------+------+-----+-----------------+-------+---------------------------------+--------------+</span><br><span class="line">3 rows in set (0.002 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>需要注意，desc命令显示的结果中是不包含列注释的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; desc web_user;</span><br><span class="line">+--------+-------------+------+-----+-----------------+-------+</span><br><span class="line">| Field  | Type        | Null | Key | Default         | Extra |</span><br><span class="line">+--------+-------------+------+-----+-----------------+-------+</span><br><span class="line">| name   | varchar(30) | NO   |     | 默认用户名      |       |</span><br><span class="line">| age    | tinyint(4)  | NO   |     | 0               |       |</span><br><span class="line">| gender | char(2)     | NO   |     | 男              |       |</span><br><span class="line">+--------+-------------+------+-----+-----------------+-------+</span><br><span class="line">3 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2023/08/301424d83346183817bd7ef999e73357.png" alt="image-20230804101749987"></p>
<h2 id="4-zerofill">4.zerofill</h2>
<h3 id="4-1-测试结果">4.1 测试结果</h3>
<p>先来用如下命令创建一个表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> test_int(</span><br><span class="line">    a <span class="type">int</span> <span class="keyword">not null</span>,</span><br><span class="line">    b <span class="type">int</span> unsigned <span class="keyword">not null</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>创建完成后，我们查看创建这个表时使用的语句，会发现在int之后多了一个括号，里面跟了一个数字。</p>
<p>我们知道在char和varchar里面，这个括号是用来限制字符串字符长度的，那么在整形这里的括号是干嘛的呢？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; show create table test_int;</span><br><span class="line">+----------+------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Table    | Create Table                                                                                                           |</span><br><span class="line">+----------+------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| test_int | CREATE TABLE `test_int` (</span><br><span class="line">  `a` int(11) NOT NULL,</span><br><span class="line">  `b` int(10) unsigned NOT NULL</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8 |</span><br><span class="line">+----------+------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.001 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>先往这个表内插入一个数据，并查询显示出来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; insert into test_int values (3,1);</span><br><span class="line">Query OK, 1 row affected (0.005 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; select * from test_int;</span><br><span class="line">+---+---+</span><br><span class="line">| a | b |</span><br><span class="line">+---+---+</span><br><span class="line">| 3 | 1 |</span><br><span class="line">+---+---+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure>
<p>如果我们把a列的属性进行修改为如下的字段类型</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> test_int change a a <span class="type">int</span>(<span class="number">5</span>) unsigned zerofill;</span><br></pre></td></tr></table></figure>
<p>再去查看创建表的命令，此时结果如下，a列已经被修改成了信的属性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; alter table test_int change a a int(5) unsigned zerofill;</span><br><span class="line">Query OK, 1 row affected (0.005 sec)               </span><br><span class="line">Records: 1  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; show create table test_int;</span><br><span class="line">+----------+---------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Table    | Create Table                                                                                                                                |</span><br><span class="line">+----------+---------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| test_int | CREATE TABLE `test_int` (</span><br><span class="line">  `a` int(5) unsigned zerofill DEFAULT NULL,</span><br><span class="line">  `b` int(10) unsigned NOT NULL</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8 |</span><br><span class="line">+----------+---------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure>
<p>那么这个括号里面的数字，和zerofill有什么作用呢？</p>
<p>再次查询此表，会发现刚刚插入的数据，a列的3变成了<code>00003</code>！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; select * from test_int;</span><br><span class="line">+-------+---+</span><br><span class="line">| a     | b |</span><br><span class="line">+-------+---+</span><br><span class="line">| 00003 | 1 |</span><br><span class="line">+-------+---+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure>
<h3 id="4-2-前补0">4.2 前补0</h3>
<p>此时这个属性的作用就很明确了，其用于给数字进行前补0；而5就是规定的前补0的长度，而不是数字的长度；当数字的位数小于5位，就会触发前补0；</p>
<p>可以看到，即便表结构中出现了<code>int(5)</code>，我们依旧可以往这个表里面插入长度大于5位的数字</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; insert into test_int values (12345678,1);</span><br><span class="line">Query OK, 1 row affected (0.005 sec)</span><br></pre></td></tr></table></figure>
<p>所以这个括号并不是用来限制int的长度的，而是当一个数字小于5位的时候，会给这个数字前补0</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; insert into test_int values (18,3);</span><br><span class="line">Query OK, 1 row affected (0.005 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; select * from test_int;</span><br><span class="line">+----------+---+</span><br><span class="line">| a        | b |</span><br><span class="line">+----------+---+</span><br><span class="line">|    00003 | 1 |</span><br><span class="line">| 12345678 | 1 |</span><br><span class="line">|    00018 | 3 |</span><br><span class="line">+----------+---+</span><br><span class="line">3 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure>
<p>如果再把<code>int(5) zerofill</code>改成更长的数值，前补0的长度就会变化</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> test_int change a a <span class="type">int</span>(<span class="number">7</span>) unsigned zerofill;</span><br></pre></td></tr></table></figure>
<p>效果如下，少于7位的数字都会前补0到七位</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; alter table test_int change a a int(7) unsigned zerofill;</span><br><span class="line">Query OK, 0 rows affected (0.007 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; select * from test_int;</span><br><span class="line">+----------+---+</span><br><span class="line">| a        | b |</span><br><span class="line">+----------+---+</span><br><span class="line">|  0000003 | 1 |</span><br><span class="line">| 12345678 | 1 |</span><br><span class="line">|  0000018 | 3 |</span><br><span class="line">+----------+---+</span><br><span class="line">3 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure>
<p>需要注意，<code>int(n)</code>的属性只有和<code>zerofill</code>一起使用，才会触发前补0的操作。这便能解释为何最初创建的表里面是<code>int(11)</code>，但数字并没有被前补0；</p>
<p>而这里的前补0，只是一个在MySQL内部<strong>显示的优化</strong>，实际上存储的依旧是数字本身；比如我们在上表中查询3，是可以直接查出来的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; select * from test_int where a = 3;</span><br><span class="line">+---------+---+</span><br><span class="line">| a       | b |</span><br><span class="line">+---------+---+</span><br><span class="line">| 0000003 | 1 |</span><br><span class="line">+---------+---+</span><br><span class="line">1 row in set (0.001 sec)</span><br></pre></td></tr></table></figure>
<p>比如我要存储的数字都是5位的，设置了前补0，查询整表时看到的格式化输出的结果会比没有前补0的结果看上去舒服很多。</p>
<h3 id="4-3-为什么int是11，无符号是10？">4.3 为什么int是11，无符号是10？</h3>
<p>在前面查询默认的创建表i语句的时候，会发现MySQL系统默认给int了11位，无符号int是10位</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2023/08/313a7278f6c389a25110b77c394c7d95.png" alt="image-20230804104708752"></p>
<p>这是因为10位的长度已经能标识int范围内的所有值了，而有符号整数多了一位，是用来显示正负号的。</p>
<h2 id="5-主键primary-key">5.主键primary key</h2>
<p>主键是用于约束字段里面的数据，不能重复，<strong>不能为空</strong>；一张表只有一个主键（或者没有），一般都是用整形作为主键。</p>
<p>主键是用于确定表中每一条记录的唯一性的，其告知了使用者，要想往这个表中插入数据，就必须保证主键的值不冲突。</p>
<h3 id="5-1-主键的设计类型">5.1 主键的设计类型</h3>
<p>以一个用户系统为例</p>
<ul>
<li>我们可以把用户名设置为主键，当用户选择了一个已经存在的用户名时，拒绝此用户名并告知用户；</li>
<li>我们可以使用另外一个无关的数字作为主键，比如QQ中就使用了QQ号来标识用户唯一性，并不要求用户的用户名不能相相同（现在绝大部分聊天软件都使用了这种方式，比如QQ和KOOK，微信虽然没有QQ那样的唯一标识，但后台肯定也是有主键作为唯一性标识的）、</li>
<li>我们可以将多列组成复合主键</li>
</ul>
<h3 id="5-2-删除和添加主键">5.2 删除和添加主键</h3>
<p>在创建表的时候，可以用两种方式来指定主键</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 方法1，在字段后指明</span></span><br><span class="line"><span class="keyword">create table</span> test_pri_1(</span><br><span class="line">    id <span class="type">int</span> unsigned <span class="keyword">not null</span> <span class="keyword">primary key</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not null</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 方法2，在表的最后指明</span></span><br><span class="line"><span class="keyword">create table</span> test_pri_2(</span><br><span class="line">    id <span class="type">int</span> unsigned <span class="keyword">not null</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not null</span>,</span><br><span class="line">    <span class="keyword">primary key</span>(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>二者都能执行成功。</p>
<p>另外，主键本身就是不能为空的，所以我们定义主键列的时候可以不用写<code>not null</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; create table test_pri_1(</span><br><span class="line">    -&gt; id int unsigned not null primary key,</span><br><span class="line">    -&gt;     name varchar(30) not null</span><br><span class="line">    -&gt; );</span><br><span class="line">Query OK, 0 rows affected (0.017 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; create table test_pri_2(</span><br><span class="line">    -&gt; id int unsigned not null,</span><br><span class="line">    -&gt;     name varchar(30) not null,</span><br><span class="line">    -&gt;     primary key(id)</span><br><span class="line">    -&gt; );</span><br><span class="line">Query OK, 0 rows affected (0.019 sec)</span><br></pre></td></tr></table></figure>
<p>而且表结构相同，在id列的Key处可以看到PRI，就是<code>Primary</code>的缩写，代表id列是主键</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; desc test_pri_1;</span><br><span class="line">+-------+------------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type             | Null | Key | Default | Extra |</span><br><span class="line">+-------+------------------+------+-----+---------+-------+</span><br><span class="line">| id    | int(10) unsigned | NO   | PRI | NULL    |       |</span><br><span class="line">| name  | varchar(30)      | NO   |     | NULL    |       |</span><br><span class="line">+-------+------------------+------+-----+---------+-------+</span><br><span class="line">2 rows in set (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; desc test_pri_2;</span><br><span class="line">+-------+------------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type             | Null | Key | Default | Extra |</span><br><span class="line">+-------+------------------+------+-----+---------+-------+</span><br><span class="line">| id    | int(10) unsigned | NO   | PRI | NULL    |       |</span><br><span class="line">| name  | varchar(30)      | NO   |     | NULL    |       |</span><br><span class="line">+-------+------------------+------+-----+---------+-------+</span><br><span class="line">2 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure>
<p>如果是一个已经存在的表，我们也可以往里面追加主键或者删除主键</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 表名 <span class="keyword">drop</span> <span class="keyword">primary key</span>;</span><br><span class="line"><span class="comment">-- 用于删除主键列的主键属性，因为主键列只能有一个</span></span><br><span class="line"><span class="comment">-- 注意，这个语句不会删除该列</span></span><br><span class="line"><span class="keyword">alter table</span> 表名 <span class="keyword">add</span> <span class="keyword">primary key</span>(id);</span><br><span class="line"><span class="comment">-- 给id列加上主键属性（但是ID列里面不能有重复值）</span></span><br></pre></td></tr></table></figure>
<p>测试一下，可以看到id列的PRI属性没有了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; alter table test_pri_1 drop primary key;</span><br><span class="line">Query OK, 0 rows affected (0.010 sec)              </span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; desc test_pri_1;</span><br><span class="line">+-------+------------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type             | Null | Key | Default | Extra |</span><br><span class="line">+-------+------------------+------+-----+---------+-------+</span><br><span class="line">| id    | int(10) unsigned | NO   |     | NULL    |       |</span><br><span class="line">| name  | varchar(30)      | NO   |     | NULL    |       |</span><br><span class="line">+-------+------------------+------+-----+---------+-------+</span><br><span class="line">2 rows in set (0.002 sec)</span><br></pre></td></tr></table></figure>
<p>当我们往表里面插入数据的时候，如果想往主键列插入一个相同的记录，MySQL会拒绝插入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; insert into test_pri_2  values (1,&#x27;李华&#x27;);</span><br><span class="line">Query OK, 1 row affected (0.006 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; insert into test_pri_2  values (1,&#x27;李明&#x27;);</span><br><span class="line">ERROR 1062 (23000): Duplicate entry &#x27;1&#x27; for key &#x27;PRIMARY&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="5-3-复合主键">5.3 复合主键</h3>
<p>一张表只有一个主键，<strong>但是主键可以不止一列</strong>；</p>
<p>以我自己写的活跃度统计机器人为例，机器人处在不同服务器中，会收到不同的服务器ID，和不同用户的操作；为了记录不同服务器的不同用户的活跃度情况，在用户统计表中，需要同时有服务器ID和用户ID；此时就会出现<strong>一个用户加入了两个服务器</strong>，而这两个服务器都使用了我这个机器人的情况。反馈到表中，就是一个用户ID出现了两次，但对应的服务器ID不同；</p>
<p>在这种情形下，肯定是不能把用户ID或服务器ID单独设置成主键的。我们就可以把用户ID和服务器ID统一设置成符合主键；</p>
<p>设置了复合主键后，我们可以出现相同的服务器ID，和相同的用户ID。但只能是<strong>某个服务器的某个用户</strong>，不能存在两条<strong>服务器ID和用户ID都相同</strong>的记录。这便是复合主键的作用！</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> <span class="keyword">user</span>(</span><br><span class="line">    guild_id <span class="type">int</span> unsigned comment <span class="string">&#x27;服务器ID&#x27;</span>,</span><br><span class="line">    user_id <span class="type">int</span> unsigned <span class="keyword">not null</span> comment <span class="string">&#x27;用户ID&#x27;</span>,</span><br><span class="line">    score tinyint unsigned <span class="keyword">not null</span> <span class="keyword">default</span> <span class="number">0</span> comment <span class="string">&#x27;用户积分&#x27;</span>,</span><br><span class="line">    <span class="keyword">primary key</span>(guild_id, user_id) <span class="comment">-- guild_id + user_id 为复合主键</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>此时查看表结构，会发现服务器id和用户id的两个键值，在Key里面都有<code>PRI</code>属性，即他们都是主键；</p>
<p>而且，即便我们的<code>guild_id</code>没有指定<code>not null</code>，其的<code>NULL</code>属性依旧是NO。因为主键是不允许为NULL的！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; create table user(</span><br><span class="line">    -&gt; guild_id int unsigned comment &#x27;服务器ID&#x27;,</span><br><span class="line">    -&gt; user_id int unsigned not null comment &#x27;用户ID&#x27;,</span><br><span class="line">    -&gt; score tinyint unsigned not null default 0 comment &#x27;用户积分&#x27;,</span><br><span class="line">    -&gt; primary key(guild_id, user_id) -- guild_id + user_id 为复合主键</span><br><span class="line">    -&gt; );</span><br><span class="line">Query OK, 0 rows affected (0.011 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; desc user;</span><br><span class="line">+----------+---------------------+------+-----+---------+-------+</span><br><span class="line">| Field    | Type                | Null | Key | Default | Extra |</span><br><span class="line">+----------+---------------------+------+-----+---------+-------+</span><br><span class="line">| guild_id | int(10) unsigned    | NO   | PRI | NULL    |       |</span><br><span class="line">| user_id  | int(10) unsigned    | NO   | PRI | NULL    |       |</span><br><span class="line">| score    | tinyint(3) unsigned | NO   |     | 0       |       |</span><br><span class="line">+----------+---------------------+------+-----+---------+-------+</span><br><span class="line">3 rows in set (0.003 sec)</span><br></pre></td></tr></table></figure>
<p>当我们插入时，服务器id和用户id可以在各自列中重复。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; insert into user values (1,1,0);</span><br><span class="line">Query OK, 1 row affected (0.008 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; insert into user values (1,2,0);</span><br><span class="line">Query OK, 1 row affected (0.008 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; insert into user values (2,1,0);</span><br><span class="line">Query OK, 1 row affected (0.001 sec)</span><br></pre></td></tr></table></figure>
<p>但如果你想在已经有<strong>服务器id为1，用户id为1</strong>的记录的基础上再插入一条这样的记录，那就会报错拒绝插入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; select * from user;</span><br><span class="line">+----------+---------+-------+</span><br><span class="line">| guild_id | user_id | score |</span><br><span class="line">+----------+---------+-------+</span><br><span class="line">|        1 |       1 |     0 |</span><br><span class="line">|        1 |       2 |     0 |</span><br><span class="line">|        2 |       1 |     0 |</span><br><span class="line">+----------+---------+-------+</span><br><span class="line">3 rows in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; insert into user values (1,1,10);</span><br><span class="line">ERROR 1062 (23000): Duplicate entry &#x27;1-1&#x27; for key &#x27;PRIMARY&#x27;</span><br></pre></td></tr></table></figure>
<h2 id="6-自增auto-increment">6.自增auto_increment</h2>
<p>自增，人如其名，就是MySQL会自动帮我们往这个列添加数据。比如一个序号，新增一条记录就会将序号加一；自增属性只能添加给整形！</p>
<p>自增的列必须是主键！</p>
<h3 id="6-1-使用">6.1 使用</h3>
<p>自增的使用办法是在创建表的键值后添加这个约束</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> test_pri_3(</span><br><span class="line">    id <span class="type">int</span> unsigned auto_increment,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not null</span>,</span><br><span class="line">    <span class="keyword">primary key</span>(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>查看表结构，可以看到id列是主键，非空，且具有自增属性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; desc test_pri_3;</span><br><span class="line">+-------+------------------+------+-----+---------+----------------+</span><br><span class="line">| Field | Type             | Null | Key | Default | Extra          |</span><br><span class="line">+-------+------------------+------+-----+---------+----------------+</span><br><span class="line">| id    | int(10) unsigned | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| name  | varchar(30)      | NO   |     | NULL    |                |</span><br><span class="line">+-------+------------------+------+-----+---------+----------------+</span><br><span class="line">2 rows in set (0.003 sec)</span><br></pre></td></tr></table></figure>
<p>由于自增的列必须是主键，所以我们不能将其和主键分开来使用；</p>
<p>如果在设置自增的时候没有将这列同时设置为主键，那么创建表的时候就会报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; create table test_pri_4(</span><br><span class="line">    -&gt; id int unsigned auto_increment,</span><br><span class="line">    -&gt;     name varchar(30) not null</span><br><span class="line">    -&gt; );</span><br><span class="line">ERROR 1075 (42000): Incorrect table definition; there can be only one auto column and it must be defined as a key</span><br></pre></td></tr></table></figure>
<p>设置了自增之后，我们同样可以显示的指定该列的值；也可以不指定，直接插入其他列的数据。MySQL会自动帮我们把当前记录+1。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; insert into test_pri_3 values (1,&#x27;李华&#x27;);</span><br><span class="line">Query OK, 1 row affected (0.007 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; select * from test_pri_3;</span><br><span class="line">+----+--------+</span><br><span class="line">| id | name   |</span><br><span class="line">+----+--------+</span><br><span class="line">|  1 | 李华   |</span><br><span class="line">+----+--------+</span><br><span class="line">1 row in set (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; insert into test_pri_3 (name) values (&#x27;小明&#x27;);</span><br><span class="line">Query OK, 1 row affected (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; select * from test_pri_3;</span><br><span class="line">+----+--------+</span><br><span class="line">| id | name   |</span><br><span class="line">+----+--------+</span><br><span class="line">|  1 | 李华   |</span><br><span class="line">|  2 | 小明   |</span><br><span class="line">+----+--------+</span><br><span class="line">2 rows in set (0.000 sec)</span><br></pre></td></tr></table></figure>
<p>多插入几条数据，可以看到id列都成功自增了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; insert into test_pri_3 (name) values (&#x27;小明3&#x27;);</span><br><span class="line">Query OK, 1 row affected (0.005 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; insert into test_pri_3 (name) values (&#x27;小明5&#x27;);</span><br><span class="line">Query OK, 1 row affected (0.005 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; select * from test_pri_3;</span><br><span class="line">+----+---------+</span><br><span class="line">| id | name    |</span><br><span class="line">+----+---------+</span><br><span class="line">|  1 | 李华    |</span><br><span class="line">|  2 | 小明    |</span><br><span class="line">|  3 | 小明3   |</span><br><span class="line">|  4 | 小明5   |</span><br><span class="line">+----+---------+</span><br><span class="line">4 rows in set (0.000 sec)</span><br></pre></td></tr></table></figure>
<h3 id="6-2-自增是怎么判断当前所处序号位置的？">6.2 自增是怎么判断当前所处序号位置的？</h3>
<p>自增的长度是按最大的那个数字开始自增的？还是说有其他处理流程？</p>
<p>先尝试往表里面主动插入一个1000为id的键值，然后再不指定id的情况下再插入两行记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; insert into test_pri_3 values (1000,&#x27;test&#x27;);</span><br><span class="line">Query OK, 1 row affected (0.006 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; insert into test_pri_3 (name) values (&#x27;test1&#x27;);</span><br><span class="line">Query OK, 1 row affected (0.005 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; insert into test_pri_3 (name) values (&#x27;test2&#x27;);</span><br><span class="line">Query OK, 1 row affected (0.001 sec)</span><br></pre></td></tr></table></figure>
<p>查询列表，会发现在这1000之后的的记录，全都是从1000开始增加的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; select * from test_pri_3;</span><br><span class="line">+------+---------+</span><br><span class="line">| id   | name    |</span><br><span class="line">+------+---------+</span><br><span class="line">|    1 | 李华    |</span><br><span class="line">|    2 | 小明    |</span><br><span class="line">|    3 | 小明3   |</span><br><span class="line">|    4 | 小明5   |</span><br><span class="line">| 1000 | test    |</span><br><span class="line">| 1001 | test1   |</span><br><span class="line">| 1002 | test2   |</span><br><span class="line">+------+---------+</span><br><span class="line">7 rows in set (0.000 sec)</span><br></pre></td></tr></table></figure>
<p>莫非是依照最大的id来进行自增的吗？我们再来试试。</p>
<p>先把最大id的记录删除，再插入一个新数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; delete from test_pri_3 where id = 1002;</span><br><span class="line">Query OK, 1 row affected (0.007 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; insert into test_pri_3 (name) values (&#x27;test3&#x27;);</span><br><span class="line">Query OK, 1 row affected (0.006 sec)</span><br></pre></td></tr></table></figure>
<p>再次查询，会发现自增的id是1003。可见其内部记录过一个id的最大值，是按内部一个额外的记录来进行自增的，而不是判断表中id列的最大值！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; select * from test_pri_3;</span><br><span class="line">+------+---------+</span><br><span class="line">| id   | name    |</span><br><span class="line">+------+---------+</span><br><span class="line">|    1 | 李华    |</span><br><span class="line">|    2 | 小明    |</span><br><span class="line">|    3 | 小明3   |</span><br><span class="line">|    4 | 小明5   |</span><br><span class="line">| 1000 | test    |</span><br><span class="line">| 1001 | test1   |</span><br><span class="line">| 1003 | test3   |</span><br><span class="line">+------+---------+</span><br><span class="line">7 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure>
<p>那这个额外的记录在哪里呢？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create table</span> test_pri_3;</span><br></pre></td></tr></table></figure>
<p>使用如上命令查看创建表的sql语句，你会发现紧跟在表之后的，就有一个自增的字段<code>AUTO_INCREMENT=1004</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; show create table test_pri_3;</span><br><span class="line">+------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Table      | Create Table                                                                                                                                                                              |</span><br><span class="line">+------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| test_pri_3 | CREATE TABLE `test_pri_3` (</span><br><span class="line">  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `name` varchar(30) NOT NULL,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1004 DEFAULT CHARSET=utf8 |</span><br><span class="line">+------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure>
<p>这就是MySQL中对自增字段当前值的定义，这里存放的就是下一个插入的记录，其id的自增值。每次插入一个信的记录，这里的自增值就会对应变换为下一个记录应该是多少的数值；</p>
<p>举个例子，如果我们想让一个系统的ID从10001开始自增，那么我们就可以在创建了表之后，直接往表里面插入一个id为10000的记录。在这之后创建的其他记录，id就会从10001开始自增了！</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2023/08/d5664b51f462f28b0459cd5ddbb8afdc.png" alt="image-20230804133951367"></p>
<h3 id="6-3-索引">6.3 索引</h3>
<p>讲到这里，顺带一提MySQL中索引的概念</p>
<p><strong>索引</strong>： 在关系数据库中，索引是一种单独的、物理的对数据库表中一列或多列的值进行排序的一种存储结构。它是某个表中一列或若干列值的集合和相应的指向表中物理标识这些值的数据页的<strong>逻辑指针清单</strong>。</p>
<p>索引的作用相当于<strong>图书的目录</strong>，可以根据目录中的页码快速找到所需的内容。索引提供指向存储在表的指定列中的数据值的指针，然后根据您指定的排序顺序对这些指针排序。 数据库使用索引以找到特定值，然后顺指针找到包含该值的行。</p>
<p>这样可以使对应于表的SQL语句执行得更快，可快速访问数据库表中的特定信息。</p>
<p>索引本质上就是一个用空间换时间的套路。在当前多并发的业务中，执行速度远比占用内存、磁盘多少来的更重要！</p>
<h2 id="7-唯一键unique">7.唯一键unique</h2>
<p>唯一键对字段的约束，那就是这一列的数据都不能出现相同的。</p>
<p>看起来和主键有点相似，但实际上其是独立于主键之外的一种唯一性的约束。和主键的区别在于：<strong>唯一键可以为NULL</strong></p>
<p>要知道，一个表里面的主键只能设置一个。复合主键在某些时候并不能满足我们的需求。于是MySQL就在主键之外，额外提供了唯一键的约束，让我们可以给其他列设置唯一性。</p>
<p>至于为什么要这么做？就好比一个免责声明：我这列的数据设置了唯一，那么就不可能接受两个相同的记录（比如用户表中两个人却有相同手机号，是不应该的）如果你的业务中出现了拒绝插入的报错，那么就应该去看业务处理代码中是哪里有BUG，而不应该怪罪MySQL没有维护唯一性或者拒绝记录的插入。</p>
<h3 id="7-1-单独唯一键">7.1 单独唯一键</h3>
<p>假设我有一个平台，类似于qq一样使用了一个qq号作为用户的主键；但为了实名认证，我们又要求一个身份证只能注册一个账户。此时就无法用复合主键来解决这个问题，<strong>因为复合主键是允许其中某一列有重复的</strong>；而我们需要的是<strong>用户账户编号和用户身份证号</strong>都不能重复！</p>
<blockquote>
<p>同时，在用户的联系方式中，两个用户的电话号码、微信号也不应该出现相同，如果要添加电话号码的键值，也可以将其设置为<code>unique</code>！</p>
</blockquote>
<p>此时就可以将用户编号作为主键，用户身分证号设置<code>unique</code>作为唯一键；</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> test_unique_1(</span><br><span class="line">    <span class="keyword">no</span> <span class="type">int</span> unsigned <span class="keyword">not null</span> <span class="keyword">primary key</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not null</span>,</span><br><span class="line">    id_card <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not null</span> <span class="keyword">unique</span> </span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>查看表结构，唯一键的列，Key的约束是UNI，即<code>unique</code>的缩写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; desc test_unique_1;</span><br><span class="line">+---------+------------------+------+-----+---------+-------+</span><br><span class="line">| Field   | Type             | Null | Key | Default | Extra |</span><br><span class="line">+---------+------------------+------+-----+---------+-------+</span><br><span class="line">| no      | int(10) unsigned | NO   | PRI | NULL    |       |</span><br><span class="line">| name    | varchar(30)      | NO   |     | NULL    |       |</span><br><span class="line">| id_card | varchar(30)      | NO   | UNI | NULL    |       |</span><br><span class="line">+---------+------------------+------+-----+---------+-------+</span><br><span class="line">3 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure>
<p>当我们往这个表中的主键列或者<code>id_card</code>列插入相同记录时，MySQL都会拒绝插入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; insert into test_unique_1 values (1,&#x27;李华&#x27;,123456);</span><br><span class="line">Query OK, 1 row affected (0.006 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; insert into test_unique_1 values (1,&#x27;李华&#x27;,1234567);</span><br><span class="line">ERROR 1062 (23000): Duplicate entry &#x27;1&#x27; for key &#x27;PRIMARY&#x27;</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; insert into test_unique_1 values (3,&#x27;小明&#x27;,123456);</span><br><span class="line">ERROR 1062 (23000): Duplicate entry &#x27;123456&#x27; for key &#x27;id_card&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="7-2-复合唯一键">7.2 复合唯一键</h3>
<p>唯一键也能设置多列，效果和复合主键相同；这里不再说明</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> <span class="keyword">user</span>(</span><br><span class="line">    user_no <span class="type">int</span> unsigned <span class="keyword">primary key</span> auto_increment comment <span class="string">&#x27;用户编号 主键&#x27;</span>,</span><br><span class="line">    guild_id <span class="type">int</span> unsigned comment <span class="string">&#x27;服务器ID&#x27;</span>,</span><br><span class="line">    user_id <span class="type">int</span> unsigned <span class="keyword">not null</span> comment <span class="string">&#x27;用户ID&#x27;</span>,</span><br><span class="line">    score tinyint unsigned <span class="keyword">not null</span> <span class="keyword">default</span> <span class="number">0</span> comment <span class="string">&#x27;用户积分&#x27;</span>,</span><br><span class="line">    <span class="keyword">unique</span>(guild_id, user_id) <span class="comment">-- guild_id + user_id 为复合唯一键</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>表中对<code>guild_id和user_id</code>的约束就变成了<code>MUL</code>，如下图所示；</p>
<p>其中能观察到，<code>guild_id</code>因为没有设置<code>not null</code>，其NULL一栏为YES，代表这列可以为NULL（唯一键可以为NULL，主键不能）</p>
<p>而MUL则代表目前允许多行在此列具有相同的值，但<code>guild_id和user_id</code>都相同的两行是不允许存在的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; desc user;</span><br><span class="line">+----------+---------------------+------+-----+---------+----------------+</span><br><span class="line">| Field    | Type                | Null | Key | Default | Extra          |</span><br><span class="line">+----------+---------------------+------+-----+---------+----------------+</span><br><span class="line">| user_no  | int(10) unsigned    | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| guild_id | int(10) unsigned    | YES  | MUL | NULL    |                |</span><br><span class="line">| user_id  | int(10) unsigned    | NO   |     | NULL    |                |</span><br><span class="line">| score    | tinyint(3) unsigned | NO   |     | 0       |                |</span><br><span class="line">+----------+---------------------+------+-----+---------+----------------+</span><br><span class="line">4 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure>
<p>如下，最后的插入和第一次的插入中的<code>guild_id和user_id</code>相同，于是就出现了拒绝插入的报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; insert into user values (1,1,1,20);</span><br><span class="line">Query OK, 1 row affected (0.006 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; insert into user values (2,1,2,21);</span><br><span class="line">Query OK, 1 row affected (0.005 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; insert into user values (3,2,3,22);</span><br><span class="line">Query OK, 1 row affected (0.006 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; insert into user values (4,1,1,23);</span><br><span class="line">ERROR 1062 (23000): Duplicate entry &#x27;1-1&#x27; for key &#x27;guild_id&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="7-3-在MySQL中MUL、PRI和UNI是什么？">7.3 在MySQL中MUL、PRI和UNI是什么？</h3>
<p>从<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/show-columns.html">Mysql 5.7</a>官网文档可知：</p>
<ul>
<li>如果键是PRI，则列是主键或多列主键中的列之一；</li>
<li>如果键是UNI，则该列是唯一索引的第一列(唯一索引允许多个空值，但可以通过检查NULL字段来判断该列是否允许空)；</li>
<li>如果键为MUL，则该列是非唯一索引的第一列，其中允许在列中多次出现给定值；</li>
</ul>
<h2 id="8-外键foreign-key">8.外键foreign key</h2>
<h3 id="8-1-说明">8.1 说明</h3>
<p>外键是用来定义两张表中某些字段的关系，并来约束记录的；</p>
<p>基础语法如下，在创建表的时候使用。需要设置外键的表是<strong>从表</strong>！</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> 表名 <span class="keyword">ADD CONSTRAINT</span> 外键约束名 </span><br><span class="line"><span class="keyword">FOREIGN KEY</span> (外键列名) <span class="keyword">REFERENCES</span> 主表名(主表列名) </span><br><span class="line">[<span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE] [<span class="keyword">ON</span> <span class="keyword">UPDATE</span> CASCADE];</span><br></pre></td></tr></table></figure>
<ul>
<li>ON DELETE CASCADE 选项，当主表中的字段删除，从表中的记录也会删除</li>
<li>ON UPDATE CASCADE 选项，当主表中字段更新，从表中记录也得更新</li>
</ul>
<p>比如下图中，学生表中每个学生的班级编号都对应了班级表中班级的id，此时我们就可以将班级表的id设置为学生表中<code>class_id</code>的外键；</p>
<p>虽然我们可以将class表中的数据直接插入到学生表里面，但是这样并不合理。如果我们针对一个班级，或者针对一个学生的字段有非常多的话，将这两张表合起来是非常不方便的。因为同一个班级会有很多学生，合并表之后，就相当于同一个班级的学生，<strong>他们的班级列的信息全是相等的</strong>，这就存在了无意义的资源占用（冗余）。</p>
<p>相比之下，分表了之后，再采用<strong>外键</strong>的方式来<strong>绑定两个字段</strong>，是更好的选择！</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://img.musnow.top/i/2023/08/39ddbd009958fabccd8729f420bbae2e.png" alt="image-20230804161621345"></p>
<p>在上图的情况中，myclass是主表，stu是一个从表；你也可以从大小规模的逻辑来理解，只有班级才能包含学生，学生不能包含班级，所以班级表更“大”，为主表，学生表为从表。</p>
<p><strong>插入数据的时候，需要先往主表插入，再往从表插入</strong>。先有班级，才能给这个班级添加学生</p>
<p>建表语句如下，从表stu中添加了外键约束命令。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 主表 班级</span></span><br><span class="line"><span class="keyword">create table</span> myclass (</span><br><span class="line">    id <span class="type">int</span> <span class="keyword">primary key</span> comment <span class="string">&#x27;班级号&#x27;</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not null</span> comment <span class="string">&#x27;班级名&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 从表 学生</span></span><br><span class="line"><span class="keyword">create table</span> stu (</span><br><span class="line">    id <span class="type">int</span> <span class="keyword">primary key</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not null</span> comment <span class="string">&#x27;学生名&#x27;</span>,</span><br><span class="line">    class_id <span class="type">int</span>,</span><br><span class="line">    <span class="keyword">foreign key</span> (class_id) <span class="keyword">references</span> myclass(id) <span class="comment">-- 设置从表外键约束</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="8-2-基本测试">8.2 基本测试</h3>
<p>创建好表之后，先来看看学生表i的属性，可以看到<code>class_id</code>表的key是一个MUL，和前面设置复合唯一键的时候相同。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; desc stu;</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field    | Type        | Null | Key | Default | Extra |</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">| id       | int(11)     | NO   | PRI | NULL    |       |</span><br><span class="line">| name     | varchar(30) | NO   |     | NULL    |       |</span><br><span class="line">| class_id | int(11)     | YES  | MUL | NULL    |       |</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">3 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure>
<p>当我们尝试往学生表里面插入一个数据的时候，会报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; insert into stu values (1,&#x27;李华&#x27;,2);</span><br><span class="line">ERROR 1452 (23000): Cannot add or update a child row: a foreign key constraint fails (`hello`.`stu`, CONSTRAINT `stu_ibfk_1` FOREIGN KEY (`class_id`) REFERENCES `myclass` (`id`))</span><br></pre></td></tr></table></figure>
<p>这是因为你设置的这个记录中，学生的班级编号2压根在班级表里面不存在。一个不存在的班级怎么可以有学生呢？所以自然就拒绝了你的插入。</p>
<p>所以，要想插入学生，我们需要保证这个学生的记录所在班级，是存在于班级表里面的！这样就实现了学生和班级N对1的绑定。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; insert into myclass values (1,&#x27;少华班&#x27;);</span><br><span class="line">Query OK, 1 row affected (0.002 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; insert into stu values (1,&#x27;李华&#x27;,1);</span><br><span class="line">Query OK, 1 row affected (0.005 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; select * from myclass;</span><br><span class="line">+----+-----------+</span><br><span class="line">| id | name      |</span><br><span class="line">+----+-----------+</span><br><span class="line">|  1 | 少华班    |</span><br><span class="line">+----+-----------+</span><br><span class="line">1 row in set (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; select * from stu;</span><br><span class="line">+----+--------+----------+</span><br><span class="line">| id | name   | class_id |</span><br><span class="line">+----+--------+----------+</span><br><span class="line">|  1 | 李华   |        1 |</span><br><span class="line">+----+--------+----------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure>
<p>这里我又多插入了几个数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; select * from stu;</span><br><span class="line">+----+-----------+----------+</span><br><span class="line">| id | name      | class_id |</span><br><span class="line">+----+-----------+----------+</span><br><span class="line">|  1 | 李华      |        1 |</span><br><span class="line">|  2 | 小明      |        1 |</span><br><span class="line">|  3 | 小流      |        1 |</span><br><span class="line">|  4 | 小流2     |        2 |</span><br><span class="line">|  5 | 猪猪侠    |        2 |</span><br><span class="line">|  6 | 苗条俊    |        2 |</span><br><span class="line">+----+-----------+----------+</span><br><span class="line">6 rows in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; select * from myclass;</span><br><span class="line">+----+-----------+</span><br><span class="line">| id | name      |</span><br><span class="line">+----+-----------+</span><br><span class="line">|  1 | 少华班    |</span><br><span class="line">|  2 | 你好班    |</span><br><span class="line">+----+-----------+</span><br><span class="line">2 rows in set (0.000 sec)</span><br></pre></td></tr></table></figure>
<p>此时还有另外一个问题：如果这个班级有学生，我们可以把这个班级删掉吗？</p>
<p>考虑看来，肯定是不行的：既然没有这个班级，你不能插入对应的学生。那么这个班级有学生的时候，你也不应该把班级删除。二者是相互的逻辑；在MySQL里面也是如此，当一个班级有对应的学生的时候，是不允许删除的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; delete from myclass where id = 1;</span><br><span class="line">ERROR 1451 (23000): Cannot delete or update a parent row: a foreign key constraint fails (`hello`.`stu`, CONSTRAINT `stu_ibfk_1` FOREIGN KEY (`class_id`) REFERENCES `myclass` (`id`))</span><br></pre></td></tr></table></figure>
<p>只有当这个班级没有学生了，才能从班级表中被删除！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; delete from stu where class_id = 2;</span><br><span class="line">Query OK, 3 rows affected (0.005 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; delete from myclass where id = 2;</span><br><span class="line">Query OK, 1 row affected (0.006 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [hello]&gt; </span><br></pre></td></tr></table></figure>
<p>更新班级id同样是不允许的，因为在学生表中有学生绑定了这个班级。MySQL并不能做到帮我们直接更新所有学生的班级号。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hello]&gt; update  myclass set id = 3 where name = &#x27;你好班&#x27;; </span><br><span class="line">ERROR 1451 (23000): Cannot delete or update a parent row: a foreign key constraint fails (`hello`.`stu`, CONSTRAINT `stu_ibfk_1` FOREIGN KEY (`class_id`) REFERENCES `myclass` (`id`))</span><br></pre></td></tr></table></figure>
<h3 id="8-3-外键约束概念">8.3 外键约束概念</h3>
<p>在上面的情况中，我们完全可以<strong>建立两个没有外键关系的独立表</strong>，在代码层进行两者关系的维护。</p>
<p>但是这样，这两个表的操作依旧是<strong>独立</strong>的，MySQL是不知道这两个表之间有毛线关联的；此时你就可以往不存在的班级里面插学生，把还有学生的班级删掉，<strong>最终就乱了套了</strong>；</p>
<ul>
<li>自己维护：两个表的信息有关联</li>
<li>加上外键：MySQL直接进行约束</li>
</ul>
<p>两者合一，才是外键的完全体！</p>
<blockquote>
<p>如果只在上层代码中约束，特别是多端协作公用数据库的时候，极有可能因为双方程序猿沟通不到位而导致数据库中产生无效记录。外键的存在帮我们避免了这个在协作中的沟通问题。</p>
</blockquote>
<p>所以我们才需要在MySQL中，将这两个表之间定义外键的约束，让MySQL协助我们维护两张表中的数据关系。</p>
<p>注意：虽然此时MySQL会约束我们的操作，但实际上的业务流程还是需要程序袁在代码中处理。比如不要往MySQL中插入班级不存在的学生（MySQL只会拒绝插入，并不能帮你把班级给修正）</p>
<h3 id="8-4-alter添加外键约束">8.4 alter添加外键约束</h3>
<p>给定如下两张表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 所有产品的总表</span></span><br><span class="line"><span class="keyword">create table</span> Product(</span><br><span class="line">    maker <span class="type">char</span>(<span class="number">2</span>),</span><br><span class="line">    model <span class="type">integer</span> unsigned <span class="keyword">primary key</span>,</span><br><span class="line">    type <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT NULL</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 台式电脑的表</span></span><br><span class="line"><span class="keyword">create table</span> PC(</span><br><span class="line">    model <span class="type">integer</span> unsigned <span class="keyword">primary key</span>,</span><br><span class="line">    speed <span class="type">float</span>(<span class="number">4</span>,<span class="number">2</span>),</span><br><span class="line">    ram <span class="type">integer</span> unsigned,</span><br><span class="line">    hd <span class="type">integer</span> unsigned,</span><br><span class="line">    price <span class="type">integer</span> unsigned</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>很明显，PC和Product表中都有一个model字段，这两个字段就构成了外键约束关系。且产品总表Product在规模上大于台式电脑表PC，所以Product表是主表，PC表是从表，我们应该给PC表上外键约束，为了防止数据一致性出现错误。</p>
<blockquote>
<p>比如PC表中出现了一个不存在于Product表中的电脑产品，肯定是不对劲的</p>
</blockquote>
<p>使用<code>alter table</code>命令，在表已经创建之后修改它的外键约束。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> PC</span><br><span class="line"><span class="keyword">ADD CONSTRAINT</span> cpc <span class="comment">-- 外键约束的名字为cpc</span></span><br><span class="line"><span class="keyword">FOREIGN KEY</span> (model) <span class="keyword">REFERENCES</span> Product(model);</span><br></pre></td></tr></table></figure>
<p>如下，操作成功，PC表里面的所有数据都符合这个外键约束，没有出错。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [products]&gt; ALTER TABLE PC</span><br><span class="line">    -&gt; ADD CONSTRAINT cpc -- 外键约束的名字为cpc</span><br><span class="line">    -&gt; FOREIGN KEY (model) REFERENCES Product(model);</span><br><span class="line">Query OK, 13 rows affected (0.019 sec)             </span><br><span class="line">Records: 13  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure>
<p>此时往PC里面插入一个Product中不存在的额外记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> PC (model, speed, ram, hd, price) </span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">1050</span>, <span class="number">2.66</span>, <span class="number">1024</span>, <span class="number">250</span>, <span class="number">2114</span>);</span><br></pre></td></tr></table></figure>
<p>如下所示，无法插入成功。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [products]&gt; INSERT INTO PC (model, speed, ram, hd, price) VALUES</span><br><span class="line">    -&gt; (1050, 2.66, 1024, 250, 2114);</span><br><span class="line">ERROR 1452 (23000): Cannot add or update a child row: a foreign key constraint fails (`products`.`PC`, CONSTRAINT `cpc` FOREIGN KEY (`model`) REFERENCES `Product` (`model`))</span><br></pre></td></tr></table></figure>
<h4 id="删除外键约束">删除外键约束</h4>
<p>使用如下命令，从PC表中删除外键约束cpc</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> PC</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">FOREIGN KEY</span> cpc;</span><br></pre></td></tr></table></figure>
<p>删除了之后，我们再次尝试往PC里面插入一个Product中不存在的额外的记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> PC (model, speed, ram, hd, price) </span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">1050</span>, <span class="number">2.66</span>, <span class="number">1024</span>, <span class="number">250</span>, <span class="number">2114</span>);</span><br></pre></td></tr></table></figure>
<p>这一次插入就成功了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [products]&gt; INSERT INTO PC (model, speed, ram, hd, price) </span><br><span class="line">    -&gt; VALUES (1050, 2.66, 1024, 250, 2114);</span><br><span class="line">Query OK, 1 row affected (0.002 sec)</span><br></pre></td></tr></table></figure>
<h4 id="给已有数据冲突的表添加外键">给已有数据冲突的表添加外键</h4>
<p>如果我们尝试给两个外键存在冲突的表添加上外键会如何？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> PC</span><br><span class="line"><span class="keyword">ADD CONSTRAINT</span> cpc <span class="comment">-- 外键约束的名字为cpc</span></span><br><span class="line"><span class="keyword">FOREIGN KEY</span> (model) <span class="keyword">REFERENCES</span> Product(model);</span><br></pre></td></tr></table></figure>
<p>mysql报出警告，不允许插入，报错的意思是外键检查失败，符合预期！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [products]&gt; ALTER TABLE PC</span><br><span class="line">    -&gt; ADD CONSTRAINT cpc -- 外键约束的名字为cpc</span><br><span class="line">    -&gt; FOREIGN KEY (model) REFERENCES Product(model);</span><br><span class="line">ERROR 1452 (23000): Cannot add or update a child row: a foreign key constraint fails (`products`.`#sql-alter-42184-25`, CONSTRAINT `cpc` FOREIGN KEY (`model`) REFERENCES `Product` (`model`))</span><br></pre></td></tr></table></figure>
<h2 id="9-数据检查Check">9.数据检查Check</h2>
<p>前面提到的都是mysql给我们提供的“固定方式”的约束类型，而check则可以由用户来自主选择约束的条件，即对插入表的数据进行有效性检查。</p>
<ul>
<li>某些数据是否大于0？</li>
<li>某些数据是否在某个范围内？</li>
<li>某些数据是否符合某个条件？</li>
</ul>
<h3 id="9-1-数据范围检查">9.1 数据范围检查</h3>
<p>给定如下表，这是一个笔记本的表，内部包含了一台笔记本的一些基本信息。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> Laptop(</span><br><span class="line">    model <span class="type">integer</span> unsigned <span class="keyword">primary key</span>,</span><br><span class="line">    speed <span class="type">float</span>(<span class="number">4</span>,<span class="number">2</span>),</span><br><span class="line">    ram <span class="type">integer</span> unsigned,</span><br><span class="line">    hd <span class="type">integer</span> unsigned,</span><br><span class="line">    screen <span class="type">float</span>(<span class="number">4</span>,<span class="number">2</span>),</span><br><span class="line">    price <span class="type">integer</span> unsigned</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>我们需要检查的是笔记本的<strong>屏幕大小screen</strong>是否在<code>[13,22]</code>之间，如果不在，则代表有问题，不是我们需要售卖的笔记本。</p>
<p>对应的约束条件如下，通过AND链接不同条件，并用括号将完整的判断条件包括起来。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> Laptop</span><br><span class="line"><span class="keyword">ADD CONSTRAINT</span> con_screen</span><br><span class="line"><span class="keyword">CHECK</span> (screen <span class="operator">&gt;=</span> <span class="number">13</span> <span class="keyword">AND</span> screen <span class="operator">&lt;=</span> <span class="number">22</span>);</span><br></pre></td></tr></table></figure>
<p>添加该约束条件后，尝试插入一个屏幕大小为25寸的笔记本，数据库拒绝插入。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [products]&gt; INSERT INTO Laptop (model, speed, ram, hd, screen, price) </span><br><span class="line">    -&gt; VALUES (2050, 2, 2048, 240, 25, 3673);</span><br><span class="line">ERROR 4025 (23000): CONSTRAINT `con_screen` failed for `products`.`Laptop`</span><br></pre></td></tr></table></figure>
<h3 id="9-2-数据是否在给定选项中">9.2 数据是否在给定选项中</h3>
<p>给定如下表，希望printer的type只能是laser或者ink-jet其中一种</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> Printer(</span><br><span class="line">    model <span class="type">integer</span> unsigned <span class="keyword">primary key</span>,</span><br><span class="line">    color <span class="type">char</span>(<span class="number">6</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    type <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    price <span class="type">integer</span> unsigned</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>因为可选项只有两个，可以直接用or来链接两个相等判断，但更好的办法是通过in来判断type是否符合条件。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> Printer</span><br><span class="line"><span class="keyword">ADD CONSTRAINT</span> con_type</span><br><span class="line"><span class="keyword">CHECK</span> (type <span class="keyword">in</span> (<span class="string">&#x27;laser&#x27;</span>,<span class="string">&#x27;ink-jet&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p>执行效果如下，已有数据符合该条件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [products]&gt; ALTER TABLE Printer</span><br><span class="line">    -&gt; ADD CONSTRAINT con_type</span><br><span class="line">    -&gt; CHECK (type in (&#x27;laser&#x27;,&#x27;ink-jet&#x27;));</span><br><span class="line">Query OK, 7 rows affected (0.021 sec)</span><br><span class="line">Records: 7  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure>
<p>尝试插入非法数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into Printer value (3050,&#x27;black&#x27;,&#x27;test&#x27;,1000);</span><br></pre></td></tr></table></figure>
<p>数据库拒绝插入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [products]&gt; insert into Printer value (3050,&#x27;black&#x27;,&#x27;test&#x27;,1000);</span><br><span class="line">ERROR 4025 (23000): CONSTRAINT `con_type` failed for `products`.`Printer`</span><br></pre></td></tr></table></figure>
<h3 id="9-3-多列数据判断">9.3 多列数据判断</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> PC(</span><br><span class="line">    model <span class="type">integer</span> unsigned <span class="keyword">primary key</span>,</span><br><span class="line">    speed <span class="type">float</span>(<span class="number">4</span>,<span class="number">2</span>),</span><br><span class="line">    ram <span class="type">integer</span> unsigned,</span><br><span class="line">    hd <span class="type">integer</span> unsigned,</span><br><span class="line">    price <span class="type">integer</span> unsigned</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>给定PC表，要求硬盘容量hd小于100的电脑价格price不能超过600。</p>
<p>直接用AND链接这两个条件是不行的，会变成<strong>只允许</strong>hd小于100且价格不超过600的PC插入。</p>
<p>这次的条件需要进行逻辑修改：</p>
<ul>
<li>hd小于100且价格大于600的PC拒绝插入</li>
<li>那么就需要一个表达式，让上述条件时为false
<ul>
<li>hd大于100的电脑，价格随便（hd&gt;=100)</li>
<li>hd小于100的电脑，价格必须小于100（price&lt;=600）</li>
<li>用or链接</li>
</ul>
</li>
</ul>
<p>对应表达式如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> PC</span><br><span class="line"><span class="keyword">ADD CONSTRAINT</span> con_price </span><br><span class="line"><span class="keyword">CHECK</span> (hd <span class="operator">&gt;=</span> <span class="number">100</span> <span class="keyword">OR</span> price <span class="operator">&lt;=</span> <span class="number">600</span>);</span><br></pre></td></tr></table></figure>
<p>目标达成！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [products]&gt; ALTER TABLE PC</span><br><span class="line">    -&gt; ADD CONSTRAINT con_price CHECK (hd &gt;= 100 OR price &lt;= 600);</span><br><span class="line">Query OK, 13 rows affected (0.013 sec)</span><br><span class="line">Records: 13  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure>
<p>尝试更新一个记录，将硬盘容量为80的，价格改成700。数据库拒绝此更新。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [products]&gt; UPDATE PC SET price = 700 WHERE model = 1013;</span><br><span class="line">ERROR 4025 (23000): CONSTRAINT `con_price` failed for `products`.`PC`</span><br></pre></td></tr></table></figure>
<p>插入一个正常记录，可以插入（这里先操作Product表，是因为之前设置了Product和PC的外键约束）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [products]&gt; INSERT INTO Product values (&#x27;tt&#x27;,1014,&#x27;PC&#x27;);</span><br><span class="line">Query OK, 1 row affected (0.002 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [products]&gt; INSERT INTO PC (model, speed, ram, hd, price) VALUES (1014, 3.2, 8, 120, 700);</span><br><span class="line">Query OK, 1 row affected (0.002 sec)</span><br></pre></td></tr></table></figure>
<h2 id="The-end">The end</h2>
<p>基础的约束操作就是这些了，有其他会用到的，日后再新增！</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.musnow.top">慕雪年华</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.musnow.top/posts/4138950838/">https://blog.musnow.top/posts/4138950838/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.musnow.top" target="_blank">慕雪的寒舍</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux/">Linux</a><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><div class="post-share"><div class="social-share" data-image="https://img.musnow.top/i/2023/04/64302610057ae.png" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="/pluginsSrc/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="/pluginsSrc/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://ifdian.net/a/128ahri" target="_blank"><img class="post-qr-code-img" src="/img/ico/aifadian.webp" alt="爱发电"/></a><div class="post-qr-code-desc">爱发电</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/3588260369/" title="【Python】调用飞书API获取excel表格中数据"><img class="cover" src="https://img.musnow.top/i/2023/07/a5c10ccb0b9f03254cc6ff5a95e0956b.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">【Python】调用飞书API获取excel表格中数据</div></div><div class="info-2"><div class="info-item-1">调用飞书API获取excel表格中数据  1.说明 关于云文档的api，今天处理kook机器人的时候，有位用户提出了这个和excel对接的需求。 但我翻了翻腾讯云文档和金山云文档，都没有看到正经的获取execl文档中数据的接口（其实是我愚笨实在是没看懂他文档里面在说什么），大多都是将云文档内嵌入到网站中的前端接口。 于是又看了看，找到了一个seatable平台是支持完整的api，甚至支持用sql来查询excel中的数据。但其免费版本的API日用量只有区区5000/天，实在是不够机器人用的。 又找到了飞书，这次总算是找到了我能看懂的用api来操作excel的文档了。  顺带一提，我的域名邮箱就是用的飞书的免费服务，还是很香的。  飞书官方文档：https://open.feishu.cn/document/server-docs/docs/sheets-v3/overview 然后又找到了一个CSDN上的教程：python...</div></div></div></a><a class="pagination-related" href="/posts/274956107/" title="【工具】centos7系统下使用vimplus配置vim的C++环境"><img class="cover" src="https://img.musnow.top/i/2023/07/312b59cbef0e08f920b638985a18d233.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">【工具】centos7系统下使用vimplus配置vim的C++环境</div></div><div class="info-2"><div class="info-item-1">centos7系统下使用vimplus配置vim的C++环境</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/2109090511/" title="【MySQL】C&#x2F;C++代码操作数据库"><img class="cover" src="https://img.musnow.top/i/2023/04/64302610057ae.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-08</div><div class="info-item-2">【MySQL】C&#x2F;C++代码操作数据库</div></div><div class="info-2"><div class="info-item-1">简单尝试使用c语言的库对mysql的数据进行增删改查</div></div></div></a><a class="pagination-related" href="/posts/577382991/" title="【MySQL】安装和基础环境配置"><img class="cover" src="https://img.musnow.top/i/2023/04/64302610057ae.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-06</div><div class="info-item-2">【MySQL】安装和基础环境配置</div></div><div class="info-2"><div class="info-item-1">在本地安装mysql，以mariadb为例</div></div></div></a><a class="pagination-related" href="/posts/3544156851/" title="【MySQL】数据类型"><img class="cover" src="https://img.musnow.top/i/2023/04/64302610057ae.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-06</div><div class="info-item-2">【MySQL】数据类型</div></div><div class="info-2"><div class="info-item-1">mysql的数据类型老多了，单开一篇博客记录一下吧</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="artalk-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/favicon.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">慕雪年华</div><div class="author-info-description">爱折腾的代码初学者</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">460</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">76</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">24</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/musnows/"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://musnow.top/?utm_source=blog" target="_blank" title="个人主页"><i class="fa fa-home"></i></a><a class="social-icon" href="mailto:muxue@musnow.top" target="_blank" title="email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://web.musnow.top/?utm_source=blog" target="_blank" title="导航站点"><i class="fas fa-server"></i></a><a class="social-icon" href="https://gitee.com/musnows" target="_blank" title="Gitee"><i class="fa-sharp fa-solid fa-g"></i></a><a class="social-icon" href="https://blog.csdn.net/muxuen" target="_blank" title="CSDN"><i class="fa-brands fa-blogger-b"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss-square"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到寒舍，近来可好？</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%8C%E6%95%B4%E6%80%A7"><span class="toc-text">数据库完整性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BA%A6%E6%9D%9F"><span class="toc-text">MySQL中的数据约束</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%A9%BA%E5%B1%9E%E6%80%A7null"><span class="toc-text">1.空属性null</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E8%AF%B4%E6%98%8E"><span class="toc-text">1.1 说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E6%A1%88%E4%BE%8B"><span class="toc-text">1.2 案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E9%BB%98%E8%AE%A4%E5%80%BCdefault"><span class="toc-text">2.默认值default</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E9%BB%98%E8%AE%A4%E5%80%BC%E5%92%8CNULL"><span class="toc-text">2.1 默认值和NULL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%88%97%E6%8F%8F%E8%BF%B0comment"><span class="toc-text">3.列描述comment</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-zerofill"><span class="toc-text">4.zerofill</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C"><span class="toc-text">4.1 测试结果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%89%8D%E8%A1%A50"><span class="toc-text">4.2 前补0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E4%B8%BA%E4%BB%80%E4%B9%88int%E6%98%AF11%EF%BC%8C%E6%97%A0%E7%AC%A6%E5%8F%B7%E6%98%AF10%EF%BC%9F"><span class="toc-text">4.3 为什么int是11，无符号是10？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E4%B8%BB%E9%94%AEprimary-key"><span class="toc-text">5.主键primary key</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E4%B8%BB%E9%94%AE%E7%9A%84%E8%AE%BE%E8%AE%A1%E7%B1%BB%E5%9E%8B"><span class="toc-text">5.1 主键的设计类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E5%88%A0%E9%99%A4%E5%92%8C%E6%B7%BB%E5%8A%A0%E4%B8%BB%E9%94%AE"><span class="toc-text">5.2 删除和添加主键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E5%A4%8D%E5%90%88%E4%B8%BB%E9%94%AE"><span class="toc-text">5.3 复合主键</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E8%87%AA%E5%A2%9Eauto-increment"><span class="toc-text">6.自增auto_increment</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E4%BD%BF%E7%94%A8"><span class="toc-text">6.1 使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E8%87%AA%E5%A2%9E%E6%98%AF%E6%80%8E%E4%B9%88%E5%88%A4%E6%96%AD%E5%BD%93%E5%89%8D%E6%89%80%E5%A4%84%E5%BA%8F%E5%8F%B7%E4%BD%8D%E7%BD%AE%E7%9A%84%EF%BC%9F"><span class="toc-text">6.2 自增是怎么判断当前所处序号位置的？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E7%B4%A2%E5%BC%95"><span class="toc-text">6.3 索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%94%AF%E4%B8%80%E9%94%AEunique"><span class="toc-text">7.唯一键unique</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E5%8D%95%E7%8B%AC%E5%94%AF%E4%B8%80%E9%94%AE"><span class="toc-text">7.1 单独唯一键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E5%A4%8D%E5%90%88%E5%94%AF%E4%B8%80%E9%94%AE"><span class="toc-text">7.2 复合唯一键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E5%9C%A8MySQL%E4%B8%ADMUL%E3%80%81PRI%E5%92%8CUNI%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">7.3 在MySQL中MUL、PRI和UNI是什么？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%A4%96%E9%94%AEforeign-key"><span class="toc-text">8.外键foreign key</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E8%AF%B4%E6%98%8E"><span class="toc-text">8.1 说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-%E5%9F%BA%E6%9C%AC%E6%B5%8B%E8%AF%95"><span class="toc-text">8.2 基本测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F%E6%A6%82%E5%BF%B5"><span class="toc-text">8.3 外键约束概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-alter%E6%B7%BB%E5%8A%A0%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-text">8.4 alter添加外键约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-text">删除外键约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%99%E5%B7%B2%E6%9C%89%E6%95%B0%E6%8D%AE%E5%86%B2%E7%AA%81%E7%9A%84%E8%A1%A8%E6%B7%BB%E5%8A%A0%E5%A4%96%E9%94%AE"><span class="toc-text">给已有数据冲突的表添加外键</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E6%95%B0%E6%8D%AE%E6%A3%80%E6%9F%A5Check"><span class="toc-text">9.数据检查Check</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-%E6%95%B0%E6%8D%AE%E8%8C%83%E5%9B%B4%E6%A3%80%E6%9F%A5"><span class="toc-text">9.1 数据范围检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-%E6%95%B0%E6%8D%AE%E6%98%AF%E5%90%A6%E5%9C%A8%E7%BB%99%E5%AE%9A%E9%80%89%E9%A1%B9%E4%B8%AD"><span class="toc-text">9.2 数据是否在给定选项中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-%E5%A4%9A%E5%88%97%E6%95%B0%E6%8D%AE%E5%88%A4%E6%96%AD"><span class="toc-text">9.3 多列数据判断</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-end"><span class="toc-text">The end</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/5899307553/" title="【Hexo】为自己的博客站点加上离线的AI摘要">【Hexo】为自己的博客站点加上离线的AI摘要</a><time datetime="2025-10-02T01:08:21.000Z" title="发表于 2025-10-02 09:08:21">2025-10-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/4044218607/" title="【Agent.04】AI时代的hello world：调用OpenAI接口，与大模型交互">【Agent.04】AI时代的hello world：调用OpenAI接口，与大模型交互</a><time datetime="2025-09-30T07:25:08.000Z" title="发表于 2025-09-30 15:25:08">2025-09-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/3454235760/" title="【面试】求职面试大忌：自断后路">【面试】求职面试大忌：自断后路</a><time datetime="2025-09-29T11:31:10.000Z" title="发表于 2025-09-29 19:31:10">2025-09-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/4200815612/" title="【AI】配置claude-code-router转发Claude Code请求至OpenAI API格式">【AI】配置claude-code-router转发Claude Code请求至OpenAI API格式</a><time datetime="2025-09-27T12:33:46.000Z" title="发表于 2025-09-27 20:33:46">2025-09-27</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/main/mothra.webp);"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2025 By 慕雪年华</div><div class="footer_custom_text"><img src="/img/ico/gonganbeian.png" height="15" style="position:relative; top:2px;">&nbsp;<a href="https://beian.mps.gov.cn/#/query/webSearch?code=44190002007715" rel="noreferrer" target="_blank">粤公网安备44190002007715</a></br><a href="https://icp.gov.moe/?keyword=20230054" target="_blank"><img src="/img/badge/-%E8%90%8CICP%E5%A4%8720230054-ff69b4.svg" height="20px"></a>&nbsp<a href="/sitemap.xml" target="_blank"><img src="/img/badge/-SITEMAP-00CDCD.svg" height="20px"></a>&nbsp<a href="https://beian.miit.gov.cn/" target="_blank"><img src="/img/badge/%E7%B2%A4ICP%E5%A4%872023007189-red.svg" height="20px"></a></br><a href="https://travel.moe/go.html" target="_blank"><img src="/img/ico/moe-default-white.png" style="width:auto;height:25px" title="异次元之旅-跃迁-我们一起去萌站成员的星球旅行吧！"></a>&nbsp<a href="https://www.foreverblog.cn/go.html" target="_blank"><img src="/img/ico/wormhole_1_tp.gif" height="25px"></a>&nbsp<a href="https://www.travellings.cn/go.html" target="_blank"><img src="/img/ico/travelling_icon.gif" height="25px"></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/pluginsSrc/@fancyapps/ui/dist/fancybox/fancybox.umd.js"></script><script src="/pluginsSrc/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }

      const script = document.createElement('script')
      script.src = '/pluginsSrc/mathjax/es5/tex-mml-chtml.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('/pluginsSrc/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  let artalkItem = null
  const option = null
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'

  const destroyArtalk = () => {
    if (artalkItem) {
      artalkItem.destroy()
      artalkItem = null
    }
  }

  const artalkChangeMode = theme => artalkItem && artalkItem.setDarkMode(theme === 'dark')

  const initArtalk = (el = document, pageKey = location.pathname) => {
    artalkItem = Artalk.init({
      el: el.querySelector('#artalk-wrap'),
      server: 'https://artk.musnow.top',
      site: 'mublog',
      darkMode: document.documentElement.getAttribute('data-theme') === 'dark',
      ...option,
      pageKey: isShuoshuo ? pageKey : (option && option.pageKey) || pageKey
    })

    if (GLOBAL_CONFIG.lightbox === 'null') return
    artalkItem.on('list-loaded', () => {
      artalkItem.ctx.get('list').getCommentNodes().forEach(comment => {
        const $content = comment.getRender().$content
        btf.loadLightbox($content.querySelectorAll('img:not([atk-emoticon])'))
      })
    })

    if (isShuoshuo) {
      window.shuoshuoComment.destroyArtalk = () => {
        destroyArtalk()
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    btf.addGlobalFn('pjaxSendOnce', destroyArtalk, 'destroyArtalk')
    btf.addGlobalFn('themeChange', artalkChangeMode, 'artalk')
  }

  const loadArtalk = async (el, pageKey) => {
    if (typeof Artalk === 'object') initArtalk(el, pageKey)
    else {
      await btf.getCSS('/pluginsSrc/artalk/dist/Artalk.css')
      await btf.getScript('/pluginsSrc/artalk/dist/Artalk.js')
      initArtalk(el, pageKey)
    }
  }

  if (isShuoshuo) {
    'Artalk' === 'Artalk'
      ? window.shuoshuoComment = { loadComment: loadArtalk }
      : window.loadOtherComment = loadArtalk
    return
  }

  if ('Artalk' === 'Artalk' || !false) {
    if (false) btf.loadComment(document.getElementById('artalk-wrap'), loadArtalk)
    else setTimeout(loadArtalk, 100)
  } else {
    window.loadOtherComment = loadArtalk
  }
})()</script></div><script src="/js/domain_check.js"></script><script>document.addEventListener('DOMContentLoaded',()=>{if(window.location.pathname.includes('/posts')){const e=document.querySelector('.footnotes');e&&e.insertBefore(document.createElement('strong').appendChild(document.createTextNode('脚注：')).parentNode,e.firstChild);}});</script><script id="click-heart" src="/pluginsSrc/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="true"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>