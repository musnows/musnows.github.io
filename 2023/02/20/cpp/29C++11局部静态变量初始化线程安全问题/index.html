<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="Hexo Theme Keep"><meta name="description" content="çˆ±æŠ˜è…¾çš„ä»£ç åˆå­¦è€…"><meta name="author" content="æ…•é›ªå¹´å"><meta name="baidu-site-verification" content="codeva-aZGKJiqRSI"><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"JwxEfuZ8fwQ1GPEq",ck:"JwxEfuZ8fwQ1GPEq"})</script><title>ã€C++ã€‘C++11ä¸­å±€éƒ¨staticå˜é‡çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ | æ…•é›ªçš„å¯’èˆ</title><link rel="stylesheet" href="/css/style.css"><link rel="shortcut icon" href="/images/myPNG.jpg"><link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/fontawesome.min.css"><link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/regular.min.css"><link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/solid.min.css"><link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/brands.min.css"><script id="hexo-configurations">let KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"blog.musnow.top","root":"/","language":"zh-CN","path":"search.json"}
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true},"style":{"primary_color":"#0066cc","logo":"/images/myPNG.jpg","favicon":"/images/myPNG.jpg","avatar":"/images/myPNG.jpg","font_size":null,"font_family":null,"hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"header_transparent":false,"background_img":"/images/MainBG.jpg","background_post_img":"/images/mothra.png","description":"å¾å¿ƒå¦‚ä¸€ï¼Œæ…•é›ªçº·çº·","font_color":null,"hitokoto":true},"scroll":{"progress_bar":true,"percent":true},"left_side_width":"260px","content_max_width":"920px"},"local_search":{"enable":true,"preload":true},"code_copy":{},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"default"},"side_tools":{},"pjax":{"enable":true},"lazyload":{"enable":true},"comment":{"enable":true,"use":"waline","valine":{"appid":"meufCipLPHNWVE3gWEnozHzz-gzGzoHsz","appkey":"CFX9WelJjGHkaMnSunOlv3dX","server_urls":null,"placeholder":"æ¬¢è¿ç•™ä¸‹ä½ çš„å£°éŸ³ğŸ˜‹"},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.8"},"waline":{"server_url":"https://waline.musnow.top/","reaction":false,"version":2}},"post":{"author_label":{"enable":false,"auto":true,"custom_label_list":["Trainee","Engineer","Architect"]},"word_count":{"enable":true,"wordcount":true,"min2read":false},"img_align":"center","copyright_info":true},"version":"3.6.1"}
    KEEP.language_ago = {"second":"%s ç§’å‰","minute":"%s åˆ†é’Ÿå‰","hour":"%s å°æ—¶å‰","day":"%s å¤©å‰","week":"%s å‘¨å‰","month":"%s ä¸ªæœˆå‰","year":"%s å¹´å‰"}
    KEEP.language_code_block = {"copy":"å¤åˆ¶ä»£ç ","copied":"å·²å¤åˆ¶","fold":"æŠ˜å ä»£ç å—","folded":"å·²æŠ˜å "}
    KEEP.language_copy_copyright = {"copy":"å¤åˆ¶ç‰ˆæƒä¿¡æ¯","copied":"å·²å¤åˆ¶","title":"åŸæ–‡æ ‡é¢˜","author":"åŸæ–‡ä½œè€…","link":"åŸæ–‡é“¾æ¥"}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="æ…•é›ªçš„å¯’èˆ" type="application/atom+xml"></head><body><div class="progress-bar-container"><span class="scroll-progress-bar"></span> <span class="pjax-progress-bar"></span> <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i></div><main class="page-container"><div class="page-main-content"><div class="page-main-content-top"><header class="header-wrapper"><div class="header-content"><div class="left"><a class="logo-image" href="/about/"><img src="/images/myPNG.jpg"> </a><a class="logo-title" href="/">æ…•é›ªçš„å¯’èˆ</a></div><div class="right"><div class="pc"><ul class="menu-list"><li class="menu-item"><a href="/">é¦–é¡µ</a></li><li class="menu-item"><a href="/archives">å½’æ¡£</a></li><li class="menu-item"><a href="/categories">åˆ†ç±»</a></li><li class="menu-item"><a href="/tags">æ ‡ç­¾</a></li><li class="menu-item"><a href="/qa">ç•™è¨€</a></li><li class="menu-item"><a href="/links">å‹é“¾</a></li><li class="menu-item search search-popup-trigger"><i class="fas fa-search"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div><div class="icon-item menu-bar"><div class="menu-bar-middle"></div></div></div></div></div><div class="header-drawer"><ul class="drawer-menu-list"><li class="drawer-menu-item flex-center"><a href="/">é¦–é¡µ</a></li><li class="drawer-menu-item flex-center"><a href="/archives">å½’æ¡£</a></li><li class="drawer-menu-item flex-center"><a href="/categories">åˆ†ç±»</a></li><li class="drawer-menu-item flex-center"><a href="/tags">æ ‡ç­¾</a></li><li class="drawer-menu-item flex-center"><a href="/qa">ç•™è¨€</a></li><li class="drawer-menu-item flex-center"><a href="/links">å‹é“¾</a></li></ul></div><div class="window-mask"></div></header></div><div class="page-main-content-middle"><div class="main-content"><div class="fade-in-down-animation"><div class="post-page-container"><div class="article-content-container"><div class="article-title"><span class="title-hover-animation">ã€C++ã€‘C++11ä¸­å±€éƒ¨staticå˜é‡çš„çº¿ç¨‹å®‰å…¨é—®é¢˜</span></div><div class="article-header"><div class="avatar"><img src="/images/myPNG.jpg"></div><div class="info"><div class="author"><span class="name">æ…•é›ªå¹´å</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-calendar-plus"></i>&nbsp; <span class="pc">2023-02-20 21:13:46</span> <span class="mobile">2023-02-20 21:13</span> </span><span class="article-update-date article-meta-item"><i class="fas fa-file-pen"></i>&nbsp; <span class="pc">2023-03-10 22:54:08</span> </span><span class="article-categories article-meta-item"><i class="fas fa-folder"></i>&nbsp;<ul><li><a href="/categories/%E9%81%87%E8%A7%81C/">é‡è§C++</a>&nbsp;</li></ul></span><span class="article-tags article-meta-item"><i class="fas fa-tags"></i>&nbsp;<ul><li><a href="/tags/C/">C++</a>&nbsp;</li><li>| <a href="/tags/C-11/">C++11</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fas fa-file-word"></i>&nbsp;<span>2.2k å­—</span> </span><span class="article-pv article-meta-item"><i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content keep-markdown-body"><p>C++11ä¸­å±€éƒ¨staticå˜é‡çš„çº¿ç¨‹å®‰å…¨é—®é¢˜</p><span id="more"></span><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å¤§å®¶éƒ½çŸ¥é“ï¼Œåœ¨C++11æ ‡å‡†ä¸­ï¼Œè¦æ±‚å±€éƒ¨é™æ€å˜é‡åˆå§‹åŒ–å…·æœ‰<a class="link" target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8&spm=1001.2101.3001.7020">çº¿ç¨‹å®‰å…¨<i class="fas fa-external-link-alt"></i></a>æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“å®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å•ä¾‹ç±»ï¼š</p><pre><code>class Foo
&#123;
public:
    static Foo *getInstance()
    &#123;
        static Foo s_instance;
        return &amp;s_instance;
    &#125;
private:
    Foo() &#123;&#125;
&#125;;
</code></pre><p>åœ¨C++æ ‡å‡†ä¸­ï¼Œæ˜¯è¿™æ ·æè¿°çš„ï¼ˆåœ¨<a class="link" target="_blank" rel="noopener" href="https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3337.pdf">æ ‡å‡†è‰æ¡ˆ<i class="fas fa-external-link-alt"></i></a>çš„6.7èŠ‚ä¸­ï¼‰ï¼š</p><blockquote><p>such a variable is initialized the first time control passes through its declaration; such a variable is considered initialized upon the completion of its initialization. If the initialization exits by throwing an exception, the initialization is not complete, so it will be tried again the next time control enters the declaration. If control enters the declaration concurrently while the variable is being initialized, the concurrent execution shall wait for completion of the initialization. If control re-enters the declaration recursively while the variable is being initialized, the behavior is undefined.</p></blockquote><h1 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h1><p>æ ‡å‡†å…³äºå±€éƒ¨é™æ€å˜é‡åˆå§‹åŒ–ï¼Œæœ‰è¿™ä¹ˆå‡ ç‚¹è¦æ±‚ï¼š</p><ol><li>å˜é‡åœ¨ä»£ç ç¬¬ä¸€æ¬¡æ‰§è¡Œåˆ°å˜é‡å£°æ˜çš„åœ°æ–¹æ—¶åˆå§‹åŒ–ã€‚</li><li>åˆå§‹åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸çš„è¯è§†ä¸ºæœªå®Œæˆåˆå§‹åŒ–ï¼Œæœªå®Œæˆåˆå§‹åŒ–çš„è¯ï¼Œéœ€è¦ä¸‹æ¬¡æœ‰ä»£ç æ‰§è¡Œåˆ°ç›¸åŒä½ç½®æ—¶å†æ¬¡åˆå§‹åŒ–ã€‚</li><li>åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œåˆ°éœ€è¦åˆå§‹åŒ–å˜é‡çš„åœ°æ–¹æ—¶ï¼Œå¦‚æœæœ‰å…¶ä»–çº¿ç¨‹æ­£åœ¨åˆå§‹åŒ–è¯¥å˜é‡ï¼Œåˆ™é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°åˆå§‹åŒ–å®Œæˆä¸ºæ­¢ã€‚</li><li>å¦‚æœåˆå§‹åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¯¹åˆå§‹åŒ–çš„é€’å½’è°ƒç”¨ï¼Œåˆ™è§†ä¸ºæœªå®šä¹‰è¡Œä¸ºã€‚</li></ol><p>å…³äºç¬¬4ç‚¹ï¼Œå¦‚æœä¸æ˜ç™½ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹ä»£ç ï¼š</p><pre><code>class Bar
&#123;
public:
    static Bar *getInstance()
    &#123;
        static Bar s_instance;
        return &amp;s_instance;
    &#125;
private:
    Bar()
    &#123;
        getInstance();
    &#125;
&#125;;
</code></pre><h1 id="GCCçš„å®ç°"><a href="#GCCçš„å®ç°" class="headerlink" title="GCCçš„å®ç°"></a>GCCçš„å®ç°</h1><p>ä»¥GCC 7.3.0ç‰ˆæœ¬ä¸ºä¾‹ï¼Œæˆ‘ä»¬æ¥åˆ†æGCCæ˜¯å¦‚ä½•å®ç°æ ‡å‡†çš„ã€‚</p><h2 id="Foo-getInstance"><a href="#Foo-getInstance" class="headerlink" title="Foo::getInstance()"></a>Foo::getInstance()</h2><p>ä½¿ç”¨GCCç¼–è¯‘åï¼Œæˆ‘ä»¬ä½¿ç”¨gdbå°†æ–‡ç« å¼€å¤´çš„<code>Foo::getInstance()</code>åæ±‡ç¼–ï¼š</p><pre><code>Dump of assembler code for function Foo::getInstance():
   0x00005555555546ea &lt;+0&gt;:     push   %rbp
   0x00005555555546eb &lt;+1&gt;:     mov    %rsp,%rbp
=&gt; 0x00005555555546ee &lt;+4&gt;:     movzbl 0x20092b(%rip),%eax        # 0x555555755020 &lt;_ZGVZN3Foo11getInstanceEvE10s_instance&gt;
   0x00005555555546f5 &lt;+11&gt;:    test   %al,%al
   0x00005555555546f7 &lt;+13&gt;:    sete   %al
   0x00005555555546fa &lt;+16&gt;:    test   %al,%al
   0x00005555555546fc &lt;+18&gt;:    je     0x55555555472b &lt;Foo::getInstance()+65&gt;
   0x00005555555546fe &lt;+20&gt;:    lea    0x20091b(%rip),%rdi        # 0x555555755020 &lt;_ZGVZN3Foo11getInstanceEvE10s_instance&gt;
   0x0000555555554705 &lt;+27&gt;:    callq  0x5555555545b0 &lt;__cxa_guard_acquire@plt&gt;
   0x000055555555470a &lt;+32&gt;:    test   %eax,%eax
   0x000055555555470c &lt;+34&gt;:    setne  %al
   0x000055555555470f &lt;+37&gt;:    test   %al,%al
   0x0000555555554711 &lt;+39&gt;:    je     0x55555555472b &lt;Foo::getInstance()+65&gt;
   0x0000555555554713 &lt;+41&gt;:    lea    0x2008fe(%rip),%rdi        # 0x555555755018 &lt;_ZZN3Foo11getInstanceEvE10s_instance&gt;
   0x000055555555471a &lt;+48&gt;:    callq  0x555555554734 &lt;Foo::Foo()&gt;
   0x000055555555471f &lt;+53&gt;:    lea    0x2008fa(%rip),%rdi        # 0x555555755020 &lt;_ZGVZN3Foo11getInstanceEvE10s_instance&gt;
   0x0000555555554726 &lt;+60&gt;:    callq  0x5555555545a0 &lt;__cxa_guard_release@plt&gt;
   0x000055555555472b &lt;+65&gt;:    lea    0x2008e6(%rip),%rax        # 0x555555755018 &lt;_ZZN3Foo11getInstanceEvE10s_instance&gt;
   0x0000555555554732 &lt;+72&gt;:    pop    %rbp
   0x0000555555554733 &lt;+73&gt;:    retq   
End of assembler dump.
</code></pre><p>åœ¨<code>+4</code>ã€<code>+20</code>ã€<code>+53</code>å‡ºç°çš„<code>_ZGVZN3Foo11getInstanceEvE10s_instance</code>ä½¿ç”¨<code>c++filt</code>åˆ†æä¸º<code>guard variable for Foo::getInstance()::s_instance</code>ï¼Œè€Œ<code>+41</code>ã€<code>+65</code>ä½ç½®å‡ºç°çš„<code>_ZZN3Foo11getInstanceEvE10s_instance</code>åˆ™ä¸º<code>Foo::getInstance()::s_instance</code>ã€‚åè€…æ˜¯<code>s_instance</code>è¿™ä¸ªå±€éƒ¨é™æ€å˜é‡ï¼Œå‰è€…ä»åå­—çœ‹å°±çŸ¥é“æ˜¯ä¸ª<code>guard</code>æ ‡å¿—å˜é‡ï¼Œç”¨æ¥æŒ‡ç¤ºå±€éƒ¨é™æ€å˜é‡çš„åˆå§‹åŒ–çŠ¶æ€ã€‚</p><h3 id="4-18"><a href="#4-18" class="headerlink" title="+4 ~ +18"></a>+4 ~ +18</h3><p>æµ‹è¯•<code>guard</code>å˜é‡çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œå¦‚æœä¸º<code>0</code>ï¼Œä»£è¡¨<code>s_instance</code>æœªåˆå§‹åŒ–ï¼Œè¿›å…¥<code>+27</code>ï¼›å¦åˆ™ä»£è¡¨<code>s_instance</code>å·²åˆå§‹åŒ–ï¼Œè¿›å…¥<code>+65</code>ã€‚</p><h3 id="20-ï½-27"><a href="#20-ï½-27" class="headerlink" title="+20 ï½ +27"></a>+20 ï½ +27</h3><p>ä»¥<code>guard</code>å˜é‡åœ°å€ä½œä¸ºå‚æ•°ï¼Œæ‰§è¡Œ<code>__cxa_guard_acquire</code>å‡½æ•°ã€‚</p><h3 id="32-ï½-39"><a href="#32-ï½-39" class="headerlink" title="+32 ï½ +39"></a>+32 ï½ +39</h3><p>æµ‹è¯•è¿”å›å€¼ï¼Œå¦‚æœä¸º<code>0</code>ï¼Œä»£è¡¨<code>s_instance</code>å·²åˆå§‹åŒ–ï¼Œè¿›å…¥<code>+65</code>ï¼›å¦åˆ™ä»£è¡¨<code>s_instance</code>æœªåˆå§‹åŒ–ï¼Œè¿›å…¥<code>+41</code>ã€‚</p><h3 id="41-ï½-48"><a href="#41-ï½-48" class="headerlink" title="+41 ï½ +48"></a>+41 ï½ +48</h3><p>åˆå§‹åŒ–<code>s_instance</code></p><h3 id="53-ï½-60"><a href="#53-ï½-60" class="headerlink" title="+53 ï½ +60"></a>+53 ï½ +60</h3><p>ä»¥<code>guard</code>å˜é‡åœ°å€ä½œä¸ºå‚æ•°ï¼Œæ‰§è¡Œ<code>__cxa_guard_release</code>å‡½æ•°ã€‚</p><h3 id="65-ï½-73"><a href="#65-ï½-73" class="headerlink" title="+65 ï½ +73"></a>+65 ï½ +73</h3><p>è¿”å›<code>s_instance</code>åœ°å€</p><h2 id="cxa-guard-acquire"><a href="#cxa-guard-acquire" class="headerlink" title="__cxa_guard_acquire"></a>__cxa_guard_acquire</h2><p>æˆ‘ä»¬æ¥çœ‹çœ‹<code>__cxa_guard_acquire</code>è¿™ä¸ªå‡½æ•°å…·ä½“åšäº†ä»€ä¹ˆï¼Œè¯¥å‡½æ•°ä»£ç ä½äº<code>gcc-7-7.3.0/gcc-7.3.0/libstdc++-v3/libsupc++/guard.cc</code>ã€‚ç”±äºè¿™ä¸ªå‡½æ•°é’ˆå¯¹ä¸åŒå¹³å°åšäº†ä¸åŒçš„å®ç°ï¼Œæœ‰äº›æˆ‘ä»¬ä¸éœ€è¦çš„ä»£ç ï¼Œä»¥æˆ‘æœºå™¨çš„è®¾ç½®ï¼Œæ”¯æŒçº¿ç¨‹å’Œfutexç³»ç»Ÿè°ƒç”¨ï¼Œæ‰€ä»¥åˆ é™¤äº†ä¸€äº›ä¸ç›¸å…³çš„ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cxa_guard_acquire (__guard *g)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// If the target can reorder loads, we need to insert a read memory</span></span><br><span class="line">    <span class="comment">// barrier so that accesses to the guarded variable happen after the</span></span><br><span class="line">    <span class="comment">// guard test.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1</span></span><br><span class="line">    <span class="keyword">if</span> (_GLIBCXX_GUARD_TEST_AND_ACQUIRE (g))</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If __atomic_* and futex syscall are supported, don&#x27;t use any global</span></span><br><span class="line">    <span class="comment">// mutex.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2</span></span><br><span class="line">    <span class="keyword">if</span> (__gthread_active_p ())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> *gi = (<span class="type">int</span> *) (<span class="type">void</span> *) g;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3</span></span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> guard_bit = _GLIBCXX_GUARD_BIT;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> pending_bit = _GLIBCXX_GUARD_PENDING_BIT;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> waiting_bit = _GLIBCXX_GUARD_WAITING_BIT;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 4</span></span><br><span class="line">            <span class="function"><span class="type">int</span> <span class="title">expected</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">            <span class="keyword">if</span> (__atomic_compare_exchange_n(gi, &amp;expected, pending_bit, <span class="literal">false</span>,</span><br><span class="line">                                            __ATOMIC_ACQ_REL,</span><br><span class="line">                                            __ATOMIC_ACQUIRE))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// This thread should do the initialization.</span></span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 5</span></span><br><span class="line">            <span class="keyword">if</span> (expected == guard_bit)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// Already initialized.</span></span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 6</span></span><br><span class="line">            <span class="keyword">if</span> (expected == pending_bit)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// Use acquire here.</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 7</span></span><br><span class="line">                <span class="type">int</span> newv = expected | waiting_bit;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 8</span></span><br><span class="line">                <span class="keyword">if</span> (!__atomic_compare_exchange_n(gi, &amp;expected, newv, <span class="literal">false</span>,</span><br><span class="line">                                                 __ATOMIC_ACQ_REL,</span><br><span class="line">                                                 __ATOMIC_ACQUIRE))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 9</span></span><br><span class="line">                    <span class="keyword">if</span> (expected == guard_bit)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// Make a thread that failed to set the</span></span><br><span class="line">                        <span class="comment">// waiting bit exit the function earlier,</span></span><br><span class="line">                        <span class="comment">// if it detects that another thread has</span></span><br><span class="line">                        <span class="comment">// successfully finished initialising.</span></span><br><span class="line">                        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 10</span></span><br><span class="line">                    <span class="keyword">if</span> (expected == <span class="number">0</span>)</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 11</span></span><br><span class="line">                expected = newv;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 12</span></span><br><span class="line">            <span class="built_in">syscall</span> (SYS_futex, gi, _GLIBCXX_FUTEX_WAIT, expected, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">acquire</span> (g);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>é¦–å…ˆæ£€æµ‹<code>guard</code>å˜é‡ï¼Œ<code>guard</code>å˜é‡ç­‰äº<code>1</code>çš„è¯ï¼Œç›´æ¥è¿”å›<code>0</code>ï¼Œä»£è¡¨<code>s_instance</code>å·²åˆå§‹åŒ–ï¼Œä¸éœ€è¦å†æ¬¡åˆå§‹åŒ–ã€‚</li><li>æ£€æµ‹æ˜¯å¦ä¸ºå¤šçº¿ç¨‹ç¯å¢ƒï¼Œå¦‚æœæ²¡æœ‰å¤šçº¿ç¨‹çš„è¯ï¼Œä¹Ÿå°±æ²¡æœ‰å¿…è¦å»åšé¢å¤–å·¥ä½œæ¥ä¿è¯çº¿ç¨‹å®‰å…¨äº†ã€‚</li><li><code>guard_bit</code>è¡¨ç¤º<code>s_instance</code>å·²ç»åˆå§‹åŒ–æˆåŠŸï¼›<code>pending_bit</code>è¡¨ç¤º<code>s_instance</code>æ­£åœ¨åˆå§‹åŒ–ï¼›<code>waiting_bit</code>è¡¨ç¤ºæœ‰å…¶ä»–çº¿ç¨‹æ­£åœ¨ç­‰å¾…<code>s_instance</code>çš„åˆå§‹åŒ–ã€‚</li><li>ä½¿ç”¨ä¸€ä¸ªåŸå­æ“ä½œæ¥æ£€æµ‹<code>guard</code>å˜é‡æ˜¯å¦ä¸º<code>0</code>ï¼Œå¦‚æœä¸º<code>0</code>ï¼Œåˆ™ç”±å½“å‰çº¿ç¨‹åˆå§‹åŒ–<code>s_instance</code>ï¼ŒæŠŠ<code>pending_bit</code>å†™å…¥guardå˜é‡ï¼Œè¿”å›<code>1</code>ã€‚å¦‚æœä¸ä¸º<code>0</code>ï¼Œåˆ™å°†guardå½“å‰å€¼å†™å…¥<code>expected</code>ã€‚</li><li>æ£€æµ‹<code>expected</code>å€¼æ˜¯å¦ä¸º<code>guard_bit</code>ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™<code>s_instance</code>å·²åˆå§‹åŒ–å®Œæˆï¼Œä¸å†éœ€è¦åˆå§‹åŒ–ï¼Œè¿”å›<code>0</code>ã€‚</li><li>æ£€æµ‹<code>expected</code>å€¼æ˜¯å¦ä¸º<code>pending_bit</code>ï¼Œå¦‚æœæ˜¯ï¼Œè¯´æ˜<code>s_instance</code>æ­£åœ¨åˆå§‹åŒ–ï¼Œä¸”æ²¡æœ‰å…¶ä»–çº¿ç¨‹ç­‰å¾…åˆå§‹åŒ–ã€‚</li><li>å°†<code>newv</code>å˜é‡è®¾ç½®ä¸º<code>pending_bit | waiting_bit</code>ï¼Œè¡¨ç¤º<code>s_instance</code>æ­£åœ¨åˆå§‹åŒ–ä¸”æœ‰çº¿ç¨‹æ­£åœ¨ç­‰å¾…åˆå§‹åŒ–ã€‚</li><li>ä½¿ç”¨ä¸€ä¸ªåŸå­æ“ä½œæ¥æ£€æµ‹<code>guard</code>å˜é‡æ˜¯å¦ä¸º<code>pending_bit</code>ï¼Œå¦‚æœä¸æ˜¯ï¼Œè¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†<code>guard</code>å˜é‡ï¼Œéœ€è¦åšè¿›ä¸€æ­¥æ£€æµ‹ï¼›å¦‚æœæ˜¯ï¼Œè¯´æ˜æ²¡æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹<code>guard</code>å˜é‡ï¼Œåˆ™å°†<code>pending_bit | waiting_bit</code>å†™å…¥<code>guard</code>å˜é‡ã€‚</li><li>å¦‚æœ<code>expected</code>ç­‰äº<code>guard_bit</code>ï¼Œè¯´æ˜<code>s_instance</code>è¢«åˆå§‹åŒ–æˆåŠŸï¼Œä¸éœ€è¦å†åˆå§‹åŒ–ï¼Œè¿”å›<code>0</code>ã€‚</li><li>å¦‚æœ<code>expected</code>ç­‰äº<code>0</code>ï¼Œè¯´æ˜<code>s_instance</code>åˆå§‹åŒ–å¤±è´¥ï¼Œå›åˆ°<code>4</code>é‡æ–°å¼€å§‹æ£€æµ‹ã€‚</li><li>å¦‚æœåœ¨<code>8</code>ä¸­æ²¡æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡<code>guard</code>å˜é‡ï¼Œå°†<code>expected</code>è®¾ç½®ä¸º<code>pending_bit | waiting_bit</code>ï¼Œè¡¨ç¤º<code>s_instance</code>æ­£åœ¨åˆå§‹åŒ–ä¸”æœ‰çº¿ç¨‹ï¼ˆä¹Ÿå°±æ˜¯å½“å‰çº¿ç¨‹ï¼‰æ­£åœ¨ç­‰å¾…åˆå§‹åŒ–ã€‚</li><li>å¦‚æœåœ¨<code>6</code>å¤„æ²¡æœ‰è¿›å…¥ifåˆ†æ”¯ï¼Œè¯´æ˜<code>expected</code>ç­‰äº<code>pending_bit | waiting_bit</code>ï¼Œå¦‚æœè¿›å…¥äº†ifåˆ†æ”¯ï¼Œç”±<code>11</code>å¯å¾—ï¼Œæ­¤æ—¶<code>expected</code>ä¹Ÿè¢«ä¿®æ”¹ä¸ºäº†<code>pending_bit | waiting_bit</code>ã€‚æ€»ä¹‹ï¼Œæ­¤æ—¶<code>s_instance</code>æ­£åœ¨åˆå§‹åŒ–ä¸”æœ‰çº¿ç¨‹æ­£åœ¨ç­‰å¾…åˆå§‹åŒ–ã€‚åˆ©ç”¨<code>futex</code>ç³»ç»Ÿè°ƒç”¨ï¼Œå†æ¬¡æ£€æµ‹<code>guard</code>å˜é‡æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼Œå¦‚æœå‘ç”Ÿäº†å˜åŒ–ï¼Œå›åˆ°<code>4</code>é‡æ–°å¼€å§‹æ£€æµ‹ï¼›å¦‚æœæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä»ç„¶ç­‰äº<code>pending_bit | waiting_bit</code>ï¼Œåˆ™æŒ‚èµ·å½“å‰çº¿ç¨‹ã€‚</li></ol><p>æ€»ä¹‹ï¼Œ<code>__cxa_guard_acquire</code>è¦ä¹ˆè¿”å›<code>0</code>è¦ä¹ˆè¿”å›<code>1</code>ï¼Œç”¨æ¥æŒ‡ç¤º<code>s_instance</code>å·²åˆå§‹åŒ–æˆ–æœªåˆå§‹åŒ–ã€‚<code>__cxa_guard_acquire</code>å¯èƒ½ä¼šå¯¼è‡´å½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œè¿™å‘ç”Ÿåœ¨<code>s_instance</code>æ­£åœ¨åˆå§‹åŒ–çš„æ—¶å€™ã€‚</p><h2 id="cxa-guard-release"><a href="#cxa-guard-release" class="headerlink" title="__cxa_guard_release"></a>__cxa_guard_release</h2><p>ç”±äº<code>__cxa_guard_acquire</code>å¯èƒ½å¯¼è‡´å½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œå› æ­¤éœ€è¦åœ¨<code>s_instance</code>åˆå§‹åŒ–å®Œæˆåä½¿ç”¨å°†<code>__cxa_guard_release</code>çº¿ç¨‹å”¤é†’ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cxa_guard_release (__guard *g) <span class="keyword">throw</span> ()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// If __atomic_* and futex syscall are supported, don&#x27;t use any global</span></span><br><span class="line">    <span class="comment">// mutex.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1</span></span><br><span class="line">    <span class="keyword">if</span> (__gthread_active_p ())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> *gi = (<span class="type">int</span> *) (<span class="type">void</span> *) g;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> guard_bit = _GLIBCXX_GUARD_BIT;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> waiting_bit = _GLIBCXX_GUARD_WAITING_BIT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2</span></span><br><span class="line">        <span class="type">int</span> old = __atomic_exchange_n (gi, guard_bit, __ATOMIC_ACQ_REL);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3</span></span><br><span class="line">        <span class="keyword">if</span> ((old &amp; waiting_bit) != <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">syscall</span> (SYS_futex, gi, _GLIBCXX_FUTEX_WAKE, INT_MAX);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">set_init_in_progress_flag</span>(g, <span class="number">0</span>);</span><br><span class="line">    _GLIBCXX_GUARD_SET_AND_RELEASE (g);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>æ£€æµ‹æ˜¯å¦ä¸ºå¤šçº¿ç¨‹ç¯å¢ƒ</li><li>ä½¿ç”¨åŸå­æ“ä½œå°†<code>guard</code>å˜é‡ç½®ä¸º<code>guard_bit</code>ï¼ŒåŒæ—¶è·å–<code>guard</code>å˜é‡åŸå§‹å€¼ã€‚</li><li>å¦‚æœ<code>guard</code>å˜é‡åŸå§‹å€¼åŒ…å«<code>waiting_bit</code>ï¼Œè¯´æ˜æœ‰çº¿ç¨‹æŒ‚èµ·ï¼ˆæˆ–å°†è¦è°ƒç”¨<code>futex</code>æ¬²ä½¿çº¿ç¨‹æŒ‚èµ·ï¼‰ï¼Œè°ƒç”¨<code>futex</code>å”¤é†’æŒ‚èµ·çš„è¿›ç¨‹ã€‚</li></ol><h2 id="cxa-guard-abort"><a href="#cxa-guard-abort" class="headerlink" title="__cxa_guard_abort"></a>__cxa_guard_abort</h2><p>ç”±äº<code>s_instance</code>å¯èƒ½åˆå§‹åŒ–å¤±è´¥ï¼ˆæœ¬ä¾‹ä¸­å¹¶æœªä½“ç°ï¼‰ï¼Œå› æ­¤è¿˜æœ‰ä¸€ä¸ª<code>__cxa_guard_abort</code>å‡½æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cxa_guard_abort (__guard *g) <span class="keyword">throw</span> ()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// If __atomic_* and futex syscall are supported, don&#x27;t use any global</span></span><br><span class="line">    <span class="comment">// mutex.</span></span><br><span class="line">    <span class="keyword">if</span> (__gthread_active_p ())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> *gi = (<span class="type">int</span> *) (<span class="type">void</span> *) g;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> waiting_bit = _GLIBCXX_GUARD_WAITING_BIT;</span><br><span class="line">        <span class="type">int</span> old = __atomic_exchange_n (gi, <span class="number">0</span>, __ATOMIC_ACQ_REL);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((old &amp; waiting_bit) != <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">syscall</span> (SYS_futex, gi, _GLIBCXX_FUTEX_WAKE, INT_MAX);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">set_init_in_progress_flag</span>(g, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸<code>__cxa_guard_release</code>åŸºæœ¬ä¸€è‡´ï¼Œä¸åŒçš„åœ°æ–¹åœ¨äºä¼šå°†<code>guard</code>å˜é‡ç½®<code>0</code>ã€‚</p><h2 id="é€’å½’åˆå§‹åŒ–è°ƒç”¨"><a href="#é€’å½’åˆå§‹åŒ–è°ƒç”¨" class="headerlink" title="é€’å½’åˆå§‹åŒ–è°ƒç”¨"></a>é€’å½’åˆå§‹åŒ–è°ƒç”¨</h2><p>ç”±äºåœ¨C++11æ ‡å‡†ä¸­ï¼Œåˆå§‹åŒ–å¦‚æœå‘ç”Ÿäº†é€’å½’æ˜¯æœªå®šä¹‰è¡Œä¸ºï¼Œæ‰€ä»¥GCC 7.3.0é’ˆå¯¹æ˜¯å¦ä¸º<a class="link" target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%A4%9A%E7%BA%BF%E7%A8%8B&spm=1001.2101.3001.7020">å¤šçº¿ç¨‹<i class="fas fa-external-link-alt"></i></a>ç¯å¢ƒåšäº†ä¸åŒçš„å¤„ç†ã€‚å¦‚æœæ˜¯å¤šçº¿ç¨‹ç¯å¢ƒï¼Œä¸è¿›è¡Œé¢å¤–å¤„ç†ï¼Œä¼šå‘ç”Ÿæ­»é”ï¼›å¦‚æœæ˜¯å•çº¿ç¨‹ç¯å¢ƒï¼Œåˆ™ä¼šæŠ›å¼‚å¸¸ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// acquire() is a helper function used to acquire guard if thread support is</span></span><br><span class="line"><span class="comment">// not compiled in or is compiled in but not enabled at run-time.</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span></span></span><br><span class="line"><span class="function"><span class="title">acquire</span><span class="params">(__guard *g)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Quit if the object is already initialized.</span></span><br><span class="line">    <span class="keyword">if</span> (_GLIBCXX_GUARD_TEST(g))</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">init_in_progress_flag</span>(g))</span><br><span class="line">        <span class="built_in">throw_recursive_init_exception</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">set_init_in_progress_flag</span>(g, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>çœ‹åˆ°äº†GCCå¦‚æ­¤å¤æ‚çš„å®ç°ï¼Œæˆ‘çš„ä¸ªäººæ„Ÿæƒ³æ˜¯è¿˜æ˜¯ä¸è¦è‡ªå·±é€ è½®å­æ¥ä¿è¯å•ä¾‹ç±»çš„çº¿ç¨‹å®‰å…¨äº†ï¼Œæƒ³è¦åšåˆ°å’ŒGCCä¸€æ ·çš„é«˜æ•ˆè¿˜æ˜¯æ¯”è¾ƒéš¾çš„ï¼Œåˆ©ç”¨C++11æ ‡å‡†çš„å¸¦æ¥çš„ä¾¿åˆ©å°±æŒºå¥½ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åŸæ–‡ä½œè€…ï¼šimred</span><br><span class="line">åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/imred/article/details/89069750</span><br></pre></td></tr></table></figure></div><ul class="post-tags-box"><li class="tag-item"><a href="/tags/C/">#C++</a>&nbsp;</li><li class="tag-item"><a href="/tags/C-11/">#C++11</a>&nbsp;</li></ul><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/2023/02/23/docker/8docker%E5%AE%89%E8%A3%85centos%E9%81%87%E5%88%B0%E6%8A%A5%E9%94%99/"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item">ã€Dockerã€‘é…ç½®CentOSå®¹å™¨æ—¶å‡ºç° Error Failed to download metadata for repo &#39;appstream&#39; Cannot prepare internal mirrorlist</span> <span class="post-nav-item">ä¸Šä¸€ç¯‡</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/2023/02/20/tools/15curl%E6%A8%A1%E6%8B%9Freferer%E8%8E%B7%E5%8F%96%E8%B5%84%E6%BA%90/"><span class="title flex-center"><span class="post-nav-title-item">ã€Curlã€‘é€šè¿‡curlæ¨¡æ‹Ÿrefererè·å–åˆ°æœ‰é˜²ç›—é“¾çš„å›¾ç‰‡</span> <span class="post-nav-item">ä¸‹ä¸€ç¯‡</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div><div class="comment-container"><div class="comments-container"><div id="comments-anchor"></div><div class="comment-area-title"><i class="fas fa-comments"></i>&nbsp;è¯„è®º</div><div class="waline-comment-container"><link rel="stylesheet" href="/css/my/waline.css"><link rel="stylesheet" href="/css/my/waline-meta.css"><script data-pjax src="/css/my/waline.js"></script><div id="waline-comment"></div><script data-pjax>function loadWaline() {
            Waline.init({
              el: '#waline-comment',
              serverURL: 'https://waline.musnow.top/',
              lang: 'zh-CN' || 'zh-CN',
              comment: '.post-comments-count',
              reaction: 'false' === 'true',
              requiredMeta: ['nick','mail'] 
            })
          }

          if ('true' === 'true') {
            setTimeout(() => {
              loadWaline()
            }, 1000)
          } else {
            window.addEventListener('DOMContentLoaded', loadWaline)
          }</script></div></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%86%E6%9E%90"><span class="nav-text">åˆ†æ</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#GCC%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-text">GCCçš„å®ç°</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Foo-getInstance"><span class="nav-text">Foo::getInstance()</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-18"><span class="nav-text">+4 ~ +18</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#20-%EF%BD%9E-27"><span class="nav-text">+20 ï½ +27</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#32-%EF%BD%9E-39"><span class="nav-text">+32 ï½ +39</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#41-%EF%BD%9E-48"><span class="nav-text">+41 ï½ +48</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#53-%EF%BD%9E-60"><span class="nav-text">+53 ï½ +60</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#65-%EF%BD%9E-73"><span class="nav-text">+65 ï½ +73</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cxa-guard-acquire"><span class="nav-text">__cxa_guard_acquire</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cxa-guard-release"><span class="nav-text">__cxa_guard_release</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cxa-guard-abort"><span class="nav-text">__cxa_guard_abort</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%92%E5%BD%92%E5%88%9D%E5%A7%8B%E5%8C%96%E8%B0%83%E7%94%A8"><span class="nav-text">é€’å½’åˆå§‹åŒ–è°ƒç”¨</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-text">æ€»ç»“</span></a></li></ol></div></div></div></div></div></div></div><div class="page-main-content-bottom"><footer class="footer"><div class="info-container"><div class="copyright-info info-item">&copy; <span>2021</span> - 2023 &nbsp;<i class="fas fa-heart icon-animate"></i> &nbsp;<a href="/">æ…•é›ªå¹´å</a></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="website-count info-item">è®¿é—®äººæ•°&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp; æ€»è®¿é—®é‡&nbsp;<span id="busuanzi_value_site_pv"></span></div><div class="timerun-info info-item"><span id="timeDate">è½½å…¥å¤©æ•°...</span><span id="times">è½½å…¥æ—¶åˆ†ç§’...</span><script>var now=new Date;function createtime(){var n=new Date("04/16/2022 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="å·²å‹‰å¼ºè¿è¡Œ "+dnum+" å¤© ",document.getElementById("times").innerHTML=hnum+" æ—¶ "+mnum+" åˆ† "+snum+" ç§’"}setInterval("createtime()",250)</script></div><div class="shields-info info-item"><a href="https://github.com/XPoet/hexo-theme-keep" target="_blank"><img src="https://img.shields.io/badge/hexo-keep-blue" height="20px"> </a><a href="https://musnow.top" target="_blank"><img src="https://img.shields.io/badge/%E4%B8%BB%E7%AB%99-%E7%82%B9%E6%88%91-blueviolet" height="20px"> </a><a href="https://icp.gov.moe/?keyword=20230054" target="_blank"><img src="https://img.shields.io/badge/-%E8%90%8CICP%E5%A4%8720230054-ff69b4" height="20px"> </a><a href="https://beian.miit.gov.cn/" target="_blank"><img src="https://img.shields.io/badge/%E7%B2%A4ICP%E5%A4%87-2023007189%E5%8F%B7-red" height="20px"> </a><a href="https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referral" target="_blank"><img src="/images/UPYUN-CDN.png" height="20px"></a></div></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="tools-list"><li class="tools-item flex-center toggle-show-toc"><i class="fas fa-list"></i></li><li class="tools-item flex-center go-to-comments"><i class="fas fa-comment"></i> <span class="post-comments-count"></span></li></ul></div></div><div class="right-bottom-side-tools"><div class="side-tools-container"><ul class="side-tools-list"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-dark-light-toggle flex-center"><i class="fas fa-moon"></i></li><li class="tools-item rss flex-center"><a class="flex-center" href="/atom.xml" target="_blank"><i class="fas fa-rss"></i></a></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="exposed-tools-list"><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li><li class="tools-item tool-scroll-to-top flex-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="zoom-in-image-mask"><img class="zoom-in-image"></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fas fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="æœç´¢..." spellcheck="false" type="search" class="search-input"></div><span class="close-popup-btn"><i class="fas fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/utils.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/main.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/header-shrink.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/back2top.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/dark-light-toggle.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/local-search.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/code-block.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/lazyload.js"></script><div class="post-scripts pjax"><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/post-helper.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/libs/anime.min.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/toc.js"></script></div><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/libs/pjax.min.js"></script><script>window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });</script><script type="text/javascript" src="/js/snow.js"></script></body></html>